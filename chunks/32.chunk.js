/*! For license information please see uw1a49.32.e58e5282.chunk.js.LICENSE.txt */
(self.a14qw1h7fq=self.a14qw1h7fq||[]).push([[32],{13182:(R,J,B)=>{"use strict";var Q=B(13189),h=B(13195),y=B(13199);B.g.__TYPEDARRAY_POOL||(B.g.__TYPEDARRAY_POOL={UINT8:h([32,0]),UINT16:h([32,0]),UINT32:h([32,0]),INT8:h([32,0]),INT16:h([32,0]),INT32:h([32,0]),FLOAT:h([32,0]),DOUBLE:h([32,0]),DATA:h([32,0]),UINT8C:h([32,0]),BUFFER:h([32,0])});var N="undefined"!==typeof Uint8ClampedArray,r=B.g.__TYPEDARRAY_POOL;r.UINT8C||(r.UINT8C=h([32,0])),r.BUFFER||(r.BUFFER=h([32,0]));var q=r.DATA,e=r.BUFFER;function D(R){if(R){var J=R.length||R.byteLength,B=Q.log2(J);q[B].push(R)}}function l(R){R=Q.nextPow2(R);var J=Q.log2(R),B=q[J];return B.length>0?B.pop():new ArrayBuffer(R)}function E(R){return new Uint8Array(l(R),0,R)}function O(R){return new Uint16Array(l(2*R),0,R)}function n(R){return new Uint32Array(l(4*R),0,R)}function P(R){return new Int8Array(l(R),0,R)}function A(R){return new Int16Array(l(2*R),0,R)}function u(R){return new Int32Array(l(4*R),0,R)}function S(R){return new Float32Array(l(4*R),0,R)}function f(R){return new Float64Array(l(8*R),0,R)}function a(R){return N?new Uint8ClampedArray(l(R),0,R):E(R)}function s(R){return new DataView(l(R),0,R)}J.free=function(R){if(y(R))e[Q.log2(R.length)].push(R);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(R)&&(R=R.buffer),!R)return;var J=R.length||R.byteLength,B=0|Q.log2(J);q[B].push(R)}},J.freeUint8=J.freeUint16=J.freeUint32=J.freeInt8=J.freeInt16=J.freeInt32=J.freeFloat32=J.freeFloat=J.freeFloat64=J.freeDouble=J.freeUint8Clamped=J.freeDataView=function(R){D(R.buffer)},J.freeArrayBuffer=D,J.freeBuffer=function(R){e[Q.log2(R.length)].push(R)},J.malloc=function(R,J){if(void 0===J||"arraybuffer"===J)return l(R);switch(J){case"uint8":return E(R);case"uint16":return O(R);case"uint32":return n(R);case"int8":return P(R);case"int16":return A(R);case"int32":return u(R);case"float":case"float32":return S(R);case"double":case"float64":return f(R);case"uint8_clamped":return a(R);case"buffer":throw"Buffer not supported";case"data":case"dataview":return s(R);default:return null}return null},J.mallocArrayBuffer=l,J.mallocUint8=E,J.mallocUint16=O,J.mallocUint32=n,J.mallocInt8=P,J.mallocInt16=A,J.mallocInt32=u,J.mallocFloat32=J.mallocFloat=S,J.mallocFloat64=J.mallocDouble=f,J.mallocUint8Clamped=a,J.mallocDataView=s,J.clearCache=function(){for(var R=0;R<32;++R)r.UINT8[R].length=0,r.UINT16[R].length=0,r.UINT32[R].length=0,r.INT8[R].length=0,r.INT16[R].length=0,r.INT32[R].length=0,r.FLOAT[R].length=0,r.DOUBLE[R].length=0,r.UINT8C[R].length=0,q[R].length=0,e[R].length=0}},13273:(R,J,B)=>{R.exports=h;var Q=B(12005);function h(R,J){if(!(this instanceof h))return new h(R,J);var B=Q.create();Q.add(B,R,J),this.base=Q.min(Q.create(),R,B),this.nD=Q.clone(J),this.max=Q.max(Q.create(),R,B),this.mag=Q.length(this.nD)}var y=h.prototype;y.width=function(){return this.nD[0]},y.height=function(){return this.nD[1]},y.depth=function(){return this.nD[2]},y.x0=function(){return this.base[0]},y.y0=function(){return this.base[1]},y.z0=function(){return this.base[2]},y.x1=function(){return this.max[0]},y.y1=function(){return this.max[1]},y.z1=function(){return this.max[2]},y.translate=function(R){return Q.add(this.max,this.max,R),Q.add(this.base,this.base,R),this},y.setPosition=function(R){return Q.add(this.max,R,this.nD),Q.j(this.base,R),this},y.expand=function(R){var J=Q.create(),B=Q.create();return Q.max(J,R.max,this.max),Q.min(B,R.base,this.base),Q.PJ(J,J,B),new h(B,J)},y.intersects=function(R){return!(R.base[0]>this.max[0])&&(!(R.base[1]>this.max[1])&&(!(R.base[2]>this.max[2])&&(!(R.max[0]<this.base[0])&&(!(R.max[1]<this.base[1])&&!(R.max[2]<this.base[2])))))},y.touches=function(R){var J=this.union(R);return null!==J&&(0==J.width()||0==J.height()||0==J.depth())},y.union=function(R){if(!this.intersects(R))return null;var J=Math.max(R.base[0],this.base[0]),B=Math.max(R.base[1],this.base[1]),Q=Math.max(R.base[2],this.base[2]);return new h([J,B,Q],[Math.min(R.max[0],this.max[0])-J,Math.min(R.max[1],this.max[1])-B,Math.min(R.max[2],this.max[2])-Q])}},13189:(R,J)=>{"use strict";function B(R){var J=32;return(R&=-R)&&J--,65535&R&&(J-=16),16711935&R&&(J-=8),252645135&R&&(J-=4),858993459&R&&(J-=2),1431655765&R&&(J-=1),J}J.INT_BITS=32,J.INT_MAX=2147483647,J.INT_MIN=-1<<31,J.sign=function(R){return(R>0)-(R<0)},J.abs=function(R){var J=R>>31;return(R^J)-J},J.min=function(R,J){return J^(R^J)&-(R<J)},J.max=function(R,J){return R^(R^J)&-(R<J)},J.isPow2=function(R){return!(R&R-1)&&!!R},J.log2=function(R){var J,B;return J=(R>65535)<<4,J|=B=((R>>>=J)>255)<<3,J|=B=((R>>>=B)>15)<<2,(J|=B=((R>>>=B)>3)<<1)|(R>>>=B)>>1},J.log10=function(R){return R>=1e9?9:R>=1e8?8:R>=1e7?7:R>=1e6?6:R>=1e5?5:R>=1e4?4:R>=1e3?3:R>=100?2:R>=10?1:0},J.popCount=function(R){return 16843009*((R=(858993459&(R-=R>>>1&1431655765))+(R>>>2&858993459))+(R>>>4)&252645135)>>>24},J.countTrailingZeros=B,J.nextPow2=function(R){return R+=0===R,--R,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)+1},J.prevPow2=function(R){return R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)-(R>>>1)},J.parity=function(R){return R^=R>>>16,R^=R>>>8,R^=R>>>4,27030>>>(R&=15)&1};var Q=new Array(256);!function(R){for(var J=0;J<256;++J){var B=J,Q=J,h=7;for(B>>>=1;B;B>>>=1)Q<<=1,Q|=1&B,--h;R[J]=Q<<h&255}}(Q),J.reverse=function(R){return Q[255&R]<<24|Q[R>>>8&255]<<16|Q[R>>>16&255]<<8|Q[R>>>24&255]},J.interleave2=function(R,J){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))|(J=1431655765&((J=858993459&((J=252645135&((J=16711935&((J&=65535)|J<<8))|J<<4))|J<<2))|J<<1))<<1},J.deinterleave2=function(R,J){return(R=65535&((R=16711935&((R=252645135&((R=858993459&((R=R>>>J&1431655765)|R>>>1))|R>>>2))|R>>>4))|R>>>16))<<16>>16},J.interleave3=function(R,J,B){return R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2),(R|=(J=1227133513&((J=3272356035&((J=251719695&((J=4278190335&((J&=1023)|J<<16))|J<<8))|J<<4))|J<<2))<<1)|(B=1227133513&((B=3272356035&((B=251719695&((B=4278190335&((B&=1023)|B<<16))|B<<8))|B<<4))|B<<2))<<2},J.deinterleave3=function(R,J){return(R=1023&((R=4278190335&((R=251719695&((R=3272356035&((R=R>>>J&1227133513)|R>>>2))|R>>>4))|R>>>8))|R>>>16))<<22>>22},J.nextCombination=function(R){var J=R|R-1;return J+1|(~J&-~J)-1>>>B(R)+1}},13180:(R,J,B)=>{"use strict";R.exports=function(R,J,B){switch(arguments.length){case 1:return Q=[],e(h=R,h,D,!0),Q;case 2:return"function"===typeof J?e(R,R,J,!0):function(R,J){return Q=[],e(R,J,D,!1),Q}(R,J);case 3:return e(R,J,B,!1);default:throw new Error("box-intersect: Invalid arguments")}var h};var Q,h=B(13182),y=B(13201),N=B(13213);function r(R,J){for(var B=0;B<R;++B)if(!(J[B]<=J[B+R]))return!0;return!1}function q(R,J,B,Q){for(var h=0,y=0,N=0,q=R.length;N<q;++N){var e=R[N];if(!r(J,e)){for(var D=0;D<2*J;++D)B[h++]=e[D];Q[y++]=N}}return y}function e(R,J,B,Q){var r=R.length,e=J.length;if(!(r<=0||e<=0)){var D=R[0].length>>>1;if(!(D<=0)){var l,E=h.mallocDouble(2*D*r),O=h.mallocInt32(r);if((r=q(R,D,E,O))>0){if(1===D&&Q)y.init(r),l=y.sweepComplete(D,B,0,r,E,O,0,r,E,O);else{var n=h.mallocDouble(2*D*e),P=h.mallocInt32(e);(e=q(J,D,n,P))>0&&(y.init(r+e),l=1===D?y.sweepBipartite(D,B,0,r,E,O,0,e,n,P):N(D,B,Q,r,E,O,e,n,P),h.free(n),h.free(P))}h.free(E),h.free(O)}return l}}}function D(R,J){Q.push([R,J])}},13219:(R,J)=>{"use strict";var B="d",Q="ax",h="fp",y="es",N="rs",r="re",q="rb",e="bs",D="be",l="bb",E=[B,Q,"vv",N,r,q,"ri",e,D,l,"bi"];function O(R){var J="bruteForce"+(R?"Full":"Partial"),Q=[],N=E.slice();R||N.splice(3,0,h);var r=["function "+J+"("+N.join()+"){"];function q(J,h){var N=function(R,J,Q){var h="bruteForce"+(R?"Red":"Blue")+(J?"Flip":"")+(Q?"Full":""),N=["function ",h,"(",E.join(),"){","var ",y,"=2*",B,";"],r="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",q="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(Q?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return R?N.push(r,"Q",":",q):N.push(q,"Q",":",r),Q?N.push("if(y1<x0||x1<y0)continue;"):J?N.push("if(y0<=x0||x1<y0)continue;"):N.push("if(y0<x0||x1<y0)continue;"),N.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),J?N.push("yi,xi"):N.push("xi,yi"),N.push(");if(rv!==void 0)return rv;}}}"),{name:h,code:N.join("")}}(J,h,R);Q.push(N.code),r.push("return "+N.name+"("+E.join()+");")}r.push("if(re-rs>be-bs){"),R?(q(!0,!1),r.push("}else{"),q(!1,!1)):(r.push("if(fp){"),q(!0,!0),r.push("}else{"),q(!0,!1),r.push("}}else{if(fp){"),q(!1,!0),r.push("}else{"),q(!1,!1),r.push("}")),r.push("}}return "+J);var e=Q.join("")+r.join("");return new Function(e)()}J.partial=O(!1),J.full=O(!0)},13213:(R,J,B)=>{"use strict";R.exports=function(R,J,B,y,D,d,X,c,z){!function(R,J){var B=8*h.log2(J+1)*(R+1)|0,y=h.nextPow2(a*B);x.length<y&&(Q.free(x),x=Q.mallocInt32(y));var N=h.nextPow2(s*B);I.length<N&&(Q.free(I),I=Q.mallocDouble(N))}(R,y+X);var p,i=0,W=2*R;V(i++,0,0,y,0,X,B?16:0,-1/0,1/0),B||V(i++,0,0,X,0,y,1,-1/0,1/0);for(;i>0;){var k=(i-=1)*a,Y=x[k],G=x[k+1],g=x[k+2],L=x[k+3],j=x[k+4],T=x[k+5],F=i*s,C=I[F],b=I[F+1],w=1&T,K=!!(16&T),v=D,m=d,o=c,t=z;if(w&&(v=c,m=z,o=D,t=d),!(2&T&&G>=(g=A(R,Y,G,g,v,m,b)))&&!(4&T&&(G=u(R,Y,G,g,v,m,C))>=g)){var Z=g-G,U=j-L;if(K){if(R*Z*(Z+U)<O){if(void 0!==(p=q.scanComplete(R,Y,J,G,g,v,m,L,j,o,t)))return p;continue}}else{if(R*Math.min(Z,U)<l){if(void 0!==(p=N(R,Y,J,w,G,g,v,m,L,j,o,t)))return p;continue}if(R*Z*U<E){if(void 0!==(p=q.scanBipartite(R,Y,J,w,G,g,v,m,L,j,o,t)))return p;continue}}var RR=n(R,Y,G,g,v,m,C,b);if(G<RR)if(R*(RR-G)<l){if(void 0!==(p=r(R,Y+1,J,G,RR,v,m,L,j,o,t)))return p}else if(Y===R-2){if(void 0!==(p=w?q.sweepBipartite(R,J,L,j,o,t,G,RR,v,m):q.sweepBipartite(R,J,G,RR,v,m,L,j,o,t)))return p}else V(i++,Y+1,G,RR,L,j,w,-1/0,1/0),V(i++,Y+1,L,j,G,RR,1^w,-1/0,1/0);if(RR<g){var JR=e(R,Y,L,j,o,t),BR=o[W*JR+Y],QR=P(R,Y,JR,j,o,t,BR);if(QR<j&&V(i++,Y,RR,g,QR,j,(4|w)+(K?16:0),BR,b),L<JR&&V(i++,Y,RR,g,L,JR,(2|w)+(K?16:0),C,BR),JR+1===QR){if(void 0!==(p=K?H(R,Y,J,RR,g,v,m,JR,o,t[JR]):M(R,Y,J,w,RR,g,v,m,JR,o,t[JR])))return p}else if(JR<QR){var hR;if(K){if(RR<(hR=S(R,Y,RR,g,v,m,BR))){var yR=P(R,Y,RR,hR,v,m,BR);if(Y===R-2){if(RR<yR&&void 0!==(p=q.sweepComplete(R,J,RR,yR,v,m,JR,QR,o,t)))return p;if(yR<hR&&void 0!==(p=q.sweepBipartite(R,J,yR,hR,v,m,JR,QR,o,t)))return p}else RR<yR&&V(i++,Y+1,RR,yR,JR,QR,16,-1/0,1/0),yR<hR&&(V(i++,Y+1,yR,hR,JR,QR,0,-1/0,1/0),V(i++,Y+1,JR,QR,yR,hR,1,-1/0,1/0))}}else RR<(hR=w?f(R,Y,RR,g,v,m,BR):S(R,Y,RR,g,v,m,BR))&&(Y===R-2?p=w?q.sweepBipartite(R,J,JR,QR,o,t,RR,hR,v,m):q.sweepBipartite(R,J,RR,hR,v,m,JR,QR,o,t):(V(i++,Y+1,RR,hR,JR,QR,w,-1/0,1/0),V(i++,Y+1,JR,QR,RR,hR,1^w,-1/0,1/0)))}}}}};var Q=B(13182),h=B(13189),y=B(13219),N=y.partial,r=y.full,q=B(13201),e=B(13224),D=B(13226),l=128,E=1<<22,O=1<<22,n=D("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),P=D("lo===p0",["p0"]),A=D("lo<p0",["p0"]),u=D("hi<=p0",["p0"]),S=D("lo<=p0&&p0<=hi",["p0"]),f=D("lo<p0&&p0<=hi",["p0"]),a=6,s=2,x=Q.mallocInt32(1024),I=Q.mallocDouble(1024);function V(R,J,B,Q,h,y,N,r,q){var e=a*R;x[e]=J,x[e+1]=B,x[e+2]=Q,x[e+3]=h,x[e+4]=y,x[e+5]=N;var D=s*R;I[D]=r,I[D+1]=q}function M(R,J,B,Q,h,y,N,r,q,e,D){var l=2*R,E=q*l,O=e[E+J];R:for(var n=h,P=h*l;n<y;++n,P+=l){var A=N[P+J],u=N[P+J+R];if(!(O<A||u<O)&&(!Q||O!==A)){for(var S,f=r[n],a=J+1;a<R;++a){A=N[P+a],u=N[P+a+R];var s=e[E+a],x=e[E+a+R];if(u<s||x<A)continue R}if(void 0!==(S=Q?B(D,f):B(f,D)))return S}}}function H(R,J,B,Q,h,y,N,r,q,e){var D=2*R,l=r*D,E=q[l+J];R:for(var O=Q,n=Q*D;O<h;++O,n+=D){var P=N[O];if(P!==e){var A=y[n+J],u=y[n+J+R];if(!(E<A||u<E)){for(var S=J+1;S<R;++S){A=y[n+S],u=y[n+S+R];var f=q[l+S],a=q[l+S+R];if(u<f||a<A)continue R}var s=B(P,e);if(void 0!==s)return s}}}}},13224:(R,J,B)=>{"use strict";R.exports=function(R,J,B,N,r,q){if(N<=B+1)return B;var e=B,D=N,l=N+B>>>1,E=2*R,O=l,n=r[E*l+J];for(;e<D;){if(D-e<h){y(R,J,e,D,r,q),n=r[E*l+J];break}var P=D-e,A=Math.random()*P+e|0,u=r[E*A+J],S=Math.random()*P+e|0,f=r[E*S+J],a=Math.random()*P+e|0,s=r[E*a+J];u<=f?s>=f?(O=S,n=f):u>=s?(O=A,n=u):(O=a,n=s):f>=s?(O=S,n=f):s>=u?(O=A,n=u):(O=a,n=s);for(var x=E*(D-1),I=E*O,V=0;V<E;++V,++x,++I){var M=r[x];r[x]=r[I],r[I]=M}var H=q[D-1];q[D-1]=q[O],q[O]=H;for(x=E*(D-1),I=E*(O=Q(R,J,e,D-1,r,q,n)),V=0;V<E;++V,++x,++I){M=r[x];r[x]=r[I],r[I]=M}H=q[D-1];if(q[D-1]=q[O],q[O]=H,l<O){for(D=O-1;e<D&&r[E*(D-1)+J]===n;)D-=1;D+=1}else{if(!(O<l))break;for(e=O+1;e<D&&r[E*e+J]===n;)e+=1}}return Q(R,J,B,l,r,q,r[E*l+J])};var Q=B(13226)("lo<p0",["p0"]),h=8;function y(R,J,B,Q,h,y){for(var N=2*R,r=N*(B+1)+J,q=B+1;q<Q;++q,r+=N)for(var e=h[r],D=q,l=N*(q-1);D>B&&h[l+J]>e;--D,l-=N){for(var E=l,O=l+N,n=0;n<N;++n,++E,++O){var P=h[E];h[E]=h[O],h[O]=P}var A=y[D];y[D]=y[D-1],y[D-1]=A}}},13226:R=>{"use strict";R.exports=function(R,B){var Q="abcdef".split("").concat(B),h=[];R.indexOf("lo")>=0&&h.push("lo=e[k+n]");R.indexOf("hi")>=0&&h.push("hi=e[k+o]");return Q.push(J.replace("_",h.join()).replace("$",R)),Function.apply(void 0,Q)};var J="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13208:R=>{"use strict";R.exports=function(R,Q){Q<=4*J?B(0,Q-1,R):e(0,Q-1,R)};var J=32;function B(R,J,B){for(var Q=2*(R+1),h=R+1;h<=J;++h){for(var y=B[Q++],N=B[Q++],r=h,q=Q-2;r-- >R;){var e=B[q-2],D=B[q-1];if(e<y)break;if(e===y&&D<N)break;B[q]=e,B[q+1]=D,q-=2}B[q]=y,B[q+1]=N}}function Q(R,J,B){J*=2;var Q=B[R*=2],h=B[R+1];B[R]=B[J],B[R+1]=B[J+1],B[J]=Q,B[J+1]=h}function h(R,J,B){J*=2,B[R*=2]=B[J],B[R+1]=B[J+1]}function y(R,J,B,Q){J*=2,B*=2;var h=Q[R*=2],y=Q[R+1];Q[R]=Q[J],Q[R+1]=Q[J+1],Q[J]=Q[B],Q[J+1]=Q[B+1],Q[B]=h,Q[B+1]=y}function N(R,J,B,Q,h){J*=2,h[R*=2]=h[J],h[J]=B,h[R+1]=h[J+1],h[J+1]=Q}function r(R,J,B){J*=2;var Q=B[R*=2],h=B[J];return!(Q<h)&&(Q!==h||B[R+1]>B[J+1])}function q(R,J,B,Q){var h=Q[R*=2];return h<J||h===J&&Q[R+1]<B}function e(R,D,l){var E=(D-R+1)/6|0,O=R+E,n=D-E,P=R+D>>1,A=P-E,u=P+E,S=O,f=A,a=P,s=u,x=n,I=R+1,V=D-1,M=0;r(S,f,l)&&(M=S,S=f,f=M),r(s,x,l)&&(M=s,s=x,x=M),r(S,a,l)&&(M=S,S=a,a=M),r(f,a,l)&&(M=f,f=a,a=M),r(S,s,l)&&(M=S,S=s,s=M),r(a,s,l)&&(M=a,a=s,s=M),r(f,x,l)&&(M=f,f=x,x=M),r(f,a,l)&&(M=f,f=a,a=M),r(s,x,l)&&(M=s,s=x,x=M);for(var H=l[2*f],d=l[2*f+1],X=l[2*s],c=l[2*s+1],z=2*S,p=2*a,i=2*x,W=2*O,k=2*P,Y=2*n,G=0;G<2;++G){var g=l[z+G],L=l[p+G],j=l[i+G];l[W+G]=g,l[k+G]=L,l[Y+G]=j}h(A,R,l),h(u,D,l);for(var T=I;T<=V;++T)if(q(T,H,d,l))T!==I&&Q(T,I,l),++I;else if(!q(T,X,c,l))for(;;){if(q(V,X,c,l)){q(V,H,d,l)?(y(T,I,V,l),++I,--V):(Q(T,V,l),--V);break}if(--V<T)break}N(R,I-1,H,d,l),N(D,V+1,X,c,l),I-2-R<=J?B(R,I-2,l):e(R,I-2,l),D-(V+2)<=J?B(V+2,D,l):e(V+2,D,l),V-I<=J?B(I,V,l):e(I,V,l)}},13201:(R,J,B)=>{"use strict";R.exports={init:function(R){var J=h.nextPow2(R);q.length<J&&(Q.free(q),q=Q.mallocInt32(J));e.length<J&&(Q.free(e),e=Q.mallocInt32(J));D.length<J&&(Q.free(D),D=Q.mallocInt32(J));l.length<J&&(Q.free(l),l=Q.mallocInt32(J));E.length<J&&(Q.free(E),E=Q.mallocInt32(J));O.length<J&&(Q.free(O),O=Q.mallocInt32(J));var B=8*J;n.length<B&&(Q.free(n),n=Q.mallocDouble(B))},sweepBipartite:function(R,J,B,Q,h,r,E,O,u,S){for(var f=0,a=2*R,s=R-1,x=a-1,I=B;I<Q;++I){var V=r[I],M=a*I;n[f++]=h[M+s],n[f++]=-(V+1),n[f++]=h[M+x],n[f++]=V}for(I=E;I<O;++I){V=S[I]+N;var H=a*I;n[f++]=u[H+s],n[f++]=-V,n[f++]=u[H+x],n[f++]=V}var d=f>>>1;y(n,d);var X=0,c=0;for(I=0;I<d;++I){var z=0|n[2*I+1];if(z>=N)P(D,l,c--,z=z-N|0);else if(z>=0)P(q,e,X--,z);else if(z<=-N){z=-z-N|0;for(var p=0;p<X;++p){if(void 0!==(i=J(q[p],z)))return i}A(D,l,c++,z)}else{z=-z-1|0;for(p=0;p<c;++p){var i;if(void 0!==(i=J(z,D[p])))return i}A(q,e,X++,z)}}},sweepComplete:function(R,J,B,Q,h,N,r,u,S,f){for(var a=0,s=2*R,x=R-1,I=s-1,V=B;V<Q;++V){var M=N[V]+1<<1,H=s*V;n[a++]=h[H+x],n[a++]=-M,n[a++]=h[H+I],n[a++]=M}for(V=r;V<u;++V){M=f[V]+1<<1;var d=s*V;n[a++]=S[d+x],n[a++]=1|-M,n[a++]=S[d+I],n[a++]=1|M}var X=a>>>1;y(n,X);var c=0,z=0,p=0;for(V=0;V<X;++V){var i=0|n[2*V+1],W=1&i;if(V<X-1&&i>>1===n[2*V+3]>>1&&(W=2,V+=1),i<0){for(var k=-(i>>1)-1,Y=0;Y<p;++Y){if(void 0!==(G=J(E[Y],k)))return G}if(0!==W)for(Y=0;Y<c;++Y){if(void 0!==(G=J(q[Y],k)))return G}if(1!==W)for(Y=0;Y<z;++Y){var G;if(void 0!==(G=J(D[Y],k)))return G}0===W?A(q,e,c++,k):1===W?A(D,l,z++,k):2===W&&A(E,O,p++,k)}else{k=(i>>1)-1;0===W?P(q,e,c--,k):1===W?P(D,l,z--,k):2===W&&P(E,O,p--,k)}}},scanBipartite:function(R,J,B,Q,h,r,D,l,E,O,u,S){var f=0,a=2*R,s=J,x=J+R,I=1,V=1;Q?V=N:I=N;for(var M=h;M<r;++M){var H=M+I,d=a*M;n[f++]=D[d+s],n[f++]=-H,n[f++]=D[d+x],n[f++]=H}for(M=E;M<O;++M){H=M+V;var X=a*M;n[f++]=u[X+s],n[f++]=-H}var c=f>>>1;y(n,c);var z=0;for(M=0;M<c;++M){var p=0|n[2*M+1];if(p<0){var i=!1;if((H=-p)>=N?(i=!Q,H-=N):(i=!!Q,H-=1),i)A(q,e,z++,H);else{var W=S[H],k=a*H,Y=u[k+J+1],G=u[k+J+1+R];R:for(var g=0;g<z;++g){var L=q[g],j=a*L;if(!(G<D[j+J+1]||D[j+J+1+R]<Y)){for(var T=J+2;T<R;++T)if(u[k+T+R]<D[j+T]||D[j+T+R]<u[k+T])continue R;var F,C=l[L];if(void 0!==(F=Q?B(W,C):B(C,W)))return F}}}}else P(q,e,z--,p-I)}},scanComplete:function(R,J,B,Q,h,r,e,D,l,E,O){for(var P=0,A=2*R,u=J,S=J+R,f=Q;f<h;++f){var a=f+N,s=A*f;n[P++]=r[s+u],n[P++]=-a,n[P++]=r[s+S],n[P++]=a}for(f=D;f<l;++f){a=f+1;var x=A*f;n[P++]=E[x+u],n[P++]=-a}var I=P>>>1;y(n,I);var V=0;for(f=0;f<I;++f){var M=0|n[2*f+1];if(M<0){if((a=-M)>=N)q[V++]=a-N;else{var H=O[a-=1],d=A*a,X=E[d+J+1],c=E[d+J+1+R];R:for(var z=0;z<V;++z){var p=q[z],i=e[p];if(i===H)break;var W=A*p;if(!(c<r[W+J+1]||r[W+J+1+R]<X)){for(var k=J+2;k<R;++k)if(E[d+k+R]<r[W+k]||r[W+k+R]<E[d+k])continue R;var Y=B(i,H);if(void 0!==Y)return Y}}}}else{for(a=M-N,z=V-1;z>=0;--z)if(q[z]===a){for(k=z+1;k<V;++k)q[k-1]=q[k];break}--V}}}};var Q=B(13182),h=B(13189),y=B(13208),N=1<<28,r=1024,q=Q.mallocInt32(r),e=Q.mallocInt32(r),D=Q.mallocInt32(r),l=Q.mallocInt32(r),E=Q.mallocInt32(r),O=Q.mallocInt32(r),n=Q.mallocDouble(8192);function P(R,J,B,Q){var h=J[Q],y=R[B-1];R[h]=y,J[y]=h}function A(R,J,B,Q){R[B]=Q,J[Q]=B}},13195:R=>{"use strict";function J(R,B,Q){var h=0|R[Q];if(h<=0)return[];var y,N=new Array(h);if(Q===R.length-1)for(y=0;y<h;++y)N[y]=B;else for(y=0;y<h;++y)N[y]=J(R,B,Q+1);return N}R.exports=function(R,B){switch("undefined"===typeof B&&(B=0),typeof R){case"number":if(R>0)return function(R,J){var B,Q;for(B=new Array(R),Q=0;Q<R;++Q)B[Q]=J;return B}(0|R,B);break;case"object":if("number"===typeof R.length)return J(R,B,0)}return[]}},13146:(R,J,B)=>{R.exports=function(){var R=this;this.components={},this.comps=this.components;var J=this.components,B=1,h={},y=[],N=[],r={timeout:!1,removals:[],multiComps:[]};function q(R,B){var Q=J[B],y=h[B],N=y.hash[R];N&&(y.remove(R),Q.QQ&&(Q.multi?(N.forEach((J=>{J&&Q.QQ(R,J)})),N.length=0):Q.QQ(R,N)),r.removals.push(y),e())}function e(){r.timeout||(r.timeout=!0,setTimeout(D,1))}function D(){r.timeout=!1,l()}function l(){r.multiComps.length&&function(R){for(var J=0;J<R.length;J++){var{entID:B,data:Q}=R[J],h=Q.hash[B];if(h){for(var y=0;y<h.length;y++)h[y]||(h.splice(y,1),y--);0===h.length&&(Q.remove(B),r.removals.push(Q))}}R.length=0}(r.multiComps),r.removals.length&&function(R){for(var J=0;J<R.length;J++){R[J].flush()}R.length=0}(r.removals)}this.cl=h,this._systems=y,this._renderSystems=N,this.uD=function(J){var Q=B++;return Array.isArray(J)&&J.forEach((J=>R.Yq(Q,J))),Q},this.deleteEntity=function(J){return Object.keys(h).forEach((R=>{h[R].hash[J]&&q(J,R)})),R},this.iD=function(R){if(!R)throw new Error("Missing component definition");var B=R.name;if(!B)throw new Error("Component definition must have a name property.");if("string"!==typeof B)throw new Error("Component name must be a string.");if(""===B)throw new Error("Component name must be a non-empty string.");if(h[B])throw new Error(`Component ${B} already exists.`);var r={};return r.name=B,r.multi=!!R.multi,r.order=isNaN(R.order)?99:R.order,r.stateConstructor=R.stateConstructor||null,r.state=R.state||{},r.ir=R.ir||null,r.QQ=R.QQ||null,r.system=R.system||null,r.Lr=R.Lr||null,J[B]=r,h[B]=new Q,h[B]._pendingMultiCleanup=!1,h[B]._multiCleanupIDs=r.multi?[]:null,r.system&&(y.push(B),y.sort(((R,B)=>J[R].order-J[B].order))),r.Lr&&(N.push(B),N.sort(((R,B)=>J[R].order-J[B].order))),B},this.overwriteComponent=function(R,B){var Q=J[R];if(!Q)throw new Error(`Unknown component: ${R}`);if(!B)throw new Error("Missing component definition");if(Q.name!==B.name)throw new Error("Overwriting component must use the same name property.");var r={};r.name=R,r.multi=!!B.multi,r.order=isNaN(B.order)?99:B.order,r.state=B.state||{},r.ir=B.ir||null,r.QQ=B.QQ||null,r.system=B.system||null,r.Lr=B.Lr||null,J[R]=r,h[R]._pendingMultiCleanup=!1,h[R]._multiCleanupIDs=r.multi?[]:null;var q=y.indexOf(R);r.system&&q<0&&y.push(R),!r.system&&q>=0&&y.splice(q,1),y.sort(((R,B)=>J[R].order-J[B].order));var e=N.indexOf(R);r.Lr&&e<0&&N.push(R),!r.Lr&&e>=0&&N.splice(e,1),N.sort(((R,B)=>J[R].order-J[B].order));var D=r.state;return this.Ze(R).forEach((R=>{for(var J in D)J in R||(R[J]=D[J]);r.ir&&r.ir(R.Gr,R)})),R},this.deleteComponent=function(B){var Q=h[B];if(!Q)throw new Error(`Unknown component: ${B}`);Q.flush(),Q.list.forEach((R=>{R&&q(R.Gr||R[0].Gr,B)}));var r=y.indexOf(B),e=N.indexOf(B);return r>-1&&y.splice(r,1),e>-1&&N.splice(e,1),h[B].dispose(),delete h[B],delete J[B],R},this.Yq=function(R,B,Q){var y,N=J[B],r=h[B];if(!r)throw new Error(`Unknown component: ${B}.`);if(r.hash[R]&&!N.multi)throw new Error(`Entity ${R} already has component: ${B}.`);if(N.stateConstructor){if(!(y=new N.stateConstructor).hasOwnProperty("Gr"))throw new Error(`Component ${N.name} stateConstructor type does not have property __id`)}else y=Object.assign({},{Gr:R},N.state,Q);if(y.Gr=R,N.multi){var q=r.hash[R];q||(q=[],r.add(R,q)),q.push(y)}else r.add(R,y);return N.ir&&N.ir(R,y),this},this.Kq=function(R,J){var B=h[J];if(!B)throw new Error(`Unknown component: ${J}.`);return!!B.hash[R]},this.jq=function(J,B){if(!h[B])throw new Error(`Unknown component: ${B}.`);return q(J,B),R},this.getState=function(R,J){var B=h[J];if(!B)throw new Error(`Unknown component: ${J}.`);return B.hash[R]},this.Ze=function(R){var J=h[R];if(!J)throw new Error(`Unknown component: ${R}.`);return l(),J.list},this.uO=function(R){if(!h[R])throw new Error(`Unknown component: ${R}.`);var J=h[R].hash;return R=>J[R]},this.aO=function(R){if(!h[R])throw new Error(`Unknown component: ${R}.`);var J=h[R].hash;return R=>!!J[R]},this.nr=function(B){l();for(var Q=0;Q<y.length;Q++){var N=y[Q],r=J[N],q=h[N];r.system(B,q.list),l()}return R},this.render=function(B){l();for(var Q=0;Q<N.length;Q++){var y=N[Q],r=J[y],q=h[y];r.Lr(B,q.list),l()}return R},this.removeMultiComponent=function(B,Q,y){var N=J[Q],q=h[Q];if(!q)throw new Error(`Unknown component: ${Q}.`);if(!N.multi)throw new Error("removeMultiComponent called on non-multi component");return function(R,J,B,Q){var h=B.hash[R];if(h){var y=h[Q];y&&(h[Q]=null,J.QQ&&J.QQ(R,y),r.multiComps.push({entID:R,data:B}),e())}}(B,N,q,y),R}};var Q=B(13153)},13153:R=>{function J(R,J){var B=R._map[J];if(delete R.hash[J],delete R._map[J],B===R.list.length-1)R.list.pop();else{var Q=R.list.pop();if(R.list[B]=Q,null===Q||null===Q[0]){var h=R.list.length;for(var y in R._map)if(R._map[y]===h)return void(R._map[y]=B)}else{var N=Q.Gr||Q[0].Gr;R._map[N]=B}}}R.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(R,J){if("number"===typeof this._map[R]){var B=this._map[R];this.hash[R]=J,this.list[B]=J}else this._map[R]=this.list.length,this.hash[R]=J,this.list.push(J)}remove(R){var J=this._map[R];this.hash[R]=null,this.list[J]=null,this._pendingRemovals.push(R)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var R=0;R<this._pendingRemovals.length;R++){var B=this._pendingRemovals[R];null===this.hash[B]&&J(this,B)}this._pendingRemovals.length=0}}},13107:R=>{"use strict";var J,B="object"===typeof Reflect?Reflect:null,Q=function(R,J,B){return Function.prototype.apply.call(R,J,B)};J=B&&"function"===typeof B.ownKeys?B.ownKeys:Object.getOwnPropertySymbols?function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:function(R){return Object.getOwnPropertyNames(R)};var h=Number.isNaN||function(R){return R!==R};function y(){y.init.call(this)}R.exports=y,R.exports.once=function(R,J){return new Promise((function(B,Q){function h(B){R.removeListener(J,y),Q(B)}function y(){"function"===typeof R.removeListener&&R.removeListener("error",h),B([].slice.call(arguments))}P(R,J,y,{once:!0}),"error"!==J&&function(R,J,B){"function"===typeof R.on&&P(R,"error",J,B)}(R,h,{once:!0})}))},y.EventEmitter=y,y.prototype._events=void 0,y.prototype._eventsCount=0,y.prototype._maxListeners=void 0;var N=10;function r(R){if("function"!==typeof R)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}function q(R){return void 0===R._maxListeners?y.defaultMaxListeners:R._maxListeners}function e(R,J,B,Q){var h,y,N,e;if(r(B),void 0===(y=R._events)?(y=R._events=Object.create(null),R._eventsCount=0):(void 0!==y.newListener&&(R.emit("newListener",J,B.listener?B.listener:B),y=R._events),N=y[J]),void 0===N)N=y[J]=B,++R._eventsCount;else if("function"===typeof N?N=y[J]=Q?[B,N]:[N,B]:Q?N.unshift(B):N.push(B),(h=q(R))>0&&N.length>h&&!N.warned){N.warned=!0;var D=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(J)+" listeners added. Use emitter.setMaxListeners() to increase limit");D.name="MaxListenersExceededWarning",D.QJ=R,D.type=J,D.count=N.length,e=D,console&&console.warn&&console.warn(e)}return R}function D(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(R,J,B){var Q={fired:!1,wrapFn:void 0,target:R,type:J,listener:B},h=D.bind(Q);return h.listener=B,Q.wrapFn=h,h}function E(R,J,B){var Q=R._events;if(void 0===Q)return[];var h=Q[J];return void 0===h?[]:"function"===typeof h?B?[h.listener||h]:[h]:B?function(R){for(var J=new Array(R.length),B=0;B<J.length;++B)J[B]=R[B].listener||R[B];return J}(h):n(h,h.length)}function O(R){var J=this._events;if(void 0!==J){var B=J[R];if("function"===typeof B)return 1;if(void 0!==B)return B.length}return 0}function n(R,J){for(var B=new Array(J),Q=0;Q<J;++Q)B[Q]=R[Q];return B}function P(R,J,B,Q){if("function"===typeof R.on)Q.once?R.once(J,B):R.on(J,B);else{if("function"!==typeof R.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R);R.addEventListener(J,(function h(y){Q.once&&R.removeEventListener(J,h),B(y)}))}}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return N},set:function(R){if("number"!==typeof R||R<0||h(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");N=R}}),y.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},y.prototype.setMaxListeners=function(R){if("number"!==typeof R||R<0||h(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this},y.prototype.getMaxListeners=function(){return q(this)},y.prototype.emit=function(R){for(var J=[],B=1;B<arguments.length;B++)J.push(arguments[B]);var h="error"===R,y=this._events;if(void 0!==y)h=h&&void 0===y.error;else if(!h)return!1;if(h){var N;if(J.length>0&&(N=J[0]),N instanceof Error)throw N;var r=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw r.context=N,r}var q=y[R];if(void 0===q)return!1;if("function"===typeof q)Q(q,this,J);else{var e=q.length,D=n(q,e);for(B=0;B<e;++B)Q(D[B],this,J)}return!0},y.prototype.addListener=function(R,J){return e(this,R,J,!1)},y.prototype.on=y.prototype.addListener,y.prototype.prependListener=function(R,J){return e(this,R,J,!0)},y.prototype.once=function(R,J){return r(J),this.on(R,l(this,R,J)),this},y.prototype.prependOnceListener=function(R,J){return r(J),this.prependListener(R,l(this,R,J)),this},y.prototype.removeListener=function(R,J){var B,Q,h,y,N;if(r(J),void 0===(Q=this._events))return this;if(void 0===(B=Q[R]))return this;if(B===J||B.listener===J)0===--this._eventsCount?this._events=Object.create(null):(delete Q[R],Q.removeListener&&this.emit("removeListener",R,B.listener||J));else if("function"!==typeof B){for(h=-1,y=B.length-1;y>=0;y--)if(B[y]===J||B[y].listener===J){N=B[y].listener,h=y;break}if(h<0)return this;0===h?B.shift():function(R,J){for(;J+1<R.length;J++)R[J]=R[J+1];R.pop()}(B,h),1===B.length&&(Q[R]=B[0]),void 0!==Q.removeListener&&this.emit("removeListener",R,N||J)}return this},y.prototype.off=y.prototype.removeListener,y.prototype.hJ=function(R){var J,B,Q;if(void 0===(B=this._events))return this;if(void 0===B.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==B[R]&&(0===--this._eventsCount?this._events=Object.create(null):delete B[R]),this;if(0===arguments.length){var h,y=Object.keys(B);for(Q=0;Q<y.length;++Q)"removeListener"!==(h=y[Q])&&this.hJ(h);return this.hJ("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(J=B[R]))this.removeListener(R,J);else if(void 0!==J)for(Q=J.length-1;Q>=0;Q--)this.removeListener(R,J[Q]);return this},y.prototype.listeners=function(R){return E(this,R,!0)},y.prototype.rawListeners=function(R){return E(this,R,!1)},y.listenerCount=function(R,J){return"function"===typeof R.listenerCount?R.listenerCount(J):O.call(R,J)},y.prototype.listenerCount=O,y.prototype.eventNames=function(){return this._eventsCount>0?J(this._events):[]}},13410:R=>{"use strict";R.exports=function(R,J,B,Q,h,y){var N=+J[0],r=+J[1],q=+J[2],e=+B[0],D=+B[1],l=+B[2],E=Math.sqrt(e*e+D*D+l*l);if(0===E)throw new Error("Can't raycast along a zero vector");return function(R,J,B,Q,h,y,N,r,q,e){for(var D=0,l=Math.floor,E=0|l(J),O=0|l(B),n=0|l(Q),P=h>0?1:-1,A=y>0?1:-1,u=N>0?1:-1,S=Math.abs(1/h),f=Math.abs(1/y),a=Math.abs(1/N),s=S<1/0?S*(P>0?E+1-J:J-E):1/0,x=f<1/0?f*(A>0?O+1-B:B-O):1/0,I=a<1/0?a*(u>0?n+1-Q:Q-n):1/0,V=-1;D<=r;){var M=R(E,O,n);if(M)return q&&(q[0]=J+D*h,q[1]=B+D*y,q[2]=Q+D*N),e&&(e[0]=e[1]=e[2]=0,0===V&&(e[0]=-P),1===V&&(e[1]=-A),2===V&&(e[2]=-u)),M;s<x?s<I?(E+=P,D=s,s+=S,V=0):(n+=u,D=I,I+=a,V=2):x<I?(O+=A,D=x,x+=f,V=1):(n+=u,D=I,I+=a,V=2)}return q&&(q[0]=J+D*h,q[1]=B+D*y,q[2]=Q+D*N),e&&(e[0]=e[1]=e[2]=0),0}(R,N,r,q,e/=E,D/=E,l/=E,Q="undefined"===typeof Q?64:+Q,h,y)}},13448:(R,J,B)=>{"use strict";B.d(J,{e:()=>y});var Q=B(13107);function h(){this.SE=!1,this.stopPropagation=!1,this.fE=!1,this.disabled=!1}class y{constructor(R,J){this.version="0.7.0";var B=Object.assign({},new h,J||{});this.element=R||document,this.SE=!!B.SE,this.stopPropagation=!!B.stopPropagation,this.fE=!!B.fE,this.disabled=!!B.disabled,this.filterEvents=(R,J)=>!0,this.down=new Q.EventEmitter,this.up=new Q.EventEmitter,this.state={},this.Fe={dx:0,dy:0,qO:0,Te:0,eO:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?r(this):document.addEventListener("DOMContentLoaded",(R=>{r(this)}),{once:!0})}bind(R){for(var J=arguments.length,B=new Array(J>1?J-1:0),Q=1;Q<J;Q++)B[Q-1]=arguments[Q];B.forEach((J=>{var B=this._keyBindmap[J]||[];B.includes(R)||(B.push(R),this._keyBindmap[J]=B)})),this.state[R]=!!this.state[R],this.pressCount[R]=this.pressCount[R]||0,this.releaseCount[R]=this.releaseCount[R]||0}unbind(R){for(var J in this._keyBindmap){var B=this._keyBindmap[J],Q=B.indexOf(R);Q>-1&&B.splice(Q,1)}}getBindings(){var R={};for(var J in this._keyBindmap){this._keyBindmap[J].forEach((B=>{R[B]=R[B]||[],R[B].push(J)}))}return R}nr(){N(this.Fe),N(this.pressCount),N(this.releaseCount)}}function N(R){for(var J in R)R[J]=0}function r(R){window.addEventListener("keydown",n.bind(null,R,!0),!1),window.addEventListener("keyup",n.bind(null,R,!1),!1);var J={passive:!0};R.element.addEventListener("touchstart",l.bind(void 0,R),{passive:!1}),R.element.addEventListener("touchend",O.bind(void 0,R),J),R.element.addEventListener("mousedown",P.bind(null,R,!0),J),window.document.addEventListener("mouseup",P.bind(null,R,!1),J),R.element.addEventListener("touchmove",A.bind(null,R),J),R.element.addEventListener("mousemove",A.bind(null,R),J),window.PointerEvent,R.element.addEventListener("wheel",u.bind(null,R),J),R.element.addEventListener("contextmenu",S.bind(null,R),!1),window.addEventListener("blur",f.bind(null,R),!1)}var q=0,e=0,D=null;function l(R,J){J.preventDefault(),E(J)}function E(R){let J=!1;for(let B=0;B<R.touches.length;++B)if(R.touches[B].identifier===D){J=!0;break}if(!J){const J=R.changedTouches[0];q=J.clientX,e=J.clientY,D=J.identifier}}function O(R,J){for(var B=J.changedTouches,Q=0;Q<B.length;++Q)B[Q].identifier===D&&(D=null)}function n(R,J,B){a(B.code,J,R,B)}function P(R,J,B){if("pointerId"in B)if(J){if(null!==R._touches.currID)return;R._touches.currID=B.pointerId}else{if(R._touches.currID!==B.pointerId)return;R._touches.currID=null}return a("Mouse"+("button"in B?B.button+1:1),J,R,B),!1}function A(R,J){var B=J.movementX||J.mozMovementX||0,Q=J.movementY||J.mozMovementY||0;if(J.touches&&0===(B|Q)){var h=function(R){E(R);for(let J=0;J<R.changedTouches.length;++J)if(R.changedTouches[J].identifier==D){const B=R.changedTouches[J],Q=[B.clientX-q,B.clientY-e];return q=B.clientX,e=B.clientY,Q}return console.error(`Did not find touch id ${D}`),[0,0]}(J);B=h[0],Q=h[1]}R.Fe.dx+=B,R.Fe.dy+=Q}function u(R,J){var B=1;switch(J.deltaMode){case 0:B=1;break;case 1:B=12;break;case 2:B=R.element.clientHeight||window.innerHeight}R.Fe.qO+=(J.deltaX||0)*B,R.Fe.Te+=(J.deltaY||0)*B,R.Fe.eO+=(J.deltaZ||0)*B}function S(R,J){if(!R.fE)return J.preventDefault(),!1}function f(R){for(var J in R._keyStates)R._keyStates[J]&&(/^Mouse\d/.test(J)||a(J,!1,R,{code:J,note:"latdpkv05i",preventDefault:()=>{},stopPropagation:()=>{}}))}function a(R,J,B,Q){var h=B._keyBindmap[R];h&&(s(B._keyStates[R],J)&&(B._keyStates[R]=J,h.forEach((R=>{(!B.filterEvents||B.filterEvents(Q,R))&&function(R,J,B,Q){var h=J?B.pressCount:B.releaseCount;h[R]=(h[R]||0)+1;var y=B._bindPressCount[R]||0;(y+=J?1:-1)<0&&(y=0);B._bindPressCount[R]=y;var N=B.state[R];if(s(N,y)){B.state[R]=y>0;var r=J?B.down:B.up;B.disabled||r.emit(R,Q)}}(R,J,B,Q)}))),"button"in Q||(B.SE&&!Q.defaultPrevented&&Q.preventDefault(),B.stopPropagation&&Q.stopPropagation()))}function s(R,J){return R?!J:J}},12083:R=>{R.exports=function(R,J,B){return R[0]=J[0]+B[0],R[1]=J[1]+B[1],R[2]=J[2]+B[2],R}},12031:(R,J,B)=>{R.exports=function(R,J){var B=Q(R[0],R[1],R[2]),N=Q(J[0],J[1],J[2]);h(B,B),h(N,N);var r=y(B,N);return r>1?0:Math.acos(r)};var Q=B(12039),h=B(12047),y=B(12056)},12127:R=>{R.exports=function(R,J){return R[0]=Math.ceil(J[0]),R[1]=Math.ceil(J[1]),R[2]=Math.ceil(J[2]),R}},12022:R=>{R.exports=function(R){var J=new Float32Array(3);return J[0]=R[0],J[1]=R[1],J[2]=R[2],J}},12063:R=>{R.exports=function(R,J){return R[0]=J[0],R[1]=J[1],R[2]=J[2],R}},12020:R=>{R.exports=function(){var R=new Float32Array(3);return R[0]=0,R[1]=0,R[2]=0,R}},12210:R=>{R.exports=function(R,J,B){var Q=J[0],h=J[1],y=J[2],N=B[0],r=B[1],q=B[2];return R[0]=h*q-y*r,R[1]=y*N-Q*q,R[2]=Q*r-h*N,R}},12154:(R,J,B)=>{R.exports=B(12151)},12151:R=>{R.exports=function(R,J){var B=J[0]-R[0],Q=J[1]-R[1],h=J[2]-R[2];return Math.sqrt(B*B+Q*Q+h*h)}},12111:(R,J,B)=>{R.exports=B(12106)},12106:R=>{R.exports=function(R,J,B){return R[0]=J[0]/B[0],R[1]=J[1]/B[1],R[2]=J[2]/B[2],R}},12056:R=>{R.exports=function(R,J){return R[0]*J[0]+R[1]*J[1]+R[2]*J[2]}},12013:R=>{R.exports=1e-6},12077:(R,J,B)=>{R.exports=function(R,J){var B=R[0],h=R[1],y=R[2],N=J[0],r=J[1],q=J[2];return Math.abs(B-N)<=Q*Math.max(1,Math.abs(B),Math.abs(N))&&Math.abs(h-r)<=Q*Math.max(1,Math.abs(h),Math.abs(r))&&Math.abs(y-q)<=Q*Math.max(1,Math.abs(y),Math.abs(q))};var Q=B(12013)},12081:R=>{R.exports=function(R,J){return R[0]===J[0]&&R[1]===J[1]&&R[2]===J[2]}},12124:R=>{R.exports=function(R,J){return R[0]=Math.floor(J[0]),R[1]=Math.floor(J[1]),R[2]=Math.floor(J[2]),R}},12252:(R,J,B)=>{R.exports=function(R,J,B,h,y,N){var r,q;J||(J=3);B||(B=0);q=h?Math.min(h*J+B,R.length):R.length;for(r=B;r<q;r+=J)Q[0]=R[r],Q[1]=R[r+1],Q[2]=R[r+2],y(Q,Q,N),R[r]=Q[0],R[r+1]=Q[1],R[r+2]=Q[2];return R};var Q=B(12020)()},12039:R=>{R.exports=function(R,J,B){var Q=new Float32Array(3);return Q[0]=R,Q[1]=J,Q[2]=B,Q}},12005:(R,J,B)=>{R.exports={EPSILON:B(12013),create:B(12020),clone:B(12022),angle:B(12031),yr:B(12039),j:B(12063),set:B(12068),equals:B(12077),exactEquals:B(12081),add:B(12083),PJ:B(12090),sub:B(12092),multiply:B(12097),mul:B(12104),divide:B(12106),div:B(12111),min:B(12113),max:B(12117),floor:B(12124),ceil:B(12127),round:B(12133),scale:B(12139),Nr:B(12146),distance:B(12151),i:B(12154),squaredDistance:B(12162),sqrDist:B(12169),length:B(12172),len:B(12175),squaredLength:B(12179),rr:B(12187),negate:B(12196),inverse:B(12204),normalize:B(12047),dot:B(12056),cross:B(12210),Jr:B(12219),random:B(12222),transformMat4:B(12226),transformMat3:B(12230),transformQuat:B(12232),qr:B(12234),er:B(12238),Dr:B(12247),forEach:B(12252)}},12204:R=>{R.exports=function(R,J){return R[0]=1/J[0],R[1]=1/J[1],R[2]=1/J[2],R}},12175:(R,J,B)=>{R.exports=B(12172)},12172:R=>{R.exports=function(R){var J=R[0],B=R[1],Q=R[2];return Math.sqrt(J*J+B*B+Q*Q)}},12219:R=>{R.exports=function(R,J,B,Q){var h=J[0],y=J[1],N=J[2];return R[0]=h+Q*(B[0]-h),R[1]=y+Q*(B[1]-y),R[2]=N+Q*(B[2]-N),R}},12117:R=>{R.exports=function(R,J,B){return R[0]=Math.max(J[0],B[0]),R[1]=Math.max(J[1],B[1]),R[2]=Math.max(J[2],B[2]),R}},12113:R=>{R.exports=function(R,J,B){return R[0]=Math.min(J[0],B[0]),R[1]=Math.min(J[1],B[1]),R[2]=Math.min(J[2],B[2]),R}},12104:(R,J,B)=>{R.exports=B(12097)},12097:R=>{R.exports=function(R,J,B){return R[0]=J[0]*B[0],R[1]=J[1]*B[1],R[2]=J[2]*B[2],R}},12196:R=>{R.exports=function(R,J){return R[0]=-J[0],R[1]=-J[1],R[2]=-J[2],R}},12047:R=>{R.exports=function(R,J){var B=J[0],Q=J[1],h=J[2],y=B*B+Q*Q+h*h;y>0&&(y=1/Math.sqrt(y),R[0]=J[0]*y,R[1]=J[1]*y,R[2]=J[2]*y);return R}},12222:R=>{R.exports=function(R,J){J=J||1;var B=2*Math.random()*Math.PI,Q=2*Math.random()-1,h=Math.sqrt(1-Q*Q)*J;return R[0]=Math.cos(B)*h,R[1]=Math.sin(B)*h,R[2]=Q*J,R}},12234:R=>{R.exports=function(R,J,B,Q){var h=B[1],y=B[2],N=J[1]-h,r=J[2]-y,q=Math.sin(Q),e=Math.cos(Q);return R[0]=J[0],R[1]=h+N*e-r*q,R[2]=y+N*q+r*e,R}},12238:R=>{R.exports=function(R,J,B,Q){var h=B[0],y=B[2],N=J[0]-h,r=J[2]-y,q=Math.sin(Q),e=Math.cos(Q);return R[0]=h+r*q+N*e,R[1]=J[1],R[2]=y+r*e-N*q,R}},12247:R=>{R.exports=function(R,J,B,Q){var h=B[0],y=B[1],N=J[0]-h,r=J[1]-y,q=Math.sin(Q),e=Math.cos(Q);return R[0]=h+N*e-r*q,R[1]=y+N*q+r*e,R[2]=J[2],R}},12133:R=>{R.exports=function(R,J){return R[0]=Math.round(J[0]),R[1]=Math.round(J[1]),R[2]=Math.round(J[2]),R}},12139:R=>{R.exports=function(R,J,B){return R[0]=J[0]*B,R[1]=J[1]*B,R[2]=J[2]*B,R}},12146:R=>{R.exports=function(R,J,B,Q){return R[0]=J[0]+B[0]*Q,R[1]=J[1]+B[1]*Q,R[2]=J[2]+B[2]*Q,R}},12068:R=>{R.exports=function(R,J,B,Q){return R[0]=J,R[1]=B,R[2]=Q,R}},12169:(R,J,B)=>{R.exports=B(12162)},12187:(R,J,B)=>{R.exports=B(12179)},12162:R=>{R.exports=function(R,J){var B=J[0]-R[0],Q=J[1]-R[1],h=J[2]-R[2];return B*B+Q*Q+h*h}},12179:R=>{R.exports=function(R){var J=R[0],B=R[1],Q=R[2];return J*J+B*B+Q*Q}},12092:(R,J,B)=>{R.exports=B(12090)},12090:R=>{R.exports=function(R,J,B){return R[0]=J[0]-B[0],R[1]=J[1]-B[1],R[2]=J[2]-B[2],R}},12230:R=>{R.exports=function(R,J,B){var Q=J[0],h=J[1],y=J[2];return R[0]=Q*B[0]+h*B[3]+y*B[6],R[1]=Q*B[1]+h*B[4]+y*B[7],R[2]=Q*B[2]+h*B[5]+y*B[8],R}},12226:R=>{R.exports=function(R,J,B){var Q=J[0],h=J[1],y=J[2],N=B[3]*Q+B[7]*h+B[11]*y+B[15];return N=N||1,R[0]=(B[0]*Q+B[4]*h+B[8]*y+B[12])/N,R[1]=(B[1]*Q+B[5]*h+B[9]*y+B[13])/N,R[2]=(B[2]*Q+B[6]*h+B[10]*y+B[14])/N,R}},12232:R=>{R.exports=function(R,J,B){var Q=J[0],h=J[1],y=J[2],N=B[0],r=B[1],q=B[2],e=B[3],D=e*Q+r*y-q*h,l=e*h+q*Q-N*y,E=e*y+N*h-r*Q,O=-N*Q-r*h-q*y;return R[0]=D*e+O*-N+l*-q-E*-r,R[1]=l*e+O*-r+E*-N-D*-q,R[2]=E*e+O*-q+D*-r-l*-N,R}},13125:R=>{"use strict";R.exports=function(R){for(var J=new Array(R),B=0;B<R;++B)J[B]=B;return J}},13199:R=>{R.exports=function(R){return null!=R&&null!=R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}},13417:(R,J,B)=>{"use strict";B.d(J,{c:()=>Q});class Q{constructor(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Rl=!1,this.Jl=!1,this.ZD=30,this.UD=0,this.Dl=!1,this.fullscreen=!1,this.Ql=function(R){},this.hl=function(){},this.ql=function(){},this.Jh=function(){},this.yl=function(R){},this.onFullscreenChanged=function(R){},e((()=>{!function(R,J){R._nowObject=performance||Date,R._lastTick=0,R._renderAccum=0,R._rt=0,R._frameCB=r.bind(null,R),requestAnimationFrame(R._frameCB),J>0&&(R._intervalCB=N.bind(null,R),R._interval=setInterval(R._intervalCB,Math.max(J,1e3/R.ZD/2)))}(this,J),function(R,J){if(!J)return;var B=!1,Q=!1;document.addEventListener("pointerlockchange",(Q=>{B=document.pointerLockElement===J,R.yl(B)})),document.addEventListener("fullscreenchange",(B=>{Q=document.fullscreenElement===J,R.onFullscreenChanged(Q)})),Object.defineProperty(R,"Dl",{get:()=>B,set:R=>{R&&!B?q(J):B&&!R&&function(R){R.exitPointerLock&&R.exitPointerLock()}(document)}}),Object.defineProperty(R,"fullscreen",{get:()=>Q,set:R=>{R&&!Q?J.requestFullscreen():Q&&!R&&document.exitFullscreen()}}),J.addEventListener("click",(h=>{R.Rl&&!B&&q(J),R.Jl&&!Q&&J.requestFullscreen()}));var h=()=>R.Jh();if(window.ResizeObserver){new ResizeObserver(h).observe(J)}else window.addEventListener("resize",h)}(this,R),this.ql()}))}}var h=3,y=20;function N(R){for(var J=1e3/R.ZD,B=R._nowObject.now()+y,Q=0;R._nowObject.now()>=R._lastTick+J&&R._nowObject.now()<B&&++Q<=h;)R.Ql(J),R._lastTick+=J;var N=5*(J+5),r=R._nowObject.now();if(r-R._lastTick>N)for(;r>=R._lastTick+J;)R._lastTick+=J}function r(R){requestAnimationFrame(R._frameCB),N(R);var J=R._nowObject.now(),B=J-R._rt;if(R._rt=J,R.UD>0){R._renderAccum+=B;var Q=1e3/R.UD;if(R._renderAccum<Q)return;R._renderAccum=Math.min(R._renderAccum-Q,Q)}var h=1e3/R.ZD,y=(J-R._lastTick)/h;R.hl(B,y,h)}function q(R){R.requestPointerLock&&R.requestPointerLock()}var e=R=>{if("loading"===document.readyState){var J=()=>{document.removeEventListener("readystatechange",J),R()};document.addEventListener("readystatechange",J)}else setTimeout(R,1)}},13120:(R,J,B)=>{var Q=B(13125),h=B(13132),y="undefined"!==typeof Float64Array;function N(R,J){return R[0]-J[0]}function r(){var R,J=this.stride,B=new Array(J.length);for(R=0;R<B.length;++R)B[R]=[Math.abs(J[R]),R];B.sort(N);var Q=new Array(B.length);for(R=0;R<Q.length;++R)Q[R]=B[R][1];return Q}function q(R,J){var B=["View",J,"d",R].join("");J<0&&(B="View_Nil"+R);var h="generic"===R;if(-1===J){var y="function "+B+"(a){this.data=a;};var proto="+B+".prototype;proto.dtype='"+R+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+B+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+B+"(a){return new "+B+"(a);}";return new Function(y)()}if(0===J){y="function "+B+"(a,d) {this.data = a;this.offset = d};var proto="+B+".prototype;proto.dtype='"+R+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+B+"_copy() {return new "+B+"(this.data,this.offset)};proto.pick=function "+B+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+B+"_get(){return "+(h?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+B+"_set(v){return "+(h?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+B+"(a,b,c,d){return new "+B+"(a,d)}";return new Function("TrivialArray",y)(e[R][0])}y=["'use strict'"];var N=Q(J),q=N.map((function(R){return"i"+R})),D="this.offset+"+N.map((function(R){return"this.stride["+R+"]*i"+R})).join("+"),l=N.map((function(R){return"b"+R})).join(","),E=N.map((function(R){return"c"+R})).join(",");y.push("function "+B+"(a,"+l+","+E+",d){this.data=a","this.shape=["+l+"]","this.stride=["+E+"]","this.offset=d|0}","var proto="+B+".prototype","proto.dtype='"+R+"'","proto.dimension="+J),y.push("Object.defineProperty(proto,'size',{get:function "+B+"_size(){return "+N.map((function(R){return"this.shape["+R+"]"})).join("*"),"}})"),1===J?y.push("proto.order=[0]"):(y.push("Object.defineProperty(proto,'order',{get:"),J<4?(y.push("function "+B+"_order(){"),2===J?y.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===J&&y.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):y.push("ORDER})")),y.push("proto.set=function "+B+"_set("+q.join(",")+",v){"),h?y.push("return this.data.set("+D+",v)}"):y.push("return this.data["+D+"]=v}"),y.push("proto.get=function "+B+"_get("+q.join(",")+"){"),h?y.push("return this.data.get("+D+")}"):y.push("return this.data["+D+"]}"),y.push("proto.index=function "+B+"_index(",q.join(),"){return "+D+"}"),y.push("proto.hi=function "+B+"_hi("+q.join(",")+"){return new "+B+"(this.data,"+N.map((function(R){return["(typeof i",R,"!=='number'||i",R,"<0)?this.shape[",R,"]:i",R,"|0"].join("")})).join(",")+","+N.map((function(R){return"this.stride["+R+"]"})).join(",")+",this.offset)}");var O=N.map((function(R){return"a"+R+"=this.shape["+R+"]"})),n=N.map((function(R){return"c"+R+"=this.stride["+R+"]"}));y.push("proto.lo=function "+B+"_lo("+q.join(",")+"){var b=this.offset,d=0,"+O.join(",")+","+n.join(","));for(var P=0;P<J;++P)y.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");y.push("return new "+B+"(this.data,"+N.map((function(R){return"a"+R})).join(",")+","+N.map((function(R){return"c"+R})).join(",")+",b)}"),y.push("proto.step=function "+B+"_step("+q.join(",")+"){var "+N.map((function(R){return"a"+R+"=this.shape["+R+"]"})).join(",")+","+N.map((function(R){return"b"+R+"=this.stride["+R+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<J;++P)y.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");y.push("return new "+B+"(this.data,"+N.map((function(R){return"a"+R})).join(",")+","+N.map((function(R){return"b"+R})).join(",")+",c)}");var A=new Array(J),u=new Array(J);for(P=0;P<J;++P)A[P]="a[i"+P+"]",u[P]="b[i"+P+"]";y.push("proto.transpose=function "+B+"_transpose("+q+"){"+q.map((function(R,J){return R+"=("+R+"===undefined?"+J+":"+R+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+B+"(this.data,"+A.join(",")+","+u.join(",")+",this.offset)}"),y.push("proto.pick=function "+B+"_pick("+q+"){var a=[],b=[],c=this.offset");for(P=0;P<J;++P)y.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return y.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),y.push("return function construct_"+B+"(data,shape,stride,offset){return new "+B+"(data,"+N.map((function(R){return"shape["+R+"]"})).join(",")+","+N.map((function(R){return"stride["+R+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",y.join("\n"))(e[R],r)}var e={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};R.exports=function(R,J,B,Q){if(void 0===R)return(0,e.array[0])([]);"number"===typeof R&&(R=[R]),void 0===J&&(J=[R.length]);var N=J.length;if(void 0===B){B=new Array(N);for(var r=N-1,D=1;r>=0;--r)B[r]=D,D*=J[r]}if(void 0===Q){Q=0;for(r=0;r<N;++r)B[r]<0&&(Q-=(J[r]-1)*B[r])}for(var l=function(R){if(h(R))return"buffer";if(y)switch(Object.prototype.toString.call(R)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(R)?"array":"generic"}(R),E=e[l];E.length<=N+1;)E.push(q(l,E.length-1));return(0,E[N+1])(R,J,B,Q)}},13132:R=>{function J(R){return!!R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}R.exports=function(R){return null!=R&&(J(R)||function(R){return"function"===typeof R.readFloatLE&&"function"===typeof R.slice&&J(R.slice(0,0))}(R)||!!R._isBuffer)}},13279:R=>{"use strict";var J=[],B=[],Q=[],h=[],y=[],N=[],r=[],q=[],e=[],D=[],l=[],E=[];R.exports=function(R,O,n,P,A,u){for(var S=r,f=e,a=D,s=E,x=0;x<3;x++)S[x]=+n[x],a[x]=+O.max[x],f[x]=+O.base[x];u||(u=1e-10);var I=function(R,r,e,D,E,O){var n=J,P=B,A=Q,u=h,S=y,f=N,a=q,s=Math.floor,x=0,I=0,V=0,M=0,H=0;if(d(),0===V)return 0;for(M=z();I<=V;){if(X(M)&&c())return x;M=z()}for(x+=V,H=0;H<3;H++)D[H]+=e[H],E[H]+=e[H];return x;function d(){if(I=0,0!==(V=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])))for(var R=0;R<3;R++){var J=e[R]>=0;u[R]=J?1:-1;var B=J?E[R]:D[R];n[R]=J?D[R]:E[R],P[R]=p(B,u[R]),A[R]=i(n[R],u[R]),a[R]=e[R]/V,S[R]=Math.abs(1/a[R]);var Q=J?P[R]+1-B:B-P[R];f[R]=S[R]<1/0?S[R]*Q:1/0}}function X(J){for(var B=u[0],Q=0===J?P[0]:A[0],h=P[0]+B,y=u[1],N=1===J?P[1]:A[1],r=P[1]+y,q=u[2],e=2===J?P[2]:A[2],D=P[2]+q,l=Q;l!=h;l+=B)for(var E=N;E!=r;E+=y)for(var O=e;O!=D;O+=q)if(R(l,E,O))return!0;return!1}function c(){x+=I;var R=u[M],J=I/V,B=l;for(H=0;H<3;H++){var Q=e[H]*J;D[H]+=Q,E[H]+=Q,B[H]=e[H]-Q}if(R>0?E[M]=Math.round(E[M]):D[M]=Math.round(D[M]),r(x,M,R,B))return!0;for(H=0;H<3;H++)e[H]=B[H];return d(),0===V}function z(){var R=f[0]<f[1]?f[0]<f[2]?0:2:f[1]<f[2]?1:2,J=f[R]-I;for(I=f[R],P[R]+=u[R],f[R]+=S[R],H=0;H<3;H++)n[H]+=J*a[H],A[H]=i(n[H],u[H]);return R}function p(R,J){return s(R-J*O)}function i(R,J){return s(R+J*O)}}(R,P,S,f,a,u);if(!A){for(x=0;x<3;x++)s[x]=n[x]>0?a[x]-O.max[x]:f[x]-O.base[x];O.translate(s)}return I}},13453:(R,J,B)=>{"use strict";B.d(J,{c:()=>l});var Q=B(13273),h=B(12005);class y{constructor(R,J,B,y,N,r,q){this.oe=new Q(R.base,R.nD),this.BQ=J,this.friction=B,this.restitution=y,this.vN=N,this.XO=r,this.mN=!!q,this.OD=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Pn=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Ee=h.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=h.create(),this._impulses=h.create(),this._sleepFrameCount=10}loadFromCopy(R){h.j(this.oe.base,R.oe.base),h.j(this.oe.nD,R.oe.nD),h.j(this.oe.max,R.oe.max),this.oe.mag=R.oe.mag,this.BQ=R.BQ,this.friction=R.friction,this.restitution=R.restitution,this.vN=R.vN,this.XO=R.XO,this.mN=R.mN,this.OD=R.OD,this.fluidDrag=R.fluidDrag,this.Pn=R.Pn,this.preventFallOffEdge=R.preventFallOffEdge,this.rolledBackLastTick=R.rolledBackLastTick,h.j(this.Ee,R.Ee),h.j(this.resting,R.resting),this.inFluid=R.inFluid,this._ratioInFluid=R._ratioInFluid,h.j(this._forces,R._forces),h.j(this._impulses,R._impulses),this._sleepFrameCount=R._sleepFrameCount}setPosition(R){N(R),h.PJ(R,R,this.oe.base),this.oe.translate(R),this.ue()}Bh(){return h.clone(this.oe.base)}applyForce(R){N(R),h.add(this._forces,this._forces,R),this.ue()}applyImpulse(R){N(R),h.add(this._impulses,this._impulses,R),this.ue()}ue(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var N=R=>{};var r=B(13273),q=B(12005),e=B(13279);function D(){this.OD=.1,this.fluidDrag=.4,this.Rr=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function l(R,J,B){R=Object.assign(new D,R),this.gravity=R.gravity||[0,-10,0],this.OD=R.OD||.1,this.Rr=R.Rr||2,this.fluidDrag=R.fluidDrag||.4,this.minBounceImpulse=R.minBounceImpulse,this.bodies=[],this.ZE=R.ZE,this.testSolid=J,this.testFluid=B}l.prototype.YO=function(R,J,B,Q,h,N){R=R||new r([0,0,0],[1,1,1]),"undefined"==typeof J&&(J=1),"undefined"==typeof B&&(B=1),"undefined"==typeof Q&&(Q=0),"undefined"==typeof h&&(h=1);var q=new y(R,J,B,Q,h,N);return this.bodies.push(q),q},l.prototype.GO=function(R){var J=this.bodies.indexOf(R);J<0||(this.bodies.splice(J,1),R.oe=R.XO=null)};var E=q.create(),O=q.create(),n=q.create(),P=q.create(),A=q.create(),u=q.create(),S=q.create(),f=new r([0,0,0],[1,1,1]),a=new y(f,1,1,0,1,(()=>{}),!1);function s(R,J,B){return J=B,J*=1-(1-R.ratioInFluid)**2}l.prototype.nr=function(R){R/=1e3;var J=g(0,q.squaredLength(this.gravity));this.bodies.forEach((B=>function(R,J,B,Q){q.j(A,J.resting),R.ZE&&a.loadFromCopy(J);if(J.BQ<=0)return q.set(J.Ee,0,0,0),q.set(J._forces,0,0,0),void q.set(J._impulses,0,0,0);var h=Q||0===J.vN;if(function(R,J,B,Q){if(J._sleepFrameCount>0)return!1;if(Q)return!0;var h=!1,y=.5*B*B*J.vN;return q.scale(G,R.gravity,y),e(R.testSolid,J.oe,G,(function(){return h=!0,!0}),!0),h}(R,J,B,h))return;J._sleepFrameCount--,function(R,J){var B=J.oe,Q=Math.floor(B.base[0]),h=Math.floor(B.base[2]),y=Math.floor(B.base[1]),N=Math.floor(B.max[1]);if(!R.testFluid(Q,y,h))return J.inFluid=!1,void(J.ratioInFluid=0);var r=1,e=y+1;for(;e<=N&&R.testFluid(Q,e,h);)r++,e++;var D=(y+r-B.base[1])/B.nD[1];D>1&&(D=1);var l=B.nD[0]*B.nD[1]*B.nD[2]*D,E=I;q.scale(E,R.gravity,-R.Rr*l*J.vN),J.applyForce(E),J.inFluid=!0,J.ratioInFluid=D}(R,J),j(J._forces),j(J._impulses),j(J.Ee),j(J.resting),q.scale(E,J._forces,1/J.BQ),q.Nr(E,E,R.gravity,J.vN),q.scale(O,J._impulses,1/J.BQ),q.Nr(O,O,E,B),q.add(J.Ee,J.Ee,O),J.friction&&(V(R,0,J,O,B),V(R,1,J,O,B),V(R,2,J,O,B));var y=J.fluidDrag>=0?J.fluidDrag:R.fluidDrag,N=J.OD>=0?J.OD:R.OD,r=N,D=N;J.inFluid&&(r=s(J,r,J.fluidDragHoriz>=0?J.fluidDragHoriz:y),D=s(J,D,J.fluidDragVert>=0?J.fluidDragVert:y));r=Math.max(1-r*B/J.BQ,0),D=Math.max(1-D*B/J.BQ,0),q.set(x,r,D,r),q.multiply(J.Ee,J.Ee,x),q.scale(n,J.Ee,B),q.set(J._forces,0,0,0),q.set(J._impulses,0,0,0),J.mN&&L(d,J.oe);q.j(u,n),q.set(S,0,0,0),J.preventFallOffEdge&&function(R,J,B,Q){if(!J.resting[1]||B[1]>0)return;var h=W;L(h,J.oe);for(var y=0;y<3;y+=2){q.set(i,0,0,0),i[y]=B[y];var N=!0;(N=(N=(N=(N=N&&!Y(R,h.base[0]+i[0]+1e-5,h.base[1],h.base[2]+i[2]+1e-5))&&!Y(R,h.max[0]+i[0]-1e-5,h.base[1],h.base[2]+i[2]+1e-5))&&!Y(R,h.base[0]+i[0]+1e-5,h.base[1],h.max[2]+i[2]-1e-5))&&!Y(R,h.max[0]+i[0]-1e-5,h.base[1],h.max[2]+i[2]-1e-5))?(Q[y]=B[y]>0?1:-1,B[y]=0):0===y&&(q.set(k,B[0],0,0),H(R,h,k,Q,J.slideOnCollision))}}(R,J,n,S);H(R,J.oe,n,J.resting,J.slideOnCollision),J.mN&&function(R,J,B,Q){if(J.resting[1]>=0&&!J.inFluid)return;var h=0!==J.resting[0],y=0!==J.resting[2];if(!h&&!y)return;var N=Math.abs(Q[0]/Q[2]),r=4;if(!h&&N>r)return;if(!y&&N<1/r)return;q.add(c,B.base,Q);var D=R.testSolid;e(D,B,Q,(function(R,J,B,Q){if(1!==J)return!0;Q[J]=0}));var l=B.base[1],E=J.inFluid?1.951:1.001,O=Math.floor(l+E)-l;q.set(z,0,O,0);var n=!1;if(e(D,B,z,(function(R,J,B,Q){return n=!0,!0})),n)return;q.PJ(p,c,B.base),p[1]=0,H(R,B,p,X,!0);var P=g(B.base[0],c[0]),A=g(B.base[2],c[2]);if(h&&!P&&(!A||!y))return;if(y&&(!P||!h)&&!A)return;var u=!0;if(u=u&&!Y(R,B.base[0]+1e-5,B.base[1],B.base[2]+1e-5),u=u&&!Y(R,B.max[0]-1e-5,B.base[1],B.base[2]+1e-5),u=u&&!Y(R,B.base[0]+1e-5,B.base[1],B.max[2]-1e-5),u=u&&!Y(R,B.max[0]-1e-5,B.base[1],B.max[2]-1e-5),u)return;L(J.oe,B),J.resting[0]=X[0],J.resting[2]=X[2],J.Pn&&J.Pn()}(R,J,d,u);for(var l=0;l<3;++l)J.resting[l]=J.resting[l]||S[l],P[l]=0,J.resting[l]&&(A[l]||(P[l]=-J.Ee[l]),J.Ee[l]=0);var f=q.length(P);f>.001&&(q.scale(P,P,J.BQ),J.XO&&J.XO(P),J.restitution>0&&f>R.minBounceImpulse&&(q.scale(P,P,J.restitution),J.applyImpulse(P)));var M=q.squaredLength(J.Ee);M>1e-5&&J.ue();R.ZE&&R.ZE(J)?(J.loadFromCopy(a),J.rolledBackLastTick=!0):J.rolledBackLastTick=!1}(this,B,R,J)))};var x=q.create([0,0,0]);var I=q.create();function V(R,J,B,Q,h){var y=B.resting[J],N=Q[J];if(!B.alwaysApplyHorizFriction||1!==J){if(0===y)return;if(y*N<=0)return}q.j(M,B.Ee),M[J]=0;var r=q.length(M);if(!g(r,0)){var e=Math.abs(B.friction*R.gravity[J]*h),D=r>e?(r-e)/r:0;B.Ee[(J+1)%3]*=D,B.Ee[(J+2)%3]*=D}}var M=q.create();function H(R,J,B,Q,h){return q.set(Q,0,0,0),e(R.testSolid,J,B,(function(R,J,B,y){Q[J]=B,y[J]=0,h||(y[0]=0,y[1]=0,y[2]=0)}))}var d=new r([],[]),X=q.create(),c=q.create(),z=q.create(),p=q.create();var i=q.create(),W=new r([],[]),k=q.create();function Y(R,J,B,Q){return R.testSolid(Math.floor(J),Math.floor(B-1),Math.floor(Q))}var G=q.create();function g(R,J){return Math.abs(R-J)<1e-5}function L(R,J){for(var B=0;B<3;B++)R.base[B]=J.base[B],R.max[B]=J.max[B],R.nD[B]=J.nD[B]}var j=function(R){}},11879:function(R,J){!function(R){"use strict";var J=function(R,B){return J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,J){R.__proto__=J}||function(R,J){for(var B in J)Object.prototype.hasOwnProperty.call(J,B)&&(R[B]=J[B])},J(R,B)};function B(R,B){if("function"!==typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function Q(){this.constructor=R}J(R,B),R.prototype=null===B?Object.create(B):(Q.prototype=B.prototype,new Q)}function Q(R,J,B,Q){var h,y=arguments.length,N=y<3?J:null===Q?Q=Object.getOwnPropertyDescriptor(J,B):Q;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)N=Reflect.decorate(R,J,B,Q);else for(var r=R.length-1;r>=0;r--)(h=R[r])&&(N=(y<3?h(N):y>3?h(J,B,N):h(J,B))||N);return y>3&&N&&Object.defineProperty(J,B,N),N}function h(R,J,B){if(B||2===arguments.length)for(var Q,h=0,y=J.length;h<y;h++)!Q&&h in J||(Q||(Q=Array.prototype.slice.call(J,0,h)),Q[h]=J[h]);return R.concat(Q||Array.prototype.slice.call(J))}var y,N=255,r=213;R.OPERATION=void 0,(y=R.OPERATION||(R.OPERATION={}))[y.ADD=128]="ADD",y[y.REPLACE=0]="REPLACE",y[y.DELETE=64]="DELETE",y[y.DELETE_AND_ADD=192]="DELETE_AND_ADD",y[y.TOUCH=1]="TOUCH",y[y.CLEAR=10]="CLEAR";var q=function(){function J(R,J,B){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=R,this.setParent(J,B)}return J.prototype.setParent=function(R,J,B){var Q=this;if(this.indexes||(this.indexes=this.ref instanceof pR?this.ref._definition.indexes:{}),this.parent=R,this.parentIndex=B,J)if(this.root=J,this.ref instanceof pR){var h=this.ref._definition;for(var y in h.schema){var N=this.ref[y];if(N&&N.$changes){var r=h.indexes[y];N.$changes.setParent(this.ref,J,r)}}}else"object"===typeof this.ref&&this.ref.forEach((function(R,J){if(R instanceof pR){var B=R.$changes,h=Q.ref.$changes.indexes[J];B.setParent(Q.ref,Q.root,h)}}))},J.prototype.operation=function(R){this.changes.set(--this.currentCustomOperation,R)},J.prototype.change=function(J,B){void 0===B&&(B=R.OPERATION.ADD);var Q="number"===typeof J?J:this.indexes[J];this.assertValidIndex(Q,J);var h=this.changes.get(Q);h&&h.op!==R.OPERATION.DELETE&&h.op!==R.OPERATION.TOUCH||this.changes.set(Q,{op:h&&h.op===R.OPERATION.DELETE?R.OPERATION.DELETE_AND_ADD:B,index:Q}),this.allChanges.add(Q),this.changed=!0,this.touchParents()},J.prototype.touch=function(J){var B="number"===typeof J?J:this.indexes[J];this.assertValidIndex(B,J),this.changes.has(B)||this.changes.set(B,{op:R.OPERATION.TOUCH,index:B}),this.allChanges.add(B),this.touchParents()},J.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},J.prototype.getType=function(R){if(this.ref._definition)return(J=this.ref._definition).schema[J.fieldsByIndex[R]];var J,B=(J=this.parent._definition).schema[J.fieldsByIndex[this.parentIndex]];return Object.values(B)[0]},J.prototype.getChildrenFilter=function(){var R=this.parent._definition.childFilters;return R&&R[this.parentIndex]},J.prototype.getValue=function(R){return this.ref.getByIndex(R)},J.prototype.delete=function(J){var B="number"===typeof J?J:this.indexes[J];if(void 0!==B){var Q=this.getValue(B);this.changes.set(B,{op:R.OPERATION.DELETE,index:B}),this.allChanges.delete(B),delete this.caches[B],Q&&Q.$changes&&(Q.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(J," (").concat(B,")"))},J.prototype.discard=function(J,B){var Q=this;void 0===J&&(J=!1),void 0===B&&(B=!1),this.ref instanceof pR||this.changes.forEach((function(J){if(J.op===R.OPERATION.DELETE){var B=Q.ref.getIndex(J.index);delete Q.indexes[B]}})),this.changes.clear(),this.changed=J,B&&this.allChanges.clear(),this.currentCustomOperation=0},J.prototype.discardAll=function(){var R=this;this.changes.forEach((function(J){var B=R.getValue(J.index);B&&B.$changes&&B.$changes.discardAll()})),this.discard()},J.prototype.cache=function(R,J){this.caches[R]=J},J.prototype.clone=function(){return new J(this.ref,this.parent,this.root)},J.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},J.prototype.assertValidIndex=function(R,J){if(void 0===R)throw new Error('ChangeTree: missing index for field "'.concat(J,'"'))},J}();function e(R,J,B,Q){return R[J]||(R[J]=[]),R[J].push(B),null===Q||void 0===Q||Q.forEach((function(R,J){return B(R,J)})),function(){return l(R[J],R[J].indexOf(B))}}function D(J){var B=this,Q="string"!==typeof this.$changes.getType();this.$items.forEach((function(h,y){J.push({refId:B.$changes.refId,op:R.OPERATION.DELETE,field:y,value:void 0,previousValue:h}),Q&&B.$changes.root.removeRef(h.$changes.refId)}))}function l(R,J){if(-1===J||J>=R.length)return!1;for(var B=R.length-1,Q=J;Q<B;Q++)R[Q]=R[Q+1];return R.length=B,!0}var E=function(R,J){var B=R.toString(),Q=J.toString();return B<Q?-1:B>Q?1:0};function O(R){return R.$proxy=!0,R=new Proxy(R,{get:function(R,J){return"symbol"===typeof J||isNaN(J)?R[J]:R.at(J)},set:function(R,J,B){if("symbol"===typeof J||isNaN(J))R[J]=B;else{var Q=Array.from(R.$items.keys()),h=parseInt(Q[J]||J);void 0===B||null===B?R.deleteAt(h):R.setAt(h,B)}return!0},deleteProperty:function(R,J){return"number"===typeof J?R.deleteAt(J):delete R[J],!0}})}var n=function(){function J(){for(var R=[],J=0;J<arguments.length;J++)R[J]=arguments[J];this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,R)}return J.prototype.ir=function(J,B){return void 0===B&&(B=!0),e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,J,B?this.$items:void 0)},J.prototype.QQ=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,J)},J.prototype.onChange=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,J)},J.is=function(R){return Array.isArray(R)||void 0!==R.array},Object.defineProperty(J.prototype,"length",{get:function(){return this.$items.size},set:function(R){0===R?this.clear():this.splice(R,this.length-R)},enumerable:!1,configurable:!0}),J.prototype.push=function(){for(var R,J=this,B=[],Q=0;Q<arguments.length;Q++)B[Q]=arguments[Q];return B.forEach((function(B){R=J.$refId++,J.setAt(R,B)})),R},J.prototype.pop=function(){var R=Array.from(this.$indexes.values()).pop();if(void 0!==R){this.$changes.delete(R),this.$indexes.delete(R);var J=this.$items.get(R);return this.$items.delete(R),J}},J.prototype.at=function(R){var J=Array.from(this.$items.keys())[R];return this.$items.get(J)},J.prototype.setAt=function(J,B){var Q,h;if(void 0!==B&&null!==B){if(this.$items.get(J)!==B){void 0!==B.$changes&&B.$changes.setParent(this,this.$changes.root,J);var y=null!==(h=null===(Q=this.$changes.indexes[J])||void 0===Q?void 0:Q.op)&&void 0!==h?h:R.OPERATION.ADD;this.$changes.indexes[J]=J,this.$indexes.set(J,J),this.$items.set(J,B),this.$changes.change(J,y)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},J.prototype.deleteAt=function(R){var J=Array.from(this.$items.keys())[R];return void 0!==J&&this.$deleteAt(J)},J.prototype.$deleteAt=function(R){return this.$changes.delete(R),this.$indexes.delete(R),this.$items.delete(R)},J.prototype.clear=function(J){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),J&&D.call(this,J),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},J.prototype.concat=function(){for(var R,B=[],Q=0;Q<arguments.length;Q++)B[Q]=arguments[Q];return new(J.bind.apply(J,h([void 0],(R=Array.from(this.$items.values())).concat.apply(R,B),!1)))},J.prototype.join=function(R){return Array.from(this.$items.values()).join(R)},J.prototype.reverse=function(){var R=this,J=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(B,Q){R.setAt(J[Q],B)})),this},J.prototype.shift=function(){var R=Array.from(this.$items.keys()).shift();if(void 0!==R){var J=this.$items.get(R);return this.$deleteAt(R),J}},J.prototype.slice=function(R,B){var Q=new J;return Q.push.apply(Q,Array.from(this.$items.values()).slice(R,B)),Q},J.prototype.sort=function(R){var J=this;void 0===R&&(R=E);var B=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(R).forEach((function(R,Q){J.setAt(B[Q],R)})),this},J.prototype.splice=function(R,J){void 0===J&&(J=this.length-R);for(var B=Array.from(this.$items.keys()),Q=[],h=R;h<R+J;h++)Q.push(this.$items.get(B[h])),this.$deleteAt(B[h]);return Q},J.prototype.unshift=function(){for(var R=this,J=[],B=0;B<arguments.length;B++)J[B]=arguments[B];var Q=this.length,h=J.length,y=Array.from(this.$items.values());return J.forEach((function(J,B){R.setAt(B,J)})),y.forEach((function(J,B){R.setAt(h+B,J)})),Q+h},J.prototype.indexOf=function(R,J){return Array.from(this.$items.values()).indexOf(R,J)},J.prototype.lastIndexOf=function(R,J){return void 0===J&&(J=this.length-1),Array.from(this.$items.values()).lastIndexOf(R,J)},J.prototype.every=function(R,J){return Array.from(this.$items.values()).every(R,J)},J.prototype.some=function(R,J){return Array.from(this.$items.values()).some(R,J)},J.prototype.forEach=function(R,J){Array.from(this.$items.values()).forEach(R,J)},J.prototype.map=function(R,J){return Array.from(this.$items.values()).map(R,J)},J.prototype.filter=function(R,J){return Array.from(this.$items.values()).filter(R,J)},J.prototype.reduce=function(R,J){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},J.prototype.reduceRight=function(R,J){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},J.prototype.find=function(R,J){return Array.from(this.$items.values()).find(R,J)},J.prototype.findIndex=function(R,J){return Array.from(this.$items.values()).findIndex(R,J)},J.prototype.fill=function(R,J,B){throw new Error("ArraySchema#fill() not implemented")},J.prototype.copyWithin=function(R,J,B){throw new Error("ArraySchema#copyWithin() not implemented")},J.prototype.toString=function(){return this.$items.toString()},J.prototype.toLocaleString=function(){return this.$items.toLocaleString()},J.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(J,Symbol.species,{get:function(){return J},enumerable:!1,configurable:!0}),J.prototype.entries=function(){return this.$items.entries()},J.prototype.keys=function(){return this.$items.keys()},J.prototype.values=function(){return this.$items.values()},J.prototype.includes=function(R,J){return Array.from(this.$items.values()).includes(R,J)},J.prototype.flatMap=function(R,J){throw new Error("ArraySchema#flatMap() is not supported.")},J.prototype.flat=function(R){throw new Error("ArraySchema#flat() is not supported.")},J.prototype.findLast=function(){var R=Array.from(this.$items.values());return R.findLast.apply(R,arguments)},J.prototype.findLastIndex=function(){var R=Array.from(this.$items.values());return R.findLastIndex.apply(R,arguments)},J.prototype.setIndex=function(R,J){this.$indexes.set(R,J)},J.prototype.getIndex=function(R){return this.$indexes.get(R)},J.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},J.prototype.deleteByIndex=function(R){var J=this.$indexes.get(R);this.$items.delete(J),this.$indexes.delete(R)},J.prototype.toArray=function(){return Array.from(this.$items.values())},J.prototype.toJSON=function(){return this.toArray().map((function(R){return"function"===typeof R.toJSON?R.toJSON():R}))},J.prototype.clone=function(R){return R?new(J.bind.apply(J,h([void 0],Array.from(this.$items.values()),!1))):new(J.bind.apply(J,h([void 0],this.map((function(R){return R.$changes?R.clone():R})),!1)))},J}();function P(R){return R.$proxy=!0,R=new Proxy(R,{get:function(R,J){return"symbol"!==typeof J&&"undefined"===typeof R[J]?R.get(J):R[J]},set:function(R,J,B){return"symbol"!==typeof J&&-1===J.indexOf("$")&&"ir"!==J&&"QQ"!==J&&"onChange"!==J?R.set(J,B):R[J]=B,!0},deleteProperty:function(R,J){return R.delete(J),!0}})}var A=function(){function J(R){var B=this;if(this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R)if(R instanceof Map||R instanceof J)R.forEach((function(R,J){return B.set(J,R)}));else for(var Q in R)this.set(Q,R[Q])}return J.prototype.ir=function(J,B){return void 0===B&&(B=!0),e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,J,B?this.$items:void 0)},J.prototype.QQ=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,J)},J.prototype.onChange=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,J)},J.is=function(R){return void 0!==R.map},J.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(J.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(J,Symbol.species,{get:function(){return J},enumerable:!1,configurable:!0}),J.prototype.set=function(J,B){if(void 0===B||null===B)throw new Error("MapSchema#set('".concat(J,"', ").concat(B,"): trying to set ").concat(B," value on '").concat(J,"'."));J=J.toString();var Q="undefined"!==typeof this.$changes.indexes[J],h=Q?this.$changes.indexes[J]:this.$refId++,y=Q?R.OPERATION.REPLACE:R.OPERATION.ADD,N=void 0!==B.$changes;if(N&&B.$changes.setParent(this,this.$changes.root,h),Q){if(!N&&this.$items.get(J)===B)return;N&&this.$items.get(J)!==B&&(y=R.OPERATION.ADD)}else this.$changes.indexes[J]=h,this.$indexes.set(h,J);return this.$items.set(J,B),this.$changes.change(J,y),this},J.prototype.get=function(R){return this.$items.get(R)},J.prototype.delete=function(R){return this.$changes.delete(R),this.$items.delete(R)},J.prototype.clear=function(J){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),J&&D.call(this,J),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},J.prototype.has=function(R){return this.$items.has(R)},J.prototype.forEach=function(R){this.$items.forEach(R)},J.prototype.entries=function(){return this.$items.entries()},J.prototype.keys=function(){return this.$items.keys()},J.prototype.values=function(){return this.$items.values()},Object.defineProperty(J.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),J.prototype.setIndex=function(R,J){this.$indexes.set(R,J)},J.prototype.getIndex=function(R){return this.$indexes.get(R)},J.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},J.prototype.deleteByIndex=function(R){var J=this.$indexes.get(R);this.$items.delete(J),this.$indexes.delete(R)},J.prototype.toJSON=function(){var R={};return this.forEach((function(J,B){R[B]="function"===typeof J.toJSON?J.toJSON():J})),R},J.prototype.clone=function(R){var B;return R?B=Object.assign(new J,this):(B=new J,this.forEach((function(R,J){R.$changes?B.set(J,R.clone()):B.set(J,R)}))),B},J}(),u={};function S(R,J){u[R]=J}function f(R){return u[R]}var a=function(){function R(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return R.create=function(J){var B=new R;return B.schema=Object.assign({},J&&J.schema||{}),B.indexes=Object.assign({},J&&J.indexes||{}),B.fieldsByIndex=Object.assign({},J&&J.fieldsByIndex||{}),B.descriptors=Object.assign({},J&&J.descriptors||{}),B.deprecated=Object.assign({},J&&J.deprecated||{}),B},R.prototype.addField=function(R,J){var B=this.getNextFieldIndex();this.fieldsByIndex[B]=R,this.indexes[R]=B,this.schema[R]=Array.isArray(J)?{array:J[0]}:J},R.prototype.hasField=function(R){return void 0!==this.indexes[R]},R.prototype.addFilter=function(R,J){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[R]]=J,this.indexesWithFilters.push(this.indexes[R]),!0},R.prototype.addChildrenFilter=function(R,J){var B=this.indexes[R],Q=this.schema[R];if(f(Object.keys(Q)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[B]=J,!0;console.warn("@filterChildren: field '".concat(R,"' can't have children. Ignoring filter."))},R.prototype.getChildrenFilter=function(R){return this.childFilters&&this.childFilters[this.indexes[R]]},R.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},R}();function s(R){return R._context&&R._context.useFilters}var x=function(){function R(){this.types={},this.schemas=new Map,this.useFilters=!1}return R.prototype.has=function(R){return this.schemas.has(R)},R.prototype.get=function(R){return this.types[R]},R.prototype.add=function(R,J){void 0===J&&(J=this.schemas.size),R._definition=a.create(R._definition),R._typeid=J,this.types[J]=R,this.schemas.set(R,J)},R.create=function(J){return void 0===J&&(J={}),function(B){return J.context||(J.context=new R),V(B,J)}},R}(),I=new x;function V(R,J){return void 0===J&&(J={}),function(B,Q){var y=J.context||I,N=B.constructor;if(N._context=y,!R)throw new Error("".concat(N.name,': @type() reference provided for "').concat(Q,"\" is undefined. Make sure you don't have any circular dependencies."));y.has(N)||y.add(N);var r=N._definition;if(r.addField(Q,R),r.descriptors[Q]){if(r.deprecated[Q])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(Q,"' definition on '").concat(N.name,"'.\nCheck @type() annotation"))}catch(u){var q=u.stack.split("\n")[4].trim();throw new Error("".concat(u.message," ").concat(q))}}var e=n.is(R),D=!e&&A.is(R);if("string"!==typeof R&&!pR.is(R)){var l=Object.values(R)[0];"string"===typeof l||y.has(l)||y.add(l)}if(J.manual)r.descriptors[Q]={enumerable:!0,configurable:!0,writable:!0};else{var E="_".concat(Q);r.descriptors[E]={enumerable:!1,configurable:!1,writable:!0},r.descriptors[Q]={get:function(){return this[E]},set:function(R){R!==this[E]&&(void 0!==R&&null!==R?(!e||R instanceof n||(R=new(n.bind.apply(n,h([void 0],R,!1)))),!D||R instanceof A||(R=new A(R)),void 0===R.$proxy&&(D?R=P(R):e&&(R=O(R))),this.$changes.change(Q),R.$changes&&R.$changes.setParent(this,this.$changes.root,this._definition.indexes[Q])):this[E]&&this.$changes.delete(Q),this[E]=R)},enumerable:!0,configurable:!0}}}}function M(R){return function(J,B){var Q=J.constructor;Q._definition.addFilter(B,R)&&(Q._context.useFilters=!0)}}function H(R){return function(J,B){var Q=J.constructor;Q._definition.addChildrenFilter(B,R)&&(Q._context.useFilters=!0)}}function d(R){return void 0===R&&(R=!0),function(J,B){var Q=J.constructor._definition;Q.deprecated[B]=!0,R&&(Q.descriptors[B]={get:function(){throw new Error("".concat(B," is deprecated."))},set:function(R){},enumerable:!1,configurable:!0})}}function X(R,J,B){for(var Q in void 0===B&&(B={}),B.context||(B.context=R._context||B.context||I),J)V(J[Q],B)(R.prototype,Q);return R}function c(R){for(var J=0,B=0,Q=0,h=R.length;Q<h;Q++)(J=R.charCodeAt(Q))<128?B+=1:J<2048?B+=2:J<55296||J>=57344?B+=3:(Q++,B+=4);return B}function z(R,J,B){for(var Q=0,h=0,y=B.length;h<y;h++)(Q=B.charCodeAt(h))<128?R[J++]=Q:Q<2048?(R[J++]=192|Q>>6,R[J++]=128|63&Q):Q<55296||Q>=57344?(R[J++]=224|Q>>12,R[J++]=128|Q>>6&63,R[J++]=128|63&Q):(h++,Q=65536+((1023&Q)<<10|1023&B.charCodeAt(h)),R[J++]=240|Q>>18,R[J++]=128|Q>>12&63,R[J++]=128|Q>>6&63,R[J++]=128|63&Q)}function p(R,J){R.push(255&J)}function i(R,J){R.push(255&J)}function W(R,J){R.push(255&J),R.push(J>>8&255)}function k(R,J){R.push(255&J),R.push(J>>8&255)}function Y(R,J){R.push(255&J),R.push(J>>8&255),R.push(J>>16&255),R.push(J>>24&255)}function G(R,J){var B=J>>24,Q=J>>16,h=J>>8,y=J;R.push(255&y),R.push(255&h),R.push(255&Q),R.push(255&B)}function g(R,J){var B=Math.floor(J/Math.pow(2,32));G(R,J>>>0),G(R,B)}function L(R,J){var B=J/Math.pow(2,32)|0;G(R,J>>>0),G(R,B)}function j(R,J){w(R,J)}function T(R,J){K(R,J)}var F=new Int32Array(2),C=new Float32Array(F.buffer),b=new Float64Array(F.buffer);function w(R,J){C[0]=J,Y(R,F[0])}function K(R,J){b[0]=J,Y(R,F[0]),Y(R,F[1])}function v(R,J){return i(R,J?1:0)}function m(R,J){J||(J="");var B=c(J),Q=0;if(B<32)R.push(160|B),Q=1;else if(B<256)R.push(217),i(R,B),Q=2;else if(B<65536)R.push(218),k(R,B),Q=3;else{if(!(B<4294967296))throw new Error("String too long");R.push(219),G(R,B),Q=5}return z(R,R.length,J),Q+B}function o(R,J){return isNaN(J)?o(R,0):isFinite(J)?J!==(0|J)?(R.push(203),K(R,J),9):J>=0?J<128?(i(R,J),1):J<256?(R.push(204),i(R,J),2):J<65536?(R.push(205),k(R,J),3):J<4294967296?(R.push(206),G(R,J),5):(R.push(207),L(R,J),9):J>=-32?(R.push(224|J+32),1):J>=-128?(R.push(208),p(R,J),2):J>=-32768?(R.push(209),W(R,J),3):J>=-2147483648?(R.push(210),Y(R,J),5):(R.push(211),g(R,J),9):o(R,J>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var t=Object.freeze({__proto__:null,utf8Write:z,int8:p,uint8:i,int16:W,uint16:k,int32:Y,uint32:G,int64:g,uint64:L,float32:j,float64:T,writeFloat32:w,writeFloat64:K,boolean:v,string:m,number:o});function Z(R,J,B){for(var Q="",h=0,y=J,N=J+B;y<N;y++){var r=R[y];0!==(128&r)?192!==(224&r)?224!==(240&r)?240!==(248&r)?console.error("Invalid byte "+r.toString(16)):(h=(7&r)<<18|(63&R[++y])<<12|(63&R[++y])<<6|63&R[++y])>=65536?(h-=65536,Q+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):Q+=String.fromCharCode(h):Q+=String.fromCharCode((15&r)<<12|(63&R[++y])<<6|63&R[++y]):Q+=String.fromCharCode((31&r)<<6|63&R[++y]):Q+=String.fromCharCode(r)}return Q}function U(R,J){return RR(R,J)<<24>>24}function RR(R,J){return R[J.offset++]}function JR(R,J){return BR(R,J)<<16>>16}function BR(R,J){return R[J.offset++]|R[J.offset++]<<8}function QR(R,J){return R[J.offset++]|R[J.offset++]<<8|R[J.offset++]<<16|R[J.offset++]<<24}function hR(R,J){return QR(R,J)>>>0}function yR(R,J){return ER(R,J)}function NR(R,J){return OR(R,J)}function rR(R,J){var B=hR(R,J);return QR(R,J)*Math.pow(2,32)+B}function qR(R,J){var B=hR(R,J);return hR(R,J)*Math.pow(2,32)+B}var eR=new Int32Array(2),DR=new Float32Array(eR.buffer),lR=new Float64Array(eR.buffer);function ER(R,J){return eR[0]=QR(R,J),DR[0]}function OR(R,J){return eR[0]=QR(R,J),eR[1]=QR(R,J),lR[0]}function nR(R,J){return RR(R,J)>0}function PR(R,J){var B,Q=R[J.offset++];Q<192?B=31&Q:217===Q?B=RR(R,J):218===Q?B=BR(R,J):219===Q&&(B=hR(R,J));var h=Z(R,J.offset,B);return J.offset+=B,h}function AR(R,J){var B=R[J.offset];return B<192&&B>160||217===B||218===B||219===B}function uR(R,J){var B=R[J.offset++];return B<128?B:202===B?ER(R,J):203===B?OR(R,J):204===B?RR(R,J):205===B?BR(R,J):206===B?hR(R,J):207===B?qR(R,J):208===B?U(R,J):209===B?JR(R,J):210===B?QR(R,J):211===B?rR(R,J):B>223?-1*(255-B+1):void 0}function SR(R,J){var B=R[J.offset];return B<128||B>=202&&B<=211}function fR(R,J){return R[J.offset]<160}function aR(R,J){return R[J.offset-1]===N&&(R[J.offset]<128||R[J.offset]>=202&&R[J.offset]<=211)}var sR=Object.freeze({__proto__:null,int8:U,uint8:RR,int16:JR,uint16:BR,int32:QR,uint32:hR,float32:yR,float64:NR,int64:rR,uint64:qR,readFloat32:ER,readFloat64:OR,boolean:nR,string:PR,stringCheck:AR,number:uR,numberCheck:SR,arrayCheck:fR,switchStructureCheck:aR}),xR=function(){function J(R){var J=this;this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R&&R.forEach((function(R){return J.add(R)}))}return J.prototype.ir=function(J,B){return void 0===B&&(B=!0),e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,J,B?this.$items:void 0)},J.prototype.QQ=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,J)},J.prototype.onChange=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,J)},J.is=function(R){return void 0!==R.collection},J.prototype.add=function(R){var J=this.$refId++;return void 0!==R.$changes&&R.$changes.setParent(this,this.$changes.root,J),this.$changes.indexes[J]=J,this.$indexes.set(J,J),this.$items.set(J,R),this.$changes.change(J),J},J.prototype.at=function(R){var J=Array.from(this.$items.keys())[R];return this.$items.get(J)},J.prototype.entries=function(){return this.$items.entries()},J.prototype.delete=function(R){for(var J,B,Q=this.$items.entries();(B=Q.next())&&!B.done;)if(R===B.value[1]){J=B.value[0];break}return void 0!==J&&(this.$changes.delete(J),this.$indexes.delete(J),this.$items.delete(J))},J.prototype.clear=function(J){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),J&&D.call(this,J),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},J.prototype.has=function(R){return Array.from(this.$items.values()).some((function(J){return J===R}))},J.prototype.forEach=function(R){var J=this;this.$items.forEach((function(B,Q,h){return R(B,Q,J)}))},J.prototype.values=function(){return this.$items.values()},Object.defineProperty(J.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),J.prototype.setIndex=function(R,J){this.$indexes.set(R,J)},J.prototype.getIndex=function(R){return this.$indexes.get(R)},J.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},J.prototype.deleteByIndex=function(R){var J=this.$indexes.get(R);this.$items.delete(J),this.$indexes.delete(R)},J.prototype.toArray=function(){return Array.from(this.$items.values())},J.prototype.toJSON=function(){var R=[];return this.forEach((function(J,B){R.push("function"===typeof J.toJSON?J.toJSON():J)})),R},J.prototype.clone=function(R){var B;return R?B=Object.assign(new J,this):(B=new J,this.forEach((function(R){R.$changes?B.add(R.clone()):B.add(R)}))),B},J}(),IR=function(){function J(R){var J=this;this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R&&R.forEach((function(R){return J.add(R)}))}return J.prototype.ir=function(J,B){return void 0===B&&(B=!0),e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,J,B?this.$items:void 0)},J.prototype.QQ=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,J)},J.prototype.onChange=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,J)},J.is=function(R){return void 0!==R.set},J.prototype.add=function(J){var B,Q;if(this.has(J))return!1;var h=this.$refId++;void 0!==J.$changes&&J.$changes.setParent(this,this.$changes.root,h);var y=null!==(Q=null===(B=this.$changes.indexes[h])||void 0===B?void 0:B.op)&&void 0!==Q?Q:R.OPERATION.ADD;return this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,J),this.$changes.change(h,y),h},J.prototype.entries=function(){return this.$items.entries()},J.prototype.delete=function(R){for(var J,B,Q=this.$items.entries();(B=Q.next())&&!B.done;)if(R===B.value[1]){J=B.value[0];break}return void 0!==J&&(this.$changes.delete(J),this.$indexes.delete(J),this.$items.delete(J))},J.prototype.clear=function(J){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),J&&D.call(this,J),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},J.prototype.has=function(R){for(var J,B=this.$items.values(),Q=!1;(J=B.next())&&!J.done;)if(R===J.value){Q=!0;break}return Q},J.prototype.forEach=function(R){var J=this;this.$items.forEach((function(B,Q,h){return R(B,Q,J)}))},J.prototype.values=function(){return this.$items.values()},Object.defineProperty(J.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),J.prototype.setIndex=function(R,J){this.$indexes.set(R,J)},J.prototype.getIndex=function(R){return this.$indexes.get(R)},J.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},J.prototype.deleteByIndex=function(R){var J=this.$indexes.get(R);this.$items.delete(J),this.$indexes.delete(R)},J.prototype.toArray=function(){return Array.from(this.$items.values())},J.prototype.toJSON=function(){var R=[];return this.forEach((function(J,B){R.push("function"===typeof J.toJSON?J.toJSON():J)})),R},J.prototype.clone=function(R){var B;return R?B=Object.assign(new J,this):(B=new J,this.forEach((function(R){R.$changes?B.add(R.clone()):B.add(R)}))),B},J}(),VR=function(){function R(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return R.prototype.addRefId=function(R){this.refIds.has(R)||(this.refIds.add(R),this.containerIndexes.set(R,new Set))},R.get=function(J){return void 0===J.$filterState&&(J.$filterState=new R),J.$filterState},R}(),MR=function(){function R(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return R.prototype.getNextUniqueId=function(){return this.nextUniqueId++},R.prototype.addRef=function(R,J,B){void 0===B&&(B=!0),this.refs.set(R,J),B&&(this.refCounts[R]=(this.refCounts[R]||0)+1)},R.prototype.removeRef=function(R){this.refCounts[R]=this.refCounts[R]-1,this.deletedRefs.add(R)},R.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},R.prototype.garbageCollectDeletedRefs=function(){var R=this;this.deletedRefs.forEach((function(J){if(!(R.refCounts[J]>0)){var B=R.refs.get(J);if(B instanceof pR)for(var Q in B._definition.schema)"string"!==typeof B._definition.schema[Q]&&B[Q]&&B[Q].$changes&&R.removeRef(B[Q].$changes.refId);else{var h=B.$changes.parent._definition,y=h.schema[h.fieldsByIndex[B.$changes.parentIndex]];"function"===typeof Object.values(y)[0]&&Array.from(B.values()).forEach((function(J){return R.removeRef(J.$changes.refId)}))}R.refs.delete(J),delete R.refCounts[J]}})),this.deletedRefs.clear()},R}(),HR=function(R){function J(){return null!==R&&R.apply(this,arguments)||this}return B(J,R),J}(Error);function dR(R,J,B,Q){var h,y=!1;switch(J){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":h="number",isNaN(R)&&console.log('trying to encode "NaN" in '.concat(B.constructor.name,"#").concat(Q));break;case"string":h="string",y=!0;break;case"boolean":return}if(typeof R!==h&&(!y||y&&null!==R)){var N="'".concat(JSON.stringify(R),"'").concat(R&&R.constructor&&" (".concat(R.constructor.name,")")||"");throw new HR("a '".concat(h,"' was expected, but ").concat(N," was provided in ").concat(B.constructor.name,"#").concat(Q))}}function XR(R,J,B,Q){if(!(R instanceof J))throw new HR("a '".concat(J.name,"' was expected, but '").concat(R.constructor.name,"' was provided in ").concat(B.constructor.name,"#").concat(Q))}function cR(R,J,B,Q,h){dR(B,R,Q,h);var y=t[R];if(!y)throw new HR("a '".concat(R,"' was expected, but ").concat(B," was provided in ").concat(Q.constructor.name,"#").concat(h));y(J,B)}function zR(R,J,B){return sR[R](J,B)}var pR=function(){function J(){for(var R=[],J=0;J<arguments.length;J++)R[J]=arguments[J];Object.defineProperties(this,{$changes:{value:new q(this,void 0,new MR),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var B=this._definition.descriptors;B&&Object.defineProperties(this,B),R[0]&&this.assign(R[0])}return J.onError=function(R){console.error(R)},J.is=function(R){return R._definition&&void 0!==R._definition.schema},J.prototype.onChange=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,J)},J.prototype.QQ=function(J){return e(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,J)},J.prototype.assign=function(R){return Object.assign(this,R),this},Object.defineProperty(J.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),J.prototype.setDirty=function(R,J){this.$changes.change(R,J)},J.prototype.listen=function(R,J,B){var Q=this;return void 0===B&&(B=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[R]||(this.$callbacks[R]=[]),this.$callbacks[R].push(J),B&&void 0!==this[R]&&J(this[R],void 0),function(){return l(Q.$callbacks[R],Q.$callbacks[R].indexOf(J))}},J.prototype.decode=function(B,Q,h){var y;void 0===Q&&(Q={offset:0}),void 0===h&&(h=this);var r=[],q=this.$changes.root,e=B.length,D=0;for(q.refs.set(D,this);Q.offset<e;){var l=B[Q.offset++];if(l!=N){var E=h.$changes,O=void 0!==h._definition,P=O?l>>6<<6:l;if(P!==R.OPERATION.CLEAR){var u=O?l%(P||255):uR(B,Q),S=O?h._definition.fieldsByIndex[u]:"",a=E.getType(u),s=void 0,x=void 0,I=void 0;if(O?x=h["_".concat(S)]:(x=h.getByIndex(u),(P&R.OPERATION.ADD)===R.OPERATION.ADD?(I=h instanceof A?PR(B,Q):u,h.setIndex(u,I)):I=h.getIndex(u)),(P&R.OPERATION.DELETE)===R.OPERATION.DELETE&&(P!==R.OPERATION.DELETE_AND_ADD&&h.deleteByIndex(u),x&&x.$changes&&q.removeRef(x.$changes.refId),s=null),void 0!==S){if(P===R.OPERATION.DELETE);else if(J.is(a)){var V=uR(B,Q);if(s=q.refs.get(V),P!==R.OPERATION.REPLACE){var M=this.getSchemaType(B,Q,a);s||((s=this.createTypeInstance(M)).$changes.refId=V,x&&(s.$callbacks=x.$callbacks,x.$changes.refId&&V!==x.$changes.refId&&q.removeRef(x.$changes.refId))),q.addRef(V,s,s!==x)}}else if("string"===typeof a)s=zR(a,B,Q);else{var H=f(Object.keys(a)[0]),d=uR(B,Q),X=q.refs.has(d)?x||q.refs.get(d):new H.constructor;if((s=X.clone(!0)).$changes.refId=d,x&&(s.$callbacks=x.$callbacks,x.$changes.refId&&d!==x.$changes.refId)){q.removeRef(x.$changes.refId);for(var c=x.entries(),z=void 0;(z=c.next())&&!z.done;){var p=(y=z.value)[0],i=y[1];r.push({refId:d,op:R.OPERATION.DELETE,field:p,value:void 0,previousValue:i})}}q.addRef(d,s,X!==x)}if(null!==s&&void 0!==s)if(s.$changes&&s.$changes.setParent(E.ref,E.root,u),h instanceof J)h[S]=s;else if(h instanceof A)p=I,h.$items.set(p,s),h.$changes.allChanges.add(u);else if(h instanceof n)h.setAt(u,s);else if(h instanceof xR){var W=h.add(s);h.setIndex(u,W)}else h instanceof IR&&!1!==(W=h.add(s))&&h.setIndex(u,W);x!==s&&r.push({refId:D,op:P,field:S,dynamicIndex:I,value:s,previousValue:x})}else{console.warn("@colyseus/schema: definition mismatch");for(var k={offset:Q.offset};Q.offset<e&&(!aR(B,Q)||(k.offset=Q.offset+1,!q.refs.has(uR(B,k))));)Q.offset++}}else h.clear(r)}else{D=uR(B,Q);var Y=q.refs.get(D);if(!Y)throw new Error('"refId" not found: '.concat(D));h=Y}}return this._triggerChanges(r),q.garbageCollectDeletedRefs(),r},J.prototype.encode=function(B,Q,h){void 0===B&&(B=!1),void 0===Q&&(Q=[]),void 0===h&&(h=!1);for(var y=this.$changes,r=new WeakSet,q=[y],e=1,D=0;D<e;D++){var l=q[D],E=l.ref,O=E instanceof J;l.ensureRefId(),r.add(l),l!==y&&(l.changed||B)&&(i(Q,N),o(Q,l.refId));for(var n=B?Array.from(l.allChanges):Array.from(l.changes.values()),P=0,u=n.length;P<u;P++){var S=B?{op:R.OPERATION.ADD,index:n[P]}:n[P],a=S.index,s=O?E._definition.fieldsByIndex&&E._definition.fieldsByIndex[a]:a,x=Q.length;if(S.op!==R.OPERATION.TOUCH)if(O)i(Q,a|S.op);else{if(i(Q,S.op),S.op===R.OPERATION.CLEAR)continue;o(Q,a)}if(O||(S.op&R.OPERATION.ADD)!=R.OPERATION.ADD||E instanceof A&&m(Q,l.ref.$indexes.get(a)),S.op!==R.OPERATION.DELETE){var I=l.getType(a),V=l.getValue(a);if(V&&V.$changes&&!r.has(V.$changes)&&(q.push(V.$changes),V.$changes.ensureRefId(),e++),S.op!==R.OPERATION.TOUCH){if(J.is(I))XR(V,I,E,s),o(Q,V.$changes.refId),(S.op&R.OPERATION.ADD)===R.OPERATION.ADD&&this.tryEncodeTypeId(Q,I,V.constructor);else if("string"===typeof I)cR(I,Q,V,E,s);else{var M=f(Object.keys(I)[0]);XR(E["_".concat(s)],M.constructor,E,s),o(Q,V.$changes.refId)}h&&l.cache(a,Q.slice(x))}}}B||h||l.discard()}return Q},J.prototype.encodeAll=function(R){return this.encode(!0,[],R)},J.prototype.applyFilters=function(B,Q){var h,y;void 0===Q&&(Q=!1);for(var r=this,q=new Set,e=VR.get(B),D=[this.$changes],l=1,E=[],O=function(O){var n=D[O];if(q.has(n.refId))return"continue";var P=n.ref,u=P instanceof J;i(E,N),o(E,n.refId);var S=e.refIds.has(n),f=Q||!S;e.addRefId(n);var a=e.containerIndexes.get(n),s=f?Array.from(n.allChanges):Array.from(n.changes.values());!Q&&u&&P._definition.indexesWithFilters&&P._definition.indexesWithFilters.forEach((function(J){!a.has(J)&&n.allChanges.has(J)&&(f?s.push(J):s.push({op:R.OPERATION.ADD,index:J}))}));for(var x=0,I=s.length;x<I;x++){var V=f?{op:R.OPERATION.ADD,index:s[x]}:s[x];if(V.op!==R.OPERATION.CLEAR){var M=V.index;if(V.op!==R.OPERATION.DELETE){var H=n.getValue(M),d=n.getType(M);if(u){if((X=P._definition.filters&&P._definition.filters[M])&&!X.call(P,B,H,r)){H&&H.$changes&&q.add(H.$changes.refId);continue}}else{var X,c=n.parent;if((X=n.getChildrenFilter())&&!X.call(c,B,P.$indexes.get(M),H,r)){H&&H.$changes&&q.add(H.$changes.refId);continue}}if(H.$changes&&(D.push(H.$changes),l++),V.op!==R.OPERATION.TOUCH)if(V.op===R.OPERATION.ADD||u)E.push.apply(E,null!==(h=n.caches[M])&&void 0!==h?h:[]),a.add(M);else if(a.has(M))E.push.apply(E,null!==(y=n.caches[M])&&void 0!==y?y:[]);else{if(a.add(M),i(E,R.OPERATION.ADD),o(E,M),P instanceof A){var z=n.ref.$indexes.get(M);m(E,z)}H.$changes?o(E,H.$changes.refId):t[d](E,H)}else H.$changes&&!u&&(i(E,R.OPERATION.ADD),o(E,M),P instanceof A&&(z=n.ref.$indexes.get(M),m(E,z)),o(E,H.$changes.refId))}else u?i(E,V.op|M):(i(E,V.op),o(E,M))}else i(E,V.op)}},n=0;n<l;n++)O(n);return E},J.prototype.clone=function(){var R,J=new this.constructor,B=this._definition.schema;for(var Q in B)"object"===typeof this[Q]&&"function"===typeof(null===(R=this[Q])||void 0===R?void 0:R.clone)?J[Q]=this[Q].clone():J[Q]=this[Q];return J},J.prototype.toJSON=function(){var R=this._definition.schema,J=this._definition.deprecated,B={};for(var Q in R)J[Q]||null===this[Q]||"undefined"===typeof this[Q]||(B[Q]="function"===typeof this[Q].toJSON?this[Q].toJSON():this["_".concat(Q)]);return B},J.prototype.discardAllChanges=function(){this.$changes.discardAll()},J.prototype.getByIndex=function(R){return this[this._definition.fieldsByIndex[R]]},J.prototype.deleteByIndex=function(R){this[this._definition.fieldsByIndex[R]]=void 0},J.prototype.tryEncodeTypeId=function(R,J,B){J._typeid!==B._typeid&&(i(R,r),o(R,B._typeid))},J.prototype.getSchemaType=function(R,J,B){var Q;return R[J.offset]===r&&(J.offset++,Q=this.constructor._context.get(uR(R,J))),Q||B},J.prototype.createTypeInstance=function(R){var J=new R;return J.$changes.root=this.$changes.root,J},J.prototype._triggerChanges=function(B){for(var Q,h,y,N,r,q,e,D,l,E=new Set,O=this.$changes.root.refs,n=function(n){var P=B[n],A=P.refId,u=O.get(A),S=u.$callbacks;if((P.op&R.OPERATION.DELETE)===R.OPERATION.DELETE&&P.previousValue instanceof J&&(null===(h=null===(Q=P.previousValue.$callbacks)||void 0===Q?void 0:Q[R.OPERATION.DELETE])||void 0===h||h.forEach((function(R){return R()}))),!S)return"continue";if(u instanceof J){if(!E.has(A))try{null===(y=null===S||void 0===S?void 0:S[R.OPERATION.REPLACE])||void 0===y||y.forEach((function(R){return R()}))}catch(f){J.onError(f)}try{S.hasOwnProperty(P.field)&&(null===(N=S[P.field])||void 0===N||N.forEach((function(R){return R(P.value,P.previousValue)})))}catch(f){J.onError(f)}}else P.op===R.OPERATION.ADD&&void 0===P.previousValue?null===(r=S[R.OPERATION.ADD])||void 0===r||r.forEach((function(R){var J;return R(P.value,null!==(J=P.dynamicIndex)&&void 0!==J?J:P.field)})):P.op===R.OPERATION.DELETE?void 0!==P.previousValue&&(null===(q=S[R.OPERATION.DELETE])||void 0===q||q.forEach((function(R){var J;return R(P.previousValue,null!==(J=P.dynamicIndex)&&void 0!==J?J:P.field)}))):P.op===R.OPERATION.DELETE_AND_ADD&&(void 0!==P.previousValue&&(null===(e=S[R.OPERATION.DELETE])||void 0===e||e.forEach((function(R){var J;return R(P.previousValue,null!==(J=P.dynamicIndex)&&void 0!==J?J:P.field)}))),null===(D=S[R.OPERATION.ADD])||void 0===D||D.forEach((function(R){var J;return R(P.value,null!==(J=P.dynamicIndex)&&void 0!==J?J:P.field)}))),P.value!==P.previousValue&&(null===(l=S[R.OPERATION.REPLACE])||void 0===l||l.forEach((function(R){var J;return R(P.value,null!==(J=P.dynamicIndex)&&void 0!==J?J:P.field)})));E.add(A)},P=0;P<B.length;P++)n(P)},J._definition=a.create(),J}();function iR(R){for(var J=[R.$changes],B=1,Q={},h=Q,y=function(R){var B=J[R];B.changes.forEach((function(R){var J=B.ref,Q=R.index,y=J._definition?J._definition.fieldsByIndex[Q]:J.$indexes.get(Q);h[y]=B.getValue(Q)}))},N=0;N<B;N++)y(N);return Q}var WR={context:new x},kR=function(R){function J(){return null!==R&&R.apply(this,arguments)||this}return B(J,R),Q([V("string",WR)],J.prototype,"name",void 0),Q([V("string",WR)],J.prototype,"type",void 0),Q([V("number",WR)],J.prototype,"referencedType",void 0),J}(pR),YR=function(R){function J(){var J=null!==R&&R.apply(this,arguments)||this;return J.fields=new n,J}return B(J,R),Q([V("number",WR)],J.prototype,"id",void 0),Q([V([kR],WR)],J.prototype,"fields",void 0),J}(pR),GR=function(R){function J(){var J=null!==R&&R.apply(this,arguments)||this;return J.types=new n,J}return B(J,R),J.encode=function(R){var B=R.constructor,Q=new J;Q.rootType=B._typeid;var h=function(R,J){for(var B in J){var h=new kR;h.name=B;var y=void 0;if("string"===typeof J[B])y=J[B];else{var N=J[B],r=void 0;pR.is(N)?(y="ref",r=J[B]):"string"===typeof N[y=Object.keys(N)[0]]?y+=":"+N[y]:r=N[y],h.referencedType=r?r._typeid:-1}h.type=y,R.fields.push(h)}Q.types.push(R)},y=B._context.types;for(var N in y){var r=new YR;r.id=Number(N),h(r,y[N]._definition.schema)}return Q.encodeAll()},J.decode=function(R,Q){var h=new x,y=new J;y.decode(R,Q);var N=y.types.reduce((function(R,J){var Q=function(R){function J(){return null!==R&&R.apply(this,arguments)||this}return B(J,R),J}(pR),y=J.id;return R[y]=Q,h.add(Q,y),R}),{});y.types.forEach((function(R){var J=N[R.id];R.fields.forEach((function(R){var B;if(void 0!==R.referencedType){var Q=R.type,y=N[R.referencedType];if(!y){var r=R.type.split(":");Q=r[0],y=r[1]}"ref"===Q?V(y,{context:h})(J.prototype,R.name):V(((B={})[Q]=y,B),{context:h})(J.prototype,R.name)}else V(R.type,{context:h})(J.prototype,R.name)}))}));var r=N[y.rootType],q=new r;for(var e in r._definition.schema){var D=r._definition.schema[e];"string"!==typeof D&&(q[e]="function"===typeof D?new D:new(f(Object.keys(D)[0]).constructor))}return q},Q([V([YR],WR)],J.prototype,"types",void 0),Q([V("number",WR)],J.prototype,"rootType",void 0),J}(pR);S("map",{constructor:A}),S("array",{constructor:n}),S("set",{constructor:IR}),S("collection",{constructor:xR}),R.ArraySchema=n,R.CollectionSchema=xR,R.Context=x,R.MapSchema=A,R.Reflection=GR,R.ReflectionField=kR,R.ReflectionType=YR,R.Schema=pR,R.SchemaDefinition=a,R.SetSchema=IR,R.decode=sR,R.defineTypes=X,R.deprecated=d,R.dumpChanges=iR,R.encode=t,R.filter=M,R.filterChildren=H,R.hasFilter=s,R.registerType=S,R.type=V,Object.defineProperty(R,"__esModule",{value:!0})}(J)},13317:R=>{"use strict";R.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13312:(R,J,B)=>{var Q=B(13317),h=B(13319),y=Object.hasOwnProperty,N=Object.create(null);for(var r in Q)y.call(Q,r)&&(N[Q[r]]=r);var q=R.exports={to:{},get:{}};function e(R,J,B){return Math.min(Math.max(J,R),B)}function D(R){var J=Math.round(R).toString(16).toUpperCase();return J.length<2?"0"+J:J}q.get=function(R){var J,B;switch(R.substring(0,3).toLowerCase()){case"hsl":J=q.get.hsl(R),B="hsl";break;case"hwb":J=q.get.hwb(R),B="hwb";break;default:J=q.get.rgb(R),B="rgb"}return J?{model:B,value:J}:null},q.get.rgb=function(R){if(!R)return null;var J,B,h,N=[0,0,0,1];if(J=R.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(h=J[2],J=J[1],B=0;B<3;B++){var r=2*B;N[B]=parseInt(J.slice(r,r+2),16)}h&&(N[3]=parseInt(h,16)/255)}else if(J=R.match(/^#([a-f0-9]{3,4})$/i)){for(h=(J=J[1])[3],B=0;B<3;B++)N[B]=parseInt(J[B]+J[B],16);h&&(N[3]=parseInt(h+h,16)/255)}else if(J=R.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(B=0;B<3;B++)N[B]=parseInt(J[B+1],0);J[4]&&(J[5]?N[3]=.01*parseFloat(J[4]):N[3]=parseFloat(J[4]))}else{if(!(J=R.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(J=R.match(/^(\w+)$/))?"transparent"===J[1]?[0,0,0,0]:y.call(Q,J[1])?((N=Q[J[1]])[3]=1,N):null:null;for(B=0;B<3;B++)N[B]=Math.round(2.55*parseFloat(J[B+1]));J[4]&&(J[5]?N[3]=.01*parseFloat(J[4]):N[3]=parseFloat(J[4]))}for(B=0;B<3;B++)N[B]=e(N[B],0,255);return N[3]=e(N[3],0,1),N},q.get.hsl=function(R){if(!R)return null;var J=R.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(J){var B=parseFloat(J[4]);return[(parseFloat(J[1])%360+360)%360,e(parseFloat(J[2]),0,100),e(parseFloat(J[3]),0,100),e(isNaN(B)?1:B,0,1)]}return null},q.get.hwb=function(R){if(!R)return null;var J=R.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(J){var B=parseFloat(J[4]);return[(parseFloat(J[1])%360+360)%360,e(parseFloat(J[2]),0,100),e(parseFloat(J[3]),0,100),e(isNaN(B)?1:B,0,1)]}return null},q.to.hex=function(){var R=h(arguments);return"#"+D(R[0])+D(R[1])+D(R[2])+(R[3]<1?D(Math.round(255*R[3])):"")},q.to.rgb=function(){var R=h(arguments);return R.length<4||1===R[3]?"rgb("+Math.round(R[0])+", "+Math.round(R[1])+", "+Math.round(R[2])+")":"rgba("+Math.round(R[0])+", "+Math.round(R[1])+", "+Math.round(R[2])+", "+R[3]+")"},q.to.rgb.percent=function(){var R=h(arguments),J=Math.round(R[0]/255*100),B=Math.round(R[1]/255*100),Q=Math.round(R[2]/255*100);return R.length<4||1===R[3]?"rgb("+J+"%, "+B+"%, "+Q+"%)":"rgba("+J+"%, "+B+"%, "+Q+"%, "+R[3]+")"},q.to.hsl=function(){var R=h(arguments);return R.length<4||1===R[3]?"hsl("+R[0]+", "+R[1]+"%, "+R[2]+"%)":"hsla("+R[0]+", "+R[1]+"%, "+R[2]+"%, "+R[3]+")"},q.to.hwb=function(){var R=h(arguments),J="";return R.length>=4&&1!==R[3]&&(J=", "+R[3]),"hwb("+R[0]+", "+R[1]+"%, "+R[2]+"%"+J+")"},q.to.keyword=function(R){return N[R.slice(0,3)]}},13304:(R,J,B)=>{const Q=B(13312),h=B(13332),y=["keyword","gray","hex"],N={};for(const O of Object.keys(h))N[[...h[O].labels].sort().join("")]=O;const r={};function q(R,J){if(!(this instanceof q))return new q(R,J);if(J&&J in y&&(J=null),J&&!(J in h))throw new Error("Unknown model: "+J);let B,e;if(null==R)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(R instanceof q)this.model=R.model,this.color=[...R.color],this.valpha=R.valpha;else if("string"===typeof R){const J=Q.get(R);if(null===J)throw new Error("Unable to parse color from string: "+R);this.model=J.model,e=h[this.model].channels,this.color=J.value.slice(0,e),this.valpha="number"===typeof J.value[e]?J.value[e]:1}else if(R.length>0){this.model=J||"rgb",e=h[this.model].channels;const B=Array.prototype.slice.call(R,0,e);this.color=E(B,e),this.valpha="number"===typeof R[e]?R[e]:1}else if("number"===typeof R)this.model="rgb",this.color=[R>>16&255,R>>8&255,255&R],this.valpha=1;else{this.valpha=1;const J=Object.keys(R);"alpha"in R&&(J.splice(J.indexOf("alpha"),1),this.valpha="number"===typeof R.alpha?R.alpha:0);const Q=J.sort().join("");if(!(Q in N))throw new Error("Unable to parse color from object: "+JSON.stringify(R));this.model=N[Q];const{labels:y}=h[this.model],r=[];for(B=0;B<y.length;B++)r.push(R[y[B]]);this.color=E(r)}if(r[this.model])for(e=h[this.model].channels,B=0;B<e;B++){const R=r[this.model][B];R&&(this.color[B]=R(this.color[B]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}q.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(R){let J=this.model in Q.to?this:this.rgb();J=J.round("number"===typeof R?R:1);const B=1===J.valpha?J.color:[...J.color,this.valpha];return Q.to[J.model](B)},percentString(R){const J=this.rgb().round("number"===typeof R?R:1),B=1===J.valpha?J.color:[...J.color,this.valpha];return Q.to.rgb.percent(B)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const R={},{channels:J}=h[this.model],{labels:B}=h[this.model];for(let Q=0;Q<J;Q++)R[B[Q]]=this.color[Q];return 1!==this.valpha&&(R.alpha=this.valpha),R},unitArray(){const R=this.rgb().color;return R[0]/=255,R[1]/=255,R[2]/=255,1!==this.valpha&&R.push(this.valpha),R},unitObject(){const R=this.rgb().object();return R.r/=255,R.g/=255,R.b/=255,1!==this.valpha&&(R.alpha=this.valpha),R},round(R){return R=Math.max(R||0,0),new q([...this.color.map(e(R)),this.valpha],this.model)},alpha(R){return void 0!==R?new q([...this.color,Math.max(0,Math.min(1,R))],this.model):this.valpha},red:D("rgb",0,l(255)),green:D("rgb",1,l(255)),blue:D("rgb",2,l(255)),hue:D(["hsl","hsv","hsl","hwb","hcg"],0,(R=>(R%360+360)%360)),saturationl:D("hsl",1,l(100)),lightness:D("hsl",2,l(100)),saturationv:D("hsv",1,l(100)),value:D("hsv",2,l(100)),chroma:D("hcg",1,l(100)),gray:D("hcg",2,l(100)),white:D("hwb",1,l(100)),wblack:D("hwb",2,l(100)),cyan:D("cmyk",0,l(100)),magenta:D("cmyk",1,l(100)),yellow:D("cmyk",2,l(100)),black:D("cmyk",3,l(100)),x:D("xyz",0,l(95.047)),y:D("xyz",1,l(100)),z:D("xyz",2,l(108.833)),l:D("lab",0,l(100)),a:D("lab",1),b:D("lab",2),keyword(R){return void 0!==R?new q(R):h[this.model].keyword(this.color)},hex(R){return void 0!==R?new q(R):Q.to.hex(this.rgb().round().color)},hexa(R){if(void 0!==R)return new q(R);const J=this.rgb().round().color;let B=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===B.length&&(B="0"+B),Q.to.hex(J)+B},rgbNumber(){const R=this.rgb().color;return(255&R[0])<<16|(255&R[1])<<8|255&R[2]},luminosity(){const R=this.rgb().color,J=[];for(const[B,Q]of R.entries()){const R=Q/255;J[B]=R<=.04045?R/12.92:((R+.055)/1.055)**2.4}return.2126*J[0]+.7152*J[1]+.0722*J[2]},contrast(R){const J=this.luminosity(),B=R.luminosity();return J>B?(J+.05)/(B+.05):(B+.05)/(J+.05)},level(R){const J=this.contrast(R);return J>=7?"AAA":J>=4.5?"AA":""},isDark(){const R=this.rgb().color;return(2126*R[0]+7152*R[1]+722*R[2])/1e4<128},isLight(){return!this.isDark()},negate(){const R=this.rgb();for(let J=0;J<3;J++)R.color[J]=255-R.color[J];return R},lighten(R){const J=this.hsl();return J.color[2]+=J.color[2]*R,J},darken(R){const J=this.hsl();return J.color[2]-=J.color[2]*R,J},saturate(R){const J=this.hsl();return J.color[1]+=J.color[1]*R,J},desaturate(R){const J=this.hsl();return J.color[1]-=J.color[1]*R,J},whiten(R){const J=this.hwb();return J.color[1]+=J.color[1]*R,J},blacken(R){const J=this.hwb();return J.color[2]+=J.color[2]*R,J},grayscale(){const R=this.rgb().color,J=.3*R[0]+.59*R[1]+.11*R[2];return q.rgb(J,J,J)},fade(R){return this.alpha(this.valpha-this.valpha*R)},opaquer(R){return this.alpha(this.valpha+this.valpha*R)},rotate(R){const J=this.hsl();let B=J.color[0];return B=(B+R)%360,B=B<0?360+B:B,J.color[0]=B,J},mix(R,J){if(!R||!R.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof R);const B=R.rgb(),Q=this.rgb(),h=void 0===J?.5:J,y=2*h-1,N=B.alpha()-Q.alpha(),r=((y*N===-1?y:(y+N)/(1+y*N))+1)/2,e=1-r;return q.rgb(r*B.red()+e*Q.red(),r*B.green()+e*Q.green(),r*B.blue()+e*Q.blue(),B.alpha()*h+Q.alpha()*(1-h))}};for(const O of Object.keys(h)){if(y.includes(O))continue;const{channels:R}=h[O];q.prototype[O]=function(){if(this.model===O)return new q(this);for(var R=arguments.length,J=new Array(R),B=0;B<R;B++)J[B]=arguments[B];return J.length>0?new q(J,O):new q([...(Q=h[this.model][O].raw(this.color),Array.isArray(Q)?Q:[Q]),this.valpha],O);var Q},q[O]=function(){for(var J=arguments.length,B=new Array(J),Q=0;Q<J;Q++)B[Q]=arguments[Q];let h=B[0];return"number"===typeof h&&(h=E(B,R)),new q(h,O)}}function e(R){return function(J){return function(R,J){return Number(R.toFixed(J))}(J,R)}}function D(R,J,B){R=Array.isArray(R)?R:[R];for(const Q of R)(r[Q]||(r[Q]=[]))[J]=B;return R=R[0],function(Q){let h;return void 0!==Q?(B&&(Q=B(Q)),h=this[R](),h.color[J]=Q,h):(h=this[R]().color[J],B&&(h=B(h)),h)}}function l(R){return function(J){return Math.max(0,Math.min(R,J))}}function E(R,J){for(let B=0;B<J;B++)"number"!==typeof R[B]&&(R[B]=0);return R}R.exports=q},13338:(R,J,B)=>{const Q=B(13347),h={};for(const N of Object.keys(Q))h[Q[N]]=N;const y={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};R.exports=y;for(const N of Object.keys(y)){if(!("channels"in y[N]))throw new Error("missing channels property: "+N);if(!("labels"in y[N]))throw new Error("missing channel labels property: "+N);if(y[N].labels.length!==y[N].channels)throw new Error("channel and label counts mismatch: "+N);const{channels:R,labels:J}=y[N];delete y[N].channels,delete y[N].labels,Object.defineProperty(y[N],"channels",{value:R}),Object.defineProperty(y[N],"labels",{value:J})}y.rgb.hsl=function(R){const J=R[0]/255,B=R[1]/255,Q=R[2]/255,h=Math.min(J,B,Q),y=Math.max(J,B,Q),N=y-h;let r,q;y===h?r=0:J===y?r=(B-Q)/N:B===y?r=2+(Q-J)/N:Q===y&&(r=4+(J-B)/N),r=Math.min(60*r,360),r<0&&(r+=360);const e=(h+y)/2;return q=y===h?0:e<=.5?N/(y+h):N/(2-y-h),[r,100*q,100*e]},y.rgb.hsv=function(R){let J,B,Q,h,y;const N=R[0]/255,r=R[1]/255,q=R[2]/255,e=Math.max(N,r,q),D=e-Math.min(N,r,q),l=function(R){return(e-R)/6/D+.5};return 0===D?(h=0,y=0):(y=D/e,J=l(N),B=l(r),Q=l(q),N===e?h=Q-B:r===e?h=1/3+J-Q:q===e&&(h=2/3+B-J),h<0?h+=1:h>1&&(h-=1)),[360*h,100*y,100*e]},y.rgb.hwb=function(R){const J=R[0],B=R[1];let Q=R[2];const h=y.rgb.hsl(R)[0],N=1/255*Math.min(J,Math.min(B,Q));return Q=1-1/255*Math.max(J,Math.max(B,Q)),[h,100*N,100*Q]},y.rgb.cmyk=function(R){const J=R[0]/255,B=R[1]/255,Q=R[2]/255,h=Math.min(1-J,1-B,1-Q);return[100*((1-J-h)/(1-h)||0),100*((1-B-h)/(1-h)||0),100*((1-Q-h)/(1-h)||0),100*h]},y.rgb.keyword=function(R){const J=h[R];if(J)return J;let B,y=1/0;for(const h of Object.keys(Q)){const J=Q[h],q=(r=J,((N=R)[0]-r[0])**2+(N[1]-r[1])**2+(N[2]-r[2])**2);q<y&&(y=q,B=h)}var N,r;return B},y.keyword.rgb=function(R){return Q[R]},y.rgb.xyz=function(R){let J=R[0]/255,B=R[1]/255,Q=R[2]/255;J=J>.04045?((J+.055)/1.055)**2.4:J/12.92,B=B>.04045?((B+.055)/1.055)**2.4:B/12.92,Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92;return[100*(.4124*J+.3576*B+.1805*Q),100*(.2126*J+.7152*B+.0722*Q),100*(.0193*J+.1192*B+.9505*Q)]},y.rgb.lab=function(R){const J=y.rgb.xyz(R);let B=J[0],Q=J[1],h=J[2];B/=95.047,Q/=100,h/=108.883,B=B>.008856?B**(1/3):7.787*B+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,h=h>.008856?h**(1/3):7.787*h+16/116;return[116*Q-16,500*(B-Q),200*(Q-h)]},y.hsl.rgb=function(R){const J=R[0]/360,B=R[1]/100,Q=R[2]/100;let h,y,N;if(0===B)return N=255*Q,[N,N,N];h=Q<.5?Q*(1+B):Q+B-Q*B;const r=2*Q-h,q=[0,0,0];for(let e=0;e<3;e++)y=J+1/3*-(e-1),y<0&&y++,y>1&&y--,N=6*y<1?r+6*(h-r)*y:2*y<1?h:3*y<2?r+(h-r)*(2/3-y)*6:r,q[e]=255*N;return q},y.hsl.hsv=function(R){const J=R[0];let B=R[1]/100,Q=R[2]/100,h=B;const y=Math.max(Q,.01);Q*=2,B*=Q<=1?Q:2-Q,h*=y<=1?y:2-y;return[J,100*(0===Q?2*h/(y+h):2*B/(Q+B)),100*((Q+B)/2)]},y.hsv.rgb=function(R){const J=R[0]/60,B=R[1]/100;let Q=R[2]/100;const h=Math.floor(J)%6,y=J-Math.floor(J),N=255*Q*(1-B),r=255*Q*(1-B*y),q=255*Q*(1-B*(1-y));switch(Q*=255,h){case 0:return[Q,q,N];case 1:return[r,Q,N];case 2:return[N,Q,q];case 3:return[N,r,Q];case 4:return[q,N,Q];case 5:return[Q,N,r]}},y.hsv.hsl=function(R){const J=R[0],B=R[1]/100,Q=R[2]/100,h=Math.max(Q,.01);let y,N;N=(2-B)*Q;const r=(2-B)*h;return y=B*h,y/=r<=1?r:2-r,y=y||0,N/=2,[J,100*y,100*N]},y.hwb.rgb=function(R){const J=R[0]/360;let B=R[1]/100,Q=R[2]/100;const h=B+Q;let y;h>1&&(B/=h,Q/=h);const N=Math.floor(6*J),r=1-Q;y=6*J-N,0!==(1&N)&&(y=1-y);const q=B+y*(r-B);let e,D,l;switch(N){default:case 6:case 0:e=r,D=q,l=B;break;case 1:e=q,D=r,l=B;break;case 2:e=B,D=r,l=q;break;case 3:e=B,D=q,l=r;break;case 4:e=q,D=B,l=r;break;case 5:e=r,D=B,l=q}return[255*e,255*D,255*l]},y.cmyk.rgb=function(R){const J=R[0]/100,B=R[1]/100,Q=R[2]/100,h=R[3]/100;return[255*(1-Math.min(1,J*(1-h)+h)),255*(1-Math.min(1,B*(1-h)+h)),255*(1-Math.min(1,Q*(1-h)+h))]},y.xyz.rgb=function(R){const J=R[0]/100,B=R[1]/100,Q=R[2]/100;let h,y,N;return h=3.2406*J+-1.5372*B+-.4986*Q,y=-.9689*J+1.8758*B+.0415*Q,N=.0557*J+-.204*B+1.057*Q,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,h=Math.min(Math.max(0,h),1),y=Math.min(Math.max(0,y),1),N=Math.min(Math.max(0,N),1),[255*h,255*y,255*N]},y.xyz.lab=function(R){let J=R[0],B=R[1],Q=R[2];J/=95.047,B/=100,Q/=108.883,J=J>.008856?J**(1/3):7.787*J+16/116,B=B>.008856?B**(1/3):7.787*B+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116;return[116*B-16,500*(J-B),200*(B-Q)]},y.lab.xyz=function(R){let J,B,Q;B=(R[0]+16)/116,J=R[1]/500+B,Q=B-R[2]/200;const h=B**3,y=J**3,N=Q**3;return B=h>.008856?h:(B-16/116)/7.787,J=y>.008856?y:(J-16/116)/7.787,Q=N>.008856?N:(Q-16/116)/7.787,J*=95.047,B*=100,Q*=108.883,[J,B,Q]},y.lab.lch=function(R){const J=R[0],B=R[1],Q=R[2];let h;h=360*Math.atan2(Q,B)/2/Math.PI,h<0&&(h+=360);return[J,Math.sqrt(B*B+Q*Q),h]},y.lch.lab=function(R){const J=R[0],B=R[1],Q=R[2]/360*2*Math.PI;return[J,B*Math.cos(Q),B*Math.sin(Q)]},y.rgb.ansi16=function(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[B,Q,h]=R;let N=null===J?y.rgb.hsv(R)[2]:J;if(N=Math.round(N/50),0===N)return 30;let r=30+(Math.round(h/255)<<2|Math.round(Q/255)<<1|Math.round(B/255));return 2===N&&(r+=60),r},y.hsv.ansi16=function(R){return y.rgb.ansi16(y.hsv.rgb(R),R[2])},y.rgb.ansi256=function(R){const J=R[0],B=R[1],Q=R[2];if(J===B&&B===Q)return J<8?16:J>248?231:Math.round((J-8)/247*24)+232;return 16+36*Math.round(J/255*5)+6*Math.round(B/255*5)+Math.round(Q/255*5)},y.ansi16.rgb=function(R){let J=R%10;if(0===J||7===J)return R>50&&(J+=3.5),J=J/10.5*255,[J,J,J];const B=.5*(1+~~(R>50));return[(1&J)*B*255,(J>>1&1)*B*255,(J>>2&1)*B*255]},y.ansi256.rgb=function(R){if(R>=232){const J=10*(R-232)+8;return[J,J,J]}let J;R-=16;return[Math.floor(R/36)/5*255,Math.floor((J=R%36)/6)/5*255,J%6/5*255]},y.rgb.hex=function(R){const J=(((255&Math.round(R[0]))<<16)+((255&Math.round(R[1]))<<8)+(255&Math.round(R[2]))).toString(16).toUpperCase();return"000000".substring(J.length)+J},y.hex.rgb=function(R){const J=R.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!J)return[0,0,0];let B=J[0];3===J[0].length&&(B=B.split("").map((R=>R+R)).join(""));const Q=parseInt(B,16);return[Q>>16&255,Q>>8&255,255&Q]},y.rgb.hcg=function(R){const J=R[0]/255,B=R[1]/255,Q=R[2]/255,h=Math.max(Math.max(J,B),Q),y=Math.min(Math.min(J,B),Q),N=h-y;let r,q;return r=N<1?y/(1-N):0,q=N<=0?0:h===J?(B-Q)/N%6:h===B?2+(Q-J)/N:4+(J-B)/N,q/=6,q%=1,[360*q,100*N,100*r]},y.hsl.hcg=function(R){const J=R[1]/100,B=R[2]/100,Q=B<.5?2*J*B:2*J*(1-B);let h=0;return Q<1&&(h=(B-.5*Q)/(1-Q)),[R[0],100*Q,100*h]},y.hsv.hcg=function(R){const J=R[1]/100,B=R[2]/100,Q=J*B;let h=0;return Q<1&&(h=(B-Q)/(1-Q)),[R[0],100*Q,100*h]},y.hcg.rgb=function(R){const J=R[0]/360,B=R[1]/100,Q=R[2]/100;if(0===B)return[255*Q,255*Q,255*Q];const h=[0,0,0],y=J%1*6,N=y%1,r=1-N;let q=0;switch(Math.floor(y)){case 0:h[0]=1,h[1]=N,h[2]=0;break;case 1:h[0]=r,h[1]=1,h[2]=0;break;case 2:h[0]=0,h[1]=1,h[2]=N;break;case 3:h[0]=0,h[1]=r,h[2]=1;break;case 4:h[0]=N,h[1]=0,h[2]=1;break;default:h[0]=1,h[1]=0,h[2]=r}return q=(1-B)*Q,[255*(B*h[0]+q),255*(B*h[1]+q),255*(B*h[2]+q)]},y.hcg.hsv=function(R){const J=R[1]/100,B=J+R[2]/100*(1-J);let Q=0;return B>0&&(Q=J/B),[R[0],100*Q,100*B]},y.hcg.hsl=function(R){const J=R[1]/100,B=R[2]/100*(1-J)+.5*J;let Q=0;return B>0&&B<.5?Q=J/(2*B):B>=.5&&B<1&&(Q=J/(2*(1-B))),[R[0],100*Q,100*B]},y.hcg.hwb=function(R){const J=R[1]/100,B=J+R[2]/100*(1-J);return[R[0],100*(B-J),100*(1-B)]},y.hwb.hcg=function(R){const J=R[1]/100,B=1-R[2]/100,Q=B-J;let h=0;return Q<1&&(h=(B-Q)/(1-Q)),[R[0],100*Q,100*h]},y.apple.rgb=function(R){return[R[0]/65535*255,R[1]/65535*255,R[2]/65535*255]},y.rgb.apple=function(R){return[R[0]/255*65535,R[1]/255*65535,R[2]/255*65535]},y.gray.rgb=function(R){return[R[0]/100*255,R[0]/100*255,R[0]/100*255]},y.gray.hsl=function(R){return[0,0,R[0]]},y.gray.hsv=y.gray.hsl,y.gray.hwb=function(R){return[0,100,R[0]]},y.gray.cmyk=function(R){return[0,0,0,R[0]]},y.gray.lab=function(R){return[R[0],0,0]},y.gray.hex=function(R){const J=255&Math.round(R[0]/100*255),B=((J<<16)+(J<<8)+J).toString(16).toUpperCase();return"000000".substring(B.length)+B},y.rgb.gray=function(R){return[(R[0]+R[1]+R[2])/3/255*100]}},13332:(R,J,B)=>{const Q=B(13338),h=B(13351),y={};Object.keys(Q).forEach((R=>{y[R]={},Object.defineProperty(y[R],"channels",{value:Q[R].channels}),Object.defineProperty(y[R],"labels",{value:Q[R].labels});const J=h(R);Object.keys(J).forEach((B=>{const Q=J[B];y[R][B]=function(R){const J=function(){for(var J=arguments.length,B=new Array(J),Q=0;Q<J;Q++)B[Q]=arguments[Q];const h=B[0];if(void 0===h||null===h)return h;h.length>1&&(B=h);const y=R(B);if("object"===typeof y)for(let R=y.length,N=0;N<R;N++)y[N]=Math.round(y[N]);return y};return"conversion"in R&&(J.conversion=R.conversion),J}(Q),y[R][B].raw=function(R){const J=function(){for(var J=arguments.length,B=new Array(J),Q=0;Q<J;Q++)B[Q]=arguments[Q];const h=B[0];return void 0===h||null===h?h:(h.length>1&&(B=h),R(B))};return"conversion"in R&&(J.conversion=R.conversion),J}(Q)}))})),R.exports=y},13351:(R,J,B)=>{const Q=B(13338);function h(R){const J=function(){const R={},J=Object.keys(Q);for(let B=J.length,Q=0;Q<B;Q++)R[J[Q]]={distance:-1,parent:null};return R}(),B=[R];for(J[R].distance=0;B.length;){const R=B.pop(),h=Object.keys(Q[R]);for(let Q=h.length,y=0;y<Q;y++){const Q=h[y],N=J[Q];-1===N.distance&&(N.distance=J[R].distance+1,N.parent=R,B.unshift(Q))}}return J}function y(R,J){return function(B){return J(R(B))}}function N(R,J){const B=[J[R].parent,R];let h=Q[J[R].parent][R],N=J[R].parent;for(;J[N].parent;)B.unshift(J[N].parent),h=y(Q[J[N].parent][N],h),N=J[N].parent;return h.conversion=B,h}R.exports=function(R){const J=h(R),B={},Q=Object.keys(J);for(let h=Q.length,y=0;y<h;y++){const R=Q[y];null!==J[R].parent&&(B[R]=N(R,J))}return B}},13347:R=>{"use strict";R.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11902:(R,J)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.discordURLBuilder=void 0,J.discordURLBuilder=function(R){var J;const B=(null===(J=null===window||void 0===window?void 0:window.location)||void 0===J?void 0:J.hostname)||"localhost",Q=R.hostname.split("."),h=!R.hostname.includes("trycloudflare.com")&&!R.hostname.includes("discordsays.com")&&Q.length>2?`/${Q[0]}`:"";return R.pathname.startsWith("/.proxy")?`${R.protocol}//${B}${h}${R.pathname}${R.search}`:`${R.protocol}//${B}/.proxy/colyseus${h}${R.pathname}${R.search}`}},11890:function(R,J,B){"use strict";var Q,h,y,N,r=this&&this.__awaiter||function(R,J,B,Q){return new(B||(B=Promise))((function(h,y){function N(R){try{q(Q.next(R))}catch(J){y(J)}}function r(R){try{q(Q.throw(R))}catch(J){y(J)}}function q(R){var J;R.done?h(R.value):(J=R.value,J instanceof B?J:new B((function(R){R(J)}))).then(N,r)}q((Q=Q.apply(R,J||[])).next())}))},q=this&&this.__classPrivateFieldGet||function(R,J,B,Q){if("a"===B&&!Q)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof J?R!==J||!Q:!J.has(R))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===B?Q:"a"===B?Q.call(R):Q?Q.value:J.get(R)},e=this&&this.__classPrivateFieldSet||function(R,J,B,Q,h){if("m"===Q)throw new TypeError("Private method is not writable");if("a"===Q&&!h)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof J?R!==J||!h:!J.has(R))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===Q?h.call(R,B):h?h.value=B:J.set(R,B),B};Object.defineProperty(J,"__esModule",{value:!0}),J.Auth=void 0;const D=B(11893),l=B(11865);J.Auth=class{constructor(R){this.http=R,this.settings={path:"/auth",key:"colyseus-auth-token"},Q.set(this,!1),h.set(this,void 0),y.set(this,void 0),N.set(this,(0,l.createNanoEvents)()),(0,D.getItem)(this.settings.key,(R=>this.token=R))}set token(R){this.http.authToken=R}get token(){return this.http.authToken}onChange(R){const J=q(this,N,"f").on("change",R);return q(this,Q,"f")||e(this,h,new Promise(((R,J)=>{this.getUserData().then((R=>{this.emitChange(Object.assign(Object.assign({},R),{token:this.token}))})).catch((R=>{this.emitChange({user:null,token:void 0})})).finally((()=>{R()}))})),"f"),e(this,Q,!0,"f"),J}getUserData(){return r(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(R,J,B){return r(this,void 0,void 0,(function*(){const Q=(yield this.http.post(`${this.settings.path}/register`,{body:{email:R,password:J,options:B}})).data;return this.emitChange(Q),Q}))}signInWithEmailAndPassword(R,J){return r(this,void 0,void 0,(function*(){const B=(yield this.http.post(`${this.settings.path}/login`,{body:{email:R,password:J}})).data;return this.emitChange(B),B}))}signInAnonymously(R){return r(this,void 0,void 0,(function*(){const J=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:R}})).data;return this.emitChange(J),J}))}sendPasswordResetEmail(R){return r(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:R}})).data}))}signInWithProvider(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,void 0,void 0,(function*(){return new Promise(((B,Q)=>{const h=J.width||480,N=J.height||768,r=this.token?`?token=${this.token}`:"",D=`Login with ${R[0].toUpperCase()+R.substring(1)}`,l=this.http.client.getHttpEndpoint(`${J.prefix||`${this.settings.path}/provider`}/${R}${r}`),E=screen.width/2-h/2,O=screen.height/2-N/2;e(this,y,window.open(l,D,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+h+", height="+N+", top="+O+", left="+E),"f");const n=R=>{void 0===R.data.user&&void 0===R.data.token||(clearInterval(P),q(this,y,"f").close(),e(this,y,void 0,"f"),window.removeEventListener("message",n),void 0!==R.data.error?Q(R.data.error):(B(R.data),this.emitChange(R.data)))},P=setInterval((()=>{q(this,y,"f")&&!q(this,y,"f").closed||(e(this,y,void 0,"f"),Q("gy"),window.removeEventListener("message",n))}),200);window.addEventListener("message",n)}))}))}signOut(){return r(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(R){void 0!==R.token&&(this.token=R.token,null===R.token?(0,D.removeItem)(this.settings.key):(0,D.setItem)(this.settings.key,R.token)),q(this,N,"f").emit("change",R)}},Q=new WeakMap,h=new WeakMap,y=new WeakMap,N=new WeakMap},11812:function(R,J,B){"use strict";var Q,h=this&&this.__awaiter||function(R,J,B,Q){return new(B||(B=Promise))((function(h,y){function N(R){try{q(Q.next(R))}catch(J){y(J)}}function r(R){try{q(Q.throw(R))}catch(J){y(J)}}function q(R){var J;R.done?h(R.value):(J=R.value,J instanceof B?J:new B((function(R){R(J)}))).then(N,r)}q((Q=Q.apply(R,J||[])).next())}))};Object.defineProperty(J,"__esModule",{value:!0}),J.Client=J.MatchMakeError=void 0;const y=B(11820),N=B(11825),r=B(11883),q=B(11890),e=B(11902);class D extends Error{constructor(R,J){super(R),this.code=J,Object.setPrototypeOf(this,D.prototype)}}J.MatchMakeError=D;const l="undefined"!==typeof window&&"undefined"!==typeof(null===(Q=null===window||void 0===window?void 0:window.location)||void 0===Q?void 0:Q.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";J.Client=class{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,J=arguments.length>1?arguments[1]:void 0;var B,Q;if("string"===typeof R){const J=R.startsWith("/")?new URL(R,l):new URL(R),B="https:"===J.protocol||"wss:"===J.protocol,Q=Number(J.port||(B?443:80));this.settings={hostname:J.hostname,pathname:J.pathname,port:Q,secure:B}}else void 0===R.port&&(R.port=R.secure?443:80),void 0===R.pathname&&(R.pathname=""),this.settings=R;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new r.HTTP(this,(null===J||void 0===J?void 0:J.headers)||{}),this.auth=new q.Auth(this.http),this.urlBuilder=null===J||void 0===J?void 0:J.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(Q=null===(B=null===window||void 0===window?void 0:window.location)||void 0===B?void 0:B.hostname)||void 0===Q?void 0:Q.includes("discordsays.com"))&&(this.urlBuilder=e.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",R,J,B)}))}create(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",R,J,B)}))}join(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",R,J,B)}))}joinById(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",R,J,B)}))}reconnect(R,J){return h(this,void 0,void 0,(function*(){if("string"===typeof R&&"string"===typeof J)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[B,Q]=R.split(":");if(!B||!Q)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",B,{reconnectionToken:Q},J)}))}getAvailableRooms(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return h(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${R}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(R,J,B){return h(this,void 0,void 0,(function*(){const Q=this.createRoom(R.room.name,J);Q.roomId=R.room.roomId,Q.sessionId=R.sessionId;const N={sessionId:Q.sessionId};R.reconnectionToken&&(N.reconnectionToken=R.reconnectionToken);const r=B||Q;return Q.connect(this.buildEndpoint(R.room,N),R.devMode&&(()=>h(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${Q.roomId}'...`);let B=0;const y=()=>h(this,void 0,void 0,(function*(){B++;try{yield this.consumeSeatReservation(R,J,r),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${Q.roomId}'`)}catch(h){B<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${B} out of 8)`),setTimeout(y,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(y,2e3)}))),r,this.http.headers),new Promise(((R,J)=>{const B=(R,B)=>J(new y.ServerError(R,B));r.onError.once(B),r.onJoin.once((()=>{r.onError.remove(B),setTimeout((()=>{try{r.iq(128,new Uint8Array([148,203,109,74,82,171,8,186,243,29,96,183,241,206,31,35,93,101,119,159]))}catch{}}),3e3),R(r)}))}))}))}createMatchMakeRequest(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3?arguments[3]:void 0,y=arguments.length>4?arguments[4]:void 0;return h(this,void 0,void 0,(function*(){const h=(yield this.http.post(`matchmake/${R}/${J}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(B)})).data;if(h.error)throw new D(h.error,h.code);return"reconnect"===R&&(h.reconnectionToken=B.reconnectionToken),yield this.consumeSeatReservation(h,Q,y)}))}createRoom(R,J){return new N.Room(R,J)}buildEndpoint(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const B=[];for(const y in J)J.hasOwnProperty(y)&&B.push(`${y}=${J[y]}`);let Q=this.settings.secure?"wss://":"ws://";R.publicAddress?Q+=`${R.publicAddress}`:Q+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const h=`${Q}/${R.processId}/${R.roomId}?${B.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(h)):h}getHttpEndpoint(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const J=R.startsWith("/")?R:`/${R}`,B=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${J}`;return this.urlBuilder?this.urlBuilder(new URL(B)):B}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11832:(R,J,B)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Connection=void 0;const Q=B(11838);J.Connection=class{constructor(){this.events={},this.transport=new Q.WebSocketTransport(this.events)}send(R){this.transport.send(R)}connect(R,J){this.transport.connect(R,J)}close(R,J){this.transport.close(R,J)}get isOpen(){return this.transport.isOpen}}},11883:function(R,J,B){"use strict";var Q=this&&this.__createBinding||(Object.create?function(R,J,B,Q){void 0===Q&&(Q=B);var h=Object.getOwnPropertyDescriptor(J,B);h&&!("get"in h?!J.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return J[B]}}),Object.defineProperty(R,Q,h)}:function(R,J,B,Q){void 0===Q&&(Q=B),R[Q]=J[B]}),h=this&&this.__setModuleDefault||(Object.create?function(R,J){Object.defineProperty(R,"default",{enumerable:!0,value:J})}:function(R,J){R.default=J}),y=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var J={};if(null!=R)for(var B in R)"default"!==B&&Object.prototype.hasOwnProperty.call(R,B)&&Q(J,R,B);return h(J,R),J};Object.defineProperty(J,"__esModule",{value:!0}),J.HTTP=void 0;const N=B(11820),r=y(B(11887));J.HTTP=class{constructor(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=R,this.headers=J}get(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",R,J)}post(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",R,J)}del(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",R,J)}put(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",R,J)}request(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r[R](this.client.getHttpEndpoint(J),this.getOptions(B)).catch((R=>{var J;const B=R.statusCode,Q=(null===(J=R.data)||void 0===J?void 0:J.error)||R.statusMessage||R.message;if(!B&&!Q)throw R;throw new N.ServerError(B,Q)}))}getOptions(R){return R.headers=Object.assign({},this.headers,R.headers),this.authToken&&(R.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(R.withCredentials=!0),R}}},11848:(R,J)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.utf8Length=J.utf8Read=J.ErrorCode=J.Protocol=void 0,function(R){R[R.HANDSHAKE=9]="HANDSHAKE",R[R.JOIN_ROOM=10]="JOIN_ROOM",R[R.ERROR=11]="ERROR",R[R.LEAVE_ROOM=12]="LEAVE_ROOM",R[R.ROOM_DATA=13]="ROOM_DATA",R[R.ROOM_STATE=14]="ROOM_STATE",R[R.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",R[R.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",R[R.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(J.Protocol||(J.Protocol={})),function(R){R[R.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",R[R.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",R[R.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",R[R.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",R[R.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",R[R.AUTH_FAILED=4215]="AUTH_FAILED",R[R.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(J.ErrorCode||(J.ErrorCode={})),J.utf8Read=function(R,J){const B=R[J++];for(var Q="",h=0,y=J,N=J+B;y<N;y++){var r=R[y];if(0!==(128&r))if(192!==(224&r))if(224!==(240&r)){if(240!==(248&r))throw new Error("Invalid byte "+r.toString(16));(h=(7&r)<<18|(63&R[++y])<<12|(63&R[++y])<<6|63&R[++y])>=65536?(h-=65536,Q+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):Q+=String.fromCharCode(h)}else Q+=String.fromCharCode((15&r)<<12|(63&R[++y])<<6|63&R[++y]);else Q+=String.fromCharCode((31&r)<<6|63&R[++y]);else Q+=String.fromCharCode(r)}return Q},J.utf8Length=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",J=0,B=0;for(let Q=0,h=R.length;Q<h;Q++)J=R.charCodeAt(Q),J<128?B+=1:J<2048?B+=2:J<55296||J>=57344?B+=3:(Q++,B+=4);return B+1}},11825:function(R,J,B){"use strict";var Q=this&&this.__createBinding||(Object.create?function(R,J,B,Q){void 0===Q&&(Q=B);var h=Object.getOwnPropertyDescriptor(J,B);h&&!("get"in h?!J.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return J[B]}}),Object.defineProperty(R,Q,h)}:function(R,J,B,Q){void 0===Q&&(Q=B),R[Q]=J[B]}),h=this&&this.__setModuleDefault||(Object.create?function(R,J){Object.defineProperty(R,"default",{enumerable:!0,value:J})}:function(R,J){R.default=J}),y=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var J={};if(null!=R)for(var B in R)"default"!==B&&Object.prototype.hasOwnProperty.call(R,B)&&Q(J,R,B);return h(J,R),J};Object.defineProperty(J,"__esModule",{value:!0}),J.Room=void 0;const N=y(B(11827)),r=B(11832),q=B(11848),e=B(11856),D=B(11865),l=B(11872),E=B(11879),O=B(11820);class n{constructor(R,J){this.onStateChange=(0,l.createSignal)(),this.onError=(0,l.createSignal)(),this.onLeave=(0,l.createSignal)(),this.onJoin=(0,l.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,D.createNanoEvents)(),this.roomId=null,this.name=R,J&&(this.serializer=new((0,e.getSerializer)("schema")),this.rootSchema=J,this.serializer.state=new J),this.onError(((R,J)=>{var B;return null===(B=console.warn)||void 0===B?void 0:B.call(console,`colyseus.js - onError => (${R}) ${J}`)})),this.onLeave((()=>this.hJ()))}get id(){return this.roomId}connect(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,Q=arguments.length>3?arguments[3]:void 0;const h=new r.Connection;B.connection=h,h.events.onmessage=n.prototype.onMessageCallback.bind(B),h.events.onclose=function(R){var Q;if(!B.hasJoined)return null===(Q=console.warn)||void 0===Q||Q.call(console,`Room connection was closed unexpectedly (${R.code}): ${R.reason}`),void B.onError.invoke(R.code,R.reason);R.code===O.CloseCode.DEVMODE_RESTART&&J?J():(B.onLeave.invoke(R.code,R.reason),B.destroy())},h.events.onerror=function(R){var J;null===(J=console.warn)||void 0===J||J.call(console,`Room, onError (${R.code}): ${R.reason}`),B.onError.invoke(R.code,R.reason)},h.connect(R,Q)}Er(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((J=>{this.onLeave((R=>J(R))),this.connection?R?this.connection.send([q.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(O.CloseCode.CONSENTED)}))}iJ(R,J){return this.onMessageHandlers.on(this.getMessageHandlerKey(R),J)}send(R,J){const B=[q.Protocol.ROOM_DATA];let Q;if("string"===typeof R?E.encode.string(B,R):E.encode.number(B,R),void 0!==J){const R=N.encode(J);Q=new Uint8Array(B.length+R.byteLength),Q.set(new Uint8Array(B),0),Q.set(new Uint8Array(R),B.length)}else Q=new Uint8Array(B);this.connection.send(Q.buffer)}iq(R,J){const B=[q.Protocol.ROOM_DATA_BYTES];let Q;"string"===typeof R?E.encode.string(B,R):E.encode.number(B,R),Q=new Uint8Array(B.length+(J.byteLength||J.length)),Q.set(new Uint8Array(B),0),Q.set(new Uint8Array(J),B.length),this.connection.send(Q.buffer)}get state(){return this.serializer.getState()}hJ(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(R){const J=Array.from(new Uint8Array(R.data)),B=J[0];if(B===q.Protocol.JOIN_ROOM){let R=1;const B=(0,q.utf8Read)(J,R);if(R+=(0,q.utf8Length)(B),this.serializerId=(0,q.utf8Read)(J,R),R+=(0,q.utf8Length)(this.serializerId),!this.serializer){const R=(0,e.getSerializer)(this.serializerId);this.serializer=new R}J.length>R&&this.serializer.handshake&&this.serializer.handshake(J,{offset:R}),this.reconnectionToken=`${this.roomId}:${B}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([q.Protocol.JOIN_ROOM])}else if(B===q.Protocol.ERROR){const R={offset:1},B=E.decode.number(J,R),Q=E.decode.string(J,R);this.onError.invoke(B,Q)}else if(B===q.Protocol.LEAVE_ROOM)this.Er();else if(B===q.Protocol.ROOM_DATA_SCHEMA){const R={offset:1},B=this.serializer.getState().constructor._context.get(E.decode.number(J,R)),Q=new B;Q.decode(J,R),this.dispatchMessage(B,Q)}else if(B===q.Protocol.ROOM_STATE)J.shift(),this.setState(J);else if(B===q.Protocol.ROOM_STATE_PATCH)J.shift(),this.patch(J);else if(B===q.Protocol.ROOM_DATA){const B={offset:1},Q=E.decode.stringCheck(J,B)?E.decode.string(J,B):E.decode.number(J,B),h=J.length>B.offset?N.decode(R.data,B.offset):void 0;this.dispatchMessage(Q,h)}else if(B===q.Protocol.ROOM_DATA_BYTES){const R={offset:1},B=E.decode.stringCheck(J,R)?E.decode.string(J,R):E.decode.number(J,R);this.dispatchMessage(B,new Uint8Array(J.slice(R.offset)))}}setState(R){this.serializer.setState(R),this.onStateChange.invoke(this.serializer.getState())}patch(R){this.serializer.patch(R),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(R,J){var B;const Q=this.getMessageHandlerKey(R);this.onMessageHandlers.events[Q]?this.onMessageHandlers.emit(Q,J):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",R,J):null===(B=console.warn)||void 0===B||B.call(console,`colyseus.js: onMessage() not registered for type '${R}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(R){switch(typeof R){case"function":return`$${R._typeid}`;case"string":return R;case"number":return`i${R}`;default:throw new Error("invalid message type.")}}}J.Room=n},11893:(R,J)=>{"use strict";let B;function Q(){if(!B)try{B="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(R){}return B||(B={cache:{},setItem:function(R,J){this.cache[R]=J},getItem:function(R){this.cache[R]},removeItem:function(R){delete this.cache[R]}}),B}Object.defineProperty(J,"__esModule",{value:!0}),J.getItem=J.removeItem=J.setItem=void 0,J.setItem=function(R,J){Q().setItem(R,J)},J.removeItem=function(R){Q().removeItem(R)},J.getItem=function(R,J){const B=Q().getItem(R);"undefined"!==typeof Promise&&B instanceof Promise?B.then((R=>J(R))):J(B)}},11865:(R,J)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.createNanoEvents=void 0;J.createNanoEvents=()=>({emit(R){let J=this.events[R]||[];for(var B=arguments.length,Q=new Array(B>1?B-1:0),h=1;h<B;h++)Q[h-1]=arguments[h];for(let y=0,N=J.length;y<N;y++)J[y](...Q)},events:{},on(R,J){var B;return(null===(B=this.events[R])||void 0===B?void 0:B.push(J))||(this.events[R]=[J]),()=>{var B;this.events[R]=null===(B=this.events[R])||void 0===B?void 0:B.filter((R=>J!==R))}}})},11872:(R,J)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.createSignal=J.EventEmitter=void 0;class B{constructor(){this.handlers=[]}register(R){return this.handlers.push(R),this}invoke(){for(var R=arguments.length,J=new Array(R),B=0;B<R;B++)J[B]=arguments[B];this.handlers.forEach((R=>R.apply(this,J)))}invokeAsync(){for(var R=arguments.length,J=new Array(R),B=0;B<R;B++)J[B]=arguments[B];return Promise.all(this.handlers.map((R=>R.apply(this,J))))}remove(R){const J=this.handlers.indexOf(R);this.handlers[J]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}J.EventEmitter=B,J.createSignal=function(){const R=new B;function J(J){return R.register(J,null===this)}return J.once=J=>{const B=function(){for(var Q=arguments.length,h=new Array(Q),y=0;y<Q;y++)h[y]=arguments[y];J.apply(this,h),R.remove(B)};R.register(B)},J.remove=J=>R.remove(J),J.invoke=function(){return R.invoke(...arguments)},J.invokeAsync=function(){return R.invokeAsync(...arguments)},J.clear=()=>R.clear(),J}},11820:(R,J)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.ServerError=J.CloseCode=void 0,function(R){R[R.CONSENTED=4e3]="CONSENTED",R[R.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(J.CloseCode||(J.CloseCode={}));class B extends Error{constructor(R,J){super(J),this.name="ServerError",this.code=R}}J.ServerError=B},11800:(R,J,B)=>{"use strict";J.b=void 0,B(11803);var Q=B(11812);Object.defineProperty(J,"b",{enumerable:!0,get:function(){return Q.Client}});var h=B(11848);var y=B(11825);var N=B(11890);const r=B(11906);const q=B(11914),e=B(11856);(0,e.registerSerializer)("schema",r.SchemaSerializer),(0,e.registerSerializer)("none",q.NoneSerializer)},11803:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=R=>null!==R&&"object"===typeof R&&R.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11827:(R,J)=>{"use strict";function B(R,J){if(this._offset=J,R instanceof ArrayBuffer)this._buffer=R,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(R))throw new Error("Invalid argument");this._buffer=R.buffer,this._view=new DataView(this._buffer,R.byteOffset,R.byteLength)}}Object.defineProperty(J,"__esModule",{value:!0}),J.decode=J.encode=void 0,B.prototype._array=function(R){for(var J=new Array(R),B=0;B<R;B++)J[B]=this._parse();return J},B.prototype._map=function(R){for(var J={},B=0;B<R;B++)J[this._parse()]=this._parse();return J},B.prototype._str=function(R){var J=function(R,J,B){for(var Q="",h=0,y=J,N=J+B;y<N;y++){var r=R.getUint8(y);if(0!==(128&r))if(192!==(224&r))if(224!==(240&r)){if(240!==(248&r))throw new Error("Invalid byte "+r.toString(16));(h=(7&r)<<18|(63&R.getUint8(++y))<<12|(63&R.getUint8(++y))<<6|63&R.getUint8(++y))>=65536?(h-=65536,Q+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):Q+=String.fromCharCode(h)}else Q+=String.fromCharCode((15&r)<<12|(63&R.getUint8(++y))<<6|63&R.getUint8(++y));else Q+=String.fromCharCode((31&r)<<6|63&R.getUint8(++y));else Q+=String.fromCharCode(r)}return Q}(this._view,this._offset,R);return this._offset+=R,J},B.prototype._bin=function(R){var J=this._buffer.slice(this._offset,this._offset+R);return this._offset+=R,J},B.prototype._parse=function(){var R,J=this._view.getUint8(this._offset++),B=0,Q=0,h=0,y=0;if(J<192)return J<128?J:J<144?this._map(15&J):J<160?this._array(15&J):this._str(31&J);if(J>223)return-1*(255-J+1);switch(J){case 192:return null;case 194:return!1;case 195:return!0;case 196:return B=this._view.getUint8(this._offset),this._offset+=1,this._bin(B);case 197:return B=this._view.getUint16(this._offset),this._offset+=2,this._bin(B);case 198:return B=this._view.getUint32(this._offset),this._offset+=4,this._bin(B);case 199:if(B=this._view.getUint8(this._offset),Q=this._view.getInt8(this._offset+1),this._offset+=2,-1===Q){var N=this._view.getUint32(this._offset);return h=this._view.getInt32(this._offset+4),y=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*h+y)+N/1e6)}return[Q,this._bin(B)];case 200:return B=this._view.getUint16(this._offset),Q=this._view.getInt8(this._offset+2),this._offset+=3,[Q,this._bin(B)];case 201:return B=this._view.getUint32(this._offset),Q=this._view.getInt8(this._offset+4),this._offset+=5,[Q,this._bin(B)];case 202:return R=this._view.getFloat32(this._offset),this._offset+=4,R;case 203:return R=this._view.getFloat64(this._offset),this._offset+=8,R;case 204:return R=this._view.getUint8(this._offset),this._offset+=1,R;case 205:return R=this._view.getUint16(this._offset),this._offset+=2,R;case 206:return R=this._view.getUint32(this._offset),this._offset+=4,R;case 207:return h=this._view.getUint32(this._offset)*Math.pow(2,32),y=this._view.getUint32(this._offset+4),this._offset+=8,h+y;case 208:return R=this._view.getInt8(this._offset),this._offset+=1,R;case 209:return R=this._view.getInt16(this._offset),this._offset+=2,R;case 210:return R=this._view.getInt32(this._offset),this._offset+=4,R;case 211:return h=this._view.getInt32(this._offset)*Math.pow(2,32),y=this._view.getUint32(this._offset+4),this._offset+=8,h+y;case 212:return Q=this._view.getInt8(this._offset),this._offset+=1,0===Q?void(this._offset+=1):[Q,this._bin(1)];case 213:return Q=this._view.getInt8(this._offset),this._offset+=1,[Q,this._bin(2)];case 214:return Q=this._view.getInt8(this._offset),this._offset+=1,-1===Q?(R=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*R)):[Q,this._bin(4)];case 215:return Q=this._view.getInt8(this._offset),this._offset+=1,0===Q?(h=this._view.getInt32(this._offset)*Math.pow(2,32),y=this._view.getUint32(this._offset+4),this._offset+=8,new Date(h+y)):-1===Q?(h=this._view.getUint32(this._offset),y=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&h)+y)+(h>>>2)/1e6)):[Q,this._bin(8)];case 216:return Q=this._view.getInt8(this._offset),this._offset+=1,[Q,this._bin(16)];case 217:return B=this._view.getUint8(this._offset),this._offset+=1,this._str(B);case 218:return B=this._view.getUint16(this._offset),this._offset+=2,this._str(B);case 219:return B=this._view.getUint32(this._offset),this._offset+=4,this._str(B);case 220:return B=this._view.getUint16(this._offset),this._offset+=2,this._array(B);case 221:return B=this._view.getUint32(this._offset),this._offset+=4,this._array(B);case 222:return B=this._view.getUint16(this._offset),this._offset+=2,this._map(B);case 223:return B=this._view.getUint32(this._offset),this._offset+=4,this._map(B)}throw new Error("Could not parse")},J.decode=function(R){var J=new B(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),Q=J._parse();if(J._offset!==R.byteLength)throw new Error(R.byteLength-J._offset+" trailing bytes");return Q};function Q(R,J,B){for(var Q=0,h=0,y=B.length;h<y;h++)(Q=B.charCodeAt(h))<128?R.setUint8(J++,Q):Q<2048?(R.setUint8(J++,192|Q>>6),R.setUint8(J++,128|63&Q)):Q<55296||Q>=57344?(R.setUint8(J++,224|Q>>12),R.setUint8(J++,128|Q>>6&63),R.setUint8(J++,128|63&Q)):(h++,Q=65536+((1023&Q)<<10|1023&B.charCodeAt(h)),R.setUint8(J++,240|Q>>18),R.setUint8(J++,128|Q>>12&63),R.setUint8(J++,128|Q>>6&63),R.setUint8(J++,128|63&Q))}function h(R,J,B){var Q=typeof B,y=0,N=0,r=0,q=0,e=0,D=0;if("string"===Q){if(e=function(R){for(var J=0,B=0,Q=0,h=R.length;Q<h;Q++)(J=R.charCodeAt(Q))<128?B+=1:J<2048?B+=2:J<55296||J>=57344?B+=3:(Q++,B+=4);return B}(B),e<32)R.push(160|e),D=1;else if(e<256)R.push(217,e),D=2;else if(e<65536)R.push(218,e>>8,e),D=3;else{if(!(e<4294967296))throw new Error("String too long");R.push(219,e>>24,e>>16,e>>8,e),D=5}return J.push({_str:B,_length:e,_offset:R.length}),D+e}if("number"===Q)return Math.floor(B)===B&&isFinite(B)?B>=0?B<128?(R.push(B),1):B<256?(R.push(204,B),2):B<65536?(R.push(205,B>>8,B),3):B<4294967296?(R.push(206,B>>24,B>>16,B>>8,B),5):(r=B/Math.pow(2,32)|0,q=B>>>0,R.push(207,r>>24,r>>16,r>>8,r,q>>24,q>>16,q>>8,q),9):B>=-32?(R.push(B),1):B>=-128?(R.push(208,B),2):B>=-32768?(R.push(209,B>>8,B),3):B>=-2147483648?(R.push(210,B>>24,B>>16,B>>8,B),5):(r=Math.floor(B/Math.pow(2,32)),q=B>>>0,R.push(211,r>>24,r>>16,r>>8,r,q>>24,q>>16,q>>8,q),9):(R.push(203),J.push({_float:B,_length:8,_offset:R.length}),9);if("object"===Q){if(null===B)return R.push(192),1;if(Array.isArray(B)){if((e=B.length)<16)R.push(144|e),D=1;else if(e<65536)R.push(220,e>>8,e),D=3;else{if(!(e<4294967296))throw new Error("Array too large");R.push(221,e>>24,e>>16,e>>8,e),D=5}for(y=0;y<e;y++)D+=h(R,J,B[y]);return D}if(B instanceof Date){var l=B.getTime(),E=Math.floor(l/1e3),O=1e6*(l-1e3*E);return E>=0&&O>=0&&E<=17179869183?0===O&&E<=4294967295?(R.push(214,255,E>>24,E>>16,E>>8,E),6):(r=E/4294967296,q=4294967295&E,R.push(215,255,O>>22,O>>14,O>>6,r,q>>24,q>>16,q>>8,q),10):(r=Math.floor(E/4294967296),q=E>>>0,R.push(199,12,255,O>>24,O>>16,O>>8,O,r>>24,r>>16,r>>8,r,q>>24,q>>16,q>>8,q),15)}if(B instanceof ArrayBuffer){if((e=B.byteLength)<256)R.push(196,e),D=2;else if(e<65536)R.push(197,e>>8,e),D=3;else{if(!(e<4294967296))throw new Error("Buffer too large");R.push(198,e>>24,e>>16,e>>8,e),D=5}return J.push({_bin:B,_length:e,_offset:R.length}),D+e}if("function"===typeof B.toJSON)return h(R,J,B.toJSON());var n=[],P="",A=Object.keys(B);for(y=0,N=A.length;y<N;y++)void 0!==B[P=A[y]]&&"function"!==typeof B[P]&&n.push(P);if((e=n.length)<16)R.push(128|e),D=1;else if(e<65536)R.push(222,e>>8,e),D=3;else{if(!(e<4294967296))throw new Error("Object too large");R.push(223,e>>24,e>>16,e>>8,e),D=5}for(y=0;y<e;y++)D+=h(R,J,P=n[y]),D+=h(R,J,B[P]);return D}if("boolean"===Q)return R.push(B?195:194),1;if("undefined"===Q)return R.push(192),1;if("function"===typeof B.toJSON)return h(R,J,B.toJSON());throw new Error("Could not encode")}J.encode=function(R){var J=[],B=[],y=h(J,B,R),N=new ArrayBuffer(y),r=new DataView(N),q=0,e=0,D=-1;B.length>0&&(D=B[0]._offset);for(var l,E=0,O=0,n=0,P=J.length;n<P;n++)if(r.setUint8(e+n,J[n]),n+1===D){if(E=(l=B[q])._length,O=e+D,l._bin)for(var A=new Uint8Array(l._bin),u=0;u<E;u++)r.setUint8(O+u,A[u]);else l._str?Q(r,O,l._str):void 0!==l._float&&r.setFloat64(O,l._float);e+=E,B[++q]&&(D=B[q]._offset)}return N}},11914:(R,J)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.NoneSerializer=void 0;J.NoneSerializer=class{setState(R){}getState(){return null}patch(R){}teardown(){}handshake(R){}}},11906:(R,J,B)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.SchemaSerializer=void 0;const Q=B(11879);J.SchemaSerializer=class{setState(R){return this.state.decode(R)}getState(){return this.state}patch(R){return this.state.decode(R)}teardown(){var R,J;null===(J=null===(R=this.state)||void 0===R?void 0:R.$changes)||void 0===J||J.root.clearRefs()}handshake(R,J){if(this.state){(new Q.Reflection).decode(R,J)}else this.state=Q.Reflection.decode(R,J)}}},11856:(R,J)=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.getSerializer=J.registerSerializer=void 0;const B={};J.registerSerializer=function(R,J){B[R]=J},J.getSerializer=function(R){const J=B[R];if(!J)throw new Error("missing serializer: "+R);return J}},11838:function(R,J,B){"use strict";var Q=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(J,"__esModule",{value:!0}),J.WebSocketTransport=void 0;const h=Q(B(11846)),y=globalThis.WebSocket||h.default;J.WebSocketTransport=class{constructor(R){this.events=R}send(R){R instanceof ArrayBuffer?this.ws.send(R):Array.isArray(R)&&this.ws.send(new Uint8Array(R).buffer)}connect(R,J){try{this.ws=new y(R,{headers:J,protocols:this.protocols})}catch(B){this.ws=new y(R,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(R,J){this.ws.close(R,J)}get isOpen(){return this.ws.readyState===y.OPEN}}},11846:R=>{"use strict";R.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12288:R=>{"use strict";R.exports=function(R){for(var J=new Array(R),B=0;B<R;++B)J[B]=B;return J}},12293:R=>{function J(R){return!!R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}R.exports=function(R){return null!=R&&(J(R)||function(R){return"function"===typeof R.readFloatLE&&"function"===typeof R.slice&&J(R.slice(0,0))}(R)||!!R._isBuffer)}},12281:(R,J,B)=>{var Q=B(12288),h=B(12293),y="undefined"!==typeof Float64Array;function N(R,J){return R[0]-J[0]}function r(){var R,J=this.stride,B=new Array(J.length);for(R=0;R<B.length;++R)B[R]=[Math.abs(J[R]),R];B.sort(N);var Q=new Array(B.length);for(R=0;R<Q.length;++R)Q[R]=B[R][1];return Q}function q(R,J){var B=["View",J,"d",R].join("");J<0&&(B="View_Nil"+R);var h="generic"===R;if(-1===J){var y="function "+B+"(a){this.data=a;};var proto="+B+".prototype;proto.dtype='"+R+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+B+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+B+"(a){return new "+B+"(a);}";return new Function(y)()}if(0===J){y="function "+B+"(a,d) {this.data = a;this.offset = d};var proto="+B+".prototype;proto.dtype='"+R+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+B+"_copy() {return new "+B+"(this.data,this.offset)};proto.pick=function "+B+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+B+"_get(){return "+(h?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+B+"_set(v){return "+(h?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+B+"(a,b,c,d){return new "+B+"(a,d)}";return new Function("TrivialArray",y)(e[R][0])}y=["'use strict'"];var N=Q(J),q=N.map((function(R){return"i"+R})),D="this.offset+"+N.map((function(R){return"this.stride["+R+"]*i"+R})).join("+"),l=N.map((function(R){return"b"+R})).join(","),E=N.map((function(R){return"c"+R})).join(",");y.push("function "+B+"(a,"+l+","+E+",d){this.data=a","this.shape=["+l+"]","this.stride=["+E+"]","this.offset=d|0}","var proto="+B+".prototype","proto.dtype='"+R+"'","proto.dimension="+J),y.push("Object.defineProperty(proto,'size',{get:function "+B+"_size(){return "+N.map((function(R){return"this.shape["+R+"]"})).join("*"),"}})"),1===J?y.push("proto.order=[0]"):(y.push("Object.defineProperty(proto,'order',{get:"),J<4?(y.push("function "+B+"_order(){"),2===J?y.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===J&&y.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):y.push("ORDER})")),y.push("proto.set=function "+B+"_set("+q.join(",")+",v){"),h?y.push("return this.data.set("+D+",v)}"):y.push("return this.data["+D+"]=v}"),y.push("proto.get=function "+B+"_get("+q.join(",")+"){"),h?y.push("return this.data.get("+D+")}"):y.push("return this.data["+D+"]}"),y.push("proto.index=function "+B+"_index(",q.join(),"){return "+D+"}"),y.push("proto.hi=function "+B+"_hi("+q.join(",")+"){return new "+B+"(this.data,"+N.map((function(R){return["(typeof i",R,"!=='number'||i",R,"<0)?this.shape[",R,"]:i",R,"|0"].join("")})).join(",")+","+N.map((function(R){return"this.stride["+R+"]"})).join(",")+",this.offset)}");var O=N.map((function(R){return"a"+R+"=this.shape["+R+"]"})),n=N.map((function(R){return"c"+R+"=this.stride["+R+"]"}));y.push("proto.lo=function "+B+"_lo("+q.join(",")+"){var b=this.offset,d=0,"+O.join(",")+","+n.join(","));for(var P=0;P<J;++P)y.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");y.push("return new "+B+"(this.data,"+N.map((function(R){return"a"+R})).join(",")+","+N.map((function(R){return"c"+R})).join(",")+",b)}"),y.push("proto.step=function "+B+"_step("+q.join(",")+"){var "+N.map((function(R){return"a"+R+"=this.shape["+R+"]"})).join(",")+","+N.map((function(R){return"b"+R+"=this.stride["+R+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<J;++P)y.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");y.push("return new "+B+"(this.data,"+N.map((function(R){return"a"+R})).join(",")+","+N.map((function(R){return"b"+R})).join(",")+",c)}");var A=new Array(J),u=new Array(J);for(P=0;P<J;++P)A[P]="a[i"+P+"]",u[P]="b[i"+P+"]";y.push("proto.transpose=function "+B+"_transpose("+q+"){"+q.map((function(R,J){return R+"=("+R+"===undefined?"+J+":"+R+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+B+"(this.data,"+A.join(",")+","+u.join(",")+",this.offset)}"),y.push("proto.pick=function "+B+"_pick("+q+"){var a=[],b=[],c=this.offset");for(P=0;P<J;++P)y.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return y.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),y.push("return function construct_"+B+"(data,shape,stride,offset){return new "+B+"(data,"+N.map((function(R){return"shape["+R+"]"})).join(",")+","+N.map((function(R){return"stride["+R+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",y.join("\n"))(e[R],r)}var e={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};R.exports=function(R,J,B,Q){if(void 0===R)return(0,e.array[0])([]);"number"===typeof R&&(R=[R]),void 0===J&&(J=[R.length]);var N=J.length;if(void 0===B){B=new Array(N);for(var r=N-1,D=1;r>=0;--r)B[r]=D,D*=J[r]}if(void 0===Q){Q=0;for(r=0;r<N;++r)B[r]<0&&(Q-=(J[r]-1)*B[r])}for(var l=function(R){if(h(R))return"buffer";if(y)switch(Object.prototype.toString.call(R)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(R)?"array":"generic"}(R),E=e[l];E.length<=N+1;)E.push(q(l,E.length-1));return(0,E[N+1])(R,J,B,Q)}},13291:R=>{var J;self,J=()=>(()=>{"use strict";var R={d:(J,B)=>{for(var Q in B)R.o(B,Q)&&!R.o(J,Q)&&Object.defineProperty(J,Q,{enumerable:!0,get:B[Q]})},o:(R,J)=>Object.prototype.hasOwnProperty.call(R,J)},J={};R.d(J,{default:()=>i});var B,Q=function(R,J){var B=J.x-R.x,Q=J.y-R.y;return Math.sqrt(B*B+Q*Q)},h=function(R){return R*(Math.PI/180)},y=new Map,N=function(R){y.has(R)&&clearTimeout(y.get(R)),y.set(R,setTimeout(R,100))},r=function(R,J,B){for(var Q,h=J.split(/[ ,]+/g),y=0;y<h.length;y+=1)Q=h[y],R.addEventListener?R.addEventListener(Q,B,!1):R.attachEvent&&R.attachEvent(Q,B)},q=function(R,J,B){for(var Q,h=J.split(/[ ,]+/g),y=0;y<h.length;y+=1)Q=h[y],R.removeEventListener?R.removeEventListener(Q,B):R.detachEvent&&R.detachEvent(Q,B)},e=function(R){return R.preventDefault(),R.type.match(/^touch/)?R.changedTouches:R},D=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},l=function(R,J){J.top||J.right||J.bottom||J.left?(R.style.top=J.top,R.style.right=J.right,R.style.bottom=J.bottom,R.style.left=J.left):(R.style.left=J.x+"px",R.style.top=J.y+"px")},E=function(R,J,B){var Q=O(R);for(var h in Q)if(Q.hasOwnProperty(h))if("string"==typeof J)Q[h]=J+" "+B;else{for(var y="",N=0,r=J.length;N<r;N+=1)y+=J[N]+" "+B+", ";Q[h]=y.slice(0,-2)}return Q},O=function(R){var J={};return J[R]="",["webkit","Moz","o"].forEach((function(B){J[B+R.charAt(0).toUpperCase()+R.slice(1)]=""})),J},n=function(R,J){for(var B in J)J.hasOwnProperty(B)&&(R[B]=J[B]);return R},P=function(R,J){if(R.length)for(var B=0,Q=R.length;B<Q;B+=1)J(R[B]);else J(R)},A="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,u=window.matchMedia("(any-hover: none)").matches,S=!!("ontouchstart"in window),f=!!window.PointerEvent,a=!!window.MSPointerEvent,s={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},x={start:"mousedown",move:"mousemove",end:"mouseup"},I={};function V(){}A&&!u?B=s:f?B={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:a?B={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:S?(B=s,I=x):B=x,V.prototype.on=function(R,J){var B,Q=this,h=R.split(/[ ,]+/g);Q._handlers_=Q._handlers_||{};for(var y=0;y<h.length;y+=1)B=h[y],Q._handlers_[B]=Q._handlers_[B]||[],Q._handlers_[B].push(J);return Q},V.prototype.off=function(R,J){var B=this;return B._handlers_=B._handlers_||{},void 0===R?B._handlers_={}:void 0===J?B._handlers_[R]=null:B._handlers_[R]&&B._handlers_[R].indexOf(J)>=0&&B._handlers_[R].splice(B._handlers_[R].indexOf(J),1),B},V.prototype.trigger=function(R,J){var B,Q=this,h=R.split(/[ ,]+/g);Q._handlers_=Q._handlers_||{};for(var y=0;y<h.length;y+=1)B=h[y],Q._handlers_[B]&&Q._handlers_[B].length&&Q._handlers_[B].forEach((function(R){R.call(Q,{type:B,target:Q},J)}))},V.prototype.config=function(R){var J=this;J.options=J.defaults||{},R&&(J.options=function(R,J){var B={};for(var Q in R)R.hasOwnProperty(Q)&&J.hasOwnProperty(Q)?B[Q]=J[Q]:R.hasOwnProperty(Q)&&(B[Q]=R[Q]);return B}(J.options,R))},V.prototype.bindEvt=function(R,J){var Q=this;return Q._domHandlers_=Q._domHandlers_||{},Q._domHandlers_[J]=function(){"function"==typeof Q["on"+J]?Q["on"+J].apply(Q,arguments):console.warn('[WARNING] : Missing "on'+J+'" handler.')},r(R,B[J],Q._domHandlers_[J]),I[J]&&r(R,I[J],Q._domHandlers_[J]),Q},V.prototype.unbindEvt=function(R,J){var Q=this;return Q._domHandlers_=Q._domHandlers_||{},q(R,B[J],Q._domHandlers_[J]),I[J]&&q(R,I[J],Q._domHandlers_[J]),delete Q._domHandlers_[J],this};const M=V;function H(R,J){return this.identifier=J.identifier,this.position=J.position,this.frontPosition=J.frontPosition,this.collection=R,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(J),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=H.id,H.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}H.prototype=new M,H.constructor=H,H.id=0,H.prototype.buildEl=function(R){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},H.prototype.stylize=function(){if(this.options.dataOnly)return this;var R=this.options.fadeTime+"ms",J=function(){var R=O("borderRadius");for(var J in R)R.hasOwnProperty(J)&&(R[J]="50%");return R}(),B=E("transition","opacity",R),Q={};return Q.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},Q.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},Q.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},n(Q.el,B),"circle"===this.options.shape&&n(Q.back,J),n(Q.front,J),this.applyStyles(Q),this},H.prototype.applyStyles=function(R){for(var J in this.ui)if(this.ui.hasOwnProperty(J))for(var B in R[J])this.ui[J].style[B]=R[J][B];return this},H.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},H.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},H.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},H.prototype.show=function(R){var J=this;return J.options.dataOnly||(clearTimeout(J.removeTimeout),clearTimeout(J.showTimeout),clearTimeout(J.restTimeout),J.addToDom(),J.restCallback(),setTimeout((function(){J.ui.el.style.opacity=1}),0),J.showTimeout=setTimeout((function(){J.trigger("shown",J.instance),"function"==typeof R&&R.call(this)}),J.options.fadeTime)),J},H.prototype.hide=function(R){var J=this;if(J.options.dataOnly)return J;if(J.ui.el.style.opacity=J.options.restOpacity,clearTimeout(J.removeTimeout),clearTimeout(J.showTimeout),clearTimeout(J.restTimeout),J.removeTimeout=setTimeout((function(){var B="dynamic"===J.options.mode?"none":"block";J.ui.el.style.display=B,"function"==typeof R&&R.call(J),J.trigger("hidden",J.instance)}),J.options.fadeTime),J.options.restJoystick){var B=J.options.restJoystick,Q={};Q.x=!0===B||!1!==B.x?0:J.instance.frontPosition.x,Q.y=!0===B||!1!==B.y?0:J.instance.frontPosition.y,J.setPosition(R,Q)}return J},H.prototype.setPosition=function(R,J){var B=this;B.frontPosition={x:J.x,y:J.y};var Q=B.options.fadeTime+"ms",h={};h.front=E("transition",["transform"],Q);var y={front:{}};y.front={transform:"translate("+B.frontPosition.x+"px,"+B.frontPosition.y+"px)"},B.applyStyles(h),B.applyStyles(y),B.restTimeout=setTimeout((function(){"function"==typeof R&&R.call(B),B.restCallback()}),B.options.fadeTime)},H.prototype.restCallback=function(){var R=this,J={};J.front=E("transition","none",""),R.applyStyles(J),R.trigger("rested",R.instance)},H.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},H.prototype.computeDirection=function(R){var J,B,Q,h=R.angle.radian,y=Math.PI/4,N=Math.PI/2;if(h>y&&h<3*y&&!R.lockX?J="up":h>-y&&h<=y&&!R.lockY?J="left":h>3*-y&&h<=-y&&!R.lockX?J="down":R.lockY||(J="right"),R.lockY||(B=h>-N&&h<N?"left":"right"),R.lockX||(Q=h>0?"up":"down"),R.force>this.options.threshold){var r,q={};for(r in this.direction)this.direction.hasOwnProperty(r)&&(q[r]=this.direction[r]);var e={};for(r in this.direction={x:B,y:Q,angle:J},R.direction=this.direction,q)q[r]===this.direction[r]&&(e[r]=!0);if(e.x&&e.y&&e.angle)return R;e.x&&e.y||this.trigger("plain",R),e.x||this.trigger("plain:"+B,R),e.y||this.trigger("plain:"+Q,R),e.angle||this.trigger("dir dir:"+J,R)}else this.resetDirection();return R};const d=H;function X(R,J){var B=this;B.nipples=[],B.idles=[],B.actives=[],B.ids=[],B.pressureIntervals={},B.manager=R,B.id=X.id,X.id+=1,B.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},B.config(J),"static"!==B.options.mode&&"semi"!==B.options.mode||(B.options.multitouch=!1),B.options.multitouch||(B.options.maxNumberOfNipples=1);var Q=getComputedStyle(B.options.zone.parentElement);return Q&&"flex"===Q.display&&(B.parentIsFlex=!0),B.updateBox(),B.prepareNipples(),B.aE(),B.begin(),B.nipples}X.prototype=new M,X.constructor=X,X.id=0,X.prototype.prepareNipples=function(){var R=this,J=R.nipples;J.on=R.on.bind(R),J.off=R.off.bind(R),J.options=R.options,J.destroy=R.destroy.bind(R),J.ids=R.ids,J.id=R.id,J.processOnMove=R.processOnMove.bind(R),J.processOnEnd=R.processOnEnd.bind(R),J.get=function(R){if(void 0===R)return J[0];for(var B=0,Q=J.length;B<Q;B+=1)if(J[B].identifier===R)return J[B];return!1}},X.prototype.aE=function(){var R=this;R.bindEvt(R.options.zone,"start"),R.options.zone.style.touchAction="none",R.options.zone.style.msTouchAction="none"},X.prototype.begin=function(){var R=this,J=R.options;if("static"===J.mode){var B=R.createNipple(J.position,R.manager.getIdentifier());B.add(),R.idles.push(B)}},X.prototype.createNipple=function(R,J){var B=this,Q=B.manager.scroll,h={},y=B.options,N=B.parentIsFlex?Q.x:Q.x+B.box.left,r=B.parentIsFlex?Q.y:Q.y+B.box.top;if(R.x&&R.y)h={x:R.x-N,y:R.y-r};else if(R.top||R.right||R.bottom||R.left){var q=document.createElement("DIV");q.style.display="hidden",q.style.top=R.top,q.style.right=R.right,q.style.bottom=R.bottom,q.style.left=R.left,q.style.position="absolute",y.zone.appendChild(q);var e=q.getBoundingClientRect();y.zone.removeChild(q),h=R,R={x:e.left+Q.x,y:e.top+Q.y}}var D=new d(B,{color:y.color,size:y.size,threshold:y.threshold,fadeTime:y.fadeTime,dataOnly:y.dataOnly,restJoystick:y.restJoystick,restOpacity:y.restOpacity,mode:y.mode,identifier:J,position:R,zone:y.zone,frontPosition:{x:0,y:0},shape:y.shape});return y.dataOnly||(l(D.ui.el,h),l(D.ui.front,D.frontPosition)),B.nipples.push(D),B.trigger("added "+D.identifier+":added",D),B.manager.trigger("added "+D.identifier+":added",D),B.bindNipple(D),D},X.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},X.prototype.bindNipple=function(R){var J,B=this,Q=function(R,Q){J=R.type+" "+Q.id+":"+R.type,B.trigger(J,Q)};R.on("destroyed",B.onDestroyed.bind(B)),R.on("shown hidden rested dir plain",Q),R.on("dir:up dir:right dir:down dir:left",Q),R.on("plain:up plain:right plain:down plain:left",Q)},X.prototype.pressureFn=function(R,J,B){var Q=this,h=0;clearInterval(Q.pressureIntervals[B]),Q.pressureIntervals[B]=setInterval(function(){var B=R.force||R.pressure||R.webkitForce||0;B!==h&&(J.trigger("pressure",B),Q.trigger("pressure "+J.identifier+":pressure",B),h=B)}.bind(Q),100)},X.prototype.onstart=function(R){var J=this,B=J.options,Q=R;return R=e(R),J.updateBox(),P(R,(function(h){J.actives.length<B.maxNumberOfNipples?J.processOnStart(h):Q.type.match(/^touch/)&&(Object.keys(J.manager.ids).forEach((function(B){if(Object.values(Q.touches).findIndex((function(R){return R.identifier===B}))<0){var h=[R[0]];h.identifier=B,J.processOnEnd(h)}})),J.actives.length<B.maxNumberOfNipples&&J.processOnStart(h))})),J.manager.bindDocument(),!1},X.prototype.processOnStart=function(R){var J,B=this,h=B.options,y=B.manager.getIdentifier(R),N=R.force||R.pressure||R.webkitForce||0,r={x:R.pageX,y:R.pageY},q=B.getOrCreate(y,r);q.identifier!==y&&B.manager.removeIdentifier(q.identifier),q.identifier=y;var e=function(J){J.trigger("start",J),B.trigger("start "+J.id+":start",J),J.show(),N>0&&B.pressureFn(R,J,J.identifier),B.processOnMove(R)};if((J=B.idles.indexOf(q))>=0&&B.idles.splice(J,1),B.actives.push(q),B.ids.push(q.identifier),"semi"!==h.mode)e(q);else{if(!(Q(r,q.position)<=h.catchDistance))return q.destroy(),void B.processOnStart(R);e(q)}return q},X.prototype.getOrCreate=function(R,J){var B,Q=this,h=Q.options;return/(semi|static)/.test(h.mode)?(B=Q.idles[0])?(Q.idles.splice(0,1),B):"semi"===h.mode?Q.createNipple(J,R):(console.warn("Coudln't find the needed nipple."),!1):B=Q.createNipple(J,R)},X.prototype.processOnMove=function(R){var J=this,B=J.options,y=J.manager.getIdentifier(R),N=J.nipples.get(y),r=J.manager.scroll;if(function(R){return isNaN(R.buttons)?0!==R.pressure:0!==R.buttons}(R)){if(!N)return console.error("Found zombie joystick with ID "+y),void J.manager.removeIdentifier(y);if(B.dynamicPage){var q=N.el.getBoundingClientRect();N.position={x:r.x+q.left,y:r.y+q.top}}N.identifier=y;var e=N.options.size/2,D={x:R.pageX,y:R.pageY};B.lockX&&(D.y=N.position.y),B.lockY&&(D.x=N.position.x);var l,E,O,n,P,A,u,S,f,a,s=Q(D,N.position),x=(l=D,O=(E=N.position).x-l.x,n=E.y-l.y,function(R){return R*(180/Math.PI)}(Math.atan2(n,O))),I=h(x),V=s/e,M={distance:s,position:D};if("circle"===N.options.shape?(P=Math.min(s,e),u=N.position,S=P,a={x:0,y:0},f=h(f=x),a.x=u.x-S*Math.cos(f),a.y=u.y-S*Math.sin(f),A=a):(A=function(R,J,B){return{x:Math.min(Math.max(R.x,J.x-B),J.x+B),y:Math.min(Math.max(R.y,J.y-B),J.y+B)}}(D,N.position,e),P=Q(A,N.position)),B.follow){if(s>e){var H=D.x-A.x,d=D.y-A.y;N.position.x+=H,N.position.y+=d,N.el.style.top=N.position.y-(J.box.top+r.y)+"px",N.el.style.left=N.position.x-(J.box.left+r.x)+"px",s=Q(D,N.position)}}else D=A,s=P;var X=D.x-N.position.x,c=D.y-N.position.y;N.frontPosition={x:X,y:c},B.dataOnly||(N.ui.front.style.transform="translate("+X+"px,"+c+"px)");var z={identifier:N.identifier,position:D,force:V,pressure:R.force||R.pressure||R.webkitForce||0,distance:s,angle:{radian:I,degree:x},vector:{x:X/e,y:-c/e},raw:M,instance:N,lockX:B.lockX,lockY:B.lockY};(z=N.computeDirection(z)).angle={radian:h(180-x),degree:180-x},N.trigger("move",z),J.trigger("move "+N.id+":move",z)}else this.processOnEnd(R)},X.prototype.processOnEnd=function(R){var J=this,B=J.options,Q=J.manager.getIdentifier(R),h=J.nipples.get(Q),y=J.manager.removeIdentifier(h.identifier);h&&(B.dataOnly||h.hide((function(){"dynamic"===B.mode&&(h.trigger("removed",h),J.trigger("removed "+h.id+":removed",h),J.manager.trigger("removed "+h.id+":removed",h),h.destroy())})),clearInterval(J.pressureIntervals[h.identifier]),h.resetDirection(),h.trigger("end",h),J.trigger("end "+h.id+":end",h),J.ids.indexOf(h.identifier)>=0&&J.ids.splice(J.ids.indexOf(h.identifier),1),J.actives.indexOf(h)>=0&&J.actives.splice(J.actives.indexOf(h),1),/(semi|static)/.test(B.mode)?J.idles.push(h):J.nipples.indexOf(h)>=0&&J.nipples.splice(J.nipples.indexOf(h),1),J.manager.unbindDocument(),/(semi|static)/.test(B.mode)&&(J.manager.ids[y.id]=y.identifier))},X.prototype.onDestroyed=function(R,J){var B=this;B.nipples.indexOf(J)>=0&&B.nipples.splice(B.nipples.indexOf(J),1),B.actives.indexOf(J)>=0&&B.actives.splice(B.actives.indexOf(J),1),B.idles.indexOf(J)>=0&&B.idles.splice(B.idles.indexOf(J),1),B.ids.indexOf(J.identifier)>=0&&B.ids.splice(B.ids.indexOf(J.identifier),1),B.manager.removeIdentifier(J.identifier),B.manager.unbindDocument()},X.prototype.destroy=function(){var R=this;for(var J in R.unbindEvt(R.options.zone,"start"),R.nipples.forEach((function(R){R.destroy()})),R.pressureIntervals)R.pressureIntervals.hasOwnProperty(J)&&clearInterval(R.pressureIntervals[J]);R.trigger("destroyed",R.nipples),R.manager.unbindDocument(),R.off()};const c=X;function z(R){var J=this;J.ids={},J.index=0,J.collections=[],J.scroll=D(),J.config(R),J.prepareCollections();var B=function(){var R;J.collections.forEach((function(B){B.forEach((function(B){R=B.el.getBoundingClientRect(),B.position={x:J.scroll.x+R.left,y:J.scroll.y+R.top}}))}))};r(window,"resize",(function(){N(B)}));var Q=function(){J.scroll=D()};return r(window,"scroll",(function(){N(Q)})),J.collections}z.prototype=new M,z.constructor=z,z.prototype.prepareCollections=function(){var R=this;R.collections.create=R.create.bind(R),R.collections.on=R.on.bind(R),R.collections.off=R.off.bind(R),R.collections.destroy=R.destroy.bind(R),R.collections.get=function(J){var B;return R.collections.every((function(R){return!(B=R.get(J))})),B}},z.prototype.create=function(R){return this.createCollection(R)},z.prototype.createCollection=function(R){var J=this,B=new c(J,R);return J.bindCollection(B),J.collections.push(B),B},z.prototype.bindCollection=function(R){var J,B=this,Q=function(R,Q){J=R.type+" "+Q.id+":"+R.type,B.trigger(J,Q)};R.on("destroyed",B.onDestroyed.bind(B)),R.on("shown hidden rested dir plain",Q),R.on("dir:up dir:right dir:down dir:left",Q),R.on("plain:up plain:right plain:down plain:left",Q)},z.prototype.bindDocument=function(){var R=this;R.binded||(R.bindEvt(document,"move").bindEvt(document,"end"),R.binded=!0)},z.prototype.unbindDocument=function(R){var J=this;Object.keys(J.ids).length&&!0!==R||(J.unbindEvt(document,"move").unbindEvt(document,"end"),J.binded=!1)},z.prototype.getIdentifier=function(R){var J;return R?void 0===(J=void 0===R.identifier?R.pointerId:R.identifier)&&(J=this.latest||0):J=this.index,void 0===this.ids[J]&&(this.ids[J]=this.index,this.index+=1),this.latest=J,this.ids[J]},z.prototype.removeIdentifier=function(R){var J={};for(var B in this.ids)if(this.ids[B]===R){J.id=B,J.identifier=this.ids[B],delete this.ids[B];break}return J},z.prototype.onmove=function(R){return this.onAny("move",R),!1},z.prototype.onend=function(R){return this.onAny("end",R),!1},z.prototype.oncancel=function(R){return this.onAny("end",R),!1},z.prototype.onAny=function(R,J){var B,Q=this,h="processOn"+R.charAt(0).toUpperCase()+R.slice(1);J=e(J);var y=function(R,J,B){B.ids.indexOf(J)>=0&&(B[h](R),R._found_=!0)};return P(J,(function(R){B=Q.getIdentifier(R),P(Q.collections,y.bind(null,R,B)),R._found_||Q.removeIdentifier(B)})),!1},z.prototype.destroy=function(){var R=this;R.unbindDocument(!0),R.ids={},R.index=0,R.collections.forEach((function(R){R.destroy()})),R.off()},z.prototype.onDestroyed=function(R,J){var B=this;if(B.collections.indexOf(J)<0)return!1;B.collections.splice(B.collections.indexOf(J),1)};var p=new z;const i={create:function(R){return p.create(R)},factory:p};return J.default})(),R.exports=J()},12306:(R,J,B)=>{"use strict";const{Deflate:Q,deflate:h,deflateRaw:y,gzip:N}=B(12314),{Inflate:r,inflate:q,inflateRaw:e,ungzip:D}=B(12369),l=B(12346);R.exports.Deflate=Q,R.exports.deflate=h,R.exports.deflateRaw=y,R.exports.gzip=N,R.exports.Inflate=r,R.exports.inflate=q,R.exports.inflateRaw=e,R.exports.ungzip=D,R.exports.constants=l},12314:(R,J,B)=>{"use strict";const Q=B(12321),h=B(12348),y=B(12356),N=B(12344),r=B(12365),q=Object.prototype.toString,{Z_NO_FLUSH:e,Z_SYNC_FLUSH:D,Z_FULL_FLUSH:l,Z_FINISH:E,Z_OK:O,Z_STREAM_END:n,Z_DEFAULT_COMPRESSION:P,Z_DEFAULT_STRATEGY:A,Z_DEFLATED:u}=B(12346);function S(R){this.options=h.assign({level:P,method:u,gR:16384,windowBits:15,memLevel:8,strategy:A},R||{});let J=this.options;J.raw&&J.windowBits>0?J.windowBits=-J.windowBits:J.gzip&&J.windowBits>0&&J.windowBits<16&&(J.windowBits+=16),this.err=0,this.eJ="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let B=Q.deflateInit2(this.strm,J.level,J.method,J.windowBits,J.memLevel,J.strategy);if(B!==O)throw new Error(N[B]);if(J.header&&Q.deflateSetHeader(this.strm,J.header),J.dictionary){let R;if(R="string"===typeof J.dictionary?y.string2buf(J.dictionary):"[object ArrayBuffer]"===q.call(J.dictionary)?new Uint8Array(J.dictionary):J.dictionary,B=Q.deflateSetDictionary(this.strm,R),B!==O)throw new Error(N[B]);this._dict_set=!0}}function f(R,J){const B=new S(J);if(B.push(R,!0),B.err)throw B.eJ||N[B.err];return B.result}S.prototype.push=function(R,J){const B=this.strm,h=this.options.gR;let N,r;if(this.ended)return!1;for(r=J===~~J?J:!0===J?E:e,"string"===typeof R?B.input=y.string2buf(R):"[object ArrayBuffer]"===q.call(R)?B.input=new Uint8Array(R):B.input=R,B.next_in=0,B.avail_in=B.input.length;;)if(0===B.avail_out&&(B.output=new Uint8Array(h),B.next_out=0,B.avail_out=h),(r===D||r===l)&&B.avail_out<=6)this.onData(B.output.subarray(0,B.next_out)),B.avail_out=0;else{if(N=Q.deflate(B,r),N===n)return B.next_out>0&&this.onData(B.output.subarray(0,B.next_out)),N=Q.deflateEnd(this.strm),this.onEnd(N),this.ended=!0,N===O;if(0!==B.avail_out){if(r>0&&B.next_out>0)this.onData(B.output.subarray(0,B.next_out)),B.avail_out=0;else if(0===B.avail_in)break}else this.onData(B.output)}return!0},S.prototype.onData=function(R){this.chunks.push(R)},S.prototype.onEnd=function(R){R===O&&(this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.eJ=this.strm.eJ},R.exports.Deflate=S,R.exports.deflate=f,R.exports.deflateRaw=function(R,J){return(J=J||{}).raw=!0,f(R,J)},R.exports.gzip=function(R,J){return(J=J||{}).gzip=!0,f(R,J)},R.exports.constants=B(12346)},12369:(R,J,B)=>{"use strict";const Q=B(12375),h=B(12348),y=B(12356),N=B(12344),r=B(12365),q=B(12390),e=Object.prototype.toString,{Z_NO_FLUSH:D,Z_FINISH:l,Z_OK:E,Z_STREAM_END:O,Z_NEED_DICT:n,Z_STREAM_ERROR:P,Z_DATA_ERROR:A,Z_MEM_ERROR:u}=B(12346);function S(R){this.options=h.assign({gR:65536,windowBits:15,to:""},R||{});const J=this.options;J.raw&&J.windowBits>=0&&J.windowBits<16&&(J.windowBits=-J.windowBits,0===J.windowBits&&(J.windowBits=-15)),!(J.windowBits>=0&&J.windowBits<16)||R&&R.windowBits||(J.windowBits+=32),J.windowBits>15&&J.windowBits<48&&0===(15&J.windowBits)&&(J.windowBits|=15),this.err=0,this.eJ="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let B=Q.inflateInit2(this.strm,J.windowBits);if(B!==E)throw new Error(N[B]);if(this.header=new q,Q.inflateGetHeader(this.strm,this.header),J.dictionary&&("string"===typeof J.dictionary?J.dictionary=y.string2buf(J.dictionary):"[object ArrayBuffer]"===e.call(J.dictionary)&&(J.dictionary=new Uint8Array(J.dictionary)),J.raw&&(B=Q.inflateSetDictionary(this.strm,J.dictionary),B!==E)))throw new Error(N[B])}function f(R,J){const B=new S(J);if(B.push(R),B.err)throw B.eJ||N[B.err];return B.result}S.prototype.push=function(R,J){const B=this.strm,h=this.options.gR,N=this.options.dictionary;let r,q,S;if(this.ended)return!1;for(q=J===~~J?J:!0===J?l:D,"[object ArrayBuffer]"===e.call(R)?B.input=new Uint8Array(R):B.input=R,B.next_in=0,B.avail_in=B.input.length;;){for(0===B.avail_out&&(B.output=new Uint8Array(h),B.next_out=0,B.avail_out=h),r=Q.inflate(B,q),r===n&&N&&(r=Q.inflateSetDictionary(B,N),r===E?r=Q.inflate(B,q):r===A&&(r=n));B.avail_in>0&&r===O&&B.state.wrap>0&&0!==R[B.next_in];)Q.inflateReset(B),r=Q.inflate(B,q);switch(r){case P:case A:case n:case u:return this.onEnd(r),this.ended=!0,!1}if(S=B.avail_out,B.next_out&&(0===B.avail_out||r===O))if("string"===this.options.to){let R=y.utf8border(B.output,B.next_out),J=B.next_out-R,Q=y.buf2string(B.output,R);B.next_out=J,B.avail_out=h-J,J&&B.output.set(B.output.subarray(R,R+J),0),this.onData(Q)}else this.onData(B.output.length===B.next_out?B.output:B.output.subarray(0,B.next_out));if(r!==E||0!==S){if(r===O)return r=Q.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===B.avail_in)break}}return!0},S.prototype.onData=function(R){this.chunks.push(R)},S.prototype.onEnd=function(R){R===E&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.eJ=this.strm.eJ},R.exports.Inflate=S,R.exports.inflate=f,R.exports.inflateRaw=function(R,J){return(J=J||{}).raw=!0,f(R,J)},R.exports.ungzip=f,R.exports.constants=B(12346)},12348:R=>{"use strict";const J=(R,J)=>Object.prototype.hasOwnProperty.call(R,J);R.exports.assign=function(R){const B=Array.prototype.slice.call(arguments,1);for(;B.length;){const Q=B.shift();if(Q){if("object"!==typeof Q)throw new TypeError(Q+"must be non-object");for(const B in Q)J(Q,B)&&(R[B]=Q[B])}}return R},R.exports.flattenChunks=R=>{let J=0;for(let Q=0,h=R.length;Q<h;Q++)J+=R[Q].length;const B=new Uint8Array(J);for(let Q=0,h=0,y=R.length;Q<y;Q++){let J=R[Q];B.set(J,h),h+=J.length}return B}},12356:R=>{"use strict";let J=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Q){J=!1}const B=new Uint8Array(256);for(let h=0;h<256;h++)B[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;B[254]=B[254]=1,R.exports.string2buf=R=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(R);let J,B,Q,h,y,N=R.length,r=0;for(h=0;h<N;h++)B=R.charCodeAt(h),55296===(64512&B)&&h+1<N&&(Q=R.charCodeAt(h+1),56320===(64512&Q)&&(B=65536+(B-55296<<10)+(Q-56320),h++)),r+=B<128?1:B<2048?2:B<65536?3:4;for(J=new Uint8Array(r),y=0,h=0;y<r;h++)B=R.charCodeAt(h),55296===(64512&B)&&h+1<N&&(Q=R.charCodeAt(h+1),56320===(64512&Q)&&(B=65536+(B-55296<<10)+(Q-56320),h++)),B<128?J[y++]=B:B<2048?(J[y++]=192|B>>>6,J[y++]=128|63&B):B<65536?(J[y++]=224|B>>>12,J[y++]=128|B>>>6&63,J[y++]=128|63&B):(J[y++]=240|B>>>18,J[y++]=128|B>>>12&63,J[y++]=128|B>>>6&63,J[y++]=128|63&B);return J};R.exports.buf2string=(R,Q)=>{const h=Q||R.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(R.subarray(0,Q));let y,N;const r=new Array(2*h);for(N=0,y=0;y<h;){let J=R[y++];if(J<128){r[N++]=J;continue}let Q=B[J];if(Q>4)r[N++]=65533,y+=Q-1;else{for(J&=2===Q?31:3===Q?15:7;Q>1&&y<h;)J=J<<6|63&R[y++],Q--;Q>1?r[N++]=65533:J<65536?r[N++]=J:(J-=65536,r[N++]=55296|J>>10&1023,r[N++]=56320|1023&J)}}return((R,B)=>{if(B<65534&&R.subarray&&J)return String.fromCharCode.apply(null,R.length===B?R:R.subarray(0,B));let Q="";for(let J=0;J<B;J++)Q+=String.fromCharCode(R[J]);return Q})(r,N)},R.exports.utf8border=(R,J)=>{(J=J||R.length)>R.length&&(J=R.length);let Q=J-1;for(;Q>=0&&128===(192&R[Q]);)Q--;return Q<0||0===Q?J:Q+B[R[Q]]>J?Q:J}},12338:R=>{"use strict";R.exports=(R,J,B,Q)=>{let h=65535&R,y=R>>>16&65535,N=0;for(;0!==B;){N=B>2e3?2e3:B,B-=N;do{h=h+J[Q++]|0,y=y+h|0}while(--N);h%=65521,y%=65521}return h|y<<16}},12346:R=>{"use strict";R.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12340:R=>{"use strict";const J=new Uint32Array((()=>{let R,J=[];for(var B=0;B<256;B++){R=B;for(var Q=0;Q<8;Q++)R=1&R?3988292384^R>>>1:R>>>1;J[B]=R}return J})());R.exports=(R,B,Q,h)=>{const y=J,N=h+Q;R^=-1;for(let J=h;J<N;J++)R=R>>>8^y[255&(R^B[J])];return~R}},12321:(R,J,B)=>{"use strict";const{_tr_init:Q,_tr_stored_block:h,_tr_flush_block:y,_tr_tally:N,_tr_align:r}=B(12329),q=B(12338),e=B(12340),D=B(12344),{Z_NO_FLUSH:l,Z_PARTIAL_FLUSH:E,Z_FULL_FLUSH:O,Z_FINISH:n,Z_BLOCK:P,Z_OK:A,Z_STREAM_END:u,Z_STREAM_ERROR:S,Z_DATA_ERROR:f,Z_BUF_ERROR:a,Z_DEFAULT_COMPRESSION:s,Z_FILTERED:x,Z_HUFFMAN_ONLY:I,Z_RLE:V,Z_FIXED:M,Z_DEFAULT_STRATEGY:H,Z_UNKNOWN:d,Z_DEFLATED:X}=B(12346),c=258,z=262,p=103,i=113,W=666,k=(R,J)=>(R.eJ=D[J],J),Y=R=>(R<<1)-(R>4?9:0),G=R=>{let J=R.length;for(;--J>=0;)R[J]=0};let g=(R,J,B)=>(J<<R.hash_shift^B)&R.hash_mask;const L=R=>{const J=R.state;let B=J.pending;B>R.avail_out&&(B=R.avail_out),0!==B&&(R.output.set(J.pending_buf.subarray(J.pending_out,J.pending_out+B),R.next_out),R.next_out+=B,J.pending_out+=B,R.total_out+=B,R.avail_out-=B,J.pending-=B,0===J.pending&&(J.pending_out=0))},j=(R,J)=>{y(R,R.block_start>=0?R.block_start:-1,R.strstart-R.block_start,J),R.block_start=R.strstart,L(R.strm)},T=(R,J)=>{R.pending_buf[R.pending++]=J},F=(R,J)=>{R.pending_buf[R.pending++]=J>>>8&255,R.pending_buf[R.pending++]=255&J},C=(R,J,B,Q)=>{let h=R.avail_in;return h>Q&&(h=Q),0===h?0:(R.avail_in-=h,J.set(R.input.subarray(R.next_in,R.next_in+h),B),1===R.state.wrap?R.adler=q(R.adler,J,h,B):2===R.state.wrap&&(R.adler=e(R.adler,J,h,B)),R.next_in+=h,R.total_in+=h,h)},b=(R,J)=>{let B,Q,h=R.max_chain_length,y=R.strstart,N=R.prev_length,r=R.nice_match;const q=R.strstart>R.w_size-z?R.strstart-(R.w_size-z):0,e=R.window,D=R.w_mask,l=R.prev,E=R.strstart+c;let O=e[y+N-1],n=e[y+N];R.prev_length>=R.good_match&&(h>>=2),r>R.lookahead&&(r=R.lookahead);do{if(B=J,e[B+N]===n&&e[B+N-1]===O&&e[B]===e[y]&&e[++B]===e[y+1]){y+=2,B++;do{}while(e[++y]===e[++B]&&e[++y]===e[++B]&&e[++y]===e[++B]&&e[++y]===e[++B]&&e[++y]===e[++B]&&e[++y]===e[++B]&&e[++y]===e[++B]&&e[++y]===e[++B]&&y<E);if(Q=c-(E-y),y=E-c,Q>N){if(R.match_start=J,N=Q,Q>=r)break;O=e[y+N-1],n=e[y+N]}}}while((J=l[J&D])>q&&0!==--h);return N<=R.lookahead?N:R.lookahead},w=R=>{const J=R.w_size;let B,Q,h,y,N;do{if(y=R.window_size-R.lookahead-R.strstart,R.strstart>=J+(J-z)){R.window.set(R.window.subarray(J,J+J),0),R.match_start-=J,R.strstart-=J,R.block_start-=J,Q=R.hash_size,B=Q;do{h=R.head[--B],R.head[B]=h>=J?h-J:0}while(--Q);Q=J,B=Q;do{h=R.prev[--B],R.prev[B]=h>=J?h-J:0}while(--Q);y+=J}if(0===R.strm.avail_in)break;if(Q=C(R.strm,R.window,R.strstart+R.lookahead,y),R.lookahead+=Q,R.lookahead+R.insert>=3)for(N=R.strstart-R.insert,R.ins_h=R.window[N],R.ins_h=g(R,R.ins_h,R.window[N+1]);R.insert&&(R.ins_h=g(R,R.ins_h,R.window[N+3-1]),R.prev[N&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=N,N++,R.insert--,!(R.lookahead+R.insert<3)););}while(R.lookahead<z&&0!==R.strm.avail_in)},K=(R,J)=>{let B,Q;for(;;){if(R.lookahead<z){if(w(R),R.lookahead<z&&J===l)return 1;if(0===R.lookahead)break}if(B=0,R.lookahead>=3&&(R.ins_h=g(R,R.ins_h,R.window[R.strstart+3-1]),B=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),0!==B&&R.strstart-B<=R.w_size-z&&(R.match_length=b(R,B)),R.match_length>=3)if(Q=N(R,R.strstart-R.match_start,R.match_length-3),R.lookahead-=R.match_length,R.match_length<=R.max_lazy_match&&R.lookahead>=3){R.match_length--;do{R.strstart++,R.ins_h=g(R,R.ins_h,R.window[R.strstart+3-1]),B=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart}while(0!==--R.match_length);R.strstart++}else R.strstart+=R.match_length,R.match_length=0,R.ins_h=R.window[R.strstart],R.ins_h=g(R,R.ins_h,R.window[R.strstart+1]);else Q=N(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++;if(Q&&(j(R,!1),0===R.strm.avail_out))return 1}return R.insert=R.strstart<2?R.strstart:2,J===n?(j(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(j(R,!1),0===R.strm.avail_out)?1:2},v=(R,J)=>{let B,Q,h;for(;;){if(R.lookahead<z){if(w(R),R.lookahead<z&&J===l)return 1;if(0===R.lookahead)break}if(B=0,R.lookahead>=3&&(R.ins_h=g(R,R.ins_h,R.window[R.strstart+3-1]),B=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),R.prev_length=R.match_length,R.prev_match=R.match_start,R.match_length=2,0!==B&&R.prev_length<R.max_lazy_match&&R.strstart-B<=R.w_size-z&&(R.match_length=b(R,B),R.match_length<=5&&(R.strategy===x||3===R.match_length&&R.strstart-R.match_start>4096)&&(R.match_length=2)),R.prev_length>=3&&R.match_length<=R.prev_length){h=R.strstart+R.lookahead-3,Q=N(R,R.strstart-1-R.prev_match,R.prev_length-3),R.lookahead-=R.prev_length-1,R.prev_length-=2;do{++R.strstart<=h&&(R.ins_h=g(R,R.ins_h,R.window[R.strstart+3-1]),B=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart)}while(0!==--R.prev_length);if(R.match_available=0,R.match_length=2,R.strstart++,Q&&(j(R,!1),0===R.strm.avail_out))return 1}else if(R.match_available){if(Q=N(R,0,R.window[R.strstart-1]),Q&&j(R,!1),R.strstart++,R.lookahead--,0===R.strm.avail_out)return 1}else R.match_available=1,R.strstart++,R.lookahead--}return R.match_available&&(Q=N(R,0,R.window[R.strstart-1]),R.match_available=0),R.insert=R.strstart<2?R.strstart:2,J===n?(j(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(j(R,!1),0===R.strm.avail_out)?1:2};function m(R,J,B,Q,h){this.good_length=R,this.max_lazy=J,this.nice_length=B,this.max_chain=Q,this.func=h}const o=[new m(0,0,0,0,((R,J)=>{let B=65535;for(B>R.pending_buf_size-5&&(B=R.pending_buf_size-5);;){if(R.lookahead<=1){if(w(R),0===R.lookahead&&J===l)return 1;if(0===R.lookahead)break}R.strstart+=R.lookahead,R.lookahead=0;const Q=R.block_start+B;if((0===R.strstart||R.strstart>=Q)&&(R.lookahead=R.strstart-Q,R.strstart=Q,j(R,!1),0===R.strm.avail_out))return 1;if(R.strstart-R.block_start>=R.w_size-z&&(j(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,J===n?(j(R,!0),0===R.strm.avail_out?3:4):(R.strstart>R.block_start&&(j(R,!1),R.strm.avail_out),1)})),new m(4,4,8,4,K),new m(4,5,16,8,K),new m(4,6,32,32,K),new m(4,4,16,16,v),new m(8,16,32,32,v),new m(8,16,128,128,v),new m(8,32,128,256,v),new m(32,128,258,1024,v),new m(32,258,258,4096,v)];function t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=X,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),G(this.dyn_ltree),G(this.dyn_dtree),G(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),G(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),G(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Z=R=>{if(!R||!R.state)return k(R,S);R.total_in=R.total_out=0,R.data_type=d;const J=R.state;return J.pending=0,J.pending_out=0,J.wrap<0&&(J.wrap=-J.wrap),J.status=J.wrap?42:i,R.adler=2===J.wrap?0:1,J.last_flush=l,Q(J),A},U=R=>{const J=Z(R);var B;return J===A&&((B=R.state).window_size=2*B.w_size,G(B.head),B.max_lazy_match=o[B.level].max_lazy,B.good_match=o[B.level].good_length,B.nice_match=o[B.level].nice_length,B.max_chain_length=o[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=2,B.match_available=0,B.ins_h=0),J},RR=(R,J,B,Q,h,y)=>{if(!R)return S;let N=1;if(J===s&&(J=6),Q<0?(N=0,Q=-Q):Q>15&&(N=2,Q-=16),h<1||h>9||B!==X||Q<8||Q>15||J<0||J>9||y<0||y>M)return k(R,S);8===Q&&(Q=9);const r=new t;return R.state=r,r.strm=R,r.wrap=N,r.gzhead=null,r.w_bits=Q,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=h+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new Uint8Array(2*r.w_size),r.head=new Uint16Array(r.hash_size),r.prev=new Uint16Array(r.w_size),r.lit_bufsize=1<<h+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new Uint8Array(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=3*r.lit_bufsize,r.level=J,r.strategy=y,r.method=B,U(R)};R.exports.deflateInit=(R,J)=>RR(R,J,X,15,8,H),R.exports.deflateInit2=RR,R.exports.deflateReset=U,R.exports.deflateResetKeep=Z,R.exports.deflateSetHeader=(R,J)=>R&&R.state?2!==R.state.wrap?S:(R.state.gzhead=J,A):S,R.exports.deflate=(R,J)=>{let B,Q;if(!R||!R.state||J>P||J<0)return R?k(R,S):S;const y=R.state;if(!R.output||!R.input&&0!==R.avail_in||y.status===W&&J!==n)return k(R,0===R.avail_out?a:S);y.strm=R;const q=y.last_flush;if(y.last_flush=J,42===y.status)if(2===y.wrap)R.adler=0,T(y,31),T(y,139),T(y,8),y.gzhead?(T(y,(y.gzhead.text?1:0)+(y.gzhead.hcrc?2:0)+(y.gzhead.extra?4:0)+(y.gzhead.name?8:0)+(y.gzhead.comment?16:0)),T(y,255&y.gzhead.time),T(y,y.gzhead.time>>8&255),T(y,y.gzhead.time>>16&255),T(y,y.gzhead.time>>24&255),T(y,9===y.level?2:y.strategy>=I||y.level<2?4:0),T(y,255&y.gzhead.os),y.gzhead.extra&&y.gzhead.extra.length&&(T(y,255&y.gzhead.extra.length),T(y,y.gzhead.extra.length>>8&255)),y.gzhead.hcrc&&(R.adler=e(R.adler,y.pending_buf,y.pending,0)),y.gzindex=0,y.status=69):(T(y,0),T(y,0),T(y,0),T(y,0),T(y,0),T(y,9===y.level?2:y.strategy>=I||y.level<2?4:0),T(y,3),y.status=i);else{let J=X+(y.w_bits-8<<4)<<8,B=-1;B=y.strategy>=I||y.level<2?0:y.level<6?1:6===y.level?2:3,J|=B<<6,0!==y.strstart&&(J|=32),J+=31-J%31,y.status=i,F(y,J),0!==y.strstart&&(F(y,R.adler>>>16),F(y,65535&R.adler)),R.adler=1}if(69===y.status)if(y.gzhead.extra){for(B=y.pending;y.gzindex<(65535&y.gzhead.extra.length)&&(y.pending!==y.pending_buf_size||(y.gzhead.hcrc&&y.pending>B&&(R.adler=e(R.adler,y.pending_buf,y.pending-B,B)),L(R),B=y.pending,y.pending!==y.pending_buf_size));)T(y,255&y.gzhead.extra[y.gzindex]),y.gzindex++;y.gzhead.hcrc&&y.pending>B&&(R.adler=e(R.adler,y.pending_buf,y.pending-B,B)),y.gzindex===y.gzhead.extra.length&&(y.gzindex=0,y.status=73)}else y.status=73;if(73===y.status)if(y.gzhead.name){B=y.pending;do{if(y.pending===y.pending_buf_size&&(y.gzhead.hcrc&&y.pending>B&&(R.adler=e(R.adler,y.pending_buf,y.pending-B,B)),L(R),B=y.pending,y.pending===y.pending_buf_size)){Q=1;break}Q=y.gzindex<y.gzhead.name.length?255&y.gzhead.name.charCodeAt(y.gzindex++):0,T(y,Q)}while(0!==Q);y.gzhead.hcrc&&y.pending>B&&(R.adler=e(R.adler,y.pending_buf,y.pending-B,B)),0===Q&&(y.gzindex=0,y.status=91)}else y.status=91;if(91===y.status)if(y.gzhead.comment){B=y.pending;do{if(y.pending===y.pending_buf_size&&(y.gzhead.hcrc&&y.pending>B&&(R.adler=e(R.adler,y.pending_buf,y.pending-B,B)),L(R),B=y.pending,y.pending===y.pending_buf_size)){Q=1;break}Q=y.gzindex<y.gzhead.comment.length?255&y.gzhead.comment.charCodeAt(y.gzindex++):0,T(y,Q)}while(0!==Q);y.gzhead.hcrc&&y.pending>B&&(R.adler=e(R.adler,y.pending_buf,y.pending-B,B)),0===Q&&(y.status=p)}else y.status=p;if(y.status===p&&(y.gzhead.hcrc?(y.pending+2>y.pending_buf_size&&L(R),y.pending+2<=y.pending_buf_size&&(T(y,255&R.adler),T(y,R.adler>>8&255),R.adler=0,y.status=i)):y.status=i),0!==y.pending){if(L(R),0===R.avail_out)return y.last_flush=-1,A}else if(0===R.avail_in&&Y(J)<=Y(q)&&J!==n)return k(R,a);if(y.status===W&&0!==R.avail_in)return k(R,a);if(0!==R.avail_in||0!==y.lookahead||J!==l&&y.status!==W){let B=y.strategy===I?((R,J)=>{let B;for(;;){if(0===R.lookahead&&(w(R),0===R.lookahead)){if(J===l)return 1;break}if(R.match_length=0,B=N(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,B&&(j(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,J===n?(j(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(j(R,!1),0===R.strm.avail_out)?1:2})(y,J):y.strategy===V?((R,J)=>{let B,Q,h,y;const r=R.window;for(;;){if(R.lookahead<=c){if(w(R),R.lookahead<=c&&J===l)return 1;if(0===R.lookahead)break}if(R.match_length=0,R.lookahead>=3&&R.strstart>0&&(h=R.strstart-1,Q=r[h],Q===r[++h]&&Q===r[++h]&&Q===r[++h])){y=R.strstart+c;do{}while(Q===r[++h]&&Q===r[++h]&&Q===r[++h]&&Q===r[++h]&&Q===r[++h]&&Q===r[++h]&&Q===r[++h]&&Q===r[++h]&&h<y);R.match_length=c-(y-h),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=3?(B=N(R,1,R.match_length-3),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(B=N(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),B&&(j(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,J===n?(j(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(j(R,!1),0===R.strm.avail_out)?1:2})(y,J):o[y.level].func(y,J);if(3!==B&&4!==B||(y.status=W),1===B||3===B)return 0===R.avail_out&&(y.last_flush=-1),A;if(2===B&&(J===E?r(y):J!==P&&(h(y,0,0,!1),J===O&&(G(y.head),0===y.lookahead&&(y.strstart=0,y.block_start=0,y.insert=0))),L(R),0===R.avail_out))return y.last_flush=-1,A}return J!==n?A:y.wrap<=0?u:(2===y.wrap?(T(y,255&R.adler),T(y,R.adler>>8&255),T(y,R.adler>>16&255),T(y,R.adler>>24&255),T(y,255&R.total_in),T(y,R.total_in>>8&255),T(y,R.total_in>>16&255),T(y,R.total_in>>24&255)):(F(y,R.adler>>>16),F(y,65535&R.adler)),L(R),y.wrap>0&&(y.wrap=-y.wrap),0!==y.pending?A:u)},R.exports.deflateEnd=R=>{if(!R||!R.state)return S;const J=R.state.status;return 42!==J&&69!==J&&73!==J&&91!==J&&J!==p&&J!==i&&J!==W?k(R,S):(R.state=null,J===i?k(R,f):A)},R.exports.deflateSetDictionary=(R,J)=>{let B=J.length;if(!R||!R.state)return S;const Q=R.state,h=Q.wrap;if(2===h||1===h&&42!==Q.status||Q.lookahead)return S;if(1===h&&(R.adler=q(R.adler,J,B,0)),Q.wrap=0,B>=Q.w_size){0===h&&(G(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0);let R=new Uint8Array(Q.w_size);R.set(J.subarray(B-Q.w_size,B),0),J=R,B=Q.w_size}const y=R.avail_in,N=R.next_in,r=R.input;for(R.avail_in=B,R.next_in=0,R.input=J,w(Q);Q.lookahead>=3;){let R=Q.strstart,J=Q.lookahead-2;do{Q.ins_h=g(Q,Q.ins_h,Q.window[R+3-1]),Q.prev[R&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=R,R++}while(--J);Q.strstart=R,Q.lookahead=2,w(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=2,Q.match_available=0,R.next_in=N,R.input=r,R.avail_in=y,Q.wrap=h,A},R.exports.deflateInfo="pako deflate (from Nodeca project)"},12390:R=>{"use strict";R.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12381:R=>{"use strict";R.exports=function(R,J){let B,Q,h,y,N,r,q,e,D,l,E,O,n,P,A,u,S,f,a,s,x,I,V,M;const H=R.state;B=R.next_in,V=R.input,Q=B+(R.avail_in-5),h=R.next_out,M=R.output,y=h-(J-R.avail_out),N=h+(R.avail_out-257),r=H.dmax,q=H.wsize,e=H.whave,D=H.wnext,l=H.window,E=H.hold,O=H.bits,n=H.lencode,P=H.distcode,A=(1<<H.lenbits)-1,u=(1<<H.distbits)-1;R:do{O<15&&(E+=V[B++]<<O,O+=8,E+=V[B++]<<O,O+=8),S=n[E&A];J:for(;;){if(f=S>>>24,E>>>=f,O-=f,f=S>>>16&255,0===f)M[h++]=65535&S;else{if(!(16&f)){if(0===(64&f)){S=n[(65535&S)+(E&(1<<f)-1)];continue J}if(32&f){H.mode=12;break R}R.eJ="invalid literal/length code",H.mode=30;break R}a=65535&S,f&=15,f&&(O<f&&(E+=V[B++]<<O,O+=8),a+=E&(1<<f)-1,E>>>=f,O-=f),O<15&&(E+=V[B++]<<O,O+=8,E+=V[B++]<<O,O+=8),S=P[E&u];B:for(;;){if(f=S>>>24,E>>>=f,O-=f,f=S>>>16&255,!(16&f)){if(0===(64&f)){S=P[(65535&S)+(E&(1<<f)-1)];continue B}R.eJ="invalid distance code",H.mode=30;break R}if(s=65535&S,f&=15,O<f&&(E+=V[B++]<<O,O+=8,O<f&&(E+=V[B++]<<O,O+=8)),s+=E&(1<<f)-1,s>r){R.eJ="invalid distance too far back",H.mode=30;break R}if(E>>>=f,O-=f,f=h-y,s>f){if(f=s-f,f>e&&H.sane){R.eJ="invalid distance too far back",H.mode=30;break R}if(x=0,I=l,0===D){if(x+=q-f,f<a){a-=f;do{M[h++]=l[x++]}while(--f);x=h-s,I=M}}else if(D<f){if(x+=q+D-f,f-=D,f<a){a-=f;do{M[h++]=l[x++]}while(--f);if(x=0,D<a){f=D,a-=f;do{M[h++]=l[x++]}while(--f);x=h-s,I=M}}}else if(x+=D-f,f<a){a-=f;do{M[h++]=l[x++]}while(--f);x=h-s,I=M}for(;a>2;)M[h++]=I[x++],M[h++]=I[x++],M[h++]=I[x++],a-=3;a&&(M[h++]=I[x++],a>1&&(M[h++]=I[x++]))}else{x=h-s;do{M[h++]=M[x++],M[h++]=M[x++],M[h++]=M[x++],a-=3}while(a>2);a&&(M[h++]=M[x++],a>1&&(M[h++]=M[x++]))}break}}break}}while(B<Q&&h<N);a=O>>3,B-=a,O-=a<<3,E&=(1<<O)-1,R.next_in=B,R.next_out=h,R.avail_in=B<Q?Q-B+5:5-(B-Q),R.avail_out=h<N?N-h+257:257-(h-N),H.hold=E,H.bits=O}},12375:(R,J,B)=>{"use strict";const Q=B(12338),h=B(12340),y=B(12381),N=B(12386),{Z_FINISH:r,Z_BLOCK:q,Z_TREES:e,Z_OK:D,Z_STREAM_END:l,Z_NEED_DICT:E,Z_STREAM_ERROR:O,Z_DATA_ERROR:n,Z_MEM_ERROR:P,Z_BUF_ERROR:A,Z_DEFLATED:u}=B(12346),S=12,f=30,a=R=>(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24);function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const x=R=>{if(!R||!R.state)return O;const J=R.state;return R.total_in=R.total_out=J.total=0,R.eJ="",J.wrap&&(R.adler=1&J.wrap),J.mode=1,J.last=0,J.havedict=0,J.dmax=32768,J.head=null,J.hold=0,J.bits=0,J.lencode=J.lendyn=new Int32Array(852),J.distcode=J.distdyn=new Int32Array(592),J.sane=1,J.back=-1,D},I=R=>{if(!R||!R.state)return O;const J=R.state;return J.wsize=0,J.whave=0,J.wnext=0,x(R)},V=(R,J)=>{let B;if(!R||!R.state)return O;const Q=R.state;return J<0?(B=0,J=-J):(B=1+(J>>4),J<48&&(J&=15)),J&&(J<8||J>15)?O:(null!==Q.window&&Q.wbits!==J&&(Q.window=null),Q.wrap=B,Q.wbits=J,I(R))},M=(R,J)=>{if(!R)return O;const B=new s;R.state=B,B.window=null;const Q=V(R,J);return Q!==D&&(R.state=null),Q};let H,d,X=!0;const c=R=>{if(X){H=new Int32Array(512),d=new Int32Array(32);let J=0;for(;J<144;)R.lens[J++]=8;for(;J<256;)R.lens[J++]=9;for(;J<280;)R.lens[J++]=7;for(;J<288;)R.lens[J++]=8;for(N(1,R.lens,0,288,H,0,R.work,{bits:9}),J=0;J<32;)R.lens[J++]=5;N(2,R.lens,0,32,d,0,R.work,{bits:5}),X=!1}R.lencode=H,R.lenbits=9,R.distcode=d,R.distbits=5},z=(R,J,B,Q)=>{let h;const y=R.state;return null===y.window&&(y.wsize=1<<y.wbits,y.wnext=0,y.whave=0,y.window=new Uint8Array(y.wsize)),Q>=y.wsize?(y.window.set(J.subarray(B-y.wsize,B),0),y.wnext=0,y.whave=y.wsize):(h=y.wsize-y.wnext,h>Q&&(h=Q),y.window.set(J.subarray(B-Q,B-Q+h),y.wnext),(Q-=h)?(y.window.set(J.subarray(B-Q,B),0),y.wnext=Q,y.whave=y.wsize):(y.wnext+=h,y.wnext===y.wsize&&(y.wnext=0),y.whave<y.wsize&&(y.whave+=h))),0};R.exports.inflateReset=I,R.exports.inflateReset2=V,R.exports.inflateResetKeep=x,R.exports.inflateInit=R=>M(R,15),R.exports.inflateInit2=M,R.exports.inflate=(R,J)=>{let B,s,x,I,V,M,H,d,X,p,i,W,k,Y,G,g,L,j,T,F,C,b,w=0;const K=new Uint8Array(4);let v,m;const o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!R||!R.state||!R.output||!R.input&&0!==R.avail_in)return O;B=R.state,B.mode===S&&(B.mode=13),V=R.next_out,x=R.output,H=R.avail_out,I=R.next_in,s=R.input,M=R.avail_in,d=B.hold,X=B.bits,p=M,i=H,b=D;R:for(;;)switch(B.mode){case 1:if(0===B.wrap){B.mode=13;break}for(;X<16;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(2&B.wrap&&35615===d){B.check=0,K[0]=255&d,K[1]=d>>>8&255,B.check=h(B.check,K,2,0),d=0,X=0,B.mode=2;break}if(B.flags=0,B.head&&(B.head.done=!1),!(1&B.wrap)||(((255&d)<<8)+(d>>8))%31){R.eJ="incorrect header check",B.mode=f;break}if((15&d)!==u){R.eJ="unknown compression method",B.mode=f;break}if(d>>>=4,X-=4,C=8+(15&d),0===B.wbits)B.wbits=C;else if(C>B.wbits){R.eJ="invalid window size",B.mode=f;break}B.dmax=1<<B.wbits,R.adler=B.check=1,B.mode=512&d?10:S,d=0,X=0;break;case 2:for(;X<16;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(B.flags=d,(255&B.flags)!==u){R.eJ="unknown compression method",B.mode=f;break}if(57344&B.flags){R.eJ="unknown header flags set",B.mode=f;break}B.head&&(B.head.text=d>>8&1),512&B.flags&&(K[0]=255&d,K[1]=d>>>8&255,B.check=h(B.check,K,2,0)),d=0,X=0,B.mode=3;case 3:for(;X<32;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}B.head&&(B.head.time=d),512&B.flags&&(K[0]=255&d,K[1]=d>>>8&255,K[2]=d>>>16&255,K[3]=d>>>24&255,B.check=h(B.check,K,4,0)),d=0,X=0,B.mode=4;case 4:for(;X<16;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}B.head&&(B.head.xflags=255&d,B.head.os=d>>8),512&B.flags&&(K[0]=255&d,K[1]=d>>>8&255,B.check=h(B.check,K,2,0)),d=0,X=0,B.mode=5;case 5:if(1024&B.flags){for(;X<16;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}B.length=d,B.head&&(B.head.extra_len=d),512&B.flags&&(K[0]=255&d,K[1]=d>>>8&255,B.check=h(B.check,K,2,0)),d=0,X=0}else B.head&&(B.head.extra=null);B.mode=6;case 6:if(1024&B.flags&&(W=B.length,W>M&&(W=M),W&&(B.head&&(C=B.head.extra_len-B.length,B.head.extra||(B.head.extra=new Uint8Array(B.head.extra_len)),B.head.extra.set(s.subarray(I,I+W),C)),512&B.flags&&(B.check=h(B.check,s,W,I)),M-=W,I+=W,B.length-=W),B.length))break R;B.length=0,B.mode=7;case 7:if(2048&B.flags){if(0===M)break R;W=0;do{C=s[I+W++],B.head&&C&&B.length<65536&&(B.head.name+=String.fromCharCode(C))}while(C&&W<M);if(512&B.flags&&(B.check=h(B.check,s,W,I)),M-=W,I+=W,C)break R}else B.head&&(B.head.name=null);B.length=0,B.mode=8;case 8:if(4096&B.flags){if(0===M)break R;W=0;do{C=s[I+W++],B.head&&C&&B.length<65536&&(B.head.comment+=String.fromCharCode(C))}while(C&&W<M);if(512&B.flags&&(B.check=h(B.check,s,W,I)),M-=W,I+=W,C)break R}else B.head&&(B.head.comment=null);B.mode=9;case 9:if(512&B.flags){for(;X<16;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(d!==(65535&B.check)){R.eJ="header crc mismatch",B.mode=f;break}d=0,X=0}B.head&&(B.head.hcrc=B.flags>>9&1,B.head.done=!0),R.adler=B.check=0,B.mode=S;break;case 10:for(;X<32;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}R.adler=B.check=a(d),d=0,X=0,B.mode=11;case 11:if(0===B.havedict)return R.next_out=V,R.avail_out=H,R.next_in=I,R.avail_in=M,B.hold=d,B.bits=X,E;R.adler=B.check=1,B.mode=S;case S:if(J===q||J===e)break R;case 13:if(B.last){d>>>=7&X,X-=7&X,B.mode=27;break}for(;X<3;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}switch(B.last=1&d,d>>>=1,X-=1,3&d){case 0:B.mode=14;break;case 1:if(c(B),B.mode=20,J===e){d>>>=2,X-=2;break R}break;case 2:B.mode=17;break;case 3:R.eJ="invalid block type",B.mode=f}d>>>=2,X-=2;break;case 14:for(d>>>=7&X,X-=7&X;X<32;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if((65535&d)!==(d>>>16^65535)){R.eJ="invalid stored block lengths",B.mode=f;break}if(B.length=65535&d,d=0,X=0,B.mode=15,J===e)break R;case 15:B.mode=16;case 16:if(W=B.length,W){if(W>M&&(W=M),W>H&&(W=H),0===W)break R;x.set(s.subarray(I,I+W),V),M-=W,I+=W,H-=W,V+=W,B.length-=W;break}B.mode=S;break;case 17:for(;X<14;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(B.nlen=257+(31&d),d>>>=5,X-=5,B.ndist=1+(31&d),d>>>=5,X-=5,B.ncode=4+(15&d),d>>>=4,X-=4,B.nlen>286||B.ndist>30){R.eJ="too many length or distance symbols",B.mode=f;break}B.have=0,B.mode=18;case 18:for(;B.have<B.ncode;){for(;X<3;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}B.lens[o[B.have++]]=7&d,d>>>=3,X-=3}for(;B.have<19;)B.lens[o[B.have++]]=0;if(B.lencode=B.lendyn,B.lenbits=7,v={bits:B.lenbits},b=N(0,B.lens,0,19,B.lencode,0,B.work,v),B.lenbits=v.bits,b){R.eJ="invalid code lengths set",B.mode=f;break}B.have=0,B.mode=19;case 19:for(;B.have<B.nlen+B.ndist;){for(;w=B.lencode[d&(1<<B.lenbits)-1],G=w>>>24,g=w>>>16&255,L=65535&w,!(G<=X);){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(L<16)d>>>=G,X-=G,B.lens[B.have++]=L;else{if(16===L){for(m=G+2;X<m;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(d>>>=G,X-=G,0===B.have){R.eJ="invalid bit length repeat",B.mode=f;break}C=B.lens[B.have-1],W=3+(3&d),d>>>=2,X-=2}else if(17===L){for(m=G+3;X<m;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}d>>>=G,X-=G,C=0,W=3+(7&d),d>>>=3,X-=3}else{for(m=G+7;X<m;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}d>>>=G,X-=G,C=0,W=11+(127&d),d>>>=7,X-=7}if(B.have+W>B.nlen+B.ndist){R.eJ="invalid bit length repeat",B.mode=f;break}for(;W--;)B.lens[B.have++]=C}}if(B.mode===f)break;if(0===B.lens[256]){R.eJ="invalid code -- missing end-of-block",B.mode=f;break}if(B.lenbits=9,v={bits:B.lenbits},b=N(1,B.lens,0,B.nlen,B.lencode,0,B.work,v),B.lenbits=v.bits,b){R.eJ="invalid literal/lengths set",B.mode=f;break}if(B.distbits=6,B.distcode=B.distdyn,v={bits:B.distbits},b=N(2,B.lens,B.nlen,B.ndist,B.distcode,0,B.work,v),B.distbits=v.bits,b){R.eJ="invalid distances set",B.mode=f;break}if(B.mode=20,J===e)break R;case 20:B.mode=21;case 21:if(M>=6&&H>=258){R.next_out=V,R.avail_out=H,R.next_in=I,R.avail_in=M,B.hold=d,B.bits=X,y(R,i),V=R.next_out,x=R.output,H=R.avail_out,I=R.next_in,s=R.input,M=R.avail_in,d=B.hold,X=B.bits,B.mode===S&&(B.back=-1);break}for(B.back=0;w=B.lencode[d&(1<<B.lenbits)-1],G=w>>>24,g=w>>>16&255,L=65535&w,!(G<=X);){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(g&&0===(240&g)){for(j=G,T=g,F=L;w=B.lencode[F+((d&(1<<j+T)-1)>>j)],G=w>>>24,g=w>>>16&255,L=65535&w,!(j+G<=X);){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}d>>>=j,X-=j,B.back+=j}if(d>>>=G,X-=G,B.back+=G,B.length=L,0===g){B.mode=26;break}if(32&g){B.back=-1,B.mode=S;break}if(64&g){R.eJ="invalid literal/length code",B.mode=f;break}B.extra=15&g,B.mode=22;case 22:if(B.extra){for(m=B.extra;X<m;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}B.length+=d&(1<<B.extra)-1,d>>>=B.extra,X-=B.extra,B.back+=B.extra}B.was=B.length,B.mode=23;case 23:for(;w=B.distcode[d&(1<<B.distbits)-1],G=w>>>24,g=w>>>16&255,L=65535&w,!(G<=X);){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(0===(240&g)){for(j=G,T=g,F=L;w=B.distcode[F+((d&(1<<j+T)-1)>>j)],G=w>>>24,g=w>>>16&255,L=65535&w,!(j+G<=X);){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}d>>>=j,X-=j,B.back+=j}if(d>>>=G,X-=G,B.back+=G,64&g){R.eJ="invalid distance code",B.mode=f;break}B.offset=L,B.extra=15&g,B.mode=24;case 24:if(B.extra){for(m=B.extra;X<m;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}B.offset+=d&(1<<B.extra)-1,d>>>=B.extra,X-=B.extra,B.back+=B.extra}if(B.offset>B.dmax){R.eJ="invalid distance too far back",B.mode=f;break}B.mode=25;case 25:if(0===H)break R;if(W=i-H,B.offset>W){if(W=B.offset-W,W>B.whave&&B.sane){R.eJ="invalid distance too far back",B.mode=f;break}W>B.wnext?(W-=B.wnext,k=B.wsize-W):k=B.wnext-W,W>B.length&&(W=B.length),Y=B.window}else Y=x,k=V-B.offset,W=B.length;W>H&&(W=H),H-=W,B.length-=W;do{x[V++]=Y[k++]}while(--W);0===B.length&&(B.mode=21);break;case 26:if(0===H)break R;x[V++]=B.length,H--,B.mode=21;break;case 27:if(B.wrap){for(;X<32;){if(0===M)break R;M--,d|=s[I++]<<X,X+=8}if(i-=H,R.total_out+=i,B.total+=i,i&&(R.adler=B.check=B.flags?h(B.check,x,i,V-i):Q(B.check,x,i,V-i)),i=H,(B.flags?d:a(d))!==B.check){R.eJ="incorrect data check",B.mode=f;break}d=0,X=0}B.mode=28;case 28:if(B.wrap&&B.flags){for(;X<32;){if(0===M)break R;M--,d+=s[I++]<<X,X+=8}if(d!==(4294967295&B.total)){R.eJ="incorrect length check",B.mode=f;break}d=0,X=0}B.mode=29;case 29:b=l;break R;case f:b=n;break R;case 31:return P;default:return O}return R.next_out=V,R.avail_out=H,R.next_in=I,R.avail_in=M,B.hold=d,B.bits=X,(B.wsize||i!==R.avail_out&&B.mode<f&&(B.mode<27||J!==r))&&z(R,R.output,R.next_out,i-R.avail_out)?(B.mode=31,P):(p-=R.avail_in,i-=R.avail_out,R.total_in+=p,R.total_out+=i,B.total+=i,B.wrap&&i&&(R.adler=B.check=B.flags?h(B.check,x,i,R.next_out-i):Q(B.check,x,i,R.next_out-i)),R.data_type=B.bits+(B.last?64:0)+(B.mode===S?128:0)+(20===B.mode||15===B.mode?256:0),(0===p&&0===i||J===r)&&b===D&&(b=A),b)},R.exports.inflateEnd=R=>{if(!R||!R.state)return O;let J=R.state;return J.window&&(J.window=null),R.state=null,D},R.exports.inflateGetHeader=(R,J)=>{if(!R||!R.state)return O;const B=R.state;return 0===(2&B.wrap)?O:(B.head=J,J.done=!1,D)},R.exports.inflateSetDictionary=(R,J)=>{const B=J.length;let h,y,N;return R&&R.state?(h=R.state,0!==h.wrap&&11!==h.mode?O:11===h.mode&&(y=1,y=Q(y,J,B,0),y!==h.check)?n:(N=z(R,J,B,B),N?(h.mode=31,P):(h.havedict=1,D))):O},R.exports.inflateInfo="pako inflate (from Nodeca project)"},12386:R=>{"use strict";const J=15,B=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Q=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),h=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),y=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);R.exports=(R,N,r,q,e,D,l,E)=>{const O=E.bits;let n,P,A,u,S,f,a=0,s=0,x=0,I=0,V=0,M=0,H=0,d=0,X=0,c=0,z=null,p=0;const i=new Uint16Array(16),W=new Uint16Array(16);let k,Y,G,g=null,L=0;for(a=0;a<=J;a++)i[a]=0;for(s=0;s<q;s++)i[N[r+s]]++;for(V=O,I=J;I>=1&&0===i[I];I--);if(V>I&&(V=I),0===I)return e[D++]=20971520,e[D++]=20971520,E.bits=1,0;for(x=1;x<I&&0===i[x];x++);for(V<x&&(V=x),d=1,a=1;a<=J;a++)if(d<<=1,d-=i[a],d<0)return-1;if(d>0&&(0===R||1!==I))return-1;for(W[1]=0,a=1;a<J;a++)W[a+1]=W[a]+i[a];for(s=0;s<q;s++)0!==N[r+s]&&(l[W[N[r+s]]++]=s);if(0===R?(z=g=l,f=19):1===R?(z=B,p-=257,g=Q,L-=257,f=256):(z=h,g=y,f=-1),c=0,s=0,a=x,S=D,M=V,H=0,A=-1,X=1<<V,u=X-1,1===R&&X>852||2===R&&X>592)return 1;for(;;){k=a-H,l[s]<f?(Y=0,G=l[s]):l[s]>f?(Y=g[L+l[s]],G=z[p+l[s]]):(Y=96,G=0),n=1<<a-H,P=1<<M,x=P;do{P-=n,e[S+(c>>H)+P]=k<<24|Y<<16|G}while(0!==P);for(n=1<<a-1;c&n;)n>>=1;if(0!==n?(c&=n-1,c+=n):c=0,s++,0===--i[a]){if(a===I)break;a=N[r+l[s]]}if(a>V&&(c&u)!==A){for(0===H&&(H=V),S+=x,M=a-H,d=1<<M;M+H<I&&(d-=i[M+H],!(d<=0));)M++,d<<=1;if(X+=1<<M,1===R&&X>852||2===R&&X>592)return 1;A=c&u,e[A]=V<<24|M<<16|S-D}}return 0!==c&&(e[S+c]=a-H<<24|64<<16),E.bits=V,0}},12344:R=>{"use strict";R.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12329:R=>{"use strict";function J(R){let J=R.length;for(;--J>=0;)R[J]=0}const B=256,Q=286,h=30,y=15,N=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),r=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),q=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),e=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D=new Array(576);J(D);const l=new Array(60);J(l);const E=new Array(512);J(E);const O=new Array(256);J(O);const n=new Array(29);J(n);const P=new Array(h);function A(R,J,B,Q,h){this.static_tree=R,this.extra_bits=J,this.extra_base=B,this.elems=Q,this.max_length=h,this.has_stree=R&&R.length}let u,S,f;function a(R,J){this.dyn_tree=R,this.max_code=0,this.stat_desc=J}J(P);const s=R=>R<256?E[R]:E[256+(R>>>7)],x=(R,J)=>{R.pending_buf[R.pending++]=255&J,R.pending_buf[R.pending++]=J>>>8&255},I=(R,J,B)=>{R.bi_valid>16-B?(R.bi_buf|=J<<R.bi_valid&65535,x(R,R.bi_buf),R.bi_buf=J>>16-R.bi_valid,R.bi_valid+=B-16):(R.bi_buf|=J<<R.bi_valid&65535,R.bi_valid+=B)},V=(R,J,B)=>{I(R,B[2*J],B[2*J+1])},M=(R,J)=>{let B=0;do{B|=1&R,R>>>=1,B<<=1}while(--J>0);return B>>>1},H=(R,J,B)=>{const Q=new Array(16);let h,N,r=0;for(h=1;h<=y;h++)Q[h]=r=r+B[h-1]<<1;for(N=0;N<=J;N++){let J=R[2*N+1];0!==J&&(R[2*N]=M(Q[J]++,J))}},d=R=>{let J;for(J=0;J<Q;J++)R.dyn_ltree[2*J]=0;for(J=0;J<h;J++)R.dyn_dtree[2*J]=0;for(J=0;J<19;J++)R.bl_tree[2*J]=0;R.dyn_ltree[512]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0},X=R=>{R.bi_valid>8?x(R,R.bi_buf):R.bi_valid>0&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0},c=(R,J,B,Q)=>{const h=2*J,y=2*B;return R[h]<R[y]||R[h]===R[y]&&Q[J]<=Q[B]},z=(R,J,B)=>{const Q=R.heap[B];let h=B<<1;for(;h<=R.heap_len&&(h<R.heap_len&&c(J,R.heap[h+1],R.heap[h],R.depth)&&h++,!c(J,Q,R.heap[h],R.depth));)R.heap[B]=R.heap[h],B=h,h<<=1;R.heap[B]=Q},p=(R,J,Q)=>{let h,y,q,e,D=0;if(0!==R.last_lit)do{h=R.pending_buf[R.d_buf+2*D]<<8|R.pending_buf[R.d_buf+2*D+1],y=R.pending_buf[R.l_buf+D],D++,0===h?V(R,y,J):(q=O[y],V(R,q+B+1,J),e=N[q],0!==e&&(y-=n[q],I(R,y,e)),h--,q=s(h),V(R,q,Q),e=r[q],0!==e&&(h-=P[q],I(R,h,e)))}while(D<R.last_lit);V(R,256,J)},i=(R,J)=>{const B=J.dyn_tree,Q=J.stat_desc.static_tree,h=J.stat_desc.has_stree,N=J.stat_desc.elems;let r,q,e,D=-1;for(R.heap_len=0,R.heap_max=573,r=0;r<N;r++)0!==B[2*r]?(R.heap[++R.heap_len]=D=r,R.depth[r]=0):B[2*r+1]=0;for(;R.heap_len<2;)e=R.heap[++R.heap_len]=D<2?++D:0,B[2*e]=1,R.depth[e]=0,R.opt_len--,h&&(R.static_len-=Q[2*e+1]);for(J.max_code=D,r=R.heap_len>>1;r>=1;r--)z(R,B,r);e=N;do{r=R.heap[1],R.heap[1]=R.heap[R.heap_len--],z(R,B,1),q=R.heap[1],R.heap[--R.heap_max]=r,R.heap[--R.heap_max]=q,B[2*e]=B[2*r]+B[2*q],R.depth[e]=(R.depth[r]>=R.depth[q]?R.depth[r]:R.depth[q])+1,B[2*r+1]=B[2*q+1]=e,R.heap[1]=e++,z(R,B,1)}while(R.heap_len>=2);R.heap[--R.heap_max]=R.heap[1],((R,J)=>{const B=J.dyn_tree,Q=J.max_code,h=J.stat_desc.static_tree,N=J.stat_desc.has_stree,r=J.stat_desc.extra_bits,q=J.stat_desc.extra_base,e=J.stat_desc.max_length;let D,l,E,O,n,P,A=0;for(O=0;O<=y;O++)R.bl_count[O]=0;for(B[2*R.heap[R.heap_max]+1]=0,D=R.heap_max+1;D<573;D++)l=R.heap[D],O=B[2*B[2*l+1]+1]+1,O>e&&(O=e,A++),B[2*l+1]=O,l>Q||(R.bl_count[O]++,n=0,l>=q&&(n=r[l-q]),P=B[2*l],R.opt_len+=P*(O+n),N&&(R.static_len+=P*(h[2*l+1]+n)));if(0!==A){do{for(O=e-1;0===R.bl_count[O];)O--;R.bl_count[O]--,R.bl_count[O+1]+=2,R.bl_count[e]--,A-=2}while(A>0);for(O=e;0!==O;O--)for(l=R.bl_count[O];0!==l;)E=R.heap[--D],E>Q||(B[2*E+1]!==O&&(R.opt_len+=(O-B[2*E+1])*B[2*E],B[2*E+1]=O),l--)}})(R,J),H(B,D,R.bl_count)},W=(R,J,B)=>{let Q,h,y=-1,N=J[1],r=0,q=7,e=4;for(0===N&&(q=138,e=3),J[2*(B+1)+1]=65535,Q=0;Q<=B;Q++)h=N,N=J[2*(Q+1)+1],++r<q&&h===N||(r<e?R.bl_tree[2*h]+=r:0!==h?(h!==y&&R.bl_tree[2*h]++,R.bl_tree[32]++):r<=10?R.bl_tree[34]++:R.bl_tree[36]++,r=0,y=h,0===N?(q=138,e=3):h===N?(q=6,e=3):(q=7,e=4))},k=(R,J,B)=>{let Q,h,y=-1,N=J[1],r=0,q=7,e=4;for(0===N&&(q=138,e=3),Q=0;Q<=B;Q++)if(h=N,N=J[2*(Q+1)+1],!(++r<q&&h===N)){if(r<e)do{V(R,h,R.bl_tree)}while(0!==--r);else 0!==h?(h!==y&&(V(R,h,R.bl_tree),r--),V(R,16,R.bl_tree),I(R,r-3,2)):r<=10?(V(R,17,R.bl_tree),I(R,r-3,3)):(V(R,18,R.bl_tree),I(R,r-11,7));r=0,y=h,0===N?(q=138,e=3):h===N?(q=6,e=3):(q=7,e=4)}};let Y=!1;const G=(R,J,B,Q)=>{I(R,0+(Q?1:0),3),((R,J,B,Q)=>{X(R),Q&&(x(R,B),x(R,~B)),R.pending_buf.set(R.window.subarray(J,J+B),R.pending),R.pending+=B})(R,J,B,!0)};R.exports._tr_init=R=>{Y||((()=>{let R,J,B,e,a;const s=new Array(16);for(B=0,e=0;e<28;e++)for(n[e]=B,R=0;R<1<<N[e];R++)O[B++]=e;for(O[B-1]=e,a=0,e=0;e<16;e++)for(P[e]=a,R=0;R<1<<r[e];R++)E[a++]=e;for(a>>=7;e<h;e++)for(P[e]=a<<7,R=0;R<1<<r[e]-7;R++)E[256+a++]=e;for(J=0;J<=y;J++)s[J]=0;for(R=0;R<=143;)D[2*R+1]=8,R++,s[8]++;for(;R<=255;)D[2*R+1]=9,R++,s[9]++;for(;R<=279;)D[2*R+1]=7,R++,s[7]++;for(;R<=287;)D[2*R+1]=8,R++,s[8]++;for(H(D,287,s),R=0;R<h;R++)l[2*R+1]=5,l[2*R]=M(R,5);u=new A(D,N,257,Q,y),S=new A(l,r,0,h,y),f=new A(new Array(0),q,0,19,7)})(),Y=!0),R.l_desc=new a(R.dyn_ltree,u),R.d_desc=new a(R.dyn_dtree,S),R.bl_desc=new a(R.bl_tree,f),R.bi_buf=0,R.bi_valid=0,d(R)},R.exports._tr_stored_block=G,R.exports._tr_flush_block=(R,J,Q,h)=>{let y,N,r=0;R.level>0?(2===R.strm.data_type&&(R.strm.data_type=(R=>{let J,Q=4093624447;for(J=0;J<=31;J++,Q>>>=1)if(1&Q&&0!==R.dyn_ltree[2*J])return 0;if(0!==R.dyn_ltree[18]||0!==R.dyn_ltree[20]||0!==R.dyn_ltree[26])return 1;for(J=32;J<B;J++)if(0!==R.dyn_ltree[2*J])return 1;return 0})(R)),i(R,R.l_desc),i(R,R.d_desc),r=(R=>{let J;for(W(R,R.dyn_ltree,R.l_desc.max_code),W(R,R.dyn_dtree,R.d_desc.max_code),i(R,R.bl_desc),J=18;J>=3&&0===R.bl_tree[2*e[J]+1];J--);return R.opt_len+=3*(J+1)+5+5+4,J})(R),y=R.opt_len+3+7>>>3,N=R.static_len+3+7>>>3,N<=y&&(y=N)):y=N=Q+5,Q+4<=y&&-1!==J?G(R,J,Q,h):4===R.strategy||N===y?(I(R,2+(h?1:0),3),p(R,D,l)):(I(R,4+(h?1:0),3),((R,J,B,Q)=>{let h;for(I(R,J-257,5),I(R,B-1,5),I(R,Q-4,4),h=0;h<Q;h++)I(R,R.bl_tree[2*e[h]+1],3);k(R,R.dyn_ltree,J-1),k(R,R.dyn_dtree,B-1)})(R,R.l_desc.max_code+1,R.d_desc.max_code+1,r+1),p(R,R.dyn_ltree,R.dyn_dtree)),d(R),h&&X(R)},R.exports._tr_tally=(R,J,Q)=>(R.pending_buf[R.d_buf+2*R.last_lit]=J>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&J,R.pending_buf[R.l_buf+R.last_lit]=255&Q,R.last_lit++,0===J?R.dyn_ltree[2*Q]++:(R.matches++,J--,R.dyn_ltree[2*(O[Q]+B+1)]++,R.dyn_dtree[2*s(J)]++),R.last_lit===R.lit_bufsize-1),R.exports._tr_align=R=>{I(R,2,3),V(R,256,D),(R=>{16===R.bi_valid?(x(R,R.bi_buf),R.bi_buf=0,R.bi_valid=0):R.bi_valid>=8&&(R.pending_buf[R.pending++]=255&R.bi_buf,R.bi_buf>>=8,R.bi_valid-=8)})(R)}},12365:R=>{"use strict";R.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.eJ="",this.state=null,this.data_type=2,this.adler=0}},11994:R=>{function J(R,J,B){for(var Q=R.length,h=-1/0,y=1/0,N=0;N<Q;N++){var r=(B[0][N]-R[N])/J[N],q=(B[1][N]-R[N])/J[N];if(r>q){var e=r;r=q,q=e}if(q<h||r>y)return 1/0;r>h&&(h=r),q<y&&(y=q)}return h>y?1/0:h}R.exports=function(R,B,Q,h){var y=J(B,Q,h);if(y===1/0)R=null;else{R=R||[];for(var N=0;N<B.length;N++)R[N]=B[N]+Q[N]*y}return R},R.exports.distance=J},13372:(R,J,B)=>{"use strict";B.d(J,{b:()=>N});var Q=B(25);const h=Q.useLayoutEffect;const y=function(R){var J=(0,Q.useRef)(R);return h((function(){J.current=R})),J};var N=function(R){var J=y(R);(0,Q.NJ)((function(){var R=function(R){var B;if(null!=J.current&&(B=J.current(R)),R.defaultPrevented&&(R.returnValue=""),"string"===typeof B)return R.returnValue=B,B};return window.addEventListener("beforeunload",R),function(){window.removeEventListener("beforeunload",R)}}),[])}},13319:(R,J,B)=>{"use strict";var Q=B(13324),h=Array.prototype.concat,y=Array.prototype.slice,N=R.exports=function(R){for(var J=[],B=0,N=R.length;B<N;B++){var r=R[B];Q(r)?J=h.call(J,y.call(r)):J.push(r)}return J};N.wrap=function(R){return function(){return R(N(arguments))}}},13324:R=>{R.exports=function(R){return!(!R||"string"===typeof R)&&(R instanceof Array||Array.isArray(R)||R.length>=0&&(R.splice instanceof Function||Object.getOwnPropertyDescriptor(R,R.length-1)&&"String"!==R.constructor.name))}},12273:(R,J,B)=>{var Q=B(12276);function h(R){for(var J,B,h=0,y=R.length,N=0;N<R.length;){for(J=R[N],B=0;N<y&&R[N]===J;)++N,++B;h+=Q.log2(B)/7|0,h+=Q.log2(J>>>0)/7|0,h+=2}return h}J.size=h,J.encode=function(R,J){J||(J=new Uint8Array(h(R)));for(var B,Q,y=0,N=J.length,r=0;r<R.length;){for(B=R[r],Q=0;r<R.length&&R[r]===B;)++r,++Q;for(;y<N&&Q>=128;)J[y++]=128+(127&Q),Q>>>=7;if(y>=N)throw new Error("RLE buffer overflow");for(J[y++]=Q,B>>>=0;y<N&&B>=128;)J[y++]=128+(127&B),B>>>=7;if(y>=N)throw new Error("RLE buffer overflow");J[y++]=B}return J},J.decode=function(R,J){for(var B,Q,h,y,N=J.length,r=R.length,q=0,e=0;e<r;){for(B=0,Q=0;e<r&&R[e]>=128;)B+=(127&R[e++])<<Q,Q+=7;if(B+=R[e++]<<Q,e>=r)throw new Error("RLE buffer underrun");if(q+B>N)throw new Error("Chunk buffer overflow");for(h=0,Q=0;e<r&&R[e]>=128;)h+=(127&R[e++])<<Q,Q+=7;if(e>=r)throw new Error("RLE buffer underrun");for(h+=R[e++]<<Q,y=0;y<B;++y)J[q++]=h}return J}},12276:(R,J)=>{"use strict";function B(R){var J=32;return(R&=-R)&&J--,65535&R&&(J-=16),16711935&R&&(J-=8),252645135&R&&(J-=4),858993459&R&&(J-=2),1431655765&R&&(J-=1),J}J.INT_BITS=32,J.INT_MAX=2147483647,J.INT_MIN=-1<<31,J.sign=function(R){return(R>0)-(R<0)},J.abs=function(R){var J=R>>31;return(R^J)-J},J.min=function(R,J){return J^(R^J)&-(R<J)},J.max=function(R,J){return R^(R^J)&-(R<J)},J.isPow2=function(R){return!(R&R-1)&&!!R},J.log2=function(R){var J,B;return J=(R>65535)<<4,J|=B=((R>>>=J)>255)<<3,J|=B=((R>>>=B)>15)<<2,(J|=B=((R>>>=B)>3)<<1)|(R>>>=B)>>1},J.log10=function(R){return R>=1e9?9:R>=1e8?8:R>=1e7?7:R>=1e6?6:R>=1e5?5:R>=1e4?4:R>=1e3?3:R>=100?2:R>=10?1:0},J.popCount=function(R){return 16843009*((R=(858993459&(R-=R>>>1&1431655765))+(R>>>2&858993459))+(R>>>4)&252645135)>>>24},J.countTrailingZeros=B,J.nextPow2=function(R){return R+=0===R,--R,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)+1},J.prevPow2=function(R){return R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)-(R>>>1)},J.parity=function(R){return R^=R>>>16,R^=R>>>8,R^=R>>>4,27030>>>(R&=15)&1};var Q=new Array(256);!function(R){for(var J=0;J<256;++J){var B=J,Q=J,h=7;for(B>>>=1;B;B>>>=1)Q<<=1,Q|=1&B,--h;R[J]=Q<<h&255}}(Q),J.reverse=function(R){return Q[255&R]<<24|Q[R>>>8&255]<<16|Q[R>>>16&255]<<8|Q[R>>>24&255]},J.interleave2=function(R,J){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))|(J=1431655765&((J=858993459&((J=252645135&((J=16711935&((J&=65535)|J<<8))|J<<4))|J<<2))|J<<1))<<1},J.deinterleave2=function(R,J){return(R=65535&((R=16711935&((R=252645135&((R=858993459&((R=R>>>J&1431655765)|R>>>1))|R>>>2))|R>>>4))|R>>>16))<<16>>16},J.interleave3=function(R,J,B){return R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2),(R|=(J=1227133513&((J=3272356035&((J=251719695&((J=4278190335&((J&=1023)|J<<16))|J<<8))|J<<4))|J<<2))<<1)|(B=1227133513&((B=3272356035&((B=251719695&((B=4278190335&((B&=1023)|B<<16))|B<<8))|B<<4))|B<<2))<<2},J.deinterleave3=function(R,J){return(R=1023&((R=4278190335&((R=251719695&((R=3272356035&((R=R>>>J&1227133513)|R>>>2))|R>>>4))|R>>>8))|R>>>16))<<22>>22},J.nextCombination=function(R){var J=R|R-1;return J+1|(~J&-~J)-1>>>B(R)+1}},12303:R=>{"use strict";R.exports=function(R,J,B,Q){var h=self||window;try{try{var y;try{y=new h.Blob([R])}catch(e){(y=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(R),y=y.getBlob()}var N=h.URL||h.webkitURL,r=N.createObjectURL(y),q=new h[J](r,B);return N.revokeObjectURL(r),q}catch(e){return new h[J]("data:application/javascript,".concat(encodeURIComponent(R)),B)}}catch(e){if(!Q)throw Error("Inline worker is not supported");return new h[J](Q,B)}}},11980:(R,J,B)=>{"use strict";function Q(R,J,B,Q,h){var y={};return Object.keys(Q).forEach((function(R){y[R]=Q[R]})),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=B.slice().reverse().reduce((function(B,Q){return Q(R,J,B)||B}),y),h&&void 0!==y.initializer&&(y.value=y.initializer?y.initializer.call(h):void 0,y.initializer=void 0),void 0===y.initializer&&(Object.defineProperty(R,J,y),y=null),y}B.d(J,{b:()=>Q})},11974:(R,J,B)=>{"use strict";function Q(R,J,B,Q){B&&Object.defineProperty(R,J,{enumerable:B.enumerable,configurable:B.configurable,writable:B.writable,value:B.initializer?B.initializer.call(Q):void 0})}B.d(J,{e:()=>Q})},13361:(R,J,B)=>{"use strict";B.d(J,{c:()=>N,g:()=>l,k:()=>r,m:()=>y,p:()=>q,t:()=>h,u:()=>e,y:()=>D});var Q=B(11392);class h{constructor(){this._easingMode=h.EASINGMODE_EASEIN}setEasingMode(R){const J=Math.min(Math.max(R,0),2);this._easingMode=J}getEasingMode(){return this._easingMode}easeInCore(R){throw new Error("You must implement this method")}ease(R){switch(this._easingMode){case h.EASINGMODE_EASEIN:return this.easeInCore(R);case h.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-R)}return R>=.5?.5*(1-this.easeInCore(2*(1-R)))+.5:.5*this.easeInCore(2*R)}}h.EASINGMODE_EASEIN=0,h.EASINGMODE_EASEOUT=1,h.EASINGMODE_EASEINOUT=2;class y extends h{easeInCore(R){return R=Math.max(0,Math.min(1,R)),1-Math.sqrt(1-R*R)}}class N extends h{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=R}easeInCore(R){const J=Math.max(0,this.amplitude);return Math.pow(R,3)-R*J*Math.sin(3.141592653589793*R)}}class r extends h{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=R,this.bounciness=J}easeInCore(R){const J=Math.max(0,this.bounces);let B=this.bounciness;B<=1&&(B=1.001);const Q=Math.pow(B,J),h=1-B,y=(1-Q)/h+.5*Q,N=R*y,r=Math.log(-N*(1-B)+1)/Math.log(B),q=Math.floor(r),e=q+1,D=(1-Math.pow(B,q))/(h*y),l=.5*(D+(1-Math.pow(B,e))/(h*y)),E=R-l,O=l-D;return-Math.pow(1/B,J-q)/(O*O)*(E-O)*(E+O)}}class q extends h{easeInCore(R){return R*R*R}}class e extends h{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=R,this.springiness=J}easeInCore(R){let J;const B=Math.max(0,this.oscillations),Q=Math.max(0,this.springiness);return J=0==Q?R:(Math.exp(Q*R)-1)/(Math.exp(Q)-1),J*Math.sin((6.283185307179586*B+1.5707963267948966)*R)}}class D extends h{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=R}easeInCore(R){return this.exponent<=0?R:(Math.exp(this.exponent*R)-1)/(Math.exp(this.exponent)-1)}}class l extends h{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=R,this.y1=J,this.x2=B,this.y2=Q}easeInCore(R){return Q.d.Interpolate(R,this.x1,this.y1,this.x2,this.y2)}}},12819:(R,J,B)=>{"use strict";B.d(J,{b:()=>N});var Q=B(11186),h=B(11193),y=B(11599);class N extends y.b{get _matrix(){return this._compose(),this.YE}set _matrix(R){(R.updateFlag!==this.YE.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.YE.h(R),this._markAsDirtyAndDecompose())}constructor(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(R,J.IR(),!1),this.name=R,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=J,this.YE=(null===h||void 0===h?void 0:h.clone())??Q.Matrix.Identity(),this._restMatrix=y??this.YE.clone(),this._bindMatrix=N??this.YE.clone(),this._index=r,this._absoluteMatrix=new Q.Matrix,this._absoluteBindMatrix=new Q.Matrix,this._absoluteInverseBindMatrix=new Q.Matrix,this._finalMatrix=new Q.Matrix,J.bones.push(this),this.setParent(B,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(R){this.setParent(R)}setParent(R){let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==R){if(this.parent){const R=this.parent.children.indexOf(this);-1!==R&&this.parent.children.splice(R,1)}this._parentNode=R,this.parent&&this.parent.children.push(this),J&&this._updateAbsoluteBindMatrices(),this.ND()}}getLocalMatrix(){return this._compose(),this.YE}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(R){this._restMatrix.h(R)}setRestPose(R){this.setRestMatrix(R)}getBindPose(){return this.getBindMatrix()}setBindMatrix(R){this.th(R)}setBindPose(R){this.setBindMatrix(R)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const R=Q.TmpVectors.nJ[0],J=Q.TmpVectors.Quaternion[0],B=Q.TmpVectors.nJ[1];this.getRestMatrix().decompose(R,J,B),this._linkedTransformNode.position.h(B),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Q.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.h(J),this._linkedTransformNode.ur.h(R)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(R){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=R,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.wr}set position(R){this._decompose(),this.wr.h(R),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(R){this.setRotation(R)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(R){this.setRotationQuaternion(R)}get ur(){return this.getScale()}set ur(R){this.setScale(R)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Q.nJ.Zero(),this._localRotation=Q.Quaternion.Zero(),this.wr=Q.nJ.Zero()),this.YE.decompose(this._localScaling,this._localRotation,this.wr))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Q.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.wr,this.YE)):this._needToCompose=!1)}th(R){let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],B=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.h(R),J&&this._updateAbsoluteBindMatrices(),B?this._matrix=R:this.ND()}_updateAbsoluteBindMatrices(R){let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R||(R=this._bindMatrix),this.parent?R.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.h(R),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),J)for(let B=0;B<this.children.length;B++)this.children[B]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ND(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ND(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ND(),this._needToDecompose=!0}_updatePosition(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2?arguments[2]:void 0,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const y=this.getLocalMatrix();if(0==J)h?(y.addAtIndex(12,R.x),y.addAtIndex(13,R.y),y.addAtIndex(14,R.z)):y.setTranslationFromFloats(R.x,R.y,R.z);else{let J=null;B&&(J=B.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=N._TmpMats[0],q=N._TmpVecs[0];this.parent?B&&J?(r.h(this.parent.getAbsoluteMatrix()),r.multiplyToRef(J,r)):r.h(this.parent.getAbsoluteMatrix()):Q.Matrix.IdentityToRef(r),h&&r.setTranslationFromFloats(0,0,0),r.invert(),Q.nJ.TransformCoordinatesToRef(R,r,q),h?(y.addAtIndex(12,q.x),y.addAtIndex(13,q.y),y.addAtIndex(14,q.z)):y.setTranslationFromFloats(q.x,q.y,q.z)}this._markAsDirtyAndDecompose()}translate(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2?arguments[2]:void 0;this._updatePosition(R,J,B,!0)}setPosition(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2?arguments[2]:void 0;this._updatePosition(R,J,B,!1)}setAbsolutePosition(R,J){this.setPosition(R,1,J)}scale(R,J,B){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const y=this.getLocalMatrix(),r=N._TmpMats[0];Q.Matrix.ScalingToRef(R,J,B,r),r.multiplyToRef(y,y),r.invert();for(const Q of this.children){const h=Q.getLocalMatrix();h.multiplyToRef(r,h),h.multiplyAtIndex(12,R),h.multiplyAtIndex(13,J),h.multiplyAtIndex(14,B),Q._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),h)for(const Q of this.children)Q.scale(R,J,B,h)}setScale(R){this._decompose(),this._localScaling.h(R),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(R){this._decompose(),R.h(this._localScaling)}setYawPitchRoll(R,J,B){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=arguments.length>4?arguments[4]:void 0;if(0===h){const r=N._TmpQuat;return Q.Quaternion.RotationYawPitchRollToRef(R,J,B,r),void this.setRotationQuaternion(r,h,y)}const r=N._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,y))return;const q=N._TmpMats[1];Q.Matrix.RotationYawPitchRollToRef(R,J,B,q),r.multiplyToRef(q,q),this._rotateWithMatrix(q,h,y)}rotate(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3?arguments[3]:void 0;const y=N._TmpMats[0];y.setTranslationFromFloats(0,0,0),Q.Matrix.RotationAxisToRef(R,J,y),this._rotateWithMatrix(y,B,h)}setAxisAngle(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3?arguments[3]:void 0;if(0===B){const y=N._TmpQuat;return Q.Quaternion.RotationAxisToRef(R,J,y),void this.setRotationQuaternion(y,B,h)}const y=N._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(y,h))return;const r=N._TmpMats[1];Q.Matrix.RotationAxisToRef(R,J,r),y.multiplyToRef(r,r),this._rotateWithMatrix(r,B,h)}setRotation(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(R.y,R.x,R.z,J,B)}setRotationQuaternion(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2?arguments[2]:void 0;if(0===J)return this._decompose(),this._localRotation.h(R),void this._markAsDirtyAndCompose();const h=N._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,B))return;const y=N._TmpMats[1];Q.Matrix.FromQuaternionToRef(R,y),h.multiplyToRef(y,y),this._rotateWithMatrix(y,J,B)}setRotationMatrix(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2?arguments[2]:void 0;if(0===J){const h=N._TmpQuat;return Q.Quaternion.FromRotationMatrixToRef(R,h),void this.setRotationQuaternion(h,J,B)}const h=N._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,B))return;const y=N._TmpMats[1];y.h(R),h.multiplyToRef(R,y),this._rotateWithMatrix(y,J,B)}_rotateWithMatrix(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2?arguments[2]:void 0;const Q=this.getLocalMatrix(),h=Q.m[12],y=Q.m[13],r=Q.m[14],q=this.getParent(),e=N._TmpMats[3],D=N._TmpMats[4];q&&1==J?(B?(e.h(B.getWorldMatrix()),q.getAbsoluteMatrix().multiplyToRef(e,e)):e.h(q.getAbsoluteMatrix()),D.h(e),D.invert(),Q.multiplyToRef(e,Q),Q.multiplyToRef(R,Q),Q.multiplyToRef(D,Q)):1==J&&B?(e.h(B.getWorldMatrix()),D.h(e),D.invert(),Q.multiplyToRef(e,Q),Q.multiplyToRef(R,Q),Q.multiplyToRef(D,Q)):Q.multiplyToRef(R,Q),Q.setTranslationFromFloats(h,y,r),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(R,J){const B=N._TmpMats[2];return R.h(this.getAbsoluteMatrix()),J?(R.multiplyToRef(J.getWorldMatrix(),R),Q.Matrix.ScalingToRef(J.ur.x,J.ur.y,J.ur.z,B)):Q.Matrix.IdentityToRef(B),R.invert(),!isNaN(R.m[0])&&(B.multiplyAtIndex(0,this._scalingDeterminant),R.multiplyToRef(B,R),!0)}Bh(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const B=Q.nJ.Zero();return this.getPositionToRef(R,J,B),B}getPositionToRef(){let R=arguments.length>1?arguments[1]:void 0,J=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const R=this.getLocalMatrix();J.x=R.m[12],J.y=R.m[13],J.z=R.m[14]}else{let B=null;R&&(B=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let Q=N._TmpMats[0];R&&B?(Q.h(this.getAbsoluteMatrix()),Q.multiplyToRef(B,Q)):Q=this.getAbsoluteMatrix(),J.x=Q.m[12],J.y=Q.m[13],J.z=Q.m[14]}}getAbsolutePosition(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const J=Q.nJ.Zero();return this.getPositionToRef(1,R,J),J}getAbsolutePositionToRef(R,J){this.getPositionToRef(1,R,J)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.YE.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.h(this.YE);const R=this._skeleton.getPoseMatrix();R&&this._absoluteMatrix.multiplyToRef(R,this._absoluteMatrix)}const R=this.children,J=R.length;for(let B=0;B<J;B++)R[B].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}aq(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const B=Q.nJ.Zero();return this.getDirectionToRef(R,J,B),B}getDirectionToRef(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2?arguments[2]:void 0,h=null;J&&(h=J.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const y=N._TmpMats[0];y.h(this.getAbsoluteMatrix()),J&&h&&y.multiplyToRef(h,y),Q.nJ.TransformNormalToRef(R,y,B),B.normalize()}getRotation(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const B=Q.nJ.Zero();return this.getRotationToRef(R,J,B),B}getRotationToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2?arguments[2]:void 0;const Q=N._TmpQuat;this.getRotationQuaternionToRef(R,J,Q),Q.toEulerAnglesToRef(B)}getRotationQuaternion(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const B=Q.Quaternion.Identity();return this.getRotationQuaternionToRef(R,J,B),B}getRotationQuaternionToRef(){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),J.h(this._localRotation);else{const B=N._TmpMats[0],Q=this.getAbsoluteMatrix();R?Q.multiplyToRef(R.getWorldMatrix(),B):B.h(Q),B.multiplyAtIndex(0,this._scalingDeterminant),B.multiplyAtIndex(1,this._scalingDeterminant),B.multiplyAtIndex(2,this._scalingDeterminant),B.decompose(void 0,J,void 0)}}getRotationMatrix(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,J=arguments.length>1?arguments[1]:void 0;const B=Q.Matrix.Identity();return this.getRotationMatrixToRef(R,J,B),B}getRotationMatrixToRef(){let R=arguments.length>1?arguments[1]:void 0,J=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(J);else{const B=N._TmpMats[0],Q=this.getAbsoluteMatrix();R?Q.multiplyToRef(R.getWorldMatrix(),B):B.h(Q),B.multiplyAtIndex(0,this._scalingDeterminant),B.multiplyAtIndex(1,this._scalingDeterminant),B.multiplyAtIndex(2,this._scalingDeterminant),B.getRotationMatrixToRef(J)}}getAbsolutePositionFromLocal(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const B=Q.nJ.Zero();return this.getAbsolutePositionFromLocalToRef(R,J,B),B}getAbsolutePositionFromLocalToRef(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2?arguments[2]:void 0,h=null;J&&(h=J.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const y=N._TmpMats[0];y.h(this.getAbsoluteMatrix()),J&&h&&y.multiplyToRef(h,y),Q.nJ.TransformCoordinatesToRef(R,y,B)}getLocalPositionFromAbsolute(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const B=Q.nJ.Zero();return this.getLocalPositionFromAbsoluteToRef(R,J,B),B}getLocalPositionFromAbsoluteToRef(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2?arguments[2]:void 0,h=null;J&&(h=J.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const y=N._TmpMats[0];y.h(this.getAbsoluteMatrix()),J&&h&&y.multiplyToRef(h,y),y.invert(),Q.nJ.TransformCoordinatesToRef(R,y,B)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const R=this._skeleton.bones.indexOf(this);if(-1!==R&&this._skeleton.bones.splice(R,1),this._parentNode&&this._parentNode.children){const R=this._parentNode.children,J=R.indexOf(this);-1!==J&&R.splice(J,1)}super.dispose()}}N._TmpVecs=(0,h.e)(2,Q.nJ.Zero),N._TmpQuat=Q.Quaternion.Identity(),N._TmpMats=(0,h.e)(5,Q.Matrix.Identity)},13355:(R,J,B)=>{"use strict";B.d(J,{e:()=>i});var Q=B(11167),h=B(11176),y=B(11032),N=B(11186),r=B(11201),q=B(11599),e=B(11628),D=B(11455),l=B(11047),E=B(11189);class O{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(R){this._zoomStopsAnimation=R}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(R){this._idleRotationSpeed=R}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(R){this._idleRotationWaitTime=R}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(R){this._idleRotationSpinupTime=R}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(R){this._attachedCamera=R;const J=this._attachedCamera.IR();this._onPrePointerObservableObserver=J.onPrePointerObservable.add((R=>{R.type!==D.e.POINTERDOWN?R.type===D.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const R=l.c.Now;let J=0;null!=this._lastFrameTime&&(J=R-this._lastFrameTime),this._lastFrameTime=R,this._applyUserInteraction();const B=R-this._lastInteractionTime-this._idleRotationWaitTime,Q=Math.max(Math.min(B/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*Q,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(J/1e3))}))}detach(){if(!this._attachedCamera)return;const R=this._attachedCamera.IR();this._onPrePointerObservableObserver&&R.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(R){this._lastInteractionTime=R??l.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<E.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let R=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(R=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?R:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=l.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var n=B(13361),P=B(11718);class A{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(R){if(this._autoTransitionRange===R)return;this._autoTransitionRange=R;const J=this._attachedCamera;J&&(R?this._onMeshTargetChangedObserver=J.onMeshTargetChangedObservable.add((R=>{if(R&&(R.ny(!0),R.getBoundingInfo)){const J=R.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*J,this.upperRadiusTransitionRange=.05*J}})):this._onMeshTargetChangedObserver&&J.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(R){this._attachedCamera=R,this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(R){return!!this._attachedCamera&&(this._attachedCamera.radius===R&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(R){if(!this._attachedCamera)return;this._radiusBounceTransition||(A.EasingFunction.setEasingMode(A.EasingMode),this._radiusBounceTransition=P.c.CreateAnimation("radius",P.c.ANIMATIONTYPE_FLOAT,60,A.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const J=P.c.TransitionTo("radius",this._attachedCamera.radius+R,this._attachedCamera,this._attachedCamera.IR(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));J&&this._animatables.push(J)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}A.EasingFunction=new n.c(.3),A.EasingMode=n.t.EASINGMODE_EASEOUT;class u{constructor(){this.onTargetFramingAnimationEndObservable=new y.e,this._mode=u.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(R){this._mode=R}get mode(){return this._mode}set radiusScale(R){this._radiusScale=R}get radiusScale(){return this._radiusScale}set positionScale(R){this._positionScale=R}get positionScale(){return this._positionScale}set defaultElevation(R){this._defaultElevation=R}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(R){this._elevationReturnTime=R}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(R){this._elevationReturnWaitTime=R}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(R){this._zoomStopsAnimation=R}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(R){this._framingTime=R}get framingTime(){return this._framingTime}init(){}attach(R){this._attachedCamera=R;const J=this._attachedCamera.IR();u.EasingFunction.setEasingMode(u.EasingMode),this._onPrePointerObservableObserver=J.onPrePointerObservable.add((R=>{R.type!==D.e.POINTERDOWN?R.type===D.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=R.onMeshTargetChangedObservable.add((R=>{R&&R.getBoundingInfo&&this.zoomOnMesh(R,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const R=this._attachedCamera.IR();this._onPrePointerObservableObserver&&R.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.ny(!0);const Q=R.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(Q.minimumWorld,Q.maximumWorld,J,B)}zoomOnMeshHierarchy(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.ny(!0);const Q=R.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(Q.min,Q.max,J,B)}zoomOnMeshesHierarchy(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new N.nJ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new N.nJ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let y=0;y<R.length;y++){const J=R[y].getHierarchyBoundingVectors(!0);N.nJ.CheckExtends(J.min,Q,h),N.nJ.CheckExtends(J.max,Q,h)}this.zoomOnBoundingInfo(Q,h,J,B)}zoomOnBoundingInfo(R,J){let B,Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const y=R.y,r=y+(J.y-y)*this._positionScale,q=J.PJ(R).scale(.5);if(!isFinite(r))return!1;if(Q)B=new N.nJ(0,r,0);else{const J=R.add(q);B=new N.nJ(J.x,r,J.z)}this._vectorTransition||(this._vectorTransition=P.c.CreateAnimation("target",P.c.ANIMATIONTYPE_VECTOR3,60,u.EasingFunction)),this._betaIsAnimating=!0;let e=P.c.TransitionTo("target",B,this._attachedCamera,this._attachedCamera.IR(),60,this._vectorTransition,this._framingTime);e&&this._animatables.push(e);let D=0;if(this._mode===u.FitFrustumSidesMode){const B=this._calculateLowerRadiusFromModelBoundingSphere(R,J);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=q.length()+this._attachedCamera.mh),D=B}else this._mode===u.IgnoreBoundsSizeMode&&(D=this._calculateLowerRadiusFromModelBoundingSphere(R,J),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.mh));if(this.autoCorrectCameraLimitsAndSensibility){const B=J.PJ(R).length();this._attachedCamera.panningSensibility=5e3/B,this._attachedCamera.wheelPrecision=100/D}return this._radiusTransition||(this._radiusTransition=P.c.CreateAnimation("radius",P.c.ANIMATIONTYPE_FLOAT,60,u.EasingFunction)),e=P.c.TransitionTo("radius",D,this._attachedCamera,this._attachedCamera.IR(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),h&&h(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),e&&this._animatables.push(e),!0}_calculateLowerRadiusFromModelBoundingSphere(R,J){const B=this._attachedCamera;if(!B)return 0;let Q=B._calculateLowerRadiusFromModelBoundingSphere(R,J,this._radiusScale);return B.lowerRadiusLimit&&this._mode===u.IgnoreBoundsSizeMode&&(Q=Q<B.lowerRadiusLimit?B.lowerRadiusLimit:Q),B.upperRadiusLimit&&(Q=Q>B.upperRadiusLimit?B.upperRadiusLimit:Q),Q}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const R=l.c.Now-this._lastInteractionTime,J=.5*Math.PI-this._defaultElevation,B=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>B&&R>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=P.c.CreateAnimation("beta",P.c.ANIMATIONTYPE_FLOAT,60,u.EasingFunction));const R=P.c.TransitionTo("beta",J,this._attachedCamera,this._attachedCamera.IR(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));R&&this._animatables.push(R)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=l.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}u.EasingFunction=new n.y,u.EasingMode=n.t.EASINGMODE_EASEINOUT,u.IgnoreBoundsSizeMode=0,u.FitFrustumSidesMode=1;var S=B(11634),f=B(11670),a=B(12816),s=B(11030);class x{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(R){R=s.Tools.BackCompatCameraNoPreventDefault(arguments);const J=this.camera.getEngine(),B=J.getInputElement();let Q=0,h=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=y=>{var N,r;const q=y.event,e="touch"===q.pointerType;if(y.type!==D.e.POINTERMOVE&&-1===this.buttons.indexOf(q.button))return;const l=q.target;if(this._altKey=q.altKey,this._ctrlKey=q.ctrlKey,this._metaKey=q.metaKey,this._shiftKey=q.shiftKey,this._buttonsPressed=q.buttons,J.isPointerLock){const R=q.movementX,J=q.movementY;this.onTouch(null,R,J),this._pointA=null,this._pointB=null}else{if(y.type!==D.e.POINTERDOWN&&y.type!==D.e.POINTERDOUBLETAP&&e&&(null===(N=this._pointA)||void 0===N?void 0:N.pointerId)!==q.pointerId&&(null===(r=this._pointB)||void 0===r?void 0:r.pointerId)!==q.pointerId)return;if(y.type!==D.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!e)if(y.type===D.e.POINTERDOUBLETAP)this.onDoubleTap(q.pointerType);else if(y.type!==D.e.POINTERUP||this._currentMousePointerIdDown!==q.pointerId&&!e){if(y.type===D.e.POINTERMOVE)if(R||q.preventDefault(),this._pointA&&null===this._pointB){const R=q.clientX-this._pointA.x,J=q.clientY-this._pointA.y;this._pointA.x=q.clientX,this._pointA.y=q.clientY,this.onTouch(this._pointA,R,J)}else if(this._pointA&&this._pointB){const R=this._pointA.pointerId===q.pointerId?this._pointA:this._pointB;R.x=q.clientX,R.y=q.clientY;const J=this._pointA.x-this._pointB.x,B=this._pointA.y-this._pointB.y,N=J*J+B*B,r={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:q.pointerId,type:y.type};this.onMultiTouch(this._pointA,this._pointB,Q,N,h,r),h=r,Q=N}}else{try{null===l||void 0===l||l.releasePointerCapture(q.pointerId)}catch(E){}e||(this._pointB=null),J._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==q.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==q.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==Q||h)&&(this.onMultiTouch(this._pointA,this._pointB,Q,0,h,null),Q=0,h=null),this._currentMousePointerIdDown=-1,this.onButtonUp(q),R||q.preventDefault()}else{try{null===l||void 0===l||l.setPointerCapture(q.pointerId)}catch(E){}if(null===this._pointA)this._pointA={x:q.clientX,y:q.clientY,pointerId:q.pointerId,type:q.pointerType};else{if(null!==this._pointB)return;this._pointB={x:q.clientX,y:q.clientY,pointerId:q.pointerId,type:q.pointerType}}-1!==this._currentMousePointerIdDown||e||(this._currentMousePointerIdDown=q.pointerId),this.onButtonDown(q),R||(q.preventDefault(),B&&B.focus())}}},this._observer=this.camera.IR()._inputManager._addCameraPointerObserver(this._pointerInput,D.e.POINTERDOWN|D.e.POINTERUP|D.e.POINTERMOVE|D.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,Q=0,h=null,this.onLostFocus()},this._contextMenuBind=R=>this.onContextMenu(R),B&&B.addEventListener("contextmenu",this._contextMenuBind,!1);const y=this.camera.IR().getEngine().getHostWindow();y&&s.Tools.RegisterTopRootEvents(y,[{name:"blur",handler:this._onLostFocus}])}vl(){if(this._onLostFocus){const R=this.camera.IR().getEngine().getHostWindow();R&&s.Tools.UnregisterTopRootEvents(R,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.IR()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const R=this.camera.IR().getEngine().getInputElement();R&&R.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(R){}onTouch(R,J,B){}onMultiTouch(R,J,B,Q,h,y){}onContextMenu(R){R.preventDefault()}onButtonDown(R){}onButtonUp(R){}onLostFocus(){}}(0,Q.e)([(0,h.N)()],x.prototype,"buttons",void 0);class I extends x{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(R,J){if(0!==this.panningSensibility&&R&&J){const B=J.x-R.x,Q=J.y-R.y;this.camera.inertialPanningX+=-B/this.panningSensibility,this.camera.inertialPanningY+=Q/this.panningSensibility}}_computePinchZoom(R,J){const B=this.camera.radius||I.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=B*Math.sqrt(R)/Math.sqrt(J):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(J-R)*B*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(J-R)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(R,J,B){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-J/this.panningSensibility,this.camera.inertialPanningY+=B/this.panningSensibility):(this.camera.inertialAlphaOffset-=J/this.angularSensibilityX,this.camera.inertialBetaOffset-=B/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(R,J,B,Q,h,y){0===B&&null===h||0===Q&&null===y||(this.multiTouchPanAndZoom?(this._computePinchZoom(B,Q),this._computeMultiTouchPanning(h,y)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(Q)-Math.sqrt(B))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(B,Q),this._isPinching=!0):this._computeMultiTouchPanning(h,y)):this.multiTouchPanning?this._computeMultiTouchPanning(h,y):this.pinchZoom&&this._computePinchZoom(B,Q))}onButtonDown(R){this._isPanClick=R.button===this.camera._panningMouseButton}onButtonUp(R){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}I.MinimumRadiusForPinch=.001,(0,Q.e)([(0,h.N)()],I.prototype,"buttons",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"angularSensibilityX",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"angularSensibilityY",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"pinchPrecision",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"pinchDeltaPercentage",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"useNaturalPinchZoom",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"pinchZoom",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"panningSensibility",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"multiTouchPanning",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"multiTouchPanAndZoom",void 0),a.e.ArcRotateCameraPointersInput=I;var V=B(11459);class M{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(R){R=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.IR(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((J=>{const B=J.event;if(!B.metaKey)if(J.type===V.e.KEYDOWN){if(this._ctrlPressed=B.ctrlKey,this._altPressed=B.altKey,-1!==this.keysUp.indexOf(B.keyCode)||-1!==this.keysDown.indexOf(B.keyCode)||-1!==this.keysLeft.indexOf(B.keyCode)||-1!==this.keysRight.indexOf(B.keyCode)||-1!==this.keysReset.indexOf(B.keyCode)){-1===this._keys.indexOf(B.keyCode)&&this._keys.push(B.keyCode),B.preventDefault&&(R||B.preventDefault())}}else if(-1!==this.keysUp.indexOf(B.keyCode)||-1!==this.keysDown.indexOf(B.keyCode)||-1!==this.keysLeft.indexOf(B.keyCode)||-1!==this.keysRight.indexOf(B.keyCode)||-1!==this.keysReset.indexOf(B.keyCode)){const J=this._keys.indexOf(B.keyCode);J>=0&&this._keys.splice(J,1),B.preventDefault&&(R||B.preventDefault())}})))}vl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const R=this.camera;for(let J=0;J<this._keys.length;J++){const B=this._keys[J];-1!==this.keysLeft.indexOf(B)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningX-=1/this.panningSensibility:R.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(B)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?R.inertialRadiusOffset+=1/this.zoomingSensibility:R.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(B)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningX+=1/this.panningSensibility:R.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(B)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?R.inertialRadiusOffset-=1/this.zoomingSensibility:R.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(B)&&R.useInputToRestoreState&&R.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Q.e)([(0,h.N)()],M.prototype,"keysUp",void 0),(0,Q.e)([(0,h.N)()],M.prototype,"keysDown",void 0),(0,Q.e)([(0,h.N)()],M.prototype,"keysLeft",void 0),(0,Q.e)([(0,h.N)()],M.prototype,"keysRight",void 0),(0,Q.e)([(0,h.N)()],M.prototype,"keysReset",void 0),(0,Q.e)([(0,h.N)()],M.prototype,"panningSensibility",void 0),(0,Q.e)([(0,h.N)()],M.prototype,"zoomingSensibility",void 0),(0,Q.e)([(0,h.N)()],M.prototype,"useAltToZoom",void 0),(0,Q.e)([(0,h.N)()],M.prototype,"angularSpeed",void 0),a.e.ArcRotateCameraKeyboardMoveInput=M;var H=B(11232),d=B(11466);class X{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new N.nJ(0,0,0),this._globalOffset=new N.nJ(0,0,0),this._inertialPanning=N.nJ.Zero()}_computeDeltaFromMouseWheelLegacyEvent(R,J){let B=0;const Q=.01*R*this.wheelDeltaPercentage*J;return B=R>0?Q/(1+this.wheelDeltaPercentage):Q*(1+this.wheelDeltaPercentage),B}attachControl(R){R=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=J=>{if(J.type!==D.e.POINTERWHEEL)return;const B=J.event;let Q=0;const h=B.deltaMode===d.e.DOM_DELTA_LINE?40:1,y=-B.deltaY*h;if(this.customComputeDeltaFromMouseWheel)Q=this.customComputeDeltaFromMouseWheel(y,this,B);else if(this.wheelDeltaPercentage){if(Q=this._computeDeltaFromMouseWheelLegacyEvent(y,this.camera.radius),Q>0){let R=this.camera.radius,J=this.camera.inertialRadiusOffset+Q;for(let B=0;B<20&&!(R<=J)&&!(Math.abs(J*this.camera.inertia)<.001);B++)R-=J,J*=this.camera.inertia;R=(0,r.Clamp)(R,0,Number.MAX_VALUE),Q=this._computeDeltaFromMouseWheelLegacyEvent(y,R)}}else Q=y/(40*this.wheelPrecision);Q&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(Q)):this.camera.inertialRadiusOffset+=Q),B.preventDefault&&(R||B.preventDefault())},this._observer=this.camera.IR()._inputManager._addCameraPointerObserver(this._wheel,D.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Sr(0)}vl(){this._observer&&(this.camera.IR()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const R=this.camera;0+R.inertialAlphaOffset+R.inertialBetaOffset+R.inertialRadiusOffset&&(this._updateHitPlane(),R.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(R.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const R=this.camera,J=R.target.PJ(R.position);this._hitPlane=H.b.FromPositionAndNormal(R.target,J)}_getPosition(){const R=this.camera,J=R.IR(),B=J.createPickingRay(J.pointerX,J.pointerY,N.Matrix.Identity(),R,!1);0===R.targetScreenOffset.x&&0===R.targetScreenOffset.y||(this._viewOffset.set(R.targetScreenOffset.x,R.targetScreenOffset.y,0),R.getViewMatrix().invertToRef(R._cameraTransformMatrix),this._globalOffset=N.nJ.TransformNormal(this._viewOffset,R._cameraTransformMatrix),B.origin.addInPlace(this._globalOffset));let Q=0;return this._hitPlane&&(Q=B.intersectsPlane(this._hitPlane)??0),B.origin.addInPlace(B.direction.scaleInPlace(Q))}_zoomToMouse(R){const J=this.camera,B=1-J.inertia;if(J.lowerRadiusLimit){const Q=J.lowerRadiusLimit??0;J.radius-(J.inertialRadiusOffset+R)/B<Q&&(R=(J.radius-Q)*B-J.inertialRadiusOffset)}if(J.upperRadiusLimit){const Q=J.upperRadiusLimit??0;J.radius-(J.inertialRadiusOffset+R)/B>Q&&(R=(J.radius-Q)*B-J.inertialRadiusOffset)}const Q=R/B/J.radius,h=this._getPosition(),y=N.TmpVectors.nJ[6];h.subtractToRef(J.target,y),y.scaleInPlace(Q),y.scaleInPlace(B),this._inertialPanning.addInPlace(y),J.inertialRadiusOffset+=R}_zeroIfClose(R){Math.abs(R.x)<E.d&&(R.x=0),Math.abs(R.y)<E.d&&(R.y=0),Math.abs(R.z)<E.d&&(R.z=0)}}(0,Q.e)([(0,h.N)()],X.prototype,"wheelPrecision",void 0),(0,Q.e)([(0,h.N)()],X.prototype,"zoomToMouseLocation",void 0),(0,Q.e)([(0,h.N)()],X.prototype,"wheelDeltaPercentage",void 0),a.e.ArcRotateCameraMouseWheelInput=X;class c extends a.i{constructor(R){super(R)}addMouseWheel(){return this.add(new X),this}addPointers(){return this.add(new I),this}addKeyboard(){return this.add(new M),this}}var z=B(11142);function p(R,J){return isNaN(R)?J:R}q.b.AddNodeConstructor("ArcRotateCamera",((R,J)=>()=>new i(R,0,0,1,N.nJ.Zero(),J)));class i extends f.e{get target(){return this._target}set target(R){this.setTarget(R)}get targetHost(){return this._targetHost}set targetHost(R){R&&this.setTarget(R)}getTarget(){return this.target}get position(){return this._position}set position(R){this.setPosition(R)}set upVector(R){this._upToYMatrix||(this._yToUpMatrix=new N.Matrix,this._upToYMatrix=new N.Matrix,this._upVector=N.nJ.Zero()),R.normalize(),this._upVector.h(R),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){N.Matrix.RotationAlignToRef(N.nJ.UpReadOnly,this._upVector,this._yToUpMatrix),N.Matrix.RotationAlignToRef(this._upVector,N.nJ.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const R=this.inputs.attached.pointers;return R?R.angularSensibilityX:0}set angularSensibilityX(R){const J=this.inputs.attached.pointers;J&&(J.angularSensibilityX=R)}get angularSensibilityY(){const R=this.inputs.attached.pointers;return R?R.angularSensibilityY:0}set angularSensibilityY(R){const J=this.inputs.attached.pointers;J&&(J.angularSensibilityY=R)}get pinchPrecision(){const R=this.inputs.attached.pointers;return R?R.pinchPrecision:0}set pinchPrecision(R){const J=this.inputs.attached.pointers;J&&(J.pinchPrecision=R)}get pinchDeltaPercentage(){const R=this.inputs.attached.pointers;return R?R.pinchDeltaPercentage:0}set pinchDeltaPercentage(R){const J=this.inputs.attached.pointers;J&&(J.pinchDeltaPercentage=R)}get useNaturalPinchZoom(){const R=this.inputs.attached.pointers;return!!R&&R.useNaturalPinchZoom}set useNaturalPinchZoom(R){const J=this.inputs.attached.pointers;J&&(J.useNaturalPinchZoom=R)}get panningSensibility(){const R=this.inputs.attached.pointers;return R?R.panningSensibility:0}set panningSensibility(R){const J=this.inputs.attached.pointers;J&&(J.panningSensibility=R)}get keysUp(){const R=this.inputs.attached.keyboard;return R?R.keysUp:[]}set keysUp(R){const J=this.inputs.attached.keyboard;J&&(J.keysUp=R)}get keysDown(){const R=this.inputs.attached.keyboard;return R?R.keysDown:[]}set keysDown(R){const J=this.inputs.attached.keyboard;J&&(J.keysDown=R)}get keysLeft(){const R=this.inputs.attached.keyboard;return R?R.keysLeft:[]}set keysLeft(R){const J=this.inputs.attached.keyboard;J&&(J.keysLeft=R)}get keysRight(){const R=this.inputs.attached.keyboard;return R?R.keysRight:[]}set keysRight(R){const J=this.inputs.attached.keyboard;J&&(J.keysRight=R)}get wheelPrecision(){const R=this.inputs.attached.mousewheel;return R?R.wheelPrecision:0}set wheelPrecision(R){const J=this.inputs.attached.mousewheel;J&&(J.wheelPrecision=R)}get zoomToMouseLocation(){const R=this.inputs.attached.mousewheel;return!!R&&R.zoomToMouseLocation}set zoomToMouseLocation(R){const J=this.inputs.attached.mousewheel;J&&(J.zoomToMouseLocation=R)}get wheelDeltaPercentage(){const R=this.inputs.attached.mousewheel;return R?R.wheelDeltaPercentage:0}set wheelDeltaPercentage(R){const J=this.inputs.attached.mousewheel;J&&(J.wheelDeltaPercentage=R)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(R){R!==this.useBouncingBehavior&&(R?(this._bouncingBehavior=new A,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(R){R!==this.useFramingBehavior&&(R?(this._framingBehavior=new u,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(R){R!==this.useAutoRotationBehavior&&(R?(this._autoRotationBehavior=new O,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(R,J,B,Q,h,r){var q;let e=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(R,N.nJ.Zero(),r,e),q=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=N.nJ.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=N.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new N.Matrix,this.panningAxis=new N.nJ(1,1,0),this._transformedDirection=new N.nJ,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new y.e,this.checkCollisions=!1,this.collisionRadius=new N.nJ(.5,.5,.5),this._previousPosition=N.nJ.Zero(),this._collisionVelocity=N.nJ.Zero(),this._newPosition=N.nJ.Zero(),this._computationVector=N.nJ.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new N.nJ(NaN,NaN,NaN),this._goalTargetScreenOffset=new N.Vector2(NaN,NaN),this._onCollisionPositionChange=function(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B?(q.setPosition(J),q.XO&&q.XO(B)):q._previousPosition.h(q._position);const Q=Math.cos(q.alpha),h=Math.sin(q.alpha),y=Math.cos(q.beta);let N=Math.sin(q.beta);0===N&&(N=1e-4);const r=q._getTargetPosition();q._computationVector.Ar(q.radius*Q*N,q.radius*y,q.radius*h*N),r.addToRef(q._computationVector,q._newPosition),q._position.h(q._newPosition);let e=q.upVector;q.allowUpsideDown&&q.beta<0&&(e=e.clone(),e=e.negate()),q._computeViewMatrix(q._position,r,e),q._viewMatrix.addAtIndex(12,q.targetScreenOffset.x),q._viewMatrix.addAtIndex(13,q.targetScreenOffset.y),q._collisionTriggered=!1},this._target=N.nJ.Zero(),h&&this.setTarget(h),this.alpha=J,this.beta=B,this.radius=Q,this.getViewMatrix(),this.inputs=new c(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new N.nJ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=N.Vector2.Zero()}_updateCache(R){R||super._updateCache(),this._cache._target.h(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.h(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const R=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?R.addToRef(this._targetBoundingCenter,this._target):this._target.h(R)}const R=this._getLockedTargetPosition();return R||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>E.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,y=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=y?this._currentInterpolationFactor=y:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=p(R,this._goalAlpha),this._goalBeta=p(J,this._goalBeta),this._goalRadius=p(B,this._goalRadius),this._goalTarget.set(p(Q.x,this._goalTarget.x),p(Q.y,this._goalTarget.y),p(Q.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(p(h.x,this._goalTargetScreenOffset.x),p(h.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,r.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,r.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,r.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,r.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(R,J){let B=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const h=arguments;J=s.Tools.BackCompatCameraNoPreventDefault(h),this._useCtrlForPanning=B,this._panningMouseButton=Q,"boolean"===typeof h[0]&&(h.length>1&&(this._useCtrlForPanning=h[1]),h.length>2&&(this._panningMouseButton=h[2])),this.inputs.attachElement(J),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}vl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let R=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){R=!0;const J=this.invertRotation?-1:1,B=this._calculateHandednessMultiplier();let Q=this.inertialAlphaOffset*B;this.beta<0&&(Q*=-1),this.alpha+=Q*J,this.beta+=this.inertialBetaOffset*J,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<E.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<E.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*E.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){R=!0;const J=new N.nJ(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),J.multiplyInPlace(this.panningAxis),N.nJ.TransformNormalToRef(J,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const R=this.upVector,J=N.nJ.CrossToRef(this._transformedDirection,R,this._transformedDirection);N.nJ.CrossToRef(R,J,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);N.nJ.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.h(this._transformedDirection)}else{if(this.parent){const R=N.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.transposeToRef(R),N.nJ.TransformCoordinatesToRef(this._transformedDirection,R,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*E.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*E.d&&(this.inertialPanningY=0)}if(R)this.stopInterpolation();else if(this._isInterpolating){let R=!1;const J=this._scene.getEngine().getDeltaTime()/1e3,B=1-Math.pow(2,-J/this._currentInterpolationFactor),Q=p(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const J=N.TmpVectors.nJ[0].set(p(this._goalTarget.x,this._target.x),p(this._goalTarget.y,this._target.y),p(this._goalTarget.z,this._target.z));N.nJ.LerpToRef(this.target,J,B,this._target),10*N.nJ.Distance(this.target,J)/Q<E.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.h(J),this.setTarget(this.target,!1,!0,!0)):R=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const J=N.Quaternion.RotationAlphaBetaGammaToRef(p(this._goalAlpha,this.alpha),p(this._goalBeta,this.beta),0,N.TmpVectors.Quaternion[0]),Q=N.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,N.TmpVectors.Quaternion[1]),h=N.Quaternion.SlerpToRef(Q,J,B,N.TmpVectors.Quaternion[2]);h.normalize();const y=h.toAlphaBetaGammaToRef(N.TmpVectors.nJ[0]);if(this.alpha=y.x,this.beta=y.y,h.isApprox(J,E.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const R=J.toAlphaBetaGammaToRef(N.TmpVectors.nJ[0]);this.alpha=R.x,this.beta=R.y}else R=!0}if(isNaN(this._goalRadius)||(this.radius+=(Q-this.radius)*B,Math.abs(Q/this.radius-1)<E.d?(this._goalRadius=NaN,this.radius=Q):R=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const J=N.TmpVectors.Vector2[0].set(p(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),p(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));N.Vector2.LerpToRef(this.targetScreenOffset,J,B,this.targetScreenOffset),N.Vector2.Distance(this.targetScreenOffset,J)<E.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.h(J)):R=!0}this._isInterpolating=R}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||N.nJ.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const R=this.alpha;var J,B;this.alpha=function(R){let J=Math.PI/2;return 0===R.x&&0===R.z||(J=Math.acos(R.x/Math.sqrt(Math.pow(R.x,2)+Math.pow(R.z,2)))),R.z<0&&(J=2*Math.PI-J),J}(this._computationVector),this.beta=(J=this._computationVector.y,B=this.radius,Math.acos(J/B));const Q=Math.round((R-this.alpha)/(2*Math.PI));this.alpha+=2*Q*Math.PI,this._checkLimits()}setPosition(R){this._position.equals(R)||(this._position.h(R),this.rebuildAnglesAndRadius())}setTarget(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Q=this.overrideCloneAlphaBetaRadius??Q,R.ny)J&&R.getBoundingInfo?this._targetBoundingCenter=R.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,R.ny(),this._targetHost=R,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const J=R,Q=this._getTargetPosition();if(Q&&!B&&Q.equals(J))return;this._targetHost=null,this._target=J,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}Q||this.rebuildAnglesAndRadius()}_getViewMatrix(){const R=Math.cos(this.alpha),J=Math.sin(this.alpha),B=Math.cos(this.beta);let Q=Math.sin(this.beta);0===Q&&(Q=1e-4),0===this.radius&&(this.radius=1e-4);const h=this._getTargetPosition();if(this._computationVector.Ar(this.radius*R*Q,this.radius*B,this.radius*J*Q),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||N.nJ.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),h.addToRef(this._computationVector,this._newPosition),this.IR().collisionsEnabled&&this.checkCollisions){const R=this.IR().collisionCoordinator;this._collider||(this._collider=R.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,R.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.h(this._newPosition);let R=this.upVector;this.allowUpsideDown&&Q<0&&(R=R.negate()),this._computeViewMatrix(this._position,h,R),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.h(h),this._viewMatrix}zoomOn(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R=R||this.IR().meshes;const B=e.e.MinMax(R);let Q=this._calculateLowerRadiusFromModelBoundingSphere(B.min,B.max);if(Q=Math.max(Math.min(Q,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=Q*this.zoomOnFactor,this.mode===S.d.ORTHOGRAPHIC_CAMERA){const R=this.IR().getEngine().getAspectRatio(this),J=Q*this.zoomOnFactor/2;this.orthoLeft=-J*R,this.orthoRight=J*R,this.orthoBottom=-J,this.orthoTop=J}this.focusOn({min:B.min,max:B.max,distance:Q},J)}focusOn(R){let J,B,Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===R.min){const Q=R||this.IR().meshes;J=e.e.MinMax(Q),B=N.nJ.Distance(J.min,J.max)}else{J=R,B=R.distance}this._target=e.e.Center(J),Q||(this.maxZ=2*B)}createRigCamera(R,J){let B=0;switch(this.cameraRigMode){case S.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.d.RIG_MODE_VR:B=this._cameraRigParams.stereoHalfAngle*(0===J?1:-1);break;case S.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:B=this._cameraRigParams.stereoHalfAngle*(0===J?-1:1)}const Q=new i(R,this.alpha+B,this.beta,this.radius,this._target,this.IR());return Q._cameraRigParams={},Q.isRigCamera=!0,Q.rigParent=this,Q.upVector=this.upVector,Q.mode=this.mode,Q.orthoLeft=this.orthoLeft,Q.orthoRight=this.orthoRight,Q.orthoBottom=this.orthoBottom,Q.orthoTop=this.orthoTop,Q}_updateRigCameras(){const R=this._rigCameras[0],J=this._rigCameras[1];switch(R.beta=J.beta=this.beta,this.cameraRigMode){case S.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.d.RIG_MODE_VR:R.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,J.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case S.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:R.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,J.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const Q=N.nJ.Distance(R,J),h=this.IR().getEngine().getAspectRatio(this),y=Math.tan(this.fov/2),r=y*h,q=.5*Q*B,e=q*Math.sqrt(1+1/(r*r)),D=q*Math.sqrt(1+1/(y*y));return Math.max(e,D)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Q.e)([(0,h.N)()],i.prototype,"alpha",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"beta",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"radius",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Q.e)([(0,h.L)("target")],i.prototype,"_target",void 0),(0,Q.e)([(0,h.y)("targetHost")],i.prototype,"_targetHost",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"inertialAlphaOffset",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"inertialBetaOffset",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"inertialRadiusOffset",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"lowerAlphaLimit",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"upperAlphaLimit",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"lowerBetaLimit",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"upperBetaLimit",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"lowerRadiusLimit",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"upperRadiusLimit",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"lowerTargetYLimit",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"inertialPanningX",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"inertialPanningY",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"pinchToPanMaxDistance",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"panningDistanceLimit",void 0),(0,Q.e)([(0,h.L)()],i.prototype,"panningOriginTarget",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"panningInertia",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"zoomToMouseLocation",null),(0,Q.e)([(0,h.N)()],i.prototype,"zoomOnFactor",void 0),(0,Q.e)([(0,h.H)()],i.prototype,"targetScreenOffset",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"allowUpsideDown",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"useInputToRestoreState",void 0),(0,Q.e)([(0,h.N)()],i.prototype,"restoreStateInterpolationFactor",void 0),(0,z.h)("BABYLON.ArcRotateCamera",i)},12816:(R,J,B)=>{"use strict";B.d(J,{e:()=>N,i:()=>r});var Q=B(11043),h=B(11217),y=B(11634),N={};class r{constructor(R){this.attachedToElement=!1,this.attached={},this.camera=R,this.checkInputs=()=>{}}add(R){const J=R.getSimpleName();this.attached[J]?Q.d.Warn("camera input of type "+J+" already exists on camera"):(this.attached[J]=R,R.camera=this.camera,R.checkInputs&&(this.checkInputs=this._addCheckInputs(R.checkInputs.bind(R))),this.attachedToElement&&R.attachControl(this.noPreventDefault))}remove(R){for(const J in this.attached){const B=this.attached[J];if(B===R)return B.vl(),B.camera=null,delete this.attached[J],void this.rebuildInputCheck()}}removeByType(R){for(const J in this.attached){const B=this.attached[J];B.getClassName()===R&&(B.vl(),B.camera=null,delete this.attached[J],this.rebuildInputCheck())}}_addCheckInputs(R){const J=this.checkInputs;return()=>{J(),R()}}attachInput(R){this.attachedToElement&&R.attachControl(this.noPreventDefault)}attachElement(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){R=!y.d.ForceAttachControlToAlwaysPreventDefault&&R,this.attachedToElement=!0,this.noPreventDefault=R;for(const J in this.attached)this.attached[J].attachControl(R)}}detachElement(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const J in this.attached)this.attached[J].vl(),R&&(this.attached[J].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const R in this.attached){const J=this.attached[R];J.checkInputs&&(this.checkInputs=this._addCheckInputs(J.checkInputs.bind(J)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(R){const J={};for(const B in this.attached){const R=this.attached[B],Q=h.c.Serialize(R);J[R.getClassName()]=Q}R.inputsmgr=J}parse(R){const J=R.inputsmgr;if(J){this.clear();for(const R in J){const B=N[R];if(B){const Q=J[R],y=h.c.Parse((()=>new B),Q,null);this.add(y)}}}else for(const B in this.attached){const J=N[this.attached[B].getClassName()];if(J){const Q=h.c.Parse((()=>new J),R,null);this.remove(this.attached[B]),this.add(Q)}}}}},12808:(R,J,B)=>{"use strict";B.d(J,{b:()=>x});var Q=B(11167),h=B(11176),y=B(11186),N=B(11670),r=B(12816),q=B(11459),e=B(11030);class D{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(R){R=e.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.IR(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((J=>{const B=J.event;if(!B.metaKey)if(J.type===q.e.KEYDOWN){if(-1!==this.keysUp.indexOf(B.keyCode)||-1!==this.keysDown.indexOf(B.keyCode)||-1!==this.keysLeft.indexOf(B.keyCode)||-1!==this.keysRight.indexOf(B.keyCode)||-1!==this.keysUpward.indexOf(B.keyCode)||-1!==this.keysDownward.indexOf(B.keyCode)||-1!==this.keysRotateLeft.indexOf(B.keyCode)||-1!==this.keysRotateRight.indexOf(B.keyCode)||-1!==this.keysRotateUp.indexOf(B.keyCode)||-1!==this.keysRotateDown.indexOf(B.keyCode)){-1===this._keys.indexOf(B.keyCode)&&this._keys.push(B.keyCode),R||B.preventDefault()}}else if(-1!==this.keysUp.indexOf(B.keyCode)||-1!==this.keysDown.indexOf(B.keyCode)||-1!==this.keysLeft.indexOf(B.keyCode)||-1!==this.keysRight.indexOf(B.keyCode)||-1!==this.keysUpward.indexOf(B.keyCode)||-1!==this.keysDownward.indexOf(B.keyCode)||-1!==this.keysRotateLeft.indexOf(B.keyCode)||-1!==this.keysRotateRight.indexOf(B.keyCode)||-1!==this.keysRotateUp.indexOf(B.keyCode)||-1!==this.keysRotateDown.indexOf(B.keyCode)){const J=this._keys.indexOf(B.keyCode);J>=0&&this._keys.splice(J,1),R||B.preventDefault()}})))}vl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const R=this.camera;for(let J=0;J<this._keys.length;J++){const B=this._keys[J],Q=R._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(B)?R._localDirection.Ar(-Q,0,0):-1!==this.keysUp.indexOf(B)?R._localDirection.Ar(0,0,Q):-1!==this.keysRight.indexOf(B)?R._localDirection.Ar(Q,0,0):-1!==this.keysDown.indexOf(B)?R._localDirection.Ar(0,0,-Q):-1!==this.keysUpward.indexOf(B)?R._localDirection.Ar(0,Q,0):-1!==this.keysDownward.indexOf(B)?R._localDirection.Ar(0,-Q,0):-1!==this.keysRotateLeft.indexOf(B)?(R._localDirection.Ar(0,0,0),R.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(B)?(R._localDirection.Ar(0,0,0),R.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(B)?(R._localDirection.Ar(0,0,0),R.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(B)&&(R._localDirection.Ar(0,0,0),R.cameraRotation.x+=this._getLocalRotation()),R.IR().useRightHandedSystem&&(R._localDirection.z*=-1),R.getViewMatrix().invertToRef(R._cameraTransformMatrix),y.nJ.TransformNormalToRef(R._localDirection,R._cameraTransformMatrix,R._transformedDirection),R.cameraDirection.addInPlace(R._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const R=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*R}}(0,Q.e)([(0,h.N)()],D.prototype,"keysUp",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysUpward",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysDown",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysDownward",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysLeft",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysRight",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"rotationSpeed",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysRotateLeft",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysRotateRight",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysRotateUp",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"keysRotateDown",void 0),r.e.FreeCameraKeyboardMoveInput=D;var l=B(11032),E=B(11455);class O{constructor(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=R,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new l.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(R){R=e.Tools.BackCompatCameraNoPreventDefault(arguments);const J=this.camera.getEngine(),B=J.getInputElement();this._pointerInput||(this._pointerInput=Q=>{const h=Q.event,y="touch"===h.pointerType;if(!this.touchEnabled&&y)return;if(Q.type!==E.e.POINTERMOVE&&-1===this.buttons.indexOf(h.button))return;const N=h.target;if(Q.type===E.e.POINTERDOWN){if(y&&-1!==this._activePointerId||!y&&-1!==this._currentActiveButton)return;this._activePointerId=h.pointerId;try{null===N||void 0===N||N.setPointerCapture(h.pointerId)}catch(r){}-1===this._currentActiveButton&&(this._currentActiveButton=h.button),this._previousPosition={x:h.clientX,y:h.clientY},R||(h.preventDefault(),B&&B.focus()),J.isPointerLock&&this._onMouseMove&&this._onMouseMove(Q.event)}else if(Q.type===E.e.POINTERUP){if(y&&this._activePointerId!==h.pointerId||!y&&this._currentActiveButton!==h.button)return;try{null===N||void 0===N||N.releasePointerCapture(h.pointerId)}catch(r){}this._currentActiveButton=-1,this._previousPosition=null,R||h.preventDefault(),this._activePointerId=-1}else if(Q.type===E.e.POINTERMOVE&&(this._activePointerId===h.pointerId||!y))if(J.isPointerLock&&this._onMouseMove)this._onMouseMove(Q.event);else if(this._previousPosition){const J=this.camera._calculateHandednessMultiplier(),B=(h.clientX-this._previousPosition.x)*J,Q=h.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=B/this.angularSensibility,this.camera.cameraRotation.x+=Q/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:B,offsetY:Q}),this._previousPosition={x:h.clientX,y:h.clientY},R||h.preventDefault()}}),this._onMouseMove=B=>{if(!J.isPointerLock)return;const Q=this.camera._calculateHandednessMultiplier(),h=B.movementX*Q;this.camera.cameraRotation.y+=h/this.angularSensibility;const y=B.movementY;this.camera.cameraRotation.x+=y/this.angularSensibility,this._previousPosition=null,R||B.preventDefault()},this._observer=this.camera.IR()._inputManager._addCameraPointerObserver(this._pointerInput,E.e.POINTERDOWN|E.e.POINTERUP|E.e.POINTERMOVE),B&&(this._contextMenuBind=R=>this.onContextMenu(R),B.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(R){R.preventDefault()}vl(){if(this._observer){if(this.camera.IR()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const R=this.camera.getEngine().getInputElement();R&&R.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,Q.e)([(0,h.N)()],O.prototype,"buttons",void 0),(0,Q.e)([(0,h.N)()],O.prototype,"angularSensibility",void 0),r.e.FreeCameraMouseInput=O;var n,P=B(11466);class A{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new l.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(R){R=e.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=J=>{if(J.type!==E.e.POINTERWHEEL)return;const B=J.event,Q=B.deltaMode===P.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*Q*B.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*Q*B.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*Q*B.deltaZ/this._normalize,B.preventDefault&&(R||B.preventDefault())},this._observer=this.camera.IR()._inputManager._addCameraPointerObserver(this._wheel,E.e.POINTERWHEEL)}vl(){this._observer&&(this.camera.IR()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,Q.e)([(0,h.N)()],A.prototype,"wheelPrecisionX",void 0),(0,Q.e)([(0,h.N)()],A.prototype,"wheelPrecisionY",void 0),(0,Q.e)([(0,h.N)()],A.prototype,"wheelPrecisionZ",void 0),function(R){R[R.MoveRelative=0]="MoveRelative",R[R.RotateRelative=1]="RotateRelative",R[R.MoveScene=2]="MoveScene"}(n||(n={}));class u extends A{constructor(){super(...arguments),this._moveRelative=y.nJ.Zero(),this._rotateRelative=y.nJ.Zero(),this._moveScene=y.nJ.Zero(),this._wheelXAction=n.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=n.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(R){null===R&&this._wheelXAction!==n.MoveRelative||(this._wheelXAction=n.MoveRelative,this._wheelXActionCoordinate=R)}get wheelXMoveRelative(){return this._wheelXAction!==n.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(R){null===R&&this._wheelYAction!==n.MoveRelative||(this._wheelYAction=n.MoveRelative,this._wheelYActionCoordinate=R)}get wheelYMoveRelative(){return this._wheelYAction!==n.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(R){null===R&&this._wheelZAction!==n.MoveRelative||(this._wheelZAction=n.MoveRelative,this._wheelZActionCoordinate=R)}get wheelZMoveRelative(){return this._wheelZAction!==n.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(R){null===R&&this._wheelXAction!==n.RotateRelative||(this._wheelXAction=n.RotateRelative,this._wheelXActionCoordinate=R)}get wheelXRotateRelative(){return this._wheelXAction!==n.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(R){null===R&&this._wheelYAction!==n.RotateRelative||(this._wheelYAction=n.RotateRelative,this._wheelYActionCoordinate=R)}get wheelYRotateRelative(){return this._wheelYAction!==n.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(R){null===R&&this._wheelZAction!==n.RotateRelative||(this._wheelZAction=n.RotateRelative,this._wheelZActionCoordinate=R)}get wheelZRotateRelative(){return this._wheelZAction!==n.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(R){null===R&&this._wheelXAction!==n.MoveScene||(this._wheelXAction=n.MoveScene,this._wheelXActionCoordinate=R)}get wheelXMoveScene(){return this._wheelXAction!==n.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(R){null===R&&this._wheelYAction!==n.MoveScene||(this._wheelYAction=n.MoveScene,this._wheelYActionCoordinate=R)}get wheelYMoveScene(){return this._wheelYAction!==n.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(R){null===R&&this._wheelZAction!==n.MoveScene||(this._wheelZAction=n.MoveScene,this._wheelZActionCoordinate=R)}get wheelZMoveScene(){return this._wheelZAction!==n.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Sr(0),this._rotateRelative.Sr(0),this._moveScene.Sr(0),this._updateCamera(),this.camera.IR().useRightHandedSystem&&(this._moveRelative.z*=-1);const R=y.Matrix.Zero();this.camera.getViewMatrix().invertToRef(R);const J=y.nJ.Zero();y.nJ.TransformNormalToRef(this._moveRelative,R,J),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(J),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(R,J,B){if(0===R)return;if(null===J||null===B)return;let Q=null;switch(J){case n.MoveRelative:Q=this._moveRelative;break;case n.RotateRelative:Q=this._rotateRelative;break;case n.MoveScene:Q=this._moveScene}switch(B){case 0:Q.set(R,0,0);break;case 1:Q.set(0,R,0);break;case 2:Q.set(0,0,R)}}}(0,Q.e)([(0,h.N)()],u.prototype,"wheelXMoveRelative",null),(0,Q.e)([(0,h.N)()],u.prototype,"wheelYMoveRelative",null),(0,Q.e)([(0,h.N)()],u.prototype,"wheelZMoveRelative",null),(0,Q.e)([(0,h.N)()],u.prototype,"wheelXRotateRelative",null),(0,Q.e)([(0,h.N)()],u.prototype,"wheelYRotateRelative",null),(0,Q.e)([(0,h.N)()],u.prototype,"wheelZRotateRelative",null),(0,Q.e)([(0,h.N)()],u.prototype,"wheelXMoveScene",null),(0,Q.e)([(0,h.N)()],u.prototype,"wheelYMoveScene",null),(0,Q.e)([(0,h.N)()],u.prototype,"wheelZMoveScene",null),r.e.FreeCameraMouseWheelInput=u;class S{constructor(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=R,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=e.Tools.IsSafari()}attachControl(R){R=e.Tools.BackCompatCameraNoPreventDefault(arguments);let J=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=B=>{const Q=B.event,h="mouse"===Q.pointerType||this._isSafari&&"undefined"===typeof Q.pointerType;if(this.allowMouse||!h)if(B.type===E.e.POINTERDOWN){if(R||Q.preventDefault(),this._pointerPressed.push(Q.pointerId),1!==this._pointerPressed.length)return;J={x:Q.clientX,y:Q.clientY}}else if(B.type===E.e.POINTERUP){R||Q.preventDefault();const B=this._pointerPressed.indexOf(Q.pointerId);if(-1===B)return;if(this._pointerPressed.splice(B,1),0!=B)return;J=null,this._offsetX=null,this._offsetY=null}else if(B.type===E.e.POINTERMOVE){if(R||Q.preventDefault(),!J)return;if(0!=this._pointerPressed.indexOf(Q.pointerId))return;this._offsetX=Q.clientX-J.x,this._offsetY=-(Q.clientY-J.y)}}),this._observer=this.camera.IR()._inputManager._addCameraPointerObserver(this._pointerInput,E.e.POINTERDOWN|E.e.POINTERUP|E.e.POINTERMOVE),this._onLostFocus){const R=this.camera.getEngine().getInputElement();R&&R.addEventListener("blur",this._onLostFocus)}}vl(){if(this._pointerInput){if(this._observer&&(this.camera.IR()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const R=this.camera.getEngine().getInputElement();R&&R.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const R=this.camera,J=R._calculateHandednessMultiplier();R.cameraRotation.y=J*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)R.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const J=R._computeLocalCameraSpeed(),B=new y.nJ(0,0,0!==this.touchMoveSensibility?J*this._offsetY/this.touchMoveSensibility:0);y.Matrix.RotationYawPitchRollToRef(R.rotation.y,R.rotation.x,0,R._cameraRotationMatrix),R.cameraDirection.addInPlace(y.nJ.TransformCoordinates(B,R._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,Q.e)([(0,h.N)()],S.prototype,"touchAngularSensibility",void 0),(0,Q.e)([(0,h.N)()],S.prototype,"touchMoveSensibility",void 0),r.e.FreeCameraTouchInput=S;class f extends r.i{constructor(R){super(R),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new D),this}addMouse(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new O(R),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new u,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new S),this}clear(){super.clear(),this._mouseInput=null}}var a=B(11142),s=B(11094);class x extends N.e{get angularSensibility(){const R=this.inputs.attached.mouse;return R?R.angularSensibility:0}set angularSensibility(R){const J=this.inputs.attached.mouse;J&&(J.angularSensibility=R)}get keysUp(){const R=this.inputs.attached.keyboard;return R?R.keysUp:[]}set keysUp(R){const J=this.inputs.attached.keyboard;J&&(J.keysUp=R)}get keysUpward(){const R=this.inputs.attached.keyboard;return R?R.keysUpward:[]}set keysUpward(R){const J=this.inputs.attached.keyboard;J&&(J.keysUpward=R)}get keysDown(){const R=this.inputs.attached.keyboard;return R?R.keysDown:[]}set keysDown(R){const J=this.inputs.attached.keyboard;J&&(J.keysDown=R)}get keysDownward(){const R=this.inputs.attached.keyboard;return R?R.keysDownward:[]}set keysDownward(R){const J=this.inputs.attached.keyboard;J&&(J.keysDownward=R)}get keysLeft(){const R=this.inputs.attached.keyboard;return R?R.keysLeft:[]}set keysLeft(R){const J=this.inputs.attached.keyboard;J&&(J.keysLeft=R)}get keysRight(){const R=this.inputs.attached.keyboard;return R?R.keysRight:[]}set keysRight(R){const J=this.inputs.attached.keyboard;J&&(J.keysRight=R)}get keysRotateLeft(){const R=this.inputs.attached.keyboard;return R?R.keysRotateLeft:[]}set keysRotateLeft(R){const J=this.inputs.attached.keyboard;J&&(J.keysRotateLeft=R)}get keysRotateRight(){const R=this.inputs.attached.keyboard;return R?R.keysRotateRight:[]}set keysRotateRight(R){const J=this.inputs.attached.keyboard;J&&(J.keysRotateRight=R)}get keysRotateUp(){const R=this.inputs.attached.keyboard;return R?R.keysRotateUp:[]}set keysRotateUp(R){const J=this.inputs.attached.keyboard;J&&(J.keysRotateUp=R)}get keysRotateDown(){const R=this.inputs.attached.keyboard;return R?R.keysRotateDown:[]}set keysRotateDown(R){const J=this.inputs.attached.keyboard;J&&(J.keysRotateDown=R)}constructor(R,J,B){var Q;super(R,J,B,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),Q=this,this.ellipsoid=new y.nJ(.5,1,.5),this.ellipsoidOffset=new y.nJ(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=y.nJ.Zero(),this._diffPosition=y.nJ.Zero(),this._newPosition=y.nJ.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q._newPosition.h(J),Q._newPosition.subtractToRef(Q._oldPosition,Q._diffPosition),Q._diffPosition.length()>s.c.CollisionsEpsilon&&(Q.position.addToRef(Q._diffPosition,Q._deferredPositionUpdate),Q._deferOnly?Q._deferredUpdated=!0:Q.position.h(Q._deferredPositionUpdate),Q.XO&&B&&Q.XO(B))},this.inputs=new f(this),this.inputs.addKeyboard().addMouse()}attachControl(R,J){J=e.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(J)}vl(){this.inputs.detachElement(),this.cameraDirection=new y.nJ(0,0,0),this.cameraRotation=new y.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(R){this._collisionMask=isNaN(R)?-1:R}_collideWithWorld(R){let J;J=this.parent?y.nJ.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,J.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const B=this.IR().collisionCoordinator;this._collider||(this._collider=B.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let Q=R;this.applyGravity&&(Q=R.add(this.IR().gravity)),B.getNewPosition(this._oldPosition,Q,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=y.nJ.Zero(),this._transformedDirection=y.nJ.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(R){this._needMoveForGravity=R}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.IR().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"le"}}(0,Q.e)([(0,h.L)()],x.prototype,"ellipsoid",void 0),(0,Q.e)([(0,h.L)()],x.prototype,"ellipsoidOffset",void 0),(0,Q.e)([(0,h.N)()],x.prototype,"checkCollisions",void 0),(0,Q.e)([(0,h.N)()],x.prototype,"applyGravity",void 0),(0,a.h)("BABYLON.FreeCamera",x)},13422:(R,J,B)=>{"use strict";B.d(J,{b:()=>y});var Q=B(11283),h=B(13424);class y{constructor(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=B,this.Ol=[],this._maxBlockCapacity=J||64,this._selectionContent=new Q.b(1024),this._creationFunc=R}update(R,J,B){h.b._CreateBlocks(R,J,B,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}fD(R){for(let J=0;J<this.pD.length;J++){this.pD[J].addEntry(R)}}SD(R){for(let J=0;J<this.pD.length;J++){this.pD[J].removeEntry(R)}}select(R,J){this._selectionContent.reset();for(let B=0;B<this.pD.length;B++){this.pD[B].select(R,this._selectionContent,J)}return J?this._selectionContent.concat(this.Ol):this._selectionContent.concatWithNoDuplicate(this.Ol),this._selectionContent}intersects(R,J,B){this._selectionContent.reset();for(let Q=0;Q<this.pD.length;Q++){this.pD[Q].intersects(R,J,this._selectionContent,B)}return B?this._selectionContent.concat(this.Ol):this._selectionContent.concatWithNoDuplicate(this.Ol),this._selectionContent}intersectsRay(R){this._selectionContent.reset();for(let J=0;J<this.pD.length;J++){this.pD[J].intersectsRay(R,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ol),this._selectionContent}}y.CreationFuncForMeshes=(R,J)=>{const B=R.getBoundingInfo();!R.isBlocked&&B.boundingBox.intersectsMinMax(J.Sl,J.fl)&&J.entries.push(R)},y.CreationFuncForSubMeshes=(R,J)=>{R.getBoundingInfo().boundingBox.intersectsMinMax(J.Sl,J.fl)&&J.entries.push(R)}},13424:(R,J,B)=>{"use strict";B.d(J,{b:()=>y});var Q=B(11186),h=B(11525);class y{constructor(R,J,B,Q,h,y){this.entries=[],this.al=new Array,this._capacity=B,this._depth=Q,this._maxDepth=h,this._creationFunc=y,this._minPoint=R,this._maxPoint=J,this.al.push(R.clone()),this.al.push(J.clone()),this.al.push(R.clone()),this.al[2].x=J.x,this.al.push(R.clone()),this.al[3].y=J.y,this.al.push(R.clone()),this.al[4].z=J.z,this.al.push(J.clone()),this.al[5].z=R.z,this.al.push(J.clone()),this.al[6].x=R.x,this.al.push(J.clone()),this.al[7].y=R.y}get cr(){return this._capacity}get Sl(){return this._minPoint}get fl(){return this._maxPoint}addEntry(R){if(this.pD)for(let J=0;J<this.pD.length;J++){this.pD[J].addEntry(R)}else this._creationFunc(R,this),this.entries.length>this.cr&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(R){if(this.pD){for(let J=0;J<this.pD.length;J++){this.pD[J].removeEntry(R)}return}const J=this.entries.indexOf(R);J>-1&&this.entries.splice(J,1)}addEntries(R){for(let J=0;J<R.length;J++){const B=R[J];this.addEntry(B)}}select(R,J,B){if(h.d.IsInFrustum(this.al,R)){if(this.pD){for(let Q=0;Q<this.pD.length;Q++){this.pD[Q].select(R,J,B)}return}B?J.concat(this.entries):J.concatWithNoDuplicate(this.entries)}}intersects(R,J,B,Q){if(h.d.IntersectsSphere(this._minPoint,this._maxPoint,R,J)){if(this.pD){for(let h=0;h<this.pD.length;h++){this.pD[h].intersects(R,J,B,Q)}return}Q?B.concat(this.entries):B.concatWithNoDuplicate(this.entries)}}intersectsRay(R,J){if(R.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.pD){for(let B=0;B<this.pD.length;B++){this.pD[B].intersectsRay(R,J)}return}J.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){y._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(R,J,B,h,N,r,q,e){q.pD=new Array;const D=new Q.nJ((J.x-R.x)/2,(J.y-R.y)/2,(J.z-R.z)/2);for(let Q=0;Q<2;Q++)for(let J=0;J<2;J++)for(let l=0;l<2;l++){const E=R.add(D.multiplyByFloats(Q,J,l)),O=R.add(D.multiplyByFloats(Q+1,J+1,l+1)),n=new y(E,O,h,N+1,r,e);n.addEntries(B),q.pD.push(n)}}}},13432:(R,J,B)=>{"use strict";B.d(J,{e:()=>D});var Q=B(11419),h=B(11186),y=B(11604),N=B(12567),r=B(11447),q=B(13422),e=B(11065);Q.d.prototype.createOrUpdateSelectionOctree=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,B=this._getComponent(r.b.NAME_OCTREE);B||(B=new D(this),this.rh(B)),this.ll||(this.ll=new q.b(q.b.CreationFuncForMeshes,R,J));const Q=this.getWorldExtends();return this.ll.update(Q.min,Q.max,this.meshes),this.ll},Object.defineProperty(Q.d.prototype,"selectionOctree",{get:function(){return this.ll},enumerable:!0,configurable:!0}),y.d.prototype.createOrUpdateSubmeshesOctree=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const B=this.IR();let Q=B._getComponent(r.b.NAME_OCTREE);Q||(Q=new D(B),B.rh(Q)),this._submeshesOctree||(this._submeshesOctree=new q.b(q.b.CreationFuncForSubMeshes,R,J)),this.ny(!0);const h=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(h.minimumWorld,h.maximumWorld,this.Fh),this._submeshesOctree};class D{constructor(R){this.name=r.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new N.d(h.nJ.Zero(),new h.nJ(1,1,1)),(R=R||e.e.LastCreatedScene)&&(this.AJ=R,this.AJ.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.AJ.getActiveSubMeshCandidates=R=>this.getActiveSubMeshCandidates(R),this.AJ.getCollidingSubMeshCandidates=(R,J)=>this.getCollidingSubMeshCandidates(R,J),this.AJ.getIntersectingSubMeshCandidates=(R,J)=>this.getIntersectingSubMeshCandidates(R,J))}register(){this.AJ.onMeshRemovedObservable.add((R=>{const J=this.AJ.selectionOctree;if(void 0!==J&&null!==J){const B=J.Ol.indexOf(R);-1!==B&&J.Ol.splice(B,1)}})),this.AJ.onMeshImportedObservable.add((R=>{const J=this.AJ.selectionOctree;void 0!==J&&null!==J&&J.fD(R)}))}getActiveMeshCandidates(){var R;return(null===(R=this.AJ.ll)||void 0===R?void 0:R.select(this.AJ.frustumPlanes))||this.AJ._getDefaultMeshCandidates()}getActiveSubMeshCandidates(R){if(R._submeshesOctree&&R.useOctreeForRenderingSelection){return R._submeshesOctree.select(this.AJ.frustumPlanes)}return this.AJ._getDefaultSubMeshCandidates(R)}getIntersectingSubMeshCandidates(R,J){if(R._submeshesOctree&&R.useOctreeForPicking){N.d.TransformToRef(J,R.getWorldMatrix(),this._tempRay);return R._submeshesOctree.intersectsRay(this._tempRay)}return this.AJ._getDefaultSubMeshCandidates(R)}getCollidingSubMeshCandidates(R,J){if(R._submeshesOctree&&R.useOctreeForCollisions){const B=J._velocityWorldLength+Math.max(J._radius.x,J._radius.y,J._radius.z);return R._submeshesOctree.intersects(J._basePointWorld,B)}return this.AJ._getDefaultSubMeshCandidates(R)}rebuild(){}dispose(){}}},12567:(R,J,B)=>{"use strict";B.d(J,{d:()=>O});var Q=B(11419),h=B(11634),y=B(11189),N=B(11186),r=B(11193),q=B(11514),e=B(11444),D=B(11065),l=B(11474);const E={internalPickerForMesh:void 0};class O{constructor(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.d;this.origin=R,this.direction=J,this.length=B,this.epsilon=Q}clone(){return new O(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Q=O._TmpVector3[0].Ar(R.x-B,R.y-B,R.z-B),h=O._TmpVector3[1].Ar(J.x+B,J.y+B,J.z+B);let y,N,r,q,e=0,D=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Q.x||this.origin.x>h.x)return!1}else if(y=1/this.direction.x,N=(Q.x-this.origin.x)*y,r=(h.x-this.origin.x)*y,r===-1/0&&(r=1/0),N>r&&(q=N,N=r,r=q),e=Math.max(N,e),D=Math.min(r,D),e>D)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Q.y||this.origin.y>h.y)return!1}else if(y=1/this.direction.y,N=(Q.y-this.origin.y)*y,r=(h.y-this.origin.y)*y,r===-1/0&&(r=1/0),N>r&&(q=N,N=r,r=q),e=Math.max(N,e),D=Math.min(r,D),e>D)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Q.z||this.origin.z>h.z)return!1}else if(y=1/this.direction.z,N=(Q.z-this.origin.z)*y,r=(h.z-this.origin.z)*y,r===-1/0&&(r=1/0),N>r&&(q=N,N=r,r=q),e=Math.max(N,e),D=Math.min(r,D),e>D)return!1;return!0}intersectsBox(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(R.minimum,R.maximum,J)}intersectsSphere(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const B=R.center.x-this.origin.x,Q=R.center.y-this.origin.y,h=R.center.z-this.origin.z,y=B*B+Q*Q+h*h,N=R.radius+J,r=N*N;if(y<=r)return!0;const q=B*this.direction.x+Q*this.direction.y+h*this.direction.z;if(q<0)return!1;return y-q*q<=r}intersectsTriangle(R,J,B){const Q=O._TmpVector3[0],h=O._TmpVector3[1],y=O._TmpVector3[2],r=O._TmpVector3[3],e=O._TmpVector3[4];J.subtractToRef(R,Q),B.subtractToRef(R,h),N.nJ.CrossToRef(this.direction,h,y);const D=N.nJ.Dot(Q,y);if(0===D)return null;const l=1/D;this.origin.subtractToRef(R,r);const E=N.nJ.Dot(r,y)*l;if(E<-this.epsilon||E>1+this.epsilon)return null;N.nJ.CrossToRef(r,Q,e);const n=N.nJ.Dot(this.direction,e)*l;if(n<-this.epsilon||E+n>1+this.epsilon)return null;const P=N.nJ.Dot(h,e)*l;return P>this.length?null:new q.e(1-E-n,E,P)}intersectsPlane(R){let J;const B=N.nJ.Dot(R.normal,this.direction);if(Math.abs(B)<9.99999997475243e-7)return null;{const Q=N.nJ.Dot(R.normal,this.origin);return J=(-R.d-Q)/B,J<0?J<-9.99999997475243e-7?null:0:J}}intersectsAxis(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(R){case"y":{const R=(this.origin.y-J)/this.direction.y;return R>0?null:new N.nJ(this.origin.x+this.direction.x*-R,J,this.origin.z+this.direction.z*-R)}case"x":{const R=(this.origin.x-J)/this.direction.x;return R>0?null:new N.nJ(J,this.origin.y+this.direction.y*-R,this.origin.z+this.direction.z*-R)}case"z":{const R=(this.origin.z-J)/this.direction.z;return R>0?null:new N.nJ(this.origin.x+this.direction.x*-R,this.origin.y+this.direction.y*-R,J)}default:return null}}intersectsMesh(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=N.TmpVectors.Matrix[0];return R.getWorldMatrix().invertToRef(r),this._tmpRay?O.TransformToRef(this,r,this._tmpRay):this._tmpRay=O.Transform(this,r),R.intersects(this._tmpRay,J,B,Q,h,y)}intersectsMeshes(R,J,B){B?B.length=0:B=[];for(let Q=0;Q<R.length;Q++){const h=this.intersectsMesh(R[Q],J);h.hit&&B.push(h)}return B.sort(this._comparePickingInfo),B}_comparePickingInfo(R,J){return R.distance<J.distance?-1:R.distance>J.distance?1:0}intersectionSegment(R,J,B){const Q=this.origin,h=N.TmpVectors.nJ[0],y=N.TmpVectors.nJ[1],r=N.TmpVectors.nJ[2],q=N.TmpVectors.nJ[3];J.subtractToRef(R,h),this.direction.scaleToRef(O._Rayl,r),Q.addToRef(r,y),R.subtractToRef(Q,q);const e=N.nJ.Dot(h,h),D=N.nJ.Dot(h,r),l=N.nJ.Dot(r,r),E=N.nJ.Dot(h,q),n=N.nJ.Dot(r,q),P=e*l-D*D;let A,u,S=P,f=P;P<O._Smallnum?(A=0,S=1,u=n,f=l):(A=D*n-l*E,u=e*n-D*E,A<0?(A=0,u=n,f=l):A>S&&(A=S,u=n+D,f=l)),u<0?(u=0,-E<0?A=0:-E>e?A=S:(A=-E,S=e)):u>f&&(u=f,-E+D<0?A=0:-E+D>e?A=S:(A=-E+D,S=e));const a=Math.abs(A)<O._Smallnum?0:A/S,s=Math.abs(u)<O._Smallnum?0:u/f,x=N.TmpVectors.nJ[4];r.scaleToRef(s,x);const I=N.TmpVectors.nJ[5];h.scaleToRef(a,I),I.addInPlace(q);const V=N.TmpVectors.nJ[6];I.subtractToRef(x,V);return s>0&&s<=this.length&&V.lengthSquared()<B*B?I.length():-1}update(R,J,B,Q,h,y,r){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){O._RayDistant||(O._RayDistant=O.Zero()),O._RayDistant.unprojectRayToRef(R,J,B,Q,N.Matrix.IdentityReadOnly,y,r);const q=N.TmpVectors.Matrix[0];h.invertToRef(q),O.TransformToRef(O._RayDistant,q,this)}else this.unprojectRayToRef(R,J,B,Q,h,y,r);return this}static Zero(){return new O(N.nJ.Zero(),N.nJ.Zero())}static CreateNew(R,J,B,Q,h,y,N){return O.Zero().update(R,J,B,Q,h,y,N)}static CreateNewFromTo(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.Matrix.IdentityReadOnly;const Q=new O(new N.nJ(0,0,0),new N.nJ(0,0,0));return O.CreateFromToToRef(R,J,Q,B)}static CreateFromToToRef(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.Matrix.IdentityReadOnly;B.origin.h(R);const h=J.subtractToRef(R,B.direction),y=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);return B.length=y,B.direction.normalize(),O.TransformToRef(B,Q,B)}static Transform(R,J){const B=new O(new N.nJ(0,0,0),new N.nJ(0,0,0));return O.TransformToRef(R,J,B),B}static TransformToRef(R,J,B){N.nJ.TransformCoordinatesToRef(R.origin,J,B.origin),N.nJ.TransformNormalToRef(R.direction,J,B.direction),B.length=R.length,B.epsilon=R.epsilon;const Q=B.direction,h=Q.length();if(0!==h&&1!==h){const R=1/h;Q.x*=R,Q.y*=R,Q.z*=R,B.length*=h}return B}unprojectRayToRef(R,J,B,Q,h,y,r){const q=N.TmpVectors.Matrix[0];h.multiplyToRef(y,q),q.multiplyToRef(r,q),q.invert();const e=D.e.LastCreatedEngine,l=N.TmpVectors.nJ[0];l.x=R/B*2-1,l.y=-(J/Q*2-1),l.z=null!==e&&void 0!==e&&e.useReverseDepthBuffer?1:null!==e&&void 0!==e&&e.isNDCHalfZRange?0:-1;const E=N.TmpVectors.nJ[1].Ar(l.x,l.y,1-1e-8),O=N.TmpVectors.nJ[2],n=N.TmpVectors.nJ[3];N.nJ._UnprojectFromInvertedMatrixToRef(l,q,O),N.nJ._UnprojectFromInvertedMatrixToRef(E,q,n),this.origin.h(O),n.subtractToRef(O,this.direction),this.direction.normalize()}}function n(R,J,B,Q,h){let y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const N=O.Zero();return P(R,J,B,Q,N,h,y),N}function P(R,J,B,Q,h,y){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const e=R.getEngine();if(!y&&!(y=R.activeCamera))return R;const D=y.viewport,l=e.getRenderHeight(),{x:E,y:O,width:n,height:P}=D.toGlobal(e.getRenderWidth(),l),A=1/e.getHardwareScalingLevel();return J=J*A-E,B=B*A-(l-O-P),h.update(J,B,n,P,Q||N.Matrix.IdentityReadOnly,r?N.Matrix.IdentityReadOnly:y.getViewMatrix(),y.getProjectionMatrix(),q),R}function A(R,J,B,Q,h){if(!e.c)return R;const y=R.getEngine();if(!h&&!(h=R.activeCamera))throw new Error("Active camera not set");const r=h.viewport,q=y.getRenderHeight(),{x:D,y:l,width:E,height:O}=r.toGlobal(y.getRenderWidth(),q),n=N.Matrix.Identity(),P=1/y.getHardwareScalingLevel();return J=J*P-D,B=B*P-(q-l-O),Q.update(J,B,E,O,n,n,h.getProjectionMatrix()),R}function u(R,J,B,Q,h,y,N,r){const q=J(Q,B.enableDistantPicking),e=B.intersects(q,h,N,y,Q,r);return e&&e.hit?!h&&null!=R&&e.distance>=R.distance?null:e:null}function S(R,J,B,Q,h,y){let r=null;const q=!!(R.activeCameras&&R.activeCameras.length>1&&R.cameraToUseForPointers!==R.activeCamera),D=R.cameraToUseForPointers||R.activeCamera,l=E.internalPickerForMesh||u;for(let e=0;e<R.meshes.length;e++){const E=R.meshes[e];if(B){if(!B(E,-1))continue}else if(!E.isEnabled()||!E.isVisible||!E.gq)continue;const O=q&&E.isWorldMatrixCameraDependent(),n=E.ny(O,D);if(E.hasThinInstances&&E.He){const R=l(r,J,E,n,!0,!0,y);if(R){if(h)return R;const q=N.TmpVectors.Matrix[1],e=E.thinInstanceGetWorldMatrices();for(let R=0;R<e.length;R++){if(B&&!B(E,R))continue;e[R].multiplyToRef(n,q);const N=l(r,J,E,q,Q,h,y,!0);if(N&&(r=N,r.thinInstanceIndex=R,Q))return r}}}else{const R=l(r,J,E,n,Q,h,y);if(R&&(r=R,Q))return r}}return r||new e.c}function f(R,J,B,Q){if(!e.c)return null;const h=[],y=!!(R.activeCameras&&R.activeCameras.length>1&&R.cameraToUseForPointers!==R.activeCamera),r=R.cameraToUseForPointers||R.activeCamera,q=E.internalPickerForMesh||u;for(let e=0;e<R.meshes.length;e++){const D=R.meshes[e];if(B){if(!B(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.gq)continue;const l=y&&D.isWorldMatrixCameraDependent(),E=D.ny(l,r);if(D.hasThinInstances&&D.He){if(q(null,J,D,E,!0,!0,Q)){const R=N.TmpVectors.Matrix[1],y=D.thinInstanceGetWorldMatrices();for(let N=0;N<y.length;N++){if(B&&!B(D,N))continue;y[N].multiplyToRef(E,R);const r=q(null,J,D,R,!1,!1,Q,!0);r&&(r.thinInstanceIndex=N,h.push(r))}}}else{const R=q(null,J,D,E,!1,!1,Q);R&&h.push(R)}}return h}function a(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,Q=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;Q||(Q=R.getWorldMatrix()),J.length=B,h?J.origin.h(h):J.origin.h(R.position);const y=N.TmpVectors.nJ[2];y.set(0,0,R._scene.useRightHandedSystem?-1:1);const r=N.TmpVectors.nJ[3];return N.nJ.TransformNormalToRef(y,Q,r),N.nJ.NormalizeToRef(r,J.direction),J}var s,x;O._TmpVector3=(0,r.e)(6,N.nJ.Zero),O._RayDistant=O.Zero(),O._Smallnum=1e-8,O._Rayl=1e9,s=Q.d,(x=h.d)&&(x.prototype.getForwardRay=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,J=arguments.length>1?arguments[1]:void 0,B=arguments.length>2?arguments[2]:void 0;return a(this,new O(N.nJ.Zero(),N.nJ.Zero(),R),R,J,B)},x.prototype.getForwardRayToRef=function(R){return a(this,R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),s&&(l.e._IsPickingAvailable=!0,s.prototype.createPickingRay=function(R,J,B,Q){return n(this,R,J,B,Q,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),Q.d.prototype.createPickingRayToRef=function(R,J,B,Q,h){return P(this,R,J,B,Q,h,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},Q.d.prototype.createPickingRayInCameraSpace=function(R,J,B){return function(R,J,B,Q){const h=O.Zero();return A(R,J,B,h,Q),h}(this,R,J,B)},Q.d.prototype.createPickingRayInCameraSpaceToRef=function(R,J,B,Q){return A(this,R,J,B,Q)},Q.d.prototype.pickWithBoundingInfo=function(R,J,B,Q,h){return function(R,J,B,Q,h,y){if(!e.c)return null;const r=S(R,(Q=>(R._tempPickingRay||(R._tempPickingRay=O.Zero()),P(R,J,B,Q,R._tempPickingRay,y||null),R._tempPickingRay)),Q,h,!0);return r&&(r.ray=n(R,J,B,N.Matrix.Identity(),y||null)),r}(this,R,J,B,Q,h)},Q.d.prototype.lB=function(R,J,B,Q,h,y){return function(R,J,B,Q,h,y,r){const q=S(R,((Q,h)=>(R._tempPickingRay||(R._tempPickingRay=O.Zero()),P(R,J,B,Q,R._tempPickingRay,y||null,!1,h),R._tempPickingRay)),Q,h,!1,r);return q&&(q.ray=n(R,J,B,N.Matrix.Identity(),y||null)),q}(this,R,J,B,Q,h,y)},Q.d.prototype.pickWithRay=function(R,J,B,Q){return function(R,J,B,Q,h){const y=S(R,(B=>(R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=N.Matrix.Identity()),B.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=O.Zero()),O.TransformToRef(J,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform)),B,Q,!1,h);return y&&(y.ray=J),y}(this,R,J,B,Q)},Q.d.prototype.multiPick=function(R,J,B,Q,h){return function(R,J,B,Q,h,y){return f(R,(Q=>n(R,J,B,Q,h||null)),Q,y)}(this,R,J,B,Q,h)},Q.d.prototype.multiPickWithRay=function(R,J,B){return function(R,J,B,Q){return f(R,(B=>(R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=N.Matrix.Identity()),B.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=O.Zero()),O.TransformToRef(J,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform)),B,Q)}(this,R,J,B)}},12865:(R,J,B)=>{"use strict";var Q=B(11124),h=B(11043),y=B(11073),N=B(11148),r=B(11094),q=B(11133);r.c.prototype._partialLoadFile=function(R,J,B,Q){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(R,(R=>{B[J]=R,B._internalCount++,6===B._internalCount&&Q(B)}),void 0,void 0,!0,((R,J)=>{h&&R&&h(R.status+" "+R.statusText,J)}))},r.c.prototype._cascadeLoadFiles=function(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=[];h._internalCount=0;for(let y=0;y<6;y++)this._partialLoadFile(B[y],y,h,J,Q)},r.c.prototype._cascadeLoadImgs=function(R,J,B,Q){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5?arguments[5]:void 0;const N=[];N._internalCount=0;for(let r=0;r<6;r++)this._partialLoadImg(Q[r],r,N,R,J,B,h,y)},r.c.prototype._partialLoadImg=function(R,J,B,Q,h,r){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7?arguments[7]:void 0;const D=(0,N.c)();(0,y.q)(R,(R=>{B[J]=R,B._internalCount++,Q&&Q.removePendingData(D),6===B._internalCount&&r&&r(h,B)}),((R,J)=>{Q&&Q.removePendingData(D),q&&q(R,J)}),Q?Q.offlineProvider:null,e),Q&&Q.addPendingData(D)},r.c.prototype.createCubeTextureBase=function(R,J,B,y){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6?arguments[6]:void 0,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,A=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,u=arguments.length>14&&void 0!==arguments[14]&&arguments[14],S=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const f=n||new Q.c(this,7);f.isCube=!0,f.url=R,f.generateMipMaps=!y,f._lodGenerationScale=E,f._lodGenerationOffset=O,f._useSRGBBuffer=!!u&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!y),f!==n&&(f.label=R.substring(0,60)),this._doNotHandleContextLost||(f._extension=D,f._files=B,f._buffer=S);const a=R;this._transformTextureUrl&&!n&&(R=this._transformTextureUrl(R));const s=D??function(R){const J=R.split("?")[0],B=J.lastIndexOf(".");return B>-1?J.substring(B).toLowerCase():""}(R),x=(0,q.c)(s),I=(R,J)=>{f.dispose(),r?r(R,J):R&&h.d.Warn(R)},V=(Q,r)=>{R===a?Q&&I(Q.status+" "+Q.statusText,r):(h.d.Warn(`Failed to load ${R}, falling back to the ${a}`),this.createCubeTextureBase(a,J,B,!!y,N,I,e,D,l,E,O,f,P,A,u,S))};if(x)x.then((Q=>{const h=R=>{P&&P(f,R),Q.loadCubeData(R,f,l,N,((R,J)=>{I(R,J)}))};S?h(S):B&&6===B.length?Q.supportCascades?this._cascadeLoadFiles(J,(R=>h(R.map((R=>new Uint8Array(R))))),B,I):I("Textures type does not support cascades."):this._loadFile(R,(R=>h(new Uint8Array(R))),void 0,void 0,!0,V)}));else{if(!B||0===B.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(J,f,((R,J)=>{A&&A(R,J)}),B,I)}return this._internalTexturesCache.push(f),f}},13440:(R,J,B)=>{"use strict";B(11043);var Q=B(11310);B(11124),B(11268),B(11117),B(11357),B(11323);Q.d},12892:(R,J,B)=>{"use strict";B.d(J,{d:()=>h});var Q=B(11142);class h{constructor(R){this.value=this._toInt(R)}_toInt(R){return 0|R}add(R){return new h(this.value+R.value)}PJ(R){return new h(this.value-R.value)}multiply(R){return new h(Math.imul(this.value,R.value))}divide(R){return new h(this.value/R.value)}getClassName(){return h.ClassName}equals(R){return this.value===R.value}static FromValue(R){return new h(R)}toString(){return this.value.toString()}}h.ClassName="FlowGraphInteger",(0,Q.h)("FlowGraphInteger",h)},12903:(R,J,B)=>{"use strict";B.d(J,{e:()=>h,h:()=>y});var Q=B(11186);class h{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.nh=R}get m(){return this.nh}transformVector(R){return this.transformVectorToRef(R,new Q.Vector2)}transformVectorToRef(R,J){return J.x=R.x*this.nh[0]+R.y*this.nh[1],J.y=R.x*this.nh[2]+R.y*this.nh[3],J}Ch(){return this.toArray()}toArray(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let J=0;J<4;J++)R[J]=this.nh[J];return R}EB(R){for(let J=0;J<4;J++)this.nh[J]=R[J];return this}multiplyToRef(R,J){const B=R.nh,Q=this.nh,h=J.nh;return h[0]=B[0]*Q[0]+B[1]*Q[2],h[1]=B[0]*Q[1]+B[1]*Q[3],h[2]=B[2]*Q[0]+B[3]*Q[2],h[3]=B[2]*Q[1]+B[3]*Q[3],J}multiply(R){return this.multiplyToRef(R,new h)}divideToRef(R,J){const B=this.nh,Q=R.nh,h=J.nh;return h[0]=B[0]/Q[0],h[1]=B[1]/Q[1],h[2]=B[2]/Q[2],h[3]=B[3]/Q[3],J}divide(R){return this.divideToRef(R,new h)}addToRef(R,J){const B=this.nh,Q=R.m,h=J.m;return h[0]=B[0]+Q[0],h[1]=B[1]+Q[1],h[2]=B[2]+Q[2],h[3]=B[3]+Q[3],J}add(R){return this.addToRef(R,new h)}subtractToRef(R,J){const B=this.nh,Q=R.m,h=J.m;return h[0]=B[0]-Q[0],h[1]=B[1]-Q[1],h[2]=B[2]-Q[2],h[3]=B[3]-Q[3],J}PJ(R){return this.subtractToRef(R,new h)}transpose(){const R=this.nh;return new h([R[0],R[2],R[1],R[3]])}determinant(){const R=this.nh;return R[0]*R[3]-R[1]*R[2]}inverse(){const R=this.determinant();if(0===R)throw new Error("Matrix is not invertible");const J=this.nh,B=1/R;return new h([J[3]*B,-J[1]*B,-J[2]*B,J[0]*B])}equals(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const B=this.nh,Q=R.m;return 0===J?B[0]===Q[0]&&B[1]===Q[1]&&B[2]===Q[2]&&B[3]===Q[3]:Math.abs(B[0]-Q[0])<J&&Math.abs(B[1]-Q[1])<J&&Math.abs(B[2]-Q[2])<J&&Math.abs(B[3]-Q[3])<J}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.nh.join(", ")})`}}class y{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.nh=R}get m(){return this.nh}transformVector(R){return this.transformVectorToRef(R,new Q.nJ)}transformVectorToRef(R,J){const B=this.nh;return J.x=R.x*B[0]+R.y*B[1]+R.z*B[2],J.y=R.x*B[3]+R.y*B[4]+R.z*B[5],J.z=R.x*B[6]+R.y*B[7]+R.z*B[8],J}multiplyToRef(R,J){const B=R.nh,Q=this.nh,h=J.m;return h[0]=B[0]*Q[0]+B[1]*Q[3]+B[2]*Q[6],h[1]=B[0]*Q[1]+B[1]*Q[4]+B[2]*Q[7],h[2]=B[0]*Q[2]+B[1]*Q[5]+B[2]*Q[8],h[3]=B[3]*Q[0]+B[4]*Q[3]+B[5]*Q[6],h[4]=B[3]*Q[1]+B[4]*Q[4]+B[5]*Q[7],h[5]=B[3]*Q[2]+B[4]*Q[5]+B[5]*Q[8],h[6]=B[6]*Q[0]+B[7]*Q[3]+B[8]*Q[6],h[7]=B[6]*Q[1]+B[7]*Q[4]+B[8]*Q[7],h[8]=B[6]*Q[2]+B[7]*Q[5]+B[8]*Q[8],J}multiply(R){return this.multiplyToRef(R,new y)}divideToRef(R,J){const B=this.nh,Q=R.m,h=J.m;return h[0]=B[0]/Q[0],h[1]=B[1]/Q[1],h[2]=B[2]/Q[2],h[3]=B[3]/Q[3],h[4]=B[4]/Q[4],h[5]=B[5]/Q[5],h[6]=B[6]/Q[6],h[7]=B[7]/Q[7],h[8]=B[8]/Q[8],J}divide(R){return this.divideToRef(R,new y)}addToRef(R,J){const B=this.nh,Q=R.m,h=J.m;return h[0]=B[0]+Q[0],h[1]=B[1]+Q[1],h[2]=B[2]+Q[2],h[3]=B[3]+Q[3],h[4]=B[4]+Q[4],h[5]=B[5]+Q[5],h[6]=B[6]+Q[6],h[7]=B[7]+Q[7],h[8]=B[8]+Q[8],J}add(R){return this.addToRef(R,new y)}subtractToRef(R,J){const B=this.nh,Q=R.m,h=J.m;return h[0]=B[0]-Q[0],h[1]=B[1]-Q[1],h[2]=B[2]-Q[2],h[3]=B[3]-Q[3],h[4]=B[4]-Q[4],h[5]=B[5]-Q[5],h[6]=B[6]-Q[6],h[7]=B[7]-Q[7],h[8]=B[8]-Q[8],J}PJ(R){return this.subtractToRef(R,new y)}toArray(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let J=0;J<9;J++)R[J]=this.nh[J];return R}Ch(){return this.toArray()}EB(R){for(let J=0;J<9;J++)this.nh[J]=R[J];return this}transpose(){const R=this.nh;return new y([R[0],R[3],R[6],R[1],R[4],R[7],R[2],R[5],R[8]])}determinant(){const R=this.nh;return R[0]*(R[4]*R[8]-R[5]*R[7])-R[1]*(R[3]*R[8]-R[5]*R[6])+R[2]*(R[3]*R[7]-R[4]*R[6])}inverse(){const R=this.determinant();if(0===R)throw new Error("Matrix is not invertible");const J=this.nh,B=1/R;return new y([(J[4]*J[8]-J[5]*J[7])*B,(J[2]*J[7]-J[1]*J[8])*B,(J[1]*J[5]-J[2]*J[4])*B,(J[5]*J[6]-J[3]*J[8])*B,(J[0]*J[8]-J[2]*J[6])*B,(J[2]*J[3]-J[0]*J[5])*B,(J[3]*J[7]-J[4]*J[6])*B,(J[1]*J[6]-J[0]*J[7])*B,(J[0]*J[4]-J[1]*J[3])*B])}equals(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const B=this.nh,Q=R.m;return 0===J?B[0]===Q[0]&&B[1]===Q[1]&&B[2]===Q[2]&&B[3]===Q[3]&&B[4]===Q[4]&&B[5]===Q[5]&&B[6]===Q[6]&&B[7]===Q[7]&&B[8]===Q[8]:Math.abs(B[0]-Q[0])<J&&Math.abs(B[1]-Q[1])<J&&Math.abs(B[2]-Q[2])<J&&Math.abs(B[3]-Q[3])<J&&Math.abs(B[4]-Q[4])<J&&Math.abs(B[5]-Q[5])<J&&Math.abs(B[6]-Q[6])<J&&Math.abs(B[7]-Q[7])<J&&Math.abs(B[8]-Q[8])<J}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.nh.join(", ")})`}}},12909:(R,J,B)=>{"use strict";var Q;function h(R,J,B,Q){switch(J){case"Animation":return Q?R.animations.find((R=>R.uniqueId===B))??null:R.animations[B]??null;case"AnimationGroup":return Q?R.animationGroups.find((R=>R.uniqueId===B))??null:R.animationGroups[B]??null;case"Mesh":return Q?R.meshes.find((R=>R.uniqueId===B))??null:R.meshes[B]??null;case"Material":return Q?R.materials.find((R=>R.uniqueId===B))??null:R.materials[B]??null;case"dD":return Q?R.cameras.find((R=>R.uniqueId===B))??null:R.cameras[B]??null;case"Light":return Q?R.lights.find((R=>R.uniqueId===B))??null:R.lights[B]??null;default:return null}}B.d(J,{e:()=>h}),function(R){R.Animation="Animation",R.AnimationGroup="AnimationGroup",R.Mesh="Mesh",R.Material="Material",R.dD="dD",R.Light="Light"}(Q||(Q={}))},12943:(R,J,B)=>{"use strict";B.d(J,{c:()=>h});var Q=B(12947);class h extends Q.d{constructor(R,J){if(super(R),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),J)for(const B of J)this._eventsSignalOutputs[B]=this._registerSignalOutput(B+"Event")}_executeOnTick(R){}_startPendingTasks(R){R._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(R),this._resetAfterCanceled(R)),this._preparePendingTasks(R),R._addPendingBlock(this),this.out._activateSignal(R),R._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(R){R._deleteExecutionVariable(this,"_initialized"),R._removePendingBlock(this)}}},12922:(R,J,B)=>{"use strict";B.d(J,{c:()=>e});var Q=B(11148),h=B(11142),y=B(12930),N=B(11032),r=B(12886);class q extends y.e{constructor(R,J,B,Q){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Q.defaultValue,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(R,J,B),this.richType=Q,this._defaultValue=h,this._optional=y,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new N.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(R){this._isDisabled!==R&&(this._isDisabled=R,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(R,J){J._getConnectionValue(this)!==R&&(J._setConnectionValue(this,R),this.onValueChangedObservable.notifyObservers(R))}resetToDefaultValue(R){R._setConnectionValue(this,this._defaultValue)}connectTo(R){this._isDisabled||super.connectTo(R)}_getValueOrDefault(R){const J=R._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(J):J}getValue(R){if(1===this.connectionType){R._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(R);const J=this._getValueOrDefault(R);return this._lastValue=J,this.richType.typeTransformer?this.richType.typeTransformer(J):J}const J=this.isConnected()?this._connectedPoint[0].getValue(R):this._getValueOrDefault(R);return this._lastValue=J,this.richType.typeTransformer?this.richType.typeTransformer(J):J}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.richType={},this.richType.serialize(R.richType),R.optional=this._optional,(0,r.g)("defaultValue",this._defaultValue,R)}}(0,h.h)("FlowGraphDataConnection",q);class e{constructor(R){var J;this.config=R,this.uniqueId=(0,Q.c)(),this.name=(null===(J=this.config)||void 0===J?void 0:J.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(R){}registerDataInput(R,J,B){const Q=new q(R,0,this,J,B);return this.dataInputs.push(Q),Q}registerDataOutput(R,J,B){const Q=new q(R,1,this,J,B);return this.dataOutputs.push(Q),Q}getDataInput(R){return this.dataInputs.find((J=>J.name===R))}getDataOutput(R){return this.dataOutputs.find((J=>J.name===R))}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.g;if(R.uniqueId=this.uniqueId,R.config={},this.config){const B=this.config,Q=Object.keys(B);for(const h of Q)J(h,B[h],R.config)}R.dataInputs=[],R.dataOutputs=[],R.className=this.getClassName();for(const B of this.dataInputs){const J={};B.serialize(J),R.dataInputs.push(J)}for(const B of this.dataOutputs){const J={};B.serialize(J),R.dataOutputs.push(J)}}deserialize(R){}_log(R,J,B){var Q;null===(Q=R.logger)||void 0===Q||Q.addLogItem({action:J,OB:B,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12930:(R,J,B)=>{"use strict";B.d(J,{e:()=>y});var Q,h=B(11148);!function(R){R[R.Input=0]="Input",R[R.Output=1]="Output"}(Q||(Q={}));class y{constructor(R,J,B){this._ownerBlock=B,this._connectedPoint=[],this.uniqueId=(0,h.c)(),this.connectedPointIds=[],this.name=R,this._connectionType=J}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(R){if(this._connectionType===R._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||R._isSingularConnection()&&R._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(R),R._connectedPoint.push(this)}disconnectFrom(R){let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const B=this._connectedPoint.indexOf(R),Q=R._connectedPoint.indexOf(this);-1!==B&&-1!==Q&&(J&&this._connectedPoint.splice(B,1),R._connectedPoint.splice(Q,1))}disconnectFromAll(){for(const R of this._connectedPoint)this.disconnectFrom(R,!1);this._connectedPoint.length=0}dispose(){for(const R of this._connectedPoint)this.disconnectFrom(R)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R.uniqueId=this.uniqueId,R.name=this.name,R._connectionType=this._connectionType,R.connectedPointIds=[],R.className=this.getClassName();for(const J of this._connectedPoint)R.connectedPointIds.push(J.uniqueId)}getClassName(){return"FGConnection"}deserialize(R){this.uniqueId=R.uniqueId,this.name=R.name,this._connectionType=R._connectionType,this.connectedPointIds=R.connectedPointIds}}},12884:(R,J,B)=>{"use strict";B.d(J,{c:()=>f});var Q,h=B(11032),y=B(11167),N=B(11176),r=B(11148),q=B(12886),e=B(12909),D=B(11043);!function(R){R.ExecuteBlock="ExecuteBlock",R.ExecuteEvent="ExecuteEvent",R.TriggerConnection="TriggerConnection",R.ContextVariableSet="ContextVariableSet",R.GlobalVariableSet="GlobalVariableSet",R.GlobalVariableDelete="GlobalVariableDelete",R.GlobalVariableGet="GlobalVariableGet",R.AddConnection="AddConnection",R.GetConnectionValue="GetConnectionValue",R.SetConnectionValue="SetConnectionValue",R.ActivateSignal="ActivateSignal",R.ContextVariableGet="ContextVariableGet"}(Q||(Q={}));class l{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(R){if(R.time||(R.time=Date.now()),this.log.push(R),this.logToConsole){var J;const B=null===(J=R.OB)||void 0===J?void 0:J.value;"object"===typeof B&&B.getClassName?D.d.Log(`[FGLog] ${R.className}:${R.uniqueId.split("-")[0]} ${R.action} - ${JSON.stringify(B.getClassName())}: ${B.toString()}`):D.d.Log(`[FGLog] ${R.className}:${R.uniqueId.split("-")[0]} ${R.action} - ${JSON.stringify(R.OB)}`)}}getItemsOfType(R){return this.log.filter((J=>J.action===R))}}class E{get enableLogging(){return this._enableLogging}set enableLogging(R){this._enableLogging!==R&&(this._enableLogging=R,this._enableLogging?(this.logger=new l,this.logger.logToConsole=!0):this.logger=null)}constructor(R){this.uniqueId=(0,r.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new h.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=R,this.assetsContext=R.assetsContext??R.AJ}hasVariable(R){return R in this._userVariables}setVariable(R,J){var B;this._userVariables[R]=J,null===(B=this.logger)||void 0===B||B.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",OB:{name:R,value:J}})}getAsset(R,J){return(0,e.e)(this.assetsContext,R,J)}getVariable(R){var J;return null===(J=this.logger)||void 0===J||J.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",OB:{name:R,value:this._userVariables[R]}}),this._userVariables[R]}get userVariables(){return this._userVariables}IR(){return this._configuration.AJ}_getUniqueIdPrefixedName(R,J){return`${R.uniqueId}_${J}`}_getGlobalContextVariable(R,J){var B;return null===(B=this.logger)||void 0===B||B.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",OB:{name:R,defaultValue:J,possibleValue:this._globalContextVariables[R]}}),this._hasGlobalContextVariable(R)?this._globalContextVariables[R]:J}_setGlobalContextVariable(R,J){var B;null===(B=this.logger)||void 0===B||B.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",OB:{name:R,value:J}}),this._globalContextVariables[R]=J}_deleteGlobalContextVariable(R){var J;null===(J=this.logger)||void 0===J||J.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",OB:{name:R}}),delete this._globalContextVariables[R]}_hasGlobalContextVariable(R){return R in this._globalContextVariables}_setExecutionVariable(R,J,B){this._executionVariables[this._getUniqueIdPrefixedName(R,J)]=B}_getExecutionVariable(R,J,B){return this._hasExecutionVariable(R,J)?this._executionVariables[this._getUniqueIdPrefixedName(R,J)]:B}_deleteExecutionVariable(R,J){delete this._executionVariables[this._getUniqueIdPrefixedName(R,J)]}_hasExecutionVariable(R,J){return this._getUniqueIdPrefixedName(R,J)in this._executionVariables}_hasConnectionValue(R){return R.uniqueId in this._connectionValues}_setConnectionValue(R,J){var B;this._connectionValues[R.uniqueId]=J,null===(B=this.logger)||void 0===B||B.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",OB:{connectionPointId:R.uniqueId,value:J}})}_setConnectionValueByKey(R,J){this._connectionValues[R]=J}_getConnectionValue(R){var J;return null===(J=this.logger)||void 0===J||J.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",OB:{connectionPointId:R.uniqueId,value:this._connectionValues[R.uniqueId]}}),this._connectionValues[R.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(R){this._pendingBlocks.includes(R)||(this._pendingBlocks.push(R),this._pendingBlocks.sort(((R,J)=>R.priority-J.priority)))}_removePendingBlock(R){const J=this._pendingBlocks.indexOf(R);-1!==J&&this._pendingBlocks.splice(J,1)}_clearPendingBlocks(){for(const R of this._pendingBlocks)R._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(R){var J;this.onNodeExecutedObservable.notifyObservers(R),null===(J=this.logger)||void 0===J||J.addLogItem({time:Date.now(),className:R.getClassName(),uniqueId:R.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(R){this._setGlobalContextVariable("timeSinceStart",R.timeSinceStart),this._setGlobalContextVariable("deltaTime",R.deltaTime);for(const B of this._pendingBlocks){var J;null===(J=B._executeOnTick)||void 0===J||J.call(B,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.g;R.uniqueId=this.uniqueId,R._userVariables={};for(const Q in this._userVariables)J(Q,this._userVariables[Q],R._userVariables);R._connectionValues={};for(const Q in this._connectionValues)J(Q,this._connectionValues[Q],R._connectionValues);var B;this.assetsContext!==this.IR()&&(R._assetsContext={meshes:this.assetsContext.meshes.map((R=>R.id)),materials:this.assetsContext.materials.map((R=>R.id)),textures:this.assetsContext.textures.map((R=>R.name)),animations:this.assetsContext.animations.map((R=>R.name)),lights:this.assetsContext.lights.map((R=>R.id)),cameras:this.assetsContext.cameras.map((R=>R.id)),vE:null===(B=this.assetsContext.vE)||void 0===B?void 0:B.map((R=>R.name)),skeletons:this.assetsContext.skeletons.map((R=>R.id)),OE:this.assetsContext.OE.map((R=>R.name)),geometries:this.assetsContext.geometries.map((R=>R.id)),multiMaterials:this.assetsContext.multiMaterials.map((R=>R.id)),transformNodes:this.assetsContext.transformNodes.map((R=>R.id))})}getClassName(){return"FlowGraphContext"}}(0,y.e)([(0,N.N)()],E.prototype,"uniqueId",void 0);var O=B(12913),n=B(11455);class P{constructor(R){this.onEventTriggeredObservable=new h.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=R,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.eh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const R=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",OB:{timeSinceStart:this._startingTime,deltaTime:R}}),this._startingTime+=R})),this._meshPickedObserver=this._scene.onPointerObservable.add((R=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",OB:R})}),n.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((R=>{const J=R.pointerId,B=R.mesh,Q=this._pointerUnderMeshState[J];!Q&&B?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",OB:{pointerId:J,mesh:B}}):Q&&!B?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",OB:{pointerId:J,mesh:Q}}):Q&&B&&Q!==B&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",OB:{pointerId:J,mesh:Q,over:B}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",OB:{pointerId:J,mesh:B,out:Q}})),this._pointerUnderMeshState[J]=B}),n.e.POINTERMOVE)}dispose(){var R,J,B,Q,h;null===(R=this._sceneDisposeObserver)||void 0===R||R.remove(),null===(J=this._sceneReadyObserver)||void 0===J||J.remove(),null===(B=this._sceneOnBeforeRenderObserver)||void 0===B||B.remove(),null===(Q=this._meshPickedObserver)||void 0===Q||Q.remove(),null===(h=this._meshUnderPointerObserver)||void 0===h||h.remove(),this.onEventTriggeredObservable.clear()}}var A,u=B(12934);!function(R){R[R.Stopped=0]="Stopped",R[R.Started=1]="Started"}(A||(A={}));class S{get state(){return this._state}set state(R){this._state=R,this.onStateChangedObservable.notifyObservers(R)}constructor(R){this.onStateChangedObservable=new h.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=R.AJ,this._sceneEventCoordinator=new P(this._scene),this._coordinator=R.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((R=>{for(const J of this._executionContexts){const B=this._getContextualOrder(R.type,J);for(const Q of B)if(!Q._executeEvent(J,R.OB))break}switch(R.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const J of this._executionContexts)J._notifyOnTick(R.OB);break;case"SceneDispose":this.dispose()}}))}createContext(){const R=new E({AJ:this._scene,coordinator:this._coordinator});return this._executionContexts.push(R),R}getContext(R){return this._executionContexts[R]}addEventBlock(R){if("PointerOver"!==R.type&&"PointerOut"!==R.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==R.type&&this._eventBlocks[R.type].push(R),1===this.state)for(const J of this._executionContexts)R._startPendingTasks(J);else this.onStateChangedObservable.addOnce((J=>{if(1===J)for(const B of this._executionContexts)R._startPendingTasks(B)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((R=>{1===R&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const R of this._executionContexts)for(const J in this._eventBlocks){const B=this._getContextualOrder(J,R);for(const J of B)J._startPendingTasks(R)}}_getContextualOrder(R,J){const B=this._eventBlocks[R].sort(((R,J)=>J.initPriority-R.initPriority));if("MeshPick"===R){const R=[];for(const Q of B){const h=Q.asset.getValue(J);let y=0;for(;y<B.length;y++){const R=B[y].asset.getValue(J);if(h&&R&&(0,u.l)(h,R))break}R.splice(y,0,Q)}return R}return B}dispose(){var R;if(0!==this.state){this.state=0;for(const R of this._executionContexts)R._clearPendingBlocks();this._executionContexts.length=0;for(const R in this._eventBlocks)this._eventBlocks[R].length=0;null===(R=this._eventObserver)||void 0===R||R.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(R){const J=[],B=new Set;for(const Q in this._eventBlocks)for(const R of this._eventBlocks[Q])J.push(R),B.add(R.uniqueId);for(;J.length>0;){const Q=J.pop();R(Q);for(const R of Q.dataInputs)for(const Q of R._connectedPoint)B.has(Q._ownerBlock.uniqueId)||(J.push(Q._ownerBlock),B.add(Q._ownerBlock.uniqueId));if(Q instanceof O.d)for(const R of Q.signalOutputs)for(const Q of R._connectedPoint)B.has(Q._ownerBlock.uniqueId)||(J.push(Q._ownerBlock),B.add(Q._ownerBlock.uniqueId))}}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},J=arguments.length>1?arguments[1]:void 0;R.allBlocks=[],this.visitAllBlocks((J=>{const B={};J.serialize(B),R.allBlocks.push(B)})),R.executionContexts=[];for(const B of this._executionContexts){const Q={};B.serialize(Q,J),R.executionContexts.push(Q)}}}class f{constructor(R){this.config=R,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.AJ.eh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.AJ.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const R=this._executeOnNextFrame.slice(0);if(R.length)for(const J of R){this.notifyCustomEvent(J.id,J.data,!1);const R=this._executeOnNextFrame.findIndex((R=>R.uniqueId===J.uniqueId));-1!==R&&this._executeOnNextFrame.splice(R,1)}}));(f.SceneCoordinators.get(this.config.AJ)??[]).push(this)}createGraph(){const R=new S({AJ:this.config.AJ,coordinator:this});return this._flowGraphs.push(R),R}removeGraph(R){const J=this._flowGraphs.indexOf(R);-1!==J&&(R.dispose(),this._flowGraphs.splice(J,1))}start(){for(const R of this._flowGraphs)R.start()}dispose(){var R,J;for(const h of this._flowGraphs)h.dispose();this._flowGraphs.length=0,null===(R=this._disposeObserver)||void 0===R||R.remove(),null===(J=this._onBeforeRenderObserver)||void 0===J||J.remove();const B=f.SceneCoordinators.get(this.config.AJ)??[],Q=B.indexOf(this);-1!==Q&&B.splice(Q,1)}serialize(R,J){R._flowGraphs=[];for(const B of this._flowGraphs){const Q={};B.serialize(Q,J),R._flowGraphs.push(Q)}R.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(R){let J=this._customEventsMap.get(R);return J||(J=new h.e,this._customEventsMap.set(R,J)),J}notifyCustomEvent(R,J){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:R,data:J,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(R)){const J=this._eventExecutionCounter.get(R);if(this._eventExecutionCounter.set(R,J+1),J>=f.MaxEventTypeExecutionPerFrame)return void(J===f.MaxEventTypeExecutionPerFrame&&D.d.Warn(`FlowGraphCoordinator: Too many executions of event "${R}".`))}else this._eventExecutionCounter.set(R,1);const B=this._customEventsMap.get(R);B&&B.notifyObservers(J)}}f.MaxEventsPerType=30,f.MaxEventTypeExecutionPerFrame=30,f.SceneCoordinators=new Map},12937:(R,J,B)=>{"use strict";B.d(J,{b:()=>h});var Q=B(12943);class h extends Q.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(R){R._notifyExecuteNode(this),this.done._activateSignal(R)}}},12913:(R,J,B)=>{"use strict";B.d(J,{d:()=>r});var Q=B(12922),h=B(12930),y=B(11142);class N extends h.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(R){super.connectTo(R),this._connectedPoint.sort(((R,J)=>J.priority-R.priority))}_activateSignal(R){var J;if(null===(J=R.logger)||void 0===J||J.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,OB:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)R._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(R,this),R._increaseExecutionId();else for(const B of this._connectedPoint)B._activateSignal(R)}}(0,y.h)("FlowGraphSignalConnection",N);class r extends Q.c{constructor(R){super(R),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(R){const J=new N(R,0,this);return this.signalInputs.push(J),J}_registerSignalOutput(R){const J=new N(R,1,this);return this.signalOutputs.push(J),J}_unregisterSignalInput(R){const J=this.signalInputs.findIndex((J=>J.name===R));-1!==J&&(this.signalInputs[J].dispose(),this.signalInputs.splice(J,1))}_unregisterSignalOutput(R){const J=this.signalOutputs.findIndex((J=>J.name===R));-1!==J&&(this.signalOutputs[J].dispose(),this.signalOutputs.splice(J,1))}_reportError(R,J){this.error.OB="string"===typeof J?new Error(J):J,this.error._activateSignal(R)}getSignalInput(R){return this.signalInputs.find((J=>J.name===R))}getSignalOutput(R){return this.signalOutputs.find((J=>J.name===R))}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.signalInputs=[],R.signalOutputs=[];for(const J of this.signalInputs){const B={};J.serialize(B),R.signalInputs.push(B)}for(const J of this.signalOutputs){const B={};J.serialize(B),R.signalOutputs.push(B)}}deserialize(R){for(let J=0;J<R.signalInputs.length;J++){const B=this.getSignalInput(R.signalInputs[J].name);if(!B)throw new Error("Could not find signal input with name "+R.signalInputs[J].name+" in block "+R.className);B.deserialize(R.signalInputs[J])}for(let J=0;J<R.signalOutputs.length;J++){const B=this.getSignalOutput(R.signalOutputs[J].name);if(!B)throw new Error("Could not find signal output with name "+R.signalOutputs[J].name+" in block "+R.className);B.deserialize(R.signalOutputs[J])}}getClassName(){return"FlowGraphExecutionBlock"}}},12947:(R,J,B)=>{"use strict";B.d(J,{d:()=>h});var Q=B(12913);class h extends Q.d{constructor(R){super(R),this.out=this._registerSignalOutput("out")}}},12894:(R,J,B)=>{"use strict";B.d(J,{D:()=>n,H:()=>P,J:()=>M,M:()=>H,O:()=>V,R:()=>I,e:()=>e,g:()=>E,k:()=>x,l:()=>A,m:()=>u,p:()=>S,t:()=>l,w:()=>s,x:()=>D,z:()=>O});var Q,h=B(11186),y=B(11224),N=B(12892),r=B(12903);!function(R){R.Any="any",R.String="string",R.Number="number",R.Boolean="boolean",R.Object="object",R.Integer="FlowGraphInteger",R.Vector2="Vector2",R.nJ="nJ",R.Vector4="Vector4",R.Quaternion="Quaternion",R.Matrix="Matrix",R.Matrix2D="Matrix2D",R.Matrix3D="Matrix3D",R.SJ="SJ",R.ar="ar"}(Q||(Q={}));class q{constructor(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=R,this.defaultValue=J,this.animationType=B}serialize(R){R.typeName=this.typeName,R.defaultValue=this.defaultValue}}const e=new q("any",void 0),D=new q("string",""),l=new q("number",0,0),E=new q("boolean",!1),O=new q("Vector2",h.Vector2.Zero(),5),n=new q("nJ",h.nJ.Zero(),1),P=new q("Vector4",h.Vector4.Zero()),A=new q("Matrix",h.Matrix.Identity(),3),u=new q("Matrix2D",new r.e),S=new q("Matrix3D",new r.h),f=new q("SJ",y.SJ.Black(),4),a=new q("ar",new y.ar(0,0,0,0),7),s=new q("Quaternion",h.Quaternion.Identity(),2);s.typeTransformer=R=>{if(R.getClassName){if("Vector4"===R.getClassName())return h.Quaternion.fJ(R.Ch());if("nJ"===R.getClassName())return h.Quaternion.FromEulerVector(R);if("Matrix"===R.getClassName())return h.Quaternion.FromRotationMatrix(R)}return R};const x=new q("FlowGraphInteger",new N.d(0),0);function I(R){const J=R;switch(typeof R){case"string":return D;case"number":return l;case"boolean":return E;case"object":if(J.getClassName)switch(J.getClassName()){case"Vector2":return O;case"nJ":return n;case"Vector4":return P;case"Matrix":return A;case"SJ":return f;case"ar":return a;case"Quaternion":return s;case"FlowGraphInteger":return x;case"Matrix2D":return u;case"Matrix3D":return S}return e;default:return e}}function V(R){switch(R){case"string":return D;case"number":return l;case"boolean":return E;case"Vector2":return O;case"nJ":return n;case"Vector4":return P;case"Matrix":return A;case"SJ":return f;case"ar":return a;case"Quaternion":return s;case"FlowGraphInteger":return x;case"Matrix2D":return u;case"Matrix3D":return S;default:return e}}function M(R){switch(R){case"number":default:return 0;case"Vector2":return 5;case"nJ":return 1;case"Matrix":return 3;case"SJ":return 4;case"ar":return 7;case"Quaternion":return 2}}function H(R){switch(R){case 0:return l;case 5:return O;case 1:return n;case 3:return A;case 4:return f;case 7:return a;case 2:return s;default:return e}}},12886:(R,J,B)=>{"use strict";B.d(J,{e:()=>D,g:()=>e,k:()=>l});var Q=B(11224),h=B(11186),y=B(12892),N=B(12894),r=B(12903);function q(R){return"Vector2"===R||"nJ"===R||"Vector4"===R||"Quaternion"===R||"SJ"===R||"ar"===R}function e(R,J,B){var Q;const h=(null===J||void 0===J||null===(Q=J.getClassName)||void 0===Q?void 0:Q.call(J))??"";if(q(h)||function(R){return"Matrix"===R||"Matrix2D"===R||"Matrix3D"===R}(h))B[R]={value:J.Ch(),className:h};else if("FlowGraphInteger"===h)B[R]={value:J.value,className:h};else if(h&&(J.id||J.name))B[R]={id:J.id,name:J.name,className:h};else{if("object"===typeof J)throw new Error(`Could not serialize value ${J}`);B[R]=J}}function D(R,J,B,e){const l=J[R];let E;const O=(null===l||void 0===l?void 0:l.type)??(null===l||void 0===l?void 0:l.className);if(function(R){return"Mesh"===R||"AbstractMesh"===R||"GroundMesh"===R||"InstanceMesh"===R||"LinesMesh"===R||"GoldbergMesh"===R||"GreasedLineMesh"===R||"TrailMesh"===R}(O)){let R=e.meshes.filter((R=>l.id?R.id===l.id:R.name===l.name));0===R.length&&(R=e.transformNodes.filter((R=>l.id?R.id===l.id:R.name===l.name))),E=l.uniqueId?R.find((R=>R.uniqueId===l.uniqueId)):R[0]}else if(q(O))E=function(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===R)return h.Vector2.fJ(J);if("nJ"===R)return B&&(J[2]*=-1),h.nJ.fJ(J);if("Vector4"===R)return h.Vector4.fJ(J);if("Quaternion"===R)return B&&(J[2]*=-1,J[3]*=-1),h.Quaternion.fJ(J);if("SJ"===R)return new Q.SJ(J[0],J[1],J[2]);if("ar"===R)return new Q.ar(J[0],J[1],J[2],J[3]);throw new Error(`Unknown vector class name ${R}`)}(O,l.value);else if(function(R){return"AnimationGroup"===R}(O)){const R=e.animationGroups.filter((R=>R.name===l.name));E=1===R.length?R[0]:R.find((R=>R.uniqueId===l.uniqueId))}else E="Matrix"===O?h.Matrix.fJ(l.value):"Matrix2D"===O?new r.e(l.value):"Matrix3D"===O?new r.h(l.value):"FlowGraphInteger"===O?y.d.FromValue(l.value):"number"===O||"string"===O||"boolean"===O?l.value[0]:l&&void 0!==l.value?l.value:Array.isArray(l)?l.reduce(((R,J)=>J.eventData?(R[J.id]={type:(0,N.O)(J.type)},"undefined"!==typeof J.value&&(R[J.id].value=D("value",J,B,e)),R):R),{}):l;return E}function l(R){return"FlowGraphJsonPointerParserBlock"===R}},12934:(R,J,B)=>{"use strict";function Q(R,J){return!(!R.parent||R.parent!==J&&!Q(R.parent,J))}function h(R){if(R.getClassName)return R.getClassName()}function y(R,J){return R===J&&("Vector2"===R||"nJ"===R||"Vector4"===R||"Quaternion"===R)}function N(R,J){return R===J&&("Matrix"===R||"Matrix2D"===R||"Matrix3D"===R)}function r(R,J){return"FlowGraphInteger"===R&&"FlowGraphInteger"===J}function q(R,J){const B="number"===typeof R||"number"===typeof(null===R||void 0===R?void 0:R.value);return B&&!J?!isNaN(e(R)):B}function e(R){return"number"===typeof R?R:R.value}B.d(J,{c:()=>r,d:()=>N,g:()=>y,i:()=>h,l:()=>Q,m:()=>e,o:()=>q})},12300:(R,J,B)=>{"use strict";B.r(J),B.d(J,{SceneInstrumentation:()=>y});var Q=B(11030),h=B(11399);class y{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(R){R!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=R,R?(this._onBeforeActiveMeshesEvaluationObserver=this.AJ.onBeforeActiveMeshesEvaluationObservable.add((()=>{Q.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.AJ.onAfterActiveMeshesEvaluationObservable.add((()=>{Q.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.AJ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.AJ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(R){R!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=R,R?(this._onBeforeRenderTargetsRenderObserver=this.AJ.onBeforeRenderTargetsRenderObservable.add((()=>{Q.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.AJ.onAfterRenderTargetsRenderObservable.add((()=>{Q.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.AJ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.AJ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(R){R!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=R,R?(this._onBeforeParticlesRenderingObserver=this.AJ.onBeforeParticlesRenderingObservable.add((()=>{Q.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.AJ.onAfterParticlesRenderingObservable.add((()=>{Q.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.AJ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.AJ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(R){R!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=R,this.AJ.spriteManagers&&(R?(this._onBeforeSpritesRenderingObserver=this.AJ.onBeforeSpritesRenderingObservable.add((()=>{Q.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.AJ.onAfterSpritesRenderingObservable.add((()=>{Q.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.AJ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.AJ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(R){R!==this._capturePhysicsTime&&this.AJ.onBeforePhysicsObservable&&(this._capturePhysicsTime=R,R?(this._onBeforePhysicsObserver=this.AJ.onBeforePhysicsObservable.add((()=>{Q.Tools.StartPerformanceCounter("Oe"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.AJ.onAfterPhysicsObservable.add((()=>{Q.Tools.EndPerformanceCounter("Oe"),this._physicsTime.endMonitoring()}))):(this.AJ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.AJ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(R){R!==this._captureAnimationsTime&&(this._captureAnimationsTime=R,R?this._onAfterAnimationsObserver=this.AJ.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.AJ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(R){this._captureFrameTime=R}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(R){this._captureInterFrameTime=R}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(R){R!==this._captureRenderTime&&(this._captureRenderTime=R,R?(this._onBeforeDrawPhaseObserver=this.AJ.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),Q.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.AJ.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),Q.Tools.EndPerformanceCounter("Main render")}))):(this.AJ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.AJ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(R){R!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=R,R?(this._onBeforeCameraRenderObserver=this.AJ.onBeforeCameraRenderObservable.add((R=>{this._cameraRenderTime.beginMonitoring(),Q.Tools.StartPerformanceCounter(`Rendering camera ${R.name}`)})),this._onAfterCameraRenderObserver=this.AJ.onAfterCameraRenderObservable.add((R=>{this._cameraRenderTime.endMonitoring(!1),Q.Tools.EndPerformanceCounter(`Rendering camera ${R.name}`)}))):(this.AJ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.AJ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.AJ.getEngine()._drawCalls}constructor(R){this.AJ=R,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new h.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new h.b,this._captureFrameTime=!1,this._frameTime=new h.b,this._captureRenderTime=!1,this._renderTime=new h.b,this._captureInterFrameTime=!1,this._interFrameTime=new h.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new h.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new h.b,this._capturePhysicsTime=!1,this._physicsTime=new h.b,this._captureAnimationsTime=!1,this._animationsTime=new h.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new h.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=R.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(Q.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.AJ.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=R.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(Q.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.qh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.qh(),this._captureParticlesRenderTime&&this._particlesRenderTime.qh(),this._captureSpritesRenderTime&&this._spritesRenderTime.qh(),this._captureRenderTime&&this._renderTime.qh(),this._captureCameraRenderTime&&this._cameraRenderTime.qh()}))}dispose(){this._disposed||(this.AJ.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.AJ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.AJ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.AJ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.AJ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.AJ.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.AJ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.AJ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.AJ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.AJ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.AJ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.AJ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.AJ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.AJ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.AJ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.AJ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.AJ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.AJ=null,this._disposed=!0)}}},12875:(R,J,B)=>{"use strict";B.d(J,{c:()=>D});var Q=B(11167),h=B(11176),y=B(11186),N=B(11599),r=B(11733),q=B(11790),e=B(11142);N.b.AddNodeConstructor("Light_Type_1",((R,J)=>()=>new D(R,y.nJ.Zero(),J)));class D extends q.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(R){this._shadowFrustumSize=R,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(R){this._shadowOrthoScale=R,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(R){this._orthoLeft=R}get orthoRight(){return this._orthoRight}set orthoRight(R){this._orthoRight=R}get orthoTop(){return this._orthoTop}set orthoTop(R){this._orthoTop=R}get orthoBottom(){return this._orthoBottom}set orthoBottom(R){this._orthoBottom=R}constructor(R,J,B){super(R,B),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=J.scale(-1),this.direction=J}getClassName(){return"ne"}getTypeID(){return r.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(R,J,B){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(R):this._setDefaultAutoExtendShadowProjectionMatrix(R,J,B)}_setDefaultFixedFrustumShadowProjectionMatrix(R){const J=this.IR().activeCamera;J&&y.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:J.mh,void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,R,this.IR().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(R,J,B){const Q=this.IR().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const R=y.nJ.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let Q=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let N=0;N<B.length;N++){const r=B[N];if(!r)continue;const q=r.getBoundingInfo().boundingBox;for(let B=0;B<q.vectorsWorld.length;B++)y.nJ.TransformCoordinatesToRef(q.vectorsWorld[B],J,R),R.x<this._orthoLeft&&(this._orthoLeft=R.x),R.y<this._orthoBottom&&(this._orthoBottom=R.y),R.x>this._orthoRight&&(this._orthoRight=R.x),R.y>this._orthoTop&&(this._orthoTop=R.y),this.autoCalcShadowZBounds&&(R.z<Q&&(Q=R.z),R.z>h&&(h=R.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=Q,this._shadowMaxZ=h)}const h=this._orthoRight-this._orthoLeft,N=this._orthoTop-this._orthoBottom,r=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Q||void 0===Q?void 0:Q.mh)||0,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Q||void 0===Q?void 0:Q.maxZ)||1e4,e=this.IR().getEngine().useReverseDepthBuffer;y.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-h*this.shadowOrthoScale,this._orthoRight+h*this.shadowOrthoScale,this._orthoBottom-N*this.shadowOrthoScale,this._orthoTop+N*this.shadowOrthoScale,e?q:r,e?r:q,R,this.IR().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(R,J){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,J),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,J),this)}transferToNodeMaterialEffect(R,J){return this.computeTransformedInformation()?(R.setFloat3(J,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(R.setFloat3(J,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(R){const J=this._scene.getEngine();return!J.useReverseDepthBuffer&&J.isNDCHalfZRange?0:1}getDepthMaxZ(R){const J=this._scene.getEngine();return J.useReverseDepthBuffer&&J.isNDCHalfZRange?0:1}prepareLightSpecificDefines(R,J){R["DIRLIGHT"+J]=!0}}(0,Q.e)([(0,h.N)()],D.prototype,"shadowFrustumSize",null),(0,Q.e)([(0,h.N)()],D.prototype,"shadowOrthoScale",null),(0,Q.e)([(0,h.N)()],D.prototype,"autoUpdateExtends",void 0),(0,Q.e)([(0,h.N)()],D.prototype,"autoCalcShadowZBounds",void 0),(0,Q.e)([(0,h.N)("orthoLeft")],D.prototype,"_orthoLeft",void 0),(0,Q.e)([(0,h.N)("orthoRight")],D.prototype,"_orthoRight",void 0),(0,Q.e)([(0,h.N)("orthoTop")],D.prototype,"_orthoTop",void 0),(0,Q.e)([(0,h.N)("orthoBottom")],D.prototype,"_orthoBottom",void 0),(0,e.h)("BABYLON.DirectionalLight",D)},13365:(R,J,B)=>{"use strict";B.d(J,{d:()=>D});var Q=B(11167),h=B(11176),y=B(11186),N=B(11224),r=B(11599),q=B(11733),e=B(11142);r.b.AddNodeConstructor("Light_Type_3",((R,J)=>()=>new D(R,y.nJ.Zero(),J)));class D extends q.e{constructor(R,J,B){super(R,B),this.groundColor=new N.SJ(0,0,0),this.direction=J||y.nJ.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ae"}setDirectionToTarget(R){return this.direction=y.nJ.Normalize(R.PJ(y.nJ.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(R,J){const B=y.nJ.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",B.x,B.y,B.z,0,J),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Vr),J),this}transferToNodeMaterialEffect(R,J){const B=y.nJ.Normalize(this.direction);return R.setFloat3(J,B.x,B.y,B.z),this}ny(){return this._worldMatrix||(this._worldMatrix=y.Matrix.Identity()),this._worldMatrix}getTypeID(){return q.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(R,J){R["HEMILIGHT"+J]=!0}}(0,Q.e)([(0,h.j)()],D.prototype,"groundColor",void 0),(0,Q.e)([(0,h.L)()],D.prototype,"direction",void 0),(0,e.h)("BABYLON.HemisphericLight",D)},12839:(R,J,B)=>{"use strict";B.d(J,{d:()=>l});var Q=B(11167),h=B(11176),y=B(11186),N=B(11599),r=B(11733),q=B(11790),e=B(11161),D=B(11142);N.b.AddNodeConstructor("Light_Type_2",((R,J)=>()=>new l(R,y.nJ.Zero(),y.nJ.Zero(),0,0,J)));class l extends q.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(R){this._iesProfileTexture!==R&&(this._iesProfileTexture=R,this._iesProfileTexture&&l._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(R){this._angle=R,this._cosHalfAngle=Math.cos(.5*R),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(R){this._innerAngle=R,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(R){this._shadowAngleScale=R,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(R){this._projectionTextureLightNear=R,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(R){this._projectionTextureLightFar=R,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(R){this._projectionTextureUpDirection=R,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(R){this._projectionTexture!==R&&(this._projectionTexture=R,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(l._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):l._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(R){return void 0!==R.onGeneratedObservable}static _IsTexture(R){return void 0!==R.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(R){this._projectionTextureProjectionLightMatrix=R,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(R,J,B,Q,h,N){super(R,N),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=y.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=y.nJ.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=y.nJ.Zero(),this._projectionTextureViewLightMatrix=y.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=y.Matrix.Zero(),this._projectionTextureScalingMatrix=y.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=J,this.direction=B,this.angle=Q,this.exponent=h}getClassName(){return"SpotLight"}getTypeID(){return r.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(R){super._setDirection(R),this._projectionTextureViewLightDirty=!0}_setPosition(R){super._setPosition(R),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(R,J,B){const Q=this.IR().activeCamera;if(!Q)return;this._shadowAngleScale=this._shadowAngleScale||1;const h=this._shadowAngleScale*this._angle,N=void 0!==this.shadowMinZ?this.shadowMinZ:Q.mh,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,q=this.IR().getEngine().useReverseDepthBuffer;y.Matrix.PerspectiveFovLHToRef(h,1,q?r:N,q?N:r,R,!0,this._scene.getEngine().isNDCHalfZRange,void 0,q)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),y.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const R=this.projectionTextureLightFar,J=this.projectionTextureLightNear,B=R/(R-J),Q=-B*J,h=1/Math.tan(this._angle/2);y.Matrix.FromValuesToRef(h/1,0,0,0,0,h,0,0,0,0,B,1,0,0,Q,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof e.d){const R=this._projectionTexture.uScale/2,J=this._projectionTexture.vScale/2;y.Matrix.FromValuesToRef(R,0,0,0,0,J,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(R,J){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),R.setMatrix("textureProjectionMatrix"+J,this._projectionTextureMatrix),R.setTexture("projectionLightTexture"+J,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&R.setTexture("iesLightTexture"+J,this._iesProfileTexture),this}transferToEffect(R,J){let B;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,J),B=y.nJ.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,J),B=y.nJ.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",B.x,B.y,B.z,this._cosHalfAngle,J),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,J),this}transferToNodeMaterialEffect(R,J){let B;return B=this.computeTransformedInformation()?y.nJ.Normalize(this.transformedDirection):y.nJ.Normalize(this.direction),this.IR().useRightHandedSystem?R.setFloat3(J,-B.x,-B.y,-B.z):R.setFloat3(J,B.x,B.y,B.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(R){const J=this._scene.getEngine(),B=void 0!==this.shadowMinZ?this.shadowMinZ:(null===R||void 0===R?void 0:R.mh)??0;return J.useReverseDepthBuffer&&J.isNDCHalfZRange?B:this._scene.getEngine().isNDCHalfZRange?0:B}getDepthMaxZ(R){const J=this._scene.getEngine(),B=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===R||void 0===R?void 0:R.maxZ)??1e4;return J.useReverseDepthBuffer&&J.isNDCHalfZRange?0:B}prepareLightSpecificDefines(R,J){R["SPOTLIGHT"+J]=!0,R["PROJECTEDLIGHTTEXTURE"+J]=!(!this.projectionTexture||!this.projectionTexture.isReady()),R["IESLIGHTTEXTURE"+J]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,Q.e)([(0,h.N)()],l.prototype,"angle",null),(0,Q.e)([(0,h.N)()],l.prototype,"innerAngle",null),(0,Q.e)([(0,h.N)()],l.prototype,"shadowAngleScale",null),(0,Q.e)([(0,h.N)()],l.prototype,"exponent",void 0),(0,Q.e)([(0,h.N)()],l.prototype,"projectionTextureLightNear",null),(0,Q.e)([(0,h.N)()],l.prototype,"projectionTextureLightFar",null),(0,Q.e)([(0,h.N)()],l.prototype,"projectionTextureUpDirection",null),(0,Q.e)([(0,h.D)("projectedLightTexture")],l.prototype,"_projectionTexture",void 0),(0,D.h)("BABYLON.SpotLight",l)},12554:(R,J,B)=>{"use strict";B.d(J,{b:()=>N,c:()=>y,f:()=>r});const Q={},h={};function y(R,J){Q[R]=J}function N(R,J){h[R]=J}function r(R){return h[R]?h[R]:null}},12458:(R,J,B)=>{"use strict";B.d(J,{d:()=>I,e:()=>k});var Q,h=B(11030),y=B(11032),N=B(11419),r=B(11065),q=B(11043),e=B(11646),D=B(11073),l=B(11077),E=B(11148),O=B(11094),n=B(11060);!function(R){R[R.Clean=0]="Clean",R[R.Stop=1]="Stop",R[R.Sync=2]="Sync",R[R.NoSync=3]="NoSync"}(Q||(Q={}));const P=new y.e,A={};let u=!1;function S(){return A[".babylon"]}function f(R,J){const B=A[R];return B||(q.d.Warn("Unable to find a plugin to load "+R+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),J?S():void 0)}function a(R,J,B){let Q="Unable to load from "+(R.rawData?"binary data":R.url);return J?Q+=`: ${J}`:B&&(Q+=`: ${B}`),Q}async function s(R,J,B,Q,h,y,N,r,q){var e;const l="data:"===(E=R.url).substring(0,5)?E.substring(5):null;var E;if(R.rawData&&!N)throw"When using ArrayBufferView to load data the file extension must be provided.";const u=l||N?"":function(R){const J=R.indexOf("?");-1!==J&&(R=R.substring(0,J));const B=R.lastIndexOf(".");return R.substring(B,R.length).toLowerCase()}(R.url);let a=N?f(N,!0):l?function(R){for(const J in A){const B=A[J].plugin;if(B.canDirectLoad&&B.canDirectLoad(R))return A[J]}return S()}(R.url):f(u,!1);if(!a&&u){if(R.url&&!R.url.startsWith("blob:")){const J=await async function(R,J){const B=J.method||"GET";return await new Promise(((Q,h)=>{const y=new n.c;y.addEventListener("readystatechange",(()=>{if(4==y.readyState)if(200==y.status){const R={};if(J.responseHeaders)for(const B of J.responseHeaders)R[B]=y.getResponseHeader(B)||"";Q({response:y.response,headerValues:R})}else h(`Unable to fetch data from ${R}. Error code: ${y.status}`)})),y.open(B,R),y.send()}))}(R.url,{method:"HEAD",responseHeaders:["Content-Type"]}),B=J.headerValues?J.headerValues["Content-Type"]:"";B&&(a=function(R){for(const J in A){const B=A[J];if(B.mimeType===R)return B}}(B))}a||(a=S())}if(!a)throw new Error(`No plugin or fallback for ${N??R.url}`);if(!1===(null===q||void 0===q||null===(e=q[a.plugin.name])||void 0===e?void 0:e.enabled))throw new Error(`The '${a.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(R.rawData&&!a.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(R=>{if(a.plugin.createPlugin){const J=a.plugin.createPlugin(q??{});return J instanceof Promise?(J.then(R).catch((R=>{h("Error instantiating plugin.",R)})),null):(R(J),J)}return R(a.plugin),a.plugin})((q=>{var e;if(!q)throw`The loader plugin corresponding to the '${N}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(P.notifyObservers(q),l&&(q.canDirectLoad&&q.canDirectLoad(R.url)||!(0,D.j)(R.url))){if(q.directLoad){const R=q.directLoad(J,l);R instanceof Promise?R.then((R=>{B(q,R)})).catch((R=>{h("Error in directLoad of _loadData: "+R,R)})):B(q,R)}else B(q,l);return}const E=a.isBinary,n=(R,Q)=>{J.D?h("Scene has been disposed"):B(q,R,Q)};let A=null,u=!1;null===(e=q.eh)||void 0===e||e.add((()=>{u=!0,A&&(A.abort(),A=null),y()}));const S=()=>{if(u)return;const B=(R,J)=>{h(null===R||void 0===R?void 0:R.statusText,J)};if(!q.loadFile&&R.rawData)throw"Plugin does not support loading ArrayBufferView.";A=q.loadFile?q.loadFile(J,R.rawData||R.file||R.url,R.rootUrl,n,Q,E,B,r):J._loadFile(R.file||R.url,n,Q,!0,E,B)},f=J.getEngine();let s=f.enableOfflineSupport;if(s){let B=!1;for(const Q of J.disableOfflineSupportExceptionRules)if(Q.test(R.url)){B=!0;break}s=!B}s&&O.c.OfflineProviderFactory?J.offlineProvider=O.c.OfflineProviderFactory(R.url,S,f.disableManifestCheck):S()}))}function x(R,J){let B,Q,y=null,N=null;if(J)if(J.name)B=`file:${J.name}`,Q=J.name,y=J;else if(ArrayBuffer.isView(J))B="",Q=(0,E.c)(),N=J;else if(J.startsWith("data:"))B=J,Q="";else if(R){const y=J;if("/"===y.substring(0,1))return h.Tools.Error("Wrong sceneFilename parameter"),null;B=R+y,Q=y}else B=J,Q=h.Tools.GetFilename(J),R=h.Tools.GetFolderPath(J);else B=R,Q=h.Tools.GetFilename(R),R=h.Tools.GetFolderPath(R);return{url:B,rootUrl:R,name:Q,file:y,rawData:N}}function I(R){if("string"===typeof R.extensions){const J=R.extensions;A[J.toLowerCase()]={plugin:R,isBinary:!1}}else{const J=R.extensions,B=Object.keys(J);for(const Q of B)A[Q.toLowerCase()]={plugin:R,isBinary:J[Q].isBinary,mimeType:J[Q].mimeType}}}async function V(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.e.LastCreatedScene,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!Q)return q.d.Error("No scene available to import mesh to"),null;const O=x(J,B);if(!O)return null;const n={};Q.addPendingData(n);const P=()=>{Q.removePendingData(n)},A=(R,J)=>{const B=a(O,R,J);N?N(Q,B,new l.i(B,l.e.SceneLoaderError,J)):q.d.Error(B),P()},u=y?R=>{try{y(R)}catch(J){A("Error in onProgress callback: "+J,J)}}:void 0,S=(R,J,B,y,N,r,q,e)=>{if(Q.importedMeshesFiles.push(O.url),h)try{h(R,J,B,y,N,r,q,e)}catch(D){A("Error in onSuccess callback: "+D,D)}Q.removePendingData(n)};return await s(O,Q,((J,B,h)=>{if(J.rewriteRootURL&&(O.rootUrl=J.rewriteRootURL(O.rootUrl,h)),J.importMesh){const h=[],y=[],N=[];if(!J.importMesh(R,Q,B,O.rootUrl,h,y,N,A))return;Q.loadingPluginName=J.name,S(h,y,N,[],[],[],[],[])}else{J.importMeshAsync(R,Q,B,O.rootUrl,u,O.name).then((R=>{Q.loadingPluginName=J.name,S(R.meshes,R.OE,R.skeletons,R.animationGroups,R.transformNodes,R.geometries,R.lights,R.spriteManagers)})).catch((R=>{A(R.message,R)}))}}),u,A,P,e,D,E)}async function M(R,J,B,Q,h,y,N,r){return await new Promise(((q,e)=>{try{V(R,J,B,Q,((R,J,B,Q,h,y,N,r)=>{q({meshes:R,OE:J,skeletons:B,animationGroups:Q,transformNodes:h,geometries:y,lights:N,spriteManagers:r})}),h,((R,J,B)=>{e(B||new Error(J))}),y,N,r).catch(e)}catch(l){e(l)}}))}async function H(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.e.LastCreatedEngine,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};B?await X(R,J,new N.d(B),Q,y,q,e,D,l):h.Tools.Error("No engine available")}async function d(R,J,B,Q,h,y,N){return await new Promise(((r,q)=>{H(R,J,B,(R=>{r(R)}),Q,((R,J,B)=>{q(B||new Error(J))}),h,y,N)}))}async function X(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.e.LastCreatedScene,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!B)return q.d.Error("No scene available to append to"),null;const O=x(R,J);if(!O)return null;const n={};B.addPendingData(n);const P=()=>{B.removePendingData(n)};e.d.ShowLoadingScreen&&!u&&(u=!0,B.getEngine().displayLoadingUI(),B.executeWhenReady((()=>{B.getEngine().hideLoadingUI(),u=!1})));const A=(R,J)=>{const Q=a(O,R,J);y?y(B,Q,new l.i(Q,l.e.SceneLoaderError,J)):q.d.Error(Q),P()},S=h?R=>{try{h(R)}catch(J){A("Error in onProgress callback",J)}}:void 0,f=()=>{if(Q)try{Q(B)}catch(R){A("Error in onSuccess callback",R)}B.removePendingData(n)};return await s(O,B,((R,J)=>{if(R.load){if(!R.load(B,J,O.rootUrl,A))return;B.loadingPluginName=R.name,f()}else{R.loadAsync(B,J,O.rootUrl,S,O.name).then((()=>{B.loadingPluginName=R.name,f()})).catch((R=>{A(R.message,R)}))}}),S,A,P,N,D,E)}async function c(R,J,B,Q,h,y,N){return await new Promise(((r,q)=>{try{X(R,J,B,(R=>{r(R)}),Q,((R,J,B)=>{q(B||new Error(J))}),h,y,N).catch(q)}catch(l){q(l)}}))}async function z(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.e.LastCreatedScene,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!B)return q.d.Error("No scene available to load asset container to"),null;const E=x(R,J);if(!E)return null;const O={};B.addPendingData(O);const n=()=>{B.removePendingData(O)},P=(R,J)=>{const Q=a(E,R,J);y?y(B,Q,new l.i(Q,l.e.SceneLoaderError,J)):q.d.Error(Q),n()},A=h?R=>{try{h(R)}catch(J){P("Error in onProgress callback",J)}}:void 0,u=R=>{if(Q)try{Q(R)}catch(J){P("Error in onSuccess callback",J)}B.removePendingData(O)};return await s(E,B,((R,J)=>{if(R.loadAssetContainer){const Q=R.loadAssetContainer(B,J,E.rootUrl,P);if(!Q)return;Q.populateRootNodes(),B.loadingPluginName=R.name,u(Q)}else if(R.loadAssetContainerAsync){R.loadAssetContainerAsync(B,J,E.rootUrl,A,E.name).then((J=>{J.populateRootNodes(),B.loadingPluginName=R.name,u(J)})).catch((R=>{P(R.message,R)}))}else P("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),A,P,n,N,e,D)}async function p(R,J,B,Q,h,y,N){return await new Promise(((r,q)=>{try{z(R,J,B,(R=>{r(R)}),Q,((R,J,B)=>{q(B||new Error(J))}),h,y,N).catch(q)}catch(l){q(l)}}))}async function i(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.e.LastCreatedScene,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!B)return void q.d.Error("No scene available to load animations to");if(Q){for(const Q of B.animatables)Q.reset();B.stopAllAnimations();const R=B.animationGroups.slice();for(const B of R)B.dispose();const J=B.getNodes();for(const B of J)B.animations&&(B.animations=[])}else switch(h){case 0:const R=B.animationGroups.slice();for(const J of R)J.dispose();break;case 1:for(const J of B.animationGroups)J.stop();break;case 2:for(const J of B.animationGroups)J.reset(),J.restart();break;case 3:break;default:return void q.d.Error("Unknown animation group loading mode value '"+h+"'")}const n=B.animatables.length;await z(R,J,B,(R=>{R.mergeAnimationsTo(B,B.animatables.slice(n),y),R.dispose(),B.onAnimationFileImportedObservable.notifyObservers(B),N&&N(B)}),e,D,l,E,O)}async function W(R,J,B,Q,h,y,N,r,q,e){return await new Promise(((D,E)=>{try{i(R,J,B,Q,h,y,(R=>{D(R)}),N,((R,J,B)=>{E(B||new Error(J))}),r,q,e).catch(E)}catch(l){E(l)}}))}class k{static get ForceFullSceneLoadingForIncremental(){return e.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(R){e.d.ForceFullSceneLoadingForIncremental=R}static get ShowLoadingScreen(){return e.d.ShowLoadingScreen}static set ShowLoadingScreen(R){e.d.ShowLoadingScreen=R}static get loggingLevel(){return e.d.loggingLevel}static set loggingLevel(R){e.d.loggingLevel=R}static get CleanBoneMatrixWeights(){return e.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(R){e.d.CleanBoneMatrixWeights=R}static GetDefaultPlugin(){return S()}static GetPluginForExtension(R){var J;return null===(J=f(R,!0))||void 0===J?void 0:J.plugin}static IsPluginForExtensionAvailable(R){return function(R){return!!A[R]}(R)}static RegisterPlugin(R){I(R)}static ImportMesh(R,J,B,Q,h,y,N,q,e){V(R,J,B,Q,h,y,N,q,e).catch((R=>null===N||void 0===N?void 0:N(r.e.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async ImportMeshAsync(R,J,B,Q,h,y,N){return await M(R,J,B,Q,h,y,N)}static Load(R,J,B,Q,h,y,N,q){H(R,J,B,Q,h,y,N,q).catch((R=>null===y||void 0===y?void 0:y(r.e.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async LoadAsync(R,J,B,Q,h,y){return await d(R,J,B,Q,h,y)}static Append(R,J,B,Q,h,y,N,q){X(R,J,B,Q,h,y,N,q).catch((R=>null===y||void 0===y?void 0:y(B??r.e.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async AppendAsync(R,J,B,Q,h,y){return await c(R,J,B,Q,h,y)}static LoadAssetContainer(R,J,B,Q,h,y,N,q){z(R,J,B,Q,h,y,N,q).catch((R=>null===y||void 0===y?void 0:y(B??r.e.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async LoadAssetContainerAsync(R,J,B,Q,h,y){return await p(R,J,B,Q,h,y)}static ImportAnimations(R,J,B,Q,h,y,N,q,e,D,l){i(R,J,B,Q,h,y,N,q,e,D,l).catch((R=>null===e||void 0===e?void 0:e(B??r.e.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async ImportAnimationsAsync(R,J,B,Q,h,y,N,r,q,e,D){return await W(R,J,B,Q,h,y,r,e,D)}}k.NO_LOGGING=0,k.MINIMAL_LOGGING=1,k.SUMMARY_LOGGING=2,k.DETAILED_LOGGING=3,k.OnPluginActivatedObservable=P},12856:(R,J,B)=>{"use strict";B.d(J,{d:()=>E});var Q=B(11167),h=B(11176),y=B(11030),N=B(11186),r=B(11209),q=B(11161),e=B(11142),D=B(11032),l=B(11217);B(12865);class E extends r.c{set boundingBoxSize(R){if(this._boundingBoxSize&&this._boundingBoxSize.equals(R))return;this._boundingBoxSize=R;const J=this.IR();J&&J.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(R){this._rotationY=R,this.setReflectionTextureMatrix(N.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(R,J,B){let Q="";for(const h of R)Q+=h;return new E(Q,J,null,B,R)}static CreateFromPrefilteredData(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=J.useDelayedTextureLoading;J.useDelayedTextureLoading=!1;const y=new E(R,J,null,!1,null,null,null,void 0,!0,B,Q);return J.useDelayedTextureLoading=h,y}constructor(R,J){var B;let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,n=arguments.length>10&&void 0!==arguments[10]&&arguments[10],P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,A=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,u=arguments.length>13?arguments[13]:void 0,S=arguments.length>14?arguments[14]:void 0;super(J),this.onLoadObservable=new D.e,this.boundingBoxPosition=N.nJ.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new N.Matrix,this._buffer=null,this.name=R,this.url=R,this._noMipmap=h,this.bh=!1,this.isCube=!0,this._textureMatrix=N.Matrix.Identity(),this.coordinatesMode=q.d.CUBIC_MODE;let f=null,a=null;null===Q||Array.isArray(Q)?(this._noMipmap=h,this._format=l,this._createPolynomials=n,f=Q,this._loaderOptions=u,this._useSRGBBuffer=S,this._lodScale=P,this._lodOffset=A):(f=Q.extensions??null,this._noMipmap=Q.noMipmap??!1,y=Q.files??null,a=Q.buffer??null,this._format=Q.format??5,E=Q.prefiltered??!1,O=Q.forcedExtension??null,this._createPolynomials=Q.createPolynomials??!1,this._lodScale=Q.lodScale??.8,this._lodOffset=Q.lodOffset??0,this._loaderOptions=Q.loaderOptions,this._useSRGBBuffer=Q.useSRGBBuffer,r=Q.t??null,e=Q.onError??null),(R||y)&&this.updateURL(R,O,r,E,e,f,null===(B=this.IR())||void 0===B?void 0:B.useDelayedTextureLoading,y,a)}getClassName(){return"CubeTexture"}updateURL(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=R),this.url=R,J&&(this._forcedExtension=J);const e=R.lastIndexOf("."),D=J||(e>-1?R.substring(e).toLowerCase():""),l=0===D.indexOf(".dds"),E=0===D.indexOf(".env"),O=0===D.indexOf(".basis");if(E?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=Q,Q&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),r)this._files=r;else if(O||E||l||y||(y=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,y){for(let J=0;J<y.length;J++)this._files.push(R+y[J]);this._extensions=y}this._buffer=q,N?(this.delayLoadState=4,this._delayedOnLoad=B,this._delayedOnError=h):this._loadTexture(B,h)}delayLoad(R){4===this.delayLoadState&&(R&&(this._forcedExtension=R),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(R){var J,B;if(R.updateFlag===this._textureMatrix.updateFlag)return;R.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(B=this.IR())||void 0===B||B.markAllMaterialsAsDirty(1,(R=>-1!==R.getActiveTextures().indexOf(this))));if(this._textureMatrix=R,null===(J=this.IR())||void 0===J||!J.useRightHandedSystem)return;const Q=N.TmpVectors.nJ[0],h=N.TmpVectors.Quaternion[0],y=N.TmpVectors.nJ[1];this._textureMatrix.decompose(Q,h,y),h.z*=-1,h.w*=-1,N.Matrix.ComposeToRef(Q,h,y,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var R;return null!==(R=this.IR())&&void 0!==R&&R.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const B=this.IR(),Q=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const h=()=>{var J;(this.onLoadObservable.notifyObservers(this),Q)&&(Q.dispose(),null===(J=this.IR())||void 0===J||J.markAllMaterialsAsDirty(1));R&&R()},N=(R,B)=>{this._loadingError=!0,this._errorObject={message:R,exception:B},J&&J(R,B),q.d.OnTextureLoadErrorObservable.notifyObservers(this)};var r;this._texture?this._texture.isReady?y.Tools.SetImmediate((()=>h())):this._texture.onLoadedObservable.add((()=>h())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,B,this._lodScale,this._lodOffset,R,N,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,B,this._files,this._noMipmap,R,N,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(r=this._texture)||void 0===r||r.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(R,J,B){const Q=l.c.Parse((()=>{let Q=!1;return R.prefiltered&&(Q=R.prefiltered),new E(B+(R.url??R.name),J,R.extensions,!1,R.files||null,null,null,void 0,Q,R.forcedExtension)}),R,J);if(R.boundingBoxPosition&&(Q.boundingBoxPosition=N.nJ.fJ(R.boundingBoxPosition)),R.boundingBoxSize&&(Q.boundingBoxSize=N.nJ.fJ(R.boundingBoxSize)),R.animations)for(let h=0;h<R.animations.length;h++){const J=R.animations[h],B=(0,e.e)("BABYLON.Animation");B&&Q.animations.push(B.Parse(J))}return Q}clone(){let R=0;const J=l.c.Clone((()=>{const J=new E(this.url,this.IR()||this._getEngine(),this._extensions,this._noMipmap,this._files);return R=J.uniqueId,J}),this);return J.uniqueId=R,J}}(0,Q.e)([(0,h.N)()],E.prototype,"url",void 0),(0,Q.e)([(0,h.L)()],E.prototype,"boundingBoxPosition",void 0),(0,Q.e)([(0,h.L)()],E.prototype,"boundingBoxSize",null),(0,Q.e)([(0,h.N)("rotationY")],E.prototype,"rotationY",null),(0,Q.e)([(0,h.N)("files")],E.prototype,"_files",void 0),(0,Q.e)([(0,h.N)("forcedExtension")],E.prototype,"_forcedExtension",void 0),(0,Q.e)([(0,h.N)("extensions")],E.prototype,"_extensions",void 0),(0,Q.e)([(0,h.u)("textureMatrix")],E.prototype,"_textureMatrix",void 0),(0,Q.e)([(0,h.u)("textureMatrixRefraction")],E.prototype,"_textureMatrixRefraction",void 0),q.d._CubeTextureParser=E.Parse,(0,e.h)("BABYLON.CubeTexture",E)},13377:(R,J,B)=>{"use strict";B.d(J,{c:()=>q});var Q=B(11043),h=B(11161),y=B(11150),N=B(11317),r=B(11124);N.ThinEngine.prototype.createDynamicTexture=function(R,J,B,Q){const h=new r.c(this,4);return h.baseWidth=R,h.baseHeight=J,B&&(R=this.needPOTTextures?(0,y.e)(R,this._caps.maxTextureSize):R,J=this.needPOTTextures?(0,y.e)(J,this._caps.maxTextureSize):J),h.width=R,h.height=J,h.isReady=!1,h.generateMipMaps=B,h.samplingMode=Q,this.updateTextureSamplingMode(Q,h),this._internalTexturesCache.push(h),h},N.ThinEngine.prototype.updateDynamicTexture=function(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!R)return;const N=this._gl,r=N.TEXTURE_2D,q=this._bindTextureDirectly(r,R,!0,y);this._unpackFlipY(void 0===B?R.invertY:B),Q&&N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const e=this._getWebGLTextureType(R.type),D=this._getInternalFormat(h||R.format),l=this._getRGBABufferInternalSizedFormat(R.type,D);N.texImage2D(r,0,l,D,e,J),R.generateMipMaps&&N.generateMipmap(r),q||this._bindTextureDirectly(r,null),Q&&N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),h&&(R.format=h),R._dynamicTextureSource=J,R._premulAlpha=Q,R.invertY=B||!1,R.isReady=!0};class q extends h.d{constructor(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,r=arguments.length>6?arguments[6]:void 0;const q=!B||B._isScene;super(null,q?B:null===B||void 0===B?void 0:B.AJ,q?!Q:B,r,y,void 0,void 0,void 0,void 0,N),this.name=R,this.wrapU=h.d.CLAMP_ADDRESSMODE,this.wrapV=h.d.CLAMP_ADDRESSMODE,this._generateMipMaps=Q;const e=this._getEngine();if(!e)return;if(J.getContext)this._canvas=J,this._ownCanvas=!1,this._texture=e.createDynamicTexture(this._canvas.width,this._canvas.height,Q,y);else{this._canvas=e.createCanvas(1,1),this._ownCanvas=!0;const R=J;R.width||0===R.width?this._texture=e.createDynamicTexture(R.width,R.height,Q,y):this._texture=e.createDynamicTexture(J,J,Q,y)}const D=this.getSize();this._canvas.width!==D.width&&(this._canvas.width=D.width),this._canvas.height!==D.height&&(this._canvas.height=D.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(R){this._canvas.width=R.width,this._canvas.height=R.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(R.width,R.height,this._generateMipMaps,this.samplingMode)}scale(R){const J=this.getSize();J.width*=R,J.height*=R,this._recreate(J)}scaleTo(R,J){const B=this.getSize();B.width=R,B.height=J,this._recreate(B)}getContext(){return this._context}clear(R){const J=this.getSize();R&&(this._context.fillStyle=R),this._context.clearRect(0,0,J.width,J.height)}update(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===R||R,J,this._format||void 0,void 0,B)}drawText(R,J,B,Q,h,y,N){let r=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const q=this.getSize();if(y&&(this._context.fillStyle=y,this._context.fillRect(0,0,q.width,q.height)),this._context.font=Q,null===J||void 0===J){const B=this._context.measureText(R);J=(q.width-B.width)/2}if(null===B||void 0===B){const R=parseInt(Q.replace(/\D/g,""));B=q.height/2+R/3.65}this._context.fillStyle=h||"",this._context.fillText(R,J,B),r&&this.update(N)}dispose(){var R,J;(super.dispose(),this._ownCanvas)&&(null===(R=this._canvas)||void 0===R||null===(J=R.remove)||void 0===J||J.call(R));this._canvas=null,this._context=null}clone(){const R=this.IR();if(!R)return this;const J=this.getSize(),B=new q(this.name,J,R,this._generateMipMaps);return B.bh=this.bh,B.level=this.level,B.wrapU=this.wrapU,B.wrapV=this.wrapV,B}serialize(){const R=this.IR();R&&!R.isReady()&&Q.d.Warn("The scene must be ready before serializing the dynamic texture");const J=super.serialize();return q._IsCanvasElement(this._canvas)&&(J.base64String=this._canvas.toDataURL()),J.invertY=this._invertY,J.samplingMode=this.samplingMode,J}static _IsCanvasElement(R){return void 0!==R.toDataURL}_rebuild(){this.update()}}},12760:(R,J,B)=>{"use strict";B.d(J,{e:()=>h});var Q=B(11161);class h extends Q.d{get depth(){return this._depth}constructor(R,J,B,h,y,N){let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Q.d.TRILINEAR_SAMPLINGMODE,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10?arguments[10]:void 0;super(null,N,!r,q),this.format=y,this._texture=N.getEngine().createRawTexture2DArray(R,J,B,h,y,r,q,e,null,D,l),this._depth=h,this.is2DArray=!0}update(R){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,R,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(R,J,B,Q,y){return new h(R,J,B,Q,5,y,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12571:(R,J,B)=>{"use strict";B.d(J,{d:()=>r,g:()=>q,h:()=>y,j:()=>N});var Q=B(11201),h=B(11186);function y(R,J){return`{X: ${R.x.toFixed(J)} Y: ${R.y.toFixed(J)}}`}function N(R,J){return`{X: ${R._x.toFixed(J)} Y: ${R._y.toFixed(J)} Z: ${R._z.toFixed(J)}}`}function r(R,J){return 2*Math.acos((0,Q.Clamp)(h.Quaternion.Dot(R,J)))}function q(R,J){const B=new h.Quaternion;return function(R,J,B){const y=h.nJ.Cross(R,J),N=Math.acos((0,Q.Clamp)(h.nJ.Dot(R,J),-1,1));h.Quaternion.RotationAxisToRef(y,N,B)}(R,J,B),B}},12409:(R,J,B)=>{"use strict";B.d(J,{d:()=>e});var Q=B(11186),h=B(11224),y=B(11628),N=B(11613),r=B(11238);B(12417);function q(R){let J=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const B=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],y=[];let q=[];const e=R.width||R.size||1,D=R.height||R.size||1,l=R.depth||R.size||1,E=R.wrap||!1;let O=void 0===R.topBaseAt?1:R.topBaseAt,n=void 0===R.bottomBaseAt?0:R.bottomBaseAt;O=(O+4)%4,n=(n+4)%4;let P=[2,0,3,1][O],A=[2,0,1,3][n],u=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(E){J=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],u=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let R=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],B=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const Q=[17,18,19,16],h=[22,23,20,21];for(;P>0;)R.unshift(R.pop()),Q.unshift(Q.pop()),P--;for(;A>0;)B.unshift(B.pop()),h.unshift(h.pop()),A--;R=R.flat(),B=B.flat(),u=u.concat(R).concat(B),J.push(Q[0],Q[2],Q[3],Q[0],Q[1],Q[2]),J.push(h[0],h[2],h[3],h[0],h[1],h[2])}const S=[e/2,D/2,l/2];q=u.reduce(((R,J,B)=>R.concat(J*S[B%3])),[]);const f=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE,a=R.faceUV||new Array(6),s=R.faceColors,x=[];for(let N=0;N<6;N++)void 0===a[N]&&(a[N]=new Q.Vector4(0,0,1,1)),s&&void 0===s[N]&&(s[N]=new h.ar(1,1,1,1));for(let Q=0;Q<6;Q++)if(y.push(a[Q].z,r.c?1-a[Q].w:a[Q].w),y.push(a[Q].x,r.c?1-a[Q].w:a[Q].w),y.push(a[Q].x,r.c?1-a[Q].y:a[Q].y),y.push(a[Q].z,r.c?1-a[Q].y:a[Q].y),s)for(let R=0;R<4;R++)x.push(s[Q].r,s[Q].g,s[Q].b,s[Q].a);N.e._ComputeSides(f,q,J,B,y,R.frontUVs,R.backUVs);const I=new N.e;if(I.indices=J,I.MR=q,I.HR=B,I.XR=y,s){const R=f===N.e.DOUBLESIDE?x.concat(x):x;I.dR=R}return I}function e(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new y.e(R,B);J.sideOrientation=y.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return q(J).zR(Q,J.updatable),Q}N.e.CreateBox=q,y.e.CreateBox=function(R,J){return e(R,{size:J,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12558:(R,J,B)=>{"use strict";B.d(J,{c:()=>r});var Q=B(11628),h=B(11613),y=B(11238);function N(R){const J=[],B=[],Q=[],N=[],r=R.radius||.5,q=R.tessellation||64,e=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,D=0===R.sideOrientation?0:R.sideOrientation||h.e.DEFAULTSIDE;J.push(0,0,0),N.push(.5,.5);const l=2*Math.PI*e,E=1===e?l/q:l/(q-1);let O=0;for(let h=0;h<q;h++){const R=Math.cos(O),B=Math.sin(O),Q=(R+1)/2,h=(1-B)/2;J.push(r*R,r*B,0),N.push(Q,y.c?1-h:h),O+=E}1===e&&(J.push(J[3],J[4],J[5]),N.push(N[2],y.c?1-N[3]:N[3]));const n=J.length/3;for(let h=1;h<n-1;h++)B.push(h+1,0,h);h.e.ComputeNormals(J,B,Q),h.e._ComputeSides(D,J,B,Q,N,R.frontUVs,R.backUVs);const P=new h.e;return P.indices=B,P.MR=J,P.HR=Q,P.XR=N,P}function r(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new Q.e(R,B);J.sideOrientation=Q.e._GetDefaultSideOrientation(J.sideOrientation),h._originalBuilderSideOrientation=J.sideOrientation;return N(J).zR(h,J.updatable),h}h.e.CreateDisc=N,Q.e.CreateDisc=function(R,J,B){return r(R,{radius:J,tessellation:B,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12417:(R,J,B)=>{"use strict";B.d(J,{f:()=>A,c:()=>S,j:()=>u});var Q=B(11186),h=B(11224),y=B(11628),N=B(11613),r=B(11262);y.e._GroundMeshParser=(R,J)=>q.Parse(R,J);class q extends y.e{constructor(R,J){super(R,J),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=R,this._subdivisionsY=R,this.subdivide(R);const B=this;B.createOrUpdateSubmeshesOctree&&B.createOrUpdateSubmeshesOctree(J)}getHeightAtCoordinates(R,J){const B=this.getWorldMatrix(),h=Q.TmpVectors.Matrix[5];B.invertToRef(h);const y=Q.TmpVectors.nJ[8];if(Q.nJ.TransformCoordinatesFromFloatsToRef(R,0,J,h,y),R=y.x,J=y.z,R<this._minX||R>=this._maxX||J<=this._minZ||J>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const N=this._getFacetAt(R,J),r=-(N.x*R+N.z*J+N.w)/N.y;return Q.nJ.TransformCoordinatesFromFloatsToRef(0,r,0,B,y),y.y}getNormalAtCoordinates(R,J){const B=new Q.nJ(0,1,0);return this.getNormalAtCoordinatesToRef(R,J,B),B}getNormalAtCoordinatesToRef(R,J,B){const h=this.getWorldMatrix(),y=Q.TmpVectors.Matrix[5];h.invertToRef(y);const N=Q.TmpVectors.nJ[8];if(Q.nJ.TransformCoordinatesFromFloatsToRef(R,0,J,y,N),R=N.x,J=N.z,R<this._minX||R>this._maxX||J<this._minZ||J>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const r=this._getFacetAt(R,J);return Q.nJ.TransformNormalFromFloatsToRef(r.x,r.y,r.z,h,B),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(R,J){const B=Math.floor((R+this._maxX)*this._subdivisionsX/this._width),Q=Math.floor(-(J+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),h=this._heightQuads[Q*this._subdivisionsX+B];let y;return y=J<h.slope.x*R+h.slope.y?h.facet1:h.facet2,y}_initHeightQuads(){const R=this._subdivisionsX,J=this._subdivisionsY;this._heightQuads=[];for(let B=0;B<J;B++)for(let J=0;J<R;J++){const h={slope:Q.Vector2.Zero(),facet1:new Q.Vector4(0,0,0,0),facet2:new Q.Vector4(0,0,0,0)};this._heightQuads[B*R+J]=h}return this}_computeHeightQuads(){const R=this.getVerticesData(r.h.PositionKind);if(!R)return this;const J=Q.TmpVectors.nJ[3],B=Q.TmpVectors.nJ[2],h=Q.TmpVectors.nJ[1],y=Q.TmpVectors.nJ[0],N=Q.TmpVectors.nJ[4],q=Q.TmpVectors.nJ[5],e=Q.TmpVectors.nJ[6],D=Q.TmpVectors.nJ[7],l=Q.TmpVectors.nJ[8];let E=0,O=0,n=0,P=0,A=0,u=0,S=0;const f=this._subdivisionsX,a=this._subdivisionsY;for(let r=0;r<a;r++)for(let a=0;a<f;a++){E=3*a,O=r*(f+1)*3,n=(r+1)*(f+1)*3,J.x=R[O+E],J.y=R[O+E+1],J.z=R[O+E+2],B.x=R[O+E+3],B.y=R[O+E+4],B.z=R[O+E+5],h.x=R[n+E],h.y=R[n+E+1],h.z=R[n+E+2],y.x=R[n+E+3],y.y=R[n+E+4],y.z=R[n+E+5],P=(y.z-J.z)/(y.x-J.x),A=J.z-P*J.x,B.subtractToRef(J,N),h.subtractToRef(J,q),y.subtractToRef(J,e),Q.nJ.CrossToRef(e,q,D),Q.nJ.CrossToRef(N,e,l),D.normalize(),l.normalize(),u=-(D.x*J.x+D.y*J.y+D.z*J.z),S=-(l.x*B.x+l.y*B.y+l.z*B.z);const s=this._heightQuads[r*f+a];s.slope.Ar(P,A),s.facet1.Ar(D.x,D.y,D.z,u),s.facet2.Ar(l.x,l.y,l.z,S)}return this}serialize(R){super.serialize(R),R.subdivisionsX=this._subdivisionsX,R.subdivisionsY=this._subdivisionsY,R.minX=this._minX,R.maxX=this._maxX,R.mh=this._minZ,R.maxZ=this._maxZ,R.width=this._width,R.height=this._height}static Parse(R,J){const B=new q(R.name,J);return B._subdivisionsX=R.subdivisionsX||1,B._subdivisionsY=R.subdivisionsY||1,B._minX=R.minX,B._maxX=R.maxX,B._minZ=R.mh,B._maxZ=R.maxZ,B._width=R.width,B._height=R.height,B}}var e=B(11030),D=B(11065),l=B(11189),E=B(11238);function O(R){const J=[],B=[],h=[],y=[];let r,q;const e=R.width||R.size||1,D=R.height||R.size||1,l=0|(R.subdivisionsX||R.subdivisions||1),O=0|(R.subdivisionsY||R.subdivisions||1);for(r=0;r<=O;r++)for(q=0;q<=l;q++){const R=new Q.nJ(q*e/l-e/2,0,(O-r)*D/O-D/2),J=new Q.nJ(0,1,0);B.push(R.x,R.y,R.z),h.push(J.x,J.y,J.z),y.push(q/l,E.c?r/O:1-r/O)}for(r=0;r<O;r++)for(q=0;q<l;q++)J.push(q+1+(r+1)*(l+1)),J.push(q+1+r*(l+1)),J.push(q+r*(l+1)),J.push(q+(r+1)*(l+1)),J.push(q+1+(r+1)*(l+1)),J.push(q+r*(l+1));const n=new N.e;return n.indices=J,n.MR=B,n.HR=h,n.XR=y,n}function n(R){const J=void 0!==R.xmin&&null!==R.xmin?R.xmin:-1,B=void 0!==R.zmin&&null!==R.zmin?R.zmin:-1,h=void 0!==R.xmax&&null!==R.xmax?R.xmax:1,y=void 0!==R.zmax&&null!==R.zmax?R.zmax:1,r=R.subdivisions||{w:1,h:1},q=R.precision||{w:1,h:1},e=[],D=[],l=[],E=[];let O,n,P,A;r.h=r.h<1?1:r.h,r.w=r.w<1?1:r.w,q.w=q.w<1?1:q.w,q.h=q.h<1?1:q.h;const u=(h-J)/r.w,S=(y-B)/r.h;function f(R,J,B,h){const y=D.length/3,N=q.w+1;for(O=0;O<q.h;O++)for(n=0;n<q.w;n++){const R=[y+n+O*N,y+(n+1)+O*N,y+(n+1)+(O+1)*N,y+n+(O+1)*N];e.push(R[1]),e.push(R[2]),e.push(R[3]),e.push(R[0]),e.push(R[1]),e.push(R[3])}const r=Q.nJ.Zero(),P=new Q.nJ(0,1,0);for(O=0;O<=q.h;O++)for(r.z=O*(h-J)/q.h+J,n=0;n<=q.w;n++)r.x=n*(B-R)/q.w+R,r.y=0,D.push(r.x,r.y,r.z),l.push(P.x,P.y,P.z),E.push(n/q.w,O/q.h)}for(P=0;P<r.h;P++)for(A=0;A<r.w;A++)f(J+A*u,B+P*S,J+(A+1)*u,B+(P+1)*S);const a=new N.e;return a.indices=e,a.MR=D,a.HR=l,a.XR=E,a}function P(R){const J=[],B=[],y=[],r=[];let q,e;const D=R.colorFilter||new h.SJ(.3,.59,.11),E=R.alphaFilter||0;let O=!1;if(R.minHeight>R.maxHeight){O=!0;const J=R.maxHeight;R.maxHeight=R.minHeight,R.minHeight=J}for(q=0;q<=R.subdivisions;q++)for(e=0;e<=R.subdivisions;e++){const J=new Q.nJ(e*R.width/R.subdivisions-R.width/2,0,(R.subdivisions-q)*R.height/R.subdivisions-R.height/2),h=4*(((J.x+R.width/2)/R.width*(R.bufferWidth-1)|0)+((1-(J.z+R.height/2)/R.height)*(R.bufferHeight-1)|0)*R.bufferWidth);let N=R.buffer[h]/255,n=R.buffer[h+1]/255,P=R.buffer[h+2]/255;const A=R.buffer[h+3]/255;O&&(N=1-N,n=1-n,P=1-P);const u=N*D.r+n*D.g+P*D.b;J.y=A>=E?R.minHeight+(R.maxHeight-R.minHeight)*u:R.minHeight-l.d,R.heightBuffer&&(R.heightBuffer[q*(R.subdivisions+1)+e]=J.y),B.push(J.x,J.y,J.z),y.push(0,0,0),r.push(e/R.subdivisions,1-q/R.subdivisions)}for(q=0;q<R.subdivisions;q++)for(e=0;e<R.subdivisions;e++){const Q=e+1+(q+1)*(R.subdivisions+1),h=e+1+q*(R.subdivisions+1),y=e+q*(R.subdivisions+1),N=e+(q+1)*(R.subdivisions+1),r=B[3*Q+1]>=R.minHeight,D=B[3*h+1]>=R.minHeight,l=B[3*y+1]>=R.minHeight;r&&D&&l&&(J.push(Q),J.push(h),J.push(y));B[3*N+1]>=R.minHeight&&r&&l&&(J.push(N),J.push(Q),J.push(y))}N.e.ComputeNormals(B,J,y);const n=new N.e;return n.indices=J,n.MR=B,n.HR=y,n.XR=r,n}function A(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const B=new q(R,arguments.length>2?arguments[2]:void 0);B._setReady(!1),B._subdivisionsX=J.subdivisionsX||J.subdivisions||1,B._subdivisionsY=J.subdivisionsY||J.subdivisions||1,B._width=J.width||1,B._height=J.height||1,B._maxX=B._width/2,B._maxZ=B._height/2,B._minX=-B._maxX,B._minZ=-B._maxZ;return O(J).zR(B,J.updatable),B._setReady(!0),B}function u(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new y.e(R,B);return n(J).zR(Q,J.updatable),Q}function S(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const y=B.width||10,N=B.height||10,r=B.subdivisions||1,l=B.minHeight||0,E=B.maxHeight||1,O=B.colorFilter||new h.SJ(.3,.59,.11),n=B.alphaFilter||0,A=B.updatable,u=B.onReady;Q=Q||D.e.LastCreatedScene;const S=new q(R,Q);let f;S._subdivisionsX=r,S._subdivisionsY=r,S._width=y,S._height=N,S._maxX=S._width/2,S._maxZ=S._height/2,S._minX=-S._maxX,S._minZ=-S._maxZ,S._setReady(!1),B.passHeightBufferInCallback&&(f=new Float32Array((r+1)*(r+1)));const a=(R,J,B)=>{P({width:y,height:N,subdivisions:r,minHeight:l,maxHeight:E,colorFilter:O,buffer:R,bufferWidth:J,bufferHeight:B,alphaFilter:n,heightBuffer:f}).zR(S,A),u&&u(S,f),S._setReady(!0)};if("string"===typeof J){const R=R=>{var J;const B=R.width,h=R.height;if(Q.D)return;const y=null===(J=Q)||void 0===J?void 0:J.getEngine().resizeImageBitmap(R,B,h);a(y,B,h)};e.Tools.LoadImage(J,R,B.onError?B.onError:()=>{},Q.offlineProvider)}else a(J.data,J.width,J.height);return S}N.e.CreateGround=O,N.e.CreateTiledGround=n,N.e.CreateGroundFromHeightMap=P,y.e.CreateGround=(R,J,B,Q,h,y)=>A(R,{width:J,height:B,subdivisions:Q,updatable:y},h),y.e.CreateTiledGround=(R,J,B,Q,h,y,N,r,q)=>u(R,{xmin:J,zmin:B,xmax:Q,zmax:h,subdivisions:y,precision:N,updatable:q},r),y.e.CreateGroundFromHeightMap=(R,J,B,Q,h,y,N,r,q,e,D)=>S(R,J,{width:B,height:Q,subdivisions:h,minHeight:y,maxHeight:N,updatable:q,onReady:e,alphaFilter:D},r)},13076:(R,J,B)=>{"use strict";B.d(J,{d:()=>O,h:()=>l,l:()=>E});var Q=B(11186),h=B(11628),y=B(11613),N=B(11741),r=B(11262),q=B(11043);function e(R){const J=[],B=[],Q=R.lines,h=R.dR,N=[];let r=0;for(let y=0;y<Q.length;y++){const R=Q[y];for(let Q=0;Q<R.length;Q++){const{x:q,y:e,z:D}=R[Q];if(B.push(q,e,D),h){const R=h[y],{r:J,g:B,b:r,a:q}=R[Q];N.push(J,B,r,q)}Q>0&&(J.push(r-1),J.push(r)),r++}}const q=new y.e;return q.indices=J,q.MR=B,h&&(q.dR=N),q}function D(R){const J=R.dashSize||3,B=R.gapSize||1,h=R.dashNb||200,N=R.points,r=[],q=[],e=Q.nJ.Zero();let D=0,l=0,E=0,O=0,n=0,P=0,A=0;for(A=0;A<N.length-1;A++)N[A+1].subtractToRef(N[A],e),D+=e.length();for(E=D/h,O=J*E/(J+B),A=0;A<N.length-1;A++){N[A+1].subtractToRef(N[A],e),l=Math.floor(e.length()/E),e.normalize();for(let R=0;R<l;R++)n=E*R,r.push(N[A].x+n*e.x,N[A].y+n*e.y,N[A].z+n*e.z),r.push(N[A].x+(n+O)*e.x,N[A].y+(n+O)*e.y,N[A].z+(n+O)*e.z),q.push(P,P+1),P+=2}const u=new y.e;return u.MR=r,u.indices=q,u}function l(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=J.instance,h=J.lines,y=J.dR;if(Q){const R=Q.getVerticesData(r.h.PositionKind);let J,B;y&&(J=Q.getVerticesData(r.h.ColorKind));let N=0,q=0;for(let Q=0;Q<h.length;Q++){const r=h[Q];for(let h=0;h<r.length;h++)R[N]=r[h].x,R[N+1]=r[h].y,R[N+2]=r[h].z,y&&J&&(B=y[Q],J[q]=B[h].r,J[q+1]=B[h].g,J[q+2]=B[h].b,J[q+3]=B[h].a,q+=4),N+=3}return Q.updateVerticesData(r.h.PositionKind,R,!1,!1),y&&J&&Q.updateVerticesData(r.h.ColorKind,J,!1,!1),Q.refreshBoundingInfo(),Q}const q=!!y,D=new N.b(R,B,null,void 0,void 0,q,J.useVertexAlpha,J.material);return e(J).zR(D,J.updatable),D}function E(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=J.dR?[J.dR]:null;return l(R,{lines:[J.points],updatable:J.updatable,instance:J.instance,dR:Q,useVertexAlpha:J.useVertexAlpha,material:J.material},B)}function O(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=J.points,r=J.instance,e=J.gapSize||1,l=J.dashSize||3;if(r){const R=R=>{const J=Q.nJ.Zero(),B=R.length/6;let h=0,N=0,q=0,e=0,D=0,l=0,E=0,O=0;for(E=0;E<y.length-1;E++)y[E+1].subtractToRef(y[E],J),h+=J.length();q=h/B;const n=r._creationDataStorage.dashSize;for(e=n*q/(n+r._creationDataStorage.gapSize),E=0;E<y.length-1;E++)for(y[E+1].subtractToRef(y[E],J),N=Math.floor(J.length()/q),J.normalize(),O=0;O<N&&l<R.length;)D=q*O,R[l]=y[E].x+D*J.x,R[l+1]=y[E].y+D*J.y,R[l+2]=y[E].z+D*J.z,R[l+3]=y[E].x+(D+e)*J.x,R[l+4]=y[E].y+(D+e)*J.y,R[l+5]=y[E].z+(D+e)*J.z,l+=6,O++;for(;l<R.length;)R[l]=y[E].x,R[l+1]=y[E].y,R[l+2]=y[E].z,l+=3};return(J.dashNb||J.dashSize||J.gapSize||J.useVertexAlpha||J.material)&&q.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),r.updateMeshPositions(R,!1),r}const E=new N.b(R,B,null,void 0,void 0,void 0,J.useVertexAlpha,J.material);return D(J).zR(E,J.updatable),E._creationDataStorage=new h.f,E._creationDataStorage.dashSize=l,E._creationDataStorage.gapSize=e,E}y.e.CreateLineSystem=e,y.e.CreateDashedLines=D,h.e.Ve=function(R,J){return E(R,{points:J,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},h.e.CreateDashedLines=function(R,J,B,Q,h){return O(R,{points:J,dashSize:B,gapSize:Q,dashNb:h,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12463:(R,J,B)=>{"use strict";B.d(J,{e:()=>r,i:()=>q});var Q=B(11628),h=B(11613),y=B(11238);function N(R){const J=[],B=[],Q=[],N=[],r=void 0!==R.width?R.width:void 0!==R.size?R.size:1,q=void 0!==R.height?R.height:void 0!==R.size?R.size:1,e=0===R.sideOrientation?0:R.sideOrientation||h.e.DEFAULTSIDE,D=r/2,l=q/2;B.push(-D,-l,0),Q.push(0,0,-1),N.push(0,y.c?1:0),B.push(D,-l,0),Q.push(0,0,-1),N.push(1,y.c?1:0),B.push(D,l,0),Q.push(0,0,-1),N.push(1,y.c?0:1),B.push(-D,l,0),Q.push(0,0,-1),N.push(0,y.c?0:1),J.push(0),J.push(1),J.push(2),J.push(0),J.push(2),J.push(3),h.e._ComputeSides(e,B,J,Q,N,R.frontUVs,R.backUVs);const E=new h.e;return E.indices=J,E.MR=B,E.HR=Q,E.XR=N,E}function r(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new Q.e(R,B);J.sideOrientation=Q.e._GetDefaultSideOrientation(J.sideOrientation),h._originalBuilderSideOrientation=J.sideOrientation;return N(J).zR(h,J.updatable),J.sourcePlane&&(h.translate(J.sourcePlane.normal,-J.sourcePlane.d),h.setDirection(J.sourcePlane.normal.scale(-1))),h}const q={ce:r};h.e.ce=N,Q.e.ce=(R,J,B,Q,h)=>r(R,{size:J,width:J,height:J,sideOrientation:h,updatable:Q},B)},12548:(R,J,B)=>{"use strict";B.d(J,{c:()=>q});var Q=B(11186),h=B(11628),y=B(11613),N=B(11238);function r(R){const J=0|(R.segments||32),B=R.diameterX||R.diameter||1,h=R.diameterY||R.diameter||1,r=R.diameterZ||R.diameter||1,q=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,e=R.slice&&R.slice<=0?1:R.slice||1,D=0===R.sideOrientation?0:R.sideOrientation||y.e.DEFAULTSIDE,l=!!R.dedupTopBottomIndices,E=new Q.nJ(B/2,h/2,r/2),O=2+J,n=2*O,P=[],A=[],u=[],S=[];for(let y=0;y<=O;y++){const R=y/O,J=R*Math.PI*e;for(let B=0;B<=n;B++){const h=B/n,y=h*Math.PI*2*q,r=Q.Matrix.RotationZ(-J),e=Q.Matrix.RotationY(y),D=Q.nJ.TransformCoordinates(Q.nJ.Up(),r),l=Q.nJ.TransformCoordinates(D,e),O=l.multiply(E),P=l.divide(E).normalize();A.push(O.x,O.y,O.z),u.push(P.x,P.y,P.z),S.push(h,N.c?1-R:R)}if(y>0){const R=A.length/3;for(let J=R-2*(n+1);J+n+2<R;J++)l?(y>1&&(P.push(J),P.push(J+1),P.push(J+n+1)),(y<O||e<1)&&(P.push(J+n+1),P.push(J+1),P.push(J+n+2))):(P.push(J),P.push(J+1),P.push(J+n+1),P.push(J+n+1),P.push(J+1),P.push(J+n+2))}}y.e._ComputeSides(D,A,P,u,S,R.frontUVs,R.backUVs);const f=new y.e;return f.indices=P,f.MR=A,f.HR=u,f.XR=S,f}function q(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new h.e(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return r(J).zR(Q,J.updatable),Q}y.e.CreateSphere=r,h.e.CreateSphere=(R,J,B,Q,h,y)=>q(R,{segments:J,diameterX:B,diameterY:B,diameterZ:B,sideOrientation:y,updatable:h},Q)},13388:(R,J,B)=>{"use strict";B.d(J,{d:()=>r});var Q=B(11763),h=B(12867),y=B(11776),N=B(11613);class r{static get Configuration(){return{get decoder(){return h.c.DefaultConfiguration},set decoder(R){h.c.DefaultConfiguration=R}}}static set Configuration(R){h.c.DefaultConfiguration=R.decoder}static get DecoderAvailable(){return(0,Q.i)(h.c.DefaultConfiguration)}static get Default(){return r._Default??(r._Default=new r),r._Default}static ResetDefault(R){r._Default&&(R||r._Default.dispose(),r._Default=null)}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.DefaultNumWorkers;const J="number"===typeof R?{...h.c.DefaultConfiguration,numWorkers:R}:{...h.c.DefaultConfiguration,...R};this._decoder=new h.c(J)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(R,J,B){return this._decoder.decodeMeshToMeshDataAsync(R,J,B)}async decodeMeshToGeometryAsync(R,J,B,Q){return await this._decoder.decodeMeshToGeometryAsync(R,J,B,Q)}async _decodeMeshToGeometryForGltfAsync(R,J,B,Q,h,y){return await this._decoder._decodeMeshToGeometryForGltfAsync(R,J,B,Q,h,y)}async decodeMeshAsync(R,J){const B=await this._decoder.decodeMeshToMeshDataAsync(R,J),Q=new N.e;B.indices&&(Q.indices=B.indices);for(const h of B.attributes){const R=y.d.GetFloatData(h.data,h.size,y.d.GetDataType(h.data),h.byteOffset,h.byteStride,h.normalized,B.totalVertices);Q.set(R,h.kind)}return Q}}r.DefaultNumWorkers=(0,Q.f)(),r._Default=null},12867:(R,J,B)=>{"use strict";B.d(J,{c:()=>e});var Q=B(11763),h=B(11030),y=B(11640),N=B(11776),r=B(11043),q=B(11771);class e extends Q.d{static get DefaultAvailable(){return(0,Q.i)(e.DefaultConfiguration)}static get Default(){return e._Default??(e._Default=new e),e._Default}static ResetDefault(R){e._Default&&(R||e._Default.dispose(),e._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(R,J){return{module:await(J||DracoDecoderModule)({wasmBinary:R})}}_getWorkerContent(){return`${q.c}(${q.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DefaultConfiguration)}decodeMeshToMeshDataAsync(R,J,B){const Q=R instanceof ArrayBuffer?new Int8Array(R):new Int8Array(R.buffer,R.byteOffset,R.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async R=>await new Promise(((h,y)=>{R.push(((R,N)=>{let q=null;const e=[],D=J=>{R.removeEventListener("error",D),R.removeEventListener("message",l),y(J),N()},l=J=>{const Q=J.data;switch(Q.id){case"indices":q=Q.data;break;case"attribute":e.push({kind:Q.kind,data:Q.data,size:Q.size,byteOffset:Q.byteOffset,byteStride:Q.byteStride,normalized:(y=Q.kind,E=Q.normalized,B&&void 0!==B[y]?(E!==B[y]&&r.d.Warn(`Normalized flag from Draco data (${E}) does not match normalized flag from glTF accessor (${B[y]}). Using flag from glTF accessor.`),B[y]):E)});break;case"decodeMeshDone":R.removeEventListener("error",D),R.removeEventListener("message",l),h({indices:q,attributes:e,totalVertices:Q.totalVertices}),N()}var y,E};R.addEventListener("error",D),R.addEventListener("message",l);const E=Q.slice();R.postMessage({id:"decodeMesh",dataView:E,attributes:J},[E.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((R=>{let B=null;const h=[],y=(0,q.c)(R.module,Q,J,(R=>{B=R}),((R,J,B,Q,y,N)=>{h.push({kind:R,data:J,size:B,byteOffset:Q,byteStride:y,normalized:N})}));return{indices:B,attributes:h,totalVertices:y}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(R,J,B,Q){const h=await this.decodeMeshToMeshDataAsync(B,Q),r=new y.c(R,J);h.indices&&r.setIndices(h.indices);for(const y of h.attributes)r.setVerticesBuffer(new N.d(J.getEngine(),y.data,y.kind,!1,void 0,y.byteStride,void 0,y.byteOffset,y.size,void 0,y.normalized,!0),h.totalVertices);return r}async _decodeMeshToGeometryForGltfAsync(R,J,B,Q,h,r){const q=await this.decodeMeshToMeshDataAsync(B,Q,h),e=new y.c(R,J);r&&(e._boundingInfo=r,e.useBoundingInfoFromGeometry=!0),q.indices&&e.setIndices(q.indices);for(const y of q.attributes)e.setVerticesBuffer(new N.d(J.getEngine(),y.data,y.kind,!1,void 0,y.byteStride,void 0,y.byteOffset,y.size,void 0,y.normalized,!0),q.totalVertices);return e}}e.DefaultConfiguration={wasmUrl:`${h.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${h.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${h.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},e._Default=null},13072:(R,J,B)=>{"use strict";B.d(J,{c:()=>rR});var Q=B(11186),h=B(11628),y=B(11262),N=B(11613),r=B(11238);function q(R){let J=R.pathArray;const B=R.closeArray||!1,Q=R.closePath||!1,h=R.invertUV||!1,q=Math.floor(J[0].length/2);let e=R.offset||q;e=e>q?q:Math.floor(e);const D=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE,l=R.XR,E=R.dR,O=[],n=[],P=[],A=[],u=[],S=[],f=[],a=[];let s;const x=[],I=[];let V,M,H;if(J.length<2){const R=[],B=[];for(M=0;M<J[0].length-e;M++)R.push(J[0][M]),B.push(J[0][M+e]);J=[R,B]}let d=0;const X=Q?1:0,c=B?1:0;let z,p,i,W,k,Y;for(s=J[0].length,V=0;V<J.length+c;V++){for(f[V]=0,u[V]=[0],z=V===J.length?J[0]:J[V],p=z.length,s=s<p?s:p,H=0;H<p;)O.push(z[H].x,z[H].y,z[H].z),H>0&&(i=z[H].PJ(z[H-1]).length(),W=i+f[V],u[V].push(W),f[V]=W),H++;Q&&(H--,O.push(z[0].x,z[0].y,z[0].z),i=z[H].PJ(z[0]).length(),W=i+f[V],u[V].push(W),f[V]=W),x[V]=p+X,I[V]=d,d+=p+X}let G,g,L=null,j=null;for(M=0;M<s+X;M++)for(a[M]=0,S[M]=[0],V=0;V<J.length-1+c;V++)k=J[V],Y=V===J.length-1?J[0]:J[V+1],M===s?(L=k[0],j=Y[0]):(L=k[M],j=Y[M]),i=j.PJ(L).length(),W=i+a[M],S[M].push(W),a[M]=W;if(l)for(V=0;V<l.length;V++)A.push(l[V].x,r.c?1-l[V].y:l[V].y);else for(V=0;V<J.length+c;V++)for(M=0;M<s+X;M++)G=0!=f[V]?u[V][M]/f[V]:0,g=0!=a[M]?S[M][V]/a[M]:0,h?A.push(g,G):A.push(G,r.c?1-g:g);V=0;let T=0,F=x[V]-1,C=x[V+1]-1,b=F<C?F:C,w=I[1]-I[0];const K=x.length-1;for(;T<=b&&V<K;)n.push(T,T+w,T+1),n.push(T+w+1,T+1,T+w),T+=1,T===b&&(V++,w=I[V+1]-I[V],F=x[V]-1,C=x[V+1]-1,T=I[V],b=F<C?F+T:C+T);if(N.e.ComputeNormals(O,n,P),Q){let R=0,B=0;for(V=0;V<J.length;V++){R=3*I[V],B=V+1<J.length?3*(I[V+1]-1):P.length-3,P[R]=.5*(P[R]+P[B]),P[R+1]=.5*(P[R+1]+P[B+1]),P[R+2]=.5*(P[R+2]+P[B+2]);const Q=Math.sqrt(P[R]*P[R]+P[R+1]*P[R+1]+P[R+2]*P[R+2]);P[R]/=Q,P[R+1]/=Q,P[R+2]/=Q,P[B]=P[R],P[B+1]=P[R+1],P[B+2]=P[R+2]}}if(B){let R=3*I[0],B=3*I[J.length];for(M=0;M<s+X;M++){P[R]=.5*(P[R]+P[B]),P[R+1]=.5*(P[R+1]+P[B+1]),P[R+2]=.5*(P[R+2]+P[B+2]);const J=Math.sqrt(P[R]*P[R]+P[R+1]*P[R+1]+P[R+2]*P[R+2]);P[R]/=J,P[R+1]/=J,P[R+2]/=J,P[B]=P[R],P[B+1]=P[R+1],P[B+2]=P[R+2],R+=3,B+=3}}N.e._ComputeSides(D,O,n,P,A,R.frontUVs,R.backUVs);let v=null;if(E){v=new Float32Array(4*E.length);for(let R=0;R<E.length;R++)v[4*R]=E[R].r,v[4*R+1]=E[R].g,v[4*R+2]=E[R].b,v[4*R+3]=E[R].a}const m=new N.e,o=new Float32Array(O),t=new Float32Array(P),Z=new Float32Array(A);return m.indices=n,m.MR=o,m.HR=t,m.XR=Z,v&&m.set(v,y.h.ColorKind),Q&&(m._idx=I),m}function e(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=J.pathArray,D=J.closeArray,l=J.closePath,E=h.e._GetDefaultSideOrientation(J.sideOrientation),O=J.instance,n=J.updatable;if(O){const R=Q.TmpVectors.nJ[0].Sr(Number.MAX_VALUE),B=Q.TmpVectors.nJ[1].Sr(-Number.MAX_VALUE),q=J=>{let Q=e[0].length;const y=O;let N=0;const r=y._originalBuilderSideOrientation===h.e.DOUBLESIDE?2:1;for(let h=1;h<=r;++h)for(let r=0;r<e.length;++r){const h=e[r],q=h.length;Q=Q<q?Q:q;for(let y=0;y<Q;++y){const Q=h[y];J[N]=Q.x,J[N+1]=Q.y,J[N+2]=Q.z,R.minimizeInPlaceFromFloats(Q.x,Q.y,Q.z),B.maximizeInPlaceFromFloats(Q.x,Q.y,Q.z),N+=3}if(y._creationDataStorage&&y._creationDataStorage.closePath){const R=h[0];J[N]=R.x,J[N+1]=R.y,J[N+2]=R.z,N+=3}}},D=O.getVerticesData(y.h.PositionKind);if(q(D),O.hasBoundingInfo?O.getBoundingInfo().reConstruct(R,B,O._worldMatrix):O.buildBoundingInfo(R,B,O._worldMatrix),O.updateVerticesData(y.h.PositionKind,D,!1,!1),J.dR){const R=O.getVerticesData(y.h.ColorKind);for(let B=0,Q=0;B<J.dR.length;B++,Q+=4){const h=J.dR[B];R[Q]=h.r,R[Q+1]=h.g,R[Q+2]=h.b,R[Q+3]=h.a}O.updateVerticesData(y.h.ColorKind,R,!1,!1)}if(J.XR){const R=O.getVerticesData(y.h.UVKind);for(let B=0;B<J.XR.length;B++)R[2*B]=J.XR[B].x,R[2*B+1]=r.c?1-J.XR[B].y:J.XR[B].y;O.updateVerticesData(y.h.UVKind,R,!1,!1)}if(!O.areNormalsFrozen||O.isFacetDataEnabled){const R=O.hr(),J=O.getVerticesData(y.h.NormalKind),B=O.isFacetDataEnabled?O.getFacetDataParameters():null;if(N.e.ComputeNormals(D,R,J,B),O._creationDataStorage&&O._creationDataStorage.closePath){let R=0,B=0;for(let Q=0;Q<e.length;Q++)R=3*O._creationDataStorage.idx[Q],B=Q+1<e.length?3*(O._creationDataStorage.idx[Q+1]-1):J.length-3,J[R]=.5*(J[R]+J[B]),J[R+1]=.5*(J[R+1]+J[B+1]),J[R+2]=.5*(J[R+2]+J[B+2]),J[B]=J[R],J[B+1]=J[R+1],J[B+2]=J[R+2]}O.areNormalsFrozen||O.updateVerticesData(y.h.NormalKind,J,!1,!1)}return O}{const Q=new h.e(R,B);Q._originalBuilderSideOrientation=E,Q._creationDataStorage=new h.f;const y=q(J);return l&&(Q._creationDataStorage.idx=y._idx),Q._creationDataStorage.closePath=l,Q._creationDataStorage.closeArray=D,y.zR(Q,n),Q}}N.e.CreateRibbon=q,h.e.CreateRibbon=function(R,J){return e(R,{pathArray:J,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var D=B(12558),l=B(12409),E=B(11224);function O(R){const J=R.pattern||h.e.NO_FLIP,B=R.tileWidth||R.tileSize||1,Q=R.tileHeight||R.tileSize||1,y=R.alignHorizontal||0,r=R.alignVertical||0,q=R.width||R.size||1,e=Math.floor(q/B);let D=q-e*B;const l=R.height||R.size||1,E=Math.floor(l/Q);let O=l-E*Q;const n=B*e/2,P=Q*E/2;let A=0,u=0,S=0,f=0,a=0,s=0;if(D>0||O>0){switch(S=-n,f=-P,a=n,s=P,y){case h.e.CENTER:D/=2,S-=D,a+=D;break;case h.e.LEFT:a+=D,A=-D/2;break;case h.e.RIGHT:S-=D,A=D/2}switch(r){case h.e.CENTER:O/=2,f-=O,s+=O;break;case h.e.BOTTOM:s+=O,u=-O/2;break;case h.e.TOP:f-=O,u=O/2}}const x=[],I=[],V=[];V[0]=[0,0,1,0,1,1,0,1],V[1]=[0,0,1,0,1,1,0,1],J!==h.e.ROTATE_TILE&&J!==h.e.ROTATE_ROW||(V[1]=[1,1,0,1,0,0,1,0]),J!==h.e.FLIP_TILE&&J!==h.e.FLIP_ROW||(V[1]=[1,0,0,0,0,1,1,1]),J!==h.e.FLIP_N_ROTATE_TILE&&J!==h.e.FLIP_N_ROTATE_ROW||(V[1]=[0,1,1,1,1,0,0,0]);let M=[];const H=[],d=[];let X=0;for(let N=0;N<E;N++)for(let R=0;R<e;R++)x.push(R*B-n+A,N*Q-P+u,0),x.push((R+1)*B-n+A,N*Q-P+u,0),x.push((R+1)*B-n+A,(N+1)*Q-P+u,0),x.push(R*B-n+A,(N+1)*Q-P+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),M=J===h.e.FLIP_TILE||J===h.e.ROTATE_TILE||J===h.e.FLIP_N_ROTATE_TILE?M.concat(V[(R%2+N%2)%2]):J===h.e.FLIP_ROW||J===h.e.ROTATE_ROW||J===h.e.FLIP_N_ROTATE_ROW?M.concat(V[N%2]):M.concat(V[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),X+=4;if(D>0||O>0){const R=O>0&&(r===h.e.CENTER||r===h.e.TOP),N=O>0&&(r===h.e.CENTER||r===h.e.BOTTOM),q=D>0&&(y===h.e.CENTER||y===h.e.RIGHT),l=D>0&&(y===h.e.CENTER||y===h.e.LEFT);let V,c,z,p,i=[];if(R&&q&&(x.push(S+A,f+u,0),x.push(-n+A,f+u,0),x.push(-n+A,f+O+u,0),x.push(S+A,f+O+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,V=1-D/B,c=1-O/Q,z=1,p=1,i=[V,c,z,c,z,p,V,p],J===h.e.ROTATE_ROW&&(i=[1-V,1-c,1-z,1-c,1-z,1-p,1-V,1-p]),J===h.e.FLIP_ROW&&(i=[1-V,c,1-z,c,1-z,p,1-V,p]),J===h.e.FLIP_N_ROTATE_ROW&&(i=[V,1-c,z,1-c,z,1-p,V,1-p]),M=M.concat(i),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R&&l&&(x.push(n+A,f+u,0),x.push(a+A,f+u,0),x.push(a+A,f+O+u,0),x.push(n+A,f+O+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,V=0,c=1-O/Q,z=D/B,p=1,i=[V,c,z,c,z,p,V,p],(J===h.e.ROTATE_ROW||J===h.e.ROTATE_TILE&&e%2===0)&&(i=[1-V,1-c,1-z,1-c,1-z,1-p,1-V,1-p]),(J===h.e.FLIP_ROW||J===h.e.FLIP_TILE&&e%2===0)&&(i=[1-V,c,1-z,c,1-z,p,1-V,p]),(J===h.e.FLIP_N_ROTATE_ROW||J===h.e.FLIP_N_ROTATE_TILE&&e%2===0)&&(i=[V,1-c,z,1-c,z,1-p,V,1-p]),M=M.concat(i),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&q&&(x.push(S+A,P+u,0),x.push(-n+A,P+u,0),x.push(-n+A,s+u,0),x.push(S+A,s+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,V=1-D/B,c=0,z=1,p=O/Q,i=[V,c,z,c,z,p,V,p],(J===h.e.ROTATE_ROW&&E%2===1||J===h.e.ROTATE_TILE&&E%1===0)&&(i=[1-V,1-c,1-z,1-c,1-z,1-p,1-V,1-p]),(J===h.e.FLIP_ROW&&E%2===1||J===h.e.FLIP_TILE&&E%2===0)&&(i=[1-V,c,1-z,c,1-z,p,1-V,p]),(J===h.e.FLIP_N_ROTATE_ROW&&E%2===1||J===h.e.FLIP_N_ROTATE_TILE&&E%2===0)&&(i=[V,1-c,z,1-c,z,1-p,V,1-p]),M=M.concat(i),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&l&&(x.push(n+A,P+u,0),x.push(a+A,P+u,0),x.push(a+A,s+u,0),x.push(n+A,s+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,V=0,c=0,z=D/B,p=O/Q,i=[V,c,z,c,z,p,V,p],(J===h.e.ROTATE_ROW&&E%2===1||J===h.e.ROTATE_TILE&&(E+e)%2===1)&&(i=[1-V,1-c,1-z,1-c,1-z,1-p,1-V,1-p]),(J===h.e.FLIP_ROW&&E%2===1||J===h.e.FLIP_TILE&&(E+e)%2===1)&&(i=[1-V,c,1-z,c,1-z,p,1-V,p]),(J===h.e.FLIP_N_ROTATE_ROW&&E%2===1||J===h.e.FLIP_N_ROTATE_TILE&&(E+e)%2===1)&&(i=[V,1-c,z,1-c,z,1-p,V,1-p]),M=M.concat(i),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R){const R=[];V=0,c=1-O/Q,z=1,p=1,R[0]=[V,c,z,c,z,p,V,p],R[1]=[V,c,z,c,z,p,V,p],J!==h.e.ROTATE_TILE&&J!==h.e.ROTATE_ROW||(R[1]=[1-V,1-c,1-z,1-c,1-z,1-p,1-V,1-p]),J!==h.e.FLIP_TILE&&J!==h.e.FLIP_ROW||(R[1]=[1-V,c,1-z,c,1-z,p,1-V,p]),J!==h.e.FLIP_N_ROTATE_TILE&&J!==h.e.FLIP_N_ROTATE_ROW||(R[1]=[V,1-c,z,1-c,z,1-p,V,1-p]);for(let Q=0;Q<e;Q++)x.push(Q*B-n+A,f+u,0),x.push((Q+1)*B-n+A,f+u,0),x.push((Q+1)*B-n+A,f+O+u,0),x.push(Q*B-n+A,f+O+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,M=J===h.e.FLIP_TILE||J===h.e.ROTATE_TILE||J===h.e.FLIP_N_ROTATE_TILE?M.concat(R[(Q+1)%2]):J===h.e.FLIP_ROW||J===h.e.ROTATE_ROW||J===h.e.FLIP_N_ROTATE_ROW?M.concat(R[1]):M.concat(R[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(N){const R=[];V=0,c=0,z=1,p=O/Q,R[0]=[V,c,z,c,z,p,V,p],R[1]=[V,c,z,c,z,p,V,p],J!==h.e.ROTATE_TILE&&J!==h.e.ROTATE_ROW||(R[1]=[1-V,1-c,1-z,1-c,1-z,1-p,1-V,1-p]),J!==h.e.FLIP_TILE&&J!==h.e.FLIP_ROW||(R[1]=[1-V,c,1-z,c,1-z,p,1-V,p]),J!==h.e.FLIP_N_ROTATE_TILE&&J!==h.e.FLIP_N_ROTATE_ROW||(R[1]=[V,1-c,z,1-c,z,1-p,V,1-p]);for(let Q=0;Q<e;Q++)x.push(Q*B-n+A,s-O+u,0),x.push((Q+1)*B-n+A,s-O+u,0),x.push((Q+1)*B-n+A,s+u,0),x.push(Q*B-n+A,s+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,M=J===h.e.FLIP_TILE||J===h.e.ROTATE_TILE||J===h.e.FLIP_N_ROTATE_TILE?M.concat(R[(Q+E)%2]):J===h.e.FLIP_ROW||J===h.e.ROTATE_ROW||J===h.e.FLIP_N_ROTATE_ROW?M.concat(R[E%2]):M.concat(R[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const R=[];V=1-D/B,c=0,z=1,p=1,R[0]=[V,c,z,c,z,p,V,p],R[1]=[V,c,z,c,z,p,V,p],J!==h.e.ROTATE_TILE&&J!==h.e.ROTATE_ROW||(R[1]=[1-V,1-c,1-z,1-c,1-z,1-p,1-V,1-p]),J!==h.e.FLIP_TILE&&J!==h.e.FLIP_ROW||(R[1]=[1-V,c,1-z,c,1-z,p,1-V,p]),J!==h.e.FLIP_N_ROTATE_TILE&&J!==h.e.FLIP_N_ROTATE_ROW||(R[1]=[V,1-c,z,1-c,z,1-p,V,1-p]);for(let B=0;B<E;B++)x.push(S+A,B*Q-P+u,0),x.push(S+D+A,B*Q-P+u,0),x.push(S+D+A,(B+1)*Q-P+u,0),x.push(S+A,(B+1)*Q-P+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,M=J===h.e.FLIP_TILE||J===h.e.ROTATE_TILE||J===h.e.FLIP_N_ROTATE_TILE?M.concat(R[(B+1)%2]):J===h.e.FLIP_ROW||J===h.e.ROTATE_ROW||J===h.e.FLIP_N_ROTATE_ROW?M.concat(R[B%2]):M.concat(R[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const R=[];V=0,c=0,z=D/Q,p=1,R[0]=[V,c,z,c,z,p,V,p],R[1]=[V,c,z,c,z,p,V,p],J!==h.e.ROTATE_TILE&&J!==h.e.ROTATE_ROW||(R[1]=[1-V,1-c,1-z,1-c,1-z,1-p,1-V,1-p]),J!==h.e.FLIP_TILE&&J!==h.e.FLIP_ROW||(R[1]=[1-V,c,1-z,c,1-z,p,1-V,p]),J!==h.e.FLIP_N_ROTATE_TILE&&J!==h.e.FLIP_N_ROTATE_ROW||(R[1]=[V,1-c,z,1-c,z,1-p,V,1-p]);for(let B=0;B<E;B++)x.push(a-D+A,B*Q-P+u,0),x.push(a+A,B*Q-P+u,0),x.push(a+A,(B+1)*Q-P+u,0),x.push(a-D+A,(B+1)*Q-P+u,0),d.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,M=J===h.e.FLIP_TILE||J===h.e.ROTATE_TILE||J===h.e.FLIP_N_ROTATE_TILE?M.concat(R[(B+e)%2]):J===h.e.FLIP_ROW||J===h.e.ROTATE_ROW||J===h.e.FLIP_N_ROTATE_ROW?M.concat(R[B%2]):M.concat(R[0]),H.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const c=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE;N.e._ComputeSides(c,x,d,I,M,R.frontUVs,R.backUVs);const z=new N.e;z.indices=d,z.MR=x,z.HR=I,z.XR=M;const p=c===N.e.DOUBLESIDE?H.concat(H):H;return z.dR=p,z}function n(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new h.e(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return O(J).zR(Q,J.updatable),Q}function P(R){const J=R.faceUV||new Array(6),B=R.faceColors,y=R.pattern||h.e.NO_FLIP,q=R.width||R.size||1,e=R.height||R.size||1,D=R.depth||R.size||1,l=R.tileWidth||R.tileSize||1,n=R.tileHeight||R.tileSize||1,P=R.alignHorizontal||0,A=R.alignVertical||0,u=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE;for(let h=0;h<6;h++)void 0===J[h]&&(J[h]=new Q.Vector4(0,0,1,1)),B&&void 0===B[h]&&(B[h]=new E.ar(1,1,1,1));const S=q/2,f=e/2,a=D/2,s=[];for(let Q=0;Q<2;Q++)s[Q]=O({pattern:y,tileWidth:l,tileHeight:n,width:q,height:e,alignVertical:A,alignHorizontal:P,sideOrientation:u});for(let Q=2;Q<4;Q++)s[Q]=O({pattern:y,tileWidth:l,tileHeight:n,width:D,height:e,alignVertical:A,alignHorizontal:P,sideOrientation:u});let x=A;A===h.e.BOTTOM?x=h.e.TOP:A===h.e.TOP&&(x=h.e.BOTTOM);for(let Q=4;Q<6;Q++)s[Q]=O({pattern:y,tileWidth:l,tileHeight:n,width:q,height:D,alignVertical:x,alignHorizontal:P,sideOrientation:u});let I=[],V=[],M=[],H=[];const d=[],X=[],c=[],z=[];let p=0,i=0;for(let h=0;h<6;h++){const R=s[h].MR.length;X[h]=[],c[h]=[];for(let J=0;J<R/3;J++)X[h].push(new Q.nJ(s[h].MR[3*J],s[h].MR[3*J+1],s[h].MR[3*J+2])),c[h].push(new Q.nJ(s[h].HR[3*J],s[h].HR[3*J+1],s[h].HR[3*J+2]));p=s[h].XR.length,z[h]=[];for(let B=0;B<p;B+=2)z[h][B]=J[h].x+(J[h].z-J[h].x)*s[h].XR[B],z[h][B+1]=J[h].y+(J[h].w-J[h].y)*s[h].XR[B+1],r.c&&(z[h][B+1]=1-z[h][B+1]);if(M=M.concat(z[h]),H=H.concat(s[h].indices.map((R=>R+i))),i+=X[h].length,B)for(let J=0;J<4;J++)d.push(B[h].r,B[h].g,B[h].b,B[h].a)}const W=new Q.nJ(0,0,a),k=Q.Matrix.RotationY(Math.PI);I=X[0].map((R=>Q.nJ.TransformNormal(R,k).add(W))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[]),V=c[0].map((R=>Q.nJ.TransformNormal(R,k))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[]),I=I.concat(X[1].map((R=>R.PJ(W))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[])),V=V.concat(c[1].map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[]));const Y=new Q.nJ(S,0,0),G=Q.Matrix.RotationY(-Math.PI/2);I=I.concat(X[2].map((R=>Q.nJ.TransformNormal(R,G).add(Y))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[])),V=V.concat(c[2].map((R=>Q.nJ.TransformNormal(R,G))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[]));const g=Q.Matrix.RotationY(Math.PI/2);I=I.concat(X[3].map((R=>Q.nJ.TransformNormal(R,g).PJ(Y))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[])),V=V.concat(c[3].map((R=>Q.nJ.TransformNormal(R,g))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[]));const L=new Q.nJ(0,f,0),j=Q.Matrix.RotationX(Math.PI/2);I=I.concat(X[4].map((R=>Q.nJ.TransformNormal(R,j).add(L))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[])),V=V.concat(c[4].map((R=>Q.nJ.TransformNormal(R,j))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[]));const T=Q.Matrix.RotationX(-Math.PI/2);I=I.concat(X[5].map((R=>Q.nJ.TransformNormal(R,T).PJ(L))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[])),V=V.concat(c[5].map((R=>Q.nJ.TransformNormal(R,T))).map((R=>[R.x,R.y,R.z])).reduce(((R,J)=>R.concat(J)),[])),N.e._ComputeSides(u,I,H,V,M);const F=new N.e;if(F.indices=H,F.MR=I,F.HR=V,F.XR=M,B){const R=u===N.e.DOUBLESIDE?d.concat(d):d;F.dR=R}return F}function A(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new h.e(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return P(J).zR(Q,J.updatable),Q}N.e.CreateTiledPlane=O;N.e.CreateTiledBox=P;var u=B(12548),S=B(11419),f=B(11381);function a(R){const J=R.height||2;let B=0===R.diameterTop?0:R.diameterTop||R.diameter||1,y=0===R.diameterBottom?0:R.diameterBottom||R.diameter||1;B=B||1e-5,y=y||1e-5;const q=0|(R.tessellation||24),e=0|(R.subdivisions||1),D=!!R.hasRings,l=!!R.enclose,O=0===R.cap?0:R.cap||h.e.CAP_ALL,n=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,P=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE,A=R.faceUV||new Array(3),u=R.faceColors,S=2+(1+(1!==n&&l?2:0))*(D?e:1);let a;for(a=0;a<S;a++)u&&void 0===u[a]&&(u[a]=new E.ar(1,1,1,1));for(a=0;a<S;a++)A&&void 0===A[a]&&(A[a]=new Q.Vector4(0,0,1,1));const s=[],x=[],I=[],V=[],M=[],H=2*Math.PI*n/q;let d,X,c;const z=(y-B)/2/J,p=Q.nJ.Zero(),i=Q.nJ.Zero(),W=Q.nJ.Zero(),k=Q.nJ.Zero(),Y=Q.nJ.Zero(),G=f.d.Y;let g,L,j,T=1,F=1,C=0,b=0;for(g=0;g<=e;g++)for(X=g/e,c=(X*(B-y)+y)/2,T=D&&0!==g&&g!==e?2:1,j=0;j<T;j++){for(D&&(F+=j),l&&(F+=2*j),L=0;L<=q;L++)d=L*H,p.x=Math.cos(-d)*c,p.y=-J/2+X*J,p.z=Math.sin(-d)*c,0===B&&g===e?(i.x=I[I.length-3*(q+1)],i.y=I[I.length-3*(q+1)+1],i.z=I[I.length-3*(q+1)+2]):(i.x=p.x,i.z=p.z,i.y=Math.sqrt(i.x*i.x+i.z*i.z)*z,i.normalize()),0===L&&(W.h(p),k.h(i)),x.push(p.x,p.y,p.z),I.push(i.x,i.y,i.z),b=D?C!==F?A[F].y:A[F].w:A[F].y+(A[F].w-A[F].y)*X,V.push(A[F].x+(A[F].z-A[F].x)*L/q,r.c?1-b:b),u&&M.push(u[F].r,u[F].g,u[F].b,u[F].a);1!==n&&l&&(x.push(p.x,p.y,p.z),x.push(0,p.y,0),x.push(0,p.y,0),x.push(W.x,W.y,W.z),Q.nJ.CrossToRef(G,i,Y),Y.normalize(),I.push(Y.x,Y.y,Y.z,Y.x,Y.y,Y.z),Q.nJ.CrossToRef(k,G,Y),Y.normalize(),I.push(Y.x,Y.y,Y.z,Y.x,Y.y,Y.z),b=D?C!==F?A[F+1].y:A[F+1].w:A[F+1].y+(A[F+1].w-A[F+1].y)*X,V.push(A[F+1].x,r.c?1-b:b),V.push(A[F+1].z,r.c?1-b:b),b=D?C!==F?A[F+2].y:A[F+2].w:A[F+2].y+(A[F+2].w-A[F+2].y)*X,V.push(A[F+2].x,r.c?1-b:b),V.push(A[F+2].z,r.c?1-b:b),u&&(M.push(u[F+1].r,u[F+1].g,u[F+1].b,u[F+1].a),M.push(u[F+1].r,u[F+1].g,u[F+1].b,u[F+1].a),M.push(u[F+2].r,u[F+2].g,u[F+2].b,u[F+2].a),M.push(u[F+2].r,u[F+2].g,u[F+2].b,u[F+2].a))),C!==F&&(C=F)}const w=1!==n&&l?q+4:q;for(g=0,F=0;F<e;F++){let R=0,J=0,B=0,Q=0;for(L=0;L<q;L++)R=g*(w+1)+L,J=(g+1)*(w+1)+L,B=g*(w+1)+(L+1),Q=(g+1)*(w+1)+(L+1),s.push(R,J,B),s.push(Q,B,J);1!==n&&l&&(s.push(R+2,J+2,B+2),s.push(Q+2,B+2,J+2),s.push(R+4,J+4,B+4),s.push(Q+4,B+4,J+4)),g=D?g+2:g+1}const K=R=>{const h=R?B/2:y/2;if(0===h)return;let N,e,D;const l=R?A[S-1]:A[0];let E=null;u&&(E=R?u[S-1]:u[0]);const O=x.length/3,P=R?J/2:-J/2,f=new Q.nJ(0,P,0);x.push(f.x,f.y,f.z),I.push(0,R?1:-1,0);const a=l.y+.5*(l.w-l.y);V.push(l.x+.5*(l.z-l.x),r.c?1-a:a),E&&M.push(E.r,E.g,E.b,E.a);const H=new Q.Vector2(.5,.5);for(D=0;D<=q;D++){N=2*Math.PI*D*n/q;const J=Math.cos(-N),B=Math.sin(-N);e=new Q.nJ(J*h,P,B*h);const y=new Q.Vector2(J*H.x+.5,B*H.y+.5);x.push(e.x,e.y,e.z),I.push(0,R?1:-1,0);const O=l.y+(l.w-l.y)*y.y;V.push(l.x+(l.z-l.x)*y.x,r.c?1-O:O),E&&M.push(E.r,E.g,E.b,E.a)}for(D=0;D<q;D++)R?(s.push(O),s.push(O+(D+2)),s.push(O+(D+1))):(s.push(O),s.push(O+(D+1)),s.push(O+(D+2)))};O!==h.e.CAP_START&&O!==h.e.CAP_ALL||K(!1),O!==h.e.CAP_END&&O!==h.e.CAP_ALL||K(!0),N.e._ComputeSides(P,x,s,I,V,R.frontUVs,R.backUVs);const v=new N.e;return v.indices=s,v.MR=x,v.HR=I,v.XR=V,u&&(v.dR=M),v}function s(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;const Q=new h.e(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return a(J).zR(Q,J.updatable),Q}function x(R){const J=[],B=[],h=[],y=[],q=R.diameter||1,e=R.thickness||.5,D=0|(R.tessellation||16),l=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE,E=D+1;for(let N=0;N<=D;N++){const R=N/D,l=N*Math.PI*2/D-Math.PI/2,O=Q.Matrix.Translation(q/2,0,0).multiply(Q.Matrix.RotationY(l));for(let q=0;q<=D;q++){const l=1-q/D,n=q*Math.PI*2/D+Math.PI,P=Math.cos(n),A=Math.sin(n);let u=new Q.nJ(P,A,0),S=u.scale(e/2);const f=new Q.Vector2(R,l);S=Q.nJ.TransformCoordinates(S,O),u=Q.nJ.TransformNormal(u,O),B.push(S.x,S.y,S.z),h.push(u.x,u.y,u.z),y.push(f.x,r.c?1-f.y:f.y);const a=(N+1)%E,s=(q+1)%E;J.push(N*E+q),J.push(N*E+s),J.push(a*E+q),J.push(N*E+s),J.push(a*E+s),J.push(a*E+q)}}N.e._ComputeSides(l,B,J,h,y,R.frontUVs,R.backUVs);const O=new N.e;return O.indices=J,O.MR=B,O.HR=h,O.XR=y,O}function I(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;const Q=new h.e(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return x(J).zR(Q,J.updatable),Q}N.e.CreateCylinder=a,h.e.CreateCylinder=(R,J,B,Q,y,N,r,q,e)=>{void 0!==r&&r instanceof S.d||(void 0!==r&&(e=q||h.e.DEFAULTSIDE,q=r),r=N,N=1);return s(R,{height:J,diameterTop:B,diameterBottom:Q,tessellation:y,subdivisions:N,sideOrientation:e,updatable:q},r)};function V(R){const J=[],B=[],h=[],y=[],q=R.radius||2,e=R.tube||.5,D=R.radialSegments||32,l=R.tubularSegments||32,E=R.p||2,O=R.q||3,n=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE,P=R=>{const J=Math.cos(R),B=Math.sin(R),h=O/E*R,y=Math.cos(h),N=q*(2+y)*.5*J,r=q*(2+y)*B*.5,e=q*Math.sin(h)*.5;return new Q.nJ(N,r,e)};let A,u;for(A=0;A<=D;A++){const R=A%D/D*2*E*Math.PI,J=P(R),h=P(R+.01),N=h.PJ(J);let q=h.add(J);const O=Q.nJ.Cross(N,q);for(q=Q.nJ.Cross(O,N),O.normalize(),q.normalize(),u=0;u<l;u++){const R=u%l/l*2*Math.PI,Q=-e*Math.cos(R),h=e*Math.sin(R);B.push(J.x+Q*q.x+h*O.x),B.push(J.y+Q*q.y+h*O.y),B.push(J.z+Q*q.z+h*O.z),y.push(A/D),y.push(r.c?1-u/l:u/l)}}for(A=0;A<D;A++)for(u=0;u<l;u++){const R=(u+1)%l,B=A*l+u,Q=(A+1)*l+u,h=(A+1)*l+R,y=A*l+R;J.push(y),J.push(Q),J.push(B),J.push(y),J.push(h),J.push(Q)}N.e.ComputeNormals(B,J,h),N.e._ComputeSides(n,B,J,h,y,R.frontUVs,R.backUVs);const S=new N.e;return S.indices=J,S.MR=B,S.HR=h,S.XR=y,S}function M(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2?arguments[2]:void 0;const Q=new h.e(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return V(J).zR(Q,J.updatable),Q}N.e.CreateTorus=x,h.e.CreateTorus=(R,J,B,Q,h,y,N)=>I(R,{diameter:J,thickness:B,tessellation:Q,sideOrientation:N,updatable:y},h);N.e.CreateTorusKnot=V,h.e.CreateTorusKnot=(R,J,B,Q,h,y,N,r,q,e)=>M(R,{radius:J,tube:B,radialSegments:Q,tubularSegments:h,p:y,q:N,sideOrientation:e,updatable:q},r);var H=B(13076),d=B(11753),X=B(11392);function c(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=J.path,y=J.shape,N=J.scale||1,r=J.rotation||0,q=0===J.cap?0:J.cap||h.e.NO_CAP,e=J.updatable,D=h.e._GetDefaultSideOrientation(J.sideOrientation),l=J.instance||null,E=J.invertUV||!1,O=J.closeShape||!1,n=J.closePath||!1,P=J.capFunction||null;return p(R,y,Q,N,r,null,null,n,O,q,!1,B,!!e,D,l,E,J.frontUVs||null,J.backUVs||null,J.firstNormal||null,!!J.adjustFrame,P)}function z(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=J.path,y=J.shape,N=J.scaleFunction||(()=>1),r=J.rotationFunction||(()=>0),q=J.closePath||J.ribbonCloseArray||!1,e=J.closeShape||J.ribbonClosePath||!1,D=0===J.cap?0:J.cap||h.e.NO_CAP,l=J.updatable,E=J.firstNormal||null,O=J.adjustFrame||!1,n=h.e._GetDefaultSideOrientation(J.sideOrientation),P=J.instance,A=J.invertUV||!1,u=J.capFunction||null;return p(R,y,Q,null,null,N,r,q,e,D,!0,B,!!l,n,P||null,A,J.frontUVs||null,J.backUVs||null,E,O,u||null)}function p(R,J,B,y,N,r,q,D,l,E,O,n,P,A,u,S,f,a,s,x,I){const V=(R,J,B,y,N,r,q,e,D,l,E)=>{const O=B.getTangents(),n=B.getNormals(),P=B.getBinormals(),A=B.getDistances();if(E)for(let h=0;h<O.length;h++)if(0==O[h].x&&0==O[h].y&&0==O[h].z&&O[h].h(O[h-1]),0==n[h].x&&0==n[h].y&&0==n[h].z&&n[h].h(n[h-1]),0==P[h].x&&0==P[h].y&&0==P[h].z&&P[h].h(P[h-1]),h>0){let R=O[h-1];Q.nJ.Dot(R,O[h])<0&&O[h].scaleInPlace(-1),R=n[h-1],Q.nJ.Dot(R,n[h])<0&&n[h].scaleInPlace(-1),R=P[h-1],Q.nJ.Dot(R,P[h])<0&&P[h].scaleInPlace(-1)}let u=0;const S=l&&e?e:()=>null!==r?r:0,f=l&&q?q:()=>null!==N?N:1;let a=D===h.e.NO_CAP||D===h.e.CAP_END?0:2;const s=Q.TmpVectors.Matrix[0];for(let h=0;h<J.length;h++){const B=[],N=S(h,A[h]),r=f(h,A[h]);Q.Matrix.RotationAxisToRef(O[h],u,s);for(let y=0;y<R.length;y++){const N=O[h].scale(R[y].z).add(n[h].scale(R[y].x)).add(P[h].scale(R[y].y)),q=Q.nJ.Zero();Q.nJ.TransformCoordinatesToRef(N,s,q),q.scaleInPlace(r).addInPlace(J[h]),B[y]=q}y[a]=B,u+=N,a++}const x=I||(R=>{const J=Array(),B=Q.nJ.Zero();let h;for(h=0;h<R.length;h++)B.addInPlace(R[h]);for(B.scaleInPlace(1/R.length),h=0;h<R.length;h++)J.push(B);return J});switch(D){case h.e.NO_CAP:break;case h.e.CAP_START:y[0]=x(y[2]),y[1]=y[2];break;case h.e.CAP_END:y[a]=y[a-1],y[a+1]=x(y[a-1]);break;case h.e.CAP_ALL:y[0]=x(y[2]),y[1]=y[2],y[a]=y[a-1],y[a+1]=x(y[a-1])}return y};let M,H;if(u){const R=u._creationDataStorage;return M=s?R.path3D.update(B,s):R.path3D.update(B),H=V(J,B,R.path3D,R.pathArray,y,N,r,q,R.cap,O,x),u=e("",{pathArray:H,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:u},n||void 0)}M=s?new X.l(B,s):new X.l(B);H=V(J,B,M,new Array,y,N,r,q,E=E<0||E>3?0:E,O,x);const d=e(R,{pathArray:H,closeArray:D,closePath:l,updatable:P,sideOrientation:A,invertUV:S,frontUVs:f||void 0,backUVs:a||void 0},n);return d._creationDataStorage.pathArray=H,d._creationDataStorage.path3D=M,d._creationDataStorage.cap=E,d}function i(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=J.arc?J.arc<=0||J.arc>1?1:J.arc:1,N=void 0===J.closed||J.closed,r=J.shape,q=J.radius||1,D=J.tessellation||64,l=J.clip||0,E=J.updatable,O=h.e._GetDefaultSideOrientation(J.sideOrientation),n=J.cap||h.e.NO_CAP,P=2*Math.PI,A=[],u=J.invertUV||!1;let S=0,f=0;const a=P/D*y;let s,x;for(S=0;S<=D-l;S++){for(x=[],n!=h.e.CAP_START&&n!=h.e.CAP_ALL||(x.push(new Q.nJ(0,r[0].y,0)),x.push(new Q.nJ(Math.cos(S*a)*r[0].x*q,r[0].y,Math.sin(S*a)*r[0].x*q))),f=0;f<r.length;f++)s=new Q.nJ(Math.cos(S*a)*r[f].x*q,r[f].y,Math.sin(S*a)*r[f].x*q),x.push(s);n!=h.e.CAP_END&&n!=h.e.CAP_ALL||(x.push(new Q.nJ(Math.cos(S*a)*r[r.length-1].x*q,r[r.length-1].y,Math.sin(S*a)*r[r.length-1].x*q)),x.push(new Q.nJ(0,r[r.length-1].y,0))),A.push(x)}return e(R,{pathArray:A,closeArray:N,sideOrientation:O,updatable:E,invertUV:u,frontUVs:J.frontUVs,backUVs:J.backUVs},B)}h.e.ExtrudeShape=function(R,J,B,Q,y,N){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7?arguments[7]:void 0,e=arguments.length>8?arguments[8]:void 0,D=arguments.length>9?arguments[9]:void 0;return c(R,{shape:J,path:B,scale:Q,rotation:y,cap:0===N?0:N||h.e.NO_CAP,sideOrientation:e,instance:D,updatable:q},r)},h.e.ExtrudeShapeCustom=(R,J,B,Q,y,N,r,q,e,D,l,E)=>z(R,{shape:J,path:B,scaleFunction:Q,rotationFunction:y,ribbonCloseArray:N,ribbonClosePath:r,cap:0===q?0:q||h.e.NO_CAP,sideOrientation:l,instance:E,updatable:D},e);h.e.CreateLathe=(R,J,B,Q,h,y,N)=>i(R,{shape:J,radius:B,tessellation:Q,sideOrientation:N,updatable:y},h);var W=B(12463),k=B(12417);function Y(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=J.path;let N=J.instance,r=1;void 0!==J.radius?r=J.radius:N&&(r=N._creationDataStorage.radius);const q=J.tessellation||64,D=J.radiusFunction||null;let l=J.cap||h.e.NO_CAP;const E=J.invertUV||!1,O=J.updatable,n=h.e._GetDefaultSideOrientation(J.sideOrientation);J.arc=J.arc&&(J.arc<=0||J.arc>1)?1:J.arc||1;const P=(R,J,B,y,N,r,q,e)=>{const D=J.getTangents(),l=J.getNormals(),E=J.getDistances(),O=2*Math.PI/N*e,n=r||(()=>y);let P,A,u,S;const f=Q.TmpVectors.Matrix[0];let a=q===h.e.NO_CAP||q===h.e.CAP_END?0:2;for(let h=0;h<R.length;h++){A=n(h,E[h]),P=Array(),u=l[h];for(let J=0;J<N;J++)Q.Matrix.RotationAxisToRef(D[h],O*J,f),S=P[J]?P[J]:Q.nJ.Zero(),Q.nJ.TransformCoordinatesToRef(u,f,S),S.scaleInPlace(A).addInPlace(R[h]),P[J]=S;B[a]=P,a++}const s=(J,B)=>{const Q=Array();for(let h=0;h<J;h++)Q.push(R[B]);return Q};switch(q){case h.e.NO_CAP:break;case h.e.CAP_START:B[0]=s(N,0),B[1]=B[2].slice(0);break;case h.e.CAP_END:B[a]=B[a-1].slice(0),B[a+1]=s(N,R.length-1);break;case h.e.CAP_ALL:B[0]=s(N,0),B[1]=B[2].slice(0),B[a]=B[a-1].slice(0),B[a+1]=s(N,R.length-1)}return B};let A,u;if(N){const R=N._creationDataStorage,B=J.arc||R.arc;return A=R.path3D.update(y),u=P(y,A,R.pathArray,r,R.tessellation,D,R.cap,B),N=e("",{pathArray:u,instance:N}),R.path3D=A,R.pathArray=u,R.arc=B,R.radius=r,N}A=new X.l(y);l=l<0||l>3?0:l,u=P(y,A,new Array,r,q,D,l,J.arc);const S=e(R,{pathArray:u,closePath:!0,closeArray:!1,updatable:O,sideOrientation:n,invertUV:E,frontUVs:J.frontUVs,backUVs:J.backUVs},B);return S._creationDataStorage.pathArray=u,S._creationDataStorage.path3D=A,S._creationDataStorage.tessellation=q,S._creationDataStorage.cap=l,S._creationDataStorage.arc=J.arc,S._creationDataStorage.radius=r,S}function G(R){const J=[];J[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},J[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},J[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},J[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},J[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},J[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},J[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},J[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},J[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},J[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},J[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},J[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},J[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},J[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},J[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const B=R.type&&(R.type<0||R.type>=J.length)?0:R.type||0,h=R.size,y=R.sizeX||h||1,q=R.sizeY||h||1,e=R.sizeZ||h||1,D=R.custom||J[B],l=D.face.length,O=R.faceUV||new Array(l),n=R.faceColors,P=void 0===R.flat||R.flat,A=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE,u=[],S=[],f=[],a=[],s=[];let x=0,I=0;const V=[];let M,H,d,X,c,z,p=0,i=0;if(P)for(i=0;i<l;i++)n&&void 0===n[i]&&(n[i]=new E.ar(1,1,1,1)),O&&void 0===O[i]&&(O[i]=new Q.Vector4(0,0,1,1));if(P)for(i=0;i<l;i++){const R=D.face[i].length;for(d=2*Math.PI/R,X=.5*Math.tan(d/2),c=.5,p=0;p<R;p++)u.push(D.vertex[D.face[i][p]][0]*y,D.vertex[D.face[i][p]][1]*q,D.vertex[D.face[i][p]][2]*e),V.push(x),x++,M=O[i].x+(O[i].z-O[i].x)*(.5+X),H=O[i].y+(O[i].w-O[i].y)*(c-.5),a.push(M,r.c?1-H:H),z=X*Math.cos(d)-c*Math.sin(d),c=X*Math.sin(d)+c*Math.cos(d),X=z,n&&s.push(n[i].r,n[i].g,n[i].b,n[i].a);for(p=0;p<R-2;p++)S.push(V[0+I],V[p+2+I],V[p+1+I]);I+=R}else{for(p=0;p<D.vertex.length;p++)u.push(D.vertex[p][0]*y,D.vertex[p][1]*q,D.vertex[p][2]*e),a.push(0,r.c?1:0);for(i=0;i<l;i++)for(p=0;p<D.face[i].length-2;p++)S.push(D.face[i][0],D.face[i][p+2],D.face[i][p+1])}N.e.ComputeNormals(u,S,f),N.e._ComputeSides(A,u,S,f,a,R.frontUVs,R.backUVs);const W=new N.e;return W.MR=u,W.indices=S,W.HR=f,W.XR=a,n&&P&&(W.dR=s),W}function g(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new h.e(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return G(J).zR(Q,J.updatable),Q}h.e.CreateTube=(R,J,B,Q,h,y,N,r,q,e)=>Y(R,{path:J,radius:B,tessellation:Q,radiusFunction:h,arc:1,cap:y,updatable:r,sideOrientation:q,instance:e},N);function L(R){const J=R.sideOrientation||N.e.DEFAULTSIDE,B=R.radius||1,h=void 0===R.flat||R.flat,y=0|(R.subdivisions||4),q=R.radiusX||B,e=R.radiusY||B,D=R.radiusZ||B,l=(1+Math.sqrt(5))/2,E=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],O=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],n=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],P=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],A=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],u=[],S=[],f=[],a=[];let s=0;const x=new Array(3),I=new Array(3);let V;for(V=0;V<3;V++)x[V]=Q.nJ.Zero(),I[V]=Q.Vector2.Zero();for(let N=0;N<20;N++){for(V=0;V<3;V++){const R=O[3*N+V];x[V].Ar(E[3*n[R]],E[3*n[R]+1],E[3*n[R]+2]),x[V].normalize(),I[V].Ar(.134765625*P[2*R]+.05859375+-.0390625*A[N],.2333984375*P[2*R+1]+.025390625+.01953125*A[N])}const R=(R,J,B,N)=>{const l=Q.nJ.Lerp(x[0],x[2],J/y),E=Q.nJ.Lerp(x[1],x[2],J/y),O=y===J?x[2]:Q.nJ.Lerp(l,E,R/(y-J));let n;if(O.normalize(),h){const R=Q.nJ.Lerp(x[0],x[2],N/y),J=Q.nJ.Lerp(x[1],x[2],N/y);n=Q.nJ.Lerp(R,J,B/(y-N))}else n=new Q.nJ(O.x,O.y,O.z);n.x/=q,n.y/=e,n.z/=D,n.normalize();const P=Q.Vector2.Lerp(I[0],I[2],J/y),A=Q.Vector2.Lerp(I[1],I[2],J/y),V=y===J?I[2]:Q.Vector2.Lerp(P,A,R/(y-J));S.push(O.x*q,O.y*e,O.z*D),f.push(n.x,n.y,n.z),a.push(V.x,r.c?1-V.y:V.y),u.push(s),s++};for(let J=0;J<y;J++)for(let B=0;B+J<y;B++)R(B,J,B+1/3,J+1/3),R(B+1,J,B+1/3,J+1/3),R(B,J+1,B+1/3,J+1/3),B+J+1<y&&(R(B+1,J,B+2/3,J+2/3),R(B+1,J+1,B+2/3,J+2/3),R(B,J+1,B+2/3,J+2/3))}N.e._ComputeSides(J,S,u,f,a,R.frontUVs,R.backUVs);const M=new N.e;return M.indices=u,M.MR=S,M.HR=f,M.XR=a,M}function j(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new h.e(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),Q._originalBuilderSideOrientation=J.sideOrientation;return L(J).zR(Q,J.updatable),Q}N.e.CreatePolyhedron=G,h.e.CreatePolyhedron=(R,J,B)=>g(R,J,B);N.e.CreateIcoSphere=L,h.e.CreateIcoSphere=(R,J,B)=>j(R,J,B);var T=B(11201);const F=new Q.nJ(1,0,0),C=new Q.nJ(-1,0,0),b=new Q.nJ(0,1,0),w=new Q.nJ(0,-1,0),K=new Q.nJ(0,0,1),v=new Q.nJ(0,0,-1);class m{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.nJ.Zero(),J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q.nJ.Up(),B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.Vector2.Zero(),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=R,this.normal=J,this.uv=B,this.vertexIdx=h,this.vertexIdxForBones=y,this.localPositionOverride=N,this.localNormalOverride=r,this.matrixIndicesOverride=q,this.matrixWeightsOverride=e}clone(){var R,J,B,Q;return new m(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(R=this.localPositionOverride)||void 0===R?void 0:R.slice(),null===(J=this.localNormalOverride)||void 0===J?void 0:J.slice(),null===(B=this.matrixIndicesOverride)||void 0===B?void 0:B.slice(),null===(Q=this.matrixWeightsOverride)||void 0===Q?void 0:Q.slice())}}function o(R,J,B){var q,e,D,l,E;const O=!!J.skeleton,n=!(null===(q=J.morphTargetManager)||void 0===q||!q.numTargets),P=B.localMode||O,A=J.hr(),u=O||n?J.kr(!0,!0):J.getVerticesData(y.h.PositionKind),S=O||n?J.getNormalsData(!0,!0):J.getVerticesData(y.h.NormalKind),f=P?O?J.getVerticesData(y.h.PositionKind):u:null,a=P?O?J.getVerticesData(y.h.NormalKind):S:null,s=J.getVerticesData(y.h.UVKind),x=O?J.getVerticesData(y.h.MatricesIndicesKind):null,I=O?J.getVerticesData(y.h.MatricesWeightsKind):null,V=O?J.getVerticesData(y.h.MatricesIndicesExtraKind):null,M=O?J.getVerticesData(y.h.MatricesWeightsExtraKind):null,H=B.position||Q.nJ.Zero();let d=B.normal||Q.nJ.Up();const X=B.size||Q.nJ.One(),c=B.angle||0;if(!d){const R=new Q.nJ(0,0,1),B=J.IR().activeCamera,h=Q.nJ.TransformCoordinates(R,B.getWorldMatrix());d=B.globalPosition.PJ(h)}const z=-Math.atan2(d.z,d.x)-Math.PI/2,p=Math.sqrt(d.x*d.x+d.z*d.z),i=Math.atan2(d.y,p),W=new N.e;W.indices=[],W.MR=[],W.HR=[],W.XR=[],W.matricesIndices=O?[]:null,W.matricesWeights=O?[]:null,W.matricesIndicesExtra=V?[]:null,W.matricesWeightsExtra=M?[]:null;let k=0;const Y=(R,J)=>{const h=new m;if(!A||!u||!S)return h;const y=A[R];if(h.vertexIdx=3*y,h.vertexIdxForBones=4*y,h.position=new Q.nJ(u[3*y],u[3*y+1],u[3*y+2]),Q.nJ.TransformCoordinatesToRef(h.position,J,h.position),h.normal=new Q.nJ(S[3*y],S[3*y+1],S[3*y+2]),Q.nJ.TransformNormalToRef(h.normal,J,h.normal),B.captureUVS&&s){const R=s[2*y+1];h.uv=new Q.Vector2(s[2*y],r.c?1-R:R)}return h},G=[0,0,0,0],g=(R,J)=>{if(0===R.length)return R;const B=.5*Math.abs(Q.nJ.Dot(X,J)),h=(R,J,B,Q)=>{for(let h=0;h<Q;++h)if(R[B+h]===J)return B+h;return-1},y=(R,y)=>{const N=Q.nJ.GetClipFactor(R.position,y.position,J,B);let r=G,q=G;if(x&&I){const J=R.matrixIndicesOverride?0:R.vertexIdxForBones,B=R.matrixIndicesOverride??x,Q=R.matrixWeightsOverride??I,e=y.matrixIndicesOverride?0:y.vertexIdxForBones,D=y.matrixIndicesOverride??x,l=y.matrixWeightsOverride??I;r=[0,0,0,0],q=[0,0,0,0];let E=0;for(let R=0;R<4;++R)if(Q[J+R]>0){const y=h(D,B[J+R],e,4);r[E]=B[J+R],q[E]=(0,T.Lerp)(Q[J+R],y>=0?l[y]:0,N),E++}for(let R=0;R<4&&E<4;++R){const Q=D[e+R];-1===h(B,Q,J,4)&&(r[E]=Q,q[E]=(0,T.Lerp)(0,l[e+R],N),E++)}const O=q[0]+q[1]+q[2]+q[3];q[0]/=O,q[1]/=O,q[2]/=O,q[3]/=O}const e=R.localPositionOverride?R.localPositionOverride[0]:(null===f||void 0===f?void 0:f[R.vertexIdx])??0,D=R.localPositionOverride?R.localPositionOverride[1]:(null===f||void 0===f?void 0:f[R.vertexIdx+1])??0,l=R.localPositionOverride?R.localPositionOverride[2]:(null===f||void 0===f?void 0:f[R.vertexIdx+2])??0,E=y.localPositionOverride?y.localPositionOverride[0]:(null===f||void 0===f?void 0:f[y.vertexIdx])??0,O=y.localPositionOverride?y.localPositionOverride[1]:(null===f||void 0===f?void 0:f[y.vertexIdx+1])??0,n=y.localPositionOverride?y.localPositionOverride[2]:(null===f||void 0===f?void 0:f[y.vertexIdx+2])??0,P=R.localNormalOverride?R.localNormalOverride[0]:(null===a||void 0===a?void 0:a[R.vertexIdx])??0,A=R.localNormalOverride?R.localNormalOverride[1]:(null===a||void 0===a?void 0:a[R.vertexIdx+1])??0,u=R.localNormalOverride?R.localNormalOverride[2]:(null===a||void 0===a?void 0:a[R.vertexIdx+2])??0,S=P+((y.localNormalOverride?y.localNormalOverride[0]:(null===a||void 0===a?void 0:a[y.vertexIdx])??0)-P)*N,s=A+((y.localNormalOverride?y.localNormalOverride[1]:(null===a||void 0===a?void 0:a[y.vertexIdx+1])??0)-A)*N,V=u+((y.localNormalOverride?y.localNormalOverride[2]:(null===a||void 0===a?void 0:a[y.vertexIdx+2])??0)-u)*N,M=Math.sqrt(S*S+s*s+V*V);return new m(Q.nJ.Lerp(R.position,y.position,N),Q.nJ.Lerp(R.normal,y.normal,N).normalize(),Q.Vector2.Lerp(R.uv,y.uv,N),-1,-1,f?[e+(E-e)*N,D+(O-D)*N,l+(n-l)*N]:null,a?[S/M,s/M,V/M]:null,r,q)};let N=null;R.length>3&&(N=[]);for(let r=0;r<R.length;r+=3){let h=0,q=null,e=null,D=null,l=null;const E=Q.nJ.Dot(R[r].position,J)-B>0,O=Q.nJ.Dot(R[r+1].position,J)-B>0,n=Q.nJ.Dot(R[r+2].position,J)-B>0;switch(h=(E?1:0)+(O?1:0)+(n?1:0),h){case 0:R.length>3?(N.push(R[r]),N.push(R[r+1]),N.push(R[r+2])):N=R;break;case 1:if(N=N??new Array,E&&(q=R[r+1],e=R[r+2],D=y(R[r],q),l=y(R[r],e)),O){q=R[r],e=R[r+2],D=y(R[r+1],q),l=y(R[r+1],e),N.push(D),N.push(e.clone()),N.push(q.clone()),N.push(e.clone()),N.push(D.clone()),N.push(l);break}n&&(q=R[r],e=R[r+1],D=y(R[r+2],q),l=y(R[r+2],e)),q&&e&&D&&l&&(N.push(q.clone()),N.push(e.clone()),N.push(D),N.push(l),N.push(D.clone()),N.push(e.clone()));break;case 2:N=N??new Array,E||(q=R[r].clone(),e=y(q,R[r+1]),D=y(q,R[r+2]),N.push(q),N.push(e),N.push(D)),O||(q=R[r+1].clone(),e=y(q,R[r+2]),D=y(q,R[r]),N.push(q),N.push(e),N.push(D)),n||(q=R[r+2].clone(),e=y(q,R[r]),D=y(q,R[r+1]),N.push(q),N.push(e),N.push(D))}}return N},L=J instanceof h.e?J:null,j=null===L||void 0===L?void 0:L._thinInstanceDataStorage.matrixData,o=(null===L||void 0===L?void 0:L.Ir)||1,t=Q.TmpVectors.Matrix[0];t.h(Q.Matrix.IdentityReadOnly);for(let h=0;h<o;++h){if(null!==L&&void 0!==L&&L.hasThinInstances&&j){const R=16*h;t.setRowFromFloats(0,j[R+0],j[R+1],j[R+2],j[R+3]),t.setRowFromFloats(1,j[R+4],j[R+5],j[R+6],j[R+7]),t.setRowFromFloats(2,j[R+8],j[R+9],j[R+10],j[R+11]),t.setRowFromFloats(3,j[R+12],j[R+13],j[R+14],j[R+15])}const R=Q.Matrix.RotationYawPitchRoll(z,i,c).multiply(Q.Matrix.Translation(H.x,H.y,H.z)),y=Q.Matrix.Invert(R),N=J.getWorldMatrix(),q=t.multiply(N).multiply(y),e=new Array(3);for(let J=0;J<A.length;J+=3){let R=e;if(R[0]=Y(J,q),R[1]=Y(J+1,q),R[2]=Y(J+2,q),!(B.cullBackFaces&&-R[0].normal.z<=0&&-R[1].normal.z<=0&&-R[2].normal.z<=0)&&(R=g(R,F),R&&(R=g(R,C),R&&(R=g(R,b),R&&(R=g(R,w),R&&(R=g(R,K),R&&(R=g(R,v),R)))))))for(let J=0;J<R.length;J++){const Q=R[J];if(W.indices.push(k),P?(Q.localPositionOverride?(W.MR[3*k]=Q.localPositionOverride[0],W.MR[3*k+1]=Q.localPositionOverride[1],W.MR[3*k+2]=Q.localPositionOverride[2]):f&&(W.MR[3*k]=f[Q.vertexIdx],W.MR[3*k+1]=f[Q.vertexIdx+1],W.MR[3*k+2]=f[Q.vertexIdx+2]),Q.localNormalOverride?(W.HR[3*k]=Q.localNormalOverride[0],W.HR[3*k+1]=Q.localNormalOverride[1],W.HR[3*k+2]=Q.localNormalOverride[2]):a&&(W.HR[3*k]=a[Q.vertexIdx],W.HR[3*k+1]=a[Q.vertexIdx+1],W.HR[3*k+2]=a[Q.vertexIdx+2])):(Q.position.toArray(W.MR,3*k),Q.normal.toArray(W.HR,3*k)),W.matricesIndices&&W.matricesWeights&&(Q.matrixIndicesOverride?(W.matricesIndices[4*k]=Q.matrixIndicesOverride[0],W.matricesIndices[4*k+1]=Q.matrixIndicesOverride[1],W.matricesIndices[4*k+2]=Q.matrixIndicesOverride[2],W.matricesIndices[4*k+3]=Q.matrixIndicesOverride[3]):(x&&(W.matricesIndices[4*k]=x[Q.vertexIdxForBones],W.matricesIndices[4*k+1]=x[Q.vertexIdxForBones+1],W.matricesIndices[4*k+2]=x[Q.vertexIdxForBones+2],W.matricesIndices[4*k+3]=x[Q.vertexIdxForBones+3]),V&&W.matricesIndicesExtra&&(W.matricesIndicesExtra[4*k]=V[Q.vertexIdxForBones],W.matricesIndicesExtra[4*k+1]=V[Q.vertexIdxForBones+1],W.matricesIndicesExtra[4*k+2]=V[Q.vertexIdxForBones+2],W.matricesIndicesExtra[4*k+3]=V[Q.vertexIdxForBones+3])),Q.matrixWeightsOverride?(W.matricesWeights[4*k]=Q.matrixWeightsOverride[0],W.matricesWeights[4*k+1]=Q.matrixWeightsOverride[1],W.matricesWeights[4*k+2]=Q.matrixWeightsOverride[2],W.matricesWeights[4*k+3]=Q.matrixWeightsOverride[3]):(I&&(W.matricesWeights[4*k]=I[Q.vertexIdxForBones],W.matricesWeights[4*k+1]=I[Q.vertexIdxForBones+1],W.matricesWeights[4*k+2]=I[Q.vertexIdxForBones+2],W.matricesWeights[4*k+3]=I[Q.vertexIdxForBones+3]),M&&W.matricesWeightsExtra&&(W.matricesWeightsExtra[4*k]=M[Q.vertexIdxForBones],W.matricesWeightsExtra[4*k+1]=M[Q.vertexIdxForBones+1],W.matricesWeightsExtra[4*k+2]=M[Q.vertexIdxForBones+2],W.matricesWeightsExtra[4*k+3]=M[Q.vertexIdxForBones+3]))),B.captureUVS)Q.uv.toArray(W.XR,2*k);else{W.XR.push(.5+Q.position.x/X.x);const R=.5+Q.position.y/X.y;W.XR.push(r.c?1-R:R)}k++}}}0===W.indices.length&&(W.indices=null),0===W.MR.length&&(W.MR=null),0===W.HR.length&&(W.HR=null),0===W.XR.length&&(W.XR=null),0===(null===(e=W.matricesIndices)||void 0===e?void 0:e.length)&&(W.matricesIndices=null),0===(null===(D=W.matricesWeights)||void 0===D?void 0:D.length)&&(W.matricesWeights=null),0===(null===(l=W.matricesIndicesExtra)||void 0===l?void 0:l.length)&&(W.matricesIndicesExtra=null),0===(null===(E=W.matricesWeightsExtra)||void 0===E?void 0:E.length)&&(W.matricesWeightsExtra=null);const Z=new h.e(R,J.IR());return W.zR(Z),P?(Z.skeleton=J.skeleton,Z.parent=J):(Z.position=H.clone(),Z.rotation=new Q.nJ(i,z,c)),Z.ny(!0),Z.refreshBoundingInfo(!0,!0),Z}function t(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const J=0|Math.max(R.subdivisions?R.subdivisions:2,1),B=0|Math.max(R.tessellation?R.tessellation:16,3),h=Math.max(R.height?R.height:1,0),y=Math.max(R.radius?R.radius:.25,0),q=0|Math.max(R.capSubdivisions?R.capSubdivisions:6,1),e=B,D=J,l=Math.max(R.radiusTop?R.radiusTop:y,0),E=Math.max(R.radiusBottom?R.radiusBottom:y,0),O=h-(l+E),n=2*Math.PI,P=Math.max(R.topCapSubdivisions?R.topCapSubdivisions:q,1),A=Math.max(R.bottomCapSubdivisions?R.bottomCapSubdivisions:q,1),u=Math.acos((E-l)/h);let S=[];const f=[],a=[],s=[];let x=0;const I=[],V=.5*O,M=.5*Math.PI;let H,d;const X=Q.nJ.Zero(),c=Q.nJ.Zero(),z=Math.cos(u),p=Math.sin(u),i=new Q.Vector2(l*p,V+l*z).PJ(new Q.Vector2(E*p,E*z-V)).length(),W=l*u+i+E*(M-u);let k=0;for(d=0;d<=P;d++){const R=[],J=M-u*(d/P);k+=l*u/P;const B=Math.cos(J),Q=Math.sin(J),h=B*l;for(H=0;H<=e;H++){const J=H/e,y=J*n+0,N=Math.sin(y),q=Math.cos(y);c.x=h*N,c.y=V+Q*l,c.z=h*q,f.push(c.x,c.y,c.z),X.set(B*N,Q,B*q),a.push(X.x,X.y,X.z),s.push(J,r.c?k/W:1-k/W),R.push(x),x++}I.push(R)}const Y=h-l-E+z*l-z*E,G=p*(E-l)/Y;for(d=1;d<=D;d++){const R=[];k+=i/D;const J=p*(d*(E-l)/D+l);for(H=0;H<=e;H++){const B=H/e,Q=B*n+0,h=Math.sin(Q),y=Math.cos(Q);c.x=J*h,c.y=V+z*l-d*Y/D,c.z=J*y,f.push(c.x,c.y,c.z),X.set(h,G,y).normalize(),a.push(X.x,X.y,X.z),s.push(B,r.c?k/W:1-k/W),R.push(x),x++}I.push(R)}for(d=1;d<=A;d++){const R=[],J=M-u-(Math.PI-u)*(d/A);k+=E*u/A;const B=Math.cos(J),Q=Math.sin(J),h=B*E;for(H=0;H<=e;H++){const J=H/e,y=J*n+0,N=Math.sin(y),q=Math.cos(y);c.x=h*N,c.y=Q*E-V,c.z=h*q,f.push(c.x,c.y,c.z),X.set(B*N,Q,B*q),a.push(X.x,X.y,X.z),s.push(J,r.c?k/W:1-k/W),R.push(x),x++}I.push(R)}for(H=0;H<e;H++)for(d=0;d<P+D+A;d++){const R=I[d][H],J=I[d+1][H],B=I[d+1][H+1],Q=I[d][H+1];S.push(R),S.push(J),S.push(Q),S.push(J),S.push(B),S.push(Q)}if(S=S.reverse(),R.orientation&&!R.orientation.equals(Q.nJ.Up())){const J=new Q.Matrix;R.orientation.clone().scale(.5*Math.PI).cross(Q.nJ.Up()).toQuaternion().toRotationMatrix(J);const B=Q.nJ.Zero();for(let R=0;R<f.length;R+=3)B.set(f[R],f[R+1],f[R+2]),Q.nJ.TransformCoordinatesToRef(B.clone(),J,B),f[R]=B.x,f[R+1]=B.y,f[R+2]=B.z}const g=new N.e;return g.MR=f,g.HR=a,g.XR=s,g.indices=S,g}function Z(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:Q.nJ.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new h.e(R,B);return t(J).zR(y,J.updatable),y}h.e.CreateDecal=(R,J,B,Q,h,y)=>o(R,J,{position:B,normal:Q,size:h,angle:y});h.e.CreateCapsule=(R,J,B)=>Z(R,J,B),N.e.CreateCapsule=t;var U=B(11043),RR=B(11189);class JR{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=R,this.y=J,R!==Math.floor(R)&&(R=Math.floor(R),U.d.Warn("x is not an integer, floor(x) used")),J!==Math.floor(J)&&(J=Math.floor(J),U.d.Warn("y is not an integer, floor(y) used"))}clone(){return new JR(this.x,this.y)}rotate60About(R){const J=this.x;return this.x=R.x+R.y-this.y,this.y=J+this.y-R.x,this}rotateNeg60About(R){const J=this.x;return this.x=J+this.y-R.y,this.y=R.x+R.y-J,this}rotate120(R,J){R!==Math.floor(R)&&(R=Math.floor(R),U.d.Warn("m not an integer only floor(m) used")),J!==Math.floor(J)&&(J=Math.floor(J),U.d.Warn("n not an integer only floor(n) used"));const B=this.x;return this.x=R-B-this.y,this.y=J+B,this}rotateNeg120(R,J){R!==Math.floor(R)&&(R=Math.floor(R),U.d.Warn("m is not an integer, floor(m) used")),J!==Math.floor(J)&&(J=Math.floor(J),U.d.Warn("n is not an integer,   floor(n) used"));const B=this.x;return this.x=this.y-J,this.y=R+J-B-this.y,this}toCartesianOrigin(R,J){const B=Q.nJ.Zero();return B.x=R.x+2*this.x*J+this.y*J,B.y=R.y+Math.sqrt(3)*this.y*J,B}static Zero(){return new JR(0,0)}}class BR{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new QR("icosahedron","Regular",[[0,RR.e,-1],[-RR.e,1,0],[-1,0,-RR.e],[1,0,-RR.e],[RR.e,1,0],[0,RR.e,1],[-1,0,RR.e],[-RR.e,-1,0],[0,-RR.e,-1],[RR.e,-1,0],[1,0,RR.e],[0,-RR.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let R=12;const J={},B=this.m,Q=this.n;let h,y,N,r,q,e=B,D=1,l=0;0!==Q&&(e=(0,T.HighestCommonFactor)(B,Q)),D=B/e,l=Q/e;const E=JR.Zero(),O=new JR(B,Q),n=new JR(-Q,B+Q),P=JR.Zero(),A=JR.Zero(),u=JR.Zero();let S,f,a,s,x=[];const I=[],V=this.vertByDist,M=(B,Q,h,y)=>{S=B+"|"+h,f=Q+"|"+y,S in J||f in J?S in J&&!(f in J)?J[f]=J[S]:f in J&&!(S in J)&&(J[S]=J[f]):(J[S]=R,J[f]=R,R++),V[h][0]>2?I[J[S]]=[-V[h][0],V[h][1],J[S]]:I[J[S]]=[x[V[h][0]],V[h][1],J[S]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let H=0;H<20;H++){if(x=this.IDATA.face[H],N=x[2],r=x[1],q=x[0],a=E.x+"|"+E.y,S=H+"|"+a,S in J||(J[S]=N,I[N]=[x[V[a][0]],V[a][1]]),a=O.x+"|"+O.y,S=H+"|"+a,S in J||(J[S]=r,I[r]=[x[V[a][0]],V[a][1]]),a=n.x+"|"+n.y,S=H+"|"+a,S in J||(J[S]=q,I[q]=[x[V[a][0]],V[a][1]]),h=this.IDATA.edgematch[H][0],y=this.IDATA.edgematch[H][1],"B"===y)for(let R=1;R<e;R++)A.x=B-R*(D+l),A.y=Q+R*D,u.x=-R*l,u.y=R*(D+l),a=A.x+"|"+A.y,s=u.x+"|"+u.y,M(H,h,a,s);if("O"===y)for(let R=1;R<e;R++)u.x=-R*l,u.y=R*(D+l),P.x=R*D,P.y=R*l,a=u.x+"|"+u.y,s=P.x+"|"+P.y,M(H,h,a,s);if(h=this.IDATA.edgematch[H][2],y=this.IDATA.edgematch[H][3],y&&"A"===y)for(let R=1;R<e;R++)P.x=R*D,P.y=R*l,A.x=B-(e-R)*(D+l),A.y=Q+(e-R)*D,a=P.x+"|"+P.y,s=A.x+"|"+A.y,M(H,h,a,s);for(let B=0;B<this.vertices.length;B++)a=this.vertices[B].x+"|"+this.vertices[B].y,S=H+"|"+a,S in J||(J[S]=R++,V[a][0]>2?I[J[S]]=[-V[a][0],V[a][1],J[S]]:I[J[S]]=[x[V[a][0]],V[a][1],J[S]])}this.closestTo=I,this.vecToidx=J}calcCoeffs(){const R=this.m,J=this.n,B=Math.sqrt(3)/3,Q=R*R+J*J+R*J;this.coau=(R+J)/Q,this.cobu=-J/Q,this.coav=-B*(R-J)/Q,this.cobv=B*(2*R+J)/Q}createInnerFacets(){const R=this.m,J=this.n;for(let B=0;B<J+R+1;B++)for(let R=this.min[B];R<this.max[B]+1;R++)R<this.max[B]&&R<this.max[B+1]+1&&this.innerFacets.push(["|"+R+"|"+B,"|"+R+"|"+(B+1),"|"+(R+1)+"|"+B]),B>0&&R<this.max[B-1]&&R+1<this.max[B]+1&&this.innerFacets.push(["|"+R+"|"+B,"|"+(R+1)+"|"+B,"|"+(R+1)+"|"+(B-1)])}edgeVecsABOB(){const R=this.m,J=this.n,B=new JR(-J,R+J);for(let Q=1;Q<R+J;Q++){const R=new JR(this.min[Q],Q),J=new JR(this.min[Q-1],Q-1),h=new JR(this.min[Q+1],Q+1),y=R.clone(),N=J.clone(),r=h.clone();y.rotate60About(B),N.rotate60About(B),r.rotate60About(B);const q=new JR(this.max[y.y],y.y),e=new JR(this.max[y.y-1],y.y-1),D=new JR(this.max[y.y-1]-1,y.y-1);y.x===q.x&&y.y===q.y||(y.x!==e.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,e,D]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,D,q])):y.y===r.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([R,J,e]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([R,e,h])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([R,J,e]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,e,q])))}}mapABOBtoOBOA(){const R=new JR(0,0);for(let J=0;J<this.isoVecsABOB.length;J++){const B=[];for(let Q=0;Q<3;Q++)R.x=this.isoVecsABOB[J][Q].x,R.y=this.isoVecsABOB[J][Q].y,0===this.vertexTypes[J][Q]&&R.rotateNeg120(this.m,this.n),B.push(R.clone());this.isoVecsOBOA.push(B)}}mapABOBtoBAOA(){const R=new JR(0,0);for(let J=0;J<this.isoVecsABOB.length;J++){const B=[];for(let Q=0;Q<3;Q++)R.x=this.isoVecsABOB[J][Q].x,R.y=this.isoVecsABOB[J][Q].y,1===this.vertexTypes[J][Q]&&R.rotate120(this.m,this.n),B.push(R.clone());this.isoVecsBAOA.push(B)}}MapToFace(R,J){const B=this.IDATA.face[R],h=B[2],y=B[1],N=B[0],r=Q.nJ.fJ(this.IDATA.vertex[h]),q=Q.nJ.fJ(this.IDATA.vertex[y]),e=Q.nJ.fJ(this.IDATA.vertex[N]),D=q.PJ(r),l=e.PJ(r),E=D.scale(this.coau).add(l.scale(this.cobu)),O=D.scale(this.coav).add(l.scale(this.cobv)),n=[];let P,A=Q.TmpVectors.nJ[0];for(let Q=0;Q<this.cartesian.length;Q++)A=E.scale(this.cartesian[Q].x).add(O.scale(this.cartesian[Q].y)).add(r),n[Q]=[A.x,A.y,A.z],P=R+"|"+this.vertices[Q].x+"|"+this.vertices[Q].y,J.vertex[this.vecToidx[P]]=[A.x,A.y,A.z]}build(R,J){const B=[],Q=JR.Zero(),h=new JR(R,J),y=new JR(-J,R+J);B.push(Q,h,y);for(let a=J;a<R+1;a++)for(let J=0;J<R+1-a;J++)B.push(new JR(J,a));if(J>0){const Q=(0,T.HighestCommonFactor)(R,J),h=R/Q,y=J/Q;for(let r=1;r<Q;r++)B.push(new JR(r*h,r*y)),B.push(new JR(-r*y,r*(h+y))),B.push(new JR(R-r*(h+y),J+r*h));const N=R/J;for(let r=1;r<J;r++)for(let Q=0;Q<r*N;Q++)B.push(new JR(Q,r)),B.push(new JR(Q,r).rotate120(R,J)),B.push(new JR(Q,r).rotateNeg120(R,J))}B.sort(((R,J)=>R.x-J.x)),B.sort(((R,J)=>R.y-J.y));const N=new Array(R+J+1),r=new Array(R+J+1);for(let a=0;a<N.length;a++)N[a]=1/0,r[a]=-1/0;let q=0,e=0;const D=B.length;for(let a=0;a<D;a++)e=B[a].x,q=B[a].y,N[q]=Math.min(e,N[q]),r[q]=Math.max(e,r[q]);const l=(B,Q)=>{const h=B.clone();return"A"===Q&&h.rotateNeg120(R,J),"B"===Q&&h.rotate120(R,J),h.x<0?h.y:h.x+h.y},E=[],O=[],n=[],P=[],A={},u=[];let S=-1,f=-1;for(let a=0;a<D;a++)E[a]=B[a].toCartesianOrigin(new JR(0,0),.5),O[a]=l(B[a],"O"),n[a]=l(B[a],"A"),P[a]=l(B[a],"B"),O[a]===n[a]&&n[a]===P[a]?(S=3,f=O[a]):O[a]===n[a]?(S=4,f=O[a]):n[a]===P[a]?(S=5,f=n[a]):P[a]===O[a]&&(S=6,f=O[a]),O[a]<n[a]&&O[a]<P[a]&&(S=2,f=O[a]),n[a]<O[a]&&n[a]<P[a]&&(S=1,f=n[a]),P[a]<n[a]&&P[a]<O[a]&&(S=0,f=P[a]),u.push([S,f,B[a].x,B[a].y]);u.sort(((R,J)=>R[2]-J[2])),u.sort(((R,J)=>R[3]-J[3])),u.sort(((R,J)=>R[1]-J[1])),u.sort(((R,J)=>R[0]-J[0]));for(let a=0;a<u.length;a++)A[u[a][2]+"|"+u[a][3]]=[u[a][0],u[a][1],a];return this.m=R,this.n=J,this.vertices=B,this.vertByDist=A,this.cartesian=E,this.min=N,this.max=r,this}}class QR{constructor(R,J,B,Q){this.name=R,this.category=J,this.vertex=B,this.face=Q}}class hR extends QR{innerToData(R,J){for(let B=0;B<J.innerFacets.length;B++)this.face.push(J.innerFacets[B].map((B=>J.vecToidx[R+B])))}mapABOBtoDATA(R,J){const B=J.IDATA.edgematch[R][0];for(let Q=0;Q<J.isoVecsABOB.length;Q++){const h=[];for(let y=0;y<3;y++)0===J.vertexTypes[Q][y]?h.push(R+"|"+J.isoVecsABOB[Q][y].x+"|"+J.isoVecsABOB[Q][y].y):h.push(B+"|"+J.isoVecsABOB[Q][y].x+"|"+J.isoVecsABOB[Q][y].y);this.face.push([J.vecToidx[h[0]],J.vecToidx[h[1]],J.vecToidx[h[2]]])}}mapOBOAtoDATA(R,J){const B=J.IDATA.edgematch[R][0];for(let Q=0;Q<J.isoVecsOBOA.length;Q++){const h=[];for(let y=0;y<3;y++)1===J.vertexTypes[Q][y]?h.push(R+"|"+J.isoVecsOBOA[Q][y].x+"|"+J.isoVecsOBOA[Q][y].y):h.push(B+"|"+J.isoVecsOBOA[Q][y].x+"|"+J.isoVecsOBOA[Q][y].y);this.face.push([J.vecToidx[h[0]],J.vecToidx[h[1]],J.vecToidx[h[2]]])}}mapBAOAtoDATA(R,J){const B=J.IDATA.edgematch[R][2];for(let Q=0;Q<J.isoVecsBAOA.length;Q++){const h=[];for(let y=0;y<3;y++)1===J.vertexTypes[Q][y]?h.push(R+"|"+J.isoVecsBAOA[Q][y].x+"|"+J.isoVecsBAOA[Q][y].y):h.push(B+"|"+J.isoVecsBAOA[Q][y].x+"|"+J.isoVecsBAOA[Q][y].y);this.face.push([J.vecToidx[h[0]],J.vecToidx[h[1]],J.vecToidx[h[2]]])}}orderData(R){const J=[];for(let y=0;y<13;y++)J[y]=[];const B=R.closestTo;for(let y=0;y<B.length;y++)B[y][0]>-1?B[y][1]>0&&J[B[y][0]].push([y,B[y][1]]):J[12].push([y,B[y][0]]);const Q=[];for(let y=0;y<12;y++)Q[y]=y;let h=12;for(let y=0;y<12;y++){J[y].sort(((R,J)=>R[1]-J[1]));for(let R=0;R<J[y].length;R++)Q[J[y][R][0]]=h++}for(let y=0;y<J[12].length;y++)Q[J[12][y][0]]=h++;for(let y=0;y<this.vertex.length;y++)this.vertex[y].push(Q[y]);this.vertex.sort(((R,J)=>R[3]-J[3]));for(let y=0;y<this.vertex.length;y++)this.vertex[y].pop();for(let y=0;y<this.face.length;y++)for(let R=0;R<this.face[y].length;R++)this.face[y][R]=Q[this.face[y][R]];this.sharedNodes=J[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(R,J){const B=[],Q=[];let h=J.pop();Q.push(h);let y=this.face[h].indexOf(R);y=(y+2)%3;let N=this.face[h][y];B.push(N);let r=0;for(;J.length>0;)h=J[r],this.face[h].indexOf(N)>-1?(y=(this.face[h].indexOf(N)+1)%3,N=this.face[h][y],B.push(N),Q.push(h),J.splice(r,1),r=0):r++;return this.adjacentFaces.push(B),Q}toGoldbergPolyhedronData(){const R=new QR("GeoDual","Goldberg",[],[]);R.name="GD dual";const J=this.vertex.length,B=new Array(J);for(let q=0;q<J;q++)B[q]=[];for(let q=0;q<this.face.length;q++)for(let R=0;R<3;R++)B[this.face[q][R]].push(q);let Q=0,h=0,y=0,N=[],r=[];this.adjacentFaces=[];for(let q=0;q<B.length;q++){R.face[q]=this.setOrder(q,B[q].concat([]));for(const J of B[q]){Q=0,h=0,y=0,N=this.face[J];for(let R=0;R<3;R++)r=this.vertex[N[R]],Q+=r[0],h+=r[1],y+=r[2];R.vertex[J]=[Q/3,h/3,y/3]}}return R}static BuildGeodesicData(R){const J=new hR("Geodesic-m-n","Geodesic",[[0,RR.e,-1],[-RR.e,1,0],[-1,0,-RR.e],[1,0,-RR.e],[RR.e,1,0],[0,RR.e,1],[-1,0,RR.e],[-RR.e,-1,0],[0,-RR.e,-1],[RR.e,-1,0],[1,0,RR.e],[0,-RR.e,1]],[]);R.setIndices(),R.calcCoeffs(),R.createInnerFacets(),R.edgeVecsABOB(),R.mapABOBtoOBOA(),R.mapABOBtoBAOA();for(let B=0;B<R.IDATA.face.length;B++)R.MapToFace(B,J),J.innerToData(B,R),"B"===R.IDATA.edgematch[B][1]&&J.mapABOBtoDATA(B,R),"O"===R.IDATA.edgematch[B][1]&&J.mapOBOAtoDATA(B,R),"A"===R.IDATA.edgematch[B][3]&&J.mapBAOAtoDATA(B,R);J.orderData(R);return J.vertex=J.vertex.map((function(R){const J=R[0],B=R[1],Q=R[2],h=Math.sqrt(J*J+B*B+Q*Q);return R[0]*=1/h,R[1]*=1/h,R[2]*=1/h,R})),J}}h.e._GoldbergMeshParser=(R,J)=>yR.Parse(R,J);class yR extends h.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(R,J){return void 0===J?(R>this.goldbergData.nbUnsharedFaces-1&&(U.d.Warn("Maximum number of unshared faces used"),R=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+R):(R>11&&(U.d.Warn("Last pole used"),R=11),J>this.goldbergData.nbFacesAtPole-1&&(U.d.Warn("Maximum number of faces at a pole used"),J=this.goldbergData.nbFacesAtPole-1),12+R*this.goldbergData.nbFacesAtPole+J)}_changeGoldbergFaceColors(R){for(let B=0;B<R.length;B++){const J=R[B][0],Q=R[B][1],h=R[B][2];for(let R=J;R<Q+1;R++)this.goldbergData.faceColors[R]=h}const J=[];for(let B=0;B<12;B++)for(let R=0;R<5;R++)J.push(this.goldbergData.faceColors[B].r,this.goldbergData.faceColors[B].g,this.goldbergData.faceColors[B].b,this.goldbergData.faceColors[B].a);for(let B=12;B<this.goldbergData.faceColors.length;B++)for(let R=0;R<6;R++)J.push(this.goldbergData.faceColors[B].r,this.goldbergData.faceColors[B].g,this.goldbergData.faceColors[B].b,this.goldbergData.faceColors[B].a);return J}setGoldbergFaceColors(R){const J=this._changeGoldbergFaceColors(R);this.kR(y.h.ColorKind,J)}updateGoldbergFaceColors(R){const J=this._changeGoldbergFaceColors(R);this.updateVerticesData(y.h.ColorKind,J)}_changeGoldbergFaceUVs(R){const J=this.getVerticesData(y.h.UVKind);for(let B=0;B<R.length;B++){const Q=R[B][0],h=R[B][1],y=R[B][2],N=R[B][3],r=R[B][4],q=[],e=[];let D,l;for(let R=0;R<5;R++)D=y.x+N*Math.cos(r+R*Math.PI/2.5),l=y.y+N*Math.sin(r+R*Math.PI/2.5),D<0&&(D=0),D>1&&(D=1),q.push(D,l);for(let R=0;R<6;R++)D=y.x+N*Math.cos(r+R*Math.PI/3),l=y.y+N*Math.sin(r+R*Math.PI/3),D<0&&(D=0),D>1&&(D=1),e.push(D,l);for(let R=Q;R<Math.min(12,h+1);R++)for(let B=0;B<5;B++)J[10*R+2*B]=q[2*B],J[10*R+2*B+1]=q[2*B+1];for(let R=Math.max(12,Q);R<h+1;R++)for(let B=0;B<6;B++)J[12*R-24+2*B]=e[2*B],J[12*R-23+2*B]=e[2*B+1]}return J}setGoldbergFaceUVs(R){const J=this._changeGoldbergFaceUVs(R);this.kR(y.h.UVKind,J)}updateGoldbergFaceUVs(R){const J=this._changeGoldbergFaceUVs(R);this.updateVerticesData(y.h.UVKind,J)}placeOnGoldbergFaceAt(R,J,B){const h=Q.nJ.RotationFromAxis(this.goldbergData.faceXaxis[J],this.goldbergData.faceYaxis[J],this.goldbergData.faceZaxis[J]);R.rotation=h,R.position=this.goldbergData.faceCenters[J].add(this.goldbergData.faceXaxis[J].scale(B.x)).add(this.goldbergData.faceYaxis[J].scale(B.y)).add(this.goldbergData.faceZaxis[J].scale(B.z))}serialize(R){super.serialize(R),R.type="GoldbergMesh";const J={};if(J.adjacentFaces=this.goldbergData.adjacentFaces,J.nbSharedFaces=this.goldbergData.nbSharedFaces,J.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,J.nbFaces=this.goldbergData.nbFaces,J.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){J.faceColors=[];for(const R of this.goldbergData.faceColors)J.faceColors.push(R.Ch())}if(this.goldbergData.faceCenters){J.faceCenters=[];for(const R of this.goldbergData.faceCenters)J.faceCenters.push(R.Ch())}if(this.goldbergData.faceZaxis){J.faceZaxis=[];for(const R of this.goldbergData.faceZaxis)J.faceZaxis.push(R.Ch())}if(this.goldbergData.faceYaxis){J.faceYaxis=[];for(const R of this.goldbergData.faceYaxis)J.faceYaxis.push(R.Ch())}if(this.goldbergData.faceXaxis){J.faceXaxis=[];for(const R of this.goldbergData.faceXaxis)J.faceXaxis.push(R.Ch())}R.goldbergData=J}static Parse(R,J){const B=R.goldbergData;B.faceColors=B.faceColors.map((R=>E.ar.fJ(R))),B.faceCenters=B.faceCenters.map((R=>Q.nJ.fJ(R))),B.faceZaxis=B.faceZaxis.map((R=>Q.nJ.fJ(R))),B.faceXaxis=B.faceXaxis.map((R=>Q.nJ.fJ(R))),B.faceYaxis=B.faceYaxis.map((R=>Q.nJ.fJ(R)));const h=new yR(R.name,J);return h.goldbergData=B,h}}var NR=B(11747);const rR={CreateBox:l.d,CreateTiledBox:A,CreateSphere:u.c,CreateDisc:D.c,CreateIcoSphere:j,CreateRibbon:e,CreateCylinder:s,CreateTorus:I,CreateTorusKnot:M,CreateLineSystem:H.h,Ve:H.l,CreateDashedLines:H.d,ExtrudeShape:c,ExtrudeShapeCustom:z,CreateLathe:i,CreateTiledPlane:n,ce:W.e,CreateGround:k.f,CreateTiledGround:k.j,CreateGroundFromHeightMap:k.c,CreatePolygon:d.e,ExtrudePolygon:d.h,CreateTube:Y,CreatePolyhedron:g,CreateGeodesic:function(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=J.m||1;Q!==Math.floor(Q)&&(Q=Math.floor(Q),U.d.Warn("m not an integer only floor(m) used"));let h=J.n||0;if(h!==Math.floor(h)&&(h=Math.floor(h),U.d.Warn("n not an integer only floor(n) used")),h>Q){const R=h;h=Q,Q=R,U.d.Warn("n > m therefore m and n swapped")}const y=new BR;return y.build(Q,h),g(R,{custom:hR.BuildGeodesicData(y),size:J.size,sizeX:J.sizeX,sizeY:J.sizeY,sizeZ:J.sizeZ,faceUV:J.faceUV,faceColors:J.faceColors,flat:J.flat,updatable:J.updatable,sideOrientation:J.sideOrientation,frontUVs:J.frontUVs,backUVs:J.backUVs},B)},CreateGoldberg:function(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=J.size,q=J.sizeX||y||1,e=J.sizeY||y||1,D=J.sizeZ||y||1;let l=J.m||1;l!==Math.floor(l)&&(l=Math.floor(l),U.d.Warn("m not an integer only floor(m) used"));let O=J.n||0;if(O!==Math.floor(O)&&(O=Math.floor(O),U.d.Warn("n not an integer only floor(n) used")),O>l){const R=O;O=l,l=R,U.d.Warn("n > m therefore m and n swapped")}const n=new BR;n.build(l,O);const P=hR.BuildGeodesicData(n),A=P.toGoldbergPolyhedronData(),u=new yR(R,B);J.sideOrientation=h.e._GetDefaultSideOrientation(J.sideOrientation),u._originalBuilderSideOrientation=J.sideOrientation;(function(R,J){const B=R.size,h=R.sizeX||B||1,y=R.sizeY||B||1,q=R.sizeZ||B||1,e=0===R.sideOrientation?0:R.sideOrientation||N.e.DEFAULTSIDE,D=[],l=[],E=[],O=[];let n=1/0,P=-1/0,A=1/0,u=-1/0;for(let Q=0;Q<J.vertex.length;Q++)n=Math.min(n,J.vertex[Q][0]*h),P=Math.max(P,J.vertex[Q][0]*h),A=Math.min(A,J.vertex[Q][1]*y),u=Math.max(u,J.vertex[Q][1]*y);let S=0;for(let N=0;N<J.face.length;N++){const R=J.face[N],B=Q.nJ.fJ(J.vertex[R[0]]),e=Q.nJ.fJ(J.vertex[R[2]]),f=Q.nJ.fJ(J.vertex[R[1]]),a=e.PJ(B),s=f.PJ(B),x=Q.nJ.Cross(s,a).normalize();for(let Q=0;Q<R.length;Q++){E.push(x.x,x.y,x.z);const B=J.vertex[R[Q]];D.push(B[0]*h,B[1]*y,B[2]*q);const N=(B[1]*y-A)/(u-A);O.push((B[0]*h-n)/(P-n),r.c?1-N:N)}for(let J=0;J<R.length-2;J++)l.push(S,S+J+2,S+J+1);S+=R.length}N.e._ComputeSides(e,D,l,E,O);const f=new N.e;return f.MR=D,f.indices=l,f.HR=E,f.XR=O,f})(J,A).zR(u,J.updatable),u.goldbergData.nbSharedFaces=P.sharedNodes,u.goldbergData.nbUnsharedFaces=P.poleNodes,u.goldbergData.adjacentFaces=P.adjacentFaces,u.goldbergData.nbFaces=u.goldbergData.nbSharedFaces+u.goldbergData.nbUnsharedFaces,u.goldbergData.nbFacesAtPole=(u.goldbergData.nbUnsharedFaces-12)/12;for(let h=0;h<P.vertex.length;h++)u.goldbergData.faceCenters.push(Q.nJ.fJ(P.vertex[h])),u.goldbergData.faceCenters[h].x*=q,u.goldbergData.faceCenters[h].y*=e,u.goldbergData.faceCenters[h].z*=D,u.goldbergData.faceColors.push(new E.ar(1,1,1,1));for(let h=0;h<A.face.length;h++){const R=A.face[h],J=Q.nJ.fJ(A.vertex[R[0]]),B=Q.nJ.fJ(A.vertex[R[2]]),y=Q.nJ.fJ(A.vertex[R[1]]),N=B.PJ(J),r=y.PJ(J),q=Q.nJ.Cross(r,N).normalize(),e=Q.nJ.Cross(r,q).normalize();u.goldbergData.faceXaxis.push(r.normalize()),u.goldbergData.faceYaxis.push(q),u.goldbergData.faceZaxis.push(e)}return u},CreateDecal:o,CreateCapsule:Z,CreateText:NR.g}},12474:(R,J,B)=>{"use strict";B.d(J,{c:()=>rJ});var Q=B(11186),h=B(11559);class y extends h.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var N=B(11224),r=(B(11345),B(11142));class q{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(R){this._targetStopDuration!==R&&(this._targetStopDuration=R)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(R){this._noiseTexture!==R&&(this._noiseTexture=R,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(R){this._animationSheetEnabled!==R&&(this._animationSheetEnabled=R)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(R){this._isAnimationSheetEnabled!=R&&(this._isAnimationSheetEnabled=R,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(R){this._useLogarithmicDepth=R&&this.IR().getEngine().getCaps().fragmentDepthSupported}IR(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(R){switch(R){case q.BLENDMODE_MULTIPLYADD:return;case q.BLENDMODE_ADD:R=1;break;case q.BLENDMODE_ONEONE:R=6;break;case q.BLENDMODE_STANDARD:R=2;break;case q.BLENDMODE_MULTIPLY:R=4;break;case q.BLENDMODE_SUBTRACT:R=3}this._engine.setAlphaMode(R)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Q.nJ.Zero()}set direction1(R){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=R)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Q.nJ.Zero()}set direction2(R){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=R)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Q.nJ.Zero()}set minEmitBox(R){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=R)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Q.nJ.Zero()}set maxEmitBox(R){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=R)}get billboardMode(){return this._billboardMode}set billboardMode(R){this._billboardMode!==R&&(this._billboardMode=R,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(R){this._isBillboardBased!==R&&(this._isBillboardBased=R,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(R){this._attachImageProcessingConfiguration(R)}_attachImageProcessingConfiguration(R){R!==this._imageProcessingConfiguration&&(!R&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=R)}_reset(){}_removeGradientAndTexture(R,J,B){if(!J)return this;let Q=0;for(const h of J){if(h.gradient===R){J.splice(Q,1);break}Q++}return B&&B.dispose(),this}constructor(R){this.animations=[],this.renderingGroupId=0,this.QJ=Q.nJ.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Q.nJ(10,10,10),this.onAnimationEnd=null,this.blendMode=q.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Q.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.fe=new Q.nJ(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Q.nJ.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new N.ar(1,1,1,1),this.color2=new N.ar(1,1,1,1),this.colorDead=new N.ar(0,0,0,1),this.textureMask=new N.ar(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new y,this.id=R,this.name=R}createPointEmitter(R,J){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new Q.nJ(0,1,0),arguments.length>2&&void 0!==arguments[2]||new Q.nJ(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new Q.nJ(0,1,0),arguments.length>4&&void 0!==arguments[4]||new Q.nJ(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new Q.nJ(0,1,0),arguments.length>3&&void 0!==arguments[3]||new Q.nJ(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(R,J,B,Q){throw new Error("Method not implemented.")}}q.BLENDMODE_ONEONE=0,q.BLENDMODE_STANDARD=1,q.BLENDMODE_ADD=2,q.BLENDMODE_MULTIPLY=3,q.BLENDMODE_MULTIPLYADD=4,q.BLENDMODE_SUBTRACT=-1,(0,r.h)("BABYLON.BaseParticleSystem",q);var e=B(11201),D=B(11045);class l{constructor(){this.direction1=new Q.nJ(0,1,0),this.direction2=new Q.nJ(0,1,0),this.minEmitBox=new Q.nJ(-.5,-.5,-.5),this.maxEmitBox=new Q.nJ(.5,.5,.5)}startDirectionFunction(R,J,B,h){const y=(0,e.RandomRange)(this.direction1.x,this.direction2.x),N=(0,e.RandomRange)(this.direction1.y,this.direction2.y),r=(0,e.RandomRange)(this.direction1.z,this.direction2.z);if(h)return J.x=y,J.y=N,void(J.z=r);Q.nJ.TransformNormalFromFloatsToRef(y,N,r,R,J)}startPositionFunction(R,J,B,h){const y=(0,e.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),N=(0,e.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),r=(0,e.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(h)return J.x=y,J.y=N,void(J.z=r);Q.nJ.TransformCoordinatesFromFloatsToRef(y,N,r,R,J)}clone(){const R=new l;return D.d.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2),R.setVector3("minEmitBox",this.minEmitBox),R.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3),R.addUniform("minEmitBox",3),R.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.direction1=this.direction1.Ch(),R.direction2=this.direction2.Ch(),R.minEmitBox=this.minEmitBox.Ch(),R.maxEmitBox=this.maxEmitBox.Ch(),R}parse(R){Q.nJ.FromArrayToRef(R.direction1,0,this.direction1),Q.nJ.FromArrayToRef(R.direction2,0,this.direction2),Q.nJ.FromArrayToRef(R.minEmitBox,0,this.minEmitBox),Q.nJ.FromArrayToRef(R.maxEmitBox,0,this.maxEmitBox)}}class E{get radius(){return this._radius}set radius(R){this._radius=R,this._buildHeight()}get angle(){return this._angle}set angle(R){this._angle=R,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=B,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=J,this.radius=R}startDirectionFunction(R,J,B,h){h?Q.TmpVectors.nJ[0].h(B.wr).normalize():B.position.subtractToRef(R.getTranslation(),Q.TmpVectors.nJ[0]).normalize();const y=(0,e.RandomRange)(0,this.directionRandomizer),N=(0,e.RandomRange)(0,this.directionRandomizer),r=(0,e.RandomRange)(0,this.directionRandomizer);J.x=Q.TmpVectors.nJ[0].x+y,J.y=Q.TmpVectors.nJ[0].y+N,J.z=Q.TmpVectors.nJ[0].z+r,J.normalize()}startPositionFunction(R,J,B,h){const y=(0,e.RandomRange)(0,2*Math.PI);let N;this.emitFromSpawnPointOnly?N=1e-4:(N=(0,e.RandomRange)(0,this.heightRange),N=1-N*N);let r=this._radius-(0,e.RandomRange)(0,this._radius*this.radiusRange);r*=N;const q=r*Math.sin(y),D=r*Math.cos(y),l=N*this._height;if(h)return J.x=q,J.y=l,void(J.z=D);Q.nJ.TransformCoordinatesFromFloatsToRef(q,l,D,R,J)}clone(){const R=new E(this._radius,this._angle,this.directionRandomizer);return D.d.DeepCopy(this,R),R}applyToShader(R){R.setFloat2("radius",this._radius,this.radiusRange),R.setFloat("coneAngle",this._angle),R.setFloat2("height",this._height,this.heightRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",2),R.addUniform("coneAngle",1),R.addUniform("height",2),R.addUniform("directionRandomizer",1)}getEffectDefines(){let R="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(R+="\n#define CONEEMITTERSPAWNPOINT"),R}getClassName(){return"ConeParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this._radius,R.angle=this._angle,R.directionRandomizer=this.directionRandomizer,R.radiusRange=this.radiusRange,R.heightRange=this.heightRange,R.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,R}parse(R){this.radius=R.radius,this.angle=R.angle,this.directionRandomizer=R.directionRandomizer,this.radiusRange=void 0!==R.radiusRange?R.radiusRange:1,this.heightRange=void 0!==R.radiusRange?R.heightRange:1,this.emitFromSpawnPointOnly=void 0!==R.emitFromSpawnPointOnly&&R.emitFromSpawnPointOnly}}class O extends E{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.nJ(0,1,0),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.nJ(0,1,0);super(R,J),this.direction1=B,this.direction2=h}startDirectionFunction(R,J){const B=(0,e.RandomRange)(this.direction1.x,this.direction2.x),h=(0,e.RandomRange)(this.direction1.y,this.direction2.y),y=(0,e.RandomRange)(this.direction1.z,this.direction2.z);Q.nJ.TransformNormalFromFloatsToRef(B,h,y,R,J)}clone(){const R=new O(this.radius,this.angle,this.direction1,this.direction2);return D.d.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.Ch(),R.direction2=this.direction2.Ch(),R}parse(R){super.parse(R),this.direction1.h(R.direction1),this.direction2.h(R.direction2)}}class n{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=R,this.height=J,this.radiusRange=B,this.directionRandomizer=h,this._tempVector=Q.nJ.Zero()}startDirectionFunction(R,J,B,h,y){B.position.subtractToRef(R.getTranslation(),this._tempVector),this._tempVector.normalize(),Q.nJ.TransformNormalToRef(this._tempVector,y,this._tempVector);const N=(0,e.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let r=Math.atan2(this._tempVector.x,this._tempVector.z);r+=(0,e.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=N,this._tempVector.x=Math.sin(r),this._tempVector.z=Math.cos(r),this._tempVector.normalize(),h?J.h(this._tempVector):Q.nJ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,R,J)}startPositionFunction(R,J,B,h){const y=(0,e.RandomRange)(-this.height/2,this.height/2),N=(0,e.RandomRange)(0,2*Math.PI),r=(0,e.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),q=Math.sqrt(r)*this.radius,D=q*Math.cos(N),l=q*Math.sin(N);h?J.Ar(D,y,l):Q.nJ.TransformCoordinatesFromFloatsToRef(D,y,l,R,J)}clone(){const R=new n(this.radius,this.directionRandomizer);return D.d.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("height",this.height),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("height",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.height=this.height,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.height=R.height,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class P extends n{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.nJ(0,1,0),y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.nJ(0,1,0);super(R,J,B),this.direction1=h,this.direction2=y}startDirectionFunction(R,J,B,h){const y=(0,e.RandomRange)(this.direction1.x,this.direction2.x),N=(0,e.RandomRange)(this.direction1.y,this.direction2.y),r=(0,e.RandomRange)(this.direction1.z,this.direction2.z);h?J.Ar(y,N,r):Q.nJ.TransformNormalFromFloatsToRef(y,N,r,R,J)}clone(){const R=new P(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return D.d.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("height",this.height),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("height",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.Ch(),R.direction2=this.direction2.Ch(),R}parse(R){super.parse(R),Q.nJ.FromArrayToRef(R.direction1,0,this.direction1),Q.nJ.FromArrayToRef(R.direction2,0,this.direction2)}}class A{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=R,this.radiusRange=J,this.directionRandomizer=B}startDirectionFunction(R,J,B,h){const y=B.position.PJ(R.getTranslation()).normalize(),N=(0,e.RandomRange)(0,this.directionRandomizer),r=(0,e.RandomRange)(0,this.directionRandomizer),q=(0,e.RandomRange)(0,this.directionRandomizer);y.x+=N,y.y+=r,y.z+=q,y.normalize(),h?J.h(y):Q.nJ.TransformNormalFromFloatsToRef(y.x,y.y,y.z,R,J)}startPositionFunction(R,J,B,h){const y=this.radius-(0,e.RandomRange)(0,this.radius*this.radiusRange),N=(0,e.RandomRange)(0,1),r=(0,e.RandomRange)(0,2*Math.PI),q=Math.acos(2*N-1),D=y*Math.cos(r)*Math.sin(q),l=y*Math.cos(q),E=y*Math.sin(r)*Math.sin(q);h?J.Ar(D,Math.abs(l),E):Q.nJ.TransformCoordinatesFromFloatsToRef(D,Math.abs(l),E,R,J)}clone(){const R=new A(this.radius,this.directionRandomizer);return D.d.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class u{constructor(){this.direction1=new Q.nJ(0,1,0),this.direction2=new Q.nJ(0,1,0)}startDirectionFunction(R,J,B,h){const y=(0,e.RandomRange)(this.direction1.x,this.direction2.x),N=(0,e.RandomRange)(this.direction1.y,this.direction2.y),r=(0,e.RandomRange)(this.direction1.z,this.direction2.z);h?J.Ar(y,N,r):Q.nJ.TransformNormalFromFloatsToRef(y,N,r,R,J)}startPositionFunction(R,J,B,h){h?J.Ar(0,0,0):Q.nJ.TransformCoordinatesFromFloatsToRef(0,0,0,R,J)}clone(){const R=new u;return D.d.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.direction1=this.direction1.Ch(),R.direction2=this.direction2.Ch(),R}parse(R){Q.nJ.FromArrayToRef(R.direction1,0,this.direction1),Q.nJ.FromArrayToRef(R.direction2,0,this.direction2)}}class S{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=R,this.radiusRange=J,this.directionRandomizer=B}startDirectionFunction(R,J,B,h){const y=B.position.PJ(R.getTranslation()).normalize(),N=(0,e.RandomRange)(0,this.directionRandomizer),r=(0,e.RandomRange)(0,this.directionRandomizer),q=(0,e.RandomRange)(0,this.directionRandomizer);y.x+=N,y.y+=r,y.z+=q,y.normalize(),h?J.h(y):Q.nJ.TransformNormalFromFloatsToRef(y.x,y.y,y.z,R,J)}startPositionFunction(R,J,B,h){const y=this.radius-(0,e.RandomRange)(0,this.radius*this.radiusRange),N=(0,e.RandomRange)(0,1),r=(0,e.RandomRange)(0,2*Math.PI),q=Math.acos(2*N-1),D=y*Math.cos(r)*Math.sin(q),l=y*Math.cos(q),E=y*Math.sin(r)*Math.sin(q);h?J.Ar(D,l,E):Q.nJ.TransformCoordinatesFromFloatsToRef(D,l,E,R,J)}clone(){const R=new S(this.radius,this.directionRandomizer);return D.d.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class f extends S{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.nJ(0,1,0),B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.nJ(0,1,0);super(R),this.direction1=J,this.direction2=B}startDirectionFunction(R,J){const B=(0,e.RandomRange)(this.direction1.x,this.direction2.x),h=(0,e.RandomRange)(this.direction1.y,this.direction2.y),y=(0,e.RandomRange)(this.direction1.z,this.direction2.z);Q.nJ.TransformNormalFromFloatsToRef(B,h,y,R,J)}clone(){const R=new f(this.radius,this.direction1,this.direction2);return D.d.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.Ch(),R.direction2=this.direction2.Ch(),R}parse(R){super.parse(R),this.direction1.h(R.direction1),this.direction2.h(R.direction2)}}class a{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(R,J,B,h){const y=Q.TmpVectors.nJ[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,B,y);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,B,y);const R=Q.TmpVectors.nJ[1];y.subtractToRef(B.position,R),R.scaleToRef(1/B.lifeTime,y)}else y.set(0,0,0);h?J.h(y):Q.nJ.TransformNormalToRef(y,R,J)}startPositionFunction(R,J,B,h){const y=Q.TmpVectors.nJ[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,B,y):y.set(0,0,0),h?J.h(y):Q.nJ.TransformCoordinatesToRef(y,R,J)}clone(){const R=new a;return D.d.DeepCopy(this,R),R}applyToShader(R){}buildUniformLayout(R){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.particlePositionGenerator=this.particlePositionGenerator,R.particleDestinationGenerator=this.particleDestinationGenerator,R}parse(R){R.particlePositionGenerator&&(this.particlePositionGenerator=R.particlePositionGenerator),R.particleDestinationGenerator&&(this.particleDestinationGenerator=R.particleDestinationGenerator)}}var s=B(11262);class x{get mesh(){return this._mesh}set mesh(R){this._mesh!==R&&(this._mesh=R,R?(this._indices=R.hr(),this._positions=R.getVerticesData(s.h.PositionKind),this._normals=R.getVerticesData(s.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=Q.nJ.Zero(),this._mesh=null,this.direction1=new Q.nJ(0,1,0),this.direction2=new Q.nJ(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=R}startDirectionFunction(R,J,B,h){if(this.useMeshNormalsForDirection&&this._normals)return void Q.nJ.TransformNormalToRef(this._storedNormal,R,J);const y=(0,e.RandomRange)(this.direction1.x,this.direction2.x),N=(0,e.RandomRange)(this.direction1.y,this.direction2.y),r=(0,e.RandomRange)(this.direction1.z,this.direction2.z);h?J.Ar(y,N,r):Q.nJ.TransformNormalFromFloatsToRef(y,N,r,R,J)}startPositionFunction(R,J,B,h){if(!this._indices||!this._positions)return;const y=3*(Math.random()*(this._indices.length/3)|0),N=Math.random(),r=Math.random()*(1-N),q=1-N-r,e=this._indices[y],D=this._indices[y+1],l=this._indices[y+2],E=Q.TmpVectors.nJ[0],O=Q.TmpVectors.nJ[1],n=Q.TmpVectors.nJ[2],P=Q.TmpVectors.nJ[3];Q.nJ.FromArrayToRef(this._positions,3*e,E),Q.nJ.FromArrayToRef(this._positions,3*D,O),Q.nJ.FromArrayToRef(this._positions,3*l,n),P.x=N*E.x+r*O.x+q*n.x,P.y=N*E.y+r*O.y+q*n.y,P.z=N*E.z+r*O.z+q*n.z,h?J.Ar(P.x,P.y,P.z):Q.nJ.TransformCoordinatesFromFloatsToRef(P.x,P.y,P.z,R,J),this.useMeshNormalsForDirection&&this._normals&&(Q.nJ.FromArrayToRef(this._normals,3*e,E),Q.nJ.FromArrayToRef(this._normals,3*D,O),Q.nJ.FromArrayToRef(this._normals,3*l,n),this._storedNormal.x=N*E.x+r*O.x+q*n.x,this._storedNormal.y=N*E.y+r*O.y+q*n.y,this._storedNormal.z=N*E.z+r*O.z+q*n.z)}clone(){const R=new x(this.mesh);return D.d.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var R;const J={};return J.type=this.getClassName(),J.direction1=this.direction1.Ch(),J.direction2=this.direction2.Ch(),J.meshId=null===(R=this.mesh)||void 0===R?void 0:R.id,J.useMeshNormalsForDirection=this.useMeshNormalsForDirection,J}parse(R,J){Q.nJ.FromArrayToRef(R.direction1,0,this.direction1),Q.nJ.FromArrayToRef(R.direction2,0,this.direction2),R.meshId&&J&&(this.mesh=J.getLastMeshById(R.meshId)),this.useMeshNormalsForDirection=R.useMeshNormalsForDirection}}class I{_isUbo(R){return void 0!==R.addUniform}constructor(R){this._isUbo(R)?(this.setMatrix3x3=R.updateMatrix3x3.bind(R),this.setMatrix2x2=R.updateMatrix2x2.bind(R),this.setFloat=R.updateFloat.bind(R),this.setFloat2=R.updateFloat2.bind(R),this.setFloat3=R.updateFloat3.bind(R),this.setFloat4=R.updateFloat4.bind(R),this.setFloatArray=R.updateFloatArray.bind(R),this.setArray=R.updateArray.bind(R),this.setIntArray=R.updateIntArray.bind(R),this.setMatrix=R.th.bind(R),this.setMatrices=R.updateMatrices.bind(R),this.setVector3=R.updateVector3.bind(R),this.setVector4=R.updateVector4.bind(R),this.setColor3=R.updateColor3.bind(R),this.setColor4=R.updateColor4.bind(R),this.setDirectColor4=R.updateDirectColor4.bind(R),this.setInt=R.updateInt.bind(R),this.setInt2=R.updateInt2.bind(R),this.setInt3=R.updateInt3.bind(R),this.setInt4=R.updateInt4.bind(R)):(this.setMatrix3x3=R.setMatrix3x3.bind(R),this.setMatrix2x2=R.setMatrix2x2.bind(R),this.setFloat=R.setFloat.bind(R),this.setFloat2=R.setFloat2.bind(R),this.setFloat3=R.setFloat3.bind(R),this.setFloat4=R.setFloat4.bind(R),this.setFloatArray=R.setFloatArray.bind(R),this.setArray=R.setArray.bind(R),this.setIntArray=R.setIntArray.bind(R),this.setMatrix=R.setMatrix.bind(R),this.setMatrices=R.setMatrices.bind(R),this.setVector3=R.setVector3.bind(R),this.setVector4=R.setVector4.bind(R),this.setColor3=R.setColor3.bind(R),this.setColor4=R.setColor4.bind(R),this.setDirectColor4=R.setDirectColor4.bind(R),this.setInt=R.setInt.bind(R),this.setInt2=R.setInt2.bind(R),this.setInt3=R.setInt3.bind(R),this.setInt4=R.setInt4.bind(R))}}var V=B(11107);const M="gpuUpdateParticlesPixelShader",H="#version 300 es\nvoid main() {discard;}\n";V.c.ShadersStore[M]||(V.c.ShadersStore[M]=H);const d="gpuUpdateParticlesVertexShader",X="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";V.c.ShadersStore[d]||(V.c.ShadersStore[d]=X);(0,r.h)("BABYLON.WebGL2ParticleSystem",class{constructor(R,J){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=R,this._engine=J,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var R;return(null===(R=this._updateEffect)||void 0===R?void 0:R.isReady())??!1}createUpdateBuffer(R){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof a&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=R,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new I(this._updateEffect)}createVertexBuffers(R,J){this._updateVAO.push(this._createUpdateVAO(R)),this._renderVAO.push(this._engine.recordVertexArrayObject(J,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=J}createParticleBuffer(R){return R}bindDrawBuffers(R,J,B){B?this._engine.bindBuffers(this._renderVertexBuffers,B,J):this._engine.bindVertexArrayObject(this._renderVAO[R],null)}preUpdateParticleBuffer(){const R=this._engine;if(this._engine.enableEffect(this._updateEffect),!R.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(R,J,B){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[R],null);const Q=this._engine;Q.bindTransformFeedbackBuffer(J.getBuffer()),Q.setRasterizerState(!1),Q.beginTransformFeedback(!0),Q.drawArraysType(3,0,B),Q.endTransformFeedback(),Q.setRasterizerState(!0),Q.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let R=0;R<this._updateVAO.length;R++)this._engine.releaseVertexArrayObject(this._updateVAO[R]);this._updateVAO.length=0;for(let R=0;R<this._renderVAO.length;R++)this._engine.releaseVertexArrayObject(this._renderVAO[R]);this._renderVAO.length=0}_createUpdateVAO(R){const J={};J.position=R.createVertexBuffer("position",0,3);let B=3;J.age=R.createVertexBuffer("age",B,1),B+=1,J.size=R.createVertexBuffer("size",B,3),B+=3,J.life=R.createVertexBuffer("life",B,1),B+=1,J.seed=R.createVertexBuffer("seed",B,4),B+=4,J.direction=R.createVertexBuffer("direction",B,3),B+=3,this._parent.particleEmitterType instanceof a&&(J.initialPosition=R.createVertexBuffer("initialPosition",B,3),B+=3),this._parent._colorGradientsTexture||(J.color=R.createVertexBuffer("color",B,4),B+=4),this._parent._isBillboardBased||(J.initialDirection=R.createVertexBuffer("initialDirection",B,3),B+=3),this._parent.noiseTexture&&(J.noiseCoordinates1=R.createVertexBuffer("noiseCoordinates1",B,3),B+=3,J.noiseCoordinates2=R.createVertexBuffer("noiseCoordinates2",B,3),B+=3),this._parent._angularSpeedGradientsTexture?(J.angle=R.createVertexBuffer("angle",B,1),B+=1):(J.angle=R.createVertexBuffer("angle",B,2),B+=2),this._parent._isAnimationSheetEnabled&&(J.cellIndex=R.createVertexBuffer("cellIndex",B,1),B+=1,this._parent.spriteRandomStartCell&&(J.cellStartOffset=R.createVertexBuffer("cellStartOffset",B,1),B+=1));const Q=this._engine.recordVertexArrayObject(J,null,this._updateEffect);return this._engine.bindArrayBuffer(null),Q}});class c{constructor(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Q=arguments.length>3?arguments[3]:void 0;this._engine=R,this._label=Q,this._engine._storageBuffers.push(this),this._create(J,B)}_create(R,J){this._bufferSize=R,this._creationFlags=J,this._buffer=this._engine.createStorageBuffer(R,J,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(R,J,B){this._buffer&&this._engine.updateStorageBuffer(this._buffer,R,J,B)}async read(R,J,B,Q){return await this._engine.readFromStorageBuffer(this._buffer,R,J,B,Q)}dispose(){const R=this._engine._storageBuffers,J=R.indexOf(this);-1!==J&&(R[J]=R[R.length-1],R.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var z=B(11167),p=B(11176),i=B(11217),W=B(11161),k=B(11479),Y=B(11043),G=B(11128),g=B(11399);class L{constructor(){this._gpuTimeInFrameId=-1,this.counter=new g.b}_addDuration(R,J){R<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==R?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(J,!1),this._gpuTimeInFrameId=R):this.counter.addCount(J,!1))}}var j=B(11090);class T{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=R,this._engine=J,this.uniqueId=k.d.UniqueId,J.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new L),this._engine.getCaps().supportComputeShaders?Q.bindingsMapping?(this._context=J.createComputeContext(),this._shaderPath=B,this._options={bindingsMapping:{},defines:[],...Q}):Y.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):Y.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(R,J){let B=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Q=this._bindings[R];this._bindings[R]={type:B?0:4,object:J,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==J||Q.type!==this._bindings[R].type)}setStorageTexture(R,J){const B=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!B||B.object!==J),this._bindings[R]={type:1,object:J,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries}}setExternalTexture(R,J){const B=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!B||B.object!==J),this._bindings[R]={type:6,object:J,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries}}setVideoTexture(R,J){return!!J.externalTexture&&(this.setExternalTexture(R,J.externalTexture),!0)}setUniformBuffer(R,J){const B=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!B||B.object!==J),this._bindings[R]={type:T._BufferIsDataBuffer(J)?7:2,object:J,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries}}setStorageBuffer(R,J){const B=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!B||B.object!==J),this._bindings[R]={type:T._BufferIsDataBuffer(J)?7:3,object:J,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries}}setTextureSampler(R,J){const B=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!B||!J.compareSampler(B.object)),this._bindings[R]={type:5,object:J,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries}}isReady(){let R=this._effect;for(const h in this._bindings){const R=this._bindings[h],J=R.type,B=R.object;switch(J){case 0:case 4:case 1:if(!B.isReady())return!1;break;case 6:if(!B.isReady())return!1;break}}const J=[],B=this._shaderPath;if(this._options.defines)for(let h=0;h<this._options.defines.length;h++)J.push(this._options.defines[h]);const Q=J.join("\n");return this._cachedDefines!==Q&&(this._cachedDefines=Q,R=this._engine.createComputeEffect(B,{defines:Q,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=R),!!R.isReady()}dispatch(R,J,B){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,R,J,B,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const B=T._BufferIsDataBuffer(R)?R:R.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,B,J,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const J in this._bindings){const B=this._bindings[J];if(!this._options.bindingsMapping[J])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+J+"'");switch(B.type){case 0:{const Q=this._samplers[J],h=B.object;var R;if(!Q||!h._texture||!Q.compareSampler(h._texture))this._samplers[J]=(new G.d).setParameters(h.wrapU,h.wrapV,h.wrapR,h.anisotropicFilteringLevel,h._texture.samplingMode,null===(R=h._texture)||void 0===R?void 0:R._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const R=B.object;R.getBuffer()!==B.buffer&&(B.buffer=R.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((h=>{(0,j.f)((()=>this.dispatch(R,J,B)),h,void 0,Q)}))}serialize(){const R=i.c.Serialize(this);R.options=this._options,R.shaderPath=this._shaderPath,R.aE={},R.textures={};for(const J in this._bindings){const B=this._bindings[J],Q=B.object;switch(B.type){case 0:case 4:case 1:{const h=Q.serialize();h&&(R.textures[J]=h,R.aE[J]={type:B.type});break}}}return R}static Parse(R,J,B){const Q=i.c.Parse((()=>new T(R.name,J.getEngine(),R.shaderPath,R.options)),R,J,B);for(const h in R.textures){const y=R.aE[h],N=W.d.Parse(R.textures[h],J,B);0===y.type?Q.setTexture(h,N):4===y.type?Q.setTexture(h,N,!1):Q.setStorageTexture(h,N)}return Q}static _BufferIsDataBuffer(R){return void 0!==R.underlyingResource}}(0,z.e)([(0,p.N)()],T.prototype,"name",void 0),(0,z.e)([(0,p.N)()],T.prototype,"fastMode",void 0),(0,r.h)("BABYLON.ComputeShader",T);var F=B(11442);const C="gpuUpdateParticlesComputeShader",b="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";V.c.ShadersStoreWGSL[C]||(V.c.ShadersStoreWGSL[C]=b);(0,r.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(R,J){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=R,this._engine=J}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var R;return(null===(R=this._updateComputeShader)||void 0===R?void 0:R.isReady())??!1}createUpdateBuffer(R){var J;const B={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(B.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(B.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(B.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(B.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(B.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(B.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(B.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new T("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:B,defines:R.split("\n")}),null===(J=this._simParamsComputeShader)||void 0===J||J.dispose(),this._simParamsComputeShader=new F.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new I(this._simParamsComputeShader)}createVertexBuffers(R,J){this._renderVertexBuffers.push(J)}createParticleBuffer(R){const J=new c(this._engine,4*R.length,11,"ComputeShaderParticleSystemBuffer");return J.update(R),this._bufferComputeShader.push(J),J.getBuffer()}bindDrawBuffers(R,J,B){this._engine.bindBuffers(this._renderVertexBuffers[R],B,J)}preUpdateParticleBuffer(){}updateParticleBuffer(R,J,B){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[R]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^R]),this._updateComputeShader.dispatch(Math.ceil(B/64))}releaseBuffers(){var R;for(let J=0;J<this._bufferComputeShader.length;++J)this._bufferComputeShader[J].dispose();this._bufferComputeShader.length=0,null===(R=this._simParamsComputeShader)||void 0===R||R.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class w{constructor(R,J,B){this.gradient=R,this.color1=J,this.color2=B}getColorToRef(R){this.color2?N.ar.LerpToRef(this.color1,this.color2,Math.random(),R):R.h(this.color1)}}class K{constructor(R,J){this.gradient=R,this.color=J}}class v{constructor(R,J,B){this.gradient=R,this.factor1=J,this.factor2=B}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class m{static GetCurrentGradient(R,J,B){if(J[0].gradient>R)return void B(J[0],J[0],1);for(let h=0;h<J.length-1;h++){const Q=J[h],y=J[h+1];if(R>=Q.gradient&&R<=y.gradient){return void B(Q,y,(R-Q.gradient)/(y.gradient-Q.gradient))}}const Q=J.length-1;B(J[Q],J[Q],1)}}var o=B(11032),t=B(11653),Z=B(11065);class U{constructor(R){this.particleSystem=R,this.position=Q.nJ.Zero(),this.direction=Q.nJ.Zero(),this.color=new N.ar(0,0,0,0),this.colorStep=new N.ar(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new Q.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new N.ar(0,0,0,0),this._currentColor2=new N.ar(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=U._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let R=this.age,J=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===J?(J=1,R=this._randomCellOffset):R+=this._randomCellOffset);const B=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let Q;Q=this._initialSpriteCellLoop?(0,e.Clamp)(R*J%this.lifeTime/this.lifeTime):(0,e.Clamp)(R*J/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+Q*B|0}_inheritParticleInfoToSubEmitter(R){if(R.particleSystem.QJ.position){const J=R.particleSystem.QJ;if(J.position.h(this.position),R.inheritDirection){const R=Q.TmpVectors.nJ[0];this.direction.normalizeToRef(R),J.setDirection(R,0,Math.PI/2)}}else{R.particleSystem.QJ.h(this.position)}this.direction.scaleToRef(R.inheritedVelocityAmount/2,Q.TmpVectors.nJ[0]),R.particleSystem._inheritedVelocityOffset.h(Q.TmpVectors.nJ[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const R of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(R)}_reset(){this.age=0,this.id=U._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(R){R.position.h(this.position),this._initialDirection?R._initialDirection?R._initialDirection.h(this._initialDirection):R._initialDirection=this._initialDirection.clone():R._initialDirection=null,R.direction.h(this.direction),this.wr&&(R.wr?R.wr.h(this.wr):R.wr=this.wr.clone()),R.color.h(this.color),R.colorStep.h(this.colorStep),R.lifeTime=this.lifeTime,R.age=this.age,R._randomCellOffset=this._randomCellOffset,R.size=this.size,R.scale.h(this.scale),R.angle=this.angle,R.angularSpeed=this.angularSpeed,R.particleSystem=this.particleSystem,R.cellIndex=this.cellIndex,R.id=this.id,R._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(R._currentColorGradient=this._currentColorGradient,R._currentColor1.h(this._currentColor1),R._currentColor2.h(this._currentColor2)),this._currentSizeGradient&&(R._currentSizeGradient=this._currentSizeGradient,R._currentSize1=this._currentSize1,R._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(R._currentAngularSpeedGradient=this._currentAngularSpeedGradient,R._currentAngularSpeed1=this._currentAngularSpeed1,R._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(R._currentVelocityGradient=this._currentVelocityGradient,R._currentVelocity1=this._currentVelocity1,R._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(R._currentLimitVelocityGradient=this._currentLimitVelocityGradient,R._currentLimitVelocity1=this._currentLimitVelocity1,R._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(R._currentDragGradient=this._currentDragGradient,R._currentDrag1=this._currentDrag1,R._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(R._initialStartSpriteCellId=this._initialStartSpriteCellId,R._initialEndSpriteCellId=this._initialEndSpriteCellId,R._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(R.remapData&&this.remapData?R.remapData.h(this.remapData):R.remapData=new Q.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(R._randomNoiseCoordinates1?(R._randomNoiseCoordinates1.h(this._randomNoiseCoordinates1),R._randomNoiseCoordinates2.h(this._randomNoiseCoordinates2)):(R._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),R._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}U._Count=0;var RR=B(11301),JR=(B(11343),B(11547)),BR=B(11539),QR=B(11433);function hR(R,J){const B=(0,e.RandomRange)(0,1);N.ar.LerpToRef(J.color1,J.color2,B,R.color),J.colorDead.subtractToRef(R.color,J._colorDiff),J._colorDiff.scaleToRef(1/R.lifeTime,R.colorStep)}function yR(R,J){R._currentColorGradient=J._colorGradients[0],R._currentColorGradient.getColorToRef(R.color),R._currentColor1.h(R.color),J._colorGradients.length>1?J._colorGradients[1].getColorToRef(R._currentColor2):R._currentColor2.h(R.color)}function NR(R,J){const B=J._colorGradients;m.GetCurrentGradient(J._ratio,B,((J,B,Q)=>{J!==R._currentColorGradient&&(R._currentColor1.h(R._currentColor2),B.getColorToRef(R._currentColor2),R._currentColorGradient=J),N.ar.LerpToRef(R._currentColor1,R._currentColor2,Q,R.color)}))}function rR(R,J){R.colorStep.scaleToRef(J._scaledUpdateSpeed,J._scaledColorStep),R.color.addInPlace(J._scaledColorStep),R.color.a<0&&(R.color.a=0)}function qR(R,J){m.GetCurrentGradient(J._ratio,J._angularSpeedGradients,((J,B,Q)=>{J!==R._currentAngularSpeedGradient&&(R._currentAngularSpeed1=R._currentAngularSpeed2,R._currentAngularSpeed2=B.getFactor(),R._currentAngularSpeedGradient=J),R.angularSpeed=(0,e.Lerp)(R._currentAngularSpeed1,R._currentAngularSpeed2,Q)}))}function eR(R,J){R.angle+=R.angularSpeed*J._scaledUpdateSpeed}function DR(R,J){J.particleEmitterType.startDirectionFunction(J._emitterWorldMatrix,R.direction,R,J.isLocal,J._emitterInverseWorldMatrix)}function lR(R,J){J.startDirectionFunction(J._emitterWorldMatrix,R.direction,R,J.isLocal)}function ER(R,J){R._currentVelocityGradient=J._velocityGradients[0],R._currentVelocity1=R._currentVelocityGradient.getFactor(),J._velocityGradients.length>1?R._currentVelocity2=J._velocityGradients[1].getFactor():R._currentVelocity2=R._currentVelocity1}function OR(R,J){R._currentLimitVelocityGradient=J._limitVelocityGradients[0],R._currentLimitVelocity1=R._currentLimitVelocityGradient.getFactor(),J._limitVelocityGradients.length>1?R._currentLimitVelocity2=J._limitVelocityGradients[1].getFactor():R._currentLimitVelocity2=R._currentLimitVelocity1}function nR(R,J){m.GetCurrentGradient(J._ratio,J._velocityGradients,((B,Q,h)=>{B!==R._currentVelocityGradient&&(R._currentVelocity1=R._currentVelocity2,R._currentVelocity2=Q.getFactor(),R._currentVelocityGradient=B),J._directionScale*=(0,e.Lerp)(R._currentVelocity1,R._currentVelocity2,h)}))}function PR(R,J){m.GetCurrentGradient(J._ratio,J._limitVelocityGradients,((B,Q,h)=>{B!==R._currentLimitVelocityGradient&&(R._currentLimitVelocity1=R._currentLimitVelocity2,R._currentLimitVelocity2=Q.getFactor(),R._currentLimitVelocityGradient=B);const y=(0,e.Lerp)(R._currentLimitVelocity1,R._currentLimitVelocity2,h);R.direction.length()>y&&R.direction.scaleInPlace(J.limitVelocityDamping)}))}function AR(R,J){R.direction.scaleToRef(J._directionScale,J._scaledDirection)}function uR(R,J){J.particleEmitterType.startPositionFunction(J._emitterWorldMatrix,R.position,R,J.isLocal)}function SR(R,J){J.startPositionFunction(J._emitterWorldMatrix,R.position,R,J.isLocal)}function fR(R,J){R.wr?R.wr.h(R.position):R.wr=R.position.clone(),Q.nJ.TransformCoordinatesToRef(R.wr,J._emitterWorldMatrix,R.position)}function aR(R,J){J.isLocal&&R.wr?(R.wr.addInPlace(J._scaledDirection),Q.nJ.TransformCoordinatesToRef(R.wr,J._emitterWorldMatrix,R.position)):R.position.addInPlace(J._scaledDirection)}function sR(R,J){R._currentDragGradient=J._dragGradients[0],R._currentDrag1=R._currentDragGradient.getFactor(),J._dragGradients.length>1?R._currentDrag2=J._dragGradients[1].getFactor():R._currentDrag2=R._currentDrag1}function xR(R,J){m.GetCurrentGradient(J._ratio,J._dragGradients,((B,Q,h)=>{B!==R._currentDragGradient&&(R._currentDrag1=R._currentDrag2,R._currentDrag2=Q.getFactor(),R._currentDragGradient=B);const y=(0,e.Lerp)(R._currentDrag1,R._currentDrag2,h);J._scaledDirection.scaleInPlace(1-y)}))}function IR(R,J){R._randomNoiseCoordinates1?(R._randomNoiseCoordinates1.Ar(Math.random(),Math.random(),Math.random()),R._randomNoiseCoordinates2.Ar(Math.random(),Math.random(),Math.random())):(R._randomNoiseCoordinates1=new Q.nJ(Math.random(),Math.random(),Math.random()),R._randomNoiseCoordinates2=new Q.nJ(Math.random(),Math.random(),Math.random()))}function VR(R,J){const B=J._noiseTextureData,h=J._noiseTextureSize;if(B&&h&&R._randomNoiseCoordinates1){const y=J._fetchR(R._randomNoiseCoordinates1.x,R._randomNoiseCoordinates1.y,h.width,h.height,B),N=J._fetchR(R._randomNoiseCoordinates1.z,R._randomNoiseCoordinates2.x,h.width,h.height,B),r=J._fetchR(R._randomNoiseCoordinates2.y,R._randomNoiseCoordinates2.z,h.width,h.height,B),q=Q.TmpVectors.nJ[0],e=Q.TmpVectors.nJ[1];q.Ar((2*y-1)*J.noiseStrength.x,(2*N-1)*J.noiseStrength.y,(2*r-1)*J.noiseStrength.z),q.scaleToRef(J._tempScaledUpdateSpeed,e),R.direction.addInPlace(e)}}function MR(R,J){J.gravity.scaleToRef(J._tempScaledUpdateSpeed,J._scaledGravity),R.direction.addInPlace(J._scaledGravity)}function HR(R,J){R.size=(0,e.RandomRange)(J.minSize,J.maxSize),R.scale.Ar((0,e.RandomRange)(J.minScaleX,J.maxScaleX),(0,e.RandomRange)(J.minScaleY,J.maxScaleY))}function dR(R,J){R._currentSizeGradient=J._sizeGradients[0],R._currentSize1=R._currentSizeGradient.getFactor(),R.size=R._currentSize1,J._sizeGradients.length>1?R._currentSize2=J._sizeGradients[1].getFactor():R._currentSize2=R._currentSize1,R.scale.Ar((0,e.RandomRange)(J.minScaleX,J.maxScaleX),(0,e.RandomRange)(J.minScaleY,J.maxScaleY))}function XR(R,J){const B=J._actualFrame/J.targetStopDuration;m.GetCurrentGradient(B,J._startSizeGradients,((B,Q,h)=>{B!==J._currentStartSizeGradient&&(J._currentStartSize1=J._currentStartSize2,J._currentStartSize2=Q.getFactor(),J._currentStartSizeGradient=B);const y=(0,e.Lerp)(J._currentStartSize1,J._currentStartSize2,h);R.scale.scaleInPlace(y)}))}function cR(R,J){m.GetCurrentGradient(J._ratio,J._sizeGradients,((J,B,Q)=>{J!==R._currentSizeGradient&&(R._currentSize1=R._currentSize2,R._currentSize2=B.getFactor(),R._currentSizeGradient=J),R.size=(0,e.Lerp)(R._currentSize1,R._currentSize2,Q)}))}function zR(R,J){R.remapData=new Q.Vector4(0,1,0,1)}function pR(R,J){J._colorRemapGradients&&J._colorRemapGradients.length>0&&m.GetCurrentGradient(J._ratio,J._colorRemapGradients,((J,B,Q)=>{const h=(0,e.Lerp)(J.factor1,B.factor1,Q),y=(0,e.Lerp)(J.factor2,B.factor2,Q);R.remapData.x=h,R.remapData.y=y-h})),J._alphaRemapGradients&&J._alphaRemapGradients.length>0&&m.GetCurrentGradient(J._ratio,J._alphaRemapGradients,((J,B,Q)=>{const h=(0,e.Lerp)(J.factor1,B.factor1,Q),y=(0,e.Lerp)(J.factor2,B.factor2,Q);R.remapData.z=h,R.remapData.w=y-h}))}function iR(R,J){const B=(0,e.Clamp)(J._actualFrame/J.targetStopDuration);m.GetCurrentGradient(B,J._lifeTimeGradients,((J,Q)=>{const h=J,y=Q,N=h.getFactor(),r=y.getFactor(),q=(B-h.gradient)/(y.gradient-h.gradient);R.lifeTime=(0,e.Lerp)(N,r,q)})),J._emitPower=(0,e.RandomRange)(J.minEmitPower,J.maxEmitPower)}function WR(R,J){R.lifeTime=(0,e.RandomRange)(J.minLifeTime,J.maxLifeTime),J._emitPower=(0,e.RandomRange)(J.minEmitPower,J.maxEmitPower)}function kR(R,J){0===J._emitPower?(R._initialDirection?R._initialDirection.h(R.direction):R._initialDirection=R.direction.clone(),R.direction.set(0,0,0)):(R._initialDirection=null,R.direction.scaleInPlace(J._emitPower)),R.direction.addInPlace(J._inheritedVelocityOffset)}function YR(R,J){R.angularSpeed=(0,e.RandomRange)(J.minAngularSpeed,J.maxAngularSpeed),R.angle=(0,e.RandomRange)(J.minInitialRotation,J.maxInitialRotation)}function GR(R,J){R._currentAngularSpeedGradient=J._angularSpeedGradients[0],R.angularSpeed=R._currentAngularSpeedGradient.getFactor(),R._currentAngularSpeed1=R.angularSpeed,J._angularSpeedGradients.length>1?R._currentAngularSpeed2=J._angularSpeedGradients[1].getFactor():R._currentAngularSpeed2=R._currentAngularSpeed1,R.angle=(0,e.RandomRange)(J.minInitialRotation,J.maxInitialRotation)}function gR(R,J){R._initialStartSpriteCellId=J.startSpriteCellID,R._initialEndSpriteCellId=J.endSpriteCellID,R._initialSpriteCellLoop=J.spriteCellLoop}function LR(R,J){R.previousItem=J.previousItem,R.nextItem=J,J.previousItem&&(J.previousItem.nextItem=R),J.previousItem=R}function jR(R,J){R.previousItem=J,R.nextItem=J.nextItem,J.nextItem&&(J.nextItem.previousItem=R),J.nextItem=R}function TR(R,J){let B=J;for(;B.nextItem;)B=B.nextItem;R.previousItem=B,R.nextItem=B.nextItem,B.nextItem=R}function FR(R){R.previousItem&&(R.previousItem.nextItem=R.nextItem),R.nextItem&&(R.nextItem.previousItem=R.previousItem)}class CR extends q{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(R){this._startDirectionFunction!==R&&(this._startDirectionFunction=R,this._directionProcessing.process=R?lR:DR)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(R){this._startPositionFunction!==R&&(this._startPositionFunction=R,this._positionCreation.process=R?SR:uR)}set onDispose(R){this._onDisposeObserver&&this.eh.remove(this._onDisposeObserver),this._onDisposeObserver=this.eh.add(R)}get D(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(R){this._useRampGradients!==R&&(this._useRampGradients=R,this._resetEffect(),R?(this._rampCreation={process:zR,previousItem:null,nextItem:null},jR(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:pR,previousItem:null,nextItem:null},jR(this._remapGradientProcessing,this._gravityProcessing)):(FR(this._rampCreation),FR(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(R){this._isLocal!==R&&(this._isLocal=R,R?(this._isLocalCreation={process:fR,previousItem:null,nextItem:null},jR(this._isLocalCreation,this._positionCreation)):FR(this._isLocalCreation))}get particles(){return this.PE}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(R){this._animationSheetEnabled!==R&&(this._animationSheetEnabled=R,R?(this._sheetCreation={process:gR,previousItem:null,nextItem:null},jR(this._sheetCreation,this._colorCreation)):FR(this._sheetCreation),this._reset())}getActiveCount(){return this.PE.length}getClassName(){return"Be"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var R;let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._customWrappers[J])||void 0===R?void 0:R.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[R]??this._customWrappers[0]}setCustomEffect(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[J]=new RR.c(this._engine),this._customWrappers[J].effect=R,this._customWrappers[J].drawContext&&(this._customWrappers[J].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new o.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(R){if(this.noiseTexture!==R){if(this._noiseTexture=R,!R)return FR(this._noiseCreation),void FR(this._noiseProcessing);this._noiseCreation={process:IR,previousItem:null,nextItem:null},jR(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:VR,previousItem:null,nextItem:null},jR(this._noiseProcessing,this._positionProcessing)}}constructor(R,J,B){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(R),this._emitterInverseWorldMatrix=Q.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new Q.nJ,this.eh=new o.e,this.onStoppedObservable=new o.e,this.onStartedObservable=new o.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.PE=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new N.ar(0,0,0,0),this._colorDiff=new N.ar(0,0,0,0),this._scaledDirection=Q.nJ.Zero(),this._scaledGravity=Q.nJ.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=R=>{},this.recycleParticle=R=>{const J=this.PE.pop();J!==R&&J.copyTo(R),this._stockParticles.push(J)},this._createParticle=()=>{let R;return 0!==this._stockParticles.length?(R=this._stockParticles.pop(),R._reset()):R=new U(this),this._prepareParticle(R),R},this.paused=!1,this._shadersLoaded=!1,this._capacity=J,this._epsilon=r,B&&"Scene"!==B.getClassName()?(this._engine=B,this.defaultProjectionMatrix=Q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=B||Z.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.OE.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:WR,previousItem:null,nextItem:null},this._positionCreation={process:uR,previousItem:null,nextItem:null},jR(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:DR,previousItem:null,nextItem:null},jR(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:kR,previousItem:null,nextItem:null},jR(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:HR,previousItem:null,nextItem:null},jR(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:YR,previousItem:null,nextItem:null},jR(this._angleCreation,this._sizeCreation),this._colorCreation={process:hR,previousItem:null,nextItem:null},jR(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,q||(this._colorProcessing={process:rR,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:eR,previousItem:null,nextItem:null},jR(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:AR,previousItem:null,nextItem:null},jR(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:aR,previousItem:null,nextItem:null},jR(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:MR,previousItem:null,nextItem:null},jR(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=y,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new RR.c(this._engine)},this._customWrappers[0].effect=h,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new l,this.updateFunction=R=>{var J;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(J=this.noiseTexture.getContent())||void 0===J||J.then((R=>{this._noiseTextureData=R})));const B=R===this.PE;for(let Q=0;Q<R.length;Q++){const J=R[Q];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const h=J.age;if(J.age+=this._tempScaledUpdateSpeed,J.age>J.lifeTime){const R=J.age-h,B=J.lifeTime-h;this._tempScaledUpdateSpeed=B*this._tempScaledUpdateSpeed/R,J.age=J.lifeTime}this._ratio=J.age/J.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let y=this._updateQueueStart;for(;y;)y.process(J,this),y=y.nextItem;if(this._isAnimationSheetEnabled&&!q&&J.updateCellIndex(),J._inheritParticleInfoToSubEmitters(),J.age>=J.lifeTime){if(this._emitFromParticle(J),J._attachedSubEmitters){for(const R of J._attachedSubEmitters)R.particleSystem.disposeOnStop=!0,R.particleSystem.stop();J._attachedSubEmitters=null}this.recycleParticle(J),B&&Q--}else;}}}serialize(R){throw new Error("Method not implemented.")}clone(R,J){throw new Error("Method not implemented.")}_addFactorGradient(R,J,B,Q){const h=new v(J,B,Q);R.push(h),R.sort(((R,J)=>R.gradient<J.gradient?-1:R.gradient>J.gradient?1:0))}_removeFactorGradient(R,J){if(!R)return;let B=0;for(const Q of R){if(Q.gradient===J){R.splice(B,1);break}B++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=iR:this._lifeTimeCreation.process=WR}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:XR,previousItem:null,nextItem:null},jR(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(FR(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(R){this.targetStopDuration!==R&&(this._targetStopDuration=R,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(R,J,B){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,R,J,B),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(R){return this._removeFactorGradient(this._lifeTimeGradients,R),this._syncLifeTimeCreation(),this}addSizeGradient(R,J,B){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=dR,this._sizeGradientProcessing={process:cR,previousItem:null,nextItem:null},LR(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,R,J,B),this}removeSizeGradient(R){var J;return this._removeFactorGradient(this._sizeGradients,R),0===(null===(J=this._sizeGradients)||void 0===J?void 0:J.length)&&(FR(this._sizeGradientProcessing),this._sizeCreation.process=HR),this}addColorRemapGradient(R,J,B){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,R,J,B),this}removeColorRemapGradient(R){return this._removeFactorGradient(this._colorRemapGradients,R),this}addAlphaRemapGradient(R,J,B){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,R,J,B),this}removeAlphaRemapGradient(R){return this._removeFactorGradient(this._alphaRemapGradients,R),this}addAngularSpeedGradient(R,J,B){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=GR,this._angularSpeedGradientProcessing={process:qR,previousItem:null,nextItem:null},LR(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,R,J,B),this}removeAngularSpeedGradient(R){var J;return this._removeFactorGradient(this._angularSpeedGradients,R),0===(null===(J=this._angularSpeedGradients)||void 0===J?void 0:J.length)&&(this._angleCreation.process=YR,FR(this._angularSpeedGradientProcessing)),this}addVelocityGradient(R,J,B){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:ER,previousItem:null,nextItem:null},jR(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:nR,previousItem:null,nextItem:null},LR(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,R,J,B),this}removeVelocityGradient(R){var J;return this._removeFactorGradient(this._velocityGradients,R),0===(null===(J=this._velocityGradients)||void 0===J?void 0:J.length)&&(FR(this._velocityCreation),FR(this._velocityGradientProcessing)),this}addLimitVelocityGradient(R,J,B){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:OR,previousItem:null,nextItem:null},jR(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:PR,previousItem:null,nextItem:null},jR(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,R,J,B),this}removeLimitVelocityGradient(R){var J;return this._removeFactorGradient(this._limitVelocityGradients,R),0===(null===(J=this._limitVelocityGradients)||void 0===J?void 0:J.length)&&(FR(this._limitVelocityCreation),FR(this._limitVelocityGradientProcessing)),this}addDragGradient(R,J,B){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:sR,previousItem:null,nextItem:null},LR(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:xR,previousItem:null,nextItem:null},LR(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,R,J,B),this}removeDragGradient(R){var J;return this._removeFactorGradient(this._dragGradients,R),0===(null===(J=this._dragGradients)||void 0===J?void 0:J.length)&&(FR(this._dragCreation),FR(this._dragGradientProcessing)),this}addEmitRateGradient(R,J,B){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,R,J,B),this}removeEmitRateGradient(R){return this._removeFactorGradient(this._emitRateGradients,R),this}addStartSizeGradient(R,J,B){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,R,J,B),this._syncStartSizeCreation(),this}removeStartSizeGradient(R){return this._removeFactorGradient(this._startSizeGradients,R),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const R=new Uint8Array(4*this._rawTextureWidth),J=N.TmpColors.SJ[0];for(let B=0;B<this._rawTextureWidth;B++){const Q=B/this._rawTextureWidth;m.GetCurrentGradient(Q,this._rampGradients,((Q,h,y)=>{N.SJ.LerpToRef(Q.color,h.color,y,J),R[4*B]=255*J.r,R[4*B+1]=255*J.g,R[4*B+2]=255*J.b,R[4*B+3]=255}))}this._rampGradientsTexture=t.b.CreateRGBATexture(R,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((R,J)=>R.gradient<J.gradient?-1:R.gradient>J.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(R,J){this._rampGradients||(this._rampGradients=[]);const B=new K(R,J);return this._rampGradients.push(B),this._syncRampGradientTexture(),this}removeRampGradient(R){return this._removeGradientAndTexture(R,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(R,J,B){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=yR,this._colorProcessing.process=NR);const Q=new w(R,J,B);return this._colorGradients.push(Q),this._colorGradients.sort(((R,J)=>R.gradient<J.gradient?-1:R.gradient>J.gradient?1:0)),this}removeColorGradient(R){if(!this._colorGradients)return this;let J=0;for(const B of this._colorGradients){if(B.gradient===R){this._colorGradients.splice(J,1);break}J++}return 0===this._colorGradients.length&&(this._colorCreation.process=hR,this._colorProcessing.process=rR),this}resetDrawCache(){if(this._drawWrappers){for(const R of this._drawWrappers)if(R)for(const J of R)null===J||void 0===J||J.dispose();this._drawWrappers=[]}}_fetchR(R,J,B,Q,h){return h[4*(((R=.5*Math.abs(R)+.5)*B%B|0)+((J=.5*Math.abs(J)+.5)*Q%Q|0)*B)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const R=this._engine,J=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*J),this._vertexBuffer=new s.d(R,this._vertexData,!0,J);let B=0;const Q=this._vertexBuffer.createVertexBuffer(s.h.PositionKind,B,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.h.PositionKind]=Q,B+=3;const h=this._vertexBuffer.createVertexBuffer(s.h.ColorKind,B,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[s.h.ColorKind]=h,B+=4;const y=this._vertexBuffer.createVertexBuffer("angle",B,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=y,B+=1;const N=this._vertexBuffer.createVertexBuffer("size",B,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=N,B+=2,this._isAnimationSheetEnabled){const R=this._vertexBuffer.createVertexBuffer("cellIndex",B,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=R,B+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const R=this._vertexBuffer.createVertexBuffer("direction",B,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=R,B+=3}if(this._useRampGradients){const R=this._vertexBuffer.createVertexBuffer("remapData",B,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=R,B+=4}let r;if(this._useInstancing){const J=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new s.d(R,J,!1,2),r=this._spriteBuffer.createVertexBuffer("offset",0,2)}else r=this._vertexBuffer.createVertexBuffer("offset",B,2,this._vertexBufferSize,this._useInstancing),B+=2;this._vertexBuffers.offset=r,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const R=[],J=[];let B=0;for(let Q=0;Q<this._capacity;Q++)R.push(B),R.push(B+1),R.push(B+2),R.push(B),R.push(B+2),R.push(B+3),J.push(B,B+1,B+1,B+2,B+2,B+3,B+3,B,B,B+3),B+=4;this._indexBuffer=this._engine.createIndexBuffer(R),this._linesIndexBuffer=this._engine.createIndexBuffer(J)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(R)setTimeout((()=>{this.start(0)}),R);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var J;-1!==(null===(J=this.QJ)||void 0===J?void 0:J.getClassName().indexOf("Mesh"))&&this.QJ.ny(!0);const R=this.noiseTexture;if(R&&R.onGeneratedObservable)R.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let J=0;J<this.preWarmCycles;J++)this.animate(!0),R.render()}))}));else for(let J=0;J<this.preWarmCycles;J++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(R))}_postStop(R){}reset(){this._stockParticles.length=0,this.PE.length=0}_appendParticleVertex(R,J,B,h){let y=R*this._vertexBufferSize;if(this._vertexData[y++]=J.position.x+this.fe.x,this._vertexData[y++]=J.position.y+this.fe.y,this._vertexData[y++]=J.position.z+this.fe.z,this._vertexData[y++]=J.color.r,this._vertexData[y++]=J.color.g,this._vertexData[y++]=J.color.b,this._vertexData[y++]=J.color.a,this._vertexData[y++]=J.angle,this._vertexData[y++]=J.scale.x*J.size,this._vertexData[y++]=J.scale.y*J.size,this._isAnimationSheetEnabled&&(this._vertexData[y++]=J.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[y++]=J.direction.x,this._vertexData[y++]=J.direction.y,this._vertexData[y++]=J.direction.z);else if(J._initialDirection){let R=J._initialDirection;this.isLocal&&(Q.nJ.TransformNormalToRef(R,this._emitterWorldMatrix,Q.TmpVectors.nJ[0]),R=Q.TmpVectors.nJ[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[y++]=R.x,this._vertexData[y++]=R.y,this._vertexData[y++]=R.z}else{let R=J.direction;this.isLocal&&(Q.nJ.TransformNormalToRef(R,this._emitterWorldMatrix,Q.TmpVectors.nJ[0]),R=Q.TmpVectors.nJ[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[y++]=R.x,this._vertexData[y++]=R.y,this._vertexData[y++]=R.z}this._useRampGradients&&J.remapData&&(this._vertexData[y++]=J.remapData.x,this._vertexData[y++]=J.remapData.y,this._vertexData[y++]=J.remapData.z,this._vertexData[y++]=J.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===B?B=this._epsilon:1===B&&(B=1-this._epsilon),0===h?h=this._epsilon:1===h&&(h=1-this._epsilon)),this._vertexData[y++]=B,this._vertexData[y++]=h)}_prepareParticle(R){}_createNewOnes(R){let J;for(let B=0;B<R&&this.PE.length!==this._capacity;B++){J=this._createParticle(),this.PE.push(J);let R=this._createQueueStart;for(;R;)R.process(J,this),R=R.nextItem;J._inheritParticleInfoToSubEmitters()}}_update(R){if(this._alive=this.PE.length>0,this.QJ.position){const R=this.QJ;this._emitterWorldMatrix=R.getWorldMatrix()}else{const R=this.QJ;this._emitterWorldMatrix=Q.Matrix.Translation(R.x,R.y,R.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.PE),this._createNewOnes(R)}static _GetAttributeNamesOrOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=[s.h.PositionKind,s.h.ColorKind,"angle","offset","size"];return R&&Q.push("cellIndex"),J||Q.push("direction"),B&&Q.push("remapData"),Q}static _GetEffectCreationOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,JR.e)(Q),R&&Q.push("particlesInfos"),J&&Q.push("logarithmicDepthConstant"),B&&(Q.push("vFogInfos"),Q.push("vFogColor")),Q}fillDefines(R,J){let B=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,JR.j)(this,this._scene,R),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&R.push("#define FOG")),this._isAnimationSheetEnabled&&R.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&R.push("#define LOGARITHMICDEPTH"),J===q.BLENDMODE_MULTIPLY&&R.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&R.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(R.push("#define BILLBOARD"),this.billboardMode){case 2:R.push("#define BILLBOARDY");break;case 8:case 9:R.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&R.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:R.push("#define BILLBOARDMODE_ALL")}B&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),R.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(R,J,B){J.push(...CR._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),R.push(...CR._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),B.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,QR.e)(R,this._imageProcessingConfigurationDefines),(0,QR.b)(B,this._imageProcessingConfigurationDefines))}_getWrapper(R){const J=this._getCustomDrawWrapper(R);if(null!==J&&void 0!==J&&J.effect)return J;const B=[];this.fillDefines(B,R);const Q=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let h=this._drawWrappers[Q];h||(h=this._drawWrappers[Q]=[]);let y=h[R];y||(y=new RR.c(this._engine),y.drawContext&&(y.drawContext.useInstancing=this._useInstancing),h[R]=y);const N=B.join("\n");if(y.defines!==N){const R=[],J=[],B=[];this.fillUniformsAttributesAndSamplerNames(J,R,B),y.setEffect(this._engine.createEffect("particles",R,J,B,N,void 0,void 0,void 0,void 0,this._shaderLanguage),N)}return y}animate(){var R;let J,B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!B&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(B?this.preWarmStepOffset:(null===(R=this._scene)||void 0===R?void 0:R.getAnimationRatio())||1),this.manualEmitCount>-1)J=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let R=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const J=this._actualFrame/this.targetStopDuration;m.GetCurrentGradient(J,this._emitRateGradients,((J,B,Q)=>{J!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=B.getFactor(),this._currentEmitRateGradient=J),R=(0,e.Lerp)(this._currentEmitRate1,this._currentEmitRate2,Q)}))}J=R*this._scaledUpdateSpeed|0,this._newPartsExcess+=R*this._scaledUpdateSpeed-J}if(this._newPartsExcess>1&&(J+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?J=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(J),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!B){let R=0;for(let J=0;J<this.PE.length;J++){const B=this.PE[J];this._appendParticleVertices(R,B),R+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.PE.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(R,J){this._appendParticleVertex(R++,J,0,0),this._useInstancing||(this._appendParticleVertex(R++,J,1,0),this._appendParticleVertex(R++,J,1,1),this._appendParticleVertex(R++,J,0,1))}rebuild(){var R;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(R=this._spriteBuffer)||void 0===R||R._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!CR.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(B.bind(B,12662)),Promise.resolve().then(B.bind(B,12600))])):await Promise.all([Promise.resolve().then(B.bind(B,12591)),Promise.resolve().then(B.bind(B,12577))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.QJ||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==q.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(q.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(q.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(R){const J=this._getWrapper(R),B=J.effect,h=this._engine;h.enableEffect(J);const y=this.defaultViewMatrix??this._scene.getViewMatrix();if(B.setTexture("diffuseSampler",this.particleTexture),B.setMatrix("view",y),B.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const R=this.particleTexture.getBaseSize();B.setFloat3("particlesInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,this.spriteCellWidth/R.width)}if(B.setVector2("translationPivot",this.translationPivot),B.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const R=this._scene.activeCamera;B.setVector3("eyePosition",R.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),B.setTexture("rampSampler",this._rampGradientsTexture));const N=B.defines;var r,q,e,D,l,E;(this._scene&&((0,JR.g)(B,this,this._scene),this.applyFog&&(0,BR.d)(this._scene,void 0,B)),N.indexOf("#define BILLBOARDMODE_ALL")>=0&&(y.invertToRef(Q.TmpVectors.Matrix[0]),B.setMatrix("invView",Q.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?h.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,B):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,B)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?h.bindBuffers(this._vertexBuffers,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBuffer:this._indexBuffer,B):h.bindBuffers(this._vertexBuffers,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBufferUseInstancing:null,B);(this.useLogarithmicDepth&&this._scene&&(0,BR.i)(N,B,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(B),this._setEngineBasedOnBlendMode(R),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(B),this._useInstancing)?null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?h.drawElementsType(6,0,10,this.PE.length):h.drawArraysType(7,0,4,this.PE.length):null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?h.drawElementsType(1,0,10*this.PE.length):h.drawElementsType(0,0,6*this.PE.length);return this.PE.length}render(){if(!this.isReady()||!this.PE.length)return 0;const R=this._engine;R.setState&&(R.setState(!1),this.forceDepthWrite&&R.setDepthWrite(!0));let J=0;return J=this.blendMode===q.BLENDMODE_MULTIPLYADD?this._render(q.BLENDMODE_MULTIPLY)+this._render(q.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),J}_onDispose(){}dispose(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),R&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),R&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(J,B),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const R=this._scene.OE.indexOf(this);R>-1&&this._scene.OE.splice(R,1),this._scene._activeParticleSystems.dispose()}this.eh.notifyObservers(this),this.eh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}CR.ForceGLSL=!1;var bR,wR=B(11056);!function(R){R[R.ATTACHED=0]="ATTACHED",R[R.END=1]="END"}(bR||(bR={}));class KR{constructor(R){if(this.particleSystem=R,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!R.QJ||!R.QJ.dispose){const J=(0,r.e)("BABYLON.AbstractMesh");R.QJ=new J("SubemitterSystemEmitter",R.IR()),R._disposeEmitterOnDispose=!0}}clone(){let R=this.particleSystem.QJ;if(R){if(R instanceof Q.nJ)R=R.clone();else if(-1!==R.getClassName().indexOf("Mesh")){R=new((0,r.e)("BABYLON.Mesh"))("",R.IR()),R.isVisible=!1}}else R=new Q.nJ;const J=new KR(this.particleSystem.clone(this.particleSystem.name,R));return J.particleSystem.name+="Clone",J.type=this.type,J.inheritDirection=this.inheritDirection,J.inheritedVelocityAmount=this.inheritedVelocityAmount,J.particleSystem._disposeEmitterOnDispose=!0,J.particleSystem.disposeOnStop=!0,J}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const J={};return J.type=this.type,J.inheritDirection=this.inheritDirection,J.inheritedVelocityAmount=this.inheritedVelocityAmount,J.particleSystem=this.particleSystem.serialize(R),J}static _ParseParticleSystem(R,J,B){throw(0,wR.c)("ParseParticle")}static Parse(R,J,B){const Q=R.particleSystem,h=new KR(KR._ParseParticleSystem(Q,J,B,!0));return h.type=R.type,h.inheritDirection=R.inheritDirection,h.inheritedVelocityAmount=R.inheritedVelocityAmount,h.particleSystem._isSubEmitter=!0,h}dispose(){this.particleSystem.dispose()}}var vR=B(11094);function mR(R,J){const B=new u;return B.direction1=R,B.direction2=J,B}function oR(){return new A(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function tR(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ZR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.nJ(0,1,0),B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.nJ(0,1,0);return new f(R,J,B)}function UR(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function RJ(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.nJ(0,1,0),y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.nJ(0,1,0);return new P(R,J,B,h,y)}function JJ(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new E(R,J)}function BJ(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.nJ(0,1,0),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.nJ(0,1,0);return new O(R,J,B,h)}const QJ=Q.nJ.Zero(),hJ=Q.nJ.Zero(),yJ=Q.nJ.Zero();class NJ{constructor(){this.strength=0,this.position=Q.nJ.Zero()}_processParticle(R,J){this.position.subtractToRef(R.position,QJ);const B=QJ.lengthSquared()+1;QJ.normalize().scaleToRef(this.strength/B,hJ),hJ.scaleToRef(J._tempScaledUpdateSpeed,yJ),R.direction.addInPlace(yJ)}serialize(){return{position:this.position.Ch(),strength:this.strength}}}class rJ extends CR{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=R=>{if(!this._subEmitters||0===this._subEmitters.length)return;const J=Math.floor(Math.random()*this._subEmitters.length);for(const B of this._subEmitters[J])if(1===B.type){const J=B.clone();R._inheritParticleInfoToSubEmitter(J),J.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(J.particleSystem),J.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(R,J){const B=mR(R,J);return this.particleEmitterType=B,B}get flowMap(){return this._flowMap}set flowMap(R){this._flowMap!==R&&(this._flowMap=R,this._flowMapUpdate&&(FR(this._flowMapUpdate),this._flowMapUpdate=null),R&&(this._flowMapUpdate={process:R=>{var J;const B=null===(J=this.IR())||void 0===J?void 0:J.getTransformMatrix();this._flowMap._processParticle(R,this.flowMapStrength*this._tempScaledUpdateSpeed,B)},previousItem:null,nextItem:null},jR(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(R){this._attractors.push(R),1===this._attractors.length&&(this._attractorUpdate={process:R=>{for(const J of this._attractors)J._processParticle(R,this)},previousItem:null,nextItem:null},jR(this._attractorUpdate,this._directionProcessing))}removeAttractor(R){const J=this._attractors.indexOf(R);-1!==J&&this._attractors.splice(J,1),0===this._attractors.length&&FR(this._attractorUpdate)}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(R)}createHemisphericEmitter(){const R=oR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createSphereEmitter(){const R=tR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createDirectedSphereEmitter(){const R=ZR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.nJ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.nJ(0,1,0));return this.particleEmitterType=R,R}createCylinderEmitter(){const R=UR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=R,R}createDirectedCylinderEmitter(){const R=RJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.nJ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.nJ(0,1,0));return this.particleEmitterType=R,R}createConeEmitter(){const R=JJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=R,R}createDirectedConeEmitter(){const R=BJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.nJ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.nJ(0,1,0));return this.particleEmitterType=R,R}createBoxEmitter(R,J,B,Q){const h=new l;return this.particleEmitterType=h,this.direction1=R,this.direction2=J,this.minEmitBox=B,this.maxEmitBox=Q,h}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const R of this.subEmitters)R instanceof rJ?this._subEmitters.push([new KR(R)]):R instanceof KR?this._subEmitters.push([R]):R instanceof Array&&this._subEmitters.push(R)}_stopSubEmitters(){if(this.activeSubSystems){for(const R of this.activeSubSystems)R.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const R=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==R&&this._rootParticleSystem.activeSubSystems.splice(R,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(R){R&&this._stopSubEmitters()}_prepareParticle(R){if(this._subEmitters&&this._subEmitters.length>0){const J=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];R._attachedSubEmitters=[];for(const B of J)if(0===B.type){const J=B.clone();R._attachedSubEmitters.push(J),J.particleSystem.start()}}}_onDispose(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),R&&this.particles)for(const B of this.particles)if(B._attachedSubEmitters)for(let R=B._attachedSubEmitters.length-1;R>=0;R-=1)B._attachedSubEmitters[R].dispose();if(J&&this.activeSubSystems)for(let B=this.activeSubSystems.length-1;B>=0;B-=1)this.activeSubSystems[B].dispose();if(this._subEmitters&&this._subEmitters.length){for(let R=0;R<this._subEmitters.length;R++)for(const J of this._subEmitters[R])J.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.QJ&&this.QJ.dispose&&this.QJ.dispose(!0)}static _Parse(R,J,B,h){let y;y=B instanceof vR.c?null:B;const q=(0,r.e)("BABYLON.Texture");if(q&&y&&(R.texture?J.particleTexture=q.Parse(R.texture,y,h):R.textureName&&(J.particleTexture=new q(h+R.textureName,y,!1,void 0===R.invertY||R.invertY),J.particleTexture.name=R.textureName)),R.emitterId||0===R.emitterId||void 0!==R.QJ?R.emitterId&&y?J.QJ=y.getLastMeshById(R.emitterId):J.QJ=Q.nJ.fJ(R.QJ):J.QJ=Q.nJ.Zero(),J.isLocal=!!R.isLocal,void 0!==R.renderingGroupId&&(J.renderingGroupId=R.renderingGroupId),void 0!==R.isBillboardBased&&(J.isBillboardBased=R.isBillboardBased),void 0!==R.billboardMode&&(J.billboardMode=R.billboardMode),void 0!==R.useLogarithmicDepth&&(J.useLogarithmicDepth=R.useLogarithmicDepth),R.animations){for(let B=0;B<R.animations.length;B++){const Q=R.animations[B],h=(0,r.e)("BABYLON.Animation");h&&J.animations.push(h.Parse(Q))}J.beginAnimationOnStart=R.beginAnimationOnStart,J.beginAnimationFrom=R.beginAnimationFrom,J.beginAnimationTo=R.beginAnimationTo,J.beginAnimationLoop=R.beginAnimationLoop}if(R.autoAnimate&&y&&y.beginAnimation(J,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),J.startDelay=0|R.startDelay,J.minAngularSpeed=R.minAngularSpeed,J.maxAngularSpeed=R.maxAngularSpeed,J.minSize=R.minSize,J.maxSize=R.maxSize,R.minScaleX&&(J.minScaleX=R.minScaleX,J.maxScaleX=R.maxScaleX,J.minScaleY=R.minScaleY,J.maxScaleY=R.maxScaleY),void 0!==R.preWarmCycles&&(J.preWarmCycles=R.preWarmCycles,J.preWarmStepOffset=R.preWarmStepOffset),void 0!==R.minInitialRotation&&(J.minInitialRotation=R.minInitialRotation,J.maxInitialRotation=R.maxInitialRotation),J.minLifeTime=R.minLifeTime,J.maxLifeTime=R.maxLifeTime,J.minEmitPower=R.minEmitPower,J.maxEmitPower=R.maxEmitPower,J.emitRate=R.emitRate,J.gravity=Q.nJ.fJ(R.gravity),R.noiseStrength&&(J.noiseStrength=Q.nJ.fJ(R.noiseStrength)),J.color1=N.ar.fJ(R.color1),J.color2=N.ar.fJ(R.color2),J.colorDead=N.ar.fJ(R.colorDead),J.updateSpeed=R.updateSpeed,J.targetStopDuration=R.targetStopDuration,J.blendMode=R.blendMode,R.colorGradients)for(const Q of R.colorGradients)J.addColorGradient(Q.gradient,N.ar.fJ(Q.color1),Q.color2?N.ar.fJ(Q.color2):void 0);if(R.rampGradients){for(const B of R.rampGradients)J.addRampGradient(B.gradient,N.SJ.fJ(B.color));J.useRampGradients=R.useRampGradients}if(R.colorRemapGradients)for(const Q of R.colorRemapGradients)J.addColorRemapGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.alphaRemapGradients)for(const Q of R.alphaRemapGradients)J.addAlphaRemapGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.sizeGradients)for(const Q of R.sizeGradients)J.addSizeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.angularSpeedGradients)for(const Q of R.angularSpeedGradients)J.addAngularSpeedGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.velocityGradients)for(const Q of R.velocityGradients)J.addVelocityGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.dragGradients)for(const Q of R.dragGradients)J.addDragGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.emitRateGradients)for(const Q of R.emitRateGradients)J.addEmitRateGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.startSizeGradients)for(const Q of R.startSizeGradients)J.addStartSizeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.lifeTimeGradients)for(const Q of R.lifeTimeGradients)J.addLifeTimeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(R.limitVelocityGradients){for(const B of R.limitVelocityGradients)J.addLimitVelocityGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);J.limitVelocityDamping=R.limitVelocityDamping}if(R.noiseTexture&&y){const B=(0,r.e)("BABYLON.ProceduralTexture");J.noiseTexture=B.Parse(R.noiseTexture,y,h)}let e;if(R.particleEmitterType){switch(R.particleEmitterType.type){case"SphereParticleEmitter":e=new S;break;case"SphereDirectedParticleEmitter":e=new f;break;case"ConeEmitter":case"ConeParticleEmitter":e=new E;break;case"ConeDirectedParticleEmitter":e=new O;break;case"CylinderParticleEmitter":e=new n;break;case"CylinderDirectedParticleEmitter":e=new P;break;case"HemisphericParticleEmitter":e=new A;break;case"PointParticleEmitter":e=new u;break;case"MeshParticleEmitter":e=new x;break;case"CustomParticleEmitter":e=new a;break;default:e=new l}e.parse(R.particleEmitterType,y)}else e=new l,e.parse(R,y);J.particleEmitterType=e,J.startSpriteCellID=R.startSpriteCellID,J.endSpriteCellID=R.endSpriteCellID,J.spriteCellLoop=R.spriteCellLoop??!0,J.spriteCellWidth=R.spriteCellWidth,J.spriteCellHeight=R.spriteCellHeight,J.spriteCellChangeSpeed=R.spriteCellChangeSpeed,J.spriteRandomStartCell=R.spriteRandomStartCell,J.disposeOnStop=R.disposeOnStop??!1,J.manualEmitCount=R.manualEmitCount??-1}static Parse(R,J,B){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4?arguments[4]:void 0;const r=R.name;let q,e,D=null,l=null;if(J instanceof vR.c?q=J:(e=J,q=e.getEngine()),R.customShader&&q.createEffectForParticles){l=R.customShader;const J=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";D=q.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,J)}const E=new rJ(r,y||R.cr,J,D,R.isAnimationSheetEnabled);if(E.customShader=l,E._rootUrl=B,R.id&&(E.id=R.id),R.subEmitters){E.subEmitters=[];for(const Q of R.subEmitters){const R=[];for(const h of Q)R.push(KR.Parse(h,J,B));E.subEmitters.push(R)}}if(R.attractors)for(const N of R.attractors){const R=new NJ;R.position=Q.nJ.fJ(N.position),R.strength=N.strength,E.addAttractor(R)}return rJ._Parse(R,E,J,B),R.textureMask&&(E.textureMask=N.ar.fJ(R.textureMask)),R.fe&&(E.fe=Q.nJ.fJ(R.fe)),R.preventAutoStart&&(E.preventAutoStart=R.preventAutoStart),h||E.preventAutoStart||E.start(),E}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const J={};if(rJ._Serialize(J,this,R),J.textureMask=this.textureMask.Ch(),J.customShader=this.customShader,J.preventAutoStart=this.preventAutoStart,J.fe=this.fe.Ch(),this.subEmitters){J.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const B of this._subEmitters){const Q=[];for(const J of B)Q.push(J.serialize(R));J.subEmitters.push(Q)}}if(this._attractors&&this._attractors.length){J.attractors=[];for(const R of this._attractors)J.attractors.push(R.serialize())}return J}static _Serialize(R,J,B){if(R.name=J.name,R.id=J.id,R.cr=J.getCapacity(),R.disposeOnStop=J.disposeOnStop,R.manualEmitCount=J.manualEmitCount,J.QJ.position){const B=J.QJ;R.emitterId=B.id}else{const B=J.QJ;R.QJ=B.Ch()}J.particleEmitterType&&(R.particleEmitterType=J.particleEmitterType.serialize()),J.particleTexture&&(B?R.texture=J.particleTexture.serialize():(R.textureName=J.particleTexture.name,R.invertY=!!J.particleTexture._invertY)),R.isLocal=J.isLocal,i.c.AppendSerializedAnimations(J,R),R.beginAnimationOnStart=J.beginAnimationOnStart,R.beginAnimationFrom=J.beginAnimationFrom,R.beginAnimationTo=J.beginAnimationTo,R.beginAnimationLoop=J.beginAnimationLoop,R.startDelay=J.startDelay,R.renderingGroupId=J.renderingGroupId,R.isBillboardBased=J.isBillboardBased,R.billboardMode=J.billboardMode,R.minAngularSpeed=J.minAngularSpeed,R.maxAngularSpeed=J.maxAngularSpeed,R.minSize=J.minSize,R.maxSize=J.maxSize,R.minScaleX=J.minScaleX,R.maxScaleX=J.maxScaleX,R.minScaleY=J.minScaleY,R.maxScaleY=J.maxScaleY,R.minEmitPower=J.minEmitPower,R.maxEmitPower=J.maxEmitPower,R.minLifeTime=J.minLifeTime,R.maxLifeTime=J.maxLifeTime,R.emitRate=J.emitRate,R.gravity=J.gravity.Ch(),R.noiseStrength=J.noiseStrength.Ch(),R.color1=J.color1.Ch(),R.color2=J.color2.Ch(),R.colorDead=J.colorDead.Ch(),R.updateSpeed=J.updateSpeed,R.targetStopDuration=J.targetStopDuration,R.blendMode=J.blendMode,R.preWarmCycles=J.preWarmCycles,R.preWarmStepOffset=J.preWarmStepOffset,R.minInitialRotation=J.minInitialRotation,R.maxInitialRotation=J.maxInitialRotation,R.startSpriteCellID=J.startSpriteCellID,R.spriteCellLoop=J.spriteCellLoop,R.endSpriteCellID=J.endSpriteCellID,R.spriteCellChangeSpeed=J.spriteCellChangeSpeed,R.spriteCellWidth=J.spriteCellWidth,R.spriteCellHeight=J.spriteCellHeight,R.spriteRandomStartCell=J.spriteRandomStartCell,R.isAnimationSheetEnabled=J.isAnimationSheetEnabled,R.useLogarithmicDepth=J.useLogarithmicDepth;const Q=J.getColorGradients();if(Q){R.colorGradients=[];for(const J of Q){const B={gradient:J.gradient,color1:J.color1.Ch()};J.color2?B.color2=J.color2.Ch():B.color2=J.color1.Ch(),R.colorGradients.push(B)}}const h=J.getRampGradients();if(h){R.rampGradients=[];for(const J of h){const B={gradient:J.gradient,color:J.color.Ch()};R.rampGradients.push(B)}R.useRampGradients=J.useRampGradients}const y=J.getColorRemapGradients();if(y){R.colorRemapGradients=[];for(const J of y){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.colorRemapGradients.push(B)}}const N=J.getAlphaRemapGradients();if(N){R.alphaRemapGradients=[];for(const J of N){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.alphaRemapGradients.push(B)}}const r=J.getSizeGradients();if(r){R.sizeGradients=[];for(const J of r){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.sizeGradients.push(B)}}const q=J.getAngularSpeedGradients();if(q){R.angularSpeedGradients=[];for(const J of q){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.angularSpeedGradients.push(B)}}const e=J.getVelocityGradients();if(e){R.velocityGradients=[];for(const J of e){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.velocityGradients.push(B)}}const D=J.getDragGradients();if(D){R.dragGradients=[];for(const J of D){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.dragGradients.push(B)}}const l=J.getEmitRateGradients();if(l){R.emitRateGradients=[];for(const J of l){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.emitRateGradients.push(B)}}const E=J.getStartSizeGradients();if(E){R.startSizeGradients=[];for(const J of E){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.startSizeGradients.push(B)}}const O=J.getLifeTimeGradients();if(O){R.lifeTimeGradients=[];for(const J of O){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.lifeTimeGradients.push(B)}}const n=J.getLimitVelocityGradients();if(n){R.limitVelocityGradients=[];for(const J of n){const B={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?B.factor2=J.factor2:B.factor2=J.factor1,R.limitVelocityGradients.push(B)}R.limitVelocityDamping=J.limitVelocityDamping}J.noiseTexture&&(R.noiseTexture=J.noiseTexture.serialize())}clone(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q={...this._customWrappers};let h=null;const y=this._engine;if(y.createEffectForParticles&&null!=this.customShader){h=this.customShader;const R=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"",J=y.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,R);Q[0]?Q[0].effect=J:this.setCustomEffect(J,0)}const N=this.serialize(B),r=rJ.Parse(N,this._scene||this._engine,this._rootUrl);return r.name=R,r.customShader=h,r._customWrappers=Q,void 0===J&&(J=this.QJ),this.noiseTexture&&(r.noiseTexture=this.noiseTexture.clone()),r.QJ=J,this.preventAutoStart||r.start(),r}}rJ.BILLBOARDMODE_Y=2,rJ.BILLBOARDMODE_ALL=7,rJ.BILLBOARDMODE_STRETCHED=8,rJ.BILLBOARDMODE_STRETCHED_LOCAL=9,KR._ParseParticleSystem=rJ.Parse;var qJ=B(11428),eJ=B(11419),DJ=B(11310);DJ.d.prototype.createTransformFeedback=function(){const R=this._gl.createTransformFeedback();if(!R)throw new Error("Unable to create Transform Feedback");return R},DJ.d.prototype.deleteTransformFeedback=function(R){this._gl.deleteTransformFeedback(R)},DJ.d.prototype.bindTransformFeedback=function(R){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,R)},DJ.d.prototype.beginTransformFeedback=function(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(R?this._gl.POINTS:this._gl.TRIANGLES)},DJ.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},DJ.d.prototype.setTranformFeedbackVaryings=function(R,J){this._gl.transformFeedbackVaryings(R,J,this._gl.INTERLEAVED_ATTRIBS)},DJ.d.prototype.bindTransformFeedbackBuffer=function(R){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,R?R.underlyingResource:null)},DJ.d.prototype.readTransformFeedbackBuffer=function(R){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,R)};const lJ="clipPlaneFragmentDeclaration2",EJ="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";V.c.IncludesShadersStore[lJ]||(V.c.IncludesShadersStore[lJ]=EJ);B(12482),B(12484),B(12487),B(12490),B(12493),B(12502),B(12511),B(12513);const OJ="gpuRenderParticlesPixelShader",nJ="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";V.c.ShadersStore[OJ]||(V.c.ShadersStore[OJ]=nJ);const PJ="clipPlaneVertexDeclaration2",AJ="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";V.c.IncludesShadersStore[PJ]||(V.c.IncludesShadersStore[PJ]=AJ);B(12521),B(12527),B(12535),B(12541);const uJ="gpuRenderParticlesVertexShader",SJ="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";V.c.ShadersStore[uJ]||(V.c.ShadersStore[uJ]=SJ);class fJ extends q{static get IsSupported(){if(!Z.e.LastCreatedEngine)return!1;const R=Z.e.LastCreatedEngine.getCaps();return R.supportTransformFeedbacks||R.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(R){this._maxActiveParticleCount=Math.min(R,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(R){this.maxActiveParticleCount=R}createPointEmitter(R,J){const B=mR(R,J);return this.particleEmitterType=B,B}createHemisphericEmitter(){const R=oR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createSphereEmitter(){const R=tR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createDirectedSphereEmitter(){const R=ZR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.nJ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.nJ(0,1,0));return this.particleEmitterType=R,R}createCylinderEmitter(){const R=UR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=R,R}createDirectedCylinderEmitter(){const R=RJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.nJ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.nJ(0,1,0));return this.particleEmitterType=R,R}createConeEmitter(){const R=JJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=R,R}createDirectedConeEmitter(){const R=BJ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.nJ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.nJ(0,1,0));return this.particleEmitterType=R,R}createBoxEmitter(R,J,B,Q){const h=new l;return this.particleEmitterType=h,this.direction1=R,this.direction2=J,this.minEmitBox=B,this.maxEmitBox=Q,h}get flowMap(){return this._flowMap}set flowMap(R){this._flowMap!==R&&(this._flowMap=R)}isReady(){if(!this.QJ||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==rJ.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(rJ.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(rJ.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";R?setTimeout((()=>{this.start(0)}),R):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var R;let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._customWrappers[J])||void 0===R?void 0:R.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[R]??this._customWrappers[0]}setCustomEffect(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[J]=new RR.c(this._engine),this._customWrappers[J].effect=R}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new o.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(R,J,B){return super._removeGradientAndTexture(R,J,B),this._releaseBuffers(),this}addColorGradient(R,J){this._colorGradients||(this._colorGradients=[]);const B=new w(R,J);return this._colorGradients.push(B),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(R&&this._colorGradients.sort(((R,J)=>R.gradient<J.gradient?-1:R.gradient>J.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(R){return this._removeGradientAndTexture(R,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const J in this._drawWrappers){var R;null===(R=this._drawWrappers[J].drawContext)||void 0===R||R.reset()}}_addFactorGradient(R,J,B){const Q=new v(J,B);R.push(Q),this._releaseBuffers()}addSizeGradient(R,J){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,R,J),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(R){return this._removeGradientAndTexture(R,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(R,J){if(!R)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&R.sort(((R,J)=>R.gradient<J.gradient?-1:R.gradient>J.gradient?1:0));const B=this;B[J]&&(B[J].dispose(),B[J]=null)}addAngularSpeedGradient(R,J){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,R,J),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(R){return this._removeGradientAndTexture(R,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(R,J){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,R,J),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(R){return this._removeGradientAndTexture(R,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(R,J){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,R,J),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(R){return this._removeGradientAndTexture(R,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(R,J){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,R,J),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(R){return this._removeGradientAndTexture(R,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(R){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(R,J,B){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(R),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.eh=new o.e,this.onStoppedObservable=new o.e,this.onStartedObservable=new o.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,B&&"Scene"!==B.getClassName()?(this._engine=B,this.defaultProjectionMatrix=Q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=B||Z.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.OE.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,r.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,r.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,r.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,r.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new RR.c(this._engine)},this._customWrappers[0].effect=h,this._drawWrappers={0:new RR.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(J=J??{}).randomTextureSize||delete J.randomTextureSize;const N={cr:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...J},q=J;isFinite(q)&&(N.cr=q),this._capacity=N.cr,this._maxActiveParticleCount=N.cr,this._currentActiveCount=0,this._isAnimationSheetEnabled=y,this.particleEmitterType=new l;const e=Math.min(this._engine.getCaps().maxTextureSize,N.randomTextureSize);let D=[];for(let Q=0;Q<e;++Q)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture=new t.b(new Float32Array(D),e,1,5,B,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,D=[];for(let Q=0;Q<e;++Q)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture2=new t.b(new Float32Array(D),e,1,5,B,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=e}_reset(){this._releaseBuffers()}_createVertexBuffers(R,J,B){const Q={};Q.position=J.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let h=3;Q.age=J.createVertexBuffer("age",h,1,this._attributesStrideSize,!0),h+=1,Q.size=J.createVertexBuffer("size",h,3,this._attributesStrideSize,!0),h+=3,Q.life=J.createVertexBuffer("life",h,1,this._attributesStrideSize,!0),h+=1,h+=4,this.billboardMode===rJ.BILLBOARDMODE_STRETCHED&&(Q.direction=J.createVertexBuffer("direction",h,3,this._attributesStrideSize,!0)),h+=3,this._platform.alignDataInBuffer&&(h+=1),this.particleEmitterType instanceof a&&(h+=3,this._platform.alignDataInBuffer&&(h+=1)),this._colorGradientsTexture||(Q.color=J.createVertexBuffer("color",h,4,this._attributesStrideSize,!0),h+=4),this._isBillboardBased||(Q.initialDirection=J.createVertexBuffer("initialDirection",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1)),this.noiseTexture&&(Q.noiseCoordinates1=J.createVertexBuffer("noiseCoordinates1",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1),Q.noiseCoordinates2=J.createVertexBuffer("noiseCoordinates2",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1)),Q.angle=J.createVertexBuffer("angle",h,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?h++:h+=2,this._isAnimationSheetEnabled&&(Q.cellIndex=J.createVertexBuffer("cellIndex",h,1,this._attributesStrideSize,!0),h+=1,this.spriteRandomStartCell&&(Q.cellStartOffset=J.createVertexBuffer("cellStartOffset",h,1,this._attributesStrideSize,!0),h+=1)),Q.offset=B.createVertexBuffer("offset",0,2),Q.uv=B.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(Q),this._platform.createVertexBuffers(R,Q),this.resetDrawCache()}_initialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!R)return;const J=this._engine,B=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof a&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const h=this.particleEmitterType instanceof a,y=Q.TmpVectors.nJ[0];let N=0;for(let Q=0;Q<this._capacity;Q++)if(B.push(0),B.push(0),B.push(0),B.push(0),B.push(0),B.push(0),B.push(0),B.push(0),B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),h?(this.particleEmitterType.particleDestinationGenerator(Q,null,y),B.push(y.x),B.push(y.y),B.push(y.z)):(B.push(0),B.push(0),B.push(0)),this._platform.alignDataInBuffer&&B.push(0),N+=16,h&&(this.particleEmitterType.particlePositionGenerator(Q,null,y),B.push(y.x),B.push(y.y),B.push(y.z),this._platform.alignDataInBuffer&&B.push(0),N+=4),this._colorGradientsTexture||(B.push(0),B.push(0),B.push(0),B.push(0),N+=4),this.isBillboardBased||(B.push(0),B.push(0),B.push(0),this._platform.alignDataInBuffer&&B.push(0),N+=4),this.noiseTexture&&(B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),this._platform.alignDataInBuffer&&B.push(0),B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),this._platform.alignDataInBuffer&&B.push(0),N+=8),B.push(0),N+=1,this._angularSpeedGradientsTexture||(B.push(0),N+=1),this._isAnimationSheetEnabled&&(B.push(0),N+=1,this.spriteRandomStartCell&&(B.push(0),N+=1)),this._platform.alignDataInBuffer){let R=3-(N+3&3);for(N+=R;R-- >0;)B.push(0)}const r=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),q=this._platform.createParticleBuffer(B),e=this._platform.createParticleBuffer(B);this._buffer0=new s.d(J,q,!1,this._attributesStrideSize),this._buffer1=new s.d(J,e,!1,this._attributesStrideSize),this._spriteBuffer=new s.d(J,r,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let R=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(R+="\n#define BILLBOARD"),this._colorGradientsTexture&&(R+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(R+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(R+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(R+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(R+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(R+="\n#define DRAGGRADIENTS"),this._flowMap&&(R+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(R+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(R+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(R+="\n#define NOISE"),this.isLocal&&(R+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===R||(this._cachedUpdateDefines=R,this._updateBuffer=this._platform.createUpdateBuffer(R)),this._platform.isUpdateBufferReady()}_getWrapper(R){const J=this._getCustomDrawWrapper(R);if(null!==J&&void 0!==J&&J.effect)return J;const B=[];this.fillDefines(B,R);let Q=this._drawWrappers[R];Q||(Q=new RR.c(this._engine),Q.drawContext&&(Q.drawContext.useInstancing=!0),this._drawWrappers[R]=Q);const h=B.join("\n");if(Q.defines!==h){const R=[],J=[],B=[];this.fillUniformsAttributesAndSamplerNames(J,R,B),Q.setEffect(this._engine.createEffect("gpuRenderParticles",R,J,B,h),h)}return Q}static _GetAttributeNamesOrOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=[s.h.PositionKind,"age","life","size","angle"];return R||h.push(s.h.ColorKind),J&&h.push("cellIndex"),B||h.push("initialDirection"),Q&&h.push("direction"),h.push("offset",s.h.UVKind),h}static _GetEffectCreationOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=["emitterWM","fe","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,JR.e)(Q),R&&Q.push("sheetInfos"),J&&Q.push("logarithmicDepthConstant"),B&&(Q.push("vFogInfos"),Q.push("vFogColor")),Q}fillDefines(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,JR.j)(this,this._scene,R),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==eJ.d.FOGMODE_NONE&&R.push("#define FOG")),J===rJ.BLENDMODE_MULTIPLY&&R.push("#define BLENDMULTIPLYMODE"),this.isLocal&&R.push("#define LOCAL"),this.useLogarithmicDepth&&R.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(R.push("#define BILLBOARD"),this.billboardMode){case rJ.BILLBOARDMODE_Y:R.push("#define BILLBOARDY");break;case rJ.BILLBOARDMODE_STRETCHED:R.push("#define BILLBOARDSTRETCHED");break;case rJ.BILLBOARDMODE_ALL:R.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&R.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&R.push("#define ANIMATESHEET"),B&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),R.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(R,J,B){J.push(...fJ._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===rJ.BILLBOARDMODE_STRETCHED)),R.push(...fJ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),B.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(qJ.e.PrepareUniforms(R,this._imageProcessingConfigurationDefines),qJ.e.PrepareSamplers(B,this._imageProcessingConfigurationDefines))}animate(){var R;let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(J?this.preWarmStepOffset:(null===(R=this._scene)||void 0===R?void 0:R.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(R,J){const B=this[J];if(!R||!R.length||B)return;const Q=new Float32Array(this._rawTextureWidth);for(let h=0;h<this._rawTextureWidth;h++){const J=h/this._rawTextureWidth;m.GetCurrentGradient(J,R,((R,J,B)=>{Q[h]=(0,e.Lerp)(R.factor1,J.factor1,B)}))}this[J]=t.b.CreateRTexture(Q,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[J].name=J.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const R=new Uint8Array(4*this._rawTextureWidth),J=N.TmpColors.ar[0];for(let B=0;B<this._rawTextureWidth;B++){const Q=B/this._rawTextureWidth;m.GetCurrentGradient(Q,this._colorGradients,((Q,h,y)=>{N.ar.LerpToRef(Q.color1,h.color1,y,J),R[4*B]=255*J.r,R[4*B+1]=255*J.g,R[4*B+2]=255*J.b,R[4*B+3]=255*J.a}))}this._colorGradientsTexture=t.b.CreateRGBATexture(R,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(R,J){var B,h,y,N;const r=this._getWrapper(R),q=r.effect;this._engine.enableEffect(r);const e=(null===(B=this._scene)||void 0===B?void 0:B.getViewMatrix())||Q.Matrix.IdentityReadOnly;if(q.setMatrix("view",e),q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),q.setTexture("diffuseSampler",this.particleTexture),q.setVector2("translationPivot",this.translationPivot),q.setVector3("fe",this.fe),this.isLocal&&q.setMatrix("emitterWM",J),this._colorGradientsTexture?q.setTexture("colorGradientSampler",this._colorGradientsTexture):q.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const R=this.particleTexture.getBaseSize();q.setFloat3("sheetInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,R.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const R=this._scene.activeCamera;q.setVector3("eyePosition",R.globalPosition)}const D=q.defines;if(this._scene&&((0,JR.g)(q,this,this._scene),this.applyFog&&(0,BR.d)(this._scene,void 0,q)),D.indexOf("#define BILLBOARDMODE_ALL")>=0){const R=e.clone();R.invert(),q.setMatrix("invView",R)}return this.useLogarithmicDepth&&this._scene&&(0,BR.i)(D,q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(q),this._setEngineBasedOnBlendMode(R),this._platform.bindDrawBuffers(this._targetIndex,q,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(q),null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(N=this._scene)&&void 0!==N&&N.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(R){if(!this.QJ||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!R)if(this.QJ.position){R=this.QJ.getWorldMatrix()}else{const J=this.QJ;R=Q.TmpVectors.Matrix[0],Q.Matrix.TranslationToRef(J.x,J.y,J.z,R)}const J=this._engine,B=J.getDepthWrite();if(J.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const R=this.IR();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",R.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",R),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const h=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=h,J.setDepthWrite(B)}render(){let R,J=arguments.length>0&&void 0!==arguments[0]&&arguments[0],B=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!J&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let R=0;R<this.preWarmCycles;R++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const R=0|this._accumulatedCount;this._accumulatedCount-=R,this._currentActiveCount+=R}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.QJ.position){R=this.QJ.getWorldMatrix()}else{const J=this.QJ;R=Q.TmpVectors.Matrix[0],Q.Matrix.TranslationToRef(J.x,J.y,J.z,R)}const h=this._engine;this.updateInAnimate||this._update(R);let y=0;return J||B||(h.setState(!1),this.forceDepthWrite&&h.setDepthWrite(!0),y=this.blendMode===rJ.BLENDMODE_MULTIPLYADD?this._render(rJ.BLENDMODE_MULTIPLY,R)+this._render(rJ.BLENDMODE_ADD,R):this._render(this.blendMode,R),this._engine.setAlphaMode(0)),y}rebuild(){const R=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(R,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,R()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const J in this._drawWrappers){this._drawWrappers[J].dispose()}if(this._drawWrappers={},this._scene){const R=this._scene.OE.indexOf(this);R>-1&&this._scene.OE.splice(R,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let J=0;J<this._renderVertexBuffers.length;++J){const R=this._renderVertexBuffers[J];for(const J in R)R[J].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),R&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),R&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.eh.notifyObservers(this),this.eh.clear()}clone(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q={...this._customWrappers};let h=null;const y=this._engine;if(y.createEffectForParticles&&null!=this.customShader){h=this.customShader;const R=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"";Q[0]=y.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,R,void 0,void 0,void 0,this)}const N=this.serialize(B),r=fJ.Parse(N,this._scene||this._engine,this._rootUrl);return r.name=R,r.customShader=h,r._customWrappers=Q,void 0===J&&(J=this.QJ),this.noiseTexture&&(r.noiseTexture=this.noiseTexture.clone()),r.QJ=J,r}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const J={};return rJ._Serialize(J,this,R),J.activeParticleCount=this.activeParticleCount,J.randomTextureSize=this._randomTextureSize,J.customShader=this.customShader,J}static Parse(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0;const y=R.name;let N,r;J instanceof vR.c?N=J:(r=J,N=r.getEngine());const q=new fJ(y,{cr:h||R.cr,randomTextureSize:R.randomTextureSize},J,null,R.isAnimationSheetEnabled);if(q._rootUrl=B,R.customShader&&N.createEffectForParticles){const J=R.customShader,B=J.shaderOptions.defines.length>0?J.shaderOptions.defines.join("\n"):"",Q=N.createEffectForParticles(J.shaderPath.fragmentElement,J.shaderOptions.uniforms,J.shaderOptions.samplers,B,void 0,void 0,void 0,q);q.setCustomEffect(Q,0),q.customShader=J}return R.id&&(q.id=R.id),R.activeParticleCount&&(q.activeParticleCount=R.activeParticleCount),rJ._Parse(R,q,J,B),R.preventAutoStart&&(q.preventAutoStart=R.preventAutoStart),Q||q.preventAutoStart||q.start(),q}}var aJ=B(11030),sJ=B(12548),xJ=B(11551);class IJ{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(R){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const J of this.systems)J.QJ=R;this._emitterNode=R}setEmitterAsSphere(R,J,B){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:R,renderingGroupId:J};const Q=(0,sJ.c)("emitterSphere",{diameter:R.diameter,segments:R.segments},B);Q.renderingGroupId=J;const h=new xJ.uJ("emitterSphereMaterial",B);h.emissiveColor=R.color,Q.material=h;for(const y of this.systems)y.QJ=Q;this._emitterNode=Q}start(R){for(const J of this.systems)R&&(J.QJ=R),J.start()}dispose(){for(const R of this.systems)R.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const J={systems:[]};for(const B of this.systems)J.systems.push(B.serialize(R));return this._emitterNode&&(J.QJ=this._emitterCreationOptions),J}static Parse(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;const h=new IJ,y=this.BaseAssetsUrl+"/textures/";J=J||Z.e.LastCreatedScene;for(const N of R.systems)h.systems.push(B?fJ.Parse(N,J,y,!0,Q):rJ.Parse(N,J,y,!0,Q));if(R.QJ){const B=R.QJ.options;if("Sphere"===R.QJ.kind)h.setEmitterAsSphere({diameter:B.diameter,segments:B.segments,color:N.SJ.fJ(B.color)},R.QJ.renderingGroupId,J)}return h}}IJ.BaseAssetsUrl="https://assets.babylonjs.com/particles";var VJ=B(11060);class MJ{static CreateDefault(R){let J,B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,Q=arguments.length>2?arguments[2]:void 0;J=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new fJ("default system",{cr:B},Q):new rJ("default system",B,Q),J.QJ=R;const h=aJ.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return J.particleTexture=new W.d(h,J.IR()),J.createConeEmitter(.1,Math.PI/4),J.color1=new N.ar(1,1,1,1),J.color2=new N.ar(1,1,1,1),J.colorDead=new N.ar(1,1,1,0),J.minSize=.1,J.maxSize=.1,J.minEmitPower=2,J.maxEmitPower=2,J.updateSpeed=1/60,J.emitRate=30,J}static CreateAsync(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;J||(J=Z.e.LastCreatedScene);const h={};return J.addPendingData(h),new Promise(((y,N)=>{if(B&&!fJ.IsSupported)return J.removePendingData(h),N("Particle system with GPU is not supported.");aJ.Tools.LoadFile(`${MJ.BaseAssetsUrl}/systems/${R}.json`,(R=>{J.removePendingData(h);const N=JSON.parse(R.toString());return y(IJ.Parse(N,J,B,Q))}),void 0,void 0,void 0,(()=>(J.removePendingData(h),N(`An error occurred with the creation of your particle system. Check if your type '${R}' exists.`))))}))}static ExportSet(R){const J=new IJ;for(const B of R)J.systems.push(B);return J}static ParseFromFileAsync(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",y=arguments.length>5?arguments[5]:void 0;return new Promise(((N,r)=>{const q=new VJ.c;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const J=JSON.parse(q.responseText);let r;r=Q?fJ.Parse(J,B,h,!1,y):rJ.Parse(J,B,h,!1,y),R&&(r.name=R),N(r)}else r("Unable to load the particle system")})),q.open("GET",J),q.send()}))}static ParseFromSnippetAsync(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",h=arguments.length>4?arguments[4]:void 0;if("_BLANK"===R){const R=this.CreateDefault(null);return R.start(),Promise.resolve(R)}return new Promise(((y,N)=>{const r=new VJ.c;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const N=JSON.parse(JSON.parse(r.responseText).jsonPayload),q=JSON.parse(N.particleSystem);let e;e=B?fJ.Parse(q,J,Q,!1,h):rJ.Parse(q,J,Q,!1,h),e.snippetId=R,y(e)}else N("Unable to load the snippet "+R)})),r.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),r.send()}))}}MJ.BaseAssetsUrl=IJ.BaseAssetsUrl,MJ.SnippetUrl="https://snippet.babylonjs.com",MJ.CreateFromSnippetAsync=MJ.ParseFromSnippetAsync;var HJ=B(11628),dJ=B(11447),XJ=B(12554);(0,XJ.c)(dJ.b.NAME_PARTICLESYSTEM,((R,J,B,Q)=>{const h=(0,XJ.f)(dJ.b.NAME_PARTICLESYSTEM);if(h&&void 0!==R.OE&&null!==R.OE)for(let y=0,N=R.OE.length;y<N;y++){const N=R.OE[y];B.OE.push(h(N,J,Q))}})),(0,XJ.b)(dJ.b.NAME_PARTICLESYSTEM,((R,J,B)=>{if(R.activeParticleCount){return fJ.Parse(R,J,B)}return rJ.Parse(R,J,B)})),vR.c.prototype.createEffectForParticles=function(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",y=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,q=arguments.length>7?arguments[7]:void 0,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>9?arguments[9]:void 0,l=[],E=[];const O=[];return q?q.fillUniformsAttributesAndSamplerNames(E,l,O):(l=rJ._GetAttributeNamesOrOptions(),E=rJ._GetEffectCreationOptions()),-1===h.indexOf(" BILLBOARD")&&(h+="\n#define BILLBOARD\n"),null!==q&&void 0!==q&&q.isAnimationSheetEnabled&&-1===h.indexOf(" ANIMATESHEET")&&(h+="\n#define ANIMATESHEET\n"),-1===Q.indexOf("diffuseSampler")&&Q.push("diffuseSampler"),this.createEffect({vertex:D??(null===q||void 0===q?void 0:q.vertexShaderName)??"particles",fragmentElement:R},l,E.concat(J),O.concat(Q),h,y,N,r,void 0,e,(async()=>{0===e?await Promise.resolve().then(B.bind(B,12591)):await Promise.resolve().then(B.bind(B,12662))}))},HJ.e.prototype.getEmittedParticleSystems=function(){const R=[];for(let J=0;J<this.IR().OE.length;J++){const B=this.IR().OE[J];B.QJ===this&&R.push(B)}return R},HJ.e.prototype.getHierarchyEmittedParticleSystems=function(){const R=[],J=this.getDescendants();J.push(this);for(let B=0;B<this.IR().OE.length;B++){const Q=this.IR().OE[B],h=Q.QJ;h.position&&-1!==J.indexOf(h)&&R.push(Q)}return R};B(11517),B(11533),B(11604);B(11613),B(12558),B(11381),B(11507),B(11650);B(11374);var cJ;B(12567),B(11209);!function(R){R[R.Color=2]="Color",R[R.UV=1]="UV",R[R.Random=0]="Random",R[R.Stated=3]="Stated"}(cJ||(cJ={}));var zJ=B(11408);const pJ=new Q.nJ(0,0,0),iJ=new Q.nJ(0,0,0),WJ=new Q.nJ(0,0,0);class kJ{constructor(R,J,B){this.width=R,this.height=J,this.data=B}processFlowable(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,B=arguments.length>2?arguments[2]:void 0;if(!B)return;B instanceof Q.Matrix?Q.nJ.TransformCoordinatesToRef(R.position,B,WJ):(WJ.x=B.x,WJ.y=B.y,WJ.z=B.z);const h=.5*WJ.x+.5,y=1-(.5*WJ.y+.5),N=Math.floor(h*this.width),r=Math.floor(y*this.height);if(N<0||N>=this.width||r<0||r>=this.height)return;const q=4*(r*this.width+N),e=this.data[q]/255*2-1,D=this.data[q+1]/255*2-1,l=this.data[q+2]/255*2-1,E=this.data[q+3]/255;pJ.set(e,D,l),pJ.scaleToRef(J*E,iJ),R.direction.addInPlace(iJ)}_processParticle(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,B=arguments.length>2?arguments[2]:void 0;this.processFlowable(R,J,B)}static async FromUrlAsync(R){return await new Promise(((J,B)=>{const Q=document.createElement("canvas"),h=Q.getContext("2d");let y=null;const N=new Image;N.crossOrigin="anonymous",N.src=R,N.onerror=J=>{B(new Error(`Failed to load image: ${R} : ${J}`))},N.onload=()=>{Q.width=N.width,Q.height=N.height,h.drawImage(N,0,0),y=h.getImageData(0,0,Q.width,Q.height),J(new kJ(Q.width,Q.height,y.data))}}))}static async ExtractFromTextureAsync(R){return await new Promise(((J,B)=>{if(!R.isReady())return void R.onLoadObservable.addOnce((async()=>{try{const B=await this.ExtractFromTextureAsync(R);J(B)}catch(Q){B(Q)}}));const Q=R.getSize();zJ.j.GetTextureDataAsync(R,Q.width,Q.height).then((R=>{J(new kJ(Q.width,Q.height,new Uint8ClampedArray(R)))})).catch(B)}))}}var YJ,GJ,gJ,LJ,jJ,TJ,FJ,CJ,bJ;!function(R){R[R.Int=1]="Int",R[R.Float=2]="Float",R[R.Vector2=4]="Vector2",R[R.nJ=8]="nJ",R[R.Matrix=16]="Matrix",R[R.Particle=32]="Particle",R[R.Texture=64]="Texture",R[R.ar=128]="ar",R[R.FloatGradient=256]="FloatGradient",R[R.Vector2Gradient=512]="Vector2Gradient",R[R.Vector3Gradient=1024]="Vector3Gradient",R[R.Color4Gradient=2048]="Color4Gradient",R[R.System=4096]="System",R[R.AutoDetect=8192]="AutoDetect",R[R.BasedOnInput=16384]="BasedOnInput",R[R.Undefined=32768]="Undefined",R[R.All=65535]="All"}(YJ||(YJ={})),function(R){R[R.Compatible=0]="Compatible",R[R.TypeIncompatible=1]="TypeIncompatible",R[R.HierarchyIssue=2]="HierarchyIssue"}(GJ||(GJ={})),function(R){R[R.Input=0]="Input",R[R.Output=1]="Output"}(gJ||(gJ={}));class wJ{get direction(){return this._direction}get type(){if(this._type===YJ.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===YJ.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(R){this._type=R}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((R=>R.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(R,J,B){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=YJ.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new o.e,this.onDisconnectionObservable=new o.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=J,this.name=R,this._direction=B}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(R){var J;return this.isConnected?null!==(J=this._connectedPoint)&&void 0!==J&&J._storedFunction?this._connectedPoint._storedFunction(R):this._connectedPoint._storedValue:this.value}canConnectTo(R){return 0===this.checkCompatibilityState(R)}checkCompatibilityState(R){const J=this._ownerBlock,B=R.ownerBlock;if(this.type!==R.type&&R.innerType!==YJ.AutoDetect)return R.acceptedConnectionPointTypes&&-1!==R.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(R.excludedConnectionPointTypes&&-1!==R.excludedConnectionPointTypes.indexOf(this.type))return 1;let Q=B,h=J;return 0===this.direction&&(Q=J,h=B),Q.isAnAncestorOf(h)?2:0}connectTo(R){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(R))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${R.ownerBlock.name}".${R.name}`;return this._endpoints.push(R),R._connectedPoint=this,this.onConnectionObservable.notifyObservers(R),R.onConnectionObservable.notifyObservers(this),this}disconnectFrom(R){const J=this._endpoints.indexOf(R);return-1===J||(this._endpoints.splice(J,1),R._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(R),R.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(R){let J=1;for(;J<YJ.All;)R&J||this.excludedConnectionPointTypes.push(J),J<<=1}serialize(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const J={};return J.name=this.name,J.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ch?(J.valueType="BABYLON."+this.value.getClassName(),J.value=this.value.Ch()):(J.valueType="number",J.value=this.value)),R&&this.connectedPoint&&(J.inputName=this.name,J.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,J.targetConnectionName=this.connectedPoint.name,J.isExposedOnFrame=!0,J.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(J.isExposedOnFrame=!0,J.exposedPortPosition=this.exposedPortPosition),J}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class KJ{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(R){this._name=R}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(R){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new o.e,this.eh=new o.e,this.onInputChangedObservable=new o.e,this.visibleOnFrame=!1,this._name=R,this.uniqueId=k.d.UniqueId}_inputRename(R){return R}_outputRename(R){return R}isAnAncestorOf(R){for(const J of this._outputs)if(J.hasEndpoints)for(const B of J.endpoints){if(B.ownerBlock===R)return!0;if(B.ownerBlock.isAnAncestorOf(R))return!0}return!1}isAnAncestorOfType(R){if(this.getClassName()===R)return!0;for(const J of this._outputs)if(J.hasEndpoints)for(const B of J.endpoints)if(B.ownerBlock.isAnAncestorOfType(R))return!0;return!1}getInputByName(R){const J=this._inputs.filter((J=>J.name===R));return J.length?J[0]:null}_linkConnectionTypes(R,J){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[J]._acceptedConnectionPointType=this._inputs[R]:(this._inputs[R]._linkedConnectionSource=this._inputs[J],this._inputs[R]._isMainLinkSource=!0),this._inputs[J]._linkedConnectionSource=this._inputs[R]}registerInput(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0;const N=new wJ(R,this,0);return N.type=J,N.isOptional=B,N.defaultValue=Q,N.value=Q,N.valueMin=h,N.valueMax=y,this._inputs.push(N),this.onInputChangedObservable.notifyObservers(N),this}registerOutput(R,J,B){return(B=B??new wJ(R,this,1)).type=J,this._outputs.push(B),this}_build(R){}_customBuildStep(R){}build(R){if(this._buildId===R.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((R=>R.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=R.buildId;for(const J of this._inputs){if(!J.connectedPoint){J.isOptional||R.notConnectedNonOptionalInputs.push(J);continue}const B=J.connectedPoint.ownerBlock;B&&B!==this&&!B.isSystem&&B.build(R)}return this._customBuildStep(R),R.verbose&&Y.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(R),this.onBuildObservable.notifyObservers(this),!1}serialize(){const R={};R.customType="BABYLON."+this.getClassName(),R.id=this.uniqueId,R.name=this.name,R.visibleOnFrame=this.visibleOnFrame,R.inputs=[],R.outputs=[];for(const J of this.inputs)R.inputs.push(J.serialize());for(const J of this.outputs)R.outputs.push(J.serialize(!1));return R}_deserialize(R){this._name=R.name,this.comments=R.comments,this.visibleOnFrame=!!R.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(R)}_deserializePortDisplayNamesAndExposedOnFrame(R){const J=R.inputs,B=R.outputs;if(J)for(const Q of J){const R=this.inputs.find((R=>R.name===Q.name));if(!R)return;if(Q.displayName&&(R.displayName=Q.displayName),Q.isExposedOnFrame&&(R.isExposedOnFrame=Q.isExposedOnFrame,R.exposedPortPosition=Q.exposedPortPosition),void 0!==Q.value&&null!==Q.value)if("number"===Q.valueType)R.value=Q.value;else{const J=(0,r.e)(Q.valueType);J&&(R.value=J.fJ(Q.value))}}if(B)for(let Q=0;Q<B.length;Q++){const R=B[Q];R.displayName&&(this.outputs[Q].displayName=R.displayName),R.isExposedOnFrame&&(this.outputs[Q].isExposedOnFrame=R.isExposedOnFrame,this.outputs[Q].exposedPortPosition=R.exposedPortPosition)}}clone(){const R=this.serialize(),J=(0,r.e)(R.customType);if(J){const B=new J;return B._deserialize(R),B}return null}dispose(){this.eh.notifyObservers(this),this.eh.clear();for(const R of this.inputs)R.dispose();for(const R of this.outputs)R.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function vJ(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",Q=arguments.length>3?arguments[3]:void 0;return(h,y)=>{let N=h._propStore;N||(N=[],h._propStore=N),N.push({propertyName:y,displayName:R,type:J,groupName:B,options:Q??{},className:h.getClassName()})}}(0,z.e)([(0,p.N)("comment")],KJ.prototype,"comments",void 0),function(R){R[R.Boolean=0]="Boolean",R[R.Float=1]="Float",R[R.Int=2]="Int",R[R.Vector2=3]="Vector2",R[R.List=4]="List",R[R.ar=5]="ar",R[R.SamplingMode=6]="SamplingMode",R[R.TextureFormat=7]="TextureFormat",R[R.TextureType=8]="TextureType"}(LJ||(LJ={})),function(R){R[R.None=0]="None",R[R.Position=1]="Position",R[R.Direction=2]="Direction",R[R.Age=3]="Age",R[R.Lifetime=4]="Lifetime",R[R.Color=5]="Color",R[R.ScaledDirection=6]="ScaledDirection",R[R.Scale=7]="Scale",R[R.AgeGradient=8]="AgeGradient",R[R.Angle=9]="Angle",R[R.SpriteCellIndex=16]="SpriteCellIndex",R[R.SpriteCellStart=17]="SpriteCellStart",R[R.SpriteCellEnd=18]="SpriteCellEnd"}(jJ||(jJ={})),function(R){R[R.None=0]="None",R[R.Time=1]="Time",R[R.Delta=2]="Delta",R[R.Emitter=3]="Emitter"}(TJ||(TJ={}));class mJ{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let R="";for(const J of this.notConnectedNonOptionalInputs)R+=`input ${J.name} from block ${J.ownerBlock.name}[${J.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(R)throw"Build of Node Particle System Set failed:\n"+R}adapt(R,J){const B=R.getConnectedValue(this)||0;if(R.type===J)return B;switch(J){case YJ.Vector2:return new Q.Vector2(B,B);case YJ.nJ:return new Q.nJ(B,B,B);case YJ.ar:return new N.ar(B,B,B,B)}return null}getContextualValue(R){if(!this.particleContext||!this.systemContext)return null;switch(R){case jJ.Position:return this.particleContext.position;case jJ.Direction:return this.particleContext.direction;case jJ.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case jJ.Color:return this.particleContext.color;case jJ.Age:return this.particleContext.age;case jJ.Lifetime:return this.particleContext.lifeTime;case jJ.Angle:return this.particleContext.angle;case jJ.Scale:return this.particleContext.scale;case jJ.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case jJ.SpriteCellEnd:return this.systemContext.endSpriteCellID;case jJ.SpriteCellIndex:return this.particleContext.cellIndex;case jJ.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.QJ.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.QJ.absolutePosition:this.systemContext.QJ:null}getSystemValue(R){if(!this.particleContext||!this.systemContext)return null;switch(R){case TJ.Time:return this.systemContext._actualFrame;case TJ.Delta:return this.systemContext._scaledUpdateSpeed;case TJ.Emitter:if(this.isEmitterTransformNode){return this.systemContext.QJ.absolutePosition}return this.systemContext.QJ}return null}}function oJ(R,J,B){const Q=new mJ;Q.AJ=J;const h=R.createSystem(Q);return h.canStart=()=>!0,h.QJ=B.clone(),h.disposeOnStop=!0,h.start(),h}class tJ extends KJ{constructor(R){super(R),this.blendMode=q.BLENDMODE_ONEONE,this.cr=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",YJ.Particle),this.registerInput("texture",YJ.Texture),this.registerInput("onStart",YJ.System,!0),this.registerInput("onEnd",YJ.System,!0),this.registerOutput("system",YJ.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(R){R.cr=this.cr,R.buildId=this._buildId++,this.build(R);const J=this.particle.getConnectedValue(R);return J.particleTexture=this.texture.getConnectedValue(R),J.emitRate=this.emitRate,J.blendMode=this.blendMode,J.name=this.name,J._nodeGenerated=!0,J._targetStopDuration=this.targetStopDuration,J.startDelay=this.startDelay,this.system._storedValue=this,J.canStart=()=>!this.doNoStart,J.onStartedObservable.add((B=>{const Q=this.onStart.getConnectedValue(R);Q&&B.onStartedObservable.addOnce((()=>{R.systemContext=J;const B=oJ(Q,R.AJ,R.emitterPosition);this.eh.addOnce((()=>{B.dispose()}))}));const h=this.onEnd.getConnectedValue(R);h&&B.onStoppedObservable.addOnce((()=>{R.systemContext=J;const B=oJ(h,R.AJ,R.emitterPosition);this.eh.addOnce((()=>{B.dispose()}))}))})),this.eh.addOnce((()=>{J.dispose()})),J}serialize(){const R=super.serialize();return R.cr=this.cr,R.emitRate=this.emitRate,R.blendMode=this.blendMode,R.doNoStart=this.doNoStart,R.targetStopDuration=this.targetStopDuration,R.startDelay=this.startDelay,R}_deserialize(R){super._deserialize(R),this.cr=R.cr,this.emitRate=R.emitRate,this.doNoStart=!!R.doNoStart,void 0!==R.blendMode&&(this.blendMode=R.blendMode),void 0!==R.targetStopDuration&&(this.targetStopDuration=R.targetStopDuration),void 0!==R.startDelay&&(this.startDelay=R.startDelay)}}(0,z.e)([vJ("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:q.BLENDMODE_ONEONE},{label:"Standard",value:q.BLENDMODE_STANDARD},{label:"Add",value:q.BLENDMODE_ADD},{label:"Multiply",value:q.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:q.BLENDMODE_MULTIPLYADD}]})],tJ.prototype,"blendMode",void 0),(0,z.e)([vJ("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],tJ.prototype,"cr",void 0),(0,z.e)([vJ("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tJ.prototype,"emitRate",void 0),(0,z.e)([vJ("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tJ.prototype,"targetStopDuration",void 0),(0,z.e)([vJ("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tJ.prototype,"startDelay",void 0),(0,z.e)([vJ("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],tJ.prototype,"doNoStart",void 0),(0,r.h)("BABYLON.SystemBlock",tJ);class ZJ extends KJ{get type(){if(this._type===YJ.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=YJ.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=YJ.Vector2,this._type;case"nJ":return this._type=YJ.nJ,this._type;case"ar":return this._type=YJ.ar,this._type;case"Matrix":return this._type=YJ.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===jJ.None&&this._systemSource!==TJ.None}get systemSource(){return this._systemSource}set systemSource(R){if(this._systemSource=R,R!==TJ.None){switch(this._contextualSource=jJ.None,this._type=YJ.Float,R){case TJ.Time:case TJ.Delta:this._type=YJ.Float;break;case TJ.Emitter:this._type=YJ.nJ}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==jJ.None}get contextualValue(){return this._contextualSource}set contextualValue(R){if(this._contextualSource=R,R!==jJ.None){switch(this._systemSource=TJ.None,R){case jJ.Scale:this._type=YJ.Vector2;break;case jJ.Position:case jJ.Direction:case jJ.ScaledDirection:this._type=YJ.nJ;break;case jJ.Color:this._type=YJ.ar;break;case jJ.Age:case jJ.Lifetime:case jJ.Angle:case jJ.AgeGradient:this._type=YJ.Float;break;case jJ.SpriteCellEnd:case jJ.SpriteCellStart:case jJ.SpriteCellIndex:this._type=YJ.Int}this.output&&(this.output.type=this._type)}}constructor(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:YJ.AutoDetect;super(R),this._type=YJ.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new o.e,this._systemSource=TJ.None,this._contextualSource=jJ.None,this._type=J,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",J)}get value(){return this._storedValue}set value(R){this.type===YJ.Float&&this.min!==this.max&&(R=Math.max(this.min,R),R=Math.min(this.max,R)),this._storedValue=R,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(R){this._valueCallback=R}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case YJ.Int:case YJ.Float:this.value=0;break;case YJ.Vector2:this.value=Q.Vector2.Zero();break;case YJ.nJ:this.value=Q.nJ.Zero();break;case YJ.ar:this.value=new N.ar(1,1,1,1);break;case YJ.Matrix:this.value=Q.Matrix.Identity()}}_build(R){super._build(R),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=R=>R.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=R=>R.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const R=super.serialize();return R.type=this.type,R.contextualValue=this.contextualValue,R.systemSource=this.systemSource,R.min=this.min,R.max=this.max,R.groupInInspector=this.groupInInspector,R.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ch?(R.valueType="BABYLON."+this._storedValue.getClassName(),R.value=this._storedValue.Ch()):(R.valueType="number",R.value=this._storedValue)),R}_deserialize(R){if(super._deserialize(R),this._type=R.type,this.contextualValue=R.contextualValue,this.systemSource=R.systemSource||TJ.None,this.min=R.min||0,this.max=R.max||0,this.groupInInspector=R.groupInInspector||"",void 0!==R.displayInInspector&&(this.displayInInspector=R.displayInInspector),R.valueType)if("number"===R.valueType)this._storedValue=R.value;else{const J=(0,r.e)(R.valueType);J&&(this._storedValue=J.fJ(R.value))}}}(0,r.h)("BABYLON.ParticleInputBlock",ZJ);class UJ extends KJ{get url(){return this._url}set url(R){this._url!==R&&(this._cachedData=null,this._url=R,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(R){this._textureDataUrl!==R&&(this._cachedData=null,this._textureDataUrl=R,this._url="",this._sourceTexture=null)}set sourceTexture(R){this._sourceTexture!==R&&(this._cachedData=null,this._sourceTexture=R,this._url="",this._textureDataUrl="")}constructor(R){super(R),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",YJ.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const R=this.texture._storedValue;return await new Promise(((J,B)=>{if(!R.isReady())return void R.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),J(this._cachedData)}catch(R){B(R)}}));const Q=R.getSize();zJ.j.GetTextureDataAsync(R,Q.width,Q.height).then((B=>{this._cachedData={width:Q.width,height:Q.height,data:new Uint8ClampedArray(B)},R.dispose(),J(this._cachedData)})).catch(B)}))}_build(R){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new W.d(this._textureDataUrl,R.AJ):this.texture._storedValue=new W.d(this._url,R.AJ):this.texture._storedValue=null}serialize(){const R=super.serialize();return R.url=this.url,R.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(R.textureDataUrl=this.textureDataUrl),R}_deserialize(R){super._deserialize(R),this.url=R.url,this.serializedCachedData=!!R.serializedCachedData,R.textureDataUrl&&(this.textureDataUrl=R.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,r.h)("BABYLON.ParticleTextureSourceBlock",UJ);class RB extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("position",YJ.nJ),this.registerOutput("output",YJ.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(R){const J=this.particle.getConnectedValue(R);if(this.output._storedValue=J,!this.position.isConnected)return;const B={process:B=>{R.particleContext=B,R.systemContext=J,B.position.h(this.position.getConnectedValue(R))},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B}}(0,r.h)("BABYLON.UpdatePositionBlock",RB),function(R){R[R.Add=0]="Add",R[R.Subtract=1]="Subtract",R[R.Multiply=2]="Multiply",R[R.Divide=3]="Divide",R[R.Max=4]="Max",R[R.Min=5]="Min"}(FJ||(FJ={}));class JB extends KJ{constructor(R){super(R),this.operation=FJ.Add,this.registerInput("left",YJ.AutoDetect),this.registerInput("right",YJ.AutoDetect),this.registerOutput("output",YJ.BasedOnInput),this.output._typeConnectionSource=this.left;const J=[YJ.Matrix,YJ.Particle,YJ.Texture,YJ.System,YJ.FloatGradient,YJ.Color4Gradient,YJ.Vector2Gradient,YJ.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...J),this.right.excludedConnectionPointTypes.push(...J),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(R){let J;const B=this.left,h=this.right;if(!B.isConnected||!h.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const y=B.type===YJ.Float||B.type===YJ.Int,r=h.type===YJ.Float||h.type===YJ.Int,q=y&&r;switch(this.operation){case FJ.Add:J=q?R=>B.getConnectedValue(R)+h.getConnectedValue(R):y?R=>R.adapt(B,h.type).add(h.getConnectedValue(R)):R=>B.getConnectedValue(R).add(R.adapt(h,B.type));break;case FJ.Subtract:J=q?R=>B.getConnectedValue(R)-h.getConnectedValue(R):y?R=>R.adapt(B,h.type).PJ(h.getConnectedValue(R)):R=>B.getConnectedValue(R).PJ(R.adapt(h,B.type));break;case FJ.Multiply:J=q?R=>B.getConnectedValue(R)*h.getConnectedValue(R):y?R=>R.adapt(B,h.type).multiply(h.getConnectedValue(R)):R=>B.getConnectedValue(R).multiply(R.adapt(h,B.type));break;case FJ.Divide:J=q?R=>B.getConnectedValue(R)/h.getConnectedValue(R):y?R=>R.adapt(B,h.type).divide(h.getConnectedValue(R)):R=>B.getConnectedValue(R).divide(R.adapt(h,B.type));break;case FJ.Min:if(q)J=R=>Math.min(B.getConnectedValue(R),h.getConnectedValue(R));else{const[R,r]=y?[h,B]:[B,h];switch(R.type){case YJ.Vector2:J=J=>Q.Vector2.Minimize(R.getConnectedValue(J),J.adapt(r,R.type));break;case YJ.nJ:J=J=>Q.nJ.Minimize(R.getConnectedValue(J),J.adapt(r,R.type));break;case YJ.ar:J=J=>{const B=R.getConnectedValue(J),{r:Q,g:h,b:y,a:q}=J.adapt(r,R.type);return new N.ar(Math.min(B.r,Q),Math.min(B.g,h),Math.min(B.b,y),Math.min(B.a,q))}}}break;case FJ.Max:if(!q){const[R,r]=y?[h,B]:[B,h];switch(R.type){case YJ.Vector2:J=J=>Q.Vector2.Maximize(R.getConnectedValue(J),J.adapt(r,R.type));break;case YJ.nJ:J=J=>Q.nJ.Maximize(R.getConnectedValue(J),J.adapt(r,R.type));break;case YJ.ar:J=J=>{const B=R.getConnectedValue(J),{r:Q,g:h,b:y,a:q}=J.adapt(r,R.type);return new N.ar(Math.max(B.r,Q),Math.min(B.g,h),Math.min(B.b,y),Math.min(B.a,q))}}break}J=R=>Math.max(B.getConnectedValue(R),h.getConnectedValue(R))}this.output._storedFunction=R=>B.type===YJ.Int?0|J(R):J(R)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===YJ.Int||this.left.type===YJ.Float&&this.right.type!==YJ.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[R,J]of[[this.left,this.right],[this.right,this.left]])R.acceptedConnectionPointTypes=[YJ.Int,YJ.Float],J.isConnected&&(R.acceptedConnectionPointTypes.push(J.type),J.type!==YJ.Int&&J.type!==YJ.Float||R.acceptedConnectionPointTypes.push(YJ.Vector2,YJ.nJ,YJ.ar))}dispose(){super.dispose();for(const R of this._connectionObservers)R.remove();this._connectionObservers.length=0}serialize(){const R=super.serialize();return R.operation=this.operation,R}_deserialize(R){super._deserialize(R),this.operation=R.operation}}(0,z.e)([vJ("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:FJ.Add},{label:"Subtract",value:FJ.Subtract},{label:"Multiply",value:FJ.Multiply},{label:"Divide",value:FJ.Divide},{label:"Max",value:FJ.Max},{label:"Min",value:FJ.Min}]})],JB.prototype,"operation",void 0),(0,r.h)("BABYLON.ParticleMathBlock",JB);class BB extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("direction1",YJ.nJ,!0,new Q.nJ(0,1,0)),this.registerInput("direction2",YJ.nJ,!0,new Q.nJ(0,1,0)),this.registerInput("minEmitBox",YJ.nJ,!0,new Q.nJ(-.5,-.5,-.5)),this.registerInput("maxEmitBox",YJ.nJ,!0,new Q.nJ(.5,.5,.5)),this.registerOutput("output",YJ.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(R){const J=this.particle.getConnectedValue(R);J._directionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.direction1.getConnectedValue(R),y=this.direction2.getConnectedValue(R),N=(0,e.RandomRange)(h.x,y.x),r=(0,e.RandomRange)(h.y,y.y),q=(0,e.RandomRange)(h.z,y.z);R.isEmitterTransformNode?Q.nJ.TransformNormalFromFloatsToRef(N,r,q,R.emitterWorldMatrix,B.direction):B.direction.Ar(N,r,q)},J._positionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.minEmitBox.getConnectedValue(R),y=this.maxEmitBox.getConnectedValue(R),N=(0,e.RandomRange)(h.x,y.x),r=(0,e.RandomRange)(h.y,y.y),q=(0,e.RandomRange)(h.z,y.z);R.isEmitterTransformNode?Q.nJ.TransformCoordinatesFromFloatsToRef(N,r,q,R.emitterWorldMatrix,B.position):(B.position.Ar(N,r,q),B.position.addInPlace(R.emitterPosition))},this.output._storedValue=J}}(0,r.h)("BABYLON.BoxShapeBlock",BB);class QB extends KJ{constructor(R){super(R),this.registerInput("emitPower",YJ.Float,!0,1),this.registerInput("lifeTime",YJ.Float,!0,1),this.registerInput("color",YJ.ar,!0,new N.ar(1,1,1,1)),this.registerInput("scale",YJ.Vector2,!0,new Q.Vector2(1,1)),this.registerInput("angle",YJ.Float,!0,0),this.registerOutput("particle",YJ.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(R){const J=new rJ(this.name,R.cr,R.AJ,null,!1,void 0,!0);J.particleEmitterType=new u,J._lifeTimeCreation.process=(J,B)=>{R.particleContext=J,J.lifeTime=this.lifeTime.getConnectedValue(R),B._emitPower=this.emitPower.getConnectedValue(R)},J._colorCreation.process=J=>{R.particleContext=J,J.color.h(this.color.getConnectedValue(R))},J._sizeCreation.process=J=>{R.particleContext=J,J.size=1,J.scale.h(this.scale.getConnectedValue(R))},J._angleCreation.process=J=>{R.particleContext=J,J.angle=this.angle.getConnectedValue(R)},this.particle._storedValue=J}}(0,r.h)("BABYLON.CreateParticleBlock",QB);class hB{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const R=[];for(const J of this.attachedBlocks)J.isInput&&R.push(J);return R}constructor(R){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new o.e,this.name=R}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(R){let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(R)&&this.attachedBlocks.push(R);for(const B of R.inputs){const Q=B.connectedPoint;if(Q){const B=Q.ownerBlock;B!==R&&this._initializeBlock(B,J)}}}async buildAsync(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((B=>{const Q=new IJ;for(const R of this._systemBlocks)this._initializeBlock(R);for(const h of this.systemBlocks){const B=new mJ;B.buildId=this._buildId++,B.AJ=R,B.verbose=J;const y=h.createSystem(B);B.emitErrors(),Q.systems.push(y)}this.onBuildObservable.notifyObservers(this),B(Q)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const R=new tJ("Particle system"),J=new RB("Update position");J.output.connectTo(R.particle);const B=new ZJ("Position");B.contextualValue=jJ.Position;const Q=new ZJ("Scaled direction");Q.contextualValue=jJ.ScaledDirection;const h=new JB("Add");h.operation=FJ.Add,B.output.connectTo(h.left),Q.output.connectTo(h.right),h.output.connectTo(J.position);const y=new QB("Create particle"),N=new BB("Box shape");y.particle.connectTo(N.particle),N.output.connectTo(J.particle);const r=new UJ("Texture");r.texture.connectTo(R.texture),r.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(R)}removeBlock(R){const J=this.attachedBlocks.indexOf(R);if(J>-1&&this.attachedBlocks.splice(J,1),R.isSystem){const J=this._systemBlocks.indexOf(R);J>-1&&this._systemBlocks.splice(J,1)}}parseSerializedObject(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];J||this.clear();const B={};for(const Q of R.pD){const R=(0,r.e)(Q.customType);if(R){const J=new R;J._deserialize(Q),B[Q.id]=J,this.attachedBlocks.push(J),J.isSystem&&this._systemBlocks.push(J)}}for(const Q of this.attachedBlocks)if(Q.isTeleportOut){const R=Q,J=R._tempEntryPointUniqueId;if(J){const Q=B[J];Q&&Q.attachToEndpoint(R)}}for(let Q=0;Q<R.pD.length;Q++){const h=R.pD[Q],y=B[h.id];y&&(y.inputs.length&&h.inputs.some((R=>R.targetConnectionName))&&!J||this._restoreConnections(y,R,B))}if(R.locations||R.editorData&&R.editorData.locations){const Q=R.locations||R.editorData.locations;for(const R of Q)B[R.EQ]&&(R.EQ=B[R.EQ].uniqueId);J&&this.editorData&&this.editorData.locations&&Q.concat(this.editorData.locations),R.locations?this.editorData={locations:Q}:(this.editorData=R.editorData,this.editorData.locations=Q);const h=[];for(const R in B)h[R]=B[R].uniqueId;this.editorData.map=h}this.comment=R.comment}_restoreConnections(R,J,B){for(const Q of R.outputs)for(const h of J.pD){const y=B[h.id];if(y)for(const N of h.inputs)if(B[N.targetBlockId]!==R||N.targetConnectionName!==Q.name);else{const R=y.getInputByName(N.inputName);if(!R||R.isConnected)continue;Q.connectTo(R,!0),this._restoreConnections(y,J,B)}}}serialize(R){const J=R?{}:i.c.Serialize(this);J.editorData=JSON.parse(JSON.stringify(this.editorData));let B=[];R?B=R:J.customType="BABYLON.NodeParticleSystemSet",J.pD=[];for(const Q of B)J.pD.push(Q.serialize());if(!R)for(const Q of this.attachedBlocks)-1===B.indexOf(Q)&&J.pD.push(Q.serialize());return J}dispose(){for(const R of this.attachedBlocks)R.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(R){const J=new hB(R);return J.setToDefault(),J}static Parse(R){const J=i.c.Parse((()=>new hB(R.name)),R,null);return J.parseSerializedObject(R),J}static ParseFromSnippetAsync(R,J){return"_BLANK"===R?Promise.resolve(hB.CreateDefault("blank")):new Promise(((B,Q)=>{const h=new VJ.c;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const N=JSON.parse(JSON.parse(h.responseText).jsonPayload),r=JSON.parse(N.nodeParticle);J||(J=i.c.Parse((()=>new hB(R)),r,null)),J.parseSerializedObject(r),J.snippetId=R;try{B(J)}catch(y){Q(y)}}else Q("Unable to load the snippet "+R)})),h.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),h.send()}))}}hB.EditorURL=`${aJ.Tools._DefaultCdnUrl}/v${vR.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,hB.SnippetUrl="https://snippet.babylonjs.com",(0,z.e)([(0,p.N)()],hB.prototype,"name",void 0),(0,z.e)([(0,p.N)("comment")],hB.prototype,"comment",void 0),function(R){R[R.None=0]="None",R[R.PerParticle=1]="PerParticle",R[R.PerSystem=2]="PerSystem"}(CJ||(CJ={}));class yB extends KJ{constructor(R){super(R),this._currentLockId=-2,this.lockMode=CJ.PerParticle,this.registerInput("min",YJ.AutoDetect,!0,0),this.registerInput("max",YJ.AutoDetect,!0,1),this.registerOutput("output",YJ.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(YJ.Float|YJ.Int|YJ.Vector2|YJ.nJ|YJ.ar),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(YJ.Float|YJ.Int|YJ.Vector2|YJ.nJ|YJ.ar),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=YJ.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let R=null;switch(this._currentLockId=-2,this.min.type){case YJ.AutoDetect:case YJ.Int:case YJ.Float:R=R=>{const J=this.min.getConnectedValue(R)||0,B=this.max.getConnectedValue(R)||1;return J+Math.random()*(B-J)};break;case YJ.Vector2:R=R=>{const J=this.min.getConnectedValue(R)||Q.Vector2.Zero(),B=this.max.getConnectedValue(R)||Q.Vector2.One();return new Q.Vector2(J.x+Math.random()*(B.x-J.x),J.y+Math.random()*(B.y-J.y))};break;case YJ.nJ:R=R=>{const J=this.min.getConnectedValue(R)||Q.nJ.Zero(),B=this.max.getConnectedValue(R)||Q.nJ.One();return new Q.nJ(J.x+Math.random()*(B.x-J.x),J.y+Math.random()*(B.y-J.y),J.z+Math.random()*(B.z-J.z))};break;case YJ.ar:R=R=>{const J=this.min.getConnectedValue(R)||new N.ar(0,0,0,0),B=this.max.getConnectedValue(R)||new N.ar(1,1,1,1);return new N.ar(J.x+Math.random()*(B.x-J.x),J.y+Math.random()*(B.y-J.y),J.z+Math.random()*(B.z-J.z),J.w+Math.random()*(B.w-J.w))}}this.output._storedFunction=J=>{var B;let Q=0;switch(this.lockMode){case CJ.PerParticle:Q=(null===(B=J.particleContext)||void 0===B?void 0:B.id)||-1;break;case CJ.PerSystem:Q=J.buildId||0}return this._currentLockId!==Q&&(this.lockMode!==CJ.None&&(this._currentLockId=Q),this.output._storedValue=R(J)),this.output._storedValue}}serialize(){const R=super.serialize();return R.lockMode=this.lockMode,R}_deserialize(R){super._deserialize(R),this.lockMode=R.lockMode}}(0,z.e)([vJ("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:CJ.None},{label:"Per particle",value:CJ.PerParticle},{label:"Per system",value:CJ.PerSystem}]})],yB.prototype,"lockMode",void 0),(0,r.h)("BABYLON.ParticleRandomBlock",yB);class NB extends KJ{constructor(R){super(R),this._currentLockId=-2,this.lockMode=CJ.PerParticle,this.registerInput("min",YJ.AutoDetect),this.registerInput("max",YJ.AutoDetect),this.registerOutput("output",YJ.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const J=[YJ.Matrix,YJ.Particle,YJ.Texture,YJ.System,YJ.FloatGradient,YJ.Color4Gradient,YJ.Vector2Gradient,YJ.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...J),this.max.excludedConnectionPointTypes.push(...J)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let R=null;switch(this._currentLockId=-2,this.min.type){case YJ.Float:case YJ.Int:R=R=>{const J=this.min.getConnectedValue(R),B=this.max.getConnectedValue(R);return Math.random()*(B-J)+J};break;case YJ.Vector2:R=R=>{const J=this.min.getConnectedValue(R),B=this.max.getConnectedValue(R);return new Q.Vector2(Math.random()*(B.x-J.x)+J.x,Math.random()*(B.y-J.y)+J.y)};break;case YJ.nJ:R=R=>{const J=this.min.getConnectedValue(R),B=this.max.getConnectedValue(R);return new Q.nJ(Math.random()*(B.x-J.x)+J.x,Math.random()*(B.y-J.y)+J.y,Math.random()*(B.z-J.z)+J.z)};break;case YJ.ar:R=R=>{const J=this.min.getConnectedValue(R),B=this.max.getConnectedValue(R);return new N.ar(Math.random()*(B.r-J.r)+J.r,Math.random()*(B.g-J.g)+J.g,Math.random()*(B.b-J.b)+J.b,Math.random()*(B.a-J.a)+J.a)}}this.output._storedFunction=J=>{var B;let Q=0;switch(this.lockMode){case CJ.PerParticle:Q=(null===(B=J.particleContext)||void 0===B?void 0:B.id)||-1;break;case CJ.PerSystem:Q=J.buildId||0}return this._currentLockId!==Q&&(this.lockMode!==CJ.None&&(this._currentLockId=Q),this.output._storedValue=R(J)),this.output._storedValue}}serialize(){const R=super.serialize();return R.lockMode=this.lockMode,R}_deserialize(R){super._deserialize(R),void 0!==R.lockMode&&(this.lockMode=R.lockMode)}}(0,z.e)([vJ("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:CJ.None},{label:"Per particle",value:CJ.PerParticle},{label:"Per system",value:CJ.PerSystem}]})],NB.prototype,"lockMode",void 0),(0,r.h)("BABYLON.RandomRangeBlock",NB);(0,r.h)("BABYLON.ParticleLerpBlock",class extends KJ{constructor(R){super(R),this.registerInput("left",YJ.AutoDetect),this.registerInput("right",YJ.AutoDetect),this.registerInput("gradient",YJ.Float,!0,0,0,1),this.registerOutput("output",YJ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(YJ.Float|YJ.Int|YJ.Vector2|YJ.nJ|YJ.ar)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const R=(R,J,B)=>(1-R)*J+R*B;this.output._storedFunction=J=>{const B=this.left.getConnectedValue(J),h=this.right.getConnectedValue(J),y=this.gradient.getConnectedValue(J);switch(this.left.type){case YJ.Int:case YJ.Float:return R(y,B,h);case YJ.Vector2:return new Q.Vector2(R(y,B.x,h.x),R(y,B.y,h.y));case YJ.nJ:return new Q.nJ(R(y,B.x,h.x),R(y,B.y,h.y),R(y,B.z,h.z));case YJ.ar:return new N.ar(R(y,B.r,h.r),R(y,B.g,h.g),R(y,B.b,h.b),R(y,B.a,h.a))}return 0}}});(0,r.h)("BABYLON.UpdateDirectionBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("direction",YJ.nJ),this.registerOutput("output",YJ.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(R){const J=this.particle.getConnectedValue(R);if(this.output._storedValue=J,!this.direction.isConnected)return;const B={process:B=>{R.particleContext=B,R.systemContext=J,B.direction.h(this.direction.getConnectedValue(R))},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B}});(0,r.h)("BABYLON.UpdateColorBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("color",YJ.ar),this.registerOutput("output",YJ.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(R){const J=this.particle.getConnectedValue(R);if(this.output._storedValue=J,!this.color.isConnected)return;const B={process:B=>{R.particleContext=B,R.systemContext=J,B.color.h(this.color.getConnectedValue(R))},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B}});(0,r.h)("BABYLON.UpdateScaleBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("scale",YJ.Vector2),this.registerOutput("output",YJ.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(R){const J=this.particle.getConnectedValue(R);if(this.output._storedValue=J,!this.scale.isConnected)return;const B={process:B=>{R.particleContext=B,R.systemContext=J,B.scale.h(this.scale.getConnectedValue(R))},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B}});(0,r.h)("BABYLON.UpdateAngleBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("angle",YJ.Float),this.registerOutput("output",YJ.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(R){const J=this.particle.getConnectedValue(R);if(this.output._storedValue=J,!this.angle.isConnected)return;const B={process:B=>{R.particleContext=B,R.systemContext=J,B.angle=this.angle.getConnectedValue(R)},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B}});(0,r.h)("BABYLON.BasicPositionUpdateBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerOutput("output",YJ.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(R){const J=this.particle.getConnectedValue(R),B={process:B=>{R.particleContext=B,R.systemContext=J,B.direction.scaleToRef(J._directionScale,J._scaledDirection),B.position.addInPlace(J._scaledDirection)},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B,this.output._storedValue=J}});(0,r.h)("BABYLON.BasicSpriteUpdateBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerOutput("output",YJ.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(R){const J=this.particle.getConnectedValue(R),B={process:B=>{R.particleContext=B,R.systemContext=J,B.updateCellIndex()},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B,this.output._storedValue=J}});(0,r.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("cellIndex",YJ.Int),this.registerOutput("output",YJ.Particle),this.cellIndex.acceptedConnectionPointTypes=[YJ.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(R){const J=this.particle.getConnectedValue(R);if(this.output._storedValue=J,!this.cellIndex.isConnected)return;const B={process:B=>{R.particleContext=B,R.systemContext=J,B.cellIndex=Math.floor(this.cellIndex.getConnectedValue(R))},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B}});class rB extends KJ{constructor(R){super(R),this.strength=1,this.registerInput("particle",YJ.Particle),this.registerInput("flowMap",YJ.Texture),this.registerOutput("output",YJ.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(R){var J;const B=this.particle.getConnectedValue(R),Q=R.AJ;let h;(null===(J=this.flowMap.connectedPoint)||void 0===J?void 0:J.ownerBlock).extractTextureContentAsync().then((R=>{R&&(h=new kJ(R.width,R.height,R.data))}));const y={process:R=>{const J=Q.getTransformMatrix();h&&h._processParticle(R,this.strength*B._tempScaledUpdateSpeed,J)},previousItem:null,nextItem:null};B._updateQueueStart?TR(y,B._updateQueueStart):B._updateQueueStart=y,this.output._storedValue=B}serialize(){const R=super.serialize();return R.strength=this.strength,R}_deserialize(R){super._deserialize(R),this.strength=R.strength}}(0,z.e)([vJ("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rB.prototype,"strength",void 0),(0,r.h)("BABYLON.UpdateFlowMapBlock",rB);(0,r.h)("BABYLON.SphereShapeBlock",class extends KJ{constructor(R){super(R),this.registerInput("input",YJ.Particle),this.registerInput("radius",YJ.Float,!0,1),this.registerInput("radiusRange",YJ.Float,!0,1,0,1),this.registerInput("directionRandomizer",YJ.Float,!0,0,0,1),this.registerOutput("output",YJ.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(R){const J=this.input.getConnectedValue(R);J._directionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.directionRandomizer.getConnectedValue(R),y=B.position.PJ(R.emitterPosition).normalize(),N=(0,e.RandomRange)(0,h),r=(0,e.RandomRange)(0,h),q=(0,e.RandomRange)(0,h);y.x+=N,y.y+=r,y.z+=q,y.normalize(),R.isEmitterTransformNode?Q.nJ.TransformNormalFromFloatsToRef(N,r,q,R.emitterWorldMatrix,B.direction):B.direction.Ar(N,r,q)},J._positionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.radius.getConnectedValue(R),y=this.radiusRange.getConnectedValue(R),N=h-(0,e.RandomRange)(0,h*y),r=(0,e.RandomRange)(0,1),q=(0,e.RandomRange)(0,2*Math.PI),D=Math.acos(2*r-1),l=N*Math.cos(q)*Math.sin(D),E=N*Math.cos(D),O=N*Math.sin(q)*Math.sin(D);R.isEmitterTransformNode?Q.nJ.TransformCoordinatesFromFloatsToRef(l,E,O,R.emitterWorldMatrix,B.position):(B.position.Ar(l,E,O),B.position.addInPlace(R.emitterPosition))},this.output._storedValue=J}});(0,r.h)("BABYLON.PointShapeBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("direction1",YJ.nJ,!0,new Q.nJ(0,1,0)),this.registerInput("direction2",YJ.nJ,!0,new Q.nJ(0,1,0)),this.registerOutput("output",YJ.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(R){const J=this.particle.getConnectedValue(R);J._directionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.direction1.getConnectedValue(R),y=this.direction2.getConnectedValue(R),N=(0,e.RandomRange)(h.x,y.x),r=(0,e.RandomRange)(h.y,y.y),q=(0,e.RandomRange)(h.z,y.z);R.isEmitterTransformNode?Q.nJ.TransformNormalFromFloatsToRef(N,r,q,R.emitterWorldMatrix,B.direction):B.direction.Ar(N,r,q)},J._positionCreation.process=B=>{R.systemContext=J,R.isEmitterTransformNode?Q.nJ.TransformCoordinatesFromFloatsToRef(0,0,0,R.emitterWorldMatrix,B.position):B.position.h(R.emitterPosition)},this.output._storedValue=J}});(0,r.h)("BABYLON.CustomShapeBlock",class extends KJ{constructor(R){super(R),this.registerInput("particle",YJ.Particle),this.registerInput("position",YJ.nJ,!0,new Q.nJ(0,0,0)),this.registerInput("direction",YJ.nJ,!0,new Q.nJ(0,1,0)),this.registerOutput("output",YJ.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(R){const J=this.particle.getConnectedValue(R);J._directionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.direction.getConnectedValue(R);R.isEmitterTransformNode?Q.nJ.TransformNormalToRef(h,R.emitterWorldMatrix,B.direction):B.direction.h(h)},J._positionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.position.getConnectedValue(R);R.isEmitterTransformNode?Q.nJ.TransformCoordinatesToRef(h,R.emitterWorldMatrix,B.position):(B.position.h(h),B.position.addInPlace(R.emitterPosition))},this.output._storedValue=J}});(0,r.h)("BABYLON.CylinderShapeBlock",class extends KJ{constructor(R){super(R),this._tempVector=Q.nJ.Zero(),this.registerInput("particle",YJ.Particle),this.registerInput("radius",YJ.Float,!0,1),this.registerInput("height",YJ.Float,!0,1,0),this.registerInput("radiusRange",YJ.Float,!0,1,0,1),this.registerInput("directionRandomizer",YJ.Float,!0,0,0,1),this.registerOutput("output",YJ.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(R){const J=this.particle.getConnectedValue(R);J._directionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.directionRandomizer.getConnectedValue(R);B.position.subtractToRef(R.emitterPosition,this._tempVector),this._tempVector.normalize(),R.isEmitterTransformNode&&Q.nJ.TransformNormalToRef(this._tempVector,R.emitterInverseWorldMatrix,this._tempVector);const y=(0,e.RandomRange)(-h/2,h/2);let N=Math.atan2(this._tempVector.x,this._tempVector.z);N+=(0,e.RandomRange)(-Math.PI/2,Math.PI/2)*h,this._tempVector.y=y,this._tempVector.x=Math.sin(N),this._tempVector.z=Math.cos(N),this._tempVector.normalize(),R.isEmitterTransformNode?Q.nJ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,R.emitterWorldMatrix,B.direction):B.direction.h(this._tempVector)},J._positionCreation.process=B=>{R.particleContext=B,R.systemContext=J;const h=this.height.getConnectedValue(R),y=this.radiusRange.getConnectedValue(R),N=this.radius.getConnectedValue(R),r=(0,e.RandomRange)(-h/2,h/2),q=(0,e.RandomRange)(0,2*Math.PI),D=(0,e.RandomRange)((1-y)*(1-y),1),l=Math.sqrt(D)*N,E=l*Math.cos(q),O=l*Math.sin(q);R.isEmitterTransformNode?Q.nJ.TransformCoordinatesFromFloatsToRef(E,r,O,R.emitterWorldMatrix,B.position):(B.position.Ar(E,r,O),B.position.addInPlace(R.emitterPosition))},this.output._storedValue=J}});class qB extends KJ{constructor(R){super(R),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",YJ.Particle),this.registerOutput("output",YJ.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(R){super._build(R);const J=this.particle.getConnectedValue(R);J._isAnimationSheetEnabled=!0,J.spriteCellWidth=this.width,J.spriteCellHeight=this.height,J.startSpriteCellID=this.start,J.endSpriteCellID=this.end,J.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=J}serialize(){const R=super.serialize();return R.width=this.width,R.height=this.height,R.start=this.start,R.end=this.end,R.randomStartCell=this.randomStartCell,R}_deserialize(R){super._deserialize(R),this.width=R.width,this.height=R.height,this.start=R.start,this.end=R.end,this.randomStartCell=R.randomStartCell}}(0,z.e)([vJ("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qB.prototype,"start",void 0),(0,z.e)([vJ("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qB.prototype,"end",void 0),(0,z.e)([vJ("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qB.prototype,"width",void 0),(0,z.e)([vJ("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qB.prototype,"height",void 0),(0,z.e)([vJ("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qB.prototype,"loop",void 0),(0,z.e)([vJ("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qB.prototype,"randomStartCell",void 0),(0,r.h)("BABYLON.SetupSpriteSheetBlock",qB);class eB extends KJ{constructor(R){super(R),this.reference=0,this.registerInput("value",YJ.AutoDetect),this.registerOutput("output",YJ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=R=>{switch(R){case YJ.Float:return YJ.FloatGradient;case YJ.Vector2:return YJ.Vector2Gradient;case YJ.nJ:return YJ.Vector3Gradient;case YJ.ar:return YJ.Color4Gradient}return R},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(YJ.Float|YJ.Vector2|YJ.nJ|YJ.ar)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=R=>null}serialize(){const R=super.serialize();return R.reference=this.reference,R}_deserialize(R){super._deserialize(R),this.reference=R.reference}}(0,z.e)([vJ("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],eB.prototype,"reference",void 0),(0,r.h)("BABYLON.ParticleGradientValueBlock",eB);(0,r.h)("BABYLON.ParticleGradientBlock",class extends KJ{constructor(R){super(R),this._entryCount=1,this.registerInput("gradient",YJ.Float,!0,1,0,1),this.registerInput("value0",YJ.AutoDetect),this.registerOutput("output",YJ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=R=>{switch(R){case YJ.FloatGradient:return YJ.Float;case YJ.Vector2Gradient:return YJ.Vector2;case YJ.Vector3Gradient:return YJ.nJ;case YJ.Color4Gradient:return YJ.ar}return R},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(YJ.FloatGradient|YJ.Vector2Gradient|YJ.Vector3Gradient|YJ.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(R){this._inputs[R].onConnectionObservable.add((()=>{this._entryCount>R||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),YJ.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const R=[];for(let B=1;B<this._inputs.length;B++){var J;if(this._inputs[B].isConnected)R.push(null===(J=this._inputs[B].connectedPoint)||void 0===J?void 0:J.ownerBlock)}R.sort(((R,J)=>R.reference-J.reference)),this.output._storedFunction=J=>{const B=this.gradient.getConnectedValue(J);if(1===R.length)return R[0].value.getConnectedValue(J);let h=null;for(let y=R.length-1;y>=0;y--){const r=R[y];if(r.reference<=B){const R=r.value.getConnectedValue(J);if(h){const y=h.value.getConnectedValue(J),q=h.reference,D=r.reference,l=Math.max(0,Math.min(1,(B-D)/(q-D)));switch(this.output.type){case YJ.Float:return(0,e.Lerp)(R,y,l);case YJ.Vector2:return Q.Vector2.Lerp(R,y,l);case YJ.nJ:return Q.nJ.Lerp(R,y,l);case YJ.ar:return N.ar.Lerp(R,y,l)}}return R}h=r}return 0}}});(0,r.h)("BABYLON.ParticleConverterBlock",class extends KJ{constructor(R){super(R),this.registerInput("color ",YJ.ar,!0),this.registerInput("xyz ",YJ.nJ,!0),this.registerInput("xy ",YJ.Vector2,!0),this.registerInput("zw ",YJ.Vector2,!0),this.registerInput("x ",YJ.Float,!0),this.registerInput("y ",YJ.Float,!0),this.registerInput("z ",YJ.Float,!0),this.registerInput("w ",YJ.Float,!0),this.registerOutput("color",YJ.ar),this.registerOutput("xyz",YJ.nJ),this.registerOutput("xy",YJ.Vector2),this.registerOutput("zw",YJ.Vector2),this.registerOutput("x",YJ.Float),this.registerOutput("y",YJ.Float),this.registerOutput("z",YJ.Float),this.registerOutput("w",YJ.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(R){return"color "===R?"colorIn":"xyz "===R?"xyzIn":"xy "===R?"xyIn":"zw "===R?"zwIn":"x "===R?"xIn":"y "===R?"yIn":"z "===R?"zIn":"w "===R?"wIn":R}_outputRename(R){switch(R){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return R}}_build(R){super._build(R);const J=this.xIn,B=this.yIn,h=this.zIn,y=this.wIn,r=this.xyIn,q=this.zwIn,e=this.xyzIn,D=this.colorIn,l=this.colorOut,E=this.xyzOut,O=this.xyOut,n=this.zwOut,P=this.xOut,A=this.yOut,u=this.zOut,S=this.wOut,f=R=>{if(D.isConnected)return D.getConnectedValue(R);let Q=0,l=0,E=0,O=0;if(J.isConnected&&(Q=J.getConnectedValue(R)),B.isConnected&&(l=B.getConnectedValue(R)),h.isConnected&&(E=h.getConnectedValue(R)),y.isConnected&&(O=y.getConnectedValue(R)),r.isConnected){const J=r.getConnectedValue(R);J&&(Q=J.x,l=J.y)}if(q.isConnected){const J=q.getConnectedValue(R);J&&(E=J.x,O=J.y)}if(e.isConnected){const J=e.getConnectedValue(R);J&&(Q=J.x,l=J.y,E=J.z)}return new N.ar(Q,l,E,O)};l._storedFunction=R=>f(R),E._storedFunction=R=>{const J=f(R);return new Q.nJ(J.r,J.g,J.b)},O._storedFunction=R=>{const J=f(R);return new Q.Vector2(J.r,J.g)},n._storedFunction=R=>{const J=f(R);return new Q.Vector2(J.b,J.a)},P._storedFunction=R=>f(R).r,A._storedFunction=R=>f(R).g,u._storedFunction=R=>f(R).b,S._storedFunction=R=>f(R).a}}),function(R){R[R.Cos=0]="Cos",R[R.Sin=1]="Sin",R[R.Abs=2]="Abs",R[R.Exp=3]="Exp",R[R.Exp2=4]="Exp2",R[R.Round=5]="Round",R[R.Floor=6]="Floor",R[R.Ceiling=7]="Ceiling",R[R.Sqrt=8]="Sqrt",R[R.Log=9]="Log",R[R.Tan=10]="Tan",R[R.ArcTan=11]="ArcTan",R[R.ArcCos=12]="ArcCos",R[R.ArcSin=13]="ArcSin",R[R.Sign=14]="Sign",R[R.Negate=15]="Negate",R[R.OneMinus=16]="OneMinus",R[R.Reciprocal=17]="Reciprocal",R[R.ToDegrees=18]="ToDegrees",R[R.ToRadians=19]="ToRadians",R[R.Fract=20]="Fract"}(bJ||(bJ={}));class DB extends KJ{constructor(R){super(R),this.operation=bJ.Cos,this.registerInput("input",YJ.AutoDetect),this.registerOutput("output",YJ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(YJ.Float|YJ.Int|YJ.Vector2|YJ.nJ|YJ.ar)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(R){super._build(R);let J=null;switch(this.operation){case bJ.Cos:J=R=>Math.cos(R);break;case bJ.Sin:J=R=>Math.sin(R);break;case bJ.Abs:J=R=>Math.abs(R);break;case bJ.Exp:J=R=>Math.exp(R);break;case bJ.Exp2:J=R=>Math.pow(2,R);break;case bJ.Round:J=R=>Math.round(R);break;case bJ.Floor:J=R=>Math.floor(R);break;case bJ.Ceiling:J=R=>Math.ceil(R);break;case bJ.Sqrt:J=R=>Math.sqrt(R);break;case bJ.Log:J=R=>Math.log(R);break;case bJ.Tan:J=R=>Math.tan(R);break;case bJ.ArcTan:J=R=>Math.atan(R);break;case bJ.ArcCos:J=R=>Math.acos(R);break;case bJ.ArcSin:J=R=>Math.asin(R);break;case bJ.Sign:J=R=>Math.sign(R);break;case bJ.Negate:J=R=>-R;break;case bJ.OneMinus:J=R=>1-R;break;case bJ.Reciprocal:J=R=>1/R;break;case bJ.ToRadians:J=R=>R*Math.PI/180;break;case bJ.ToDegrees:J=R=>180*R/Math.PI;break;case bJ.Fract:J=R=>R>=0?R-Math.floor(R):R-Math.ceil(R)}if(!J)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case YJ.Int:case YJ.Float:this.output._storedFunction=R=>{const B=this.input.getConnectedValue(R);return J(B)};break;case YJ.Vector2:this.output._storedFunction=R=>{const B=this.input.getConnectedValue(R);return new Q.Vector2(J(B.x),J(B.y))};break;case YJ.nJ:this.output._storedFunction=R=>{const B=this.input.getConnectedValue(R);return new Q.nJ(J(B.x),J(B.y),J(B.z))};break;case YJ.ar:this.output._storedFunction=R=>{const B=this.input.getConnectedValue(R);return new N.ar(J(B.r),J(B.g),J(B.b),J(B.a))}}return this}serialize(){const R=super.serialize();return R.operation=this.operation,R}_deserialize(R){super._deserialize(R),this.operation=R.operation}}(0,z.e)([vJ("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:bJ.Cos},{label:"Sin",value:bJ.Sin},{label:"Abs",value:bJ.Abs},{label:"Exp",value:bJ.Exp},{label:"Exp2",value:bJ.Exp2},{label:"Round",value:bJ.Round},{label:"Floor",value:bJ.Floor},{label:"Ceiling",value:bJ.Ceiling},{label:"Sqrt",value:bJ.Sqrt},{label:"Log",value:bJ.Log},{label:"Tan",value:bJ.Tan},{label:"ArcTan",value:bJ.ArcTan},{label:"ArcCos",value:bJ.ArcCos},{label:"ArcSin",value:bJ.ArcSin},{label:"Sign",value:bJ.Sign},{label:"Negate",value:bJ.Negate},{label:"OneMinus",value:bJ.OneMinus},{label:"Reciprocal",value:bJ.Reciprocal},{label:"ToDegrees",value:bJ.ToDegrees},{label:"ToRadians",value:bJ.ToRadians},{label:"Fract",value:bJ.Fract}]})],DB.prototype,"operation",void 0),(0,r.h)("BABYLON.ParticleTrigonometryBlock",DB);var lB,EB=B(12571);class OB extends KJ{constructor(R){super(R),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",YJ.AutoDetect),this.registerOutput("output",YJ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(YJ.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(YJ.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(YJ.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(YJ.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(YJ.System),this._inputs[0].excludedConnectionPointTypes.push(YJ.Particle),this._inputs[0].excludedConnectionPointTypes.push(YJ.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(R){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const J=R=>{const J=this.input.getConnectedValue(R);if(this.log.length>=this.stackSize)return J;if(null===J||void 0===J)return this.log.push(["null",""]),J;switch(this.input.type){case YJ.Vector2:this.log.push([(0,EB.h)(J,4),J.toString()]);break;case YJ.nJ:this.log.push([(0,EB.j)(J,4),J.toString()]);break;case YJ.ar:this.log.push([`{R: ${J.r.toFixed(4)} G: ${J.g.toFixed(4)} B: ${J.b.toFixed(4)} A: ${J.a.toFixed(4)}}`,J.toString()]);break;default:this.log.push([J.toString(),J.toString()])}return J};this.output.isConnected?this.output._storedFunction=J:this.output._storedValue=J(R)}serialize(){const R=super.serialize();return R.stackSize=this.stackSize,R}_deserialize(R){super._deserialize(R),this.stackSize=R.stackSize}}(0,z.e)([vJ("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],OB.prototype,"stackSize",void 0),(0,r.h)("BABYLON.ParticleDebugBlock",OB);(0,r.h)("BABYLON.ParticleElbowBlock",class extends KJ{constructor(R){super(R),this.registerInput("input",YJ.AutoDetect),this.registerOutput("output",YJ.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(R){super._build(R);const J=this._outputs[0],B=this._inputs[0];J._storedFunction=R=>B.getConnectedValue(R)}});(0,r.h)("BABYLON.ParticleTeleportInBlock",class extends KJ{get endpoints(){return this._endpoints}constructor(R){super(R),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",YJ.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(R){if(this.getClassName()===R)return!0;for(const J of this.endpoints)if(J.isAnAncestorOfType(R))return!0;return!1}isAnAncestorOf(R){for(const J of this.endpoints){if(J===R)return!0;if(J.isAnAncestorOf(R))return!0}return!1}attachToEndpoint(R){R.detach(),this._endpoints.push(R),R._entryPoint=this,R._outputs[0]._typeConnectionSource=this._inputs[0],R._tempEntryPointUniqueId=null,R.name="> "+this.name}detachFromEndpoint(R){const J=this._endpoints.indexOf(R);-1!==J&&(this._endpoints.splice(J,1),R._outputs[0]._typeConnectionSource=null,R._entryPoint=null)}_build(){for(const R of this._endpoints)R.output._storedFunction=R=>this.input.getConnectedValue(R)}});(0,r.h)("BABYLON.ParticleTeleportOutBlock",class extends KJ{constructor(R){super(R),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",YJ.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(R){this.entryPoint&&this.entryPoint.build(R)}clone(){const R=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(R),R}serialize(){var R;const J=super.serialize();return J.entryPoint=(null===(R=this.entryPoint)||void 0===R?void 0:R.uniqueId)??"",J}_deserialize(R){super._deserialize(R),this._tempEntryPointUniqueId=R.entryPoint}}),function(R){R[R.Equal=0]="Equal",R[R.NotEqual=1]="NotEqual",R[R.LessThan=2]="LessThan",R[R.GreaterThan=3]="GreaterThan",R[R.LessOrEqual=4]="LessOrEqual",R[R.GreaterOrEqual=5]="GreaterOrEqual",R[R.Xor=6]="Xor",R[R.Or=7]="Or",R[R.And=8]="And"}(lB||(lB={}));class nB extends KJ{constructor(R){super(R),this.test=lB.Equal,this.epsilon=0,this.registerInput("left",YJ.Float),this.registerInput("right",YJ.Float,!0,0),this.registerInput("ifTrue",YJ.AutoDetect,!0,1),this.registerInput("ifFalse",YJ.AutoDetect,!0,0),this.registerOutput("output",YJ.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=YJ.Float,this._inputs[0].acceptedConnectionPointTypes.push(YJ.Int),this._inputs[1].acceptedConnectionPointTypes.push(YJ.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const R=R=>{const J=this.left.getConnectedValue(R),B=this.right.getConnectedValue(R);let Q=!1;switch(this.test){case lB.Equal:Q=(0,e.WithinEpsilon)(J,B,this.epsilon);break;case lB.NotEqual:Q=!(0,e.WithinEpsilon)(J,B,this.epsilon);break;case lB.LessThan:Q=J<B+this.epsilon;break;case lB.GreaterThan:Q=J>B-this.epsilon;break;case lB.LessOrEqual:Q=J<=B+this.epsilon;break;case lB.GreaterOrEqual:Q=J>=B-this.epsilon;break;case lB.Xor:Q=!!J&&!B||!J&&!!B;break;case lB.Or:Q=!!J||!!B;break;case lB.And:Q=!!J&&!!B}return Q};this.output._storedFunction=J=>R(J)?this.ifTrue.getConnectedValue(J):this.ifFalse.getConnectedValue(J)}serialize(){const R=super.serialize();return R.test=this.test,R.epsilon=this.epsilon,R}_deserialize(R){super._deserialize(R),this.test=R.test,void 0!==R.epsilon&&(this.epsilon=R.epsilon)}}(0,z.e)([vJ("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:lB.Equal},{label:"NotEqual",value:lB.NotEqual},{label:"LessThan",value:lB.LessThan},{label:"GreaterThan",value:lB.GreaterThan},{label:"LessOrEqual",value:lB.LessOrEqual},{label:"GreaterOrEqual",value:lB.GreaterOrEqual},{label:"Xor",value:lB.Xor},{label:"Or",value:lB.Or},{label:"And",value:lB.And}]})],nB.prototype,"test",void 0),(0,z.e)([vJ("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],nB.prototype,"epsilon",void 0),(0,r.h)("BABYLON.ParticleConditionBlock",nB);class PB extends KJ{constructor(R){super(R),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",YJ.Particle),this.registerInput("condition",YJ.Float,!0,0),this.registerInput("system",YJ.System),this.registerOutput("output",YJ.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(R){this._triggerCount=0;const J=this.input.getConnectedValue(R),B={process:B=>{if(R.particleContext=B,R.systemContext=J,0!==this.condition.getConnectedValue(R)&&(0===this.limit||this._triggerCount<this.limit)){const Q=(new Date).getTime();if(this._previousOne&&Q-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=Q;const h=this.system.getConnectedValue(R);if(h){const Q=oJ(h,R.AJ,B.position);Q.eh.addOnce((()=>{this._triggerCount--})),J.eh.addOnce((()=>{Q.dispose()}))}}},previousItem:null,nextItem:null};J._updateQueueStart?TR(B,J._updateQueueStart):J._updateQueueStart=B,this.output._storedValue=J}serialize(){const R=super.serialize();return R.limit=this.limit,R.delay=this.delay,R}_deserialize(R){super._deserialize(R),void 0!==R.limit&&(this.limit=R.limit),void 0!==R.delay&&(this.delay=R.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,z.e)([vJ("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PB.prototype,"limit",void 0),(0,z.e)([vJ("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PB.prototype,"delay",void 0),(0,r.h)("BABYLON.ParticleTriggerBlock",PB);B(12577),B(12591),B(12600),B(12662)},12641:(R,J,B)=>{"use strict";var Q=B(11107);const h="clipPlaneFragment",y="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12606:(R,J,B)=>{"use strict";var Q=B(11107);const h="clipPlaneFragmentDeclaration",y="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12680:(R,J,B)=>{"use strict";var Q=B(11107);const h="clipPlaneVertex",y="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12667:(R,J,B)=>{"use strict";var Q=B(11107);const h="clipPlaneVertexDeclaration",y="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12653:(R,J,B)=>{"use strict";var Q=B(11107);const h="fogFragment",y="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12639:(R,J,B)=>{"use strict";var Q=B(11107);const h="fogFragmentDeclaration",y="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12682:(R,J,B)=>{"use strict";var Q=B(11107);const h="fogVertex",y="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12671:(R,J,B)=>{"use strict";var Q=B(11107);const h="fogVertexDeclaration",y="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12624:(R,J,B)=>{"use strict";var Q=B(11107);const h="helperFunctions",y="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12609:(R,J,B)=>{"use strict";var Q=B(11107);const h="imageProcessingDeclaration",y="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12632:(R,J,B)=>{"use strict";var Q=B(11107);const h="imageProcessingFunctions",y="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12616:(R,J,B)=>{"use strict";var Q=B(11107);const h="logDepthDeclaration",y="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12649:(R,J,B)=>{"use strict";var Q=B(11107);const h="logDepthFragment",y="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12690:(R,J,B)=>{"use strict";var Q=B(11107);const h="logDepthVertex",y="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Q.c.IncludesShadersStoreWGSL[h]||(Q.c.IncludesShadersStoreWGSL[h]=y)},12600:(R,J,B)=>{"use strict";B.r(J),B.d(J,{particlesPixelShaderWGSL:()=>N});var Q=B(11107);B(12606),B(12609),B(12616),B(12624),B(12632),B(12639),B(12641),B(12649),B(12653);const h="particlesPixelShader",y="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Q.c.ShadersStoreWGSL[h]||(Q.c.ShadersStoreWGSL[h]=y);const N={name:h,shader:y}},12662:(R,J,B)=>{"use strict";B.r(J),B.d(J,{particlesVertexShaderWGSL:()=>N});var Q=B(11107);B(12667),B(12671),B(12616),B(12680),B(12682),B(12690);const h="particlesVertexShader",y="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Q.c.ShadersStoreWGSL[h]||(Q.c.ShadersStoreWGSL[h]=y);const N={name:h,shader:y}},12502:(R,J,B)=>{"use strict";var Q=B(11107);const h="clipPlaneFragment",y="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12583:(R,J,B)=>{"use strict";var Q=B(11107);const h="clipPlaneFragmentDeclaration",y="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12527:(R,J,B)=>{"use strict";var Q=B(11107);const h="clipPlaneVertex",y="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12595:(R,J,B)=>{"use strict";var Q=B(11107);const h="clipPlaneVertexDeclaration",y="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12513:(R,J,B)=>{"use strict";var Q=B(11107);const h="fogFragment",y="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12493:(R,J,B)=>{"use strict";var Q=B(11107);const h="fogFragmentDeclaration",y="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12535:(R,J,B)=>{"use strict";var Q=B(11107);const h="fogVertex",y="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12521:(R,J,B)=>{"use strict";var Q=B(11107);const h="fogVertexDeclaration",y="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12487:(R,J,B)=>{"use strict";var Q=B(11107);const h="helperFunctions",y="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12482:(R,J,B)=>{"use strict";var Q=B(11107);const h="imageProcessingDeclaration",y="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12490:(R,J,B)=>{"use strict";var Q=B(11107);const h="imageProcessingFunctions",y="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12484:(R,J,B)=>{"use strict";var Q=B(11107);const h="logDepthDeclaration",y="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12511:(R,J,B)=>{"use strict";var Q=B(11107);const h="logDepthFragment",y="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12541:(R,J,B)=>{"use strict";var Q=B(11107);const h="logDepthVertex",y="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Q.c.IncludesShadersStore[h]||(Q.c.IncludesShadersStore[h]=y)},12577:(R,J,B)=>{"use strict";B.r(J),B.d(J,{particlesPixelShader:()=>N});var Q=B(11107);B(12583),B(12482),B(12484),B(12487),B(12490),B(12493),B(12502),B(12511),B(12513);const h="particlesPixelShader",y="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Q.c.ShadersStore[h]||(Q.c.ShadersStore[h]=y);const N={name:h,shader:y}},12591:(R,J,B)=>{"use strict";B.r(J),B.d(J,{particlesVertexShader:()=>N});var Q=B(11107);B(12595),B(12521),B(12484),B(12527),B(12535),B(12541);const h="particlesVertexShader",y="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Q.c.ShadersStore[h]||(Q.c.ShadersStore[h]=y);const N={name:h,shader:y}},12954:(R,J,B)=>{"use strict";B.r(J),B.d(J,{FlowGraphGLTFDataProvider:()=>y});var Q=B(12922),h=B(12894);class y extends Q.c{constructor(R){var J,B;super();const Q=R.glTF,y=(null===(J=Q.animations)||void 0===J?void 0:J.map((R=>R._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",h.e,y);const N=(null===(B=Q.nodes)||void 0===B?void 0:B.map((R=>R._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",h.e,N)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12835:(R,J,B)=>{"use strict";B.d(J,{c:()=>A,f:()=>n,g:()=>O,j:()=>P});var Q=B(11186),h=B(11662),y=B(11224),N=B(12839);const r=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class q{constructor(R,J){this._gltf=R,this._infoTree=J}convert(R){let J,B=this._gltf,Q=this._infoTree;if(!R.startsWith("/"))throw new Error("Path must start with a /");const h=R.split("/");if(h.shift(),h[h.length-1].includes(".length")){const R=h[h.length-1].split(".");h.pop(),h.push(...R)}let y=!1;for(const q of h){const h="length"===q;if(h&&!Q.__array__)throw new Error(`Path ${R} is invalid`);if(Q.__ignoreObjectTree__&&(y=!0),Q.__array__&&!h)Q=Q.__array__;else if(Q=Q[q],!Q)throw new Error(`Path ${R} is invalid`);if(!y)if(void 0===B){if(!r.find((J=>J.regex.test(R))))throw new Error(`Path ${R} is invalid`)}else if(!h){var N;B=null===(N=B)||void 0===N?void 0:N[q]}(Q.__target__||h)&&(J=B)}return{object:J,info:Q}}}function e(R,J,B,Q){const h=D(R,J);return Q?h[B][Q]:h[B]}function D(R,J,B){var Q,y;return null===(Q=R._data)||void 0===Q||null===(y=Q[(null===B||void 0===B?void 0:B.fillMode)??h.e.MATERIAL_TriangleFillMode])||void 0===y?void 0:y.babylonMaterial}function l(R,J){return{offset:{componentsCount:2,type:"Vector2",get:(B,h,y)=>{const N=e(B,y,R,J);return new Q.Vector2(null===N||void 0===N?void 0:N.uOffset,null===N||void 0===N?void 0:N.vOffset)},getTarget:D,set:(B,Q,h,y)=>{const N=e(Q,y,R,J);N.uOffset=B.x,N.vOffset=B.y},getPropertyName:[()=>`${R}${J?"."+J:""}.uOffset`,()=>`${R}${J?"."+J:""}.vOffset`]},rotation:{type:"number",get:(B,Q,h)=>{var y;return null===(y=e(B,h,R,J))||void 0===y?void 0:y.wAng},getTarget:D,set:(B,Q,h,y)=>e(Q,y,R,J).wAng=B,getPropertyName:[()=>`${R}${J?"."+J:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(B,h,y)=>{const N=e(B,y,R,J);return new Q.Vector2(null===N||void 0===N?void 0:N.uScale,null===N||void 0===N?void 0:N.vScale)},getTarget:D,set:(B,Q,h,y)=>{const N=e(Q,y,R,J);N.uScale=B.x,N.vScale=B.y},getPropertyName:[()=>`${R}${J?"."+J:""}.uScale`,()=>`${R}${J?"."+J:""}.vScale`]}}}const E={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:R=>{var J,B;return new Q.Vector2((null===(J=R._babylonCamera)||void 0===J?void 0:J.orthoLeft)??0,(null===(B=R._babylonCamera)||void 0===B?void 0:B.orthoRight)??0)},set:(R,J)=>{J._babylonCamera&&(J._babylonCamera.orthoLeft=R.x,J._babylonCamera.orthoRight=R.y)},getTarget:R=>R,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:R=>{var J,B;return new Q.Vector2((null===(J=R._babylonCamera)||void 0===J?void 0:J.orthoBottom)??0,(null===(B=R._babylonCamera)||void 0===B?void 0:B.orthoTop)??0)},set:(R,J)=>{J._babylonCamera&&(J._babylonCamera.orthoBottom=R.x,J._babylonCamera.orthoTop=R.y)},getTarget:R=>R,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:R=>{var J;return null===(J=R._babylonCamera)||void 0===J?void 0:J.maxZ},set:(R,J)=>{J._babylonCamera&&(J._babylonCamera.maxZ=R)},getTarget:R=>R,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:R=>{var J;return null===(J=R._babylonCamera)||void 0===J?void 0:J.mh},set:(R,J)=>{J._babylonCamera&&(J._babylonCamera.mh=R)},getTarget:R=>R,getPropertyName:[()=>"mh"]}},perspective:{aspectRatio:{type:"number",get:R=>{var J;return null===(J=R._babylonCamera)||void 0===J?void 0:J.getEngine().getAspectRatio(R._babylonCamera)},getTarget:R=>R,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:R=>{var J;return null===(J=R._babylonCamera)||void 0===J?void 0:J.fov},set:(R,J)=>{J._babylonCamera&&(J._babylonCamera.fov=R)},getTarget:R=>R,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:R=>{var J;return null===(J=R._babylonCamera)||void 0===J?void 0:J.maxZ},set:(R,J)=>{J._babylonCamera&&(J._babylonCamera.maxZ=R)},getTarget:R=>R,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:R=>{var J;return null===(J=R._babylonCamera)||void 0===J?void 0:J.mh},set:(R,J)=>{J._babylonCamera&&(J._babylonCamera.mh=R)},getTarget:R=>R,getPropertyName:[()=>"mh"]}}}},nodes:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"nJ",get:R=>{var J;return null===(J=R._babylonTransformNode)||void 0===J?void 0:J.position},set:(R,J)=>{var B;return null===(B=J._babylonTransformNode)||void 0===B?void 0:B.position.h(R)},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:R=>{var J;return null===(J=R._babylonTransformNode)||void 0===J?void 0:J.rotationQuaternion},set:(R,J)=>{var B,Q;return null===(B=J._babylonTransformNode)||void 0===B||null===(Q=B.rotationQuaternion)||void 0===Q?void 0:Q.h(R)},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"nJ",get:R=>{var J;return null===(J=R._babylonTransformNode)||void 0===J?void 0:J.ur},set:(R,J)=>{var B;return null===(B=J._babylonTransformNode)||void 0===B?void 0:B.ur.h(R)},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"ur"]},weights:{length:{type:"number",get:R=>R._numMorphTargets,getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(R,J)=>{var B,Q;return void 0!==J?null===(B=R._primitiveBabylonMeshes)||void 0===B||null===(Q=B[0].morphTargetManager)||void 0===Q?void 0:Q.getTarget(J).influence:void 0},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(R,J)=>[0],getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:R=>{var J,B,h;return Q.Matrix.Compose(null===(J=R._babylonTransformNode)||void 0===J?void 0:J.ur,null===(B=R._babylonTransformNode)||void 0===B?void 0:B.rotationQuaternion,null===(h=R._babylonTransformNode)||void 0===h?void 0:h.position)},getTarget:R=>R._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:R=>{var J,B,h,y;const N=Q.Matrix.Identity();let r=R.parent;for(;r&&r.parent;)r=r.parent;const q=(null===(J=R._babylonTransformNode)||void 0===J?void 0:J.position._isDirty)||(null===(B=R._babylonTransformNode)||void 0===B||null===(h=B.rotationQuaternion)||void 0===h?void 0:h._isDirty)||(null===(y=R._babylonTransformNode)||void 0===y?void 0:y.ur._isDirty);if(r){var e;const J=null===(e=r._babylonTransformNode)||void 0===e?void 0:e.ny(!0).invert();var D,l;if(J)null===(D=R._babylonTransformNode)||void 0===D||null===(l=D.ny(q))||void 0===l||l.multiplyToRef(J,N)}else R._babylonTransformNode&&N.h(R._babylonTransformNode.ny(q));return N},getTarget:R=>R._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:R=>{var J,B;return null===(J=R._babylonTransformNode)||void 0===J||null===(B=J.getChildren((R=>R instanceof N.d),!0)[0])||void 0===B?void 0:B.Vr},getTarget:R=>{var J;return null===(J=R._babylonTransformNode)||void 0===J?void 0:J.getChildren((R=>R instanceof N.d),!0)[0]},set:(R,J)=>{if(J._babylonTransformNode){const B=J._babylonTransformNode.getChildren((R=>R instanceof N.d),!0)[0];B&&(B.Vr=R)}}},color:{type:"SJ",get:R=>{var J,B;return null===(J=R._babylonTransformNode)||void 0===J||null===(B=J.getChildren((R=>R instanceof N.d),!0)[0])||void 0===B?void 0:B.Mr},getTarget:R=>{var J;return null===(J=R._babylonTransformNode)||void 0===J?void 0:J.getChildren((R=>R instanceof N.d),!0)[0]},set:(R,J)=>{if(J._babylonTransformNode){const B=J._babylonTransformNode.getChildren((R=>R instanceof N.d),!0)[0];B&&(B.Mr=R)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"SJ",get:(R,J,B)=>D(R,J,B).emissiveColor,set:(R,J,B,Q)=>D(J,B,Q).emissiveColor.h(R),getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:l("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(R,J,B)=>{var Q;return null===(Q=e(R,B,"bumpTexture"))||void 0===Q?void 0:Q.level},set:(R,J,B,Q)=>{const h=e(J,Q,"bumpTexture");h&&(h.level=R)},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:l("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(R,J,B)=>D(R,J,B).ambientTextureStrength,set:(R,J,B,Q)=>{const h=D(J,B,Q);h&&(h.ambientTextureStrength=R)},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:l("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ar",get:(R,J,B)=>{const Q=D(R,J,B);return y.ar.FromColor3(Q.albedoColor,Q.alpha)},set:(R,J,B,Q)=>{const h=D(J,B,Q);h.albedoColor.set(R.r,R.g,R.b),h.alpha=R.a},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:l("albedoTexture")}},metallicFactor:{type:"number",get:(R,J,B)=>D(R,J,B).metallic,set:(R,J,B,Q)=>{const h=D(J,B,Q);h&&(h.metallic=R)},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(R,J,B)=>D(R,J,B).roughness,set:(R,J,B,Q)=>{const h=D(J,B,Q);h&&(h.roughness=R)},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:l("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(R,J,B)=>D(R,J,B).anisotropy.Vr,set:(R,J,B,Q)=>{D(J,B,Q).anisotropy.Vr=R},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(R,J,B)=>D(R,J,B).anisotropy.angle,set:(R,J,B,Q)=>{D(J,B,Q).anisotropy.angle=R},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:l("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(R,J,B)=>D(R,J,B).clearCoat.Vr,set:(R,J,B,Q)=>{D(J,B,Q).clearCoat.Vr=R},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(R,J,B)=>D(R,J,B).clearCoat.roughness,set:(R,J,B,Q)=>{D(J,B,Q).clearCoat.roughness=R},getTarget:(R,J,B)=>D(R,J,B),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:l("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(R,J,B)=>{var Q;return null===(Q=D(R,J,B).clearCoat.bumpTexture)||void 0===Q?void 0:Q.level},getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).clearCoat.bumpTexture.level=R},extensions:{KHR_texture_transform:l("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:l("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(R,J,B)=>D(R,J,B).subSurface.dispersion,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).subSurface.dispersion=R}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(R,J,B)=>D(R,J,B).emissiveIntensity,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).emissiveIntensity=R}},KHR_materials_ior:{ior:{type:"number",get:(R,J,B)=>D(R,J,B).indexOfRefraction,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).indexOfRefraction=R}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(R,J,B)=>D(R,J,B).iridescence.Vr,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).iridescence.Vr=R},iridescenceIor:{type:"number",get:(R,J,B)=>D(R,J,B).iridescence.indexOfRefraction,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).iridescence.indexOfRefraction=R},iridescenceTexture:{extensions:{KHR_texture_transform:l("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(R,J,B)=>D(R,J,B).iridescence.maximumThickness,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).iridescence.maximumThickness=R},iridescenceThicknessMinimum:{type:"number",get:(R,J,B)=>D(R,J,B).iridescence.minimumThickness,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).iridescence.minimumThickness=R},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:l("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"SJ",get:(R,J,B)=>D(R,J,B).sheen.color,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).sheen.color.h(R)},sheenColorTexture:{extensions:{KHR_texture_transform:l("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(R,J,B)=>D(R,J,B).sheen.Vr,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).sheen.Vr=R},sheenRoughnessTexture:{extensions:{KHR_texture_transform:l("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(R,J,B)=>D(R,J,B).metallicF0Factor,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).metallicF0Factor=R,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"SJ",get:(R,J,B)=>D(R,J,B).metallicReflectanceColor,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).metallicReflectanceColor.h(R),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:l("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:l("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(R,J,B)=>D(R,J,B).subSurface.refractionIntensity,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).subSurface.refractionIntensity=R,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:l("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(R,J,B)=>D(R,J,B).subSurface.translucencyIntensity,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).subSurface.translucencyIntensity=R},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:l("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"SJ",get:(R,J,B)=>D(R,J,B).subSurface.translucencyColor,getTarget:D,set:(R,J,B,Q)=>{var h;return R&&(null===(h=D(J,B,Q).subSurface.translucencyColor)||void 0===h?void 0:h.h(R))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:l("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"SJ",get:(R,J,B)=>D(R,J,B).subSurface.tintColor,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).subSurface.tintColor.h(R)},attenuationDistance:{type:"number",get:(R,J,B)=>D(R,J,B).subSurface.tintColorAtDistance,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).subSurface.tintColorAtDistance=R},thicknessFactor:{type:"number",get:(R,J,B)=>D(R,J,B).subSurface.maximumThickness,getTarget:D,set:(R,J,B,Q)=>D(J,B,Q).subSurface.maximumThickness=R},thicknessTexture:{extensions:{KHR_texture_transform:l("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonLight)),getPropertyName:[R=>"length"]},__array__:{__target__:!0,color:{type:"SJ",get:R=>{var J;return null===(J=R._babylonLight)||void 0===J?void 0:J.Mr},set:(R,J)=>{var B;return null===(B=J._babylonLight)||void 0===B?void 0:B.Mr.h(R)},getTarget:R=>R._babylonLight,getPropertyName:[R=>"diffuse"]},Vr:{type:"number",get:R=>{var J;return null===(J=R._babylonLight)||void 0===J?void 0:J.Vr},set:(R,J)=>J._babylonLight?J._babylonLight.Vr=R:void 0,getTarget:R=>R._babylonLight,getPropertyName:[R=>"intensity"]},range:{type:"number",get:R=>{var J;return null===(J=R._babylonLight)||void 0===J?void 0:J.range},set:(R,J)=>J._babylonLight?J._babylonLight.range=R:void 0,getTarget:R=>R._babylonLight,getPropertyName:[R=>"range"]},spot:{innerConeAngle:{type:"number",get:R=>{var J;return null===(J=R._babylonLight)||void 0===J?void 0:J.innerAngle},set:(R,J)=>J._babylonLight?J._babylonLight.innerAngle=R:void 0,getTarget:R=>R._babylonLight,getPropertyName:[R=>"innerConeAngle"]},outerConeAngle:{type:"number",get:R=>{var J;return null===(J=R._babylonLight)||void 0===J?void 0:J.angle},set:(R,J)=>J._babylonLight?J._babylonLight.angle=R:void 0,getTarget:R=>R._babylonLight,getPropertyName:[R=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonLight)),getPropertyName:[R=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonTexture)),getPropertyName:[R=>"length"]},__array__:{__target__:!0,Vr:{type:"number",get:R=>{var J;return null===(J=R._babylonTexture)||void 0===J?void 0:J.level},set:(R,J)=>{J._babylonTexture&&(J._babylonTexture.level=R)},getTarget:R=>R._babylonTexture},rotation:{type:"Quaternion",get:R=>{var J;return R._babylonTexture&&Q.Quaternion.FromRotationMatrix(null===(J=R._babylonTexture)||void 0===J?void 0:J.getReflectionTextureMatrix())},set:(R,J)=>{var B;J._babylonTexture&&(null!==(B=J._babylonTexture.IR())&&void 0!==B&&B.useRightHandedSystem||(R=Q.Quaternion.Inverse(R)),Q.Matrix.FromQuaternionToRef(R,J._babylonTexture.getReflectionTextureMatrix()))},getTarget:R=>R._babylonTexture}}}}},animations:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>{var J;return null===(J=R.primitives[0]._instanceData)||void 0===J?void 0:J.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function O(R){return new q(R,E)}function n(R){const J=R.split("/").map((R=>R.replace(/{}/g,"__array__")));let B=E;for(const Q of J)Q&&(B=B[Q]);if(B&&B.type&&B.get)return B}function P(R,J){const B=R.split("/").map((R=>R.replace(/{}/g,"__array__")));let Q=E;for(const h of B)h&&(Q=Q[h]);Q&&Q.type&&Q.get&&(Q.interpolation=J)}function A(R,J){const B=R.split("/").map((R=>R.replace(/{}/g,"__array__")));let Q=E;for(const h of B)if(h){if(!Q[h]){if("?"===h){Q.__ignoreObjectTree__=!0;continue}Q[h]={},"__array__"===h&&(Q[h].__target__=!0)}Q=Q[h]}Object.assign(Q,J)}},12848:(R,J,B)=>{"use strict";B.r(J),B.d(J,{AnimationPropertyInfo:()=>e,TransformNodeAnimationPropertyInfo:()=>D,WeightAnimationPropertyInfo:()=>l,getQuaternion:()=>r,getVector3:()=>N,getWeights:()=>q});var Q=B(11718),h=B(11186),y=B(12835);function N(R,J,B,Q){return h.nJ.fJ(J,B).scaleInPlace(Q)}function r(R,J,B,Q){return h.Quaternion.fJ(J,B).scaleInPlace(Q)}function q(R,J,B,Q){const h=new Array(R._numMorphTargets);for(let y=0;y<h.length;y++)h[y]=J[B++]*Q;return h}class e{constructor(R,J,B,Q){this.type=R,this.name=J,this.getValue=B,this.getStride=Q}_buildAnimation(R,J,B){const h=new Q.c(R,this.name,J,this.type);return h.setKeys(B),h}}class D extends e{buildAnimations(R,J,B,Q){const h=[];return h.push({babylonAnimatable:R._babylonTransformNode,babylonAnimation:this._buildAnimation(J,B,Q)}),h}}class l extends e{buildAnimations(R,J,B,h){const y=[];if(R._numMorphTargets)for(let N=0;N<R._numMorphTargets;N++){const r=new Q.c(`${J}_${N}`,this.name,B,this.type);if(r.setKeys(h.map((R=>({frame:R.frame,inTangent:R.inTangent?R.inTangent[N]:void 0,value:R.value[N],outTangent:R.outTangent?R.outTangent[N]:void 0,interpolation:R.interpolation})))),R._primitiveBabylonMeshes)for(const J of R._primitiveBabylonMeshes)if(J.morphTargetManager){const R=J.morphTargetManager.getTarget(N),B=r.clone();R.animations.push(B),y.push({babylonAnimatable:R,babylonAnimation:B})}}return y}}(0,y.j)("/nodes/{}/translation",[new D(Q.c.ANIMATIONTYPE_VECTOR3,"position",N,(()=>3))]),(0,y.j)("/nodes/{}/rotation",[new D(Q.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",r,(()=>4))]),(0,y.j)("/nodes/{}/scale",[new D(Q.c.ANIMATIONTYPE_VECTOR3,"ur",N,(()=>3))]),(0,y.j)("/nodes/{}/weights",[new l(Q.c.ANIMATIONTYPE_FLOAT,"influence",q,(R=>R._numMorphTargets))])},12800:(R,J,B)=>{"use strict";class Q{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((R,J)=>{this._resolve=R,this._reject=J}))}}var h=B(11186),y=B(11224),N=B(11030),r=B(11634),q=B(12808),e=B(12819),D=B(11032),l=B(11653),E=B(11718),O=B(11722),n=B(11065),P=B(11043),A=B(11045);class u{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(R){this._useTextureToStoreBoneMatrices=R,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(R,J,B){this.name=R,this.id=J,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=h.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new D.e,this.bones=[],this._scene=B||n.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const Q=this._scene.getEngine().getCaps();this._canUseTextureForBones=Q.textureFloat&&Q.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((R=>!R.getParent()))}getTransformMatrices(R){if(this.needInitialSkinMatrix){if(!R)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return R._bonesTransformMatrices||this.prepare(!0),R._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(R){return this.needInitialSkinMatrix&&R._transformMatrixTexture?R._transformMatrixTexture:this._transformMatrixTexture}IR(){return this._scene}toString(R){let J=`Name: ${this.name}, nBones: ${this.bones.length}`;if(J+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,R){J+=", Ranges: {";let R=!0;for(const B in this._ranges)R&&(J+=", ",R=!1),J+=B;J+="}"}return J}getBoneIndexByName(R){for(let J=0,B=this.bones.length;J<B;J++)if(this.bones[J].name===R)return J;return-1}createAnimationRange(R,J,B){if(!this._ranges[R]){this._ranges[R]=new O.b(R,J,B);for(let Q=0,h=this.bones.length;Q<h;Q++)this.bones[Q].animations[0]&&this.bones[Q].animations[0].createRange(R,J,B)}}deleteAnimationRange(R){let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let B=0,Q=this.bones.length;B<Q;B++)this.bones[B].animations[0]&&this.bones[B].animations[0].deleteRange(R,J);this._ranges[R]=null}getAnimationRange(R){return this._ranges[R]||null}getAnimationRanges(){const R=[];let J;for(J in this._ranges)R.push(this._ranges[J]);return R}copyAnimationRange(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[J]||!R.getAnimationRange(J))return!1;let Q=!0;const h=this._getHighestAnimationFrame()+1,y={},N=R.bones;let r,q;for(q=0,r=N.length;q<r;q++)y[N[q].name]=N[q];this.bones.length!==N.length&&(P.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${N.length}`),Q=!1);const e=B&&this.dimensionsAtRest&&R.dimensionsAtRest?this.dimensionsAtRest.divide(R.dimensionsAtRest):null;for(q=0,r=this.bones.length;q<r;q++){const R=this.bones[q].name,N=y[R];N?Q=Q&&this.bones[q].copyAnimationRange(N,J,h,B,e):(P.d.Warn("copyAnimationRange: not same rig, missing source bone "+R),Q=!1)}const D=R.getAnimationRange(J);return D&&(this._ranges[J]=new O.b(J,D.from+h,D.to+h)),Q}returnToRest(){for(const R of this.bones)-1!==R._index&&R.returnToRest()}_getHighestAnimationFrame(){let R=0;for(let J=0,B=this.bones.length;J<B;J++)if(this.bones[J].animations[0]){const B=this.bones[J].animations[0].getHighestFrame();R<B&&(R=B)}return R}beginAnimation(R,J,B,Q){const h=this.getAnimationRange(R);return h?this._scene.beginAnimation(this,h.from,h.to,J,B,Q):null}static MakeAnimationAdditive(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,B=arguments.length>2?arguments[2]:void 0;const Q=R.getAnimationRange(B);if(!Q)return null;const h=R._scene.getAllAnimatablesByTarget(R);let y=null;for(let r=0;r<h.length;r++){const R=h[r];if(R.fromFrame===(null===Q||void 0===Q?void 0:Q.from)&&R.toFrame===(null===Q||void 0===Q?void 0:Q.to)){y=R;break}}const N=R.getAnimatables();for(let r=0;r<N.length;r++){const R=N[r].animations;if(R)for(let Q=0;Q<R.length;Q++)E.c.MakeAnimationAdditive(R[Q],J,B)}return y&&(y.isAdditive=!0),R}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(R){this._meshesWithPoseMatrix.push(R)}_unregisterMeshWithPoseMatrix(R){const J=this._meshesWithPoseMatrix.indexOf(R);J>-1&&this._meshesWithPoseMatrix.splice(J,1)}_computeTransformMatrices(R,J){this.onBeforeComputeObservable.notifyObservers(this);for(let B=0;B<this.bones.length;B++){const Q=this.bones[B];Q._childUpdateId++;const h=Q.getParent();if(h?Q.getLocalMatrix().multiplyToRef(h.getFinalMatrix(),Q.getFinalMatrix()):J?Q.getLocalMatrix().multiplyToRef(J,Q.getFinalMatrix()):Q.getFinalMatrix().h(Q.getLocalMatrix()),-1!==Q._index){const J=null===Q._index?B:Q._index;Q.getAbsoluteInverseBindMatrix().multiplyToArray(Q.getFinalMatrix(),R,16*J)}}this._identity.copyToArray(R,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const R=this.IR().getRenderId();if(this._currentRenderId===R)return;this._currentRenderId=R}if(this._numBonesWithLinkedTransformNode>0)for(const R of this.bones)if(R._linkedTransformNode){const J=R._linkedTransformNode;R.position=J.position,J.rotationQuaternion?R.rotationQuaternion=J.rotationQuaternion:R.rotation=J.rotation,R.ur=J.ur}if(this.needInitialSkinMatrix)for(const R of this._meshesWithPoseMatrix){const J=R.getPoseMatrix();let B=this._isDirty;if(R._bonesTransformMatrices&&R._bonesTransformMatrices.length===16*(this.bones.length+1)||(R._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),B=!0),B){if(this._synchronizedWithMesh!==R){this._synchronizedWithMesh=R;for(const R of this.bones)if(!R.getParent()){R.getBindMatrix().multiplyToRef(J,h.TmpVectors.Matrix[1]),R._updateAbsoluteBindMatrices(h.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const J=4*(this.bones.length+1);R._transformMatrixTexture&&R._transformMatrixTexture.getSize().width===J||(R._transformMatrixTexture&&R._transformMatrixTexture.dispose(),R._transformMatrixTexture=l.b.CreateRGBATexture(R._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(R._bonesTransformMatrices,J),this.isUsingTextureForMatrices&&R._transformMatrixTexture&&R._transformMatrixTexture.update(R._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=l.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let R=0;R<this.bones.length;R++)this._animatables.push(this.bones[R])}return this._animatables}clone(R,J){const B=new u(R,J||R,this._scene);B.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Q=0;Q<this.bones.length;Q++){const R=this.bones[Q];let J=null;const h=R.getParent();if(h){const R=this.bones.indexOf(h);J=B.bones[R]}const y=new e.b(R.name,B,J,R.getBindMatrix().clone(),R.getRestMatrix().clone());y._index=R._index,R._linkedTransformNode&&y.linkTransformNode(R._linkedTransformNode),A.d.DeepCopy(R.animations,y.animations)}if(this._ranges){B._ranges={};for(const R in this._ranges){const J=this._ranges[R];J&&(B._ranges[R]=J.clone())}}return this._isDirty=!0,B.prepare(!0),B}enableBlending(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const J of this.bones)for(const B of J.animations)B.enableBlending=!0,B.blendingSpeed=R}dispose(){if(this._meshesWithPoseMatrix.length=0,this.IR().stopAnimation(this),this.IR().removeSkeleton(this),this._parentContainer){const R=this._parentContainer.skeletons.indexOf(this);R>-1&&this._parentContainer.skeletons.splice(R,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const R={};R.name=this.name,R.id=this.id,this.dimensionsAtRest&&(R.dimensionsAtRest=this.dimensionsAtRest.Ch()),R.bones=[],R.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let B=0;B<this.bones.length;B++){var J;const Q=this.bones[B],h=Q.getParent(),y={parentBoneIndex:h?this.bones.indexOf(h):-1,index:Q.getIndex(),name:Q.name,id:Q.id,matrix:Q.getBindMatrix().Ch(),rest:Q.getRestMatrix().Ch(),linkedTransformNodeId:null===(J=Q.getTransformNode())||void 0===J?void 0:J.id};R.bones.push(y),Q.length&&(y.length=Q.length),Q.metadata&&(y.metadata=Q.metadata),Q.animations&&Q.animations.length>0&&(y.animation=Q.animations[0].serialize()),R.ranges=[];for(const J in this._ranges){const B=this._ranges[J];if(!B)continue;const Q={};Q.name=J,Q.from=B.from,Q.to=B.to,R.ranges.push(Q)}}return R}static Parse(R,J){const B=new u(R.name,R.id,J);let Q;for(R.dimensionsAtRest&&(B.dimensionsAtRest=h.nJ.fJ(R.dimensionsAtRest)),B.needInitialSkinMatrix=R.needInitialSkinMatrix,Q=0;Q<R.bones.length;Q++){const J=R.bones[Q],y=R.bones[Q].index;let N=null;J.parentBoneIndex>-1&&(N=B.bones[J.parentBoneIndex]);const r=J.rest?h.Matrix.fJ(J.rest):null,q=new e.b(J.name,B,N,h.Matrix.fJ(J.matrix),r,null,y);void 0!==J.id&&null!==J.id&&(q.id=J.id),J.length&&(q.length=J.length),J.metadata&&(q.metadata=J.metadata),J.animation&&q.animations.push(E.c.Parse(J.animation)),void 0!==J.linkedTransformNodeId&&null!==J.linkedTransformNodeId&&(B._hasWaitingData=!0,q._waitingTransformNodeId=J.linkedTransformNodeId)}if(R.ranges)for(Q=0;Q<R.ranges.length;Q++){const J=R.ranges[Q];B.createAnimationRange(J.name,J.from,J.to)}return B}computeAbsoluteMatrices(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||R)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(R)}getPoseMatrix(){let R=null;return this._meshesWithPoseMatrix.length>0&&(R=this._meshesWithPoseMatrix[0].getPoseMatrix()),R}sortBones(){const R=[],J=new Array(this.bones.length);for(let B=0;B<this.bones.length;B++)this._sortBones(B,R,J);this.bones=R}_sortBones(R,J,B){if(B[R])return;B[R]=!0;const Q=this.bones[R];if(!Q)return;void 0===Q._index&&(Q._index=R);const h=Q.getParent();h&&this._sortBones(this.bones.indexOf(h),J,B),J.push(Q)}setCurrentPoseAsRest(){for(const R of this.bones)R.setCurrentPoseAsRest()}}var S=B(11504),f=B(11679),a=B(11161),s=B(11595),x=B(11262),I=B(11640),V=B(11604),M=B(11628),H=B(11728),d=B(11283),X=B(12760);class c{set areUpdatesFrozen(R){R?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new d.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,R||(R=n.e.LastCreatedScene),this._scene=R,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const R=this._scene.getEngine().getCaps();this._canUseTextureForTargets=R.canUseGLVertexID&&R.textureFloat&&R.maxVertexTextureImageUnits>0&&R.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return c.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?c.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(R){this._numMaxInfluencers!==R&&(this._numMaxInfluencers=R,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(R){this._useTextureToStoreTargets!==R&&(this._useTextureToStoreTargets=R,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var R;return c.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(R=this._scene)&&void 0!==R&&R.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(R){return this._activeTargets.data[R]}getTarget(R){return this._targets[R]}getTargetByName(R){for(const J of this._targets)if(J.name===R)return J;return null}addTarget(R){this._targets.push(R),this._targetInfluenceChangedObservers.push(R.onInfluenceChanged.add((R=>{this.areUpdatesFrozen&&R&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(R)}))),this._targetDataLayoutChangedObservers.push(R._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(R){const J=this._targets.indexOf(R);J>=0&&(this._targets.splice(J,1),R.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(J,1)[0]),R._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(J,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(R)}_bind(R){R.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),R.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),R.setTexture("morphTargets",this._targetStoreTexture),R.setInt("morphTargetCount",this.numInfluencers)}clone(){const R=new c(this._scene);for(const J of this._targets)R.addTarget(J.clone());return R.enablePositionMorphing=this.enablePositionMorphing,R.enableNormalMorphing=this.enableNormalMorphing,R.enableTangentMorphing=this.enableTangentMorphing,R.enableUVMorphing=this.enableUVMorphing,R.enableUV2Morphing=this.enableUV2Morphing,R.enableColorMorphing=this.enableColorMorphing,R}serialize(){const R={};R.id=this.uniqueId,R.targets=[];for(const J of this._targets)R.targets.push(J.serialize());return R}_syncActiveTargets(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const J=!!this._targetStoreTexture,B=this.isUsingTextureForTargets;(this._mustSynchronize||J!==B)&&(this._mustSynchronize=!1,this.synchronize());let Q=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let h=-1;for(const y of this._targets)if(h++,0!==y.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=c.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(y),this._morphTargetTextureIndices[Q]=h,this._tempInfluences[Q++]=y.influence}this._morphTargetTextureIndices.length!==Q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Q)),this._influences&&this._influences.length===Q||(this._influences=new Float32Array(Q));for(let y=0;y<Q;y++)this._influences[y]=this._tempInfluences[y];if(R&&this._scene)for(const y of this._scene.meshes)y.morphTargetManager===this&&(B?y._markSubMeshesAsAttributesDirty():y._syncGeometryWithMorphTargetManager())}synchronize(){var R;if(!this._scene||this.areUpdatesFrozen)return;const J=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(R=this._targetStoreTexture)||void 0===R||R.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>J.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const B of this._targets){this._supportsPositions=this._supportsPositions&&B.hasPositions,this._supportsNormals=this._supportsNormals&&B.hasNormals,this._supportsTangents=this._supportsTangents&&B.hasTangents,this._supportsUVs=this._supportsUVs&&B.hasUVs,this._supportsUV2s=this._supportsUV2s&&B.hasUV2s,this._supportsColors=this._supportsColors&&B.hasColors;const R=B.vertexCount;if(0===this._vertexCount)this._vertexCount=R;else if(this._vertexCount!==R)return void P.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${B.name}": ${R}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const R=J.getCaps().maxTextureSize;this._textureWidth>R&&(this._textureHeight=Math.ceil(this._textureWidth/R),this._textureWidth=R);const B=this._targets.length,Q=new Float32Array(B*this._textureWidth*this._textureHeight*4);let h=0;for(let J=0;J<B;J++){const R=this._targets[J],B=R.getPositions(),y=R.getNormals(),N=R.getUVs(),r=R.getTangents(),q=R.getUV2s(),e=R.getColors();h=J*this._textureWidth*this._textureHeight*4;for(let J=0;J<this._vertexCount;J++)this._supportsPositions&&B&&(Q[h]=B[3*J],Q[h+1]=B[3*J+1],Q[h+2]=B[3*J+2],h+=4),this._supportsNormals&&y&&(Q[h]=y[3*J],Q[h+1]=y[3*J+1],Q[h+2]=y[3*J+2],h+=4),this._supportsUVs&&N&&(Q[h]=N[2*J],Q[h+1]=N[2*J+1],h+=4),this._supportsTangents&&r&&(Q[h]=r[3*J],Q[h+1]=r[3*J+1],Q[h+2]=r[3*J+2],h+=4),this._supportsUV2s&&q&&(Q[h]=q[2*J],Q[h+1]=q[2*J+1],h+=4),this._supportsColors&&e&&(Q[h]=e[4*J],Q[h+1]=e[4*J+1],Q[h+2]=e[4*J+2],Q[h+3]=e[4*J+3],h+=4)}this._targetStoreTexture=X.e.CreateRGBATexture(Q,this._textureWidth,this._textureHeight,B,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const B of this._scene.meshes)B.morphTargetManager===this&&B._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const R=this._parentContainer.morphTargetManagers.indexOf(this);R>-1&&this._parentContainer.morphTargetManagers.splice(R,1),this._parentContainer=null}for(const R of this._targets)this._scene.stopAnimation(R)}}static Parse(R,J){const B=new c(J);for(const Q of R.targets)B.addTarget(H.e.Parse(Q,J));return B}}c.EnableTextureStorage=!0,c.MaxActiveMorphTargetsInVertexAttributeMode=8,c.ConstantTargetCountForTextureMode=0;var z=B(12828),p=B(11073),i=B(11517);const W=new Map,k=W;function Y(R,J,B){G(R)&&P.d.Warn(`Extension with the name '${R}' already exists`),W.set(R,{isGLTFExtension:J,factory:B})}function G(R){return W.delete(R)}var g=B(12835),L=B(11781),j=B(11272);class T{static Get(R,J,B){if(!J||void 0==B||!J[B])throw new Error(`${R}: Failed to find index (${B})`);return J[B]}static TryGet(R,J){return R&&void 0!=J&&R[J]?R[J]:null}static Assign(R){if(R)for(let J=0;J<R.length;J++)R[J].index=J}}function F(R){if(R.min&&R.max){const J=R.min,B=R.max,Q=h.TmpVectors.nJ[0].Ar(J[0],J[1],J[2]),y=h.TmpVectors.nJ[1].Ar(B[0],B[1],B[2]);if(R.normalized&&5126!==R.componentType){let J=1;switch(R.componentType){case 5120:J=127;break;case 5121:J=255;break;case 5122:J=32767;break;case 5123:J=65535}const B=1/J;Q.scaleInPlace(B),y.scaleInPlace(B)}return new i.d(Q,y)}return null}class C{static RegisterExtension(R,J){Y(R,!1,J)}static UnregisterExtension(R){return G(R)}get xh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(R){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=R}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((R=>R.dispose&&R.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(R,J,B,Q,h,y){let N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=J,this._assetContainer=B,this._loadData(Q);let y=null;if(R){const J={};if(this._gltf.nodes)for(const R of this._gltf.nodes)R.name&&(J[R.name]=R.index);y=(R instanceof Array?R:[R]).map((R=>{const B=J[R];if(void 0===B)throw new Error(`Failed to find node '${R}'`);return B}))}return await this._loadAsync(h,N,y,(()=>({meshes:this._getMeshes(),OE:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(R,J,B,Q){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=R,this._loadData(J),await this._loadAsync(B,h,null,(()=>{}))}async _loadAsync(R,J,B,Q){return await Promise.resolve().then((async()=>{this._rootUrl=R,this._uniqueRootUrl=!R.startsWith("file:")&&J?R:`${R}${Date.now()}/`,this._fileName=J,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const h=`${z.h[z.h.LOADING]} => ${z.h[z.h.READY]}`,y=`${z.h[z.h.LOADING]} => ${z.h[z.h.COMPLETE]}`;this._parent._startPerformanceCounter(h),this._parent._startPerformanceCounter(y),this._parent._setState(z.h.LOADING),this._extensionsOnLoading();const r=new Array;if(!this.parent.loadOnlyMaterials)if(B)r.push(this.loadSceneAsync("/nodes",{nodes:B,index:-1}));else if(void 0!=this._gltf.AJ||this._gltf.scenes&&this._gltf.scenes[0]){const R=T.Get("/scene",this._gltf.scenes,this._gltf.AJ||0);r.push(this.loadSceneAsync(`/scenes/${R.index}`,R))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let R=0;R<this._gltf.materials.length;++R){const J=this._gltf.materials[R],B="/materials/"+R,Q=S.b.TriangleFillMode;r.push(this._loadMaterialAsync(B,J,null,Q,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&r.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&r.push(this._compileShadowGeneratorsAsync());const q=Promise.all(r).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Cr(!0);for(const R of this._babylonScene.materials){const J=R;void 0!==J.maxSimultaneousLights&&(J.maxSimultaneousLights=Math.max(J.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(z.h.READY),this._skipStartAnimationStep||this._startAnimations(),Q()}));return await q.then((R=>(this._parent._endPerformanceCounter(h),N.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(y),this._parent._setState(z.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(R=>{this._parent.onErrorObservable.notifyObservers(R),this._parent.onErrorObservable.clear(),this.dispose()}))})),R)))})).catch((R=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(R),this._parent.onErrorObservable.clear(),this.dispose()),R}))}_loadData(R){if(this._gltf=R.json,this._setupData(),R.bin){const J=this._gltf.buffers;if(J&&J[0]&&!J[0].uri){const B=J[0];(B.byteLength<R.bin.byteLength-3||B.byteLength>R.bin.byteLength)&&P.d.Warn(`Binary buffer length (${B.byteLength}) from JSON does not match chunk length (${R.bin.byteLength})`),this._bin=R.bin}else P.d.Warn("Unexpected BIN chunk")}}_setupData(){if(T.Assign(this._gltf.accessors),T.Assign(this._gltf.animations),T.Assign(this._gltf.buffers),T.Assign(this._gltf.bufferViews),T.Assign(this._gltf.cameras),T.Assign(this._gltf.images),T.Assign(this._gltf.materials),T.Assign(this._gltf.meshes),T.Assign(this._gltf.nodes),T.Assign(this._gltf.samplers),T.Assign(this._gltf.scenes),T.Assign(this._gltf.skins),T.Assign(this._gltf.textures),this._gltf.nodes){const R={};for(const B of this._gltf.nodes)if(B.children)for(const J of B.children)R[J]=B.index;const J=this._createRootNode();for(const B of this._gltf.nodes){const Q=R[B.index];B.parent=void 0===Q?J:this._gltf.nodes[Q]}}}async _loadExtensionsAsync(){const R=[];if(k.forEach(((J,B)=>{var Q;!1===(null===(Q=this.parent.extensionOptions[B])||void 0===Q?void 0:Q.enabled)?J.isGLTFExtension&&this.isExtensionUsed(B)&&P.d.Warn(`Extension ${B} is used but has been explicitly disabled.`):J.isGLTFExtension&&!this.isExtensionUsed(B)||R.push((async()=>{const R=await J.factory(this);return R.name!==B&&P.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${R.name} !== ${B}`),this._parent.onExtensionLoadedObservable.notifyObservers(R),R})())})),this._extensions.push(...await Promise.all(R)),this._extensions.sort(((R,J)=>(R.order||Number.MAX_VALUE)-(J.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const B of this._gltf.extensionsRequired){if(!this._extensions.some((R=>R.name===B&&R.enabled))){var J;if(!1===(null===(J=this.parent.extensionOptions[B])||void 0===J?void 0:J.enabled))throw new Error(`Required extension ${B} is disabled`);throw new Error(`Required extension ${B} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new M.e("__root__",this._babylonScene);this._rootBabylonMesh=R,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Cr(!1);const J={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case z.e.AUTO:this._babylonScene.useRightHandedSystem||(J.rotation=[0,1,0,0],J.scale=[1,1,-1],C._LoadTransform(J,this._rootBabylonMesh));break;case z.e.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(R),J}loadSceneAsync(R,J){const B=this._extensionsLoadSceneAsync(R,J);if(B)return B;const Q=new Array;if(this.logOpen(`${R} ${J.name||""}`),J.nodes)for(const h of J.nodes){const J=T.Get(`${R}/nodes/${h}`,this._gltf.nodes,h);Q.push(this.loadNodeAsync(`/nodes/${J.index}`,J,(R=>{R.parent=this._rootBabylonMesh})))}for(const h of this._postSceneLoadActions)h();return Q.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(Q).then((()=>{}))}_forEachPrimitive(R,J){if(R._primitiveBabylonMeshes)for(const B of R._primitiveBabylonMeshes)J(B)}_getGeometries(){const R=[],J=this._gltf.nodes;if(J)for(const B of J)this._forEachPrimitive(B,(J=>{const B=J.py;B&&-1===R.indexOf(B)&&R.push(B)}));return R}_getMeshes(){const R=[];this._rootBabylonMesh instanceof V.d&&R.push(this._rootBabylonMesh);const J=this._gltf.nodes;if(J)for(const B of J)this._forEachPrimitive(B,(J=>{R.push(J)}));return R}_getTransformNodes(){const R=[],J=this._gltf.nodes;if(J)for(const B of J)B._babylonTransformNode&&"De"===B._babylonTransformNode.getClassName()&&R.push(B._babylonTransformNode),B._babylonTransformNodeForSkin&&R.push(B._babylonTransformNodeForSkin);return R}_getSkeletons(){const R=[],J=this._gltf.skins;if(J)for(const B of J)B._data&&R.push(B._data.babylonSkeleton);return R}_getAnimationGroups(){const R=[],J=this._gltf.animations;if(J)for(const B of J)B._babylonAnimationGroup&&R.push(B._babylonAnimationGroup);return R}_startAnimations(){switch(this._parent.animationStartMode){case z.d.NONE:break;case z.d.FIRST:{const R=this._getAnimationGroups();0!==R.length&&R[0].start(!0);break}case z.d.ALL:{const R=this._getAnimationGroups();for(const J of R)J.start(!0);break}default:return void P.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadNodeAsync(R,J,B);if(Q)return Q;if(J._babylonTransformNode)throw new Error(`${R}: Invalid recursive node hierarchy`);const h=new Array;this.logOpen(`${R} ${J.name||""}`);const y=Q=>{if(C.AddPointerMetadata(Q,R),C._LoadTransform(J,Q),void 0!=J.camera){const B=T.Get(`${R}/camera`,this._gltf.cameras,J.camera);h.push(this.loadCameraAsync(`/cameras/${B.index}`,B,(R=>{R.parent=Q,this._babylonScene.useRightHandedSystem||(Q.ur.x=-1)})))}if(J.children)for(const B of J.children){const J=T.Get(`${R}/children/${B}`,this._gltf.nodes,B);h.push(this.loadNodeAsync(`/nodes/${J.index}`,J,(R=>{R.parent=Q})))}B(Q)},N=void 0!=J.mesh,r=this._parent.loadSkins&&void 0!=J.skin;if(!N||r){const R=J.name||`node${J.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new s.e(R,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==J.mesh?J._babylonTransformNode=B:J._babylonTransformNodeForSkin=B,y(B)}if(N)if(r){const B=T.Get(`${R}/mesh`,this._gltf.meshes,J.mesh);h.push(this._loadMeshAsync(`/meshes/${B.index}`,J,B,(B=>{const Q=J._babylonTransformNodeForSkin;B.metadata=(0,L.e)(Q.metadata,B.metadata||{});const y=T.Get(`${R}/skin`,this._gltf.skins,J.skin);h.push(this._loadSkinAsync(`/skins/${y.index}`,J,y,(R=>{this._forEachPrimitive(J,(J=>{J.skeleton=R})),this._postSceneLoadActions.push((()=>{if(void 0!=y.skeleton){const R=T.Get(`/skins/${y.index}/skeleton`,this._gltf.nodes,y.skeleton).parent;J.index===R.index?B.parent=Q.parent:B.parent=R._babylonTransformNode}else B.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:Q,skinnedNode:B})}))})))})))}else{const B=T.Get(`${R}/mesh`,this._gltf.meshes,J.mesh);h.push(this._loadMeshAsync(`/meshes/${B.index}`,J,B,y))}return this.logClose(),Promise.all(h).then((()=>(this._forEachPrimitive(J,(R=>{const J=R;!J.isAnInstance&&J.py&&J.py.useBoundingInfoFromGeometry?R.iR():R.refreshBoundingInfo(!0,!0)})),J._babylonTransformNode)))}_loadMeshAsync(R,J,B,Q){const h=B.primitives;if(!h||!h.length)throw new Error(`${R}: Primitives are missing`);void 0==h[0].index&&T.Assign(h);const y=new Array;this.logOpen(`${R} ${B.name||""}`);const N=J.name||`node${J.index}`;if(1===h.length){const Q=B.primitives[0];y.push(this._loadMeshPrimitiveAsync(`${R}/primitives/${Q.index}`,N,J,B,Q,(R=>{J._babylonTransformNode=R,J._primitiveBabylonMeshes=[R]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,J._babylonTransformNode=new s.e(N,this._babylonScene),J._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J._primitiveBabylonMeshes=[];for(const Q of h)y.push(this._loadMeshPrimitiveAsync(`${R}/primitives/${Q.index}`,`${N}_primitive${Q.index}`,J,B,Q,(R=>{R.parent=J._babylonTransformNode,J._primitiveBabylonMeshes.push(R)})))}return Q(J._babylonTransformNode),this.logClose(),Promise.all(y).then((()=>J._babylonTransformNode))}_loadMeshPrimitiveAsync(R,J,B,Q,h,y){const N=this._extensionsLoadMeshPrimitiveAsync(R,J,B,Q,h,y);if(N)return N;this.logOpen(`${R}`);const r=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==B.skin&&!Q.primitives[0].targets;let q,e;if(r&&h._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,q=h._instanceData.babylonSourceMesh.createInstance(J),q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e=h._instanceData.promise;else{const y=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new M.e(J,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.sideOrientation=this._babylonScene.useRightHandedSystem?S.b.CounterClockWiseSideOrientation:S.b.ClockWiseSideOrientation,this._createMorphTargets(R,B,Q,h,N),y.push(this._loadVertexDataAsync(R,h,N).then((async J=>await this._loadMorphTargetsAsync(R,h,N,J).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,J.zR(N),J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const D=C._GetDrawMode(R,h.mode);if(void 0==h.material){let R=this._defaultBabylonMaterialData[D];R||(R=this._createDefaultMaterial("__GLTFLoader._default",D),this._parent.onMaterialLoadedObservable.notifyObservers(R),this._defaultBabylonMaterialData[D]=R),N.material=R}else if(!this.parent.skipMaterials){const J=T.Get(`${R}/material`,this._gltf.materials,h.material);y.push(this._loadMaterialAsync(`/materials/${J.index}`,J,N,D,(R=>{N.material=R})))}e=Promise.all(y),r&&(h._instanceData={babylonSourceMesh:N,promise:e}),q=N}return C.AddPointerMetadata(q,R),this._parent.onMeshLoadedObservable.notifyObservers(q),y(q),this.logClose(),e.then((()=>q))}_loadVertexDataAsync(R,J,B){const Q=this._extensionsLoadVertexDataAsync(R,J,B);if(Q)return Q;const h=J.attributes;if(!h)throw new Error(`${R}: Attributes are missing`);const y=new Array,N=new I.c(B.name,this._babylonScene);if(void 0==J.indices)B.isUnIndexed=!0;else{const B=T.Get(`${R}/indices`,this._gltf.accessors,J.indices);y.push(this._loadIndicesAccessorAsync(`/accessors/${B.index}`,B).then((R=>{N.setIndices(R)})))}const r=(J,Q,r)=>{if(void 0==h[J])return;B._delayInfo=B._delayInfo||[],-1===B._delayInfo.indexOf(Q)&&B._delayInfo.push(Q);const q=T.Get(`${R}/attributes/${J}`,this._gltf.accessors,h[J]);y.push(this._loadVertexAccessorAsync(`/accessors/${q.index}`,q,Q).then((R=>{if(R.getKind()===x.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!B.skeleton){const R=F(q);R&&(N._boundingInfo=R,N.useBoundingInfoFromGeometry=!0)}N.setVerticesBuffer(R,q.count)}))),Q==x.h.MatricesIndicesExtraKind&&(B.numBoneInfluencers=8),r&&r(q)};return r("POSITION",x.h.PositionKind),r("NORMAL",x.h.NormalKind),r("TANGENT",x.h.TangentKind),r("TEXCOORD_0",x.h.UVKind),r("TEXCOORD_1",x.h.UV2Kind),r("TEXCOORD_2",x.h.UV3Kind),r("TEXCOORD_3",x.h.UV4Kind),r("TEXCOORD_4",x.h.UV5Kind),r("TEXCOORD_5",x.h.UV6Kind),r("JOINTS_0",x.h.MatricesIndicesKind),r("WEIGHTS_0",x.h.MatricesWeightsKind),r("JOINTS_1",x.h.MatricesIndicesExtraKind),r("WEIGHTS_1",x.h.MatricesWeightsExtraKind),r("COLOR_0",x.h.ColorKind,(R=>{"VEC4"===R.type&&(B.hasVertexAlpha=!0)})),Promise.all(y).then((()=>N))}_createMorphTargets(R,J,B,Q,h){if(!Q.targets||!this._parent.loadMorphTargets)return;if(void 0==J._numMorphTargets)J._numMorphTargets=Q.targets.length;else if(Q.targets.length!==J._numMorphTargets)throw new Error(`${R}: Primitives do not have the same number of targets`);const y=B.extras?B.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,h.morphTargetManager=new c(this._babylonScene),h.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.morphTargetManager.areUpdatesFrozen=!0;for(let N=0;N<Q.targets.length;N++){const R=J.weights?J.weights[N]:B.weights?B.weights[N]:0,Q=y?y[N]:`morphTarget${N}`;h.morphTargetManager.addTarget(new H.e(Q,R,h.IR()))}}_loadMorphTargetsAsync(R,J,B,Q){if(!J.targets||!this._parent.loadMorphTargets)return Promise.resolve();const h=new Array,y=B.morphTargetManager;for(let N=0;N<y.numTargets;N++){const B=y.getTarget(N);h.push(this._loadMorphTargetVertexDataAsync(`${R}/targets/${N}`,Q,J.targets[N],B))}return Promise.all(h).then((()=>{y.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(R,J,B,Q){const h=new Array,y=(Q,y,N)=>{if(void 0==B[Q])return;const r=J.getVertexBuffer(y);if(!r)return;const q=T.Get(`${R}/${Q}`,this._gltf.accessors,B[Q]);h.push(this._loadFloatAccessorAsync(`/accessors/${q.index}`,q).then((R=>{N(r,R)})))};return y("POSITION",x.h.PositionKind,((R,J)=>{const B=new Float32Array(J.length);R.forEach(J.length,((R,Q)=>{B[Q]=J[Q]+R})),Q.setPositions(B)})),y("NORMAL",x.h.NormalKind,((R,J)=>{const B=new Float32Array(J.length);R.forEach(B.length,((R,Q)=>{B[Q]=J[Q]+R})),Q.setNormals(B)})),y("TANGENT",x.h.TangentKind,((R,J)=>{const B=new Float32Array(J.length/3*4);let h=0;R.forEach(J.length/3*4,((R,Q)=>{(Q+1)%4!==0&&(B[h]=J[h]+R,h++)})),Q.setTangents(B)})),y("TEXCOORD_0",x.h.UVKind,((R,J)=>{const B=new Float32Array(J.length);R.forEach(J.length,((R,Q)=>{B[Q]=J[Q]+R})),Q.setUVs(B)})),y("TEXCOORD_1",x.h.UV2Kind,((R,J)=>{const B=new Float32Array(J.length);R.forEach(J.length,((R,Q)=>{B[Q]=J[Q]+R})),Q.setUV2s(B)})),y("COLOR_0",x.h.ColorKind,((J,B)=>{let h=null;const y=J.getSize();if(3===y){h=new Float32Array(B.length/3*4),J.forEach(B.length,((R,J)=>{const Q=Math.floor(J/3),y=J%3;h[4*Q+y]=B[3*Q+y]+R}));for(let R=0;R<B.length/3;++R)h[4*R+3]=1}else{if(4!==y)throw new Error(`${R}: Invalid number of components (${y}) for COLOR_0 attribute`);h=new Float32Array(B.length),J.forEach(B.length,((R,J)=>{h[J]=B[J]+R}))}Q.setColors(h)})),await Promise.all(h).then((()=>{}))}static _LoadTransform(R,J){if(void 0!=R.skin)return;let B=h.nJ.Zero(),Q=h.Quaternion.Identity(),y=h.nJ.One();if(R.matrix){h.Matrix.fJ(R.matrix).decompose(y,Q,B)}else R.translation&&(B=h.nJ.fJ(R.translation)),R.rotation&&(Q=h.Quaternion.fJ(R.rotation)),R.scale&&(y=h.nJ.fJ(R.scale));J.position=B,J.rotationQuaternion=Q,J.ur=y}_loadSkinAsync(R,J,B,Q){if(!this._parent.loadSkins)return Promise.resolve();const h=this._extensionsLoadSkinAsync(R,J,B);if(h)return h;if(B._data)return Q(B._data.babylonSkeleton),B._data.promise;const y=`skeleton${B.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new u(B.name||y,y,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(R,B,N);const r=this._loadSkinInverseBindMatricesDataAsync(R,B).then((R=>{this._updateBoneMatrices(N,R)}));return B._data={babylonSkeleton:N,promise:r},Q(N),r}_loadBones(R,J,B){if(void 0==J.skeleton||this._parent.alwaysComputeSkeletonRootNode){const B=this._findSkeletonRootNode(`${R}/joints`,J.joints);if(B)if(void 0===J.skeleton)J.skeleton=B.index;else{const Q=(R,J)=>{for(;J.parent;J=J.parent)if(J.parent===R)return!0;return!1},h=T.Get(`${R}/skeleton`,this._gltf.nodes,J.skeleton);h===B||Q(h,B)||(P.d.Warn(`${R}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),J.skeleton=B.index)}else P.d.Warn(`${R}: Failed to find common root`)}const Q={};for(const h of J.joints){const y=T.Get(`${R}/joints/${h}`,this._gltf.nodes,h);this._loadBone(y,J,B,Q)}}_findSkeletonRootNode(R,J){if(0===J.length)return null;const B={};for(const h of J){const J=[];let Q=T.Get(`${R}/${h}`,this._gltf.nodes,h);for(;-1!==Q.index;)J.unshift(Q),Q=Q.parent;B[h]=J}let Q=null;for(let h=0;;++h){let R=B[J[0]];if(h>=R.length)return Q;const y=R[h];for(let N=1;N<J.length;++N)if(R=B[J[N]],h>=R.length||y!==R[h])return Q;Q=y}}_loadBone(R,J,B,Q){R._isJoint=!0;let h=Q[R.index];if(h)return h;let y=null;R.index!==J.skeleton&&(R.parent&&-1!==R.parent.index?y=this._loadBone(R.parent,J,B,Q):void 0!==J.skeleton&&P.d.Warn(`/skins/${J.index}/skeleton: Skeleton node is not a common root`));const N=J.joints.indexOf(R.index);return h=new e.b(R.name||`joint${R.index}`,B,y,this._getNodeMatrix(R),null,null,N),Q[R.index]=h,this._postSceneLoadActions.push((()=>{h.linkTransformNode(R._babylonTransformNode)})),h}_loadSkinInverseBindMatricesDataAsync(R,J){if(void 0==J.inverseBindMatrices)return Promise.resolve(null);const B=T.Get(`${R}/inverseBindMatrices`,this._gltf.accessors,J.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${B.index}`,B)}_updateBoneMatrices(R,J){for(const B of R.bones){const R=h.Matrix.Identity(),Q=B._index;J&&-1!==Q&&(h.Matrix.FromArrayToRef(J,16*Q,R),R.invertToRef(R));const y=B.getParent();y&&R.multiplyToRef(y.getAbsoluteInverseBindMatrix(),R),B.th(R,!1,!1),B._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(R){return R.matrix?h.Matrix.fJ(R.matrix):h.Matrix.Compose(R.scale?h.nJ.fJ(R.scale):h.nJ.One(),R.rotation?h.Quaternion.fJ(R.rotation):h.Quaternion.Identity(),R.translation?h.nJ.fJ(R.translation):h.nJ.Zero())}loadCameraAsync(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadCameraAsync(R,J,B);if(Q)return Q;const y=new Array;this.logOpen(`${R} ${J.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new q.b(J.name||`camera${J.index}`,h.nJ.Zero(),this._babylonScene,!1);switch(N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J._babylonCamera=N,N.setTarget(new h.nJ(0,0,-1)),J.type){case"perspective":{const B=J.perspective;if(!B)throw new Error(`${R}: Camera perspective properties are missing`);N.fov=B.yfov,N.mh=B.znear,N.maxZ=B.zfar||0;break}case"orthographic":if(!J.orthographic)throw new Error(`${R}: Camera orthographic properties are missing`);N.mode=r.d.ORTHOGRAPHIC_CAMERA,N.orthoLeft=-J.orthographic.xmag,N.orthoRight=J.orthographic.xmag,N.orthoBottom=-J.orthographic.ymag,N.orthoTop=J.orthographic.ymag,N.mh=J.orthographic.znear,N.maxZ=J.orthographic.zfar;break;default:throw new Error(`${R}: Invalid camera type (${J.type})`)}return C.AddPointerMetadata(N,R),this._parent.onCameraLoadedObservable.notifyObservers(N),B(N),this.logClose(),Promise.all(y).then((()=>N))}_loadAnimationsAsync(){const R=this._gltf.animations;if(!R)return Promise.resolve();const J=new Array;for(let B=0;B<R.length;B++){const Q=R[B];J.push(this.loadAnimationAsync(`/animations/${Q.index}`,Q).then((R=>{0===R.targetedAnimations.length&&R.dispose()})))}return Promise.all(J).then((()=>{}))}loadAnimationAsync(R,J){const Q=this._extensionsLoadAnimationAsync(R,J);return Q||B.e(78).then(B.bind(B,14316)).then((B=>{let{AnimationGroup:Q}=B;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new Q(J.name||`animation${J.index}`,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J._babylonAnimationGroup=h;const y=new Array;T.Assign(J.channels),T.Assign(J.samplers);for(const N of J.channels)y.push(this._loadAnimationChannelAsync(`${R}/channels/${N.index}`,R,J,N,((R,J)=>{R.animations=R.animations||[],R.animations.push(J),h.addTargetedAnimation(J,R)})));return Promise.all(y).then((()=>(h.normalize(0),h)))}))}async _loadAnimationChannelAsync(R,J,Q,h,y){const N=this._extensionsLoadAnimationChannelAsync(R,J,Q,h,y);if(N)return await N;if(void 0==h.target.node)return await Promise.resolve();const r=T.Get(`${R}/target/node`,this._gltf.nodes,h.target.node),q=h.target.path,e="weights"===q;if(e&&!r._numMorphTargets||!e&&!r._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!e&&!r._isJoint)return await Promise.resolve();let D;switch(await Promise.resolve().then(B.bind(B,12848)),q){case"translation":var l;D=null===(l=(0,g.f)("/nodes/{}/translation"))||void 0===l?void 0:l.interpolation;break;case"rotation":var E;D=null===(E=(0,g.f)("/nodes/{}/rotation"))||void 0===E?void 0:E.interpolation;break;case"scale":var O;D=null===(O=(0,g.f)("/nodes/{}/scale"))||void 0===O?void 0:O.interpolation;break;case"weights":var n;D=null===(n=(0,g.f)("/nodes/{}/weights"))||void 0===n?void 0:n.interpolation;break;default:throw new Error(`${R}/target/path: Invalid value (${h.target.path})`)}if(!D)throw new Error(`${R}/target/path: Could not find interpolation properties for target path (${h.target.path})`);const P={object:r,info:D};return await this._loadAnimationChannelFromTargetInfoAsync(R,J,Q,h,P,y)}_loadAnimationChannelFromTargetInfoAsync(R,J,B,Q,h,y){const N=this.parent.targetFps,r=1/N,q=T.Get(`${R}/sampler`,B.samplers,Q.sampler);return this._loadAnimationSamplerAsync(`${J}/samplers/${Q.sampler}`,q).then((R=>{let J=0;const q=h.object,e=h.info;for(const h of e){const e=h.getStride(q),D=R.input,l=R.output,E=new Array(D.length);let O=0;switch(R.interpolation){case"STEP":for(let R=0;R<D.length;R++){const J=h.getValue(q,l,O,1);O+=e,E[R]={frame:D[R]*N,value:J,interpolation:1}}break;case"CUBICSPLINE":for(let R=0;R<D.length;R++){const J=h.getValue(q,l,O,r);O+=e;const B=h.getValue(q,l,O,1);O+=e;const Q=h.getValue(q,l,O,r);O+=e,E[R]={frame:D[R]*N,inTangent:J,value:B,outTangent:Q}}break;case"LINEAR":for(let R=0;R<D.length;R++){const J=h.getValue(q,l,O,1);O+=e,E[R]={frame:D[R]*N,value:J}}}if(O>0){const R=`${B.name||`animation${B.index}`}_channel${Q.index}_${J}`,r=h.buildAnimations(q,R,N,E);for(const B of r)J++,y(B.babylonAnimatable,B.babylonAnimation)}}}))}_loadAnimationSamplerAsync(R,J){if(J._data)return J._data;const B=J.interpolation||"LINEAR";switch(B){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${R}/interpolation: Invalid value (${J.interpolation})`)}const Q=T.Get(`${R}/input`,this._gltf.accessors,J.input),h=T.Get(`${R}/output`,this._gltf.accessors,J.output);return J._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q),this._loadFloatAccessorAsync(`/accessors/${h.index}`,h)]).then((R=>{let[J,Q]=R;return{input:J,interpolation:B,output:Q}})),J._data}loadBufferAsync(R,J,B,Q){const h=this._extensionsLoadBufferAsync(R,J,B,Q);if(h)return h;if(!J._data)if(J.uri)J._data=this.loadUriAsync(`${R}/uri`,J,J.uri);else{if(!this._bin)throw new Error(`${R}: Uri is missing or the binary glTF is missing its binary chunk`);J._data=this._bin.readAsync(0,J.byteLength)}return J._data.then((J=>{try{return new Uint8Array(J.buffer,J.byteOffset+B,Q)}catch(h){throw new Error(`${R}: ${h.message}`)}}))}loadBufferViewAsync(R,J){const B=this._extensionsLoadBufferViewAsync(R,J);if(B)return B;if(J._data)return J._data;const Q=T.Get(`${R}/buffer`,this._gltf.buffers,J.buffer);return J._data=this.loadBufferAsync(`/buffers/${Q.index}`,Q,J.byteOffset||0,J.byteLength),J._data}_loadAccessorAsync(R,J,B){if(J._data)return J._data;const Q=C._GetNumComponents(R,J.type),h=Q*x.h.GetTypeByteLength(J.componentType),y=Q*J.count;if(void 0==J.bufferView)J._data=Promise.resolve(new B(y));else{const N=T.Get(`${R}/bufferView`,this._gltf.bufferViews,J.bufferView);J._data=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((r=>{if(5126!==J.componentType||J.normalized||N.byteStride&&N.byteStride!==h){const R=new B(y);return x.h.ForEach(r,J.byteOffset||0,N.byteStride||h,Q,J.componentType,R.length,J.normalized||!1,((J,B)=>{R[B]=J})),R}return C._GetTypedArray(R,J.componentType,r,J.byteOffset,y)}))}if(J.sparse){const y=J.sparse;J._data=J._data.then((N=>{const r=N,q=T.Get(`${R}/sparse/indices/bufferView`,this._gltf.bufferViews,y.indices.bufferView),e=T.Get(`${R}/sparse/values/bufferView`,this._gltf.bufferViews,y.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${q.index}`,q),this.loadBufferViewAsync(`/bufferViews/${e.index}`,e)]).then((N=>{let[q,e]=N;const D=C._GetTypedArray(`${R}/sparse/indices`,y.indices.componentType,q,y.indices.byteOffset,y.count),l=Q*y.count;let E;if(5126!==J.componentType||J.normalized){const N=C._GetTypedArray(`${R}/sparse/values`,J.componentType,e,y.values.byteOffset,l);E=new B(l),x.h.ForEach(N,0,h,Q,J.componentType,E.length,J.normalized||!1,((R,J)=>{E[J]=R}))}else E=C._GetTypedArray(`${R}/sparse/values`,J.componentType,e,y.values.byteOffset,l);let O=0;for(let R=0;R<D.length;R++){let J=D[R]*Q;for(let R=0;R<Q;R++)r[J++]=E[O++]}return r}))}))}return J._data}_loadFloatAccessorAsync(R,J){return this._loadAccessorAsync(R,J,Float32Array)}_loadIndicesAccessorAsync(R,J){if("SCALAR"!==J.type)throw new Error(`${R}/type: Invalid value ${J.type}`);if(5121!==J.componentType&&5123!==J.componentType&&5125!==J.componentType)throw new Error(`${R}/componentType: Invalid value ${J.componentType}`);if(J._data)return J._data;if(J.sparse){const B=C._GetTypedArrayConstructor(`${R}/componentType`,J.componentType);J._data=this._loadAccessorAsync(R,J,B)}else{const B=T.Get(`${R}/bufferView`,this._gltf.bufferViews,J.bufferView);J._data=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((B=>C._GetTypedArray(R,J.componentType,B,J.byteOffset,J.count)))}return J._data}_loadVertexBufferViewAsync(R){if(R._babylonBuffer)return R._babylonBuffer;const J=this._babylonScene.getEngine();return R._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${R.index}`,R).then((R=>new x.d(J,R,!1))),R._babylonBuffer}_loadVertexAccessorAsync(R,J,B){var Q;if(null!==(Q=J._babylonVertexBuffer)&&void 0!==Q&&Q[B])return J._babylonVertexBuffer[B];J._babylonVertexBuffer||(J._babylonVertexBuffer={});const h=this._babylonScene.getEngine();if(J.sparse||void 0==J.bufferView)J._babylonVertexBuffer[B]=this._loadFloatAccessorAsync(R,J).then((R=>new x.h(h,R,B,!1)));else{const Q=T.Get(`${R}/bufferView`,this._gltf.bufferViews,J.bufferView);J._babylonVertexBuffer[B]=this._loadVertexBufferViewAsync(Q).then((y=>{const N=C._GetNumComponents(R,J.type);return new x.h(h,y,B,!1,void 0,Q.byteStride,void 0,J.byteOffset,N,J.componentType,J.normalized,!0,void 0,!0)}))}return J._babylonVertexBuffer[B]}_loadMaterialMetallicRoughnessPropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;return J&&(J.baseColorFactor?(B.albedoColor=y.SJ.fJ(J.baseColorFactor),B.alpha=J.baseColorFactor[3]):B.albedoColor=y.SJ.White(),B.metallic=void 0==J.metallicFactor?1:J.metallicFactor,B.roughness=void 0==J.roughnessFactor?1:J.roughnessFactor,J.baseColorTexture&&Q.push(this.loadTextureInfoAsync(`${R}/baseColorTexture`,J.baseColorTexture,(R=>{R.name=`${B.name} (Base Color)`,B.albedoTexture=R}))),J.metallicRoughnessTexture&&(J.metallicRoughnessTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${R}/metallicRoughnessTexture`,J.metallicRoughnessTexture,(R=>{R.name=`${B.name} (Metallic Roughness)`,B.metallicTexture=R}))),B.useMetallnessFromMetallicTextureBlue=!0,B.useRoughnessFromMetallicTextureGreen=!0,B.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(Q).then((()=>{}))}_loadMaterialAsync(R,J,B,Q){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const y=this._extensionsLoadMaterialAsync(R,J,B,Q,h);if(y)return y;J._data=J._data||{};let N=J._data[Q];if(!N){this.logOpen(`${R} ${J.name||""}`);const B=this.createMaterial(R,J,Q);N={babylonMaterial:B,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(R,J,B)},J._data[Q]=N,C.AddPointerMetadata(B,R),this._parent.onMaterialLoadedObservable.notifyObservers(B),this.logClose()}return B&&(N.babylonMeshes.push(B),B.eh.addOnce((()=>{const R=N.babylonMeshes.indexOf(B);-1!==R&&N.babylonMeshes.splice(R,1)}))),h(N.babylonMaterial),N.promise.then((()=>N.babylonMaterial))}_createDefaultMaterial(R,J){this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new f.b(R,this._babylonScene);return B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.fillMode=J,B.enableSpecularAntiAliasing=!0,B.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,B.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,B.transparencyMode=f.b.PBRMATERIAL_OPAQUE,B.metallic=1,B.roughness=1,B}createMaterial(R,J,B){const Q=this._extensionsCreateMaterial(R,J,B);if(Q)return Q;const h=J.name||`material${J.index}`;return this._createDefaultMaterial(h,B)}loadMaterialPropertiesAsync(R,J,B){const Q=this._extensionsLoadMaterialPropertiesAsync(R,J,B);if(Q)return Q;const h=new Array;return h.push(this.loadMaterialBasePropertiesAsync(R,J,B)),J.pbrMetallicRoughness&&h.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${R}/pbrMetallicRoughness`,J.pbrMetallicRoughness,B)),this.loadMaterialAlphaProperties(R,J,B),Promise.all(h).then((()=>{}))}loadMaterialBasePropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;return B.emissiveColor=J.emissiveFactor?y.SJ.fJ(J.emissiveFactor):new y.SJ(0,0,0),J.doubleSided&&(B.Pr=!1,B.twoSidedLighting=!0),J.normalTexture&&(J.normalTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${R}/normalTexture`,J.normalTexture,(R=>{R.name=`${B.name} (Normal)`,B.bumpTexture=R}))),B.invertNormalMapX=!this._babylonScene.useRightHandedSystem,B.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=J.normalTexture.scale&&B.bumpTexture&&(B.bumpTexture.level=J.normalTexture.scale),B.forceIrradianceInFragment=!0),J.occlusionTexture&&(J.occlusionTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${R}/occlusionTexture`,J.occlusionTexture,(R=>{R.name=`${B.name} (Occlusion)`,B.ambientTexture=R}))),B.useAmbientInGrayScale=!0,void 0!=J.occlusionTexture.strength&&(B.ambientTextureStrength=J.occlusionTexture.strength)),J.emissiveTexture&&Q.push(this.loadTextureInfoAsync(`${R}/emissiveTexture`,J.emissiveTexture,(R=>{R.name=`${B.name} (Emissive)`,B.emissiveTexture=R}))),Promise.all(Q).then((()=>{}))}loadMaterialAlphaProperties(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);switch(J.alphaMode||"OPAQUE"){case"OPAQUE":B.transparencyMode=f.b.PBRMATERIAL_OPAQUE,B.alpha=1;break;case"MASK":B.transparencyMode=f.b.PBRMATERIAL_ALPHATEST,B.alphaCutOff=void 0==J.alphaCutoff?.5:J.alphaCutoff,B.albedoTexture&&(B.albedoTexture.bh=!0);break;case"BLEND":B.transparencyMode=f.b.PBRMATERIAL_ALPHABLEND,B.albedoTexture&&(B.albedoTexture.bh=!0,B.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${R}/alphaMode: Invalid value (${J.alphaMode})`)}}loadTextureInfoAsync(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadTextureInfoAsync(R,J,B);if(Q)return Q;if(this.logOpen(`${R}`),J.texCoord>=6)throw new Error(`${R}/texCoord: Invalid value (${J.texCoord})`);const h=T.Get(`${R}/index`,this._gltf.textures,J.index);h._textureInfo=J;const y=this._loadTextureAsync(`/textures/${J.index}`,h,(Q=>{Q.coordinatesIndex=J.texCoord||0,C.AddPointerMetadata(Q,R),this._parent.onTextureLoadedObservable.notifyObservers(Q),B(Q)}));return this.logClose(),y}_loadTextureAsync(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadTextureAsync(R,J,B);if(Q)return Q;this.logOpen(`${R} ${J.name||""}`);const h=void 0==J.sampler?C.DefaultSampler:T.Get(`${R}/sampler`,this._gltf.samplers,J.sampler),y=T.Get(`${R}/source`,this._gltf.images,J.source),N=this._createTextureAsync(R,h,y,B,void 0,!J._textureInfo.nonColorData);return this.logClose(),N}_createTextureAsync(R,J,B){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},y=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0;const r=this._loadSampler(`/samplers/${J.index}`,J),q=new Array,e=new Q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D={noMipmap:r.noMipMaps,invertY:!1,samplingMode:r.samplingMode,t:()=>{this._disposed||e.resolve()},onError:(J,B)=>{this._disposed||e.reject(new Error(`${R}: ${B&&B.message?B.message:J||"Failed to load texture"}`))},mimeType:B.mimeType??(0,p.i)(B.uri??""),loaderOptions:y,useSRGBBuffer:!!N&&this._parent.useSRGBBuffers},l=new a.d(null,this._babylonScene,D);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.push(e.promise),q.push(this.loadImageAsync(`/images/${B.index}`,B).then((R=>{const J=B.uri||`${this._fileName}#image${B.index}`,Q=`data:${this._uniqueRootUrl}${J}`;l.updateURL(Q,R);const h=l.getInternalTexture();h&&(h.label=B.name)}))),l.wrapU=r.wrapU,l.wrapV=r.wrapV,h(l),this._parent.useGltfTextureNames&&(l.name=B.name||B.uri||`image${B.index}`),Promise.all(q).then((()=>l))}_loadSampler(R,J){return J._data||(J._data={noMipMaps:9728===J.minFilter||9729===J.minFilter,samplingMode:C._GetTextureSamplingMode(R,J),wrapU:C._GetTextureWrapMode(`${R}/wrapS`,J.wrapS),wrapV:C._GetTextureWrapMode(`${R}/wrapT`,J.wrapT)}),J._data}loadImageAsync(R,J){if(!J._data){if(this.logOpen(`${R} ${J.name||""}`),J.uri)J._data=this.loadUriAsync(`${R}/uri`,J,J.uri);else{const B=T.Get(`${R}/bufferView`,this._gltf.bufferViews,J.bufferView);J._data=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B)}this.logClose()}return J._data}loadUriAsync(R,J,B){const Q=this._extensionsLoadUriAsync(R,J,B);if(Q)return Q;if(!C._ValidateUri(B))throw new Error(`${R}: '${B}' is invalid`);if((0,p.j)(B)){const J=new Uint8Array((0,p.d)(B));return this.log(`${R}: Decoded ${B.substring(0,64)}... (${J.length} bytes)`),Promise.resolve(J)}return this.log(`${R}: Loading ${B}`),this._parent.preprocessUrlAsync(this._rootUrl+B).then((J=>new Promise(((Q,h)=>{this._parent._loadFile(this._babylonScene,J,(J=>{this._disposed||(this.log(`${R}: Loaded ${B} (${J.byteLength} bytes)`),Q(new Uint8Array(J)))}),!0,(J=>{h(new p.k(`${R}: Failed to load '${B}'${J?": "+J.status+" "+J.statusText:""}`,J))}))}))))}static AddPointerMetadata(R,J){R.metadata=R.metadata||{};const B=R._internalMetadata=R._internalMetadata||{},Q=B.xh=B.xh||{};(Q.pointers=Q.pointers||[]).push(J)}static _GetTextureWrapMode(R,J){switch(J=void 0==J?10497:J){case 33071:return a.d.CLAMP_ADDRESSMODE;case 33648:return a.d.MIRROR_ADDRESSMODE;case 10497:return a.d.WRAP_ADDRESSMODE;default:return P.d.Warn(`${R}: Invalid value (${J})`),a.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(R,J){const B=void 0==J.magFilter?9729:J.magFilter,Q=void 0==J.minFilter?9987:J.minFilter;if(9729===B)switch(Q){case 9728:return a.d.LINEAR_NEAREST;case 9729:return a.d.LINEAR_LINEAR;case 9984:return a.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return a.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return a.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return a.d.LINEAR_LINEAR_MIPLINEAR;default:return P.d.Warn(`${R}/minFilter: Invalid value (${Q})`),a.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==B&&P.d.Warn(`${R}/magFilter: Invalid value (${B})`),Q){case 9728:return a.d.NEAREST_NEAREST;case 9729:return a.d.NEAREST_LINEAR;case 9984:return a.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return a.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return a.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return a.d.NEAREST_LINEAR_MIPLINEAR;default:return P.d.Warn(`${R}/minFilter: Invalid value (${Q})`),a.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(R,J){try{return(0,j.t)(J)}catch(B){throw new Error(`${R}: ${B.message}`)}}static _GetTypedArray(R,J,B,Q,h){const y=B.buffer;Q=B.byteOffset+(Q||0);const N=C._GetTypedArrayConstructor(`${R}/componentType`,J),r=x.h.GetTypeByteLength(J);return Q%r!==0?(P.d.Warn(`${R}: Copying buffer as byte offset (${Q}) is not a multiple of component type byte length (${r})`),new N(y.slice(Q,Q+h*r),0)):new N(y,Q,h)}static _GetNumComponents(R,J){switch(J){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${R}: Invalid type (${J})`)}static _ValidateUri(R){return N.Tools.IsBase64(R)||-1===R.indexOf("..")}static _GetDrawMode(R,J){switch(void 0==J&&(J=4),J){case 0:return S.b.PointListDrawMode;case 1:return S.b.LineListDrawMode;case 2:return S.b.LineLoopDrawMode;case 3:return S.b.LineStripDrawMode;case 4:return S.b.TriangleFillMode;case 5:return S.b.TriangleStripDrawMode;case 6:return S.b.TriangleFanDrawMode}throw new Error(`${R}: Invalid mesh primitive mode (${J})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const R=new Array;if(this._gltf.materials)for(const J of this._gltf.materials)if(J._data)for(const B in J._data){const Q=J._data[B];for(const J of Q.babylonMeshes){J.ny(!0);const B=Q.babylonMaterial;R.push(B.forceCompilationAsync(J)),R.push(B.forceCompilationAsync(J,{useInstances:!0})),this._parent.useClipPlane&&(R.push(B.forceCompilationAsync(J,{clipPlane:!0})),R.push(B.forceCompilationAsync(J,{clipPlane:!0,useInstances:!0})))}}return Promise.all(R).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const R=new Array,J=this._babylonScene.lights;for(const B of J){const J=B.getShadowGenerator();J&&R.push(J.forceCompilationAsync())}return Promise.all(R).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(R){for(const J of this._extensions)J.enabled&&R(J)}_applyExtensions(R,J,B){for(const Q of this._extensions)if(Q.enabled){const h=`${Q.name}.${J}`,y=R;y._activeLoaderExtensionFunctions=y._activeLoaderExtensionFunctions||{};const N=y._activeLoaderExtensionFunctions;if(!N[h]){N[h]=!0;try{const R=B(Q);if(R)return R}finally{delete N[h]}}}return null}_extensionsOnLoading(){this._forEachExtensions((R=>R.onLoading&&R.onLoading()))}_extensionsOnReady(){this._forEachExtensions((R=>R.onReady&&R.onReady()))}_extensionsLoadSceneAsync(R,J){return this._applyExtensions(J,"loadScene",(B=>B.loadSceneAsync&&B.loadSceneAsync(R,J)))}_extensionsLoadNodeAsync(R,J,B){return this._applyExtensions(J,"loadNode",(Q=>Q.loadNodeAsync&&Q.loadNodeAsync(R,J,B)))}_extensionsLoadCameraAsync(R,J,B){return this._applyExtensions(J,"loadCamera",(Q=>Q.loadCameraAsync&&Q.loadCameraAsync(R,J,B)))}_extensionsLoadVertexDataAsync(R,J,B){return this._applyExtensions(J,"loadVertexData",(Q=>Q._loadVertexDataAsync&&Q._loadVertexDataAsync(R,J,B)))}_extensionsLoadMeshPrimitiveAsync(R,J,B,Q,h,y){return this._applyExtensions(h,"loadMeshPrimitive",(N=>N._loadMeshPrimitiveAsync&&N._loadMeshPrimitiveAsync(R,J,B,Q,h,y)))}_extensionsLoadMaterialAsync(R,J,B,Q,h){return this._applyExtensions(J,"loadMaterial",(y=>y._loadMaterialAsync&&y._loadMaterialAsync(R,J,B,Q,h)))}_extensionsCreateMaterial(R,J,B){return this._applyExtensions(J,"createMaterial",(Q=>Q.createMaterial&&Q.createMaterial(R,J,B)))}_extensionsLoadMaterialPropertiesAsync(R,J,B){return this._applyExtensions(J,"loadMaterialProperties",(Q=>Q.loadMaterialPropertiesAsync&&Q.loadMaterialPropertiesAsync(R,J,B)))}_extensionsLoadTextureInfoAsync(R,J,B){return this._applyExtensions(J,"loadTextureInfo",(Q=>Q.loadTextureInfoAsync&&Q.loadTextureInfoAsync(R,J,B)))}_extensionsLoadTextureAsync(R,J,B){return this._applyExtensions(J,"loadTexture",(Q=>Q._loadTextureAsync&&Q._loadTextureAsync(R,J,B)))}_extensionsLoadAnimationAsync(R,J){return this._applyExtensions(J,"loadAnimation",(B=>B.loadAnimationAsync&&B.loadAnimationAsync(R,J)))}_extensionsLoadAnimationChannelAsync(R,J,B,Q,h){return this._applyExtensions(B,"loadAnimationChannel",(y=>y._loadAnimationChannelAsync&&y._loadAnimationChannelAsync(R,J,B,Q,h)))}_extensionsLoadSkinAsync(R,J,B){return this._applyExtensions(B,"loadSkin",(Q=>Q._loadSkinAsync&&Q._loadSkinAsync(R,J,B)))}_extensionsLoadUriAsync(R,J,B){return this._applyExtensions(J,"loadUri",(Q=>Q._loadUriAsync&&Q._loadUriAsync(R,J,B)))}_extensionsLoadBufferViewAsync(R,J){return this._applyExtensions(J,"loadBufferView",(B=>B.loadBufferViewAsync&&B.loadBufferViewAsync(R,J)))}_extensionsLoadBufferAsync(R,J,B,Q){return this._applyExtensions(J,"loadBuffer",(h=>h.loadBufferAsync&&h.loadBufferAsync(R,J,B,Q)))}static LoadExtensionAsync(R,J,B,Q){if(!J.extensions)return null;const h=J.extensions[B];return h?Q(`${R}/extensions/${B}`,h):null}static LoadExtraAsync(R,J,B,Q){if(!J.extras)return null;const h=J.extras[B];return h?Q(`${R}/extras/${B}`,h):null}isExtensionUsed(R){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(R)}logOpen(R){this._parent._logOpen(R)}logClose(){this._parent._logClose()}log(R){this._parent._log(R)}startPerformanceCounter(R){this._parent._startPerformanceCounter(R)}endPerformanceCounter(R){this._parent._endPerformanceCounter(R)}}C.DefaultSampler={index:-1},z.c._CreateGLTF2Loader=R=>new C(R);var b=B(12848),w=B(11370),K=B(11217),v=B(12851),m=B(12856);class o extends m.d{constructor(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",R),this._texture=R.getEngine().createRawCubeTexture(J,B,Q,h,y,N,r,q)}update(R,J,B,Q){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,R,J,B,Q,h)}updateRGBDAsync(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,v.l)(this._texture,R,J,B,Q).then((()=>{}))}clone(){return K.c.Clone((()=>{const R=this.IR(),J=this._texture,B=new o(R,J._bufferViewArray,J.width,J.format,J.type,J.generateMipMaps,J.invertY,J.samplingMode,J._compression);return 13===J.source&&B.updateRGBDAsync(J._bufferViewArrayArray,J._sphericalPolynomial,J._lodGenerationScale,J._lodGenerationOffset),B}),this)}}const t="EXT_lights_image_based";class Z{constructor(R){this.name=t,this._loader=R,this.enabled=this._loader.isExtensionUsed(t)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.xh.extensions;if(R&&R[this.name]){const J=R[this.name];this._lights=J.lights}}loadSceneAsync(R,J){return C.LoadExtensionAsync(R,J,this.name,(async(B,Q)=>{this._loader._allMaterialsDirtyRequired=!0;const h=new Array;h.push(this._loader.loadSceneAsync(R,J)),this._loader.logOpen(`${B}`);const y=T.Get(`${B}/light`,this._lights,Q.hh);return h.push(this._loadLightAsync(`/extensions/${this.name}/lights/${Q.hh}`,y).then((R=>{this._loader.babylonScene.environmentTexture=R}))),this._loader.logClose(),await Promise.all(h).then((()=>{}))}))}_loadLightAsync(R,J){if(!J._loaded){const B=new Array;this._loader.logOpen(`${R}`);const Q=new Array(J.specularImages.length);for(let h=0;h<J.specularImages.length;h++){const y=J.specularImages[h];Q[h]=new Array(y.length);for(let J=0;J<y.length;J++){const N=`${R}/specularImages/${h}/${J}`;this._loader.logOpen(`${N}`);const r=y[J],q=T.Get(N,this._loader.xh.images,r);B.push(this._loader.loadImageAsync(`/images/${r}`,q).then((R=>{Q[h][J]=R}))),this._loader.logClose()}}this._loader.logClose(),J._loaded=Promise.all(B).then((async()=>{const B=new o(this._loader.babylonScene,null,J.specularImageSize);if(B.name=J.name||"environment",J._babylonTexture=B,void 0!=J.Vr&&(B.level=J.Vr),J.rotation){let R=h.Quaternion.fJ(J.rotation);this._loader.babylonScene.useRightHandedSystem||(R=h.Quaternion.Inverse(R)),h.Matrix.FromQuaternionToRef(R,B.getReflectionTextureMatrix())}if(!J.irradianceCoefficients)throw new Error(`${R}: Irradiance coefficients are missing`);const y=w.b.fJ(J.irradianceCoefficients);y.scaleInPlace(J.Vr),y.convertIrradianceToLambertianRadiance();const N=w.d.FromHarmonics(y),r=(Q.length-1)/Math.log2(J.specularImageSize);return await B.updateRGBDAsync(Q,N,r)}))}return J._loaded.then((()=>J._babylonTexture))}}G(t),Y(t,!0,(R=>new Z(R)));B(11755);const U="EXT_mesh_gpu_instancing";class RR{constructor(R){this.name=U,this._loader=R,this.enabled=this._loader.isExtensionUsed(U)}dispose(){this._loader=null}loadNodeAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(R,Q)=>{this._loader._disableInstancedMesh++;const y=this._loader.loadNodeAsync(`/nodes/${J.index}`,J,B);if(this._loader._disableInstancedMesh--,!J._primitiveBabylonMeshes)return await y;const N=new Array;let r=0;const q=J=>{if(void 0==Q.attributes[J])return void N.push(Promise.resolve(null));const B=T.Get(`${R}/attributes/${J}`,this._loader.xh.accessors,Q.attributes[J]);if(N.push(this._loader._loadFloatAccessorAsync(`/accessors/${B.bufferView}`,B)),0===r)r=B.count;else if(r!==B.count)throw new Error(`${R}/attributes: Instance buffer accessors do not have the same count.`)};return q("TRANSLATION"),q("ROTATION"),q("SCALE"),await y.then((async R=>{const[B,Q,y]=await Promise.all(N),q=new Float32Array(16*r);h.TmpVectors.nJ[0].Ar(0,0,0),h.TmpVectors.Quaternion[0].Ar(0,0,0,1),h.TmpVectors.nJ[1].Ar(1,1,1);for(let J=0;J<r;++J)B&&h.nJ.FromArrayToRef(B,3*J,h.TmpVectors.nJ[0]),Q&&h.Quaternion.FromArrayToRef(Q,4*J,h.TmpVectors.Quaternion[0]),y&&h.nJ.FromArrayToRef(y,3*J,h.TmpVectors.nJ[1]),h.Matrix.ComposeToRef(h.TmpVectors.nJ[1],h.TmpVectors.Quaternion[0],h.TmpVectors.nJ[0],h.TmpVectors.Matrix[0]),h.TmpVectors.Matrix[0].copyToArray(q,16*J);for(const h of J._primitiveBabylonMeshes)h.Wl("matrix",q,16,!0);return R}))}))}}G(U),Y(U,!0,(R=>new RR(R)));let JR=0,BR=null;class QR{static get Default(){return QR._Default||(QR._Default=new QR),QR._Default}constructor(){const R=QR.Configuration.decoder;this._decoderModulePromise=N.Tools.LoadBabylonScriptAsync(R.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(R,J,B,Q,h){await this._decoderModulePromise,0===JR&&(MeshoptDecoder.useWorkers(1),JR=1);const y=await MeshoptDecoder.decodeGltfBufferAsync(J,B,R,Q,h);return null!==BR&&clearTimeout(BR),BR=setTimeout((()=>{MeshoptDecoder.useWorkers(0),JR=0,BR=null}),1e3),y}}QR.Configuration={decoder:{url:`${N.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},QR._Default=null;const hR="EXT_meshopt_compression";class yR{constructor(R){this.name=hR,this.enabled=R.isExtensionUsed(hR),this._loader=R}dispose(){this._loader=null}loadBufferViewAsync(R,J){return C.LoadExtensionAsync(R,J,this.name,(async(B,Q)=>{const h=J;if(h._meshOptData)return await h._meshOptData;const y=T.Get(`${R}/buffer`,this._loader.xh.buffers,Q.buffer);return h._meshOptData=this._loader.loadBufferAsync(`/buffers/${y.index}`,y,Q.byteOffset||0,Q.byteLength).then((async R=>await QR.Default.decodeGltfBufferAsync(R,Q.count,Q.byteStride,Q.mode,Q.filter))),await h._meshOptData}))}}G(hR),Y(hR,!0,(R=>new yR(R)));const NR="EXT_texture_webp";class rR{constructor(R){this.name=NR,this._loader=R,this.enabled=R.isExtensionUsed(NR)}dispose(){this._loader=null}_loadTextureAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=void 0==J.sampler?C.DefaultSampler:T.Get(`${R}/sampler`,this._loader.xh.samplers,J.sampler),N=T.Get(`${Q}/source`,this._loader.xh.images,h.source);return await this._loader._createTextureAsync(R,y,N,(R=>{B(R)}),void 0,!J._textureInfo.nonColorData)}))}}G(NR),Y(NR,!0,(R=>new rR(R)));const qR="EXT_texture_avif";class eR{constructor(R){this.name=qR,this._loader=R,this.enabled=R.isExtensionUsed(qR)}dispose(){this._loader=null}_loadTextureAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=void 0==J.sampler?C.DefaultSampler:T.Get(`${R}/sampler`,this._loader.xh.samplers,J.sampler),N=T.Get(`${Q}/source`,this._loader.xh.images,h.source);return await this._loader._createTextureAsync(R,y,N,(R=>{B(R)}),void 0,!J._textureInfo.nonColorData)}))}}G(qR),Y(qR,!0,(R=>new eR(R)));var DR=B(12839),lR=B(11733);const ER="EXT_lights_ies";class OR{constructor(R){this.name=ER,this._loader=R,this.enabled=this._loader.isExtensionUsed(ER)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.xh.extensions;if(R&&R[this.name]){const J=R[this.name];this._lights=J.lights,T.Assign(this._lights)}}loadNodeAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,N)=>{let r,q;this._loader._allMaterialsDirtyRequired=!0;const e=await this._loader.loadNodeAsync(R,J,(R=>{q=T.Get(Q,this._lights,N.hh);const J=q.name||R.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,r=new DR.d(J,h.nJ.Zero(),h.nJ.Backward(),0,1,this._loader.babylonScene),r.angle=Math.PI/2,r.innerAngle=0,r._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,q._babylonLight=r,r.falloffType=lR.e.FALLOFF_GLTF,r.Mr=N.color?y.SJ.fJ(N.color):y.SJ.White(),r.Vr=N.multiplier||1,r.range=Number.MAX_VALUE,r.parent=R,this._loader._babylonLights.push(r),C.AddPointerMetadata(r,Q),B(R)}));let D;if(q.uri)D=await this._loader.loadUriAsync(R,q,q.uri);else{const J=T.Get(`${R}/bufferView`,this._loader.xh.bufferViews,q.bufferView);D=await this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J)}return r.iesProfileTexture=new a.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,D,!0,void 0,void 0,void 0,void 0,".ies"),e}))}}G(ER),Y(ER,!0,(R=>new OR(R)));var nR=B(12867);const PR="KHR_draco_mesh_compression";class AR{constructor(R){this.name=PR,this.useNormalizedFlagFromAccessor=!0,this._loader=R,this.enabled=nR.c.DefaultAvailable&&this._loader.isExtensionUsed(PR)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{if(void 0!=J.mode&&4!==J.mode&&5!==J.mode)throw new Error(`${R}: Unsupported mode ${J.mode}`);const y={},N={},r=(R,Q)=>{const r=h.attributes[R];if(void 0!=r&&(B._delayInfo=B._delayInfo||[],-1===B._delayInfo.indexOf(Q)&&B._delayInfo.push(Q),y[Q]=r,this.useNormalizedFlagFromAccessor)){const B=T.TryGet(this._loader.xh.accessors,J.attributes[R]);B&&(N[Q]=B.normalized||!1)}};r("POSITION",x.h.PositionKind),r("NORMAL",x.h.NormalKind),r("TANGENT",x.h.TangentKind),r("TEXCOORD_0",x.h.UVKind),r("TEXCOORD_1",x.h.UV2Kind),r("TEXCOORD_2",x.h.UV3Kind),r("TEXCOORD_3",x.h.UV4Kind),r("TEXCOORD_4",x.h.UV5Kind),r("TEXCOORD_5",x.h.UV6Kind),r("JOINTS_0",x.h.MatricesIndicesKind),r("WEIGHTS_0",x.h.MatricesWeightsKind),r("COLOR_0",x.h.ColorKind);const q=T.Get(Q,this._loader.xh.bufferViews,h.bufferView);return q._dracoBabylonGeometry||(q._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((async Q=>{const h=this.dracoDecoder||nR.c.Default,r=T.TryGet(this._loader.xh.accessors,J.attributes.POSITION),q=this._loader.parent.alwaysComputeBoundingBox||B.skeleton||!r?null:F(r);return await h._decodeMeshToGeometryForGltfAsync(B.name,this._loader.babylonScene,Q,y,N,q).catch((J=>{throw new Error(`${R}: ${J.message}`)}))}))),await q._dracoBabylonGeometry}))}}G(PR),Y(PR,!0,(R=>new AR(R)));var uR=B(12875),SR=B(11167),fR=B(11176),aR=B(11599),sR=B(11790),xR=B(11142);aR.b.AddNodeConstructor("Light_Type_0",((R,J)=>()=>new IR(R,h.nJ.Zero(),J)));class IR extends sR.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(R){this._shadowAngle=R,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(R){const J=this.needCube();if(this._direction=R,this.needCube()!==J&&this._shadowGenerators){const R=this._shadowGenerators.values();for(let J=R.next();!0!==J.done;J=R.next()){J.value.recreateShadowMap()}}}constructor(R,J,B){super(R,B),this._shadowAngle=Math.PI/2,this.position=J}getClassName(){return"PointLight"}getTypeID(){return lR.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(R){if(this.direction)return super.getShadowDirection(R);switch(R){case 0:return new h.nJ(1,0,0);case 1:return new h.nJ(-1,0,0);case 2:return new h.nJ(0,-1,0);case 3:return new h.nJ(0,1,0);case 4:return new h.nJ(0,0,1);case 5:return new h.nJ(0,0,-1)}return h.nJ.Zero()}_setDefaultShadowProjectionMatrix(R,J,B){const Q=this.IR().activeCamera;if(!Q)return;const y=void 0!==this.shadowMinZ?this.shadowMinZ:Q.mh,N=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,r=this.IR().getEngine().useReverseDepthBuffer;h.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,r?N:y,r?y:N,R,!0,this._scene.getEngine().isNDCHalfZRange,void 0,r)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(R,J){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,J):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,J),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,J),this}transferToNodeMaterialEffect(R,J){return this.computeTransformedInformation()?R.setFloat3(J,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):R.setFloat3(J,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(R,J){R["POINTLIGHT"+J]=!0}}(0,SR.e)([(0,fR.N)()],IR.prototype,"shadowAngle",null),(0,xR.h)("BABYLON.PointLight",IR);const VR="KHR_lights_punctual";class MR{constructor(R){this.name=VR,this._loader=R,this.enabled=this._loader.isExtensionUsed(VR)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.xh.extensions;if(R&&R[this.name]){const J=R[this.name];this._lights=J.lights,T.Assign(this._lights)}}loadNodeAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,N)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(R,J,(R=>{let J;const r=T.Get(Q,this._lights,N.hh),q=r.name||R.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,r.type){case"directional":{const R=new uR.c(q,h.nJ.Backward(),this._loader.babylonScene);R.position.Sr(0),J=R;break}case"point":J=new IR(q,h.nJ.Zero(),this._loader.babylonScene);break;case"spot":{const R=new DR.d(q,h.nJ.Zero(),h.nJ.Backward(),0,1,this._loader.babylonScene);R.angle=2*(r.spot&&r.spot.outerConeAngle||Math.PI/4),R.innerAngle=2*(r.spot&&r.spot.innerConeAngle||0),J=R;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${Q}: Invalid light type (${r.type})`)}J._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,r._babylonLight=J,J.falloffType=lR.e.FALLOFF_GLTF,J.Mr=r.color?y.SJ.fJ(r.color):y.SJ.White(),J.Vr=void 0==r.Vr?1:r.Vr,J.range=void 0==r.range?Number.MAX_VALUE:r.range,J.parent=R,this._loader._babylonLights.push(J),C.AddPointerMetadata(J,Q),B(R)})))))}}G(VR),Y(VR,!0,(R=>new MR(R)));const HR="KHR_materials_pbrSpecularGlossiness";class dR{constructor(R){this.name=HR,this.order=200,this._loader=R,this.enabled=this._loader.isExtensionUsed(HR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialBasePropertiesAsync(R,J,B)),y.push(this._loadSpecularGlossinessPropertiesAsync(Q,h,B)),this._loader.loadMaterialAlphaProperties(R,J,B),await Promise.all(y).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;return B.metallic=null,B.roughness=null,J.diffuseFactor?(B.albedoColor=y.SJ.fJ(J.diffuseFactor),B.alpha=J.diffuseFactor[3]):B.albedoColor=y.SJ.White(),B.reflectivityColor=J.specularFactor?y.SJ.fJ(J.specularFactor):y.SJ.White(),B.microSurface=void 0==J.glossinessFactor?1:J.glossinessFactor,J.diffuseTexture&&Q.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTexture`,J.diffuseTexture,(R=>{R.name=`${B.name} (Diffuse)`,B.albedoTexture=R}))),J.specularGlossinessTexture&&(Q.push(this._loader.loadTextureInfoAsync(`${R}/specularGlossinessTexture`,J.specularGlossinessTexture,(R=>{R.name=`${B.name} (Specular Glossiness)`,B.reflectivityTexture=R,B.reflectivityTexture.bh=!0}))),B.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(Q).then((()=>{}))}}G(HR),Y(HR,!0,(R=>new dR(R)));const XR="KHR_materials_unlit";class cR{constructor(R){this.name=XR,this.order=210,this._loader=R,this.enabled=this._loader.isExtensionUsed(XR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async()=>await this._loadUnlitPropertiesAsync(R,J,B)))}_loadUnlitPropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;B.unlit=!0;const h=J.pbrMetallicRoughness;return h&&(h.baseColorFactor?(B.albedoColor=y.SJ.fJ(h.baseColorFactor),B.alpha=h.baseColorFactor[3]):B.albedoColor=y.SJ.White(),h.baseColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${R}/baseColorTexture`,h.baseColorTexture,(R=>{R.name=`${B.name} (Base Color)`,B.albedoTexture=R})))),J.doubleSided&&(B.Pr=!1,B.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(R,J,B),Promise.all(Q).then((()=>{}))}}G(XR),Y(XR,!0,(R=>new cR(R)));const zR="KHR_materials_clearcoat";class pR{constructor(R){this.name=zR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(zR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadClearCoatPropertiesAsync(Q,h,B)),await Promise.all(y)}))}_loadClearCoatPropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;return B.clearCoat.isEnabled=!0,B.clearCoat.useRoughnessFromMainTexture=!1,B.clearCoat.remapF0OnInterfaceChange=!1,void 0!=J.clearcoatFactor?B.clearCoat.Vr=J.clearcoatFactor:B.clearCoat.Vr=0,J.clearcoatTexture&&Q.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatTexture`,J.clearcoatTexture,(R=>{R.name=`${B.name} (ClearCoat)`,B.clearCoat.texture=R}))),void 0!=J.clearcoatRoughnessFactor?B.clearCoat.roughness=J.clearcoatRoughnessFactor:B.clearCoat.roughness=0,J.clearcoatRoughnessTexture&&(J.clearcoatRoughnessTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatRoughnessTexture`,J.clearcoatRoughnessTexture,(R=>{R.name=`${B.name} (ClearCoat Roughness)`,B.clearCoat.textureRoughness=R})))),J.clearcoatNormalTexture&&(J.clearcoatNormalTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatNormalTexture`,J.clearcoatNormalTexture,(R=>{R.name=`${B.name} (ClearCoat Normal)`,B.clearCoat.bumpTexture=R}))),B.invertNormalMapX=!B.IR().useRightHandedSystem,B.invertNormalMapY=B.IR().useRightHandedSystem,void 0!=J.clearcoatNormalTexture.scale&&(B.clearCoat.bumpTexture.level=J.clearcoatNormalTexture.scale)),Promise.all(Q).then((()=>{}))}}G(zR),Y(zR,!0,(R=>new pR(R)));const iR="KHR_materials_iridescence";class WR{constructor(R){this.name=iR,this.order=195,this._loader=R,this.enabled=this._loader.isExtensionUsed(iR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadIridescencePropertiesAsync(Q,h,B)),await Promise.all(y).then((()=>{}))}))}_loadIridescencePropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;return B.iridescence.isEnabled=!0,B.iridescence.Vr=J.iridescenceFactor??0,B.iridescence.indexOfRefraction=J.iridescenceIor??J.iridescenceIOR??1.3,B.iridescence.minimumThickness=J.iridescenceThicknessMinimum??100,B.iridescence.maximumThickness=J.iridescenceThicknessMaximum??400,J.iridescenceTexture&&Q.push(this._loader.loadTextureInfoAsync(`${R}/iridescenceTexture`,J.iridescenceTexture,(R=>{R.name=`${B.name} (Iridescence)`,B.iridescence.texture=R}))),J.iridescenceThicknessTexture&&Q.push(this._loader.loadTextureInfoAsync(`${R}/iridescenceThicknessTexture`,J.iridescenceThicknessTexture,(R=>{R.name=`${B.name} (Iridescence Thickness)`,B.iridescence.thicknessTexture=R}))),Promise.all(Q).then((()=>{}))}}G(iR),Y(iR,!0,(R=>new WR(R)));const kR="KHR_materials_anisotropy";class YR{constructor(R){this.name=kR,this.order=195,this._loader=R,this.enabled=this._loader.isExtensionUsed(kR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadIridescencePropertiesAsync(Q,h,B)),await Promise.all(y)}))}async _loadIridescencePropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;B.anisotropy.isEnabled=!0,B.anisotropy.Vr=J.anisotropyStrength??0,B.anisotropy.angle=J.anisotropyRotation??0,J.anisotropyTexture&&(J.anisotropyTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${R}/anisotropyTexture`,J.anisotropyTexture,(R=>{R.name=`${B.name} (Anisotropy Intensity)`,B.anisotropy.texture=R})))),await Promise.all(Q)}}G(kR),Y(kR,!0,(R=>new YR(R)));const GR="KHR_materials_emissive_strength";class gR{constructor(R){this.name=GR,this.order=170,this._loader=R,this.enabled=this._loader.isExtensionUsed(GR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>await this._loader.loadMaterialPropertiesAsync(R,J,B).then((()=>{this._loadEmissiveProperties(Q,h,B)}))))}_loadEmissiveProperties(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);void 0!==J.emissiveStrength&&(B.emissiveIntensity=J.emissiveStrength)}}G(GR),Y(GR,!0,(R=>new gR(R)));const LR="KHR_materials_sheen";class jR{constructor(R){this.name=LR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(LR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadSheenPropertiesAsync(Q,h,B)),await Promise.all(y).then((()=>{}))}))}_loadSheenPropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;return B.sheen.isEnabled=!0,B.sheen.Vr=1,void 0!=J.sheenColorFactor?B.sheen.color=y.SJ.fJ(J.sheenColorFactor):B.sheen.color=y.SJ.Black(),J.sheenColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${R}/sheenColorTexture`,J.sheenColorTexture,(R=>{R.name=`${B.name} (Sheen Color)`,B.sheen.texture=R}))),void 0!==J.sheenRoughnessFactor?B.sheen.roughness=J.sheenRoughnessFactor:B.sheen.roughness=0,J.sheenRoughnessTexture&&(J.sheenRoughnessTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${R}/sheenRoughnessTexture`,J.sheenRoughnessTexture,(R=>{R.name=`${B.name} (Sheen Roughness)`,B.sheen.textureRoughness=R})))),B.sheen.albedoScaling=!0,B.sheen.useRoughnessFromMainTexture=!1,Promise.all(Q).then((()=>{}))}}G(LR),Y(LR,!0,(R=>new jR(R)));var TR=B(11662);const FR="KHR_materials_specular";class CR{constructor(R){this.name=FR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(FR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;if(y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadSpecularPropertiesAsync(Q,h,B)),h.extensions&&h.extensions.EXT_materials_specular_edge_color&&B instanceof f.b){h.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(B.brdf.dielectricSpecularModel=TR.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,B.brdf.conductorSpecularModel=TR.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(y).then((()=>{}))}))}_loadSpecularPropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;return void 0!==J.specularFactor&&(B.metallicF0Factor=J.specularFactor),void 0!==J.specularColorFactor&&(B.metallicReflectanceColor=y.SJ.fJ(J.specularColorFactor)),J.specularTexture&&(J.specularTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${R}/specularTexture`,J.specularTexture,(R=>{R.name=`${B.name} (Specular)`,B.metallicReflectanceTexture=R,B.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),J.specularColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${R}/specularColorTexture`,J.specularColorTexture,(R=>{R.name=`${B.name} (Specular Color)`,B.reflectanceTexture=R}))),Promise.all(Q).then((()=>{}))}}G(FR),Y(FR,!0,(R=>new CR(R)));const bR="KHR_materials_ior";class wR{constructor(R){this.name=bR,this.order=180,this._loader=R,this.enabled=this._loader.isExtensionUsed(bR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadIorPropertiesAsync(Q,h,B)),await Promise.all(y).then((()=>{}))}))}_loadIorPropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);return void 0!==J.ior?B.indexOfRefraction=J.ior:B.indexOfRefraction=wR._DEFAULT_IOR,Promise.resolve()}}wR._DEFAULT_IOR=1.5,G(bR),Y(bR,!0,(R=>new wR(R)));const KR="KHR_materials_variants";class vR{constructor(R){this.name=KR,this._loader=R,this.enabled=this._loader.isExtensionUsed(KR)}dispose(){this._loader=null}static GetAvailableVariants(R){const J=this._GetExtensionMetadata(R);return J?Object.keys(J.variants):[]}getAvailableVariants(R){return vR.GetAvailableVariants(R)}static SelectVariant(R,J){const B=this._GetExtensionMetadata(R);if(!B)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${KR} extension`);const Q=R=>{const J=B.variants[R];if(J)for(const B of J)B.mesh.material=B.material};if(J instanceof Array)for(const h of J)Q(h);else Q(J);B.lastSelected=J}selectVariant(R,J){vR.SelectVariant(R,J)}static Reset(R){const J=this._GetExtensionMetadata(R);if(!J)throw new Error(`Cannot reset on a glTF mesh that does not have the ${KR} extension`);for(const B of J.original)B.mesh.material=B.material;J.lastSelected=null}reset(R){vR.Reset(R)}static GetLastSelectedVariant(R){const J=this._GetExtensionMetadata(R);if(!J)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${KR} extension`);return J.lastSelected}getLastSelectedVariant(R){return vR.GetLastSelectedVariant(R)}static _GetExtensionMetadata(R){var J,B;return(null===R||void 0===R||null===(J=R._internalMetadata)||void 0===J||null===(B=J.xh)||void 0===B?void 0:B[KR])||null}onLoading(){const R=this._loader.xh.extensions;if(R&&R[this.name]){const J=R[this.name];this._variants=J.variants}}onReady(){const R=this._loader.rootBabylonMesh;if(R){var J;const B=this._loader.parent.extensionOptions[KR];null!==B&&void 0!==B&&B.defaultVariant&&vR.SelectVariant(R,B.defaultVariant),null===B||void 0===B||null===(J=B.onLoaded)||void 0===J||J.call(B,{get variants(){return vR.GetAvailableVariants(R)},get selectedVariant(){const J=vR.GetLastSelectedVariant(R);return J?Array.isArray(J)?J[0]:J:vR.GetAvailableVariants(R)[0]},set selectedVariant(J){vR.SelectVariant(R,J)}})}}_loadMeshPrimitiveAsync(R,J,B,Q,h,y){return C.LoadExtensionAsync(R,h,this.name,(async(N,r)=>{const q=new Array;return q.push(this._loader._loadMeshPrimitiveAsync(R,J,B,Q,h,(J=>{if(y(J),J instanceof M.e){const B=C._GetDrawMode(R,h.mode),Q=this._loader.rootBabylonMesh,y=Q?Q._internalMetadata=Q._internalMetadata||{}:{},e=y.xh=y.xh||{},D=e[KR]=e[KR]||{lastSelected:null,original:[],variants:{}};D.original.push({mesh:J,material:J.material});for(let R=0;R<r.mappings.length;++R){const h=r.mappings[R],y=T.Get(`${N}/mappings/${R}/material`,this._loader.xh.materials,h.material);q.push(this._loader._loadMaterialAsync(`#/materials/${h.material}`,y,J,B,(R=>{for(let B=0;B<h.variants.length;++B){const y=h.variants[B],N=T.Get(`/extensions/${KR}/variants/${y}`,this._variants,y);D.variants[N.name]=D.variants[N.name]||[],D.variants[N.name].push({mesh:J,material:R}),J.onClonedObservable.add((R=>{const B=R;let h=null,y=B;do{if(y=y.parent,!y)return;h=vR._GetExtensionMetadata(y)}while(null===h);if(Q&&h===vR._GetExtensionMetadata(Q)){y._internalMetadata={};for(const R in Q._internalMetadata)y._internalMetadata[R]=Q._internalMetadata[R];y._internalMetadata.xh=[];for(const R in Q._internalMetadata.xh)y._internalMetadata.xh[R]=Q._internalMetadata.xh[R];y._internalMetadata.xh[KR]={lastSelected:null,original:[],variants:{}};for(const R of h.original)y._internalMetadata.xh[KR].original.push({mesh:R.mesh,material:R.material});for(const R in h.variants)if(Object.prototype.hasOwnProperty.call(h.variants,R)){y._internalMetadata.xh[KR].variants[R]=[];for(const J of h.variants[R])y._internalMetadata.xh[KR].variants[R].push({mesh:J.mesh,material:J.material})}h=y._internalMetadata.xh[KR]}for(const Q of h.original)Q.mesh===J&&(Q.mesh=B);for(const Q of h.variants[N.name])Q.mesh===J&&(Q.mesh=B)}))}})))}}}))),await Promise.all(q).then((R=>{let[J]=R;return J}))}))}}G(KR),Y(KR,!0,(R=>new vR(R)));var mR=B(11247);class oR{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:TR.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(R,J){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...oR._GetDefaultOptions(),...R},this._scene=J,this._scene._transmissionHelper=this,this.onErrorObservable=new D.e,this._scene.eh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(R){if(!Object.keys(R).filter((J=>this._options[J]!==R[J])).length)return;const J={...this._options,...R},B=this._options;this._options=J,J.renderSize===B.renderSize&&J.renderTargetTextureType===B.renderTargetTextureType&&J.generateMipmaps===B.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=J.samples,this._opaqueRenderTarget.lodGenerationScale=J.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=J.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(R){return!!R&&!!(R instanceof f.b&&R.subSurface.isRefractionEnabled)}_addMesh(R){this._materialObservers[R.uniqueId]=R.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),N.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(R.material)?(R.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(R)&&this._transparentMeshesCache.push(R)):-1===this._opaqueMeshesCache.indexOf(R)&&this._opaqueMeshesCache.push(R)}))}_removeMesh(R){R.onMaterialChangedObservable.remove(this._materialObservers[R.uniqueId]),delete this._materialObservers[R.uniqueId];let J=this._transparentMeshesCache.indexOf(R);-1!==J&&this._transparentMeshesCache.splice(J,1),J=this._opaqueMeshesCache.indexOf(R),-1!==J&&this._opaqueMeshesCache.splice(J,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(R){const J=this._transparentMeshesCache.indexOf(R),B=this._opaqueMeshesCache.indexOf(R);this._shouldRenderAsTransmission(R.material)?(R.material instanceof f.b&&(R.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==B?(this._opaqueMeshesCache.splice(B,1),this._transparentMeshesCache.push(R)):-1===J&&this._transparentMeshesCache.push(R)):-1!==J?(this._transparentMeshesCache.splice(J,1),this._opaqueMeshesCache.push(R)):-1===B&&this._opaqueMeshesCache.push(R)}_isRenderTargetValid(){var R;return null!==(null===(R=this._opaqueRenderTarget)||void 0===R?void 0:R.getInternalTexture())}_setupRenderTargets(){var R;let J;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new mR.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(R=this._options.clearColor)||void 0===R?void 0:R.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((R=>{J=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?R.clearColor.h(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(R.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=J}));for(const B of this._transparentMeshesCache)this._shouldRenderAsTransmission(B.material)&&(B.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const tR="KHR_materials_transmission";class ZR{constructor(R){this.name=tR,this.order=175,this._loader=R,this.enabled=this._loader.isExtensionUsed(tR),this.enabled&&(R.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadTransparentPropertiesAsync(Q,J,B,h)),await Promise.all(y).then((()=>{}))}))}_loadTransparentPropertiesAsync(R,J,B,Q){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const h=B;if(h.subSurface.isRefractionEnabled=!0,h.subSurface.volumeIndexOfRefraction=1,h.subSurface.useAlbedoToTintRefraction=!0,void 0===Q.transmissionFactor)return h.subSurface.refractionIntensity=0,h.subSurface.isRefractionEnabled=!1,Promise.resolve();{var y;h.subSurface.refractionIntensity=Q.transmissionFactor;const R=h.IR();if(h.subSurface.refractionIntensity&&!R._transmissionHelper)new oR({},h.IR());else if(h.subSurface.refractionIntensity&&(null===(y=R._transmissionHelper)||void 0===y||!y._isRenderTargetValid())){var N;null===(N=R._transmissionHelper)||void 0===N||N._setupRenderTargets()}}return h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=0,Q.transmissionTexture?(Q.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${R}/transmissionTexture`,Q.transmissionTexture,void 0).then((R=>{R.name=`${B.name} (Transmission)`,h.subSurface.refractionIntensityTexture=R,h.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}G(tR),Y(tR,!0,(R=>new ZR(R)));const UR="KHR_materials_diffuse_transmission";class RJ{constructor(R){this.name=UR,this.order=174,this._loader=R,this.enabled=this._loader.isExtensionUsed(UR),this.enabled&&(R.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadTranslucentPropertiesAsync(Q,J,B,h)),await Promise.all(y).then((()=>{}))}))}_loadTranslucentPropertiesAsync(R,J,B,Q){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const h=B;if(h.subSurface.isTranslucencyEnabled=!0,h.subSurface.volumeIndexOfRefraction=1,h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=0,h.subSurface.useAlbedoToTintTranslucency=!1,void 0===Q.diffuseTransmissionFactor)return h.subSurface.translucencyIntensity=0,h.subSurface.isTranslucencyEnabled=!1,Promise.resolve();h.subSurface.translucencyIntensity=Q.diffuseTransmissionFactor;const N=new Array;return h.subSurface.useGltfStyleTextures=!0,Q.diffuseTransmissionTexture&&(Q.diffuseTransmissionTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTransmissionTexture`,Q.diffuseTransmissionTexture).then((R=>{R.name=`${B.name} (Diffuse Transmission)`,h.subSurface.translucencyIntensityTexture=R})))),void 0!==Q.diffuseTransmissionColorFactor?h.subSurface.translucencyColor=y.SJ.fJ(Q.diffuseTransmissionColorFactor):h.subSurface.translucencyColor=y.SJ.White(),Q.diffuseTransmissionColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTransmissionColorTexture`,Q.diffuseTransmissionColorTexture).then((R=>{R.name=`${B.name} (Diffuse Transmission Color)`,h.subSurface.translucencyColorTexture=R}))),Promise.all(N).then((()=>{}))}}G(UR),Y(UR,!0,(R=>new RJ(R)));const JJ="KHR_materials_volume";class BJ{constructor(R){this.name=JJ,this.order=173,this._loader=R,this.enabled=this._loader.isExtensionUsed(JJ),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadVolumePropertiesAsync(Q,J,B,h)),await Promise.all(y).then((()=>{}))}))}_loadVolumePropertiesAsync(R,J,B,Q){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);if(!B.subSurface.isRefractionEnabled&&!B.subSurface.isTranslucencyEnabled||!Q.thicknessFactor)return Promise.resolve();B.subSurface.volumeIndexOfRefraction=B.indexOfRefraction;const h=void 0!==Q.attenuationDistance?Q.attenuationDistance:Number.MAX_VALUE;return B.subSurface.tintColorAtDistance=h,void 0!==Q.attenuationColor&&3==Q.attenuationColor.length&&B.subSurface.tintColor.Ar(Q.attenuationColor[0],Q.attenuationColor[1],Q.attenuationColor[2]),B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=Q.thicknessFactor,B.subSurface.useThicknessAsDepth=!0,Q.thicknessTexture?(Q.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${R}/thicknessTexture`,Q.thicknessTexture).then((R=>{R.name=`${B.name} (Thickness)`,B.subSurface.thicknessTexture=R,B.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}G(JJ),Y(JJ,!0,(R=>new BJ(R)));const QJ="KHR_materials_dispersion";class hJ{constructor(R){this.name=QJ,this.order=174,this._loader=R,this.enabled=this._loader.isExtensionUsed(QJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadDispersionPropertiesAsync(Q,J,B,h)),await Promise.all(y).then((()=>{}))}))}_loadDispersionPropertiesAsync(R,J,B,Q){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);return B.subSurface.isRefractionEnabled&&Q.dispersion?(B.subSurface.isDispersionEnabled=!0,B.subSurface.dispersion=Q.dispersion,Promise.resolve()):Promise.resolve()}}G(QJ),Y(QJ,!0,(R=>new hJ(R)));const yJ="EXT_materials_diffuse_roughness";class NJ{constructor(R){this.name=yJ,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(yJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(R,J,B)),y.push(this._loadDiffuseRoughnessPropertiesAsync(Q,h,B)),await Promise.all(y).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(R,J,B){if(!(B instanceof f.b))throw new Error(`${R}: Material type not supported`);const Q=new Array;return B.brdf.baseDiffuseModel=TR.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=J.diffuseRoughnessFactor?B.baseDiffuseRoughness=J.diffuseRoughnessFactor:B.baseDiffuseRoughness=0,J.diffuseRoughnessTexture&&Q.push(this._loader.loadTextureInfoAsync(`${R}/diffuseRoughnessTexture`,J.diffuseRoughnessTexture,(R=>{R.name=`${B.name} (Diffuse Roughness)`,B.baseDiffuseRoughnessTexture=R}))),Promise.all(Q).then((()=>{}))}}G(yJ),Y(yJ,!0,(R=>new NJ(R)));const rJ="KHR_mesh_quantization";class qJ{constructor(R){this.name=rJ,this.enabled=R.isExtensionUsed(rJ)}dispose(){}}G(rJ),Y(rJ,!0,(R=>new qJ(R)));const eJ="KHR_texture_basisu";class DJ{constructor(R){this.name=eJ,this._loader=R,this.enabled=R.isExtensionUsed(eJ)}dispose(){this._loader=null}_loadTextureAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>{const y=void 0==J.sampler?C.DefaultSampler:T.Get(`${R}/sampler`,this._loader.xh.samplers,J.sampler),N=T.Get(`${Q}/source`,this._loader.xh.images,h.source);return await this._loader._createTextureAsync(R,y,N,(R=>{B(R)}),J._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!J._textureInfo.nonColorData)}))}}G(eJ),Y(eJ,!0,(R=>new DJ(R)));const lJ="KHR_texture_transform";class EJ{constructor(R){this.name=lJ,this._loader=R,this.enabled=this._loader.isExtensionUsed(lJ)}dispose(){this._loader=null}loadTextureInfoAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(Q,h)=>await this._loader.loadTextureInfoAsync(R,J,(R=>{if(!(R instanceof a.d))throw new Error(`${Q}: Texture type not supported`);h.offset&&(R.uOffset=h.offset[0],R.vOffset=h.offset[1]),R.uRotationCenter=0,R.vRotationCenter=0,h.rotation&&(R.wAng=-h.rotation),h.scale&&(R.uScale=h.scale[0],R.vScale=h.scale[1]),void 0!=h.texCoord&&(R.coordinatesIndex=h.texCoord),B(R)}))))}}G(lJ),Y(lJ,!0,(R=>new EJ(R)));const OJ="KHR_xmp_json_ld";class nJ{constructor(R){this.name=OJ,this.order=100,this._loader=R,this.enabled=this._loader.isExtensionUsed(OJ)}dispose(){this._loader=null}onLoading(){var R,J,B;if(null===this._loader.rootBabylonMesh)return;const Q=null===(R=this._loader.xh.extensions)||void 0===R?void 0:R.KHR_xmp_json_ld,h=null===(J=this._loader.xh.asset)||void 0===J||null===(B=J.extensions)||void 0===B?void 0:B.KHR_xmp_json_ld;if(Q&&h){const R=+h.packet;Q.packets&&R<Q.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=Q.packets[R])}}}function PJ(R,J,B,Q){return y.SJ.fJ(J,B).scale(Q)}function AJ(R,J,B,Q){return J[B]*Q}function uJ(R,J,B,Q){return-J[B]*Q}function SJ(R,J,B,Q){return J[B+1]*Q}function fJ(R,J,B,Q){return J[B]*Q*2}function aJ(R){return{scale:[new xJ(E.c.ANIMATIONTYPE_FLOAT,`${R}.uScale`,AJ,(()=>2)),new xJ(E.c.ANIMATIONTYPE_FLOAT,`${R}.vScale`,SJ,(()=>2))],offset:[new xJ(E.c.ANIMATIONTYPE_FLOAT,`${R}.uOffset`,AJ,(()=>2)),new xJ(E.c.ANIMATIONTYPE_FLOAT,`${R}.vOffset`,SJ,(()=>2))],rotation:[new xJ(E.c.ANIMATIONTYPE_FLOAT,`${R}.wAng`,uJ,(()=>1))]}}G(OJ),Y(OJ,!0,(R=>new nJ(R)));class sJ extends b.AnimationPropertyInfo{buildAnimations(R,J,B,Q){return[{babylonAnimatable:R._babylonCamera,babylonAnimation:this._buildAnimation(J,B,Q)}]}}class xJ extends b.AnimationPropertyInfo{buildAnimations(R,J,B,Q){const h=[];for(const y in R._data)h.push({babylonAnimatable:R._data[y].babylonMaterial,babylonAnimation:this._buildAnimation(J,B,Q)});return h}}class IJ extends b.AnimationPropertyInfo{buildAnimations(R,J,B,Q){return[{babylonAnimatable:R._babylonLight,babylonAnimation:this._buildAnimation(J,B,Q)}]}}(0,g.j)("/cameras/{}/orthographic/xmag",[new sJ(E.c.ANIMATIONTYPE_FLOAT,"orthoLeft",uJ,(()=>1)),new sJ(E.c.ANIMATIONTYPE_FLOAT,"orthoRight",SJ,(()=>1))]),(0,g.j)("/cameras/{}/orthographic/ymag",[new sJ(E.c.ANIMATIONTYPE_FLOAT,"orthoBottom",uJ,(()=>1)),new sJ(E.c.ANIMATIONTYPE_FLOAT,"orthoTop",SJ,(()=>1))]),(0,g.j)("/cameras/{}/orthographic/zfar",[new sJ(E.c.ANIMATIONTYPE_FLOAT,"maxZ",AJ,(()=>1))]),(0,g.j)("/cameras/{}/orthographic/znear",[new sJ(E.c.ANIMATIONTYPE_FLOAT,"mh",AJ,(()=>1))]),(0,g.j)("/cameras/{}/perspective/yfov",[new sJ(E.c.ANIMATIONTYPE_FLOAT,"fov",AJ,(()=>1))]),(0,g.j)("/cameras/{}/perspective/zfar",[new sJ(E.c.ANIMATIONTYPE_FLOAT,"maxZ",AJ,(()=>1))]),(0,g.j)("/cameras/{}/perspective/znear",[new sJ(E.c.ANIMATIONTYPE_FLOAT,"mh",AJ,(()=>1))]),(0,g.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new xJ(E.c.ANIMATIONTYPE_COLOR3,"albedoColor",PJ,(()=>4)),new xJ(E.c.ANIMATIONTYPE_FLOAT,"alpha",(function(R,J,B,Q){return J[B+3]*Q}),(()=>4))]),(0,g.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"metallic",AJ,(()=>1))]),(0,g.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"roughness",AJ,(()=>1))]);const VJ=aJ("albedoTexture");(0,g.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",VJ.scale),(0,g.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",VJ.offset),(0,g.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",VJ.rotation);const MJ=aJ("metallicTexture");(0,g.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",MJ.scale),(0,g.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",MJ.offset),(0,g.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",MJ.rotation),(0,g.j)("/materials/{}/emissiveFactor",[new xJ(E.c.ANIMATIONTYPE_COLOR3,"emissiveColor",PJ,(()=>3))]);const HJ=aJ("bumpTexture");(0,g.j)("/materials/{}/normalTexture/scale",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",AJ,(()=>1))]),(0,g.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",HJ.scale),(0,g.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",HJ.offset),(0,g.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",HJ.rotation),(0,g.j)("/materials/{}/occlusionTexture/strength",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",AJ,(()=>1))]);const dJ=aJ("ambientTexture");(0,g.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",dJ.scale),(0,g.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",dJ.offset),(0,g.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",dJ.rotation);const XJ=aJ("emissiveTexture");(0,g.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",XJ.scale),(0,g.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",XJ.offset),(0,g.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",XJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",AJ,(()=>1))]);const cJ=aJ("anisotropy.texture");(0,g.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",cJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",cJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",cJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",AJ,(()=>1))]);const zJ=aJ("clearCoat.texture");(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",zJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",zJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",zJ.rotation);const pJ=aJ("clearCoat.bumpTexture");(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",pJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",pJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",pJ.rotation);const iJ=aJ("clearCoat.textureRoughness");(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",iJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",iJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",iJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",AJ,(()=>1))]);const WJ=aJ("iridescence.texture");(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",WJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",WJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",WJ.rotation);const kJ=aJ("iridescence.thicknessTexture");(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",kJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",kJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",kJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new xJ(E.c.ANIMATIONTYPE_COLOR3,"sheen.color",PJ,(()=>3))]),(0,g.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",AJ,(()=>1))]);const YJ=aJ("sheen.texture");(0,g.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",YJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",YJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",YJ.rotation);const GJ=aJ("sheen.textureRoughness");(0,g.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",GJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",GJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",GJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new xJ(E.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",PJ,(()=>3))]);const gJ=aJ("metallicReflectanceTexture");(0,g.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",gJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",gJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",gJ.rotation);const LJ=aJ("reflectanceTexture");(0,g.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",LJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",LJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",LJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",AJ,(()=>1))]);const jJ=aJ("subSurface.refractionIntensityTexture");(0,g.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",jJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",jJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",jJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new xJ(E.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",PJ,(()=>3))]),(0,g.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",AJ,(()=>1))]),(0,g.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",AJ,(()=>1))]);const TJ=aJ("subSurface.thicknessTexture");(0,g.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",TJ.scale),(0,g.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",TJ.offset),(0,g.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",TJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new xJ(E.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",AJ,(()=>1))]);const FJ=aJ("subSurface.translucencyIntensityTexture");(0,g.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",FJ.scale),(0,g.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",FJ.offset),(0,g.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",FJ.rotation),(0,g.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new xJ(E.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",PJ,(()=>3))]);const CJ=aJ("subSurface.translucencyColorTexture");(0,g.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",CJ.scale),(0,g.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",CJ.offset),(0,g.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",CJ.rotation),(0,g.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new IJ(E.c.ANIMATIONTYPE_COLOR3,"diffuse",PJ,(()=>3))]),(0,g.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new IJ(E.c.ANIMATIONTYPE_FLOAT,"intensity",AJ,(()=>1))]),(0,g.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new IJ(E.c.ANIMATIONTYPE_FLOAT,"range",AJ,(()=>1))]),(0,g.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new IJ(E.c.ANIMATIONTYPE_FLOAT,"innerAngle",fJ,(()=>1))]),(0,g.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new IJ(E.c.ANIMATIONTYPE_FLOAT,"angle",fJ,(()=>1))]),(0,g.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new IJ(E.c.ANIMATIONTYPE_COLOR3,"diffuse",PJ,(()=>3))]),(0,g.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new IJ(E.c.ANIMATIONTYPE_FLOAT,"intensity",AJ,(()=>1))]);const bJ="KHR_animation_pointer";class wJ{constructor(R){this.name=bJ,this._loader=R,this._pathToObjectConverter=(0,g.g)(this._loader.xh)}get enabled(){return this._loader.isExtensionUsed(bJ)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(R,J,B,Q,h){var y;const N=null===(y=Q.target.extensions)||void 0===y?void 0:y.KHR_animation_pointer;if(!N||!this._pathToObjectConverter)return null;"pointer"!==Q.target.path&&P.d.Warn(`${R}/target/path: Value (${Q.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=Q.target.node&&P.d.Warn(`${R}/target/node: Value (${Q.target.node}) must not be present when using the ${this.name} extension`);const r=`${R}/extensions/${this.name}`,q=N.pointer;if(!q)throw new Error(`${r}: Pointer is missing`);try{const y=this._pathToObjectConverter.convert(q);if(!y.info.interpolation)throw new Error(`${r}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(R,J,B,Q,{object:y.object,info:y.info.interpolation},h)}catch(e){return P.d.Warn(`${r}/pointer: Invalid pointer (${q}) skipped`),null}}}G(bJ),Y(bJ,!0,(R=>new wJ(R)));class KJ{constructor(R,J,B){this.frame=R,this.action=J,this.onlyOnce=B,this.isDone=!1}_clone(){return new KJ(this.frame,this.action,this.onlyOnce)}}var vJ=B(11056),mJ=B(11094),oJ=B(11090);class tJ{get loop(){return this._loop}set loop(R){R!==this._loop&&(this._loop=R,this.updateOptions({loop:R}))}get currentTime(){var R;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.audioContext&&(this.isPlaying||this.isPaused)){const R=this.isPaused?0:mJ.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+R}return 0}get spatialSound(){return this._spatialSound}set spatialSound(R){if(R==this._spatialSound)return;const J=this.isPlaying;this.pause(),R?(this._spatialSound=R,this._updateSpatialParameters()):this._disableSpatialSound(),J&&this.play()}constructor(R,J,B){var Q;let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new D.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=h.nJ.Zero(),this._localDirection=new h.nJ(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=R,B=B||n.e.LastCreatedScene)if(this._scene=B,tJ._SceneComponentInitialization(B),this._readyToPlayCallback=y,this._customAttenuationFunction=(R,J,B,Q,h)=>J<B?R*(1-J/B):0,r&&(this.autoplay=r.autoplay||!1,this._loop=r.loop||!1,void 0!==r.volume&&(this._volume=r.volume),this._spatialSound=r.spatialSound??!1,this.maxDistance=r.maxDistance??100,this.useCustomAttenuation=r.useCustomAttenuation??!1,this.rolloffFactor=r.rolloffFactor||1,this.refDistance=r.refDistance||1,this.distanceModel=r.distanceModel||"linear",this._playbackRate=r.playbackRate||1,this._streaming=r.streaming??!1,this._length=r.length,this._offset=r.offset),null!==(Q=mJ.c.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&mJ.c.audioEngine.audioContext){this._soundGain=mJ.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let R=!0;if(J)try{"string"===typeof J?(this._urlType="String",this._url=J):J instanceof ArrayBuffer?this._urlType="ArrayBuffer":J instanceof HTMLMediaElement?this._urlType="MediaElement":J instanceof MediaStream?this._urlType="MediaStream":J instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(J)&&(this._urlType="Array");let B=[],Q=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=mJ.c.audioEngine.audioContext.createMediaElementSource(J),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=mJ.c.audioEngine.audioContext.createMediaStreamSource(J),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":J.byteLength>0&&(Q=!0,this._soundLoaded(J));break;case"AudioBuffer":this._audioBufferLoaded(J);break;case"String":B.push(J);case"Array":0===B.length&&(B=J);for(let R=0;R<B.length;R++){const J=B[R];if(Q=r&&r.skipCodecCheck||-1!==J.indexOf(".mp3",J.length-4)&&mJ.c.audioEngine.isMP3supported||-1!==J.indexOf(".ogg",J.length-4)&&mJ.c.audioEngine.isOGGsupported||-1!==J.indexOf(".wav",J.length-4)||-1!==J.indexOf(".m4a",J.length-4)||-1!==J.indexOf(".mp4",J.length-4)||-1!==J.indexOf("blob:"),Q){this._streaming?(this._htmlAudioElement=new Audio(J),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,N.Tools.SetCorsBehavior(J,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(J,(R=>{this._soundLoaded(R)}),void 0,!0,!0,(R=>{R&&P.d.Error("XHR "+R.status+" error on: "+J+"."),P.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:R=!1}R?Q||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):P.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(q){P.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),mJ.c.audioEngine&&!mJ.c.audioEngine.WarnedWebAudioUnsupported&&(P.d.Error("Web Audio is not supported by your browser."),mJ.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var R;null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(R){var J;null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.audioContext&&(this._audioBuffer=R,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(R){var J;null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.audioContext&&mJ.c.audioEngine.audioContext.decodeAudioData(R,(R=>{this._audioBufferLoaded(R)}),(R=>{P.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+R)}))}setAudioBuffer(R){var J;null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&(this._audioBuffer=R,this._isReadyToPlay=!0)}updateOptions(R){R&&(this.loop=R.loop??this.loop,this.maxDistance=R.maxDistance??this.maxDistance,this.useCustomAttenuation=R.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=R.rolloffFactor??this.rolloffFactor,this.refDistance=R.refDistance??this.refDistance,this.distanceModel=R.distanceModel??this.distanceModel,this._playbackRate=R.playbackRate??this._playbackRate,this._length=R.length??void 0,this.spatialSound=R.spatialSound??this._spatialSound,this._setOffset(R.offset??void 0),this.setVolume(R.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var R;null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&mJ.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??mJ.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var R;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(R=this._soundPanner)||void 0===R||R.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var R;null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(R){var J;null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(R),this._isOutputConnected=!0)}setDirectionalCone(R,J,B){J<R?P.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=R,this._coneOuterAngle=J,this._coneOuterGain=B,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(R){if(R!=this._coneInnerAngle){var J;if(this._coneOuterAngle<R)return void P.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=R,null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(R){if(R!=this._coneOuterAngle){var J;if(R<this._coneInnerAngle)return void P.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=R,null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(R){var J;R.equals(this._position)||(this._position.h(R),null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(R){var J;this._localDirection=R,null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const R=this._connectedTransformNode.getWorldMatrix(),J=h.nJ.TransformNormal(this._localDirection,R);J.normalize(),this._soundPanner.orientationX.value=J.x,this._soundPanner.orientationY.value=J.y,this._soundPanner.orientationZ.value=J.z}updateDistanceFromListener(){var R;if(null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const R=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.PJ(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,R,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(R){this._customAttenuationFunction=R}play(R,J,B){var Q;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(Q=mJ.c.audioEngine)&&void 0!==Q&&Q.audioContext)try{var h,y;this._clearTimeoutsAndObservers();let Q=R?(null===(h=mJ.c.audioEngine)||void 0===h?void 0:h.audioContext.currentTime)+R:null===(y=mJ.c.audioEngine)||void 0===y?void 0:y.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=mJ.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const R=()=>{var B;if(null!==(B=mJ.c.audioEngine)&&void 0!==B&&B.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=J??0;const B=this._htmlAudioElement.play();void 0!==B&&B.catch((()=>{var J,B;(null===(J=mJ.c.audioEngine)||void 0===J||J.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(B=mJ.c.audioEngine)||void 0===B?void 0:B.onAudioUnlockedObservable.addOnce((()=>{R()})))}))}else{var Q;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(Q=mJ.c.audioEngine)||void 0===Q?void 0:Q.onAudioUnlockedObservable.addOnce((()=>{R()}))}};R()}}else{var N;const h=()=>{var h;if(null!==(h=mJ.c.audioEngine)&&void 0!==h&&h.audioContext){var y;if(B=B||this._length,void 0!==J&&this._setOffset(J),this._soundSource){const R=this._soundSource;R.onended=()=>{R.disconnect()}}if(this._soundSource=null===(y=mJ.c.audioEngine)||void 0===y?void 0:y.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var N;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==J&&(this._soundSource.loopStart=J),void 0!==B&&(this._soundSource.loopEnd=(0|J)+B),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},Q=R?(null===(N=mJ.c.audioEngine)||void 0===N?void 0:N.audioContext.currentTime)+R:mJ.c.audioEngine.audioContext.currentTime;const h=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(Q,h,this.loop?void 0:B)}}};"suspended"===(null===(N=mJ.c.audioEngine)||void 0===N?void 0:N.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var R;"suspended"===(null===(R=mJ.c.audioEngine)||void 0===R?void 0:R.audioContext.state)?(mJ.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=mJ.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{h()})))):h()}),500):h()}this._startTime=Q,this.isPlaying=!0,this.isPaused=!1}catch(r){P.d.Error("Error while trying to play audio: "+this.name+", "+r.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(R){var J;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var B;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(B=this._streamingSource)||void 0===B||B.disconnect();this.isPlaying=!1}else if(null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.audioContext&&this._soundSource){const J=R?mJ.c.audioEngine.audioContext.currentTime+R:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(J)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var R;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var J;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(J=this._streamingSource)||void 0===J||J.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=mJ.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(R,J){var B;null!==(B=mJ.c.audioEngine)&&void 0!==B&&B.canUseWebAudio&&this._soundGain&&(J&&mJ.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(mJ.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,mJ.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(R,mJ.c.audioEngine.audioContext.currentTime+J)):this._soundGain.gain.value=R),this._volume=R}setPlaybackRate(R){this._playbackRate=R,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(R){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=R,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=R=>this._onRegisterAfterWorldMatrixUpdate(R),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(R){var J;if(R.getBoundingInfo){const J=R.getBoundingInfo();this.setPosition(J.boundingSphere.centerWorld)}else this.setPosition(R.absolutePosition);null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const R=()=>{(0,oJ.f)((()=>this._isReadyToPlay),(()=>{B._audioBuffer=this.getAudioBuffer(),B._isReadyToPlay=!0,B.autoplay&&B.play(0,this._offset,this._length)}),void 0,300)},J={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},B=new tJ(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,J);return this.useCustomAttenuation&&B.setAttenuationFunction(this._customAttenuationFunction),B.setPosition(this._position),B.setPlaybackRate(this._playbackRate),R(),B}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const R={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(R.connectedMeshId=this._connectedTransformNode.id),R.position=this._position.Ch(),R.refDistance=this.refDistance,R.distanceModel=this.distanceModel,R.isDirectional=this._isDirectional,R.localDirectionToMesh=this._localDirection.Ch(),R.coneInnerAngle=this._coneInnerAngle,R.coneOuterAngle=this._coneOuterAngle,R.coneOuterGain=this._coneOuterGain),R}static Parse(R,J,B,Q){const y=R.name;let N;N=R.url?B+R.url:B+y;const r={autoplay:R.autoplay,loop:R.loop,volume:R.volume,spatialSound:R.spatialSound,maxDistance:R.maxDistance,rolloffFactor:R.rolloffFactor,refDistance:R.refDistance,distanceModel:R.distanceModel,playbackRate:R.playbackRate};let q;if(Q){const R=()=>{(0,oJ.f)((()=>Q._isReadyToPlay),(()=>{q._audioBuffer=Q.getAudioBuffer(),q._isReadyToPlay=!0,q.autoplay&&q.play(0,q._offset,q._length)}),void 0,300)};q=new tJ(y,new ArrayBuffer(0),J,null,r),R()}else q=new tJ(y,N,J,(()=>{J.removePendingData(q)}),r),J.addPendingData(q);if(R.position){const J=h.nJ.fJ(R.position);q.setPosition(J)}if(R.isDirectional&&(q.setDirectionalCone(R.coneInnerAngle||360,R.coneOuterAngle||360,R.coneOuterGain||0),R.localDirectionToMesh)){const J=h.nJ.fJ(R.localDirectionToMesh);q.setLocalDirectionToMesh(J)}if(R.connectedMeshId){const B=J.getMeshById(R.connectedMeshId);B&&q.attachToMesh(B)}return R.metadata&&(q.metadata=R.metadata),q}_setOffset(R){this._offset!==R&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=R)}_clearTimeoutsAndObservers(){var R;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(R=mJ.c.audioEngine)||void 0===R||R.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}tJ._SceneComponentInitialization=R=>{throw(0,vJ.c)("AudioSceneComponent")},(0,xR.h)("BABYLON.Sound",tJ);class ZJ{constructor(R,J,B){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],J.length!==B.length)throw new Error("Sounds length does not equal weights length");this.loop=R,this._weights=B;let Q=0;for(const y of B)Q+=y;const h=Q>0?1/Q:0;for(let y=0;y<this._weights.length;y++)this._weights[y]*=h;this._sounds=J;for(const y of this._sounds)y.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(R){if(R!==this._coneInnerAngle){if(this._coneOuterAngle<R)return void P.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=R;for(const J of this._sounds)J.directionalConeInnerAngle=R}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(R){if(R!==this._coneOuterAngle){if(R<this._coneInnerAngle)return void P.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=R;for(const J of this._sounds)J.directionalConeOuterAngle=R}}get volume(){return this._volume}set volume(R){if(R!==this._volume)for(const J of this._sounds)J.setVolume(R)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(R){if(!this.isPaused){this.stop();const R=Math.random();let J=0;for(let B=0;B<this._weights.length;B++)if(J+=this._weights[B],R<=J){this._currentIndex=B;break}}const J=this._sounds[this._currentIndex??0];J.isReady()?J.play(0,this.isPaused?void 0:R):J.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class UJ{constructor(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(R=R||n.e.LastCreatedScene)&&(this._scene=R,this.soundCollection=[],this._options=J,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var R;null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&mJ.c.audioEngine.audioContext&&(this._outputAudioNode=mJ.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(mJ.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(mJ.c.audioEngine&&mJ.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(R){var J;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._outputAudioNode&&R.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==R.soundTrackId&&(-1===R.soundTrackId?this._scene.mainSoundTrack.removeSound(R):this._scene.soundTracks&&this._scene.soundTracks[R.soundTrackId].removeSound(R)),this.soundCollection.push(R),R.soundTrackId=this.id}removeSound(R){const J=this.soundCollection.indexOf(R);-1!==J&&this.soundCollection.splice(J,1)}setVolume(R){var J;null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=R)}switchPanningModelToHRTF(){var R;if(null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.canUseWebAudio)for(let J=0;J<this.soundCollection.length;J++)this.soundCollection[J].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var R;if(null!==(R=mJ.c.audioEngine)&&void 0!==R&&R.canUseWebAudio)for(let J=0;J<this.soundCollection.length;J++)this.soundCollection[J].switchPanningModelToEqualPower()}connectToAnalyser(R){var J;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=R,null!==(J=mJ.c.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,mJ.c.audioEngine.masterGain))}}var RB=B(11447),JB=B(11419),BB=B(11039);mJ.c.AudioEngineFactory=(R,J,B)=>new QB(R,J,B);class QB{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new D.e,this.onAudioLockedObservable=new D.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,BB.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const Q=document.createElement("audio");this._hostElement=R,this._audioContext=J,this._audioDestination=B;try{Q&&Q.canPlayType&&(Q.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||Q.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(h){}try{Q&&Q.canPlayType&&Q.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(h){}}lock(){this._triggerSuspendedState()}unlock(){var R,J;if("running"===(null===(R=this._audioContext)||void 0===R?void 0:R.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(J=this._audioContext)||void 0===J||J.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{P.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var R;null===(R=this._audioContext)||void 0===R||R.addEventListener("statechange",(()=>{var R;this.unlocked&&"running"!==(null===(R=this._audioContext)||void 0===R?void 0:R.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var R;return null!==(R=this._audioContext)&&void 0!==R&&R.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(R){this.canUseWebAudio=!1,P.d.Error("Web Audio: "+R.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(R){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const R=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",J=document.createElement("style");J.appendChild(document.createTextNode(R)),document.getElementsByTagName("head")[0].appendChild(J),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var R;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(R=this._audioContext)||void 0===R||R.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(R){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=R)}connectToAnalyser(R){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=R,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var hB=B(11047);(0,B(12554).c)(RB.b.NAME_AUDIO,((R,J,B,Q)=>{let h,y=[];if(B.vE=B.vE||[],void 0!==R.vE&&null!==R.vE)for(let r=0,q=R.vE.length;r<q;r++){var N;const q=R.vE[r];null!==(N=mJ.c.audioEngine)&&void 0!==N&&N.canUseWebAudio?(q.url||(q.url=q.name),y[q.url]?B.vE.push(tJ.Parse(q,J,Q,y[q.url])):(h=tJ.Parse(q,J,Q),y[q.url]=h,B.vE.push(h))):B.vE.push(new tJ(q.name,null,J))}y=[]})),Object.defineProperty(JB.d.prototype,"mainSoundTrack",{get:function(){let R=this._getComponent(RB.b.NAME_AUDIO);return R||(R=new yB(this),this.rh(R)),this._mainSoundTrack||(this._mainSoundTrack=new UJ(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),JB.d.prototype.getSoundByName=function(R){let J;for(J=0;J<this.mainSoundTrack.soundCollection.length;J++)if(this.mainSoundTrack.soundCollection[J].name===R)return this.mainSoundTrack.soundCollection[J];if(this.soundTracks)for(let B=0;B<this.soundTracks.length;B++)for(J=0;J<this.soundTracks[B].soundCollection.length;J++)if(this.soundTracks[B].soundCollection[J].name===R)return this.soundTracks[B].soundCollection[J];return null},Object.defineProperty(JB.d.prototype,"audioEnabled",{get:function(){let R=this._getComponent(RB.b.NAME_AUDIO);return R||(R=new yB(this),this.rh(R)),R.audioEnabled},set:function(R){let J=this._getComponent(RB.b.NAME_AUDIO);J||(J=new yB(this),this.rh(J)),R?J.enableAudio():J.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(JB.d.prototype,"headphone",{get:function(){let R=this._getComponent(RB.b.NAME_AUDIO);return R||(R=new yB(this),this.rh(R)),R.headphone},set:function(R){let J=this._getComponent(RB.b.NAME_AUDIO);J||(J=new yB(this),this.rh(J)),R?J.switchAudioModeForHeadphones():J.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(JB.d.prototype,"audioListenerPositionProvider",{get:function(){let R=this._getComponent(RB.b.NAME_AUDIO);return R||(R=new yB(this),this.rh(R)),R.audioListenerPositionProvider},set:function(R){let J=this._getComponent(RB.b.NAME_AUDIO);if(J||(J=new yB(this),this.rh(J)),R&&"function"!==typeof R)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");J.audioListenerPositionProvider=R},enumerable:!0,configurable:!0}),Object.defineProperty(JB.d.prototype,"audioListenerRotationProvider",{get:function(){let R=this._getComponent(RB.b.NAME_AUDIO);return R||(R=new yB(this),this.rh(R)),R.audioListenerRotationProvider},set:function(R){let J=this._getComponent(RB.b.NAME_AUDIO);if(J||(J=new yB(this),this.rh(J)),R&&"function"!==typeof R)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");J.audioListenerRotationProvider=R},enumerable:!0,configurable:!0}),Object.defineProperty(JB.d.prototype,"audioPositioningRefreshRate",{get:function(){let R=this._getComponent(RB.b.NAME_AUDIO);return R||(R=new yB(this),this.rh(R)),R.audioPositioningRefreshRate},set:function(R){let J=this._getComponent(RB.b.NAME_AUDIO);J||(J=new yB(this),this.rh(J)),J.audioPositioningRefreshRate=R},enumerable:!0,configurable:!0});class yB{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(R){this.name=RB.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new h.nJ,this._cachedCameraPosition=new h.nJ,this._lastCheck=0,this._invertMatrixTemp=new h.Matrix,this._cameraDirectionTemp=new h.nJ,(R=R||n.e.LastCreatedScene)&&(this.AJ=R,R.soundTracks=[],R.vE=[])}register(){this.AJ._afterRenderStage.registerStep(RB.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(R){if(R.vE=[],this.AJ.soundTracks)for(let J=0;J<this.AJ.soundTracks.length;J++){const B=this.AJ.soundTracks[J];for(let J=0;J<B.soundCollection.length;J++)R.vE.push(B.soundCollection[J].serialize())}}addFromContainer(R){if(R.vE)for(const J of R.vE)J.play(),J.autoplay=!0,this.AJ.mainSoundTrack.addSound(J)}removeFromContainer(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(R.vE)for(const B of R.vE)B.stop(),B.autoplay=!1,this.AJ.mainSoundTrack.removeSound(B),J&&B.dispose()}dispose(){const R=this.AJ;if(R._mainSoundTrack&&R.mainSoundTrack.dispose(),R.soundTracks)for(let J=0;J<R.soundTracks.length;J++)R.soundTracks[J].dispose()}disableAudio(){const R=this.AJ;let J;for(this._audioEnabled=!1,mJ.c.audioEngine&&mJ.c.audioEngine.audioContext&&mJ.c.audioEngine.audioContext.suspend(),J=0;J<R.mainSoundTrack.soundCollection.length;J++)R.mainSoundTrack.soundCollection[J].pause();if(R.soundTracks)for(J=0;J<R.soundTracks.length;J++)for(let B=0;B<R.soundTracks[J].soundCollection.length;B++)R.soundTracks[J].soundCollection[B].pause()}enableAudio(){const R=this.AJ;let J;for(this._audioEnabled=!0,mJ.c.audioEngine&&mJ.c.audioEngine.audioContext&&mJ.c.audioEngine.audioContext.resume(),J=0;J<R.mainSoundTrack.soundCollection.length;J++)R.mainSoundTrack.soundCollection[J].isPaused&&R.mainSoundTrack.soundCollection[J].play();if(R.soundTracks)for(J=0;J<R.soundTracks.length;J++)for(let B=0;B<R.soundTracks[J].soundCollection.length;B++)R.soundTracks[J].soundCollection[B].isPaused&&R.soundTracks[J].soundCollection[B].play()}switchAudioModeForHeadphones(){const R=this.AJ;if(this._headphone=!0,R.mainSoundTrack.switchPanningModelToHRTF(),R.soundTracks)for(let J=0;J<R.soundTracks.length;J++)R.soundTracks[J].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const R=this.AJ;if(this._headphone=!1,R.mainSoundTrack.switchPanningModelToEqualPower(),R.soundTracks)for(let J=0;J<R.soundTracks.length;J++)R.soundTracks[J].switchPanningModelToEqualPower()}_afterRender(){const R=hB.c.Now;if(this._lastCheck&&R-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=R;const J=this.AJ;if(!this._audioEnabled||!J._mainSoundTrack||!J.soundTracks||0===J._mainSoundTrack.soundCollection.length&&1===J.soundTracks.length)return;const B=mJ.c.audioEngine;if(B&&B.audioContext){let R,Q=J.activeCamera;if(J.activeCameras&&J.activeCameras.length>0&&(Q=J.activeCameras[0]),this.audioListenerPositionProvider){const R=this.audioListenerPositionProvider();B.audioContext.listener.setPosition(R.x||0,R.y||0,R.z||0)}else Q?this._cachedCameraPosition.equals(Q.globalPosition)||(this._cachedCameraPosition.h(Q.globalPosition),B.audioContext.listener.setPosition(Q.globalPosition.x,Q.globalPosition.y,Q.globalPosition.z)):B.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const R=this.audioListenerRotationProvider();B.audioContext.listener.setOrientation(R.x||0,R.y||0,R.z||0,0,1,0)}else Q?(Q.rigCameras&&Q.rigCameras.length>0&&(Q=Q.rigCameras[0]),Q.getViewMatrix().invertToRef(this._invertMatrixTemp),h.nJ.TransformNormalToRef(yB._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.h(this._cameraDirectionTemp),B.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):B.audioContext.listener.setOrientation(0,0,0,0,1,0);for(R=0;R<J.mainSoundTrack.soundCollection.length;R++){const B=J.mainSoundTrack.soundCollection[R];B.useCustomAttenuation&&B.updateDistanceFromListener()}if(J.soundTracks)for(R=0;R<J.soundTracks.length;R++)for(let B=0;B<J.soundTracks[R].soundCollection.length;B++){const Q=J.soundTracks[R].soundCollection[B];Q.useCustomAttenuation&&Q.updateDistanceFromListener()}}}}yB._CameraDirection=new h.nJ(0,0,-1),tJ._SceneComponentInitialization=R=>{let J=R._getComponent(RB.b.NAME_AUDIO);J||(J=new yB(R),R.rh(J))};const NB="MSFT_audio_emitter";class rB{constructor(R){this.name=NB,this._loader=R,this.enabled=this._loader.isExtensionUsed(NB)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const R=this._loader.xh.extensions;if(R&&R[this.name]){const J=R[this.name];this._clips=J.clips,this._emitters=J.emitters,T.Assign(this._clips),T.Assign(this._emitters)}}loadSceneAsync(R,J){return C.LoadExtensionAsync(R,J,this.name,(async(B,Q)=>{const h=new Array;h.push(this._loader.loadSceneAsync(R,J));for(const R of Q.emitters){const J=T.Get(`${B}/emitters`,this._emitters,R);if(void 0!=J.refDistance||void 0!=J.maxDistance||void 0!=J.rolloffFactor||void 0!=J.distanceModel||void 0!=J.innerAngle||void 0!=J.outerAngle)throw new Error(`${B}: Direction or Distance properties are not allowed on emitters attached to a scene`);h.push(this._loadEmitterAsync(`${B}/emitters/${J.index}`,J))}await Promise.all(h)}))}loadNodeAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(R,Q)=>{const y=new Array,r=await this._loader.loadNodeAsync(R,J,(J=>{for(const B of Q.emitters){const Q=T.Get(`${R}/emitters`,this._emitters,B);y.push(this._loadEmitterAsync(`${R}/emitters/${Q.index}`,Q).then((()=>{for(const R of Q._babylonSounds)R.attachToMesh(J),void 0==Q.innerAngle&&void 0==Q.outerAngle||(R.setLocalDirectionToMesh(h.nJ.Forward()),R.setDirectionalCone(2*N.Tools.ToDegrees(void 0==Q.innerAngle?Math.PI:Q.innerAngle),2*N.Tools.ToDegrees(void 0==Q.outerAngle?Math.PI:Q.outerAngle),0))})))}B(J)}));return await Promise.all(y),r}))}loadAnimationAsync(R,J){return C.LoadExtensionAsync(R,J,this.name,(async(B,Q)=>{const h=await this._loader.loadAnimationAsync(R,J),y=new Array;T.Assign(Q.events);for(const N of Q.events)y.push(this._loadAnimationEventAsync(`${B}/events/${N.index}`,R,J,N,h));return await Promise.all(y),h}))}_loadClipAsync(R,J){if(J._objectURL)return J._objectURL;let B;if(J.uri)B=this._loader.loadUriAsync(R,J,J.uri);else{const Q=T.Get(`${R}/bufferView`,this._loader.xh.bufferViews,J.bufferView);B=this._loader.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}return J._objectURL=B.then((R=>URL.createObjectURL(new Blob([R],{type:J.mimeType})))),J._objectURL}_loadEmitterAsync(R,J){if(J._babylonSounds=J._babylonSounds||[],!J._babylonData){const R=new Array,B=J.name||`emitter${J.index}`,Q={loop:!1,autoplay:!1,volume:void 0==J.volume?1:J.volume};for(let y=0;y<J.clips.length;y++){const h=`/extensions/${this.name}/clips`,N=T.Get(h,this._clips,J.clips[y].clip);R.push(this._loadClipAsync(`${h}/${J.clips[y].clip}`,N).then((R=>{const h=J._babylonSounds[y]=new tJ(B,R,this._loader.babylonScene,null,Q);h.refDistance=J.refDistance||1,h.maxDistance=J.maxDistance||256,h.rolloffFactor=J.rolloffFactor||1,h.distanceModel=J.distanceModel||"exponential"})))}const h=Promise.all(R).then((()=>{const R=J.clips.map((R=>R.weight||1)),B=new ZJ(J.loop||!1,J._babylonSounds,R);J.innerAngle&&(B.directionalConeInnerAngle=2*N.Tools.ToDegrees(J.innerAngle)),J.outerAngle&&(B.directionalConeOuterAngle=2*N.Tools.ToDegrees(J.outerAngle)),J.volume&&(B.volume=J.volume),J._babylonData.sound=B}));J._babylonData={loaded:h}}return J._babylonData.loaded}_getEventAction(R,J,B,Q,h){switch(B){case"play":return R=>{const B=(h||0)+(R-Q);J.play(B)};case"stop":return()=>{J.stop()};case"pause":return()=>{J.pause()};default:throw new Error(`${R}: Unsupported action ${B}`)}}_loadAnimationEventAsync(R,J,B,Q,h){if(0==h.targetedAnimations.length)return Promise.resolve();const y=h.targetedAnimations[0],N=Q.QJ,r=T.Get(`/extensions/${this.name}/emitters`,this._emitters,N);return this._loadEmitterAsync(R,r).then((()=>{const J=r._babylonData.sound;if(J){const B=new KJ(Q.time,this._getEventAction(R,J,Q.action,Q.time,Q.startOffset));y.animation.addEvent(B),h.onAnimationGroupEndObservable.add((()=>{J.stop()})),h.onAnimationGroupPauseObservable.add((()=>{J.pause()}))}}))}}G(NB),Y(NB,!0,(R=>new rB(R)));const qB="MSFT_lod";class eB{constructor(R){var J;this.name=qB,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new D.e,this.onMaterialLODsLoadedObservable=new D.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=R,this.maxLODsToLoad=(null===(J=this._loader.parent.extensionOptions[qB])||void 0===J?void 0:J.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(qB)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let R=0;R<this._nodePromiseLODs.length;R++){const J=Promise.all(this._nodePromiseLODs[R]).then((()=>{0!==R&&(this._loader.endPerformanceCounter(`Node LOD ${R}`),this._loader.log(`Loaded node LOD ${R}`)),this.onNodeLODsLoadedObservable.notifyObservers(R),R!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${R+1}`),this._loadBufferLOD(this._nodeBufferLODs,R+1),this._nodeSignalLODs[R]&&this._nodeSignalLODs[R].resolve())}));this._loader._completePromises.push(J)}for(let R=0;R<this._materialPromiseLODs.length;R++){const J=Promise.all(this._materialPromiseLODs[R]).then((()=>{0!==R&&(this._loader.endPerformanceCounter(`Material LOD ${R}`),this._loader.log(`Loaded material LOD ${R}`)),this.onMaterialLODsLoadedObservable.notifyObservers(R),R!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${R+1}`),this._loadBufferLOD(this._materialBufferLODs,R+1),this._materialSignalLODs[R]&&this._materialSignalLODs[R].resolve())}));this._loader._completePromises.push(J)}}loadSceneAsync(R,J){const B=this._loader.loadSceneAsync(R,J);return this._loadBufferLOD(this._bufferLODs,0),B}loadNodeAsync(R,J,B){return C.LoadExtensionAsync(R,J,this.name,(async(R,h)=>{let y;const N=this._getLODs(R,J,this._loader.xh.nodes,h.ids);this._loader.logOpen(`${R}`);for(let J=0;J<N.length;J++){const R=N[J];0!==J&&(this._nodeIndexLOD=J,this._nodeSignalLODs[J]=this._nodeSignalLODs[J]||new Q);const h=R=>{B(R),R.Cr(!1)},r=this._loader.loadNodeAsync(`/nodes/${R.index}`,R,h).then((R=>{if(0!==J){const R=N[J-1];R._babylonTransformNode&&(this._disposeTransformNode(R._babylonTransformNode),delete R._babylonTransformNode)}return R.Cr(!0),R}));this._nodePromiseLODs[J]=this._nodePromiseLODs[J]||[],0===J?y=r:(this._nodeIndexLOD=null,this._nodePromiseLODs[J].push(r))}return this._loader.logClose(),await y}))}_loadMaterialAsync(R,J,B,Q,h){return this._nodeIndexLOD?null:C.LoadExtensionAsync(R,J,this.name,(async(R,y)=>{let N;const r=this._getLODs(R,J,this._loader.xh.materials,y.ids);this._loader.logOpen(`${R}`);for(let J=0;J<r.length;J++){const R=r[J];0!==J&&(this._materialIndexLOD=J);const y=this._loader._loadMaterialAsync(`/materials/${R.index}`,R,B,Q,(R=>{0===J&&h(R)})).then((R=>{if(0!==J){h(R);const B=r[J-1]._data;B[Q]&&(this._disposeMaterials([B[Q].babylonMaterial]),delete B[Q])}return R}));this._materialPromiseLODs[J]=this._materialPromiseLODs[J]||[],0===J?N=y:(this._materialIndexLOD=null,this._materialPromiseLODs[J].push(y))}return this._loader.logClose(),await N}))}_loadUriAsync(R,J,B){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const h=this._nodeIndexLOD-1;return this._nodeSignalLODs[h]=this._nodeSignalLODs[h]||new Q,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(R,J,B)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const h=this._materialIndexLOD-1;return this._materialSignalLODs[h]=this._materialSignalLODs[h]||new Q,this._materialSignalLODs[h].promise.then((async()=>await this._loader.loadUriAsync(R,J,B)))}return null}loadBufferAsync(R,J,B,h){if(this._loader.parent.useRangeRequests&&!J.uri){if(!this._loader.bin)throw new Error(`${R}: Uri is missing or the binary glTF is missing its binary chunk`);const J=async(R,J)=>{const y=B,N=y+h-1;let r=R[J];return r?(r.start=Math.min(r.start,y),r.end=Math.max(r.end,N)):(r={start:y,end:N,loaded:new Q},R[J]=r),await r.loaded.promise.then((R=>new Uint8Array(R.buffer,R.byteOffset+B-r.start,h)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?J(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?J(this._materialBufferLODs,this._materialIndexLOD):J(this._bufferLODs,0)}return null}_loadBufferLOD(R,J){const B=R[J];B&&(this._loader.log(`Loading buffer range [${B.start}-${B.end}]`),this._loader.bin.readAsync(B.start,B.end-B.start+1).then((R=>{B.loaded.resolve(R)}),(R=>{B.loaded.reject(R)})))}_getLODs(R,J,B,Q){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const h=[];for(let y=Q.length-1;y>=0;y--)if(h.push(T.Get(`${R}/ids/${Q[y]}`,B,Q[y])),h.length===this.maxLODsToLoad)return h;return h.push(J),h}_disposeTransformNode(R){const J=[],B=R.material;B&&J.push(B);for(const h of R.getChildMeshes())h.material&&J.push(h.material);R.dispose();const Q=J.filter((R=>this._loader.babylonScene.meshes.every((J=>J.material!=R))));this._disposeMaterials(Q)}_disposeMaterials(R){const J={};for(const B of R){for(const R of B.getActiveTextures())J[R.uniqueId]=R;B.dispose()}for(const B in J)for(const R of this._loader.babylonScene.materials)R.hasTexture(J[B])&&delete J[B];for(const B in J)J[B].dispose()}}G(qB),Y(qB,!0,(R=>new eB(R)));const DB="MSFT_minecraftMesh";class lB{constructor(R){this.name=DB,this._loader=R,this.enabled=this._loader.isExtensionUsed(DB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtraAsync(R,J,this.name,(async(Q,h)=>{if(h){if(!(B instanceof f.b))throw new Error(`${Q}: Material type not supported`);const h=this._loader.loadMaterialPropertiesAsync(R,J,B);return B.needAlphaBlending()&&(B.forceDepthWrite=!0,B.separateCullingPass=!0),B.Pr=B.forceDepthWrite,B.twoSidedLighting=!0,await h}}))}}G(DB),Y(DB,!0,(R=>new lB(R)));const EB="MSFT_sRGBFactors";class OB{constructor(R){this.name=EB,this._loader=R,this.enabled=this._loader.isExtensionUsed(EB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,J,B){return C.LoadExtraAsync(R,J,this.name,(async(Q,h)=>{if(h){if(!(B instanceof f.b))throw new Error(`${Q}: Material type not supported`);const h=this._loader.loadMaterialPropertiesAsync(R,J,B),y=B.IR().getEngine().useExactSrgbConversions;return B.albedoTexture||B.albedoColor.toLinearSpaceToRef(B.albedoColor,y),B.reflectivityTexture||B.reflectivityColor.toLinearSpaceToRef(B.reflectivityColor,y),await h}}))}}G(EB),Y(EB,!0,(R=>new OB(R)));var nB=B(12884);const PB={};var AB=B(12937),uB=B(12913),SB=B(12886),fB=B(12894);function aB(R,J){for(const B of R)for(const R of B.dataOutputs)if(R.uniqueId===J)return R;throw new Error("Could not find data out connection with unique id "+J)}function sB(R,J){for(const B of R)if(B instanceof uB.d)for(const R of B.signalInputs)if(R.uniqueId===J)return R;throw new Error("Could not find signal in connection with unique id "+J)}async function xB(R,J){const Q=await Promise.all(R.allBlocks.map((async R=>{const J=function(R){switch(R){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([B.e(78),B.e(79)]).then(B.bind(B,14325))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await B.e(80).then(B.bind(B,14330))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await B.e(81).then(B.bind(B,14339))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await B.e(82).then(B.bind(B,14347))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await B.e(83).then(B.bind(B,14350))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await B.e(84).then(B.bind(B,14358))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await B.e(85).then(B.bind(B,14361))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await B.e(86).then(B.bind(B,14365))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await B.e(87).then(B.bind(B,14373))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await B.e(90).then(B.bind(B,14405))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await B.e(90).then(B.bind(B,14405))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await B.e(90).then(B.bind(B,14405))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await B.e(90).then(B.bind(B,14405))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await B.e(95).then(B.bind(B,14411))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await B.e(96).then(B.bind(B,14420))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await B.e(97).then(B.bind(B,14426))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await B.e(98).then(B.bind(B,14428))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await B.e(99).then(B.bind(B,14431))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await B.e(100).then(B.bind(B,14438))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await B.e(101).then(B.bind(B,14442))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await B.e(102).then(B.bind(B,14450))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await B.e(103).then(B.bind(B,14458))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await B.e(104).then(B.bind(B,14465))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await B.e(105).then(B.bind(B,14469))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await B.e(106).then(B.bind(B,14473))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await B.e(107).then(B.bind(B,14480))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await B.e(108).then(B.bind(B,14486))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await B.e(109).then(B.bind(B,14490))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await B.e(110).then(B.bind(B,14494))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await B.e(111).then(B.bind(B,14501))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await B.e(112).then(B.bind(B,14508))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await B.e(113).then(B.bind(B,14515))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await B.e(92).then(B.bind(B,14518))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await B.e(114).then(B.bind(B,14520))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await B.e(115).then(B.bind(B,14525))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await B.e(116).then(B.bind(B,14530))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await B.e(93).then(B.bind(B,14532))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await B.e(88).then(B.bind(B,14376))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await B.e(94).then(B.bind(B,14541))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await B.e(94).then(B.bind(B,14541))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await B.e(94).then(B.bind(B,14541))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await B.e(94).then(B.bind(B,14541))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await B.e(94).then(B.bind(B,14541))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await B.e(94).then(B.bind(B,14541))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await B.e(94).then(B.bind(B,14541))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await B.e(94).then(B.bind(B,14541))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await B.e(89).then(B.bind(B,14396))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await B.e(90).then(B.bind(B,14405))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await B.e(90).then(B.bind(B,14405))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await B.e(91).then(B.bind(B,14546))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await B.e(91).then(B.bind(B,14546))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await B.e(91).then(B.bind(B,14546))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await B.e(91).then(B.bind(B,14546))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await B.e(91).then(B.bind(B,14546))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await B.e(91).then(B.bind(B,14546))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await B.e(117).then(B.bind(B,14551))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await B.e(118).then(B.bind(B,14554))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await B.e(119).then(B.bind(B,14558))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await B.e(120).then(B.bind(B,14561))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await B.e(121).then(B.bind(B,14569))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await B.e(122).then(B.bind(B,14578))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await B.e(123).then(B.bind(B,14586))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await B.e(124).then(B.bind(B,14588))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await B.e(125).then(B.bind(B,14594))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await B.e(126).then(B.bind(B,14603))).FlowGraphDataSwitchBlock;default:if(PB[R])return PB[R];throw new Error(`Unknown block name ${R}`)}}(R.className);return await J()})));return function(R,J,B){const Q=J.coordinator.createGraph(),h=[],y=J.valueParseFunction??SB.e;for(let N=0;N<R.allBlocks.length;N++){const r=VB(R.allBlocks[N],{AJ:J.coordinator.config.AJ,pathConverter:J.pathConverter,assetsContainer:J.coordinator.config.AJ,valueParseFunction:y},B[N]);h.push(r),r instanceof AB.b&&Q.addEventBlock(r)}for(const N of h){for(const R of N.dataInputs)for(const J of R.connectedPointIds){const B=aB(h,J);R.connectTo(B)}if(N instanceof uB.d)for(const R of N.signalOutputs)for(const J of R.connectedPointIds){const B=sB(h,J);R.connectTo(B)}}for(const N of R.executionContexts)IB(N,{graph:Q,valueParseFunction:y},R.rightHanded);return Q}(R,J,Q)}function IB(R,J,B){const Q=J.graph.createContext();R.enableLogging&&(Q.enableLogging=!0),Q.treatDataAsRightHanded=B||!1;const h=J.valueParseFunction??SB.e;Q.uniqueId=R.uniqueId;const y=Q.IR();if(R._assetsContext){var N,r,q,e,D,l,E,O,n,P;const J=R._assetsContext,B={meshes:null===(N=J.meshes)||void 0===N?void 0:N.map((R=>y.getMeshById(R))),lights:null===(r=J.lights)||void 0===r?void 0:r.map((R=>y.getLightByName(R))),cameras:null===(q=J.cameras)||void 0===q?void 0:q.map((R=>y.getCameraByName(R))),materials:null===(e=J.materials)||void 0===e?void 0:e.map((R=>y.getMaterialById(R))),textures:null===(D=J.textures)||void 0===D?void 0:D.map((R=>y.getTextureByName(R))),animations:null===(l=J.animations)||void 0===l?void 0:l.map((R=>y.animations.find((J=>J.name===R)))),skeletons:null===(E=J.skeletons)||void 0===E?void 0:E.map((R=>y.getSkeletonByName(R))),OE:null===(O=J.OE)||void 0===O?void 0:O.map((R=>y.getParticleSystemById(R))),animationGroups:null===(n=J.animationGroups)||void 0===n?void 0:n.map((R=>y.getAnimationGroupByName(R))),transformNodes:null===(P=J.transformNodes)||void 0===P?void 0:P.map((R=>y.getTransformNodeById(R))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],vE:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};Q.assetsContext=B}for(const A in R._userVariables){const J=h(A,R._userVariables,Q.assetsContext,y);Q.userVariables[A]=J}for(const A in R._connectionValues){const J=h(A,R._connectionValues,Q.assetsContext,y);Q._setConnectionValueByKey(A,J)}return Q}function VB(R,J,B){const Q={},h=J.valueParseFunction??SB.e;if(R.config)for(const N in R.config)Q[N]=h(N,R.config,J.assetsContainer||J.AJ,J.AJ);if((0,SB.k)(R.className)){if(!J.pathConverter)throw new Error("Path converter is required for this block");Q.pathConverter=J.pathConverter}const y=new B(Q);y.uniqueId=R.uniqueId;for(let N=0;N<R.dataInputs.length;N++){const J=y.getDataInput(R.dataInputs[N].name);if(!J)throw new Error("Could not find data input with name "+R.dataInputs[N].name+" in block "+R.className);J.deserialize(R.dataInputs[N])}for(let N=0;N<R.dataOutputs.length;N++){const J=y.getDataOutput(R.dataOutputs[N].name);if(!J)throw new Error("Could not find data output with name "+R.dataOutputs[N].name+" in block "+R.className);J.deserialize(R.dataOutputs[N])}return y.metadata=R.metadata,y.deserialize&&y.deserialize(R),y}function MB(R){const[J,B]=R.split(":");return HB({op:J,extension:B})}function HB(R){var J;let B=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=R.extension?null===(J=XB[R.extension])||void 0===J?void 0:J[R.op]:cB[R.op];if(!Q&&(P.d.Warn(`No mapping found for operation ${R.op} and extension ${R.extension||"KHR_interactivity"}`),B)){const J={},B={flows:{}};if(R.inputValueSockets){J.values={};for(const B in R.inputValueSockets)J.values[B]={name:B}}return R.outputValueSockets&&(B.values={},Object.keys(R.outputValueSockets).forEach((R=>{B.values[R]={name:R}}))),{pD:[],inputs:J,outputs:B}}return Q}function dB(R,J,B){XB[J]||(XB[J]={}),XB[J][R]=B}const XB={BABYLON:{"flow/log":{pD:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},cB={"event/onStart":{pD:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{pD:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{pD:["FlowGraphSendCustomEventBlock"],extraProcessor(R,J,B,Q,h){if("event/send"!==J.op||!R.configuration||1!==Object.keys(R.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const y=R.configuration.event.value[0];if("number"!==typeof y)throw new Error("Event id should be a number");const N=Q.arrays.events[y],r=h[0];return r.config||(r.config={}),r.config.eventId=N.eventId,r.config.eventData=N.eventData,h}},"event/receive":{pD:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(R,J){var B;if(!R.configuration)return P.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const Q=R.configuration.event;if(!Q)return P.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const h=Q.value[0];if("number"!==typeof h)return P.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(B=J.events)||void 0===B?void 0:B[h])?{valid:!0}:(P.d.Error(`Event with id ${h} not found`),{valid:!1,error:`Event with id ${h} not found`})},extraProcessor(R,J,B,Q,h){if("event/receive"!==J.op||!R.configuration||1!==Object.keys(R.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const y=R.configuration.event.value[0];if("number"!==typeof y)throw new Error("Event id should be a number");const N=Q.arrays.events[y],r=h[0];return r.config||(r.config={}),r.config.eventId=N.eventId,r.config.eventData=N.eventData,h}},"math/e":zB("FlowGraphEBlock"),"math/pi":zB("FlowGraphPIBlock"),"math/inf":zB("FlowGraphInfBlock"),"math/nan":zB("FlowGraphNaNBlock"),"math/abs":zB("FlowGraphAbsBlock"),"math/sign":zB("FlowGraphSignBlock"),"math/trunc":zB("FlowGraphTruncBlock"),"math/floor":zB("FlowGraphFloorBlock"),"math/ceil":zB("FlowGraphCeilBlock"),"math/round":{pD:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h){var y;return(y=h[0]).config||(y.config={}),h[0].config.roundHalfAwayFromZero=!0,h}},"math/fract":zB("FlowGraphFractBlock"),"math/neg":zB("FlowGraphNegationBlock"),"math/add":zB("FlowGraphAddBlock",["a","b"],!0),"math/sub":zB("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{pD:["FlowGraphMultiplyBlock"],extraProcessor(R,J,B,Q,h){var y;(y=h[0]).config||(y.config={}),h[0].config.useMatrixPerComponent=!0,h[0].config.preventIntegerFloatArithmetic=!0;let N=-1;return Object.keys(R.values||{}).find((J=>{var B;return void 0!==(null===(B=R.values)||void 0===B?void 0:B[J].type)&&(N=R.values[J].type,!0)})),-1!==N&&(h[0].config.type=Q.arrays.types[N].flowGraphType),h},validation:R=>R.values?pB(R):{valid:!0}},"math/div":zB("FlowGraphDivideBlock",["a","b"],!0),"math/rem":zB("FlowGraphModuloBlock",["a","b"]),"math/min":zB("FlowGraphMinBlock",["a","b"]),"math/max":zB("FlowGraphMaxBlock",["a","b"]),"math/clamp":zB("FlowGraphClampBlock",["a","b","c"]),"math/saturate":zB("FlowGraphSaturateBlock"),"math/mix":zB("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":zB("FlowGraphEqualityBlock",["a","b"]),"math/lt":zB("FlowGraphLessThanBlock",["a","b"]),"math/le":zB("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":zB("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":zB("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":zB("FlowGraphIsNaNBlock"),"math/isinf":zB("FlowGraphIsInfBlock"),"math/select":{pD:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{pD:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":zB("FlowGraphSinBlock"),"math/cos":zB("FlowGraphCosBlock"),"math/tan":zB("FlowGraphTanBlock"),"math/asin":zB("FlowGraphASinBlock"),"math/acos":zB("FlowGraphACosBlock"),"math/atan":zB("FlowGraphATanBlock"),"math/atan2":zB("FlowGraphATan2Block",["a","b"]),"math/sinh":zB("FlowGraphSinhBlock"),"math/cosh":zB("FlowGraphCoshBlock"),"math/tanh":zB("FlowGraphTanhBlock"),"math/asinh":zB("FlowGraphASinhBlock"),"math/acosh":zB("FlowGraphACoshBlock"),"math/atanh":zB("FlowGraphATanhBlock"),"math/exp":zB("FlowGraphExponentialBlock"),"math/log":zB("FlowGraphLogBlock"),"math/log2":zB("FlowGraphLog2Block"),"math/log10":zB("FlowGraphLog10Block"),"math/sqrt":zB("FlowGraphSquareRootBlock"),"math/cbrt":zB("FlowGraphCubeRootBlock"),"math/pow":zB("FlowGraphPowerBlock",["a","b"]),"math/length":zB("FlowGraphLengthBlock"),"math/normalize":zB("FlowGraphNormalizeBlock"),"math/dot":zB("FlowGraphDotBlock",["a","b"]),"math/cross":zB("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":zB("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":zB("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{pD:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{pD:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{pD:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{pD:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{pD:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{pD:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{pD:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":zB("FlowGraphTransposeBlock"),"math/determinant":zB("FlowGraphDeterminantBlock"),"math/inverse":zB("FlowGraphInvertMatrixBlock"),"math/matmul":zB("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{pD:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ur",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h,y){const N=h[0].dataInputs.find((R=>"rotationQuaternion"===R.name));if(!N)throw new Error("Rotation quaternion input not found");return y._connectionValues[N.uniqueId]&&(y._connectionValues[N.uniqueId].type="Quaternion"),h}},"math/matDecompose":{pD:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ur"}}}},"math/quatConjugate":zB("FlowGraphConjugateBlock",["a"]),"math/quatMul":{pD:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h){var y;return(y=h[0]).config||(y.config={}),h[0].config.type="Quaternion",h}},"math/quatAngleBetween":zB("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{pD:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":zB("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":zB("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{pD:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h){var y;return(y=h[0]).config||(y.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract2x2":{pD:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{pD:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h){var y;return(y=h[0]).config||(y.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract3x3":{pD:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{pD:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h){var y;return(y=h[0]).config||(y.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract4x4":{pD:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{pD:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h,y){var N,r;(r=h[0]).config||(r.config={});const q=h[0].dataInputs[0];return h[0].config.valueType=(null===(N=y._connectionValues[q.uniqueId])||void 0===N?void 0:N.type)??"FlowGraphInteger",h}},"math/and":{pD:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h,y){var N,r,q;(q=h[0]).config||(q.config={});const e=h[0].dataInputs[0],D=h[0].dataInputs[1];return h[0].config.valueType=(null===(N=y._connectionValues[e.uniqueId])||void 0===N?void 0:N.type)??(null===(r=y._connectionValues[D.uniqueId])||void 0===r?void 0:r.type)??"FlowGraphInteger",h}},"math/or":{pD:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h,y){var N,r,q;(q=h[0]).config||(q.config={});const e=h[0].dataInputs[0],D=h[0].dataInputs[1];return h[0].config.valueType=(null===(N=y._connectionValues[e.uniqueId])||void 0===N?void 0:N.type)??(null===(r=y._connectionValues[D.uniqueId])||void 0===r?void 0:r.type)??"FlowGraphInteger",h}},"math/xor":{pD:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,J,B,Q,h,y){var N,r,q;(q=h[0]).config||(q.config={});const e=h[0].dataInputs[0],D=h[0].dataInputs[1];return h[0].config.valueType=(null===(N=y._connectionValues[e.uniqueId])||void 0===N?void 0:N.type)??(null===(r=y._connectionValues[D.uniqueId])||void 0===r?void 0:r.type)??"FlowGraphInteger",h}},"math/asr":zB("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":zB("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":zB("FlowGraphLeadingZerosBlock"),"math/ctz":zB("FlowGraphTrailingZerosBlock"),"math/popcnt":zB("FlowGraphOneBitsCounterBlock"),"math/rad":zB("FlowGraphDegToRadBlock"),"math/deg":zB("FlowGraphRadToDegBlock"),"type/boolToInt":zB("FlowGraphBooleanToInt"),"type/boolToFloat":zB("FlowGraphBooleanToFloat"),"type/intToBool":zB("FlowGraphIntToBoolean"),"type/intToFloat":zB("FlowGraphIntToFloat"),"type/floatToInt":zB("FlowGraphFloatToInt"),"type/floatToBool":zB("FlowGraphFloatToBoolean"),"flow/sequence":{pD:["FlowGraphSequenceBlock"],extraProcessor(R,J,B,Q,h){const y=h[0];return y.config||(y.config={}),y.config.outputSignalCount=Object.keys(R.flows||[]).length,y.signalOutputs.forEach(((R,J)=>{R.name="out_"+J})),h}},"flow/branch":{pD:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{pD:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(R){if(R.configuration&&R.configuration.cases){const J=R.configuration.cases.value;if(!J.every((R=>"number"===typeof R&&/^-?\d+$/.test(R.toString()))))return P.d.Warn("Switch cases should be integers. Using empty array instead."),R.configuration.cases.value=[],{valid:!0};const B=new Set(J);R.configuration.cases.value=Array.from(B)}return{valid:!0}},extraProcessor(R,J,B,Q,h){if("flow/switch"!==J.op||!R.flows||0===Object.keys(R.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return h[0].signalOutputs.forEach((R=>{"default"!==R.name&&(R.name="out_"+R.name)})),h}},"flow/while":{pD:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{pD:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(R,J,B,Q,h){const y=h[0];return y.config||(y.config={}),y.config.incrementIndexWhenLoopDone=!0,h}},"flow/doN":{pD:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{pD:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(R,J,B,Q,h){if("flow/multiGate"!==J.op||!R.flows||0===Object.keys(R.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const y=h[0];return y.config||(y.config={}),y.config.outputSignalCount=Object.keys(R.flows).length,y.signalOutputs.forEach(((R,J)=>{R.name="out_"+J})),h}},"flow/waitAll":{pD:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(R){var J,B;return"number"!==typeof(null===(J=R.configuration)||void 0===J||null===(B=J.inputFlows)||void 0===B?void 0:B.value[0])&&(R.configuration=R.configuration||{inputFlows:{value:[0]}},R.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{pD:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{pD:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{pD:["FlowGraphCancelDelayBlock"]},"variable/get":{pD:["FlowGraphGetVariableBlock"],validation(R){var J,B;return null!==(J=R.configuration)&&void 0!==J&&null!==(B=J.variable)&&void 0!==B&&B.value?{valid:!0}:(P.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(R,J)=>[J.getVariableName(R[0])]}}},"variable/set":{pD:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(R,J)=>[J.getVariableName(R[0])]}}},"variable/setMultiple":{pD:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(R,J)=>[R[0].map((R=>J.getVariableName(R)))]}},extraProcessor:(R,J,B,Q,h)=>(h[0].dataInputs.forEach((R=>{R.name=Q.getVariableName(+R.name)})),h)},"variable/interpolate":{pD:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(R,J)=>[J.getVariableName(R[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:R=>!0===R[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xB:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xB:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xB:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xB:"FlowGraphPlayAnimationBlock"},out:{name:"out",xB:"FlowGraphPlayAnimationBlock"},done:{name:"done",xB:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(R,J,B,Q,h){var y,N,r;const q=h[0],e=null===(y=R.configuration)||void 0===y?void 0:y.variable.value[0];if("number"!==typeof e)throw P.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const D=Q.arrays.staticVariables[e];"undefined"===typeof q.config.animationType.value&&(Q.arrays.staticVariables,q.config.animationType.value=(0,fB.J)(D.type));const l=h[4];return l.config||(l.config={}),(N=l.config).variable||(N.variable={}),l.config.variable.value=Q.getVariableName(e),(r=h[3]).config||(r.config={}),h}},"pointer/get":{pD:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xB:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",xB:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(R,J,B,Q,h)=>(h.forEach((R=>{"FlowGraphJsonPointerParserBlock"===R.className&&(R.config||(R.config={}),R.config.outputValue=!0)})),h)},"pointer/set":{pD:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xB:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",xB:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(R,J,B,Q,h)=>(h.forEach((R=>{"FlowGraphJsonPointerParserBlock"===R.className&&(R.config||(R.config={}),R.config.outputValue=!0)})),h)},"pointer/interpolate":{pD:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",xB:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",xB:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xB:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xB:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xB:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xB:"FlowGraphPlayAnimationBlock"},out:{name:"out",xB:"FlowGraphPlayAnimationBlock"},done:{name:"done",xB:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(R,J,B,Q,h)=>(h.forEach((J=>{"FlowGraphJsonPointerParserBlock"===J.className?(J.config||(J.config={}),J.config.outputValue=!0):"FlowGraphInterpolationBlock"===J.className&&(J.config||(J.config={}),Object.keys(R.values||[]).forEach((B=>{var h;const y=null===(h=R.values)||void 0===h?void 0:h[B];if("value"===B&&y){const R=y.type;void 0!==R&&(J.config.animationType=Q.arrays.types[R].flowGraphType)}})))})),h)},"animation/start":{pD:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xB:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(R,J)=>[R[0]*J._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(R,J)=>[R[0]*J._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(R,J,B,Q,h,y,N){const r=h[h.length-1];return r.config||(r.config={}),r.config.glTF=N,h}},"animation/stop":{pD:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xB:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(R,J,B,Q,h,y,N){const r=h[h.length-1];return r.config||(r.config={}),r.config.glTF=N,h}},"animation/stopAt":{pD:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",xB:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(R,J)=>[R[0]*J._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(R,J,B,Q,h,y,N){const r=h[h.length-1];return r.config||(r.config={}),r.config.glTF=N,h}},"math/switch":{pD:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(R){if(R.configuration&&R.configuration.cases){const J=R.configuration.cases.value;if(!J.every((R=>"number"===typeof R&&/^-?\d+$/.test(R.toString()))))return P.d.Warn("Switch cases should be integers. Using empty array instead."),R.configuration.cases.value=[],{valid:!0};const B=new Set(J);R.configuration.cases.value=Array.from(B)}return{valid:!0}},extraProcessor(R,J,B,Q,h){const y=h[0];return y.dataInputs.forEach((R=>{"default"!==R.name&&"case"!==R.name&&(R.name="in_"+R.name)})),y.config||(y.config={}),y.config.treatCasesAsIntegers=!0,h}},"debug/log":{pD:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function zB(R){let J=arguments.length>2?arguments[2]:void 0;return{pD:[R],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((R,J)=>(R[J]={name:J},R)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(R,B,Q,h,y){var N;if(J){(N=y[0]).config||(N.config={}),y[0].config.preventIntegerFloatArithmetic=!0;let J=-1;Object.keys(R.values||{}).find((B=>{var Q;return void 0!==(null===(Q=R.values)||void 0===Q?void 0:Q[B].type)&&(J=R.values[B].type,!0)})),-1!==J&&(y[0].config.type=h.arrays.types[J].flowGraphType)}return y},validation:R=>J?pB(R):{valid:!0}}}function pB(R){if(R.values){const J=Object.keys(R.values).map((J=>R.values[J].type)).filter((R=>void 0!==R));if(!J.every((R=>R===J[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}cB["math/compose"]=cB["math/matCompose"],cB["math/decompose"]=cB["math/matDecompose"];var iB=B(11148);const WB={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"nJ",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class kB{constructor(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=R,this._gltf=J,this._animationTargetFps=B,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const R of this._interactivityGraph.types)this._types.push(WB[R.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const R of this._interactivityGraph.declarations){const J=HB(R);if(!J)throw P.d.Error(["No mapping found for declaration",R]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:J,fullOperationName:R.extension?R.op+":"+R.extension:R.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const R of this._interactivityGraph.variables){const J=this._parseVariable(R);this._staticVariables.push(J)}}_parseVariable(R,J){const B=this._types[R.type];if(!B)throw P.d.Error(["No type found for variable",R]),new Error("Error parsing variables");if(R.value&&R.value.length!==B.length)throw P.d.Error(["Invalid value length for variable",R,B]),new Error("Error parsing variables");const Q=R.value||[];if(!Q.length)switch(B.flowGraphType){case"boolean":Q.push(!1);break;case"FlowGraphInteger":Q.push(0);break;case"number":Q.push(NaN);break;case"Vector2":Q.push(NaN,NaN);break;case"nJ":Q.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":Q.fill(NaN,0,4);break;case"Matrix":Q.fill(NaN,0,16);break;case"Matrix3D":Q.fill(NaN,0,9)}return"number"===B.elementType&&"string"===typeof Q[0]&&(Q[0]=parseFloat(Q[0])),{type:B.flowGraphType,value:J?J(Q,this):Q}}_parseEvents(){if(this._interactivityGraph.events)for(const R of this._interactivityGraph.events){const J={eventId:R.id||"internalEvent_"+this._internalEventsCounter++};R.values&&(J.eventData=Object.keys(R.values).map((J=>{var B;const Q=null===(B=R.values)||void 0===B?void 0:B[J];if(!Q)throw P.d.Error(["No value found for event key",J]),new Error("Error parsing events");const h=this._types[Q.type];if(!h)throw P.d.Error(["No type found for event value",Q]),new Error("Error parsing events");const y="undefined"!==typeof Q.value?this._parseVariable(Q):void 0;return{id:J,type:h.flowGraphType,eventData:!0,value:y}}))),this._events.push(J)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const J of this._interactivityGraph.nodes){if("number"!==typeof J.declaration)throw P.d.Error(["No declaration found for node",J]),new Error("Error parsing nodes");const B=this._mappings[J.declaration];if(!B)throw P.d.Error(["No mapping found for node",J]),new Error("Error parsing nodes");if(B.flowGraphMapping.validation){const Q=B.flowGraphMapping.validation(J,this._interactivityGraph,this._gltf);var R;if(!Q.valid)throw new Error(`Error validating interactivity node ${null===(R=this._interactivityGraph.declarations)||void 0===R?void 0:R[J.declaration].op} - ${Q.error}`)}const Q=[];for(const R of B.flowGraphMapping.pD){const h=this._getEmptyBlock(R,B.fullOperationName);this._parseNodeConfiguration(J,h,B.flowGraphMapping,R),Q.push(h)}this._nodes.push({pD:Q,fullOperationName:B.fullOperationName})}}_getEmptyBlock(R,J){return{uniqueId:(0,iB.c)(),className:R,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:J,metadata:{}}}_parseNodeConfiguration(R,J,B,Q){const h=J.config;if(R.configuration){const J=Object.keys(R.configuration);for(const r of J){var y,N;const J=null===(y=R.configuration)||void 0===y?void 0:y[r];if(!J)throw P.d.Error(["No value found for node configuration",r]),new Error("Error parsing node configuration");const q=null===(N=B.configuration)||void 0===N?void 0:N[r];if(q&&q.xB?q.xB===Q:0===B.pD.indexOf(Q)){const R=(null===q||void 0===q?void 0:q.name)||r;J&&"undefined"!==typeof J.value||"undefined"===typeof(null===q||void 0===q?void 0:q.defaultValue)?J.value.length>=0?h[R]={value:1===J.value.length?J.value[0]:J.value}:P.d.Warn(["Invalid value for node configuration",J]):h[R]={value:q.defaultValue},q&&q.dataTransformer&&(h[R].value=q.dataTransformer([h[R].value],this)[0])}}}}_parseNodeConnections(R){for(let x=0;x<this._nodes.length;x++){var J;const I=null===(J=this._interactivityGraph.nodes)||void 0===J?void 0:J[x];if(!I)throw P.d.Error(["No node found for interactivity node",this._nodes[x]]),new Error("Error parsing node connections");const V=this._nodes[x],M=this._mappings[I.declaration];if(!M)throw P.d.Error(["No mapping found for node",I]),new Error("Error parsing node connections");const H=I.flows||{},d=Object.keys(H).sort();for(const R of d){var B,Q,h,y;const J=H[R],e=null===(B=M.flowGraphMapping.outputs)||void 0===B||null===(Q=B.flows)||void 0===Q?void 0:Q[R],D=(null===e||void 0===e?void 0:e.name)||R,l=this._createNewSocketConnection(D,!0);(e&&e.xB&&V.pD.find((R=>R.className===e.xB))||V.pD[0]).signalOutputs.push(l);const E=J.node,O=this._nodes[E];if(!O)throw P.d.Error(["No node found for input node id",E]),new Error("Error parsing node connections");const n=MB(O.fullOperationName);if(!n)throw P.d.Error(["No mapping found for input node",O]),new Error("Error parsing node connections");let A=null===(h=n.inputs)||void 0===h||null===(y=h.flows)||void 0===y?void 0:y[J.socket||"in"],u=!1;if(!A)for(const R in null===(N=n.inputs)||void 0===N?void 0:N.flows){var N,r,q;if(R.startsWith("[")&&R.endsWith("]"))u=!0,A=null===(r=n.inputs)||void 0===r||null===(q=r.flows)||void 0===q?void 0:q[R]}const S=A?u?A.name.replace("$1",J.socket||""):A.name:J.socket||"in",f=A&&A.xB&&O.pD.find((R=>R.className===A.xB))||O.pD[0];let a=f.signalInputs.find((R=>R.name===S));a||(a=this._createNewSocketConnection(S),f.signalInputs.push(a)),a.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(a.uniqueId)}const X=I.values||{},c=Object.keys(X);for(const J of c){var e,D;const B=X[J];let Q=null===(e=M.flowGraphMapping.inputs)||void 0===e||null===(D=e.values)||void 0===D?void 0:D[J],h=!1;if(!Q)for(const R in null===(l=M.flowGraphMapping.inputs)||void 0===l?void 0:l.values){var l,E,O;if(R.startsWith("[")&&R.endsWith("]"))h=!0,Q=null===(E=M.flowGraphMapping.inputs)||void 0===E||null===(O=E.values)||void 0===O?void 0:O[R]}const y=Q?h?Q.name.replace("$1",J):Q.name:J,N=this._createNewSocketConnection(y);if((Q&&Q.xB&&V.pD.find((R=>R.className===Q.xB))||V.pD[0]).dataInputs.push(N),void 0!==B.value){const J=this._parseVariable(B,Q&&Q.dataTransformer);R._connectionValues[N.uniqueId]=J}else{if("undefined"===typeof B.node)throw P.d.Error(["Invalid value for value connection",B]),new Error("Error parsing node connections");{var n,A,u;const R=B.node,J=B.socket||"value",Q=this._nodes[R];if(!Q)throw P.d.Error(["No node found for output socket reference",B]),new Error("Error parsing node connections");const h=MB(Q.fullOperationName);if(!h)throw P.d.Error(["No mapping found for output socket reference",B]),new Error("Error parsing node connections");let y=null===(n=h.outputs)||void 0===n||null===(A=n.values)||void 0===A?void 0:A[J],r=!1;if(!y)for(const B in null===(S=h.outputs)||void 0===S?void 0:S.values){var S,f,a;if(B.startsWith("[")&&B.endsWith("]"))r=!0,y=null===(f=h.outputs)||void 0===f||null===(a=f.values)||void 0===a?void 0:a[B]}const q=y?r?y.name.replace("$1",J):null===(u=y)||void 0===u?void 0:u.name:J,e=y&&y.xB&&Q.pD.find((R=>R.className===y.xB))||Q.pD[0];let D=e.dataOutputs.find((R=>R.name===q));D||(D=this._createNewSocketConnection(q,!0),e.dataOutputs.push(D)),N.connectedPointIds.push(D.uniqueId),D.connectedPointIds.push(N.uniqueId)}}}if(M.flowGraphMapping.interBlockConnectors)for(const R of M.flowGraphMapping.interBlockConnectors){const J=R.input,B=R.output,Q=R.isVariable;this._connectFlowGraphNodes(J,B,V.pD[R.inputBlockIndex],V.pD[R.outputBlockIndex],Q)}if(M.flowGraphMapping.extraProcessor){var s;const J=null===(s=this._interactivityGraph.declarations)||void 0===s?void 0:s[I.declaration];if(!J)throw P.d.Error(["No declaration found for extra processor",I]),new Error("Error parsing node connections");V.pD=M.flowGraphMapping.extraProcessor(I,J,M.flowGraphMapping,this,V.pD,R,this._gltf)}}}_createNewSocketConnection(R,J){return{uniqueId:(0,iB.c)(),name:R,_connectionType:J?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(R,J,B,Q,h){const y=h?B.dataInputs:B.signalInputs,N=h?Q.dataOutputs:Q.signalOutputs,r=y.find((J=>J.name===R))||this._createNewSocketConnection(R),q=N.find((R=>R.name===J))||this._createNewSocketConnection(J,!0);y.find((J=>J.name===R))||y.push(r),N.find((R=>R.name===J))||N.push(q),r.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(r.uniqueId)}getVariableName(R){return"staticVariable_"+R}serializeToFlowGraph(){const R={uniqueId:(0,iB.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(R);for(let J=0;J<this._staticVariables.length;J++){const B=this._staticVariables[J];R._userVariables[this.getVariableName(J)]=B}return{rightHanded:!0,allBlocks:this._nodes.reduce(((R,J)=>R.concat(J.pD)),[]),executionContexts:[R]}}}const YB="KHR_interactivity";class GB{constructor(R){this._loader=R,this.name=YB,this.enabled=this._loader.isExtensionUsed(YB),this._pathConverter=(0,g.g)(this._loader.xh),R._skipStartAnimationStep=!0;const J=R.babylonScene;J&&function(R){(0,g.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!R.activeCamera)return new h.Quaternion(NaN,NaN,NaN,NaN);const J=h.Quaternion.FromRotationMatrix(R.activeCamera.getWorldMatrix()).normalize();return R.useRightHandedSystem||(J.w*=-1,J.x*=-1),J},type:"Quaternion",getTarget:()=>R.activeCamera}),(0,g.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!R.activeCamera)return new h.nJ(NaN,NaN,NaN);const J=R.activeCamera.getWorldMatrix().getTranslation();return R.useRightHandedSystem||(J.x*=-1),J},type:"nJ",getTarget:()=>R.activeCamera}),(0,g.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:R=>{var J;return(null===(J=R._babylonAnimationGroup)||void 0===J?void 0:J.isPlaying)??!1},type:"boolean",getTarget:R=>R._babylonAnimationGroup}),(0,g.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:R=>{var J;return((null===(J=R._babylonAnimationGroup)||void 0===J?void 0:J.from)??0)/60},type:"number",getTarget:R=>R._babylonAnimationGroup}),(0,g.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:R=>{var J;return((null===(J=R._babylonAnimationGroup)||void 0===J?void 0:J.to)??0)/60},type:"number",getTarget:R=>R._babylonAnimationGroup}),(0,g.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:R=>{var J;return((null===(J=R._babylonAnimationGroup)||void 0===J?void 0:J.getCurrentFrame())??0)/60},type:"number",getTarget:R=>R._babylonAnimationGroup}),(0,g.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:R=>{var J;return((null===(J=R._babylonAnimationGroup)||void 0===J?void 0:J.getCurrentFrame())??0)/60},type:"number",getTarget:R=>R._babylonAnimationGroup})}(J)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var R;if(!this._loader.babylonScene||!this._pathConverter)return;const J=this._loader.babylonScene,B=null===(R=this._loader.xh.extensions)||void 0===R?void 0:R.KHR_interactivity;if(!B)return;const Q=new nB.c({AJ:J});Q.dispatchEventsSynchronously=!1;const h=B.graphs.map((R=>new kB(R,this._loader.xh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(h.map((async R=>await xB(R,{coordinator:Q,pathConverter:this._pathConverter})))),Q.start()}}var gB;gB=async()=>(await Promise.resolve().then(B.bind(B,12954))).FlowGraphGLTFDataProvider,PB[`${YB}/${"FlowGraphGLTFDataProvider"}`]=gB,G(YB),Y(YB,!0,(R=>new GB(R)));const LB="KHR_node_visibility";(0,g.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:R=>{const J=R._babylonTransformNode;return!J||void 0===J.isVisible||J.isVisible},set:(R,J)=>{var B,Q;null===(B=J._primitiveBabylonMeshes)||void 0===B||B.forEach((R=>{R.inheritVisibility=!0})),J._babylonTransformNode&&(J._babylonTransformNode.isVisible=R),null===(Q=J._primitiveBabylonMeshes)||void 0===Q||Q.forEach((J=>{J.isVisible=R}))},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class jB{constructor(R){this.name=LB,this._loader=R,this.enabled=R.isExtensionUsed(LB)}async onReady(){var R;null===(R=this._loader.xh.nodes)||void 0===R||R.forEach((R=>{var J,B,Q,h;(null===(J=R._primitiveBabylonMeshes)||void 0===J||J.forEach((R=>{R.inheritVisibility=!0})),null!==(B=R.extensions)&&void 0!==B&&B.KHR_node_visibility)&&(!1===(null===(Q=R.extensions)||void 0===Q?void 0:Q.KHR_node_visibility.visible)&&(R._babylonTransformNode&&(R._babylonTransformNode.isVisible=!1),null===(h=R._primitiveBabylonMeshes)||void 0===h||h.forEach((R=>{R.isVisible=!1}))))}))}dispose(){this._loader=null}}G(LB),Y(LB,!0,(R=>new jB(R)));const TB="KHR_node_selectability";dB("event/onSelect",TB,{pD:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xB:"FlowGraphGetVariableBlock",dataTransformer:R=>["pickedMesh_"+R[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",xB:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(R,J,B,Q,h,y,N){var r,q,e,D,l,E;const O=h[h.length-1];O.config=O.config||{},O.config.glTF=N;const n=null===(r=R.configuration)||void 0===r||null===(q=r.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===n||"number"!==typeof n)throw new Error("nodeIndex not found in configuration");const P="pickedMesh_"+n;return h[1].config.variable=P,y._userVariables[P]={className:"Mesh",id:null===N||void 0===N||null===(e=N.nodes)||void 0===e||null===(D=e[n]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===N||void 0===N||null===(l=N.nodes)||void 0===l||null===(E=l[n]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},h}}),(0,g.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:R=>{const J=R._babylonTransformNode;return!J||void 0===J.gq||J.gq},set:(R,J)=>{var B;null===(B=J._primitiveBabylonMeshes)||void 0===B||B.forEach((J=>{J.gq=R}))},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"gq"],type:"boolean"});class FB{constructor(R){this.name=TB,this._loader=R,this.enabled=R.isExtensionUsed(TB)}async onReady(){var R;null===(R=this._loader.xh.nodes)||void 0===R||R.forEach((R=>{var J,B,Q;null!==(J=R.extensions)&&void 0!==J&&J.KHR_node_selectability&&!1===(null===(B=R.extensions)||void 0===B?void 0:B.KHR_node_selectability.selectable)&&(null===(Q=R._babylonTransformNode)||void 0===Q||Q.getChildMeshes().forEach((R=>{R.gq=!1})))}))}dispose(){this._loader=null}}G(TB),Y(TB,!0,(R=>new FB(R)));const CB="KHR_node_hoverability",bB="targetMeshPointerOver_";dB("event/onHoverIn",CB,{pD:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xB:"FlowGraphGetVariableBlock",dataTransformer:R=>[bB+R[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xB:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(R,J,B,Q,h,y,N){var r,q,e,D,l,E;const O=h[h.length-1];O.config=O.config||{},O.config.glTF=N;const n=null===(r=R.configuration)||void 0===r||null===(q=r.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===n||"number"!==typeof n)throw new Error("nodeIndex not found in configuration");const P=bB+n;return h[1].config.variable=P,y._userVariables[P]={className:"Mesh",id:null===N||void 0===N||null===(e=N.nodes)||void 0===e||null===(D=e[n]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===N||void 0===N||null===(l=N.nodes)||void 0===l||null===(E=l[n]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},h}});const wB="targetMeshPointerOut_";dB("event/onHoverOut",CB,{pD:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xB:"FlowGraphGetVariableBlock",dataTransformer:R=>[wB+R[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xB:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(R,J,B,Q,h,y,N){var r,q,e,D,l,E;const O=h[h.length-1];O.config=O.config||{},O.config.glTF=N;const n=null===(r=R.configuration)||void 0===r||null===(q=r.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===n||"number"!==typeof n)throw new Error("nodeIndex not found in configuration");const P=wB+n;return h[1].config.variable=P,y._userVariables[P]={className:"Mesh",id:null===N||void 0===N||null===(e=N.nodes)||void 0===e||null===(D=e[n]._babylonTransformNode)||void 0===D?void 0:D.id,uniqueId:null===N||void 0===N||null===(l=N.nodes)||void 0===l||null===(E=l[n]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},h}}),(0,g.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:R=>{const J=R._babylonTransformNode;return!J||void 0===J.pointerOverDisableMeshTesting||J.pointerOverDisableMeshTesting},set:(R,J)=>{var B;null===(B=J._primitiveBabylonMeshes)||void 0===B||B.forEach((J=>{J.pointerOverDisableMeshTesting=!R}))},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class KB{constructor(R){this.name=CB,this._loader=R,this.enabled=R.isExtensionUsed(CB)}async onReady(){var R;null===(R=this._loader.xh.nodes)||void 0===R||R.forEach((R=>{var J,B,Q;null!==(J=R.extensions)&&void 0!==J&&J.KHR_node_hoverability&&!1===(null===(B=R.extensions)||void 0===B?void 0:B.KHR_node_hoverability.hoverable)&&(null===(Q=R._babylonTransformNode)||void 0===Q||Q.getChildMeshes().forEach((R=>{R.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}G(CB),Y(CB,!0,(R=>new KB(R)));const vB="ExtrasAsMetadata";class mB{_assignExtras(R,J){if(J.extras&&Object.keys(J.extras).length>0){const B=R.metadata=R.metadata||{};(B.xh=B.xh||{}).extras=J.extras}}constructor(R){this.name=vB,this.enabled=!0,this._loader=R}dispose(){this._loader=null}loadNodeAsync(R,J,B){return this._loader.loadNodeAsync(R,J,(R=>{this._assignExtras(R,J),B(R)}))}loadCameraAsync(R,J,B){return this._loader.loadCameraAsync(R,J,(R=>{this._assignExtras(R,J),B(R)}))}createMaterial(R,J,B){const Q=this._loader.createMaterial(R,J,B);return this._assignExtras(Q,J),Q}}G(vB),Y(vB,!1,(R=>new mB(R)));B(12954)},12828:(R,J,B)=>{"use strict";B.d(J,{c:()=>p,d:()=>M,e:()=>V,h:()=>H});var Q=B(11032),h=B(11030),y=B(12458),N=B(11628),r=B(11595),q=B(11604),e=B(11043),D=B(11065),l=B(11624),E=B(11733),O=B(11634),n=B(11221);class P{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.OE=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.vE=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(R){this._environmentTexture=R}getNodes(){let R=[];R=R.concat(this.meshes),R=R.concat(this.lights),R=R.concat(this.cameras),R=R.concat(this.transformNodes);for(const J of this.skeletons)R=R.concat(J.bones);return R}}class A extends P{}class u{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const R=this.rootNodes;for(const Q of R)Q.dispose();R.length=0;const J=this.skeletons;for(const Q of J)Q.dispose();J.length=0;const B=this.animationGroups;for(const Q of B)Q.dispose();B.length=0}}class S extends P{constructor(R){super(),this._wasAddedToScene=!1,(R=R||D.e.LastCreatedScene)&&(this.AJ=R,this.proceduralTextures=[],R.eh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=R.getEngine().onContextRestoredObservable.add((()=>{for(const R of this.geometries)R._rebuild();for(const R of this.meshes)R._rebuild();for(const R of this.OE)R.rebuild();for(const R of this.textures)R._rebuild()})))}_topologicalSort(R){const J=new Map;for(const N of R)J.set(N.uniqueId,N);const B={dependsOn:new Map,dependedBy:new Map};for(const N of R){const R=N.uniqueId;B.dependsOn.set(R,new Set),B.dependedBy.set(R,new Set)}for(const N of R){const R=N.uniqueId,Q=B.dependsOn.get(R);if(N instanceof l.c){const h=N.sourceMesh;J.has(h.uniqueId)&&(Q.add(h.uniqueId),B.dependedBy.get(h.uniqueId).add(R))}const h=B.dependedBy.get(R);for(const y of N.getDescendants()){const Q=y.uniqueId;if(J.has(Q)){h.add(Q);B.dependsOn.get(Q).add(R)}}}const Q=[],h=[];for(const N of R){const R=N.uniqueId;0===B.dependsOn.get(R).size&&(h.push(N),J.delete(R))}const y=h;for(;y.length>0;){const R=y.shift();Q.push(R);const h=B.dependedBy.get(R.uniqueId);for(const Q of Array.from(h.values())){const h=B.dependsOn.get(Q);h.delete(R.uniqueId),0===h.size&&J.get(Q)&&(y.push(J.get(Q)),J.delete(Q))}}return J.size>0&&(e.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),J.forEach((R=>{e.d.Error(R.name)}))),Q}_addNodeAndDescendantsToList(R,J,B,Q){if(B&&(!Q||Q(B))&&!J.has(B.uniqueId)){R.push(B),J.add(B.uniqueId);for(const h of B.getDescendants(!0))this._addNodeAndDescendantsToList(R,J,h,Q)}}_isNodeInContainer(R){return R instanceof q.d&&-1!==this.meshes.indexOf(R)||(R instanceof r.e&&-1!==this.transformNodes.indexOf(R)||(R instanceof E.e&&-1!==this.lights.indexOf(R)||R instanceof O.d&&-1!==this.cameras.indexOf(R)))}_isValidHierarchy(){for(const R of this.meshes)if(R.parent&&!this._isNodeInContainer(R.parent))return e.d.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.transformNodes)if(R.parent&&!this._isNodeInContainer(R.parent))return e.d.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.lights)if(R.parent&&!this._isNodeInContainer(R.parent))return e.d.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.cameras)if(R.parent&&!this._isNodeInContainer(R.parent))return e.d.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const Q={},y={},r=new u,q=[],e=[],D={doNotInstantiate:!0,...B},l=[],E=new Set;for(const h of this.transformNodes)null===h.parent&&this._addNodeAndDescendantsToList(l,E,h,D.predicate);for(const h of this.meshes)null===h.parent&&this._addNodeAndDescendantsToList(l,E,h,D.predicate);const O=this._topologicalSort(l),n=(B,h)=>{if(((J,B)=>{if(Q[J.uniqueId]=B.uniqueId,y[B.uniqueId]=B,R&&(B.name=R(J.name)),B instanceof N.e){const R=B;if(R.morphTargetManager){const B=J.morphTargetManager;R.morphTargetManager=B.clone();for(let J=0;J<B.numTargets;J++){const h=B.getTarget(J),N=R.morphTargetManager.getTarget(J);Q[h.uniqueId]=N.uniqueId,y[N.uniqueId]=N}}}})(B,h),B.parent){const R=Q[B.parent.uniqueId],J=y[R];h.parent=J||B.parent}if(h.position&&B.position&&h.position.h(B.position),h.rotationQuaternion&&B.rotationQuaternion&&h.rotationQuaternion.h(B.rotationQuaternion),h.rotation&&B.rotation&&h.rotation.h(B.rotation),h.ur&&B.ur&&h.ur.h(B.ur),h.material){const N=h;if(N.material)if(J){const J=B.material;if(-1===e.indexOf(J)){let B=J.clone(R?R(J.name):"Clone of "+J.name);if(e.push(J),Q[J.uniqueId]=B.uniqueId,y[B.uniqueId]=B,"MultiMaterial"===J.getClassName()){const h=J;for(const J of h.sr)J&&(B=J.clone(R?R(J.name):"Clone of "+J.name),e.push(J),Q[J.uniqueId]=B.uniqueId,y[B.uniqueId]=B);h.sr=h.sr.map((R=>R&&y[Q[R.uniqueId]]))}}"InstancedMesh"!==N.getClassName()&&(N.material=y[Q[J.uniqueId]])}else"MultiMaterial"===N.material.getClassName()?-1===this.AJ.multiMaterials.indexOf(N.material)&&this.AJ.addMultiMaterial(N.material):-1===this.AJ.materials.indexOf(N.material)&&this.AJ.addMaterial(N.material)}null===h.parent&&r.rootNodes.push(h)};for(const h of O)if("InstancedMesh"===h.getClassName()){const R=h,J=R.sourceMesh,B=Q[J.uniqueId];n(R,("number"===typeof B?y[B]:J).createInstance(R.name))}else{let R=!0;"De"===h.getClassName()||"Node"===h.getClassName()||h.skeleton||!h.getTotalVertices||0===h.getTotalVertices()?R=!1:D.doNotInstantiate&&(R="function"===typeof D.doNotInstantiate?!D.doNotInstantiate(h):!D.doNotInstantiate);const J=R?h.createInstance(`instance of ${h.name}`):h.clone(`Clone of ${h.name}`,null,!0);if(!J)throw new Error(`Could not clone or instantiate node on Asset Container ${h.name}`);n(h,J)}for(const h of this.skeletons){if(D.predicate&&!D.predicate(h))continue;const J=h.clone(R?R(h.name):"Clone of "+h.name);for(const R of this.meshes)if(R.skeleton===h&&!R.isAnInstance){const B=y[Q[R.uniqueId]];if(!B||B.isAnInstance)continue;if(B.skeleton=J,-1!==q.indexOf(J))continue;q.push(J);for(const R of J.bones)R._linkedTransformNode&&(R._linkedTransformNode=y[Q[R._linkedTransformNode.uniqueId]])}r.skeletons.push(J)}for(const h of this.animationGroups){if(D.predicate&&!D.predicate(h))continue;const J=h.clone(R?R(h.name):"Clone of "+h.name,(R=>y[Q[R.uniqueId]]||R));r.animationGroups.push(J)}return r}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.AJ.environmentTexture=this.environmentTexture);for(const R of this.AJ._serializableComponents)R.addFromContainer(this);this.AJ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const J=[];for(const B of this.cameras)R&&!R(B)||(this.AJ.addCamera(B),J.push(B));for(const B of this.lights)R&&!R(B)||(this.AJ.addLight(B),J.push(B));for(const B of this.meshes)R&&!R(B)||(this.AJ.fD(B),J.push(B));for(const B of this.skeletons)R&&!R(B)||this.AJ.addSkeleton(B);for(const B of this.animations)R&&!R(B)||this.AJ.addAnimation(B);for(const B of this.animationGroups)R&&!R(B)||this.AJ.addAnimationGroup(B);for(const B of this.multiMaterials)R&&!R(B)||this.AJ.addMultiMaterial(B);for(const B of this.materials)R&&!R(B)||this.AJ.addMaterial(B);for(const B of this.morphTargetManagers)R&&!R(B)||this.AJ.addMorphTargetManager(B);for(const B of this.geometries)R&&!R(B)||this.AJ.addGeometry(B);for(const B of this.transformNodes)R&&!R(B)||(this.AJ.addTransformNode(B),J.push(B));for(const B of this.actionManagers)R&&!R(B)||this.AJ.addActionManager(B);for(const B of this.textures)R&&!R(B)||this.AJ.addTexture(B);for(const B of this.reflectionProbes)R&&!R(B)||this.AJ.addReflectionProbe(B);for(const B of J)B.parent&&-1===this.AJ.getNodes().indexOf(B.parent)&&(B.setParent?B.setParent(null):B.parent=null)}removeAllFromScene(){this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.AJ.environmentTexture&&(this.AJ.environmentTexture=null);for(const R of this.AJ._serializableComponents)R.removeFromContainer(this)}removeFromScene(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const J of this.cameras)R&&!R(J)||this.AJ.removeCamera(J);for(const J of this.lights)R&&!R(J)||this.AJ.removeLight(J);for(const J of this.meshes)R&&!R(J)||this.AJ.SD(J,!0);for(const J of this.skeletons)R&&!R(J)||this.AJ.removeSkeleton(J);for(const J of this.animations)R&&!R(J)||this.AJ.removeAnimation(J);for(const J of this.animationGroups)R&&!R(J)||this.AJ.removeAnimationGroup(J);for(const J of this.multiMaterials)R&&!R(J)||this.AJ.removeMultiMaterial(J);for(const J of this.materials)R&&!R(J)||this.AJ.removeMaterial(J);for(const J of this.morphTargetManagers)R&&!R(J)||this.AJ.removeMorphTargetManager(J);for(const J of this.geometries)R&&!R(J)||this.AJ.removeGeometry(J);for(const J of this.transformNodes)R&&!R(J)||this.AJ.removeTransformNode(J);for(const J of this.actionManagers)R&&!R(J)||this.AJ.removeActionManager(J);for(const J of this.textures)R&&!R(J)||this.AJ.removeTexture(J);for(const J of this.reflectionProbes)R&&!R(J)||this.AJ.removeReflectionProbe(J)}dispose(){const R=this.cameras.slice(0);for(const O of R)O.dispose();this.cameras.length=0;const J=this.lights.slice(0);for(const O of J)O.dispose();this.lights.length=0;const B=this.meshes.slice(0);for(const O of B)O.dispose();this.meshes.length=0;const Q=this.skeletons.slice(0);for(const O of Q)O.dispose();this.skeletons.length=0;const h=this.animationGroups.slice(0);for(const O of h)O.dispose();this.animationGroups.length=0;const y=this.multiMaterials.slice(0);for(const O of y)O.dispose();this.multiMaterials.length=0;const N=this.materials.slice(0);for(const O of N)O.dispose();this.materials.length=0;const r=this.geometries.slice(0);for(const O of r)O.dispose();this.geometries.length=0;const q=this.transformNodes.slice(0);for(const O of q)O.dispose();this.transformNodes.length=0;const e=this.actionManagers.slice(0);for(const O of e)O.dispose();this.actionManagers.length=0;const D=this.textures.slice(0);for(const O of D)O.dispose();this.textures.length=0;const l=this.reflectionProbes.slice(0);for(const O of l)O.dispose();this.reflectionProbes.length=0;const E=this.morphTargetManagers.slice(0);for(const O of E)O.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const O of this.AJ._serializableComponents)O.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.AJ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(R,J,B){if(R&&J)for(const Q of R){let R=!0;if(B)for(const J of B)if(Q===J){R=!1;break}R&&(J.push(Q),Q._parentContainer=this)}}moveAllFromScene(R){this._wasAddedToScene=!1,void 0===R&&(R=new A);for(const J in this)Object.prototype.hasOwnProperty.call(this,J)&&(this[J]=this[J]||("_environmentTexture"===J?null:[]),this._moveAssets(this.AJ[J],this[J],R[J]));this.environmentTexture=this.AJ.environmentTexture,this.removeAllFromScene()}createRootMesh(){const R=new N.e("assetContainerRootMesh",this.AJ);for(const J of this.meshes)J.parent||R.addChild(J);return this.meshes.unshift(R),R}mergeAnimationsTo(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.e.LastCreatedScene,J=arguments.length>1?arguments[1]:void 0,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!R)return e.d.Error("No scene available to merge animations to"),[];const Q=B||(J=>{let B=null;const Q=J.animations.length?J.animations[0].targetProperty:"",h=J.name.split(".").join("").split("_primitive")[0];switch(Q){case"position":case"rotationQuaternion":B=R.getTransformNodeByName(J.name)||R.getTransformNodeByName(h);break;case"influence":B=R.getMorphTargetByName(J.name)||R.getMorphTargetByName(h);break;default:B=R.getNodeByName(J.name)||R.getNodeByName(h)}return B}),h=this.getNodes();for(const r of h){const R=Q(r);if(null!==R){for(const J of r.animations){const B=R.animations.filter((R=>R.targetProperty===J.targetProperty));for(const J of B){const B=R.animations.indexOf(J,0);B>-1&&R.animations.splice(B,1)}}R.animations=R.animations.concat(r.animations)}}const y=[],N=this.animationGroups.slice();for(const r of N){y.push(r.clone(r.name,Q));for(const R of r.animatables)R.stop()}for(const r of J){const J=Q(r.target);J&&(R.beginAnimation(J,r.fromFrame,r.toFrame,r.loopAnimation,r.speedRatio,r.onAnimationEnd?r.onAnimationEnd:void 0,void 0,!0,void 0,r.onAnimationLoop?r.onAnimationLoop:void 0),R.stopAnimation(r.target))}return y}populateRootNodes(){this.rootNodes.length=0;for(const R of this.meshes)R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R);for(const R of this.transformNodes)R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R);for(const R of this.lights)R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R);for(const R of this.cameras)R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)}addAllAssetsToContainer(R){if(!R)return;const J=[],B=new Set;for(J.push(R);J.length>0;){const R=J.pop();if(R instanceof N.e?(R.py&&-1===this.geometries.indexOf(R.py)&&this.geometries.push(R.py),this.meshes.push(R)):R instanceof l.c?this.meshes.push(R):R instanceof r.e?this.transformNodes.push(R):R instanceof E.e?this.lights.push(R):R instanceof O.d&&this.cameras.push(R),R instanceof q.d){if(R.material&&-1===this.materials.indexOf(R.material)){this.materials.push(R.material);for(const J of R.material.getActiveTextures())-1===this.textures.indexOf(J)&&this.textures.push(J)}R.skeleton&&-1===this.skeletons.indexOf(R.skeleton)&&this.skeletons.push(R.skeleton),R.morphTargetManager&&-1===this.morphTargetManagers.indexOf(R.morphTargetManager)&&this.morphTargetManagers.push(R.morphTargetManager)}for(const Q of R.getChildren())B.has(Q)||J.push(Q);B.add(R)}this.populateRootNodes()}_getByTags(R,J,B){if(void 0===J)return R;const Q=[];for(const h in R){const y=R[h];n.d&&n.d.MatchesQuery(y,J)&&(!B||B(y))&&Q.push(y)}return Q}getMeshesByTags(R,J){return this._getByTags(this.meshes,R,J)}getCamerasByTags(R,J){return this._getByTags(this.cameras,R,J)}getLightsByTags(R,J){return this._getByTags(this.lights,R,J)}getMaterialsByTags(R,J){return this._getByTags(this.materials,R,J).concat(this._getByTags(this.multiMaterials,R,J))}getTransformNodesByTags(R,J){return this._getByTags(this.transformNodes,R,J)}}var f=B(11079);class a{constructor(R){this.byteOffset=0,this.buffer=R}async loadAsync(R){const J=await this.buffer.readAsync(this.byteOffset,R);this._dataView=new DataView(J.buffer,J.byteOffset,J.byteLength),this._dataByteOffset=0}readUint32(){const R=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,R}readUint8Array(R){const J=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,R);return this._dataByteOffset+=R,this.byteOffset+=R,J}readString(R){return(0,f.i)(this.readUint8Array(R))}skipBytes(R){this._dataByteOffset+=R,this.byteOffset+=R}}var s=B(12833);const x="Z2xURg",I={name:"xh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:R=>-1!==R.indexOf("asset")&&-1!==R.indexOf("version")||R.startsWith("data:base64,"+x)||R.startsWith("data:;base64,"+x)||R.startsWith("data:application/octet-stream;base64,"+x)||R.startsWith("data:model/gltf-binary;base64,"+x)};var V,M,H,d=B(11073),X=B(11077);function c(R,J,B){try{return Promise.resolve(new Uint8Array(R,J,B))}catch(Q){return Promise.reject(Q)}}!function(R){R[R.AUTO=0]="AUTO",R[R.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(V||(V={})),function(R){R[R.NONE=0]="NONE",R[R.FIRST=1]="FIRST",R[R.ALL=2]="ALL"}(M||(M={})),function(R){R[R.LOADING=0]="LOADING",R[R.READY=1]="READY",R[R.COMPLETE=2]="COMPLETE"}(H||(H={}));class z{constructor(){this.coordinateSystemMode=V.AUTO,this.animationStartMode=M.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=R=>Promise.resolve(R),this.extensionOptions={}}h(R){R&&(this.onParsed=R.onParsed,this.coordinateSystemMode=R.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=R.animationStartMode??this.animationStartMode,this.loadNodeAnimations=R.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=R.loadSkins??this.loadSkins,this.loadMorphTargets=R.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=R.compileMaterials??this.compileMaterials,this.useClipPlane=R.useClipPlane??this.useClipPlane,this.compileShadowGenerators=R.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=R.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=R.useRangeRequests??this.useRangeRequests,this.createInstances=R.createInstances??this.createInstances,this.alwaysComputeBoundingBox=R.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=R.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=R.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=R.skipMaterials??this.skipMaterials,this.useSRGBBuffers=R.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=R.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=R.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=R.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=R.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=R.customRootNode,this.onMeshLoaded=R.onMeshLoaded,this.onSkinLoaded=R.onSkinLoaded,this.onTextureLoaded=R.onTextureLoaded,this.onMaterialLoaded=R.onMaterialLoaded,this.onCameraLoaded=R.onCameraLoaded,this.extensionOptions=R.extensionOptions??this.extensionOptions)}}class p extends z{constructor(R){super(),this.onParsedObservable=new Q.e,this.onMeshLoadedObservable=new Q.e,this.onSkinLoadedObservable=new Q.e,this.onTextureLoadedObservable=new Q.e,this.onMaterialLoadedObservable=new Q.e,this.onCameraLoadedObservable=new Q.e,this.onCompleteObservable=new Q.e,this.onErrorObservable=new Q.e,this.eh=new Q.e,this.onExtensionLoadedObservable=new Q.e,this.validate=!1,this.onValidatedObservable=new Q.e,this._loader=null,this._state=null,this._requests=new Array,this.name=I.name,this.extensions=I.extensions,this.onLoaderStateChangedObservable=new Q.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.h(R)}set onParsed(R){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),R&&(this._onParsedObserver=this.onParsedObservable.add(R))}set onMeshLoaded(R){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),R&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(R))}set onSkinLoaded(R){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),R&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((J=>R(J.node,J.skinnedNode))))}set onTextureLoaded(R){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),R&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(R))}set onMaterialLoaded(R){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),R&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(R))}set onCameraLoaded(R){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),R&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(R))}set onComplete(R){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(R)}set onError(R){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(R)}set onDispose(R){this._onDisposeObserver&&this.eh.remove(this._onDisposeObserver),this._onDisposeObserver=this.eh.add(R)}set onExtensionLoaded(R){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(R)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(R){this._loggingEnabled!==R&&(this._loggingEnabled=R,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(R){this._capturePerformanceCounters!==R&&(this._capturePerformanceCounters=R,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(R){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(R)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const R of this._requests)R.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=R=>Promise.resolve(R),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.eh.notifyObservers(void 0),this.eh.clear()}loadFile(R,J,B,y,N,r,q,D){if(ArrayBuffer.isView(J))return this._loadBinary(R,J,B,y,q,D),null;this._progressCallback=N;const l=J.name||h.Tools.GetFilename(J);if(r){if(this.useRangeRequests){this.validate&&e.d.Warn("glTF validation is not supported when range requests are enabled");const B={abort:()=>{},onCompleteObservable:new Q.e},h={readAsync:(B,Q)=>new Promise(((h,y)=>{this._loadFile(R,J,(R=>{h(new Uint8Array(R))}),!0,(R=>{y(R)}),(R=>{R.setRequestHeader("Range",`bytes=${B}-${B+Q-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new a(h)).then((R=>{B.onCompleteObservable.notifyObservers(B),y(R)}),q?R=>q(void 0,R):void 0),B}return this._loadFile(R,J,(J=>{this._validate(R,new Uint8Array(J,0,J.byteLength),B,l),this._unpackBinaryAsync(new a({readAsync:(R,B)=>c(J,R,B),byteLength:J.byteLength})).then((R=>{y(R)}),q?R=>q(void 0,R):void 0)}),!0,q)}return this._loadFile(R,J,(J=>{try{this._validate(R,J,B,l),y({json:this._parseJson(J)})}catch{q&&q()}}),!1,q)}_loadBinary(R,J,B,Q,h,y){this._validate(R,new Uint8Array(J.buffer,J.byteOffset,J.byteLength),B,y),this._unpackBinaryAsync(new a({readAsync:(R,B)=>function(R,J,B){try{if(J<0||J>=R.byteLength)throw new RangeError("Offset is out of range.");if(J+B>R.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(R.buffer,R.byteOffset+J,B))}catch(Q){return Promise.reject(Q)}}(J,R,B),byteLength:J.byteLength})).then((R=>{Q(R)}),h?R=>h(void 0,R):void 0)}importMeshAsync(R,J,B,Q,h,y){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(B),this.onParsedObservable.clear(),this._log(`Loading ${y||""}`),this._loader=this._getLoader(B),this._loader.importMeshAsync(R,J,null,B,Q,h,y))))}loadAsync(R,J,B,Q,h){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(J),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(J),this._loader.loadAsync(R,J,B,Q,h))))}loadAssetContainerAsync(R,J,B,Q,h){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(J),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(J);const y=new S(R),N=[];this.onMaterialLoadedObservable.add((R=>{N.push(R)}));const r=[];this.onTextureLoadedObservable.add((R=>{r.push(R)}));const q=[];this.onCameraLoadedObservable.add((R=>{q.push(R)}));const e=[];return this.onMeshLoadedObservable.add((R=>{R.morphTargetManager&&e.push(R.morphTargetManager)})),this._loader.importMeshAsync(null,R,y,J,B,Q,h).then((R=>(Array.prototype.push.apply(y.geometries,R.geometries),Array.prototype.push.apply(y.meshes,R.meshes),Array.prototype.push.apply(y.OE,R.OE),Array.prototype.push.apply(y.skeletons,R.skeletons),Array.prototype.push.apply(y.animationGroups,R.animationGroups),Array.prototype.push.apply(y.materials,N),Array.prototype.push.apply(y.textures,r),Array.prototype.push.apply(y.lights,R.lights),Array.prototype.push.apply(y.transformNodes,R.transformNodes),Array.prototype.push.apply(y.cameras,q),Array.prototype.push.apply(y.morphTargetManagers,e),y)))}))}canDirectLoad(R){return I.canDirectLoad(R)}directLoad(R,J){if(J.startsWith("base64,"+x)||J.startsWith(";base64,"+x)||J.startsWith("application/octet-stream;base64,"+x)||J.startsWith("model/gltf-binary;base64,"+x)){const B=(0,d.d)(J);return this._validate(R,new Uint8Array(B,0,B.byteLength)),this._unpackBinaryAsync(new a({readAsync:(R,J)=>c(B,R,J),byteLength:B.byteLength}))}return this._validate(R,J),Promise.resolve({json:this._parseJson(J)})}createPlugin(R){return new p(R[I.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((R,J)=>{this.onCompleteObservable.addOnce((()=>{R()})),this.onErrorObservable.addOnce((R=>{J(R)}))}))}_setState(R){this._state!==R&&(this._state=R,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(H[this._state]))}_loadFile(R,J,B,Q,h,y){const N=R._loadFile(J,B,(R=>{this._onProgress(R,N)}),!0,Q,h,y);return N.onCompleteObservable.add((()=>{N._lengthComputable=!0,N._total=N._loaded})),this._requests.push(N),N}_onProgress(R,J){if(!this._progressCallback)return;J._lengthComputable=R.lengthComputable,J._loaded=R.loaded,J._total=R.total;let B=!0,Q=0,h=0;for(const y of this._requests){if(void 0===y._lengthComputable||void 0===y._loaded||void 0===y._total)return;B=B&&y._lengthComputable,Q+=y._loaded,h+=y._total}this._progressCallback({lengthComputable:B,loaded:Q,total:B?h:0})}_validate(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),s.b.ValidateAsync(J,B,Q,(J=>this.preprocessUrlAsync(B+J).then((J=>R._loadFileAsync(J,void 0,!0,!0).then((R=>new Uint8Array(R,0,R.byteLength))))))).then((R=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(R),this.onValidatedObservable.clear()}),(R=>{this._endPerformanceCounter("Validate JSON"),h.Tools.Warn(`Failed to validate: ${R.message}`),this.onValidatedObservable.clear()})))}_getLoader(R){const J=R.json.asset||{};this._log(`Asset version: ${J.version}`),J.minVersion&&this._log(`Asset minimum version: ${J.minVersion}`),J.generator&&this._log(`Asset generator: ${J.generator}`);const B=p._parseVersion(J.version);if(!B)throw new Error("Invalid version: "+J.version);if(void 0!==J.minVersion){const R=p._parseVersion(J.minVersion);if(!R)throw new Error("Invalid minimum version: "+J.minVersion);if(p._compareVersion(R,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+J.minVersion)}const Q={1:p._CreateGLTF1Loader,2:p._CreateGLTF2Loader}[B.major];if(!Q)throw new Error("Unsupported version: "+J.version);return Q(this)}_parseJson(R){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${R.length}`);const J=JSON.parse(R);return this._endPerformanceCounter("Parse JSON"),J}_unpackBinaryAsync(R){return this._startPerformanceCounter("Unpack Binary"),R.loadAsync(20).then((()=>{const J=R.readUint32();if(1179937895!==J)throw new X.i("Unexpected magic: "+J,X.e.GLTFLoaderUnexpectedMagicError);const B=R.readUint32();this.loggingEnabled&&this._log(`Binary version: ${B}`);const Q=R.readUint32();let h;switch(this.useRangeRequests||Q===R.buffer.byteLength||e.d.Warn(`Length in header does not match actual data length: ${Q} != ${R.buffer.byteLength}`),B){case 1:h=this._unpackBinaryV1Async(R,Q);break;case 2:h=this._unpackBinaryV2Async(R,Q);break;default:throw new Error("Unsupported version: "+B)}return this._endPerformanceCounter("Unpack Binary"),h}))}_unpackBinaryV1Async(R,J){const B=R.readUint32(),Q=R.readUint32();if(0!==Q)throw new Error(`Unexpected content format: ${Q}`);const h=J-R.byteOffset,y={json:this._parseJson(R.readString(B)),bin:null};if(0!==h){const J=R.byteOffset;y.bin={readAsync:(B,Q)=>R.buffer.readAsync(J+B,Q),byteLength:h}}return Promise.resolve(y)}_unpackBinaryV2Async(R,J){const B=1313821514,Q=5130562,h=R.readUint32();if(R.readUint32()!==B)throw new Error("First chunk format is not JSON");return R.byteOffset+h===J?R.loadAsync(h).then((()=>({json:this._parseJson(R.readString(h)),bin:null}))):R.loadAsync(h+8).then((()=>{const y={json:this._parseJson(R.readString(h)),bin:null},N=()=>{const h=R.readUint32();switch(R.readUint32()){case B:throw new Error("Unexpected JSON chunk");case Q:{const J=R.byteOffset;y.bin={readAsync:(B,Q)=>R.buffer.readAsync(J+B,Q),byteLength:h},R.skipBytes(h);break}default:R.skipBytes(h)}return R.byteOffset!==J?R.loadAsync(8).then(N):Promise.resolve(y)};return N()}))}static _parseVersion(R){if("1.0"===R||"1.0.1"===R)return{major:1,minor:0};const J=(R+"").match(/^(\d+)\.(\d+)/);return J?{major:parseInt(J[1]),minor:parseInt(J[2])}:null}static _compareVersion(R,J){return R.major>J.major?1:R.major<J.major?-1:R.minor>J.minor?1:R.minor<J.minor?-1:0}_logOpen(R){this._log(R),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(R){const J=p._logSpaces.substring(0,2*this._logIndentLevel);e.d.Log(`${J}${R}`)}_logDisabled(R){}_startPerformanceCounterEnabled(R){h.Tools.StartPerformanceCounter(R)}_startPerformanceCounterDisabled(R){}_endPerformanceCounterEnabled(R){h.Tools.EndPerformanceCounter(R)}_endPerformanceCounterDisabled(R){}}p.IncrementalLoading=!0,p.HomogeneousCoordinates=!1,p._logSpaces="                                ",(0,y.d)(new p)},12833:(R,J,B)=>{"use strict";B.d(J,{b:()=>N});var Q=B(11030);function h(R,J,B,Q){const h={externalResourceFunction:Q};return B&&(h.uri="file:"===J?B:J+B),ArrayBuffer.isView(R)?GLTFValidator.validateBytes(R,h):GLTFValidator.validateString(R,h)}function y(){const R=[];onmessage=J=>{const B=J.data;switch(B.id){case"init":importScripts(B.url);break;case"validate":h(B.data,B.rootUrl,B.fileName,(J=>new Promise(((B,Q)=>{const h=R.length;R.push({resolve:B,reject:Q}),postMessage({id:"getExternalResource",index:h,uri:J})})))).then((R=>{postMessage({id:"validate.resolve",value:R})}),(R=>{postMessage({id:"validate.reject",reason:R})}));break;case"getExternalResource.resolve":R[B.index].resolve(B.value);break;case"getExternalResource.reject":R[B.index].reject(B.reason)}}}class N{static ValidateAsync(R,J,B,N){return"function"===typeof Worker?new Promise(((r,q)=>{const e=`${h}(${y})()`,D=URL.createObjectURL(new Blob([e],{type:"application/javascript"})),l=new Worker(D),E=R=>{l.removeEventListener("error",E),l.removeEventListener("message",O),q(R)},O=R=>{const J=R.data;switch(J.id){case"getExternalResource":N(J.uri).then((R=>{l.postMessage({id:"getExternalResource.resolve",index:J.index,value:R},[R.buffer])}),(R=>{l.postMessage({id:"getExternalResource.reject",index:J.index,reason:R})}));break;case"validate.resolve":l.removeEventListener("error",E),l.removeEventListener("message",O),r(J.value),l.terminate();break;case"validate.reject":l.removeEventListener("error",E),l.removeEventListener("message",O),q(J.reason),l.terminate()}};if(l.addEventListener("error",E),l.addEventListener("message",O),l.postMessage({id:"init",url:Q.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(R)){const Q=R.slice();l.postMessage({id:"validate",data:Q,rootUrl:J,fileName:B},[Q.buffer])}else l.postMessage({id:"validate",data:R,rootUrl:J,fileName:B})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Q.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>h(R,J,B,N))))}}N.Configuration={url:`${Q.Tools._DefaultCdnUrl}/gltf_validator.js`}},13383:(R,J,B)=>{"use strict";B.d(J,{e:()=>I});var Q=B(11167),h=B(11176),y=B(11217),N=B(11186),r=B(11559),q=B(11495),e=B(11262),D=B(11419),l=B(11142),E=B(11107);B(12583),B(12484),B(12493),B(12487),B(12502),B(12511),B(12513);const O="imageProcessingCompatibility",n="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";E.c.IncludesShadersStore[O]||(E.c.IncludesShadersStore[O]=n);const P="skyPixelShader",A="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";E.c.ShadersStore[P]||(E.c.ShadersStore[P]=A);B(12595),B(12521),B(12527),B(12541),B(12535);const u="skyVertexShader",S="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";E.c.ShadersStore[u]||(E.c.ShadersStore[u]=S);var f=B(11489),a=B(11547),s=B(11539);class x extends r.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class I extends q.d{constructor(R,J){super(R,J),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new N.nJ(0,100,0),this.useSunPosition=!1,this.cameraOffset=N.nJ.Zero(),this.up=N.nJ.Up(),this.dithering=!1,this._cameraPosition=N.nJ.Zero(),this._skyOrientation=new N.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(R,J){const B=J._drawWrapper;if(this.isFrozen&&B.effect&&B._wasPreviouslyReady)return!0;J.materialDefines||(J.materialDefines=new x);const Q=J.materialDefines,h=this.IR();if(this._isReadyForSubMesh(J))return!0;if((0,s.Q)(R,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,Q),(0,s.J)(R,Q,!0,!1),Q.IMAGEPROCESSINGPOSTPROCESS!==h.imageProcessingConfiguration.applyByPostProcess&&Q.markAsMiscDirty(),Q.DITHER!==this.dithering&&Q.markAsMiscDirty(),Q.isDirty){Q.markAsProcessed(),h.resetCachedMaterial();const R=new f.c;Q.FOG&&R.addFallback(1,"FOG"),Q.IMAGEPROCESSINGPOSTPROCESS=h.imageProcessingConfiguration.applyByPostProcess,Q.DITHER=this.dithering;const B=[e.h.PositionKind];Q.VERTEXCOLOR&&B.push(e.h.ColorKind);const y="sky",N=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,a.e)(N);const r=Q.toString();J.setEffect(h.getEngine().createEffect(y,B,N,[],r,R,this.onCompiled,this.onError),Q,this._materialContext)}return!(!J.effect||!J.effect.isReady())&&(Q._renderId=h.getRenderId(),B._wasPreviouslyReady=!0,!0)}bindForSubMesh(R,J,B){const Q=this.IR(),h=B.materialDefines;if(!h)return;const y=B.effect;if(!y)return;this._activeEffect=y,this.bindOnlyWorldMatrix(R),this._activeEffect.setMatrix("viewProjection",Q.getTransformMatrix()),this._mustRebind(Q,y,B)&&((0,a.g)(y,this,Q),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,s.i)(h,y,Q)),Q.fogEnabled&&J.applyFog&&Q.fogMode!==D.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",Q.getViewMatrix()),(0,s.d)(Q,J,this._activeEffect);const r=Q.activeCamera;if(r){const R=r.getWorldMatrix();this._cameraPosition.x=R.m[12],this._cameraPosition.y=R.m[13],this._cameraPosition.z=R.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const R=Math.PI*(this.inclination-.5),J=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(J)*Math.cos(R),this.sunPosition.y=this.distance*Math.sin(-R),this.sunPosition.z=this.distance*Math.sin(J)*Math.cos(R),N.Quaternion.FromUnitVectorsToRef(N.nJ.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(J,this._activeEffect,B)}getAnimatables(){return[]}dispose(R){super.dispose(R)}clone(R){return y.c.Clone((()=>new I(R,this.IR())),this)}serialize(){const R=super.serialize();return R.customType="BABYLON.SkyMaterial",R}getClassName(){return"SkyMaterial"}static Parse(R,J,B){return y.c.Parse((()=>new I(R.name,J)),R,J,B)}}(0,Q.e)([(0,h.N)()],I.prototype,"luminance",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"turbidity",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"rayleigh",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"mieCoefficient",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"mieDirectionalG",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"distance",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"inclination",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"azimuth",void 0),(0,Q.e)([(0,h.L)()],I.prototype,"sunPosition",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"useSunPosition",void 0),(0,Q.e)([(0,h.L)()],I.prototype,"cameraOffset",void 0),(0,Q.e)([(0,h.L)()],I.prototype,"up",void 0),(0,Q.e)([(0,h.N)()],I.prototype,"dithering",void 0),(0,l.h)("BABYLON.SkyMaterial",I)},11887:(R,J,B)=>{"use strict";function Q(R,J){J.headers=R.headers||{},J.statusMessage=R.statusText,J.statusCode=R.status,J.data=R.response}function h(R,J,B){return new Promise((function(h,y){B=B||{};var N,r,q,e=new XMLHttpRequest,D=B.body,l=B.headers||{};for(N in B.timeout&&(e.timeout=B.timeout),e.ontimeout=e.onerror=function(R){R.timeout="timeout"==R.type,y(R)},e.open(R,J.href||J),e.onload=function(){for(q=e.getAllResponseHeaders().trim().split(/[\r\n]+/),Q(e,e);r=q.shift();)r=r.split(": "),e.headers[r.shift().toLowerCase()]=r.join(": ");if((r=e.headers["content-type"])&&~r.indexOf("application/json"))try{e.data=JSON.parse(e.data,B.reviver)}catch(R){return Q(e,R),y(R)}(e.status>=400?y:h)(e)},typeof FormData<"u"&&D instanceof FormData||D&&"object"==typeof D&&(l["content-type"]="application/json",D=JSON.stringify(D)),e.withCredentials=!!B.withCredentials,l)e.setRequestHeader(N,l[N]);e.send(D)}))}B.r(J),B.d(J,{del:()=>q,get:()=>y,patch:()=>r,post:()=>N,put:()=>e,send:()=>h});var y=h.bind(h,"GET"),N=h.bind(h,"POST"),r=h.bind(h,"PATCH"),q=h.bind(h,"DELETE"),e=h.bind(h,"PUT")},13493:(R,J,B)=>{"use strict";B.d(J,{d:()=>l});const Q=.5*(Math.sqrt(3)-1),h=(3-Math.sqrt(3))/6,y=1/3,N=1/6,r=(Math.sqrt(5)-1)/4,q=(5-Math.sqrt(5))/20,e=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),D=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const l=class{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const J="function"==typeof R?R:function(R){let J=0,B=0,Q=0,h=1;const y=function(){let R=4022871197;return function(J){J=J.toString();for(let B=0;B<J.length;B++){R+=J.charCodeAt(B);let Q=.02519603282416938*R;R=Q>>>0,Q-=R,Q*=R,R=Q>>>0,Q-=R,R+=4294967296*Q}return 2.3283064365386963e-10*(R>>>0)}}();J=y(" "),B=y(" "),Q=y(" "),J-=y(R),J<0&&(J+=1);B-=y(R),B<0&&(B+=1);Q-=y(R),Q<0&&(Q+=1);return function(){const R=2091639*J+2.3283064365386963e-10*h;return J=B,B=Q,Q=R-(h=0|R)}}(R);this.p=function(R){const J=new Uint8Array(256);for(let B=0;B<256;B++)J[B]=B;for(let B=0;B<255;B++){const Q=B+~~(R()*(256-B)),h=J[B];J[B]=J[Q],J[Q]=h}return J}(J),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let B=0;B<512;B++)this.perm[B]=this.p[255&B],this.permMod12[B]=this.perm[B]%12}noise2D(R,J){const B=this.permMod12,y=this.perm;let N=0,r=0,q=0;const D=(R+J)*Q,l=Math.floor(R+D),E=Math.floor(J+D),O=(l+E)*h,n=R-(l-O),P=J-(E-O);let A,u;n>P?(A=1,u=0):(A=0,u=1);const S=n-A+h,f=P-u+h,a=n-1+2*h,s=P-1+2*h,x=255&l,I=255&E;let V=.5-n*n-P*P;if(V>=0){const R=3*B[x+y[I]];V*=V,N=V*V*(e[R]*n+e[R+1]*P)}let M=.5-S*S-f*f;if(M>=0){const R=3*B[x+A+y[I+u]];M*=M,r=M*M*(e[R]*S+e[R+1]*f)}let H=.5-a*a-s*s;if(H>=0){const R=3*B[x+1+y[I+1]];H*=H,q=H*H*(e[R]*a+e[R+1]*s)}return 70*(N+r+q)}noise3D(R,J,B){const Q=this.permMod12,h=this.perm;let r,q,D,l;const E=(R+J+B)*y,O=Math.floor(R+E),n=Math.floor(J+E),P=Math.floor(B+E),A=(O+n+P)*N,u=R-(O-A),S=J-(n-A),f=B-(P-A);let a,s,x,I,V,M;u>=S?S>=f?(a=1,s=0,x=0,I=1,V=1,M=0):u>=f?(a=1,s=0,x=0,I=1,V=0,M=1):(a=0,s=0,x=1,I=1,V=0,M=1):S<f?(a=0,s=0,x=1,I=0,V=1,M=1):u<f?(a=0,s=1,x=0,I=0,V=1,M=1):(a=0,s=1,x=0,I=1,V=1,M=0);const H=u-a+N,d=S-s+N,X=f-x+N,c=u-I+2*N,z=S-V+2*N,p=f-M+2*N,i=u-1+.5,W=S-1+.5,k=f-1+.5,Y=255&O,G=255&n,g=255&P;let L=.6-u*u-S*S-f*f;if(L<0)r=0;else{const R=3*Q[Y+h[G+h[g]]];L*=L,r=L*L*(e[R]*u+e[R+1]*S+e[R+2]*f)}let j=.6-H*H-d*d-X*X;if(j<0)q=0;else{const R=3*Q[Y+a+h[G+s+h[g+x]]];j*=j,q=j*j*(e[R]*H+e[R+1]*d+e[R+2]*X)}let T=.6-c*c-z*z-p*p;if(T<0)D=0;else{const R=3*Q[Y+I+h[G+V+h[g+M]]];T*=T,D=T*T*(e[R]*c+e[R+1]*z+e[R+2]*p)}let F=.6-i*i-W*W-k*k;if(F<0)l=0;else{const R=3*Q[Y+1+h[G+1+h[g+1]]];F*=F,l=F*F*(e[R]*i+e[R+1]*W+e[R+2]*k)}return 32*(r+q+D+l)}noise4D(R,J,B,Q){const h=this.perm;let y,N,e,l,E;const O=(R+J+B+Q)*r,n=Math.floor(R+O),P=Math.floor(J+O),A=Math.floor(B+O),u=Math.floor(Q+O),S=(n+P+A+u)*q,f=R-(n-S),a=J-(P-S),s=B-(A-S),x=Q-(u-S);let I=0,V=0,M=0,H=0;f>a?I++:V++,f>s?I++:M++,f>x?I++:H++,a>s?V++:M++,a>x?V++:H++,s>x?M++:H++;const d=I>=3?1:0,X=V>=3?1:0,c=M>=3?1:0,z=H>=3?1:0,p=I>=2?1:0,i=V>=2?1:0,W=M>=2?1:0,k=H>=2?1:0,Y=I>=1?1:0,G=V>=1?1:0,g=M>=1?1:0,L=H>=1?1:0,j=f-d+q,T=a-X+q,F=s-c+q,C=x-z+q,b=f-p+2*q,w=a-i+2*q,K=s-W+2*q,v=x-k+2*q,m=f-Y+3*q,o=a-G+3*q,t=s-g+3*q,Z=x-L+3*q,U=f-1+4*q,RR=a-1+4*q,JR=s-1+4*q,BR=x-1+4*q,QR=255&n,hR=255&P,yR=255&A,NR=255&u;let rR=.6-f*f-a*a-s*s-x*x;if(rR<0)y=0;else{const R=h[QR+h[hR+h[yR+h[NR]]]]%32*4;rR*=rR,y=rR*rR*(D[R]*f+D[R+1]*a+D[R+2]*s+D[R+3]*x)}let qR=.6-j*j-T*T-F*F-C*C;if(qR<0)N=0;else{const R=h[QR+d+h[hR+X+h[yR+c+h[NR+z]]]]%32*4;qR*=qR,N=qR*qR*(D[R]*j+D[R+1]*T+D[R+2]*F+D[R+3]*C)}let eR=.6-b*b-w*w-K*K-v*v;if(eR<0)e=0;else{const R=h[QR+p+h[hR+i+h[yR+W+h[NR+k]]]]%32*4;eR*=eR,e=eR*eR*(D[R]*b+D[R+1]*w+D[R+2]*K+D[R+3]*v)}let DR=.6-m*m-o*o-t*t-Z*Z;if(DR<0)l=0;else{const R=h[QR+Y+h[hR+G+h[yR+g+h[NR+L]]]]%32*4;DR*=DR,l=DR*DR*(D[R]*m+D[R+1]*o+D[R+2]*t+D[R+3]*Z)}let lR=.6-U*U-RR*RR-JR*JR-BR*BR;if(lR<0)E=0;else{const R=h[QR+1+h[hR+1+h[yR+1+h[NR+1]]]]%32*4;lR*=lR,E=lR*lR*(D[R]*U+D[R+1]*RR+D[R+2]*JR+D[R+3]*BR)}return 27*(y+N+e+l+E)}}}}]);