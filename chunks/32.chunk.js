/*! For license information please see apti8u.32.23bffc04.chunk.js.LICENSE.txt */
(self.hbnkweqmycf=self.hbnkweqmycf||[]).push([[32],{13558:(F,P,f)=>{"use strict";var c=f(13563),N=f(13572),q=f(13579);f.g.__TYPEDARRAY_POOL||(f.g.__TYPEDARRAY_POOL={UINT8:N([32,0]),UINT16:N([32,0]),UINT32:N([32,0]),INT8:N([32,0]),INT16:N([32,0]),INT32:N([32,0]),FLOAT:N([32,0]),DOUBLE:N([32,0]),DATA:N([32,0]),UINT8C:N([32,0]),BUFFER:N([32,0])});var H="undefined"!==typeof Uint8ClampedArray,A=f.g.__TYPEDARRAY_POOL;A.UINT8C||(A.UINT8C=N([32,0])),A.BUFFER||(A.BUFFER=N([32,0]));var o=A.DATA,j=A.BUFFER;function i(F){if(F){var P=F.length||F.byteLength,f=c.log2(P);o[f].push(F)}}function u(F){F=c.nextPow2(F);var P=c.log2(F),f=o[P];return f.length>0?f.pop():new ArrayBuffer(F)}function T(F){return new Uint8Array(u(F),0,F)}function Y(F){return new Uint16Array(u(2*F),0,F)}function t(F){return new Uint32Array(u(4*F),0,F)}function C(F){return new Int8Array(u(F),0,F)}function L(F){return new Int16Array(u(2*F),0,F)}function J(F){return new Int32Array(u(4*F),0,F)}function B(F){return new Float32Array(u(4*F),0,F)}function z(F){return new Float64Array(u(8*F),0,F)}function Z(F){return H?new Uint8ClampedArray(u(F),0,F):T(F)}function R(F){return new DataView(u(F),0,F)}P.free=function(F){if(q(F))j[c.log2(F.length)].push(F);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(F)&&(F=F.buffer),!F)return;var P=F.length||F.byteLength,f=0|c.log2(P);o[f].push(F)}},P.freeUint8=P.freeUint16=P.freeUint32=P.freeInt8=P.freeInt16=P.freeInt32=P.freeFloat32=P.freeFloat=P.freeFloat64=P.freeDouble=P.freeUint8Clamped=P.freeDataView=function(F){i(F.buffer)},P.freeArrayBuffer=i,P.freeBuffer=function(F){j[c.log2(F.length)].push(F)},P.malloc=function(F,P){if(void 0===P||"arraybuffer"===P)return u(F);switch(P){case"uint8":return T(F);case"uint16":return Y(F);case"uint32":return t(F);case"int8":return C(F);case"int16":return L(F);case"int32":return J(F);case"float":case"float32":return B(F);case"double":case"float64":return z(F);case"uint8_clamped":return Z(F);case"buffer":throw"Buffer not supported";case"data":case"dataview":return R(F);default:return null}return null},P.mallocArrayBuffer=u,P.mallocUint8=T,P.mallocUint16=Y,P.mallocUint32=t,P.mallocInt8=C,P.mallocInt16=L,P.mallocInt32=J,P.mallocFloat32=P.mallocFloat=B,P.mallocFloat64=P.mallocDouble=z,P.mallocUint8Clamped=Z,P.mallocDataView=R,P.clearCache=function(){for(var F=0;F<32;++F)A.UINT8[F].length=0,A.UINT16[F].length=0,A.UINT32[F].length=0,A.INT8[F].length=0,A.INT16[F].length=0,A.INT32[F].length=0,A.FLOAT[F].length=0,A.DOUBLE[F].length=0,A.UINT8C[F].length=0,o[F].length=0,j[F].length=0}},13656:(F,P,f)=>{F.exports=N;var c=f(12430);function N(F,P){if(!(this instanceof N))return new N(F,P);var f=c.create();c.add(f,F,P),this.base=c.min(c.create(),F,f),this.Zi=c.clone(P),this.max=c.max(c.create(),F,f),this.mag=c.length(this.Zi)}var q=N.prototype;q.width=function(){return this.Zi[0]},q.height=function(){return this.Zi[1]},q.depth=function(){return this.Zi[2]},q.x0=function(){return this.base[0]},q.y0=function(){return this.base[1]},q.z0=function(){return this.base[2]},q.x1=function(){return this.max[0]},q.y1=function(){return this.max[1]},q.z1=function(){return this.max[2]},q.translate=function(F){return c.add(this.max,this.max,F),c.add(this.base,this.base,F),this},q.setPosition=function(F){return c.add(this.max,F,this.Zi),c.k(this.base,F),this},q.expand=function(F){var P=c.create(),f=c.create();return c.max(P,F.max,this.max),c.min(f,F.base,this.base),c.CP(P,P,f),new N(f,P)},q.intersects=function(F){return!(F.base[0]>this.max[0])&&(!(F.base[1]>this.max[1])&&(!(F.base[2]>this.max[2])&&(!(F.max[0]<this.base[0])&&(!(F.max[1]<this.base[1])&&!(F.max[2]<this.base[2])))))},q.touches=function(F){var P=this.union(F);return null!==P&&(0==P.width()||0==P.height()||0==P.depth())},q.union=function(F){if(!this.intersects(F))return null;var P=Math.max(F.base[0],this.base[0]),f=Math.max(F.base[1],this.base[1]),c=Math.max(F.base[2],this.base[2]);return new N([P,f,c],[Math.min(F.max[0],this.max[0])-P,Math.min(F.max[1],this.max[1])-f,Math.min(F.max[2],this.max[2])-c])}},13563:(F,P)=>{"use strict";function f(F){var P=32;return(F&=-F)&&P--,65535&F&&(P-=16),16711935&F&&(P-=8),252645135&F&&(P-=4),858993459&F&&(P-=2),1431655765&F&&(P-=1),P}P.INT_BITS=32,P.INT_MAX=2147483647,P.INT_MIN=-1<<31,P.sign=function(F){return(F>0)-(F<0)},P.abs=function(F){var P=F>>31;return(F^P)-P},P.min=function(F,P){return P^(F^P)&-(F<P)},P.max=function(F,P){return F^(F^P)&-(F<P)},P.isPow2=function(F){return!(F&F-1)&&!!F},P.log2=function(F){var P,f;return P=(F>65535)<<4,P|=f=((F>>>=P)>255)<<3,P|=f=((F>>>=f)>15)<<2,(P|=f=((F>>>=f)>3)<<1)|(F>>>=f)>>1},P.log10=function(F){return F>=1e9?9:F>=1e8?8:F>=1e7?7:F>=1e6?6:F>=1e5?5:F>=1e4?4:F>=1e3?3:F>=100?2:F>=10?1:0},P.popCount=function(F){return 16843009*((F=(858993459&(F-=F>>>1&1431655765))+(F>>>2&858993459))+(F>>>4)&252645135)>>>24},P.countTrailingZeros=f,P.nextPow2=function(F){return F+=0===F,--F,F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,(F|=F>>>16)+1},P.prevPow2=function(F){return F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,(F|=F>>>16)-(F>>>1)},P.parity=function(F){return F^=F>>>16,F^=F>>>8,F^=F>>>4,27030>>>(F&=15)&1};var c=new Array(256);!function(F){for(var P=0;P<256;++P){var f=P,c=P,N=7;for(f>>>=1;f;f>>>=1)c<<=1,c|=1&f,--N;F[P]=c<<N&255}}(c),P.reverse=function(F){return c[255&F]<<24|c[F>>>8&255]<<16|c[F>>>16&255]<<8|c[F>>>24&255]},P.interleave2=function(F,P){return(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F&=65535)|F<<8))|F<<4))|F<<2))|F<<1))|(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P&=65535)|P<<8))|P<<4))|P<<2))|P<<1))<<1},P.deinterleave2=function(F,P){return(F=65535&((F=16711935&((F=252645135&((F=858993459&((F=F>>>P&1431655765)|F>>>1))|F>>>2))|F>>>4))|F>>>16))<<16>>16},P.interleave3=function(F,P,f){return F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2),(F|=(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<1)|(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<2},P.deinterleave3=function(F,P){return(F=1023&((F=4278190335&((F=251719695&((F=3272356035&((F=F>>>P&1227133513)|F>>>2))|F>>>4))|F>>>8))|F>>>16))<<22>>22},P.nextCombination=function(F){var P=F|F-1;return P+1|(~P&-~P)-1>>>f(F)+1}},13551:(F,P,f)=>{"use strict";F.exports=function(F,P,f){switch(arguments.length){case 1:return c=[],j(N=F,N,i,!0),c;case 2:return"function"===typeof P?j(F,F,P,!0):function(F,P){return c=[],j(F,P,i,!1),c}(F,P);case 3:return j(F,P,f,!1);default:throw new Error("box-intersect: Invalid arguments")}var N};var c,N=f(13558),q=f(13586),H=f(13602);function A(F,P){for(var f=0;f<F;++f)if(!(P[f]<=P[f+F]))return!0;return!1}function o(F,P,f,c){for(var N=0,q=0,H=0,o=F.length;H<o;++H){var j=F[H];if(!A(P,j)){for(var i=0;i<2*P;++i)f[N++]=j[i];c[q++]=H}}return q}function j(F,P,f,c){var A=F.length,j=P.length;if(!(A<=0||j<=0)){var i=F[0].length>>>1;if(!(i<=0)){var u,T=N.mallocDouble(2*i*A),Y=N.mallocInt32(A);if((A=o(F,i,T,Y))>0){if(1===i&&c)q.init(A),u=q.sweepComplete(i,f,0,A,T,Y,0,A,T,Y);else{var t=N.mallocDouble(2*i*j),C=N.mallocInt32(j);(j=o(P,i,t,C))>0&&(q.init(A+j),u=1===i?q.sweepBipartite(i,f,0,A,T,Y,0,j,t,C):H(i,f,c,A,T,Y,j,t,C),N.free(t),N.free(C))}N.free(T),N.free(Y)}return u}}}function i(F,P){c.push([F,P])}},13604:(F,P)=>{"use strict";var f="d",c="ax",N="fp",q="es",H="rs",A="re",o="rb",j="bs",i="be",u="bb",T=[f,c,"vv",H,A,o,"ri",j,i,u,"bi"];function Y(F){var P="bruteForce"+(F?"Full":"Partial"),c=[],H=T.slice();F||H.splice(3,0,N);var A=["function "+P+"("+H.join()+"){"];function o(P,N){var H=function(F,P,c){var N="bruteForce"+(F?"Red":"Blue")+(P?"Flip":"")+(c?"Full":""),H=["function ",N,"(",T.join(),"){","var ",q,"=2*",f,";"],A="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",o="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(c?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return F?H.push(A,"Q",":",o):H.push(o,"Q",":",A),c?H.push("if(y1<x0||x1<y0)continue;"):P?H.push("if(y0<=x0||x1<y0)continue;"):H.push("if(y0<x0||x1<y0)continue;"),H.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),P?H.push("yi,xi"):H.push("xi,yi"),H.push(");if(rv!==void 0)return rv;}}}"),{name:N,code:H.join("")}}(P,N,F);c.push(H.code),A.push("return "+H.name+"("+T.join()+");")}A.push("if(re-rs>be-bs){"),F?(o(!0,!1),A.push("}else{"),o(!1,!1)):(A.push("if(fp){"),o(!0,!0),A.push("}else{"),o(!0,!1),A.push("}}else{if(fp){"),o(!1,!0),A.push("}else{"),o(!1,!1),A.push("}")),A.push("}}return "+P);var j=c.join("")+A.join("");return new Function(j)()}P.partial=Y(!1),P.full=Y(!0)},13602:(F,P,f)=>{"use strict";F.exports=function(F,P,f,q,i,Q,K,x,k){!function(F,P){var f=8*N.log2(P+1)*(F+1)|0,q=N.nextPow2(Z*f);y.length<q&&(c.free(y),y=c.mallocInt32(q));var H=N.nextPow2(R*f);O.length<H&&(c.free(O),O=c.mallocDouble(H))}(F,q+K);var I,E=0,r=2*F;d(E++,0,0,q,0,K,f?16:0,-1/0,1/0),f||d(E++,0,0,K,0,q,1,-1/0,1/0);for(;E>0;){var n=(E-=1)*Z,p=y[n],U=y[n+1],e=y[n+2],D=y[n+3],l=y[n+4],W=y[n+5],b=E*R,v=O[b],s=O[b+1],X=1&W,m=!!(16&W),a=i,w=Q,g=x,G=k;if(X&&(a=x,w=k,g=i,G=Q),!(2&W&&U>=(e=L(F,p,U,e,a,w,s)))&&!(4&W&&(U=J(F,p,U,e,a,w,v))>=e)){var h=e-U,S=l-D;if(m){if(F*h*(h+S)<Y){if(void 0!==(I=o.scanComplete(F,p,P,U,e,a,w,D,l,g,G)))return I;continue}}else{if(F*Math.min(h,S)<u){if(void 0!==(I=H(F,p,P,X,U,e,a,w,D,l,g,G)))return I;continue}if(F*h*S<T){if(void 0!==(I=o.scanBipartite(F,p,P,X,U,e,a,w,D,l,g,G)))return I;continue}}var FF=t(F,p,U,e,a,w,v,s);if(U<FF)if(F*(FF-U)<u){if(void 0!==(I=A(F,p+1,P,U,FF,a,w,D,l,g,G)))return I}else if(p===F-2){if(void 0!==(I=X?o.sweepBipartite(F,P,D,l,g,G,U,FF,a,w):o.sweepBipartite(F,P,U,FF,a,w,D,l,g,G)))return I}else d(E++,p+1,U,FF,D,l,X,-1/0,1/0),d(E++,p+1,D,l,U,FF,1^X,-1/0,1/0);if(FF<e){var PF=j(F,p,D,l,g,G),fF=g[r*PF+p],cF=C(F,p,PF,l,g,G,fF);if(cF<l&&d(E++,p,FF,e,cF,l,(4|X)+(m?16:0),fF,s),D<PF&&d(E++,p,FF,e,D,PF,(2|X)+(m?16:0),v,fF),PF+1===cF){if(void 0!==(I=m?V(F,p,P,FF,e,a,w,PF,g,G[PF]):M(F,p,P,X,FF,e,a,w,PF,g,G[PF])))return I}else if(PF<cF){var NF;if(m){if(FF<(NF=B(F,p,FF,e,a,w,fF))){var qF=C(F,p,FF,NF,a,w,fF);if(p===F-2){if(FF<qF&&void 0!==(I=o.sweepComplete(F,P,FF,qF,a,w,PF,cF,g,G)))return I;if(qF<NF&&void 0!==(I=o.sweepBipartite(F,P,qF,NF,a,w,PF,cF,g,G)))return I}else FF<qF&&d(E++,p+1,FF,qF,PF,cF,16,-1/0,1/0),qF<NF&&(d(E++,p+1,qF,NF,PF,cF,0,-1/0,1/0),d(E++,p+1,PF,cF,qF,NF,1,-1/0,1/0))}}else FF<(NF=X?z(F,p,FF,e,a,w,fF):B(F,p,FF,e,a,w,fF))&&(p===F-2?I=X?o.sweepBipartite(F,P,PF,cF,g,G,FF,NF,a,w):o.sweepBipartite(F,P,FF,NF,a,w,PF,cF,g,G):(d(E++,p+1,FF,NF,PF,cF,X,-1/0,1/0),d(E++,p+1,PF,cF,FF,NF,1^X,-1/0,1/0)))}}}}};var c=f(13558),N=f(13563),q=f(13604),H=q.partial,A=q.full,o=f(13586),j=f(13608),i=f(13611),u=128,T=1<<22,Y=1<<22,t=i("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),C=i("lo===p0",["p0"]),L=i("lo<p0",["p0"]),J=i("hi<=p0",["p0"]),B=i("lo<=p0&&p0<=hi",["p0"]),z=i("lo<p0&&p0<=hi",["p0"]),Z=6,R=2,y=c.mallocInt32(1024),O=c.mallocDouble(1024);function d(F,P,f,c,N,q,H,A,o){var j=Z*F;y[j]=P,y[j+1]=f,y[j+2]=c,y[j+3]=N,y[j+4]=q,y[j+5]=H;var i=R*F;O[i]=A,O[i+1]=o}function M(F,P,f,c,N,q,H,A,o,j,i){var u=2*F,T=o*u,Y=j[T+P];F:for(var t=N,C=N*u;t<q;++t,C+=u){var L=H[C+P],J=H[C+P+F];if(!(Y<L||J<Y)&&(!c||Y!==L)){for(var B,z=A[t],Z=P+1;Z<F;++Z){L=H[C+Z],J=H[C+Z+F];var R=j[T+Z],y=j[T+Z+F];if(J<R||y<L)continue F}if(void 0!==(B=c?f(i,z):f(z,i)))return B}}}function V(F,P,f,c,N,q,H,A,o,j){var i=2*F,u=A*i,T=o[u+P];F:for(var Y=c,t=c*i;Y<N;++Y,t+=i){var C=H[Y];if(C!==j){var L=q[t+P],J=q[t+P+F];if(!(T<L||J<T)){for(var B=P+1;B<F;++B){L=q[t+B],J=q[t+B+F];var z=o[u+B],Z=o[u+B+F];if(J<z||Z<L)continue F}var R=f(C,j);if(void 0!==R)return R}}}}},13608:(F,P,f)=>{"use strict";F.exports=function(F,P,f,H,A,o){if(H<=f+1)return f;var j=f,i=H,u=H+f>>>1,T=2*F,Y=u,t=A[T*u+P];for(;j<i;){if(i-j<N){q(F,P,j,i,A,o),t=A[T*u+P];break}var C=i-j,L=Math.random()*C+j|0,J=A[T*L+P],B=Math.random()*C+j|0,z=A[T*B+P],Z=Math.random()*C+j|0,R=A[T*Z+P];J<=z?R>=z?(Y=B,t=z):J>=R?(Y=L,t=J):(Y=Z,t=R):z>=R?(Y=B,t=z):R>=J?(Y=L,t=J):(Y=Z,t=R);for(var y=T*(i-1),O=T*Y,d=0;d<T;++d,++y,++O){var M=A[y];A[y]=A[O],A[O]=M}var V=o[i-1];o[i-1]=o[Y],o[Y]=V;for(y=T*(i-1),O=T*(Y=c(F,P,j,i-1,A,o,t)),d=0;d<T;++d,++y,++O){M=A[y];A[y]=A[O],A[O]=M}V=o[i-1];if(o[i-1]=o[Y],o[Y]=V,u<Y){for(i=Y-1;j<i&&A[T*(i-1)+P]===t;)i-=1;i+=1}else{if(!(Y<u))break;for(j=Y+1;j<i&&A[T*j+P]===t;)j+=1}}return c(F,P,f,u,A,o,A[T*u+P])};var c=f(13611)("lo<p0",["p0"]),N=8;function q(F,P,f,c,N,q){for(var H=2*F,A=H*(f+1)+P,o=f+1;o<c;++o,A+=H)for(var j=N[A],i=o,u=H*(o-1);i>f&&N[u+P]>j;--i,u-=H){for(var T=u,Y=u+H,t=0;t<H;++t,++T,++Y){var C=N[T];N[T]=N[Y],N[Y]=C}var L=q[i];q[i]=q[i-1],q[i-1]=L}}},13611:F=>{"use strict";F.exports=function(F,f){var c="abcdef".split("").concat(f),N=[];F.indexOf("lo")>=0&&N.push("lo=e[k+n]");F.indexOf("hi")>=0&&N.push("hi=e[k+o]");return c.push(P.replace("_",N.join()).replace("$",F)),Function.apply(void 0,c)};var P="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13595:F=>{"use strict";F.exports=function(F,c){c<=4*P?f(0,c-1,F):j(0,c-1,F)};var P=32;function f(F,P,f){for(var c=2*(F+1),N=F+1;N<=P;++N){for(var q=f[c++],H=f[c++],A=N,o=c-2;A-- >F;){var j=f[o-2],i=f[o-1];if(j<q)break;if(j===q&&i<H)break;f[o]=j,f[o+1]=i,o-=2}f[o]=q,f[o+1]=H}}function c(F,P,f){P*=2;var c=f[F*=2],N=f[F+1];f[F]=f[P],f[F+1]=f[P+1],f[P]=c,f[P+1]=N}function N(F,P,f){P*=2,f[F*=2]=f[P],f[F+1]=f[P+1]}function q(F,P,f,c){P*=2,f*=2;var N=c[F*=2],q=c[F+1];c[F]=c[P],c[F+1]=c[P+1],c[P]=c[f],c[P+1]=c[f+1],c[f]=N,c[f+1]=q}function H(F,P,f,c,N){P*=2,N[F*=2]=N[P],N[P]=f,N[F+1]=N[P+1],N[P+1]=c}function A(F,P,f){P*=2;var c=f[F*=2],N=f[P];return!(c<N)&&(c!==N||f[F+1]>f[P+1])}function o(F,P,f,c){var N=c[F*=2];return N<P||N===P&&c[F+1]<f}function j(F,i,u){var T=(i-F+1)/6|0,Y=F+T,t=i-T,C=F+i>>1,L=C-T,J=C+T,B=Y,z=L,Z=C,R=J,y=t,O=F+1,d=i-1,M=0;A(B,z,u)&&(M=B,B=z,z=M),A(R,y,u)&&(M=R,R=y,y=M),A(B,Z,u)&&(M=B,B=Z,Z=M),A(z,Z,u)&&(M=z,z=Z,Z=M),A(B,R,u)&&(M=B,B=R,R=M),A(Z,R,u)&&(M=Z,Z=R,R=M),A(z,y,u)&&(M=z,z=y,y=M),A(z,Z,u)&&(M=z,z=Z,Z=M),A(R,y,u)&&(M=R,R=y,y=M);for(var V=u[2*z],Q=u[2*z+1],K=u[2*R],x=u[2*R+1],k=2*B,I=2*Z,E=2*y,r=2*Y,n=2*C,p=2*t,U=0;U<2;++U){var e=u[k+U],D=u[I+U],l=u[E+U];u[r+U]=e,u[n+U]=D,u[p+U]=l}N(L,F,u),N(J,i,u);for(var W=O;W<=d;++W)if(o(W,V,Q,u))W!==O&&c(W,O,u),++O;else if(!o(W,K,x,u))for(;;){if(o(d,K,x,u)){o(d,V,Q,u)?(q(W,O,d,u),++O,--d):(c(W,d,u),--d);break}if(--d<W)break}H(F,O-1,V,Q,u),H(i,d+1,K,x,u),O-2-F<=P?f(F,O-2,u):j(F,O-2,u),i-(d+2)<=P?f(d+2,i,u):j(d+2,i,u),d-O<=P?f(O,d,u):j(O,d,u)}},13586:(F,P,f)=>{"use strict";F.exports={init:function(F){var P=N.nextPow2(F);o.length<P&&(c.free(o),o=c.mallocInt32(P));j.length<P&&(c.free(j),j=c.mallocInt32(P));i.length<P&&(c.free(i),i=c.mallocInt32(P));u.length<P&&(c.free(u),u=c.mallocInt32(P));T.length<P&&(c.free(T),T=c.mallocInt32(P));Y.length<P&&(c.free(Y),Y=c.mallocInt32(P));var f=8*P;t.length<f&&(c.free(t),t=c.mallocDouble(f))},sweepBipartite:function(F,P,f,c,N,A,T,Y,J,B){for(var z=0,Z=2*F,R=F-1,y=Z-1,O=f;O<c;++O){var d=A[O],M=Z*O;t[z++]=N[M+R],t[z++]=-(d+1),t[z++]=N[M+y],t[z++]=d}for(O=T;O<Y;++O){d=B[O]+H;var V=Z*O;t[z++]=J[V+R],t[z++]=-d,t[z++]=J[V+y],t[z++]=d}var Q=z>>>1;q(t,Q);var K=0,x=0;for(O=0;O<Q;++O){var k=0|t[2*O+1];if(k>=H)C(i,u,x--,k=k-H|0);else if(k>=0)C(o,j,K--,k);else if(k<=-H){k=-k-H|0;for(var I=0;I<K;++I){if(void 0!==(E=P(o[I],k)))return E}L(i,u,x++,k)}else{k=-k-1|0;for(I=0;I<x;++I){var E;if(void 0!==(E=P(k,i[I])))return E}L(o,j,K++,k)}}},sweepComplete:function(F,P,f,c,N,H,A,J,B,z){for(var Z=0,R=2*F,y=F-1,O=R-1,d=f;d<c;++d){var M=H[d]+1<<1,V=R*d;t[Z++]=N[V+y],t[Z++]=-M,t[Z++]=N[V+O],t[Z++]=M}for(d=A;d<J;++d){M=z[d]+1<<1;var Q=R*d;t[Z++]=B[Q+y],t[Z++]=1|-M,t[Z++]=B[Q+O],t[Z++]=1|M}var K=Z>>>1;q(t,K);var x=0,k=0,I=0;for(d=0;d<K;++d){var E=0|t[2*d+1],r=1&E;if(d<K-1&&E>>1===t[2*d+3]>>1&&(r=2,d+=1),E<0){for(var n=-(E>>1)-1,p=0;p<I;++p){if(void 0!==(U=P(T[p],n)))return U}if(0!==r)for(p=0;p<x;++p){if(void 0!==(U=P(o[p],n)))return U}if(1!==r)for(p=0;p<k;++p){var U;if(void 0!==(U=P(i[p],n)))return U}0===r?L(o,j,x++,n):1===r?L(i,u,k++,n):2===r&&L(T,Y,I++,n)}else{n=(E>>1)-1;0===r?C(o,j,x--,n):1===r?C(i,u,k--,n):2===r&&C(T,Y,I--,n)}}},scanBipartite:function(F,P,f,c,N,A,i,u,T,Y,J,B){var z=0,Z=2*F,R=P,y=P+F,O=1,d=1;c?d=H:O=H;for(var M=N;M<A;++M){var V=M+O,Q=Z*M;t[z++]=i[Q+R],t[z++]=-V,t[z++]=i[Q+y],t[z++]=V}for(M=T;M<Y;++M){V=M+d;var K=Z*M;t[z++]=J[K+R],t[z++]=-V}var x=z>>>1;q(t,x);var k=0;for(M=0;M<x;++M){var I=0|t[2*M+1];if(I<0){var E=!1;if((V=-I)>=H?(E=!c,V-=H):(E=!!c,V-=1),E)L(o,j,k++,V);else{var r=B[V],n=Z*V,p=J[n+P+1],U=J[n+P+1+F];F:for(var e=0;e<k;++e){var D=o[e],l=Z*D;if(!(U<i[l+P+1]||i[l+P+1+F]<p)){for(var W=P+2;W<F;++W)if(J[n+W+F]<i[l+W]||i[l+W+F]<J[n+W])continue F;var b,v=u[D];if(void 0!==(b=c?f(r,v):f(v,r)))return b}}}}else C(o,j,k--,I-O)}},scanComplete:function(F,P,f,c,N,A,j,i,u,T,Y){for(var C=0,L=2*F,J=P,B=P+F,z=c;z<N;++z){var Z=z+H,R=L*z;t[C++]=A[R+J],t[C++]=-Z,t[C++]=A[R+B],t[C++]=Z}for(z=i;z<u;++z){Z=z+1;var y=L*z;t[C++]=T[y+J],t[C++]=-Z}var O=C>>>1;q(t,O);var d=0;for(z=0;z<O;++z){var M=0|t[2*z+1];if(M<0){if((Z=-M)>=H)o[d++]=Z-H;else{var V=Y[Z-=1],Q=L*Z,K=T[Q+P+1],x=T[Q+P+1+F];F:for(var k=0;k<d;++k){var I=o[k],E=j[I];if(E===V)break;var r=L*I;if(!(x<A[r+P+1]||A[r+P+1+F]<K)){for(var n=P+2;n<F;++n)if(T[Q+n+F]<A[r+n]||A[r+n+F]<T[Q+n])continue F;var p=f(E,V);if(void 0!==p)return p}}}}else{for(Z=M-H,k=d-1;k>=0;--k)if(o[k]===Z){for(n=k+1;n<d;++n)o[n-1]=o[n];break}--d}}}};var c=f(13558),N=f(13563),q=f(13595),H=1<<28,A=1024,o=c.mallocInt32(A),j=c.mallocInt32(A),i=c.mallocInt32(A),u=c.mallocInt32(A),T=c.mallocInt32(A),Y=c.mallocInt32(A),t=c.mallocDouble(8192);function C(F,P,f,c){var N=P[c],q=F[f-1];F[N]=q,P[q]=N}function L(F,P,f,c){F[f]=c,P[c]=f}},13572:F=>{"use strict";function P(F,f,c){var N=0|F[c];if(N<=0)return[];var q,H=new Array(N);if(c===F.length-1)for(q=0;q<N;++q)H[q]=f;else for(q=0;q<N;++q)H[q]=P(F,f,c+1);return H}F.exports=function(F,f){switch("undefined"===typeof f&&(f=0),typeof F){case"number":if(F>0)return function(F,P){var f,c;for(f=new Array(F),c=0;c<F;++c)f[c]=P;return f}(0|F,f);break;case"object":if("number"===typeof F.length)return P(F,f,0)}return[]}},13522:(F,P,f)=>{F.exports=function(){var F=this;this.components={},this.comps=this.components;var P=this.components,f=1,N={},q=[],H=[],A={timeout:!1,removals:[],multiComps:[]};function o(F,f){var c=P[f],q=N[f],H=q.hash[F];H&&(q.remove(F),c.Ff&&(c.multi?(H.forEach((P=>{P&&c.Ff(F,P)})),H.length=0):c.Ff(F,H)),A.removals.push(q),j())}function j(){A.timeout||(A.timeout=!0,setTimeout(i,1))}function i(){A.timeout=!1,u()}function u(){A.multiComps.length&&function(F){for(var P=0;P<F.length;P++){var{entID:f,data:c}=F[P],N=c.hash[f];if(N){for(var q=0;q<N.length;q++)N[q]||(N.splice(q,1),q--);0===N.length&&(c.remove(f),A.removals.push(c))}}F.length=0}(A.multiComps),A.removals.length&&function(F){for(var P=0;P<F.length;P++){F[P].flush()}F.length=0}(A.removals)}this.pu=N,this._systems=q,this._renderSystems=H,this.Oi=function(P){var c=f++;return Array.isArray(P)&&P.forEach((P=>F.Aj(c,P))),c},this.deleteEntity=function(P){return Object.keys(N).forEach((F=>{N[F].hash[P]&&o(P,F)})),F},this.Di=function(F){if(!F)throw new Error("Missing component definition");var f=F.name;if(!f)throw new Error("Component definition must have a name property.");if("string"!==typeof f)throw new Error("Component name must be a string.");if(""===f)throw new Error("Component name must be a non-empty string.");if(N[f])throw new Error(`Component ${f} already exists.`);var A={};return A.name=f,A.multi=!!F.multi,A.order=isNaN(F.order)?99:F.order,A.stateConstructor=F.stateConstructor||null,A.state=F.state||{},A.eq=F.eq||null,A.Ff=F.Ff||null,A.system=F.system||null,A.oo=F.oo||null,P[f]=A,N[f]=new c,N[f]._pendingMultiCleanup=!1,N[f]._multiCleanupIDs=A.multi?[]:null,A.system&&(q.push(f),q.sort(((F,f)=>P[F].order-P[f].order))),A.oo&&(H.push(f),H.sort(((F,f)=>P[F].order-P[f].order))),f},this.overwriteComponent=function(F,f){var c=P[F];if(!c)throw new Error(`Unknown component: ${F}`);if(!f)throw new Error("Missing component definition");if(c.name!==f.name)throw new Error("Overwriting component must use the same name property.");var A={};A.name=F,A.multi=!!f.multi,A.order=isNaN(f.order)?99:f.order,A.state=f.state||{},A.eq=f.eq||null,A.Ff=f.Ff||null,A.system=f.system||null,A.oo=f.oo||null,P[F]=A,N[F]._pendingMultiCleanup=!1,N[F]._multiCleanupIDs=A.multi?[]:null;var o=q.indexOf(F);A.system&&o<0&&q.push(F),!A.system&&o>=0&&q.splice(o,1),q.sort(((F,f)=>P[F].order-P[f].order));var j=H.indexOf(F);A.oo&&j<0&&H.push(F),!A.oo&&j>=0&&H.splice(j,1),H.sort(((F,f)=>P[F].order-P[f].order));var i=A.state;return this.qi(F).forEach((F=>{for(var P in i)P in F||(F[P]=i[P]);A.eq&&A.eq(F.Ho,F)})),F},this.deleteComponent=function(f){var c=N[f];if(!c)throw new Error(`Unknown component: ${f}`);c.flush(),c.list.forEach((F=>{F&&o(F.Ho||F[0].Ho,f)}));var A=q.indexOf(f),j=H.indexOf(f);return A>-1&&q.splice(A,1),j>-1&&H.splice(j,1),N[f].dispose(),delete N[f],delete P[f],F},this.Aj=function(F,f,c){var q,H=P[f],A=N[f];if(!A)throw new Error(`Unknown component: ${f}.`);if(A.hash[F]&&!H.multi)throw new Error(`Entity ${F} already has component: ${f}.`);if(H.stateConstructor){if(!(q=new H.stateConstructor).hasOwnProperty("Ho"))throw new Error(`Component ${H.name} stateConstructor type does not have property __id`)}else q=Object.assign({},{Ho:F},H.state,c);if(q.Ho=F,H.multi){var o=A.hash[F];o||(o=[],A.add(F,o)),o.push(q)}else A.add(F,q);return H.eq&&H.eq(F,q),this},this.Jj=function(F,P){var f=N[P];if(!f)throw new Error(`Unknown component: ${P}.`);return!!f.hash[F]},this.uj=function(P,f){if(!N[f])throw new Error(`Unknown component: ${f}.`);return o(P,f),F},this.getState=function(F,P){var f=N[P];if(!f)throw new Error(`Unknown component: ${P}.`);return f.hash[F]},this.qi=function(F){var P=N[F];if(!P)throw new Error(`Unknown component: ${F}.`);return u(),P.list},this.OY=function(F){if(!N[F])throw new Error(`Unknown component: ${F}.`);var P=N[F].hash;return F=>P[F]},this.QY=function(F){if(!N[F])throw new Error(`Unknown component: ${F}.`);var P=N[F].hash;return F=>!!P[F]},this.fo=function(f){u();for(var c=0;c<q.length;c++){var H=q[c],A=P[H],o=N[H];A.system(f,o.list),u()}return F},this.render=function(f){u();for(var c=0;c<H.length;c++){var q=H[c],A=P[q],o=N[q];A.oo(f,o.list),u()}return F},this.removeMultiComponent=function(f,c,q){var H=P[c],o=N[c];if(!o)throw new Error(`Unknown component: ${c}.`);if(!H.multi)throw new Error("removeMultiComponent called on non-multi component");return function(F,P,f,c){var N=f.hash[F];if(N){var q=N[c];q&&(N[c]=null,P.Ff&&P.Ff(F,q),A.multiComps.push({entID:F,data:f}),j())}}(f,H,o,q),F}};var c=f(13530)},13530:F=>{function P(F,P){var f=F._map[P];if(delete F.hash[P],delete F._map[P],f===F.list.length-1)F.list.pop();else{var c=F.list.pop();if(F.list[f]=c,null===c||null===c[0]){var N=F.list.length;for(var q in F._map)if(F._map[q]===N)return void(F._map[q]=f)}else{var H=c.Ho||c[0].Ho;F._map[H]=f}}}F.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(F,P){if("number"===typeof this._map[F]){var f=this._map[F];this.hash[F]=P,this.list[f]=P}else this._map[F]=this.list.length,this.hash[F]=P,this.list.push(P)}remove(F){var P=this._map[F];this.hash[F]=null,this.list[P]=null,this._pendingRemovals.push(F)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var F=0;F<this._pendingRemovals.length;F++){var f=this._pendingRemovals[F];null===this.hash[f]&&P(this,f)}this._pendingRemovals.length=0}}},13479:F=>{"use strict";var P,f="object"===typeof Reflect?Reflect:null,c=function(F,P,f){return Function.prototype.apply.call(F,P,f)};P=f&&"function"===typeof f.ownKeys?f.ownKeys:Object.getOwnPropertySymbols?function(F){return Object.getOwnPropertyNames(F).concat(Object.getOwnPropertySymbols(F))}:function(F){return Object.getOwnPropertyNames(F)};var N=Number.isNaN||function(F){return F!==F};function q(){q.init.call(this)}F.exports=q,F.exports.once=function(F,P){return new Promise((function(f,c){function N(f){F.removeListener(P,q),c(f)}function q(){"function"===typeof F.removeListener&&F.removeListener("error",N),f([].slice.call(arguments))}C(F,P,q,{once:!0}),"error"!==P&&function(F,P,f){"function"===typeof F.on&&C(F,"error",P,f)}(F,N,{once:!0})}))},q.EventEmitter=q,q.prototype._events=void 0,q.prototype._eventsCount=0,q.prototype._maxListeners=void 0;var H=10;function A(F){if("function"!==typeof F)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof F)}function o(F){return void 0===F._maxListeners?q.defaultMaxListeners:F._maxListeners}function j(F,P,f,c){var N,q,H,j;if(A(f),void 0===(q=F._events)?(q=F._events=Object.create(null),F._eventsCount=0):(void 0!==q.newListener&&(F.emit("newListener",P,f.listener?f.listener:f),q=F._events),H=q[P]),void 0===H)H=q[P]=f,++F._eventsCount;else if("function"===typeof H?H=q[P]=c?[f,H]:[H,f]:c?H.unshift(f):H.push(f),(N=o(F))>0&&H.length>N&&!H.warned){H.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+H.length+" "+String(P)+" listeners added. Use emitter.setMaxListeners() to increase limit");i.name="MaxListenersExceededWarning",i.cP=F,i.type=P,i.count=H.length,j=i,console&&console.warn&&console.warn(j)}return F}function i(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(F,P,f){var c={fired:!1,wrapFn:void 0,target:F,type:P,listener:f},N=i.bind(c);return N.listener=f,c.wrapFn=N,N}function T(F,P,f){var c=F._events;if(void 0===c)return[];var N=c[P];return void 0===N?[]:"function"===typeof N?f?[N.listener||N]:[N]:f?function(F){for(var P=new Array(F.length),f=0;f<P.length;++f)P[f]=F[f].listener||F[f];return P}(N):t(N,N.length)}function Y(F){var P=this._events;if(void 0!==P){var f=P[F];if("function"===typeof f)return 1;if(void 0!==f)return f.length}return 0}function t(F,P){for(var f=new Array(P),c=0;c<P;++c)f[c]=F[c];return f}function C(F,P,f,c){if("function"===typeof F.on)c.once?F.once(P,f):F.on(P,f);else{if("function"!==typeof F.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof F);F.addEventListener(P,(function N(q){c.once&&F.removeEventListener(P,N),f(q)}))}}Object.defineProperty(q,"defaultMaxListeners",{enumerable:!0,get:function(){return H},set:function(F){if("number"!==typeof F||F<0||N(F))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+F+".");H=F}}),q.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},q.prototype.setMaxListeners=function(F){if("number"!==typeof F||F<0||N(F))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+F+".");return this._maxListeners=F,this},q.prototype.getMaxListeners=function(){return o(this)},q.prototype.emit=function(F){for(var P=[],f=1;f<arguments.length;f++)P.push(arguments[f]);var N="error"===F,q=this._events;if(void 0!==q)N=N&&void 0===q.error;else if(!N)return!1;if(N){var H;if(P.length>0&&(H=P[0]),H instanceof Error)throw H;var A=new Error("Unhandled error."+(H?" ("+H.message+")":""));throw A.context=H,A}var o=q[F];if(void 0===o)return!1;if("function"===typeof o)c(o,this,P);else{var j=o.length,i=t(o,j);for(f=0;f<j;++f)c(i[f],this,P)}return!0},q.prototype.addListener=function(F,P){return j(this,F,P,!1)},q.prototype.on=q.prototype.addListener,q.prototype.prependListener=function(F,P){return j(this,F,P,!0)},q.prototype.once=function(F,P){return A(P),this.on(F,u(this,F,P)),this},q.prototype.prependOnceListener=function(F,P){return A(P),this.prependListener(F,u(this,F,P)),this},q.prototype.removeListener=function(F,P){var f,c,N,q,H;if(A(P),void 0===(c=this._events))return this;if(void 0===(f=c[F]))return this;if(f===P||f.listener===P)0===--this._eventsCount?this._events=Object.create(null):(delete c[F],c.removeListener&&this.emit("removeListener",F,f.listener||P));else if("function"!==typeof f){for(N=-1,q=f.length-1;q>=0;q--)if(f[q]===P||f[q].listener===P){H=f[q].listener,N=q;break}if(N<0)return this;0===N?f.shift():function(F,P){for(;P+1<F.length;P++)F[P]=F[P+1];F.pop()}(f,N),1===f.length&&(c[F]=f[0]),void 0!==c.removeListener&&this.emit("removeListener",F,H||P)}return this},q.prototype.off=q.prototype.removeListener,q.prototype.NP=function(F){var P,f,c;if(void 0===(f=this._events))return this;if(void 0===f.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==f[F]&&(0===--this._eventsCount?this._events=Object.create(null):delete f[F]),this;if(0===arguments.length){var N,q=Object.keys(f);for(c=0;c<q.length;++c)"removeListener"!==(N=q[c])&&this.NP(N);return this.NP("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(P=f[F]))this.removeListener(F,P);else if(void 0!==P)for(c=P.length-1;c>=0;c--)this.removeListener(F,P[c]);return this},q.prototype.listeners=function(F){return T(this,F,!0)},q.prototype.rawListeners=function(F){return T(this,F,!1)},q.listenerCount=function(F,P){return"function"===typeof F.listenerCount?F.listenerCount(P):Y.call(F,P)},q.prototype.listenerCount=Y,q.prototype.eventNames=function(){return this._eventsCount>0?P(this._events):[]}},13785:F=>{"use strict";F.exports=function(F,P,f,c,N,q){var H=+P[0],A=+P[1],o=+P[2],j=+f[0],i=+f[1],u=+f[2],T=Math.sqrt(j*j+i*i+u*u);if(0===T)throw new Error("Can't raycast along a zero vector");return function(F,P,f,c,N,q,H,A,o,j){for(var i=0,u=Math.floor,T=0|u(P),Y=0|u(f),t=0|u(c),C=N>0?1:-1,L=q>0?1:-1,J=H>0?1:-1,B=Math.abs(1/N),z=Math.abs(1/q),Z=Math.abs(1/H),R=B<1/0?B*(C>0?T+1-P:P-T):1/0,y=z<1/0?z*(L>0?Y+1-f:f-Y):1/0,O=Z<1/0?Z*(J>0?t+1-c:c-t):1/0,d=-1;i<=A;){var M=F(T,Y,t);if(M)return o&&(o[0]=P+i*N,o[1]=f+i*q,o[2]=c+i*H),j&&(j[0]=j[1]=j[2]=0,0===d&&(j[0]=-C),1===d&&(j[1]=-L),2===d&&(j[2]=-J)),M;R<y?R<O?(T+=C,i=R,R+=B,d=0):(t+=J,i=O,O+=Z,d=2):y<O?(Y+=L,i=y,y+=z,d=1):(t+=J,i=O,O+=Z,d=2)}return o&&(o[0]=P+i*N,o[1]=f+i*q,o[2]=c+i*H),j&&(j[0]=j[1]=j[2]=0),0}(F,H,A,o,j/=T,i/=T,u/=T,c="undefined"===typeof c?64:+c,N,q)}},13812:(F,P,f)=>{"use strict";f.d(P,{e:()=>q});var c=f(13479);function N(){this.dT=!1,this.stopPropagation=!1,this.MT=!1,this.disabled=!1}class q{constructor(F,P){this.version="0.7.0";var f=Object.assign({},new N,P||{});this.element=F||document,this.dT=!!f.dT,this.stopPropagation=!!f.stopPropagation,this.MT=!!f.MT,this.disabled=!!f.disabled,this.filterEvents=(F,P)=>!0,this.down=new c.EventEmitter,this.up=new c.EventEmitter,this.state={},this.Sj={dx:0,dy:0,tY:0,hj:0,CY:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?A(this):document.addEventListener("DOMContentLoaded",(F=>{A(this)}),{once:!0})}bind(F){for(var P=arguments.length,f=new Array(P>1?P-1:0),c=1;c<P;c++)f[c-1]=arguments[c];f.forEach((P=>{var f=this._keyBindmap[P]||[];f.includes(F)||(f.push(F),this._keyBindmap[P]=f)})),this.state[F]=!!this.state[F],this.pressCount[F]=this.pressCount[F]||0,this.releaseCount[F]=this.releaseCount[F]||0}unbind(F){for(var P in this._keyBindmap){var f=this._keyBindmap[P],c=f.indexOf(F);c>-1&&f.splice(c,1)}}getBindings(){var F={};for(var P in this._keyBindmap){this._keyBindmap[P].forEach((f=>{F[f]=F[f]||[],F[f].push(P)}))}return F}fo(){H(this.Sj),H(this.pressCount),H(this.releaseCount)}}function H(F){for(var P in F)F[P]=0}function A(F){window.addEventListener("keydown",t.bind(null,F,!0),!1),window.addEventListener("keyup",t.bind(null,F,!1),!1);var P={passive:!0};F.element.addEventListener("touchstart",u.bind(void 0,F),{passive:!1}),F.element.addEventListener("touchend",Y.bind(void 0,F),P),F.element.addEventListener("mousedown",C.bind(null,F,!0),P),window.document.addEventListener("mouseup",C.bind(null,F,!1),P),F.element.addEventListener("touchmove",L.bind(null,F),P),F.element.addEventListener("mousemove",L.bind(null,F),P),window.PointerEvent,F.element.addEventListener("wheel",J.bind(null,F),P),F.element.addEventListener("contextmenu",B.bind(null,F),!1),window.addEventListener("blur",z.bind(null,F),!1)}var o=0,j=0,i=null;function u(F,P){P.preventDefault(),T(P)}function T(F){let P=!1;for(let f=0;f<F.touches.length;++f)if(F.touches[f].identifier===i){P=!0;break}if(!P){const P=F.changedTouches[0];o=P.clientX,j=P.clientY,i=P.identifier}}function Y(F,P){for(var f=P.changedTouches,c=0;c<f.length;++c)f[c].identifier===i&&(i=null)}function t(F,P,f){Z(f.code,P,F,f)}function C(F,P,f){if("pointerId"in f)if(P){if(null!==F._touches.currID)return;F._touches.currID=f.pointerId}else{if(F._touches.currID!==f.pointerId)return;F._touches.currID=null}return Z("Mouse"+("button"in f?f.button+1:1),P,F,f),!1}function L(F,P){var f=P.movementX||P.mozMovementX||0,c=P.movementY||P.mozMovementY||0;if(P.touches&&0===(f|c)){var N=function(F){T(F);for(let P=0;P<F.changedTouches.length;++P)if(F.changedTouches[P].identifier==i){const f=F.changedTouches[P],c=[f.clientX-o,f.clientY-j];return o=f.clientX,j=f.clientY,c}return console.error(`Did not find touch id ${i}`),[0,0]}(P);f=N[0],c=N[1]}F.Sj.dx+=f,F.Sj.dy+=c}function J(F,P){var f=1;switch(P.deltaMode){case 0:f=1;break;case 1:f=12;break;case 2:f=F.element.clientHeight||window.innerHeight}F.Sj.tY+=(P.deltaX||0)*f,F.Sj.hj+=(P.deltaY||0)*f,F.Sj.CY+=(P.deltaZ||0)*f}function B(F,P){if(!F.MT)return P.preventDefault(),!1}function z(F){for(var P in F._keyStates)F._keyStates[P]&&(/^Mouse\d/.test(P)||Z(P,!1,F,{code:P,note:"mc2ksnnuzp",preventDefault:()=>{},stopPropagation:()=>{}}))}function Z(F,P,f,c){var N=f._keyBindmap[F];N&&(R(f._keyStates[F],P)&&(f._keyStates[F]=P,N.forEach((F=>{(!f.filterEvents||f.filterEvents(c,F))&&function(F,P,f,c){var N=P?f.pressCount:f.releaseCount;N[F]=(N[F]||0)+1;var q=f._bindPressCount[F]||0;(q+=P?1:-1)<0&&(q=0);f._bindPressCount[F]=q;var H=f.state[F];if(R(H,q)){f.state[F]=q>0;var A=P?f.down:f.up;f.disabled||A.emit(F,c)}}(F,P,f,c)}))),"button"in c||(f.dT&&!c.defaultPrevented&&c.preventDefault(),f.stopPropagation&&c.stopPropagation()))}function R(F,P){return F?!P:P}},12487:F=>{F.exports=function(F,P,f){return F[0]=P[0]+f[0],F[1]=P[1]+f[1],F[2]=P[2]+f[2],F}},12451:(F,P,f)=>{F.exports=function(F,P){var f=c(F[0],F[1],F[2]),H=c(P[0],P[1],P[2]);N(f,f),N(H,H);var A=q(f,H);return A>1?0:Math.acos(A)};var c=f(12456),N=f(12463),q=f(12465)},12532:F=>{F.exports=function(F,P){return F[0]=Math.ceil(P[0]),F[1]=Math.ceil(P[1]),F[2]=Math.ceil(P[2]),F}},12444:F=>{F.exports=function(F){var P=new Float32Array(3);return P[0]=F[0],P[1]=F[1],P[2]=F[2],P}},12470:F=>{F.exports=function(F,P){return F[0]=P[0],F[1]=P[1],F[2]=P[2],F}},12436:F=>{F.exports=function(){var F=new Float32Array(3);return F[0]=0,F[1]=0,F[2]=0,F}},12614:F=>{F.exports=function(F,P,f){var c=P[0],N=P[1],q=P[2],H=f[0],A=f[1],o=f[2];return F[0]=N*o-q*A,F[1]=q*H-c*o,F[2]=c*A-N*H,F}},12564:(F,P,f)=>{F.exports=f(12557)},12557:F=>{F.exports=function(F,P){var f=P[0]-F[0],c=P[1]-F[1],N=P[2]-F[2];return Math.sqrt(f*f+c*c+N*N)}},12514:(F,P,f)=>{F.exports=f(12509)},12509:F=>{F.exports=function(F,P,f){return F[0]=P[0]/f[0],F[1]=P[1]/f[1],F[2]=P[2]/f[2],F}},12465:F=>{F.exports=function(F,P){return F[0]*P[0]+F[1]*P[1]+F[2]*P[2]}},12434:F=>{F.exports=1e-6},12480:(F,P,f)=>{F.exports=function(F,P){var f=F[0],N=F[1],q=F[2],H=P[0],A=P[1],o=P[2];return Math.abs(f-H)<=c*Math.max(1,Math.abs(f),Math.abs(H))&&Math.abs(N-A)<=c*Math.max(1,Math.abs(N),Math.abs(A))&&Math.abs(q-o)<=c*Math.max(1,Math.abs(q),Math.abs(o))};var c=f(12434)},12483:F=>{F.exports=function(F,P){return F[0]===P[0]&&F[1]===P[1]&&F[2]===P[2]}},12523:F=>{F.exports=function(F,P){return F[0]=Math.floor(P[0]),F[1]=Math.floor(P[1]),F[2]=Math.floor(P[2]),F}},12661:(F,P,f)=>{F.exports=function(F,P,f,N,q,H){var A,o;P||(P=3);f||(f=0);o=N?Math.min(N*P+f,F.length):F.length;for(A=f;A<o;A+=P)c[0]=F[A],c[1]=F[A+1],c[2]=F[A+2],q(c,c,H),F[A]=c[0],F[A+1]=c[1],F[A+2]=c[2];return F};var c=f(12436)()},12456:F=>{F.exports=function(F,P,f){var c=new Float32Array(3);return c[0]=F,c[1]=P,c[2]=f,c}},12430:(F,P,f)=>{F.exports={EPSILON:f(12434),create:f(12436),clone:f(12444),angle:f(12451),mA:f(12456),k:f(12470),set:f(12474),equals:f(12480),exactEquals:f(12483),add:f(12487),CP:f(12490),sub:f(12496),multiply:f(12500),mul:f(12503),divide:f(12509),div:f(12514),min:f(12516),max:f(12519),floor:f(12523),ceil:f(12532),round:f(12537),scale:f(12545),aA:f(12551),distance:f(12557),j:f(12564),squaredDistance:f(12569),sqrDist:f(12576),length:f(12582),len:f(12585),squaredLength:f(12592),wA:f(12595),negate:f(12600),inverse:f(12607),normalize:f(12463),dot:f(12465),cross:f(12614),vA:f(12620),random:f(12622),transformMat4:f(12625),transformMat3:f(12633),transformQuat:f(12640),gA:f(12649),GA:f(12652),hA:f(12655),forEach:f(12661)}},12607:F=>{F.exports=function(F,P){return F[0]=1/P[0],F[1]=1/P[1],F[2]=1/P[2],F}},12585:(F,P,f)=>{F.exports=f(12582)},12582:F=>{F.exports=function(F){var P=F[0],f=F[1],c=F[2];return Math.sqrt(P*P+f*f+c*c)}},12620:F=>{F.exports=function(F,P,f,c){var N=P[0],q=P[1],H=P[2];return F[0]=N+c*(f[0]-N),F[1]=q+c*(f[1]-q),F[2]=H+c*(f[2]-H),F}},12519:F=>{F.exports=function(F,P,f){return F[0]=Math.max(P[0],f[0]),F[1]=Math.max(P[1],f[1]),F[2]=Math.max(P[2],f[2]),F}},12516:F=>{F.exports=function(F,P,f){return F[0]=Math.min(P[0],f[0]),F[1]=Math.min(P[1],f[1]),F[2]=Math.min(P[2],f[2]),F}},12503:(F,P,f)=>{F.exports=f(12500)},12500:F=>{F.exports=function(F,P,f){return F[0]=P[0]*f[0],F[1]=P[1]*f[1],F[2]=P[2]*f[2],F}},12600:F=>{F.exports=function(F,P){return F[0]=-P[0],F[1]=-P[1],F[2]=-P[2],F}},12463:F=>{F.exports=function(F,P){var f=P[0],c=P[1],N=P[2],q=f*f+c*c+N*N;q>0&&(q=1/Math.sqrt(q),F[0]=P[0]*q,F[1]=P[1]*q,F[2]=P[2]*q);return F}},12622:F=>{F.exports=function(F,P){P=P||1;var f=2*Math.random()*Math.PI,c=2*Math.random()-1,N=Math.sqrt(1-c*c)*P;return F[0]=Math.cos(f)*N,F[1]=Math.sin(f)*N,F[2]=c*P,F}},12649:F=>{F.exports=function(F,P,f,c){var N=f[1],q=f[2],H=P[1]-N,A=P[2]-q,o=Math.sin(c),j=Math.cos(c);return F[0]=P[0],F[1]=N+H*j-A*o,F[2]=q+H*o+A*j,F}},12652:F=>{F.exports=function(F,P,f,c){var N=f[0],q=f[2],H=P[0]-N,A=P[2]-q,o=Math.sin(c),j=Math.cos(c);return F[0]=N+A*o+H*j,F[1]=P[1],F[2]=q+A*j-H*o,F}},12655:F=>{F.exports=function(F,P,f,c){var N=f[0],q=f[1],H=P[0]-N,A=P[1]-q,o=Math.sin(c),j=Math.cos(c);return F[0]=N+H*j-A*o,F[1]=q+H*o+A*j,F[2]=P[2],F}},12537:F=>{F.exports=function(F,P){return F[0]=Math.round(P[0]),F[1]=Math.round(P[1]),F[2]=Math.round(P[2]),F}},12545:F=>{F.exports=function(F,P,f){return F[0]=P[0]*f,F[1]=P[1]*f,F[2]=P[2]*f,F}},12551:F=>{F.exports=function(F,P,f,c){return F[0]=P[0]+f[0]*c,F[1]=P[1]+f[1]*c,F[2]=P[2]+f[2]*c,F}},12474:F=>{F.exports=function(F,P,f,c){return F[0]=P,F[1]=f,F[2]=c,F}},12576:(F,P,f)=>{F.exports=f(12569)},12595:(F,P,f)=>{F.exports=f(12592)},12569:F=>{F.exports=function(F,P){var f=P[0]-F[0],c=P[1]-F[1],N=P[2]-F[2];return f*f+c*c+N*N}},12592:F=>{F.exports=function(F){var P=F[0],f=F[1],c=F[2];return P*P+f*f+c*c}},12496:(F,P,f)=>{F.exports=f(12490)},12490:F=>{F.exports=function(F,P,f){return F[0]=P[0]-f[0],F[1]=P[1]-f[1],F[2]=P[2]-f[2],F}},12633:F=>{F.exports=function(F,P,f){var c=P[0],N=P[1],q=P[2];return F[0]=c*f[0]+N*f[3]+q*f[6],F[1]=c*f[1]+N*f[4]+q*f[7],F[2]=c*f[2]+N*f[5]+q*f[8],F}},12625:F=>{F.exports=function(F,P,f){var c=P[0],N=P[1],q=P[2],H=f[3]*c+f[7]*N+f[11]*q+f[15];return H=H||1,F[0]=(f[0]*c+f[4]*N+f[8]*q+f[12])/H,F[1]=(f[1]*c+f[5]*N+f[9]*q+f[13])/H,F[2]=(f[2]*c+f[6]*N+f[10]*q+f[14])/H,F}},12640:F=>{F.exports=function(F,P,f){var c=P[0],N=P[1],q=P[2],H=f[0],A=f[1],o=f[2],j=f[3],i=j*c+A*q-o*N,u=j*N+o*c-H*q,T=j*q+H*N-A*c,Y=-H*c-A*N-o*q;return F[0]=i*j+Y*-H+u*-o-T*-A,F[1]=u*j+Y*-A+T*-H-i*-o,F[2]=T*j+Y*-o+i*-A-u*-H,F}},13506:F=>{"use strict";F.exports=function(F){for(var P=new Array(F),f=0;f<F;++f)P[f]=f;return P}},13579:F=>{F.exports=function(F){return null!=F&&null!=F.constructor&&"function"===typeof F.constructor.isBuffer&&F.constructor.isBuffer(F)}},13791:(F,P,f)=>{"use strict";f.d(P,{d:()=>c});class c{constructor(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Au=!1,this.ou=!1,this.qu=30,this.Hu=0,this.Lu=!1,this.fullscreen=!1,this.iu=function(F){},this.uu=function(){},this.tu=function(){},this.cf=function(){},this.Tu=function(F){},this.onFullscreenChanged=function(F){},j((()=>{!function(F,P){F._nowObject=performance||Date,F._lastTick=0,F._renderAccum=0,F._rt=0,F._frameCB=A.bind(null,F),requestAnimationFrame(F._frameCB),P>0&&(F._intervalCB=H.bind(null,F),F._interval=setInterval(F._intervalCB,Math.max(P,1e3/F.qu/2)))}(this,P),function(F,P){if(!P)return;var f=!1,c=!1;document.addEventListener("pointerlockchange",(c=>{f=document.pointerLockElement===P,F.Tu(f)})),document.addEventListener("fullscreenchange",(f=>{c=document.fullscreenElement===P,F.onFullscreenChanged(c)})),Object.defineProperty(F,"Lu",{get:()=>f,set:F=>{F&&!f?o(P):f&&!F&&function(F){F.exitPointerLock&&F.exitPointerLock()}(document)}}),Object.defineProperty(F,"fullscreen",{get:()=>c,set:F=>{F&&!c?P.requestFullscreen():c&&!F&&document.exitFullscreen()}}),P.addEventListener("click",(N=>{F.Au&&!f&&o(P),F.ou&&!c&&P.requestFullscreen()}));var N=()=>F.cf();if(window.ResizeObserver){new ResizeObserver(N).observe(P)}else window.addEventListener("resize",N)}(this,F),this.tu()}))}}var N=3,q=20;function H(F){for(var P=1e3/F.qu,f=F._nowObject.now()+q,c=0;F._nowObject.now()>=F._lastTick+P&&F._nowObject.now()<f&&++c<=N;)F.iu(P),F._lastTick+=P;var H=5*(P+5),A=F._nowObject.now();if(A-F._lastTick>H)for(;A>=F._lastTick+P;)F._lastTick+=P}function A(F){requestAnimationFrame(F._frameCB),H(F);var P=F._nowObject.now(),f=P-F._rt;if(F._rt=P,F.Hu>0){F._renderAccum+=f;var c=1e3/F.Hu;if(F._renderAccum<c)return;F._renderAccum=Math.min(F._renderAccum-c,c)}var N=1e3/F.qu,q=(P-F._lastTick)/N;F.uu(f,q,N)}function o(F){F.requestPointerLock&&F.requestPointerLock()}var j=F=>{if("loading"===document.readyState){var P=()=>{document.removeEventListener("readystatechange",P),F()};document.addEventListener("readystatechange",P)}else setTimeout(F,1)}},13502:(F,P,f)=>{var c=f(13506),N=f(13509),q="undefined"!==typeof Float64Array;function H(F,P){return F[0]-P[0]}function A(){var F,P=this.stride,f=new Array(P.length);for(F=0;F<f.length;++F)f[F]=[Math.abs(P[F]),F];f.sort(H);var c=new Array(f.length);for(F=0;F<c.length;++F)c[F]=f[F][1];return c}function o(F,P){var f=["View",P,"d",F].join("");P<0&&(f="View_Nil"+F);var N="generic"===F;if(-1===P){var q="function "+f+"(a){this.data=a;};var proto="+f+".prototype;proto.dtype='"+F+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+f+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+f+"(a){return new "+f+"(a);}";return new Function(q)()}if(0===P){q="function "+f+"(a,d) {this.data = a;this.offset = d};var proto="+f+".prototype;proto.dtype='"+F+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+f+"_copy() {return new "+f+"(this.data,this.offset)};proto.pick=function "+f+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+f+"_get(){return "+(N?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+f+"_set(v){return "+(N?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+f+"(a,b,c,d){return new "+f+"(a,d)}";return new Function("TrivialArray",q)(j[F][0])}q=["'use strict'"];var H=c(P),o=H.map((function(F){return"i"+F})),i="this.offset+"+H.map((function(F){return"this.stride["+F+"]*i"+F})).join("+"),u=H.map((function(F){return"b"+F})).join(","),T=H.map((function(F){return"c"+F})).join(",");q.push("function "+f+"(a,"+u+","+T+",d){this.data=a","this.shape=["+u+"]","this.stride=["+T+"]","this.offset=d|0}","var proto="+f+".prototype","proto.dtype='"+F+"'","proto.dimension="+P),q.push("Object.defineProperty(proto,'size',{get:function "+f+"_size(){return "+H.map((function(F){return"this.shape["+F+"]"})).join("*"),"}})"),1===P?q.push("proto.order=[0]"):(q.push("Object.defineProperty(proto,'order',{get:"),P<4?(q.push("function "+f+"_order(){"),2===P?q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===P&&q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):q.push("ORDER})")),q.push("proto.set=function "+f+"_set("+o.join(",")+",v){"),N?q.push("return this.data.set("+i+",v)}"):q.push("return this.data["+i+"]=v}"),q.push("proto.get=function "+f+"_get("+o.join(",")+"){"),N?q.push("return this.data.get("+i+")}"):q.push("return this.data["+i+"]}"),q.push("proto.index=function "+f+"_index(",o.join(),"){return "+i+"}"),q.push("proto.hi=function "+f+"_hi("+o.join(",")+"){return new "+f+"(this.data,"+H.map((function(F){return["(typeof i",F,"!=='number'||i",F,"<0)?this.shape[",F,"]:i",F,"|0"].join("")})).join(",")+","+H.map((function(F){return"this.stride["+F+"]"})).join(",")+",this.offset)}");var Y=H.map((function(F){return"a"+F+"=this.shape["+F+"]"})),t=H.map((function(F){return"c"+F+"=this.stride["+F+"]"}));q.push("proto.lo=function "+f+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+Y.join(",")+","+t.join(","));for(var C=0;C<P;++C)q.push("if(typeof i"+C+"==='number'&&i"+C+">=0){d=i"+C+"|0;b+=c"+C+"*d;a"+C+"-=d}");q.push("return new "+f+"(this.data,"+H.map((function(F){return"a"+F})).join(",")+","+H.map((function(F){return"c"+F})).join(",")+",b)}"),q.push("proto.step=function "+f+"_step("+o.join(",")+"){var "+H.map((function(F){return"a"+F+"=this.shape["+F+"]"})).join(",")+","+H.map((function(F){return"b"+F+"=this.stride["+F+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(C=0;C<P;++C)q.push("if(typeof i"+C+"==='number'){d=i"+C+"|0;if(d<0){c+=b"+C+"*(a"+C+"-1);a"+C+"=ceil(-a"+C+"/d)}else{a"+C+"=ceil(a"+C+"/d)}b"+C+"*=d}");q.push("return new "+f+"(this.data,"+H.map((function(F){return"a"+F})).join(",")+","+H.map((function(F){return"b"+F})).join(",")+",c)}");var L=new Array(P),J=new Array(P);for(C=0;C<P;++C)L[C]="a[i"+C+"]",J[C]="b[i"+C+"]";q.push("proto.transpose=function "+f+"_transpose("+o+"){"+o.map((function(F,P){return F+"=("+F+"===undefined?"+P+":"+F+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+f+"(this.data,"+L.join(",")+","+J.join(",")+",this.offset)}"),q.push("proto.pick=function "+f+"_pick("+o+"){var a=[],b=[],c=this.offset");for(C=0;C<P;++C)q.push("if(typeof i"+C+"==='number'&&i"+C+">=0){c=(c+this.stride["+C+"]*i"+C+")|0}else{a.push(this.shape["+C+"]);b.push(this.stride["+C+"])}");return q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),q.push("return function construct_"+f+"(data,shape,stride,offset){return new "+f+"(data,"+H.map((function(F){return"shape["+F+"]"})).join(",")+","+H.map((function(F){return"stride["+F+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",q.join("\n"))(j[F],A)}var j={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};F.exports=function(F,P,f,c){if(void 0===F)return(0,j.array[0])([]);"number"===typeof F&&(F=[F]),void 0===P&&(P=[F.length]);var H=P.length;if(void 0===f){f=new Array(H);for(var A=H-1,i=1;A>=0;--A)f[A]=i,i*=P[A]}if(void 0===c){c=0;for(A=0;A<H;++A)f[A]<0&&(c-=(P[A]-1)*f[A])}for(var u=function(F){if(N(F))return"buffer";if(q)switch(Object.prototype.toString.call(F)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(F)?"array":"generic"}(F),T=j[u];T.length<=H+1;)T.push(o(u,T.length-1));return(0,T[H+1])(F,P,f,c)}},13509:F=>{function P(F){return!!F.constructor&&"function"===typeof F.constructor.isBuffer&&F.constructor.isBuffer(F)}F.exports=function(F){return null!=F&&(P(F)||function(F){return"function"===typeof F.readFloatLE&&"function"===typeof F.slice&&P(F.slice(0,0))}(F)||!!F._isBuffer)}},13658:F=>{"use strict";var P=[],f=[],c=[],N=[],q=[],H=[],A=[],o=[],j=[],i=[],u=[],T=[];F.exports=function(F,Y,t,C,L,J){for(var B=A,z=j,Z=i,R=T,y=0;y<3;y++)B[y]=+t[y],Z[y]=+Y.max[y],z[y]=+Y.base[y];J||(J=1e-10);var O=function(F,A,j,i,T,Y){var t=P,C=f,L=c,J=N,B=q,z=H,Z=o,R=Math.floor,y=0,O=0,d=0,M=0,V=0;if(Q(),0===d)return 0;for(M=k();O<=d;){if(K(M)&&x())return y;M=k()}for(y+=d,V=0;V<3;V++)i[V]+=j[V],T[V]+=j[V];return y;function Q(){if(O=0,0!==(d=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2])))for(var F=0;F<3;F++){var P=j[F]>=0;J[F]=P?1:-1;var f=P?T[F]:i[F];t[F]=P?i[F]:T[F],C[F]=I(f,J[F]),L[F]=E(t[F],J[F]),Z[F]=j[F]/d,B[F]=Math.abs(1/Z[F]);var c=P?C[F]+1-f:f-C[F];z[F]=B[F]<1/0?B[F]*c:1/0}}function K(P){for(var f=J[0],c=0===P?C[0]:L[0],N=C[0]+f,q=J[1],H=1===P?C[1]:L[1],A=C[1]+q,o=J[2],j=2===P?C[2]:L[2],i=C[2]+o,u=c;u!=N;u+=f)for(var T=H;T!=A;T+=q)for(var Y=j;Y!=i;Y+=o)if(F(u,T,Y))return!0;return!1}function x(){y+=O;var F=J[M],P=O/d,f=u;for(V=0;V<3;V++){var c=j[V]*P;i[V]+=c,T[V]+=c,f[V]=j[V]-c}if(F>0?T[M]=Math.round(T[M]):i[M]=Math.round(i[M]),A(y,M,F,f))return!0;for(V=0;V<3;V++)j[V]=f[V];return Q(),0===d}function k(){var F=z[0]<z[1]?z[0]<z[2]?0:2:z[1]<z[2]?1:2,P=z[F]-O;for(O=z[F],C[F]+=J[F],z[F]+=B[F],V=0;V<3;V++)t[V]+=P*Z[V],L[V]=E(t[V],J[V]);return F}function I(F,P){return R(F-P*Y)}function E(F,P){return R(F+P*Y)}}(F,C,B,z,Z,J);if(!L){for(y=0;y<3;y++)R[y]=t[y]>0?Z[y]-Y.max[y]:z[y]-Y.base[y];Y.translate(R)}return O}},13821:(F,P,f)=>{"use strict";f.d(P,{e:()=>u});var c=f(13656),N=f(12430);class q{constructor(F,P,f,q,H,A,o){this.Ni=new c(F.base,F.Zi),this.IN=P,this.friction=f,this.restitution=q,this.pA=H,this.pY=A,this.UA=!!o,this.zi=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.yt=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Ej=N.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=N.create(),this._impulses=N.create(),this._sleepFrameCount=10}loadFromCopy(F){N.k(this.Ni.base,F.Ni.base),N.k(this.Ni.Zi,F.Ni.Zi),N.k(this.Ni.max,F.Ni.max),this.Ni.mag=F.Ni.mag,this.IN=F.IN,this.friction=F.friction,this.restitution=F.restitution,this.pA=F.pA,this.pY=F.pY,this.UA=F.UA,this.zi=F.zi,this.fluidDrag=F.fluidDrag,this.yt=F.yt,this.preventFallOffEdge=F.preventFallOffEdge,this.rolledBackLastTick=F.rolledBackLastTick,N.k(this.Ej,F.Ej),N.k(this.resting,F.resting),this.inFluid=F.inFluid,this._ratioInFluid=F._ratioInFluid,N.k(this._forces,F._forces),N.k(this._impulses,F._impulses),this._sleepFrameCount=F._sleepFrameCount}setPosition(F){H(F),N.CP(F,F,this.Ni.base),this.Ni.translate(F),this.pj()}Af(){return N.clone(this.Ni.base)}applyForce(F){H(F),N.add(this._forces,this._forces,F),this.pj()}applyImpulse(F){H(F),N.add(this._impulses,this._impulses,F),this.pj()}pj(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var H=F=>{};var A=f(13656),o=f(12430),j=f(13658);function i(){this.zi=.1,this.fluidDrag=.4,this.bA=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function u(F,P,f){F=Object.assign(new i,F),this.gravity=F.gravity||[0,-10,0],this.zi=F.zi||.1,this.bA=F.bA||2,this.fluidDrag=F.fluidDrag||.4,this.minBounceImpulse=F.minBounceImpulse,this.bodies=[],this.NY=F.NY,this.testSolid=P,this.testFluid=f}u.prototype.vY=function(F,P,f,c,N,H){F=F||new A([0,0,0],[1,1,1]),"undefined"==typeof P&&(P=1),"undefined"==typeof f&&(f=1),"undefined"==typeof c&&(c=0),"undefined"==typeof N&&(N=1);var o=new q(F,P,f,c,N,H);return this.bodies.push(o),o},u.prototype.sY=function(F){var P=this.bodies.indexOf(F);P<0||(this.bodies.splice(P,1),F.Ni=F.pY=null)};var T=o.create(),Y=o.create(),t=o.create(),C=o.create(),L=o.create(),J=o.create(),B=o.create(),z=new A([0,0,0],[1,1,1]),Z=new q(z,1,1,0,1,(()=>{}),!1);function R(F,P,f){return P=f,P*=1-(1-F.ratioInFluid)**2}u.prototype.fo=function(F){F/=1e3;var P=e(0,o.squaredLength(this.gravity));this.bodies.forEach((f=>function(F,P,f,c){o.k(L,P.resting),F.NY&&Z.loadFromCopy(P);if(P.IN<=0)return o.set(P.Ej,0,0,0),o.set(P._forces,0,0,0),void o.set(P._impulses,0,0,0);var N=c||0===P.pA;if(function(F,P,f,c){if(P._sleepFrameCount>0)return!1;if(c)return!0;var N=!1,q=.5*f*f*P.pA;return o.scale(U,F.gravity,q),j(F.testSolid,P.Ni,U,(function(){return N=!0,!0}),!0),N}(F,P,f,N))return;P._sleepFrameCount--,function(F,P){var f=P.Ni,c=Math.floor(f.base[0]),N=Math.floor(f.base[2]),q=Math.floor(f.base[1]),H=Math.floor(f.max[1]);if(!F.testFluid(c,q,N))return P.inFluid=!1,void(P.ratioInFluid=0);var A=1,j=q+1;for(;j<=H&&F.testFluid(c,j,N);)A++,j++;var i=(q+A-f.base[1])/f.Zi[1];i>1&&(i=1);var u=f.Zi[0]*f.Zi[1]*f.Zi[2]*i,T=O;o.scale(T,F.gravity,-F.bA*u*P.pA),P.applyForce(T),P.inFluid=!0,P.ratioInFluid=i}(F,P),l(P._forces),l(P._impulses),l(P.Ej),l(P.resting),o.scale(T,P._forces,1/P.IN),o.aA(T,T,F.gravity,P.pA),o.scale(Y,P._impulses,1/P.IN),o.aA(Y,Y,T,f),o.add(P.Ej,P.Ej,Y),P.friction&&(d(F,0,P,Y,f),d(F,1,P,Y,f),d(F,2,P,Y,f));var q=P.fluidDrag>=0?P.fluidDrag:F.fluidDrag,H=P.zi>=0?P.zi:F.zi,A=H,i=H;P.inFluid&&(A=R(P,A,P.fluidDragHoriz>=0?P.fluidDragHoriz:q),i=R(P,i,P.fluidDragVert>=0?P.fluidDragVert:q));A=Math.max(1-A*f/P.IN,0),i=Math.max(1-i*f/P.IN,0),o.set(y,A,i,A),o.multiply(P.Ej,P.Ej,y),o.scale(t,P.Ej,f),o.set(P._forces,0,0,0),o.set(P._impulses,0,0,0),P.UA&&D(Q,P.Ni);o.k(J,t),o.set(B,0,0,0),P.preventFallOffEdge&&function(F,P,f,c){if(!P.resting[1]||f[1]>0)return;var N=r;D(N,P.Ni);for(var q=0;q<3;q+=2){o.set(E,0,0,0),E[q]=f[q];var H=!0;(H=(H=(H=(H=H&&!p(F,N.base[0]+E[0]+1e-5,N.base[1],N.base[2]+E[2]+1e-5))&&!p(F,N.max[0]+E[0]-1e-5,N.base[1],N.base[2]+E[2]+1e-5))&&!p(F,N.base[0]+E[0]+1e-5,N.base[1],N.max[2]+E[2]-1e-5))&&!p(F,N.max[0]+E[0]-1e-5,N.base[1],N.max[2]+E[2]-1e-5))?(c[q]=f[q]>0?1:-1,f[q]=0):0===q&&(o.set(n,f[0],0,0),V(F,N,n,c,P.slideOnCollision))}}(F,P,t,B);V(F,P.Ni,t,P.resting,P.slideOnCollision),P.UA&&function(F,P,f,c){if(P.resting[1]>=0&&!P.inFluid)return;var N=0!==P.resting[0],q=0!==P.resting[2];if(!N&&!q)return;var H=Math.abs(c[0]/c[2]),A=4;if(!N&&H>A)return;if(!q&&H<1/A)return;o.add(x,f.base,c);var i=F.testSolid;j(i,f,c,(function(F,P,f,c){if(1!==P)return!0;c[P]=0}));var u=f.base[1],T=P.inFluid?1.951:1.001,Y=Math.floor(u+T)-u;o.set(k,0,Y,0);var t=!1;if(j(i,f,k,(function(F,P,f,c){return t=!0,!0})),t)return;o.CP(I,x,f.base),I[1]=0,V(F,f,I,K,!0);var C=e(f.base[0],x[0]),L=e(f.base[2],x[2]);if(N&&!C&&(!L||!q))return;if(q&&(!C||!N)&&!L)return;var J=!0;if(J=J&&!p(F,f.base[0]+1e-5,f.base[1],f.base[2]+1e-5),J=J&&!p(F,f.max[0]-1e-5,f.base[1],f.base[2]+1e-5),J=J&&!p(F,f.base[0]+1e-5,f.base[1],f.max[2]-1e-5),J=J&&!p(F,f.max[0]-1e-5,f.base[1],f.max[2]-1e-5),J)return;D(P.Ni,f),P.resting[0]=K[0],P.resting[2]=K[2],P.yt&&P.yt()}(F,P,Q,J);for(var u=0;u<3;++u)P.resting[u]=P.resting[u]||B[u],C[u]=0,P.resting[u]&&(L[u]||(C[u]=-P.Ej[u]),P.Ej[u]=0);var z=o.length(C);z>.001&&(o.scale(C,C,P.IN),P.pY&&P.pY(C),P.restitution>0&&z>F.minBounceImpulse&&(o.scale(C,C,P.restitution),P.applyImpulse(C)));var M=o.squaredLength(P.Ej);M>1e-5&&P.pj();F.NY&&F.NY(P)?(P.loadFromCopy(Z),P.rolledBackLastTick=!0):P.rolledBackLastTick=!1}(this,f,F,P)))};var y=o.create([0,0,0]);var O=o.create();function d(F,P,f,c,N){var q=f.resting[P],H=c[P];if(!f.alwaysApplyHorizFriction||1!==P){if(0===q)return;if(q*H<=0)return}o.k(M,f.Ej),M[P]=0;var A=o.length(M);if(!e(A,0)){var j=Math.abs(f.friction*F.gravity[P]*N),i=A>j?(A-j)/A:0;f.Ej[(P+1)%3]*=i,f.Ej[(P+2)%3]*=i}}var M=o.create();function V(F,P,f,c,N){return o.set(c,0,0,0),j(F.testSolid,P,f,(function(F,P,f,q){c[P]=f,q[P]=0,N||(q[0]=0,q[1]=0,q[2]=0)}))}var Q=new A([],[]),K=o.create(),x=o.create(),k=o.create(),I=o.create();var E=o.create(),r=new A([],[]),n=o.create();function p(F,P,f,c){return F.testSolid(Math.floor(P),Math.floor(f-1),Math.floor(c))}var U=o.create();function e(F,P){return Math.abs(F-P)<1e-5}function D(F,P){for(var f=0;f<3;f++)F.base[f]=P.base[f],F.max[f]=P.max[f],F.Zi[f]=P.Zi[f]}var l=function(F){}},12307:function(F,P){!function(F){"use strict";var P=function(F,f){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,P){F.__proto__=P}||function(F,P){for(var f in P)Object.prototype.hasOwnProperty.call(P,f)&&(F[f]=P[f])},P(F,f)};function f(F,f){if("function"!==typeof f&&null!==f)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function c(){this.constructor=F}P(F,f),F.prototype=null===f?Object.create(f):(c.prototype=f.prototype,new c)}function c(F,P,f,c){var N,q=arguments.length,H=q<3?P:null===c?c=Object.getOwnPropertyDescriptor(P,f):c;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)H=Reflect.decorate(F,P,f,c);else for(var A=F.length-1;A>=0;A--)(N=F[A])&&(H=(q<3?N(H):q>3?N(P,f,H):N(P,f))||H);return q>3&&H&&Object.defineProperty(P,f,H),H}function N(F,P,f){if(f||2===arguments.length)for(var c,N=0,q=P.length;N<q;N++)!c&&N in P||(c||(c=Array.prototype.slice.call(P,0,N)),c[N]=P[N]);return F.concat(c||Array.prototype.slice.call(P))}var q,H=255,A=213;F.OPERATION=void 0,(q=F.OPERATION||(F.OPERATION={}))[q.ADD=128]="ADD",q[q.REPLACE=0]="REPLACE",q[q.DELETE=64]="DELETE",q[q.DELETE_AND_ADD=192]="DELETE_AND_ADD",q[q.TOUCH=1]="TOUCH",q[q.CLEAR=10]="CLEAR";var o=function(){function P(F,P,f){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=F,this.setParent(P,f)}return P.prototype.setParent=function(F,P,f){var c=this;if(this.indexes||(this.indexes=this.ref instanceof IF?this.ref._definition.indexes:{}),this.parent=F,this.parentIndex=f,P)if(this.root=P,this.ref instanceof IF){var N=this.ref._definition;for(var q in N.schema){var H=this.ref[q];if(H&&H.$changes){var A=N.indexes[q];H.$changes.setParent(this.ref,P,A)}}}else"object"===typeof this.ref&&this.ref.forEach((function(F,P){if(F instanceof IF){var f=F.$changes,N=c.ref.$changes.indexes[P];f.setParent(c.ref,c.root,N)}}))},P.prototype.operation=function(F){this.changes.set(--this.currentCustomOperation,F)},P.prototype.change=function(P,f){void 0===f&&(f=F.OPERATION.ADD);var c="number"===typeof P?P:this.indexes[P];this.assertValidIndex(c,P);var N=this.changes.get(c);N&&N.op!==F.OPERATION.DELETE&&N.op!==F.OPERATION.TOUCH||this.changes.set(c,{op:N&&N.op===F.OPERATION.DELETE?F.OPERATION.DELETE_AND_ADD:f,index:c}),this.allChanges.add(c),this.changed=!0,this.touchParents()},P.prototype.touch=function(P){var f="number"===typeof P?P:this.indexes[P];this.assertValidIndex(f,P),this.changes.has(f)||this.changes.set(f,{op:F.OPERATION.TOUCH,index:f}),this.allChanges.add(f),this.touchParents()},P.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},P.prototype.getType=function(F){if(this.ref._definition)return(P=this.ref._definition).schema[P.fieldsByIndex[F]];var P,f=(P=this.parent._definition).schema[P.fieldsByIndex[this.parentIndex]];return Object.values(f)[0]},P.prototype.getChildrenFilter=function(){var F=this.parent._definition.childFilters;return F&&F[this.parentIndex]},P.prototype.getValue=function(F){return this.ref.getByIndex(F)},P.prototype.delete=function(P){var f="number"===typeof P?P:this.indexes[P];if(void 0!==f){var c=this.getValue(f);this.changes.set(f,{op:F.OPERATION.DELETE,index:f}),this.allChanges.delete(f),delete this.caches[f],c&&c.$changes&&(c.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(P," (").concat(f,")"))},P.prototype.discard=function(P,f){var c=this;void 0===P&&(P=!1),void 0===f&&(f=!1),this.ref instanceof IF||this.changes.forEach((function(P){if(P.op===F.OPERATION.DELETE){var f=c.ref.getIndex(P.index);delete c.indexes[f]}})),this.changes.clear(),this.changed=P,f&&this.allChanges.clear(),this.currentCustomOperation=0},P.prototype.discardAll=function(){var F=this;this.changes.forEach((function(P){var f=F.getValue(P.index);f&&f.$changes&&f.$changes.discardAll()})),this.discard()},P.prototype.cache=function(F,P){this.caches[F]=P},P.prototype.clone=function(){return new P(this.ref,this.parent,this.root)},P.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},P.prototype.assertValidIndex=function(F,P){if(void 0===F)throw new Error('ChangeTree: missing index for field "'.concat(P,'"'))},P}();function j(F,P,f,c){return F[P]||(F[P]=[]),F[P].push(f),null===c||void 0===c||c.forEach((function(F,P){return f(F,P)})),function(){return u(F[P],F[P].indexOf(f))}}function i(P){var f=this,c="string"!==typeof this.$changes.getType();this.$items.forEach((function(N,q){P.push({refId:f.$changes.refId,op:F.OPERATION.DELETE,field:q,value:void 0,previousValue:N}),c&&f.$changes.root.removeRef(N.$changes.refId)}))}function u(F,P){if(-1===P||P>=F.length)return!1;for(var f=F.length-1,c=P;c<f;c++)F[c]=F[c+1];return F.length=f,!0}var T=function(F,P){var f=F.toString(),c=P.toString();return f<c?-1:f>c?1:0};function Y(F){return F.$proxy=!0,F=new Proxy(F,{get:function(F,P){return"symbol"===typeof P||isNaN(P)?F[P]:F.at(P)},set:function(F,P,f){if("symbol"===typeof P||isNaN(P))F[P]=f;else{var c=Array.from(F.$items.keys()),N=parseInt(c[P]||P);void 0===f||null===f?F.deleteAt(N):F.setAt(N,f)}return!0},deleteProperty:function(F,P){return"number"===typeof P?F.deleteAt(P):delete F[P],!0}})}var t=function(){function P(){for(var F=[],P=0;P<arguments.length;P++)F[P]=arguments[P];this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,F)}return P.prototype.eq=function(P,f){return void 0===f&&(f=!0),j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.ADD,P,f?this.$items:void 0)},P.prototype.Ff=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,P)},P.prototype.onChange=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,P)},P.is=function(F){return Array.isArray(F)||void 0!==F.array},Object.defineProperty(P.prototype,"length",{get:function(){return this.$items.size},set:function(F){0===F?this.clear():this.splice(F,this.length-F)},enumerable:!1,configurable:!0}),P.prototype.push=function(){for(var F,P=this,f=[],c=0;c<arguments.length;c++)f[c]=arguments[c];return f.forEach((function(f){F=P.$refId++,P.setAt(F,f)})),F},P.prototype.pop=function(){var F=Array.from(this.$indexes.values()).pop();if(void 0!==F){this.$changes.delete(F),this.$indexes.delete(F);var P=this.$items.get(F);return this.$items.delete(F),P}},P.prototype.at=function(F){var P=Array.from(this.$items.keys())[F];return this.$items.get(P)},P.prototype.setAt=function(P,f){var c,N;if(void 0!==f&&null!==f){if(this.$items.get(P)!==f){void 0!==f.$changes&&f.$changes.setParent(this,this.$changes.root,P);var q=null!==(N=null===(c=this.$changes.indexes[P])||void 0===c?void 0:c.op)&&void 0!==N?N:F.OPERATION.ADD;this.$changes.indexes[P]=P,this.$indexes.set(P,P),this.$items.set(P,f),this.$changes.change(P,q)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},P.prototype.deleteAt=function(F){var P=Array.from(this.$items.keys())[F];return void 0!==P&&this.$deleteAt(P)},P.prototype.$deleteAt=function(F){return this.$changes.delete(F),this.$indexes.delete(F),this.$items.delete(F)},P.prototype.clear=function(P){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),P&&i.call(this,P),this.$items.clear(),this.$changes.operation({index:0,op:F.OPERATION.CLEAR}),this.$changes.touchParents()},P.prototype.concat=function(){for(var F,f=[],c=0;c<arguments.length;c++)f[c]=arguments[c];return new(P.bind.apply(P,N([void 0],(F=Array.from(this.$items.values())).concat.apply(F,f),!1)))},P.prototype.join=function(F){return Array.from(this.$items.values()).join(F)},P.prototype.reverse=function(){var F=this,P=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(f,c){F.setAt(P[c],f)})),this},P.prototype.shift=function(){var F=Array.from(this.$items.keys()).shift();if(void 0!==F){var P=this.$items.get(F);return this.$deleteAt(F),P}},P.prototype.slice=function(F,f){var c=new P;return c.push.apply(c,Array.from(this.$items.values()).slice(F,f)),c},P.prototype.sort=function(F){var P=this;void 0===F&&(F=T);var f=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(F).forEach((function(F,c){P.setAt(f[c],F)})),this},P.prototype.splice=function(F,P){void 0===P&&(P=this.length-F);for(var f=Array.from(this.$items.keys()),c=[],N=F;N<F+P;N++)c.push(this.$items.get(f[N])),this.$deleteAt(f[N]);return c},P.prototype.unshift=function(){for(var F=this,P=[],f=0;f<arguments.length;f++)P[f]=arguments[f];var c=this.length,N=P.length,q=Array.from(this.$items.values());return P.forEach((function(P,f){F.setAt(f,P)})),q.forEach((function(P,f){F.setAt(N+f,P)})),c+N},P.prototype.indexOf=function(F,P){return Array.from(this.$items.values()).indexOf(F,P)},P.prototype.lastIndexOf=function(F,P){return void 0===P&&(P=this.length-1),Array.from(this.$items.values()).lastIndexOf(F,P)},P.prototype.every=function(F,P){return Array.from(this.$items.values()).every(F,P)},P.prototype.some=function(F,P){return Array.from(this.$items.values()).some(F,P)},P.prototype.forEach=function(F,P){Array.from(this.$items.values()).forEach(F,P)},P.prototype.map=function(F,P){return Array.from(this.$items.values()).map(F,P)},P.prototype.filter=function(F,P){return Array.from(this.$items.values()).filter(F,P)},P.prototype.reduce=function(F,P){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},P.prototype.reduceRight=function(F,P){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},P.prototype.find=function(F,P){return Array.from(this.$items.values()).find(F,P)},P.prototype.findIndex=function(F,P){return Array.from(this.$items.values()).findIndex(F,P)},P.prototype.fill=function(F,P,f){throw new Error("ArraySchema#fill() not implemented")},P.prototype.copyWithin=function(F,P,f){throw new Error("ArraySchema#copyWithin() not implemented")},P.prototype.toString=function(){return this.$items.toString()},P.prototype.toLocaleString=function(){return this.$items.toLocaleString()},P.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(P,Symbol.species,{get:function(){return P},enumerable:!1,configurable:!0}),P.prototype.entries=function(){return this.$items.entries()},P.prototype.keys=function(){return this.$items.keys()},P.prototype.values=function(){return this.$items.values()},P.prototype.includes=function(F,P){return Array.from(this.$items.values()).includes(F,P)},P.prototype.flatMap=function(F,P){throw new Error("ArraySchema#flatMap() is not supported.")},P.prototype.flat=function(F){throw new Error("ArraySchema#flat() is not supported.")},P.prototype.findLast=function(){var F=Array.from(this.$items.values());return F.findLast.apply(F,arguments)},P.prototype.findLastIndex=function(){var F=Array.from(this.$items.values());return F.findLastIndex.apply(F,arguments)},P.prototype.setIndex=function(F,P){this.$indexes.set(F,P)},P.prototype.getIndex=function(F){return this.$indexes.get(F)},P.prototype.getByIndex=function(F){return this.$items.get(this.$indexes.get(F))},P.prototype.deleteByIndex=function(F){var P=this.$indexes.get(F);this.$items.delete(P),this.$indexes.delete(F)},P.prototype.toArray=function(){return Array.from(this.$items.values())},P.prototype.toJSON=function(){return this.toArray().map((function(F){return"function"===typeof F.toJSON?F.toJSON():F}))},P.prototype.clone=function(F){return F?new(P.bind.apply(P,N([void 0],Array.from(this.$items.values()),!1))):new(P.bind.apply(P,N([void 0],this.map((function(F){return F.$changes?F.clone():F})),!1)))},P}();function C(F){return F.$proxy=!0,F=new Proxy(F,{get:function(F,P){return"symbol"!==typeof P&&"undefined"===typeof F[P]?F.get(P):F[P]},set:function(F,P,f){return"symbol"!==typeof P&&-1===P.indexOf("$")&&"eq"!==P&&"Ff"!==P&&"onChange"!==P?F.set(P,f):F[P]=f,!0},deleteProperty:function(F,P){return F.delete(P),!0}})}var L=function(){function P(F){var f=this;if(this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,F)if(F instanceof Map||F instanceof P)F.forEach((function(F,P){return f.set(P,F)}));else for(var c in F)this.set(c,F[c])}return P.prototype.eq=function(P,f){return void 0===f&&(f=!0),j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.ADD,P,f?this.$items:void 0)},P.prototype.Ff=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,P)},P.prototype.onChange=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,P)},P.is=function(F){return void 0!==F.map},P.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(P.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(P,Symbol.species,{get:function(){return P},enumerable:!1,configurable:!0}),P.prototype.set=function(P,f){if(void 0===f||null===f)throw new Error("MapSchema#set('".concat(P,"', ").concat(f,"): trying to set ").concat(f," value on '").concat(P,"'."));P=P.toString();var c="undefined"!==typeof this.$changes.indexes[P],N=c?this.$changes.indexes[P]:this.$refId++,q=c?F.OPERATION.REPLACE:F.OPERATION.ADD,H=void 0!==f.$changes;if(H&&f.$changes.setParent(this,this.$changes.root,N),c){if(!H&&this.$items.get(P)===f)return;H&&this.$items.get(P)!==f&&(q=F.OPERATION.ADD)}else this.$changes.indexes[P]=N,this.$indexes.set(N,P);return this.$items.set(P,f),this.$changes.change(P,q),this},P.prototype.get=function(F){return this.$items.get(F)},P.prototype.delete=function(F){return this.$changes.delete(F),this.$items.delete(F)},P.prototype.clear=function(P){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),P&&i.call(this,P),this.$items.clear(),this.$changes.operation({index:0,op:F.OPERATION.CLEAR}),this.$changes.touchParents()},P.prototype.has=function(F){return this.$items.has(F)},P.prototype.forEach=function(F){this.$items.forEach(F)},P.prototype.entries=function(){return this.$items.entries()},P.prototype.keys=function(){return this.$items.keys()},P.prototype.values=function(){return this.$items.values()},Object.defineProperty(P.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),P.prototype.setIndex=function(F,P){this.$indexes.set(F,P)},P.prototype.getIndex=function(F){return this.$indexes.get(F)},P.prototype.getByIndex=function(F){return this.$items.get(this.$indexes.get(F))},P.prototype.deleteByIndex=function(F){var P=this.$indexes.get(F);this.$items.delete(P),this.$indexes.delete(F)},P.prototype.toJSON=function(){var F={};return this.forEach((function(P,f){F[f]="function"===typeof P.toJSON?P.toJSON():P})),F},P.prototype.clone=function(F){var f;return F?f=Object.assign(new P,this):(f=new P,this.forEach((function(F,P){F.$changes?f.set(P,F.clone()):f.set(P,F)}))),f},P}(),J={};function B(F,P){J[F]=P}function z(F){return J[F]}var Z=function(){function F(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return F.create=function(P){var f=new F;return f.schema=Object.assign({},P&&P.schema||{}),f.indexes=Object.assign({},P&&P.indexes||{}),f.fieldsByIndex=Object.assign({},P&&P.fieldsByIndex||{}),f.descriptors=Object.assign({},P&&P.descriptors||{}),f.deprecated=Object.assign({},P&&P.deprecated||{}),f},F.prototype.addField=function(F,P){var f=this.getNextFieldIndex();this.fieldsByIndex[f]=F,this.indexes[F]=f,this.schema[F]=Array.isArray(P)?{array:P[0]}:P},F.prototype.hasField=function(F){return void 0!==this.indexes[F]},F.prototype.addFilter=function(F,P){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[F]]=P,this.indexesWithFilters.push(this.indexes[F]),!0},F.prototype.addChildrenFilter=function(F,P){var f=this.indexes[F],c=this.schema[F];if(z(Object.keys(c)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[f]=P,!0;console.warn("@filterChildren: field '".concat(F,"' can't have children. Ignoring filter."))},F.prototype.getChildrenFilter=function(F){return this.childFilters&&this.childFilters[this.indexes[F]]},F.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},F}();function R(F){return F._context&&F._context.useFilters}var y=function(){function F(){this.types={},this.schemas=new Map,this.useFilters=!1}return F.prototype.has=function(F){return this.schemas.has(F)},F.prototype.get=function(F){return this.types[F]},F.prototype.add=function(F,P){void 0===P&&(P=this.schemas.size),F._definition=Z.create(F._definition),F._typeid=P,this.types[P]=F,this.schemas.set(F,P)},F.create=function(P){return void 0===P&&(P={}),function(f){return P.context||(P.context=new F),d(f,P)}},F}(),O=new y;function d(F,P){return void 0===P&&(P={}),function(f,c){var q=P.context||O,H=f.constructor;if(H._context=q,!F)throw new Error("".concat(H.name,': @type() reference provided for "').concat(c,"\" is undefined. Make sure you don't have any circular dependencies."));q.has(H)||q.add(H);var A=H._definition;if(A.addField(c,F),A.descriptors[c]){if(A.deprecated[c])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(c,"' definition on '").concat(H.name,"'.\nCheck @type() annotation"))}catch(J){var o=J.stack.split("\n")[4].trim();throw new Error("".concat(J.message," ").concat(o))}}var j=t.is(F),i=!j&&L.is(F);if("string"!==typeof F&&!IF.is(F)){var u=Object.values(F)[0];"string"===typeof u||q.has(u)||q.add(u)}if(P.manual)A.descriptors[c]={enumerable:!0,configurable:!0,writable:!0};else{var T="_".concat(c);A.descriptors[T]={enumerable:!1,configurable:!1,writable:!0},A.descriptors[c]={get:function(){return this[T]},set:function(F){F!==this[T]&&(void 0!==F&&null!==F?(!j||F instanceof t||(F=new(t.bind.apply(t,N([void 0],F,!1)))),!i||F instanceof L||(F=new L(F)),void 0===F.$proxy&&(i?F=C(F):j&&(F=Y(F))),this.$changes.change(c),F.$changes&&F.$changes.setParent(this,this.$changes.root,this._definition.indexes[c])):this[T]&&this.$changes.delete(c),this[T]=F)},enumerable:!0,configurable:!0}}}}function M(F){return function(P,f){var c=P.constructor;c._definition.addFilter(f,F)&&(c._context.useFilters=!0)}}function V(F){return function(P,f){var c=P.constructor;c._definition.addChildrenFilter(f,F)&&(c._context.useFilters=!0)}}function Q(F){return void 0===F&&(F=!0),function(P,f){var c=P.constructor._definition;c.deprecated[f]=!0,F&&(c.descriptors[f]={get:function(){throw new Error("".concat(f," is deprecated."))},set:function(F){},enumerable:!1,configurable:!0})}}function K(F,P,f){for(var c in void 0===f&&(f={}),f.context||(f.context=F._context||f.context||O),P)d(P[c],f)(F.prototype,c);return F}function x(F){for(var P=0,f=0,c=0,N=F.length;c<N;c++)(P=F.charCodeAt(c))<128?f+=1:P<2048?f+=2:P<55296||P>=57344?f+=3:(c++,f+=4);return f}function k(F,P,f){for(var c=0,N=0,q=f.length;N<q;N++)(c=f.charCodeAt(N))<128?F[P++]=c:c<2048?(F[P++]=192|c>>6,F[P++]=128|63&c):c<55296||c>=57344?(F[P++]=224|c>>12,F[P++]=128|c>>6&63,F[P++]=128|63&c):(N++,c=65536+((1023&c)<<10|1023&f.charCodeAt(N)),F[P++]=240|c>>18,F[P++]=128|c>>12&63,F[P++]=128|c>>6&63,F[P++]=128|63&c)}function I(F,P){F.push(255&P)}function E(F,P){F.push(255&P)}function r(F,P){F.push(255&P),F.push(P>>8&255)}function n(F,P){F.push(255&P),F.push(P>>8&255)}function p(F,P){F.push(255&P),F.push(P>>8&255),F.push(P>>16&255),F.push(P>>24&255)}function U(F,P){var f=P>>24,c=P>>16,N=P>>8,q=P;F.push(255&q),F.push(255&N),F.push(255&c),F.push(255&f)}function e(F,P){var f=Math.floor(P/Math.pow(2,32));U(F,P>>>0),U(F,f)}function D(F,P){var f=P/Math.pow(2,32)|0;U(F,P>>>0),U(F,f)}function l(F,P){X(F,P)}function W(F,P){m(F,P)}var b=new Int32Array(2),v=new Float32Array(b.buffer),s=new Float64Array(b.buffer);function X(F,P){v[0]=P,p(F,b[0])}function m(F,P){s[0]=P,p(F,b[0]),p(F,b[1])}function a(F,P){return E(F,P?1:0)}function w(F,P){P||(P="");var f=x(P),c=0;if(f<32)F.push(160|f),c=1;else if(f<256)F.push(217),E(F,f),c=2;else if(f<65536)F.push(218),n(F,f),c=3;else{if(!(f<4294967296))throw new Error("String too long");F.push(219),U(F,f),c=5}return k(F,F.length,P),c+f}function g(F,P){return isNaN(P)?g(F,0):isFinite(P)?P!==(0|P)?(F.push(203),m(F,P),9):P>=0?P<128?(E(F,P),1):P<256?(F.push(204),E(F,P),2):P<65536?(F.push(205),n(F,P),3):P<4294967296?(F.push(206),U(F,P),5):(F.push(207),D(F,P),9):P>=-32?(F.push(224|P+32),1):P>=-128?(F.push(208),I(F,P),2):P>=-32768?(F.push(209),r(F,P),3):P>=-2147483648?(F.push(210),p(F,P),5):(F.push(211),e(F,P),9):g(F,P>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var G=Object.freeze({__proto__:null,utf8Write:k,int8:I,uint8:E,int16:r,uint16:n,int32:p,uint32:U,int64:e,uint64:D,float32:l,float64:W,writeFloat32:X,writeFloat64:m,boolean:a,string:w,number:g});function h(F,P,f){for(var c="",N=0,q=P,H=P+f;q<H;q++){var A=F[q];0!==(128&A)?192!==(224&A)?224!==(240&A)?240!==(248&A)?console.error("Invalid byte "+A.toString(16)):(N=(7&A)<<18|(63&F[++q])<<12|(63&F[++q])<<6|63&F[++q])>=65536?(N-=65536,c+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):c+=String.fromCharCode(N):c+=String.fromCharCode((15&A)<<12|(63&F[++q])<<6|63&F[++q]):c+=String.fromCharCode((31&A)<<6|63&F[++q]):c+=String.fromCharCode(A)}return c}function S(F,P){return FF(F,P)<<24>>24}function FF(F,P){return F[P.offset++]}function PF(F,P){return fF(F,P)<<16>>16}function fF(F,P){return F[P.offset++]|F[P.offset++]<<8}function cF(F,P){return F[P.offset++]|F[P.offset++]<<8|F[P.offset++]<<16|F[P.offset++]<<24}function NF(F,P){return cF(F,P)>>>0}function qF(F,P){return TF(F,P)}function HF(F,P){return YF(F,P)}function AF(F,P){var f=NF(F,P);return cF(F,P)*Math.pow(2,32)+f}function oF(F,P){var f=NF(F,P);return NF(F,P)*Math.pow(2,32)+f}var jF=new Int32Array(2),iF=new Float32Array(jF.buffer),uF=new Float64Array(jF.buffer);function TF(F,P){return jF[0]=cF(F,P),iF[0]}function YF(F,P){return jF[0]=cF(F,P),jF[1]=cF(F,P),uF[0]}function tF(F,P){return FF(F,P)>0}function CF(F,P){var f,c=F[P.offset++];c<192?f=31&c:217===c?f=FF(F,P):218===c?f=fF(F,P):219===c&&(f=NF(F,P));var N=h(F,P.offset,f);return P.offset+=f,N}function LF(F,P){var f=F[P.offset];return f<192&&f>160||217===f||218===f||219===f}function JF(F,P){var f=F[P.offset++];return f<128?f:202===f?TF(F,P):203===f?YF(F,P):204===f?FF(F,P):205===f?fF(F,P):206===f?NF(F,P):207===f?oF(F,P):208===f?S(F,P):209===f?PF(F,P):210===f?cF(F,P):211===f?AF(F,P):f>223?-1*(255-f+1):void 0}function BF(F,P){var f=F[P.offset];return f<128||f>=202&&f<=211}function zF(F,P){return F[P.offset]<160}function ZF(F,P){return F[P.offset-1]===H&&(F[P.offset]<128||F[P.offset]>=202&&F[P.offset]<=211)}var RF=Object.freeze({__proto__:null,int8:S,uint8:FF,int16:PF,uint16:fF,int32:cF,uint32:NF,float32:qF,float64:HF,int64:AF,uint64:oF,readFloat32:TF,readFloat64:YF,boolean:tF,string:CF,stringCheck:LF,number:JF,numberCheck:BF,arrayCheck:zF,switchStructureCheck:ZF}),yF=function(){function P(F){var P=this;this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,F&&F.forEach((function(F){return P.add(F)}))}return P.prototype.eq=function(P,f){return void 0===f&&(f=!0),j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.ADD,P,f?this.$items:void 0)},P.prototype.Ff=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,P)},P.prototype.onChange=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,P)},P.is=function(F){return void 0!==F.collection},P.prototype.add=function(F){var P=this.$refId++;return void 0!==F.$changes&&F.$changes.setParent(this,this.$changes.root,P),this.$changes.indexes[P]=P,this.$indexes.set(P,P),this.$items.set(P,F),this.$changes.change(P),P},P.prototype.at=function(F){var P=Array.from(this.$items.keys())[F];return this.$items.get(P)},P.prototype.entries=function(){return this.$items.entries()},P.prototype.delete=function(F){for(var P,f,c=this.$items.entries();(f=c.next())&&!f.done;)if(F===f.value[1]){P=f.value[0];break}return void 0!==P&&(this.$changes.delete(P),this.$indexes.delete(P),this.$items.delete(P))},P.prototype.clear=function(P){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),P&&i.call(this,P),this.$items.clear(),this.$changes.operation({index:0,op:F.OPERATION.CLEAR}),this.$changes.touchParents()},P.prototype.has=function(F){return Array.from(this.$items.values()).some((function(P){return P===F}))},P.prototype.forEach=function(F){var P=this;this.$items.forEach((function(f,c,N){return F(f,c,P)}))},P.prototype.values=function(){return this.$items.values()},Object.defineProperty(P.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),P.prototype.setIndex=function(F,P){this.$indexes.set(F,P)},P.prototype.getIndex=function(F){return this.$indexes.get(F)},P.prototype.getByIndex=function(F){return this.$items.get(this.$indexes.get(F))},P.prototype.deleteByIndex=function(F){var P=this.$indexes.get(F);this.$items.delete(P),this.$indexes.delete(F)},P.prototype.toArray=function(){return Array.from(this.$items.values())},P.prototype.toJSON=function(){var F=[];return this.forEach((function(P,f){F.push("function"===typeof P.toJSON?P.toJSON():P)})),F},P.prototype.clone=function(F){var f;return F?f=Object.assign(new P,this):(f=new P,this.forEach((function(F){F.$changes?f.add(F.clone()):f.add(F)}))),f},P}(),OF=function(){function P(F){var P=this;this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,F&&F.forEach((function(F){return P.add(F)}))}return P.prototype.eq=function(P,f){return void 0===f&&(f=!0),j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.ADD,P,f?this.$items:void 0)},P.prototype.Ff=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,P)},P.prototype.onChange=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,P)},P.is=function(F){return void 0!==F.set},P.prototype.add=function(P){var f,c;if(this.has(P))return!1;var N=this.$refId++;void 0!==P.$changes&&P.$changes.setParent(this,this.$changes.root,N);var q=null!==(c=null===(f=this.$changes.indexes[N])||void 0===f?void 0:f.op)&&void 0!==c?c:F.OPERATION.ADD;return this.$changes.indexes[N]=N,this.$indexes.set(N,N),this.$items.set(N,P),this.$changes.change(N,q),N},P.prototype.entries=function(){return this.$items.entries()},P.prototype.delete=function(F){for(var P,f,c=this.$items.entries();(f=c.next())&&!f.done;)if(F===f.value[1]){P=f.value[0];break}return void 0!==P&&(this.$changes.delete(P),this.$indexes.delete(P),this.$items.delete(P))},P.prototype.clear=function(P){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),P&&i.call(this,P),this.$items.clear(),this.$changes.operation({index:0,op:F.OPERATION.CLEAR}),this.$changes.touchParents()},P.prototype.has=function(F){for(var P,f=this.$items.values(),c=!1;(P=f.next())&&!P.done;)if(F===P.value){c=!0;break}return c},P.prototype.forEach=function(F){var P=this;this.$items.forEach((function(f,c,N){return F(f,c,P)}))},P.prototype.values=function(){return this.$items.values()},Object.defineProperty(P.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),P.prototype.setIndex=function(F,P){this.$indexes.set(F,P)},P.prototype.getIndex=function(F){return this.$indexes.get(F)},P.prototype.getByIndex=function(F){return this.$items.get(this.$indexes.get(F))},P.prototype.deleteByIndex=function(F){var P=this.$indexes.get(F);this.$items.delete(P),this.$indexes.delete(F)},P.prototype.toArray=function(){return Array.from(this.$items.values())},P.prototype.toJSON=function(){var F=[];return this.forEach((function(P,f){F.push("function"===typeof P.toJSON?P.toJSON():P)})),F},P.prototype.clone=function(F){var f;return F?f=Object.assign(new P,this):(f=new P,this.forEach((function(F){F.$changes?f.add(F.clone()):f.add(F)}))),f},P}(),dF=function(){function F(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return F.prototype.addRefId=function(F){this.refIds.has(F)||(this.refIds.add(F),this.containerIndexes.set(F,new Set))},F.get=function(P){return void 0===P.$filterState&&(P.$filterState=new F),P.$filterState},F}(),MF=function(){function F(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return F.prototype.getNextUniqueId=function(){return this.nextUniqueId++},F.prototype.addRef=function(F,P,f){void 0===f&&(f=!0),this.refs.set(F,P),f&&(this.refCounts[F]=(this.refCounts[F]||0)+1)},F.prototype.removeRef=function(F){this.refCounts[F]=this.refCounts[F]-1,this.deletedRefs.add(F)},F.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},F.prototype.garbageCollectDeletedRefs=function(){var F=this;this.deletedRefs.forEach((function(P){if(!(F.refCounts[P]>0)){var f=F.refs.get(P);if(f instanceof IF)for(var c in f._definition.schema)"string"!==typeof f._definition.schema[c]&&f[c]&&f[c].$changes&&F.removeRef(f[c].$changes.refId);else{var N=f.$changes.parent._definition,q=N.schema[N.fieldsByIndex[f.$changes.parentIndex]];"function"===typeof Object.values(q)[0]&&Array.from(f.values()).forEach((function(P){return F.removeRef(P.$changes.refId)}))}F.refs.delete(P),delete F.refCounts[P]}})),this.deletedRefs.clear()},F}(),VF=function(F){function P(){return null!==F&&F.apply(this,arguments)||this}return f(P,F),P}(Error);function QF(F,P,f,c){var N,q=!1;switch(P){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":N="number",isNaN(F)&&console.log('trying to encode "NaN" in '.concat(f.constructor.name,"#").concat(c));break;case"string":N="string",q=!0;break;case"boolean":return}if(typeof F!==N&&(!q||q&&null!==F)){var H="'".concat(JSON.stringify(F),"'").concat(F&&F.constructor&&" (".concat(F.constructor.name,")")||"");throw new VF("a '".concat(N,"' was expected, but ").concat(H," was provided in ").concat(f.constructor.name,"#").concat(c))}}function KF(F,P,f,c){if(!(F instanceof P))throw new VF("a '".concat(P.name,"' was expected, but '").concat(F.constructor.name,"' was provided in ").concat(f.constructor.name,"#").concat(c))}function xF(F,P,f,c,N){QF(f,F,c,N);var q=G[F];if(!q)throw new VF("a '".concat(F,"' was expected, but ").concat(f," was provided in ").concat(c.constructor.name,"#").concat(N));q(P,f)}function kF(F,P,f){return RF[F](P,f)}var IF=function(){function P(){for(var F=[],P=0;P<arguments.length;P++)F[P]=arguments[P];Object.defineProperties(this,{$changes:{value:new o(this,void 0,new MF),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var f=this._definition.descriptors;f&&Object.defineProperties(this,f),F[0]&&this.assign(F[0])}return P.onError=function(F){console.error(F)},P.is=function(F){return F._definition&&void 0!==F._definition.schema},P.prototype.onChange=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,P)},P.prototype.Ff=function(P){return j(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,P)},P.prototype.assign=function(F){return Object.assign(this,F),this},Object.defineProperty(P.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),P.prototype.setDirty=function(F,P){this.$changes.change(F,P)},P.prototype.listen=function(F,P,f){var c=this;return void 0===f&&(f=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[F]||(this.$callbacks[F]=[]),this.$callbacks[F].push(P),f&&void 0!==this[F]&&P(this[F],void 0),function(){return u(c.$callbacks[F],c.$callbacks[F].indexOf(P))}},P.prototype.decode=function(f,c,N){var q;void 0===c&&(c={offset:0}),void 0===N&&(N=this);var A=[],o=this.$changes.root,j=f.length,i=0;for(o.refs.set(i,this);c.offset<j;){var u=f[c.offset++];if(u!=H){var T=N.$changes,Y=void 0!==N._definition,C=Y?u>>6<<6:u;if(C!==F.OPERATION.CLEAR){var J=Y?u%(C||255):JF(f,c),B=Y?N._definition.fieldsByIndex[J]:"",Z=T.getType(J),R=void 0,y=void 0,O=void 0;if(Y?y=N["_".concat(B)]:(y=N.getByIndex(J),(C&F.OPERATION.ADD)===F.OPERATION.ADD?(O=N instanceof L?CF(f,c):J,N.setIndex(J,O)):O=N.getIndex(J)),(C&F.OPERATION.DELETE)===F.OPERATION.DELETE&&(C!==F.OPERATION.DELETE_AND_ADD&&N.deleteByIndex(J),y&&y.$changes&&o.removeRef(y.$changes.refId),R=null),void 0!==B){if(C===F.OPERATION.DELETE);else if(P.is(Z)){var d=JF(f,c);if(R=o.refs.get(d),C!==F.OPERATION.REPLACE){var M=this.getSchemaType(f,c,Z);R||((R=this.createTypeInstance(M)).$changes.refId=d,y&&(R.$callbacks=y.$callbacks,y.$changes.refId&&d!==y.$changes.refId&&o.removeRef(y.$changes.refId))),o.addRef(d,R,R!==y)}}else if("string"===typeof Z)R=kF(Z,f,c);else{var V=z(Object.keys(Z)[0]),Q=JF(f,c),K=o.refs.has(Q)?y||o.refs.get(Q):new V.constructor;if((R=K.clone(!0)).$changes.refId=Q,y&&(R.$callbacks=y.$callbacks,y.$changes.refId&&Q!==y.$changes.refId)){o.removeRef(y.$changes.refId);for(var x=y.entries(),k=void 0;(k=x.next())&&!k.done;){var I=(q=k.value)[0],E=q[1];A.push({refId:Q,op:F.OPERATION.DELETE,field:I,value:void 0,previousValue:E})}}o.addRef(Q,R,K!==y)}if(null!==R&&void 0!==R)if(R.$changes&&R.$changes.setParent(T.ref,T.root,J),N instanceof P)N[B]=R;else if(N instanceof L)I=O,N.$items.set(I,R),N.$changes.allChanges.add(J);else if(N instanceof t)N.setAt(J,R);else if(N instanceof yF){var r=N.add(R);N.setIndex(J,r)}else N instanceof OF&&!1!==(r=N.add(R))&&N.setIndex(J,r);y!==R&&A.push({refId:i,op:C,field:B,dynamicIndex:O,value:R,previousValue:y})}else{console.warn("@colyseus/schema: definition mismatch");for(var n={offset:c.offset};c.offset<j&&(!ZF(f,c)||(n.offset=c.offset+1,!o.refs.has(JF(f,n))));)c.offset++}}else N.clear(A)}else{i=JF(f,c);var p=o.refs.get(i);if(!p)throw new Error('"refId" not found: '.concat(i));N=p}}return this._triggerChanges(A),o.garbageCollectDeletedRefs(),A},P.prototype.encode=function(f,c,N){void 0===f&&(f=!1),void 0===c&&(c=[]),void 0===N&&(N=!1);for(var q=this.$changes,A=new WeakSet,o=[q],j=1,i=0;i<j;i++){var u=o[i],T=u.ref,Y=T instanceof P;u.ensureRefId(),A.add(u),u!==q&&(u.changed||f)&&(E(c,H),g(c,u.refId));for(var t=f?Array.from(u.allChanges):Array.from(u.changes.values()),C=0,J=t.length;C<J;C++){var B=f?{op:F.OPERATION.ADD,index:t[C]}:t[C],Z=B.index,R=Y?T._definition.fieldsByIndex&&T._definition.fieldsByIndex[Z]:Z,y=c.length;if(B.op!==F.OPERATION.TOUCH)if(Y)E(c,Z|B.op);else{if(E(c,B.op),B.op===F.OPERATION.CLEAR)continue;g(c,Z)}if(Y||(B.op&F.OPERATION.ADD)!=F.OPERATION.ADD||T instanceof L&&w(c,u.ref.$indexes.get(Z)),B.op!==F.OPERATION.DELETE){var O=u.getType(Z),d=u.getValue(Z);if(d&&d.$changes&&!A.has(d.$changes)&&(o.push(d.$changes),d.$changes.ensureRefId(),j++),B.op!==F.OPERATION.TOUCH){if(P.is(O))KF(d,O,T,R),g(c,d.$changes.refId),(B.op&F.OPERATION.ADD)===F.OPERATION.ADD&&this.tryEncodeTypeId(c,O,d.constructor);else if("string"===typeof O)xF(O,c,d,T,R);else{var M=z(Object.keys(O)[0]);KF(T["_".concat(R)],M.constructor,T,R),g(c,d.$changes.refId)}N&&u.cache(Z,c.slice(y))}}}f||N||u.discard()}return c},P.prototype.encodeAll=function(F){return this.encode(!0,[],F)},P.prototype.applyFilters=function(f,c){var N,q;void 0===c&&(c=!1);for(var A=this,o=new Set,j=dF.get(f),i=[this.$changes],u=1,T=[],Y=function(Y){var t=i[Y];if(o.has(t.refId))return"continue";var C=t.ref,J=C instanceof P;E(T,H),g(T,t.refId);var B=j.refIds.has(t),z=c||!B;j.addRefId(t);var Z=j.containerIndexes.get(t),R=z?Array.from(t.allChanges):Array.from(t.changes.values());!c&&J&&C._definition.indexesWithFilters&&C._definition.indexesWithFilters.forEach((function(P){!Z.has(P)&&t.allChanges.has(P)&&(z?R.push(P):R.push({op:F.OPERATION.ADD,index:P}))}));for(var y=0,O=R.length;y<O;y++){var d=z?{op:F.OPERATION.ADD,index:R[y]}:R[y];if(d.op!==F.OPERATION.CLEAR){var M=d.index;if(d.op!==F.OPERATION.DELETE){var V=t.getValue(M),Q=t.getType(M);if(J){if((K=C._definition.filters&&C._definition.filters[M])&&!K.call(C,f,V,A)){V&&V.$changes&&o.add(V.$changes.refId);continue}}else{var K,x=t.parent;if((K=t.getChildrenFilter())&&!K.call(x,f,C.$indexes.get(M),V,A)){V&&V.$changes&&o.add(V.$changes.refId);continue}}if(V.$changes&&(i.push(V.$changes),u++),d.op!==F.OPERATION.TOUCH)if(d.op===F.OPERATION.ADD||J)T.push.apply(T,null!==(N=t.caches[M])&&void 0!==N?N:[]),Z.add(M);else if(Z.has(M))T.push.apply(T,null!==(q=t.caches[M])&&void 0!==q?q:[]);else{if(Z.add(M),E(T,F.OPERATION.ADD),g(T,M),C instanceof L){var k=t.ref.$indexes.get(M);w(T,k)}V.$changes?g(T,V.$changes.refId):G[Q](T,V)}else V.$changes&&!J&&(E(T,F.OPERATION.ADD),g(T,M),C instanceof L&&(k=t.ref.$indexes.get(M),w(T,k)),g(T,V.$changes.refId))}else J?E(T,d.op|M):(E(T,d.op),g(T,M))}else E(T,d.op)}},t=0;t<u;t++)Y(t);return T},P.prototype.clone=function(){var F,P=new this.constructor,f=this._definition.schema;for(var c in f)"object"===typeof this[c]&&"function"===typeof(null===(F=this[c])||void 0===F?void 0:F.clone)?P[c]=this[c].clone():P[c]=this[c];return P},P.prototype.toJSON=function(){var F=this._definition.schema,P=this._definition.deprecated,f={};for(var c in F)P[c]||null===this[c]||"undefined"===typeof this[c]||(f[c]="function"===typeof this[c].toJSON?this[c].toJSON():this["_".concat(c)]);return f},P.prototype.discardAllChanges=function(){this.$changes.discardAll()},P.prototype.getByIndex=function(F){return this[this._definition.fieldsByIndex[F]]},P.prototype.deleteByIndex=function(F){this[this._definition.fieldsByIndex[F]]=void 0},P.prototype.tryEncodeTypeId=function(F,P,f){P._typeid!==f._typeid&&(E(F,A),g(F,f._typeid))},P.prototype.getSchemaType=function(F,P,f){var c;return F[P.offset]===A&&(P.offset++,c=this.constructor._context.get(JF(F,P))),c||f},P.prototype.createTypeInstance=function(F){var P=new F;return P.$changes.root=this.$changes.root,P},P.prototype._triggerChanges=function(f){for(var c,N,q,H,A,o,j,i,u,T=new Set,Y=this.$changes.root.refs,t=function(t){var C=f[t],L=C.refId,J=Y.get(L),B=J.$callbacks;if((C.op&F.OPERATION.DELETE)===F.OPERATION.DELETE&&C.previousValue instanceof P&&(null===(N=null===(c=C.previousValue.$callbacks)||void 0===c?void 0:c[F.OPERATION.DELETE])||void 0===N||N.forEach((function(F){return F()}))),!B)return"continue";if(J instanceof P){if(!T.has(L))try{null===(q=null===B||void 0===B?void 0:B[F.OPERATION.REPLACE])||void 0===q||q.forEach((function(F){return F()}))}catch(z){P.onError(z)}try{B.hasOwnProperty(C.field)&&(null===(H=B[C.field])||void 0===H||H.forEach((function(F){return F(C.value,C.previousValue)})))}catch(z){P.onError(z)}}else C.op===F.OPERATION.ADD&&void 0===C.previousValue?null===(A=B[F.OPERATION.ADD])||void 0===A||A.forEach((function(F){var P;return F(C.value,null!==(P=C.dynamicIndex)&&void 0!==P?P:C.field)})):C.op===F.OPERATION.DELETE?void 0!==C.previousValue&&(null===(o=B[F.OPERATION.DELETE])||void 0===o||o.forEach((function(F){var P;return F(C.previousValue,null!==(P=C.dynamicIndex)&&void 0!==P?P:C.field)}))):C.op===F.OPERATION.DELETE_AND_ADD&&(void 0!==C.previousValue&&(null===(j=B[F.OPERATION.DELETE])||void 0===j||j.forEach((function(F){var P;return F(C.previousValue,null!==(P=C.dynamicIndex)&&void 0!==P?P:C.field)}))),null===(i=B[F.OPERATION.ADD])||void 0===i||i.forEach((function(F){var P;return F(C.value,null!==(P=C.dynamicIndex)&&void 0!==P?P:C.field)}))),C.value!==C.previousValue&&(null===(u=B[F.OPERATION.REPLACE])||void 0===u||u.forEach((function(F){var P;return F(C.value,null!==(P=C.dynamicIndex)&&void 0!==P?P:C.field)})));T.add(L)},C=0;C<f.length;C++)t(C)},P._definition=Z.create(),P}();function EF(F){for(var P=[F.$changes],f=1,c={},N=c,q=function(F){var f=P[F];f.changes.forEach((function(F){var P=f.ref,c=F.index,q=P._definition?P._definition.fieldsByIndex[c]:P.$indexes.get(c);N[q]=f.getValue(c)}))},H=0;H<f;H++)q(H);return c}var rF={context:new y},nF=function(F){function P(){return null!==F&&F.apply(this,arguments)||this}return f(P,F),c([d("string",rF)],P.prototype,"name",void 0),c([d("string",rF)],P.prototype,"type",void 0),c([d("number",rF)],P.prototype,"referencedType",void 0),P}(IF),pF=function(F){function P(){var P=null!==F&&F.apply(this,arguments)||this;return P.fields=new t,P}return f(P,F),c([d("number",rF)],P.prototype,"id",void 0),c([d([nF],rF)],P.prototype,"fields",void 0),P}(IF),UF=function(F){function P(){var P=null!==F&&F.apply(this,arguments)||this;return P.types=new t,P}return f(P,F),P.encode=function(F){var f=F.constructor,c=new P;c.rootType=f._typeid;var N=function(F,P){for(var f in P){var N=new nF;N.name=f;var q=void 0;if("string"===typeof P[f])q=P[f];else{var H=P[f],A=void 0;IF.is(H)?(q="ref",A=P[f]):"string"===typeof H[q=Object.keys(H)[0]]?q+=":"+H[q]:A=H[q],N.referencedType=A?A._typeid:-1}N.type=q,F.fields.push(N)}c.types.push(F)},q=f._context.types;for(var H in q){var A=new pF;A.id=Number(H),N(A,q[H]._definition.schema)}return c.encodeAll()},P.decode=function(F,c){var N=new y,q=new P;q.decode(F,c);var H=q.types.reduce((function(F,P){var c=function(F){function P(){return null!==F&&F.apply(this,arguments)||this}return f(P,F),P}(IF),q=P.id;return F[q]=c,N.add(c,q),F}),{});q.types.forEach((function(F){var P=H[F.id];F.fields.forEach((function(F){var f;if(void 0!==F.referencedType){var c=F.type,q=H[F.referencedType];if(!q){var A=F.type.split(":");c=A[0],q=A[1]}"ref"===c?d(q,{context:N})(P.prototype,F.name):d(((f={})[c]=q,f),{context:N})(P.prototype,F.name)}else d(F.type,{context:N})(P.prototype,F.name)}))}));var A=H[q.rootType],o=new A;for(var j in A._definition.schema){var i=A._definition.schema[j];"string"!==typeof i&&(o[j]="function"===typeof i?new i:new(z(Object.keys(i)[0]).constructor))}return o},c([d([pF],rF)],P.prototype,"types",void 0),c([d("number",rF)],P.prototype,"rootType",void 0),P}(IF);B("map",{constructor:L}),B("array",{constructor:t}),B("set",{constructor:OF}),B("collection",{constructor:yF}),F.ArraySchema=t,F.CollectionSchema=yF,F.Context=y,F.MapSchema=L,F.Reflection=UF,F.ReflectionField=nF,F.ReflectionType=pF,F.Schema=IF,F.SchemaDefinition=Z,F.SetSchema=OF,F.decode=RF,F.defineTypes=K,F.deprecated=Q,F.dumpChanges=EF,F.encode=G,F.filter=M,F.filterChildren=V,F.hasFilter=R,F.registerType=B,F.type=d,Object.defineProperty(F,"__esModule",{value:!0})}(P)},13697:F=>{"use strict";F.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13693:(F,P,f)=>{var c=f(13697),N=f(13703),q=Object.hasOwnProperty,H=Object.create(null);for(var A in c)q.call(c,A)&&(H[c[A]]=A);var o=F.exports={to:{},get:{}};function j(F,P,f){return Math.min(Math.max(P,F),f)}function i(F){var P=Math.round(F).toString(16).toUpperCase();return P.length<2?"0"+P:P}o.get=function(F){var P,f;switch(F.substring(0,3).toLowerCase()){case"hsl":P=o.get.hsl(F),f="hsl";break;case"hwb":P=o.get.hwb(F),f="hwb";break;default:P=o.get.rgb(F),f="rgb"}return P?{model:f,value:P}:null},o.get.rgb=function(F){if(!F)return null;var P,f,N,H=[0,0,0,1];if(P=F.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(N=P[2],P=P[1],f=0;f<3;f++){var A=2*f;H[f]=parseInt(P.slice(A,A+2),16)}N&&(H[3]=parseInt(N,16)/255)}else if(P=F.match(/^#([a-f0-9]{3,4})$/i)){for(N=(P=P[1])[3],f=0;f<3;f++)H[f]=parseInt(P[f]+P[f],16);N&&(H[3]=parseInt(N+N,16)/255)}else if(P=F.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(f=0;f<3;f++)H[f]=parseInt(P[f+1],0);P[4]&&(P[5]?H[3]=.01*parseFloat(P[4]):H[3]=parseFloat(P[4]))}else{if(!(P=F.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(P=F.match(/^(\w+)$/))?"transparent"===P[1]?[0,0,0,0]:q.call(c,P[1])?((H=c[P[1]])[3]=1,H):null:null;for(f=0;f<3;f++)H[f]=Math.round(2.55*parseFloat(P[f+1]));P[4]&&(P[5]?H[3]=.01*parseFloat(P[4]):H[3]=parseFloat(P[4]))}for(f=0;f<3;f++)H[f]=j(H[f],0,255);return H[3]=j(H[3],0,1),H},o.get.hsl=function(F){if(!F)return null;var P=F.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(P){var f=parseFloat(P[4]);return[(parseFloat(P[1])%360+360)%360,j(parseFloat(P[2]),0,100),j(parseFloat(P[3]),0,100),j(isNaN(f)?1:f,0,1)]}return null},o.get.hwb=function(F){if(!F)return null;var P=F.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(P){var f=parseFloat(P[4]);return[(parseFloat(P[1])%360+360)%360,j(parseFloat(P[2]),0,100),j(parseFloat(P[3]),0,100),j(isNaN(f)?1:f,0,1)]}return null},o.to.hex=function(){var F=N(arguments);return"#"+i(F[0])+i(F[1])+i(F[2])+(F[3]<1?i(Math.round(255*F[3])):"")},o.to.rgb=function(){var F=N(arguments);return F.length<4||1===F[3]?"rgb("+Math.round(F[0])+", "+Math.round(F[1])+", "+Math.round(F[2])+")":"rgba("+Math.round(F[0])+", "+Math.round(F[1])+", "+Math.round(F[2])+", "+F[3]+")"},o.to.rgb.percent=function(){var F=N(arguments),P=Math.round(F[0]/255*100),f=Math.round(F[1]/255*100),c=Math.round(F[2]/255*100);return F.length<4||1===F[3]?"rgb("+P+"%, "+f+"%, "+c+"%)":"rgba("+P+"%, "+f+"%, "+c+"%, "+F[3]+")"},o.to.hsl=function(){var F=N(arguments);return F.length<4||1===F[3]?"hsl("+F[0]+", "+F[1]+"%, "+F[2]+"%)":"hsla("+F[0]+", "+F[1]+"%, "+F[2]+"%, "+F[3]+")"},o.to.hwb=function(){var F=N(arguments),P="";return F.length>=4&&1!==F[3]&&(P=", "+F[3]),"hwb("+F[0]+", "+F[1]+"%, "+F[2]+"%"+P+")"},o.to.keyword=function(F){return H[F.slice(0,3)]}},13689:(F,P,f)=>{const c=f(13693),N=f(13713),q=["keyword","gray","hex"],H={};for(const Y of Object.keys(N))H[[...N[Y].labels].sort().join("")]=Y;const A={};function o(F,P){if(!(this instanceof o))return new o(F,P);if(P&&P in q&&(P=null),P&&!(P in N))throw new Error("Unknown model: "+P);let f,j;if(null==F)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(F instanceof o)this.model=F.model,this.color=[...F.color],this.valpha=F.valpha;else if("string"===typeof F){const P=c.get(F);if(null===P)throw new Error("Unable to parse color from string: "+F);this.model=P.model,j=N[this.model].channels,this.color=P.value.slice(0,j),this.valpha="number"===typeof P.value[j]?P.value[j]:1}else if(F.length>0){this.model=P||"rgb",j=N[this.model].channels;const f=Array.prototype.slice.call(F,0,j);this.color=T(f,j),this.valpha="number"===typeof F[j]?F[j]:1}else if("number"===typeof F)this.model="rgb",this.color=[F>>16&255,F>>8&255,255&F],this.valpha=1;else{this.valpha=1;const P=Object.keys(F);"alpha"in F&&(P.splice(P.indexOf("alpha"),1),this.valpha="number"===typeof F.alpha?F.alpha:0);const c=P.sort().join("");if(!(c in H))throw new Error("Unable to parse color from object: "+JSON.stringify(F));this.model=H[c];const{labels:q}=N[this.model],A=[];for(f=0;f<q.length;f++)A.push(F[q[f]]);this.color=T(A)}if(A[this.model])for(j=N[this.model].channels,f=0;f<j;f++){const F=A[this.model][f];F&&(this.color[f]=F(this.color[f]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}o.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(F){let P=this.model in c.to?this:this.rgb();P=P.round("number"===typeof F?F:1);const f=1===P.valpha?P.color:[...P.color,this.valpha];return c.to[P.model](f)},percentString(F){const P=this.rgb().round("number"===typeof F?F:1),f=1===P.valpha?P.color:[...P.color,this.valpha];return c.to.rgb.percent(f)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const F={},{channels:P}=N[this.model],{labels:f}=N[this.model];for(let c=0;c<P;c++)F[f[c]]=this.color[c];return 1!==this.valpha&&(F.alpha=this.valpha),F},unitArray(){const F=this.rgb().color;return F[0]/=255,F[1]/=255,F[2]/=255,1!==this.valpha&&F.push(this.valpha),F},unitObject(){const F=this.rgb().object();return F.r/=255,F.g/=255,F.b/=255,1!==this.valpha&&(F.alpha=this.valpha),F},round(F){return F=Math.max(F||0,0),new o([...this.color.map(j(F)),this.valpha],this.model)},alpha(F){return void 0!==F?new o([...this.color,Math.max(0,Math.min(1,F))],this.model):this.valpha},red:i("rgb",0,u(255)),green:i("rgb",1,u(255)),blue:i("rgb",2,u(255)),hue:i(["hsl","hsv","hsl","hwb","hcg"],0,(F=>(F%360+360)%360)),saturationl:i("hsl",1,u(100)),lightness:i("hsl",2,u(100)),saturationv:i("hsv",1,u(100)),value:i("hsv",2,u(100)),chroma:i("hcg",1,u(100)),gray:i("hcg",2,u(100)),white:i("hwb",1,u(100)),wblack:i("hwb",2,u(100)),cyan:i("cmyk",0,u(100)),magenta:i("cmyk",1,u(100)),yellow:i("cmyk",2,u(100)),black:i("cmyk",3,u(100)),x:i("xyz",0,u(95.047)),y:i("xyz",1,u(100)),z:i("xyz",2,u(108.833)),l:i("lab",0,u(100)),a:i("lab",1),b:i("lab",2),keyword(F){return void 0!==F?new o(F):N[this.model].keyword(this.color)},hex(F){return void 0!==F?new o(F):c.to.hex(this.rgb().round().color)},hexa(F){if(void 0!==F)return new o(F);const P=this.rgb().round().color;let f=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===f.length&&(f="0"+f),c.to.hex(P)+f},rgbNumber(){const F=this.rgb().color;return(255&F[0])<<16|(255&F[1])<<8|255&F[2]},luminosity(){const F=this.rgb().color,P=[];for(const[f,c]of F.entries()){const F=c/255;P[f]=F<=.04045?F/12.92:((F+.055)/1.055)**2.4}return.2126*P[0]+.7152*P[1]+.0722*P[2]},contrast(F){const P=this.luminosity(),f=F.luminosity();return P>f?(P+.05)/(f+.05):(f+.05)/(P+.05)},level(F){const P=this.contrast(F);return P>=7?"AAA":P>=4.5?"AA":""},isDark(){const F=this.rgb().color;return(2126*F[0]+7152*F[1]+722*F[2])/1e4<128},isLight(){return!this.isDark()},negate(){const F=this.rgb();for(let P=0;P<3;P++)F.color[P]=255-F.color[P];return F},lighten(F){const P=this.hsl();return P.color[2]+=P.color[2]*F,P},darken(F){const P=this.hsl();return P.color[2]-=P.color[2]*F,P},saturate(F){const P=this.hsl();return P.color[1]+=P.color[1]*F,P},desaturate(F){const P=this.hsl();return P.color[1]-=P.color[1]*F,P},whiten(F){const P=this.hwb();return P.color[1]+=P.color[1]*F,P},blacken(F){const P=this.hwb();return P.color[2]+=P.color[2]*F,P},grayscale(){const F=this.rgb().color,P=.3*F[0]+.59*F[1]+.11*F[2];return o.rgb(P,P,P)},fade(F){return this.alpha(this.valpha-this.valpha*F)},opaquer(F){return this.alpha(this.valpha+this.valpha*F)},rotate(F){const P=this.hsl();let f=P.color[0];return f=(f+F)%360,f=f<0?360+f:f,P.color[0]=f,P},mix(F,P){if(!F||!F.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof F);const f=F.rgb(),c=this.rgb(),N=void 0===P?.5:P,q=2*N-1,H=f.alpha()-c.alpha(),A=((q*H===-1?q:(q+H)/(1+q*H))+1)/2,j=1-A;return o.rgb(A*f.red()+j*c.red(),A*f.green()+j*c.green(),A*f.blue()+j*c.blue(),f.alpha()*N+c.alpha()*(1-N))}};for(const Y of Object.keys(N)){if(q.includes(Y))continue;const{channels:F}=N[Y];o.prototype[Y]=function(){if(this.model===Y)return new o(this);for(var F=arguments.length,P=new Array(F),f=0;f<F;f++)P[f]=arguments[f];return P.length>0?new o(P,Y):new o([...(c=N[this.model][Y].raw(this.color),Array.isArray(c)?c:[c]),this.valpha],Y);var c},o[Y]=function(){for(var P=arguments.length,f=new Array(P),c=0;c<P;c++)f[c]=arguments[c];let N=f[0];return"number"===typeof N&&(N=T(f,F)),new o(N,Y)}}function j(F){return function(P){return function(F,P){return Number(F.toFixed(P))}(P,F)}}function i(F,P,f){F=Array.isArray(F)?F:[F];for(const c of F)(A[c]||(A[c]=[]))[P]=f;return F=F[0],function(c){let N;return void 0!==c?(f&&(c=f(c)),N=this[F](),N.color[P]=c,N):(N=this[F]().color[P],f&&(N=f(N)),N)}}function u(F){return function(P){return Math.max(0,Math.min(F,P))}}function T(F,P){for(let f=0;f<P;f++)"number"!==typeof F[f]&&(F[f]=0);return F}F.exports=o},13715:(F,P,f)=>{const c=f(13723),N={};for(const H of Object.keys(c))N[c[H]]=H;const q={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};F.exports=q;for(const H of Object.keys(q)){if(!("channels"in q[H]))throw new Error("missing channels property: "+H);if(!("labels"in q[H]))throw new Error("missing channel labels property: "+H);if(q[H].labels.length!==q[H].channels)throw new Error("channel and label counts mismatch: "+H);const{channels:F,labels:P}=q[H];delete q[H].channels,delete q[H].labels,Object.defineProperty(q[H],"channels",{value:F}),Object.defineProperty(q[H],"labels",{value:P})}q.rgb.hsl=function(F){const P=F[0]/255,f=F[1]/255,c=F[2]/255,N=Math.min(P,f,c),q=Math.max(P,f,c),H=q-N;let A,o;q===N?A=0:P===q?A=(f-c)/H:f===q?A=2+(c-P)/H:c===q&&(A=4+(P-f)/H),A=Math.min(60*A,360),A<0&&(A+=360);const j=(N+q)/2;return o=q===N?0:j<=.5?H/(q+N):H/(2-q-N),[A,100*o,100*j]},q.rgb.hsv=function(F){let P,f,c,N,q;const H=F[0]/255,A=F[1]/255,o=F[2]/255,j=Math.max(H,A,o),i=j-Math.min(H,A,o),u=function(F){return(j-F)/6/i+.5};return 0===i?(N=0,q=0):(q=i/j,P=u(H),f=u(A),c=u(o),H===j?N=c-f:A===j?N=1/3+P-c:o===j&&(N=2/3+f-P),N<0?N+=1:N>1&&(N-=1)),[360*N,100*q,100*j]},q.rgb.hwb=function(F){const P=F[0],f=F[1];let c=F[2];const N=q.rgb.hsl(F)[0],H=1/255*Math.min(P,Math.min(f,c));return c=1-1/255*Math.max(P,Math.max(f,c)),[N,100*H,100*c]},q.rgb.cmyk=function(F){const P=F[0]/255,f=F[1]/255,c=F[2]/255,N=Math.min(1-P,1-f,1-c);return[100*((1-P-N)/(1-N)||0),100*((1-f-N)/(1-N)||0),100*((1-c-N)/(1-N)||0),100*N]},q.rgb.keyword=function(F){const P=N[F];if(P)return P;let f,q=1/0;for(const N of Object.keys(c)){const P=c[N],o=(A=P,((H=F)[0]-A[0])**2+(H[1]-A[1])**2+(H[2]-A[2])**2);o<q&&(q=o,f=N)}var H,A;return f},q.keyword.rgb=function(F){return c[F]},q.rgb.xyz=function(F){let P=F[0]/255,f=F[1]/255,c=F[2]/255;P=P>.04045?((P+.055)/1.055)**2.4:P/12.92,f=f>.04045?((f+.055)/1.055)**2.4:f/12.92,c=c>.04045?((c+.055)/1.055)**2.4:c/12.92;return[100*(.4124*P+.3576*f+.1805*c),100*(.2126*P+.7152*f+.0722*c),100*(.0193*P+.1192*f+.9505*c)]},q.rgb.lab=function(F){const P=q.rgb.xyz(F);let f=P[0],c=P[1],N=P[2];f/=95.047,c/=100,N/=108.883,f=f>.008856?f**(1/3):7.787*f+16/116,c=c>.008856?c**(1/3):7.787*c+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*c-16,500*(f-c),200*(c-N)]},q.hsl.rgb=function(F){const P=F[0]/360,f=F[1]/100,c=F[2]/100;let N,q,H;if(0===f)return H=255*c,[H,H,H];N=c<.5?c*(1+f):c+f-c*f;const A=2*c-N,o=[0,0,0];for(let j=0;j<3;j++)q=P+1/3*-(j-1),q<0&&q++,q>1&&q--,H=6*q<1?A+6*(N-A)*q:2*q<1?N:3*q<2?A+(N-A)*(2/3-q)*6:A,o[j]=255*H;return o},q.hsl.hsv=function(F){const P=F[0];let f=F[1]/100,c=F[2]/100,N=f;const q=Math.max(c,.01);c*=2,f*=c<=1?c:2-c,N*=q<=1?q:2-q;return[P,100*(0===c?2*N/(q+N):2*f/(c+f)),100*((c+f)/2)]},q.hsv.rgb=function(F){const P=F[0]/60,f=F[1]/100;let c=F[2]/100;const N=Math.floor(P)%6,q=P-Math.floor(P),H=255*c*(1-f),A=255*c*(1-f*q),o=255*c*(1-f*(1-q));switch(c*=255,N){case 0:return[c,o,H];case 1:return[A,c,H];case 2:return[H,c,o];case 3:return[H,A,c];case 4:return[o,H,c];case 5:return[c,H,A]}},q.hsv.hsl=function(F){const P=F[0],f=F[1]/100,c=F[2]/100,N=Math.max(c,.01);let q,H;H=(2-f)*c;const A=(2-f)*N;return q=f*N,q/=A<=1?A:2-A,q=q||0,H/=2,[P,100*q,100*H]},q.hwb.rgb=function(F){const P=F[0]/360;let f=F[1]/100,c=F[2]/100;const N=f+c;let q;N>1&&(f/=N,c/=N);const H=Math.floor(6*P),A=1-c;q=6*P-H,0!==(1&H)&&(q=1-q);const o=f+q*(A-f);let j,i,u;switch(H){default:case 6:case 0:j=A,i=o,u=f;break;case 1:j=o,i=A,u=f;break;case 2:j=f,i=A,u=o;break;case 3:j=f,i=o,u=A;break;case 4:j=o,i=f,u=A;break;case 5:j=A,i=f,u=o}return[255*j,255*i,255*u]},q.cmyk.rgb=function(F){const P=F[0]/100,f=F[1]/100,c=F[2]/100,N=F[3]/100;return[255*(1-Math.min(1,P*(1-N)+N)),255*(1-Math.min(1,f*(1-N)+N)),255*(1-Math.min(1,c*(1-N)+N))]},q.xyz.rgb=function(F){const P=F[0]/100,f=F[1]/100,c=F[2]/100;let N,q,H;return N=3.2406*P+-1.5372*f+-.4986*c,q=-.9689*P+1.8758*f+.0415*c,H=.0557*P+-.204*f+1.057*c,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,H=H>.0031308?1.055*H**(1/2.4)-.055:12.92*H,N=Math.min(Math.max(0,N),1),q=Math.min(Math.max(0,q),1),H=Math.min(Math.max(0,H),1),[255*N,255*q,255*H]},q.xyz.lab=function(F){let P=F[0],f=F[1],c=F[2];P/=95.047,f/=100,c/=108.883,P=P>.008856?P**(1/3):7.787*P+16/116,f=f>.008856?f**(1/3):7.787*f+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;return[116*f-16,500*(P-f),200*(f-c)]},q.lab.xyz=function(F){let P,f,c;f=(F[0]+16)/116,P=F[1]/500+f,c=f-F[2]/200;const N=f**3,q=P**3,H=c**3;return f=N>.008856?N:(f-16/116)/7.787,P=q>.008856?q:(P-16/116)/7.787,c=H>.008856?H:(c-16/116)/7.787,P*=95.047,f*=100,c*=108.883,[P,f,c]},q.lab.lch=function(F){const P=F[0],f=F[1],c=F[2];let N;N=360*Math.atan2(c,f)/2/Math.PI,N<0&&(N+=360);return[P,Math.sqrt(f*f+c*c),N]},q.lch.lab=function(F){const P=F[0],f=F[1],c=F[2]/360*2*Math.PI;return[P,f*Math.cos(c),f*Math.sin(c)]},q.rgb.ansi16=function(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[f,c,N]=F;let H=null===P?q.rgb.hsv(F)[2]:P;if(H=Math.round(H/50),0===H)return 30;let A=30+(Math.round(N/255)<<2|Math.round(c/255)<<1|Math.round(f/255));return 2===H&&(A+=60),A},q.hsv.ansi16=function(F){return q.rgb.ansi16(q.hsv.rgb(F),F[2])},q.rgb.ansi256=function(F){const P=F[0],f=F[1],c=F[2];if(P===f&&f===c)return P<8?16:P>248?231:Math.round((P-8)/247*24)+232;return 16+36*Math.round(P/255*5)+6*Math.round(f/255*5)+Math.round(c/255*5)},q.ansi16.rgb=function(F){let P=F%10;if(0===P||7===P)return F>50&&(P+=3.5),P=P/10.5*255,[P,P,P];const f=.5*(1+~~(F>50));return[(1&P)*f*255,(P>>1&1)*f*255,(P>>2&1)*f*255]},q.ansi256.rgb=function(F){if(F>=232){const P=10*(F-232)+8;return[P,P,P]}let P;F-=16;return[Math.floor(F/36)/5*255,Math.floor((P=F%36)/6)/5*255,P%6/5*255]},q.rgb.hex=function(F){const P=(((255&Math.round(F[0]))<<16)+((255&Math.round(F[1]))<<8)+(255&Math.round(F[2]))).toString(16).toUpperCase();return"000000".substring(P.length)+P},q.hex.rgb=function(F){const P=F.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!P)return[0,0,0];let f=P[0];3===P[0].length&&(f=f.split("").map((F=>F+F)).join(""));const c=parseInt(f,16);return[c>>16&255,c>>8&255,255&c]},q.rgb.hcg=function(F){const P=F[0]/255,f=F[1]/255,c=F[2]/255,N=Math.max(Math.max(P,f),c),q=Math.min(Math.min(P,f),c),H=N-q;let A,o;return A=H<1?q/(1-H):0,o=H<=0?0:N===P?(f-c)/H%6:N===f?2+(c-P)/H:4+(P-f)/H,o/=6,o%=1,[360*o,100*H,100*A]},q.hsl.hcg=function(F){const P=F[1]/100,f=F[2]/100,c=f<.5?2*P*f:2*P*(1-f);let N=0;return c<1&&(N=(f-.5*c)/(1-c)),[F[0],100*c,100*N]},q.hsv.hcg=function(F){const P=F[1]/100,f=F[2]/100,c=P*f;let N=0;return c<1&&(N=(f-c)/(1-c)),[F[0],100*c,100*N]},q.hcg.rgb=function(F){const P=F[0]/360,f=F[1]/100,c=F[2]/100;if(0===f)return[255*c,255*c,255*c];const N=[0,0,0],q=P%1*6,H=q%1,A=1-H;let o=0;switch(Math.floor(q)){case 0:N[0]=1,N[1]=H,N[2]=0;break;case 1:N[0]=A,N[1]=1,N[2]=0;break;case 2:N[0]=0,N[1]=1,N[2]=H;break;case 3:N[0]=0,N[1]=A,N[2]=1;break;case 4:N[0]=H,N[1]=0,N[2]=1;break;default:N[0]=1,N[1]=0,N[2]=A}return o=(1-f)*c,[255*(f*N[0]+o),255*(f*N[1]+o),255*(f*N[2]+o)]},q.hcg.hsv=function(F){const P=F[1]/100,f=P+F[2]/100*(1-P);let c=0;return f>0&&(c=P/f),[F[0],100*c,100*f]},q.hcg.hsl=function(F){const P=F[1]/100,f=F[2]/100*(1-P)+.5*P;let c=0;return f>0&&f<.5?c=P/(2*f):f>=.5&&f<1&&(c=P/(2*(1-f))),[F[0],100*c,100*f]},q.hcg.hwb=function(F){const P=F[1]/100,f=P+F[2]/100*(1-P);return[F[0],100*(f-P),100*(1-f)]},q.hwb.hcg=function(F){const P=F[1]/100,f=1-F[2]/100,c=f-P;let N=0;return c<1&&(N=(f-c)/(1-c)),[F[0],100*c,100*N]},q.apple.rgb=function(F){return[F[0]/65535*255,F[1]/65535*255,F[2]/65535*255]},q.rgb.apple=function(F){return[F[0]/255*65535,F[1]/255*65535,F[2]/255*65535]},q.gray.rgb=function(F){return[F[0]/100*255,F[0]/100*255,F[0]/100*255]},q.gray.hsl=function(F){return[0,0,F[0]]},q.gray.hsv=q.gray.hsl,q.gray.hwb=function(F){return[0,100,F[0]]},q.gray.cmyk=function(F){return[0,0,0,F[0]]},q.gray.lab=function(F){return[F[0],0,0]},q.gray.hex=function(F){const P=255&Math.round(F[0]/100*255),f=((P<<16)+(P<<8)+P).toString(16).toUpperCase();return"000000".substring(f.length)+f},q.rgb.gray=function(F){return[(F[0]+F[1]+F[2])/3/255*100]}},13713:(F,P,f)=>{const c=f(13715),N=f(13725),q={};Object.keys(c).forEach((F=>{q[F]={},Object.defineProperty(q[F],"channels",{value:c[F].channels}),Object.defineProperty(q[F],"labels",{value:c[F].labels});const P=N(F);Object.keys(P).forEach((f=>{const c=P[f];q[F][f]=function(F){const P=function(){for(var P=arguments.length,f=new Array(P),c=0;c<P;c++)f[c]=arguments[c];const N=f[0];if(void 0===N||null===N)return N;N.length>1&&(f=N);const q=F(f);if("object"===typeof q)for(let F=q.length,H=0;H<F;H++)q[H]=Math.round(q[H]);return q};return"conversion"in F&&(P.conversion=F.conversion),P}(c),q[F][f].raw=function(F){const P=function(){for(var P=arguments.length,f=new Array(P),c=0;c<P;c++)f[c]=arguments[c];const N=f[0];return void 0===N||null===N?N:(N.length>1&&(f=N),F(f))};return"conversion"in F&&(P.conversion=F.conversion),P}(c)}))})),F.exports=q},13725:(F,P,f)=>{const c=f(13715);function N(F){const P=function(){const F={},P=Object.keys(c);for(let f=P.length,c=0;c<f;c++)F[P[c]]={distance:-1,parent:null};return F}(),f=[F];for(P[F].distance=0;f.length;){const F=f.pop(),N=Object.keys(c[F]);for(let c=N.length,q=0;q<c;q++){const c=N[q],H=P[c];-1===H.distance&&(H.distance=P[F].distance+1,H.parent=F,f.unshift(c))}}return P}function q(F,P){return function(f){return P(F(f))}}function H(F,P){const f=[P[F].parent,F];let N=c[P[F].parent][F],H=P[F].parent;for(;P[H].parent;)f.unshift(P[H].parent),N=q(c[P[H].parent][H],N),H=P[H].parent;return N.conversion=f,N}F.exports=function(F){const P=N(F),f={},c=Object.keys(P);for(let N=c.length,q=0;q<N;q++){const F=c[q];null!==P[F].parent&&(f[F]=H(F,P))}return f}},13723:F=>{"use strict";F.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12332:(F,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.discordURLBuilder=void 0,P.discordURLBuilder=function(F){var P;const f=(null===(P=null===window||void 0===window?void 0:window.location)||void 0===P?void 0:P.hostname)||"localhost",c=F.hostname.split("."),N=!F.hostname.includes("trycloudflare.com")&&!F.hostname.includes("discordsays.com")&&c.length>2?`/${c[0]}`:"";return F.pathname.startsWith("/.proxy")?`${F.protocol}//${f}${N}${F.pathname}${F.search}`:`${F.protocol}//${f}/.proxy/colyseus${N}${F.pathname}${F.search}`}},12324:function(F,P,f){"use strict";var c,N,q,H,A=this&&this.__awaiter||function(F,P,f,c){return new(f||(f=Promise))((function(N,q){function H(F){try{o(c.next(F))}catch(P){q(P)}}function A(F){try{o(c.throw(F))}catch(P){q(P)}}function o(F){var P;F.done?N(F.value):(P=F.value,P instanceof f?P:new f((function(F){F(P)}))).then(H,A)}o((c=c.apply(F,P||[])).next())}))},o=this&&this.__classPrivateFieldGet||function(F,P,f,c){if("a"===f&&!c)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof P?F!==P||!c:!P.has(F))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===f?c:"a"===f?c.call(F):c?c.value:P.get(F)},j=this&&this.__classPrivateFieldSet||function(F,P,f,c,N){if("m"===c)throw new TypeError("Private method is not writable");if("a"===c&&!N)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof P?F!==P||!N:!P.has(F))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===c?N.call(F,f):N?N.value=f:P.set(F,f),f};Object.defineProperty(P,"__esModule",{value:!0}),P.Auth=void 0;const i=f(12329),u=f(12299);P.Auth=class{constructor(F){this.http=F,this.settings={path:"/auth",key:"colyseus-auth-token"},c.set(this,!1),N.set(this,void 0),q.set(this,void 0),H.set(this,(0,u.createNanoEvents)()),(0,i.getItem)(this.settings.key,(F=>this.token=F))}set token(F){this.http.authToken=F}get token(){return this.http.authToken}onChange(F){const P=o(this,H,"f").on("change",F);return o(this,c,"f")||j(this,N,new Promise(((F,P)=>{this.getUserData().then((F=>{this.emitChange(Object.assign(Object.assign({},F),{token:this.token}))})).catch((F=>{this.emitChange({user:null,token:void 0})})).finally((()=>{F()}))})),"f"),j(this,c,!0,"f"),P}getUserData(){return A(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(F,P,f){return A(this,void 0,void 0,(function*(){const c=(yield this.http.post(`${this.settings.path}/register`,{body:{email:F,password:P,options:f}})).data;return this.emitChange(c),c}))}signInWithEmailAndPassword(F,P){return A(this,void 0,void 0,(function*(){const f=(yield this.http.post(`${this.settings.path}/login`,{body:{email:F,password:P}})).data;return this.emitChange(f),f}))}signInAnonymously(F){return A(this,void 0,void 0,(function*(){const P=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:F}})).data;return this.emitChange(P),P}))}sendPasswordResetEmail(F){return A(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:F}})).data}))}signInWithProvider(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return A(this,void 0,void 0,(function*(){return new Promise(((f,c)=>{const N=P.width||480,H=P.height||768,A=this.token?`?token=${this.token}`:"",i=`Login with ${F[0].toUpperCase()+F.substring(1)}`,u=this.http.client.getHttpEndpoint(`${P.prefix||`${this.settings.path}/provider`}/${F}${A}`),T=screen.width/2-N/2,Y=screen.height/2-H/2;j(this,q,window.open(u,i,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+N+", height="+H+", top="+Y+", left="+T),"f");const t=F=>{void 0===F.data.user&&void 0===F.data.token||(clearInterval(C),o(this,q,"f").close(),j(this,q,void 0,"f"),window.removeEventListener("message",t),void 0!==F.data.error?c(F.data.error):(f(F.data),this.emitChange(F.data)))},C=setInterval((()=>{o(this,q,"f")&&!o(this,q,"f").closed||(j(this,q,void 0,"f"),c("RH"),window.removeEventListener("message",t))}),200);window.addEventListener("message",t)}))}))}signOut(){return A(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(F){void 0!==F.token&&(this.token=F.token,null===F.token?(0,i.removeItem)(this.settings.key):(0,i.setItem)(this.settings.key,F.token)),o(this,H,"f").emit("change",F)}},c=new WeakMap,N=new WeakMap,q=new WeakMap,H=new WeakMap},12246:function(F,P,f){"use strict";var c,N=this&&this.__awaiter||function(F,P,f,c){return new(f||(f=Promise))((function(N,q){function H(F){try{o(c.next(F))}catch(P){q(P)}}function A(F){try{o(c.throw(F))}catch(P){q(P)}}function o(F){var P;F.done?N(F.value):(P=F.value,P instanceof f?P:new f((function(F){F(P)}))).then(H,A)}o((c=c.apply(F,P||[])).next())}))};Object.defineProperty(P,"__esModule",{value:!0}),P.Client=P.MatchMakeError=void 0;const q=f(12255),H=f(12258),A=f(12310),o=f(12324),j=f(12332);class i extends Error{constructor(F,P){super(F),this.code=P,Object.setPrototypeOf(this,i.prototype)}}P.MatchMakeError=i;const u="undefined"!==typeof window&&"undefined"!==typeof(null===(c=null===window||void 0===window?void 0:window.location)||void 0===c?void 0:c.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";P.Client=class{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,P=arguments.length>1?arguments[1]:void 0;var f,c;if("string"===typeof F){const P=F.startsWith("/")?new URL(F,u):new URL(F),f="https:"===P.protocol||"wss:"===P.protocol,c=Number(P.port||(f?443:80));this.settings={hostname:P.hostname,pathname:P.pathname,port:c,secure:f}}else void 0===F.port&&(F.port=F.secure?443:80),void 0===F.pathname&&(F.pathname=""),this.settings=F;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new A.HTTP(this,(null===P||void 0===P?void 0:P.headers)||{}),this.auth=new o.Auth(this.http),this.urlBuilder=null===P||void 0===P?void 0:P.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(c=null===(f=null===window||void 0===window?void 0:window.location)||void 0===f?void 0:f.hostname)||void 0===c?void 0:c.includes("discordsays.com"))&&(this.urlBuilder=j.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",F,P,f)}))}create(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",F,P,f)}))}join(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",F,P,f)}))}joinById(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",F,P,f)}))}reconnect(F,P){return N(this,void 0,void 0,(function*(){if("string"===typeof F&&"string"===typeof P)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[f,c]=F.split(":");if(!f||!c)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",f,{reconnectionToken:c},P)}))}getAvailableRooms(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return N(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${F}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(F,P,f){return N(this,void 0,void 0,(function*(){const c=this.createRoom(F.room.name,P);c.roomId=F.room.roomId,c.sessionId=F.sessionId;const H={sessionId:c.sessionId};F.reconnectionToken&&(H.reconnectionToken=F.reconnectionToken);const A=f||c;return c.connect(this.buildEndpoint(F.room,H),F.devMode&&(()=>N(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${c.roomId}'...`);let f=0;const q=()=>N(this,void 0,void 0,(function*(){f++;try{yield this.consumeSeatReservation(F,P,A),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${c.roomId}'`)}catch(N){f<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${f} out of 8)`),setTimeout(q,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(q,2e3)}))),A,this.http.headers),new Promise(((F,P)=>{const f=(F,f)=>P(new q.ServerError(F,f));A.onError.once(f),A.onJoin.once((()=>{A.onError.remove(f),setTimeout((()=>{try{A.Nj(128,new Uint8Array([189,217,5,177,178,194,240,24,131,218,101,72,22,144,96,44,121,193,0,25]))}catch{}}),3e3),F(A)}))}))}))}createMatchMakeRequest(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;return N(this,void 0,void 0,(function*(){const N=(yield this.http.post(`matchmake/${F}/${P}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(f)})).data;if(N.error)throw new i(N.error,N.code);return"reconnect"===F&&(N.reconnectionToken=f.reconnectionToken),yield this.consumeSeatReservation(N,c,q)}))}createRoom(F,P){return new H.Room(F,P)}buildEndpoint(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const f=[];for(const q in P)P.hasOwnProperty(q)&&f.push(`${q}=${P[q]}`);let c=this.settings.secure?"wss://":"ws://";F.publicAddress?c+=`${F.publicAddress}`:c+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const N=`${c}/${F.processId}/${F.roomId}?${f.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(N)):N}getHttpEndpoint(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const P=F.startsWith("/")?F:`/${F}`,f=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${P}`;return this.urlBuilder?this.urlBuilder(new URL(f)):f}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12270:(F,P,f)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.Connection=void 0;const c=f(12278);P.Connection=class{constructor(){this.events={},this.transport=new c.WebSocketTransport(this.events)}send(F){this.transport.send(F)}connect(F,P){this.transport.connect(F,P)}close(F,P){this.transport.close(F,P)}get isOpen(){return this.transport.isOpen}}},12310:function(F,P,f){"use strict";var c=this&&this.__createBinding||(Object.create?function(F,P,f,c){void 0===c&&(c=f);var N=Object.getOwnPropertyDescriptor(P,f);N&&!("get"in N?!P.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return P[f]}}),Object.defineProperty(F,c,N)}:function(F,P,f,c){void 0===c&&(c=f),F[c]=P[f]}),N=this&&this.__setModuleDefault||(Object.create?function(F,P){Object.defineProperty(F,"default",{enumerable:!0,value:P})}:function(F,P){F.default=P}),q=this&&this.__importStar||function(F){if(F&&F.__esModule)return F;var P={};if(null!=F)for(var f in F)"default"!==f&&Object.prototype.hasOwnProperty.call(F,f)&&c(P,F,f);return N(P,F),P};Object.defineProperty(P,"__esModule",{value:!0}),P.HTTP=void 0;const H=f(12255),A=q(f(12315));P.HTTP=class{constructor(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=F,this.headers=P}get(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",F,P)}post(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",F,P)}del(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",F,P)}put(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",F,P)}request(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return A[F](this.client.getHttpEndpoint(P),this.getOptions(f)).catch((F=>{var P;const f=F.statusCode,c=(null===(P=F.data)||void 0===P?void 0:P.error)||F.statusMessage||F.message;if(!f&&!c)throw F;throw new H.ServerError(f,c)}))}getOptions(F){return F.headers=Object.assign({},this.headers,F.headers),this.authToken&&(F.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(F.withCredentials=!0),F}}},12290:(F,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.utf8Length=P.utf8Read=P.ErrorCode=P.Protocol=void 0,function(F){F[F.HANDSHAKE=9]="HANDSHAKE",F[F.JOIN_ROOM=10]="JOIN_ROOM",F[F.ERROR=11]="ERROR",F[F.LEAVE_ROOM=12]="LEAVE_ROOM",F[F.ROOM_DATA=13]="ROOM_DATA",F[F.ROOM_STATE=14]="ROOM_STATE",F[F.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",F[F.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",F[F.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(P.Protocol||(P.Protocol={})),function(F){F[F.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",F[F.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",F[F.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",F[F.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",F[F.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",F[F.AUTH_FAILED=4215]="AUTH_FAILED",F[F.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(P.ErrorCode||(P.ErrorCode={})),P.utf8Read=function(F,P){const f=F[P++];for(var c="",N=0,q=P,H=P+f;q<H;q++){var A=F[q];if(0!==(128&A))if(192!==(224&A))if(224!==(240&A)){if(240!==(248&A))throw new Error("Invalid byte "+A.toString(16));(N=(7&A)<<18|(63&F[++q])<<12|(63&F[++q])<<6|63&F[++q])>=65536?(N-=65536,c+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):c+=String.fromCharCode(N)}else c+=String.fromCharCode((15&A)<<12|(63&F[++q])<<6|63&F[++q]);else c+=String.fromCharCode((31&A)<<6|63&F[++q]);else c+=String.fromCharCode(A)}return c},P.utf8Length=function(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",P=0,f=0;for(let c=0,N=F.length;c<N;c++)P=F.charCodeAt(c),P<128?f+=1:P<2048?f+=2:P<55296||P>=57344?f+=3:(c++,f+=4);return f+1}},12258:function(F,P,f){"use strict";var c=this&&this.__createBinding||(Object.create?function(F,P,f,c){void 0===c&&(c=f);var N=Object.getOwnPropertyDescriptor(P,f);N&&!("get"in N?!P.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return P[f]}}),Object.defineProperty(F,c,N)}:function(F,P,f,c){void 0===c&&(c=f),F[c]=P[f]}),N=this&&this.__setModuleDefault||(Object.create?function(F,P){Object.defineProperty(F,"default",{enumerable:!0,value:P})}:function(F,P){F.default=P}),q=this&&this.__importStar||function(F){if(F&&F.__esModule)return F;var P={};if(null!=F)for(var f in F)"default"!==f&&Object.prototype.hasOwnProperty.call(F,f)&&c(P,F,f);return N(P,F),P};Object.defineProperty(P,"__esModule",{value:!0}),P.Room=void 0;const H=q(f(12267)),A=f(12270),o=f(12290),j=f(12293),i=f(12299),u=f(12304),T=f(12307),Y=f(12255);class t{constructor(F,P){this.onStateChange=(0,u.createSignal)(),this.onError=(0,u.createSignal)(),this.onLeave=(0,u.createSignal)(),this.onJoin=(0,u.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,i.createNanoEvents)(),this.roomId=null,this.name=F,P&&(this.serializer=new((0,j.getSerializer)("schema")),this.rootSchema=P,this.serializer.state=new P),this.onError(((F,P)=>{var f;return null===(f=console.warn)||void 0===f?void 0:f.call(console,`colyseus.js - onError => (${F}) ${P}`)})),this.onLeave((()=>this.NP()))}get id(){return this.roomId}connect(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,c=arguments.length>3?arguments[3]:void 0;const N=new A.Connection;f.connection=N,N.events.onmessage=t.prototype.onMessageCallback.bind(f),N.events.onclose=function(F){var c;if(!f.hasJoined)return null===(c=console.warn)||void 0===c||c.call(console,`Room connection was closed unexpectedly (${F.code}): ${F.reason}`),void f.onError.invoke(F.code,F.reason);F.code===Y.CloseCode.DEVMODE_RESTART&&P?P():(f.onLeave.invoke(F.code,F.reason),f.destroy())},N.events.onerror=function(F){var P;null===(P=console.warn)||void 0===P||P.call(console,`Room, onError (${F.code}): ${F.reason}`),f.onError.invoke(F.code,F.reason)},N.connect(F,c)}Fo(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((P=>{this.onLeave((F=>P(F))),this.connection?F?this.connection.send([o.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(Y.CloseCode.CONSENTED)}))}EP(F,P){return this.onMessageHandlers.on(this.getMessageHandlerKey(F),P)}send(F,P){const f=[o.Protocol.ROOM_DATA];let c;if("string"===typeof F?T.encode.string(f,F):T.encode.number(f,F),void 0!==P){const F=H.encode(P);c=new Uint8Array(f.length+F.byteLength),c.set(new Uint8Array(f),0),c.set(new Uint8Array(F),f.length)}else c=new Uint8Array(f);this.connection.send(c.buffer)}Nj(F,P){const f=[o.Protocol.ROOM_DATA_BYTES];let c;"string"===typeof F?T.encode.string(f,F):T.encode.number(f,F),c=new Uint8Array(f.length+(P.byteLength||P.length)),c.set(new Uint8Array(f),0),c.set(new Uint8Array(P),f.length),this.connection.send(c.buffer)}get state(){return this.serializer.getState()}NP(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(F){const P=Array.from(new Uint8Array(F.data)),f=P[0];if(f===o.Protocol.JOIN_ROOM){let F=1;const f=(0,o.utf8Read)(P,F);if(F+=(0,o.utf8Length)(f),this.serializerId=(0,o.utf8Read)(P,F),F+=(0,o.utf8Length)(this.serializerId),!this.serializer){const F=(0,j.getSerializer)(this.serializerId);this.serializer=new F}P.length>F&&this.serializer.handshake&&this.serializer.handshake(P,{offset:F}),this.reconnectionToken=`${this.roomId}:${f}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([o.Protocol.JOIN_ROOM])}else if(f===o.Protocol.ERROR){const F={offset:1},f=T.decode.number(P,F),c=T.decode.string(P,F);this.onError.invoke(f,c)}else if(f===o.Protocol.LEAVE_ROOM)this.Fo();else if(f===o.Protocol.ROOM_DATA_SCHEMA){const F={offset:1},f=this.serializer.getState().constructor._context.get(T.decode.number(P,F)),c=new f;c.decode(P,F),this.dispatchMessage(f,c)}else if(f===o.Protocol.ROOM_STATE)P.shift(),this.setState(P);else if(f===o.Protocol.ROOM_STATE_PATCH)P.shift(),this.patch(P);else if(f===o.Protocol.ROOM_DATA){const f={offset:1},c=T.decode.stringCheck(P,f)?T.decode.string(P,f):T.decode.number(P,f),N=P.length>f.offset?H.decode(F.data,f.offset):void 0;this.dispatchMessage(c,N)}else if(f===o.Protocol.ROOM_DATA_BYTES){const F={offset:1},f=T.decode.stringCheck(P,F)?T.decode.string(P,F):T.decode.number(P,F);this.dispatchMessage(f,new Uint8Array(P.slice(F.offset)))}}setState(F){this.serializer.setState(F),this.onStateChange.invoke(this.serializer.getState())}patch(F){this.serializer.patch(F),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(F,P){var f;const c=this.getMessageHandlerKey(F);this.onMessageHandlers.events[c]?this.onMessageHandlers.emit(c,P):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",F,P):null===(f=console.warn)||void 0===f||f.call(console,`colyseus.js: onMessage() not registered for type '${F}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(F){switch(typeof F){case"function":return`$${F._typeid}`;case"string":return F;case"number":return`i${F}`;default:throw new Error("invalid message type.")}}}P.Room=t},12329:(F,P)=>{"use strict";let f;function c(){if(!f)try{f="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(F){}return f||(f={cache:{},setItem:function(F,P){this.cache[F]=P},getItem:function(F){this.cache[F]},removeItem:function(F){delete this.cache[F]}}),f}Object.defineProperty(P,"__esModule",{value:!0}),P.getItem=P.removeItem=P.setItem=void 0,P.setItem=function(F,P){c().setItem(F,P)},P.removeItem=function(F){c().removeItem(F)},P.getItem=function(F,P){const f=c().getItem(F);"undefined"!==typeof Promise&&f instanceof Promise?f.then((F=>P(F))):P(f)}},12299:(F,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.createNanoEvents=void 0;P.createNanoEvents=()=>({emit(F){let P=this.events[F]||[];for(var f=arguments.length,c=new Array(f>1?f-1:0),N=1;N<f;N++)c[N-1]=arguments[N];for(let q=0,H=P.length;q<H;q++)P[q](...c)},events:{},on(F,P){var f;return(null===(f=this.events[F])||void 0===f?void 0:f.push(P))||(this.events[F]=[P]),()=>{var f;this.events[F]=null===(f=this.events[F])||void 0===f?void 0:f.filter((F=>P!==F))}}})},12304:(F,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.createSignal=P.EventEmitter=void 0;class f{constructor(){this.handlers=[]}register(F){return this.handlers.push(F),this}invoke(){for(var F=arguments.length,P=new Array(F),f=0;f<F;f++)P[f]=arguments[f];this.handlers.forEach((F=>F.apply(this,P)))}invokeAsync(){for(var F=arguments.length,P=new Array(F),f=0;f<F;f++)P[f]=arguments[f];return Promise.all(this.handlers.map((F=>F.apply(this,P))))}remove(F){const P=this.handlers.indexOf(F);this.handlers[P]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}P.EventEmitter=f,P.createSignal=function(){const F=new f;function P(P){return F.register(P,null===this)}return P.once=P=>{const f=function(){for(var c=arguments.length,N=new Array(c),q=0;q<c;q++)N[q]=arguments[q];P.apply(this,N),F.remove(f)};F.register(f)},P.remove=P=>F.remove(P),P.invoke=function(){return F.invoke(...arguments)},P.invokeAsync=function(){return F.invokeAsync(...arguments)},P.clear=()=>F.clear(),P}},12255:(F,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.ServerError=P.CloseCode=void 0,function(F){F[F.CONSENTED=4e3]="CONSENTED",F[F.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(P.CloseCode||(P.CloseCode={}));class f extends Error{constructor(F,P){super(P),this.name="ServerError",this.code=F}}P.ServerError=f},12233:(F,P,f)=>{"use strict";P.b=void 0,f(12238);var c=f(12246);Object.defineProperty(P,"b",{enumerable:!0,get:function(){return c.Client}});var N=f(12290);var q=f(12258);var H=f(12324);const A=f(12341);const o=f(12343),j=f(12293);(0,j.registerSerializer)("schema",A.SchemaSerializer),(0,j.registerSerializer)("none",o.NoneSerializer)},12238:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=F=>null!==F&&"object"===typeof F&&F.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12267:(F,P)=>{"use strict";function f(F,P){if(this._offset=P,F instanceof ArrayBuffer)this._buffer=F,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(F))throw new Error("Invalid argument");this._buffer=F.buffer,this._view=new DataView(this._buffer,F.byteOffset,F.byteLength)}}Object.defineProperty(P,"__esModule",{value:!0}),P.decode=P.encode=void 0,f.prototype._array=function(F){for(var P=new Array(F),f=0;f<F;f++)P[f]=this._parse();return P},f.prototype._map=function(F){for(var P={},f=0;f<F;f++)P[this._parse()]=this._parse();return P},f.prototype._str=function(F){var P=function(F,P,f){for(var c="",N=0,q=P,H=P+f;q<H;q++){var A=F.getUint8(q);if(0!==(128&A))if(192!==(224&A))if(224!==(240&A)){if(240!==(248&A))throw new Error("Invalid byte "+A.toString(16));(N=(7&A)<<18|(63&F.getUint8(++q))<<12|(63&F.getUint8(++q))<<6|63&F.getUint8(++q))>=65536?(N-=65536,c+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):c+=String.fromCharCode(N)}else c+=String.fromCharCode((15&A)<<12|(63&F.getUint8(++q))<<6|63&F.getUint8(++q));else c+=String.fromCharCode((31&A)<<6|63&F.getUint8(++q));else c+=String.fromCharCode(A)}return c}(this._view,this._offset,F);return this._offset+=F,P},f.prototype._bin=function(F){var P=this._buffer.slice(this._offset,this._offset+F);return this._offset+=F,P},f.prototype._parse=function(){var F,P=this._view.getUint8(this._offset++),f=0,c=0,N=0,q=0;if(P<192)return P<128?P:P<144?this._map(15&P):P<160?this._array(15&P):this._str(31&P);if(P>223)return-1*(255-P+1);switch(P){case 192:return null;case 194:return!1;case 195:return!0;case 196:return f=this._view.getUint8(this._offset),this._offset+=1,this._bin(f);case 197:return f=this._view.getUint16(this._offset),this._offset+=2,this._bin(f);case 198:return f=this._view.getUint32(this._offset),this._offset+=4,this._bin(f);case 199:if(f=this._view.getUint8(this._offset),c=this._view.getInt8(this._offset+1),this._offset+=2,-1===c){var H=this._view.getUint32(this._offset);return N=this._view.getInt32(this._offset+4),q=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*N+q)+H/1e6)}return[c,this._bin(f)];case 200:return f=this._view.getUint16(this._offset),c=this._view.getInt8(this._offset+2),this._offset+=3,[c,this._bin(f)];case 201:return f=this._view.getUint32(this._offset),c=this._view.getInt8(this._offset+4),this._offset+=5,[c,this._bin(f)];case 202:return F=this._view.getFloat32(this._offset),this._offset+=4,F;case 203:return F=this._view.getFloat64(this._offset),this._offset+=8,F;case 204:return F=this._view.getUint8(this._offset),this._offset+=1,F;case 205:return F=this._view.getUint16(this._offset),this._offset+=2,F;case 206:return F=this._view.getUint32(this._offset),this._offset+=4,F;case 207:return N=this._view.getUint32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,N+q;case 208:return F=this._view.getInt8(this._offset),this._offset+=1,F;case 209:return F=this._view.getInt16(this._offset),this._offset+=2,F;case 210:return F=this._view.getInt32(this._offset),this._offset+=4,F;case 211:return N=this._view.getInt32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,N+q;case 212:return c=this._view.getInt8(this._offset),this._offset+=1,0===c?void(this._offset+=1):[c,this._bin(1)];case 213:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(2)];case 214:return c=this._view.getInt8(this._offset),this._offset+=1,-1===c?(F=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*F)):[c,this._bin(4)];case 215:return c=this._view.getInt8(this._offset),this._offset+=1,0===c?(N=this._view.getInt32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(N+q)):-1===c?(N=this._view.getUint32(this._offset),q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&N)+q)+(N>>>2)/1e6)):[c,this._bin(8)];case 216:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(16)];case 217:return f=this._view.getUint8(this._offset),this._offset+=1,this._str(f);case 218:return f=this._view.getUint16(this._offset),this._offset+=2,this._str(f);case 219:return f=this._view.getUint32(this._offset),this._offset+=4,this._str(f);case 220:return f=this._view.getUint16(this._offset),this._offset+=2,this._array(f);case 221:return f=this._view.getUint32(this._offset),this._offset+=4,this._array(f);case 222:return f=this._view.getUint16(this._offset),this._offset+=2,this._map(f);case 223:return f=this._view.getUint32(this._offset),this._offset+=4,this._map(f)}throw new Error("Could not parse")},P.decode=function(F){var P=new f(F,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),c=P._parse();if(P._offset!==F.byteLength)throw new Error(F.byteLength-P._offset+" trailing bytes");return c};function c(F,P,f){for(var c=0,N=0,q=f.length;N<q;N++)(c=f.charCodeAt(N))<128?F.setUint8(P++,c):c<2048?(F.setUint8(P++,192|c>>6),F.setUint8(P++,128|63&c)):c<55296||c>=57344?(F.setUint8(P++,224|c>>12),F.setUint8(P++,128|c>>6&63),F.setUint8(P++,128|63&c)):(N++,c=65536+((1023&c)<<10|1023&f.charCodeAt(N)),F.setUint8(P++,240|c>>18),F.setUint8(P++,128|c>>12&63),F.setUint8(P++,128|c>>6&63),F.setUint8(P++,128|63&c))}function N(F,P,f){var c=typeof f,q=0,H=0,A=0,o=0,j=0,i=0;if("string"===c){if(j=function(F){for(var P=0,f=0,c=0,N=F.length;c<N;c++)(P=F.charCodeAt(c))<128?f+=1:P<2048?f+=2:P<55296||P>=57344?f+=3:(c++,f+=4);return f}(f),j<32)F.push(160|j),i=1;else if(j<256)F.push(217,j),i=2;else if(j<65536)F.push(218,j>>8,j),i=3;else{if(!(j<4294967296))throw new Error("String too long");F.push(219,j>>24,j>>16,j>>8,j),i=5}return P.push({_str:f,_length:j,_offset:F.length}),i+j}if("number"===c)return Math.floor(f)===f&&isFinite(f)?f>=0?f<128?(F.push(f),1):f<256?(F.push(204,f),2):f<65536?(F.push(205,f>>8,f),3):f<4294967296?(F.push(206,f>>24,f>>16,f>>8,f),5):(A=f/Math.pow(2,32)|0,o=f>>>0,F.push(207,A>>24,A>>16,A>>8,A,o>>24,o>>16,o>>8,o),9):f>=-32?(F.push(f),1):f>=-128?(F.push(208,f),2):f>=-32768?(F.push(209,f>>8,f),3):f>=-2147483648?(F.push(210,f>>24,f>>16,f>>8,f),5):(A=Math.floor(f/Math.pow(2,32)),o=f>>>0,F.push(211,A>>24,A>>16,A>>8,A,o>>24,o>>16,o>>8,o),9):(F.push(203),P.push({_float:f,_length:8,_offset:F.length}),9);if("object"===c){if(null===f)return F.push(192),1;if(Array.isArray(f)){if((j=f.length)<16)F.push(144|j),i=1;else if(j<65536)F.push(220,j>>8,j),i=3;else{if(!(j<4294967296))throw new Error("Array too large");F.push(221,j>>24,j>>16,j>>8,j),i=5}for(q=0;q<j;q++)i+=N(F,P,f[q]);return i}if(f instanceof Date){var u=f.getTime(),T=Math.floor(u/1e3),Y=1e6*(u-1e3*T);return T>=0&&Y>=0&&T<=17179869183?0===Y&&T<=4294967295?(F.push(214,255,T>>24,T>>16,T>>8,T),6):(A=T/4294967296,o=4294967295&T,F.push(215,255,Y>>22,Y>>14,Y>>6,A,o>>24,o>>16,o>>8,o),10):(A=Math.floor(T/4294967296),o=T>>>0,F.push(199,12,255,Y>>24,Y>>16,Y>>8,Y,A>>24,A>>16,A>>8,A,o>>24,o>>16,o>>8,o),15)}if(f instanceof ArrayBuffer){if((j=f.byteLength)<256)F.push(196,j),i=2;else if(j<65536)F.push(197,j>>8,j),i=3;else{if(!(j<4294967296))throw new Error("Buffer too large");F.push(198,j>>24,j>>16,j>>8,j),i=5}return P.push({_bin:f,_length:j,_offset:F.length}),i+j}if("function"===typeof f.toJSON)return N(F,P,f.toJSON());var t=[],C="",L=Object.keys(f);for(q=0,H=L.length;q<H;q++)void 0!==f[C=L[q]]&&"function"!==typeof f[C]&&t.push(C);if((j=t.length)<16)F.push(128|j),i=1;else if(j<65536)F.push(222,j>>8,j),i=3;else{if(!(j<4294967296))throw new Error("Object too large");F.push(223,j>>24,j>>16,j>>8,j),i=5}for(q=0;q<j;q++)i+=N(F,P,C=t[q]),i+=N(F,P,f[C]);return i}if("boolean"===c)return F.push(f?195:194),1;if("undefined"===c)return F.push(192),1;if("function"===typeof f.toJSON)return N(F,P,f.toJSON());throw new Error("Could not encode")}P.encode=function(F){var P=[],f=[],q=N(P,f,F),H=new ArrayBuffer(q),A=new DataView(H),o=0,j=0,i=-1;f.length>0&&(i=f[0]._offset);for(var u,T=0,Y=0,t=0,C=P.length;t<C;t++)if(A.setUint8(j+t,P[t]),t+1===i){if(T=(u=f[o])._length,Y=j+i,u._bin)for(var L=new Uint8Array(u._bin),J=0;J<T;J++)A.setUint8(Y+J,L[J]);else u._str?c(A,Y,u._str):void 0!==u._float&&A.setFloat64(Y,u._float);j+=T,f[++o]&&(i=f[o]._offset)}return H}},12343:(F,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.NoneSerializer=void 0;P.NoneSerializer=class{setState(F){}getState(){return null}patch(F){}teardown(){}handshake(F){}}},12341:(F,P,f)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.SchemaSerializer=void 0;const c=f(12307);P.SchemaSerializer=class{setState(F){return this.state.decode(F)}getState(){return this.state}patch(F){return this.state.decode(F)}teardown(){var F,P;null===(P=null===(F=this.state)||void 0===F?void 0:F.$changes)||void 0===P||P.root.clearRefs()}handshake(F,P){if(this.state){(new c.Reflection).decode(F,P)}else this.state=c.Reflection.decode(F,P)}}},12293:(F,P)=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0}),P.getSerializer=P.registerSerializer=void 0;const f={};P.registerSerializer=function(F,P){f[F]=P},P.getSerializer=function(F){const P=f[F];if(!P)throw new Error("missing serializer: "+F);return P}},12278:function(F,P,f){"use strict";var c=this&&this.__importDefault||function(F){return F&&F.__esModule?F:{default:F}};Object.defineProperty(P,"__esModule",{value:!0}),P.WebSocketTransport=void 0;const N=c(f(12283)),q=globalThis.WebSocket||N.default;P.WebSocketTransport=class{constructor(F){this.events=F}send(F){F instanceof ArrayBuffer?this.ws.send(F):Array.isArray(F)&&this.ws.send(new Uint8Array(F).buffer)}connect(F,P){try{this.ws=new q(F,{headers:P,protocols:this.protocols})}catch(f){this.ws=new q(F,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(F,P){this.ws.close(F,P)}get isOpen(){return this.ws.readyState===q.OPEN}}},12283:F=>{"use strict";F.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12693:F=>{"use strict";F.exports=function(F){for(var P=new Array(F),f=0;f<F;++f)P[f]=f;return P}},12702:F=>{function P(F){return!!F.constructor&&"function"===typeof F.constructor.isBuffer&&F.constructor.isBuffer(F)}F.exports=function(F){return null!=F&&(P(F)||function(F){return"function"===typeof F.readFloatLE&&"function"===typeof F.slice&&P(F.slice(0,0))}(F)||!!F._isBuffer)}},12690:(F,P,f)=>{var c=f(12693),N=f(12702),q="undefined"!==typeof Float64Array;function H(F,P){return F[0]-P[0]}function A(){var F,P=this.stride,f=new Array(P.length);for(F=0;F<f.length;++F)f[F]=[Math.abs(P[F]),F];f.sort(H);var c=new Array(f.length);for(F=0;F<c.length;++F)c[F]=f[F][1];return c}function o(F,P){var f=["View",P,"d",F].join("");P<0&&(f="View_Nil"+F);var N="generic"===F;if(-1===P){var q="function "+f+"(a){this.data=a;};var proto="+f+".prototype;proto.dtype='"+F+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+f+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+f+"(a){return new "+f+"(a);}";return new Function(q)()}if(0===P){q="function "+f+"(a,d) {this.data = a;this.offset = d};var proto="+f+".prototype;proto.dtype='"+F+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+f+"_copy() {return new "+f+"(this.data,this.offset)};proto.pick=function "+f+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+f+"_get(){return "+(N?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+f+"_set(v){return "+(N?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+f+"(a,b,c,d){return new "+f+"(a,d)}";return new Function("TrivialArray",q)(j[F][0])}q=["'use strict'"];var H=c(P),o=H.map((function(F){return"i"+F})),i="this.offset+"+H.map((function(F){return"this.stride["+F+"]*i"+F})).join("+"),u=H.map((function(F){return"b"+F})).join(","),T=H.map((function(F){return"c"+F})).join(",");q.push("function "+f+"(a,"+u+","+T+",d){this.data=a","this.shape=["+u+"]","this.stride=["+T+"]","this.offset=d|0}","var proto="+f+".prototype","proto.dtype='"+F+"'","proto.dimension="+P),q.push("Object.defineProperty(proto,'size',{get:function "+f+"_size(){return "+H.map((function(F){return"this.shape["+F+"]"})).join("*"),"}})"),1===P?q.push("proto.order=[0]"):(q.push("Object.defineProperty(proto,'order',{get:"),P<4?(q.push("function "+f+"_order(){"),2===P?q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===P&&q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):q.push("ORDER})")),q.push("proto.set=function "+f+"_set("+o.join(",")+",v){"),N?q.push("return this.data.set("+i+",v)}"):q.push("return this.data["+i+"]=v}"),q.push("proto.get=function "+f+"_get("+o.join(",")+"){"),N?q.push("return this.data.get("+i+")}"):q.push("return this.data["+i+"]}"),q.push("proto.index=function "+f+"_index(",o.join(),"){return "+i+"}"),q.push("proto.hi=function "+f+"_hi("+o.join(",")+"){return new "+f+"(this.data,"+H.map((function(F){return["(typeof i",F,"!=='number'||i",F,"<0)?this.shape[",F,"]:i",F,"|0"].join("")})).join(",")+","+H.map((function(F){return"this.stride["+F+"]"})).join(",")+",this.offset)}");var Y=H.map((function(F){return"a"+F+"=this.shape["+F+"]"})),t=H.map((function(F){return"c"+F+"=this.stride["+F+"]"}));q.push("proto.lo=function "+f+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+Y.join(",")+","+t.join(","));for(var C=0;C<P;++C)q.push("if(typeof i"+C+"==='number'&&i"+C+">=0){d=i"+C+"|0;b+=c"+C+"*d;a"+C+"-=d}");q.push("return new "+f+"(this.data,"+H.map((function(F){return"a"+F})).join(",")+","+H.map((function(F){return"c"+F})).join(",")+",b)}"),q.push("proto.step=function "+f+"_step("+o.join(",")+"){var "+H.map((function(F){return"a"+F+"=this.shape["+F+"]"})).join(",")+","+H.map((function(F){return"b"+F+"=this.stride["+F+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(C=0;C<P;++C)q.push("if(typeof i"+C+"==='number'){d=i"+C+"|0;if(d<0){c+=b"+C+"*(a"+C+"-1);a"+C+"=ceil(-a"+C+"/d)}else{a"+C+"=ceil(a"+C+"/d)}b"+C+"*=d}");q.push("return new "+f+"(this.data,"+H.map((function(F){return"a"+F})).join(",")+","+H.map((function(F){return"b"+F})).join(",")+",c)}");var L=new Array(P),J=new Array(P);for(C=0;C<P;++C)L[C]="a[i"+C+"]",J[C]="b[i"+C+"]";q.push("proto.transpose=function "+f+"_transpose("+o+"){"+o.map((function(F,P){return F+"=("+F+"===undefined?"+P+":"+F+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+f+"(this.data,"+L.join(",")+","+J.join(",")+",this.offset)}"),q.push("proto.pick=function "+f+"_pick("+o+"){var a=[],b=[],c=this.offset");for(C=0;C<P;++C)q.push("if(typeof i"+C+"==='number'&&i"+C+">=0){c=(c+this.stride["+C+"]*i"+C+")|0}else{a.push(this.shape["+C+"]);b.push(this.stride["+C+"])}");return q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),q.push("return function construct_"+f+"(data,shape,stride,offset){return new "+f+"(data,"+H.map((function(F){return"shape["+F+"]"})).join(",")+","+H.map((function(F){return"stride["+F+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",q.join("\n"))(j[F],A)}var j={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};F.exports=function(F,P,f,c){if(void 0===F)return(0,j.array[0])([]);"number"===typeof F&&(F=[F]),void 0===P&&(P=[F.length]);var H=P.length;if(void 0===f){f=new Array(H);for(var A=H-1,i=1;A>=0;--A)f[A]=i,i*=P[A]}if(void 0===c){c=0;for(A=0;A<H;++A)f[A]<0&&(c-=(P[A]-1)*f[A])}for(var u=function(F){if(N(F))return"buffer";if(q)switch(Object.prototype.toString.call(F)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(F)?"array":"generic"}(F),T=j[u];T.length<=H+1;)T.push(o(u,T.length-1));return(0,T[H+1])(F,P,f,c)}},13668:F=>{var P;self,P=()=>(()=>{"use strict";var F={d:(P,f)=>{for(var c in f)F.o(f,c)&&!F.o(P,c)&&Object.defineProperty(P,c,{enumerable:!0,get:f[c]})},o:(F,P)=>Object.prototype.hasOwnProperty.call(F,P)},P={};F.d(P,{default:()=>E});var f,c=function(F,P){var f=P.x-F.x,c=P.y-F.y;return Math.sqrt(f*f+c*c)},N=function(F){return F*(Math.PI/180)},q=new Map,H=function(F){q.has(F)&&clearTimeout(q.get(F)),q.set(F,setTimeout(F,100))},A=function(F,P,f){for(var c,N=P.split(/[ ,]+/g),q=0;q<N.length;q+=1)c=N[q],F.addEventListener?F.addEventListener(c,f,!1):F.attachEvent&&F.attachEvent(c,f)},o=function(F,P,f){for(var c,N=P.split(/[ ,]+/g),q=0;q<N.length;q+=1)c=N[q],F.removeEventListener?F.removeEventListener(c,f):F.detachEvent&&F.detachEvent(c,f)},j=function(F){return F.preventDefault(),F.type.match(/^touch/)?F.changedTouches:F},i=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},u=function(F,P){P.top||P.right||P.bottom||P.left?(F.style.top=P.top,F.style.right=P.right,F.style.bottom=P.bottom,F.style.left=P.left):(F.style.left=P.x+"px",F.style.top=P.y+"px")},T=function(F,P,f){var c=Y(F);for(var N in c)if(c.hasOwnProperty(N))if("string"==typeof P)c[N]=P+" "+f;else{for(var q="",H=0,A=P.length;H<A;H+=1)q+=P[H]+" "+f+", ";c[N]=q.slice(0,-2)}return c},Y=function(F){var P={};return P[F]="",["webkit","Moz","o"].forEach((function(f){P[f+F.charAt(0).toUpperCase()+F.slice(1)]=""})),P},t=function(F,P){for(var f in P)P.hasOwnProperty(f)&&(F[f]=P[f]);return F},C=function(F,P){if(F.length)for(var f=0,c=F.length;f<c;f+=1)P(F[f]);else P(F)},L="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,J=window.matchMedia("(any-hover: none)").matches,B=!!("ontouchstart"in window),z=!!window.PointerEvent,Z=!!window.MSPointerEvent,R={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},y={start:"mousedown",move:"mousemove",end:"mouseup"},O={};function d(){}L&&!J?f=R:z?f={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Z?f={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:B?(f=R,O=y):f=y,d.prototype.on=function(F,P){var f,c=this,N=F.split(/[ ,]+/g);c._handlers_=c._handlers_||{};for(var q=0;q<N.length;q+=1)f=N[q],c._handlers_[f]=c._handlers_[f]||[],c._handlers_[f].push(P);return c},d.prototype.off=function(F,P){var f=this;return f._handlers_=f._handlers_||{},void 0===F?f._handlers_={}:void 0===P?f._handlers_[F]=null:f._handlers_[F]&&f._handlers_[F].indexOf(P)>=0&&f._handlers_[F].splice(f._handlers_[F].indexOf(P),1),f},d.prototype.trigger=function(F,P){var f,c=this,N=F.split(/[ ,]+/g);c._handlers_=c._handlers_||{};for(var q=0;q<N.length;q+=1)f=N[q],c._handlers_[f]&&c._handlers_[f].length&&c._handlers_[f].forEach((function(F){F.call(c,{type:f,target:c},P)}))},d.prototype.config=function(F){var P=this;P.options=P.defaults||{},F&&(P.options=function(F,P){var f={};for(var c in F)F.hasOwnProperty(c)&&P.hasOwnProperty(c)?f[c]=P[c]:F.hasOwnProperty(c)&&(f[c]=F[c]);return f}(P.options,F))},d.prototype.bindEvt=function(F,P){var c=this;return c._domHandlers_=c._domHandlers_||{},c._domHandlers_[P]=function(){"function"==typeof c["on"+P]?c["on"+P].apply(c,arguments):console.warn('[WARNING] : Missing "on'+P+'" handler.')},A(F,f[P],c._domHandlers_[P]),O[P]&&A(F,O[P],c._domHandlers_[P]),c},d.prototype.unbindEvt=function(F,P){var c=this;return c._domHandlers_=c._domHandlers_||{},o(F,f[P],c._domHandlers_[P]),O[P]&&o(F,O[P],c._domHandlers_[P]),delete c._domHandlers_[P],this};const M=d;function V(F,P){return this.identifier=P.identifier,this.position=P.position,this.frontPosition=P.frontPosition,this.collection=F,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(P),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=V.id,V.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}V.prototype=new M,V.constructor=V,V.id=0,V.prototype.buildEl=function(F){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},V.prototype.stylize=function(){if(this.options.dataOnly)return this;var F=this.options.fadeTime+"ms",P=function(){var F=Y("borderRadius");for(var P in F)F.hasOwnProperty(P)&&(F[P]="50%");return F}(),f=T("transition","opacity",F),c={};return c.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},c.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},c.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},t(c.el,f),"circle"===this.options.shape&&t(c.back,P),t(c.front,P),this.applyStyles(c),this},V.prototype.applyStyles=function(F){for(var P in this.ui)if(this.ui.hasOwnProperty(P))for(var f in F[P])this.ui[P].style[f]=F[P][f];return this},V.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},V.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},V.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},V.prototype.show=function(F){var P=this;return P.options.dataOnly||(clearTimeout(P.removeTimeout),clearTimeout(P.showTimeout),clearTimeout(P.restTimeout),P.addToDom(),P.restCallback(),setTimeout((function(){P.ui.el.style.opacity=1}),0),P.showTimeout=setTimeout((function(){P.trigger("shown",P.instance),"function"==typeof F&&F.call(this)}),P.options.fadeTime)),P},V.prototype.hide=function(F){var P=this;if(P.options.dataOnly)return P;if(P.ui.el.style.opacity=P.options.restOpacity,clearTimeout(P.removeTimeout),clearTimeout(P.showTimeout),clearTimeout(P.restTimeout),P.removeTimeout=setTimeout((function(){var f="dynamic"===P.options.mode?"none":"block";P.ui.el.style.display=f,"function"==typeof F&&F.call(P),P.trigger("hidden",P.instance)}),P.options.fadeTime),P.options.restJoystick){var f=P.options.restJoystick,c={};c.x=!0===f||!1!==f.x?0:P.instance.frontPosition.x,c.y=!0===f||!1!==f.y?0:P.instance.frontPosition.y,P.setPosition(F,c)}return P},V.prototype.setPosition=function(F,P){var f=this;f.frontPosition={x:P.x,y:P.y};var c=f.options.fadeTime+"ms",N={};N.front=T("transition",["transform"],c);var q={front:{}};q.front={transform:"translate("+f.frontPosition.x+"px,"+f.frontPosition.y+"px)"},f.applyStyles(N),f.applyStyles(q),f.restTimeout=setTimeout((function(){"function"==typeof F&&F.call(f),f.restCallback()}),f.options.fadeTime)},V.prototype.restCallback=function(){var F=this,P={};P.front=T("transition","none",""),F.applyStyles(P),F.trigger("rested",F.instance)},V.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},V.prototype.computeDirection=function(F){var P,f,c,N=F.angle.radian,q=Math.PI/4,H=Math.PI/2;if(N>q&&N<3*q&&!F.lockX?P="up":N>-q&&N<=q&&!F.lockY?P="left":N>3*-q&&N<=-q&&!F.lockX?P="down":F.lockY||(P="right"),F.lockY||(f=N>-H&&N<H?"left":"right"),F.lockX||(c=N>0?"up":"down"),F.force>this.options.threshold){var A,o={};for(A in this.direction)this.direction.hasOwnProperty(A)&&(o[A]=this.direction[A]);var j={};for(A in this.direction={x:f,y:c,angle:P},F.direction=this.direction,o)o[A]===this.direction[A]&&(j[A]=!0);if(j.x&&j.y&&j.angle)return F;j.x&&j.y||this.trigger("plain",F),j.x||this.trigger("plain:"+f,F),j.y||this.trigger("plain:"+c,F),j.angle||this.trigger("dir dir:"+P,F)}else this.resetDirection();return F};const Q=V;function K(F,P){var f=this;f.nipples=[],f.idles=[],f.actives=[],f.ids=[],f.pressureIntervals={},f.manager=F,f.id=K.id,K.id+=1,f.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},f.config(P),"static"!==f.options.mode&&"semi"!==f.options.mode||(f.options.multitouch=!1),f.options.multitouch||(f.options.maxNumberOfNipples=1);var c=getComputedStyle(f.options.zone.parentElement);return c&&"flex"===c.display&&(f.parentIsFlex=!0),f.updateBox(),f.prepareNipples(),f.VT(),f.begin(),f.nipples}K.prototype=new M,K.constructor=K,K.id=0,K.prototype.prepareNipples=function(){var F=this,P=F.nipples;P.on=F.on.bind(F),P.off=F.off.bind(F),P.options=F.options,P.destroy=F.destroy.bind(F),P.ids=F.ids,P.id=F.id,P.processOnMove=F.processOnMove.bind(F),P.processOnEnd=F.processOnEnd.bind(F),P.get=function(F){if(void 0===F)return P[0];for(var f=0,c=P.length;f<c;f+=1)if(P[f].identifier===F)return P[f];return!1}},K.prototype.VT=function(){var F=this;F.bindEvt(F.options.zone,"start"),F.options.zone.style.touchAction="none",F.options.zone.style.msTouchAction="none"},K.prototype.begin=function(){var F=this,P=F.options;if("static"===P.mode){var f=F.createNipple(P.position,F.manager.getIdentifier());f.add(),F.idles.push(f)}},K.prototype.createNipple=function(F,P){var f=this,c=f.manager.scroll,N={},q=f.options,H=f.parentIsFlex?c.x:c.x+f.box.left,A=f.parentIsFlex?c.y:c.y+f.box.top;if(F.x&&F.y)N={x:F.x-H,y:F.y-A};else if(F.top||F.right||F.bottom||F.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=F.top,o.style.right=F.right,o.style.bottom=F.bottom,o.style.left=F.left,o.style.position="absolute",q.zone.appendChild(o);var j=o.getBoundingClientRect();q.zone.removeChild(o),N=F,F={x:j.left+c.x,y:j.top+c.y}}var i=new Q(f,{color:q.color,size:q.size,threshold:q.threshold,fadeTime:q.fadeTime,dataOnly:q.dataOnly,restJoystick:q.restJoystick,restOpacity:q.restOpacity,mode:q.mode,identifier:P,position:F,zone:q.zone,frontPosition:{x:0,y:0},shape:q.shape});return q.dataOnly||(u(i.ui.el,N),u(i.ui.front,i.frontPosition)),f.nipples.push(i),f.trigger("added "+i.identifier+":added",i),f.manager.trigger("added "+i.identifier+":added",i),f.bindNipple(i),i},K.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},K.prototype.bindNipple=function(F){var P,f=this,c=function(F,c){P=F.type+" "+c.id+":"+F.type,f.trigger(P,c)};F.on("destroyed",f.onDestroyed.bind(f)),F.on("shown hidden rested dir plain",c),F.on("dir:up dir:right dir:down dir:left",c),F.on("plain:up plain:right plain:down plain:left",c)},K.prototype.pressureFn=function(F,P,f){var c=this,N=0;clearInterval(c.pressureIntervals[f]),c.pressureIntervals[f]=setInterval(function(){var f=F.force||F.pressure||F.webkitForce||0;f!==N&&(P.trigger("pressure",f),c.trigger("pressure "+P.identifier+":pressure",f),N=f)}.bind(c),100)},K.prototype.onstart=function(F){var P=this,f=P.options,c=F;return F=j(F),P.updateBox(),C(F,(function(N){P.actives.length<f.maxNumberOfNipples?P.processOnStart(N):c.type.match(/^touch/)&&(Object.keys(P.manager.ids).forEach((function(f){if(Object.values(c.touches).findIndex((function(F){return F.identifier===f}))<0){var N=[F[0]];N.identifier=f,P.processOnEnd(N)}})),P.actives.length<f.maxNumberOfNipples&&P.processOnStart(N))})),P.manager.bindDocument(),!1},K.prototype.processOnStart=function(F){var P,f=this,N=f.options,q=f.manager.getIdentifier(F),H=F.force||F.pressure||F.webkitForce||0,A={x:F.pageX,y:F.pageY},o=f.getOrCreate(q,A);o.identifier!==q&&f.manager.removeIdentifier(o.identifier),o.identifier=q;var j=function(P){P.trigger("start",P),f.trigger("start "+P.id+":start",P),P.show(),H>0&&f.pressureFn(F,P,P.identifier),f.processOnMove(F)};if((P=f.idles.indexOf(o))>=0&&f.idles.splice(P,1),f.actives.push(o),f.ids.push(o.identifier),"semi"!==N.mode)j(o);else{if(!(c(A,o.position)<=N.catchDistance))return o.destroy(),void f.processOnStart(F);j(o)}return o},K.prototype.getOrCreate=function(F,P){var f,c=this,N=c.options;return/(semi|static)/.test(N.mode)?(f=c.idles[0])?(c.idles.splice(0,1),f):"semi"===N.mode?c.createNipple(P,F):(console.warn("Coudln't find the needed nipple."),!1):f=c.createNipple(P,F)},K.prototype.processOnMove=function(F){var P=this,f=P.options,q=P.manager.getIdentifier(F),H=P.nipples.get(q),A=P.manager.scroll;if(function(F){return isNaN(F.buttons)?0!==F.pressure:0!==F.buttons}(F)){if(!H)return console.error("Found zombie joystick with ID "+q),void P.manager.removeIdentifier(q);if(f.dynamicPage){var o=H.el.getBoundingClientRect();H.position={x:A.x+o.left,y:A.y+o.top}}H.identifier=q;var j=H.options.size/2,i={x:F.pageX,y:F.pageY};f.lockX&&(i.y=H.position.y),f.lockY&&(i.x=H.position.x);var u,T,Y,t,C,L,J,B,z,Z,R=c(i,H.position),y=(u=i,Y=(T=H.position).x-u.x,t=T.y-u.y,function(F){return F*(180/Math.PI)}(Math.atan2(t,Y))),O=N(y),d=R/j,M={distance:R,position:i};if("circle"===H.options.shape?(C=Math.min(R,j),J=H.position,B=C,Z={x:0,y:0},z=N(z=y),Z.x=J.x-B*Math.cos(z),Z.y=J.y-B*Math.sin(z),L=Z):(L=function(F,P,f){return{x:Math.min(Math.max(F.x,P.x-f),P.x+f),y:Math.min(Math.max(F.y,P.y-f),P.y+f)}}(i,H.position,j),C=c(L,H.position)),f.follow){if(R>j){var V=i.x-L.x,Q=i.y-L.y;H.position.x+=V,H.position.y+=Q,H.el.style.top=H.position.y-(P.box.top+A.y)+"px",H.el.style.left=H.position.x-(P.box.left+A.x)+"px",R=c(i,H.position)}}else i=L,R=C;var K=i.x-H.position.x,x=i.y-H.position.y;H.frontPosition={x:K,y:x},f.dataOnly||(H.ui.front.style.transform="translate("+K+"px,"+x+"px)");var k={identifier:H.identifier,position:i,force:d,pressure:F.force||F.pressure||F.webkitForce||0,distance:R,angle:{radian:O,degree:y},vector:{x:K/j,y:-x/j},raw:M,instance:H,lockX:f.lockX,lockY:f.lockY};(k=H.computeDirection(k)).angle={radian:N(180-y),degree:180-y},H.trigger("move",k),P.trigger("move "+H.id+":move",k)}else this.processOnEnd(F)},K.prototype.processOnEnd=function(F){var P=this,f=P.options,c=P.manager.getIdentifier(F),N=P.nipples.get(c),q=P.manager.removeIdentifier(N.identifier);N&&(f.dataOnly||N.hide((function(){"dynamic"===f.mode&&(N.trigger("removed",N),P.trigger("removed "+N.id+":removed",N),P.manager.trigger("removed "+N.id+":removed",N),N.destroy())})),clearInterval(P.pressureIntervals[N.identifier]),N.resetDirection(),N.trigger("end",N),P.trigger("end "+N.id+":end",N),P.ids.indexOf(N.identifier)>=0&&P.ids.splice(P.ids.indexOf(N.identifier),1),P.actives.indexOf(N)>=0&&P.actives.splice(P.actives.indexOf(N),1),/(semi|static)/.test(f.mode)?P.idles.push(N):P.nipples.indexOf(N)>=0&&P.nipples.splice(P.nipples.indexOf(N),1),P.manager.unbindDocument(),/(semi|static)/.test(f.mode)&&(P.manager.ids[q.id]=q.identifier))},K.prototype.onDestroyed=function(F,P){var f=this;f.nipples.indexOf(P)>=0&&f.nipples.splice(f.nipples.indexOf(P),1),f.actives.indexOf(P)>=0&&f.actives.splice(f.actives.indexOf(P),1),f.idles.indexOf(P)>=0&&f.idles.splice(f.idles.indexOf(P),1),f.ids.indexOf(P.identifier)>=0&&f.ids.splice(f.ids.indexOf(P.identifier),1),f.manager.removeIdentifier(P.identifier),f.manager.unbindDocument()},K.prototype.destroy=function(){var F=this;for(var P in F.unbindEvt(F.options.zone,"start"),F.nipples.forEach((function(F){F.destroy()})),F.pressureIntervals)F.pressureIntervals.hasOwnProperty(P)&&clearInterval(F.pressureIntervals[P]);F.trigger("destroyed",F.nipples),F.manager.unbindDocument(),F.off()};const x=K;function k(F){var P=this;P.ids={},P.index=0,P.collections=[],P.scroll=i(),P.config(F),P.prepareCollections();var f=function(){var F;P.collections.forEach((function(f){f.forEach((function(f){F=f.el.getBoundingClientRect(),f.position={x:P.scroll.x+F.left,y:P.scroll.y+F.top}}))}))};A(window,"resize",(function(){H(f)}));var c=function(){P.scroll=i()};return A(window,"scroll",(function(){H(c)})),P.collections}k.prototype=new M,k.constructor=k,k.prototype.prepareCollections=function(){var F=this;F.collections.create=F.create.bind(F),F.collections.on=F.on.bind(F),F.collections.off=F.off.bind(F),F.collections.destroy=F.destroy.bind(F),F.collections.get=function(P){var f;return F.collections.every((function(F){return!(f=F.get(P))})),f}},k.prototype.create=function(F){return this.createCollection(F)},k.prototype.createCollection=function(F){var P=this,f=new x(P,F);return P.bindCollection(f),P.collections.push(f),f},k.prototype.bindCollection=function(F){var P,f=this,c=function(F,c){P=F.type+" "+c.id+":"+F.type,f.trigger(P,c)};F.on("destroyed",f.onDestroyed.bind(f)),F.on("shown hidden rested dir plain",c),F.on("dir:up dir:right dir:down dir:left",c),F.on("plain:up plain:right plain:down plain:left",c)},k.prototype.bindDocument=function(){var F=this;F.binded||(F.bindEvt(document,"move").bindEvt(document,"end"),F.binded=!0)},k.prototype.unbindDocument=function(F){var P=this;Object.keys(P.ids).length&&!0!==F||(P.unbindEvt(document,"move").unbindEvt(document,"end"),P.binded=!1)},k.prototype.getIdentifier=function(F){var P;return F?void 0===(P=void 0===F.identifier?F.pointerId:F.identifier)&&(P=this.latest||0):P=this.index,void 0===this.ids[P]&&(this.ids[P]=this.index,this.index+=1),this.latest=P,this.ids[P]},k.prototype.removeIdentifier=function(F){var P={};for(var f in this.ids)if(this.ids[f]===F){P.id=f,P.identifier=this.ids[f],delete this.ids[f];break}return P},k.prototype.onmove=function(F){return this.onAny("move",F),!1},k.prototype.onend=function(F){return this.onAny("end",F),!1},k.prototype.oncancel=function(F){return this.onAny("end",F),!1},k.prototype.onAny=function(F,P){var f,c=this,N="processOn"+F.charAt(0).toUpperCase()+F.slice(1);P=j(P);var q=function(F,P,f){f.ids.indexOf(P)>=0&&(f[N](F),F._found_=!0)};return C(P,(function(F){f=c.getIdentifier(F),C(c.collections,q.bind(null,F,f)),F._found_||c.removeIdentifier(f)})),!1},k.prototype.destroy=function(){var F=this;F.unbindDocument(!0),F.ids={},F.index=0,F.collections.forEach((function(F){F.destroy()})),F.off()},k.prototype.onDestroyed=function(F,P){var f=this;if(f.collections.indexOf(P)<0)return!1;f.collections.splice(f.collections.indexOf(P),1)};var I=new k;const E={create:function(F){return I.create(F)},factory:I};return P.default})(),F.exports=P()},12720:(F,P,f)=>{"use strict";const{Deflate:c,deflate:N,deflateRaw:q,gzip:H}=f(12724),{Inflate:A,inflate:o,inflateRaw:j,ungzip:i}=f(12773),u=f(12754);F.exports.Deflate=c,F.exports.deflate=N,F.exports.deflateRaw=q,F.exports.gzip=H,F.exports.Inflate=A,F.exports.inflate=o,F.exports.inflateRaw=j,F.exports.ungzip=i,F.exports.constants=u},12724:(F,P,f)=>{"use strict";const c=f(12728),N=f(12757),q=f(12759),H=f(12750),A=f(12766),o=Object.prototype.toString,{Z_NO_FLUSH:j,Z_SYNC_FLUSH:i,Z_FULL_FLUSH:u,Z_FINISH:T,Z_OK:Y,Z_STREAM_END:t,Z_DEFAULT_COMPRESSION:C,Z_DEFAULT_STRATEGY:L,Z_DEFLATED:J}=f(12754);function B(F){this.options=N.assign({level:C,method:J,eF:16384,windowBits:15,memLevel:8,strategy:L},F||{});let P=this.options;P.raw&&P.windowBits>0?P.windowBits=-P.windowBits:P.gzip&&P.windowBits>0&&P.windowBits<16&&(P.windowBits+=16),this.err=0,this.jP="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;let f=c.deflateInit2(this.strm,P.level,P.method,P.windowBits,P.memLevel,P.strategy);if(f!==Y)throw new Error(H[f]);if(P.header&&c.deflateSetHeader(this.strm,P.header),P.dictionary){let F;if(F="string"===typeof P.dictionary?q.string2buf(P.dictionary):"[object ArrayBuffer]"===o.call(P.dictionary)?new Uint8Array(P.dictionary):P.dictionary,f=c.deflateSetDictionary(this.strm,F),f!==Y)throw new Error(H[f]);this._dict_set=!0}}function z(F,P){const f=new B(P);if(f.push(F,!0),f.err)throw f.jP||H[f.err];return f.result}B.prototype.push=function(F,P){const f=this.strm,N=this.options.eF;let H,A;if(this.ended)return!1;for(A=P===~~P?P:!0===P?T:j,"string"===typeof F?f.input=q.string2buf(F):"[object ArrayBuffer]"===o.call(F)?f.input=new Uint8Array(F):f.input=F,f.next_in=0,f.avail_in=f.input.length;;)if(0===f.avail_out&&(f.output=new Uint8Array(N),f.next_out=0,f.avail_out=N),(A===i||A===u)&&f.avail_out<=6)this.onData(f.output.subarray(0,f.next_out)),f.avail_out=0;else{if(H=c.deflate(f,A),H===t)return f.next_out>0&&this.onData(f.output.subarray(0,f.next_out)),H=c.deflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===Y;if(0!==f.avail_out){if(A>0&&f.next_out>0)this.onData(f.output.subarray(0,f.next_out)),f.avail_out=0;else if(0===f.avail_in)break}else this.onData(f.output)}return!0},B.prototype.onData=function(F){this.chunks.push(F)},B.prototype.onEnd=function(F){F===Y&&(this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.jP=this.strm.jP},F.exports.Deflate=B,F.exports.deflate=z,F.exports.deflateRaw=function(F,P){return(P=P||{}).raw=!0,z(F,P)},F.exports.gzip=function(F,P){return(P=P||{}).gzip=!0,z(F,P)},F.exports.constants=f(12754)},12773:(F,P,f)=>{"use strict";const c=f(12780),N=f(12757),q=f(12759),H=f(12750),A=f(12766),o=f(12801),j=Object.prototype.toString,{Z_NO_FLUSH:i,Z_FINISH:u,Z_OK:T,Z_STREAM_END:Y,Z_NEED_DICT:t,Z_STREAM_ERROR:C,Z_DATA_ERROR:L,Z_MEM_ERROR:J}=f(12754);function B(F){this.options=N.assign({eF:65536,windowBits:15,to:""},F||{});const P=this.options;P.raw&&P.windowBits>=0&&P.windowBits<16&&(P.windowBits=-P.windowBits,0===P.windowBits&&(P.windowBits=-15)),!(P.windowBits>=0&&P.windowBits<16)||F&&F.windowBits||(P.windowBits+=32),P.windowBits>15&&P.windowBits<48&&0===(15&P.windowBits)&&(P.windowBits|=15),this.err=0,this.jP="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;let f=c.inflateInit2(this.strm,P.windowBits);if(f!==T)throw new Error(H[f]);if(this.header=new o,c.inflateGetHeader(this.strm,this.header),P.dictionary&&("string"===typeof P.dictionary?P.dictionary=q.string2buf(P.dictionary):"[object ArrayBuffer]"===j.call(P.dictionary)&&(P.dictionary=new Uint8Array(P.dictionary)),P.raw&&(f=c.inflateSetDictionary(this.strm,P.dictionary),f!==T)))throw new Error(H[f])}function z(F,P){const f=new B(P);if(f.push(F),f.err)throw f.jP||H[f.err];return f.result}B.prototype.push=function(F,P){const f=this.strm,N=this.options.eF,H=this.options.dictionary;let A,o,B;if(this.ended)return!1;for(o=P===~~P?P:!0===P?u:i,"[object ArrayBuffer]"===j.call(F)?f.input=new Uint8Array(F):f.input=F,f.next_in=0,f.avail_in=f.input.length;;){for(0===f.avail_out&&(f.output=new Uint8Array(N),f.next_out=0,f.avail_out=N),A=c.inflate(f,o),A===t&&H&&(A=c.inflateSetDictionary(f,H),A===T?A=c.inflate(f,o):A===L&&(A=t));f.avail_in>0&&A===Y&&f.state.wrap>0&&0!==F[f.next_in];)c.inflateReset(f),A=c.inflate(f,o);switch(A){case C:case L:case t:case J:return this.onEnd(A),this.ended=!0,!1}if(B=f.avail_out,f.next_out&&(0===f.avail_out||A===Y))if("string"===this.options.to){let F=q.utf8border(f.output,f.next_out),P=f.next_out-F,c=q.buf2string(f.output,F);f.next_out=P,f.avail_out=N-P,P&&f.output.set(f.output.subarray(F,F+P),0),this.onData(c)}else this.onData(f.output.length===f.next_out?f.output:f.output.subarray(0,f.next_out));if(A!==T||0!==B){if(A===Y)return A=c.inflateEnd(this.strm),this.onEnd(A),this.ended=!0,!0;if(0===f.avail_in)break}}return!0},B.prototype.onData=function(F){this.chunks.push(F)},B.prototype.onEnd=function(F){F===T&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.jP=this.strm.jP},F.exports.Inflate=B,F.exports.inflate=z,F.exports.inflateRaw=function(F,P){return(P=P||{}).raw=!0,z(F,P)},F.exports.ungzip=z,F.exports.constants=f(12754)},12757:F=>{"use strict";const P=(F,P)=>Object.prototype.hasOwnProperty.call(F,P);F.exports.assign=function(F){const f=Array.prototype.slice.call(arguments,1);for(;f.length;){const c=f.shift();if(c){if("object"!==typeof c)throw new TypeError(c+"must be non-object");for(const f in c)P(c,f)&&(F[f]=c[f])}}return F},F.exports.flattenChunks=F=>{let P=0;for(let c=0,N=F.length;c<N;c++)P+=F[c].length;const f=new Uint8Array(P);for(let c=0,N=0,q=F.length;c<q;c++){let P=F[c];f.set(P,N),N+=P.length}return f}},12759:F=>{"use strict";let P=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(c){P=!1}const f=new Uint8Array(256);for(let N=0;N<256;N++)f[N]=N>=252?6:N>=248?5:N>=240?4:N>=224?3:N>=192?2:1;f[254]=f[254]=1,F.exports.string2buf=F=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(F);let P,f,c,N,q,H=F.length,A=0;for(N=0;N<H;N++)f=F.charCodeAt(N),55296===(64512&f)&&N+1<H&&(c=F.charCodeAt(N+1),56320===(64512&c)&&(f=65536+(f-55296<<10)+(c-56320),N++)),A+=f<128?1:f<2048?2:f<65536?3:4;for(P=new Uint8Array(A),q=0,N=0;q<A;N++)f=F.charCodeAt(N),55296===(64512&f)&&N+1<H&&(c=F.charCodeAt(N+1),56320===(64512&c)&&(f=65536+(f-55296<<10)+(c-56320),N++)),f<128?P[q++]=f:f<2048?(P[q++]=192|f>>>6,P[q++]=128|63&f):f<65536?(P[q++]=224|f>>>12,P[q++]=128|f>>>6&63,P[q++]=128|63&f):(P[q++]=240|f>>>18,P[q++]=128|f>>>12&63,P[q++]=128|f>>>6&63,P[q++]=128|63&f);return P};F.exports.buf2string=(F,c)=>{const N=c||F.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(F.subarray(0,c));let q,H;const A=new Array(2*N);for(H=0,q=0;q<N;){let P=F[q++];if(P<128){A[H++]=P;continue}let c=f[P];if(c>4)A[H++]=65533,q+=c-1;else{for(P&=2===c?31:3===c?15:7;c>1&&q<N;)P=P<<6|63&F[q++],c--;c>1?A[H++]=65533:P<65536?A[H++]=P:(P-=65536,A[H++]=55296|P>>10&1023,A[H++]=56320|1023&P)}}return((F,f)=>{if(f<65534&&F.subarray&&P)return String.fromCharCode.apply(null,F.length===f?F:F.subarray(0,f));let c="";for(let P=0;P<f;P++)c+=String.fromCharCode(F[P]);return c})(A,H)},F.exports.utf8border=(F,P)=>{(P=P||F.length)>F.length&&(P=F.length);let c=P-1;for(;c>=0&&128===(192&F[c]);)c--;return c<0||0===c?P:c+f[F[c]]>P?c:P}},12738:F=>{"use strict";F.exports=(F,P,f,c)=>{let N=65535&F,q=F>>>16&65535,H=0;for(;0!==f;){H=f>2e3?2e3:f,f-=H;do{N=N+P[c++]|0,q=q+N|0}while(--H);N%=65521,q%=65521}return N|q<<16}},12754:F=>{"use strict";F.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12744:F=>{"use strict";const P=new Uint32Array((()=>{let F,P=[];for(var f=0;f<256;f++){F=f;for(var c=0;c<8;c++)F=1&F?3988292384^F>>>1:F>>>1;P[f]=F}return P})());F.exports=(F,f,c,N)=>{const q=P,H=N+c;F^=-1;for(let P=N;P<H;P++)F=F>>>8^q[255&(F^f[P])];return~F}},12728:(F,P,f)=>{"use strict";const{_tr_init:c,_tr_stored_block:N,_tr_flush_block:q,_tr_tally:H,_tr_align:A}=f(12731),o=f(12738),j=f(12744),i=f(12750),{Z_NO_FLUSH:u,Z_PARTIAL_FLUSH:T,Z_FULL_FLUSH:Y,Z_FINISH:t,Z_BLOCK:C,Z_OK:L,Z_STREAM_END:J,Z_STREAM_ERROR:B,Z_DATA_ERROR:z,Z_BUF_ERROR:Z,Z_DEFAULT_COMPRESSION:R,Z_FILTERED:y,Z_HUFFMAN_ONLY:O,Z_RLE:d,Z_FIXED:M,Z_DEFAULT_STRATEGY:V,Z_UNKNOWN:Q,Z_DEFLATED:K}=f(12754),x=258,k=262,I=103,E=113,r=666,n=(F,P)=>(F.jP=i[P],P),p=F=>(F<<1)-(F>4?9:0),U=F=>{let P=F.length;for(;--P>=0;)F[P]=0};let e=(F,P,f)=>(P<<F.hash_shift^f)&F.hash_mask;const D=F=>{const P=F.state;let f=P.pending;f>F.avail_out&&(f=F.avail_out),0!==f&&(F.output.set(P.pending_buf.subarray(P.pending_out,P.pending_out+f),F.next_out),F.next_out+=f,P.pending_out+=f,F.total_out+=f,F.avail_out-=f,P.pending-=f,0===P.pending&&(P.pending_out=0))},l=(F,P)=>{q(F,F.block_start>=0?F.block_start:-1,F.strstart-F.block_start,P),F.block_start=F.strstart,D(F.strm)},W=(F,P)=>{F.pending_buf[F.pending++]=P},b=(F,P)=>{F.pending_buf[F.pending++]=P>>>8&255,F.pending_buf[F.pending++]=255&P},v=(F,P,f,c)=>{let N=F.avail_in;return N>c&&(N=c),0===N?0:(F.avail_in-=N,P.set(F.input.subarray(F.next_in,F.next_in+N),f),1===F.state.wrap?F.adler=o(F.adler,P,N,f):2===F.state.wrap&&(F.adler=j(F.adler,P,N,f)),F.next_in+=N,F.total_in+=N,N)},s=(F,P)=>{let f,c,N=F.max_chain_length,q=F.strstart,H=F.prev_length,A=F.nice_match;const o=F.strstart>F.w_size-k?F.strstart-(F.w_size-k):0,j=F.window,i=F.w_mask,u=F.prev,T=F.strstart+x;let Y=j[q+H-1],t=j[q+H];F.prev_length>=F.good_match&&(N>>=2),A>F.lookahead&&(A=F.lookahead);do{if(f=P,j[f+H]===t&&j[f+H-1]===Y&&j[f]===j[q]&&j[++f]===j[q+1]){q+=2,f++;do{}while(j[++q]===j[++f]&&j[++q]===j[++f]&&j[++q]===j[++f]&&j[++q]===j[++f]&&j[++q]===j[++f]&&j[++q]===j[++f]&&j[++q]===j[++f]&&j[++q]===j[++f]&&q<T);if(c=x-(T-q),q=T-x,c>H){if(F.match_start=P,H=c,c>=A)break;Y=j[q+H-1],t=j[q+H]}}}while((P=u[P&i])>o&&0!==--N);return H<=F.lookahead?H:F.lookahead},X=F=>{const P=F.w_size;let f,c,N,q,H;do{if(q=F.window_size-F.lookahead-F.strstart,F.strstart>=P+(P-k)){F.window.set(F.window.subarray(P,P+P),0),F.match_start-=P,F.strstart-=P,F.block_start-=P,c=F.hash_size,f=c;do{N=F.head[--f],F.head[f]=N>=P?N-P:0}while(--c);c=P,f=c;do{N=F.prev[--f],F.prev[f]=N>=P?N-P:0}while(--c);q+=P}if(0===F.strm.avail_in)break;if(c=v(F.strm,F.window,F.strstart+F.lookahead,q),F.lookahead+=c,F.lookahead+F.insert>=3)for(H=F.strstart-F.insert,F.ins_h=F.window[H],F.ins_h=e(F,F.ins_h,F.window[H+1]);F.insert&&(F.ins_h=e(F,F.ins_h,F.window[H+3-1]),F.prev[H&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=H,H++,F.insert--,!(F.lookahead+F.insert<3)););}while(F.lookahead<k&&0!==F.strm.avail_in)},m=(F,P)=>{let f,c;for(;;){if(F.lookahead<k){if(X(F),F.lookahead<k&&P===u)return 1;if(0===F.lookahead)break}if(f=0,F.lookahead>=3&&(F.ins_h=e(F,F.ins_h,F.window[F.strstart+3-1]),f=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),0!==f&&F.strstart-f<=F.w_size-k&&(F.match_length=s(F,f)),F.match_length>=3)if(c=H(F,F.strstart-F.match_start,F.match_length-3),F.lookahead-=F.match_length,F.match_length<=F.max_lazy_match&&F.lookahead>=3){F.match_length--;do{F.strstart++,F.ins_h=e(F,F.ins_h,F.window[F.strstart+3-1]),f=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart}while(0!==--F.match_length);F.strstart++}else F.strstart+=F.match_length,F.match_length=0,F.ins_h=F.window[F.strstart],F.ins_h=e(F,F.ins_h,F.window[F.strstart+1]);else c=H(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++;if(c&&(l(F,!1),0===F.strm.avail_out))return 1}return F.insert=F.strstart<2?F.strstart:2,P===t?(l(F,!0),0===F.strm.avail_out?3:4):F.last_lit&&(l(F,!1),0===F.strm.avail_out)?1:2},a=(F,P)=>{let f,c,N;for(;;){if(F.lookahead<k){if(X(F),F.lookahead<k&&P===u)return 1;if(0===F.lookahead)break}if(f=0,F.lookahead>=3&&(F.ins_h=e(F,F.ins_h,F.window[F.strstart+3-1]),f=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),F.prev_length=F.match_length,F.prev_match=F.match_start,F.match_length=2,0!==f&&F.prev_length<F.max_lazy_match&&F.strstart-f<=F.w_size-k&&(F.match_length=s(F,f),F.match_length<=5&&(F.strategy===y||3===F.match_length&&F.strstart-F.match_start>4096)&&(F.match_length=2)),F.prev_length>=3&&F.match_length<=F.prev_length){N=F.strstart+F.lookahead-3,c=H(F,F.strstart-1-F.prev_match,F.prev_length-3),F.lookahead-=F.prev_length-1,F.prev_length-=2;do{++F.strstart<=N&&(F.ins_h=e(F,F.ins_h,F.window[F.strstart+3-1]),f=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart)}while(0!==--F.prev_length);if(F.match_available=0,F.match_length=2,F.strstart++,c&&(l(F,!1),0===F.strm.avail_out))return 1}else if(F.match_available){if(c=H(F,0,F.window[F.strstart-1]),c&&l(F,!1),F.strstart++,F.lookahead--,0===F.strm.avail_out)return 1}else F.match_available=1,F.strstart++,F.lookahead--}return F.match_available&&(c=H(F,0,F.window[F.strstart-1]),F.match_available=0),F.insert=F.strstart<2?F.strstart:2,P===t?(l(F,!0),0===F.strm.avail_out?3:4):F.last_lit&&(l(F,!1),0===F.strm.avail_out)?1:2};function w(F,P,f,c,N){this.good_length=F,this.max_lazy=P,this.nice_length=f,this.max_chain=c,this.func=N}const g=[new w(0,0,0,0,((F,P)=>{let f=65535;for(f>F.pending_buf_size-5&&(f=F.pending_buf_size-5);;){if(F.lookahead<=1){if(X(F),0===F.lookahead&&P===u)return 1;if(0===F.lookahead)break}F.strstart+=F.lookahead,F.lookahead=0;const c=F.block_start+f;if((0===F.strstart||F.strstart>=c)&&(F.lookahead=F.strstart-c,F.strstart=c,l(F,!1),0===F.strm.avail_out))return 1;if(F.strstart-F.block_start>=F.w_size-k&&(l(F,!1),0===F.strm.avail_out))return 1}return F.insert=0,P===t?(l(F,!0),0===F.strm.avail_out?3:4):(F.strstart>F.block_start&&(l(F,!1),F.strm.avail_out),1)})),new w(4,4,8,4,m),new w(4,5,16,8,m),new w(4,6,32,32,m),new w(4,4,16,16,a),new w(8,16,32,32,a),new w(8,16,128,128,a),new w(8,32,128,256,a),new w(32,128,258,1024,a),new w(32,258,258,4096,a)];function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=K,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const h=F=>{if(!F||!F.state)return n(F,B);F.total_in=F.total_out=0,F.data_type=Q;const P=F.state;return P.pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?42:E,F.adler=2===P.wrap?0:1,P.last_flush=u,c(P),L},S=F=>{const P=h(F);var f;return P===L&&((f=F.state).window_size=2*f.w_size,U(f.head),f.max_lazy_match=g[f.level].max_lazy,f.good_match=g[f.level].good_length,f.nice_match=g[f.level].nice_length,f.max_chain_length=g[f.level].max_chain,f.strstart=0,f.block_start=0,f.lookahead=0,f.insert=0,f.match_length=f.prev_length=2,f.match_available=0,f.ins_h=0),P},FF=(F,P,f,c,N,q)=>{if(!F)return B;let H=1;if(P===R&&(P=6),c<0?(H=0,c=-c):c>15&&(H=2,c-=16),N<1||N>9||f!==K||c<8||c>15||P<0||P>9||q<0||q>M)return n(F,B);8===c&&(c=9);const A=new G;return F.state=A,A.strm=F,A.wrap=H,A.gzhead=null,A.w_bits=c,A.w_size=1<<A.w_bits,A.w_mask=A.w_size-1,A.hash_bits=N+7,A.hash_size=1<<A.hash_bits,A.hash_mask=A.hash_size-1,A.hash_shift=~~((A.hash_bits+3-1)/3),A.window=new Uint8Array(2*A.w_size),A.head=new Uint16Array(A.hash_size),A.prev=new Uint16Array(A.w_size),A.lit_bufsize=1<<N+6,A.pending_buf_size=4*A.lit_bufsize,A.pending_buf=new Uint8Array(A.pending_buf_size),A.d_buf=1*A.lit_bufsize,A.l_buf=3*A.lit_bufsize,A.level=P,A.strategy=q,A.method=f,S(F)};F.exports.deflateInit=(F,P)=>FF(F,P,K,15,8,V),F.exports.deflateInit2=FF,F.exports.deflateReset=S,F.exports.deflateResetKeep=h,F.exports.deflateSetHeader=(F,P)=>F&&F.state?2!==F.state.wrap?B:(F.state.gzhead=P,L):B,F.exports.deflate=(F,P)=>{let f,c;if(!F||!F.state||P>C||P<0)return F?n(F,B):B;const q=F.state;if(!F.output||!F.input&&0!==F.avail_in||q.status===r&&P!==t)return n(F,0===F.avail_out?Z:B);q.strm=F;const o=q.last_flush;if(q.last_flush=P,42===q.status)if(2===q.wrap)F.adler=0,W(q,31),W(q,139),W(q,8),q.gzhead?(W(q,(q.gzhead.text?1:0)+(q.gzhead.hcrc?2:0)+(q.gzhead.extra?4:0)+(q.gzhead.name?8:0)+(q.gzhead.comment?16:0)),W(q,255&q.gzhead.time),W(q,q.gzhead.time>>8&255),W(q,q.gzhead.time>>16&255),W(q,q.gzhead.time>>24&255),W(q,9===q.level?2:q.strategy>=O||q.level<2?4:0),W(q,255&q.gzhead.os),q.gzhead.extra&&q.gzhead.extra.length&&(W(q,255&q.gzhead.extra.length),W(q,q.gzhead.extra.length>>8&255)),q.gzhead.hcrc&&(F.adler=j(F.adler,q.pending_buf,q.pending,0)),q.gzindex=0,q.status=69):(W(q,0),W(q,0),W(q,0),W(q,0),W(q,0),W(q,9===q.level?2:q.strategy>=O||q.level<2?4:0),W(q,3),q.status=E);else{let P=K+(q.w_bits-8<<4)<<8,f=-1;f=q.strategy>=O||q.level<2?0:q.level<6?1:6===q.level?2:3,P|=f<<6,0!==q.strstart&&(P|=32),P+=31-P%31,q.status=E,b(q,P),0!==q.strstart&&(b(q,F.adler>>>16),b(q,65535&F.adler)),F.adler=1}if(69===q.status)if(q.gzhead.extra){for(f=q.pending;q.gzindex<(65535&q.gzhead.extra.length)&&(q.pending!==q.pending_buf_size||(q.gzhead.hcrc&&q.pending>f&&(F.adler=j(F.adler,q.pending_buf,q.pending-f,f)),D(F),f=q.pending,q.pending!==q.pending_buf_size));)W(q,255&q.gzhead.extra[q.gzindex]),q.gzindex++;q.gzhead.hcrc&&q.pending>f&&(F.adler=j(F.adler,q.pending_buf,q.pending-f,f)),q.gzindex===q.gzhead.extra.length&&(q.gzindex=0,q.status=73)}else q.status=73;if(73===q.status)if(q.gzhead.name){f=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>f&&(F.adler=j(F.adler,q.pending_buf,q.pending-f,f)),D(F),f=q.pending,q.pending===q.pending_buf_size)){c=1;break}c=q.gzindex<q.gzhead.name.length?255&q.gzhead.name.charCodeAt(q.gzindex++):0,W(q,c)}while(0!==c);q.gzhead.hcrc&&q.pending>f&&(F.adler=j(F.adler,q.pending_buf,q.pending-f,f)),0===c&&(q.gzindex=0,q.status=91)}else q.status=91;if(91===q.status)if(q.gzhead.comment){f=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>f&&(F.adler=j(F.adler,q.pending_buf,q.pending-f,f)),D(F),f=q.pending,q.pending===q.pending_buf_size)){c=1;break}c=q.gzindex<q.gzhead.comment.length?255&q.gzhead.comment.charCodeAt(q.gzindex++):0,W(q,c)}while(0!==c);q.gzhead.hcrc&&q.pending>f&&(F.adler=j(F.adler,q.pending_buf,q.pending-f,f)),0===c&&(q.status=I)}else q.status=I;if(q.status===I&&(q.gzhead.hcrc?(q.pending+2>q.pending_buf_size&&D(F),q.pending+2<=q.pending_buf_size&&(W(q,255&F.adler),W(q,F.adler>>8&255),F.adler=0,q.status=E)):q.status=E),0!==q.pending){if(D(F),0===F.avail_out)return q.last_flush=-1,L}else if(0===F.avail_in&&p(P)<=p(o)&&P!==t)return n(F,Z);if(q.status===r&&0!==F.avail_in)return n(F,Z);if(0!==F.avail_in||0!==q.lookahead||P!==u&&q.status!==r){let f=q.strategy===O?((F,P)=>{let f;for(;;){if(0===F.lookahead&&(X(F),0===F.lookahead)){if(P===u)return 1;break}if(F.match_length=0,f=H(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++,f&&(l(F,!1),0===F.strm.avail_out))return 1}return F.insert=0,P===t?(l(F,!0),0===F.strm.avail_out?3:4):F.last_lit&&(l(F,!1),0===F.strm.avail_out)?1:2})(q,P):q.strategy===d?((F,P)=>{let f,c,N,q;const A=F.window;for(;;){if(F.lookahead<=x){if(X(F),F.lookahead<=x&&P===u)return 1;if(0===F.lookahead)break}if(F.match_length=0,F.lookahead>=3&&F.strstart>0&&(N=F.strstart-1,c=A[N],c===A[++N]&&c===A[++N]&&c===A[++N])){q=F.strstart+x;do{}while(c===A[++N]&&c===A[++N]&&c===A[++N]&&c===A[++N]&&c===A[++N]&&c===A[++N]&&c===A[++N]&&c===A[++N]&&N<q);F.match_length=x-(q-N),F.match_length>F.lookahead&&(F.match_length=F.lookahead)}if(F.match_length>=3?(f=H(F,1,F.match_length-3),F.lookahead-=F.match_length,F.strstart+=F.match_length,F.match_length=0):(f=H(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++),f&&(l(F,!1),0===F.strm.avail_out))return 1}return F.insert=0,P===t?(l(F,!0),0===F.strm.avail_out?3:4):F.last_lit&&(l(F,!1),0===F.strm.avail_out)?1:2})(q,P):g[q.level].func(q,P);if(3!==f&&4!==f||(q.status=r),1===f||3===f)return 0===F.avail_out&&(q.last_flush=-1),L;if(2===f&&(P===T?A(q):P!==C&&(N(q,0,0,!1),P===Y&&(U(q.head),0===q.lookahead&&(q.strstart=0,q.block_start=0,q.insert=0))),D(F),0===F.avail_out))return q.last_flush=-1,L}return P!==t?L:q.wrap<=0?J:(2===q.wrap?(W(q,255&F.adler),W(q,F.adler>>8&255),W(q,F.adler>>16&255),W(q,F.adler>>24&255),W(q,255&F.total_in),W(q,F.total_in>>8&255),W(q,F.total_in>>16&255),W(q,F.total_in>>24&255)):(b(q,F.adler>>>16),b(q,65535&F.adler)),D(F),q.wrap>0&&(q.wrap=-q.wrap),0!==q.pending?L:J)},F.exports.deflateEnd=F=>{if(!F||!F.state)return B;const P=F.state.status;return 42!==P&&69!==P&&73!==P&&91!==P&&P!==I&&P!==E&&P!==r?n(F,B):(F.state=null,P===E?n(F,z):L)},F.exports.deflateSetDictionary=(F,P)=>{let f=P.length;if(!F||!F.state)return B;const c=F.state,N=c.wrap;if(2===N||1===N&&42!==c.status||c.lookahead)return B;if(1===N&&(F.adler=o(F.adler,P,f,0)),c.wrap=0,f>=c.w_size){0===N&&(U(c.head),c.strstart=0,c.block_start=0,c.insert=0);let F=new Uint8Array(c.w_size);F.set(P.subarray(f-c.w_size,f),0),P=F,f=c.w_size}const q=F.avail_in,H=F.next_in,A=F.input;for(F.avail_in=f,F.next_in=0,F.input=P,X(c);c.lookahead>=3;){let F=c.strstart,P=c.lookahead-2;do{c.ins_h=e(c,c.ins_h,c.window[F+3-1]),c.prev[F&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=F,F++}while(--P);c.strstart=F,c.lookahead=2,X(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=2,c.match_available=0,F.next_in=H,F.input=A,F.avail_in=q,c.wrap=N,L},F.exports.deflateInfo="pako deflate (from Nodeca project)"},12801:F=>{"use strict";F.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12788:F=>{"use strict";F.exports=function(F,P){let f,c,N,q,H,A,o,j,i,u,T,Y,t,C,L,J,B,z,Z,R,y,O,d,M;const V=F.state;f=F.next_in,d=F.input,c=f+(F.avail_in-5),N=F.next_out,M=F.output,q=N-(P-F.avail_out),H=N+(F.avail_out-257),A=V.dmax,o=V.wsize,j=V.whave,i=V.wnext,u=V.window,T=V.hold,Y=V.bits,t=V.lencode,C=V.distcode,L=(1<<V.lenbits)-1,J=(1<<V.distbits)-1;F:do{Y<15&&(T+=d[f++]<<Y,Y+=8,T+=d[f++]<<Y,Y+=8),B=t[T&L];P:for(;;){if(z=B>>>24,T>>>=z,Y-=z,z=B>>>16&255,0===z)M[N++]=65535&B;else{if(!(16&z)){if(0===(64&z)){B=t[(65535&B)+(T&(1<<z)-1)];continue P}if(32&z){V.mode=12;break F}F.jP="invalid literal/length code",V.mode=30;break F}Z=65535&B,z&=15,z&&(Y<z&&(T+=d[f++]<<Y,Y+=8),Z+=T&(1<<z)-1,T>>>=z,Y-=z),Y<15&&(T+=d[f++]<<Y,Y+=8,T+=d[f++]<<Y,Y+=8),B=C[T&J];f:for(;;){if(z=B>>>24,T>>>=z,Y-=z,z=B>>>16&255,!(16&z)){if(0===(64&z)){B=C[(65535&B)+(T&(1<<z)-1)];continue f}F.jP="invalid distance code",V.mode=30;break F}if(R=65535&B,z&=15,Y<z&&(T+=d[f++]<<Y,Y+=8,Y<z&&(T+=d[f++]<<Y,Y+=8)),R+=T&(1<<z)-1,R>A){F.jP="invalid distance too far back",V.mode=30;break F}if(T>>>=z,Y-=z,z=N-q,R>z){if(z=R-z,z>j&&V.sane){F.jP="invalid distance too far back",V.mode=30;break F}if(y=0,O=u,0===i){if(y+=o-z,z<Z){Z-=z;do{M[N++]=u[y++]}while(--z);y=N-R,O=M}}else if(i<z){if(y+=o+i-z,z-=i,z<Z){Z-=z;do{M[N++]=u[y++]}while(--z);if(y=0,i<Z){z=i,Z-=z;do{M[N++]=u[y++]}while(--z);y=N-R,O=M}}}else if(y+=i-z,z<Z){Z-=z;do{M[N++]=u[y++]}while(--z);y=N-R,O=M}for(;Z>2;)M[N++]=O[y++],M[N++]=O[y++],M[N++]=O[y++],Z-=3;Z&&(M[N++]=O[y++],Z>1&&(M[N++]=O[y++]))}else{y=N-R;do{M[N++]=M[y++],M[N++]=M[y++],M[N++]=M[y++],Z-=3}while(Z>2);Z&&(M[N++]=M[y++],Z>1&&(M[N++]=M[y++]))}break}}break}}while(f<c&&N<H);Z=Y>>3,f-=Z,Y-=Z<<3,T&=(1<<Y)-1,F.next_in=f,F.next_out=N,F.avail_in=f<c?c-f+5:5-(f-c),F.avail_out=N<H?H-N+257:257-(N-H),V.hold=T,V.bits=Y}},12780:(F,P,f)=>{"use strict";const c=f(12738),N=f(12744),q=f(12788),H=f(12795),{Z_FINISH:A,Z_BLOCK:o,Z_TREES:j,Z_OK:i,Z_STREAM_END:u,Z_NEED_DICT:T,Z_STREAM_ERROR:Y,Z_DATA_ERROR:t,Z_MEM_ERROR:C,Z_BUF_ERROR:L,Z_DEFLATED:J}=f(12754),B=12,z=30,Z=F=>(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24);function R(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const y=F=>{if(!F||!F.state)return Y;const P=F.state;return F.total_in=F.total_out=P.total=0,F.jP="",P.wrap&&(F.adler=1&P.wrap),P.mode=1,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new Int32Array(852),P.distcode=P.distdyn=new Int32Array(592),P.sane=1,P.back=-1,i},O=F=>{if(!F||!F.state)return Y;const P=F.state;return P.wsize=0,P.whave=0,P.wnext=0,y(F)},d=(F,P)=>{let f;if(!F||!F.state)return Y;const c=F.state;return P<0?(f=0,P=-P):(f=1+(P>>4),P<48&&(P&=15)),P&&(P<8||P>15)?Y:(null!==c.window&&c.wbits!==P&&(c.window=null),c.wrap=f,c.wbits=P,O(F))},M=(F,P)=>{if(!F)return Y;const f=new R;F.state=f,f.window=null;const c=d(F,P);return c!==i&&(F.state=null),c};let V,Q,K=!0;const x=F=>{if(K){V=new Int32Array(512),Q=new Int32Array(32);let P=0;for(;P<144;)F.lens[P++]=8;for(;P<256;)F.lens[P++]=9;for(;P<280;)F.lens[P++]=7;for(;P<288;)F.lens[P++]=8;for(H(1,F.lens,0,288,V,0,F.work,{bits:9}),P=0;P<32;)F.lens[P++]=5;H(2,F.lens,0,32,Q,0,F.work,{bits:5}),K=!1}F.lencode=V,F.lenbits=9,F.distcode=Q,F.distbits=5},k=(F,P,f,c)=>{let N;const q=F.state;return null===q.window&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new Uint8Array(q.wsize)),c>=q.wsize?(q.window.set(P.subarray(f-q.wsize,f),0),q.wnext=0,q.whave=q.wsize):(N=q.wsize-q.wnext,N>c&&(N=c),q.window.set(P.subarray(f-c,f-c+N),q.wnext),(c-=N)?(q.window.set(P.subarray(f-c,f),0),q.wnext=c,q.whave=q.wsize):(q.wnext+=N,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=N))),0};F.exports.inflateReset=O,F.exports.inflateReset2=d,F.exports.inflateResetKeep=y,F.exports.inflateInit=F=>M(F,15),F.exports.inflateInit2=M,F.exports.inflate=(F,P)=>{let f,R,y,O,d,M,V,Q,K,I,E,r,n,p,U,e,D,l,W,b,v,s,X=0;const m=new Uint8Array(4);let a,w;const g=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!F||!F.state||!F.output||!F.input&&0!==F.avail_in)return Y;f=F.state,f.mode===B&&(f.mode=13),d=F.next_out,y=F.output,V=F.avail_out,O=F.next_in,R=F.input,M=F.avail_in,Q=f.hold,K=f.bits,I=M,E=V,s=i;F:for(;;)switch(f.mode){case 1:if(0===f.wrap){f.mode=13;break}for(;K<16;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(2&f.wrap&&35615===Q){f.check=0,m[0]=255&Q,m[1]=Q>>>8&255,f.check=N(f.check,m,2,0),Q=0,K=0,f.mode=2;break}if(f.flags=0,f.head&&(f.head.done=!1),!(1&f.wrap)||(((255&Q)<<8)+(Q>>8))%31){F.jP="incorrect header check",f.mode=z;break}if((15&Q)!==J){F.jP="unknown compression method",f.mode=z;break}if(Q>>>=4,K-=4,v=8+(15&Q),0===f.wbits)f.wbits=v;else if(v>f.wbits){F.jP="invalid window size",f.mode=z;break}f.dmax=1<<f.wbits,F.adler=f.check=1,f.mode=512&Q?10:B,Q=0,K=0;break;case 2:for(;K<16;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(f.flags=Q,(255&f.flags)!==J){F.jP="unknown compression method",f.mode=z;break}if(57344&f.flags){F.jP="unknown header flags set",f.mode=z;break}f.head&&(f.head.text=Q>>8&1),512&f.flags&&(m[0]=255&Q,m[1]=Q>>>8&255,f.check=N(f.check,m,2,0)),Q=0,K=0,f.mode=3;case 3:for(;K<32;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}f.head&&(f.head.time=Q),512&f.flags&&(m[0]=255&Q,m[1]=Q>>>8&255,m[2]=Q>>>16&255,m[3]=Q>>>24&255,f.check=N(f.check,m,4,0)),Q=0,K=0,f.mode=4;case 4:for(;K<16;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}f.head&&(f.head.xflags=255&Q,f.head.os=Q>>8),512&f.flags&&(m[0]=255&Q,m[1]=Q>>>8&255,f.check=N(f.check,m,2,0)),Q=0,K=0,f.mode=5;case 5:if(1024&f.flags){for(;K<16;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}f.length=Q,f.head&&(f.head.extra_len=Q),512&f.flags&&(m[0]=255&Q,m[1]=Q>>>8&255,f.check=N(f.check,m,2,0)),Q=0,K=0}else f.head&&(f.head.extra=null);f.mode=6;case 6:if(1024&f.flags&&(r=f.length,r>M&&(r=M),r&&(f.head&&(v=f.head.extra_len-f.length,f.head.extra||(f.head.extra=new Uint8Array(f.head.extra_len)),f.head.extra.set(R.subarray(O,O+r),v)),512&f.flags&&(f.check=N(f.check,R,r,O)),M-=r,O+=r,f.length-=r),f.length))break F;f.length=0,f.mode=7;case 7:if(2048&f.flags){if(0===M)break F;r=0;do{v=R[O+r++],f.head&&v&&f.length<65536&&(f.head.name+=String.fromCharCode(v))}while(v&&r<M);if(512&f.flags&&(f.check=N(f.check,R,r,O)),M-=r,O+=r,v)break F}else f.head&&(f.head.name=null);f.length=0,f.mode=8;case 8:if(4096&f.flags){if(0===M)break F;r=0;do{v=R[O+r++],f.head&&v&&f.length<65536&&(f.head.comment+=String.fromCharCode(v))}while(v&&r<M);if(512&f.flags&&(f.check=N(f.check,R,r,O)),M-=r,O+=r,v)break F}else f.head&&(f.head.comment=null);f.mode=9;case 9:if(512&f.flags){for(;K<16;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(Q!==(65535&f.check)){F.jP="header crc mismatch",f.mode=z;break}Q=0,K=0}f.head&&(f.head.hcrc=f.flags>>9&1,f.head.done=!0),F.adler=f.check=0,f.mode=B;break;case 10:for(;K<32;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}F.adler=f.check=Z(Q),Q=0,K=0,f.mode=11;case 11:if(0===f.havedict)return F.next_out=d,F.avail_out=V,F.next_in=O,F.avail_in=M,f.hold=Q,f.bits=K,T;F.adler=f.check=1,f.mode=B;case B:if(P===o||P===j)break F;case 13:if(f.last){Q>>>=7&K,K-=7&K,f.mode=27;break}for(;K<3;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}switch(f.last=1&Q,Q>>>=1,K-=1,3&Q){case 0:f.mode=14;break;case 1:if(x(f),f.mode=20,P===j){Q>>>=2,K-=2;break F}break;case 2:f.mode=17;break;case 3:F.jP="invalid block type",f.mode=z}Q>>>=2,K-=2;break;case 14:for(Q>>>=7&K,K-=7&K;K<32;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if((65535&Q)!==(Q>>>16^65535)){F.jP="invalid stored block lengths",f.mode=z;break}if(f.length=65535&Q,Q=0,K=0,f.mode=15,P===j)break F;case 15:f.mode=16;case 16:if(r=f.length,r){if(r>M&&(r=M),r>V&&(r=V),0===r)break F;y.set(R.subarray(O,O+r),d),M-=r,O+=r,V-=r,d+=r,f.length-=r;break}f.mode=B;break;case 17:for(;K<14;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(f.nlen=257+(31&Q),Q>>>=5,K-=5,f.ndist=1+(31&Q),Q>>>=5,K-=5,f.ncode=4+(15&Q),Q>>>=4,K-=4,f.nlen>286||f.ndist>30){F.jP="too many length or distance symbols",f.mode=z;break}f.have=0,f.mode=18;case 18:for(;f.have<f.ncode;){for(;K<3;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}f.lens[g[f.have++]]=7&Q,Q>>>=3,K-=3}for(;f.have<19;)f.lens[g[f.have++]]=0;if(f.lencode=f.lendyn,f.lenbits=7,a={bits:f.lenbits},s=H(0,f.lens,0,19,f.lencode,0,f.work,a),f.lenbits=a.bits,s){F.jP="invalid code lengths set",f.mode=z;break}f.have=0,f.mode=19;case 19:for(;f.have<f.nlen+f.ndist;){for(;X=f.lencode[Q&(1<<f.lenbits)-1],U=X>>>24,e=X>>>16&255,D=65535&X,!(U<=K);){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(D<16)Q>>>=U,K-=U,f.lens[f.have++]=D;else{if(16===D){for(w=U+2;K<w;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(Q>>>=U,K-=U,0===f.have){F.jP="invalid bit length repeat",f.mode=z;break}v=f.lens[f.have-1],r=3+(3&Q),Q>>>=2,K-=2}else if(17===D){for(w=U+3;K<w;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}Q>>>=U,K-=U,v=0,r=3+(7&Q),Q>>>=3,K-=3}else{for(w=U+7;K<w;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}Q>>>=U,K-=U,v=0,r=11+(127&Q),Q>>>=7,K-=7}if(f.have+r>f.nlen+f.ndist){F.jP="invalid bit length repeat",f.mode=z;break}for(;r--;)f.lens[f.have++]=v}}if(f.mode===z)break;if(0===f.lens[256]){F.jP="invalid code -- missing end-of-block",f.mode=z;break}if(f.lenbits=9,a={bits:f.lenbits},s=H(1,f.lens,0,f.nlen,f.lencode,0,f.work,a),f.lenbits=a.bits,s){F.jP="invalid literal/lengths set",f.mode=z;break}if(f.distbits=6,f.distcode=f.distdyn,a={bits:f.distbits},s=H(2,f.lens,f.nlen,f.ndist,f.distcode,0,f.work,a),f.distbits=a.bits,s){F.jP="invalid distances set",f.mode=z;break}if(f.mode=20,P===j)break F;case 20:f.mode=21;case 21:if(M>=6&&V>=258){F.next_out=d,F.avail_out=V,F.next_in=O,F.avail_in=M,f.hold=Q,f.bits=K,q(F,E),d=F.next_out,y=F.output,V=F.avail_out,O=F.next_in,R=F.input,M=F.avail_in,Q=f.hold,K=f.bits,f.mode===B&&(f.back=-1);break}for(f.back=0;X=f.lencode[Q&(1<<f.lenbits)-1],U=X>>>24,e=X>>>16&255,D=65535&X,!(U<=K);){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(e&&0===(240&e)){for(l=U,W=e,b=D;X=f.lencode[b+((Q&(1<<l+W)-1)>>l)],U=X>>>24,e=X>>>16&255,D=65535&X,!(l+U<=K);){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}Q>>>=l,K-=l,f.back+=l}if(Q>>>=U,K-=U,f.back+=U,f.length=D,0===e){f.mode=26;break}if(32&e){f.back=-1,f.mode=B;break}if(64&e){F.jP="invalid literal/length code",f.mode=z;break}f.extra=15&e,f.mode=22;case 22:if(f.extra){for(w=f.extra;K<w;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}f.length+=Q&(1<<f.extra)-1,Q>>>=f.extra,K-=f.extra,f.back+=f.extra}f.was=f.length,f.mode=23;case 23:for(;X=f.distcode[Q&(1<<f.distbits)-1],U=X>>>24,e=X>>>16&255,D=65535&X,!(U<=K);){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(0===(240&e)){for(l=U,W=e,b=D;X=f.distcode[b+((Q&(1<<l+W)-1)>>l)],U=X>>>24,e=X>>>16&255,D=65535&X,!(l+U<=K);){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}Q>>>=l,K-=l,f.back+=l}if(Q>>>=U,K-=U,f.back+=U,64&e){F.jP="invalid distance code",f.mode=z;break}f.offset=D,f.extra=15&e,f.mode=24;case 24:if(f.extra){for(w=f.extra;K<w;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}f.offset+=Q&(1<<f.extra)-1,Q>>>=f.extra,K-=f.extra,f.back+=f.extra}if(f.offset>f.dmax){F.jP="invalid distance too far back",f.mode=z;break}f.mode=25;case 25:if(0===V)break F;if(r=E-V,f.offset>r){if(r=f.offset-r,r>f.whave&&f.sane){F.jP="invalid distance too far back",f.mode=z;break}r>f.wnext?(r-=f.wnext,n=f.wsize-r):n=f.wnext-r,r>f.length&&(r=f.length),p=f.window}else p=y,n=d-f.offset,r=f.length;r>V&&(r=V),V-=r,f.length-=r;do{y[d++]=p[n++]}while(--r);0===f.length&&(f.mode=21);break;case 26:if(0===V)break F;y[d++]=f.length,V--,f.mode=21;break;case 27:if(f.wrap){for(;K<32;){if(0===M)break F;M--,Q|=R[O++]<<K,K+=8}if(E-=V,F.total_out+=E,f.total+=E,E&&(F.adler=f.check=f.flags?N(f.check,y,E,d-E):c(f.check,y,E,d-E)),E=V,(f.flags?Q:Z(Q))!==f.check){F.jP="incorrect data check",f.mode=z;break}Q=0,K=0}f.mode=28;case 28:if(f.wrap&&f.flags){for(;K<32;){if(0===M)break F;M--,Q+=R[O++]<<K,K+=8}if(Q!==(4294967295&f.total)){F.jP="incorrect length check",f.mode=z;break}Q=0,K=0}f.mode=29;case 29:s=u;break F;case z:s=t;break F;case 31:return C;default:return Y}return F.next_out=d,F.avail_out=V,F.next_in=O,F.avail_in=M,f.hold=Q,f.bits=K,(f.wsize||E!==F.avail_out&&f.mode<z&&(f.mode<27||P!==A))&&k(F,F.output,F.next_out,E-F.avail_out)?(f.mode=31,C):(I-=F.avail_in,E-=F.avail_out,F.total_in+=I,F.total_out+=E,f.total+=E,f.wrap&&E&&(F.adler=f.check=f.flags?N(f.check,y,E,F.next_out-E):c(f.check,y,E,F.next_out-E)),F.data_type=f.bits+(f.last?64:0)+(f.mode===B?128:0)+(20===f.mode||15===f.mode?256:0),(0===I&&0===E||P===A)&&s===i&&(s=L),s)},F.exports.inflateEnd=F=>{if(!F||!F.state)return Y;let P=F.state;return P.window&&(P.window=null),F.state=null,i},F.exports.inflateGetHeader=(F,P)=>{if(!F||!F.state)return Y;const f=F.state;return 0===(2&f.wrap)?Y:(f.head=P,P.done=!1,i)},F.exports.inflateSetDictionary=(F,P)=>{const f=P.length;let N,q,H;return F&&F.state?(N=F.state,0!==N.wrap&&11!==N.mode?Y:11===N.mode&&(q=1,q=c(q,P,f,0),q!==N.check)?t:(H=k(F,P,f,f),H?(N.mode=31,C):(N.havedict=1,i))):Y},F.exports.inflateInfo="pako inflate (from Nodeca project)"},12795:F=>{"use strict";const P=15,f=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),c=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),N=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),q=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);F.exports=(F,H,A,o,j,i,u,T)=>{const Y=T.bits;let t,C,L,J,B,z,Z=0,R=0,y=0,O=0,d=0,M=0,V=0,Q=0,K=0,x=0,k=null,I=0;const E=new Uint16Array(16),r=new Uint16Array(16);let n,p,U,e=null,D=0;for(Z=0;Z<=P;Z++)E[Z]=0;for(R=0;R<o;R++)E[H[A+R]]++;for(d=Y,O=P;O>=1&&0===E[O];O--);if(d>O&&(d=O),0===O)return j[i++]=20971520,j[i++]=20971520,T.bits=1,0;for(y=1;y<O&&0===E[y];y++);for(d<y&&(d=y),Q=1,Z=1;Z<=P;Z++)if(Q<<=1,Q-=E[Z],Q<0)return-1;if(Q>0&&(0===F||1!==O))return-1;for(r[1]=0,Z=1;Z<P;Z++)r[Z+1]=r[Z]+E[Z];for(R=0;R<o;R++)0!==H[A+R]&&(u[r[H[A+R]]++]=R);if(0===F?(k=e=u,z=19):1===F?(k=f,I-=257,e=c,D-=257,z=256):(k=N,e=q,z=-1),x=0,R=0,Z=y,B=i,M=d,V=0,L=-1,K=1<<d,J=K-1,1===F&&K>852||2===F&&K>592)return 1;for(;;){n=Z-V,u[R]<z?(p=0,U=u[R]):u[R]>z?(p=e[D+u[R]],U=k[I+u[R]]):(p=96,U=0),t=1<<Z-V,C=1<<M,y=C;do{C-=t,j[B+(x>>V)+C]=n<<24|p<<16|U}while(0!==C);for(t=1<<Z-1;x&t;)t>>=1;if(0!==t?(x&=t-1,x+=t):x=0,R++,0===--E[Z]){if(Z===O)break;Z=H[A+u[R]]}if(Z>d&&(x&J)!==L){for(0===V&&(V=d),B+=y,M=Z-V,Q=1<<M;M+V<O&&(Q-=E[M+V],!(Q<=0));)M++,Q<<=1;if(K+=1<<M,1===F&&K>852||2===F&&K>592)return 1;L=x&J,j[L]=d<<24|M<<16|B-i}}return 0!==x&&(j[B+x]=Z-V<<24|64<<16),T.bits=d,0}},12750:F=>{"use strict";F.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12731:F=>{"use strict";function P(F){let P=F.length;for(;--P>=0;)F[P]=0}const f=256,c=286,N=30,q=15,H=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),A=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),o=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=new Array(576);P(i);const u=new Array(60);P(u);const T=new Array(512);P(T);const Y=new Array(256);P(Y);const t=new Array(29);P(t);const C=new Array(N);function L(F,P,f,c,N){this.static_tree=F,this.extra_bits=P,this.extra_base=f,this.elems=c,this.max_length=N,this.has_stree=F&&F.length}let J,B,z;function Z(F,P){this.dyn_tree=F,this.max_code=0,this.stat_desc=P}P(C);const R=F=>F<256?T[F]:T[256+(F>>>7)],y=(F,P)=>{F.pending_buf[F.pending++]=255&P,F.pending_buf[F.pending++]=P>>>8&255},O=(F,P,f)=>{F.bi_valid>16-f?(F.bi_buf|=P<<F.bi_valid&65535,y(F,F.bi_buf),F.bi_buf=P>>16-F.bi_valid,F.bi_valid+=f-16):(F.bi_buf|=P<<F.bi_valid&65535,F.bi_valid+=f)},d=(F,P,f)=>{O(F,f[2*P],f[2*P+1])},M=(F,P)=>{let f=0;do{f|=1&F,F>>>=1,f<<=1}while(--P>0);return f>>>1},V=(F,P,f)=>{const c=new Array(16);let N,H,A=0;for(N=1;N<=q;N++)c[N]=A=A+f[N-1]<<1;for(H=0;H<=P;H++){let P=F[2*H+1];0!==P&&(F[2*H]=M(c[P]++,P))}},Q=F=>{let P;for(P=0;P<c;P++)F.dyn_ltree[2*P]=0;for(P=0;P<N;P++)F.dyn_dtree[2*P]=0;for(P=0;P<19;P++)F.bl_tree[2*P]=0;F.dyn_ltree[512]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0},K=F=>{F.bi_valid>8?y(F,F.bi_buf):F.bi_valid>0&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0},x=(F,P,f,c)=>{const N=2*P,q=2*f;return F[N]<F[q]||F[N]===F[q]&&c[P]<=c[f]},k=(F,P,f)=>{const c=F.heap[f];let N=f<<1;for(;N<=F.heap_len&&(N<F.heap_len&&x(P,F.heap[N+1],F.heap[N],F.depth)&&N++,!x(P,c,F.heap[N],F.depth));)F.heap[f]=F.heap[N],f=N,N<<=1;F.heap[f]=c},I=(F,P,c)=>{let N,q,o,j,i=0;if(0!==F.last_lit)do{N=F.pending_buf[F.d_buf+2*i]<<8|F.pending_buf[F.d_buf+2*i+1],q=F.pending_buf[F.l_buf+i],i++,0===N?d(F,q,P):(o=Y[q],d(F,o+f+1,P),j=H[o],0!==j&&(q-=t[o],O(F,q,j)),N--,o=R(N),d(F,o,c),j=A[o],0!==j&&(N-=C[o],O(F,N,j)))}while(i<F.last_lit);d(F,256,P)},E=(F,P)=>{const f=P.dyn_tree,c=P.stat_desc.static_tree,N=P.stat_desc.has_stree,H=P.stat_desc.elems;let A,o,j,i=-1;for(F.heap_len=0,F.heap_max=573,A=0;A<H;A++)0!==f[2*A]?(F.heap[++F.heap_len]=i=A,F.depth[A]=0):f[2*A+1]=0;for(;F.heap_len<2;)j=F.heap[++F.heap_len]=i<2?++i:0,f[2*j]=1,F.depth[j]=0,F.opt_len--,N&&(F.static_len-=c[2*j+1]);for(P.max_code=i,A=F.heap_len>>1;A>=1;A--)k(F,f,A);j=H;do{A=F.heap[1],F.heap[1]=F.heap[F.heap_len--],k(F,f,1),o=F.heap[1],F.heap[--F.heap_max]=A,F.heap[--F.heap_max]=o,f[2*j]=f[2*A]+f[2*o],F.depth[j]=(F.depth[A]>=F.depth[o]?F.depth[A]:F.depth[o])+1,f[2*A+1]=f[2*o+1]=j,F.heap[1]=j++,k(F,f,1)}while(F.heap_len>=2);F.heap[--F.heap_max]=F.heap[1],((F,P)=>{const f=P.dyn_tree,c=P.max_code,N=P.stat_desc.static_tree,H=P.stat_desc.has_stree,A=P.stat_desc.extra_bits,o=P.stat_desc.extra_base,j=P.stat_desc.max_length;let i,u,T,Y,t,C,L=0;for(Y=0;Y<=q;Y++)F.bl_count[Y]=0;for(f[2*F.heap[F.heap_max]+1]=0,i=F.heap_max+1;i<573;i++)u=F.heap[i],Y=f[2*f[2*u+1]+1]+1,Y>j&&(Y=j,L++),f[2*u+1]=Y,u>c||(F.bl_count[Y]++,t=0,u>=o&&(t=A[u-o]),C=f[2*u],F.opt_len+=C*(Y+t),H&&(F.static_len+=C*(N[2*u+1]+t)));if(0!==L){do{for(Y=j-1;0===F.bl_count[Y];)Y--;F.bl_count[Y]--,F.bl_count[Y+1]+=2,F.bl_count[j]--,L-=2}while(L>0);for(Y=j;0!==Y;Y--)for(u=F.bl_count[Y];0!==u;)T=F.heap[--i],T>c||(f[2*T+1]!==Y&&(F.opt_len+=(Y-f[2*T+1])*f[2*T],f[2*T+1]=Y),u--)}})(F,P),V(f,i,F.bl_count)},r=(F,P,f)=>{let c,N,q=-1,H=P[1],A=0,o=7,j=4;for(0===H&&(o=138,j=3),P[2*(f+1)+1]=65535,c=0;c<=f;c++)N=H,H=P[2*(c+1)+1],++A<o&&N===H||(A<j?F.bl_tree[2*N]+=A:0!==N?(N!==q&&F.bl_tree[2*N]++,F.bl_tree[32]++):A<=10?F.bl_tree[34]++:F.bl_tree[36]++,A=0,q=N,0===H?(o=138,j=3):N===H?(o=6,j=3):(o=7,j=4))},n=(F,P,f)=>{let c,N,q=-1,H=P[1],A=0,o=7,j=4;for(0===H&&(o=138,j=3),c=0;c<=f;c++)if(N=H,H=P[2*(c+1)+1],!(++A<o&&N===H)){if(A<j)do{d(F,N,F.bl_tree)}while(0!==--A);else 0!==N?(N!==q&&(d(F,N,F.bl_tree),A--),d(F,16,F.bl_tree),O(F,A-3,2)):A<=10?(d(F,17,F.bl_tree),O(F,A-3,3)):(d(F,18,F.bl_tree),O(F,A-11,7));A=0,q=N,0===H?(o=138,j=3):N===H?(o=6,j=3):(o=7,j=4)}};let p=!1;const U=(F,P,f,c)=>{O(F,0+(c?1:0),3),((F,P,f,c)=>{K(F),c&&(y(F,f),y(F,~f)),F.pending_buf.set(F.window.subarray(P,P+f),F.pending),F.pending+=f})(F,P,f,!0)};F.exports._tr_init=F=>{p||((()=>{let F,P,f,j,Z;const R=new Array(16);for(f=0,j=0;j<28;j++)for(t[j]=f,F=0;F<1<<H[j];F++)Y[f++]=j;for(Y[f-1]=j,Z=0,j=0;j<16;j++)for(C[j]=Z,F=0;F<1<<A[j];F++)T[Z++]=j;for(Z>>=7;j<N;j++)for(C[j]=Z<<7,F=0;F<1<<A[j]-7;F++)T[256+Z++]=j;for(P=0;P<=q;P++)R[P]=0;for(F=0;F<=143;)i[2*F+1]=8,F++,R[8]++;for(;F<=255;)i[2*F+1]=9,F++,R[9]++;for(;F<=279;)i[2*F+1]=7,F++,R[7]++;for(;F<=287;)i[2*F+1]=8,F++,R[8]++;for(V(i,287,R),F=0;F<N;F++)u[2*F+1]=5,u[2*F]=M(F,5);J=new L(i,H,257,c,q),B=new L(u,A,0,N,q),z=new L(new Array(0),o,0,19,7)})(),p=!0),F.l_desc=new Z(F.dyn_ltree,J),F.d_desc=new Z(F.dyn_dtree,B),F.bl_desc=new Z(F.bl_tree,z),F.bi_buf=0,F.bi_valid=0,Q(F)},F.exports._tr_stored_block=U,F.exports._tr_flush_block=(F,P,c,N)=>{let q,H,A=0;F.level>0?(2===F.strm.data_type&&(F.strm.data_type=(F=>{let P,c=4093624447;for(P=0;P<=31;P++,c>>>=1)if(1&c&&0!==F.dyn_ltree[2*P])return 0;if(0!==F.dyn_ltree[18]||0!==F.dyn_ltree[20]||0!==F.dyn_ltree[26])return 1;for(P=32;P<f;P++)if(0!==F.dyn_ltree[2*P])return 1;return 0})(F)),E(F,F.l_desc),E(F,F.d_desc),A=(F=>{let P;for(r(F,F.dyn_ltree,F.l_desc.max_code),r(F,F.dyn_dtree,F.d_desc.max_code),E(F,F.bl_desc),P=18;P>=3&&0===F.bl_tree[2*j[P]+1];P--);return F.opt_len+=3*(P+1)+5+5+4,P})(F),q=F.opt_len+3+7>>>3,H=F.static_len+3+7>>>3,H<=q&&(q=H)):q=H=c+5,c+4<=q&&-1!==P?U(F,P,c,N):4===F.strategy||H===q?(O(F,2+(N?1:0),3),I(F,i,u)):(O(F,4+(N?1:0),3),((F,P,f,c)=>{let N;for(O(F,P-257,5),O(F,f-1,5),O(F,c-4,4),N=0;N<c;N++)O(F,F.bl_tree[2*j[N]+1],3);n(F,F.dyn_ltree,P-1),n(F,F.dyn_dtree,f-1)})(F,F.l_desc.max_code+1,F.d_desc.max_code+1,A+1),I(F,F.dyn_ltree,F.dyn_dtree)),Q(F),N&&K(F)},F.exports._tr_tally=(F,P,c)=>(F.pending_buf[F.d_buf+2*F.last_lit]=P>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&P,F.pending_buf[F.l_buf+F.last_lit]=255&c,F.last_lit++,0===P?F.dyn_ltree[2*c]++:(F.matches++,P--,F.dyn_ltree[2*(Y[c]+f+1)]++,F.dyn_dtree[2*R(P)]++),F.last_lit===F.lit_bufsize-1),F.exports._tr_align=F=>{O(F,2,3),d(F,256,i),(F=>{16===F.bi_valid?(y(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):F.bi_valid>=8&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)})(F)}},12766:F=>{"use strict";F.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.jP="",this.state=null,this.data_type=2,this.adler=0}},12418:F=>{function P(F,P,f){for(var c=F.length,N=-1/0,q=1/0,H=0;H<c;H++){var A=(f[0][H]-F[H])/P[H],o=(f[1][H]-F[H])/P[H];if(A>o){var j=A;A=o,o=j}if(o<N||A>q)return 1/0;A>N&&(N=A),o<q&&(q=o)}return N>q?1/0:N}F.exports=function(F,f,c,N){var q=P(f,c,N);if(q===1/0)F=null;else{F=F||[];for(var H=0;H<f.length;H++)F[H]=f[H]+c[H]*q}return F},F.exports.distance=P},13749:(F,P,f)=>{"use strict";f.d(P,{b:()=>H});var c=f(21);const N=c.useLayoutEffect;const q=function(F){var P=(0,c.useRef)(F);return N((function(){P.current=F})),P};var H=function(F){var P=q(F);(0,c.HP)((function(){var F=function(F){var f;if(null!=P.current&&(f=P.current(F)),F.defaultPrevented&&(F.returnValue=""),"string"===typeof f)return F.returnValue=f,f};return window.addEventListener("beforeunload",F),function(){window.removeEventListener("beforeunload",F)}}),[])}},13703:(F,P,f)=>{"use strict";var c=f(13707),N=Array.prototype.concat,q=Array.prototype.slice,H=F.exports=function(F){for(var P=[],f=0,H=F.length;f<H;f++){var A=F[f];c(A)?P=N.call(P,q.call(A)):P.push(A)}return P};H.wrap=function(F){return function(){return F(H(arguments))}}},13707:F=>{F.exports=function(F){return!(!F||"string"===typeof F)&&(F instanceof Array||Array.isArray(F)||F.length>=0&&(F.splice instanceof Function||Object.getOwnPropertyDescriptor(F,F.length-1)&&"String"!==F.constructor.name))}},12679:(F,P,f)=>{var c=f(12683);function N(F){for(var P,f,N=0,q=F.length,H=0;H<F.length;){for(P=F[H],f=0;H<q&&F[H]===P;)++H,++f;N+=c.log2(f)/7|0,N+=c.log2(P>>>0)/7|0,N+=2}return N}P.size=N,P.encode=function(F,P){P||(P=new Uint8Array(N(F)));for(var f,c,q=0,H=P.length,A=0;A<F.length;){for(f=F[A],c=0;A<F.length&&F[A]===f;)++A,++c;for(;q<H&&c>=128;)P[q++]=128+(127&c),c>>>=7;if(q>=H)throw new Error("RLE buffer overflow");for(P[q++]=c,f>>>=0;q<H&&f>=128;)P[q++]=128+(127&f),f>>>=7;if(q>=H)throw new Error("RLE buffer overflow");P[q++]=f}return P},P.decode=function(F,P){for(var f,c,N,q,H=P.length,A=F.length,o=0,j=0;j<A;){for(f=0,c=0;j<A&&F[j]>=128;)f+=(127&F[j++])<<c,c+=7;if(f+=F[j++]<<c,j>=A)throw new Error("RLE buffer underrun");if(o+f>H)throw new Error("Chunk buffer overflow");for(N=0,c=0;j<A&&F[j]>=128;)N+=(127&F[j++])<<c,c+=7;if(j>=A)throw new Error("RLE buffer underrun");for(N+=F[j++]<<c,q=0;q<f;++q)P[o++]=N}return P}},12683:(F,P)=>{"use strict";function f(F){var P=32;return(F&=-F)&&P--,65535&F&&(P-=16),16711935&F&&(P-=8),252645135&F&&(P-=4),858993459&F&&(P-=2),1431655765&F&&(P-=1),P}P.INT_BITS=32,P.INT_MAX=2147483647,P.INT_MIN=-1<<31,P.sign=function(F){return(F>0)-(F<0)},P.abs=function(F){var P=F>>31;return(F^P)-P},P.min=function(F,P){return P^(F^P)&-(F<P)},P.max=function(F,P){return F^(F^P)&-(F<P)},P.isPow2=function(F){return!(F&F-1)&&!!F},P.log2=function(F){var P,f;return P=(F>65535)<<4,P|=f=((F>>>=P)>255)<<3,P|=f=((F>>>=f)>15)<<2,(P|=f=((F>>>=f)>3)<<1)|(F>>>=f)>>1},P.log10=function(F){return F>=1e9?9:F>=1e8?8:F>=1e7?7:F>=1e6?6:F>=1e5?5:F>=1e4?4:F>=1e3?3:F>=100?2:F>=10?1:0},P.popCount=function(F){return 16843009*((F=(858993459&(F-=F>>>1&1431655765))+(F>>>2&858993459))+(F>>>4)&252645135)>>>24},P.countTrailingZeros=f,P.nextPow2=function(F){return F+=0===F,--F,F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,(F|=F>>>16)+1},P.prevPow2=function(F){return F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,(F|=F>>>16)-(F>>>1)},P.parity=function(F){return F^=F>>>16,F^=F>>>8,F^=F>>>4,27030>>>(F&=15)&1};var c=new Array(256);!function(F){for(var P=0;P<256;++P){var f=P,c=P,N=7;for(f>>>=1;f;f>>>=1)c<<=1,c|=1&f,--N;F[P]=c<<N&255}}(c),P.reverse=function(F){return c[255&F]<<24|c[F>>>8&255]<<16|c[F>>>16&255]<<8|c[F>>>24&255]},P.interleave2=function(F,P){return(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F&=65535)|F<<8))|F<<4))|F<<2))|F<<1))|(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P&=65535)|P<<8))|P<<4))|P<<2))|P<<1))<<1},P.deinterleave2=function(F,P){return(F=65535&((F=16711935&((F=252645135&((F=858993459&((F=F>>>P&1431655765)|F>>>1))|F>>>2))|F>>>4))|F>>>16))<<16>>16},P.interleave3=function(F,P,f){return F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2),(F|=(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<1)|(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<2},P.deinterleave3=function(F,P){return(F=1023&((F=4278190335&((F=251719695&((F=3272356035&((F=F>>>P&1227133513)|F>>>2))|F>>>4))|F>>>8))|F>>>16))<<22>>22},P.nextCombination=function(F){var P=F|F-1;return P+1|(~P&-~P)-1>>>f(F)+1}},12713:F=>{"use strict";F.exports=function(F,P,f,c){var N=self||window;try{try{var q;try{q=new N.Blob([F])}catch(j){(q=new(N.BlobBuilder||N.WebKitBlobBuilder||N.MozBlobBuilder||N.MSBlobBuilder)).append(F),q=q.getBlob()}var H=N.URL||N.webkitURL,A=H.createObjectURL(q),o=new N[P](A,f);return H.revokeObjectURL(A),o}catch(j){return new N[P]("data:application/javascript,".concat(encodeURIComponent(F)),f)}}catch(j){if(!c)throw Error("Inline worker is not supported");return new N[P](c,f)}}},12407:(F,P,f)=>{"use strict";function c(F,P,f,c,N){var q={};return Object.keys(c).forEach((function(F){q[F]=c[F]})),q.enumerable=!!q.enumerable,q.configurable=!!q.configurable,("value"in q||q.initializer)&&(q.writable=!0),q=f.slice().reverse().reduce((function(f,c){return c(F,P,f)||f}),q),N&&void 0!==q.initializer&&(q.value=q.initializer?q.initializer.call(N):void 0,q.initializer=void 0),void 0===q.initializer&&(Object.defineProperty(F,P,q),q=null),q}f.d(P,{d:()=>c})},12398:(F,P,f)=>{"use strict";function c(F,P,f,c){f&&Object.defineProperty(F,P,{enumerable:f.enumerable,configurable:f.configurable,writable:f.writable,value:f.initializer?f.initializer.call(c):void 0})}f.d(P,{b:()=>c})},13738:(F,P,f)=>{"use strict";f.d(P,{d:()=>H,f:()=>u,g:()=>A,h:()=>q,i:()=>o,j:()=>N,l:()=>j,p:()=>i});var c=f(11826);class N{constructor(){this._easingMode=N.EASINGMODE_EASEIN}setEasingMode(F){const P=Math.min(Math.max(F,0),2);this._easingMode=P}getEasingMode(){return this._easingMode}easeInCore(F){throw new Error("You must implement this method")}ease(F){switch(this._easingMode){case N.EASINGMODE_EASEIN:return this.easeInCore(F);case N.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-F)}return F>=.5?.5*(1-this.easeInCore(2*(1-F)))+.5:.5*this.easeInCore(2*F)}}N.EASINGMODE_EASEIN=0,N.EASINGMODE_EASEOUT=1,N.EASINGMODE_EASEINOUT=2;class q extends N{easeInCore(F){return F=Math.max(0,Math.min(1,F)),1-Math.sqrt(1-F*F)}}class H extends N{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=F}easeInCore(F){const P=Math.max(0,this.amplitude);return Math.pow(F,3)-F*P*Math.sin(3.141592653589793*F)}}class A extends N{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=F,this.bounciness=P}easeInCore(F){const P=Math.max(0,this.bounces);let f=this.bounciness;f<=1&&(f=1.001);const c=Math.pow(f,P),N=1-f,q=(1-c)/N+.5*c,H=F*q,A=Math.log(-H*(1-f)+1)/Math.log(f),o=Math.floor(A),j=o+1,i=(1-Math.pow(f,o))/(N*q),u=.5*(i+(1-Math.pow(f,j))/(N*q)),T=F-u,Y=u-i;return-Math.pow(1/f,P-o)/(Y*Y)*(T-Y)*(T+Y)}}class o extends N{easeInCore(F){return F*F*F}}class j extends N{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=F,this.springiness=P}easeInCore(F){let P;const f=Math.max(0,this.oscillations),c=Math.max(0,this.springiness);return P=0==c?F:(Math.exp(c*F)-1)/(Math.exp(c)-1),P*Math.sin((6.283185307179586*f+1.5707963267948966)*F)}}class i extends N{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=F}easeInCore(F){return this.exponent<=0?F:(Math.exp(this.exponent*F)-1)/(Math.exp(this.exponent)-1)}}class u extends N{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=F,this.y1=P,this.x2=f,this.y2=c}easeInCore(F){return c.b.Interpolate(F,this.x1,this.y1,this.x2,this.y2)}}},13180:(F,P,f)=>{"use strict";f.d(P,{c:()=>H});var c=f(11639),N=f(11655),q=f(12033);class H extends q.c{get _matrix(){return this._compose(),this.bT}set _matrix(F){(F.updateFlag!==this.bT.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.bT.q(F),this._markAsDirtyAndDecompose())}constructor(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(F,P.OF(),!1),this.name=F,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=P,this.bT=(null===N||void 0===N?void 0:N.clone())??c.Matrix.Identity(),this._restMatrix=q??this.bT.clone(),this._bindMatrix=H??this.bT.clone(),this._index=A,this._absoluteMatrix=new c.Matrix,this._absoluteBindMatrix=new c.Matrix,this._absoluteInverseBindMatrix=new c.Matrix,this._finalMatrix=new c.Matrix,P.bones.push(this),this.setParent(f,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(F){this.setParent(F)}setParent(F){let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==F){if(this.parent){const F=this.parent.children.indexOf(this);-1!==F&&this.parent.children.splice(F,1)}this._parentNode=F,this.parent&&this.parent.children.push(this),P&&this._updateAbsoluteBindMatrices(),this.Ti()}}getLocalMatrix(){return this._compose(),this.bT}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(F){this._restMatrix.q(F)}setRestPose(F){this.setRestMatrix(F)}getBindPose(){return this.getBindMatrix()}setBindMatrix(F){this.sf(F)}setBindPose(F){this.setBindMatrix(F)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const F=c.TmpVectors.tP[0],P=c.TmpVectors.Quaternion[0],f=c.TmpVectors.tP[1];this.getRestMatrix().decompose(F,P,f),this._linkedTransformNode.position.q(f),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??c.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.q(P),this._linkedTransformNode.cc.q(F)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(F){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=F,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Co}set position(F){this._decompose(),this.Co.q(F),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(F){this.setRotation(F)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(F){this.setRotationQuaternion(F)}get cc(){return this.getScale()}set cc(F){this.setScale(F)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=c.tP.Zero(),this._localRotation=c.Quaternion.Zero(),this.Co=c.tP.Zero()),this.bT.decompose(this._localScaling,this._localRotation,this.Co))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,c.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Co,this.bT)):this._needToCompose=!1)}sf(F){let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.q(F),P&&this._updateAbsoluteBindMatrices(),f?this._matrix=F:this.Ti()}_updateAbsoluteBindMatrices(F){let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(F||(F=this._bindMatrix),this.parent?F.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.q(F),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),P)for(let f=0;f<this.children.length;f++)this.children[f]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Ti(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Ti(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Ti(),this._needToDecompose=!0}_updatePosition(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=this.getLocalMatrix();if(0==P)N?(q.addAtIndex(12,F.x),q.addAtIndex(13,F.y),q.addAtIndex(14,F.z)):q.setTranslationFromFloats(F.x,F.y,F.z);else{let P=null;f&&(P=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=H._TmpMats[0],o=H._TmpVecs[0];this.parent?f&&P?(A.q(this.parent.getAbsoluteMatrix()),A.multiplyToRef(P,A)):A.q(this.parent.getAbsoluteMatrix()):c.Matrix.IdentityToRef(A),N&&A.setTranslationFromFloats(0,0,0),A.invert(),c.tP.TransformCoordinatesToRef(F,A,o),N?(q.addAtIndex(12,o.x),q.addAtIndex(13,o.y),q.addAtIndex(14,o.z)):q.setTranslationFromFloats(o.x,o.y,o.z)}this._markAsDirtyAndDecompose()}translate(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;this._updatePosition(F,P,f,!0)}setPosition(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;this._updatePosition(F,P,f,!1)}setAbsolutePosition(F,P){this.setPosition(F,1,P)}scale(F,P,f){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const q=this.getLocalMatrix(),A=H._TmpMats[0];c.Matrix.ScalingToRef(F,P,f,A),A.multiplyToRef(q,q),A.invert();for(const c of this.children){const N=c.getLocalMatrix();N.multiplyToRef(A,N),N.multiplyAtIndex(12,F),N.multiplyAtIndex(13,P),N.multiplyAtIndex(14,f),c._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),N)for(const c of this.children)c.scale(F,P,f,N)}setScale(F){this._decompose(),this._localScaling.q(F),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(F){this._decompose(),F.q(this._localScaling)}setYawPitchRoll(F,P,f){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4?arguments[4]:void 0;if(0===N){const A=H._TmpQuat;return c.Quaternion.RotationYawPitchRollToRef(F,P,f,A),void this.setRotationQuaternion(A,N,q)}const A=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,q))return;const o=H._TmpMats[1];c.Matrix.RotationYawPitchRollToRef(F,P,f,o),A.multiplyToRef(o,o),this._rotateWithMatrix(o,N,q)}rotate(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;const q=H._TmpMats[0];q.setTranslationFromFloats(0,0,0),c.Matrix.RotationAxisToRef(F,P,q),this._rotateWithMatrix(q,f,N)}setAxisAngle(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;if(0===f){const q=H._TmpQuat;return c.Quaternion.RotationAxisToRef(F,P,q),void this.setRotationQuaternion(q,f,N)}const q=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,N))return;const A=H._TmpMats[1];c.Matrix.RotationAxisToRef(F,P,A),q.multiplyToRef(A,A),this._rotateWithMatrix(A,f,N)}setRotation(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(F.y,F.x,F.z,P,f)}setRotationQuaternion(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;if(0===P)return this._decompose(),this._localRotation.q(F),void this._markAsDirtyAndCompose();const N=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,f))return;const q=H._TmpMats[1];c.Matrix.FromQuaternionToRef(F,q),N.multiplyToRef(q,q),this._rotateWithMatrix(q,P,f)}setRotationMatrix(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;if(0===P){const N=H._TmpQuat;return c.Quaternion.FromRotationMatrixToRef(F,N),void this.setRotationQuaternion(N,P,f)}const N=H._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,f))return;const q=H._TmpMats[1];q.q(F),N.multiplyToRef(F,q),this._rotateWithMatrix(q,P,f)}_rotateWithMatrix(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;const c=this.getLocalMatrix(),N=c.m[12],q=c.m[13],A=c.m[14],o=this.getParent(),j=H._TmpMats[3],i=H._TmpMats[4];o&&1==P?(f?(j.q(f.getWorldMatrix()),o.getAbsoluteMatrix().multiplyToRef(j,j)):j.q(o.getAbsoluteMatrix()),i.q(j),i.invert(),c.multiplyToRef(j,c),c.multiplyToRef(F,c),c.multiplyToRef(i,c)):1==P&&f?(j.q(f.getWorldMatrix()),i.q(j),i.invert(),c.multiplyToRef(j,c),c.multiplyToRef(F,c),c.multiplyToRef(i,c)):c.multiplyToRef(F,c),c.setTranslationFromFloats(N,q,A),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(F,P){const f=H._TmpMats[2];return F.q(this.getAbsoluteMatrix()),P?(F.multiplyToRef(P.getWorldMatrix(),F),c.Matrix.ScalingToRef(P.cc.x,P.cc.y,P.cc.z,f)):c.Matrix.IdentityToRef(f),F.invert(),!isNaN(F.m[0])&&(f.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyToRef(f,F),!0)}Af(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=c.tP.Zero();return this.getPositionToRef(F,P,f),f}getPositionToRef(){let F=arguments.length>1?arguments[1]:void 0,P=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const F=this.getLocalMatrix();P.x=F.m[12],P.y=F.m[13],P.z=F.m[14]}else{let f=null;F&&(f=F.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let c=H._TmpMats[0];F&&f?(c.q(this.getAbsoluteMatrix()),c.multiplyToRef(f,c)):c=this.getAbsoluteMatrix(),P.x=c.m[12],P.y=c.m[13],P.z=c.m[14]}}getAbsolutePosition(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const P=c.tP.Zero();return this.getPositionToRef(1,F,P),P}getAbsolutePositionToRef(F,P){this.getPositionToRef(1,F,P)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.bT.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.q(this.bT);const F=this._skeleton.getPoseMatrix();F&&this._absoluteMatrix.multiplyToRef(F,this._absoluteMatrix)}const F=this.children,P=F.length;for(let f=0;f<P;f++)F[f].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}so(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=c.tP.Zero();return this.getDirectionToRef(F,P,f),f}getDirectionToRef(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,N=null;P&&(N=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=H._TmpMats[0];q.q(this.getAbsoluteMatrix()),P&&N&&q.multiplyToRef(N,q),c.tP.TransformNormalToRef(F,q,f),f.normalize()}getRotation(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=c.tP.Zero();return this.getRotationToRef(F,P,f),f}getRotationToRef(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0;const c=H._TmpQuat;this.getRotationQuaternionToRef(F,P,c),c.toEulerAnglesToRef(f)}getRotationQuaternion(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=c.Quaternion.Identity();return this.getRotationQuaternionToRef(F,P,f),f}getRotationQuaternionToRef(){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),P.q(this._localRotation);else{const f=H._TmpMats[0],c=this.getAbsoluteMatrix();F?c.multiplyToRef(F.getWorldMatrix(),f):f.q(c),f.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyAtIndex(1,this._scalingDeterminant),f.multiplyAtIndex(2,this._scalingDeterminant),f.decompose(void 0,P,void 0)}}getRotationMatrix(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,P=arguments.length>1?arguments[1]:void 0;const f=c.Matrix.Identity();return this.getRotationMatrixToRef(F,P,f),f}getRotationMatrixToRef(){let F=arguments.length>1?arguments[1]:void 0,P=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(P);else{const f=H._TmpMats[0],c=this.getAbsoluteMatrix();F?c.multiplyToRef(F.getWorldMatrix(),f):f.q(c),f.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyAtIndex(1,this._scalingDeterminant),f.multiplyAtIndex(2,this._scalingDeterminant),f.getRotationMatrixToRef(P)}}getAbsolutePositionFromLocal(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=c.tP.Zero();return this.getAbsolutePositionFromLocalToRef(F,P,f),f}getAbsolutePositionFromLocalToRef(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,N=null;P&&(N=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=H._TmpMats[0];q.q(this.getAbsoluteMatrix()),P&&N&&q.multiplyToRef(N,q),c.tP.TransformCoordinatesToRef(F,q,f)}getLocalPositionFromAbsolute(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=c.tP.Zero();return this.getLocalPositionFromAbsoluteToRef(F,P,f),f}getLocalPositionFromAbsoluteToRef(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,N=null;P&&(N=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=H._TmpMats[0];q.q(this.getAbsoluteMatrix()),P&&N&&q.multiplyToRef(N,q),q.invert(),c.tP.TransformCoordinatesToRef(F,q,f)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const F=this._skeleton.bones.indexOf(this);if(-1!==F&&this._skeleton.bones.splice(F,1),this._parentNode&&this._parentNode.children){const F=this._parentNode.children,P=F.indexOf(this);-1!==P&&F.splice(P,1)}super.dispose()}}H._TmpVecs=(0,N.e)(2,c.tP.Zero),H._TmpQuat=c.Quaternion.Identity(),H._TmpMats=(0,N.e)(5,c.Matrix.Identity)},13730:(F,P,f)=>{"use strict";f.d(P,{d:()=>E});var c=f(11619),N=f(11628),q=f(11464),H=f(11639),A=f(11664),o=f(12033),j=f(12063),i=f(11883),u=f(11480),T=f(11648);class Y{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(F){this._zoomStopsAnimation=F}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(F){this._idleRotationSpeed=F}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(F){this._idleRotationWaitTime=F}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(F){this._idleRotationSpinupTime=F}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(F){this._attachedCamera=F;const P=this._attachedCamera.OF();this._onPrePointerObservableObserver=P.onPrePointerObservable.add((F=>{F.type!==i.b.POINTERDOWN?F.type===i.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=F.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const F=u.d.Now;let P=0;null!=this._lastFrameTime&&(P=F-this._lastFrameTime),this._lastFrameTime=F,this._applyUserInteraction();const f=F-this._lastInteractionTime-this._idleRotationWaitTime,c=Math.max(Math.min(f/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*c,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(P/1e3))}))}detach(){if(!this._attachedCamera)return;const F=this._attachedCamera.OF();this._onPrePointerObservableObserver&&F.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(F){this._lastInteractionTime=F??u.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<T.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let F=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(F=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?F:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=u.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var t=f(13738),C=f(12150);class L{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(F){if(this._autoTransitionRange===F)return;this._autoTransitionRange=F;const P=this._attachedCamera;P&&(F?this._onMeshTargetChangedObserver=P.onMeshTargetChangedObservable.add((F=>{if(F&&(F.gf(!0),F.getBoundingInfo)){const P=F.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*P,this.upperRadiusTransitionRange=.05*P}})):this._onMeshTargetChangedObserver&&P.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(F){this._attachedCamera=F,this._onAfterCheckInputsObserver=F.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(F){return!!this._attachedCamera&&(this._attachedCamera.radius===F&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(F){if(!this._attachedCamera)return;this._radiusBounceTransition||(L.EasingFunction.setEasingMode(L.EasingMode),this._radiusBounceTransition=C.d.CreateAnimation("radius",C.d.ANIMATIONTYPE_FLOAT,60,L.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const P=C.d.TransitionTo("radius",this._attachedCamera.radius+F,this._attachedCamera,this._attachedCamera.OF(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));P&&this._animatables.push(P)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}L.EasingFunction=new t.d(.3),L.EasingMode=t.j.EASINGMODE_EASEOUT;class J{constructor(){this.onTargetFramingAnimationEndObservable=new q.d,this._mode=J.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(F){this._mode=F}get mode(){return this._mode}set radiusScale(F){this._radiusScale=F}get radiusScale(){return this._radiusScale}set positionScale(F){this._positionScale=F}get positionScale(){return this._positionScale}set defaultElevation(F){this._defaultElevation=F}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(F){this._elevationReturnTime=F}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(F){this._elevationReturnWaitTime=F}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(F){this._zoomStopsAnimation=F}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(F){this._framingTime=F}get framingTime(){return this._framingTime}init(){}attach(F){this._attachedCamera=F;const P=this._attachedCamera.OF();J.EasingFunction.setEasingMode(J.EasingMode),this._onPrePointerObservableObserver=P.onPrePointerObservable.add((F=>{F.type!==i.b.POINTERDOWN?F.type===i.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=F.onMeshTargetChangedObservable.add((F=>{F&&F.getBoundingInfo&&this.zoomOnMesh(F,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=F.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const F=this._attachedCamera.OF();this._onPrePointerObservableObserver&&F.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F.gf(!0);const c=F.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(c.minimumWorld,c.maximumWorld,P,f)}zoomOnMeshHierarchy(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F.gf(!0);const c=F.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(c.min,c.max,P,f)}zoomOnMeshesHierarchy(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new H.tP(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new H.tP(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let q=0;q<F.length;q++){const P=F[q].getHierarchyBoundingVectors(!0);H.tP.CheckExtends(P.min,c,N),H.tP.CheckExtends(P.max,c,N)}this.zoomOnBoundingInfo(c,N,P,f)}zoomOnBoundingInfo(F,P){let f,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const q=F.y,A=q+(P.y-q)*this._positionScale,o=P.CP(F).scale(.5);if(!isFinite(A))return!1;if(c)f=new H.tP(0,A,0);else{const P=F.add(o);f=new H.tP(P.x,A,P.z)}this._vectorTransition||(this._vectorTransition=C.d.CreateAnimation("target",C.d.ANIMATIONTYPE_VECTOR3,60,J.EasingFunction)),this._betaIsAnimating=!0;let j=C.d.TransitionTo("target",f,this._attachedCamera,this._attachedCamera.OF(),60,this._vectorTransition,this._framingTime);j&&this._animatables.push(j);let i=0;if(this._mode===J.FitFrustumSidesMode){const f=this._calculateLowerRadiusFromModelBoundingSphere(F,P);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=o.length()+this._attachedCamera.Wf),i=f}else this._mode===J.IgnoreBoundsSizeMode&&(i=this._calculateLowerRadiusFromModelBoundingSphere(F,P),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Wf));if(this.autoCorrectCameraLimitsAndSensibility){const f=P.CP(F).length();this._attachedCamera.panningSensibility=5e3/f,this._attachedCamera.wheelPrecision=100/i}return this._radiusTransition||(this._radiusTransition=C.d.CreateAnimation("radius",C.d.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),j=C.d.TransitionTo("radius",i,this._attachedCamera,this._attachedCamera.OF(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),N&&N(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),j&&this._animatables.push(j),!0}_calculateLowerRadiusFromModelBoundingSphere(F,P){const f=this._attachedCamera;if(!f)return 0;let c=f._calculateLowerRadiusFromModelBoundingSphere(F,P,this._radiusScale);return f.lowerRadiusLimit&&this._mode===J.IgnoreBoundsSizeMode&&(c=c<f.lowerRadiusLimit?f.lowerRadiusLimit:c),f.upperRadiusLimit&&(c=c>f.upperRadiusLimit?f.upperRadiusLimit:c),c}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const F=u.d.Now-this._lastInteractionTime,P=.5*Math.PI-this._defaultElevation,f=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>f&&F>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=C.d.CreateAnimation("beta",C.d.ANIMATIONTYPE_FLOAT,60,J.EasingFunction));const F=C.d.TransitionTo("beta",P,this._attachedCamera,this._attachedCamera.OF(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));F&&this._animatables.push(F)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=u.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}J.EasingFunction=new t.p,J.EasingMode=t.j.EASINGMODE_EASEINOUT,J.IgnoreBoundsSizeMode=0,J.FitFrustumSidesMode=1;var B=f(12070),z=f(12108),Z=f(13174),R=f(11462);class y{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(F){F=R.Tools.BackCompatCameraNoPreventDefault(arguments);const P=this.camera.getEngine(),f=P.getInputElement();let c=0,N=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=q=>{var H,A;const o=q.event,j="touch"===o.pointerType;if(q.type!==i.b.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;const u=o.target;if(this._altKey=o.altKey,this._ctrlKey=o.ctrlKey,this._metaKey=o.metaKey,this._shiftKey=o.shiftKey,this._buttonsPressed=o.buttons,P.isPointerLock){const F=o.movementX,P=o.movementY;this.onTouch(null,F,P),this._pointA=null,this._pointB=null}else{if(q.type!==i.b.POINTERDOWN&&q.type!==i.b.POINTERDOUBLETAP&&j&&(null===(H=this._pointA)||void 0===H?void 0:H.pointerId)!==o.pointerId&&(null===(A=this._pointB)||void 0===A?void 0:A.pointerId)!==o.pointerId)return;if(q.type!==i.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!j)if(q.type===i.b.POINTERDOUBLETAP)this.onDoubleTap(o.pointerType);else if(q.type!==i.b.POINTERUP||this._currentMousePointerIdDown!==o.pointerId&&!j){if(q.type===i.b.POINTERMOVE)if(F||o.preventDefault(),this._pointA&&null===this._pointB){const F=o.clientX-this._pointA.x,P=o.clientY-this._pointA.y;this._pointA.x=o.clientX,this._pointA.y=o.clientY,this.onTouch(this._pointA,F,P)}else if(this._pointA&&this._pointB){const F=this._pointA.pointerId===o.pointerId?this._pointA:this._pointB;F.x=o.clientX,F.y=o.clientY;const P=this._pointA.x-this._pointB.x,f=this._pointA.y-this._pointB.y,H=P*P+f*f,A={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:o.pointerId,type:q.type};this.onMultiTouch(this._pointA,this._pointB,c,H,N,A),N=A,c=H}}else{try{null===u||void 0===u||u.releasePointerCapture(o.pointerId)}catch(T){}j||(this._pointB=null),P._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==o.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==o.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==c||N)&&(this.onMultiTouch(this._pointA,this._pointB,c,0,N,null),c=0,N=null),this._currentMousePointerIdDown=-1,this.onButtonUp(o),F||o.preventDefault()}else{try{null===u||void 0===u||u.setPointerCapture(o.pointerId)}catch(T){}if(null===this._pointA)this._pointA={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType};else{if(null!==this._pointB)return;this._pointB={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType}}-1!==this._currentMousePointerIdDown||j||(this._currentMousePointerIdDown=o.pointerId),this.onButtonDown(o),F||(o.preventDefault(),f&&f.focus())}}},this._observer=this.camera.OF()._inputManager._addCameraPointerObserver(this._pointerInput,i.b.POINTERDOWN|i.b.POINTERUP|i.b.POINTERMOVE|i.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,c=0,N=null,this.onLostFocus()},this._contextMenuBind=F=>this.onContextMenu(F),f&&f.addEventListener("contextmenu",this._contextMenuBind,!1);const q=this.camera.OF().getEngine().getHostWindow();q&&R.Tools.RegisterTopRootEvents(q,[{name:"blur",handler:this._onLostFocus}])}FT(){if(this._onLostFocus){const F=this.camera.OF().getEngine().getHostWindow();F&&R.Tools.UnregisterTopRootEvents(F,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.OF()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const F=this.camera.OF().getEngine().getInputElement();F&&F.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(F){}onTouch(F,P,f){}onMultiTouch(F,P,f,c,N,q){}onContextMenu(F){F.preventDefault()}onButtonDown(F){}onButtonUp(F){}onLostFocus(){}}(0,c.e)([(0,N.L)()],y.prototype,"buttons",void 0);class O extends y{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(F,P){if(0!==this.panningSensibility&&F&&P){const f=P.x-F.x,c=P.y-F.y;this.camera.inertialPanningX+=-f/this.panningSensibility,this.camera.inertialPanningY+=c/this.panningSensibility}}_computePinchZoom(F,P){const f=this.camera.radius||O.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=f*Math.sqrt(F)/Math.sqrt(P):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(P-F)*f*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(P-F)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(F,P,f){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-P/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility):(this.camera.inertialAlphaOffset-=P/this.angularSensibilityX,this.camera.inertialBetaOffset-=f/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(F,P,f,c,N,q){0===f&&null===N||0===c&&null===q||(this.multiTouchPanAndZoom?(this._computePinchZoom(f,c),this._computeMultiTouchPanning(N,q)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(c)-Math.sqrt(f))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(f,c),this._isPinching=!0):this._computeMultiTouchPanning(N,q)):this.multiTouchPanning?this._computeMultiTouchPanning(N,q):this.pinchZoom&&this._computePinchZoom(f,c))}onButtonDown(F){this._isPanClick=F.button===this.camera._panningMouseButton}onButtonUp(F){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}O.MinimumRadiusForPinch=.001,(0,c.e)([(0,N.L)()],O.prototype,"buttons",void 0),(0,c.e)([(0,N.L)()],O.prototype,"angularSensibilityX",void 0),(0,c.e)([(0,N.L)()],O.prototype,"angularSensibilityY",void 0),(0,c.e)([(0,N.L)()],O.prototype,"pinchPrecision",void 0),(0,c.e)([(0,N.L)()],O.prototype,"pinchDeltaPercentage",void 0),(0,c.e)([(0,N.L)()],O.prototype,"useNaturalPinchZoom",void 0),(0,c.e)([(0,N.L)()],O.prototype,"pinchZoom",void 0),(0,c.e)([(0,N.L)()],O.prototype,"panningSensibility",void 0),(0,c.e)([(0,N.L)()],O.prototype,"multiTouchPanning",void 0),(0,c.e)([(0,N.L)()],O.prototype,"multiTouchPanAndZoom",void 0),Z.e.ArcRotateCameraPointersInput=O;var d=f(11891);class M{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(F){F=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.OF(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((P=>{const f=P.event;if(!f.metaKey)if(P.type===d.d.KEYDOWN){if(this._ctrlPressed=f.ctrlKey,this._altPressed=f.altKey,-1!==this.keysUp.indexOf(f.keyCode)||-1!==this.keysDown.indexOf(f.keyCode)||-1!==this.keysLeft.indexOf(f.keyCode)||-1!==this.keysRight.indexOf(f.keyCode)||-1!==this.keysReset.indexOf(f.keyCode)){-1===this._keys.indexOf(f.keyCode)&&this._keys.push(f.keyCode),f.preventDefault&&(F||f.preventDefault())}}else if(-1!==this.keysUp.indexOf(f.keyCode)||-1!==this.keysDown.indexOf(f.keyCode)||-1!==this.keysLeft.indexOf(f.keyCode)||-1!==this.keysRight.indexOf(f.keyCode)||-1!==this.keysReset.indexOf(f.keyCode)){const P=this._keys.indexOf(f.keyCode);P>=0&&this._keys.splice(P,1),f.preventDefault&&(F||f.preventDefault())}})))}FT(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const F=this.camera;for(let P=0;P<this._keys.length;P++){const f=this._keys[P];-1!==this.keysLeft.indexOf(f)?this._ctrlPressed&&this.camera._useCtrlForPanning?F.inertialPanningX-=1/this.panningSensibility:F.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(f)?this._ctrlPressed&&this.camera._useCtrlForPanning?F.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?F.inertialRadiusOffset+=1/this.zoomingSensibility:F.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(f)?this._ctrlPressed&&this.camera._useCtrlForPanning?F.inertialPanningX+=1/this.panningSensibility:F.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(f)?this._ctrlPressed&&this.camera._useCtrlForPanning?F.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?F.inertialRadiusOffset-=1/this.zoomingSensibility:F.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(f)&&F.useInputToRestoreState&&F.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,c.e)([(0,N.L)()],M.prototype,"keysUp",void 0),(0,c.e)([(0,N.L)()],M.prototype,"keysDown",void 0),(0,c.e)([(0,N.L)()],M.prototype,"keysLeft",void 0),(0,c.e)([(0,N.L)()],M.prototype,"keysRight",void 0),(0,c.e)([(0,N.L)()],M.prototype,"keysReset",void 0),(0,c.e)([(0,N.L)()],M.prototype,"panningSensibility",void 0),(0,c.e)([(0,N.L)()],M.prototype,"zoomingSensibility",void 0),(0,c.e)([(0,N.L)()],M.prototype,"useAltToZoom",void 0),(0,c.e)([(0,N.L)()],M.prototype,"angularSpeed",void 0),Z.e.ArcRotateCameraKeyboardMoveInput=M;var V=f(11697),Q=f(11894);class K{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new H.tP(0,0,0),this._globalOffset=new H.tP(0,0,0),this._inertialPanning=H.tP.Zero()}_computeDeltaFromMouseWheelLegacyEvent(F,P){let f=0;const c=.01*F*this.wheelDeltaPercentage*P;return f=F>0?c/(1+this.wheelDeltaPercentage):c*(1+this.wheelDeltaPercentage),f}attachControl(F){F=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=P=>{if(P.type!==i.b.POINTERWHEEL)return;const f=P.event;let c=0;const N=f.deltaMode===Q.b.DOM_DELTA_LINE?40:1,q=-f.deltaY*N;if(this.customComputeDeltaFromMouseWheel)c=this.customComputeDeltaFromMouseWheel(q,this,f);else if(this.wheelDeltaPercentage){if(c=this._computeDeltaFromMouseWheelLegacyEvent(q,this.camera.radius),c>0){let F=this.camera.radius,P=this.camera.inertialRadiusOffset+c;for(let f=0;f<20&&!(F<=P)&&!(Math.abs(P*this.camera.inertia)<.001);f++)F-=P,P*=this.camera.inertia;F=(0,A.Clamp)(F,0,Number.MAX_VALUE),c=this._computeDeltaFromMouseWheelLegacyEvent(q,F)}}else c=q/(40*this.wheelPrecision);c&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(c)):this.camera.inertialRadiusOffset+=c),f.preventDefault&&(F||f.preventDefault())},this._observer=this.camera.OF()._inputManager._addCameraPointerObserver(this._wheel,i.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Nc(0)}FT(){this._observer&&(this.camera.OF()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const F=this.camera;0+F.inertialAlphaOffset+F.inertialBetaOffset+F.inertialRadiusOffset&&(this._updateHitPlane(),F.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(F.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const F=this.camera,P=F.target.CP(F.position);this._hitPlane=V.e.FromPositionAndNormal(F.target,P)}_getPosition(){const F=this.camera,P=F.OF(),f=P.createPickingRay(P.pointerX,P.pointerY,H.Matrix.Identity(),F,!1);0===F.targetScreenOffset.x&&0===F.targetScreenOffset.y||(this._viewOffset.set(F.targetScreenOffset.x,F.targetScreenOffset.y,0),F.getViewMatrix().invertToRef(F._cameraTransformMatrix),this._globalOffset=H.tP.TransformNormal(this._viewOffset,F._cameraTransformMatrix),f.origin.addInPlace(this._globalOffset));let c=0;return this._hitPlane&&(c=f.intersectsPlane(this._hitPlane)??0),f.origin.addInPlace(f.direction.scaleInPlace(c))}_zoomToMouse(F){const P=this.camera,f=1-P.inertia;if(P.lowerRadiusLimit){const c=P.lowerRadiusLimit??0;P.radius-(P.inertialRadiusOffset+F)/f<c&&(F=(P.radius-c)*f-P.inertialRadiusOffset)}if(P.upperRadiusLimit){const c=P.upperRadiusLimit??0;P.radius-(P.inertialRadiusOffset+F)/f>c&&(F=(P.radius-c)*f-P.inertialRadiusOffset)}const c=F/f/P.radius,N=this._getPosition(),q=H.TmpVectors.tP[6];N.subtractToRef(P.target,q),q.scaleInPlace(c),q.scaleInPlace(f),this._inertialPanning.addInPlace(q),P.inertialRadiusOffset+=F}_zeroIfClose(F){Math.abs(F.x)<T.e&&(F.x=0),Math.abs(F.y)<T.e&&(F.y=0),Math.abs(F.z)<T.e&&(F.z=0)}}(0,c.e)([(0,N.L)()],K.prototype,"wheelPrecision",void 0),(0,c.e)([(0,N.L)()],K.prototype,"zoomToMouseLocation",void 0),(0,c.e)([(0,N.L)()],K.prototype,"wheelDeltaPercentage",void 0),Z.e.ArcRotateCameraMouseWheelInput=K;class x extends Z.h{constructor(F){super(F)}addMouseWheel(){return this.add(new K),this}addPointers(){return this.add(new O),this}addKeyboard(){return this.add(new M),this}}var k=f(11587);function I(F,P){return isNaN(F)?P:F}o.c.AddNodeConstructor("ArcRotateCamera",((F,P)=>()=>new E(F,0,0,1,H.tP.Zero(),P)));class E extends z.b{get target(){return this._target}set target(F){this.setTarget(F)}get targetHost(){return this._targetHost}set targetHost(F){F&&this.setTarget(F)}getTarget(){return this.target}get position(){return this._position}set position(F){this.setPosition(F)}set upVector(F){this._upToYMatrix||(this._yToUpMatrix=new H.Matrix,this._upToYMatrix=new H.Matrix,this._upVector=H.tP.Zero()),F.normalize(),this._upVector.q(F),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){H.Matrix.RotationAlignToRef(H.tP.UpReadOnly,this._upVector,this._yToUpMatrix),H.Matrix.RotationAlignToRef(this._upVector,H.tP.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const F=this.inputs.attached.pointers;return F?F.angularSensibilityX:0}set angularSensibilityX(F){const P=this.inputs.attached.pointers;P&&(P.angularSensibilityX=F)}get angularSensibilityY(){const F=this.inputs.attached.pointers;return F?F.angularSensibilityY:0}set angularSensibilityY(F){const P=this.inputs.attached.pointers;P&&(P.angularSensibilityY=F)}get pinchPrecision(){const F=this.inputs.attached.pointers;return F?F.pinchPrecision:0}set pinchPrecision(F){const P=this.inputs.attached.pointers;P&&(P.pinchPrecision=F)}get pinchDeltaPercentage(){const F=this.inputs.attached.pointers;return F?F.pinchDeltaPercentage:0}set pinchDeltaPercentage(F){const P=this.inputs.attached.pointers;P&&(P.pinchDeltaPercentage=F)}get useNaturalPinchZoom(){const F=this.inputs.attached.pointers;return!!F&&F.useNaturalPinchZoom}set useNaturalPinchZoom(F){const P=this.inputs.attached.pointers;P&&(P.useNaturalPinchZoom=F)}get panningSensibility(){const F=this.inputs.attached.pointers;return F?F.panningSensibility:0}set panningSensibility(F){const P=this.inputs.attached.pointers;P&&(P.panningSensibility=F)}get keysUp(){const F=this.inputs.attached.keyboard;return F?F.keysUp:[]}set keysUp(F){const P=this.inputs.attached.keyboard;P&&(P.keysUp=F)}get keysDown(){const F=this.inputs.attached.keyboard;return F?F.keysDown:[]}set keysDown(F){const P=this.inputs.attached.keyboard;P&&(P.keysDown=F)}get keysLeft(){const F=this.inputs.attached.keyboard;return F?F.keysLeft:[]}set keysLeft(F){const P=this.inputs.attached.keyboard;P&&(P.keysLeft=F)}get keysRight(){const F=this.inputs.attached.keyboard;return F?F.keysRight:[]}set keysRight(F){const P=this.inputs.attached.keyboard;P&&(P.keysRight=F)}get wheelPrecision(){const F=this.inputs.attached.mousewheel;return F?F.wheelPrecision:0}set wheelPrecision(F){const P=this.inputs.attached.mousewheel;P&&(P.wheelPrecision=F)}get zoomToMouseLocation(){const F=this.inputs.attached.mousewheel;return!!F&&F.zoomToMouseLocation}set zoomToMouseLocation(F){const P=this.inputs.attached.mousewheel;P&&(P.zoomToMouseLocation=F)}get wheelDeltaPercentage(){const F=this.inputs.attached.mousewheel;return F?F.wheelDeltaPercentage:0}set wheelDeltaPercentage(F){const P=this.inputs.attached.mousewheel;P&&(P.wheelDeltaPercentage=F)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(F){F!==this.useBouncingBehavior&&(F?(this._bouncingBehavior=new L,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(F){F!==this.useFramingBehavior&&(F?(this._framingBehavior=new J,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(F){F!==this.useAutoRotationBehavior&&(F?(this._autoRotationBehavior=new Y,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(F,P,f,c,N,A){var o;let j=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(F,H.tP.Zero(),A,j),o=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=H.tP.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=H.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new H.Matrix,this.panningAxis=new H.tP(1,1,0),this._transformedDirection=new H.tP,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new q.d,this.checkCollisions=!1,this.collisionRadius=new H.tP(.5,.5,.5),this._previousPosition=H.tP.Zero(),this._collisionVelocity=H.tP.Zero(),this._newPosition=H.tP.Zero(),this._computationVector=H.tP.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new H.tP(NaN,NaN,NaN),this._goalTargetScreenOffset=new H.Vector2(NaN,NaN),this._onCollisionPositionChange=function(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f?(o.setPosition(P),o.pY&&o.pY(f)):o._previousPosition.q(o._position);const c=Math.cos(o.alpha),N=Math.sin(o.alpha),q=Math.cos(o.beta);let H=Math.sin(o.beta);0===H&&(H=1e-4);const A=o._getTargetPosition();o._computationVector.fc(o.radius*c*H,o.radius*q,o.radius*N*H),A.addToRef(o._computationVector,o._newPosition),o._position.q(o._newPosition);let j=o.upVector;o.allowUpsideDown&&o.beta<0&&(j=j.clone(),j=j.negate()),o._computeViewMatrix(o._position,A,j),o._viewMatrix.addAtIndex(12,o.targetScreenOffset.x),o._viewMatrix.addAtIndex(13,o.targetScreenOffset.y),o._collisionTriggered=!1},this._target=H.tP.Zero(),N&&this.setTarget(N),this.alpha=P,this.beta=f,this.radius=c,this.getViewMatrix(),this.inputs=new x(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new H.tP(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=H.Vector2.Zero()}_updateCache(F){F||super._updateCache(),this._cache._target.q(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.q(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const F=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?F.addToRef(this._targetBoundingCenter,this._target):this._target.q(F)}const F=this._getLockedTargetPosition();return F||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>T.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,q=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=q?this._currentInterpolationFactor=q:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=I(F,this._goalAlpha),this._goalBeta=I(P,this._goalBeta),this._goalRadius=I(f,this._goalRadius),this._goalTarget.set(I(c.x,this._goalTarget.x),I(c.y,this._goalTarget.y),I(c.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(I(N.x,this._goalTargetScreenOffset.x),I(N.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,A.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,A.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,A.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,A.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(F,P){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const N=arguments;P=R.Tools.BackCompatCameraNoPreventDefault(N),this._useCtrlForPanning=f,this._panningMouseButton=c,"boolean"===typeof N[0]&&(N.length>1&&(this._useCtrlForPanning=N[1]),N.length>2&&(this._panningMouseButton=N[2])),this.inputs.attachElement(P),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}FT(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let F=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){F=!0;const P=this.invertRotation?-1:1,f=this._calculateHandednessMultiplier();let c=this.inertialAlphaOffset*f;this.beta<0&&(c*=-1),this.alpha+=c*P,this.beta+=this.inertialBetaOffset*P,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<T.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<T.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*T.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){F=!0;const P=new H.tP(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),P.multiplyInPlace(this.panningAxis),H.tP.TransformNormalToRef(P,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const F=this.upVector,P=H.tP.CrossToRef(this._transformedDirection,F,this._transformedDirection);H.tP.CrossToRef(F,P,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);H.tP.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.q(this._transformedDirection)}else{if(this.parent){const F=H.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(F),F.transposeToRef(F),H.tP.TransformCoordinatesToRef(this._transformedDirection,F,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*T.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*T.e&&(this.inertialPanningY=0)}if(F)this.stopInterpolation();else if(this._isInterpolating){let F=!1;const P=this._scene.getEngine().getDeltaTime()/1e3,f=1-Math.pow(2,-P/this._currentInterpolationFactor),c=I(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const P=H.TmpVectors.tP[0].set(I(this._goalTarget.x,this._target.x),I(this._goalTarget.y,this._target.y),I(this._goalTarget.z,this._target.z));H.tP.LerpToRef(this.target,P,f,this._target),10*H.tP.Distance(this.target,P)/c<T.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.q(P),this.setTarget(this.target,!1,!0,!0)):F=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const P=H.Quaternion.RotationAlphaBetaGammaToRef(I(this._goalAlpha,this.alpha),I(this._goalBeta,this.beta),0,H.TmpVectors.Quaternion[0]),c=H.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,H.TmpVectors.Quaternion[1]),N=H.Quaternion.SlerpToRef(c,P,f,H.TmpVectors.Quaternion[2]);N.normalize();const q=N.toAlphaBetaGammaToRef(H.TmpVectors.tP[0]);if(this.alpha=q.x,this.beta=q.y,N.isApprox(P,T.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const F=P.toAlphaBetaGammaToRef(H.TmpVectors.tP[0]);this.alpha=F.x,this.beta=F.y}else F=!0}if(isNaN(this._goalRadius)||(this.radius+=(c-this.radius)*f,Math.abs(c/this.radius-1)<T.e?(this._goalRadius=NaN,this.radius=c):F=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const P=H.TmpVectors.Vector2[0].set(I(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),I(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));H.Vector2.LerpToRef(this.targetScreenOffset,P,f,this.targetScreenOffset),H.Vector2.Distance(this.targetScreenOffset,P)<T.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.q(P)):F=!0}this._isInterpolating=F}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||H.tP.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const F=this.alpha;var P,f;this.alpha=function(F){let P=Math.PI/2;return 0===F.x&&0===F.z||(P=Math.acos(F.x/Math.sqrt(Math.pow(F.x,2)+Math.pow(F.z,2)))),F.z<0&&(P=2*Math.PI-P),P}(this._computationVector),this.beta=(P=this._computationVector.y,f=this.radius,Math.acos(P/f));const c=Math.round((F-this.alpha)/(2*Math.PI));this.alpha+=2*c*Math.PI,this._checkLimits()}setPosition(F){this._position.equals(F)||(this._position.q(F),this.rebuildAnglesAndRadius())}setTarget(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(c=this.overrideCloneAlphaBetaRadius??c,F.gf)P&&F.getBoundingInfo?this._targetBoundingCenter=F.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,F.gf(),this._targetHost=F,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const P=F,c=this._getTargetPosition();if(c&&!f&&c.equals(P))return;this._targetHost=null,this._target=P,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}c||this.rebuildAnglesAndRadius()}_getViewMatrix(){const F=Math.cos(this.alpha),P=Math.sin(this.alpha),f=Math.cos(this.beta);let c=Math.sin(this.beta);0===c&&(c=1e-4),0===this.radius&&(this.radius=1e-4);const N=this._getTargetPosition();if(this._computationVector.fc(this.radius*F*c,this.radius*f,this.radius*P*c),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||H.tP.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),N.addToRef(this._computationVector,this._newPosition),this.OF().collisionsEnabled&&this.checkCollisions){const F=this.OF().collisionCoordinator;this._collider||(this._collider=F.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,F.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.q(this._newPosition);let F=this.upVector;this.allowUpsideDown&&c<0&&(F=F.negate()),this._computeViewMatrix(this._position,N,F),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.q(N),this._viewMatrix}zoomOn(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];F=F||this.OF().meshes;const f=j.d.MinMax(F);let c=this._calculateLowerRadiusFromModelBoundingSphere(f.min,f.max);if(c=Math.max(Math.min(c,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=c*this.zoomOnFactor,this.mode===B.e.ORTHOGRAPHIC_CAMERA){const F=this.OF().getEngine().getAspectRatio(this),P=c*this.zoomOnFactor/2;this.orthoLeft=-P*F,this.orthoRight=P*F,this.orthoBottom=-P,this.orthoTop=P}this.focusOn({min:f.min,max:f.max,distance:c},P)}focusOn(F){let P,f,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===F.min){const c=F||this.OF().meshes;P=j.d.MinMax(c),f=H.tP.Distance(P.min,P.max)}else{P=F,f=F.distance}this._target=j.d.Center(P),c||(this.maxZ=2*f)}createRigCamera(F,P){let f=0;switch(this.cameraRigMode){case B.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.e.RIG_MODE_VR:f=this._cameraRigParams.stereoHalfAngle*(0===P?1:-1);break;case B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:f=this._cameraRigParams.stereoHalfAngle*(0===P?-1:1)}const c=new E(F,this.alpha+f,this.beta,this.radius,this._target,this.OF());return c._cameraRigParams={},c.isRigCamera=!0,c.rigParent=this,c.upVector=this.upVector,c.mode=this.mode,c.orthoLeft=this.orthoLeft,c.orthoRight=this.orthoRight,c.orthoBottom=this.orthoBottom,c.orthoTop=this.orthoTop,c}_updateRigCameras(){const F=this._rigCameras[0],P=this._rigCameras[1];switch(F.beta=P.beta=this.beta,this.cameraRigMode){case B.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.e.RIG_MODE_VR:F.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,P.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case B.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:F.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,P.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const c=H.tP.Distance(F,P),N=this.OF().getEngine().getAspectRatio(this),q=Math.tan(this.fov/2),A=q*N,o=.5*c*f,j=o*Math.sqrt(1+1/(A*A)),i=o*Math.sqrt(1+1/(q*q));return Math.max(j,i)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,c.e)([(0,N.L)()],E.prototype,"alpha",void 0),(0,c.e)([(0,N.L)()],E.prototype,"beta",void 0),(0,c.e)([(0,N.L)()],E.prototype,"radius",void 0),(0,c.e)([(0,N.L)()],E.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,c.e)([(0,N.H)("target")],E.prototype,"_target",void 0),(0,c.e)([(0,N.u)("targetHost")],E.prototype,"_targetHost",void 0),(0,c.e)([(0,N.L)()],E.prototype,"inertialAlphaOffset",void 0),(0,c.e)([(0,N.L)()],E.prototype,"inertialBetaOffset",void 0),(0,c.e)([(0,N.L)()],E.prototype,"inertialRadiusOffset",void 0),(0,c.e)([(0,N.L)()],E.prototype,"lowerAlphaLimit",void 0),(0,c.e)([(0,N.L)()],E.prototype,"upperAlphaLimit",void 0),(0,c.e)([(0,N.L)()],E.prototype,"lowerBetaLimit",void 0),(0,c.e)([(0,N.L)()],E.prototype,"upperBetaLimit",void 0),(0,c.e)([(0,N.L)()],E.prototype,"lowerRadiusLimit",void 0),(0,c.e)([(0,N.L)()],E.prototype,"upperRadiusLimit",void 0),(0,c.e)([(0,N.L)()],E.prototype,"lowerTargetYLimit",void 0),(0,c.e)([(0,N.L)()],E.prototype,"inertialPanningX",void 0),(0,c.e)([(0,N.L)()],E.prototype,"inertialPanningY",void 0),(0,c.e)([(0,N.L)()],E.prototype,"pinchToPanMaxDistance",void 0),(0,c.e)([(0,N.L)()],E.prototype,"panningDistanceLimit",void 0),(0,c.e)([(0,N.H)()],E.prototype,"panningOriginTarget",void 0),(0,c.e)([(0,N.L)()],E.prototype,"panningInertia",void 0),(0,c.e)([(0,N.L)()],E.prototype,"zoomToMouseLocation",null),(0,c.e)([(0,N.L)()],E.prototype,"zoomOnFactor",void 0),(0,c.e)([(0,N.E)()],E.prototype,"targetScreenOffset",void 0),(0,c.e)([(0,N.L)()],E.prototype,"allowUpsideDown",void 0),(0,c.e)([(0,N.L)()],E.prototype,"useInputToRestoreState",void 0),(0,c.e)([(0,N.L)()],E.prototype,"restoreStateInterpolationFactor",void 0),(0,k.f)("BABYLON.ArcRotateCamera",E)},13174:(F,P,f)=>{"use strict";f.d(P,{e:()=>H,h:()=>A});var c=f(11474),N=f(11677),q=f(12070),H={};class A{constructor(F){this.attachedToElement=!1,this.attached={},this.camera=F,this.checkInputs=()=>{}}add(F){const P=F.getSimpleName();this.attached[P]?c.d.Warn("camera input of type "+P+" already exists on camera"):(this.attached[P]=F,F.camera=this.camera,F.checkInputs&&(this.checkInputs=this._addCheckInputs(F.checkInputs.bind(F))),this.attachedToElement&&F.attachControl(this.noPreventDefault))}remove(F){for(const P in this.attached){const f=this.attached[P];if(f===F)return f.FT(),f.camera=null,delete this.attached[P],void this.rebuildInputCheck()}}removeByType(F){for(const P in this.attached){const f=this.attached[P];f.getClassName()===F&&(f.FT(),f.camera=null,delete this.attached[P],this.rebuildInputCheck())}}_addCheckInputs(F){const P=this.checkInputs;return()=>{P(),F()}}attachInput(F){this.attachedToElement&&F.attachControl(this.noPreventDefault)}attachElement(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){F=!q.e.ForceAttachControlToAlwaysPreventDefault&&F,this.attachedToElement=!0,this.noPreventDefault=F;for(const P in this.attached)this.attached[P].attachControl(F)}}detachElement(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const P in this.attached)this.attached[P].FT(),F&&(this.attached[P].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const F in this.attached){const P=this.attached[F];P.checkInputs&&(this.checkInputs=this._addCheckInputs(P.checkInputs.bind(P)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(F){const P={};for(const f in this.attached){const F=this.attached[f],c=N.e.Serialize(F);P[F.getClassName()]=c}F.inputsmgr=P}parse(F){const P=F.inputsmgr;if(P){this.clear();for(const F in P){const f=H[F];if(f){const c=P[F],q=N.e.Parse((()=>new f),c,null);this.add(q)}}}else for(const f in this.attached){const P=H[this.attached[f].getClassName()];if(P){const c=N.e.Parse((()=>new P),F,null);this.remove(this.attached[f]),this.add(c)}}}}},13171:(F,P,f)=>{"use strict";f.d(P,{d:()=>y});var c=f(11619),N=f(11628),q=f(11639),H=f(12108),A=f(13174),o=f(11891),j=f(11462);class i{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(F){F=j.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.OF(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((P=>{const f=P.event;if(!f.metaKey)if(P.type===o.d.KEYDOWN){if(-1!==this.keysUp.indexOf(f.keyCode)||-1!==this.keysDown.indexOf(f.keyCode)||-1!==this.keysLeft.indexOf(f.keyCode)||-1!==this.keysRight.indexOf(f.keyCode)||-1!==this.keysUpward.indexOf(f.keyCode)||-1!==this.keysDownward.indexOf(f.keyCode)||-1!==this.keysRotateLeft.indexOf(f.keyCode)||-1!==this.keysRotateRight.indexOf(f.keyCode)||-1!==this.keysRotateUp.indexOf(f.keyCode)||-1!==this.keysRotateDown.indexOf(f.keyCode)){-1===this._keys.indexOf(f.keyCode)&&this._keys.push(f.keyCode),F||f.preventDefault()}}else if(-1!==this.keysUp.indexOf(f.keyCode)||-1!==this.keysDown.indexOf(f.keyCode)||-1!==this.keysLeft.indexOf(f.keyCode)||-1!==this.keysRight.indexOf(f.keyCode)||-1!==this.keysUpward.indexOf(f.keyCode)||-1!==this.keysDownward.indexOf(f.keyCode)||-1!==this.keysRotateLeft.indexOf(f.keyCode)||-1!==this.keysRotateRight.indexOf(f.keyCode)||-1!==this.keysRotateUp.indexOf(f.keyCode)||-1!==this.keysRotateDown.indexOf(f.keyCode)){const P=this._keys.indexOf(f.keyCode);P>=0&&this._keys.splice(P,1),F||f.preventDefault()}})))}FT(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const F=this.camera;for(let P=0;P<this._keys.length;P++){const f=this._keys[P],c=F._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(f)?F._localDirection.fc(-c,0,0):-1!==this.keysUp.indexOf(f)?F._localDirection.fc(0,0,c):-1!==this.keysRight.indexOf(f)?F._localDirection.fc(c,0,0):-1!==this.keysDown.indexOf(f)?F._localDirection.fc(0,0,-c):-1!==this.keysUpward.indexOf(f)?F._localDirection.fc(0,c,0):-1!==this.keysDownward.indexOf(f)?F._localDirection.fc(0,-c,0):-1!==this.keysRotateLeft.indexOf(f)?(F._localDirection.fc(0,0,0),F.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(f)?(F._localDirection.fc(0,0,0),F.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(f)?(F._localDirection.fc(0,0,0),F.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(f)&&(F._localDirection.fc(0,0,0),F.cameraRotation.x+=this._getLocalRotation()),F.OF().useRightHandedSystem&&(F._localDirection.z*=-1),F.getViewMatrix().invertToRef(F._cameraTransformMatrix),q.tP.TransformNormalToRef(F._localDirection,F._cameraTransformMatrix,F._transformedDirection),F.cameraDirection.addInPlace(F._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const F=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*F}}(0,c.e)([(0,N.L)()],i.prototype,"keysUp",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysUpward",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysDown",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysDownward",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysLeft",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysRight",void 0),(0,c.e)([(0,N.L)()],i.prototype,"rotationSpeed",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysRotateLeft",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysRotateRight",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysRotateUp",void 0),(0,c.e)([(0,N.L)()],i.prototype,"keysRotateDown",void 0),A.e.FreeCameraKeyboardMoveInput=i;var u=f(11464),T=f(11883);class Y{constructor(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=F,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new u.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(F){F=j.Tools.BackCompatCameraNoPreventDefault(arguments);const P=this.camera.getEngine(),f=P.getInputElement();this._pointerInput||(this._pointerInput=c=>{const N=c.event,q="touch"===N.pointerType;if(!this.touchEnabled&&q)return;if(c.type!==T.b.POINTERMOVE&&-1===this.buttons.indexOf(N.button))return;const H=N.target;if(c.type===T.b.POINTERDOWN){if(q&&-1!==this._activePointerId||!q&&-1!==this._currentActiveButton)return;this._activePointerId=N.pointerId;try{null===H||void 0===H||H.setPointerCapture(N.pointerId)}catch(A){}-1===this._currentActiveButton&&(this._currentActiveButton=N.button),this._previousPosition={x:N.clientX,y:N.clientY},F||(N.preventDefault(),f&&f.focus()),P.isPointerLock&&this._onMouseMove&&this._onMouseMove(c.event)}else if(c.type===T.b.POINTERUP){if(q&&this._activePointerId!==N.pointerId||!q&&this._currentActiveButton!==N.button)return;try{null===H||void 0===H||H.releasePointerCapture(N.pointerId)}catch(A){}this._currentActiveButton=-1,this._previousPosition=null,F||N.preventDefault(),this._activePointerId=-1}else if(c.type===T.b.POINTERMOVE&&(this._activePointerId===N.pointerId||!q))if(P.isPointerLock&&this._onMouseMove)this._onMouseMove(c.event);else if(this._previousPosition){const P=this.camera._calculateHandednessMultiplier(),f=(N.clientX-this._previousPosition.x)*P,c=N.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=f/this.angularSensibility,this.camera.cameraRotation.x+=c/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:f,offsetY:c}),this._previousPosition={x:N.clientX,y:N.clientY},F||N.preventDefault()}}),this._onMouseMove=f=>{if(!P.isPointerLock)return;const c=this.camera._calculateHandednessMultiplier(),N=f.movementX*c;this.camera.cameraRotation.y+=N/this.angularSensibility;const q=f.movementY;this.camera.cameraRotation.x+=q/this.angularSensibility,this._previousPosition=null,F||f.preventDefault()},this._observer=this.camera.OF()._inputManager._addCameraPointerObserver(this._pointerInput,T.b.POINTERDOWN|T.b.POINTERUP|T.b.POINTERMOVE),f&&(this._contextMenuBind=F=>this.onContextMenu(F),f.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(F){F.preventDefault()}FT(){if(this._observer){if(this.camera.OF()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const F=this.camera.getEngine().getInputElement();F&&F.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,c.e)([(0,N.L)()],Y.prototype,"buttons",void 0),(0,c.e)([(0,N.L)()],Y.prototype,"angularSensibility",void 0),A.e.FreeCameraMouseInput=Y;var t,C=f(11894);class L{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new u.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(F){F=j.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=P=>{if(P.type!==T.b.POINTERWHEEL)return;const f=P.event,c=f.deltaMode===C.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*c*f.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*c*f.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*c*f.deltaZ/this._normalize,f.preventDefault&&(F||f.preventDefault())},this._observer=this.camera.OF()._inputManager._addCameraPointerObserver(this._wheel,T.b.POINTERWHEEL)}FT(){this._observer&&(this.camera.OF()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,c.e)([(0,N.L)()],L.prototype,"wheelPrecisionX",void 0),(0,c.e)([(0,N.L)()],L.prototype,"wheelPrecisionY",void 0),(0,c.e)([(0,N.L)()],L.prototype,"wheelPrecisionZ",void 0),function(F){F[F.MoveRelative=0]="MoveRelative",F[F.RotateRelative=1]="RotateRelative",F[F.MoveScene=2]="MoveScene"}(t||(t={}));class J extends L{constructor(){super(...arguments),this._moveRelative=q.tP.Zero(),this._rotateRelative=q.tP.Zero(),this._moveScene=q.tP.Zero(),this._wheelXAction=t.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=t.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(F){null===F&&this._wheelXAction!==t.MoveRelative||(this._wheelXAction=t.MoveRelative,this._wheelXActionCoordinate=F)}get wheelXMoveRelative(){return this._wheelXAction!==t.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(F){null===F&&this._wheelYAction!==t.MoveRelative||(this._wheelYAction=t.MoveRelative,this._wheelYActionCoordinate=F)}get wheelYMoveRelative(){return this._wheelYAction!==t.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(F){null===F&&this._wheelZAction!==t.MoveRelative||(this._wheelZAction=t.MoveRelative,this._wheelZActionCoordinate=F)}get wheelZMoveRelative(){return this._wheelZAction!==t.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(F){null===F&&this._wheelXAction!==t.RotateRelative||(this._wheelXAction=t.RotateRelative,this._wheelXActionCoordinate=F)}get wheelXRotateRelative(){return this._wheelXAction!==t.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(F){null===F&&this._wheelYAction!==t.RotateRelative||(this._wheelYAction=t.RotateRelative,this._wheelYActionCoordinate=F)}get wheelYRotateRelative(){return this._wheelYAction!==t.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(F){null===F&&this._wheelZAction!==t.RotateRelative||(this._wheelZAction=t.RotateRelative,this._wheelZActionCoordinate=F)}get wheelZRotateRelative(){return this._wheelZAction!==t.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(F){null===F&&this._wheelXAction!==t.MoveScene||(this._wheelXAction=t.MoveScene,this._wheelXActionCoordinate=F)}get wheelXMoveScene(){return this._wheelXAction!==t.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(F){null===F&&this._wheelYAction!==t.MoveScene||(this._wheelYAction=t.MoveScene,this._wheelYActionCoordinate=F)}get wheelYMoveScene(){return this._wheelYAction!==t.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(F){null===F&&this._wheelZAction!==t.MoveScene||(this._wheelZAction=t.MoveScene,this._wheelZActionCoordinate=F)}get wheelZMoveScene(){return this._wheelZAction!==t.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Nc(0),this._rotateRelative.Nc(0),this._moveScene.Nc(0),this._updateCamera(),this.camera.OF().useRightHandedSystem&&(this._moveRelative.z*=-1);const F=q.Matrix.Zero();this.camera.getViewMatrix().invertToRef(F);const P=q.tP.Zero();q.tP.TransformNormalToRef(this._moveRelative,F,P),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(P),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(F,P,f){if(0===F)return;if(null===P||null===f)return;let c=null;switch(P){case t.MoveRelative:c=this._moveRelative;break;case t.RotateRelative:c=this._rotateRelative;break;case t.MoveScene:c=this._moveScene}switch(f){case 0:c.set(F,0,0);break;case 1:c.set(0,F,0);break;case 2:c.set(0,0,F)}}}(0,c.e)([(0,N.L)()],J.prototype,"wheelXMoveRelative",null),(0,c.e)([(0,N.L)()],J.prototype,"wheelYMoveRelative",null),(0,c.e)([(0,N.L)()],J.prototype,"wheelZMoveRelative",null),(0,c.e)([(0,N.L)()],J.prototype,"wheelXRotateRelative",null),(0,c.e)([(0,N.L)()],J.prototype,"wheelYRotateRelative",null),(0,c.e)([(0,N.L)()],J.prototype,"wheelZRotateRelative",null),(0,c.e)([(0,N.L)()],J.prototype,"wheelXMoveScene",null),(0,c.e)([(0,N.L)()],J.prototype,"wheelYMoveScene",null),(0,c.e)([(0,N.L)()],J.prototype,"wheelZMoveScene",null),A.e.FreeCameraMouseWheelInput=J;class B{constructor(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=F,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=j.Tools.IsSafari()}attachControl(F){F=j.Tools.BackCompatCameraNoPreventDefault(arguments);let P=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=f=>{const c=f.event,N="mouse"===c.pointerType||this._isSafari&&"undefined"===typeof c.pointerType;if(this.allowMouse||!N)if(f.type===T.b.POINTERDOWN){if(F||c.preventDefault(),this._pointerPressed.push(c.pointerId),1!==this._pointerPressed.length)return;P={x:c.clientX,y:c.clientY}}else if(f.type===T.b.POINTERUP){F||c.preventDefault();const f=this._pointerPressed.indexOf(c.pointerId);if(-1===f)return;if(this._pointerPressed.splice(f,1),0!=f)return;P=null,this._offsetX=null,this._offsetY=null}else if(f.type===T.b.POINTERMOVE){if(F||c.preventDefault(),!P)return;if(0!=this._pointerPressed.indexOf(c.pointerId))return;this._offsetX=c.clientX-P.x,this._offsetY=-(c.clientY-P.y)}}),this._observer=this.camera.OF()._inputManager._addCameraPointerObserver(this._pointerInput,T.b.POINTERDOWN|T.b.POINTERUP|T.b.POINTERMOVE),this._onLostFocus){const F=this.camera.getEngine().getInputElement();F&&F.addEventListener("blur",this._onLostFocus)}}FT(){if(this._pointerInput){if(this._observer&&(this.camera.OF()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const F=this.camera.getEngine().getInputElement();F&&F.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const F=this.camera,P=F._calculateHandednessMultiplier();F.cameraRotation.y=P*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)F.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const P=F._computeLocalCameraSpeed(),f=new q.tP(0,0,0!==this.touchMoveSensibility?P*this._offsetY/this.touchMoveSensibility:0);q.Matrix.RotationYawPitchRollToRef(F.rotation.y,F.rotation.x,0,F._cameraRotationMatrix),F.cameraDirection.addInPlace(q.tP.TransformCoordinates(f,F._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,c.e)([(0,N.L)()],B.prototype,"touchAngularSensibility",void 0),(0,c.e)([(0,N.L)()],B.prototype,"touchMoveSensibility",void 0),A.e.FreeCameraTouchInput=B;class z extends A.h{constructor(F){super(F),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new i),this}addMouse(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new Y(F),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new J,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new B),this}clear(){super.clear(),this._mouseInput=null}}var Z=f(11587),R=f(11541);class y extends H.b{get angularSensibility(){const F=this.inputs.attached.mouse;return F?F.angularSensibility:0}set angularSensibility(F){const P=this.inputs.attached.mouse;P&&(P.angularSensibility=F)}get keysUp(){const F=this.inputs.attached.keyboard;return F?F.keysUp:[]}set keysUp(F){const P=this.inputs.attached.keyboard;P&&(P.keysUp=F)}get keysUpward(){const F=this.inputs.attached.keyboard;return F?F.keysUpward:[]}set keysUpward(F){const P=this.inputs.attached.keyboard;P&&(P.keysUpward=F)}get keysDown(){const F=this.inputs.attached.keyboard;return F?F.keysDown:[]}set keysDown(F){const P=this.inputs.attached.keyboard;P&&(P.keysDown=F)}get keysDownward(){const F=this.inputs.attached.keyboard;return F?F.keysDownward:[]}set keysDownward(F){const P=this.inputs.attached.keyboard;P&&(P.keysDownward=F)}get keysLeft(){const F=this.inputs.attached.keyboard;return F?F.keysLeft:[]}set keysLeft(F){const P=this.inputs.attached.keyboard;P&&(P.keysLeft=F)}get keysRight(){const F=this.inputs.attached.keyboard;return F?F.keysRight:[]}set keysRight(F){const P=this.inputs.attached.keyboard;P&&(P.keysRight=F)}get keysRotateLeft(){const F=this.inputs.attached.keyboard;return F?F.keysRotateLeft:[]}set keysRotateLeft(F){const P=this.inputs.attached.keyboard;P&&(P.keysRotateLeft=F)}get keysRotateRight(){const F=this.inputs.attached.keyboard;return F?F.keysRotateRight:[]}set keysRotateRight(F){const P=this.inputs.attached.keyboard;P&&(P.keysRotateRight=F)}get keysRotateUp(){const F=this.inputs.attached.keyboard;return F?F.keysRotateUp:[]}set keysRotateUp(F){const P=this.inputs.attached.keyboard;P&&(P.keysRotateUp=F)}get keysRotateDown(){const F=this.inputs.attached.keyboard;return F?F.keysRotateDown:[]}set keysRotateDown(F){const P=this.inputs.attached.keyboard;P&&(P.keysRotateDown=F)}constructor(F,P,f){var c;super(F,P,f,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),c=this,this.ellipsoid=new q.tP(.5,1,.5),this.ellipsoidOffset=new q.tP(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=q.tP.Zero(),this._diffPosition=q.tP.Zero(),this._newPosition=q.tP.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c._newPosition.q(P),c._newPosition.subtractToRef(c._oldPosition,c._diffPosition),c._diffPosition.length()>R.b.CollisionsEpsilon&&(c.position.addToRef(c._diffPosition,c._deferredPositionUpdate),c._deferOnly?c._deferredUpdated=!0:c.position.q(c._deferredPositionUpdate),c.pY&&f&&c.pY(f))},this.inputs=new z(this),this.inputs.addKeyboard().addMouse()}attachControl(F,P){P=j.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(P)}FT(){this.inputs.detachElement(),this.cameraDirection=new q.tP(0,0,0),this.cameraRotation=new q.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(F){this._collisionMask=isNaN(F)?-1:F}_collideWithWorld(F){let P;P=this.parent?q.tP.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,P.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const f=this.OF().collisionCoordinator;this._collider||(this._collider=f.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let c=F;this.applyGravity&&(c=F.add(this.OF().gravity)),f.getNewPosition(this._oldPosition,c,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=q.tP.Zero(),this._transformedDirection=q.tP.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(F){this._needMoveForGravity=F}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.OF().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Lc"}}(0,c.e)([(0,N.H)()],y.prototype,"ellipsoid",void 0),(0,c.e)([(0,N.H)()],y.prototype,"ellipsoidOffset",void 0),(0,c.e)([(0,N.L)()],y.prototype,"checkCollisions",void 0),(0,c.e)([(0,N.L)()],y.prototype,"applyGravity",void 0),(0,Z.f)("BABYLON.FreeCamera",y)},13795:(F,P,f)=>{"use strict";f.d(P,{c:()=>q});var c=f(11723),N=f(13802);class q{constructor(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=f,this.zu=[],this._maxBlockCapacity=P||64,this._selectionContent=new c.c(1024),this._creationFunc=F}update(F,P,f){N.e._CreateBlocks(F,P,f,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Mi(F){for(let P=0;P<this.ei.length;P++){this.ei[P].addEntry(F)}}di(F){for(let P=0;P<this.ei.length;P++){this.ei[P].removeEntry(F)}}select(F,P){this._selectionContent.reset();for(let f=0;f<this.ei.length;f++){this.ei[f].select(F,this._selectionContent,P)}return P?this._selectionContent.concat(this.zu):this._selectionContent.concatWithNoDuplicate(this.zu),this._selectionContent}intersects(F,P,f){this._selectionContent.reset();for(let c=0;c<this.ei.length;c++){this.ei[c].intersects(F,P,this._selectionContent,f)}return f?this._selectionContent.concat(this.zu):this._selectionContent.concatWithNoDuplicate(this.zu),this._selectionContent}intersectsRay(F){this._selectionContent.reset();for(let P=0;P<this.ei.length;P++){this.ei[P].intersectsRay(F,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.zu),this._selectionContent}}q.CreationFuncForMeshes=(F,P)=>{const f=F.getBoundingInfo();!F.isBlocked&&f.boundingBox.intersectsMinMax(P.du,P.Mu)&&P.entries.push(F)},q.CreationFuncForSubMeshes=(F,P)=>{F.getBoundingInfo().boundingBox.intersectsMinMax(P.du,P.Mu)&&P.entries.push(F)}},13802:(F,P,f)=>{"use strict";f.d(P,{e:()=>q});var c=f(11639),N=f(11949);class q{constructor(F,P,f,c,N,q){this.entries=[],this.Vu=new Array,this._capacity=f,this._depth=c,this._maxDepth=N,this._creationFunc=q,this._minPoint=F,this._maxPoint=P,this.Vu.push(F.clone()),this.Vu.push(P.clone()),this.Vu.push(F.clone()),this.Vu[2].x=P.x,this.Vu.push(F.clone()),this.Vu[3].y=P.y,this.Vu.push(F.clone()),this.Vu[4].z=P.z,this.Vu.push(P.clone()),this.Vu[5].z=F.z,this.Vu.push(P.clone()),this.Vu[6].x=F.x,this.Vu.push(P.clone()),this.Vu[7].y=F.y}get pP(){return this._capacity}get du(){return this._minPoint}get Mu(){return this._maxPoint}addEntry(F){if(this.ei)for(let P=0;P<this.ei.length;P++){this.ei[P].addEntry(F)}else this._creationFunc(F,this),this.entries.length>this.pP&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(F){if(this.ei){for(let P=0;P<this.ei.length;P++){this.ei[P].removeEntry(F)}return}const P=this.entries.indexOf(F);P>-1&&this.entries.splice(P,1)}addEntries(F){for(let P=0;P<F.length;P++){const f=F[P];this.addEntry(f)}}select(F,P,f){if(N.d.IsInFrustum(this.Vu,F)){if(this.ei){for(let c=0;c<this.ei.length;c++){this.ei[c].select(F,P,f)}return}f?P.concat(this.entries):P.concatWithNoDuplicate(this.entries)}}intersects(F,P,f,c){if(N.d.IntersectsSphere(this._minPoint,this._maxPoint,F,P)){if(this.ei){for(let N=0;N<this.ei.length;N++){this.ei[N].intersects(F,P,f,c)}return}c?f.concat(this.entries):f.concatWithNoDuplicate(this.entries)}}intersectsRay(F,P){if(F.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.ei){for(let f=0;f<this.ei.length;f++){this.ei[f].intersectsRay(F,P)}return}P.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){q._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(F,P,f,N,H,A,o,j){o.ei=new Array;const i=new c.tP((P.x-F.x)/2,(P.y-F.y)/2,(P.z-F.z)/2);for(let c=0;c<2;c++)for(let P=0;P<2;P++)for(let u=0;u<2;u++){const T=F.add(i.multiplyByFloats(c,P,u)),Y=F.add(i.multiplyByFloats(c+1,P+1,u+1)),t=new q(T,Y,N,H+1,A,j);t.addEntries(f),o.ei.push(t)}}}},13804:(F,P,f)=>{"use strict";f.d(P,{b:()=>i});var c=f(11845),N=f(11639),q=f(12042),H=f(12974),A=f(11880),o=f(13795),j=f(11501);c.e.prototype.createOrUpdateSelectionOctree=function(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,f=this._getComponent(A.e.NAME_OCTREE);f||(f=new i(this),this.o(f)),this.Ju||(this.Ju=new o.c(o.c.CreationFuncForMeshes,F,P));const c=this.getWorldExtends();return this.Ju.update(c.min,c.max,this.meshes),this.Ju},Object.defineProperty(c.e.prototype,"selectionOctree",{get:function(){return this.Ju},enumerable:!0,configurable:!0}),q.b.prototype.createOrUpdateSubmeshesOctree=function(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const f=this.OF();let c=f._getComponent(A.e.NAME_OCTREE);c||(c=new i(f),f.o(c)),this._submeshesOctree||(this._submeshesOctree=new o.c(o.c.CreationFuncForSubMeshes,F,P)),this.gf(!0);const N=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(N.minimumWorld,N.maximumWorld,this.nf),this._submeshesOctree};class i{constructor(F){this.name=A.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new H.d(N.tP.Zero(),new N.tP(1,1,1)),(F=F||j.b.LastCreatedScene)&&(this.LP=F,this.LP.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.LP.getActiveSubMeshCandidates=F=>this.getActiveSubMeshCandidates(F),this.LP.getCollidingSubMeshCandidates=(F,P)=>this.getCollidingSubMeshCandidates(F,P),this.LP.getIntersectingSubMeshCandidates=(F,P)=>this.getIntersectingSubMeshCandidates(F,P))}register(){this.LP.onMeshRemovedObservable.add((F=>{const P=this.LP.selectionOctree;if(void 0!==P&&null!==P){const f=P.zu.indexOf(F);-1!==f&&P.zu.splice(f,1)}})),this.LP.onMeshImportedObservable.add((F=>{const P=this.LP.selectionOctree;void 0!==P&&null!==P&&P.Mi(F)}))}getActiveMeshCandidates(){var F;return(null===(F=this.LP.Ju)||void 0===F?void 0:F.select(this.LP.frustumPlanes))||this.LP._getDefaultMeshCandidates()}getActiveSubMeshCandidates(F){if(F._submeshesOctree&&F.useOctreeForRenderingSelection){return F._submeshesOctree.select(this.LP.frustumPlanes)}return this.LP._getDefaultSubMeshCandidates(F)}getIntersectingSubMeshCandidates(F,P){if(F._submeshesOctree&&F.useOctreeForPicking){H.d.TransformToRef(P,F.getWorldMatrix(),this._tempRay);return F._submeshesOctree.intersectsRay(this._tempRay)}return this.LP._getDefaultSubMeshCandidates(F)}getCollidingSubMeshCandidates(F,P){if(F._submeshesOctree&&F.useOctreeForCollisions){const f=P._velocityWorldLength+Math.max(P._radius.x,P._radius.y,P._radius.z);return F._submeshesOctree.intersects(P._basePointWorld,f)}return this.LP._getDefaultSubMeshCandidates(F)}rebuild(){}dispose(){}}},12974:(F,P,f)=>{"use strict";f.d(P,{d:()=>Y});var c=f(11845),N=f(12070),q=f(11648),H=f(11639),A=f(11655),o=f(11943),j=f(11877),i=f(11501),u=f(11903);const T={internalPickerForMesh:void 0};class Y{constructor(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.e;this.origin=F,this.direction=P,this.length=f,this.epsilon=c}clone(){return new Y(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const c=Y._TmpVector3[0].fc(F.x-f,F.y-f,F.z-f),N=Y._TmpVector3[1].fc(P.x+f,P.y+f,P.z+f);let q,H,A,o,j=0,i=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<c.x||this.origin.x>N.x)return!1}else if(q=1/this.direction.x,H=(c.x-this.origin.x)*q,A=(N.x-this.origin.x)*q,A===-1/0&&(A=1/0),H>A&&(o=H,H=A,A=o),j=Math.max(H,j),i=Math.min(A,i),j>i)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<c.y||this.origin.y>N.y)return!1}else if(q=1/this.direction.y,H=(c.y-this.origin.y)*q,A=(N.y-this.origin.y)*q,A===-1/0&&(A=1/0),H>A&&(o=H,H=A,A=o),j=Math.max(H,j),i=Math.min(A,i),j>i)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<c.z||this.origin.z>N.z)return!1}else if(q=1/this.direction.z,H=(c.z-this.origin.z)*q,A=(N.z-this.origin.z)*q,A===-1/0&&(A=1/0),H>A&&(o=H,H=A,A=o),j=Math.max(H,j),i=Math.min(A,i),j>i)return!1;return!0}intersectsBox(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(F.minimum,F.maximum,P)}intersectsSphere(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const f=F.center.x-this.origin.x,c=F.center.y-this.origin.y,N=F.center.z-this.origin.z,q=f*f+c*c+N*N,H=F.radius+P,A=H*H;if(q<=A)return!0;const o=f*this.direction.x+c*this.direction.y+N*this.direction.z;if(o<0)return!1;return q-o*o<=A}intersectsTriangle(F,P,f){const c=Y._TmpVector3[0],N=Y._TmpVector3[1],q=Y._TmpVector3[2],A=Y._TmpVector3[3],j=Y._TmpVector3[4];P.subtractToRef(F,c),f.subtractToRef(F,N),H.tP.CrossToRef(this.direction,N,q);const i=H.tP.Dot(c,q);if(0===i)return null;const u=1/i;this.origin.subtractToRef(F,A);const T=H.tP.Dot(A,q)*u;if(T<-this.epsilon||T>1+this.epsilon)return null;H.tP.CrossToRef(A,c,j);const t=H.tP.Dot(this.direction,j)*u;if(t<-this.epsilon||T+t>1+this.epsilon)return null;const C=H.tP.Dot(N,j)*u;return C>this.length?null:new o.d(1-T-t,T,C)}intersectsPlane(F){let P;const f=H.tP.Dot(F.normal,this.direction);if(Math.abs(f)<9.99999997475243e-7)return null;{const c=H.tP.Dot(F.normal,this.origin);return P=(-F.d-c)/f,P<0?P<-9.99999997475243e-7?null:0:P}}intersectsAxis(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(F){case"y":{const F=(this.origin.y-P)/this.direction.y;return F>0?null:new H.tP(this.origin.x+this.direction.x*-F,P,this.origin.z+this.direction.z*-F)}case"x":{const F=(this.origin.x-P)/this.direction.x;return F>0?null:new H.tP(P,this.origin.y+this.direction.y*-F,this.origin.z+this.direction.z*-F)}case"z":{const F=(this.origin.z-P)/this.direction.z;return F>0?null:new H.tP(this.origin.x+this.direction.x*-F,this.origin.y+this.direction.y*-F,P)}default:return null}}intersectsMesh(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=H.TmpVectors.Matrix[0];return F.getWorldMatrix().invertToRef(A),this._tmpRay?Y.TransformToRef(this,A,this._tmpRay):this._tmpRay=Y.Transform(this,A),F.intersects(this._tmpRay,P,f,c,N,q)}intersectsMeshes(F,P,f){f?f.length=0:f=[];for(let c=0;c<F.length;c++){const N=this.intersectsMesh(F[c],P);N.hit&&f.push(N)}return f.sort(this._comparePickingInfo),f}_comparePickingInfo(F,P){return F.distance<P.distance?-1:F.distance>P.distance?1:0}intersectionSegment(F,P,f){const c=this.origin,N=H.TmpVectors.tP[0],q=H.TmpVectors.tP[1],A=H.TmpVectors.tP[2],o=H.TmpVectors.tP[3];P.subtractToRef(F,N),this.direction.scaleToRef(Y._Rayl,A),c.addToRef(A,q),F.subtractToRef(c,o);const j=H.tP.Dot(N,N),i=H.tP.Dot(N,A),u=H.tP.Dot(A,A),T=H.tP.Dot(N,o),t=H.tP.Dot(A,o),C=j*u-i*i;let L,J,B=C,z=C;C<Y._Smallnum?(L=0,B=1,J=t,z=u):(L=i*t-u*T,J=j*t-i*T,L<0?(L=0,J=t,z=u):L>B&&(L=B,J=t+i,z=u)),J<0?(J=0,-T<0?L=0:-T>j?L=B:(L=-T,B=j)):J>z&&(J=z,-T+i<0?L=0:-T+i>j?L=B:(L=-T+i,B=j));const Z=Math.abs(L)<Y._Smallnum?0:L/B,R=Math.abs(J)<Y._Smallnum?0:J/z,y=H.TmpVectors.tP[4];A.scaleToRef(R,y);const O=H.TmpVectors.tP[5];N.scaleToRef(Z,O),O.addInPlace(o);const d=H.TmpVectors.tP[6];O.subtractToRef(y,d);return R>0&&R<=this.length&&d.lengthSquared()<f*f?O.length():-1}update(F,P,f,c,N,q,A){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){Y._RayDistant||(Y._RayDistant=Y.Zero()),Y._RayDistant.unprojectRayToRef(F,P,f,c,H.Matrix.IdentityReadOnly,q,A);const o=H.TmpVectors.Matrix[0];N.invertToRef(o),Y.TransformToRef(Y._RayDistant,o,this)}else this.unprojectRayToRef(F,P,f,c,N,q,A);return this}static Zero(){return new Y(H.tP.Zero(),H.tP.Zero())}static CreateNew(F,P,f,c,N,q,H){return Y.Zero().update(F,P,f,c,N,q,H)}static CreateNewFromTo(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.Matrix.IdentityReadOnly;const c=new Y(new H.tP(0,0,0),new H.tP(0,0,0));return Y.CreateFromToToRef(F,P,c,f)}static CreateFromToToRef(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.Matrix.IdentityReadOnly;f.origin.q(F);const N=P.subtractToRef(F,f.direction),q=Math.sqrt(N.x*N.x+N.y*N.y+N.z*N.z);return f.length=q,f.direction.normalize(),Y.TransformToRef(f,c,f)}static Transform(F,P){const f=new Y(new H.tP(0,0,0),new H.tP(0,0,0));return Y.TransformToRef(F,P,f),f}static TransformToRef(F,P,f){H.tP.TransformCoordinatesToRef(F.origin,P,f.origin),H.tP.TransformNormalToRef(F.direction,P,f.direction),f.length=F.length,f.epsilon=F.epsilon;const c=f.direction,N=c.length();if(0!==N&&1!==N){const F=1/N;c.x*=F,c.y*=F,c.z*=F,f.length*=N}return f}unprojectRayToRef(F,P,f,c,N,q,A){const o=H.TmpVectors.Matrix[0];N.multiplyToRef(q,o),o.multiplyToRef(A,o),o.invert();const j=i.b.LastCreatedEngine,u=H.TmpVectors.tP[0];u.x=F/f*2-1,u.y=-(P/c*2-1),u.z=null!==j&&void 0!==j&&j.useReverseDepthBuffer?1:null!==j&&void 0!==j&&j.isNDCHalfZRange?0:-1;const T=H.TmpVectors.tP[1].fc(u.x,u.y,1-1e-8),Y=H.TmpVectors.tP[2],t=H.TmpVectors.tP[3];H.tP._UnprojectFromInvertedMatrixToRef(u,o,Y),H.tP._UnprojectFromInvertedMatrixToRef(T,o,t),this.origin.q(Y),t.subtractToRef(Y,this.direction),this.direction.normalize()}}function t(F,P,f,c,N){let q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const H=Y.Zero();return C(F,P,f,c,H,N,q),H}function C(F,P,f,c,N,q){let A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const j=F.getEngine();if(!q&&!(q=F.activeCamera))return F;const i=q.viewport,u=j.getRenderHeight(),{x:T,y:Y,width:t,height:C}=i.toGlobal(j.getRenderWidth(),u),L=1/j.getHardwareScalingLevel();return P=P*L-T,f=f*L-(u-Y-C),N.update(P,f,t,C,c||H.Matrix.IdentityReadOnly,A?H.Matrix.IdentityReadOnly:q.getViewMatrix(),q.getProjectionMatrix(),o),F}function L(F,P,f,c,N){if(!j.d)return F;const q=F.getEngine();if(!N&&!(N=F.activeCamera))throw new Error("Active camera not set");const A=N.viewport,o=q.getRenderHeight(),{x:i,y:u,width:T,height:Y}=A.toGlobal(q.getRenderWidth(),o),t=H.Matrix.Identity(),C=1/q.getHardwareScalingLevel();return P=P*C-i,f=f*C-(o-u-Y),c.update(P,f,T,Y,t,t,N.getProjectionMatrix()),F}function J(F,P,f,c,N,q,H,A){const o=P(c,f.enableDistantPicking),j=f.intersects(o,N,H,q,c,A);return j&&j.hit?!N&&null!=F&&j.distance>=F.distance?null:j:null}function B(F,P,f,c,N,q){let A=null;const o=!!(F.activeCameras&&F.activeCameras.length>1&&F.cameraToUseForPointers!==F.activeCamera),i=F.cameraToUseForPointers||F.activeCamera,u=T.internalPickerForMesh||J;for(let j=0;j<F.meshes.length;j++){const T=F.meshes[j];if(f){if(!f(T,-1))continue}else if(!T.isEnabled()||!T.isVisible||!T.jj)continue;const Y=o&&T.isWorldMatrixCameraDependent(),t=T.gf(Y,i);if(T.hasThinInstances&&T.bj){const F=u(A,P,T,t,!0,!0,q);if(F){if(N)return F;const o=H.TmpVectors.Matrix[1],j=T.thinInstanceGetWorldMatrices();for(let F=0;F<j.length;F++){if(f&&!f(T,F))continue;j[F].multiplyToRef(t,o);const H=u(A,P,T,o,c,N,q,!0);if(H&&(A=H,A.thinInstanceIndex=F,c))return A}}}else{const F=u(A,P,T,t,c,N,q);if(F&&(A=F,c))return A}}return A||new j.d}function z(F,P,f,c){if(!j.d)return null;const N=[],q=!!(F.activeCameras&&F.activeCameras.length>1&&F.cameraToUseForPointers!==F.activeCamera),A=F.cameraToUseForPointers||F.activeCamera,o=T.internalPickerForMesh||J;for(let j=0;j<F.meshes.length;j++){const i=F.meshes[j];if(f){if(!f(i,-1))continue}else if(!i.isEnabled()||!i.isVisible||!i.jj)continue;const u=q&&i.isWorldMatrixCameraDependent(),T=i.gf(u,A);if(i.hasThinInstances&&i.bj){if(o(null,P,i,T,!0,!0,c)){const F=H.TmpVectors.Matrix[1],q=i.thinInstanceGetWorldMatrices();for(let H=0;H<q.length;H++){if(f&&!f(i,H))continue;q[H].multiplyToRef(T,F);const A=o(null,P,i,F,!1,!1,c,!0);A&&(A.thinInstanceIndex=H,N.push(A))}}}else{const F=o(null,P,i,T,!1,!1,c);F&&N.push(F)}}return N}function Z(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,c=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;c||(c=F.getWorldMatrix()),P.length=f,N?P.origin.q(N):P.origin.q(F.position);const q=H.TmpVectors.tP[2];q.set(0,0,F._scene.useRightHandedSystem?-1:1);const A=H.TmpVectors.tP[3];return H.tP.TransformNormalToRef(q,c,A),H.tP.NormalizeToRef(A,P.direction),P}var R,y;Y._TmpVector3=(0,A.e)(6,H.tP.Zero),Y._RayDistant=Y.Zero(),Y._Smallnum=1e-8,Y._Rayl=1e9,R=c.e,(y=N.e)&&(y.prototype.getForwardRay=function(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,P=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;return Z(this,new Y(H.tP.Zero(),H.tP.Zero(),F),F,P,f)},y.prototype.getForwardRayToRef=function(F){return Z(this,F,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),R&&(u.d._IsPickingAvailable=!0,R.prototype.createPickingRay=function(F,P,f,c){return t(this,F,P,f,c,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),c.e.prototype.createPickingRayToRef=function(F,P,f,c,N){return C(this,F,P,f,c,N,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},c.e.prototype.createPickingRayInCameraSpace=function(F,P,f){return function(F,P,f,c){const N=Y.Zero();return L(F,P,f,N,c),N}(this,F,P,f)},c.e.prototype.createPickingRayInCameraSpaceToRef=function(F,P,f,c){return L(this,F,P,f,c)},c.e.prototype.pickWithBoundingInfo=function(F,P,f,c,N){return function(F,P,f,c,N,q){if(!j.d)return null;const A=B(F,(c=>(F._tempPickingRay||(F._tempPickingRay=Y.Zero()),C(F,P,f,c,F._tempPickingRay,q||null),F._tempPickingRay)),c,N,!0);return A&&(A.ray=t(F,P,f,H.Matrix.Identity(),q||null)),A}(this,F,P,f,c,N)},c.e.prototype.zf=function(F,P,f,c,N,q){return function(F,P,f,c,N,q,A){const o=B(F,((c,N)=>(F._tempPickingRay||(F._tempPickingRay=Y.Zero()),C(F,P,f,c,F._tempPickingRay,q||null,!1,N),F._tempPickingRay)),c,N,!1,A);return o&&(o.ray=t(F,P,f,H.Matrix.Identity(),q||null)),o}(this,F,P,f,c,N,q)},c.e.prototype.pickWithRay=function(F,P,f,c){return function(F,P,f,c,N){const q=B(F,(f=>(F._pickWithRayInverseMatrix||(F._pickWithRayInverseMatrix=H.Matrix.Identity()),f.invertToRef(F._pickWithRayInverseMatrix),F._cachedRayForTransform||(F._cachedRayForTransform=Y.Zero()),Y.TransformToRef(P,F._pickWithRayInverseMatrix,F._cachedRayForTransform),F._cachedRayForTransform)),f,c,!1,N);return q&&(q.ray=P),q}(this,F,P,f,c)},c.e.prototype.multiPick=function(F,P,f,c,N){return function(F,P,f,c,N,q){return z(F,(c=>t(F,P,f,c,N||null)),c,q)}(this,F,P,f,c,N)},c.e.prototype.multiPickWithRay=function(F,P,f){return function(F,P,f,c){return z(F,(f=>(F._pickWithRayInverseMatrix||(F._pickWithRayInverseMatrix=H.Matrix.Identity()),f.invertToRef(F._pickWithRayInverseMatrix),F._cachedRayForTransform||(F._cachedRayForTransform=Y.Zero()),Y.TransformToRef(P,F._pickWithRayInverseMatrix,F._cachedRayForTransform),F._cachedRayForTransform)),f,c)}(this,F,P,f)}},13227:(F,P,f)=>{"use strict";var c=f(11567),N=f(11474),q=f(11510),H=f(11596),A=f(11541),o=f(11580);A.b.prototype._partialLoadFile=function(F,P,f,c){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(F,(F=>{f[P]=F,f._internalCount++,6===f._internalCount&&c(f)}),void 0,void 0,!0,((F,P)=>{N&&F&&N(F.status+" "+F.statusText,P)}))},A.b.prototype._cascadeLoadFiles=function(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=[];N._internalCount=0;for(let q=0;q<6;q++)this._partialLoadFile(f[q],q,N,P,c)},A.b.prototype._cascadeLoadImgs=function(F,P,f,c){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5?arguments[5]:void 0;const H=[];H._internalCount=0;for(let A=0;A<6;A++)this._partialLoadImg(c[A],A,H,F,P,f,N,q)},A.b.prototype._partialLoadImg=function(F,P,f,c,N,A){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7?arguments[7]:void 0;const i=(0,H.e)();(0,q.r)(F,(F=>{f[P]=F,f._internalCount++,c&&c.removePendingData(i),6===f._internalCount&&A&&A(N,f)}),((F,P)=>{c&&c.removePendingData(i),o&&o(F,P)}),c?c.offlineProvider:null,j),c&&c.addPendingData(i)},A.b.prototype.createCubeTextureBase=function(F,P,f,q){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],T=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,C=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,L=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,J=arguments.length>14&&void 0!==arguments[14]&&arguments[14],B=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const z=t||new c.b(this,7);z.isCube=!0,z.url=F,z.generateMipMaps=!q,z._lodGenerationScale=T,z._lodGenerationOffset=Y,z._useSRGBBuffer=!!J&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!q),z!==t&&(z.label=F.substring(0,60)),this._doNotHandleContextLost||(z._extension=i,z._files=f,z._buffer=B);const Z=F;this._transformTextureUrl&&!t&&(F=this._transformTextureUrl(F));const R=i??function(F){const P=F.split("?")[0],f=P.lastIndexOf(".");return f>-1?P.substring(f).toLowerCase():""}(F),y=(0,o.e)(R),O=(F,P)=>{z.dispose(),A?A(F,P):F&&N.d.Warn(F)},d=(c,A)=>{F===Z?c&&O(c.status+" "+c.statusText,A):(N.d.Warn(`Failed to load ${F}, falling back to the ${Z}`),this.createCubeTextureBase(Z,P,f,!!q,H,O,j,i,u,T,Y,z,C,L,J,B))};if(y)y.then((c=>{const N=F=>{C&&C(z,F),c.loadCubeData(F,z,u,H,((F,P)=>{O(F,P)}))};B?N(B):f&&6===f.length?c.supportCascades?this._cascadeLoadFiles(P,(F=>N(F.map((F=>new Uint8Array(F))))),f,O):O("Textures type does not support cascades."):this._loadFile(F,(F=>N(new Uint8Array(F))),void 0,void 0,!0,d)}));else{if(!f||0===f.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(P,z,((F,P)=>{L&&L(F,P)}),f,O)}return this._internalTexturesCache.push(z),z}},13807:(F,P,f)=>{"use strict";f(11474);var c=f(11743);f(11567),f(11710),f(11563),f(11786),f(11758);c.d},13258:(F,P,f)=>{"use strict";f.d(P,{b:()=>N});var c=f(11587);class N{constructor(F){this.value=this._toInt(F)}_toInt(F){return 0|F}add(F){return new N(this.value+F.value)}CP(F){return new N(this.value-F.value)}multiply(F){return new N(Math.imul(this.value,F.value))}divide(F){return new N(this.value/F.value)}getClassName(){return N.ClassName}equals(F){return this.value===F.value}static FromValue(F){return new N(F)}toString(){return this.value.toString()}}N.ClassName="FlowGraphInteger",(0,c.f)("FlowGraphInteger",N)},13269:(F,P,f)=>{"use strict";f.d(P,{e:()=>N,g:()=>q});var c=f(11639);class N{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Qf=F}get m(){return this.Qf}transformVector(F){return this.transformVectorToRef(F,new c.Vector2)}transformVectorToRef(F,P){return P.x=F.x*this.Qf[0]+F.y*this.Qf[1],P.y=F.x*this.Qf[2]+F.y*this.Qf[3],P}pf(){return this.toArray()}toArray(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let P=0;P<4;P++)F[P]=this.Qf[P];return F}Zf(F){for(let P=0;P<4;P++)this.Qf[P]=F[P];return this}multiplyToRef(F,P){const f=F.Qf,c=this.Qf,N=P.Qf;return N[0]=f[0]*c[0]+f[1]*c[2],N[1]=f[0]*c[1]+f[1]*c[3],N[2]=f[2]*c[0]+f[3]*c[2],N[3]=f[2]*c[1]+f[3]*c[3],P}multiply(F){return this.multiplyToRef(F,new N)}divideToRef(F,P){const f=this.Qf,c=F.Qf,N=P.Qf;return N[0]=f[0]/c[0],N[1]=f[1]/c[1],N[2]=f[2]/c[2],N[3]=f[3]/c[3],P}divide(F){return this.divideToRef(F,new N)}addToRef(F,P){const f=this.Qf,c=F.m,N=P.m;return N[0]=f[0]+c[0],N[1]=f[1]+c[1],N[2]=f[2]+c[2],N[3]=f[3]+c[3],P}add(F){return this.addToRef(F,new N)}subtractToRef(F,P){const f=this.Qf,c=F.m,N=P.m;return N[0]=f[0]-c[0],N[1]=f[1]-c[1],N[2]=f[2]-c[2],N[3]=f[3]-c[3],P}CP(F){return this.subtractToRef(F,new N)}transpose(){const F=this.Qf;return new N([F[0],F[2],F[1],F[3]])}determinant(){const F=this.Qf;return F[0]*F[3]-F[1]*F[2]}inverse(){const F=this.determinant();if(0===F)throw new Error("Matrix is not invertible");const P=this.Qf,f=1/F;return new N([P[3]*f,-P[1]*f,-P[2]*f,P[0]*f])}equals(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const f=this.Qf,c=F.m;return 0===P?f[0]===c[0]&&f[1]===c[1]&&f[2]===c[2]&&f[3]===c[3]:Math.abs(f[0]-c[0])<P&&Math.abs(f[1]-c[1])<P&&Math.abs(f[2]-c[2])<P&&Math.abs(f[3]-c[3])<P}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Qf.join(", ")})`}}class q{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Qf=F}get m(){return this.Qf}transformVector(F){return this.transformVectorToRef(F,new c.tP)}transformVectorToRef(F,P){const f=this.Qf;return P.x=F.x*f[0]+F.y*f[1]+F.z*f[2],P.y=F.x*f[3]+F.y*f[4]+F.z*f[5],P.z=F.x*f[6]+F.y*f[7]+F.z*f[8],P}multiplyToRef(F,P){const f=F.Qf,c=this.Qf,N=P.m;return N[0]=f[0]*c[0]+f[1]*c[3]+f[2]*c[6],N[1]=f[0]*c[1]+f[1]*c[4]+f[2]*c[7],N[2]=f[0]*c[2]+f[1]*c[5]+f[2]*c[8],N[3]=f[3]*c[0]+f[4]*c[3]+f[5]*c[6],N[4]=f[3]*c[1]+f[4]*c[4]+f[5]*c[7],N[5]=f[3]*c[2]+f[4]*c[5]+f[5]*c[8],N[6]=f[6]*c[0]+f[7]*c[3]+f[8]*c[6],N[7]=f[6]*c[1]+f[7]*c[4]+f[8]*c[7],N[8]=f[6]*c[2]+f[7]*c[5]+f[8]*c[8],P}multiply(F){return this.multiplyToRef(F,new q)}divideToRef(F,P){const f=this.Qf,c=F.m,N=P.m;return N[0]=f[0]/c[0],N[1]=f[1]/c[1],N[2]=f[2]/c[2],N[3]=f[3]/c[3],N[4]=f[4]/c[4],N[5]=f[5]/c[5],N[6]=f[6]/c[6],N[7]=f[7]/c[7],N[8]=f[8]/c[8],P}divide(F){return this.divideToRef(F,new q)}addToRef(F,P){const f=this.Qf,c=F.m,N=P.m;return N[0]=f[0]+c[0],N[1]=f[1]+c[1],N[2]=f[2]+c[2],N[3]=f[3]+c[3],N[4]=f[4]+c[4],N[5]=f[5]+c[5],N[6]=f[6]+c[6],N[7]=f[7]+c[7],N[8]=f[8]+c[8],P}add(F){return this.addToRef(F,new q)}subtractToRef(F,P){const f=this.Qf,c=F.m,N=P.m;return N[0]=f[0]-c[0],N[1]=f[1]-c[1],N[2]=f[2]-c[2],N[3]=f[3]-c[3],N[4]=f[4]-c[4],N[5]=f[5]-c[5],N[6]=f[6]-c[6],N[7]=f[7]-c[7],N[8]=f[8]-c[8],P}CP(F){return this.subtractToRef(F,new q)}toArray(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let P=0;P<9;P++)F[P]=this.Qf[P];return F}pf(){return this.toArray()}Zf(F){for(let P=0;P<9;P++)this.Qf[P]=F[P];return this}transpose(){const F=this.Qf;return new q([F[0],F[3],F[6],F[1],F[4],F[7],F[2],F[5],F[8]])}determinant(){const F=this.Qf;return F[0]*(F[4]*F[8]-F[5]*F[7])-F[1]*(F[3]*F[8]-F[5]*F[6])+F[2]*(F[3]*F[7]-F[4]*F[6])}inverse(){const F=this.determinant();if(0===F)throw new Error("Matrix is not invertible");const P=this.Qf,f=1/F;return new q([(P[4]*P[8]-P[5]*P[7])*f,(P[2]*P[7]-P[1]*P[8])*f,(P[1]*P[5]-P[2]*P[4])*f,(P[5]*P[6]-P[3]*P[8])*f,(P[0]*P[8]-P[2]*P[6])*f,(P[2]*P[3]-P[0]*P[5])*f,(P[3]*P[7]-P[4]*P[6])*f,(P[1]*P[6]-P[0]*P[7])*f,(P[0]*P[4]-P[1]*P[3])*f])}equals(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const f=this.Qf,c=F.m;return 0===P?f[0]===c[0]&&f[1]===c[1]&&f[2]===c[2]&&f[3]===c[3]&&f[4]===c[4]&&f[5]===c[5]&&f[6]===c[6]&&f[7]===c[7]&&f[8]===c[8]:Math.abs(f[0]-c[0])<P&&Math.abs(f[1]-c[1])<P&&Math.abs(f[2]-c[2])<P&&Math.abs(f[3]-c[3])<P&&Math.abs(f[4]-c[4])<P&&Math.abs(f[5]-c[5])<P&&Math.abs(f[6]-c[6])<P&&Math.abs(f[7]-c[7])<P&&Math.abs(f[8]-c[8])<P}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Qf.join(", ")})`}}},13277:(F,P,f)=>{"use strict";var c;function N(F,P,f,c){switch(P){case"Animation":return c?F.animations.find((F=>F.uniqueId===f))??null:F.animations[f]??null;case"AnimationGroup":return c?F.animationGroups.find((F=>F.uniqueId===f))??null:F.animationGroups[f]??null;case"Mesh":return c?F.meshes.find((F=>F.uniqueId===f))??null:F.meshes[f]??null;case"Material":return c?F.materials.find((F=>F.uniqueId===f))??null:F.materials[f]??null;case"ri":return c?F.cameras.find((F=>F.uniqueId===f))??null:F.cameras[f]??null;case"Light":return c?F.lights.find((F=>F.uniqueId===f))??null:F.lights[f]??null;default:return null}}f.d(P,{e:()=>N}),function(F){F.Animation="Animation",F.AnimationGroup="AnimationGroup",F.Mesh="Mesh",F.Material="Material",F.ri="ri",F.Light="Light"}(c||(c={}))},13307:(F,P,f)=>{"use strict";f.d(P,{c:()=>N});var c=f(13312);class N extends c.d{constructor(F,P){if(super(F),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),P)for(const f of P)this._eventsSignalOutputs[f]=this._registerSignalOutput(f+"Event")}_executeOnTick(F){}_startPendingTasks(F){F._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(F),this._resetAfterCanceled(F)),this._preparePendingTasks(F),F._addPendingBlock(this),this.out._activateSignal(F),F._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(F){F._deleteExecutionVariable(this,"_initialized"),F._removePendingBlock(this)}}},13287:(F,P,f)=>{"use strict";f.d(P,{c:()=>j});var c=f(11596),N=f(11587),q=f(13291),H=f(11464),A=f(13249);class o extends q.c{constructor(F,P,f,c){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c.defaultValue,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(F,P,f),this.richType=c,this._defaultValue=N,this._optional=q,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new H.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(F){this._isDisabled!==F&&(this._isDisabled=F,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(F,P){P._getConnectionValue(this)!==F&&(P._setConnectionValue(this,F),this.onValueChangedObservable.notifyObservers(F))}resetToDefaultValue(F){F._setConnectionValue(this,this._defaultValue)}connectTo(F){this._isDisabled||super.connectTo(F)}_getValueOrDefault(F){const P=F._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(P):P}getValue(F){if(1===this.connectionType){F._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(F);const P=this._getValueOrDefault(F);return this._lastValue=P,this.richType.typeTransformer?this.richType.typeTransformer(P):P}const P=this.isConnected()?this._connectedPoint[0].getValue(F):this._getValueOrDefault(F);return this._lastValue=P,this.richType.typeTransformer?this.richType.typeTransformer(P):P}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(F),F.richType={},this.richType.serialize(F.richType),F.optional=this._optional,(0,A.e)("defaultValue",this._defaultValue,F)}}(0,N.f)("FlowGraphDataConnection",o);class j{constructor(F){var P;this.config=F,this.uniqueId=(0,c.e)(),this.name=(null===(P=this.config)||void 0===P?void 0:P.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(F){}registerDataInput(F,P,f){const c=new o(F,0,this,P,f);return this.dataInputs.push(c),c}registerDataOutput(F,P,f){const c=new o(F,1,this,P,f);return this.dataOutputs.push(c),c}getDataInput(F){return this.dataInputs.find((P=>P.name===F))}getDataOutput(F){return this.dataOutputs.find((P=>P.name===F))}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.e;if(F.uniqueId=this.uniqueId,F.config={},this.config){const f=this.config,c=Object.keys(f);for(const N of c)P(N,f[N],F.config)}F.dataInputs=[],F.dataOutputs=[],F.className=this.getClassName();for(const f of this.dataInputs){const P={};f.serialize(P),F.dataInputs.push(P)}for(const f of this.dataOutputs){const P={};f.serialize(P),F.dataOutputs.push(P)}}deserialize(F){}_log(F,P,f){var c;null===(c=F.logger)||void 0===c||c.addLogItem({action:P,Rf:f,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13291:(F,P,f)=>{"use strict";f.d(P,{c:()=>q});var c,N=f(11596);!function(F){F[F.Input=0]="Input",F[F.Output=1]="Output"}(c||(c={}));class q{constructor(F,P,f){this._ownerBlock=f,this._connectedPoint=[],this.uniqueId=(0,N.e)(),this.connectedPointIds=[],this.name=F,this._connectionType=P}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(F){if(this._connectionType===F._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||F._isSingularConnection()&&F._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(F),F._connectedPoint.push(this)}disconnectFrom(F){let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=this._connectedPoint.indexOf(F),c=F._connectedPoint.indexOf(this);-1!==f&&-1!==c&&(P&&this._connectedPoint.splice(f,1),F._connectedPoint.splice(c,1))}disconnectFromAll(){for(const F of this._connectedPoint)this.disconnectFrom(F,!1);this._connectedPoint.length=0}dispose(){for(const F of this._connectedPoint)this.disconnectFrom(F)}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};F.uniqueId=this.uniqueId,F.name=this.name,F._connectionType=this._connectionType,F.connectedPointIds=[],F.className=this.getClassName();for(const P of this._connectedPoint)F.connectedPointIds.push(P.uniqueId)}getClassName(){return"FGConnection"}deserialize(F){this.uniqueId=F.uniqueId,this.name=F.name,this._connectionType=F._connectionType,this.connectedPointIds=F.connectedPointIds}}},13241:(F,P,f)=>{"use strict";f.d(P,{c:()=>z});var c,N=f(11464),q=f(11619),H=f(11628),A=f(11596),o=f(13249),j=f(13277),i=f(11474);!function(F){F.ExecuteBlock="ExecuteBlock",F.ExecuteEvent="ExecuteEvent",F.TriggerConnection="TriggerConnection",F.ContextVariableSet="ContextVariableSet",F.GlobalVariableSet="GlobalVariableSet",F.GlobalVariableDelete="GlobalVariableDelete",F.GlobalVariableGet="GlobalVariableGet",F.AddConnection="AddConnection",F.GetConnectionValue="GetConnectionValue",F.SetConnectionValue="SetConnectionValue",F.ActivateSignal="ActivateSignal",F.ContextVariableGet="ContextVariableGet"}(c||(c={}));class u{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(F){if(F.time||(F.time=Date.now()),this.log.push(F),this.logToConsole){var P;const f=null===(P=F.Rf)||void 0===P?void 0:P.value;"object"===typeof f&&f.getClassName?i.d.Log(`[FGLog] ${F.className}:${F.uniqueId.split("-")[0]} ${F.action} - ${JSON.stringify(f.getClassName())}: ${f.toString()}`):i.d.Log(`[FGLog] ${F.className}:${F.uniqueId.split("-")[0]} ${F.action} - ${JSON.stringify(F.Rf)}`)}}getItemsOfType(F){return this.log.filter((P=>P.action===F))}}class T{get enableLogging(){return this._enableLogging}set enableLogging(F){this._enableLogging!==F&&(this._enableLogging=F,this._enableLogging?(this.logger=new u,this.logger.logToConsole=!0):this.logger=null)}constructor(F){this.uniqueId=(0,A.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new N.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=F,this.assetsContext=F.assetsContext??F.LP}hasVariable(F){return F in this._userVariables}setVariable(F,P){var f;this._userVariables[F]=P,null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Rf:{name:F,value:P}})}getAsset(F,P){return(0,j.e)(this.assetsContext,F,P)}getVariable(F){var P;return null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Rf:{name:F,value:this._userVariables[F]}}),this._userVariables[F]}get userVariables(){return this._userVariables}OF(){return this._configuration.LP}_getUniqueIdPrefixedName(F,P){return`${F.uniqueId}_${P}`}_getGlobalContextVariable(F,P){var f;return null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Rf:{name:F,defaultValue:P,possibleValue:this._globalContextVariables[F]}}),this._hasGlobalContextVariable(F)?this._globalContextVariables[F]:P}_setGlobalContextVariable(F,P){var f;null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Rf:{name:F,value:P}}),this._globalContextVariables[F]=P}_deleteGlobalContextVariable(F){var P;null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Rf:{name:F}}),delete this._globalContextVariables[F]}_hasGlobalContextVariable(F){return F in this._globalContextVariables}_setExecutionVariable(F,P,f){this._executionVariables[this._getUniqueIdPrefixedName(F,P)]=f}_getExecutionVariable(F,P,f){return this._hasExecutionVariable(F,P)?this._executionVariables[this._getUniqueIdPrefixedName(F,P)]:f}_deleteExecutionVariable(F,P){delete this._executionVariables[this._getUniqueIdPrefixedName(F,P)]}_hasExecutionVariable(F,P){return this._getUniqueIdPrefixedName(F,P)in this._executionVariables}_hasConnectionValue(F){return F.uniqueId in this._connectionValues}_setConnectionValue(F,P){var f;this._connectionValues[F.uniqueId]=P,null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Rf:{connectionPointId:F.uniqueId,value:P}})}_setConnectionValueByKey(F,P){this._connectionValues[F]=P}_getConnectionValue(F){var P;return null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Rf:{connectionPointId:F.uniqueId,value:this._connectionValues[F.uniqueId]}}),this._connectionValues[F.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(F){this._pendingBlocks.includes(F)||(this._pendingBlocks.push(F),this._pendingBlocks.sort(((F,P)=>F.priority-P.priority)))}_removePendingBlock(F){const P=this._pendingBlocks.indexOf(F);-1!==P&&this._pendingBlocks.splice(P,1)}_clearPendingBlocks(){for(const F of this._pendingBlocks)F._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(F){var P;this.onNodeExecutedObservable.notifyObservers(F),null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:F.getClassName(),uniqueId:F.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(F){this._setGlobalContextVariable("timeSinceStart",F.timeSinceStart),this._setGlobalContextVariable("deltaTime",F.deltaTime);for(const f of this._pendingBlocks){var P;null===(P=f._executeOnTick)||void 0===P||P.call(f,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.e;F.uniqueId=this.uniqueId,F._userVariables={};for(const c in this._userVariables)P(c,this._userVariables[c],F._userVariables);F._connectionValues={};for(const c in this._connectionValues)P(c,this._connectionValues[c],F._connectionValues);var f;this.assetsContext!==this.OF()&&(F._assetsContext={meshes:this.assetsContext.meshes.map((F=>F.id)),materials:this.assetsContext.materials.map((F=>F.id)),textures:this.assetsContext.textures.map((F=>F.name)),animations:this.assetsContext.animations.map((F=>F.name)),lights:this.assetsContext.lights.map((F=>F.id)),cameras:this.assetsContext.cameras.map((F=>F.id)),FY:null===(f=this.assetsContext.FY)||void 0===f?void 0:f.map((F=>F.name)),skeletons:this.assetsContext.skeletons.map((F=>F.id)),zT:this.assetsContext.zT.map((F=>F.name)),geometries:this.assetsContext.geometries.map((F=>F.id)),multiMaterials:this.assetsContext.multiMaterials.map((F=>F.id)),transformNodes:this.assetsContext.transformNodes.map((F=>F.id))})}getClassName(){return"FlowGraphContext"}}(0,q.e)([(0,H.L)()],T.prototype,"uniqueId",void 0);var Y=f(13280),t=f(11883);class C{constructor(F){this.onEventTriggeredObservable=new N.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=F,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Mf.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const F=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Rf:{timeSinceStart:this._startingTime,deltaTime:F}}),this._startingTime+=F})),this._meshPickedObserver=this._scene.onPointerObservable.add((F=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Rf:F})}),t.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((F=>{const P=F.pointerId,f=F.mesh,c=this._pointerUnderMeshState[P];!c&&f?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Rf:{pointerId:P,mesh:f}}):c&&!f?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Rf:{pointerId:P,mesh:c}}):c&&f&&c!==f&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Rf:{pointerId:P,mesh:c,over:f}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Rf:{pointerId:P,mesh:f,out:c}})),this._pointerUnderMeshState[P]=f}),t.b.POINTERMOVE)}dispose(){var F,P,f,c,N;null===(F=this._sceneDisposeObserver)||void 0===F||F.remove(),null===(P=this._sceneReadyObserver)||void 0===P||P.remove(),null===(f=this._sceneOnBeforeRenderObserver)||void 0===f||f.remove(),null===(c=this._meshPickedObserver)||void 0===c||c.remove(),null===(N=this._meshUnderPointerObserver)||void 0===N||N.remove(),this.onEventTriggeredObservable.clear()}}var L,J=f(13296);!function(F){F[F.Stopped=0]="Stopped",F[F.Started=1]="Started"}(L||(L={}));class B{get state(){return this._state}set state(F){this._state=F,this.onStateChangedObservable.notifyObservers(F)}constructor(F){this.onStateChangedObservable=new N.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=F.LP,this._sceneEventCoordinator=new C(this._scene),this._coordinator=F.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((F=>{for(const P of this._executionContexts){const f=this._getContextualOrder(F.type,P);for(const c of f)if(!c._executeEvent(P,F.Rf))break}switch(F.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const P of this._executionContexts)P._notifyOnTick(F.Rf);break;case"SceneDispose":this.dispose()}}))}createContext(){const F=new T({LP:this._scene,coordinator:this._coordinator});return this._executionContexts.push(F),F}getContext(F){return this._executionContexts[F]}addEventBlock(F){if("PointerOver"!==F.type&&"PointerOut"!==F.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==F.type&&this._eventBlocks[F.type].push(F),1===this.state)for(const P of this._executionContexts)F._startPendingTasks(P);else this.onStateChangedObservable.addOnce((P=>{if(1===P)for(const f of this._executionContexts)F._startPendingTasks(f)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((F=>{1===F&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const F of this._executionContexts)for(const P in this._eventBlocks){const f=this._getContextualOrder(P,F);for(const P of f)P._startPendingTasks(F)}}_getContextualOrder(F,P){const f=this._eventBlocks[F].sort(((F,P)=>P.initPriority-F.initPriority));if("MeshPick"===F){const F=[];for(const c of f){const N=c.asset.getValue(P);let q=0;for(;q<f.length;q++){const F=f[q].asset.getValue(P);if(N&&F&&(0,J.j)(N,F))break}F.splice(q,0,c)}return F}return f}dispose(){var F;if(0!==this.state){this.state=0;for(const F of this._executionContexts)F._clearPendingBlocks();this._executionContexts.length=0;for(const F in this._eventBlocks)this._eventBlocks[F].length=0;null===(F=this._eventObserver)||void 0===F||F.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(F){const P=[],f=new Set;for(const c in this._eventBlocks)for(const F of this._eventBlocks[c])P.push(F),f.add(F.uniqueId);for(;P.length>0;){const c=P.pop();F(c);for(const F of c.dataInputs)for(const c of F._connectedPoint)f.has(c._ownerBlock.uniqueId)||(P.push(c._ownerBlock),f.add(c._ownerBlock.uniqueId));if(c instanceof Y.d)for(const F of c.signalOutputs)for(const c of F._connectedPoint)f.has(c._ownerBlock.uniqueId)||(P.push(c._ownerBlock),f.add(c._ownerBlock.uniqueId))}}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},P=arguments.length>1?arguments[1]:void 0;F.allBlocks=[],this.visitAllBlocks((P=>{const f={};P.serialize(f),F.allBlocks.push(f)})),F.executionContexts=[];for(const f of this._executionContexts){const c={};f.serialize(c,P),F.executionContexts.push(c)}}}class z{constructor(F){this.config=F,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.LP.Mf.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.LP.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const F=this._executeOnNextFrame.slice(0);if(F.length)for(const P of F){this.notifyCustomEvent(P.id,P.data,!1);const F=this._executeOnNextFrame.findIndex((F=>F.uniqueId===P.uniqueId));-1!==F&&this._executeOnNextFrame.splice(F,1)}}));(z.SceneCoordinators.get(this.config.LP)??[]).push(this)}createGraph(){const F=new B({LP:this.config.LP,coordinator:this});return this._flowGraphs.push(F),F}removeGraph(F){const P=this._flowGraphs.indexOf(F);-1!==P&&(F.dispose(),this._flowGraphs.splice(P,1))}start(){for(const F of this._flowGraphs)F.start()}dispose(){var F,P;for(const N of this._flowGraphs)N.dispose();this._flowGraphs.length=0,null===(F=this._disposeObserver)||void 0===F||F.remove(),null===(P=this._onBeforeRenderObserver)||void 0===P||P.remove();const f=z.SceneCoordinators.get(this.config.LP)??[],c=f.indexOf(this);-1!==c&&f.splice(c,1)}serialize(F,P){F._flowGraphs=[];for(const f of this._flowGraphs){const c={};f.serialize(c,P),F._flowGraphs.push(c)}F.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(F){let P=this._customEventsMap.get(F);return P||(P=new N.d,this._customEventsMap.set(F,P)),P}notifyCustomEvent(F,P){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:F,data:P,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(F)){const P=this._eventExecutionCounter.get(F);if(this._eventExecutionCounter.set(F,P+1),P>=z.MaxEventTypeExecutionPerFrame)return void(P===z.MaxEventTypeExecutionPerFrame&&i.d.Warn(`FlowGraphCoordinator: Too many executions of event "${F}".`))}else this._eventExecutionCounter.set(F,1);const f=this._customEventsMap.get(F);f&&f.notifyObservers(P)}}z.MaxEventsPerType=30,z.MaxEventTypeExecutionPerFrame=30,z.SceneCoordinators=new Map},13303:(F,P,f)=>{"use strict";f.d(P,{e:()=>N});var c=f(13307);class N extends c.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(F){F._notifyExecuteNode(this),this.done._activateSignal(F)}}},13280:(F,P,f)=>{"use strict";f.d(P,{d:()=>A});var c=f(13287),N=f(13291),q=f(11587);class H extends N.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(F){super.connectTo(F),this._connectedPoint.sort(((F,P)=>P.priority-F.priority))}_activateSignal(F){var P;if(null===(P=F.logger)||void 0===P||P.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Rf:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)F._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(F,this),F._increaseExecutionId();else for(const f of this._connectedPoint)f._activateSignal(F)}}(0,q.f)("FlowGraphSignalConnection",H);class A extends c.c{constructor(F){super(F),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(F){const P=new H(F,0,this);return this.signalInputs.push(P),P}_registerSignalOutput(F){const P=new H(F,1,this);return this.signalOutputs.push(P),P}_unregisterSignalInput(F){const P=this.signalInputs.findIndex((P=>P.name===F));-1!==P&&(this.signalInputs[P].dispose(),this.signalInputs.splice(P,1))}_unregisterSignalOutput(F){const P=this.signalOutputs.findIndex((P=>P.name===F));-1!==P&&(this.signalOutputs[P].dispose(),this.signalOutputs.splice(P,1))}_reportError(F,P){this.error.Rf="string"===typeof P?new Error(P):P,this.error._activateSignal(F)}getSignalInput(F){return this.signalInputs.find((P=>P.name===F))}getSignalOutput(F){return this.signalOutputs.find((P=>P.name===F))}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(F),F.signalInputs=[],F.signalOutputs=[];for(const P of this.signalInputs){const f={};P.serialize(f),F.signalInputs.push(f)}for(const P of this.signalOutputs){const f={};P.serialize(f),F.signalOutputs.push(f)}}deserialize(F){for(let P=0;P<F.signalInputs.length;P++){const f=this.getSignalInput(F.signalInputs[P].name);if(!f)throw new Error("Could not find signal input with name "+F.signalInputs[P].name+" in block "+F.className);f.deserialize(F.signalInputs[P])}for(let P=0;P<F.signalOutputs.length;P++){const f=this.getSignalOutput(F.signalOutputs[P].name);if(!f)throw new Error("Could not find signal output with name "+F.signalOutputs[P].name+" in block "+F.className);f.deserialize(F.signalOutputs[P])}}getClassName(){return"FlowGraphExecutionBlock"}}},13312:(F,P,f)=>{"use strict";f.d(P,{d:()=>N});var c=f(13280);class N extends c.d{constructor(F){super(F),this.out=this._registerSignalOutput("out")}}},13265:(F,P,f)=>{"use strict";f.d(P,{C:()=>V,F:()=>d,G:()=>O,c:()=>j,g:()=>T,h:()=>y,j:()=>L,l:()=>J,n:()=>B,o:()=>u,p:()=>R,r:()=>i,v:()=>Y,w:()=>t,x:()=>C,y:()=>M});var c,N=f(11639),q=f(11690),H=f(13258),A=f(13269);!function(F){F.Any="any",F.String="string",F.Number="number",F.Boolean="boolean",F.Object="object",F.Integer="FlowGraphInteger",F.Vector2="Vector2",F.tP="tP",F.Vector4="Vector4",F.Quaternion="Quaternion",F.Matrix="Matrix",F.Matrix2D="Matrix2D",F.Matrix3D="Matrix3D",F.BP="BP",F.qc="qc"}(c||(c={}));class o{constructor(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=F,this.defaultValue=P,this.animationType=f}serialize(F){F.typeName=this.typeName,F.defaultValue=this.defaultValue}}const j=new o("any",void 0),i=new o("string",""),u=new o("number",0,0),T=new o("boolean",!1),Y=new o("Vector2",N.Vector2.Zero(),5),t=new o("tP",N.tP.Zero(),1),C=new o("Vector4",N.Vector4.Zero()),L=new o("Matrix",N.Matrix.Identity(),3),J=new o("Matrix2D",new A.e),B=new o("Matrix3D",new A.g),z=new o("BP",q.BP.Black(),4),Z=new o("qc",new q.qc(0,0,0,0),7),R=new o("Quaternion",N.Quaternion.Identity(),2);R.typeTransformer=F=>{if(F.getClassName){if("Vector4"===F.getClassName())return N.Quaternion.zP(F.pf());if("tP"===F.getClassName())return N.Quaternion.FromEulerVector(F);if("Matrix"===F.getClassName())return N.Quaternion.FromRotationMatrix(F)}return F};const y=new o("FlowGraphInteger",new H.b(0),0);function O(F){const P=F;switch(typeof F){case"string":return i;case"number":return u;case"boolean":return T;case"object":if(P.getClassName)switch(P.getClassName()){case"Vector2":return Y;case"tP":return t;case"Vector4":return C;case"Matrix":return L;case"BP":return z;case"qc":return Z;case"Quaternion":return R;case"FlowGraphInteger":return y;case"Matrix2D":return J;case"Matrix3D":return B}return j;default:return j}}function d(F){switch(F){case"string":return i;case"number":return u;case"boolean":return T;case"Vector2":return Y;case"tP":return t;case"Vector4":return C;case"Matrix":return L;case"BP":return z;case"qc":return Z;case"Quaternion":return R;case"FlowGraphInteger":return y;case"Matrix2D":return J;case"Matrix3D":return B;default:return j}}function M(F){switch(F){case"number":default:return 0;case"Vector2":return 5;case"tP":return 1;case"Matrix":return 3;case"BP":return 4;case"qc":return 7;case"Quaternion":return 2}}function V(F){switch(F){case 0:return u;case 5:return Y;case 1:return t;case 3:return L;case 4:return z;case 7:return Z;case 2:return R;default:return j}}},13249:(F,P,f)=>{"use strict";f.d(P,{d:()=>i,e:()=>j,i:()=>u});var c=f(11690),N=f(11639),q=f(13258),H=f(13265),A=f(13269);function o(F){return"Vector2"===F||"tP"===F||"Vector4"===F||"Quaternion"===F||"BP"===F||"qc"===F}function j(F,P,f){var c;const N=(null===P||void 0===P||null===(c=P.getClassName)||void 0===c?void 0:c.call(P))??"";if(o(N)||function(F){return"Matrix"===F||"Matrix2D"===F||"Matrix3D"===F}(N))f[F]={value:P.pf(),className:N};else if("FlowGraphInteger"===N)f[F]={value:P.value,className:N};else if(N&&(P.id||P.name))f[F]={id:P.id,name:P.name,className:N};else{if("object"===typeof P)throw new Error(`Could not serialize value ${P}`);f[F]=P}}function i(F,P,f,j){const u=P[F];let T;const Y=(null===u||void 0===u?void 0:u.type)??(null===u||void 0===u?void 0:u.className);if(function(F){return"Mesh"===F||"AbstractMesh"===F||"GroundMesh"===F||"InstanceMesh"===F||"LinesMesh"===F||"GoldbergMesh"===F||"GreasedLineMesh"===F||"TrailMesh"===F}(Y)){let F=j.meshes.filter((F=>u.id?F.id===u.id:F.name===u.name));0===F.length&&(F=j.transformNodes.filter((F=>u.id?F.id===u.id:F.name===u.name))),T=u.uniqueId?F.find((F=>F.uniqueId===u.uniqueId)):F[0]}else if(o(Y))T=function(F,P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===F)return N.Vector2.zP(P);if("tP"===F)return f&&(P[2]*=-1),N.tP.zP(P);if("Vector4"===F)return N.Vector4.zP(P);if("Quaternion"===F)return f&&(P[2]*=-1,P[3]*=-1),N.Quaternion.zP(P);if("BP"===F)return new c.BP(P[0],P[1],P[2]);if("qc"===F)return new c.qc(P[0],P[1],P[2],P[3]);throw new Error(`Unknown vector class name ${F}`)}(Y,u.value);else if(function(F){return"AnimationGroup"===F}(Y)){const F=j.animationGroups.filter((F=>F.name===u.name));T=1===F.length?F[0]:F.find((F=>F.uniqueId===u.uniqueId))}else T="Matrix"===Y?N.Matrix.zP(u.value):"Matrix2D"===Y?new A.e(u.value):"Matrix3D"===Y?new A.g(u.value):"FlowGraphInteger"===Y?q.b.FromValue(u.value):"number"===Y||"string"===Y||"boolean"===Y?u.value[0]:u&&void 0!==u.value?u.value:Array.isArray(u)?u.reduce(((F,P)=>P.eventData?(F[P.id]={type:(0,H.F)(P.type)},"undefined"!==typeof P.value&&(F[P.id].value=i("value",P,f,j)),F):F),{}):u;return T}function u(F){return"FlowGraphJsonPointerParserBlock"===F}},13296:(F,P,f)=>{"use strict";function c(F,P){return!(!F.parent||F.parent!==P&&!c(F.parent,P))}function N(F){if(F.getClassName)return F.getClassName()}function q(F,P){return F===P&&("Vector2"===F||"tP"===F||"Vector4"===F||"Quaternion"===F)}function H(F,P){return F===P&&("Matrix"===F||"Matrix2D"===F||"Matrix3D"===F)}function A(F,P){return"FlowGraphInteger"===F&&"FlowGraphInteger"===P}function o(F,P){const f="number"===typeof F||"number"===typeof(null===F||void 0===F?void 0:F.value);return f&&!P?!isNaN(j(F)):f}function j(F){return"number"===typeof F?F:F.value}f.d(P,{b:()=>A,f:()=>H,h:()=>q,i:()=>N,j:()=>c,m:()=>j,n:()=>o})},12705:(F,P,f)=>{"use strict";f.r(P),f.d(P,{SceneInstrumentation:()=>q});var c=f(11462),N=f(11833);class q{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(F){F!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=F,F?(this._onBeforeActiveMeshesEvaluationObserver=this.LP.onBeforeActiveMeshesEvaluationObservable.add((()=>{c.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.LP.onAfterActiveMeshesEvaluationObservable.add((()=>{c.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.LP.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.LP.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(F){F!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=F,F?(this._onBeforeRenderTargetsRenderObserver=this.LP.onBeforeRenderTargetsRenderObservable.add((()=>{c.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.LP.onAfterRenderTargetsRenderObservable.add((()=>{c.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.LP.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.LP.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(F){F!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=F,F?(this._onBeforeParticlesRenderingObserver=this.LP.onBeforeParticlesRenderingObservable.add((()=>{c.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.LP.onAfterParticlesRenderingObservable.add((()=>{c.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.LP.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.LP.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(F){F!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=F,this.LP.spriteManagers&&(F?(this._onBeforeSpritesRenderingObserver=this.LP.onBeforeSpritesRenderingObservable.add((()=>{c.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.LP.onAfterSpritesRenderingObservable.add((()=>{c.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.LP.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.LP.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(F){F!==this._capturePhysicsTime&&this.LP.onBeforePhysicsObservable&&(this._capturePhysicsTime=F,F?(this._onBeforePhysicsObserver=this.LP.onBeforePhysicsObservable.add((()=>{c.Tools.StartPerformanceCounter("zc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.LP.onAfterPhysicsObservable.add((()=>{c.Tools.EndPerformanceCounter("zc"),this._physicsTime.endMonitoring()}))):(this.LP.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.LP.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(F){F!==this._captureAnimationsTime&&(this._captureAnimationsTime=F,F?this._onAfterAnimationsObserver=this.LP.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.LP.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(F){this._captureFrameTime=F}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(F){this._captureInterFrameTime=F}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(F){F!==this._captureRenderTime&&(this._captureRenderTime=F,F?(this._onBeforeDrawPhaseObserver=this.LP.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),c.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.LP.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),c.Tools.EndPerformanceCounter("Main render")}))):(this.LP.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.LP.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(F){F!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=F,F?(this._onBeforeCameraRenderObserver=this.LP.onBeforeCameraRenderObservable.add((F=>{this._cameraRenderTime.beginMonitoring(),c.Tools.StartPerformanceCounter(`Rendering camera ${F.name}`)})),this._onAfterCameraRenderObserver=this.LP.onAfterCameraRenderObservable.add((F=>{this._cameraRenderTime.endMonitoring(!1),c.Tools.EndPerformanceCounter(`Rendering camera ${F.name}`)}))):(this.LP.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.LP.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.LP.getEngine()._drawCalls}constructor(F){this.LP=F,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new N.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new N.b,this._captureFrameTime=!1,this._frameTime=new N.b,this._captureRenderTime=!1,this._renderTime=new N.b,this._captureInterFrameTime=!1,this._interFrameTime=new N.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new N.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new N.b,this._capturePhysicsTime=!1,this._physicsTime=new N.b,this._captureAnimationsTime=!1,this._animationsTime=new N.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new N.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=F.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(c.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.LP.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=F.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(c.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Yf(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Yf(),this._captureParticlesRenderTime&&this._particlesRenderTime.Yf(),this._captureSpritesRenderTime&&this._spritesRenderTime.Yf(),this._captureRenderTime&&this._renderTime.Yf(),this._captureCameraRenderTime&&this._cameraRenderTime.Yf()}))}dispose(){this._disposed||(this.LP.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.LP.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.LP.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.LP.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.LP.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.LP.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.LP.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.LP.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.LP.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.LP.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.LP.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.LP.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.LP.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.LP.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.LP.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.LP.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.LP.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.LP=null,this._disposed=!0)}}},13238:(F,P,f)=>{"use strict";f.d(P,{d:()=>i});var c=f(11619),N=f(11628),q=f(11639),H=f(12033),A=f(12165),o=f(12217),j=f(11587);H.c.AddNodeConstructor("Light_Type_1",((F,P)=>()=>new i(F,q.tP.Zero(),P)));class i extends o.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(F){this._shadowFrustumSize=F,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(F){this._shadowOrthoScale=F,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(F){this._orthoLeft=F}get orthoRight(){return this._orthoRight}set orthoRight(F){this._orthoRight=F}get orthoTop(){return this._orthoTop}set orthoTop(F){this._orthoTop=F}get orthoBottom(){return this._orthoBottom}set orthoBottom(F){this._orthoBottom=F}constructor(F,P,f){super(F,f),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=P.scale(-1),this.direction=P}getClassName(){return"Zc"}getTypeID(){return A.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(F,P,f){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(F):this._setDefaultAutoExtendShadowProjectionMatrix(F,P,f)}_setDefaultFixedFrustumShadowProjectionMatrix(F){const P=this.OF().activeCamera;P&&q.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:P.Wf,void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,F,this.OF().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(F,P,f){const c=this.OF().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const F=q.tP.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let c=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let H=0;H<f.length;H++){const A=f[H];if(!A)continue;const o=A.getBoundingInfo().boundingBox;for(let f=0;f<o.vectorsWorld.length;f++)q.tP.TransformCoordinatesToRef(o.vectorsWorld[f],P,F),F.x<this._orthoLeft&&(this._orthoLeft=F.x),F.y<this._orthoBottom&&(this._orthoBottom=F.y),F.x>this._orthoRight&&(this._orthoRight=F.x),F.y>this._orthoTop&&(this._orthoTop=F.y),this.autoCalcShadowZBounds&&(F.z<c&&(c=F.z),F.z>N&&(N=F.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=c,this._shadowMaxZ=N)}const N=this._orthoRight-this._orthoLeft,H=this._orthoTop-this._orthoBottom,A=void 0!==this.shadowMinZ?this.shadowMinZ:(null===c||void 0===c?void 0:c.Wf)||0,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===c||void 0===c?void 0:c.maxZ)||1e4,j=this.OF().getEngine().useReverseDepthBuffer;q.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-N*this.shadowOrthoScale,this._orthoRight+N*this.shadowOrthoScale,this._orthoBottom-H*this.shadowOrthoScale,this._orthoTop+H*this.shadowOrthoScale,j?o:A,j?A:o,F,this.OF().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(F,P){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,P),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,P),this)}transferToNodeMaterialEffect(F,P){return this.computeTransformedInformation()?(F.setFloat3(P,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(F.setFloat3(P,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(F){const P=this._scene.getEngine();return!P.useReverseDepthBuffer&&P.isNDCHalfZRange?0:1}getDepthMaxZ(F){const P=this._scene.getEngine();return P.useReverseDepthBuffer&&P.isNDCHalfZRange?0:1}prepareLightSpecificDefines(F,P){F["DIRLIGHT"+P]=!0}}(0,c.e)([(0,N.L)()],i.prototype,"shadowFrustumSize",null),(0,c.e)([(0,N.L)()],i.prototype,"shadowOrthoScale",null),(0,c.e)([(0,N.L)()],i.prototype,"autoUpdateExtends",void 0),(0,c.e)([(0,N.L)()],i.prototype,"autoCalcShadowZBounds",void 0),(0,c.e)([(0,N.L)("orthoLeft")],i.prototype,"_orthoLeft",void 0),(0,c.e)([(0,N.L)("orthoRight")],i.prototype,"_orthoRight",void 0),(0,c.e)([(0,N.L)("orthoTop")],i.prototype,"_orthoTop",void 0),(0,c.e)([(0,N.L)("orthoBottom")],i.prototype,"_orthoBottom",void 0),(0,j.f)("BABYLON.DirectionalLight",i)},13744:(F,P,f)=>{"use strict";f.d(P,{e:()=>i});var c=f(11619),N=f(11628),q=f(11639),H=f(11690),A=f(12033),o=f(12165),j=f(11587);A.c.AddNodeConstructor("Light_Type_3",((F,P)=>()=>new i(F,q.tP.Zero(),P)));class i extends o.e{constructor(F,P,f){super(F,f),this.groundColor=new H.BP(0,0,0),this.direction=P||q.tP.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Rc"}setDirectionToTarget(F){return this.direction=q.tP.Normalize(F.CP(q.tP.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(F,P){const f=q.tP.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",f.x,f.y,f.z,0,P),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.jc),P),this}transferToNodeMaterialEffect(F,P){const f=q.tP.Normalize(this.direction);return F.setFloat3(P,f.x,f.y,f.z),this}gf(){return this._worldMatrix||(this._worldMatrix=q.Matrix.Identity()),this._worldMatrix}getTypeID(){return o.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(F,P){F["HEMILIGHT"+P]=!0}}(0,c.e)([(0,N.j)()],i.prototype,"groundColor",void 0),(0,c.e)([(0,N.H)()],i.prototype,"direction",void 0),(0,j.f)("BABYLON.HemisphericLight",i)},13201:(F,P,f)=>{"use strict";f.d(P,{b:()=>u});var c=f(11619),N=f(11628),q=f(11639),H=f(12033),A=f(12165),o=f(12217),j=f(11612),i=f(11587);H.c.AddNodeConstructor("Light_Type_2",((F,P)=>()=>new u(F,q.tP.Zero(),q.tP.Zero(),0,0,P)));class u extends o.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(F){this._iesProfileTexture!==F&&(this._iesProfileTexture=F,this._iesProfileTexture&&u._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(F){this._angle=F,this._cosHalfAngle=Math.cos(.5*F),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(F){this._innerAngle=F,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(F){this._shadowAngleScale=F,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(F){this._projectionTextureLightNear=F,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(F){this._projectionTextureLightFar=F,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(F){this._projectionTextureUpDirection=F,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(F){this._projectionTexture!==F&&(this._projectionTexture=F,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(u._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):u._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(F){return void 0!==F.onGeneratedObservable}static _IsTexture(F){return void 0!==F.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(F){this._projectionTextureProjectionLightMatrix=F,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(F,P,f,c,N,H){super(F,H),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=q.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=q.tP.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=q.tP.Zero(),this._projectionTextureViewLightMatrix=q.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=q.Matrix.Zero(),this._projectionTextureScalingMatrix=q.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=P,this.direction=f,this.angle=c,this.exponent=N}getClassName(){return"SpotLight"}getTypeID(){return A.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(F){super._setDirection(F),this._projectionTextureViewLightDirty=!0}_setPosition(F){super._setPosition(F),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(F,P,f){const c=this.OF().activeCamera;if(!c)return;this._shadowAngleScale=this._shadowAngleScale||1;const N=this._shadowAngleScale*this._angle,H=void 0!==this.shadowMinZ?this.shadowMinZ:c.Wf,A=void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,o=this.OF().getEngine().useReverseDepthBuffer;q.Matrix.PerspectiveFovLHToRef(N,1,o?A:H,o?H:A,F,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),q.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const F=this.projectionTextureLightFar,P=this.projectionTextureLightNear,f=F/(F-P),c=-f*P,N=1/Math.tan(this._angle/2);q.Matrix.FromValuesToRef(N/1,0,0,0,0,N,0,0,0,0,f,1,0,0,c,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof j.e){const F=this._projectionTexture.uScale/2,P=this._projectionTexture.vScale/2;q.Matrix.FromValuesToRef(F,0,0,0,0,P,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(F,P){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),F.setMatrix("textureProjectionMatrix"+P,this._projectionTextureMatrix),F.setTexture("projectionLightTexture"+P,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&F.setTexture("iesLightTexture"+P,this._iesProfileTexture),this}transferToEffect(F,P){let f;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,P),f=q.tP.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,P),f=q.tP.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",f.x,f.y,f.z,this._cosHalfAngle,P),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,P),this}transferToNodeMaterialEffect(F,P){let f;return f=this.computeTransformedInformation()?q.tP.Normalize(this.transformedDirection):q.tP.Normalize(this.direction),this.OF().useRightHandedSystem?F.setFloat3(P,-f.x,-f.y,-f.z):F.setFloat3(P,f.x,f.y,f.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(F){const P=this._scene.getEngine(),f=void 0!==this.shadowMinZ?this.shadowMinZ:(null===F||void 0===F?void 0:F.Wf)??0;return P.useReverseDepthBuffer&&P.isNDCHalfZRange?f:this._scene.getEngine().isNDCHalfZRange?0:f}getDepthMaxZ(F){const P=this._scene.getEngine(),f=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===F||void 0===F?void 0:F.maxZ)??1e4;return P.useReverseDepthBuffer&&P.isNDCHalfZRange?0:f}prepareLightSpecificDefines(F,P){F["SPOTLIGHT"+P]=!0,F["PROJECTEDLIGHTTEXTURE"+P]=!(!this.projectionTexture||!this.projectionTexture.isReady()),F["IESLIGHTTEXTURE"+P]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,c.e)([(0,N.L)()],u.prototype,"angle",null),(0,c.e)([(0,N.L)()],u.prototype,"innerAngle",null),(0,c.e)([(0,N.L)()],u.prototype,"shadowAngleScale",null),(0,c.e)([(0,N.L)()],u.prototype,"exponent",void 0),(0,c.e)([(0,N.L)()],u.prototype,"projectionTextureLightNear",null),(0,c.e)([(0,N.L)()],u.prototype,"projectionTextureLightFar",null),(0,c.e)([(0,N.L)()],u.prototype,"projectionTextureUpDirection",null),(0,c.e)([(0,N.B)("projectedLightTexture")],u.prototype,"_projectionTexture",void 0),(0,i.f)("BABYLON.SpotLight",u)},12963:(F,P,f)=>{"use strict";f.d(P,{c:()=>H,g:()=>q,k:()=>A});const c={},N={};function q(F,P){c[F]=P}function H(F,P){N[F]=P}function A(F){return N[F]?N[F]:null}},12872:(F,P,f)=>{"use strict";f.d(P,{c:()=>O,f:()=>n});var c,N=f(11462),q=f(11464),H=f(11845),A=f(11501),o=f(11474),j=f(12083),i=f(11510),u=f(11514),T=f(11596),Y=f(11541),t=f(11494);!function(F){F[F.Clean=0]="Clean",F[F.Stop=1]="Stop",F[F.Sync=2]="Sync",F[F.NoSync=3]="NoSync"}(c||(c={}));const C=new q.d,L={};let J=!1;function B(){return L[".babylon"]}function z(F,P){const f=L[F];return f||(o.d.Warn("Unable to find a plugin to load "+F+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),P?B():void 0)}function Z(F,P,f){let c="Unable to load from "+(F.rawData?"binary data":F.url);return P?c+=`: ${P}`:f&&(c+=`: ${f}`),c}async function R(F,P,f,c,N,q,H,A,o){var j;const u="data:"===(T=F.url).substring(0,5)?T.substring(5):null;var T;if(F.rawData&&!H)throw"When using ArrayBufferView to load data the file extension must be provided.";const J=u||H?"":function(F){const P=F.indexOf("?");-1!==P&&(F=F.substring(0,P));const f=F.lastIndexOf(".");return F.substring(f,F.length).toLowerCase()}(F.url);let Z=H?z(H,!0):u?function(F){for(const P in L){const f=L[P].plugin;if(f.canDirectLoad&&f.canDirectLoad(F))return L[P]}return B()}(F.url):z(J,!1);if(!Z&&J){if(F.url&&!F.url.startsWith("blob:")){const P=await async function(F,P){const f=P.method||"GET";return await new Promise(((c,N)=>{const q=new t.e;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const F={};if(P.responseHeaders)for(const f of P.responseHeaders)F[f]=q.getResponseHeader(f)||"";c({response:q.response,headerValues:F})}else N(`Unable to fetch data from ${F}. Error code: ${q.status}`)})),q.open(f,F),q.send()}))}(F.url,{method:"HEAD",responseHeaders:["Content-Type"]}),f=P.headerValues?P.headerValues["Content-Type"]:"";f&&(Z=function(F){for(const P in L){const f=L[P];if(f.mimeType===F)return f}}(f))}Z||(Z=B())}if(!Z)throw new Error(`No plugin or fallback for ${H??F.url}`);if(!1===(null===o||void 0===o||null===(j=o[Z.plugin.name])||void 0===j?void 0:j.enabled))throw new Error(`The '${Z.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(F.rawData&&!Z.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(F=>{if(Z.plugin.createPlugin){const P=Z.plugin.createPlugin(o??{});return P instanceof Promise?(P.then(F).catch((F=>{N("Error instantiating plugin.",F)})),null):(F(P),P)}return F(Z.plugin),Z.plugin})((o=>{var j;if(!o)throw`The loader plugin corresponding to the '${H}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(C.notifyObservers(o),u&&(o.canDirectLoad&&o.canDirectLoad(F.url)||!(0,i.i)(F.url))){if(o.directLoad){const F=o.directLoad(P,u);F instanceof Promise?F.then((F=>{f(o,F)})).catch((F=>{N("Error in directLoad of _loadData: "+F,F)})):f(o,F)}else f(o,u);return}const T=Z.isBinary,t=(F,c)=>{P.u?N("Scene has been disposed"):f(o,F,c)};let L=null,J=!1;null===(j=o.Mf)||void 0===j||j.add((()=>{J=!0,L&&(L.abort(),L=null),q()}));const B=()=>{if(J)return;const f=(F,P)=>{N(null===F||void 0===F?void 0:F.statusText,P)};if(!o.loadFile&&F.rawData)throw"Plugin does not support loading ArrayBufferView.";L=o.loadFile?o.loadFile(P,F.rawData||F.file||F.url,F.rootUrl,t,c,T,f,A):P._loadFile(F.file||F.url,t,c,!0,T,f)},z=P.getEngine();let R=z.enableOfflineSupport;if(R){let f=!1;for(const c of P.disableOfflineSupportExceptionRules)if(c.test(F.url)){f=!0;break}R=!f}R&&Y.b.OfflineProviderFactory?P.offlineProvider=Y.b.OfflineProviderFactory(F.url,B,z.disableManifestCheck):B()}))}function y(F,P){let f,c,q=null,H=null;if(P)if(P.name)f=`file:${P.name}`,c=P.name,q=P;else if(ArrayBuffer.isView(P))f="",c=(0,T.e)(),H=P;else if(P.startsWith("data:"))f=P,c="";else if(F){const q=P;if("/"===q.substring(0,1))return N.Tools.Error("Wrong sceneFilename parameter"),null;f=F+q,c=q}else f=P,c=N.Tools.GetFilename(P),F=N.Tools.GetFolderPath(P);else f=F,c=N.Tools.GetFilename(F),F=N.Tools.GetFolderPath(F);return{url:f,rootUrl:F,name:c,file:q,rawData:H}}function O(F){if("string"===typeof F.extensions){const P=F.extensions;L[P.toLowerCase()]={plugin:F,isBinary:!1}}else{const P=F.extensions,f=Object.keys(P);for(const c of f)L[c.toLowerCase()]={plugin:F,isBinary:P[c].isBinary,mimeType:P[c].mimeType}}}async function d(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.b.LastCreatedScene,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",T=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!c)return o.d.Error("No scene available to import mesh to"),null;const Y=y(P,f);if(!Y)return null;const t={};c.addPendingData(t);const C=()=>{c.removePendingData(t)},L=(F,P)=>{const f=Z(Y,F,P);H?H(c,f,new u.h(f,u.e.SceneLoaderError,P)):o.d.Error(f),C()},J=q?F=>{try{q(F)}catch(P){L("Error in onProgress callback: "+P,P)}}:void 0,B=(F,P,f,q,H,A,o,j)=>{if(c.importedMeshesFiles.push(Y.url),N)try{N(F,P,f,q,H,A,o,j)}catch(i){L("Error in onSuccess callback: "+i,i)}c.removePendingData(t)};return await R(Y,c,((P,f,N)=>{if(P.rewriteRootURL&&(Y.rootUrl=P.rewriteRootURL(Y.rootUrl,N)),P.importMesh){const N=[],q=[],H=[];if(!P.importMesh(F,c,f,Y.rootUrl,N,q,H,L))return;c.loadingPluginName=P.name,B(N,q,H,[],[],[],[],[])}else{P.importMeshAsync(F,c,f,Y.rootUrl,J,Y.name).then((F=>{c.loadingPluginName=P.name,B(F.meshes,F.zT,F.skeletons,F.animationGroups,F.transformNodes,F.geometries,F.lights,F.spriteManagers)})).catch((F=>{L(F.message,F)}))}}),J,L,C,j,i,T)}async function M(F,P,f,c,N,q,H,A){return await new Promise(((o,j)=>{try{d(F,P,f,c,((F,P,f,c,N,q,H,A)=>{o({meshes:F,zT:P,skeletons:f,animationGroups:c,transformNodes:N,geometries:q,lights:H,spriteManagers:A})}),N,((F,P,f)=>{j(f||new Error(P))}),q,H,A).catch(j)}catch(u){j(u)}}))}async function V(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.b.LastCreatedEngine,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};f?await K(F,P,new H.e(f),c,q,o,j,i,u):N.Tools.Error("No engine available")}async function Q(F,P,f,c,N,q,H){return await new Promise(((A,o)=>{V(F,P,f,(F=>{A(F)}),c,((F,P,f)=>{o(f||new Error(P))}),N,q,H)}))}async function K(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.b.LastCreatedScene,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!f)return o.d.Error("No scene available to append to"),null;const Y=y(F,P);if(!Y)return null;const t={};f.addPendingData(t);const C=()=>{f.removePendingData(t)};j.d.ShowLoadingScreen&&!J&&(J=!0,f.getEngine().displayLoadingUI(),f.executeWhenReady((()=>{f.getEngine().hideLoadingUI(),J=!1})));const L=(F,P)=>{const c=Z(Y,F,P);q?q(f,c,new u.h(c,u.e.SceneLoaderError,P)):o.d.Error(c),C()},B=N?F=>{try{N(F)}catch(P){L("Error in onProgress callback",P)}}:void 0,z=()=>{if(c)try{c(f)}catch(F){L("Error in onSuccess callback",F)}f.removePendingData(t)};return await R(Y,f,((F,P)=>{if(F.load){if(!F.load(f,P,Y.rootUrl,L))return;f.loadingPluginName=F.name,z()}else{F.loadAsync(f,P,Y.rootUrl,B,Y.name).then((()=>{f.loadingPluginName=F.name,z()})).catch((F=>{L(F.message,F)}))}}),B,L,C,H,i,T)}async function x(F,P,f,c,N,q,H){return await new Promise(((A,o)=>{try{K(F,P,f,(F=>{A(F)}),c,((F,P,f)=>{o(f||new Error(P))}),N,q,H).catch(o)}catch(u){o(u)}}))}async function k(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.b.LastCreatedScene,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!f)return o.d.Error("No scene available to load asset container to"),null;const T=y(F,P);if(!T)return null;const Y={};f.addPendingData(Y);const t=()=>{f.removePendingData(Y)},C=(F,P)=>{const c=Z(T,F,P);q?q(f,c,new u.h(c,u.e.SceneLoaderError,P)):o.d.Error(c),t()},L=N?F=>{try{N(F)}catch(P){C("Error in onProgress callback",P)}}:void 0,J=F=>{if(c)try{c(F)}catch(P){C("Error in onSuccess callback",P)}f.removePendingData(Y)};return await R(T,f,((F,P)=>{if(F.loadAssetContainer){const c=F.loadAssetContainer(f,P,T.rootUrl,C);if(!c)return;c.populateRootNodes(),f.loadingPluginName=F.name,J(c)}else if(F.loadAssetContainerAsync){F.loadAssetContainerAsync(f,P,T.rootUrl,L,T.name).then((P=>{P.populateRootNodes(),f.loadingPluginName=F.name,J(P)})).catch((F=>{C(F.message,F)}))}else C("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),L,C,t,H,j,i)}async function I(F,P,f,c,N,q,H){return await new Promise(((A,o)=>{try{k(F,P,f,(F=>{A(F)}),c,((F,P,f)=>{o(f||new Error(P))}),N,q,H).catch(o)}catch(u){o(u)}}))}async function E(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.b.LastCreatedScene,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,T=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!f)return void o.d.Error("No scene available to load animations to");if(c){for(const c of f.animatables)c.reset();f.stopAllAnimations();const F=f.animationGroups.slice();for(const f of F)f.dispose();const P=f.getNodes();for(const f of P)f.animations&&(f.animations=[])}else switch(N){case 0:const F=f.animationGroups.slice();for(const P of F)P.dispose();break;case 1:for(const P of f.animationGroups)P.stop();break;case 2:for(const P of f.animationGroups)P.reset(),P.restart();break;case 3:break;default:return void o.d.Error("Unknown animation group loading mode value '"+N+"'")}const t=f.animatables.length;await k(F,P,f,(F=>{F.mergeAnimationsTo(f,f.animatables.slice(t),q),F.dispose(),f.onAnimationFileImportedObservable.notifyObservers(f),H&&H(f)}),j,i,u,T,Y)}async function r(F,P,f,c,N,q,H,A,o,j){return await new Promise(((i,T)=>{try{E(F,P,f,c,N,q,(F=>{i(F)}),H,((F,P,f)=>{T(f||new Error(P))}),A,o,j).catch(T)}catch(u){T(u)}}))}class n{static get ForceFullSceneLoadingForIncremental(){return j.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(F){j.d.ForceFullSceneLoadingForIncremental=F}static get ShowLoadingScreen(){return j.d.ShowLoadingScreen}static set ShowLoadingScreen(F){j.d.ShowLoadingScreen=F}static get loggingLevel(){return j.d.loggingLevel}static set loggingLevel(F){j.d.loggingLevel=F}static get CleanBoneMatrixWeights(){return j.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(F){j.d.CleanBoneMatrixWeights=F}static GetDefaultPlugin(){return B()}static GetPluginForExtension(F){var P;return null===(P=z(F,!0))||void 0===P?void 0:P.plugin}static IsPluginForExtensionAvailable(F){return function(F){return!!L[F]}(F)}static RegisterPlugin(F){O(F)}static ImportMesh(F,P,f,c,N,q,H,o,j){d(F,P,f,c,N,q,H,o,j).catch((F=>null===H||void 0===H?void 0:H(A.b.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async ImportMeshAsync(F,P,f,c,N,q,H){return await M(F,P,f,c,N,q,H)}static Load(F,P,f,c,N,q,H,o){V(F,P,f,c,N,q,H,o).catch((F=>null===q||void 0===q?void 0:q(A.b.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async LoadAsync(F,P,f,c,N,q){return await Q(F,P,f,c,N,q)}static Append(F,P,f,c,N,q,H,o){K(F,P,f,c,N,q,H,o).catch((F=>null===q||void 0===q?void 0:q(f??A.b.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async AppendAsync(F,P,f,c,N,q){return await x(F,P,f,c,N,q)}static LoadAssetContainer(F,P,f,c,N,q,H,o){k(F,P,f,c,N,q,H,o).catch((F=>null===q||void 0===q?void 0:q(f??A.b.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async LoadAssetContainerAsync(F,P,f,c,N,q){return await I(F,P,f,c,N,q)}static ImportAnimations(F,P,f,c,N,q,H,o,j,i,u){E(F,P,f,c,N,q,H,o,j,i,u).catch((F=>null===j||void 0===j?void 0:j(f??A.b.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async ImportAnimationsAsync(F,P,f,c,N,q,H,A,o,j,i){return await r(F,P,f,c,N,q,A,j,i)}}n.NO_LOGGING=0,n.MINIMAL_LOGGING=1,n.SUMMARY_LOGGING=2,n.DETAILED_LOGGING=3,n.OnPluginActivatedObservable=C},13222:(F,P,f)=>{"use strict";f.d(P,{d:()=>T});var c=f(11619),N=f(11628),q=f(11462),H=f(11639),A=f(11666),o=f(11612),j=f(11587),i=f(11464),u=f(11677);f(13227);class T extends A.b{set boundingBoxSize(F){if(this._boundingBoxSize&&this._boundingBoxSize.equals(F))return;this._boundingBoxSize=F;const P=this.OF();P&&P.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(F){this._rotationY=F,this.setReflectionTextureMatrix(H.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(F,P,f){let c="";for(const N of F)c+=N;return new T(c,P,null,f,F)}static CreateFromPrefilteredData(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=P.useDelayedTextureLoading;P.useDelayedTextureLoading=!1;const q=new T(F,P,null,!1,null,null,null,void 0,!0,f,c);return P.useDelayedTextureLoading=N,q}constructor(F,P){var f;let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,T=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]&&arguments[10],C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,L=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,J=arguments.length>13?arguments[13]:void 0,B=arguments.length>14?arguments[14]:void 0;super(P),this.onLoadObservable=new i.d,this.boundingBoxPosition=H.tP.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new H.Matrix,this._buffer=null,this.name=F,this.url=F,this._noMipmap=N,this.ef=!1,this.isCube=!0,this._textureMatrix=H.Matrix.Identity(),this.coordinatesMode=o.e.CUBIC_MODE;let z=null,Z=null;null===c||Array.isArray(c)?(this._noMipmap=N,this._format=u,this._createPolynomials=t,z=c,this._loaderOptions=J,this._useSRGBBuffer=B,this._lodScale=C,this._lodOffset=L):(z=c.extensions??null,this._noMipmap=c.noMipmap??!1,q=c.files??null,Z=c.buffer??null,this._format=c.format??5,T=c.prefiltered??!1,Y=c.forcedExtension??null,this._createPolynomials=c.createPolynomials??!1,this._lodScale=c.lodScale??.8,this._lodOffset=c.lodOffset??0,this._loaderOptions=c.loaderOptions,this._useSRGBBuffer=c.useSRGBBuffer,A=c.G??null,j=c.onError??null),(F||q)&&this.updateURL(F,Y,A,T,j,z,null===(f=this.OF())||void 0===f?void 0:f.useDelayedTextureLoading,q,Z)}getClassName(){return"CubeTexture"}updateURL(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=F),this.url=F,P&&(this._forcedExtension=P);const j=F.lastIndexOf("."),i=P||(j>-1?F.substring(j).toLowerCase():""),u=0===i.indexOf(".dds"),T=0===i.indexOf(".env"),Y=0===i.indexOf(".basis");if(T?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=c,c&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),A)this._files=A;else if(Y||T||u||q||(q=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,q){for(let P=0;P<q.length;P++)this._files.push(F+q[P]);this._extensions=q}this._buffer=o,H?(this.delayLoadState=4,this._delayedOnLoad=f,this._delayedOnError=N):this._loadTexture(f,N)}delayLoad(F){4===this.delayLoadState&&(F&&(this._forcedExtension=F),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(F){var P,f;if(F.updateFlag===this._textureMatrix.updateFlag)return;F.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(f=this.OF())||void 0===f||f.markAllMaterialsAsDirty(1,(F=>-1!==F.getActiveTextures().indexOf(this))));if(this._textureMatrix=F,null===(P=this.OF())||void 0===P||!P.useRightHandedSystem)return;const c=H.TmpVectors.tP[0],N=H.TmpVectors.Quaternion[0],q=H.TmpVectors.tP[1];this._textureMatrix.decompose(c,N,q),N.z*=-1,N.w*=-1,H.Matrix.ComposeToRef(c,N,q,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var F;return null!==(F=this.OF())&&void 0!==F&&F.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const f=this.OF(),c=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const N=()=>{var P;(this.onLoadObservable.notifyObservers(this),c)&&(c.dispose(),null===(P=this.OF())||void 0===P||P.markAllMaterialsAsDirty(1));F&&F()},H=(F,f)=>{this._loadingError=!0,this._errorObject={message:F,exception:f},P&&P(F,f),o.e.OnTextureLoadErrorObservable.notifyObservers(this)};var A;this._texture?this._texture.isReady?q.Tools.SetImmediate((()=>N())):this._texture.onLoadedObservable.add((()=>N())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,f,this._lodScale,this._lodOffset,F,H,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,f,this._files,this._noMipmap,F,H,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(A=this._texture)||void 0===A||A.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(F,P,f){const c=u.e.Parse((()=>{let c=!1;return F.prefiltered&&(c=F.prefiltered),new T(f+(F.url??F.name),P,F.extensions,!1,F.files||null,null,null,void 0,c,F.forcedExtension)}),F,P);if(F.boundingBoxPosition&&(c.boundingBoxPosition=H.tP.zP(F.boundingBoxPosition)),F.boundingBoxSize&&(c.boundingBoxSize=H.tP.zP(F.boundingBoxSize)),F.animations)for(let N=0;N<F.animations.length;N++){const P=F.animations[N],f=(0,j.c)("BABYLON.Animation");f&&c.animations.push(f.Parse(P))}return c}clone(){let F=0;const P=u.e.Clone((()=>{const P=new T(this.url,this.OF()||this._getEngine(),this._extensions,this._noMipmap,this._files);return F=P.uniqueId,P}),this);return P.uniqueId=F,P}}(0,c.e)([(0,N.L)()],T.prototype,"url",void 0),(0,c.e)([(0,N.H)()],T.prototype,"boundingBoxPosition",void 0),(0,c.e)([(0,N.H)()],T.prototype,"boundingBoxSize",null),(0,c.e)([(0,N.L)("rotationY")],T.prototype,"rotationY",null),(0,c.e)([(0,N.L)("files")],T.prototype,"_files",void 0),(0,c.e)([(0,N.L)("forcedExtension")],T.prototype,"_forcedExtension",void 0),(0,c.e)([(0,N.L)("extensions")],T.prototype,"_extensions",void 0),(0,c.e)([(0,N.t)("textureMatrix")],T.prototype,"_textureMatrix",void 0),(0,c.e)([(0,N.t)("textureMatrixRefraction")],T.prototype,"_textureMatrixRefraction",void 0),o.e._CubeTextureParser=T.Parse,(0,j.f)("BABYLON.CubeTexture",T)},13757:(F,P,f)=>{"use strict";f.d(P,{c:()=>o});var c=f(11474),N=f(11612),q=f(11598),H=f(11752),A=f(11567);H.ThinEngine.prototype.createDynamicTexture=function(F,P,f,c){const N=new A.b(this,4);return N.baseWidth=F,N.baseHeight=P,f&&(F=this.needPOTTextures?(0,q.f)(F,this._caps.maxTextureSize):F,P=this.needPOTTextures?(0,q.f)(P,this._caps.maxTextureSize):P),N.width=F,N.height=P,N.isReady=!1,N.generateMipMaps=f,N.samplingMode=c,this.updateTextureSamplingMode(c,N),this._internalTexturesCache.push(N),N},H.ThinEngine.prototype.updateDynamicTexture=function(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!F)return;const H=this._gl,A=H.TEXTURE_2D,o=this._bindTextureDirectly(A,F,!0,q);this._unpackFlipY(void 0===f?F.invertY:f),c&&H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const j=this._getWebGLTextureType(F.type),i=this._getInternalFormat(N||F.format),u=this._getRGBABufferInternalSizedFormat(F.type,i);H.texImage2D(A,0,u,i,j,P),F.generateMipMaps&&H.generateMipmap(A),o||this._bindTextureDirectly(A,null),c&&H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),N&&(F.format=N),F._dynamicTextureSource=P,F._premulAlpha=c,F.invertY=f||!1,F.isReady=!0};class o extends N.e{constructor(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,A=arguments.length>6?arguments[6]:void 0;const o=!f||f._isScene;super(null,o?f:null===f||void 0===f?void 0:f.LP,o?!c:f,A,q,void 0,void 0,void 0,void 0,H),this.name=F,this.wrapU=N.e.CLAMP_ADDRESSMODE,this.wrapV=N.e.CLAMP_ADDRESSMODE,this._generateMipMaps=c;const j=this._getEngine();if(!j)return;if(P.getContext)this._canvas=P,this._ownCanvas=!1,this._texture=j.createDynamicTexture(this._canvas.width,this._canvas.height,c,q);else{this._canvas=j.createCanvas(1,1),this._ownCanvas=!0;const F=P;F.width||0===F.width?this._texture=j.createDynamicTexture(F.width,F.height,c,q):this._texture=j.createDynamicTexture(P,P,c,q)}const i=this.getSize();this._canvas.width!==i.width&&(this._canvas.width=i.width),this._canvas.height!==i.height&&(this._canvas.height=i.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(F){this._canvas.width=F.width,this._canvas.height=F.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(F.width,F.height,this._generateMipMaps,this.samplingMode)}scale(F){const P=this.getSize();P.width*=F,P.height*=F,this._recreate(P)}scaleTo(F,P){const f=this.getSize();f.width=F,f.height=P,this._recreate(f)}getContext(){return this._context}clear(F){const P=this.getSize();F&&(this._context.fillStyle=F),this._context.clearRect(0,0,P.width,P.height)}update(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===F||F,P,this._format||void 0,void 0,f)}drawText(F,P,f,c,N,q,H){let A=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const o=this.getSize();if(q&&(this._context.fillStyle=q,this._context.fillRect(0,0,o.width,o.height)),this._context.font=c,null===P||void 0===P){const f=this._context.measureText(F);P=(o.width-f.width)/2}if(null===f||void 0===f){const F=parseInt(c.replace(/\D/g,""));f=o.height/2+F/3.65}this._context.fillStyle=N||"",this._context.fillText(F,P,f),A&&this.update(H)}dispose(){var F,P;(super.dispose(),this._ownCanvas)&&(null===(F=this._canvas)||void 0===F||null===(P=F.remove)||void 0===P||P.call(F));this._canvas=null,this._context=null}clone(){const F=this.OF();if(!F)return this;const P=this.getSize(),f=new o(this.name,P,F,this._generateMipMaps);return f.ef=this.ef,f.level=this.level,f.wrapU=this.wrapU,f.wrapV=this.wrapV,f}serialize(){const F=this.OF();F&&!F.isReady()&&c.d.Warn("The scene must be ready before serializing the dynamic texture");const P=super.serialize();return o._IsCanvasElement(this._canvas)&&(P.base64String=this._canvas.toDataURL()),P.invertY=this._invertY,P.samplingMode=this.samplingMode,P}static _IsCanvasElement(F){return void 0!==F.toDataURL}_rebuild(){this.update()}}},13135:(F,P,f)=>{"use strict";f.d(P,{b:()=>N});var c=f(11612);class N extends c.e{get depth(){return this._depth}constructor(F,P,f,N,q,H){let A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:c.e.TRILINEAR_SAMPLINGMODE,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10?arguments[10]:void 0;super(null,H,!A,o),this.format=q,this._texture=H.getEngine().createRawTexture2DArray(F,P,f,N,q,A,o,j,null,i,u),this._depth=N,this.is2DArray=!0}update(F){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,F,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(F,P,f,c,q){return new N(F,P,f,c,5,q,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12978:(F,P,f)=>{"use strict";f.d(P,{e:()=>A,f:()=>o,h:()=>q,i:()=>H});var c=f(11664),N=f(11639);function q(F,P){return`{X: ${F.x.toFixed(P)} Y: ${F.y.toFixed(P)}}`}function H(F,P){return`{X: ${F._x.toFixed(P)} Y: ${F._y.toFixed(P)} Z: ${F._z.toFixed(P)}}`}function A(F,P){return 2*Math.acos((0,c.Clamp)(N.Quaternion.Dot(F,P)))}function o(F,P){const f=new N.Quaternion;return function(F,P,f){const q=N.tP.Cross(F,P),H=Math.acos((0,c.Clamp)(N.tP.Dot(F,P),-1,1));N.Quaternion.RotationAxisToRef(q,H,f)}(F,P,f),f}},12824:(F,P,f)=>{"use strict";f.d(P,{b:()=>j});var c=f(11639),N=f(11690),q=f(12063),H=f(12050),A=f(11699);f(12826);function o(F){let P=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const f=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],q=[];let o=[];const j=F.width||F.size||1,i=F.height||F.size||1,u=F.depth||F.size||1,T=F.wrap||!1;let Y=void 0===F.topBaseAt?1:F.topBaseAt,t=void 0===F.bottomBaseAt?0:F.bottomBaseAt;Y=(Y+4)%4,t=(t+4)%4;let C=[2,0,3,1][Y],L=[2,0,1,3][t],J=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(T){P=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],J=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let F=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],f=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const c=[17,18,19,16],N=[22,23,20,21];for(;C>0;)F.unshift(F.pop()),c.unshift(c.pop()),C--;for(;L>0;)f.unshift(f.pop()),N.unshift(N.pop()),L--;F=F.flat(),f=f.flat(),J=J.concat(F).concat(f),P.push(c[0],c[2],c[3],c[0],c[1],c[2]),P.push(N[0],N[2],N[3],N[0],N[1],N[2])}const B=[j/2,i/2,u/2];o=J.reduce(((F,P,f)=>F.concat(P*B[f%3])),[]);const z=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE,Z=F.faceUV||new Array(6),R=F.faceColors,y=[];for(let H=0;H<6;H++)void 0===Z[H]&&(Z[H]=new c.Vector4(0,0,1,1)),R&&void 0===R[H]&&(R[H]=new N.qc(1,1,1,1));for(let c=0;c<6;c++)if(q.push(Z[c].z,A.e?1-Z[c].w:Z[c].w),q.push(Z[c].x,A.e?1-Z[c].w:Z[c].w),q.push(Z[c].x,A.e?1-Z[c].y:Z[c].y),q.push(Z[c].z,A.e?1-Z[c].y:Z[c].y),R)for(let F=0;F<4;F++)y.push(R[c].r,R[c].g,R[c].b,R[c].a);H.e._ComputeSides(z,o,P,f,q,F.frontUVs,F.backUVs);const O=new H.e;if(O.indices=P,O.MF=o,O.VF=f,O.KF=q,R){const F=z===H.e.DOUBLESIDE?y.concat(y):y;O.QF=F}return O}function j(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new q.d(F,f);P.sideOrientation=q.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return o(P).kF(c,P.updatable),c}H.e.CreateBox=o,q.d.CreateBox=function(F,P){return j(F,{size:P,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12970:(F,P,f)=>{"use strict";f.d(P,{b:()=>A});var c=f(12063),N=f(12050),q=f(11699);function H(F){const P=[],f=[],c=[],H=[],A=F.radius||.5,o=F.tessellation||64,j=F.arc&&(F.arc<=0||F.arc>1)?1:F.arc||1,i=0===F.sideOrientation?0:F.sideOrientation||N.e.DEFAULTSIDE;P.push(0,0,0),H.push(.5,.5);const u=2*Math.PI*j,T=1===j?u/o:u/(o-1);let Y=0;for(let N=0;N<o;N++){const F=Math.cos(Y),f=Math.sin(Y),c=(F+1)/2,N=(1-f)/2;P.push(A*F,A*f,0),H.push(c,q.e?1-N:N),Y+=T}1===j&&(P.push(P[3],P[4],P[5]),H.push(H[2],q.e?1-H[3]:H[3]));const t=P.length/3;for(let N=1;N<t-1;N++)f.push(N+1,0,N);N.e.ComputeNormals(P,f,c),N.e._ComputeSides(i,P,f,c,H,F.frontUVs,F.backUVs);const C=new N.e;return C.indices=f,C.MF=P,C.VF=c,C.KF=H,C}function A(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new c.d(F,f);P.sideOrientation=c.d._GetDefaultSideOrientation(P.sideOrientation),N._originalBuilderSideOrientation=P.sideOrientation;return H(P).kF(N,P.updatable),N}N.e.CreateDisc=H,c.d.CreateDisc=function(F,P,f){return A(F,{radius:P,tessellation:f,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12826:(F,P,f)=>{"use strict";f.d(P,{g:()=>L,d:()=>B,i:()=>J});var c=f(11639),N=f(11690),q=f(12063),H=f(12050),A=f(11706);q.d._GroundMeshParser=(F,P)=>o.Parse(F,P);class o extends q.d{constructor(F,P){super(F,P),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=F,this._subdivisionsY=F,this.subdivide(F);const f=this;f.createOrUpdateSubmeshesOctree&&f.createOrUpdateSubmeshesOctree(P)}getHeightAtCoordinates(F,P){const f=this.getWorldMatrix(),N=c.TmpVectors.Matrix[5];f.invertToRef(N);const q=c.TmpVectors.tP[8];if(c.tP.TransformCoordinatesFromFloatsToRef(F,0,P,N,q),F=q.x,P=q.z,F<this._minX||F>=this._maxX||P<=this._minZ||P>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const H=this._getFacetAt(F,P),A=-(H.x*F+H.z*P+H.w)/H.y;return c.tP.TransformCoordinatesFromFloatsToRef(0,A,0,f,q),q.y}getNormalAtCoordinates(F,P){const f=new c.tP(0,1,0);return this.getNormalAtCoordinatesToRef(F,P,f),f}getNormalAtCoordinatesToRef(F,P,f){const N=this.getWorldMatrix(),q=c.TmpVectors.Matrix[5];N.invertToRef(q);const H=c.TmpVectors.tP[8];if(c.tP.TransformCoordinatesFromFloatsToRef(F,0,P,q,H),F=H.x,P=H.z,F<this._minX||F>this._maxX||P<this._minZ||P>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const A=this._getFacetAt(F,P);return c.tP.TransformNormalFromFloatsToRef(A.x,A.y,A.z,N,f),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(F,P){const f=Math.floor((F+this._maxX)*this._subdivisionsX/this._width),c=Math.floor(-(P+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),N=this._heightQuads[c*this._subdivisionsX+f];let q;return q=P<N.slope.x*F+N.slope.y?N.facet1:N.facet2,q}_initHeightQuads(){const F=this._subdivisionsX,P=this._subdivisionsY;this._heightQuads=[];for(let f=0;f<P;f++)for(let P=0;P<F;P++){const N={slope:c.Vector2.Zero(),facet1:new c.Vector4(0,0,0,0),facet2:new c.Vector4(0,0,0,0)};this._heightQuads[f*F+P]=N}return this}_computeHeightQuads(){const F=this.getVerticesData(A.f.PositionKind);if(!F)return this;const P=c.TmpVectors.tP[3],f=c.TmpVectors.tP[2],N=c.TmpVectors.tP[1],q=c.TmpVectors.tP[0],H=c.TmpVectors.tP[4],o=c.TmpVectors.tP[5],j=c.TmpVectors.tP[6],i=c.TmpVectors.tP[7],u=c.TmpVectors.tP[8];let T=0,Y=0,t=0,C=0,L=0,J=0,B=0;const z=this._subdivisionsX,Z=this._subdivisionsY;for(let A=0;A<Z;A++)for(let Z=0;Z<z;Z++){T=3*Z,Y=A*(z+1)*3,t=(A+1)*(z+1)*3,P.x=F[Y+T],P.y=F[Y+T+1],P.z=F[Y+T+2],f.x=F[Y+T+3],f.y=F[Y+T+4],f.z=F[Y+T+5],N.x=F[t+T],N.y=F[t+T+1],N.z=F[t+T+2],q.x=F[t+T+3],q.y=F[t+T+4],q.z=F[t+T+5],C=(q.z-P.z)/(q.x-P.x),L=P.z-C*P.x,f.subtractToRef(P,H),N.subtractToRef(P,o),q.subtractToRef(P,j),c.tP.CrossToRef(j,o,i),c.tP.CrossToRef(H,j,u),i.normalize(),u.normalize(),J=-(i.x*P.x+i.y*P.y+i.z*P.z),B=-(u.x*f.x+u.y*f.y+u.z*f.z);const R=this._heightQuads[A*z+Z];R.slope.fc(C,L),R.facet1.fc(i.x,i.y,i.z,J),R.facet2.fc(u.x,u.y,u.z,B)}return this}serialize(F){super.serialize(F),F.subdivisionsX=this._subdivisionsX,F.subdivisionsY=this._subdivisionsY,F.minX=this._minX,F.maxX=this._maxX,F.Wf=this._minZ,F.maxZ=this._maxZ,F.width=this._width,F.height=this._height}static Parse(F,P){const f=new o(F.name,P);return f._subdivisionsX=F.subdivisionsX||1,f._subdivisionsY=F.subdivisionsY||1,f._minX=F.minX,f._maxX=F.maxX,f._minZ=F.Wf,f._maxZ=F.maxZ,f._width=F.width,f._height=F.height,f}}var j=f(11462),i=f(11501),u=f(11648),T=f(11699);function Y(F){const P=[],f=[],N=[],q=[];let A,o;const j=F.width||F.size||1,i=F.height||F.size||1,u=0|(F.subdivisionsX||F.subdivisions||1),Y=0|(F.subdivisionsY||F.subdivisions||1);for(A=0;A<=Y;A++)for(o=0;o<=u;o++){const F=new c.tP(o*j/u-j/2,0,(Y-A)*i/Y-i/2),P=new c.tP(0,1,0);f.push(F.x,F.y,F.z),N.push(P.x,P.y,P.z),q.push(o/u,T.e?A/Y:1-A/Y)}for(A=0;A<Y;A++)for(o=0;o<u;o++)P.push(o+1+(A+1)*(u+1)),P.push(o+1+A*(u+1)),P.push(o+A*(u+1)),P.push(o+(A+1)*(u+1)),P.push(o+1+(A+1)*(u+1)),P.push(o+A*(u+1));const t=new H.e;return t.indices=P,t.MF=f,t.VF=N,t.KF=q,t}function t(F){const P=void 0!==F.xmin&&null!==F.xmin?F.xmin:-1,f=void 0!==F.zmin&&null!==F.zmin?F.zmin:-1,N=void 0!==F.xmax&&null!==F.xmax?F.xmax:1,q=void 0!==F.zmax&&null!==F.zmax?F.zmax:1,A=F.subdivisions||{w:1,h:1},o=F.precision||{w:1,h:1},j=[],i=[],u=[],T=[];let Y,t,C,L;A.h=A.h<1?1:A.h,A.w=A.w<1?1:A.w,o.w=o.w<1?1:o.w,o.h=o.h<1?1:o.h;const J=(N-P)/A.w,B=(q-f)/A.h;function z(F,P,f,N){const q=i.length/3,H=o.w+1;for(Y=0;Y<o.h;Y++)for(t=0;t<o.w;t++){const F=[q+t+Y*H,q+(t+1)+Y*H,q+(t+1)+(Y+1)*H,q+t+(Y+1)*H];j.push(F[1]),j.push(F[2]),j.push(F[3]),j.push(F[0]),j.push(F[1]),j.push(F[3])}const A=c.tP.Zero(),C=new c.tP(0,1,0);for(Y=0;Y<=o.h;Y++)for(A.z=Y*(N-P)/o.h+P,t=0;t<=o.w;t++)A.x=t*(f-F)/o.w+F,A.y=0,i.push(A.x,A.y,A.z),u.push(C.x,C.y,C.z),T.push(t/o.w,Y/o.h)}for(C=0;C<A.h;C++)for(L=0;L<A.w;L++)z(P+L*J,f+C*B,P+(L+1)*J,f+(C+1)*B);const Z=new H.e;return Z.indices=j,Z.MF=i,Z.VF=u,Z.KF=T,Z}function C(F){const P=[],f=[],q=[],A=[];let o,j;const i=F.colorFilter||new N.BP(.3,.59,.11),T=F.alphaFilter||0;let Y=!1;if(F.minHeight>F.maxHeight){Y=!0;const P=F.maxHeight;F.maxHeight=F.minHeight,F.minHeight=P}for(o=0;o<=F.subdivisions;o++)for(j=0;j<=F.subdivisions;j++){const P=new c.tP(j*F.width/F.subdivisions-F.width/2,0,(F.subdivisions-o)*F.height/F.subdivisions-F.height/2),N=4*(((P.x+F.width/2)/F.width*(F.bufferWidth-1)|0)+((1-(P.z+F.height/2)/F.height)*(F.bufferHeight-1)|0)*F.bufferWidth);let H=F.buffer[N]/255,t=F.buffer[N+1]/255,C=F.buffer[N+2]/255;const L=F.buffer[N+3]/255;Y&&(H=1-H,t=1-t,C=1-C);const J=H*i.r+t*i.g+C*i.b;P.y=L>=T?F.minHeight+(F.maxHeight-F.minHeight)*J:F.minHeight-u.e,F.heightBuffer&&(F.heightBuffer[o*(F.subdivisions+1)+j]=P.y),f.push(P.x,P.y,P.z),q.push(0,0,0),A.push(j/F.subdivisions,1-o/F.subdivisions)}for(o=0;o<F.subdivisions;o++)for(j=0;j<F.subdivisions;j++){const c=j+1+(o+1)*(F.subdivisions+1),N=j+1+o*(F.subdivisions+1),q=j+o*(F.subdivisions+1),H=j+(o+1)*(F.subdivisions+1),A=f[3*c+1]>=F.minHeight,i=f[3*N+1]>=F.minHeight,u=f[3*q+1]>=F.minHeight;A&&i&&u&&(P.push(c),P.push(N),P.push(q));f[3*H+1]>=F.minHeight&&A&&u&&(P.push(H),P.push(c),P.push(q))}H.e.ComputeNormals(f,P,q);const t=new H.e;return t.indices=P,t.MF=f,t.VF=q,t.KF=A,t}function L(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const f=new o(F,arguments.length>2?arguments[2]:void 0);f._setReady(!1),f._subdivisionsX=P.subdivisionsX||P.subdivisions||1,f._subdivisionsY=P.subdivisionsY||P.subdivisions||1,f._width=P.width||1,f._height=P.height||1,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ;return Y(P).kF(f,P.updatable),f._setReady(!0),f}function J(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new q.d(F,f);return t(P).kF(c,P.updatable),c}function B(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const q=f.width||10,H=f.height||10,A=f.subdivisions||1,u=f.minHeight||0,T=f.maxHeight||1,Y=f.colorFilter||new N.BP(.3,.59,.11),t=f.alphaFilter||0,L=f.updatable,J=f.onReady;c=c||i.b.LastCreatedScene;const B=new o(F,c);let z;B._subdivisionsX=A,B._subdivisionsY=A,B._width=q,B._height=H,B._maxX=B._width/2,B._maxZ=B._height/2,B._minX=-B._maxX,B._minZ=-B._maxZ,B._setReady(!1),f.passHeightBufferInCallback&&(z=new Float32Array((A+1)*(A+1)));const Z=(F,P,f)=>{C({width:q,height:H,subdivisions:A,minHeight:u,maxHeight:T,colorFilter:Y,buffer:F,bufferWidth:P,bufferHeight:f,alphaFilter:t,heightBuffer:z}).kF(B,L),J&&J(B,z),B._setReady(!0)};if("string"===typeof P){const F=F=>{var P;const f=F.width,N=F.height;if(c.u)return;const q=null===(P=c)||void 0===P?void 0:P.getEngine().resizeImageBitmap(F,f,N);Z(q,f,N)};j.Tools.LoadImage(P,F,f.onError?f.onError:()=>{},c.offlineProvider)}else Z(P.data,P.width,P.height);return B}H.e.CreateGround=Y,H.e.CreateTiledGround=t,H.e.CreateGroundFromHeightMap=C,q.d.CreateGround=(F,P,f,c,N,q)=>L(F,{width:P,height:f,subdivisions:c,updatable:q},N),q.d.CreateTiledGround=(F,P,f,c,N,q,H,A,o)=>J(F,{xmin:P,zmin:f,xmax:c,zmax:N,subdivisions:q,precision:H,updatable:o},A),q.d.CreateGroundFromHeightMap=(F,P,f,c,N,q,H,A,o,j,i)=>B(F,P,{width:f,height:c,subdivisions:N,minHeight:q,maxHeight:H,updatable:o,onReady:j,alphaFilter:i},A)},13448:(F,P,f)=>{"use strict";f.d(P,{e:()=>Y,g:()=>u,j:()=>T});var c=f(11639),N=f(12063),q=f(12050),H=f(12172),A=f(11706),o=f(11474);function j(F){const P=[],f=[],c=F.lines,N=F.QF,H=[];let A=0;for(let q=0;q<c.length;q++){const F=c[q];for(let c=0;c<F.length;c++){const{x:o,y:j,z:i}=F[c];if(f.push(o,j,i),N){const F=N[q],{r:P,g:f,b:A,a:o}=F[c];H.push(P,f,A,o)}c>0&&(P.push(A-1),P.push(A)),A++}}const o=new q.e;return o.indices=P,o.MF=f,N&&(o.QF=H),o}function i(F){const P=F.dashSize||3,f=F.gapSize||1,N=F.dashNb||200,H=F.points,A=[],o=[],j=c.tP.Zero();let i=0,u=0,T=0,Y=0,t=0,C=0,L=0;for(L=0;L<H.length-1;L++)H[L+1].subtractToRef(H[L],j),i+=j.length();for(T=i/N,Y=P*T/(P+f),L=0;L<H.length-1;L++){H[L+1].subtractToRef(H[L],j),u=Math.floor(j.length()/T),j.normalize();for(let F=0;F<u;F++)t=T*F,A.push(H[L].x+t*j.x,H[L].y+t*j.y,H[L].z+t*j.z),A.push(H[L].x+(t+Y)*j.x,H[L].y+(t+Y)*j.y,H[L].z+(t+Y)*j.z),o.push(C,C+1),C+=2}const J=new q.e;return J.MF=A,J.indices=o,J}function u(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=P.instance,N=P.lines,q=P.QF;if(c){const F=c.getVerticesData(A.f.PositionKind);let P,f;q&&(P=c.getVerticesData(A.f.ColorKind));let H=0,o=0;for(let c=0;c<N.length;c++){const A=N[c];for(let N=0;N<A.length;N++)F[H]=A[N].x,F[H+1]=A[N].y,F[H+2]=A[N].z,q&&P&&(f=q[c],P[o]=f[N].r,P[o+1]=f[N].g,P[o+2]=f[N].b,P[o+3]=f[N].a,o+=4),H+=3}return c.updateVerticesData(A.f.PositionKind,F,!1,!1),q&&P&&c.updateVerticesData(A.f.ColorKind,P,!1,!1),c.refreshBoundingInfo(),c}const o=!!q,i=new H.e(F,f,null,void 0,void 0,o,P.useVertexAlpha,P.material);return j(P).kF(i,P.updatable),i}function T(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=P.QF?[P.QF]:null;return u(F,{lines:[P.points],updatable:P.updatable,instance:P.instance,QF:c,useVertexAlpha:P.useVertexAlpha,material:P.material},f)}function Y(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=P.points,A=P.instance,j=P.gapSize||1,u=P.dashSize||3;if(A){const F=F=>{const P=c.tP.Zero(),f=F.length/6;let N=0,H=0,o=0,j=0,i=0,u=0,T=0,Y=0;for(T=0;T<q.length-1;T++)q[T+1].subtractToRef(q[T],P),N+=P.length();o=N/f;const t=A._creationDataStorage.dashSize;for(j=t*o/(t+A._creationDataStorage.gapSize),T=0;T<q.length-1;T++)for(q[T+1].subtractToRef(q[T],P),H=Math.floor(P.length()/o),P.normalize(),Y=0;Y<H&&u<F.length;)i=o*Y,F[u]=q[T].x+i*P.x,F[u+1]=q[T].y+i*P.y,F[u+2]=q[T].z+i*P.z,F[u+3]=q[T].x+(i+j)*P.x,F[u+4]=q[T].y+(i+j)*P.y,F[u+5]=q[T].z+(i+j)*P.z,u+=6,Y++;for(;u<F.length;)F[u]=q[T].x,F[u+1]=q[T].y,F[u+2]=q[T].z,u+=3};return(P.dashNb||P.dashSize||P.gapSize||P.useVertexAlpha||P.material)&&o.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),A.updateMeshPositions(F,!1),A}const T=new H.e(F,f,null,void 0,void 0,void 0,P.useVertexAlpha,P.material);return i(P).kF(T,P.updatable),T._creationDataStorage=new N.g,T._creationDataStorage.dashSize=u,T._creationDataStorage.gapSize=j,T}q.e.CreateLineSystem=j,q.e.CreateDashedLines=i,N.d.Wj=function(F,P){return T(F,{points:P,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},N.d.CreateDashedLines=function(F,P,f,c,N){return Y(F,{points:P,dashSize:f,gapSize:c,dashNb:N,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12876:(F,P,f)=>{"use strict";f.d(P,{b:()=>A,e:()=>o});var c=f(12063),N=f(12050),q=f(11699);function H(F){const P=[],f=[],c=[],H=[],A=void 0!==F.width?F.width:void 0!==F.size?F.size:1,o=void 0!==F.height?F.height:void 0!==F.size?F.size:1,j=0===F.sideOrientation?0:F.sideOrientation||N.e.DEFAULTSIDE,i=A/2,u=o/2;f.push(-i,-u,0),c.push(0,0,-1),H.push(0,q.e?1:0),f.push(i,-u,0),c.push(0,0,-1),H.push(1,q.e?1:0),f.push(i,u,0),c.push(0,0,-1),H.push(1,q.e?0:1),f.push(-i,u,0),c.push(0,0,-1),H.push(0,q.e?0:1),P.push(0),P.push(1),P.push(2),P.push(0),P.push(2),P.push(3),N.e._ComputeSides(j,f,P,c,H,F.frontUVs,F.backUVs);const T=new N.e;return T.indices=P,T.MF=f,T.VF=c,T.KF=H,T}function A(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new c.d(F,f);P.sideOrientation=c.d._GetDefaultSideOrientation(P.sideOrientation),N._originalBuilderSideOrientation=P.sideOrientation;return H(P).kF(N,P.updatable),P.sourcePlane&&(N.translate(P.sourcePlane.normal,-P.sourcePlane.d),N.setDirection(P.sourcePlane.normal.scale(-1))),N}const o={sj:A};N.e.sj=H,c.d.sj=(F,P,f,c,N)=>A(F,{size:P,width:P,height:P,sideOrientation:N,updatable:c},f)},12957:(F,P,f)=>{"use strict";f.d(P,{e:()=>o});var c=f(11639),N=f(12063),q=f(12050),H=f(11699);function A(F){const P=0|(F.segments||32),f=F.diameterX||F.diameter||1,N=F.diameterY||F.diameter||1,A=F.diameterZ||F.diameter||1,o=F.arc&&(F.arc<=0||F.arc>1)?1:F.arc||1,j=F.slice&&F.slice<=0?1:F.slice||1,i=0===F.sideOrientation?0:F.sideOrientation||q.e.DEFAULTSIDE,u=!!F.dedupTopBottomIndices,T=new c.tP(f/2,N/2,A/2),Y=2+P,t=2*Y,C=[],L=[],J=[],B=[];for(let q=0;q<=Y;q++){const F=q/Y,P=F*Math.PI*j;for(let f=0;f<=t;f++){const N=f/t,q=N*Math.PI*2*o,A=c.Matrix.RotationZ(-P),j=c.Matrix.RotationY(q),i=c.tP.TransformCoordinates(c.tP.Up(),A),u=c.tP.TransformCoordinates(i,j),Y=u.multiply(T),C=u.divide(T).normalize();L.push(Y.x,Y.y,Y.z),J.push(C.x,C.y,C.z),B.push(N,H.e?1-F:F)}if(q>0){const F=L.length/3;for(let P=F-2*(t+1);P+t+2<F;P++)u?(q>1&&(C.push(P),C.push(P+1),C.push(P+t+1)),(q<Y||j<1)&&(C.push(P+t+1),C.push(P+1),C.push(P+t+2))):(C.push(P),C.push(P+1),C.push(P+t+1),C.push(P+t+1),C.push(P+1),C.push(P+t+2))}}q.e._ComputeSides(i,L,C,J,B,F.frontUVs,F.backUVs);const z=new q.e;return z.indices=C,z.MF=L,z.VF=J,z.KF=B,z}function o(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new N.d(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return A(P).kF(c,P.updatable),c}q.e.CreateSphere=A,N.d.CreateSphere=(F,P,f,c,N,q)=>o(F,{segments:P,diameterX:f,diameterY:f,diameterZ:f,sideOrientation:q,updatable:N},c)},13767:(F,P,f)=>{"use strict";f.d(P,{d:()=>A});var c=f(12193),N=f(13229),q=f(12210),H=f(12050);class A{static get Configuration(){return{get decoder(){return N.d.DefaultConfiguration},set decoder(F){N.d.DefaultConfiguration=F}}}static set Configuration(F){N.d.DefaultConfiguration=F.decoder}static get DecoderAvailable(){return(0,c.g)(N.d.DefaultConfiguration)}static get Default(){return A._Default??(A._Default=new A),A._Default}static ResetDefault(F){A._Default&&(F||A._Default.dispose(),A._Default=null)}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.DefaultNumWorkers;const P="number"===typeof F?{...N.d.DefaultConfiguration,numWorkers:F}:{...N.d.DefaultConfiguration,...F};this._decoder=new N.d(P)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(F,P,f){return this._decoder.decodeMeshToMeshDataAsync(F,P,f)}async decodeMeshToGeometryAsync(F,P,f,c){return await this._decoder.decodeMeshToGeometryAsync(F,P,f,c)}async _decodeMeshToGeometryForGltfAsync(F,P,f,c,N,q){return await this._decoder._decodeMeshToGeometryForGltfAsync(F,P,f,c,N,q)}async decodeMeshAsync(F,P){const f=await this._decoder.decodeMeshToMeshDataAsync(F,P),c=new H.e;f.indices&&(c.indices=f.indices);for(const N of f.attributes){const F=q.c.GetFloatData(N.data,N.size,q.c.GetDataType(N.data),N.byteOffset,N.byteStride,N.normalized,f.totalVertices);c.set(F,N.kind)}return c}}A.DefaultNumWorkers=(0,c.e)(),A._Default=null},13229:(F,P,f)=>{"use strict";f.d(P,{d:()=>j});var c=f(12193),N=f(11462),q=f(12075),H=f(12210),A=f(11474),o=f(12202);class j extends c.b{static get DefaultAvailable(){return(0,c.g)(j.DefaultConfiguration)}static get Default(){return j._Default??(j._Default=new j),j._Default}static ResetDefault(F){j._Default&&(F||j._Default.dispose(),j._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(F,P){return{module:await(P||DracoDecoderModule)({wasmBinary:F})}}_getWorkerContent(){return`${o.c}(${o.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.DefaultConfiguration)}decodeMeshToMeshDataAsync(F,P,f){const c=F instanceof ArrayBuffer?new Int8Array(F):new Int8Array(F.buffer,F.byteOffset,F.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async F=>await new Promise(((N,q)=>{F.push(((F,H)=>{let o=null;const j=[],i=P=>{F.removeEventListener("error",i),F.removeEventListener("message",u),q(P),H()},u=P=>{const c=P.data;switch(c.id){case"indices":o=c.data;break;case"attribute":j.push({kind:c.kind,data:c.data,size:c.size,byteOffset:c.byteOffset,byteStride:c.byteStride,normalized:(q=c.kind,T=c.normalized,f&&void 0!==f[q]?(T!==f[q]&&A.d.Warn(`Normalized flag from Draco data (${T}) does not match normalized flag from glTF accessor (${f[q]}). Using flag from glTF accessor.`),f[q]):T)});break;case"decodeMeshDone":F.removeEventListener("error",i),F.removeEventListener("message",u),N({indices:o,attributes:j,totalVertices:c.totalVertices}),H()}var q,T};F.addEventListener("error",i),F.addEventListener("message",u);const T=c.slice();F.postMessage({id:"decodeMesh",dataView:T,attributes:P},[T.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((F=>{let f=null;const N=[],q=(0,o.c)(F.module,c,P,(F=>{f=F}),((F,P,f,c,q,H)=>{N.push({kind:F,data:P,size:f,byteOffset:c,byteStride:q,normalized:H})}));return{indices:f,attributes:N,totalVertices:q}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(F,P,f,c){const N=await this.decodeMeshToMeshDataAsync(f,c),A=new q.e(F,P);N.indices&&A.setIndices(N.indices);for(const q of N.attributes)A.setVerticesBuffer(new H.c(P.getEngine(),q.data,q.kind,!1,void 0,q.byteStride,void 0,q.byteOffset,q.size,void 0,q.normalized,!0),N.totalVertices);return A}async _decodeMeshToGeometryForGltfAsync(F,P,f,c,N,A){const o=await this.decodeMeshToMeshDataAsync(f,c,N),j=new q.e(F,P);A&&(j._boundingInfo=A,j.useBoundingInfoFromGeometry=!0),o.indices&&j.setIndices(o.indices);for(const q of o.attributes)j.setVerticesBuffer(new H.c(P.getEngine(),q.data,q.kind,!1,void 0,q.byteStride,void 0,q.byteOffset,q.size,void 0,q.normalized,!0),o.totalVertices);return j}}j.DefaultConfiguration={wasmUrl:`${N.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${N.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${N.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},j._Default=null},13440:(F,P,f)=>{"use strict";f.d(P,{e:()=>AF});var c=f(11639),N=f(12063),q=f(11706),H=f(12050),A=f(11699);function o(F){let P=F.pathArray;const f=F.closeArray||!1,c=F.closePath||!1,N=F.invertUV||!1,o=Math.floor(P[0].length/2);let j=F.offset||o;j=j>o?o:Math.floor(j);const i=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE,u=F.KF,T=F.QF,Y=[],t=[],C=[],L=[],J=[],B=[],z=[],Z=[];let R;const y=[],O=[];let d,M,V;if(P.length<2){const F=[],f=[];for(M=0;M<P[0].length-j;M++)F.push(P[0][M]),f.push(P[0][M+j]);P=[F,f]}let Q=0;const K=c?1:0,x=f?1:0;let k,I,E,r,n,p;for(R=P[0].length,d=0;d<P.length+x;d++){for(z[d]=0,J[d]=[0],k=d===P.length?P[0]:P[d],I=k.length,R=R<I?R:I,V=0;V<I;)Y.push(k[V].x,k[V].y,k[V].z),V>0&&(E=k[V].CP(k[V-1]).length(),r=E+z[d],J[d].push(r),z[d]=r),V++;c&&(V--,Y.push(k[0].x,k[0].y,k[0].z),E=k[V].CP(k[0]).length(),r=E+z[d],J[d].push(r),z[d]=r),y[d]=I+K,O[d]=Q,Q+=I+K}let U,e,D=null,l=null;for(M=0;M<R+K;M++)for(Z[M]=0,B[M]=[0],d=0;d<P.length-1+x;d++)n=P[d],p=d===P.length-1?P[0]:P[d+1],M===R?(D=n[0],l=p[0]):(D=n[M],l=p[M]),E=l.CP(D).length(),r=E+Z[M],B[M].push(r),Z[M]=r;if(u)for(d=0;d<u.length;d++)L.push(u[d].x,A.e?1-u[d].y:u[d].y);else for(d=0;d<P.length+x;d++)for(M=0;M<R+K;M++)U=0!=z[d]?J[d][M]/z[d]:0,e=0!=Z[M]?B[M][d]/Z[M]:0,N?L.push(e,U):L.push(U,A.e?1-e:e);d=0;let W=0,b=y[d]-1,v=y[d+1]-1,s=b<v?b:v,X=O[1]-O[0];const m=y.length-1;for(;W<=s&&d<m;)t.push(W,W+X,W+1),t.push(W+X+1,W+1,W+X),W+=1,W===s&&(d++,X=O[d+1]-O[d],b=y[d]-1,v=y[d+1]-1,W=O[d],s=b<v?b+W:v+W);if(H.e.ComputeNormals(Y,t,C),c){let F=0,f=0;for(d=0;d<P.length;d++){F=3*O[d],f=d+1<P.length?3*(O[d+1]-1):C.length-3,C[F]=.5*(C[F]+C[f]),C[F+1]=.5*(C[F+1]+C[f+1]),C[F+2]=.5*(C[F+2]+C[f+2]);const c=Math.sqrt(C[F]*C[F]+C[F+1]*C[F+1]+C[F+2]*C[F+2]);C[F]/=c,C[F+1]/=c,C[F+2]/=c,C[f]=C[F],C[f+1]=C[F+1],C[f+2]=C[F+2]}}if(f){let F=3*O[0],f=3*O[P.length];for(M=0;M<R+K;M++){C[F]=.5*(C[F]+C[f]),C[F+1]=.5*(C[F+1]+C[f+1]),C[F+2]=.5*(C[F+2]+C[f+2]);const P=Math.sqrt(C[F]*C[F]+C[F+1]*C[F+1]+C[F+2]*C[F+2]);C[F]/=P,C[F+1]/=P,C[F+2]/=P,C[f]=C[F],C[f+1]=C[F+1],C[f+2]=C[F+2],F+=3,f+=3}}H.e._ComputeSides(i,Y,t,C,L,F.frontUVs,F.backUVs);let a=null;if(T){a=new Float32Array(4*T.length);for(let F=0;F<T.length;F++)a[4*F]=T[F].r,a[4*F+1]=T[F].g,a[4*F+2]=T[F].b,a[4*F+3]=T[F].a}const w=new H.e,g=new Float32Array(Y),G=new Float32Array(C),h=new Float32Array(L);return w.indices=t,w.MF=g,w.VF=G,w.KF=h,a&&w.set(a,q.f.ColorKind),c&&(w._idx=O),w}function j(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=P.pathArray,i=P.closeArray,u=P.closePath,T=N.d._GetDefaultSideOrientation(P.sideOrientation),Y=P.instance,t=P.updatable;if(Y){const F=c.TmpVectors.tP[0].Nc(Number.MAX_VALUE),f=c.TmpVectors.tP[1].Nc(-Number.MAX_VALUE),o=P=>{let c=j[0].length;const q=Y;let H=0;const A=q._originalBuilderSideOrientation===N.d.DOUBLESIDE?2:1;for(let N=1;N<=A;++N)for(let A=0;A<j.length;++A){const N=j[A],o=N.length;c=c<o?c:o;for(let q=0;q<c;++q){const c=N[q];P[H]=c.x,P[H+1]=c.y,P[H+2]=c.z,F.minimizeInPlaceFromFloats(c.x,c.y,c.z),f.maximizeInPlaceFromFloats(c.x,c.y,c.z),H+=3}if(q._creationDataStorage&&q._creationDataStorage.closePath){const F=N[0];P[H]=F.x,P[H+1]=F.y,P[H+2]=F.z,H+=3}}},i=Y.getVerticesData(q.f.PositionKind);if(o(i),Y.hasBoundingInfo?Y.getBoundingInfo().reConstruct(F,f,Y._worldMatrix):Y.buildBoundingInfo(F,f,Y._worldMatrix),Y.updateVerticesData(q.f.PositionKind,i,!1,!1),P.QF){const F=Y.getVerticesData(q.f.ColorKind);for(let f=0,c=0;f<P.QF.length;f++,c+=4){const N=P.QF[f];F[c]=N.r,F[c+1]=N.g,F[c+2]=N.b,F[c+3]=N.a}Y.updateVerticesData(q.f.ColorKind,F,!1,!1)}if(P.KF){const F=Y.getVerticesData(q.f.UVKind);for(let f=0;f<P.KF.length;f++)F[2*f]=P.KF[f].x,F[2*f+1]=A.e?1-P.KF[f].y:P.KF[f].y;Y.updateVerticesData(q.f.UVKind,F,!1,!1)}if(!Y.areNormalsFrozen||Y.isFacetDataEnabled){const F=Y.Fc(),P=Y.getVerticesData(q.f.NormalKind),f=Y.isFacetDataEnabled?Y.getFacetDataParameters():null;if(H.e.ComputeNormals(i,F,P,f),Y._creationDataStorage&&Y._creationDataStorage.closePath){let F=0,f=0;for(let c=0;c<j.length;c++)F=3*Y._creationDataStorage.idx[c],f=c+1<j.length?3*(Y._creationDataStorage.idx[c+1]-1):P.length-3,P[F]=.5*(P[F]+P[f]),P[F+1]=.5*(P[F+1]+P[f+1]),P[F+2]=.5*(P[F+2]+P[f+2]),P[f]=P[F],P[f+1]=P[F+1],P[f+2]=P[F+2]}Y.areNormalsFrozen||Y.updateVerticesData(q.f.NormalKind,P,!1,!1)}return Y}{const c=new N.d(F,f);c._originalBuilderSideOrientation=T,c._creationDataStorage=new N.g;const q=o(P);return u&&(c._creationDataStorage.idx=q._idx),c._creationDataStorage.closePath=u,c._creationDataStorage.closeArray=i,q.kF(c,t),c}}H.e.CreateRibbon=o,N.d.CreateRibbon=function(F,P){return j(F,{pathArray:P,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var i=f(12970),u=f(12824),T=f(11690);function Y(F){const P=F.pattern||N.d.NO_FLIP,f=F.tileWidth||F.tileSize||1,c=F.tileHeight||F.tileSize||1,q=F.alignHorizontal||0,A=F.alignVertical||0,o=F.width||F.size||1,j=Math.floor(o/f);let i=o-j*f;const u=F.height||F.size||1,T=Math.floor(u/c);let Y=u-T*c;const t=f*j/2,C=c*T/2;let L=0,J=0,B=0,z=0,Z=0,R=0;if(i>0||Y>0){switch(B=-t,z=-C,Z=t,R=C,q){case N.d.CENTER:i/=2,B-=i,Z+=i;break;case N.d.LEFT:Z+=i,L=-i/2;break;case N.d.RIGHT:B-=i,L=i/2}switch(A){case N.d.CENTER:Y/=2,z-=Y,R+=Y;break;case N.d.BOTTOM:R+=Y,J=-Y/2;break;case N.d.TOP:z-=Y,J=Y/2}}const y=[],O=[],d=[];d[0]=[0,0,1,0,1,1,0,1],d[1]=[0,0,1,0,1,1,0,1],P!==N.d.ROTATE_TILE&&P!==N.d.ROTATE_ROW||(d[1]=[1,1,0,1,0,0,1,0]),P!==N.d.FLIP_TILE&&P!==N.d.FLIP_ROW||(d[1]=[1,0,0,0,0,1,1,1]),P!==N.d.FLIP_N_ROTATE_TILE&&P!==N.d.FLIP_N_ROTATE_ROW||(d[1]=[0,1,1,1,1,0,0,0]);let M=[];const V=[],Q=[];let K=0;for(let H=0;H<T;H++)for(let F=0;F<j;F++)y.push(F*f-t+L,H*c-C+J,0),y.push((F+1)*f-t+L,H*c-C+J,0),y.push((F+1)*f-t+L,(H+1)*c-C+J,0),y.push(F*f-t+L,(H+1)*c-C+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),M=P===N.d.FLIP_TILE||P===N.d.ROTATE_TILE||P===N.d.FLIP_N_ROTATE_TILE?M.concat(d[(F%2+H%2)%2]):P===N.d.FLIP_ROW||P===N.d.ROTATE_ROW||P===N.d.FLIP_N_ROTATE_ROW?M.concat(d[H%2]):M.concat(d[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),K+=4;if(i>0||Y>0){const F=Y>0&&(A===N.d.CENTER||A===N.d.TOP),H=Y>0&&(A===N.d.CENTER||A===N.d.BOTTOM),o=i>0&&(q===N.d.CENTER||q===N.d.RIGHT),u=i>0&&(q===N.d.CENTER||q===N.d.LEFT);let d,x,k,I,E=[];if(F&&o&&(y.push(B+L,z+J,0),y.push(-t+L,z+J,0),y.push(-t+L,z+Y+J,0),y.push(B+L,z+Y+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,d=1-i/f,x=1-Y/c,k=1,I=1,E=[d,x,k,x,k,I,d,I],P===N.d.ROTATE_ROW&&(E=[1-d,1-x,1-k,1-x,1-k,1-I,1-d,1-I]),P===N.d.FLIP_ROW&&(E=[1-d,x,1-k,x,1-k,I,1-d,I]),P===N.d.FLIP_N_ROTATE_ROW&&(E=[d,1-x,k,1-x,k,1-I,d,1-I]),M=M.concat(E),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&u&&(y.push(t+L,z+J,0),y.push(Z+L,z+J,0),y.push(Z+L,z+Y+J,0),y.push(t+L,z+Y+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,d=0,x=1-Y/c,k=i/f,I=1,E=[d,x,k,x,k,I,d,I],(P===N.d.ROTATE_ROW||P===N.d.ROTATE_TILE&&j%2===0)&&(E=[1-d,1-x,1-k,1-x,1-k,1-I,1-d,1-I]),(P===N.d.FLIP_ROW||P===N.d.FLIP_TILE&&j%2===0)&&(E=[1-d,x,1-k,x,1-k,I,1-d,I]),(P===N.d.FLIP_N_ROTATE_ROW||P===N.d.FLIP_N_ROTATE_TILE&&j%2===0)&&(E=[d,1-x,k,1-x,k,1-I,d,1-I]),M=M.concat(E),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&o&&(y.push(B+L,C+J,0),y.push(-t+L,C+J,0),y.push(-t+L,R+J,0),y.push(B+L,R+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,d=1-i/f,x=0,k=1,I=Y/c,E=[d,x,k,x,k,I,d,I],(P===N.d.ROTATE_ROW&&T%2===1||P===N.d.ROTATE_TILE&&T%1===0)&&(E=[1-d,1-x,1-k,1-x,1-k,1-I,1-d,1-I]),(P===N.d.FLIP_ROW&&T%2===1||P===N.d.FLIP_TILE&&T%2===0)&&(E=[1-d,x,1-k,x,1-k,I,1-d,I]),(P===N.d.FLIP_N_ROTATE_ROW&&T%2===1||P===N.d.FLIP_N_ROTATE_TILE&&T%2===0)&&(E=[d,1-x,k,1-x,k,1-I,d,1-I]),M=M.concat(E),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&u&&(y.push(t+L,C+J,0),y.push(Z+L,C+J,0),y.push(Z+L,R+J,0),y.push(t+L,R+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,d=0,x=0,k=i/f,I=Y/c,E=[d,x,k,x,k,I,d,I],(P===N.d.ROTATE_ROW&&T%2===1||P===N.d.ROTATE_TILE&&(T+j)%2===1)&&(E=[1-d,1-x,1-k,1-x,1-k,1-I,1-d,1-I]),(P===N.d.FLIP_ROW&&T%2===1||P===N.d.FLIP_TILE&&(T+j)%2===1)&&(E=[1-d,x,1-k,x,1-k,I,1-d,I]),(P===N.d.FLIP_N_ROTATE_ROW&&T%2===1||P===N.d.FLIP_N_ROTATE_TILE&&(T+j)%2===1)&&(E=[d,1-x,k,1-x,k,1-I,d,1-I]),M=M.concat(E),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F){const F=[];d=0,x=1-Y/c,k=1,I=1,F[0]=[d,x,k,x,k,I,d,I],F[1]=[d,x,k,x,k,I,d,I],P!==N.d.ROTATE_TILE&&P!==N.d.ROTATE_ROW||(F[1]=[1-d,1-x,1-k,1-x,1-k,1-I,1-d,1-I]),P!==N.d.FLIP_TILE&&P!==N.d.FLIP_ROW||(F[1]=[1-d,x,1-k,x,1-k,I,1-d,I]),P!==N.d.FLIP_N_ROTATE_TILE&&P!==N.d.FLIP_N_ROTATE_ROW||(F[1]=[d,1-x,k,1-x,k,1-I,d,1-I]);for(let c=0;c<j;c++)y.push(c*f-t+L,z+J,0),y.push((c+1)*f-t+L,z+J,0),y.push((c+1)*f-t+L,z+Y+J,0),y.push(c*f-t+L,z+Y+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,M=P===N.d.FLIP_TILE||P===N.d.ROTATE_TILE||P===N.d.FLIP_N_ROTATE_TILE?M.concat(F[(c+1)%2]):P===N.d.FLIP_ROW||P===N.d.ROTATE_ROW||P===N.d.FLIP_N_ROTATE_ROW?M.concat(F[1]):M.concat(F[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const F=[];d=0,x=0,k=1,I=Y/c,F[0]=[d,x,k,x,k,I,d,I],F[1]=[d,x,k,x,k,I,d,I],P!==N.d.ROTATE_TILE&&P!==N.d.ROTATE_ROW||(F[1]=[1-d,1-x,1-k,1-x,1-k,1-I,1-d,1-I]),P!==N.d.FLIP_TILE&&P!==N.d.FLIP_ROW||(F[1]=[1-d,x,1-k,x,1-k,I,1-d,I]),P!==N.d.FLIP_N_ROTATE_TILE&&P!==N.d.FLIP_N_ROTATE_ROW||(F[1]=[d,1-x,k,1-x,k,1-I,d,1-I]);for(let c=0;c<j;c++)y.push(c*f-t+L,R-Y+J,0),y.push((c+1)*f-t+L,R-Y+J,0),y.push((c+1)*f-t+L,R+J,0),y.push(c*f-t+L,R+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,M=P===N.d.FLIP_TILE||P===N.d.ROTATE_TILE||P===N.d.FLIP_N_ROTATE_TILE?M.concat(F[(c+T)%2]):P===N.d.FLIP_ROW||P===N.d.ROTATE_ROW||P===N.d.FLIP_N_ROTATE_ROW?M.concat(F[T%2]):M.concat(F[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(o){const F=[];d=1-i/f,x=0,k=1,I=1,F[0]=[d,x,k,x,k,I,d,I],F[1]=[d,x,k,x,k,I,d,I],P!==N.d.ROTATE_TILE&&P!==N.d.ROTATE_ROW||(F[1]=[1-d,1-x,1-k,1-x,1-k,1-I,1-d,1-I]),P!==N.d.FLIP_TILE&&P!==N.d.FLIP_ROW||(F[1]=[1-d,x,1-k,x,1-k,I,1-d,I]),P!==N.d.FLIP_N_ROTATE_TILE&&P!==N.d.FLIP_N_ROTATE_ROW||(F[1]=[d,1-x,k,1-x,k,1-I,d,1-I]);for(let f=0;f<T;f++)y.push(B+L,f*c-C+J,0),y.push(B+i+L,f*c-C+J,0),y.push(B+i+L,(f+1)*c-C+J,0),y.push(B+L,(f+1)*c-C+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,M=P===N.d.FLIP_TILE||P===N.d.ROTATE_TILE||P===N.d.FLIP_N_ROTATE_TILE?M.concat(F[(f+1)%2]):P===N.d.FLIP_ROW||P===N.d.ROTATE_ROW||P===N.d.FLIP_N_ROTATE_ROW?M.concat(F[f%2]):M.concat(F[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const F=[];d=0,x=0,k=i/c,I=1,F[0]=[d,x,k,x,k,I,d,I],F[1]=[d,x,k,x,k,I,d,I],P!==N.d.ROTATE_TILE&&P!==N.d.ROTATE_ROW||(F[1]=[1-d,1-x,1-k,1-x,1-k,1-I,1-d,1-I]),P!==N.d.FLIP_TILE&&P!==N.d.FLIP_ROW||(F[1]=[1-d,x,1-k,x,1-k,I,1-d,I]),P!==N.d.FLIP_N_ROTATE_TILE&&P!==N.d.FLIP_N_ROTATE_ROW||(F[1]=[d,1-x,k,1-x,k,1-I,d,1-I]);for(let f=0;f<T;f++)y.push(Z-i+L,f*c-C+J,0),y.push(Z+L,f*c-C+J,0),y.push(Z+L,(f+1)*c-C+J,0),y.push(Z-i+L,(f+1)*c-C+J,0),Q.push(K,K+1,K+3,K+1,K+2,K+3),K+=4,M=P===N.d.FLIP_TILE||P===N.d.ROTATE_TILE||P===N.d.FLIP_N_ROTATE_TILE?M.concat(F[(f+j)%2]):P===N.d.FLIP_ROW||P===N.d.ROTATE_ROW||P===N.d.FLIP_N_ROTATE_ROW?M.concat(F[f%2]):M.concat(F[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const x=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE;H.e._ComputeSides(x,y,Q,O,M,F.frontUVs,F.backUVs);const k=new H.e;k.indices=Q,k.MF=y,k.VF=O,k.KF=M;const I=x===H.e.DOUBLESIDE?V.concat(V):V;return k.QF=I,k}function t(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new N.d(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return Y(P).kF(c,P.updatable),c}function C(F){const P=F.faceUV||new Array(6),f=F.faceColors,q=F.pattern||N.d.NO_FLIP,o=F.width||F.size||1,j=F.height||F.size||1,i=F.depth||F.size||1,u=F.tileWidth||F.tileSize||1,t=F.tileHeight||F.tileSize||1,C=F.alignHorizontal||0,L=F.alignVertical||0,J=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE;for(let N=0;N<6;N++)void 0===P[N]&&(P[N]=new c.Vector4(0,0,1,1)),f&&void 0===f[N]&&(f[N]=new T.qc(1,1,1,1));const B=o/2,z=j/2,Z=i/2,R=[];for(let c=0;c<2;c++)R[c]=Y({pattern:q,tileWidth:u,tileHeight:t,width:o,height:j,alignVertical:L,alignHorizontal:C,sideOrientation:J});for(let c=2;c<4;c++)R[c]=Y({pattern:q,tileWidth:u,tileHeight:t,width:i,height:j,alignVertical:L,alignHorizontal:C,sideOrientation:J});let y=L;L===N.d.BOTTOM?y=N.d.TOP:L===N.d.TOP&&(y=N.d.BOTTOM);for(let c=4;c<6;c++)R[c]=Y({pattern:q,tileWidth:u,tileHeight:t,width:o,height:i,alignVertical:y,alignHorizontal:C,sideOrientation:J});let O=[],d=[],M=[],V=[];const Q=[],K=[],x=[],k=[];let I=0,E=0;for(let N=0;N<6;N++){const F=R[N].MF.length;K[N]=[],x[N]=[];for(let P=0;P<F/3;P++)K[N].push(new c.tP(R[N].MF[3*P],R[N].MF[3*P+1],R[N].MF[3*P+2])),x[N].push(new c.tP(R[N].VF[3*P],R[N].VF[3*P+1],R[N].VF[3*P+2]));I=R[N].KF.length,k[N]=[];for(let f=0;f<I;f+=2)k[N][f]=P[N].x+(P[N].z-P[N].x)*R[N].KF[f],k[N][f+1]=P[N].y+(P[N].w-P[N].y)*R[N].KF[f+1],A.e&&(k[N][f+1]=1-k[N][f+1]);if(M=M.concat(k[N]),V=V.concat(R[N].indices.map((F=>F+E))),E+=K[N].length,f)for(let P=0;P<4;P++)Q.push(f[N].r,f[N].g,f[N].b,f[N].a)}const r=new c.tP(0,0,Z),n=c.Matrix.RotationY(Math.PI);O=K[0].map((F=>c.tP.TransformNormal(F,n).add(r))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[]),d=x[0].map((F=>c.tP.TransformNormal(F,n))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[]),O=O.concat(K[1].map((F=>F.CP(r))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[])),d=d.concat(x[1].map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[]));const p=new c.tP(B,0,0),U=c.Matrix.RotationY(-Math.PI/2);O=O.concat(K[2].map((F=>c.tP.TransformNormal(F,U).add(p))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[])),d=d.concat(x[2].map((F=>c.tP.TransformNormal(F,U))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[]));const e=c.Matrix.RotationY(Math.PI/2);O=O.concat(K[3].map((F=>c.tP.TransformNormal(F,e).CP(p))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[])),d=d.concat(x[3].map((F=>c.tP.TransformNormal(F,e))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[]));const D=new c.tP(0,z,0),l=c.Matrix.RotationX(Math.PI/2);O=O.concat(K[4].map((F=>c.tP.TransformNormal(F,l).add(D))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[])),d=d.concat(x[4].map((F=>c.tP.TransformNormal(F,l))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[]));const W=c.Matrix.RotationX(-Math.PI/2);O=O.concat(K[5].map((F=>c.tP.TransformNormal(F,W).CP(D))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[])),d=d.concat(x[5].map((F=>c.tP.TransformNormal(F,W))).map((F=>[F.x,F.y,F.z])).reduce(((F,P)=>F.concat(P)),[])),H.e._ComputeSides(J,O,V,d,M);const b=new H.e;if(b.indices=V,b.MF=O,b.VF=d,b.KF=M,f){const F=J===H.e.DOUBLESIDE?Q.concat(Q):Q;b.QF=F}return b}function L(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new N.d(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return C(P).kF(c,P.updatable),c}H.e.CreateTiledPlane=Y;H.e.CreateTiledBox=C;var J=f(12957),B=f(11845),z=f(11812);function Z(F){const P=F.height||2;let f=0===F.diameterTop?0:F.diameterTop||F.diameter||1,q=0===F.diameterBottom?0:F.diameterBottom||F.diameter||1;f=f||1e-5,q=q||1e-5;const o=0|(F.tessellation||24),j=0|(F.subdivisions||1),i=!!F.hasRings,u=!!F.enclose,Y=0===F.cap?0:F.cap||N.d.CAP_ALL,t=F.arc&&(F.arc<=0||F.arc>1)?1:F.arc||1,C=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE,L=F.faceUV||new Array(3),J=F.faceColors,B=2+(1+(1!==t&&u?2:0))*(i?j:1);let Z;for(Z=0;Z<B;Z++)J&&void 0===J[Z]&&(J[Z]=new T.qc(1,1,1,1));for(Z=0;Z<B;Z++)L&&void 0===L[Z]&&(L[Z]=new c.Vector4(0,0,1,1));const R=[],y=[],O=[],d=[],M=[],V=2*Math.PI*t/o;let Q,K,x;const k=(q-f)/2/P,I=c.tP.Zero(),E=c.tP.Zero(),r=c.tP.Zero(),n=c.tP.Zero(),p=c.tP.Zero(),U=z.b.Y;let e,D,l,W=1,b=1,v=0,s=0;for(e=0;e<=j;e++)for(K=e/j,x=(K*(f-q)+q)/2,W=i&&0!==e&&e!==j?2:1,l=0;l<W;l++){for(i&&(b+=l),u&&(b+=2*l),D=0;D<=o;D++)Q=D*V,I.x=Math.cos(-Q)*x,I.y=-P/2+K*P,I.z=Math.sin(-Q)*x,0===f&&e===j?(E.x=O[O.length-3*(o+1)],E.y=O[O.length-3*(o+1)+1],E.z=O[O.length-3*(o+1)+2]):(E.x=I.x,E.z=I.z,E.y=Math.sqrt(E.x*E.x+E.z*E.z)*k,E.normalize()),0===D&&(r.q(I),n.q(E)),y.push(I.x,I.y,I.z),O.push(E.x,E.y,E.z),s=i?v!==b?L[b].y:L[b].w:L[b].y+(L[b].w-L[b].y)*K,d.push(L[b].x+(L[b].z-L[b].x)*D/o,A.e?1-s:s),J&&M.push(J[b].r,J[b].g,J[b].b,J[b].a);1!==t&&u&&(y.push(I.x,I.y,I.z),y.push(0,I.y,0),y.push(0,I.y,0),y.push(r.x,r.y,r.z),c.tP.CrossToRef(U,E,p),p.normalize(),O.push(p.x,p.y,p.z,p.x,p.y,p.z),c.tP.CrossToRef(n,U,p),p.normalize(),O.push(p.x,p.y,p.z,p.x,p.y,p.z),s=i?v!==b?L[b+1].y:L[b+1].w:L[b+1].y+(L[b+1].w-L[b+1].y)*K,d.push(L[b+1].x,A.e?1-s:s),d.push(L[b+1].z,A.e?1-s:s),s=i?v!==b?L[b+2].y:L[b+2].w:L[b+2].y+(L[b+2].w-L[b+2].y)*K,d.push(L[b+2].x,A.e?1-s:s),d.push(L[b+2].z,A.e?1-s:s),J&&(M.push(J[b+1].r,J[b+1].g,J[b+1].b,J[b+1].a),M.push(J[b+1].r,J[b+1].g,J[b+1].b,J[b+1].a),M.push(J[b+2].r,J[b+2].g,J[b+2].b,J[b+2].a),M.push(J[b+2].r,J[b+2].g,J[b+2].b,J[b+2].a))),v!==b&&(v=b)}const X=1!==t&&u?o+4:o;for(e=0,b=0;b<j;b++){let F=0,P=0,f=0,c=0;for(D=0;D<o;D++)F=e*(X+1)+D,P=(e+1)*(X+1)+D,f=e*(X+1)+(D+1),c=(e+1)*(X+1)+(D+1),R.push(F,P,f),R.push(c,f,P);1!==t&&u&&(R.push(F+2,P+2,f+2),R.push(c+2,f+2,P+2),R.push(F+4,P+4,f+4),R.push(c+4,f+4,P+4)),e=i?e+2:e+1}const m=F=>{const N=F?f/2:q/2;if(0===N)return;let H,j,i;const u=F?L[B-1]:L[0];let T=null;J&&(T=F?J[B-1]:J[0]);const Y=y.length/3,C=F?P/2:-P/2,z=new c.tP(0,C,0);y.push(z.x,z.y,z.z),O.push(0,F?1:-1,0);const Z=u.y+.5*(u.w-u.y);d.push(u.x+.5*(u.z-u.x),A.e?1-Z:Z),T&&M.push(T.r,T.g,T.b,T.a);const V=new c.Vector2(.5,.5);for(i=0;i<=o;i++){H=2*Math.PI*i*t/o;const P=Math.cos(-H),f=Math.sin(-H);j=new c.tP(P*N,C,f*N);const q=new c.Vector2(P*V.x+.5,f*V.y+.5);y.push(j.x,j.y,j.z),O.push(0,F?1:-1,0);const Y=u.y+(u.w-u.y)*q.y;d.push(u.x+(u.z-u.x)*q.x,A.e?1-Y:Y),T&&M.push(T.r,T.g,T.b,T.a)}for(i=0;i<o;i++)F?(R.push(Y),R.push(Y+(i+2)),R.push(Y+(i+1))):(R.push(Y),R.push(Y+(i+1)),R.push(Y+(i+2)))};Y!==N.d.CAP_START&&Y!==N.d.CAP_ALL||m(!1),Y!==N.d.CAP_END&&Y!==N.d.CAP_ALL||m(!0),H.e._ComputeSides(C,y,R,O,d,F.frontUVs,F.backUVs);const a=new H.e;return a.indices=R,a.MF=y,a.VF=O,a.KF=d,J&&(a.QF=M),a}function R(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const c=new N.d(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return Z(P).kF(c,P.updatable),c}function y(F){const P=[],f=[],N=[],q=[],o=F.diameter||1,j=F.thickness||.5,i=0|(F.tessellation||16),u=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE,T=i+1;for(let H=0;H<=i;H++){const F=H/i,u=H*Math.PI*2/i-Math.PI/2,Y=c.Matrix.Translation(o/2,0,0).multiply(c.Matrix.RotationY(u));for(let o=0;o<=i;o++){const u=1-o/i,t=o*Math.PI*2/i+Math.PI,C=Math.cos(t),L=Math.sin(t);let J=new c.tP(C,L,0),B=J.scale(j/2);const z=new c.Vector2(F,u);B=c.tP.TransformCoordinates(B,Y),J=c.tP.TransformNormal(J,Y),f.push(B.x,B.y,B.z),N.push(J.x,J.y,J.z),q.push(z.x,A.e?1-z.y:z.y);const Z=(H+1)%T,R=(o+1)%T;P.push(H*T+o),P.push(H*T+R),P.push(Z*T+o),P.push(H*T+R),P.push(Z*T+R),P.push(Z*T+o)}}H.e._ComputeSides(u,f,P,N,q,F.frontUVs,F.backUVs);const Y=new H.e;return Y.indices=P,Y.MF=f,Y.VF=N,Y.KF=q,Y}function O(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const c=new N.d(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return y(P).kF(c,P.updatable),c}H.e.CreateCylinder=Z,N.d.CreateCylinder=(F,P,f,c,q,H,A,o,j)=>{void 0!==A&&A instanceof B.e||(void 0!==A&&(j=o||N.d.DEFAULTSIDE,o=A),A=H,H=1);return R(F,{height:P,diameterTop:f,diameterBottom:c,tessellation:q,subdivisions:H,sideOrientation:j,updatable:o},A)};function d(F){const P=[],f=[],N=[],q=[],o=F.radius||2,j=F.tube||.5,i=F.radialSegments||32,u=F.tubularSegments||32,T=F.p||2,Y=F.q||3,t=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE,C=F=>{const P=Math.cos(F),f=Math.sin(F),N=Y/T*F,q=Math.cos(N),H=o*(2+q)*.5*P,A=o*(2+q)*f*.5,j=o*Math.sin(N)*.5;return new c.tP(H,A,j)};let L,J;for(L=0;L<=i;L++){const F=L%i/i*2*T*Math.PI,P=C(F),N=C(F+.01),H=N.CP(P);let o=N.add(P);const Y=c.tP.Cross(H,o);for(o=c.tP.Cross(Y,H),Y.normalize(),o.normalize(),J=0;J<u;J++){const F=J%u/u*2*Math.PI,c=-j*Math.cos(F),N=j*Math.sin(F);f.push(P.x+c*o.x+N*Y.x),f.push(P.y+c*o.y+N*Y.y),f.push(P.z+c*o.z+N*Y.z),q.push(L/i),q.push(A.e?1-J/u:J/u)}}for(L=0;L<i;L++)for(J=0;J<u;J++){const F=(J+1)%u,f=L*u+J,c=(L+1)*u+J,N=(L+1)*u+F,q=L*u+F;P.push(q),P.push(c),P.push(f),P.push(q),P.push(N),P.push(c)}H.e.ComputeNormals(f,P,N),H.e._ComputeSides(t,f,P,N,q,F.frontUVs,F.backUVs);const B=new H.e;return B.indices=P,B.MF=f,B.VF=N,B.KF=q,B}function M(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const c=new N.d(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return d(P).kF(c,P.updatable),c}H.e.CreateTorus=y,N.d.CreateTorus=(F,P,f,c,N,q,H)=>O(F,{diameter:P,thickness:f,tessellation:c,sideOrientation:H,updatable:q},N);H.e.CreateTorusKnot=d,N.d.CreateTorusKnot=(F,P,f,c,N,q,H,A,o,j)=>M(F,{radius:P,tube:f,radialSegments:c,tubularSegments:N,p:q,q:H,sideOrientation:j,updatable:o},A);var V=f(13448),Q=f(12184),K=f(11826);function x(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=P.path,q=P.shape,H=P.scale||1,A=P.rotation||0,o=0===P.cap?0:P.cap||N.d.NO_CAP,j=P.updatable,i=N.d._GetDefaultSideOrientation(P.sideOrientation),u=P.instance||null,T=P.invertUV||!1,Y=P.closeShape||!1,t=P.closePath||!1,C=P.capFunction||null;return I(F,q,c,H,A,null,null,t,Y,o,!1,f,!!j,i,u,T,P.frontUVs||null,P.backUVs||null,P.firstNormal||null,!!P.adjustFrame,C)}function k(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=P.path,q=P.shape,H=P.scaleFunction||(()=>1),A=P.rotationFunction||(()=>0),o=P.closePath||P.ribbonCloseArray||!1,j=P.closeShape||P.ribbonClosePath||!1,i=0===P.cap?0:P.cap||N.d.NO_CAP,u=P.updatable,T=P.firstNormal||null,Y=P.adjustFrame||!1,t=N.d._GetDefaultSideOrientation(P.sideOrientation),C=P.instance,L=P.invertUV||!1,J=P.capFunction||null;return I(F,q,c,null,null,H,A,o,j,i,!0,f,!!u,t,C||null,L,P.frontUVs||null,P.backUVs||null,T,Y,J||null)}function I(F,P,f,q,H,A,o,i,u,T,Y,t,C,L,J,B,z,Z,R,y,O){const d=(F,P,f,q,H,A,o,j,i,u,T)=>{const Y=f.getTangents(),t=f.getNormals(),C=f.getBinormals(),L=f.getDistances();if(T)for(let N=0;N<Y.length;N++)if(0==Y[N].x&&0==Y[N].y&&0==Y[N].z&&Y[N].q(Y[N-1]),0==t[N].x&&0==t[N].y&&0==t[N].z&&t[N].q(t[N-1]),0==C[N].x&&0==C[N].y&&0==C[N].z&&C[N].q(C[N-1]),N>0){let F=Y[N-1];c.tP.Dot(F,Y[N])<0&&Y[N].scaleInPlace(-1),F=t[N-1],c.tP.Dot(F,t[N])<0&&t[N].scaleInPlace(-1),F=C[N-1],c.tP.Dot(F,C[N])<0&&C[N].scaleInPlace(-1)}let J=0;const B=u&&j?j:()=>null!==A?A:0,z=u&&o?o:()=>null!==H?H:1;let Z=i===N.d.NO_CAP||i===N.d.CAP_END?0:2;const R=c.TmpVectors.Matrix[0];for(let N=0;N<P.length;N++){const f=[],H=B(N,L[N]),A=z(N,L[N]);c.Matrix.RotationAxisToRef(Y[N],J,R);for(let q=0;q<F.length;q++){const H=Y[N].scale(F[q].z).add(t[N].scale(F[q].x)).add(C[N].scale(F[q].y)),o=c.tP.Zero();c.tP.TransformCoordinatesToRef(H,R,o),o.scaleInPlace(A).addInPlace(P[N]),f[q]=o}q[Z]=f,J+=H,Z++}const y=O||(F=>{const P=Array(),f=c.tP.Zero();let N;for(N=0;N<F.length;N++)f.addInPlace(F[N]);for(f.scaleInPlace(1/F.length),N=0;N<F.length;N++)P.push(f);return P});switch(i){case N.d.NO_CAP:break;case N.d.CAP_START:q[0]=y(q[2]),q[1]=q[2];break;case N.d.CAP_END:q[Z]=q[Z-1],q[Z+1]=y(q[Z-1]);break;case N.d.CAP_ALL:q[0]=y(q[2]),q[1]=q[2],q[Z]=q[Z-1],q[Z+1]=y(q[Z-1])}return q};let M,V;if(J){const F=J._creationDataStorage;return M=R?F.path3D.update(f,R):F.path3D.update(f),V=d(P,f,F.path3D,F.pathArray,q,H,A,o,F.cap,Y,y),J=j("",{pathArray:V,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:J},t||void 0)}M=R?new K.g(f,R):new K.g(f);V=d(P,f,M,new Array,q,H,A,o,T=T<0||T>3?0:T,Y,y);const Q=j(F,{pathArray:V,closeArray:i,closePath:u,updatable:C,sideOrientation:L,invertUV:B,frontUVs:z||void 0,backUVs:Z||void 0},t);return Q._creationDataStorage.pathArray=V,Q._creationDataStorage.path3D=M,Q._creationDataStorage.cap=T,Q}function E(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=P.arc?P.arc<=0||P.arc>1?1:P.arc:1,H=void 0===P.closed||P.closed,A=P.shape,o=P.radius||1,i=P.tessellation||64,u=P.clip||0,T=P.updatable,Y=N.d._GetDefaultSideOrientation(P.sideOrientation),t=P.cap||N.d.NO_CAP,C=2*Math.PI,L=[],J=P.invertUV||!1;let B=0,z=0;const Z=C/i*q;let R,y;for(B=0;B<=i-u;B++){for(y=[],t!=N.d.CAP_START&&t!=N.d.CAP_ALL||(y.push(new c.tP(0,A[0].y,0)),y.push(new c.tP(Math.cos(B*Z)*A[0].x*o,A[0].y,Math.sin(B*Z)*A[0].x*o))),z=0;z<A.length;z++)R=new c.tP(Math.cos(B*Z)*A[z].x*o,A[z].y,Math.sin(B*Z)*A[z].x*o),y.push(R);t!=N.d.CAP_END&&t!=N.d.CAP_ALL||(y.push(new c.tP(Math.cos(B*Z)*A[A.length-1].x*o,A[A.length-1].y,Math.sin(B*Z)*A[A.length-1].x*o)),y.push(new c.tP(0,A[A.length-1].y,0))),L.push(y)}return j(F,{pathArray:L,closeArray:H,sideOrientation:Y,updatable:T,invertUV:J,frontUVs:P.frontUVs,backUVs:P.backUVs},f)}N.d.ExtrudeShape=function(F,P,f,c,q,H){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7?arguments[7]:void 0,j=arguments.length>8?arguments[8]:void 0,i=arguments.length>9?arguments[9]:void 0;return x(F,{shape:P,path:f,scale:c,rotation:q,cap:0===H?0:H||N.d.NO_CAP,sideOrientation:j,instance:i,updatable:o},A)},N.d.ExtrudeShapeCustom=(F,P,f,c,q,H,A,o,j,i,u,T)=>k(F,{shape:P,path:f,scaleFunction:c,rotationFunction:q,ribbonCloseArray:H,ribbonClosePath:A,cap:0===o?0:o||N.d.NO_CAP,sideOrientation:u,instance:T,updatable:i},j);N.d.CreateLathe=(F,P,f,c,N,q,H)=>E(F,{shape:P,radius:f,tessellation:c,sideOrientation:H,updatable:q},N);var r=f(12876),n=f(12826);function p(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=P.path;let H=P.instance,A=1;void 0!==P.radius?A=P.radius:H&&(A=H._creationDataStorage.radius);const o=P.tessellation||64,i=P.radiusFunction||null;let u=P.cap||N.d.NO_CAP;const T=P.invertUV||!1,Y=P.updatable,t=N.d._GetDefaultSideOrientation(P.sideOrientation);P.arc=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1;const C=(F,P,f,q,H,A,o,j)=>{const i=P.getTangents(),u=P.getNormals(),T=P.getDistances(),Y=2*Math.PI/H*j,t=A||(()=>q);let C,L,J,B;const z=c.TmpVectors.Matrix[0];let Z=o===N.d.NO_CAP||o===N.d.CAP_END?0:2;for(let N=0;N<F.length;N++){L=t(N,T[N]),C=Array(),J=u[N];for(let P=0;P<H;P++)c.Matrix.RotationAxisToRef(i[N],Y*P,z),B=C[P]?C[P]:c.tP.Zero(),c.tP.TransformCoordinatesToRef(J,z,B),B.scaleInPlace(L).addInPlace(F[N]),C[P]=B;f[Z]=C,Z++}const R=(P,f)=>{const c=Array();for(let N=0;N<P;N++)c.push(F[f]);return c};switch(o){case N.d.NO_CAP:break;case N.d.CAP_START:f[0]=R(H,0),f[1]=f[2].slice(0);break;case N.d.CAP_END:f[Z]=f[Z-1].slice(0),f[Z+1]=R(H,F.length-1);break;case N.d.CAP_ALL:f[0]=R(H,0),f[1]=f[2].slice(0),f[Z]=f[Z-1].slice(0),f[Z+1]=R(H,F.length-1)}return f};let L,J;if(H){const F=H._creationDataStorage,f=P.arc||F.arc;return L=F.path3D.update(q),J=C(q,L,F.pathArray,A,F.tessellation,i,F.cap,f),H=j("",{pathArray:J,instance:H}),F.path3D=L,F.pathArray=J,F.arc=f,F.radius=A,H}L=new K.g(q);u=u<0||u>3?0:u,J=C(q,L,new Array,A,o,i,u,P.arc);const B=j(F,{pathArray:J,closePath:!0,closeArray:!1,updatable:Y,sideOrientation:t,invertUV:T,frontUVs:P.frontUVs,backUVs:P.backUVs},f);return B._creationDataStorage.pathArray=J,B._creationDataStorage.path3D=L,B._creationDataStorage.tessellation=o,B._creationDataStorage.cap=u,B._creationDataStorage.arc=P.arc,B._creationDataStorage.radius=A,B}function U(F){const P=[];P[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},P[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},P[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},P[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},P[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},P[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},P[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},P[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},P[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},P[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},P[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},P[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},P[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},P[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},P[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const f=F.type&&(F.type<0||F.type>=P.length)?0:F.type||0,N=F.size,q=F.sizeX||N||1,o=F.sizeY||N||1,j=F.sizeZ||N||1,i=F.custom||P[f],u=i.face.length,Y=F.faceUV||new Array(u),t=F.faceColors,C=void 0===F.flat||F.flat,L=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE,J=[],B=[],z=[],Z=[],R=[];let y=0,O=0;const d=[];let M,V,Q,K,x,k,I=0,E=0;if(C)for(E=0;E<u;E++)t&&void 0===t[E]&&(t[E]=new T.qc(1,1,1,1)),Y&&void 0===Y[E]&&(Y[E]=new c.Vector4(0,0,1,1));if(C)for(E=0;E<u;E++){const F=i.face[E].length;for(Q=2*Math.PI/F,K=.5*Math.tan(Q/2),x=.5,I=0;I<F;I++)J.push(i.vertex[i.face[E][I]][0]*q,i.vertex[i.face[E][I]][1]*o,i.vertex[i.face[E][I]][2]*j),d.push(y),y++,M=Y[E].x+(Y[E].z-Y[E].x)*(.5+K),V=Y[E].y+(Y[E].w-Y[E].y)*(x-.5),Z.push(M,A.e?1-V:V),k=K*Math.cos(Q)-x*Math.sin(Q),x=K*Math.sin(Q)+x*Math.cos(Q),K=k,t&&R.push(t[E].r,t[E].g,t[E].b,t[E].a);for(I=0;I<F-2;I++)B.push(d[0+O],d[I+2+O],d[I+1+O]);O+=F}else{for(I=0;I<i.vertex.length;I++)J.push(i.vertex[I][0]*q,i.vertex[I][1]*o,i.vertex[I][2]*j),Z.push(0,A.e?1:0);for(E=0;E<u;E++)for(I=0;I<i.face[E].length-2;I++)B.push(i.face[E][0],i.face[E][I+2],i.face[E][I+1])}H.e.ComputeNormals(J,B,z),H.e._ComputeSides(L,J,B,z,Z,F.frontUVs,F.backUVs);const r=new H.e;return r.MF=J,r.indices=B,r.VF=z,r.KF=Z,t&&C&&(r.QF=R),r}function e(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new N.d(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return U(P).kF(c,P.updatable),c}N.d.CreateTube=(F,P,f,c,N,q,H,A,o,j)=>p(F,{path:P,radius:f,tessellation:c,radiusFunction:N,arc:1,cap:q,updatable:A,sideOrientation:o,instance:j},H);function D(F){const P=F.sideOrientation||H.e.DEFAULTSIDE,f=F.radius||1,N=void 0===F.flat||F.flat,q=0|(F.subdivisions||4),o=F.radiusX||f,j=F.radiusY||f,i=F.radiusZ||f,u=(1+Math.sqrt(5))/2,T=[-1,u,-0,1,u,0,-1,-u,0,1,-u,0,0,-1,-u,0,1,-u,0,-1,u,0,1,u,u,0,1,u,0,-1,-u,0,1,-u,0,-1],Y=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],t=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],C=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],L=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],J=[],B=[],z=[],Z=[];let R=0;const y=new Array(3),O=new Array(3);let d;for(d=0;d<3;d++)y[d]=c.tP.Zero(),O[d]=c.Vector2.Zero();for(let H=0;H<20;H++){for(d=0;d<3;d++){const F=Y[3*H+d];y[d].fc(T[3*t[F]],T[3*t[F]+1],T[3*t[F]+2]),y[d].normalize(),O[d].fc(.134765625*C[2*F]+.05859375+-.0390625*L[H],.2333984375*C[2*F+1]+.025390625+.01953125*L[H])}const F=(F,P,f,H)=>{const u=c.tP.Lerp(y[0],y[2],P/q),T=c.tP.Lerp(y[1],y[2],P/q),Y=q===P?y[2]:c.tP.Lerp(u,T,F/(q-P));let t;if(Y.normalize(),N){const F=c.tP.Lerp(y[0],y[2],H/q),P=c.tP.Lerp(y[1],y[2],H/q);t=c.tP.Lerp(F,P,f/(q-H))}else t=new c.tP(Y.x,Y.y,Y.z);t.x/=o,t.y/=j,t.z/=i,t.normalize();const C=c.Vector2.Lerp(O[0],O[2],P/q),L=c.Vector2.Lerp(O[1],O[2],P/q),d=q===P?O[2]:c.Vector2.Lerp(C,L,F/(q-P));B.push(Y.x*o,Y.y*j,Y.z*i),z.push(t.x,t.y,t.z),Z.push(d.x,A.e?1-d.y:d.y),J.push(R),R++};for(let P=0;P<q;P++)for(let f=0;f+P<q;f++)F(f,P,f+1/3,P+1/3),F(f+1,P,f+1/3,P+1/3),F(f,P+1,f+1/3,P+1/3),f+P+1<q&&(F(f+1,P,f+2/3,P+2/3),F(f+1,P+1,f+2/3,P+2/3),F(f,P+1,f+2/3,P+2/3))}H.e._ComputeSides(P,B,J,z,Z,F.frontUVs,F.backUVs);const M=new H.e;return M.indices=J,M.MF=B,M.VF=z,M.KF=Z,M}function l(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new N.d(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),c._originalBuilderSideOrientation=P.sideOrientation;return D(P).kF(c,P.updatable),c}H.e.CreatePolyhedron=U,N.d.CreatePolyhedron=(F,P,f)=>e(F,P,f);H.e.CreateIcoSphere=D,N.d.CreateIcoSphere=(F,P,f)=>l(F,P,f);var W=f(11664);const b=new c.tP(1,0,0),v=new c.tP(-1,0,0),s=new c.tP(0,1,0),X=new c.tP(0,-1,0),m=new c.tP(0,0,1),a=new c.tP(0,0,-1);class w{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.tP.Zero(),P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.tP.Up(),f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.Vector2.Zero(),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=F,this.normal=P,this.uv=f,this.vertexIdx=N,this.vertexIdxForBones=q,this.localPositionOverride=H,this.localNormalOverride=A,this.matrixIndicesOverride=o,this.matrixWeightsOverride=j}clone(){var F,P,f,c;return new w(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(F=this.localPositionOverride)||void 0===F?void 0:F.slice(),null===(P=this.localNormalOverride)||void 0===P?void 0:P.slice(),null===(f=this.matrixIndicesOverride)||void 0===f?void 0:f.slice(),null===(c=this.matrixWeightsOverride)||void 0===c?void 0:c.slice())}}function g(F,P,f){var o,j,i,u,T;const Y=!!P.skeleton,t=!(null===(o=P.morphTargetManager)||void 0===o||!o.numTargets),C=f.localMode||Y,L=P.Fc(),J=Y||t?P.No(!0,!0):P.getVerticesData(q.f.PositionKind),B=Y||t?P.getNormalsData(!0,!0):P.getVerticesData(q.f.NormalKind),z=C?Y?P.getVerticesData(q.f.PositionKind):J:null,Z=C?Y?P.getVerticesData(q.f.NormalKind):B:null,R=P.getVerticesData(q.f.UVKind),y=Y?P.getVerticesData(q.f.MatricesIndicesKind):null,O=Y?P.getVerticesData(q.f.MatricesWeightsKind):null,d=Y?P.getVerticesData(q.f.MatricesIndicesExtraKind):null,M=Y?P.getVerticesData(q.f.MatricesWeightsExtraKind):null,V=f.position||c.tP.Zero();let Q=f.normal||c.tP.Up();const K=f.size||c.tP.One(),x=f.angle||0;if(!Q){const F=new c.tP(0,0,1),f=P.OF().activeCamera,N=c.tP.TransformCoordinates(F,f.getWorldMatrix());Q=f.globalPosition.CP(N)}const k=-Math.atan2(Q.z,Q.x)-Math.PI/2,I=Math.sqrt(Q.x*Q.x+Q.z*Q.z),E=Math.atan2(Q.y,I),r=new H.e;r.indices=[],r.MF=[],r.VF=[],r.KF=[],r.matricesIndices=Y?[]:null,r.matricesWeights=Y?[]:null,r.matricesIndicesExtra=d?[]:null,r.matricesWeightsExtra=M?[]:null;let n=0;const p=(F,P)=>{const N=new w;if(!L||!J||!B)return N;const q=L[F];if(N.vertexIdx=3*q,N.vertexIdxForBones=4*q,N.position=new c.tP(J[3*q],J[3*q+1],J[3*q+2]),c.tP.TransformCoordinatesToRef(N.position,P,N.position),N.normal=new c.tP(B[3*q],B[3*q+1],B[3*q+2]),c.tP.TransformNormalToRef(N.normal,P,N.normal),f.captureUVS&&R){const F=R[2*q+1];N.uv=new c.Vector2(R[2*q],A.e?1-F:F)}return N},U=[0,0,0,0],e=(F,P)=>{if(0===F.length)return F;const f=.5*Math.abs(c.tP.Dot(K,P)),N=(F,P,f,c)=>{for(let N=0;N<c;++N)if(F[f+N]===P)return f+N;return-1},q=(F,q)=>{const H=c.tP.GetClipFactor(F.position,q.position,P,f);let A=U,o=U;if(y&&O){const P=F.matrixIndicesOverride?0:F.vertexIdxForBones,f=F.matrixIndicesOverride??y,c=F.matrixWeightsOverride??O,j=q.matrixIndicesOverride?0:q.vertexIdxForBones,i=q.matrixIndicesOverride??y,u=q.matrixWeightsOverride??O;A=[0,0,0,0],o=[0,0,0,0];let T=0;for(let F=0;F<4;++F)if(c[P+F]>0){const q=N(i,f[P+F],j,4);A[T]=f[P+F],o[T]=(0,W.Lerp)(c[P+F],q>=0?u[q]:0,H),T++}for(let F=0;F<4&&T<4;++F){const c=i[j+F];-1===N(f,c,P,4)&&(A[T]=c,o[T]=(0,W.Lerp)(0,u[j+F],H),T++)}const Y=o[0]+o[1]+o[2]+o[3];o[0]/=Y,o[1]/=Y,o[2]/=Y,o[3]/=Y}const j=F.localPositionOverride?F.localPositionOverride[0]:(null===z||void 0===z?void 0:z[F.vertexIdx])??0,i=F.localPositionOverride?F.localPositionOverride[1]:(null===z||void 0===z?void 0:z[F.vertexIdx+1])??0,u=F.localPositionOverride?F.localPositionOverride[2]:(null===z||void 0===z?void 0:z[F.vertexIdx+2])??0,T=q.localPositionOverride?q.localPositionOverride[0]:(null===z||void 0===z?void 0:z[q.vertexIdx])??0,Y=q.localPositionOverride?q.localPositionOverride[1]:(null===z||void 0===z?void 0:z[q.vertexIdx+1])??0,t=q.localPositionOverride?q.localPositionOverride[2]:(null===z||void 0===z?void 0:z[q.vertexIdx+2])??0,C=F.localNormalOverride?F.localNormalOverride[0]:(null===Z||void 0===Z?void 0:Z[F.vertexIdx])??0,L=F.localNormalOverride?F.localNormalOverride[1]:(null===Z||void 0===Z?void 0:Z[F.vertexIdx+1])??0,J=F.localNormalOverride?F.localNormalOverride[2]:(null===Z||void 0===Z?void 0:Z[F.vertexIdx+2])??0,B=C+((q.localNormalOverride?q.localNormalOverride[0]:(null===Z||void 0===Z?void 0:Z[q.vertexIdx])??0)-C)*H,R=L+((q.localNormalOverride?q.localNormalOverride[1]:(null===Z||void 0===Z?void 0:Z[q.vertexIdx+1])??0)-L)*H,d=J+((q.localNormalOverride?q.localNormalOverride[2]:(null===Z||void 0===Z?void 0:Z[q.vertexIdx+2])??0)-J)*H,M=Math.sqrt(B*B+R*R+d*d);return new w(c.tP.Lerp(F.position,q.position,H),c.tP.Lerp(F.normal,q.normal,H).normalize(),c.Vector2.Lerp(F.uv,q.uv,H),-1,-1,z?[j+(T-j)*H,i+(Y-i)*H,u+(t-u)*H]:null,Z?[B/M,R/M,d/M]:null,A,o)};let H=null;F.length>3&&(H=[]);for(let A=0;A<F.length;A+=3){let N=0,o=null,j=null,i=null,u=null;const T=c.tP.Dot(F[A].position,P)-f>0,Y=c.tP.Dot(F[A+1].position,P)-f>0,t=c.tP.Dot(F[A+2].position,P)-f>0;switch(N=(T?1:0)+(Y?1:0)+(t?1:0),N){case 0:F.length>3?(H.push(F[A]),H.push(F[A+1]),H.push(F[A+2])):H=F;break;case 1:if(H=H??new Array,T&&(o=F[A+1],j=F[A+2],i=q(F[A],o),u=q(F[A],j)),Y){o=F[A],j=F[A+2],i=q(F[A+1],o),u=q(F[A+1],j),H.push(i),H.push(j.clone()),H.push(o.clone()),H.push(j.clone()),H.push(i.clone()),H.push(u);break}t&&(o=F[A],j=F[A+1],i=q(F[A+2],o),u=q(F[A+2],j)),o&&j&&i&&u&&(H.push(o.clone()),H.push(j.clone()),H.push(i),H.push(u),H.push(i.clone()),H.push(j.clone()));break;case 2:H=H??new Array,T||(o=F[A].clone(),j=q(o,F[A+1]),i=q(o,F[A+2]),H.push(o),H.push(j),H.push(i)),Y||(o=F[A+1].clone(),j=q(o,F[A+2]),i=q(o,F[A]),H.push(o),H.push(j),H.push(i)),t||(o=F[A+2].clone(),j=q(o,F[A]),i=q(o,F[A+1]),H.push(o),H.push(j),H.push(i))}}return H},D=P instanceof N.d?P:null,l=null===D||void 0===D?void 0:D._thinInstanceDataStorage.matrixData,g=(null===D||void 0===D?void 0:D.Ac)||1,G=c.TmpVectors.Matrix[0];G.q(c.Matrix.IdentityReadOnly);for(let N=0;N<g;++N){if(null!==D&&void 0!==D&&D.hasThinInstances&&l){const F=16*N;G.setRowFromFloats(0,l[F+0],l[F+1],l[F+2],l[F+3]),G.setRowFromFloats(1,l[F+4],l[F+5],l[F+6],l[F+7]),G.setRowFromFloats(2,l[F+8],l[F+9],l[F+10],l[F+11]),G.setRowFromFloats(3,l[F+12],l[F+13],l[F+14],l[F+15])}const F=c.Matrix.RotationYawPitchRoll(k,E,x).multiply(c.Matrix.Translation(V.x,V.y,V.z)),q=c.Matrix.Invert(F),H=P.getWorldMatrix(),o=G.multiply(H).multiply(q),j=new Array(3);for(let P=0;P<L.length;P+=3){let F=j;if(F[0]=p(P,o),F[1]=p(P+1,o),F[2]=p(P+2,o),!(f.cullBackFaces&&-F[0].normal.z<=0&&-F[1].normal.z<=0&&-F[2].normal.z<=0)&&(F=e(F,b),F&&(F=e(F,v),F&&(F=e(F,s),F&&(F=e(F,X),F&&(F=e(F,m),F&&(F=e(F,a),F)))))))for(let P=0;P<F.length;P++){const c=F[P];if(r.indices.push(n),C?(c.localPositionOverride?(r.MF[3*n]=c.localPositionOverride[0],r.MF[3*n+1]=c.localPositionOverride[1],r.MF[3*n+2]=c.localPositionOverride[2]):z&&(r.MF[3*n]=z[c.vertexIdx],r.MF[3*n+1]=z[c.vertexIdx+1],r.MF[3*n+2]=z[c.vertexIdx+2]),c.localNormalOverride?(r.VF[3*n]=c.localNormalOverride[0],r.VF[3*n+1]=c.localNormalOverride[1],r.VF[3*n+2]=c.localNormalOverride[2]):Z&&(r.VF[3*n]=Z[c.vertexIdx],r.VF[3*n+1]=Z[c.vertexIdx+1],r.VF[3*n+2]=Z[c.vertexIdx+2])):(c.position.toArray(r.MF,3*n),c.normal.toArray(r.VF,3*n)),r.matricesIndices&&r.matricesWeights&&(c.matrixIndicesOverride?(r.matricesIndices[4*n]=c.matrixIndicesOverride[0],r.matricesIndices[4*n+1]=c.matrixIndicesOverride[1],r.matricesIndices[4*n+2]=c.matrixIndicesOverride[2],r.matricesIndices[4*n+3]=c.matrixIndicesOverride[3]):(y&&(r.matricesIndices[4*n]=y[c.vertexIdxForBones],r.matricesIndices[4*n+1]=y[c.vertexIdxForBones+1],r.matricesIndices[4*n+2]=y[c.vertexIdxForBones+2],r.matricesIndices[4*n+3]=y[c.vertexIdxForBones+3]),d&&r.matricesIndicesExtra&&(r.matricesIndicesExtra[4*n]=d[c.vertexIdxForBones],r.matricesIndicesExtra[4*n+1]=d[c.vertexIdxForBones+1],r.matricesIndicesExtra[4*n+2]=d[c.vertexIdxForBones+2],r.matricesIndicesExtra[4*n+3]=d[c.vertexIdxForBones+3])),c.matrixWeightsOverride?(r.matricesWeights[4*n]=c.matrixWeightsOverride[0],r.matricesWeights[4*n+1]=c.matrixWeightsOverride[1],r.matricesWeights[4*n+2]=c.matrixWeightsOverride[2],r.matricesWeights[4*n+3]=c.matrixWeightsOverride[3]):(O&&(r.matricesWeights[4*n]=O[c.vertexIdxForBones],r.matricesWeights[4*n+1]=O[c.vertexIdxForBones+1],r.matricesWeights[4*n+2]=O[c.vertexIdxForBones+2],r.matricesWeights[4*n+3]=O[c.vertexIdxForBones+3]),M&&r.matricesWeightsExtra&&(r.matricesWeightsExtra[4*n]=M[c.vertexIdxForBones],r.matricesWeightsExtra[4*n+1]=M[c.vertexIdxForBones+1],r.matricesWeightsExtra[4*n+2]=M[c.vertexIdxForBones+2],r.matricesWeightsExtra[4*n+3]=M[c.vertexIdxForBones+3]))),f.captureUVS)c.uv.toArray(r.KF,2*n);else{r.KF.push(.5+c.position.x/K.x);const F=.5+c.position.y/K.y;r.KF.push(A.e?1-F:F)}n++}}}0===r.indices.length&&(r.indices=null),0===r.MF.length&&(r.MF=null),0===r.VF.length&&(r.VF=null),0===r.KF.length&&(r.KF=null),0===(null===(j=r.matricesIndices)||void 0===j?void 0:j.length)&&(r.matricesIndices=null),0===(null===(i=r.matricesWeights)||void 0===i?void 0:i.length)&&(r.matricesWeights=null),0===(null===(u=r.matricesIndicesExtra)||void 0===u?void 0:u.length)&&(r.matricesIndicesExtra=null),0===(null===(T=r.matricesWeightsExtra)||void 0===T?void 0:T.length)&&(r.matricesWeightsExtra=null);const h=new N.d(F,P.OF());return r.kF(h),C?(h.skeleton=P.skeleton,h.parent=P):(h.position=V.clone(),h.rotation=new c.tP(E,k,x)),h.gf(!0),h.refreshBoundingInfo(!0,!0),h}function G(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const P=0|Math.max(F.subdivisions?F.subdivisions:2,1),f=0|Math.max(F.tessellation?F.tessellation:16,3),N=Math.max(F.height?F.height:1,0),q=Math.max(F.radius?F.radius:.25,0),o=0|Math.max(F.capSubdivisions?F.capSubdivisions:6,1),j=f,i=P,u=Math.max(F.radiusTop?F.radiusTop:q,0),T=Math.max(F.radiusBottom?F.radiusBottom:q,0),Y=N-(u+T),t=2*Math.PI,C=Math.max(F.topCapSubdivisions?F.topCapSubdivisions:o,1),L=Math.max(F.bottomCapSubdivisions?F.bottomCapSubdivisions:o,1),J=Math.acos((T-u)/N);let B=[];const z=[],Z=[],R=[];let y=0;const O=[],d=.5*Y,M=.5*Math.PI;let V,Q;const K=c.tP.Zero(),x=c.tP.Zero(),k=Math.cos(J),I=Math.sin(J),E=new c.Vector2(u*I,d+u*k).CP(new c.Vector2(T*I,T*k-d)).length(),r=u*J+E+T*(M-J);let n=0;for(Q=0;Q<=C;Q++){const F=[],P=M-J*(Q/C);n+=u*J/C;const f=Math.cos(P),c=Math.sin(P),N=f*u;for(V=0;V<=j;V++){const P=V/j,q=P*t+0,H=Math.sin(q),o=Math.cos(q);x.x=N*H,x.y=d+c*u,x.z=N*o,z.push(x.x,x.y,x.z),K.set(f*H,c,f*o),Z.push(K.x,K.y,K.z),R.push(P,A.e?n/r:1-n/r),F.push(y),y++}O.push(F)}const p=N-u-T+k*u-k*T,U=I*(T-u)/p;for(Q=1;Q<=i;Q++){const F=[];n+=E/i;const P=I*(Q*(T-u)/i+u);for(V=0;V<=j;V++){const f=V/j,c=f*t+0,N=Math.sin(c),q=Math.cos(c);x.x=P*N,x.y=d+k*u-Q*p/i,x.z=P*q,z.push(x.x,x.y,x.z),K.set(N,U,q).normalize(),Z.push(K.x,K.y,K.z),R.push(f,A.e?n/r:1-n/r),F.push(y),y++}O.push(F)}for(Q=1;Q<=L;Q++){const F=[],P=M-J-(Math.PI-J)*(Q/L);n+=T*J/L;const f=Math.cos(P),c=Math.sin(P),N=f*T;for(V=0;V<=j;V++){const P=V/j,q=P*t+0,H=Math.sin(q),o=Math.cos(q);x.x=N*H,x.y=c*T-d,x.z=N*o,z.push(x.x,x.y,x.z),K.set(f*H,c,f*o),Z.push(K.x,K.y,K.z),R.push(P,A.e?n/r:1-n/r),F.push(y),y++}O.push(F)}for(V=0;V<j;V++)for(Q=0;Q<C+i+L;Q++){const F=O[Q][V],P=O[Q+1][V],f=O[Q+1][V+1],c=O[Q][V+1];B.push(F),B.push(P),B.push(c),B.push(P),B.push(f),B.push(c)}if(B=B.reverse(),F.orientation&&!F.orientation.equals(c.tP.Up())){const P=new c.Matrix;F.orientation.clone().scale(.5*Math.PI).cross(c.tP.Up()).toQuaternion().toRotationMatrix(P);const f=c.tP.Zero();for(let F=0;F<z.length;F+=3)f.set(z[F],z[F+1],z[F+2]),c.tP.TransformCoordinatesToRef(f.clone(),P,f),z[F]=f.x,z[F+1]=f.y,z[F+2]=f.z}const e=new H.e;return e.MF=z,e.VF=Z,e.KF=R,e.indices=B,e}function h(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:c.tP.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new N.d(F,f);return G(P).kF(q,P.updatable),q}N.d.CreateDecal=(F,P,f,c,N,q)=>g(F,P,{position:f,normal:c,size:N,angle:q});N.d.CreateCapsule=(F,P,f)=>h(F,P,f),H.e.CreateCapsule=G;var S=f(11474),FF=f(11648);class PF{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=F,this.y=P,F!==Math.floor(F)&&(F=Math.floor(F),S.d.Warn("x is not an integer, floor(x) used")),P!==Math.floor(P)&&(P=Math.floor(P),S.d.Warn("y is not an integer, floor(y) used"))}clone(){return new PF(this.x,this.y)}rotate60About(F){const P=this.x;return this.x=F.x+F.y-this.y,this.y=P+this.y-F.x,this}rotateNeg60About(F){const P=this.x;return this.x=P+this.y-F.y,this.y=F.x+F.y-P,this}rotate120(F,P){F!==Math.floor(F)&&(F=Math.floor(F),S.d.Warn("m not an integer only floor(m) used")),P!==Math.floor(P)&&(P=Math.floor(P),S.d.Warn("n not an integer only floor(n) used"));const f=this.x;return this.x=F-f-this.y,this.y=P+f,this}rotateNeg120(F,P){F!==Math.floor(F)&&(F=Math.floor(F),S.d.Warn("m is not an integer, floor(m) used")),P!==Math.floor(P)&&(P=Math.floor(P),S.d.Warn("n is not an integer,   floor(n) used"));const f=this.x;return this.x=this.y-P,this.y=F+P-f-this.y,this}toCartesianOrigin(F,P){const f=c.tP.Zero();return f.x=F.x+2*this.x*P+this.y*P,f.y=F.y+Math.sqrt(3)*this.y*P,f}static Zero(){return new PF(0,0)}}class fF{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new cF("icosahedron","Regular",[[0,FF.i,-1],[-FF.i,1,0],[-1,0,-FF.i],[1,0,-FF.i],[FF.i,1,0],[0,FF.i,1],[-1,0,FF.i],[-FF.i,-1,0],[0,-FF.i,-1],[FF.i,-1,0],[1,0,FF.i],[0,-FF.i,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let F=12;const P={},f=this.m,c=this.n;let N,q,H,A,o,j=f,i=1,u=0;0!==c&&(j=(0,W.HighestCommonFactor)(f,c)),i=f/j,u=c/j;const T=PF.Zero(),Y=new PF(f,c),t=new PF(-c,f+c),C=PF.Zero(),L=PF.Zero(),J=PF.Zero();let B,z,Z,R,y=[];const O=[],d=this.vertByDist,M=(f,c,N,q)=>{B=f+"|"+N,z=c+"|"+q,B in P||z in P?B in P&&!(z in P)?P[z]=P[B]:z in P&&!(B in P)&&(P[B]=P[z]):(P[B]=F,P[z]=F,F++),d[N][0]>2?O[P[B]]=[-d[N][0],d[N][1],P[B]]:O[P[B]]=[y[d[N][0]],d[N][1],P[B]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let V=0;V<20;V++){if(y=this.IDATA.face[V],H=y[2],A=y[1],o=y[0],Z=T.x+"|"+T.y,B=V+"|"+Z,B in P||(P[B]=H,O[H]=[y[d[Z][0]],d[Z][1]]),Z=Y.x+"|"+Y.y,B=V+"|"+Z,B in P||(P[B]=A,O[A]=[y[d[Z][0]],d[Z][1]]),Z=t.x+"|"+t.y,B=V+"|"+Z,B in P||(P[B]=o,O[o]=[y[d[Z][0]],d[Z][1]]),N=this.IDATA.edgematch[V][0],q=this.IDATA.edgematch[V][1],"B"===q)for(let F=1;F<j;F++)L.x=f-F*(i+u),L.y=c+F*i,J.x=-F*u,J.y=F*(i+u),Z=L.x+"|"+L.y,R=J.x+"|"+J.y,M(V,N,Z,R);if("O"===q)for(let F=1;F<j;F++)J.x=-F*u,J.y=F*(i+u),C.x=F*i,C.y=F*u,Z=J.x+"|"+J.y,R=C.x+"|"+C.y,M(V,N,Z,R);if(N=this.IDATA.edgematch[V][2],q=this.IDATA.edgematch[V][3],q&&"A"===q)for(let F=1;F<j;F++)C.x=F*i,C.y=F*u,L.x=f-(j-F)*(i+u),L.y=c+(j-F)*i,Z=C.x+"|"+C.y,R=L.x+"|"+L.y,M(V,N,Z,R);for(let f=0;f<this.vertices.length;f++)Z=this.vertices[f].x+"|"+this.vertices[f].y,B=V+"|"+Z,B in P||(P[B]=F++,d[Z][0]>2?O[P[B]]=[-d[Z][0],d[Z][1],P[B]]:O[P[B]]=[y[d[Z][0]],d[Z][1],P[B]])}this.closestTo=O,this.vecToidx=P}calcCoeffs(){const F=this.m,P=this.n,f=Math.sqrt(3)/3,c=F*F+P*P+F*P;this.coau=(F+P)/c,this.cobu=-P/c,this.coav=-f*(F-P)/c,this.cobv=f*(2*F+P)/c}createInnerFacets(){const F=this.m,P=this.n;for(let f=0;f<P+F+1;f++)for(let F=this.min[f];F<this.max[f]+1;F++)F<this.max[f]&&F<this.max[f+1]+1&&this.innerFacets.push(["|"+F+"|"+f,"|"+F+"|"+(f+1),"|"+(F+1)+"|"+f]),f>0&&F<this.max[f-1]&&F+1<this.max[f]+1&&this.innerFacets.push(["|"+F+"|"+f,"|"+(F+1)+"|"+f,"|"+(F+1)+"|"+(f-1)])}edgeVecsABOB(){const F=this.m,P=this.n,f=new PF(-P,F+P);for(let c=1;c<F+P;c++){const F=new PF(this.min[c],c),P=new PF(this.min[c-1],c-1),N=new PF(this.min[c+1],c+1),q=F.clone(),H=P.clone(),A=N.clone();q.rotate60About(f),H.rotate60About(f),A.rotate60About(f);const o=new PF(this.max[q.y],q.y),j=new PF(this.max[q.y-1],q.y-1),i=new PF(this.max[q.y-1]-1,q.y-1);q.x===o.x&&q.y===o.y||(q.x!==j.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([F,j,i]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([F,i,o])):q.y===A.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([F,P,j]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([F,j,N])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([F,P,j]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([F,j,o])))}}mapABOBtoOBOA(){const F=new PF(0,0);for(let P=0;P<this.isoVecsABOB.length;P++){const f=[];for(let c=0;c<3;c++)F.x=this.isoVecsABOB[P][c].x,F.y=this.isoVecsABOB[P][c].y,0===this.vertexTypes[P][c]&&F.rotateNeg120(this.m,this.n),f.push(F.clone());this.isoVecsOBOA.push(f)}}mapABOBtoBAOA(){const F=new PF(0,0);for(let P=0;P<this.isoVecsABOB.length;P++){const f=[];for(let c=0;c<3;c++)F.x=this.isoVecsABOB[P][c].x,F.y=this.isoVecsABOB[P][c].y,1===this.vertexTypes[P][c]&&F.rotate120(this.m,this.n),f.push(F.clone());this.isoVecsBAOA.push(f)}}MapToFace(F,P){const f=this.IDATA.face[F],N=f[2],q=f[1],H=f[0],A=c.tP.zP(this.IDATA.vertex[N]),o=c.tP.zP(this.IDATA.vertex[q]),j=c.tP.zP(this.IDATA.vertex[H]),i=o.CP(A),u=j.CP(A),T=i.scale(this.coau).add(u.scale(this.cobu)),Y=i.scale(this.coav).add(u.scale(this.cobv)),t=[];let C,L=c.TmpVectors.tP[0];for(let c=0;c<this.cartesian.length;c++)L=T.scale(this.cartesian[c].x).add(Y.scale(this.cartesian[c].y)).add(A),t[c]=[L.x,L.y,L.z],C=F+"|"+this.vertices[c].x+"|"+this.vertices[c].y,P.vertex[this.vecToidx[C]]=[L.x,L.y,L.z]}build(F,P){const f=[],c=PF.Zero(),N=new PF(F,P),q=new PF(-P,F+P);f.push(c,N,q);for(let Z=P;Z<F+1;Z++)for(let P=0;P<F+1-Z;P++)f.push(new PF(P,Z));if(P>0){const c=(0,W.HighestCommonFactor)(F,P),N=F/c,q=P/c;for(let A=1;A<c;A++)f.push(new PF(A*N,A*q)),f.push(new PF(-A*q,A*(N+q))),f.push(new PF(F-A*(N+q),P+A*N));const H=F/P;for(let A=1;A<P;A++)for(let c=0;c<A*H;c++)f.push(new PF(c,A)),f.push(new PF(c,A).rotate120(F,P)),f.push(new PF(c,A).rotateNeg120(F,P))}f.sort(((F,P)=>F.x-P.x)),f.sort(((F,P)=>F.y-P.y));const H=new Array(F+P+1),A=new Array(F+P+1);for(let Z=0;Z<H.length;Z++)H[Z]=1/0,A[Z]=-1/0;let o=0,j=0;const i=f.length;for(let Z=0;Z<i;Z++)j=f[Z].x,o=f[Z].y,H[o]=Math.min(j,H[o]),A[o]=Math.max(j,A[o]);const u=(f,c)=>{const N=f.clone();return"A"===c&&N.rotateNeg120(F,P),"B"===c&&N.rotate120(F,P),N.x<0?N.y:N.x+N.y},T=[],Y=[],t=[],C=[],L={},J=[];let B=-1,z=-1;for(let Z=0;Z<i;Z++)T[Z]=f[Z].toCartesianOrigin(new PF(0,0),.5),Y[Z]=u(f[Z],"O"),t[Z]=u(f[Z],"A"),C[Z]=u(f[Z],"B"),Y[Z]===t[Z]&&t[Z]===C[Z]?(B=3,z=Y[Z]):Y[Z]===t[Z]?(B=4,z=Y[Z]):t[Z]===C[Z]?(B=5,z=t[Z]):C[Z]===Y[Z]&&(B=6,z=Y[Z]),Y[Z]<t[Z]&&Y[Z]<C[Z]&&(B=2,z=Y[Z]),t[Z]<Y[Z]&&t[Z]<C[Z]&&(B=1,z=t[Z]),C[Z]<t[Z]&&C[Z]<Y[Z]&&(B=0,z=C[Z]),J.push([B,z,f[Z].x,f[Z].y]);J.sort(((F,P)=>F[2]-P[2])),J.sort(((F,P)=>F[3]-P[3])),J.sort(((F,P)=>F[1]-P[1])),J.sort(((F,P)=>F[0]-P[0]));for(let Z=0;Z<J.length;Z++)L[J[Z][2]+"|"+J[Z][3]]=[J[Z][0],J[Z][1],Z];return this.m=F,this.n=P,this.vertices=f,this.vertByDist=L,this.cartesian=T,this.min=H,this.max=A,this}}class cF{constructor(F,P,f,c){this.name=F,this.category=P,this.vertex=f,this.face=c}}class NF extends cF{innerToData(F,P){for(let f=0;f<P.innerFacets.length;f++)this.face.push(P.innerFacets[f].map((f=>P.vecToidx[F+f])))}mapABOBtoDATA(F,P){const f=P.IDATA.edgematch[F][0];for(let c=0;c<P.isoVecsABOB.length;c++){const N=[];for(let q=0;q<3;q++)0===P.vertexTypes[c][q]?N.push(F+"|"+P.isoVecsABOB[c][q].x+"|"+P.isoVecsABOB[c][q].y):N.push(f+"|"+P.isoVecsABOB[c][q].x+"|"+P.isoVecsABOB[c][q].y);this.face.push([P.vecToidx[N[0]],P.vecToidx[N[1]],P.vecToidx[N[2]]])}}mapOBOAtoDATA(F,P){const f=P.IDATA.edgematch[F][0];for(let c=0;c<P.isoVecsOBOA.length;c++){const N=[];for(let q=0;q<3;q++)1===P.vertexTypes[c][q]?N.push(F+"|"+P.isoVecsOBOA[c][q].x+"|"+P.isoVecsOBOA[c][q].y):N.push(f+"|"+P.isoVecsOBOA[c][q].x+"|"+P.isoVecsOBOA[c][q].y);this.face.push([P.vecToidx[N[0]],P.vecToidx[N[1]],P.vecToidx[N[2]]])}}mapBAOAtoDATA(F,P){const f=P.IDATA.edgematch[F][2];for(let c=0;c<P.isoVecsBAOA.length;c++){const N=[];for(let q=0;q<3;q++)1===P.vertexTypes[c][q]?N.push(F+"|"+P.isoVecsBAOA[c][q].x+"|"+P.isoVecsBAOA[c][q].y):N.push(f+"|"+P.isoVecsBAOA[c][q].x+"|"+P.isoVecsBAOA[c][q].y);this.face.push([P.vecToidx[N[0]],P.vecToidx[N[1]],P.vecToidx[N[2]]])}}orderData(F){const P=[];for(let q=0;q<13;q++)P[q]=[];const f=F.closestTo;for(let q=0;q<f.length;q++)f[q][0]>-1?f[q][1]>0&&P[f[q][0]].push([q,f[q][1]]):P[12].push([q,f[q][0]]);const c=[];for(let q=0;q<12;q++)c[q]=q;let N=12;for(let q=0;q<12;q++){P[q].sort(((F,P)=>F[1]-P[1]));for(let F=0;F<P[q].length;F++)c[P[q][F][0]]=N++}for(let q=0;q<P[12].length;q++)c[P[12][q][0]]=N++;for(let q=0;q<this.vertex.length;q++)this.vertex[q].push(c[q]);this.vertex.sort(((F,P)=>F[3]-P[3]));for(let q=0;q<this.vertex.length;q++)this.vertex[q].pop();for(let q=0;q<this.face.length;q++)for(let F=0;F<this.face[q].length;F++)this.face[q][F]=c[this.face[q][F]];this.sharedNodes=P[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(F,P){const f=[],c=[];let N=P.pop();c.push(N);let q=this.face[N].indexOf(F);q=(q+2)%3;let H=this.face[N][q];f.push(H);let A=0;for(;P.length>0;)N=P[A],this.face[N].indexOf(H)>-1?(q=(this.face[N].indexOf(H)+1)%3,H=this.face[N][q],f.push(H),c.push(N),P.splice(A,1),A=0):A++;return this.adjacentFaces.push(f),c}toGoldbergPolyhedronData(){const F=new cF("GeoDual","Goldberg",[],[]);F.name="GD dual";const P=this.vertex.length,f=new Array(P);for(let o=0;o<P;o++)f[o]=[];for(let o=0;o<this.face.length;o++)for(let F=0;F<3;F++)f[this.face[o][F]].push(o);let c=0,N=0,q=0,H=[],A=[];this.adjacentFaces=[];for(let o=0;o<f.length;o++){F.face[o]=this.setOrder(o,f[o].concat([]));for(const P of f[o]){c=0,N=0,q=0,H=this.face[P];for(let F=0;F<3;F++)A=this.vertex[H[F]],c+=A[0],N+=A[1],q+=A[2];F.vertex[P]=[c/3,N/3,q/3]}}return F}static BuildGeodesicData(F){const P=new NF("Geodesic-m-n","Geodesic",[[0,FF.i,-1],[-FF.i,1,0],[-1,0,-FF.i],[1,0,-FF.i],[FF.i,1,0],[0,FF.i,1],[-1,0,FF.i],[-FF.i,-1,0],[0,-FF.i,-1],[FF.i,-1,0],[1,0,FF.i],[0,-FF.i,1]],[]);F.setIndices(),F.calcCoeffs(),F.createInnerFacets(),F.edgeVecsABOB(),F.mapABOBtoOBOA(),F.mapABOBtoBAOA();for(let f=0;f<F.IDATA.face.length;f++)F.MapToFace(f,P),P.innerToData(f,F),"B"===F.IDATA.edgematch[f][1]&&P.mapABOBtoDATA(f,F),"O"===F.IDATA.edgematch[f][1]&&P.mapOBOAtoDATA(f,F),"A"===F.IDATA.edgematch[f][3]&&P.mapBAOAtoDATA(f,F);P.orderData(F);return P.vertex=P.vertex.map((function(F){const P=F[0],f=F[1],c=F[2],N=Math.sqrt(P*P+f*f+c*c);return F[0]*=1/N,F[1]*=1/N,F[2]*=1/N,F})),P}}N.d._GoldbergMeshParser=(F,P)=>qF.Parse(F,P);class qF extends N.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(F,P){return void 0===P?(F>this.goldbergData.nbUnsharedFaces-1&&(S.d.Warn("Maximum number of unshared faces used"),F=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+F):(F>11&&(S.d.Warn("Last pole used"),F=11),P>this.goldbergData.nbFacesAtPole-1&&(S.d.Warn("Maximum number of faces at a pole used"),P=this.goldbergData.nbFacesAtPole-1),12+F*this.goldbergData.nbFacesAtPole+P)}_changeGoldbergFaceColors(F){for(let f=0;f<F.length;f++){const P=F[f][0],c=F[f][1],N=F[f][2];for(let F=P;F<c+1;F++)this.goldbergData.faceColors[F]=N}const P=[];for(let f=0;f<12;f++)for(let F=0;F<5;F++)P.push(this.goldbergData.faceColors[f].r,this.goldbergData.faceColors[f].g,this.goldbergData.faceColors[f].b,this.goldbergData.faceColors[f].a);for(let f=12;f<this.goldbergData.faceColors.length;f++)for(let F=0;F<6;F++)P.push(this.goldbergData.faceColors[f].r,this.goldbergData.faceColors[f].g,this.goldbergData.faceColors[f].b,this.goldbergData.faceColors[f].a);return P}setGoldbergFaceColors(F){const P=this._changeGoldbergFaceColors(F);this.nF(q.f.ColorKind,P)}updateGoldbergFaceColors(F){const P=this._changeGoldbergFaceColors(F);this.updateVerticesData(q.f.ColorKind,P)}_changeGoldbergFaceUVs(F){const P=this.getVerticesData(q.f.UVKind);for(let f=0;f<F.length;f++){const c=F[f][0],N=F[f][1],q=F[f][2],H=F[f][3],A=F[f][4],o=[],j=[];let i,u;for(let F=0;F<5;F++)i=q.x+H*Math.cos(A+F*Math.PI/2.5),u=q.y+H*Math.sin(A+F*Math.PI/2.5),i<0&&(i=0),i>1&&(i=1),o.push(i,u);for(let F=0;F<6;F++)i=q.x+H*Math.cos(A+F*Math.PI/3),u=q.y+H*Math.sin(A+F*Math.PI/3),i<0&&(i=0),i>1&&(i=1),j.push(i,u);for(let F=c;F<Math.min(12,N+1);F++)for(let f=0;f<5;f++)P[10*F+2*f]=o[2*f],P[10*F+2*f+1]=o[2*f+1];for(let F=Math.max(12,c);F<N+1;F++)for(let f=0;f<6;f++)P[12*F-24+2*f]=j[2*f],P[12*F-23+2*f]=j[2*f+1]}return P}setGoldbergFaceUVs(F){const P=this._changeGoldbergFaceUVs(F);this.nF(q.f.UVKind,P)}updateGoldbergFaceUVs(F){const P=this._changeGoldbergFaceUVs(F);this.updateVerticesData(q.f.UVKind,P)}placeOnGoldbergFaceAt(F,P,f){const N=c.tP.RotationFromAxis(this.goldbergData.faceXaxis[P],this.goldbergData.faceYaxis[P],this.goldbergData.faceZaxis[P]);F.rotation=N,F.position=this.goldbergData.faceCenters[P].add(this.goldbergData.faceXaxis[P].scale(f.x)).add(this.goldbergData.faceYaxis[P].scale(f.y)).add(this.goldbergData.faceZaxis[P].scale(f.z))}serialize(F){super.serialize(F),F.type="GoldbergMesh";const P={};if(P.adjacentFaces=this.goldbergData.adjacentFaces,P.nbSharedFaces=this.goldbergData.nbSharedFaces,P.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,P.nbFaces=this.goldbergData.nbFaces,P.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){P.faceColors=[];for(const F of this.goldbergData.faceColors)P.faceColors.push(F.pf())}if(this.goldbergData.faceCenters){P.faceCenters=[];for(const F of this.goldbergData.faceCenters)P.faceCenters.push(F.pf())}if(this.goldbergData.faceZaxis){P.faceZaxis=[];for(const F of this.goldbergData.faceZaxis)P.faceZaxis.push(F.pf())}if(this.goldbergData.faceYaxis){P.faceYaxis=[];for(const F of this.goldbergData.faceYaxis)P.faceYaxis.push(F.pf())}if(this.goldbergData.faceXaxis){P.faceXaxis=[];for(const F of this.goldbergData.faceXaxis)P.faceXaxis.push(F.pf())}F.goldbergData=P}static Parse(F,P){const f=F.goldbergData;f.faceColors=f.faceColors.map((F=>T.qc.zP(F))),f.faceCenters=f.faceCenters.map((F=>c.tP.zP(F))),f.faceZaxis=f.faceZaxis.map((F=>c.tP.zP(F))),f.faceXaxis=f.faceXaxis.map((F=>c.tP.zP(F))),f.faceYaxis=f.faceYaxis.map((F=>c.tP.zP(F)));const N=new qF(F.name,P);return N.goldbergData=f,N}}var HF=f(12177);const AF={CreateBox:u.b,CreateTiledBox:L,CreateSphere:J.e,CreateDisc:i.b,CreateIcoSphere:l,CreateRibbon:j,CreateCylinder:R,CreateTorus:O,CreateTorusKnot:M,CreateLineSystem:V.g,Wj:V.j,CreateDashedLines:V.e,ExtrudeShape:x,ExtrudeShapeCustom:k,CreateLathe:E,CreateTiledPlane:t,sj:r.b,CreateGround:n.g,CreateTiledGround:n.i,CreateGroundFromHeightMap:n.d,CreatePolygon:Q.d,ExtrudePolygon:Q.g,CreateTube:p,CreatePolyhedron:e,CreateGeodesic:function(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=P.m||1;c!==Math.floor(c)&&(c=Math.floor(c),S.d.Warn("m not an integer only floor(m) used"));let N=P.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),S.d.Warn("n not an integer only floor(n) used")),N>c){const F=N;N=c,c=F,S.d.Warn("n > m therefore m and n swapped")}const q=new fF;return q.build(c,N),e(F,{custom:NF.BuildGeodesicData(q),size:P.size,sizeX:P.sizeX,sizeY:P.sizeY,sizeZ:P.sizeZ,faceUV:P.faceUV,faceColors:P.faceColors,flat:P.flat,updatable:P.updatable,sideOrientation:P.sideOrientation,frontUVs:P.frontUVs,backUVs:P.backUVs},f)},CreateGoldberg:function(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=P.size,o=P.sizeX||q||1,j=P.sizeY||q||1,i=P.sizeZ||q||1;let u=P.m||1;u!==Math.floor(u)&&(u=Math.floor(u),S.d.Warn("m not an integer only floor(m) used"));let Y=P.n||0;if(Y!==Math.floor(Y)&&(Y=Math.floor(Y),S.d.Warn("n not an integer only floor(n) used")),Y>u){const F=Y;Y=u,u=F,S.d.Warn("n > m therefore m and n swapped")}const t=new fF;t.build(u,Y);const C=NF.BuildGeodesicData(t),L=C.toGoldbergPolyhedronData(),J=new qF(F,f);P.sideOrientation=N.d._GetDefaultSideOrientation(P.sideOrientation),J._originalBuilderSideOrientation=P.sideOrientation;(function(F,P){const f=F.size,N=F.sizeX||f||1,q=F.sizeY||f||1,o=F.sizeZ||f||1,j=0===F.sideOrientation?0:F.sideOrientation||H.e.DEFAULTSIDE,i=[],u=[],T=[],Y=[];let t=1/0,C=-1/0,L=1/0,J=-1/0;for(let c=0;c<P.vertex.length;c++)t=Math.min(t,P.vertex[c][0]*N),C=Math.max(C,P.vertex[c][0]*N),L=Math.min(L,P.vertex[c][1]*q),J=Math.max(J,P.vertex[c][1]*q);let B=0;for(let H=0;H<P.face.length;H++){const F=P.face[H],f=c.tP.zP(P.vertex[F[0]]),j=c.tP.zP(P.vertex[F[2]]),z=c.tP.zP(P.vertex[F[1]]),Z=j.CP(f),R=z.CP(f),y=c.tP.Cross(R,Z).normalize();for(let c=0;c<F.length;c++){T.push(y.x,y.y,y.z);const f=P.vertex[F[c]];i.push(f[0]*N,f[1]*q,f[2]*o);const H=(f[1]*q-L)/(J-L);Y.push((f[0]*N-t)/(C-t),A.e?1-H:H)}for(let P=0;P<F.length-2;P++)u.push(B,B+P+2,B+P+1);B+=F.length}H.e._ComputeSides(j,i,u,T,Y);const z=new H.e;return z.MF=i,z.indices=u,z.VF=T,z.KF=Y,z})(P,L).kF(J,P.updatable),J.goldbergData.nbSharedFaces=C.sharedNodes,J.goldbergData.nbUnsharedFaces=C.poleNodes,J.goldbergData.adjacentFaces=C.adjacentFaces,J.goldbergData.nbFaces=J.goldbergData.nbSharedFaces+J.goldbergData.nbUnsharedFaces,J.goldbergData.nbFacesAtPole=(J.goldbergData.nbUnsharedFaces-12)/12;for(let N=0;N<C.vertex.length;N++)J.goldbergData.faceCenters.push(c.tP.zP(C.vertex[N])),J.goldbergData.faceCenters[N].x*=o,J.goldbergData.faceCenters[N].y*=j,J.goldbergData.faceCenters[N].z*=i,J.goldbergData.faceColors.push(new T.qc(1,1,1,1));for(let N=0;N<L.face.length;N++){const F=L.face[N],P=c.tP.zP(L.vertex[F[0]]),f=c.tP.zP(L.vertex[F[2]]),q=c.tP.zP(L.vertex[F[1]]),H=f.CP(P),A=q.CP(P),o=c.tP.Cross(A,H).normalize(),j=c.tP.Cross(A,o).normalize();J.goldbergData.faceXaxis.push(A.normalize()),J.goldbergData.faceYaxis.push(o),J.goldbergData.faceZaxis.push(j)}return J},CreateDecal:g,CreateCapsule:h,CreateText:HF.e}},12893:(F,P,f)=>{"use strict";f.d(P,{c:()=>AP});var c=f(11639),N=f(11994);class q extends N.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var H=f(11690),A=(f(11775),f(11587));class o{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(F){this._targetStopDuration!==F&&(this._targetStopDuration=F)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(F){this._noiseTexture!==F&&(this._noiseTexture=F,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(F){this._animationSheetEnabled!==F&&(this._animationSheetEnabled=F)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(F){this._isAnimationSheetEnabled!=F&&(this._isAnimationSheetEnabled=F,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(F){this._useLogarithmicDepth=F&&this.OF().getEngine().getCaps().fragmentDepthSupported}OF(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(F){switch(F){case o.BLENDMODE_MULTIPLYADD:return;case o.BLENDMODE_ADD:F=1;break;case o.BLENDMODE_ONEONE:F=6;break;case o.BLENDMODE_STANDARD:F=2;break;case o.BLENDMODE_MULTIPLY:F=4;break;case o.BLENDMODE_SUBTRACT:F=3}this._engine.setAlphaMode(F)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:c.tP.Zero()}set direction1(F){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=F)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:c.tP.Zero()}set direction2(F){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=F)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:c.tP.Zero()}set minEmitBox(F){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=F)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:c.tP.Zero()}set maxEmitBox(F){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=F)}get billboardMode(){return this._billboardMode}set billboardMode(F){this._billboardMode!==F&&(this._billboardMode=F,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(F){this._isBillboardBased!==F&&(this._isBillboardBased=F,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(F){this._attachImageProcessingConfiguration(F)}_attachImageProcessingConfiguration(F){F!==this._imageProcessingConfiguration&&(!F&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=F)}_reset(){}_removeGradientAndTexture(F,P,f){if(!P)return this;let c=0;for(const N of P){if(N.gradient===F){P.splice(c,1);break}c++}return f&&f.dispose(),this}constructor(F){this.animations=[],this.renderingGroupId=0,this.cP=c.tP.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new c.tP(10,10,10),this.onAnimationEnd=null,this.blendMode=o.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new c.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ej=new c.tP(0,0,0),this._useLogarithmicDepth=!1,this.gravity=c.tP.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new H.qc(1,1,1,1),this.color2=new H.qc(1,1,1,1),this.colorDead=new H.qc(0,0,0,1),this.textureMask=new H.qc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new q,this.id=F,this.name=F}createPointEmitter(F,P){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new c.tP(0,1,0),arguments.length>2&&void 0!==arguments[2]||new c.tP(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new c.tP(0,1,0),arguments.length>4&&void 0!==arguments[4]||new c.tP(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new c.tP(0,1,0),arguments.length>3&&void 0!==arguments[3]||new c.tP(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(F,P,f,c){throw new Error("Method not implemented.")}}o.BLENDMODE_ONEONE=0,o.BLENDMODE_STANDARD=1,o.BLENDMODE_ADD=2,o.BLENDMODE_MULTIPLY=3,o.BLENDMODE_MULTIPLYADD=4,o.BLENDMODE_SUBTRACT=-1,(0,A.f)("BABYLON.BaseParticleSystem",o);var j=f(11664),i=f(11476);class u{constructor(){this.direction1=new c.tP(0,1,0),this.direction2=new c.tP(0,1,0),this.minEmitBox=new c.tP(-.5,-.5,-.5),this.maxEmitBox=new c.tP(.5,.5,.5)}startDirectionFunction(F,P,f,N){const q=(0,j.RandomRange)(this.direction1.x,this.direction2.x),H=(0,j.RandomRange)(this.direction1.y,this.direction2.y),A=(0,j.RandomRange)(this.direction1.z,this.direction2.z);if(N)return P.x=q,P.y=H,void(P.z=A);c.tP.TransformNormalFromFloatsToRef(q,H,A,F,P)}startPositionFunction(F,P,f,N){const q=(0,j.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),H=(0,j.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),A=(0,j.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(N)return P.x=q,P.y=H,void(P.z=A);c.tP.TransformCoordinatesFromFloatsToRef(q,H,A,F,P)}clone(){const F=new u;return i.c.DeepCopy(this,F),F}applyToShader(F){F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2),F.setVector3("minEmitBox",this.minEmitBox),F.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(F){F.addUniform("direction1",3),F.addUniform("direction2",3),F.addUniform("minEmitBox",3),F.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.direction1=this.direction1.pf(),F.direction2=this.direction2.pf(),F.minEmitBox=this.minEmitBox.pf(),F.maxEmitBox=this.maxEmitBox.pf(),F}parse(F){c.tP.FromArrayToRef(F.direction1,0,this.direction1),c.tP.FromArrayToRef(F.direction2,0,this.direction2),c.tP.FromArrayToRef(F.minEmitBox,0,this.minEmitBox),c.tP.FromArrayToRef(F.maxEmitBox,0,this.maxEmitBox)}}class T{get radius(){return this._radius}set radius(F){this._radius=F,this._buildHeight()}get angle(){return this._angle}set angle(F){this._angle=F,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=f,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=P,this.radius=F}startDirectionFunction(F,P,f,N){N?c.TmpVectors.tP[0].q(f.Co).normalize():f.position.subtractToRef(F.getTranslation(),c.TmpVectors.tP[0]).normalize();const q=(0,j.RandomRange)(0,this.directionRandomizer),H=(0,j.RandomRange)(0,this.directionRandomizer),A=(0,j.RandomRange)(0,this.directionRandomizer);P.x=c.TmpVectors.tP[0].x+q,P.y=c.TmpVectors.tP[0].y+H,P.z=c.TmpVectors.tP[0].z+A,P.normalize()}startPositionFunction(F,P,f,N){const q=(0,j.RandomRange)(0,2*Math.PI);let H;this.emitFromSpawnPointOnly?H=1e-4:(H=(0,j.RandomRange)(0,this.heightRange),H=1-H*H);let A=this._radius-(0,j.RandomRange)(0,this._radius*this.radiusRange);A*=H;const o=A*Math.sin(q),i=A*Math.cos(q),u=H*this._height;if(N)return P.x=o,P.y=u,void(P.z=i);c.tP.TransformCoordinatesFromFloatsToRef(o,u,i,F,P)}clone(){const F=new T(this._radius,this._angle,this.directionRandomizer);return i.c.DeepCopy(this,F),F}applyToShader(F){F.setFloat2("radius",this._radius,this.radiusRange),F.setFloat("coneAngle",this._angle),F.setFloat2("height",this._height,this.heightRange),F.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(F){F.addUniform("radius",2),F.addUniform("coneAngle",1),F.addUniform("height",2),F.addUniform("directionRandomizer",1)}getEffectDefines(){let F="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(F+="\n#define CONEEMITTERSPAWNPOINT"),F}getClassName(){return"ConeParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.radius=this._radius,F.angle=this._angle,F.directionRandomizer=this.directionRandomizer,F.radiusRange=this.radiusRange,F.heightRange=this.heightRange,F.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,F}parse(F){this.radius=F.radius,this.angle=F.angle,this.directionRandomizer=F.directionRandomizer,this.radiusRange=void 0!==F.radiusRange?F.radiusRange:1,this.heightRange=void 0!==F.radiusRange?F.heightRange:1,this.emitFromSpawnPointOnly=void 0!==F.emitFromSpawnPointOnly&&F.emitFromSpawnPointOnly}}class Y extends T{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.tP(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.tP(0,1,0);super(F,P),this.direction1=f,this.direction2=N}startDirectionFunction(F,P){const f=(0,j.RandomRange)(this.direction1.x,this.direction2.x),N=(0,j.RandomRange)(this.direction1.y,this.direction2.y),q=(0,j.RandomRange)(this.direction1.z,this.direction2.z);c.tP.TransformNormalFromFloatsToRef(f,N,q,F,P)}clone(){const F=new Y(this.radius,this.angle,this.direction1,this.direction2);return i.c.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("radiusRange",this.radiusRange),F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("radiusRange",1),F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const F=super.serialize();return F.direction1=this.direction1.pf(),F.direction2=this.direction2.pf(),F}parse(F){super.parse(F),this.direction1.q(F.direction1),this.direction2.q(F.direction2)}}class t{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=F,this.height=P,this.radiusRange=f,this.directionRandomizer=N,this._tempVector=c.tP.Zero()}startDirectionFunction(F,P,f,N,q){f.position.subtractToRef(F.getTranslation(),this._tempVector),this._tempVector.normalize(),c.tP.TransformNormalToRef(this._tempVector,q,this._tempVector);const H=(0,j.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let A=Math.atan2(this._tempVector.x,this._tempVector.z);A+=(0,j.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=H,this._tempVector.x=Math.sin(A),this._tempVector.z=Math.cos(A),this._tempVector.normalize(),N?P.q(this._tempVector):c.tP.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,F,P)}startPositionFunction(F,P,f,N){const q=(0,j.RandomRange)(-this.height/2,this.height/2),H=(0,j.RandomRange)(0,2*Math.PI),A=(0,j.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),o=Math.sqrt(A)*this.radius,i=o*Math.cos(H),u=o*Math.sin(H);N?P.fc(i,q,u):c.tP.TransformCoordinatesFromFloatsToRef(i,q,u,F,P)}clone(){const F=new t(this.radius,this.directionRandomizer);return i.c.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("height",this.height),F.setFloat("radiusRange",this.radiusRange),F.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("height",1),F.addUniform("radiusRange",1),F.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.radius=this.radius,F.height=this.height,F.radiusRange=this.radiusRange,F.directionRandomizer=this.directionRandomizer,F}parse(F){this.radius=F.radius,this.height=F.height,this.radiusRange=F.radiusRange,this.directionRandomizer=F.directionRandomizer}}class C extends t{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.tP(0,1,0),q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.tP(0,1,0);super(F,P,f),this.direction1=N,this.direction2=q}startDirectionFunction(F,P,f,N){const q=(0,j.RandomRange)(this.direction1.x,this.direction2.x),H=(0,j.RandomRange)(this.direction1.y,this.direction2.y),A=(0,j.RandomRange)(this.direction1.z,this.direction2.z);N?P.fc(q,H,A):c.tP.TransformNormalFromFloatsToRef(q,H,A,F,P)}clone(){const F=new C(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return i.c.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("height",this.height),F.setFloat("radiusRange",this.radiusRange),F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("height",1),F.addUniform("radiusRange",1),F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const F=super.serialize();return F.direction1=this.direction1.pf(),F.direction2=this.direction2.pf(),F}parse(F){super.parse(F),c.tP.FromArrayToRef(F.direction1,0,this.direction1),c.tP.FromArrayToRef(F.direction2,0,this.direction2)}}class L{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=F,this.radiusRange=P,this.directionRandomizer=f}startDirectionFunction(F,P,f,N){const q=f.position.CP(F.getTranslation()).normalize(),H=(0,j.RandomRange)(0,this.directionRandomizer),A=(0,j.RandomRange)(0,this.directionRandomizer),o=(0,j.RandomRange)(0,this.directionRandomizer);q.x+=H,q.y+=A,q.z+=o,q.normalize(),N?P.q(q):c.tP.TransformNormalFromFloatsToRef(q.x,q.y,q.z,F,P)}startPositionFunction(F,P,f,N){const q=this.radius-(0,j.RandomRange)(0,this.radius*this.radiusRange),H=(0,j.RandomRange)(0,1),A=(0,j.RandomRange)(0,2*Math.PI),o=Math.acos(2*H-1),i=q*Math.cos(A)*Math.sin(o),u=q*Math.cos(o),T=q*Math.sin(A)*Math.sin(o);N?P.fc(i,Math.abs(u),T):c.tP.TransformCoordinatesFromFloatsToRef(i,Math.abs(u),T,F,P)}clone(){const F=new L(this.radius,this.directionRandomizer);return i.c.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("radiusRange",this.radiusRange),F.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("radiusRange",1),F.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.radius=this.radius,F.radiusRange=this.radiusRange,F.directionRandomizer=this.directionRandomizer,F}parse(F){this.radius=F.radius,this.radiusRange=F.radiusRange,this.directionRandomizer=F.directionRandomizer}}class J{constructor(){this.direction1=new c.tP(0,1,0),this.direction2=new c.tP(0,1,0)}startDirectionFunction(F,P,f,N){const q=(0,j.RandomRange)(this.direction1.x,this.direction2.x),H=(0,j.RandomRange)(this.direction1.y,this.direction2.y),A=(0,j.RandomRange)(this.direction1.z,this.direction2.z);N?P.fc(q,H,A):c.tP.TransformNormalFromFloatsToRef(q,H,A,F,P)}startPositionFunction(F,P,f,N){N?P.fc(0,0,0):c.tP.TransformCoordinatesFromFloatsToRef(0,0,0,F,P)}clone(){const F=new J;return i.c.DeepCopy(this,F),F}applyToShader(F){F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.direction1=this.direction1.pf(),F.direction2=this.direction2.pf(),F}parse(F){c.tP.FromArrayToRef(F.direction1,0,this.direction1),c.tP.FromArrayToRef(F.direction2,0,this.direction2)}}class B{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=F,this.radiusRange=P,this.directionRandomizer=f}startDirectionFunction(F,P,f,N){const q=f.position.CP(F.getTranslation()).normalize(),H=(0,j.RandomRange)(0,this.directionRandomizer),A=(0,j.RandomRange)(0,this.directionRandomizer),o=(0,j.RandomRange)(0,this.directionRandomizer);q.x+=H,q.y+=A,q.z+=o,q.normalize(),N?P.q(q):c.tP.TransformNormalFromFloatsToRef(q.x,q.y,q.z,F,P)}startPositionFunction(F,P,f,N){const q=this.radius-(0,j.RandomRange)(0,this.radius*this.radiusRange),H=(0,j.RandomRange)(0,1),A=(0,j.RandomRange)(0,2*Math.PI),o=Math.acos(2*H-1),i=q*Math.cos(A)*Math.sin(o),u=q*Math.cos(o),T=q*Math.sin(A)*Math.sin(o);N?P.fc(i,u,T):c.tP.TransformCoordinatesFromFloatsToRef(i,u,T,F,P)}clone(){const F=new B(this.radius,this.directionRandomizer);return i.c.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("radiusRange",this.radiusRange),F.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("radiusRange",1),F.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.radius=this.radius,F.radiusRange=this.radiusRange,F.directionRandomizer=this.directionRandomizer,F}parse(F){this.radius=F.radius,this.radiusRange=F.radiusRange,this.directionRandomizer=F.directionRandomizer}}class z extends B{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.tP(0,1,0),f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.tP(0,1,0);super(F),this.direction1=P,this.direction2=f}startDirectionFunction(F,P){const f=(0,j.RandomRange)(this.direction1.x,this.direction2.x),N=(0,j.RandomRange)(this.direction1.y,this.direction2.y),q=(0,j.RandomRange)(this.direction1.z,this.direction2.z);c.tP.TransformNormalFromFloatsToRef(f,N,q,F,P)}clone(){const F=new z(this.radius,this.direction1,this.direction2);return i.c.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("radiusRange",this.radiusRange),F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("radiusRange",1),F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const F=super.serialize();return F.direction1=this.direction1.pf(),F.direction2=this.direction2.pf(),F}parse(F){super.parse(F),this.direction1.q(F.direction1),this.direction2.q(F.direction2)}}class Z{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(F,P,f,N){const q=c.TmpVectors.tP[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,f,q);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,f,q);const F=c.TmpVectors.tP[1];q.subtractToRef(f.position,F),F.scaleToRef(1/f.lifeTime,q)}else q.set(0,0,0);N?P.q(q):c.tP.TransformNormalToRef(q,F,P)}startPositionFunction(F,P,f,N){const q=c.TmpVectors.tP[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,f,q):q.set(0,0,0),N?P.q(q):c.tP.TransformCoordinatesToRef(q,F,P)}clone(){const F=new Z;return i.c.DeepCopy(this,F),F}applyToShader(F){}buildUniformLayout(F){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.particlePositionGenerator=this.particlePositionGenerator,F.particleDestinationGenerator=this.particleDestinationGenerator,F}parse(F){F.particlePositionGenerator&&(this.particlePositionGenerator=F.particlePositionGenerator),F.particleDestinationGenerator&&(this.particleDestinationGenerator=F.particleDestinationGenerator)}}var R=f(11706);class y{get mesh(){return this._mesh}set mesh(F){this._mesh!==F&&(this._mesh=F,F?(this._indices=F.Fc(),this._positions=F.getVerticesData(R.f.PositionKind),this._normals=F.getVerticesData(R.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=c.tP.Zero(),this._mesh=null,this.direction1=new c.tP(0,1,0),this.direction2=new c.tP(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=F}startDirectionFunction(F,P,f,N){if(this.useMeshNormalsForDirection&&this._normals)return void c.tP.TransformNormalToRef(this._storedNormal,F,P);const q=(0,j.RandomRange)(this.direction1.x,this.direction2.x),H=(0,j.RandomRange)(this.direction1.y,this.direction2.y),A=(0,j.RandomRange)(this.direction1.z,this.direction2.z);N?P.fc(q,H,A):c.tP.TransformNormalFromFloatsToRef(q,H,A,F,P)}startPositionFunction(F,P,f,N){if(!this._indices||!this._positions)return;const q=3*(Math.random()*(this._indices.length/3)|0),H=Math.random(),A=Math.random()*(1-H),o=1-H-A,j=this._indices[q],i=this._indices[q+1],u=this._indices[q+2],T=c.TmpVectors.tP[0],Y=c.TmpVectors.tP[1],t=c.TmpVectors.tP[2],C=c.TmpVectors.tP[3];c.tP.FromArrayToRef(this._positions,3*j,T),c.tP.FromArrayToRef(this._positions,3*i,Y),c.tP.FromArrayToRef(this._positions,3*u,t),C.x=H*T.x+A*Y.x+o*t.x,C.y=H*T.y+A*Y.y+o*t.y,C.z=H*T.z+A*Y.z+o*t.z,N?P.fc(C.x,C.y,C.z):c.tP.TransformCoordinatesFromFloatsToRef(C.x,C.y,C.z,F,P),this.useMeshNormalsForDirection&&this._normals&&(c.tP.FromArrayToRef(this._normals,3*j,T),c.tP.FromArrayToRef(this._normals,3*i,Y),c.tP.FromArrayToRef(this._normals,3*u,t),this._storedNormal.x=H*T.x+A*Y.x+o*t.x,this._storedNormal.y=H*T.y+A*Y.y+o*t.y,this._storedNormal.z=H*T.z+A*Y.z+o*t.z)}clone(){const F=new y(this.mesh);return i.c.DeepCopy(this,F),F}applyToShader(F){F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var F;const P={};return P.type=this.getClassName(),P.direction1=this.direction1.pf(),P.direction2=this.direction2.pf(),P.meshId=null===(F=this.mesh)||void 0===F?void 0:F.id,P.useMeshNormalsForDirection=this.useMeshNormalsForDirection,P}parse(F,P){c.tP.FromArrayToRef(F.direction1,0,this.direction1),c.tP.FromArrayToRef(F.direction2,0,this.direction2),F.meshId&&P&&(this.mesh=P.getLastMeshById(F.meshId)),this.useMeshNormalsForDirection=F.useMeshNormalsForDirection}}class O{_isUbo(F){return void 0!==F.addUniform}constructor(F){this._isUbo(F)?(this.setMatrix3x3=F.updateMatrix3x3.bind(F),this.setMatrix2x2=F.updateMatrix2x2.bind(F),this.setFloat=F.updateFloat.bind(F),this.setFloat2=F.updateFloat2.bind(F),this.setFloat3=F.updateFloat3.bind(F),this.setFloat4=F.updateFloat4.bind(F),this.setFloatArray=F.updateFloatArray.bind(F),this.setArray=F.updateArray.bind(F),this.setIntArray=F.updateIntArray.bind(F),this.setMatrix=F.sf.bind(F),this.setMatrices=F.updateMatrices.bind(F),this.setVector3=F.updateVector3.bind(F),this.setVector4=F.updateVector4.bind(F),this.setColor3=F.updateColor3.bind(F),this.setColor4=F.updateColor4.bind(F),this.setDirectColor4=F.updateDirectColor4.bind(F),this.setInt=F.updateInt.bind(F),this.setInt2=F.updateInt2.bind(F),this.setInt3=F.updateInt3.bind(F),this.setInt4=F.updateInt4.bind(F)):(this.setMatrix3x3=F.setMatrix3x3.bind(F),this.setMatrix2x2=F.setMatrix2x2.bind(F),this.setFloat=F.setFloat.bind(F),this.setFloat2=F.setFloat2.bind(F),this.setFloat3=F.setFloat3.bind(F),this.setFloat4=F.setFloat4.bind(F),this.setFloatArray=F.setFloatArray.bind(F),this.setArray=F.setArray.bind(F),this.setIntArray=F.setIntArray.bind(F),this.setMatrix=F.setMatrix.bind(F),this.setMatrices=F.setMatrices.bind(F),this.setVector3=F.setVector3.bind(F),this.setVector4=F.setVector4.bind(F),this.setColor3=F.setColor3.bind(F),this.setColor4=F.setColor4.bind(F),this.setDirectColor4=F.setDirectColor4.bind(F),this.setInt=F.setInt.bind(F),this.setInt2=F.setInt2.bind(F),this.setInt3=F.setInt3.bind(F),this.setInt4=F.setInt4.bind(F))}}var d=f(11548);const M="gpuUpdateParticlesPixelShader",V="#version 300 es\nvoid main() {discard;}\n";d.c.ShadersStore[M]||(d.c.ShadersStore[M]=V);const Q="gpuUpdateParticlesVertexShader",K="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";d.c.ShadersStore[Q]||(d.c.ShadersStore[Q]=K);(0,A.f)("BABYLON.WebGL2ParticleSystem",class{constructor(F,P){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=F,this._engine=P,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var F;return(null===(F=this._updateEffect)||void 0===F?void 0:F.isReady())??!1}createUpdateBuffer(F){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Z&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=F,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new O(this._updateEffect)}createVertexBuffers(F,P){this._updateVAO.push(this._createUpdateVAO(F)),this._renderVAO.push(this._engine.recordVertexArrayObject(P,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=P}createParticleBuffer(F){return F}bindDrawBuffers(F,P,f){f?this._engine.bindBuffers(this._renderVertexBuffers,f,P):this._engine.bindVertexArrayObject(this._renderVAO[F],null)}preUpdateParticleBuffer(){const F=this._engine;if(this._engine.enableEffect(this._updateEffect),!F.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(F,P,f){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[F],null);const c=this._engine;c.bindTransformFeedbackBuffer(P.getBuffer()),c.setRasterizerState(!1),c.beginTransformFeedback(!0),c.drawArraysType(3,0,f),c.endTransformFeedback(),c.setRasterizerState(!0),c.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let F=0;F<this._updateVAO.length;F++)this._engine.releaseVertexArrayObject(this._updateVAO[F]);this._updateVAO.length=0;for(let F=0;F<this._renderVAO.length;F++)this._engine.releaseVertexArrayObject(this._renderVAO[F]);this._renderVAO.length=0}_createUpdateVAO(F){const P={};P.position=F.createVertexBuffer("position",0,3);let f=3;P.age=F.createVertexBuffer("age",f,1),f+=1,P.size=F.createVertexBuffer("size",f,3),f+=3,P.life=F.createVertexBuffer("life",f,1),f+=1,P.seed=F.createVertexBuffer("seed",f,4),f+=4,P.direction=F.createVertexBuffer("direction",f,3),f+=3,this._parent.particleEmitterType instanceof Z&&(P.initialPosition=F.createVertexBuffer("initialPosition",f,3),f+=3),this._parent._colorGradientsTexture||(P.color=F.createVertexBuffer("color",f,4),f+=4),this._parent._isBillboardBased||(P.initialDirection=F.createVertexBuffer("initialDirection",f,3),f+=3),this._parent.noiseTexture&&(P.noiseCoordinates1=F.createVertexBuffer("noiseCoordinates1",f,3),f+=3,P.noiseCoordinates2=F.createVertexBuffer("noiseCoordinates2",f,3),f+=3),this._parent._angularSpeedGradientsTexture?(P.angle=F.createVertexBuffer("angle",f,1),f+=1):(P.angle=F.createVertexBuffer("angle",f,2),f+=2),this._parent._isAnimationSheetEnabled&&(P.cellIndex=F.createVertexBuffer("cellIndex",f,1),f+=1,this._parent.spriteRandomStartCell&&(P.cellStartOffset=F.createVertexBuffer("cellStartOffset",f,1),f+=1));const c=this._engine.recordVertexArrayObject(P,null,this._updateEffect);return this._engine.bindArrayBuffer(null),c}});class x{constructor(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,c=arguments.length>3?arguments[3]:void 0;this._engine=F,this._label=c,this._engine._storageBuffers.push(this),this._create(P,f)}_create(F,P){this._bufferSize=F,this._creationFlags=P,this._buffer=this._engine.createStorageBuffer(F,P,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(F,P,f){this._buffer&&this._engine.updateStorageBuffer(this._buffer,F,P,f)}async read(F,P,f,c){return await this._engine.readFromStorageBuffer(this._buffer,F,P,f,c)}dispose(){const F=this._engine._storageBuffers,P=F.indexOf(this);-1!==P&&(F[P]=F[F.length-1],F.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var k=f(11619),I=f(11628),E=f(11677),r=f(11612),n=f(11911),p=f(11474),U=f(11574),e=f(11833);class D{constructor(){this._gpuTimeInFrameId=-1,this.counter=new e.b}_addDuration(F,P){F<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==F?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(P,!1),this._gpuTimeInFrameId=F):this.counter.addCount(P,!1))}}var l=f(11538);class W{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=F,this._engine=P,this.uniqueId=n.c.UniqueId,P.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new D),this._engine.getCaps().supportComputeShaders?c.bindingsMapping?(this._context=P.createComputeContext(),this._shaderPath=f,this._options={bindingsMapping:{},defines:[],...c}):p.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):p.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(F,P){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const c=this._bindings[F];this._bindings[F]={type:f?0:4,object:P,indexInGroupEntries:null===c||void 0===c?void 0:c.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!c||c.object!==P||c.type!==this._bindings[F].type)}setStorageTexture(F,P){const f=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!f||f.object!==P),this._bindings[F]={type:1,object:P,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}setExternalTexture(F,P){const f=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!f||f.object!==P),this._bindings[F]={type:6,object:P,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}setVideoTexture(F,P){return!!P.externalTexture&&(this.setExternalTexture(F,P.externalTexture),!0)}setUniformBuffer(F,P){const f=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!f||f.object!==P),this._bindings[F]={type:W._BufferIsDataBuffer(P)?7:2,object:P,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}setStorageBuffer(F,P){const f=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!f||f.object!==P),this._bindings[F]={type:W._BufferIsDataBuffer(P)?7:3,object:P,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}setTextureSampler(F,P){const f=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!f||!P.compareSampler(f.object)),this._bindings[F]={type:5,object:P,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries}}isReady(){let F=this._effect;for(const N in this._bindings){const F=this._bindings[N],P=F.type,f=F.object;switch(P){case 0:case 4:case 1:if(!f.isReady())return!1;break;case 6:if(!f.isReady())return!1;break}}const P=[],f=this._shaderPath;if(this._options.defines)for(let N=0;N<this._options.defines.length;N++)P.push(this._options.defines[N]);const c=P.join("\n");return this._cachedDefines!==c&&(this._cachedDefines=c,F=this._engine.createComputeEffect(f,{defines:c,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=F),!!F.isReady()}dispatch(F,P,f){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,F,P,f,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const f=W._BufferIsDataBuffer(F)?F:F.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,f,P,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const P in this._bindings){const f=this._bindings[P];if(!this._options.bindingsMapping[P])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+P+"'");switch(f.type){case 0:{const c=this._samplers[P],N=f.object;var F;if(!c||!N._texture||!c.compareSampler(N._texture))this._samplers[P]=(new U.e).setParameters(N.wrapU,N.wrapV,N.wrapR,N.anisotropicFilteringLevel,N._texture.samplingMode,null===(F=N._texture)||void 0===F?void 0:F._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const F=f.object;F.getBuffer()!==f.buffer&&(f.buffer=F.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((N=>{(0,l.f)((()=>this.dispatch(F,P,f)),N,void 0,c)}))}serialize(){const F=E.e.Serialize(this);F.options=this._options,F.shaderPath=this._shaderPath,F.VT={},F.textures={};for(const P in this._bindings){const f=this._bindings[P],c=f.object;switch(f.type){case 0:case 4:case 1:{const N=c.serialize();N&&(F.textures[P]=N,F.VT[P]={type:f.type});break}}}return F}static Parse(F,P,f){const c=E.e.Parse((()=>new W(F.name,P.getEngine(),F.shaderPath,F.options)),F,P,f);for(const N in F.textures){const q=F.VT[N],H=r.e.Parse(F.textures[N],P,f);0===q.type?c.setTexture(N,H):4===q.type?c.setTexture(N,H,!1):c.setStorageTexture(N,H)}return c}static _BufferIsDataBuffer(F){return void 0!==F.underlyingResource}}(0,k.e)([(0,I.L)()],W.prototype,"name",void 0),(0,k.e)([(0,I.L)()],W.prototype,"fastMode",void 0),(0,A.f)("BABYLON.ComputeShader",W);var b=f(11869);const v="gpuUpdateParticlesComputeShader",s="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";d.c.ShadersStoreWGSL[v]||(d.c.ShadersStoreWGSL[v]=s);(0,A.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(F,P){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=F,this._engine=P}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var F;return(null===(F=this._updateComputeShader)||void 0===F?void 0:F.isReady())??!1}createUpdateBuffer(F){var P;const f={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(f.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(f.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(f.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(f.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(f.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(f.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(f.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new W("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:f,defines:F.split("\n")}),null===(P=this._simParamsComputeShader)||void 0===P||P.dispose(),this._simParamsComputeShader=new b.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new O(this._simParamsComputeShader)}createVertexBuffers(F,P){this._renderVertexBuffers.push(P)}createParticleBuffer(F){const P=new x(this._engine,4*F.length,11,"ComputeShaderParticleSystemBuffer");return P.update(F),this._bufferComputeShader.push(P),P.getBuffer()}bindDrawBuffers(F,P,f){this._engine.bindBuffers(this._renderVertexBuffers[F],f,P)}preUpdateParticleBuffer(){}updateParticleBuffer(F,P,f){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[F]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^F]),this._updateComputeShader.dispatch(Math.ceil(f/64))}releaseBuffers(){var F;for(let P=0;P<this._bufferComputeShader.length;++P)this._bufferComputeShader[P].dispose();this._bufferComputeShader.length=0,null===(F=this._simParamsComputeShader)||void 0===F||F.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class X{constructor(F,P,f){this.gradient=F,this.color1=P,this.color2=f}getColorToRef(F){this.color2?H.qc.LerpToRef(this.color1,this.color2,Math.random(),F):F.q(this.color1)}}class m{constructor(F,P){this.gradient=F,this.color=P}}class a{constructor(F,P,f){this.gradient=F,this.factor1=P,this.factor2=f}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class w{static GetCurrentGradient(F,P,f){if(P[0].gradient>F)return void f(P[0],P[0],1);for(let N=0;N<P.length-1;N++){const c=P[N],q=P[N+1];if(F>=c.gradient&&F<=q.gradient){return void f(c,q,(F-c.gradient)/(q.gradient-c.gradient))}}const c=P.length-1;f(P[c],P[c],1)}}var g=f(11464),G=f(12099),h=f(11501);class S{constructor(F){this.particleSystem=F,this.position=c.tP.Zero(),this.direction=c.tP.Zero(),this.color=new H.qc(0,0,0,0),this.colorStep=new H.qc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new c.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new H.qc(0,0,0,0),this._currentColor2=new H.qc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=S._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let F=this.age,P=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===P?(P=1,F=this._randomCellOffset):F+=this._randomCellOffset);const f=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let c;c=this._initialSpriteCellLoop?(0,j.Clamp)(F*P%this.lifeTime/this.lifeTime):(0,j.Clamp)(F*P/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+c*f|0}_inheritParticleInfoToSubEmitter(F){if(F.particleSystem.cP.position){const P=F.particleSystem.cP;if(P.position.q(this.position),F.inheritDirection){const F=c.TmpVectors.tP[0];this.direction.normalizeToRef(F),P.setDirection(F,0,Math.PI/2)}}else{F.particleSystem.cP.q(this.position)}this.direction.scaleToRef(F.inheritedVelocityAmount/2,c.TmpVectors.tP[0]),F.particleSystem._inheritedVelocityOffset.q(c.TmpVectors.tP[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const F of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(F)}_reset(){this.age=0,this.id=S._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(F){F.position.q(this.position),this._initialDirection?F._initialDirection?F._initialDirection.q(this._initialDirection):F._initialDirection=this._initialDirection.clone():F._initialDirection=null,F.direction.q(this.direction),this.Co&&(F.Co?F.Co.q(this.Co):F.Co=this.Co.clone()),F.color.q(this.color),F.colorStep.q(this.colorStep),F.lifeTime=this.lifeTime,F.age=this.age,F._randomCellOffset=this._randomCellOffset,F.size=this.size,F.scale.q(this.scale),F.angle=this.angle,F.angularSpeed=this.angularSpeed,F.particleSystem=this.particleSystem,F.cellIndex=this.cellIndex,F.id=this.id,F._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(F._currentColorGradient=this._currentColorGradient,F._currentColor1.q(this._currentColor1),F._currentColor2.q(this._currentColor2)),this._currentSizeGradient&&(F._currentSizeGradient=this._currentSizeGradient,F._currentSize1=this._currentSize1,F._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(F._currentAngularSpeedGradient=this._currentAngularSpeedGradient,F._currentAngularSpeed1=this._currentAngularSpeed1,F._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(F._currentVelocityGradient=this._currentVelocityGradient,F._currentVelocity1=this._currentVelocity1,F._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(F._currentLimitVelocityGradient=this._currentLimitVelocityGradient,F._currentLimitVelocity1=this._currentLimitVelocity1,F._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(F._currentDragGradient=this._currentDragGradient,F._currentDrag1=this._currentDrag1,F._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(F._initialStartSpriteCellId=this._initialStartSpriteCellId,F._initialEndSpriteCellId=this._initialEndSpriteCellId,F._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(F.remapData&&this.remapData?F.remapData.q(this.remapData):F.remapData=new c.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(F._randomNoiseCoordinates1?(F._randomNoiseCoordinates1.q(this._randomNoiseCoordinates1),F._randomNoiseCoordinates2.q(this._randomNoiseCoordinates2)):(F._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),F._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}S._Count=0;var FF=f(11739),PF=(f(11773),f(11976)),fF=f(11973),cF=f(11866);function NF(F,P){const f=(0,j.RandomRange)(0,1);H.qc.LerpToRef(P.color1,P.color2,f,F.color),P.colorDead.subtractToRef(F.color,P._colorDiff),P._colorDiff.scaleToRef(1/F.lifeTime,F.colorStep)}function qF(F,P){F._currentColorGradient=P._colorGradients[0],F._currentColorGradient.getColorToRef(F.color),F._currentColor1.q(F.color),P._colorGradients.length>1?P._colorGradients[1].getColorToRef(F._currentColor2):F._currentColor2.q(F.color)}function HF(F,P){const f=P._colorGradients;w.GetCurrentGradient(P._ratio,f,((P,f,c)=>{P!==F._currentColorGradient&&(F._currentColor1.q(F._currentColor2),f.getColorToRef(F._currentColor2),F._currentColorGradient=P),H.qc.LerpToRef(F._currentColor1,F._currentColor2,c,F.color)}))}function AF(F,P){F.colorStep.scaleToRef(P._scaledUpdateSpeed,P._scaledColorStep),F.color.addInPlace(P._scaledColorStep),F.color.a<0&&(F.color.a=0)}function oF(F,P){w.GetCurrentGradient(P._ratio,P._angularSpeedGradients,((P,f,c)=>{P!==F._currentAngularSpeedGradient&&(F._currentAngularSpeed1=F._currentAngularSpeed2,F._currentAngularSpeed2=f.getFactor(),F._currentAngularSpeedGradient=P),F.angularSpeed=(0,j.Lerp)(F._currentAngularSpeed1,F._currentAngularSpeed2,c)}))}function jF(F,P){F.angle+=F.angularSpeed*P._scaledUpdateSpeed}function iF(F,P){P.particleEmitterType.startDirectionFunction(P._emitterWorldMatrix,F.direction,F,P.isLocal,P._emitterInverseWorldMatrix)}function uF(F,P){P.startDirectionFunction(P._emitterWorldMatrix,F.direction,F,P.isLocal)}function TF(F,P){F._currentVelocityGradient=P._velocityGradients[0],F._currentVelocity1=F._currentVelocityGradient.getFactor(),P._velocityGradients.length>1?F._currentVelocity2=P._velocityGradients[1].getFactor():F._currentVelocity2=F._currentVelocity1}function YF(F,P){F._currentLimitVelocityGradient=P._limitVelocityGradients[0],F._currentLimitVelocity1=F._currentLimitVelocityGradient.getFactor(),P._limitVelocityGradients.length>1?F._currentLimitVelocity2=P._limitVelocityGradients[1].getFactor():F._currentLimitVelocity2=F._currentLimitVelocity1}function tF(F,P){w.GetCurrentGradient(P._ratio,P._velocityGradients,((f,c,N)=>{f!==F._currentVelocityGradient&&(F._currentVelocity1=F._currentVelocity2,F._currentVelocity2=c.getFactor(),F._currentVelocityGradient=f),P._directionScale*=(0,j.Lerp)(F._currentVelocity1,F._currentVelocity2,N)}))}function CF(F,P){w.GetCurrentGradient(P._ratio,P._limitVelocityGradients,((f,c,N)=>{f!==F._currentLimitVelocityGradient&&(F._currentLimitVelocity1=F._currentLimitVelocity2,F._currentLimitVelocity2=c.getFactor(),F._currentLimitVelocityGradient=f);const q=(0,j.Lerp)(F._currentLimitVelocity1,F._currentLimitVelocity2,N);F.direction.length()>q&&F.direction.scaleInPlace(P.limitVelocityDamping)}))}function LF(F,P){F.direction.scaleToRef(P._directionScale,P._scaledDirection)}function JF(F,P){P.particleEmitterType.startPositionFunction(P._emitterWorldMatrix,F.position,F,P.isLocal)}function BF(F,P){P.startPositionFunction(P._emitterWorldMatrix,F.position,F,P.isLocal)}function zF(F,P){F.Co?F.Co.q(F.position):F.Co=F.position.clone(),c.tP.TransformCoordinatesToRef(F.Co,P._emitterWorldMatrix,F.position)}function ZF(F,P){P.isLocal&&F.Co?(F.Co.addInPlace(P._scaledDirection),c.tP.TransformCoordinatesToRef(F.Co,P._emitterWorldMatrix,F.position)):F.position.addInPlace(P._scaledDirection)}function RF(F,P){F._currentDragGradient=P._dragGradients[0],F._currentDrag1=F._currentDragGradient.getFactor(),P._dragGradients.length>1?F._currentDrag2=P._dragGradients[1].getFactor():F._currentDrag2=F._currentDrag1}function yF(F,P){w.GetCurrentGradient(P._ratio,P._dragGradients,((f,c,N)=>{f!==F._currentDragGradient&&(F._currentDrag1=F._currentDrag2,F._currentDrag2=c.getFactor(),F._currentDragGradient=f);const q=(0,j.Lerp)(F._currentDrag1,F._currentDrag2,N);P._scaledDirection.scaleInPlace(1-q)}))}function OF(F,P){F._randomNoiseCoordinates1?(F._randomNoiseCoordinates1.fc(Math.random(),Math.random(),Math.random()),F._randomNoiseCoordinates2.fc(Math.random(),Math.random(),Math.random())):(F._randomNoiseCoordinates1=new c.tP(Math.random(),Math.random(),Math.random()),F._randomNoiseCoordinates2=new c.tP(Math.random(),Math.random(),Math.random()))}function dF(F,P){const f=P._noiseTextureData,N=P._noiseTextureSize;if(f&&N&&F._randomNoiseCoordinates1){const q=P._fetchR(F._randomNoiseCoordinates1.x,F._randomNoiseCoordinates1.y,N.width,N.height,f),H=P._fetchR(F._randomNoiseCoordinates1.z,F._randomNoiseCoordinates2.x,N.width,N.height,f),A=P._fetchR(F._randomNoiseCoordinates2.y,F._randomNoiseCoordinates2.z,N.width,N.height,f),o=c.TmpVectors.tP[0],j=c.TmpVectors.tP[1];o.fc((2*q-1)*P.noiseStrength.x,(2*H-1)*P.noiseStrength.y,(2*A-1)*P.noiseStrength.z),o.scaleToRef(P._tempScaledUpdateSpeed,j),F.direction.addInPlace(j)}}function MF(F,P){P.gravity.scaleToRef(P._tempScaledUpdateSpeed,P._scaledGravity),F.direction.addInPlace(P._scaledGravity)}function VF(F,P){F.size=(0,j.RandomRange)(P.minSize,P.maxSize),F.scale.fc((0,j.RandomRange)(P.minScaleX,P.maxScaleX),(0,j.RandomRange)(P.minScaleY,P.maxScaleY))}function QF(F,P){F._currentSizeGradient=P._sizeGradients[0],F._currentSize1=F._currentSizeGradient.getFactor(),F.size=F._currentSize1,P._sizeGradients.length>1?F._currentSize2=P._sizeGradients[1].getFactor():F._currentSize2=F._currentSize1,F.scale.fc((0,j.RandomRange)(P.minScaleX,P.maxScaleX),(0,j.RandomRange)(P.minScaleY,P.maxScaleY))}function KF(F,P){const f=P._actualFrame/P.targetStopDuration;w.GetCurrentGradient(f,P._startSizeGradients,((f,c,N)=>{f!==P._currentStartSizeGradient&&(P._currentStartSize1=P._currentStartSize2,P._currentStartSize2=c.getFactor(),P._currentStartSizeGradient=f);const q=(0,j.Lerp)(P._currentStartSize1,P._currentStartSize2,N);F.scale.scaleInPlace(q)}))}function xF(F,P){w.GetCurrentGradient(P._ratio,P._sizeGradients,((P,f,c)=>{P!==F._currentSizeGradient&&(F._currentSize1=F._currentSize2,F._currentSize2=f.getFactor(),F._currentSizeGradient=P),F.size=(0,j.Lerp)(F._currentSize1,F._currentSize2,c)}))}function kF(F,P){F.remapData=new c.Vector4(0,1,0,1)}function IF(F,P){P._colorRemapGradients&&P._colorRemapGradients.length>0&&w.GetCurrentGradient(P._ratio,P._colorRemapGradients,((P,f,c)=>{const N=(0,j.Lerp)(P.factor1,f.factor1,c),q=(0,j.Lerp)(P.factor2,f.factor2,c);F.remapData.x=N,F.remapData.y=q-N})),P._alphaRemapGradients&&P._alphaRemapGradients.length>0&&w.GetCurrentGradient(P._ratio,P._alphaRemapGradients,((P,f,c)=>{const N=(0,j.Lerp)(P.factor1,f.factor1,c),q=(0,j.Lerp)(P.factor2,f.factor2,c);F.remapData.z=N,F.remapData.w=q-N}))}function EF(F,P){const f=(0,j.Clamp)(P._actualFrame/P.targetStopDuration);w.GetCurrentGradient(f,P._lifeTimeGradients,((P,c)=>{const N=P,q=c,H=N.getFactor(),A=q.getFactor(),o=(f-N.gradient)/(q.gradient-N.gradient);F.lifeTime=(0,j.Lerp)(H,A,o)})),P._emitPower=(0,j.RandomRange)(P.minEmitPower,P.maxEmitPower)}function rF(F,P){F.lifeTime=(0,j.RandomRange)(P.minLifeTime,P.maxLifeTime),P._emitPower=(0,j.RandomRange)(P.minEmitPower,P.maxEmitPower)}function nF(F,P){0===P._emitPower?(F._initialDirection?F._initialDirection.q(F.direction):F._initialDirection=F.direction.clone(),F.direction.set(0,0,0)):(F._initialDirection=null,F.direction.scaleInPlace(P._emitPower)),F.direction.addInPlace(P._inheritedVelocityOffset)}function pF(F,P){F.angularSpeed=(0,j.RandomRange)(P.minAngularSpeed,P.maxAngularSpeed),F.angle=(0,j.RandomRange)(P.minInitialRotation,P.maxInitialRotation)}function UF(F,P){F._currentAngularSpeedGradient=P._angularSpeedGradients[0],F.angularSpeed=F._currentAngularSpeedGradient.getFactor(),F._currentAngularSpeed1=F.angularSpeed,P._angularSpeedGradients.length>1?F._currentAngularSpeed2=P._angularSpeedGradients[1].getFactor():F._currentAngularSpeed2=F._currentAngularSpeed1,F.angle=(0,j.RandomRange)(P.minInitialRotation,P.maxInitialRotation)}function eF(F,P){F._initialStartSpriteCellId=P.startSpriteCellID,F._initialEndSpriteCellId=P.endSpriteCellID,F._initialSpriteCellLoop=P.spriteCellLoop}function DF(F,P){F.previousItem=P.previousItem,F.nextItem=P,P.previousItem&&(P.previousItem.nextItem=F),P.previousItem=F}function lF(F,P){F.previousItem=P,F.nextItem=P.nextItem,P.nextItem&&(P.nextItem.previousItem=F),P.nextItem=F}function WF(F,P){let f=P;for(;f.nextItem;)f=f.nextItem;F.previousItem=f,F.nextItem=f.nextItem,f.nextItem=F}function bF(F){F.previousItem&&(F.previousItem.nextItem=F.nextItem),F.nextItem&&(F.nextItem.previousItem=F.previousItem)}class vF extends o{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(F){this._startDirectionFunction!==F&&(this._startDirectionFunction=F,this._directionProcessing.process=F?uF:iF)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(F){this._startPositionFunction!==F&&(this._startPositionFunction=F,this._positionCreation.process=F?BF:JF)}set onDispose(F){this._onDisposeObserver&&this.Mf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Mf.add(F)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(F){this._useRampGradients!==F&&(this._useRampGradients=F,this._resetEffect(),F?(this._rampCreation={process:kF,previousItem:null,nextItem:null},lF(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:IF,previousItem:null,nextItem:null},lF(this._remapGradientProcessing,this._gravityProcessing)):(bF(this._rampCreation),bF(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(F){this._isLocal!==F&&(this._isLocal=F,F?(this._isLocalCreation={process:zF,previousItem:null,nextItem:null},lF(this._isLocalCreation,this._positionCreation)):bF(this._isLocalCreation))}get particles(){return this.RT}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(F){this._animationSheetEnabled!==F&&(this._animationSheetEnabled=F,F?(this._sheetCreation={process:eF,previousItem:null,nextItem:null},lF(this._sheetCreation,this._colorCreation)):bF(this._sheetCreation),this._reset())}getActiveCount(){return this.RT.length}getClassName(){return"Tc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var F;let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(F=this._customWrappers[P])||void 0===F?void 0:F.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[F]??this._customWrappers[0]}setCustomEffect(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[P]=new FF.d(this._engine),this._customWrappers[P].effect=F,this._customWrappers[P].drawContext&&(this._customWrappers[P].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new g.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(F){if(this.noiseTexture!==F){if(this._noiseTexture=F,!F)return bF(this._noiseCreation),void bF(this._noiseProcessing);this._noiseCreation={process:OF,previousItem:null,nextItem:null},lF(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:dF,previousItem:null,nextItem:null},lF(this._noiseProcessing,this._positionProcessing)}}constructor(F,P,f){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(F),this._emitterInverseWorldMatrix=c.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new c.tP,this.Mf=new g.d,this.onStoppedObservable=new g.d,this.onStartedObservable=new g.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.RT=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new H.qc(0,0,0,0),this._colorDiff=new H.qc(0,0,0,0),this._scaledDirection=c.tP.Zero(),this._scaledGravity=c.tP.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=F=>{},this.recycleParticle=F=>{const P=this.RT.pop();P!==F&&P.copyTo(F),this._stockParticles.push(P)},this._createParticle=()=>{let F;return 0!==this._stockParticles.length?(F=this._stockParticles.pop(),F._reset()):F=new S(this),this._prepareParticle(F),F},this.paused=!1,this._shadersLoaded=!1,this._capacity=P,this._epsilon=A,f&&"Scene"!==f.getClassName()?(this._engine=f,this.defaultProjectionMatrix=c.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=f||h.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.zT.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:rF,previousItem:null,nextItem:null},this._positionCreation={process:JF,previousItem:null,nextItem:null},lF(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:iF,previousItem:null,nextItem:null},lF(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:nF,previousItem:null,nextItem:null},lF(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:VF,previousItem:null,nextItem:null},lF(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:pF,previousItem:null,nextItem:null},lF(this._angleCreation,this._sizeCreation),this._colorCreation={process:NF,previousItem:null,nextItem:null},lF(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,o||(this._colorProcessing={process:AF,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:jF,previousItem:null,nextItem:null},lF(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:LF,previousItem:null,nextItem:null},lF(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:ZF,previousItem:null,nextItem:null},lF(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:MF,previousItem:null,nextItem:null},lF(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=q,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new FF.d(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new u,this.updateFunction=F=>{var P;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(P=this.noiseTexture.getContent())||void 0===P||P.then((F=>{this._noiseTextureData=F})));const f=F===this.RT;for(let c=0;c<F.length;c++){const P=F[c];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const N=P.age;if(P.age+=this._tempScaledUpdateSpeed,P.age>P.lifeTime){const F=P.age-N,f=P.lifeTime-N;this._tempScaledUpdateSpeed=f*this._tempScaledUpdateSpeed/F,P.age=P.lifeTime}this._ratio=P.age/P.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let q=this._updateQueueStart;for(;q;)q.process(P,this),q=q.nextItem;if(this._isAnimationSheetEnabled&&!o&&P.updateCellIndex(),P._inheritParticleInfoToSubEmitters(),P.age>=P.lifeTime){if(this._emitFromParticle(P),P._attachedSubEmitters){for(const F of P._attachedSubEmitters)F.particleSystem.disposeOnStop=!0,F.particleSystem.stop();P._attachedSubEmitters=null}this.recycleParticle(P),f&&c--}else;}}}serialize(F){throw new Error("Method not implemented.")}clone(F,P){throw new Error("Method not implemented.")}_addFactorGradient(F,P,f,c){const N=new a(P,f,c);F.push(N),F.sort(((F,P)=>F.gradient<P.gradient?-1:F.gradient>P.gradient?1:0))}_removeFactorGradient(F,P){if(!F)return;let f=0;for(const c of F){if(c.gradient===P){F.splice(f,1);break}f++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=EF:this._lifeTimeCreation.process=rF}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:KF,previousItem:null,nextItem:null},lF(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(bF(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(F){this.targetStopDuration!==F&&(this._targetStopDuration=F,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(F,P,f){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,F,P,f),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(F){return this._removeFactorGradient(this._lifeTimeGradients,F),this._syncLifeTimeCreation(),this}addSizeGradient(F,P,f){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=QF,this._sizeGradientProcessing={process:xF,previousItem:null,nextItem:null},DF(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,F,P,f),this}removeSizeGradient(F){var P;return this._removeFactorGradient(this._sizeGradients,F),0===(null===(P=this._sizeGradients)||void 0===P?void 0:P.length)&&(bF(this._sizeGradientProcessing),this._sizeCreation.process=VF),this}addColorRemapGradient(F,P,f){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,F,P,f),this}removeColorRemapGradient(F){return this._removeFactorGradient(this._colorRemapGradients,F),this}addAlphaRemapGradient(F,P,f){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,F,P,f),this}removeAlphaRemapGradient(F){return this._removeFactorGradient(this._alphaRemapGradients,F),this}addAngularSpeedGradient(F,P,f){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=UF,this._angularSpeedGradientProcessing={process:oF,previousItem:null,nextItem:null},DF(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,F,P,f),this}removeAngularSpeedGradient(F){var P;return this._removeFactorGradient(this._angularSpeedGradients,F),0===(null===(P=this._angularSpeedGradients)||void 0===P?void 0:P.length)&&(this._angleCreation.process=pF,bF(this._angularSpeedGradientProcessing)),this}addVelocityGradient(F,P,f){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:TF,previousItem:null,nextItem:null},lF(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:tF,previousItem:null,nextItem:null},DF(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,F,P,f),this}removeVelocityGradient(F){var P;return this._removeFactorGradient(this._velocityGradients,F),0===(null===(P=this._velocityGradients)||void 0===P?void 0:P.length)&&(bF(this._velocityCreation),bF(this._velocityGradientProcessing)),this}addLimitVelocityGradient(F,P,f){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:YF,previousItem:null,nextItem:null},lF(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:CF,previousItem:null,nextItem:null},lF(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,F,P,f),this}removeLimitVelocityGradient(F){var P;return this._removeFactorGradient(this._limitVelocityGradients,F),0===(null===(P=this._limitVelocityGradients)||void 0===P?void 0:P.length)&&(bF(this._limitVelocityCreation),bF(this._limitVelocityGradientProcessing)),this}addDragGradient(F,P,f){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:RF,previousItem:null,nextItem:null},DF(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:yF,previousItem:null,nextItem:null},DF(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,F,P,f),this}removeDragGradient(F){var P;return this._removeFactorGradient(this._dragGradients,F),0===(null===(P=this._dragGradients)||void 0===P?void 0:P.length)&&(bF(this._dragCreation),bF(this._dragGradientProcessing)),this}addEmitRateGradient(F,P,f){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,F,P,f),this}removeEmitRateGradient(F){return this._removeFactorGradient(this._emitRateGradients,F),this}addStartSizeGradient(F,P,f){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,F,P,f),this._syncStartSizeCreation(),this}removeStartSizeGradient(F){return this._removeFactorGradient(this._startSizeGradients,F),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const F=new Uint8Array(4*this._rawTextureWidth),P=H.TmpColors.BP[0];for(let f=0;f<this._rawTextureWidth;f++){const c=f/this._rawTextureWidth;w.GetCurrentGradient(c,this._rampGradients,((c,N,q)=>{H.BP.LerpToRef(c.color,N.color,q,P),F[4*f]=255*P.r,F[4*f+1]=255*P.g,F[4*f+2]=255*P.b,F[4*f+3]=255}))}this._rampGradientsTexture=G.e.CreateRGBATexture(F,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((F,P)=>F.gradient<P.gradient?-1:F.gradient>P.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(F,P){this._rampGradients||(this._rampGradients=[]);const f=new m(F,P);return this._rampGradients.push(f),this._syncRampGradientTexture(),this}removeRampGradient(F){return this._removeGradientAndTexture(F,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(F,P,f){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=qF,this._colorProcessing.process=HF);const c=new X(F,P,f);return this._colorGradients.push(c),this._colorGradients.sort(((F,P)=>F.gradient<P.gradient?-1:F.gradient>P.gradient?1:0)),this}removeColorGradient(F){if(!this._colorGradients)return this;let P=0;for(const f of this._colorGradients){if(f.gradient===F){this._colorGradients.splice(P,1);break}P++}return 0===this._colorGradients.length&&(this._colorCreation.process=NF,this._colorProcessing.process=AF),this}resetDrawCache(){if(this._drawWrappers){for(const F of this._drawWrappers)if(F)for(const P of F)null===P||void 0===P||P.dispose();this._drawWrappers=[]}}_fetchR(F,P,f,c,N){return N[4*(((F=.5*Math.abs(F)+.5)*f%f|0)+((P=.5*Math.abs(P)+.5)*c%c|0)*f)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const F=this._engine,P=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*P),this._vertexBuffer=new R.e(F,this._vertexData,!0,P);let f=0;const c=this._vertexBuffer.createVertexBuffer(R.f.PositionKind,f,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[R.f.PositionKind]=c,f+=3;const N=this._vertexBuffer.createVertexBuffer(R.f.ColorKind,f,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[R.f.ColorKind]=N,f+=4;const q=this._vertexBuffer.createVertexBuffer("angle",f,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=q,f+=1;const H=this._vertexBuffer.createVertexBuffer("size",f,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=H,f+=2,this._isAnimationSheetEnabled){const F=this._vertexBuffer.createVertexBuffer("cellIndex",f,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=F,f+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const F=this._vertexBuffer.createVertexBuffer("direction",f,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=F,f+=3}if(this._useRampGradients){const F=this._vertexBuffer.createVertexBuffer("remapData",f,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=F,f+=4}let A;if(this._useInstancing){const P=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new R.e(F,P,!1,2),A=this._spriteBuffer.createVertexBuffer("offset",0,2)}else A=this._vertexBuffer.createVertexBuffer("offset",f,2,this._vertexBufferSize,this._useInstancing),f+=2;this._vertexBuffers.offset=A,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const F=[],P=[];let f=0;for(let c=0;c<this._capacity;c++)F.push(f),F.push(f+1),F.push(f+2),F.push(f),F.push(f+2),F.push(f+3),P.push(f,f+1,f+1,f+2,f+2,f+3,f+3,f,f,f+3),f+=4;this._indexBuffer=this._engine.createIndexBuffer(F),this._linesIndexBuffer=this._engine.createIndexBuffer(P)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(F)setTimeout((()=>{this.start(0)}),F);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var P;-1!==(null===(P=this.cP)||void 0===P?void 0:P.getClassName().indexOf("Mesh"))&&this.cP.gf(!0);const F=this.noiseTexture;if(F&&F.onGeneratedObservable)F.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let P=0;P<this.preWarmCycles;P++)this.animate(!0),F.render()}))}));else for(let P=0;P<this.preWarmCycles;P++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(F))}_postStop(F){}reset(){this._stockParticles.length=0,this.RT.length=0}_appendParticleVertex(F,P,f,N){let q=F*this._vertexBufferSize;if(this._vertexData[q++]=P.position.x+this.ej.x,this._vertexData[q++]=P.position.y+this.ej.y,this._vertexData[q++]=P.position.z+this.ej.z,this._vertexData[q++]=P.color.r,this._vertexData[q++]=P.color.g,this._vertexData[q++]=P.color.b,this._vertexData[q++]=P.color.a,this._vertexData[q++]=P.angle,this._vertexData[q++]=P.scale.x*P.size,this._vertexData[q++]=P.scale.y*P.size,this._isAnimationSheetEnabled&&(this._vertexData[q++]=P.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[q++]=P.direction.x,this._vertexData[q++]=P.direction.y,this._vertexData[q++]=P.direction.z);else if(P._initialDirection){let F=P._initialDirection;this.isLocal&&(c.tP.TransformNormalToRef(F,this._emitterWorldMatrix,c.TmpVectors.tP[0]),F=c.TmpVectors.tP[0]),0===F.x&&0===F.z&&(F.x=.001),this._vertexData[q++]=F.x,this._vertexData[q++]=F.y,this._vertexData[q++]=F.z}else{let F=P.direction;this.isLocal&&(c.tP.TransformNormalToRef(F,this._emitterWorldMatrix,c.TmpVectors.tP[0]),F=c.TmpVectors.tP[0]),0===F.x&&0===F.z&&(F.x=.001),this._vertexData[q++]=F.x,this._vertexData[q++]=F.y,this._vertexData[q++]=F.z}this._useRampGradients&&P.remapData&&(this._vertexData[q++]=P.remapData.x,this._vertexData[q++]=P.remapData.y,this._vertexData[q++]=P.remapData.z,this._vertexData[q++]=P.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===f?f=this._epsilon:1===f&&(f=1-this._epsilon),0===N?N=this._epsilon:1===N&&(N=1-this._epsilon)),this._vertexData[q++]=f,this._vertexData[q++]=N)}_prepareParticle(F){}_createNewOnes(F){let P;for(let f=0;f<F&&this.RT.length!==this._capacity;f++){P=this._createParticle(),this.RT.push(P);let F=this._createQueueStart;for(;F;)F.process(P,this),F=F.nextItem;P._inheritParticleInfoToSubEmitters()}}_update(F){if(this._alive=this.RT.length>0,this.cP.position){const F=this.cP;this._emitterWorldMatrix=F.getWorldMatrix()}else{const F=this.cP;this._emitterWorldMatrix=c.Matrix.Translation(F.x,F.y,F.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.RT),this._createNewOnes(F)}static _GetAttributeNamesOrOptions(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c=[R.f.PositionKind,R.f.ColorKind,"angle","offset","size"];return F&&c.push("cellIndex"),P||c.push("direction"),f&&c.push("remapData"),c}static _GetEffectCreationOptions(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,PF.c)(c),F&&c.push("particlesInfos"),P&&c.push("logarithmicDepthConstant"),f&&(c.push("vFogInfos"),c.push("vFogColor")),c}fillDefines(F,P){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,PF.l)(this,this._scene,F),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&F.push("#define FOG")),this._isAnimationSheetEnabled&&F.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&F.push("#define LOGARITHMICDEPTH"),P===o.BLENDMODE_MULTIPLY&&F.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&F.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(F.push("#define BILLBOARD"),this.billboardMode){case 2:F.push("#define BILLBOARDY");break;case 8:case 9:F.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&F.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:F.push("#define BILLBOARDMODE_ALL")}f&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),F.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(F,P,f){P.push(...vF._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),F.push(...vF._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),f.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,cF.e)(F,this._imageProcessingConfigurationDefines),(0,cF.c)(f,this._imageProcessingConfigurationDefines))}_getWrapper(F){const P=this._getCustomDrawWrapper(F);if(null!==P&&void 0!==P&&P.effect)return P;const f=[];this.fillDefines(f,F);const c=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let N=this._drawWrappers[c];N||(N=this._drawWrappers[c]=[]);let q=N[F];q||(q=new FF.d(this._engine),q.drawContext&&(q.drawContext.useInstancing=this._useInstancing),N[F]=q);const H=f.join("\n");if(q.defines!==H){const F=[],P=[],f=[];this.fillUniformsAttributesAndSamplerNames(P,F,f),q.setEffect(this._engine.createEffect("particles",F,P,f,H,void 0,void 0,void 0,void 0,this._shaderLanguage),H)}return q}animate(){var F;let P,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!f&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(f?this.preWarmStepOffset:(null===(F=this._scene)||void 0===F?void 0:F.getAnimationRatio())||1),this.manualEmitCount>-1)P=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let F=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const P=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(P,this._emitRateGradients,((P,f,c)=>{P!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=f.getFactor(),this._currentEmitRateGradient=P),F=(0,j.Lerp)(this._currentEmitRate1,this._currentEmitRate2,c)}))}P=F*this._scaledUpdateSpeed|0,this._newPartsExcess+=F*this._scaledUpdateSpeed-P}if(this._newPartsExcess>1&&(P+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?P=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(P),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!f){let F=0;for(let P=0;P<this.RT.length;P++){const f=this.RT[P];this._appendParticleVertices(F,f),F+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.RT.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(F,P){this._appendParticleVertex(F++,P,0,0),this._useInstancing||(this._appendParticleVertex(F++,P,1,0),this._appendParticleVertex(F++,P,1,1),this._appendParticleVertex(F++,P,0,1))}rebuild(){var F;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(F=this._spriteBuffer)||void 0===F||F._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!vF.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(f.bind(f,13059)),Promise.resolve().then(f.bind(f,13006))])):await Promise.all([Promise.resolve().then(f.bind(f,12996)),Promise.resolve().then(f.bind(f,12986))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.cP||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==o.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(o.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(o.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(F){const P=this._getWrapper(F),f=P.effect,N=this._engine;N.enableEffect(P);const q=this.defaultViewMatrix??this._scene.getViewMatrix();if(f.setTexture("diffuseSampler",this.particleTexture),f.setMatrix("view",q),f.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const F=this.particleTexture.getBaseSize();f.setFloat3("particlesInfos",this.spriteCellWidth/F.width,this.spriteCellHeight/F.height,this.spriteCellWidth/F.width)}if(f.setVector2("translationPivot",this.translationPivot),f.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const F=this._scene.activeCamera;f.setVector3("eyePosition",F.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),f.setTexture("rampSampler",this._rampGradientsTexture));const H=f.defines;var A,o,j,i,u,T;(this._scene&&((0,PF.d)(f,this,this._scene),this.applyFog&&(0,fF.f)(this._scene,void 0,f)),H.indexOf("#define BILLBOARDMODE_ALL")>=0&&(q.invertToRef(c.TmpVectors.Matrix[0]),f.setMatrix("invView",c.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?N.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,f):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,f)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?N.bindBuffers(this._vertexBuffers,null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._linesIndexBuffer:this._indexBuffer,f):N.bindBuffers(this._vertexBuffers,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBufferUseInstancing:null,f);(this.useLogarithmicDepth&&this._scene&&(0,fF.n)(H,f,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(f),this._setEngineBasedOnBlendMode(F),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(f),this._useInstancing)?null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?N.drawElementsType(6,0,10,this.RT.length):N.drawArraysType(7,0,4,this.RT.length):null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?N.drawElementsType(1,0,10*this.RT.length):N.drawElementsType(0,0,6*this.RT.length);return this.RT.length}render(){if(!this.isReady()||!this.RT.length)return 0;const F=this._engine;F.setState&&(F.setState(!1),this.forceDepthWrite&&F.setDepthWrite(!0));let P=0;return P=this.blendMode===o.BLENDMODE_MULTIPLYADD?this._render(o.BLENDMODE_MULTIPLY)+this._render(o.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),P}_onDispose(){}dispose(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),F&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),F&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(P,f),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const F=this._scene.zT.indexOf(this);F>-1&&this._scene.zT.splice(F,1),this._scene._activeParticleSystems.dispose()}this.Mf.notifyObservers(this),this.Mf.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}vF.ForceGLSL=!1;var sF,XF=f(11488);!function(F){F[F.ATTACHED=0]="ATTACHED",F[F.END=1]="END"}(sF||(sF={}));class mF{constructor(F){if(this.particleSystem=F,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!F.cP||!F.cP.dispose){const P=(0,A.c)("BABYLON.AbstractMesh");F.cP=new P("SubemitterSystemEmitter",F.OF()),F._disposeEmitterOnDispose=!0}}clone(){let F=this.particleSystem.cP;if(F){if(F instanceof c.tP)F=F.clone();else if(-1!==F.getClassName().indexOf("Mesh")){F=new((0,A.c)("BABYLON.Mesh"))("",F.OF()),F.isVisible=!1}}else F=new c.tP;const P=new mF(this.particleSystem.clone(this.particleSystem.name,F));return P.particleSystem.name+="Clone",P.type=this.type,P.inheritDirection=this.inheritDirection,P.inheritedVelocityAmount=this.inheritedVelocityAmount,P.particleSystem._disposeEmitterOnDispose=!0,P.particleSystem.disposeOnStop=!0,P}serialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const P={};return P.type=this.type,P.inheritDirection=this.inheritDirection,P.inheritedVelocityAmount=this.inheritedVelocityAmount,P.particleSystem=this.particleSystem.serialize(F),P}static _ParseParticleSystem(F,P,f){throw(0,XF.e)("ParseParticle")}static Parse(F,P,f){const c=F.particleSystem,N=new mF(mF._ParseParticleSystem(c,P,f,!0));return N.type=F.type,N.inheritDirection=F.inheritDirection,N.inheritedVelocityAmount=F.inheritedVelocityAmount,N.particleSystem._isSubEmitter=!0,N}dispose(){this.particleSystem.dispose()}}var aF=f(11541);function wF(F,P){const f=new J;return f.direction1=F,f.direction2=P,f}function gF(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function GF(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function hF(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.tP(0,1,0),f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.tP(0,1,0);return new z(F,P,f)}function SF(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function FP(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.tP(0,1,0),q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.tP(0,1,0);return new C(F,P,f,N,q)}function PP(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new T(F,P)}function fP(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.tP(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.tP(0,1,0);return new Y(F,P,f,N)}const cP=c.tP.Zero(),NP=c.tP.Zero(),qP=c.tP.Zero();class HP{constructor(){this.strength=0,this.position=c.tP.Zero()}_processParticle(F,P){this.position.subtractToRef(F.position,cP);const f=cP.lengthSquared()+1;cP.normalize().scaleToRef(this.strength/f,NP),NP.scaleToRef(P._tempScaledUpdateSpeed,qP),F.direction.addInPlace(qP)}serialize(){return{position:this.position.pf(),strength:this.strength}}}class AP extends vF{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=F=>{if(!this._subEmitters||0===this._subEmitters.length)return;const P=Math.floor(Math.random()*this._subEmitters.length);for(const f of this._subEmitters[P])if(1===f.type){const P=f.clone();F._inheritParticleInfoToSubEmitter(P),P.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(P.particleSystem),P.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(F,P){const f=wF(F,P);return this.particleEmitterType=f,f}get flowMap(){return this._flowMap}set flowMap(F){this._flowMap!==F&&(this._flowMap=F,this._flowMapUpdate&&(bF(this._flowMapUpdate),this._flowMapUpdate=null),F&&(this._flowMapUpdate={process:F=>{var P;const f=null===(P=this.OF())||void 0===P?void 0:P.getTransformMatrix();this._flowMap._processParticle(F,this.flowMapStrength*this._tempScaledUpdateSpeed,f)},previousItem:null,nextItem:null},lF(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(F){this._attractors.push(F),1===this._attractors.length&&(this._attractorUpdate={process:F=>{for(const P of this._attractors)P._processParticle(F,this)},previousItem:null,nextItem:null},lF(this._attractorUpdate,this._directionProcessing))}removeAttractor(F){const P=this._attractors.indexOf(F);-1!==P&&this._attractors.splice(P,1),0===this._attractors.length&&bF(this._attractorUpdate)}start(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(F)}createHemisphericEmitter(){const F=gF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=F,F}createSphereEmitter(){const F=GF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=F,F}createDirectedSphereEmitter(){const F=hF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.tP(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.tP(0,1,0));return this.particleEmitterType=F,F}createCylinderEmitter(){const F=SF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=F,F}createDirectedCylinderEmitter(){const F=FP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.tP(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.tP(0,1,0));return this.particleEmitterType=F,F}createConeEmitter(){const F=PP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=F,F}createDirectedConeEmitter(){const F=fP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.tP(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.tP(0,1,0));return this.particleEmitterType=F,F}createBoxEmitter(F,P,f,c){const N=new u;return this.particleEmitterType=N,this.direction1=F,this.direction2=P,this.minEmitBox=f,this.maxEmitBox=c,N}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const F of this.subEmitters)F instanceof AP?this._subEmitters.push([new mF(F)]):F instanceof mF?this._subEmitters.push([F]):F instanceof Array&&this._subEmitters.push(F)}_stopSubEmitters(){if(this.activeSubSystems){for(const F of this.activeSubSystems)F.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const F=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==F&&this._rootParticleSystem.activeSubSystems.splice(F,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(F){F&&this._stopSubEmitters()}_prepareParticle(F){if(this._subEmitters&&this._subEmitters.length>0){const P=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];F._attachedSubEmitters=[];for(const f of P)if(0===f.type){const P=f.clone();F._attachedSubEmitters.push(P),P.particleSystem.start()}}}_onDispose(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),F&&this.particles)for(const f of this.particles)if(f._attachedSubEmitters)for(let F=f._attachedSubEmitters.length-1;F>=0;F-=1)f._attachedSubEmitters[F].dispose();if(P&&this.activeSubSystems)for(let f=this.activeSubSystems.length-1;f>=0;f-=1)this.activeSubSystems[f].dispose();if(this._subEmitters&&this._subEmitters.length){for(let F=0;F<this._subEmitters.length;F++)for(const P of this._subEmitters[F])P.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.cP&&this.cP.dispose&&this.cP.dispose(!0)}static _Parse(F,P,f,N){let q;q=f instanceof aF.b?null:f;const o=(0,A.c)("BABYLON.Texture");if(o&&q&&(F.texture?P.particleTexture=o.Parse(F.texture,q,N):F.textureName&&(P.particleTexture=new o(N+F.textureName,q,!1,void 0===F.invertY||F.invertY),P.particleTexture.name=F.textureName)),F.emitterId||0===F.emitterId||void 0!==F.cP?F.emitterId&&q?P.cP=q.getLastMeshById(F.emitterId):P.cP=c.tP.zP(F.cP):P.cP=c.tP.Zero(),P.isLocal=!!F.isLocal,void 0!==F.renderingGroupId&&(P.renderingGroupId=F.renderingGroupId),void 0!==F.isBillboardBased&&(P.isBillboardBased=F.isBillboardBased),void 0!==F.billboardMode&&(P.billboardMode=F.billboardMode),void 0!==F.useLogarithmicDepth&&(P.useLogarithmicDepth=F.useLogarithmicDepth),F.animations){for(let f=0;f<F.animations.length;f++){const c=F.animations[f],N=(0,A.c)("BABYLON.Animation");N&&P.animations.push(N.Parse(c))}P.beginAnimationOnStart=F.beginAnimationOnStart,P.beginAnimationFrom=F.beginAnimationFrom,P.beginAnimationTo=F.beginAnimationTo,P.beginAnimationLoop=F.beginAnimationLoop}if(F.autoAnimate&&q&&q.beginAnimation(P,F.autoAnimateFrom,F.autoAnimateTo,F.autoAnimateLoop,F.autoAnimateSpeed||1),P.startDelay=0|F.startDelay,P.minAngularSpeed=F.minAngularSpeed,P.maxAngularSpeed=F.maxAngularSpeed,P.minSize=F.minSize,P.maxSize=F.maxSize,F.minScaleX&&(P.minScaleX=F.minScaleX,P.maxScaleX=F.maxScaleX,P.minScaleY=F.minScaleY,P.maxScaleY=F.maxScaleY),void 0!==F.preWarmCycles&&(P.preWarmCycles=F.preWarmCycles,P.preWarmStepOffset=F.preWarmStepOffset),void 0!==F.minInitialRotation&&(P.minInitialRotation=F.minInitialRotation,P.maxInitialRotation=F.maxInitialRotation),P.minLifeTime=F.minLifeTime,P.maxLifeTime=F.maxLifeTime,P.minEmitPower=F.minEmitPower,P.maxEmitPower=F.maxEmitPower,P.emitRate=F.emitRate,P.gravity=c.tP.zP(F.gravity),F.noiseStrength&&(P.noiseStrength=c.tP.zP(F.noiseStrength)),P.color1=H.qc.zP(F.color1),P.color2=H.qc.zP(F.color2),P.colorDead=H.qc.zP(F.colorDead),P.updateSpeed=F.updateSpeed,P.targetStopDuration=F.targetStopDuration,P.blendMode=F.blendMode,F.colorGradients)for(const c of F.colorGradients)P.addColorGradient(c.gradient,H.qc.zP(c.color1),c.color2?H.qc.zP(c.color2):void 0);if(F.rampGradients){for(const f of F.rampGradients)P.addRampGradient(f.gradient,H.BP.zP(f.color));P.useRampGradients=F.useRampGradients}if(F.colorRemapGradients)for(const c of F.colorRemapGradients)P.addColorRemapGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.alphaRemapGradients)for(const c of F.alphaRemapGradients)P.addAlphaRemapGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.sizeGradients)for(const c of F.sizeGradients)P.addSizeGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.angularSpeedGradients)for(const c of F.angularSpeedGradients)P.addAngularSpeedGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.velocityGradients)for(const c of F.velocityGradients)P.addVelocityGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.dragGradients)for(const c of F.dragGradients)P.addDragGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.emitRateGradients)for(const c of F.emitRateGradients)P.addEmitRateGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.startSizeGradients)for(const c of F.startSizeGradients)P.addStartSizeGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.lifeTimeGradients)for(const c of F.lifeTimeGradients)P.addLifeTimeGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(F.limitVelocityGradients){for(const f of F.limitVelocityGradients)P.addLimitVelocityGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);P.limitVelocityDamping=F.limitVelocityDamping}if(F.noiseTexture&&q){const f=(0,A.c)("BABYLON.ProceduralTexture");P.noiseTexture=f.Parse(F.noiseTexture,q,N)}let j;if(F.particleEmitterType){switch(F.particleEmitterType.type){case"SphereParticleEmitter":j=new B;break;case"SphereDirectedParticleEmitter":j=new z;break;case"ConeEmitter":case"ConeParticleEmitter":j=new T;break;case"ConeDirectedParticleEmitter":j=new Y;break;case"CylinderParticleEmitter":j=new t;break;case"CylinderDirectedParticleEmitter":j=new C;break;case"HemisphericParticleEmitter":j=new L;break;case"PointParticleEmitter":j=new J;break;case"MeshParticleEmitter":j=new y;break;case"CustomParticleEmitter":j=new Z;break;default:j=new u}j.parse(F.particleEmitterType,q)}else j=new u,j.parse(F,q);P.particleEmitterType=j,P.startSpriteCellID=F.startSpriteCellID,P.endSpriteCellID=F.endSpriteCellID,P.spriteCellLoop=F.spriteCellLoop??!0,P.spriteCellWidth=F.spriteCellWidth,P.spriteCellHeight=F.spriteCellHeight,P.spriteCellChangeSpeed=F.spriteCellChangeSpeed,P.spriteRandomStartCell=F.spriteRandomStartCell,P.disposeOnStop=F.disposeOnStop??!1,P.manualEmitCount=F.manualEmitCount??-1}static Parse(F,P,f){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0;const A=F.name;let o,j,i=null,u=null;if(P instanceof aF.b?o=P:(j=P,o=j.getEngine()),F.customShader&&o.createEffectForParticles){u=F.customShader;const P=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"";i=o.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,P)}const T=new AP(A,q||F.pP,P,i,F.isAnimationSheetEnabled);if(T.customShader=u,T._rootUrl=f,F.id&&(T.id=F.id),F.subEmitters){T.subEmitters=[];for(const c of F.subEmitters){const F=[];for(const N of c)F.push(mF.Parse(N,P,f));T.subEmitters.push(F)}}if(F.attractors)for(const H of F.attractors){const F=new HP;F.position=c.tP.zP(H.position),F.strength=H.strength,T.addAttractor(F)}return AP._Parse(F,T,P,f),F.textureMask&&(T.textureMask=H.qc.zP(F.textureMask)),F.ej&&(T.ej=c.tP.zP(F.ej)),F.preventAutoStart&&(T.preventAutoStart=F.preventAutoStart),N||T.preventAutoStart||T.start(),T}serialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const P={};if(AP._Serialize(P,this,F),P.textureMask=this.textureMask.pf(),P.customShader=this.customShader,P.preventAutoStart=this.preventAutoStart,P.ej=this.ej.pf(),this.subEmitters){P.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const f of this._subEmitters){const c=[];for(const P of f)c.push(P.serialize(F));P.subEmitters.push(c)}}if(this._attractors&&this._attractors.length){P.attractors=[];for(const F of this._attractors)P.attractors.push(F.serialize())}return P}static _Serialize(F,P,f){if(F.name=P.name,F.id=P.id,F.pP=P.getCapacity(),F.disposeOnStop=P.disposeOnStop,F.manualEmitCount=P.manualEmitCount,P.cP.position){const f=P.cP;F.emitterId=f.id}else{const f=P.cP;F.cP=f.pf()}P.particleEmitterType&&(F.particleEmitterType=P.particleEmitterType.serialize()),P.particleTexture&&(f?F.texture=P.particleTexture.serialize():(F.textureName=P.particleTexture.name,F.invertY=!!P.particleTexture._invertY)),F.isLocal=P.isLocal,E.e.AppendSerializedAnimations(P,F),F.beginAnimationOnStart=P.beginAnimationOnStart,F.beginAnimationFrom=P.beginAnimationFrom,F.beginAnimationTo=P.beginAnimationTo,F.beginAnimationLoop=P.beginAnimationLoop,F.startDelay=P.startDelay,F.renderingGroupId=P.renderingGroupId,F.isBillboardBased=P.isBillboardBased,F.billboardMode=P.billboardMode,F.minAngularSpeed=P.minAngularSpeed,F.maxAngularSpeed=P.maxAngularSpeed,F.minSize=P.minSize,F.maxSize=P.maxSize,F.minScaleX=P.minScaleX,F.maxScaleX=P.maxScaleX,F.minScaleY=P.minScaleY,F.maxScaleY=P.maxScaleY,F.minEmitPower=P.minEmitPower,F.maxEmitPower=P.maxEmitPower,F.minLifeTime=P.minLifeTime,F.maxLifeTime=P.maxLifeTime,F.emitRate=P.emitRate,F.gravity=P.gravity.pf(),F.noiseStrength=P.noiseStrength.pf(),F.color1=P.color1.pf(),F.color2=P.color2.pf(),F.colorDead=P.colorDead.pf(),F.updateSpeed=P.updateSpeed,F.targetStopDuration=P.targetStopDuration,F.blendMode=P.blendMode,F.preWarmCycles=P.preWarmCycles,F.preWarmStepOffset=P.preWarmStepOffset,F.minInitialRotation=P.minInitialRotation,F.maxInitialRotation=P.maxInitialRotation,F.startSpriteCellID=P.startSpriteCellID,F.spriteCellLoop=P.spriteCellLoop,F.endSpriteCellID=P.endSpriteCellID,F.spriteCellChangeSpeed=P.spriteCellChangeSpeed,F.spriteCellWidth=P.spriteCellWidth,F.spriteCellHeight=P.spriteCellHeight,F.spriteRandomStartCell=P.spriteRandomStartCell,F.isAnimationSheetEnabled=P.isAnimationSheetEnabled,F.useLogarithmicDepth=P.useLogarithmicDepth;const c=P.getColorGradients();if(c){F.colorGradients=[];for(const P of c){const f={gradient:P.gradient,color1:P.color1.pf()};P.color2?f.color2=P.color2.pf():f.color2=P.color1.pf(),F.colorGradients.push(f)}}const N=P.getRampGradients();if(N){F.rampGradients=[];for(const P of N){const f={gradient:P.gradient,color:P.color.pf()};F.rampGradients.push(f)}F.useRampGradients=P.useRampGradients}const q=P.getColorRemapGradients();if(q){F.colorRemapGradients=[];for(const P of q){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.colorRemapGradients.push(f)}}const H=P.getAlphaRemapGradients();if(H){F.alphaRemapGradients=[];for(const P of H){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.alphaRemapGradients.push(f)}}const A=P.getSizeGradients();if(A){F.sizeGradients=[];for(const P of A){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.sizeGradients.push(f)}}const o=P.getAngularSpeedGradients();if(o){F.angularSpeedGradients=[];for(const P of o){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.angularSpeedGradients.push(f)}}const j=P.getVelocityGradients();if(j){F.velocityGradients=[];for(const P of j){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.velocityGradients.push(f)}}const i=P.getDragGradients();if(i){F.dragGradients=[];for(const P of i){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.dragGradients.push(f)}}const u=P.getEmitRateGradients();if(u){F.emitRateGradients=[];for(const P of u){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.emitRateGradients.push(f)}}const T=P.getStartSizeGradients();if(T){F.startSizeGradients=[];for(const P of T){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.startSizeGradients.push(f)}}const Y=P.getLifeTimeGradients();if(Y){F.lifeTimeGradients=[];for(const P of Y){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.lifeTimeGradients.push(f)}}const t=P.getLimitVelocityGradients();if(t){F.limitVelocityGradients=[];for(const P of t){const f={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2?f.factor2=P.factor2:f.factor2=P.factor1,F.limitVelocityGradients.push(f)}F.limitVelocityDamping=P.limitVelocityDamping}P.noiseTexture&&(F.noiseTexture=P.noiseTexture.serialize())}clone(F,P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c={...this._customWrappers};let N=null;const q=this._engine;if(q.createEffectForParticles&&null!=this.customShader){N=this.customShader;const F=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"",P=q.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,F);c[0]?c[0].effect=P:this.setCustomEffect(P,0)}const H=this.serialize(f),A=AP.Parse(H,this._scene||this._engine,this._rootUrl);return A.name=F,A.customShader=N,A._customWrappers=c,void 0===P&&(P=this.cP),this.noiseTexture&&(A.noiseTexture=this.noiseTexture.clone()),A.cP=P,this.preventAutoStart||A.start(),A}}AP.BILLBOARDMODE_Y=2,AP.BILLBOARDMODE_ALL=7,AP.BILLBOARDMODE_STRETCHED=8,AP.BILLBOARDMODE_STRETCHED_LOCAL=9,mF._ParseParticleSystem=AP.Parse;var oP=f(11851),jP=f(11845),iP=f(11743);iP.d.prototype.createTransformFeedback=function(){const F=this._gl.createTransformFeedback();if(!F)throw new Error("Unable to create Transform Feedback");return F},iP.d.prototype.deleteTransformFeedback=function(F){this._gl.deleteTransformFeedback(F)},iP.d.prototype.bindTransformFeedback=function(F){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,F)},iP.d.prototype.beginTransformFeedback=function(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(F?this._gl.POINTS:this._gl.TRIANGLES)},iP.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},iP.d.prototype.setTranformFeedbackVaryings=function(F,P){this._gl.transformFeedbackVaryings(F,P,this._gl.INTERLEAVED_ATTRIBS)},iP.d.prototype.bindTransformFeedbackBuffer=function(F){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,F?F.underlyingResource:null)},iP.d.prototype.readTransformFeedbackBuffer=function(F){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,F)};const uP="clipPlaneFragmentDeclaration2",TP="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";d.c.IncludesShadersStore[uP]||(d.c.IncludesShadersStore[uP]=TP);f(12899),f(12906),f(12909),f(12915),f(12924),f(12929),f(12931),f(12933);const YP="gpuRenderParticlesPixelShader",tP="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";d.c.ShadersStore[YP]||(d.c.ShadersStore[YP]=tP);const CP="clipPlaneVertexDeclaration2",LP="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";d.c.IncludesShadersStore[CP]||(d.c.IncludesShadersStore[CP]=LP);f(12935),f(12944),f(12950),f(12952);const JP="gpuRenderParticlesVertexShader",BP="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";d.c.ShadersStore[JP]||(d.c.ShadersStore[JP]=BP);class zP extends o{static get IsSupported(){if(!h.b.LastCreatedEngine)return!1;const F=h.b.LastCreatedEngine.getCaps();return F.supportTransformFeedbacks||F.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(F){this._maxActiveParticleCount=Math.min(F,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(F){this.maxActiveParticleCount=F}createPointEmitter(F,P){const f=wF(F,P);return this.particleEmitterType=f,f}createHemisphericEmitter(){const F=gF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=F,F}createSphereEmitter(){const F=GF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=F,F}createDirectedSphereEmitter(){const F=hF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.tP(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.tP(0,1,0));return this.particleEmitterType=F,F}createCylinderEmitter(){const F=SF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=F,F}createDirectedCylinderEmitter(){const F=FP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.tP(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.tP(0,1,0));return this.particleEmitterType=F,F}createConeEmitter(){const F=PP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=F,F}createDirectedConeEmitter(){const F=fP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.tP(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.tP(0,1,0));return this.particleEmitterType=F,F}createBoxEmitter(F,P,f,c){const N=new u;return this.particleEmitterType=N,this.direction1=F,this.direction2=P,this.minEmitBox=f,this.maxEmitBox=c,N}get flowMap(){return this._flowMap}set flowMap(F){this._flowMap!==F&&(this._flowMap=F)}isReady(){if(!this.cP||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==AP.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(AP.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(AP.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";F?setTimeout((()=>{this.start(0)}),F):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var F;let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(F=this._customWrappers[P])||void 0===F?void 0:F.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[F]??this._customWrappers[0]}setCustomEffect(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[P]=new FF.d(this._engine),this._customWrappers[P].effect=F}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new g.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(F,P,f){return super._removeGradientAndTexture(F,P,f),this._releaseBuffers(),this}addColorGradient(F,P){this._colorGradients||(this._colorGradients=[]);const f=new X(F,P);return this._colorGradients.push(f),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(F&&this._colorGradients.sort(((F,P)=>F.gradient<P.gradient?-1:F.gradient>P.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(F){return this._removeGradientAndTexture(F,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const P in this._drawWrappers){var F;null===(F=this._drawWrappers[P].drawContext)||void 0===F||F.reset()}}_addFactorGradient(F,P,f){const c=new a(P,f);F.push(c),this._releaseBuffers()}addSizeGradient(F,P){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,F,P),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(F){return this._removeGradientAndTexture(F,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(F,P){if(!F)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&F.sort(((F,P)=>F.gradient<P.gradient?-1:F.gradient>P.gradient?1:0));const f=this;f[P]&&(f[P].dispose(),f[P]=null)}addAngularSpeedGradient(F,P){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,F,P),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(F){return this._removeGradientAndTexture(F,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(F,P){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,F,P),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(F){return this._removeGradientAndTexture(F,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(F,P){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,F,P),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(F){return this._removeGradientAndTexture(F,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(F,P){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,F,P),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(F){return this._removeGradientAndTexture(F,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(F){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(F,P,f){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(F),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Mf=new g.d,this.onStoppedObservable=new g.d,this.onStartedObservable=new g.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,f&&"Scene"!==f.getClassName()?(this._engine=f,this.defaultProjectionMatrix=c.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=f||h.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.zT.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,A.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,A.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,A.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,A.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new FF.d(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers={0:new FF.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(P=P??{}).randomTextureSize||delete P.randomTextureSize;const H={pP:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...P},o=P;isFinite(o)&&(H.pP=o),this._capacity=H.pP,this._maxActiveParticleCount=H.pP,this._currentActiveCount=0,this._isAnimationSheetEnabled=q,this.particleEmitterType=new u;const j=Math.min(this._engine.getCaps().maxTextureSize,H.randomTextureSize);let i=[];for(let c=0;c<j;++c)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture=new G.e(new Float32Array(i),j,1,5,f,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,i=[];for(let c=0;c<j;++c)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture2=new G.e(new Float32Array(i),j,1,5,f,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=j}_reset(){this._releaseBuffers()}_createVertexBuffers(F,P,f){const c={};c.position=P.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let N=3;c.age=P.createVertexBuffer("age",N,1,this._attributesStrideSize,!0),N+=1,c.size=P.createVertexBuffer("size",N,3,this._attributesStrideSize,!0),N+=3,c.life=P.createVertexBuffer("life",N,1,this._attributesStrideSize,!0),N+=1,N+=4,this.billboardMode===AP.BILLBOARDMODE_STRETCHED&&(c.direction=P.createVertexBuffer("direction",N,3,this._attributesStrideSize,!0)),N+=3,this._platform.alignDataInBuffer&&(N+=1),this.particleEmitterType instanceof Z&&(N+=3,this._platform.alignDataInBuffer&&(N+=1)),this._colorGradientsTexture||(c.color=P.createVertexBuffer("color",N,4,this._attributesStrideSize,!0),N+=4),this._isBillboardBased||(c.initialDirection=P.createVertexBuffer("initialDirection",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),this.noiseTexture&&(c.noiseCoordinates1=P.createVertexBuffer("noiseCoordinates1",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1),c.noiseCoordinates2=P.createVertexBuffer("noiseCoordinates2",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),c.angle=P.createVertexBuffer("angle",N,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?N++:N+=2,this._isAnimationSheetEnabled&&(c.cellIndex=P.createVertexBuffer("cellIndex",N,1,this._attributesStrideSize,!0),N+=1,this.spriteRandomStartCell&&(c.cellStartOffset=P.createVertexBuffer("cellStartOffset",N,1,this._attributesStrideSize,!0),N+=1)),c.offset=f.createVertexBuffer("offset",0,2),c.uv=f.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(c),this._platform.createVertexBuffers(F,c),this.resetDrawCache()}_initialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!F)return;const P=this._engine,f=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Z&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const N=this.particleEmitterType instanceof Z,q=c.TmpVectors.tP[0];let H=0;for(let c=0;c<this._capacity;c++)if(f.push(0),f.push(0),f.push(0),f.push(0),f.push(0),f.push(0),f.push(0),f.push(0),f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),N?(this.particleEmitterType.particleDestinationGenerator(c,null,q),f.push(q.x),f.push(q.y),f.push(q.z)):(f.push(0),f.push(0),f.push(0)),this._platform.alignDataInBuffer&&f.push(0),H+=16,N&&(this.particleEmitterType.particlePositionGenerator(c,null,q),f.push(q.x),f.push(q.y),f.push(q.z),this._platform.alignDataInBuffer&&f.push(0),H+=4),this._colorGradientsTexture||(f.push(0),f.push(0),f.push(0),f.push(0),H+=4),this.isBillboardBased||(f.push(0),f.push(0),f.push(0),this._platform.alignDataInBuffer&&f.push(0),H+=4),this.noiseTexture&&(f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),this._platform.alignDataInBuffer&&f.push(0),f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),this._platform.alignDataInBuffer&&f.push(0),H+=8),f.push(0),H+=1,this._angularSpeedGradientsTexture||(f.push(0),H+=1),this._isAnimationSheetEnabled&&(f.push(0),H+=1,this.spriteRandomStartCell&&(f.push(0),H+=1)),this._platform.alignDataInBuffer){let F=3-(H+3&3);for(H+=F;F-- >0;)f.push(0)}const A=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),o=this._platform.createParticleBuffer(f),j=this._platform.createParticleBuffer(f);this._buffer0=new R.e(P,o,!1,this._attributesStrideSize),this._buffer1=new R.e(P,j,!1,this._attributesStrideSize),this._spriteBuffer=new R.e(P,A,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let F=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(F+="\n#define BILLBOARD"),this._colorGradientsTexture&&(F+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(F+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(F+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(F+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(F+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(F+="\n#define DRAGGRADIENTS"),this._flowMap&&(F+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(F+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(F+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(F+="\n#define NOISE"),this.isLocal&&(F+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===F||(this._cachedUpdateDefines=F,this._updateBuffer=this._platform.createUpdateBuffer(F)),this._platform.isUpdateBufferReady()}_getWrapper(F){const P=this._getCustomDrawWrapper(F);if(null!==P&&void 0!==P&&P.effect)return P;const f=[];this.fillDefines(f,F);let c=this._drawWrappers[F];c||(c=new FF.d(this._engine),c.drawContext&&(c.drawContext.useInstancing=!0),this._drawWrappers[F]=c);const N=f.join("\n");if(c.defines!==N){const F=[],P=[],f=[];this.fillUniformsAttributesAndSamplerNames(P,F,f),c.setEffect(this._engine.createEffect("gpuRenderParticles",F,P,f,N),N)}return c}static _GetAttributeNamesOrOptions(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=[R.f.PositionKind,"age","life","size","angle"];return F||N.push(R.f.ColorKind),P&&N.push("cellIndex"),f||N.push("initialDirection"),c&&N.push("direction"),N.push("offset",R.f.UVKind),N}static _GetEffectCreationOptions(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c=["emitterWM","ej","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,PF.c)(c),F&&c.push("sheetInfos"),P&&c.push("logarithmicDepthConstant"),f&&(c.push("vFogInfos"),c.push("vFogColor")),c}fillDefines(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,PF.l)(this,this._scene,F),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==jP.e.FOGMODE_NONE&&F.push("#define FOG")),P===AP.BLENDMODE_MULTIPLY&&F.push("#define BLENDMULTIPLYMODE"),this.isLocal&&F.push("#define LOCAL"),this.useLogarithmicDepth&&F.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(F.push("#define BILLBOARD"),this.billboardMode){case AP.BILLBOARDMODE_Y:F.push("#define BILLBOARDY");break;case AP.BILLBOARDMODE_STRETCHED:F.push("#define BILLBOARDSTRETCHED");break;case AP.BILLBOARDMODE_ALL:F.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&F.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&F.push("#define ANIMATESHEET"),f&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),F.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(F,P,f){P.push(...zP._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===AP.BILLBOARDMODE_STRETCHED)),F.push(...zP._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),f.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(oP.b.PrepareUniforms(F,this._imageProcessingConfigurationDefines),oP.b.PrepareSamplers(f,this._imageProcessingConfigurationDefines))}animate(){var F;let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(P?this.preWarmStepOffset:(null===(F=this._scene)||void 0===F?void 0:F.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(F,P){const f=this[P];if(!F||!F.length||f)return;const c=new Float32Array(this._rawTextureWidth);for(let N=0;N<this._rawTextureWidth;N++){const P=N/this._rawTextureWidth;w.GetCurrentGradient(P,F,((F,P,f)=>{c[N]=(0,j.Lerp)(F.factor1,P.factor1,f)}))}this[P]=G.e.CreateRTexture(c,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[P].name=P.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const F=new Uint8Array(4*this._rawTextureWidth),P=H.TmpColors.qc[0];for(let f=0;f<this._rawTextureWidth;f++){const c=f/this._rawTextureWidth;w.GetCurrentGradient(c,this._colorGradients,((c,N,q)=>{H.qc.LerpToRef(c.color1,N.color1,q,P),F[4*f]=255*P.r,F[4*f+1]=255*P.g,F[4*f+2]=255*P.b,F[4*f+3]=255*P.a}))}this._colorGradientsTexture=G.e.CreateRGBATexture(F,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(F,P){var f,N,q,H;const A=this._getWrapper(F),o=A.effect;this._engine.enableEffect(A);const j=(null===(f=this._scene)||void 0===f?void 0:f.getViewMatrix())||c.Matrix.IdentityReadOnly;if(o.setMatrix("view",j),o.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),o.setTexture("diffuseSampler",this.particleTexture),o.setVector2("translationPivot",this.translationPivot),o.setVector3("ej",this.ej),this.isLocal&&o.setMatrix("emitterWM",P),this._colorGradientsTexture?o.setTexture("colorGradientSampler",this._colorGradientsTexture):o.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const F=this.particleTexture.getBaseSize();o.setFloat3("sheetInfos",this.spriteCellWidth/F.width,this.spriteCellHeight/F.height,F.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const F=this._scene.activeCamera;o.setVector3("eyePosition",F.globalPosition)}const i=o.defines;if(this._scene&&((0,PF.d)(o,this,this._scene),this.applyFog&&(0,fF.f)(this._scene,void 0,o)),i.indexOf("#define BILLBOARDMODE_ALL")>=0){const F=j.clone();F.invert(),o.setMatrix("invView",F)}return this.useLogarithmicDepth&&this._scene&&(0,fF.n)(i,o,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),this._setEngineBasedOnBlendMode(F),this._platform.bindDrawBuffers(this._targetIndex,o,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(H=this._scene)&&void 0!==H&&H.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(F){if(!this.cP||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!F)if(this.cP.position){F=this.cP.getWorldMatrix()}else{const P=this.cP;F=c.TmpVectors.Matrix[0],c.Matrix.TranslationToRef(P.x,P.y,P.z,F)}const P=this._engine,f=P.getDepthWrite();if(P.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const F=this.OF();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",F.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",F),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const N=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=N,P.setDepthWrite(f)}render(){let F,P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!P&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let F=0;F<this.preWarmCycles;F++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const F=0|this._accumulatedCount;this._accumulatedCount-=F,this._currentActiveCount+=F}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.cP.position){F=this.cP.getWorldMatrix()}else{const P=this.cP;F=c.TmpVectors.Matrix[0],c.Matrix.TranslationToRef(P.x,P.y,P.z,F)}const N=this._engine;this.updateInAnimate||this._update(F);let q=0;return P||f||(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0),q=this.blendMode===AP.BLENDMODE_MULTIPLYADD?this._render(AP.BLENDMODE_MULTIPLY,F)+this._render(AP.BLENDMODE_ADD,F):this._render(this.blendMode,F),this._engine.setAlphaMode(0)),q}rebuild(){const F=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(F,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,F()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const P in this._drawWrappers){this._drawWrappers[P].dispose()}if(this._drawWrappers={},this._scene){const F=this._scene.zT.indexOf(this);F>-1&&this._scene.zT.splice(F,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let P=0;P<this._renderVertexBuffers.length;++P){const F=this._renderVertexBuffers[P];for(const P in F)F[P].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),F&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),F&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Mf.notifyObservers(this),this.Mf.clear()}clone(F,P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c={...this._customWrappers};let N=null;const q=this._engine;if(q.createEffectForParticles&&null!=this.customShader){N=this.customShader;const F=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"";c[0]=q.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,F,void 0,void 0,void 0,this)}const H=this.serialize(f),A=zP.Parse(H,this._scene||this._engine,this._rootUrl);return A.name=F,A.customShader=N,A._customWrappers=c,void 0===P&&(P=this.cP),this.noiseTexture&&(A.noiseTexture=this.noiseTexture.clone()),A.cP=P,A}serialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const P={};return AP._Serialize(P,this,F),P.activeParticleCount=this.activeParticleCount,P.randomTextureSize=this._randomTextureSize,P.customShader=this.customShader,P}static Parse(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const q=F.name;let H,A;P instanceof aF.b?H=P:(A=P,H=A.getEngine());const o=new zP(q,{pP:N||F.pP,randomTextureSize:F.randomTextureSize},P,null,F.isAnimationSheetEnabled);if(o._rootUrl=f,F.customShader&&H.createEffectForParticles){const P=F.customShader,f=P.shaderOptions.defines.length>0?P.shaderOptions.defines.join("\n"):"",c=H.createEffectForParticles(P.shaderPath.fragmentElement,P.shaderOptions.uniforms,P.shaderOptions.samplers,f,void 0,void 0,void 0,o);o.setCustomEffect(c,0),o.customShader=P}return F.id&&(o.id=F.id),F.activeParticleCount&&(o.activeParticleCount=F.activeParticleCount),AP._Parse(F,o,P,f),F.preventAutoStart&&(o.preventAutoStart=F.preventAutoStart),c||o.preventAutoStart||o.start(),o}}var ZP=f(11462),RP=f(12957),yP=f(11980);class OP{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(F){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const P of this.systems)P.cP=F;this._emitterNode=F}setEmitterAsSphere(F,P,f){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:F,renderingGroupId:P};const c=(0,RP.e)("emitterSphere",{diameter:F.diameter,segments:F.segments},f);c.renderingGroupId=P;const N=new yP.JP("emitterSphereMaterial",f);N.emissiveColor=F.color,c.material=N;for(const q of this.systems)q.cP=c;this._emitterNode=c}start(F){for(const P of this.systems)F&&(P.cP=F),P.start()}dispose(){for(const F of this.systems)F.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const P={systems:[]};for(const f of this.systems)P.systems.push(f.serialize(F));return this._emitterNode&&(P.cP=this._emitterCreationOptions),P}static Parse(F,P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3?arguments[3]:void 0;const N=new OP,q=this.BaseAssetsUrl+"/textures/";P=P||h.b.LastCreatedScene;for(const H of F.systems)N.systems.push(f?zP.Parse(H,P,q,!0,c):AP.Parse(H,P,q,!0,c));if(F.cP){const f=F.cP.options;if("Sphere"===F.cP.kind)N.setEmitterAsSphere({diameter:f.diameter,segments:f.segments,color:H.BP.zP(f.color)},F.cP.renderingGroupId,P)}return N}}OP.BaseAssetsUrl="https://assets.babylonjs.com/particles";var dP=f(11494);class MP{static CreateDefault(F){let P,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,c=arguments.length>2?arguments[2]:void 0;P=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new zP("default system",{pP:f},c):new AP("default system",f,c),P.cP=F;const N=ZP.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return P.particleTexture=new r.e(N,P.OF()),P.createConeEmitter(.1,Math.PI/4),P.color1=new H.qc(1,1,1,1),P.color2=new H.qc(1,1,1,1),P.colorDead=new H.qc(1,1,1,0),P.minSize=.1,P.maxSize=.1,P.minEmitPower=2,P.maxEmitPower=2,P.updateSpeed=1/60,P.emitRate=30,P}static CreateAsync(F,P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3?arguments[3]:void 0;P||(P=h.b.LastCreatedScene);const N={};return P.addPendingData(N),new Promise(((q,H)=>{if(f&&!zP.IsSupported)return P.removePendingData(N),H("Particle system with GPU is not supported.");ZP.Tools.LoadFile(`${MP.BaseAssetsUrl}/systems/${F}.json`,(F=>{P.removePendingData(N);const H=JSON.parse(F.toString());return q(OP.Parse(H,P,f,c))}),void 0,void 0,void 0,(()=>(P.removePendingData(N),H(`An error occurred with the creation of your particle system. Check if your type '${F}' exists.`))))}))}static ExportSet(F){const P=new OP;for(const f of F)P.systems.push(f);return P}static ParseFromFileAsync(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",q=arguments.length>5?arguments[5]:void 0;return new Promise(((H,A)=>{const o=new dP.e;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const P=JSON.parse(o.responseText);let A;A=c?zP.Parse(P,f,N,!1,q):AP.Parse(P,f,N,!1,q),F&&(A.name=F),H(A)}else A("Unable to load the particle system")})),o.open("GET",P),o.send()}))}static ParseFromSnippetAsync(F,P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0;if("_BLANK"===F){const F=this.CreateDefault(null);return F.start(),Promise.resolve(F)}return new Promise(((q,H)=>{const A=new dP.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const H=JSON.parse(JSON.parse(A.responseText).jsonPayload),o=JSON.parse(H.particleSystem);let j;j=f?zP.Parse(o,P,c,!1,N):AP.Parse(o,P,c,!1,N),j.snippetId=F,q(j)}else H("Unable to load the snippet "+F)})),A.open("GET",this.SnippetUrl+"/"+F.replace(/#/g,"/")),A.send()}))}}MP.BaseAssetsUrl=OP.BaseAssetsUrl,MP.SnippetUrl="https://snippet.babylonjs.com",MP.CreateFromSnippetAsync=MP.ParseFromSnippetAsync;var VP=f(12063),QP=f(11880),KP=f(12963);(0,KP.g)(QP.e.NAME_PARTICLESYSTEM,((F,P,f,c)=>{const N=(0,KP.k)(QP.e.NAME_PARTICLESYSTEM);if(N&&void 0!==F.zT&&null!==F.zT)for(let q=0,H=F.zT.length;q<H;q++){const H=F.zT[q];f.zT.push(N(H,P,c))}})),(0,KP.c)(QP.e.NAME_PARTICLESYSTEM,((F,P,f)=>{if(F.activeParticleCount){return zP.Parse(F,P,f)}return AP.Parse(F,P,f)})),aF.b.prototype.createEffectForParticles=function(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",q=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=arguments.length>9?arguments[9]:void 0,u=[],T=[];const Y=[];return o?o.fillUniformsAttributesAndSamplerNames(T,u,Y):(u=AP._GetAttributeNamesOrOptions(),T=AP._GetEffectCreationOptions()),-1===N.indexOf(" BILLBOARD")&&(N+="\n#define BILLBOARD\n"),null!==o&&void 0!==o&&o.isAnimationSheetEnabled&&-1===N.indexOf(" ANIMATESHEET")&&(N+="\n#define ANIMATESHEET\n"),-1===c.indexOf("diffuseSampler")&&c.push("diffuseSampler"),this.createEffect({vertex:i??(null===o||void 0===o?void 0:o.vertexShaderName)??"particles",fragmentElement:F},u,T.concat(P),Y.concat(c),N,q,H,A,void 0,j,(async()=>{0===j?await Promise.resolve().then(f.bind(f,12996)):await Promise.resolve().then(f.bind(f,13059))}))},VP.d.prototype.getEmittedParticleSystems=function(){const F=[];for(let P=0;P<this.OF().zT.length;P++){const f=this.OF().zT[P];f.cP===this&&F.push(f)}return F},VP.d.prototype.getHierarchyEmittedParticleSystems=function(){const F=[],P=this.getDescendants();P.push(this);for(let f=0;f<this.OF().zT.length;f++){const c=this.OF().zT[f],N=c.cP;N.position&&-1!==P.indexOf(N)&&F.push(c)}return F};f(11947),f(11958),f(12042);f(12050),f(12970),f(11812),f(11940),f(12090);f(11805);var xP;f(12974),f(11666);!function(F){F[F.Color=2]="Color",F[F.UV=1]="UV",F[F.Random=0]="Random",F[F.Stated=3]="Stated"}(xP||(xP={}));var kP=f(11841);const IP=new c.tP(0,0,0),EP=new c.tP(0,0,0),rP=new c.tP(0,0,0);class nP{constructor(F,P,f){this.width=F,this.height=P,this.data=f}processFlowable(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2?arguments[2]:void 0;if(!f)return;f instanceof c.Matrix?c.tP.TransformCoordinatesToRef(F.position,f,rP):(rP.x=f.x,rP.y=f.y,rP.z=f.z);const N=.5*rP.x+.5,q=1-(.5*rP.y+.5),H=Math.floor(N*this.width),A=Math.floor(q*this.height);if(H<0||H>=this.width||A<0||A>=this.height)return;const o=4*(A*this.width+H),j=this.data[o]/255*2-1,i=this.data[o+1]/255*2-1,u=this.data[o+2]/255*2-1,T=this.data[o+3]/255;IP.set(j,i,u),IP.scaleToRef(P*T,EP),F.direction.addInPlace(EP)}_processParticle(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,f=arguments.length>2?arguments[2]:void 0;this.processFlowable(F,P,f)}static async FromUrlAsync(F){return await new Promise(((P,f)=>{const c=document.createElement("canvas"),N=c.getContext("2d");let q=null;const H=new Image;H.crossOrigin="anonymous",H.src=F,H.onerror=P=>{f(new Error(`Failed to load image: ${F} : ${P}`))},H.onload=()=>{c.width=H.width,c.height=H.height,N.drawImage(H,0,0),q=N.getImageData(0,0,c.width,c.height),P(new nP(c.width,c.height,q.data))}}))}static async ExtractFromTextureAsync(F){return await new Promise(((P,f)=>{if(!F.isReady())return void F.onLoadObservable.addOnce((async()=>{try{const f=await this.ExtractFromTextureAsync(F);P(f)}catch(c){f(c)}}));const c=F.getSize();kP.j.GetTextureDataAsync(F,c.width,c.height).then((F=>{P(new nP(c.width,c.height,new Uint8ClampedArray(F)))})).catch(f)}))}}var pP,UP,eP,DP,lP,WP,bP,vP,sP;!function(F){F[F.Int=1]="Int",F[F.Float=2]="Float",F[F.Vector2=4]="Vector2",F[F.tP=8]="tP",F[F.Matrix=16]="Matrix",F[F.Particle=32]="Particle",F[F.Texture=64]="Texture",F[F.qc=128]="qc",F[F.FloatGradient=256]="FloatGradient",F[F.Vector2Gradient=512]="Vector2Gradient",F[F.Vector3Gradient=1024]="Vector3Gradient",F[F.Color4Gradient=2048]="Color4Gradient",F[F.System=4096]="System",F[F.AutoDetect=8192]="AutoDetect",F[F.BasedOnInput=16384]="BasedOnInput",F[F.Undefined=32768]="Undefined",F[F.All=65535]="All"}(pP||(pP={})),function(F){F[F.Compatible=0]="Compatible",F[F.TypeIncompatible=1]="TypeIncompatible",F[F.HierarchyIssue=2]="HierarchyIssue"}(UP||(UP={})),function(F){F[F.Input=0]="Input",F[F.Output=1]="Output"}(eP||(eP={}));class XP{get direction(){return this._direction}get type(){if(this._type===pP.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===pP.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(F){this._type=F}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((F=>F.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(F,P,f){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=pP.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new g.d,this.onDisconnectionObservable=new g.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=P,this.name=F,this._direction=f}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(F){var P;return this.isConnected?null!==(P=this._connectedPoint)&&void 0!==P&&P._storedFunction?this._connectedPoint._storedFunction(F):this._connectedPoint._storedValue:this.value}canConnectTo(F){return 0===this.checkCompatibilityState(F)}checkCompatibilityState(F){const P=this._ownerBlock,f=F.ownerBlock;if(this.type!==F.type&&F.innerType!==pP.AutoDetect)return F.acceptedConnectionPointTypes&&-1!==F.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(F.excludedConnectionPointTypes&&-1!==F.excludedConnectionPointTypes.indexOf(this.type))return 1;let c=f,N=P;return 0===this.direction&&(c=P,N=f),c.isAnAncestorOf(N)?2:0}connectTo(F){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(F))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${F.ownerBlock.name}".${F.name}`;return this._endpoints.push(F),F._connectedPoint=this,this.onConnectionObservable.notifyObservers(F),F.onConnectionObservable.notifyObservers(this),this}disconnectFrom(F){const P=this._endpoints.indexOf(F);return-1===P||(this._endpoints.splice(P,1),F._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(F),F.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(F){let P=1;for(;P<pP.All;)F&P||this.excludedConnectionPointTypes.push(P),P<<=1}serialize(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const P={};return P.name=this.name,P.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.pf?(P.valueType="BABYLON."+this.value.getClassName(),P.value=this.value.pf()):(P.valueType="number",P.value=this.value)),F&&this.connectedPoint&&(P.inputName=this.name,P.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,P.targetConnectionName=this.connectedPoint.name,P.isExposedOnFrame=!0,P.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(P.isExposedOnFrame=!0,P.exposedPortPosition=this.exposedPortPosition),P}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class mP{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(F){this._name=F}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(F){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new g.d,this.Mf=new g.d,this.onInputChangedObservable=new g.d,this.visibleOnFrame=!1,this._name=F,this.uniqueId=n.c.UniqueId}_inputRename(F){return F}_outputRename(F){return F}isAnAncestorOf(F){for(const P of this._outputs)if(P.hasEndpoints)for(const f of P.endpoints){if(f.ownerBlock===F)return!0;if(f.ownerBlock.isAnAncestorOf(F))return!0}return!1}isAnAncestorOfType(F){if(this.getClassName()===F)return!0;for(const P of this._outputs)if(P.hasEndpoints)for(const f of P.endpoints)if(f.ownerBlock.isAnAncestorOfType(F))return!0;return!1}getInputByName(F){const P=this._inputs.filter((P=>P.name===F));return P.length?P[0]:null}_linkConnectionTypes(F,P){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[P]._acceptedConnectionPointType=this._inputs[F]:(this._inputs[F]._linkedConnectionSource=this._inputs[P],this._inputs[F]._isMainLinkSource=!0),this._inputs[P]._linkedConnectionSource=this._inputs[F]}registerInput(F,P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0;const H=new XP(F,this,0);return H.type=P,H.isOptional=f,H.defaultValue=c,H.value=c,H.valueMin=N,H.valueMax=q,this._inputs.push(H),this.onInputChangedObservable.notifyObservers(H),this}registerOutput(F,P,f){return(f=f??new XP(F,this,1)).type=P,this._outputs.push(f),this}_build(F){}_customBuildStep(F){}build(F){if(this._buildId===F.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((F=>F.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=F.buildId;for(const P of this._inputs){if(!P.connectedPoint){P.isOptional||F.notConnectedNonOptionalInputs.push(P);continue}const f=P.connectedPoint.ownerBlock;f&&f!==this&&!f.isSystem&&f.build(F)}return this._customBuildStep(F),F.verbose&&p.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(F),this.onBuildObservable.notifyObservers(this),!1}serialize(){const F={};F.customType="BABYLON."+this.getClassName(),F.id=this.uniqueId,F.name=this.name,F.visibleOnFrame=this.visibleOnFrame,F.inputs=[],F.outputs=[];for(const P of this.inputs)F.inputs.push(P.serialize());for(const P of this.outputs)F.outputs.push(P.serialize(!1));return F}_deserialize(F){this._name=F.name,this.comments=F.comments,this.visibleOnFrame=!!F.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(F)}_deserializePortDisplayNamesAndExposedOnFrame(F){const P=F.inputs,f=F.outputs;if(P)for(const c of P){const F=this.inputs.find((F=>F.name===c.name));if(!F)return;if(c.displayName&&(F.displayName=c.displayName),c.isExposedOnFrame&&(F.isExposedOnFrame=c.isExposedOnFrame,F.exposedPortPosition=c.exposedPortPosition),void 0!==c.value&&null!==c.value)if("number"===c.valueType)F.value=c.value;else{const P=(0,A.c)(c.valueType);P&&(F.value=P.zP(c.value))}}if(f)for(let c=0;c<f.length;c++){const F=f[c];F.displayName&&(this.outputs[c].displayName=F.displayName),F.isExposedOnFrame&&(this.outputs[c].isExposedOnFrame=F.isExposedOnFrame,this.outputs[c].exposedPortPosition=F.exposedPortPosition)}}clone(){const F=this.serialize(),P=(0,A.c)(F.customType);if(P){const f=new P;return f._deserialize(F),f}return null}dispose(){this.Mf.notifyObservers(this),this.Mf.clear();for(const F of this.inputs)F.dispose();for(const F of this.outputs)F.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function aP(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",c=arguments.length>3?arguments[3]:void 0;return(N,q)=>{let H=N._propStore;H||(H=[],N._propStore=H),H.push({propertyName:q,displayName:F,type:P,groupName:f,options:c??{},className:N.getClassName()})}}(0,k.e)([(0,I.L)("comment")],mP.prototype,"comments",void 0),function(F){F[F.Boolean=0]="Boolean",F[F.Float=1]="Float",F[F.Int=2]="Int",F[F.Vector2=3]="Vector2",F[F.List=4]="List",F[F.qc=5]="qc",F[F.SamplingMode=6]="SamplingMode",F[F.TextureFormat=7]="TextureFormat",F[F.TextureType=8]="TextureType"}(DP||(DP={})),function(F){F[F.None=0]="None",F[F.Position=1]="Position",F[F.Direction=2]="Direction",F[F.Age=3]="Age",F[F.Lifetime=4]="Lifetime",F[F.Color=5]="Color",F[F.ScaledDirection=6]="ScaledDirection",F[F.Scale=7]="Scale",F[F.AgeGradient=8]="AgeGradient",F[F.Angle=9]="Angle",F[F.SpriteCellIndex=16]="SpriteCellIndex",F[F.SpriteCellStart=17]="SpriteCellStart",F[F.SpriteCellEnd=18]="SpriteCellEnd"}(lP||(lP={})),function(F){F[F.None=0]="None",F[F.Time=1]="Time",F[F.Delta=2]="Delta",F[F.Emitter=3]="Emitter"}(WP||(WP={}));class wP{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let F="";for(const P of this.notConnectedNonOptionalInputs)F+=`input ${P.name} from block ${P.ownerBlock.name}[${P.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(F)throw"Build of Node Particle System Set failed:\n"+F}adapt(F,P){const f=F.getConnectedValue(this)||0;if(F.type===P)return f;switch(P){case pP.Vector2:return new c.Vector2(f,f);case pP.tP:return new c.tP(f,f,f);case pP.qc:return new H.qc(f,f,f,f)}return null}getContextualValue(F){if(!this.particleContext||!this.systemContext)return null;switch(F){case lP.Position:return this.particleContext.position;case lP.Direction:return this.particleContext.direction;case lP.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case lP.Color:return this.particleContext.color;case lP.Age:return this.particleContext.age;case lP.Lifetime:return this.particleContext.lifeTime;case lP.Angle:return this.particleContext.angle;case lP.Scale:return this.particleContext.scale;case lP.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case lP.SpriteCellEnd:return this.systemContext.endSpriteCellID;case lP.SpriteCellIndex:return this.particleContext.cellIndex;case lP.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.cP.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.cP.absolutePosition:this.systemContext.cP:null}getSystemValue(F){if(!this.particleContext||!this.systemContext)return null;switch(F){case WP.Time:return this.systemContext._actualFrame;case WP.Delta:return this.systemContext._scaledUpdateSpeed;case WP.Emitter:if(this.isEmitterTransformNode){return this.systemContext.cP.absolutePosition}return this.systemContext.cP}return null}}function gP(F,P,f){const c=new wP;c.LP=P;const N=F.createSystem(c);return N.canStart=()=>!0,N.cP=f.clone(),N.disposeOnStop=!0,N.start(),N}class GP extends mP{constructor(F){super(F),this.blendMode=o.BLENDMODE_ONEONE,this.pP=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",pP.Particle),this.registerInput("texture",pP.Texture),this.registerInput("onStart",pP.System,!0),this.registerInput("onEnd",pP.System,!0),this.registerOutput("system",pP.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(F){F.pP=this.pP,F.buildId=this._buildId++,this.build(F);const P=this.particle.getConnectedValue(F);return P.particleTexture=this.texture.getConnectedValue(F),P.emitRate=this.emitRate,P.blendMode=this.blendMode,P.name=this.name,P._nodeGenerated=!0,P._targetStopDuration=this.targetStopDuration,P.startDelay=this.startDelay,this.system._storedValue=this,P.canStart=()=>!this.doNoStart,P.onStartedObservable.add((f=>{const c=this.onStart.getConnectedValue(F);c&&f.onStartedObservable.addOnce((()=>{F.systemContext=P;const f=gP(c,F.LP,F.emitterPosition);this.Mf.addOnce((()=>{f.dispose()}))}));const N=this.onEnd.getConnectedValue(F);N&&f.onStoppedObservable.addOnce((()=>{F.systemContext=P;const f=gP(N,F.LP,F.emitterPosition);this.Mf.addOnce((()=>{f.dispose()}))}))})),this.Mf.addOnce((()=>{P.dispose()})),P}serialize(){const F=super.serialize();return F.pP=this.pP,F.emitRate=this.emitRate,F.blendMode=this.blendMode,F.doNoStart=this.doNoStart,F.targetStopDuration=this.targetStopDuration,F.startDelay=this.startDelay,F}_deserialize(F){super._deserialize(F),this.pP=F.pP,this.emitRate=F.emitRate,this.doNoStart=!!F.doNoStart,void 0!==F.blendMode&&(this.blendMode=F.blendMode),void 0!==F.targetStopDuration&&(this.targetStopDuration=F.targetStopDuration),void 0!==F.startDelay&&(this.startDelay=F.startDelay)}}(0,k.e)([aP("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:o.BLENDMODE_ONEONE},{label:"Standard",value:o.BLENDMODE_STANDARD},{label:"Add",value:o.BLENDMODE_ADD},{label:"Multiply",value:o.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:o.BLENDMODE_MULTIPLYADD}]})],GP.prototype,"blendMode",void 0),(0,k.e)([aP("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],GP.prototype,"pP",void 0),(0,k.e)([aP("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],GP.prototype,"emitRate",void 0),(0,k.e)([aP("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],GP.prototype,"targetStopDuration",void 0),(0,k.e)([aP("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],GP.prototype,"startDelay",void 0),(0,k.e)([aP("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],GP.prototype,"doNoStart",void 0),(0,A.f)("BABYLON.SystemBlock",GP);class hP extends mP{get type(){if(this._type===pP.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=pP.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=pP.Vector2,this._type;case"tP":return this._type=pP.tP,this._type;case"qc":return this._type=pP.qc,this._type;case"Matrix":return this._type=pP.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===lP.None&&this._systemSource!==WP.None}get systemSource(){return this._systemSource}set systemSource(F){if(this._systemSource=F,F!==WP.None){switch(this._contextualSource=lP.None,this._type=pP.Float,F){case WP.Time:case WP.Delta:this._type=pP.Float;break;case WP.Emitter:this._type=pP.tP}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==lP.None}get contextualValue(){return this._contextualSource}set contextualValue(F){if(this._contextualSource=F,F!==lP.None){switch(this._systemSource=WP.None,F){case lP.Scale:this._type=pP.Vector2;break;case lP.Position:case lP.Direction:case lP.ScaledDirection:this._type=pP.tP;break;case lP.Color:this._type=pP.qc;break;case lP.Age:case lP.Lifetime:case lP.Angle:case lP.AgeGradient:this._type=pP.Float;break;case lP.SpriteCellEnd:case lP.SpriteCellStart:case lP.SpriteCellIndex:this._type=pP.Int}this.output&&(this.output.type=this._type)}}constructor(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pP.AutoDetect;super(F),this._type=pP.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new g.d,this._systemSource=WP.None,this._contextualSource=lP.None,this._type=P,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",P)}get value(){return this._storedValue}set value(F){this.type===pP.Float&&this.min!==this.max&&(F=Math.max(this.min,F),F=Math.min(this.max,F)),this._storedValue=F,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(F){this._valueCallback=F}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case pP.Int:case pP.Float:this.value=0;break;case pP.Vector2:this.value=c.Vector2.Zero();break;case pP.tP:this.value=c.tP.Zero();break;case pP.qc:this.value=new H.qc(1,1,1,1);break;case pP.Matrix:this.value=c.Matrix.Identity()}}_build(F){super._build(F),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=F=>F.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=F=>F.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const F=super.serialize();return F.type=this.type,F.contextualValue=this.contextualValue,F.systemSource=this.systemSource,F.min=this.min,F.max=this.max,F.groupInInspector=this.groupInInspector,F.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.pf?(F.valueType="BABYLON."+this._storedValue.getClassName(),F.value=this._storedValue.pf()):(F.valueType="number",F.value=this._storedValue)),F}_deserialize(F){if(super._deserialize(F),this._type=F.type,this.contextualValue=F.contextualValue,this.systemSource=F.systemSource||WP.None,this.min=F.min||0,this.max=F.max||0,this.groupInInspector=F.groupInInspector||"",void 0!==F.displayInInspector&&(this.displayInInspector=F.displayInInspector),F.valueType)if("number"===F.valueType)this._storedValue=F.value;else{const P=(0,A.c)(F.valueType);P&&(this._storedValue=P.zP(F.value))}}}(0,A.f)("BABYLON.ParticleInputBlock",hP);class SP extends mP{get url(){return this._url}set url(F){this._url!==F&&(this._cachedData=null,this._url=F,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(F){this._textureDataUrl!==F&&(this._cachedData=null,this._textureDataUrl=F,this._url="",this._sourceTexture=null)}set sourceTexture(F){this._sourceTexture!==F&&(this._cachedData=null,this._sourceTexture=F,this._url="",this._textureDataUrl="")}constructor(F){super(F),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",pP.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const F=this.texture._storedValue;return await new Promise(((P,f)=>{if(!F.isReady())return void F.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),P(this._cachedData)}catch(F){f(F)}}));const c=F.getSize();kP.j.GetTextureDataAsync(F,c.width,c.height).then((f=>{this._cachedData={width:c.width,height:c.height,data:new Uint8ClampedArray(f)},F.dispose(),P(this._cachedData)})).catch(f)}))}_build(F){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new r.e(this._textureDataUrl,F.LP):this.texture._storedValue=new r.e(this._url,F.LP):this.texture._storedValue=null}serialize(){const F=super.serialize();return F.url=this.url,F.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(F.textureDataUrl=this.textureDataUrl),F}_deserialize(F){super._deserialize(F),this.url=F.url,this.serializedCachedData=!!F.serializedCachedData,F.textureDataUrl&&(this.textureDataUrl=F.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,A.f)("BABYLON.ParticleTextureSourceBlock",SP);class Ff extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("position",pP.tP),this.registerOutput("output",pP.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(F){const P=this.particle.getConnectedValue(F);if(this.output._storedValue=P,!this.position.isConnected)return;const f={process:f=>{F.particleContext=f,F.systemContext=P,f.position.q(this.position.getConnectedValue(F))},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f}}(0,A.f)("BABYLON.UpdatePositionBlock",Ff),function(F){F[F.Add=0]="Add",F[F.Subtract=1]="Subtract",F[F.Multiply=2]="Multiply",F[F.Divide=3]="Divide",F[F.Max=4]="Max",F[F.Min=5]="Min"}(bP||(bP={}));class Pf extends mP{constructor(F){super(F),this.operation=bP.Add,this.registerInput("left",pP.AutoDetect),this.registerInput("right",pP.AutoDetect),this.registerOutput("output",pP.BasedOnInput),this.output._typeConnectionSource=this.left;const P=[pP.Matrix,pP.Particle,pP.Texture,pP.System,pP.FloatGradient,pP.Color4Gradient,pP.Vector2Gradient,pP.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...P),this.right.excludedConnectionPointTypes.push(...P),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(F){let P;const f=this.left,N=this.right;if(!f.isConnected||!N.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const q=f.type===pP.Float||f.type===pP.Int,A=N.type===pP.Float||N.type===pP.Int,o=q&&A;switch(this.operation){case bP.Add:P=o?F=>f.getConnectedValue(F)+N.getConnectedValue(F):q?F=>F.adapt(f,N.type).add(N.getConnectedValue(F)):F=>f.getConnectedValue(F).add(F.adapt(N,f.type));break;case bP.Subtract:P=o?F=>f.getConnectedValue(F)-N.getConnectedValue(F):q?F=>F.adapt(f,N.type).CP(N.getConnectedValue(F)):F=>f.getConnectedValue(F).CP(F.adapt(N,f.type));break;case bP.Multiply:P=o?F=>f.getConnectedValue(F)*N.getConnectedValue(F):q?F=>F.adapt(f,N.type).multiply(N.getConnectedValue(F)):F=>f.getConnectedValue(F).multiply(F.adapt(N,f.type));break;case bP.Divide:P=o?F=>f.getConnectedValue(F)/N.getConnectedValue(F):q?F=>F.adapt(f,N.type).divide(N.getConnectedValue(F)):F=>f.getConnectedValue(F).divide(F.adapt(N,f.type));break;case bP.Min:if(o)P=F=>Math.min(f.getConnectedValue(F),N.getConnectedValue(F));else{const[F,A]=q?[N,f]:[f,N];switch(F.type){case pP.Vector2:P=P=>c.Vector2.Minimize(F.getConnectedValue(P),P.adapt(A,F.type));break;case pP.tP:P=P=>c.tP.Minimize(F.getConnectedValue(P),P.adapt(A,F.type));break;case pP.qc:P=P=>{const f=F.getConnectedValue(P),{r:c,g:N,b:q,a:o}=P.adapt(A,F.type);return new H.qc(Math.min(f.r,c),Math.min(f.g,N),Math.min(f.b,q),Math.min(f.a,o))}}}break;case bP.Max:if(!o){const[F,A]=q?[N,f]:[f,N];switch(F.type){case pP.Vector2:P=P=>c.Vector2.Maximize(F.getConnectedValue(P),P.adapt(A,F.type));break;case pP.tP:P=P=>c.tP.Maximize(F.getConnectedValue(P),P.adapt(A,F.type));break;case pP.qc:P=P=>{const f=F.getConnectedValue(P),{r:c,g:N,b:q,a:o}=P.adapt(A,F.type);return new H.qc(Math.max(f.r,c),Math.min(f.g,N),Math.min(f.b,q),Math.min(f.a,o))}}break}P=F=>Math.max(f.getConnectedValue(F),N.getConnectedValue(F))}this.output._storedFunction=F=>f.type===pP.Int?0|P(F):P(F)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===pP.Int||this.left.type===pP.Float&&this.right.type!==pP.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[F,P]of[[this.left,this.right],[this.right,this.left]])F.acceptedConnectionPointTypes=[pP.Int,pP.Float],P.isConnected&&(F.acceptedConnectionPointTypes.push(P.type),P.type!==pP.Int&&P.type!==pP.Float||F.acceptedConnectionPointTypes.push(pP.Vector2,pP.tP,pP.qc))}dispose(){super.dispose();for(const F of this._connectionObservers)F.remove();this._connectionObservers.length=0}serialize(){const F=super.serialize();return F.operation=this.operation,F}_deserialize(F){super._deserialize(F),this.operation=F.operation}}(0,k.e)([aP("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:bP.Add},{label:"Subtract",value:bP.Subtract},{label:"Multiply",value:bP.Multiply},{label:"Divide",value:bP.Divide},{label:"Max",value:bP.Max},{label:"Min",value:bP.Min}]})],Pf.prototype,"operation",void 0),(0,A.f)("BABYLON.ParticleMathBlock",Pf);class ff extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("direction1",pP.tP,!0,new c.tP(0,1,0)),this.registerInput("direction2",pP.tP,!0,new c.tP(0,1,0)),this.registerInput("minEmitBox",pP.tP,!0,new c.tP(-.5,-.5,-.5)),this.registerInput("maxEmitBox",pP.tP,!0,new c.tP(.5,.5,.5)),this.registerOutput("output",pP.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(F){const P=this.particle.getConnectedValue(F);P._directionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.direction1.getConnectedValue(F),q=this.direction2.getConnectedValue(F),H=(0,j.RandomRange)(N.x,q.x),A=(0,j.RandomRange)(N.y,q.y),o=(0,j.RandomRange)(N.z,q.z);F.isEmitterTransformNode?c.tP.TransformNormalFromFloatsToRef(H,A,o,F.emitterWorldMatrix,f.direction):f.direction.fc(H,A,o)},P._positionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.minEmitBox.getConnectedValue(F),q=this.maxEmitBox.getConnectedValue(F),H=(0,j.RandomRange)(N.x,q.x),A=(0,j.RandomRange)(N.y,q.y),o=(0,j.RandomRange)(N.z,q.z);F.isEmitterTransformNode?c.tP.TransformCoordinatesFromFloatsToRef(H,A,o,F.emitterWorldMatrix,f.position):(f.position.fc(H,A,o),f.position.addInPlace(F.emitterPosition))},this.output._storedValue=P}}(0,A.f)("BABYLON.BoxShapeBlock",ff);class cf extends mP{constructor(F){super(F),this.registerInput("emitPower",pP.Float,!0,1),this.registerInput("lifeTime",pP.Float,!0,1),this.registerInput("color",pP.qc,!0,new H.qc(1,1,1,1)),this.registerInput("scale",pP.Vector2,!0,new c.Vector2(1,1)),this.registerInput("angle",pP.Float,!0,0),this.registerOutput("particle",pP.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(F){const P=new AP(this.name,F.pP,F.LP,null,!1,void 0,!0);P.particleEmitterType=new J,P._lifeTimeCreation.process=(P,f)=>{F.particleContext=P,P.lifeTime=this.lifeTime.getConnectedValue(F),f._emitPower=this.emitPower.getConnectedValue(F)},P._colorCreation.process=P=>{F.particleContext=P,P.color.q(this.color.getConnectedValue(F))},P._sizeCreation.process=P=>{F.particleContext=P,P.size=1,P.scale.q(this.scale.getConnectedValue(F))},P._angleCreation.process=P=>{F.particleContext=P,P.angle=this.angle.getConnectedValue(F)},this.particle._storedValue=P}}(0,A.f)("BABYLON.CreateParticleBlock",cf);class Nf{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const F=[];for(const P of this.attachedBlocks)P.isInput&&F.push(P);return F}constructor(F){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new g.d,this.name=F}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(F){let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(F)&&this.attachedBlocks.push(F);for(const f of F.inputs){const c=f.connectedPoint;if(c){const f=c.ownerBlock;f!==F&&this._initializeBlock(f,P)}}}async buildAsync(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((f=>{const c=new OP;for(const F of this._systemBlocks)this._initializeBlock(F);for(const N of this.systemBlocks){const f=new wP;f.buildId=this._buildId++,f.LP=F,f.verbose=P;const q=N.createSystem(f);f.emitErrors(),c.systems.push(q)}this.onBuildObservable.notifyObservers(this),f(c)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const F=new GP("Particle system"),P=new Ff("Update position");P.output.connectTo(F.particle);const f=new hP("Position");f.contextualValue=lP.Position;const c=new hP("Scaled direction");c.contextualValue=lP.ScaledDirection;const N=new Pf("Add");N.operation=bP.Add,f.output.connectTo(N.left),c.output.connectTo(N.right),N.output.connectTo(P.position);const q=new cf("Create particle"),H=new ff("Box shape");q.particle.connectTo(H.particle),H.output.connectTo(P.particle);const A=new SP("Texture");A.texture.connectTo(F.texture),A.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(F)}removeBlock(F){const P=this.attachedBlocks.indexOf(F);if(P>-1&&this.attachedBlocks.splice(P,1),F.isSystem){const P=this._systemBlocks.indexOf(F);P>-1&&this._systemBlocks.splice(P,1)}}parseSerializedObject(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P||this.clear();const f={};for(const c of F.ei){const F=(0,A.c)(c.customType);if(F){const P=new F;P._deserialize(c),f[c.id]=P,this.attachedBlocks.push(P),P.isSystem&&this._systemBlocks.push(P)}}for(const c of this.attachedBlocks)if(c.isTeleportOut){const F=c,P=F._tempEntryPointUniqueId;if(P){const c=f[P];c&&c.attachToEndpoint(F)}}for(let c=0;c<F.ei.length;c++){const N=F.ei[c],q=f[N.id];q&&(q.inputs.length&&N.inputs.some((F=>F.targetConnectionName))&&!P||this._restoreConnections(q,F,f))}if(F.locations||F.editorData&&F.editorData.locations){const c=F.locations||F.editorData.locations;for(const F of c)f[F.LN]&&(F.LN=f[F.LN].uniqueId);P&&this.editorData&&this.editorData.locations&&c.concat(this.editorData.locations),F.locations?this.editorData={locations:c}:(this.editorData=F.editorData,this.editorData.locations=c);const N=[];for(const F in f)N[F]=f[F].uniqueId;this.editorData.map=N}this.comment=F.comment}_restoreConnections(F,P,f){for(const c of F.outputs)for(const N of P.ei){const q=f[N.id];if(q)for(const H of N.inputs)if(f[H.targetBlockId]!==F||H.targetConnectionName!==c.name);else{const F=q.getInputByName(H.inputName);if(!F||F.isConnected)continue;c.connectTo(F,!0),this._restoreConnections(q,P,f)}}}serialize(F){const P=F?{}:E.e.Serialize(this);P.editorData=JSON.parse(JSON.stringify(this.editorData));let f=[];F?f=F:P.customType="BABYLON.NodeParticleSystemSet",P.ei=[];for(const c of f)P.ei.push(c.serialize());if(!F)for(const c of this.attachedBlocks)-1===f.indexOf(c)&&P.ei.push(c.serialize());return P}dispose(){for(const F of this.attachedBlocks)F.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(F){const P=new Nf(F);return P.setToDefault(),P}static Parse(F){const P=E.e.Parse((()=>new Nf(F.name)),F,null);return P.parseSerializedObject(F),P}static ParseFromSnippetAsync(F,P){return"_BLANK"===F?Promise.resolve(Nf.CreateDefault("blank")):new Promise(((f,c)=>{const N=new dP.e;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const H=JSON.parse(JSON.parse(N.responseText).jsonPayload),A=JSON.parse(H.nodeParticle);P||(P=E.e.Parse((()=>new Nf(F)),A,null)),P.parseSerializedObject(A),P.snippetId=F;try{f(P)}catch(q){c(q)}}else c("Unable to load the snippet "+F)})),N.open("GET",this.SnippetUrl+"/"+F.replace(/#/g,"/")),N.send()}))}}Nf.EditorURL=`${ZP.Tools._DefaultCdnUrl}/v${aF.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Nf.SnippetUrl="https://snippet.babylonjs.com",(0,k.e)([(0,I.L)()],Nf.prototype,"name",void 0),(0,k.e)([(0,I.L)("comment")],Nf.prototype,"comment",void 0),function(F){F[F.None=0]="None",F[F.PerParticle=1]="PerParticle",F[F.PerSystem=2]="PerSystem"}(vP||(vP={}));class qf extends mP{constructor(F){super(F),this._currentLockId=-2,this.lockMode=vP.PerParticle,this.registerInput("min",pP.AutoDetect,!0,0),this.registerInput("max",pP.AutoDetect,!0,1),this.registerOutput("output",pP.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(pP.Float|pP.Int|pP.Vector2|pP.tP|pP.qc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(pP.Float|pP.Int|pP.Vector2|pP.tP|pP.qc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=pP.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let F=null;switch(this._currentLockId=-2,this.min.type){case pP.AutoDetect:case pP.Int:case pP.Float:F=F=>{const P=this.min.getConnectedValue(F)||0,f=this.max.getConnectedValue(F)||1;return P+Math.random()*(f-P)};break;case pP.Vector2:F=F=>{const P=this.min.getConnectedValue(F)||c.Vector2.Zero(),f=this.max.getConnectedValue(F)||c.Vector2.One();return new c.Vector2(P.x+Math.random()*(f.x-P.x),P.y+Math.random()*(f.y-P.y))};break;case pP.tP:F=F=>{const P=this.min.getConnectedValue(F)||c.tP.Zero(),f=this.max.getConnectedValue(F)||c.tP.One();return new c.tP(P.x+Math.random()*(f.x-P.x),P.y+Math.random()*(f.y-P.y),P.z+Math.random()*(f.z-P.z))};break;case pP.qc:F=F=>{const P=this.min.getConnectedValue(F)||new H.qc(0,0,0,0),f=this.max.getConnectedValue(F)||new H.qc(1,1,1,1);return new H.qc(P.x+Math.random()*(f.x-P.x),P.y+Math.random()*(f.y-P.y),P.z+Math.random()*(f.z-P.z),P.w+Math.random()*(f.w-P.w))}}this.output._storedFunction=P=>{var f;let c=0;switch(this.lockMode){case vP.PerParticle:c=(null===(f=P.particleContext)||void 0===f?void 0:f.id)||-1;break;case vP.PerSystem:c=P.buildId||0}return this._currentLockId!==c&&(this.lockMode!==vP.None&&(this._currentLockId=c),this.output._storedValue=F(P)),this.output._storedValue}}serialize(){const F=super.serialize();return F.lockMode=this.lockMode,F}_deserialize(F){super._deserialize(F),this.lockMode=F.lockMode}}(0,k.e)([aP("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vP.None},{label:"Per particle",value:vP.PerParticle},{label:"Per system",value:vP.PerSystem}]})],qf.prototype,"lockMode",void 0),(0,A.f)("BABYLON.ParticleRandomBlock",qf);class Hf extends mP{constructor(F){super(F),this._currentLockId=-2,this.lockMode=vP.PerParticle,this.registerInput("min",pP.AutoDetect),this.registerInput("max",pP.AutoDetect),this.registerOutput("output",pP.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const P=[pP.Matrix,pP.Particle,pP.Texture,pP.System,pP.FloatGradient,pP.Color4Gradient,pP.Vector2Gradient,pP.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...P),this.max.excludedConnectionPointTypes.push(...P)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let F=null;switch(this._currentLockId=-2,this.min.type){case pP.Float:case pP.Int:F=F=>{const P=this.min.getConnectedValue(F),f=this.max.getConnectedValue(F);return Math.random()*(f-P)+P};break;case pP.Vector2:F=F=>{const P=this.min.getConnectedValue(F),f=this.max.getConnectedValue(F);return new c.Vector2(Math.random()*(f.x-P.x)+P.x,Math.random()*(f.y-P.y)+P.y)};break;case pP.tP:F=F=>{const P=this.min.getConnectedValue(F),f=this.max.getConnectedValue(F);return new c.tP(Math.random()*(f.x-P.x)+P.x,Math.random()*(f.y-P.y)+P.y,Math.random()*(f.z-P.z)+P.z)};break;case pP.qc:F=F=>{const P=this.min.getConnectedValue(F),f=this.max.getConnectedValue(F);return new H.qc(Math.random()*(f.r-P.r)+P.r,Math.random()*(f.g-P.g)+P.g,Math.random()*(f.b-P.b)+P.b,Math.random()*(f.a-P.a)+P.a)}}this.output._storedFunction=P=>{var f;let c=0;switch(this.lockMode){case vP.PerParticle:c=(null===(f=P.particleContext)||void 0===f?void 0:f.id)||-1;break;case vP.PerSystem:c=P.buildId||0}return this._currentLockId!==c&&(this.lockMode!==vP.None&&(this._currentLockId=c),this.output._storedValue=F(P)),this.output._storedValue}}serialize(){const F=super.serialize();return F.lockMode=this.lockMode,F}_deserialize(F){super._deserialize(F),void 0!==F.lockMode&&(this.lockMode=F.lockMode)}}(0,k.e)([aP("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vP.None},{label:"Per particle",value:vP.PerParticle},{label:"Per system",value:vP.PerSystem}]})],Hf.prototype,"lockMode",void 0),(0,A.f)("BABYLON.RandomRangeBlock",Hf);(0,A.f)("BABYLON.ParticleLerpBlock",class extends mP{constructor(F){super(F),this.registerInput("left",pP.AutoDetect),this.registerInput("right",pP.AutoDetect),this.registerInput("gradient",pP.Float,!0,0,0,1),this.registerOutput("output",pP.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(pP.Float|pP.Int|pP.Vector2|pP.tP|pP.qc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const F=(F,P,f)=>(1-F)*P+F*f;this.output._storedFunction=P=>{const f=this.left.getConnectedValue(P),N=this.right.getConnectedValue(P),q=this.gradient.getConnectedValue(P);switch(this.left.type){case pP.Int:case pP.Float:return F(q,f,N);case pP.Vector2:return new c.Vector2(F(q,f.x,N.x),F(q,f.y,N.y));case pP.tP:return new c.tP(F(q,f.x,N.x),F(q,f.y,N.y),F(q,f.z,N.z));case pP.qc:return new H.qc(F(q,f.r,N.r),F(q,f.g,N.g),F(q,f.b,N.b),F(q,f.a,N.a))}return 0}}});(0,A.f)("BABYLON.UpdateDirectionBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("direction",pP.tP),this.registerOutput("output",pP.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(F){const P=this.particle.getConnectedValue(F);if(this.output._storedValue=P,!this.direction.isConnected)return;const f={process:f=>{F.particleContext=f,F.systemContext=P,f.direction.q(this.direction.getConnectedValue(F))},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f}});(0,A.f)("BABYLON.UpdateColorBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("color",pP.qc),this.registerOutput("output",pP.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(F){const P=this.particle.getConnectedValue(F);if(this.output._storedValue=P,!this.color.isConnected)return;const f={process:f=>{F.particleContext=f,F.systemContext=P,f.color.q(this.color.getConnectedValue(F))},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f}});(0,A.f)("BABYLON.UpdateScaleBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("scale",pP.Vector2),this.registerOutput("output",pP.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(F){const P=this.particle.getConnectedValue(F);if(this.output._storedValue=P,!this.scale.isConnected)return;const f={process:f=>{F.particleContext=f,F.systemContext=P,f.scale.q(this.scale.getConnectedValue(F))},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f}});(0,A.f)("BABYLON.UpdateAngleBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("angle",pP.Float),this.registerOutput("output",pP.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(F){const P=this.particle.getConnectedValue(F);if(this.output._storedValue=P,!this.angle.isConnected)return;const f={process:f=>{F.particleContext=f,F.systemContext=P,f.angle=this.angle.getConnectedValue(F)},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f}});(0,A.f)("BABYLON.BasicPositionUpdateBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerOutput("output",pP.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(F){const P=this.particle.getConnectedValue(F),f={process:f=>{F.particleContext=f,F.systemContext=P,f.direction.scaleToRef(P._directionScale,P._scaledDirection),f.position.addInPlace(P._scaledDirection)},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f,this.output._storedValue=P}});(0,A.f)("BABYLON.BasicSpriteUpdateBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerOutput("output",pP.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(F){const P=this.particle.getConnectedValue(F),f={process:f=>{F.particleContext=f,F.systemContext=P,f.updateCellIndex()},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f,this.output._storedValue=P}});(0,A.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("cellIndex",pP.Int),this.registerOutput("output",pP.Particle),this.cellIndex.acceptedConnectionPointTypes=[pP.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(F){const P=this.particle.getConnectedValue(F);if(this.output._storedValue=P,!this.cellIndex.isConnected)return;const f={process:f=>{F.particleContext=f,F.systemContext=P,f.cellIndex=Math.floor(this.cellIndex.getConnectedValue(F))},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f}});class Af extends mP{constructor(F){super(F),this.strength=1,this.registerInput("particle",pP.Particle),this.registerInput("flowMap",pP.Texture),this.registerOutput("output",pP.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(F){var P;const f=this.particle.getConnectedValue(F),c=F.LP;let N;(null===(P=this.flowMap.connectedPoint)||void 0===P?void 0:P.ownerBlock).extractTextureContentAsync().then((F=>{F&&(N=new nP(F.width,F.height,F.data))}));const q={process:F=>{const P=c.getTransformMatrix();N&&N._processParticle(F,this.strength*f._tempScaledUpdateSpeed,P)},previousItem:null,nextItem:null};f._updateQueueStart?WF(q,f._updateQueueStart):f._updateQueueStart=q,this.output._storedValue=f}serialize(){const F=super.serialize();return F.strength=this.strength,F}_deserialize(F){super._deserialize(F),this.strength=F.strength}}(0,k.e)([aP("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Af.prototype,"strength",void 0),(0,A.f)("BABYLON.UpdateFlowMapBlock",Af);(0,A.f)("BABYLON.SphereShapeBlock",class extends mP{constructor(F){super(F),this.registerInput("input",pP.Particle),this.registerInput("radius",pP.Float,!0,1),this.registerInput("radiusRange",pP.Float,!0,1,0,1),this.registerInput("directionRandomizer",pP.Float,!0,0,0,1),this.registerOutput("output",pP.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(F){const P=this.input.getConnectedValue(F);P._directionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.directionRandomizer.getConnectedValue(F),q=f.position.CP(F.emitterPosition).normalize(),H=(0,j.RandomRange)(0,N),A=(0,j.RandomRange)(0,N),o=(0,j.RandomRange)(0,N);q.x+=H,q.y+=A,q.z+=o,q.normalize(),F.isEmitterTransformNode?c.tP.TransformNormalFromFloatsToRef(H,A,o,F.emitterWorldMatrix,f.direction):f.direction.fc(H,A,o)},P._positionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.radius.getConnectedValue(F),q=this.radiusRange.getConnectedValue(F),H=N-(0,j.RandomRange)(0,N*q),A=(0,j.RandomRange)(0,1),o=(0,j.RandomRange)(0,2*Math.PI),i=Math.acos(2*A-1),u=H*Math.cos(o)*Math.sin(i),T=H*Math.cos(i),Y=H*Math.sin(o)*Math.sin(i);F.isEmitterTransformNode?c.tP.TransformCoordinatesFromFloatsToRef(u,T,Y,F.emitterWorldMatrix,f.position):(f.position.fc(u,T,Y),f.position.addInPlace(F.emitterPosition))},this.output._storedValue=P}});(0,A.f)("BABYLON.PointShapeBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("direction1",pP.tP,!0,new c.tP(0,1,0)),this.registerInput("direction2",pP.tP,!0,new c.tP(0,1,0)),this.registerOutput("output",pP.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(F){const P=this.particle.getConnectedValue(F);P._directionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.direction1.getConnectedValue(F),q=this.direction2.getConnectedValue(F),H=(0,j.RandomRange)(N.x,q.x),A=(0,j.RandomRange)(N.y,q.y),o=(0,j.RandomRange)(N.z,q.z);F.isEmitterTransformNode?c.tP.TransformNormalFromFloatsToRef(H,A,o,F.emitterWorldMatrix,f.direction):f.direction.fc(H,A,o)},P._positionCreation.process=f=>{F.systemContext=P,F.isEmitterTransformNode?c.tP.TransformCoordinatesFromFloatsToRef(0,0,0,F.emitterWorldMatrix,f.position):f.position.q(F.emitterPosition)},this.output._storedValue=P}});(0,A.f)("BABYLON.CustomShapeBlock",class extends mP{constructor(F){super(F),this.registerInput("particle",pP.Particle),this.registerInput("position",pP.tP,!0,new c.tP(0,0,0)),this.registerInput("direction",pP.tP,!0,new c.tP(0,1,0)),this.registerOutput("output",pP.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(F){const P=this.particle.getConnectedValue(F);P._directionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.direction.getConnectedValue(F);F.isEmitterTransformNode?c.tP.TransformNormalToRef(N,F.emitterWorldMatrix,f.direction):f.direction.q(N)},P._positionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.position.getConnectedValue(F);F.isEmitterTransformNode?c.tP.TransformCoordinatesToRef(N,F.emitterWorldMatrix,f.position):(f.position.q(N),f.position.addInPlace(F.emitterPosition))},this.output._storedValue=P}});(0,A.f)("BABYLON.CylinderShapeBlock",class extends mP{constructor(F){super(F),this._tempVector=c.tP.Zero(),this.registerInput("particle",pP.Particle),this.registerInput("radius",pP.Float,!0,1),this.registerInput("height",pP.Float,!0,1,0),this.registerInput("radiusRange",pP.Float,!0,1,0,1),this.registerInput("directionRandomizer",pP.Float,!0,0,0,1),this.registerOutput("output",pP.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(F){const P=this.particle.getConnectedValue(F);P._directionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.directionRandomizer.getConnectedValue(F);f.position.subtractToRef(F.emitterPosition,this._tempVector),this._tempVector.normalize(),F.isEmitterTransformNode&&c.tP.TransformNormalToRef(this._tempVector,F.emitterInverseWorldMatrix,this._tempVector);const q=(0,j.RandomRange)(-N/2,N/2);let H=Math.atan2(this._tempVector.x,this._tempVector.z);H+=(0,j.RandomRange)(-Math.PI/2,Math.PI/2)*N,this._tempVector.y=q,this._tempVector.x=Math.sin(H),this._tempVector.z=Math.cos(H),this._tempVector.normalize(),F.isEmitterTransformNode?c.tP.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,F.emitterWorldMatrix,f.direction):f.direction.q(this._tempVector)},P._positionCreation.process=f=>{F.particleContext=f,F.systemContext=P;const N=this.height.getConnectedValue(F),q=this.radiusRange.getConnectedValue(F),H=this.radius.getConnectedValue(F),A=(0,j.RandomRange)(-N/2,N/2),o=(0,j.RandomRange)(0,2*Math.PI),i=(0,j.RandomRange)((1-q)*(1-q),1),u=Math.sqrt(i)*H,T=u*Math.cos(o),Y=u*Math.sin(o);F.isEmitterTransformNode?c.tP.TransformCoordinatesFromFloatsToRef(T,A,Y,F.emitterWorldMatrix,f.position):(f.position.fc(T,A,Y),f.position.addInPlace(F.emitterPosition))},this.output._storedValue=P}});class of extends mP{constructor(F){super(F),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",pP.Particle),this.registerOutput("output",pP.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(F){super._build(F);const P=this.particle.getConnectedValue(F);P._isAnimationSheetEnabled=!0,P.spriteCellWidth=this.width,P.spriteCellHeight=this.height,P.startSpriteCellID=this.start,P.endSpriteCellID=this.end,P.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=P}serialize(){const F=super.serialize();return F.width=this.width,F.height=this.height,F.start=this.start,F.end=this.end,F.randomStartCell=this.randomStartCell,F}_deserialize(F){super._deserialize(F),this.width=F.width,this.height=F.height,this.start=F.start,this.end=F.end,this.randomStartCell=F.randomStartCell}}(0,k.e)([aP("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],of.prototype,"start",void 0),(0,k.e)([aP("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],of.prototype,"end",void 0),(0,k.e)([aP("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],of.prototype,"width",void 0),(0,k.e)([aP("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],of.prototype,"height",void 0),(0,k.e)([aP("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],of.prototype,"loop",void 0),(0,k.e)([aP("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],of.prototype,"randomStartCell",void 0),(0,A.f)("BABYLON.SetupSpriteSheetBlock",of);class jf extends mP{constructor(F){super(F),this.reference=0,this.registerInput("value",pP.AutoDetect),this.registerOutput("output",pP.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=F=>{switch(F){case pP.Float:return pP.FloatGradient;case pP.Vector2:return pP.Vector2Gradient;case pP.tP:return pP.Vector3Gradient;case pP.qc:return pP.Color4Gradient}return F},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(pP.Float|pP.Vector2|pP.tP|pP.qc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=F=>null}serialize(){const F=super.serialize();return F.reference=this.reference,F}_deserialize(F){super._deserialize(F),this.reference=F.reference}}(0,k.e)([aP("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],jf.prototype,"reference",void 0),(0,A.f)("BABYLON.ParticleGradientValueBlock",jf);(0,A.f)("BABYLON.ParticleGradientBlock",class extends mP{constructor(F){super(F),this._entryCount=1,this.registerInput("gradient",pP.Float,!0,1,0,1),this.registerInput("value0",pP.AutoDetect),this.registerOutput("output",pP.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=F=>{switch(F){case pP.FloatGradient:return pP.Float;case pP.Vector2Gradient:return pP.Vector2;case pP.Vector3Gradient:return pP.tP;case pP.Color4Gradient:return pP.qc}return F},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(pP.FloatGradient|pP.Vector2Gradient|pP.Vector3Gradient|pP.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(F){this._inputs[F].onConnectionObservable.add((()=>{this._entryCount>F||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),pP.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const F=[];for(let f=1;f<this._inputs.length;f++){var P;if(this._inputs[f].isConnected)F.push(null===(P=this._inputs[f].connectedPoint)||void 0===P?void 0:P.ownerBlock)}F.sort(((F,P)=>F.reference-P.reference)),this.output._storedFunction=P=>{const f=this.gradient.getConnectedValue(P);if(1===F.length)return F[0].value.getConnectedValue(P);let N=null;for(let q=F.length-1;q>=0;q--){const A=F[q];if(A.reference<=f){const F=A.value.getConnectedValue(P);if(N){const q=N.value.getConnectedValue(P),o=N.reference,i=A.reference,u=Math.max(0,Math.min(1,(f-i)/(o-i)));switch(this.output.type){case pP.Float:return(0,j.Lerp)(F,q,u);case pP.Vector2:return c.Vector2.Lerp(F,q,u);case pP.tP:return c.tP.Lerp(F,q,u);case pP.qc:return H.qc.Lerp(F,q,u)}}return F}N=A}return 0}}});(0,A.f)("BABYLON.ParticleConverterBlock",class extends mP{constructor(F){super(F),this.registerInput("color ",pP.qc,!0),this.registerInput("xyz ",pP.tP,!0),this.registerInput("xy ",pP.Vector2,!0),this.registerInput("zw ",pP.Vector2,!0),this.registerInput("x ",pP.Float,!0),this.registerInput("y ",pP.Float,!0),this.registerInput("z ",pP.Float,!0),this.registerInput("w ",pP.Float,!0),this.registerOutput("color",pP.qc),this.registerOutput("xyz",pP.tP),this.registerOutput("xy",pP.Vector2),this.registerOutput("zw",pP.Vector2),this.registerOutput("x",pP.Float),this.registerOutput("y",pP.Float),this.registerOutput("z",pP.Float),this.registerOutput("w",pP.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(F){return"color "===F?"colorIn":"xyz "===F?"xyzIn":"xy "===F?"xyIn":"zw "===F?"zwIn":"x "===F?"xIn":"y "===F?"yIn":"z "===F?"zIn":"w "===F?"wIn":F}_outputRename(F){switch(F){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return F}}_build(F){super._build(F);const P=this.xIn,f=this.yIn,N=this.zIn,q=this.wIn,A=this.xyIn,o=this.zwIn,j=this.xyzIn,i=this.colorIn,u=this.colorOut,T=this.xyzOut,Y=this.xyOut,t=this.zwOut,C=this.xOut,L=this.yOut,J=this.zOut,B=this.wOut,z=F=>{if(i.isConnected)return i.getConnectedValue(F);let c=0,u=0,T=0,Y=0;if(P.isConnected&&(c=P.getConnectedValue(F)),f.isConnected&&(u=f.getConnectedValue(F)),N.isConnected&&(T=N.getConnectedValue(F)),q.isConnected&&(Y=q.getConnectedValue(F)),A.isConnected){const P=A.getConnectedValue(F);P&&(c=P.x,u=P.y)}if(o.isConnected){const P=o.getConnectedValue(F);P&&(T=P.x,Y=P.y)}if(j.isConnected){const P=j.getConnectedValue(F);P&&(c=P.x,u=P.y,T=P.z)}return new H.qc(c,u,T,Y)};u._storedFunction=F=>z(F),T._storedFunction=F=>{const P=z(F);return new c.tP(P.r,P.g,P.b)},Y._storedFunction=F=>{const P=z(F);return new c.Vector2(P.r,P.g)},t._storedFunction=F=>{const P=z(F);return new c.Vector2(P.b,P.a)},C._storedFunction=F=>z(F).r,L._storedFunction=F=>z(F).g,J._storedFunction=F=>z(F).b,B._storedFunction=F=>z(F).a}}),function(F){F[F.Cos=0]="Cos",F[F.Sin=1]="Sin",F[F.Abs=2]="Abs",F[F.Exp=3]="Exp",F[F.Exp2=4]="Exp2",F[F.Round=5]="Round",F[F.Floor=6]="Floor",F[F.Ceiling=7]="Ceiling",F[F.Sqrt=8]="Sqrt",F[F.Log=9]="Log",F[F.Tan=10]="Tan",F[F.ArcTan=11]="ArcTan",F[F.ArcCos=12]="ArcCos",F[F.ArcSin=13]="ArcSin",F[F.Sign=14]="Sign",F[F.Negate=15]="Negate",F[F.OneMinus=16]="OneMinus",F[F.Reciprocal=17]="Reciprocal",F[F.ToDegrees=18]="ToDegrees",F[F.ToRadians=19]="ToRadians",F[F.Fract=20]="Fract"}(sP||(sP={}));class uf extends mP{constructor(F){super(F),this.operation=sP.Cos,this.registerInput("input",pP.AutoDetect),this.registerOutput("output",pP.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(pP.Float|pP.Int|pP.Vector2|pP.tP|pP.qc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(F){super._build(F);let P=null;switch(this.operation){case sP.Cos:P=F=>Math.cos(F);break;case sP.Sin:P=F=>Math.sin(F);break;case sP.Abs:P=F=>Math.abs(F);break;case sP.Exp:P=F=>Math.exp(F);break;case sP.Exp2:P=F=>Math.pow(2,F);break;case sP.Round:P=F=>Math.round(F);break;case sP.Floor:P=F=>Math.floor(F);break;case sP.Ceiling:P=F=>Math.ceil(F);break;case sP.Sqrt:P=F=>Math.sqrt(F);break;case sP.Log:P=F=>Math.log(F);break;case sP.Tan:P=F=>Math.tan(F);break;case sP.ArcTan:P=F=>Math.atan(F);break;case sP.ArcCos:P=F=>Math.acos(F);break;case sP.ArcSin:P=F=>Math.asin(F);break;case sP.Sign:P=F=>Math.sign(F);break;case sP.Negate:P=F=>-F;break;case sP.OneMinus:P=F=>1-F;break;case sP.Reciprocal:P=F=>1/F;break;case sP.ToRadians:P=F=>F*Math.PI/180;break;case sP.ToDegrees:P=F=>180*F/Math.PI;break;case sP.Fract:P=F=>F>=0?F-Math.floor(F):F-Math.ceil(F)}if(!P)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case pP.Int:case pP.Float:this.output._storedFunction=F=>{const f=this.input.getConnectedValue(F);return P(f)};break;case pP.Vector2:this.output._storedFunction=F=>{const f=this.input.getConnectedValue(F);return new c.Vector2(P(f.x),P(f.y))};break;case pP.tP:this.output._storedFunction=F=>{const f=this.input.getConnectedValue(F);return new c.tP(P(f.x),P(f.y),P(f.z))};break;case pP.qc:this.output._storedFunction=F=>{const f=this.input.getConnectedValue(F);return new H.qc(P(f.r),P(f.g),P(f.b),P(f.a))}}return this}serialize(){const F=super.serialize();return F.operation=this.operation,F}_deserialize(F){super._deserialize(F),this.operation=F.operation}}(0,k.e)([aP("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:sP.Cos},{label:"Sin",value:sP.Sin},{label:"Abs",value:sP.Abs},{label:"Exp",value:sP.Exp},{label:"Exp2",value:sP.Exp2},{label:"Round",value:sP.Round},{label:"Floor",value:sP.Floor},{label:"Ceiling",value:sP.Ceiling},{label:"Sqrt",value:sP.Sqrt},{label:"Log",value:sP.Log},{label:"Tan",value:sP.Tan},{label:"ArcTan",value:sP.ArcTan},{label:"ArcCos",value:sP.ArcCos},{label:"ArcSin",value:sP.ArcSin},{label:"Sign",value:sP.Sign},{label:"Negate",value:sP.Negate},{label:"OneMinus",value:sP.OneMinus},{label:"Reciprocal",value:sP.Reciprocal},{label:"ToDegrees",value:sP.ToDegrees},{label:"ToRadians",value:sP.ToRadians},{label:"Fract",value:sP.Fract}]})],uf.prototype,"operation",void 0),(0,A.f)("BABYLON.ParticleTrigonometryBlock",uf);var Tf,Yf=f(12978);class tf extends mP{constructor(F){super(F),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",pP.AutoDetect),this.registerOutput("output",pP.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(pP.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(pP.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(pP.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(pP.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(pP.System),this._inputs[0].excludedConnectionPointTypes.push(pP.Particle),this._inputs[0].excludedConnectionPointTypes.push(pP.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(F){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const P=F=>{const P=this.input.getConnectedValue(F);if(this.log.length>=this.stackSize)return P;if(null===P||void 0===P)return this.log.push(["null",""]),P;switch(this.input.type){case pP.Vector2:this.log.push([(0,Yf.h)(P,4),P.toString()]);break;case pP.tP:this.log.push([(0,Yf.i)(P,4),P.toString()]);break;case pP.qc:this.log.push([`{R: ${P.r.toFixed(4)} G: ${P.g.toFixed(4)} B: ${P.b.toFixed(4)} A: ${P.a.toFixed(4)}}`,P.toString()]);break;default:this.log.push([P.toString(),P.toString()])}return P};this.output.isConnected?this.output._storedFunction=P:this.output._storedValue=P(F)}serialize(){const F=super.serialize();return F.stackSize=this.stackSize,F}_deserialize(F){super._deserialize(F),this.stackSize=F.stackSize}}(0,k.e)([aP("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],tf.prototype,"stackSize",void 0),(0,A.f)("BABYLON.ParticleDebugBlock",tf);(0,A.f)("BABYLON.ParticleElbowBlock",class extends mP{constructor(F){super(F),this.registerInput("input",pP.AutoDetect),this.registerOutput("output",pP.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(F){super._build(F);const P=this._outputs[0],f=this._inputs[0];P._storedFunction=F=>f.getConnectedValue(F)}});(0,A.f)("BABYLON.ParticleTeleportInBlock",class extends mP{get endpoints(){return this._endpoints}constructor(F){super(F),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",pP.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(F){if(this.getClassName()===F)return!0;for(const P of this.endpoints)if(P.isAnAncestorOfType(F))return!0;return!1}isAnAncestorOf(F){for(const P of this.endpoints){if(P===F)return!0;if(P.isAnAncestorOf(F))return!0}return!1}attachToEndpoint(F){F.detach(),this._endpoints.push(F),F._entryPoint=this,F._outputs[0]._typeConnectionSource=this._inputs[0],F._tempEntryPointUniqueId=null,F.name="> "+this.name}detachFromEndpoint(F){const P=this._endpoints.indexOf(F);-1!==P&&(this._endpoints.splice(P,1),F._outputs[0]._typeConnectionSource=null,F._entryPoint=null)}_build(){for(const F of this._endpoints)F.output._storedFunction=F=>this.input.getConnectedValue(F)}});(0,A.f)("BABYLON.ParticleTeleportOutBlock",class extends mP{constructor(F){super(F),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",pP.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(F){this.entryPoint&&this.entryPoint.build(F)}clone(){const F=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(F),F}serialize(){var F;const P=super.serialize();return P.entryPoint=(null===(F=this.entryPoint)||void 0===F?void 0:F.uniqueId)??"",P}_deserialize(F){super._deserialize(F),this._tempEntryPointUniqueId=F.entryPoint}}),function(F){F[F.Equal=0]="Equal",F[F.NotEqual=1]="NotEqual",F[F.LessThan=2]="LessThan",F[F.GreaterThan=3]="GreaterThan",F[F.LessOrEqual=4]="LessOrEqual",F[F.GreaterOrEqual=5]="GreaterOrEqual",F[F.Xor=6]="Xor",F[F.Or=7]="Or",F[F.And=8]="And"}(Tf||(Tf={}));class Cf extends mP{constructor(F){super(F),this.test=Tf.Equal,this.epsilon=0,this.registerInput("left",pP.Float),this.registerInput("right",pP.Float,!0,0),this.registerInput("ifTrue",pP.AutoDetect,!0,1),this.registerInput("ifFalse",pP.AutoDetect,!0,0),this.registerOutput("output",pP.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=pP.Float,this._inputs[0].acceptedConnectionPointTypes.push(pP.Int),this._inputs[1].acceptedConnectionPointTypes.push(pP.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const F=F=>{const P=this.left.getConnectedValue(F),f=this.right.getConnectedValue(F);let c=!1;switch(this.test){case Tf.Equal:c=(0,j.WithinEpsilon)(P,f,this.epsilon);break;case Tf.NotEqual:c=!(0,j.WithinEpsilon)(P,f,this.epsilon);break;case Tf.LessThan:c=P<f+this.epsilon;break;case Tf.GreaterThan:c=P>f-this.epsilon;break;case Tf.LessOrEqual:c=P<=f+this.epsilon;break;case Tf.GreaterOrEqual:c=P>=f-this.epsilon;break;case Tf.Xor:c=!!P&&!f||!P&&!!f;break;case Tf.Or:c=!!P||!!f;break;case Tf.And:c=!!P&&!!f}return c};this.output._storedFunction=P=>F(P)?this.ifTrue.getConnectedValue(P):this.ifFalse.getConnectedValue(P)}serialize(){const F=super.serialize();return F.test=this.test,F.epsilon=this.epsilon,F}_deserialize(F){super._deserialize(F),this.test=F.test,void 0!==F.epsilon&&(this.epsilon=F.epsilon)}}(0,k.e)([aP("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Tf.Equal},{label:"NotEqual",value:Tf.NotEqual},{label:"LessThan",value:Tf.LessThan},{label:"GreaterThan",value:Tf.GreaterThan},{label:"LessOrEqual",value:Tf.LessOrEqual},{label:"GreaterOrEqual",value:Tf.GreaterOrEqual},{label:"Xor",value:Tf.Xor},{label:"Or",value:Tf.Or},{label:"And",value:Tf.And}]})],Cf.prototype,"test",void 0),(0,k.e)([aP("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Cf.prototype,"epsilon",void 0),(0,A.f)("BABYLON.ParticleConditionBlock",Cf);class Lf extends mP{constructor(F){super(F),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",pP.Particle),this.registerInput("condition",pP.Float,!0,0),this.registerInput("system",pP.System),this.registerOutput("output",pP.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(F){this._triggerCount=0;const P=this.input.getConnectedValue(F),f={process:f=>{if(F.particleContext=f,F.systemContext=P,0!==this.condition.getConnectedValue(F)&&(0===this.limit||this._triggerCount<this.limit)){const c=(new Date).getTime();if(this._previousOne&&c-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=c;const N=this.system.getConnectedValue(F);if(N){const c=gP(N,F.LP,f.position);c.Mf.addOnce((()=>{this._triggerCount--})),P.Mf.addOnce((()=>{c.dispose()}))}}},previousItem:null,nextItem:null};P._updateQueueStart?WF(f,P._updateQueueStart):P._updateQueueStart=f,this.output._storedValue=P}serialize(){const F=super.serialize();return F.limit=this.limit,F.delay=this.delay,F}_deserialize(F){super._deserialize(F),void 0!==F.limit&&(this.limit=F.limit),void 0!==F.delay&&(this.delay=F.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,k.e)([aP("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Lf.prototype,"limit",void 0),(0,k.e)([aP("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Lf.prototype,"delay",void 0),(0,A.f)("BABYLON.ParticleTriggerBlock",Lf);f(12986),f(12996),f(13006),f(13059)},13044:(F,P,f)=>{"use strict";var c=f(11548);const N="clipPlaneFragment",q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13010:(F,P,f)=>{"use strict";var c=f(11548);const N="clipPlaneFragmentDeclaration",q="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13069:(F,P,f)=>{"use strict";var c=f(11548);const N="clipPlaneVertex",q="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13062:(F,P,f)=>{"use strict";var c=f(11548);const N="clipPlaneVertexDeclaration",q="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13051:(F,P,f)=>{"use strict";var c=f(11548);const N="fogFragment",q="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13038:(F,P,f)=>{"use strict";var c=f(11548);const N="fogFragmentDeclaration",q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13076:(F,P,f)=>{"use strict";var c=f(11548);const N="fogVertex",q="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13065:(F,P,f)=>{"use strict";var c=f(11548);const N="fogVertexDeclaration",q="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13028:(F,P,f)=>{"use strict";var c=f(11548);const N="helperFunctions",q="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13015:(F,P,f)=>{"use strict";var c=f(11548);const N="imageProcessingDeclaration",q="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13034:(F,P,f)=>{"use strict";var c=f(11548);const N="imageProcessingFunctions",q="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13021:(F,P,f)=>{"use strict";var c=f(11548);const N="logDepthDeclaration",q="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13048:(F,P,f)=>{"use strict";var c=f(11548);const N="logDepthFragment",q="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13080:(F,P,f)=>{"use strict";var c=f(11548);const N="logDepthVertex",q="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";c.c.IncludesShadersStoreWGSL[N]||(c.c.IncludesShadersStoreWGSL[N]=q)},13006:(F,P,f)=>{"use strict";f.r(P),f.d(P,{particlesPixelShaderWGSL:()=>H});var c=f(11548);f(13010),f(13015),f(13021),f(13028),f(13034),f(13038),f(13044),f(13048),f(13051);const N="particlesPixelShader",q="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";c.c.ShadersStoreWGSL[N]||(c.c.ShadersStoreWGSL[N]=q);const H={name:N,shader:q}},13059:(F,P,f)=>{"use strict";f.r(P),f.d(P,{particlesVertexShaderWGSL:()=>H});var c=f(11548);f(13062),f(13065),f(13021),f(13069),f(13076),f(13080);const N="particlesVertexShader",q="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";c.c.ShadersStoreWGSL[N]||(c.c.ShadersStoreWGSL[N]=q);const H={name:N,shader:q}},12929:(F,P,f)=>{"use strict";var c=f(11548);const N="clipPlaneFragment",q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12993:(F,P,f)=>{"use strict";var c=f(11548);const N="clipPlaneFragmentDeclaration",q="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12944:(F,P,f)=>{"use strict";var c=f(11548);const N="clipPlaneVertex",q="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12998:(F,P,f)=>{"use strict";var c=f(11548);const N="clipPlaneVertexDeclaration",q="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12933:(F,P,f)=>{"use strict";var c=f(11548);const N="fogFragment",q="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12924:(F,P,f)=>{"use strict";var c=f(11548);const N="fogFragmentDeclaration",q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12950:(F,P,f)=>{"use strict";var c=f(11548);const N="fogVertex",q="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12935:(F,P,f)=>{"use strict";var c=f(11548);const N="fogVertexDeclaration",q="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12909:(F,P,f)=>{"use strict";var c=f(11548);const N="helperFunctions",q="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12899:(F,P,f)=>{"use strict";var c=f(11548);const N="imageProcessingDeclaration",q="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12915:(F,P,f)=>{"use strict";var c=f(11548);const N="imageProcessingFunctions",q="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12906:(F,P,f)=>{"use strict";var c=f(11548);const N="logDepthDeclaration",q="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12931:(F,P,f)=>{"use strict";var c=f(11548);const N="logDepthFragment",q="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12952:(F,P,f)=>{"use strict";var c=f(11548);const N="logDepthVertex",q="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";c.c.IncludesShadersStore[N]||(c.c.IncludesShadersStore[N]=q)},12986:(F,P,f)=>{"use strict";f.r(P),f.d(P,{particlesPixelShader:()=>H});var c=f(11548);f(12993),f(12899),f(12906),f(12909),f(12915),f(12924),f(12929),f(12931),f(12933);const N="particlesPixelShader",q="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";c.c.ShadersStore[N]||(c.c.ShadersStore[N]=q);const H={name:N,shader:q}},12996:(F,P,f)=>{"use strict";f.r(P),f.d(P,{particlesVertexShader:()=>H});var c=f(11548);f(12998),f(12935),f(12906),f(12944),f(12950),f(12952);const N="particlesVertexShader",q="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";c.c.ShadersStore[N]||(c.c.ShadersStore[N]=q);const H={name:N,shader:q}},13321:(F,P,f)=>{"use strict";f.r(P),f.d(P,{FlowGraphGLTFDataProvider:()=>q});var c=f(13287),N=f(13265);class q extends c.c{constructor(F){var P,f;super();const c=F.glTF,q=(null===(P=c.animations)||void 0===P?void 0:P.map((F=>F._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",N.c,q);const H=(null===(f=c.nodes)||void 0===f?void 0:f.map((F=>F._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",N.c,H)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13199:(F,P,f)=>{"use strict";f.d(P,{d:()=>L,e:()=>t,h:()=>Y,i:()=>C});var c=f(11639),N=f(12106),q=f(11690),H=f(13201);const A=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class o{constructor(F,P){this._gltf=F,this._infoTree=P}convert(F){let P,f=this._gltf,c=this._infoTree;if(!F.startsWith("/"))throw new Error("Path must start with a /");const N=F.split("/");if(N.shift(),N[N.length-1].includes(".length")){const F=N[N.length-1].split(".");N.pop(),N.push(...F)}let q=!1;for(const o of N){const N="length"===o;if(N&&!c.__array__)throw new Error(`Path ${F} is invalid`);if(c.__ignoreObjectTree__&&(q=!0),c.__array__&&!N)c=c.__array__;else if(c=c[o],!c)throw new Error(`Path ${F} is invalid`);if(!q)if(void 0===f){if(!A.find((P=>P.regex.test(F))))throw new Error(`Path ${F} is invalid`)}else if(!N){var H;f=null===(H=f)||void 0===H?void 0:H[o]}(c.__target__||N)&&(P=f)}return{object:P,info:c}}}function j(F,P,f,c){const N=i(F,P);return c?N[f][c]:N[f]}function i(F,P,f){var c,q;return null===(c=F._data)||void 0===c||null===(q=c[(null===f||void 0===f?void 0:f.fillMode)??N.b.MATERIAL_TriangleFillMode])||void 0===q?void 0:q.babylonMaterial}function u(F,P){return{offset:{componentsCount:2,type:"Vector2",get:(f,N,q)=>{const H=j(f,q,F,P);return new c.Vector2(null===H||void 0===H?void 0:H.uOffset,null===H||void 0===H?void 0:H.vOffset)},getTarget:i,set:(f,c,N,q)=>{const H=j(c,q,F,P);H.uOffset=f.x,H.vOffset=f.y},getPropertyName:[()=>`${F}${P?"."+P:""}.uOffset`,()=>`${F}${P?"."+P:""}.vOffset`]},rotation:{type:"number",get:(f,c,N)=>{var q;return null===(q=j(f,N,F,P))||void 0===q?void 0:q.wAng},getTarget:i,set:(f,c,N,q)=>j(c,q,F,P).wAng=f,getPropertyName:[()=>`${F}${P?"."+P:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(f,N,q)=>{const H=j(f,q,F,P);return new c.Vector2(null===H||void 0===H?void 0:H.uScale,null===H||void 0===H?void 0:H.vScale)},getTarget:i,set:(f,c,N,q)=>{const H=j(c,q,F,P);H.uScale=f.x,H.vScale=f.y},getPropertyName:[()=>`${F}${P?"."+P:""}.uScale`,()=>`${F}${P?"."+P:""}.vScale`]}}}const T={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:F=>{var P,f;return new c.Vector2((null===(P=F._babylonCamera)||void 0===P?void 0:P.orthoLeft)??0,(null===(f=F._babylonCamera)||void 0===f?void 0:f.orthoRight)??0)},set:(F,P)=>{P._babylonCamera&&(P._babylonCamera.orthoLeft=F.x,P._babylonCamera.orthoRight=F.y)},getTarget:F=>F,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:F=>{var P,f;return new c.Vector2((null===(P=F._babylonCamera)||void 0===P?void 0:P.orthoBottom)??0,(null===(f=F._babylonCamera)||void 0===f?void 0:f.orthoTop)??0)},set:(F,P)=>{P._babylonCamera&&(P._babylonCamera.orthoBottom=F.x,P._babylonCamera.orthoTop=F.y)},getTarget:F=>F,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:F=>{var P;return null===(P=F._babylonCamera)||void 0===P?void 0:P.maxZ},set:(F,P)=>{P._babylonCamera&&(P._babylonCamera.maxZ=F)},getTarget:F=>F,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:F=>{var P;return null===(P=F._babylonCamera)||void 0===P?void 0:P.Wf},set:(F,P)=>{P._babylonCamera&&(P._babylonCamera.Wf=F)},getTarget:F=>F,getPropertyName:[()=>"Wf"]}},perspective:{aspectRatio:{type:"number",get:F=>{var P;return null===(P=F._babylonCamera)||void 0===P?void 0:P.getEngine().getAspectRatio(F._babylonCamera)},getTarget:F=>F,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:F=>{var P;return null===(P=F._babylonCamera)||void 0===P?void 0:P.fov},set:(F,P)=>{P._babylonCamera&&(P._babylonCamera.fov=F)},getTarget:F=>F,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:F=>{var P;return null===(P=F._babylonCamera)||void 0===P?void 0:P.maxZ},set:(F,P)=>{P._babylonCamera&&(P._babylonCamera.maxZ=F)},getTarget:F=>F,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:F=>{var P;return null===(P=F._babylonCamera)||void 0===P?void 0:P.Wf},set:(F,P)=>{P._babylonCamera&&(P._babylonCamera.Wf=F)},getTarget:F=>F,getPropertyName:[()=>"Wf"]}}}},nodes:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"tP",get:F=>{var P;return null===(P=F._babylonTransformNode)||void 0===P?void 0:P.position},set:(F,P)=>{var f;return null===(f=P._babylonTransformNode)||void 0===f?void 0:f.position.q(F)},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:F=>{var P;return null===(P=F._babylonTransformNode)||void 0===P?void 0:P.rotationQuaternion},set:(F,P)=>{var f,c;return null===(f=P._babylonTransformNode)||void 0===f||null===(c=f.rotationQuaternion)||void 0===c?void 0:c.q(F)},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"tP",get:F=>{var P;return null===(P=F._babylonTransformNode)||void 0===P?void 0:P.cc},set:(F,P)=>{var f;return null===(f=P._babylonTransformNode)||void 0===f?void 0:f.cc.q(F)},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"cc"]},weights:{length:{type:"number",get:F=>F._numMorphTargets,getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(F,P)=>{var f,c;return void 0!==P?null===(f=F._primitiveBabylonMeshes)||void 0===f||null===(c=f[0].morphTargetManager)||void 0===c?void 0:c.getTarget(P).influence:void 0},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(F,P)=>[0],getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:F=>{var P,f,N;return c.Matrix.Compose(null===(P=F._babylonTransformNode)||void 0===P?void 0:P.cc,null===(f=F._babylonTransformNode)||void 0===f?void 0:f.rotationQuaternion,null===(N=F._babylonTransformNode)||void 0===N?void 0:N.position)},getTarget:F=>F._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:F=>{var P,f,N,q;const H=c.Matrix.Identity();let A=F.parent;for(;A&&A.parent;)A=A.parent;const o=(null===(P=F._babylonTransformNode)||void 0===P?void 0:P.position._isDirty)||(null===(f=F._babylonTransformNode)||void 0===f||null===(N=f.rotationQuaternion)||void 0===N?void 0:N._isDirty)||(null===(q=F._babylonTransformNode)||void 0===q?void 0:q.cc._isDirty);if(A){var j;const P=null===(j=A._babylonTransformNode)||void 0===j?void 0:j.gf(!0).invert();var i,u;if(P)null===(i=F._babylonTransformNode)||void 0===i||null===(u=i.gf(o))||void 0===u||u.multiplyToRef(P,H)}else F._babylonTransformNode&&H.q(F._babylonTransformNode.gf(o));return H},getTarget:F=>F._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:F=>{var P,f;return null===(P=F._babylonTransformNode)||void 0===P||null===(f=P.getChildren((F=>F instanceof H.b),!0)[0])||void 0===f?void 0:f.jc},getTarget:F=>{var P;return null===(P=F._babylonTransformNode)||void 0===P?void 0:P.getChildren((F=>F instanceof H.b),!0)[0]},set:(F,P)=>{if(P._babylonTransformNode){const f=P._babylonTransformNode.getChildren((F=>F instanceof H.b),!0)[0];f&&(f.jc=F)}}},color:{type:"BP",get:F=>{var P,f;return null===(P=F._babylonTransformNode)||void 0===P||null===(f=P.getChildren((F=>F instanceof H.b),!0)[0])||void 0===f?void 0:f.uc},getTarget:F=>{var P;return null===(P=F._babylonTransformNode)||void 0===P?void 0:P.getChildren((F=>F instanceof H.b),!0)[0]},set:(F,P)=>{if(P._babylonTransformNode){const f=P._babylonTransformNode.getChildren((F=>F instanceof H.b),!0)[0];f&&(f.uc=F)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"BP",get:(F,P,f)=>i(F,P,f).emissiveColor,set:(F,P,f,c)=>i(P,f,c).emissiveColor.q(F),getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:u("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(F,P,f)=>{var c;return null===(c=j(F,f,"bumpTexture"))||void 0===c?void 0:c.level},set:(F,P,f,c)=>{const N=j(P,c,"bumpTexture");N&&(N.level=F)},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:u("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(F,P,f)=>i(F,P,f).ambientTextureStrength,set:(F,P,f,c)=>{const N=i(P,f,c);N&&(N.ambientTextureStrength=F)},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:u("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"qc",get:(F,P,f)=>{const c=i(F,P,f);return q.qc.FromColor3(c.albedoColor,c.alpha)},set:(F,P,f,c)=>{const N=i(P,f,c);N.albedoColor.set(F.r,F.g,F.b),N.alpha=F.a},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:u("albedoTexture")}},metallicFactor:{type:"number",get:(F,P,f)=>i(F,P,f).metallic,set:(F,P,f,c)=>{const N=i(P,f,c);N&&(N.metallic=F)},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(F,P,f)=>i(F,P,f).roughness,set:(F,P,f,c)=>{const N=i(P,f,c);N&&(N.roughness=F)},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:u("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(F,P,f)=>i(F,P,f).anisotropy.jc,set:(F,P,f,c)=>{i(P,f,c).anisotropy.jc=F},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(F,P,f)=>i(F,P,f).anisotropy.angle,set:(F,P,f,c)=>{i(P,f,c).anisotropy.angle=F},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:u("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(F,P,f)=>i(F,P,f).clearCoat.jc,set:(F,P,f,c)=>{i(P,f,c).clearCoat.jc=F},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(F,P,f)=>i(F,P,f).clearCoat.roughness,set:(F,P,f,c)=>{i(P,f,c).clearCoat.roughness=F},getTarget:(F,P,f)=>i(F,P,f),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:u("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(F,P,f)=>{var c;return null===(c=i(F,P,f).clearCoat.bumpTexture)||void 0===c?void 0:c.level},getTarget:i,set:(F,P,f,c)=>i(P,f,c).clearCoat.bumpTexture.level=F},extensions:{KHR_texture_transform:u("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:u("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(F,P,f)=>i(F,P,f).subSurface.dispersion,getTarget:i,set:(F,P,f,c)=>i(P,f,c).subSurface.dispersion=F}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(F,P,f)=>i(F,P,f).emissiveIntensity,getTarget:i,set:(F,P,f,c)=>i(P,f,c).emissiveIntensity=F}},KHR_materials_ior:{ior:{type:"number",get:(F,P,f)=>i(F,P,f).indexOfRefraction,getTarget:i,set:(F,P,f,c)=>i(P,f,c).indexOfRefraction=F}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(F,P,f)=>i(F,P,f).iridescence.jc,getTarget:i,set:(F,P,f,c)=>i(P,f,c).iridescence.jc=F},iridescenceIor:{type:"number",get:(F,P,f)=>i(F,P,f).iridescence.indexOfRefraction,getTarget:i,set:(F,P,f,c)=>i(P,f,c).iridescence.indexOfRefraction=F},iridescenceTexture:{extensions:{KHR_texture_transform:u("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(F,P,f)=>i(F,P,f).iridescence.maximumThickness,getTarget:i,set:(F,P,f,c)=>i(P,f,c).iridescence.maximumThickness=F},iridescenceThicknessMinimum:{type:"number",get:(F,P,f)=>i(F,P,f).iridescence.minimumThickness,getTarget:i,set:(F,P,f,c)=>i(P,f,c).iridescence.minimumThickness=F},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:u("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"BP",get:(F,P,f)=>i(F,P,f).sheen.color,getTarget:i,set:(F,P,f,c)=>i(P,f,c).sheen.color.q(F)},sheenColorTexture:{extensions:{KHR_texture_transform:u("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(F,P,f)=>i(F,P,f).sheen.jc,getTarget:i,set:(F,P,f,c)=>i(P,f,c).sheen.jc=F},sheenRoughnessTexture:{extensions:{KHR_texture_transform:u("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(F,P,f)=>i(F,P,f).metallicF0Factor,getTarget:i,set:(F,P,f,c)=>i(P,f,c).metallicF0Factor=F,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"BP",get:(F,P,f)=>i(F,P,f).metallicReflectanceColor,getTarget:i,set:(F,P,f,c)=>i(P,f,c).metallicReflectanceColor.q(F),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:u("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:u("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(F,P,f)=>i(F,P,f).subSurface.refractionIntensity,getTarget:i,set:(F,P,f,c)=>i(P,f,c).subSurface.refractionIntensity=F,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:u("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(F,P,f)=>i(F,P,f).subSurface.translucencyIntensity,getTarget:i,set:(F,P,f,c)=>i(P,f,c).subSurface.translucencyIntensity=F},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:u("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"BP",get:(F,P,f)=>i(F,P,f).subSurface.translucencyColor,getTarget:i,set:(F,P,f,c)=>{var N;return F&&(null===(N=i(P,f,c).subSurface.translucencyColor)||void 0===N?void 0:N.q(F))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:u("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"BP",get:(F,P,f)=>i(F,P,f).subSurface.tintColor,getTarget:i,set:(F,P,f,c)=>i(P,f,c).subSurface.tintColor.q(F)},attenuationDistance:{type:"number",get:(F,P,f)=>i(F,P,f).subSurface.tintColorAtDistance,getTarget:i,set:(F,P,f,c)=>i(P,f,c).subSurface.tintColorAtDistance=F},thicknessFactor:{type:"number",get:(F,P,f)=>i(F,P,f).subSurface.maximumThickness,getTarget:i,set:(F,P,f,c)=>i(P,f,c).subSurface.maximumThickness=F},thicknessTexture:{extensions:{KHR_texture_transform:u("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonLight)),getPropertyName:[F=>"length"]},__array__:{__target__:!0,color:{type:"BP",get:F=>{var P;return null===(P=F._babylonLight)||void 0===P?void 0:P.uc},set:(F,P)=>{var f;return null===(f=P._babylonLight)||void 0===f?void 0:f.uc.q(F)},getTarget:F=>F._babylonLight,getPropertyName:[F=>"diffuse"]},jc:{type:"number",get:F=>{var P;return null===(P=F._babylonLight)||void 0===P?void 0:P.jc},set:(F,P)=>P._babylonLight?P._babylonLight.jc=F:void 0,getTarget:F=>F._babylonLight,getPropertyName:[F=>"intensity"]},range:{type:"number",get:F=>{var P;return null===(P=F._babylonLight)||void 0===P?void 0:P.range},set:(F,P)=>P._babylonLight?P._babylonLight.range=F:void 0,getTarget:F=>F._babylonLight,getPropertyName:[F=>"range"]},spot:{innerConeAngle:{type:"number",get:F=>{var P;return null===(P=F._babylonLight)||void 0===P?void 0:P.innerAngle},set:(F,P)=>P._babylonLight?P._babylonLight.innerAngle=F:void 0,getTarget:F=>F._babylonLight,getPropertyName:[F=>"innerConeAngle"]},outerConeAngle:{type:"number",get:F=>{var P;return null===(P=F._babylonLight)||void 0===P?void 0:P.angle},set:(F,P)=>P._babylonLight?P._babylonLight.angle=F:void 0,getTarget:F=>F._babylonLight,getPropertyName:[F=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonLight)),getPropertyName:[F=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonTexture)),getPropertyName:[F=>"length"]},__array__:{__target__:!0,jc:{type:"number",get:F=>{var P;return null===(P=F._babylonTexture)||void 0===P?void 0:P.level},set:(F,P)=>{P._babylonTexture&&(P._babylonTexture.level=F)},getTarget:F=>F._babylonTexture},rotation:{type:"Quaternion",get:F=>{var P;return F._babylonTexture&&c.Quaternion.FromRotationMatrix(null===(P=F._babylonTexture)||void 0===P?void 0:P.getReflectionTextureMatrix())},set:(F,P)=>{var f;P._babylonTexture&&(null!==(f=P._babylonTexture.OF())&&void 0!==f&&f.useRightHandedSystem||(F=c.Quaternion.Inverse(F)),c.Matrix.FromQuaternionToRef(F,P._babylonTexture.getReflectionTextureMatrix()))},getTarget:F=>F._babylonTexture}}}}},animations:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>{var P;return null===(P=F.primitives[0]._instanceData)||void 0===P?void 0:P.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function Y(F){return new o(F,T)}function t(F){const P=F.split("/").map((F=>F.replace(/{}/g,"__array__")));let f=T;for(const c of P)c&&(f=f[c]);if(f&&f.type&&f.get)return f}function C(F,P){const f=F.split("/").map((F=>F.replace(/{}/g,"__array__")));let c=T;for(const N of f)N&&(c=c[N]);c&&c.type&&c.get&&(c.interpolation=P)}function L(F,P){const f=F.split("/").map((F=>F.replace(/{}/g,"__array__")));let c=T;for(const N of f)if(N){if(!c[N]){if("?"===N){c.__ignoreObjectTree__=!0;continue}c[N]={},"__array__"===N&&(c[N].__target__=!0)}c=c[N]}Object.assign(c,P)}},13210:(F,P,f)=>{"use strict";f.r(P),f.d(P,{AnimationPropertyInfo:()=>j,TransformNodeAnimationPropertyInfo:()=>i,WeightAnimationPropertyInfo:()=>u,getQuaternion:()=>A,getVector3:()=>H,getWeights:()=>o});var c=f(12150),N=f(11639),q=f(13199);function H(F,P,f,c){return N.tP.zP(P,f).scaleInPlace(c)}function A(F,P,f,c){return N.Quaternion.zP(P,f).scaleInPlace(c)}function o(F,P,f,c){const N=new Array(F._numMorphTargets);for(let q=0;q<N.length;q++)N[q]=P[f++]*c;return N}class j{constructor(F,P,f,c){this.type=F,this.name=P,this.getValue=f,this.getStride=c}_buildAnimation(F,P,f){const N=new c.d(F,this.name,P,this.type);return N.setKeys(f),N}}class i extends j{buildAnimations(F,P,f,c){const N=[];return N.push({babylonAnimatable:F._babylonTransformNode,babylonAnimation:this._buildAnimation(P,f,c)}),N}}class u extends j{buildAnimations(F,P,f,N){const q=[];if(F._numMorphTargets)for(let H=0;H<F._numMorphTargets;H++){const A=new c.d(`${P}_${H}`,this.name,f,this.type);if(A.setKeys(N.map((F=>({frame:F.frame,inTangent:F.inTangent?F.inTangent[H]:void 0,value:F.value[H],outTangent:F.outTangent?F.outTangent[H]:void 0,interpolation:F.interpolation})))),F._primitiveBabylonMeshes)for(const P of F._primitiveBabylonMeshes)if(P.morphTargetManager){const F=P.morphTargetManager.getTarget(H),f=A.clone();F.animations.push(f),q.push({babylonAnimatable:F,babylonAnimation:f})}}return q}}(0,q.i)("/nodes/{}/translation",[new i(c.d.ANIMATIONTYPE_VECTOR3,"position",H,(()=>3))]),(0,q.i)("/nodes/{}/rotation",[new i(c.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",A,(()=>4))]),(0,q.i)("/nodes/{}/scale",[new i(c.d.ANIMATIONTYPE_VECTOR3,"cc",H,(()=>3))]),(0,q.i)("/nodes/{}/weights",[new u(c.d.ANIMATIONTYPE_FLOAT,"influence",o,(F=>F._numMorphTargets))])},13169:(F,P,f)=>{"use strict";class c{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((F,P)=>{this._resolve=F,this._reject=P}))}}var N=f(11639),q=f(11690),H=f(11462),A=f(12070),o=f(13171),j=f(13180),i=f(11464),u=f(12099),T=f(12150),Y=f(12153),t=f(11501),C=f(11474),L=f(11476);class J{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(F){this._useTextureToStoreBoneMatrices=F,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(F){this._animationPropertiesOverride=F}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(F,P,f){this.name=F,this.id=P,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=N.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new i.d,this.bones=[],this._scene=f||t.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const c=this._scene.getEngine().getCaps();this._canUseTextureForBones=c.textureFloat&&c.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((F=>!F.getParent()))}getTransformMatrices(F){if(this.needInitialSkinMatrix){if(!F)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return F._bonesTransformMatrices||this.prepare(!0),F._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(F){return this.needInitialSkinMatrix&&F._transformMatrixTexture?F._transformMatrixTexture:this._transformMatrixTexture}OF(){return this._scene}toString(F){let P=`Name: ${this.name}, nBones: ${this.bones.length}`;if(P+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,F){P+=", Ranges: {";let F=!0;for(const f in this._ranges)F&&(P+=", ",F=!1),P+=f;P+="}"}return P}getBoneIndexByName(F){for(let P=0,f=this.bones.length;P<f;P++)if(this.bones[P].name===F)return P;return-1}createAnimationRange(F,P,f){if(!this._ranges[F]){this._ranges[F]=new Y.c(F,P,f);for(let c=0,N=this.bones.length;c<N;c++)this.bones[c].animations[0]&&this.bones[c].animations[0].createRange(F,P,f)}}deleteAnimationRange(F){let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let f=0,c=this.bones.length;f<c;f++)this.bones[f].animations[0]&&this.bones[f].animations[0].deleteRange(F,P);this._ranges[F]=null}getAnimationRange(F){return this._ranges[F]||null}getAnimationRanges(){const F=[];let P;for(P in this._ranges)F.push(this._ranges[P]);return F}copyAnimationRange(F,P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[P]||!F.getAnimationRange(P))return!1;let c=!0;const N=this._getHighestAnimationFrame()+1,q={},H=F.bones;let A,o;for(o=0,A=H.length;o<A;o++)q[H[o].name]=H[o];this.bones.length!==H.length&&(C.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${H.length}`),c=!1);const j=f&&this.dimensionsAtRest&&F.dimensionsAtRest?this.dimensionsAtRest.divide(F.dimensionsAtRest):null;for(o=0,A=this.bones.length;o<A;o++){const F=this.bones[o].name,H=q[F];H?c=c&&this.bones[o].copyAnimationRange(H,P,N,f,j):(C.d.Warn("copyAnimationRange: not same rig, missing source bone "+F),c=!1)}const i=F.getAnimationRange(P);return i&&(this._ranges[P]=new Y.c(P,i.from+N,i.to+N)),c}returnToRest(){for(const F of this.bones)-1!==F._index&&F.returnToRest()}_getHighestAnimationFrame(){let F=0;for(let P=0,f=this.bones.length;P<f;P++)if(this.bones[P].animations[0]){const f=this.bones[P].animations[0].getHighestFrame();F<f&&(F=f)}return F}beginAnimation(F,P,f,c){const N=this.getAnimationRange(F);return N?this._scene.beginAnimation(this,N.from,N.to,P,f,c):null}static MakeAnimationAdditive(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2?arguments[2]:void 0;const c=F.getAnimationRange(f);if(!c)return null;const N=F._scene.getAllAnimatablesByTarget(F);let q=null;for(let A=0;A<N.length;A++){const F=N[A];if(F.fromFrame===(null===c||void 0===c?void 0:c.from)&&F.toFrame===(null===c||void 0===c?void 0:c.to)){q=F;break}}const H=F.getAnimatables();for(let A=0;A<H.length;A++){const F=H[A].animations;if(F)for(let c=0;c<F.length;c++)T.d.MakeAnimationAdditive(F[c],P,f)}return q&&(q.isAdditive=!0),F}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(F){this._meshesWithPoseMatrix.push(F)}_unregisterMeshWithPoseMatrix(F){const P=this._meshesWithPoseMatrix.indexOf(F);P>-1&&this._meshesWithPoseMatrix.splice(P,1)}_computeTransformMatrices(F,P){this.onBeforeComputeObservable.notifyObservers(this);for(let f=0;f<this.bones.length;f++){const c=this.bones[f];c._childUpdateId++;const N=c.getParent();if(N?c.getLocalMatrix().multiplyToRef(N.getFinalMatrix(),c.getFinalMatrix()):P?c.getLocalMatrix().multiplyToRef(P,c.getFinalMatrix()):c.getFinalMatrix().q(c.getLocalMatrix()),-1!==c._index){const P=null===c._index?f:c._index;c.getAbsoluteInverseBindMatrix().multiplyToArray(c.getFinalMatrix(),F,16*P)}}this._identity.copyToArray(F,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const F=this.OF().getRenderId();if(this._currentRenderId===F)return;this._currentRenderId=F}if(this._numBonesWithLinkedTransformNode>0)for(const F of this.bones)if(F._linkedTransformNode){const P=F._linkedTransformNode;F.position=P.position,P.rotationQuaternion?F.rotationQuaternion=P.rotationQuaternion:F.rotation=P.rotation,F.cc=P.cc}if(this.needInitialSkinMatrix)for(const F of this._meshesWithPoseMatrix){const P=F.getPoseMatrix();let f=this._isDirty;if(F._bonesTransformMatrices&&F._bonesTransformMatrices.length===16*(this.bones.length+1)||(F._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),f=!0),f){if(this._synchronizedWithMesh!==F){this._synchronizedWithMesh=F;for(const F of this.bones)if(!F.getParent()){F.getBindMatrix().multiplyToRef(P,N.TmpVectors.Matrix[1]),F._updateAbsoluteBindMatrices(N.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const P=4*(this.bones.length+1);F._transformMatrixTexture&&F._transformMatrixTexture.getSize().width===P||(F._transformMatrixTexture&&F._transformMatrixTexture.dispose(),F._transformMatrixTexture=u.e.CreateRGBATexture(F._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(F._bonesTransformMatrices,P),this.isUsingTextureForMatrices&&F._transformMatrixTexture&&F._transformMatrixTexture.update(F._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=u.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let F=0;F<this.bones.length;F++)this._animatables.push(this.bones[F])}return this._animatables}clone(F,P){const f=new J(F,P||F,this._scene);f.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let c=0;c<this.bones.length;c++){const F=this.bones[c];let P=null;const N=F.getParent();if(N){const F=this.bones.indexOf(N);P=f.bones[F]}const q=new j.c(F.name,f,P,F.getBindMatrix().clone(),F.getRestMatrix().clone());q._index=F._index,F._linkedTransformNode&&q.linkTransformNode(F._linkedTransformNode),L.c.DeepCopy(F.animations,q.animations)}if(this._ranges){f._ranges={};for(const F in this._ranges){const P=this._ranges[F];P&&(f._ranges[F]=P.clone())}}return this._isDirty=!0,f.prepare(!0),f}enableBlending(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const P of this.bones)for(const f of P.animations)f.enableBlending=!0,f.blendingSpeed=F}dispose(){if(this._meshesWithPoseMatrix.length=0,this.OF().stopAnimation(this),this.OF().removeSkeleton(this),this._parentContainer){const F=this._parentContainer.skeletons.indexOf(this);F>-1&&this._parentContainer.skeletons.splice(F,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const F={};F.name=this.name,F.id=this.id,this.dimensionsAtRest&&(F.dimensionsAtRest=this.dimensionsAtRest.pf()),F.bones=[],F.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let f=0;f<this.bones.length;f++){var P;const c=this.bones[f],N=c.getParent(),q={parentBoneIndex:N?this.bones.indexOf(N):-1,index:c.getIndex(),name:c.name,id:c.id,matrix:c.getBindMatrix().pf(),rest:c.getRestMatrix().pf(),linkedTransformNodeId:null===(P=c.getTransformNode())||void 0===P?void 0:P.id};F.bones.push(q),c.length&&(q.length=c.length),c.metadata&&(q.metadata=c.metadata),c.animations&&c.animations.length>0&&(q.animation=c.animations[0].serialize()),F.ranges=[];for(const P in this._ranges){const f=this._ranges[P];if(!f)continue;const c={};c.name=P,c.from=f.from,c.to=f.to,F.ranges.push(c)}}return F}static Parse(F,P){const f=new J(F.name,F.id,P);let c;for(F.dimensionsAtRest&&(f.dimensionsAtRest=N.tP.zP(F.dimensionsAtRest)),f.needInitialSkinMatrix=F.needInitialSkinMatrix,c=0;c<F.bones.length;c++){const P=F.bones[c],q=F.bones[c].index;let H=null;P.parentBoneIndex>-1&&(H=f.bones[P.parentBoneIndex]);const A=P.rest?N.Matrix.zP(P.rest):null,o=new j.c(P.name,f,H,N.Matrix.zP(P.matrix),A,null,q);void 0!==P.id&&null!==P.id&&(o.id=P.id),P.length&&(o.length=P.length),P.metadata&&(o.metadata=P.metadata),P.animation&&o.animations.push(T.d.Parse(P.animation)),void 0!==P.linkedTransformNodeId&&null!==P.linkedTransformNodeId&&(f._hasWaitingData=!0,o._waitingTransformNodeId=P.linkedTransformNodeId)}if(F.ranges)for(c=0;c<F.ranges.length;c++){const P=F.ranges[c];f.createAnimationRange(P.name,P.from,P.to)}return f}computeAbsoluteMatrices(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||F)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(F)}getPoseMatrix(){let F=null;return this._meshesWithPoseMatrix.length>0&&(F=this._meshesWithPoseMatrix[0].getPoseMatrix()),F}sortBones(){const F=[],P=new Array(this.bones.length);for(let f=0;f<this.bones.length;f++)this._sortBones(f,F,P);this.bones=F}_sortBones(F,P,f){if(f[F])return;f[F]=!0;const c=this.bones[F];if(!c)return;void 0===c._index&&(c._index=F);const N=c.getParent();N&&this._sortBones(this.bones.indexOf(N),P,f),P.push(c)}setCurrentPoseAsRest(){for(const F of this.bones)F.setCurrentPoseAsRest()}}var B=f(11937),z=f(12117),Z=f(11612),R=f(12028),y=f(11706),O=f(12075),d=f(12042),M=f(12063),V=f(12158),Q=f(11723),K=f(13135);class x{set areUpdatesFrozen(F){F?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Q.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,F||(F=t.b.LastCreatedScene),this._scene=F,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const F=this._scene.getEngine().getCaps();this._canUseTextureForTargets=F.canUseGLVertexID&&F.textureFloat&&F.maxVertexTextureImageUnits>0&&F.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return x.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?x.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(F){this._numMaxInfluencers!==F&&(this._numMaxInfluencers=F,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(F){this._useTextureToStoreTargets!==F&&(this._useTextureToStoreTargets=F,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var F;return x.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(F=this._scene)&&void 0!==F&&F.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(F){return this._activeTargets.data[F]}getTarget(F){return this._targets[F]}getTargetByName(F){for(const P of this._targets)if(P.name===F)return P;return null}addTarget(F){this._targets.push(F),this._targetInfluenceChangedObservers.push(F.onInfluenceChanged.add((F=>{this.areUpdatesFrozen&&F&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(F)}))),this._targetDataLayoutChangedObservers.push(F._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(F){const P=this._targets.indexOf(F);P>=0&&(this._targets.splice(P,1),F.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(P,1)[0]),F._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(P,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(F)}_bind(F){F.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),F.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),F.setTexture("morphTargets",this._targetStoreTexture),F.setInt("morphTargetCount",this.numInfluencers)}clone(){const F=new x(this._scene);for(const P of this._targets)F.addTarget(P.clone());return F.enablePositionMorphing=this.enablePositionMorphing,F.enableNormalMorphing=this.enableNormalMorphing,F.enableTangentMorphing=this.enableTangentMorphing,F.enableUVMorphing=this.enableUVMorphing,F.enableUV2Morphing=this.enableUV2Morphing,F.enableColorMorphing=this.enableColorMorphing,F}serialize(){const F={};F.id=this.uniqueId,F.targets=[];for(const P of this._targets)F.targets.push(P.serialize());return F}_syncActiveTargets(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const P=!!this._targetStoreTexture,f=this.isUsingTextureForTargets;(this._mustSynchronize||P!==f)&&(this._mustSynchronize=!1,this.synchronize());let c=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let N=-1;for(const q of this._targets)if(N++,0!==q.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=x.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(q),this._morphTargetTextureIndices[c]=N,this._tempInfluences[c++]=q.influence}this._morphTargetTextureIndices.length!==c&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,c)),this._influences&&this._influences.length===c||(this._influences=new Float32Array(c));for(let q=0;q<c;q++)this._influences[q]=this._tempInfluences[q];if(F&&this._scene)for(const q of this._scene.meshes)q.morphTargetManager===this&&(f?q._markSubMeshesAsAttributesDirty():q._syncGeometryWithMorphTargetManager())}synchronize(){var F;if(!this._scene||this.areUpdatesFrozen)return;const P=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(F=this._targetStoreTexture)||void 0===F||F.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>P.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const f of this._targets){this._supportsPositions=this._supportsPositions&&f.hasPositions,this._supportsNormals=this._supportsNormals&&f.hasNormals,this._supportsTangents=this._supportsTangents&&f.hasTangents,this._supportsUVs=this._supportsUVs&&f.hasUVs,this._supportsUV2s=this._supportsUV2s&&f.hasUV2s,this._supportsColors=this._supportsColors&&f.hasColors;const F=f.vertexCount;if(0===this._vertexCount)this._vertexCount=F;else if(this._vertexCount!==F)return void C.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${f.name}": ${F}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const F=P.getCaps().maxTextureSize;this._textureWidth>F&&(this._textureHeight=Math.ceil(this._textureWidth/F),this._textureWidth=F);const f=this._targets.length,c=new Float32Array(f*this._textureWidth*this._textureHeight*4);let N=0;for(let P=0;P<f;P++){const F=this._targets[P],f=F.getPositions(),q=F.getNormals(),H=F.getUVs(),A=F.getTangents(),o=F.getUV2s(),j=F.getColors();N=P*this._textureWidth*this._textureHeight*4;for(let P=0;P<this._vertexCount;P++)this._supportsPositions&&f&&(c[N]=f[3*P],c[N+1]=f[3*P+1],c[N+2]=f[3*P+2],N+=4),this._supportsNormals&&q&&(c[N]=q[3*P],c[N+1]=q[3*P+1],c[N+2]=q[3*P+2],N+=4),this._supportsUVs&&H&&(c[N]=H[2*P],c[N+1]=H[2*P+1],N+=4),this._supportsTangents&&A&&(c[N]=A[3*P],c[N+1]=A[3*P+1],c[N+2]=A[3*P+2],N+=4),this._supportsUV2s&&o&&(c[N]=o[2*P],c[N+1]=o[2*P+1],N+=4),this._supportsColors&&j&&(c[N]=j[4*P],c[N+1]=j[4*P+1],c[N+2]=j[4*P+2],c[N+3]=j[4*P+3],N+=4)}this._targetStoreTexture=K.b.CreateRGBATexture(c,this._textureWidth,this._textureHeight,f,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const f of this._scene.meshes)f.morphTargetManager===this&&f._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const F=this._parentContainer.morphTargetManagers.indexOf(this);F>-1&&this._parentContainer.morphTargetManagers.splice(F,1),this._parentContainer=null}for(const F of this._targets)this._scene.stopAnimation(F)}}static Parse(F,P){const f=new x(P);for(const c of F.targets)f.addTarget(V.c.Parse(c,P));return f}}x.EnableTextureStorage=!0,x.MaxActiveMorphTargetsInVertexAttributeMode=8,x.ConstantTargetCountForTextureMode=0;var k=f(13189),I=f(11510),E=f(11947);const r=new Map,n=r;function p(F,P,f){U(F)&&C.d.Warn(`Extension with the name '${F}' already exists`),r.set(F,{isGLTFExtension:P,factory:f})}function U(F){return r.delete(F)}var e=f(13199),D=f(12212),l=f(11713);class W{static Get(F,P,f){if(!P||void 0==f||!P[f])throw new Error(`${F}: Failed to find index (${f})`);return P[f]}static TryGet(F,P){return F&&void 0!=P&&F[P]?F[P]:null}static Assign(F){if(F)for(let P=0;P<F.length;P++)F[P].index=P}}function b(F){if(F.min&&F.max){const P=F.min,f=F.max,c=N.TmpVectors.tP[0].fc(P[0],P[1],P[2]),q=N.TmpVectors.tP[1].fc(f[0],f[1],f[2]);if(F.normalized&&5126!==F.componentType){let P=1;switch(F.componentType){case 5120:P=127;break;case 5121:P=255;break;case 5122:P=32767;break;case 5123:P=65535}const f=1/P;c.scaleInPlace(f),q.scaleInPlace(f)}return new E.b(c,q)}return null}class v{static RegisterExtension(F,P){p(F,!1,P)}static UnregisterExtension(F){return U(F)}get kf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(F){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=F}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((F=>F.dispose&&F.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(F,P,f,c,N,q){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=P,this._assetContainer=f,this._loadData(c);let q=null;if(F){const P={};if(this._gltf.nodes)for(const F of this._gltf.nodes)F.name&&(P[F.name]=F.index);q=(F instanceof Array?F:[F]).map((F=>{const f=P[F];if(void 0===f)throw new Error(`Failed to find node '${F}'`);return f}))}return await this._loadAsync(N,H,q,(()=>({meshes:this._getMeshes(),zT:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(F,P,f,c){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=F,this._loadData(P),await this._loadAsync(f,N,null,(()=>{}))}async _loadAsync(F,P,f,c){return await Promise.resolve().then((async()=>{this._rootUrl=F,this._uniqueRootUrl=!F.startsWith("file:")&&P?F:`${F}${Date.now()}/`,this._fileName=P,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const N=`${k.g[k.g.LOADING]} => ${k.g[k.g.READY]}`,q=`${k.g[k.g.LOADING]} => ${k.g[k.g.COMPLETE]}`;this._parent._startPerformanceCounter(N),this._parent._startPerformanceCounter(q),this._parent._setState(k.g.LOADING),this._extensionsOnLoading();const A=new Array;if(!this.parent.loadOnlyMaterials)if(f)A.push(this.loadSceneAsync("/nodes",{nodes:f,index:-1}));else if(void 0!=this._gltf.LP||this._gltf.scenes&&this._gltf.scenes[0]){const F=W.Get("/scene",this._gltf.scenes,this._gltf.LP||0);A.push(this.loadSceneAsync(`/scenes/${F.index}`,F))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let F=0;F<this._gltf.materials.length;++F){const P=this._gltf.materials[F],f="/materials/"+F,c=B.d.TriangleFillMode;A.push(this._loadMaterialAsync(f,P,null,c,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&A.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&A.push(this._compileShadowGeneratorsAsync());const o=Promise.all(A).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.To(!0);for(const F of this._babylonScene.materials){const P=F;void 0!==P.maxSimultaneousLights&&(P.maxSimultaneousLights=Math.max(P.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(k.g.READY),this._skipStartAnimationStep||this._startAnimations(),c()}));return await o.then((F=>(this._parent._endPerformanceCounter(N),H.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(q),this._parent._setState(k.g.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(F=>{this._parent.onErrorObservable.notifyObservers(F),this._parent.onErrorObservable.clear(),this.dispose()}))})),F)))})).catch((F=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(F),this._parent.onErrorObservable.clear(),this.dispose()),F}))}_loadData(F){if(this._gltf=F.json,this._setupData(),F.bin){const P=this._gltf.buffers;if(P&&P[0]&&!P[0].uri){const f=P[0];(f.byteLength<F.bin.byteLength-3||f.byteLength>F.bin.byteLength)&&C.d.Warn(`Binary buffer length (${f.byteLength}) from JSON does not match chunk length (${F.bin.byteLength})`),this._bin=F.bin}else C.d.Warn("Unexpected BIN chunk")}}_setupData(){if(W.Assign(this._gltf.accessors),W.Assign(this._gltf.animations),W.Assign(this._gltf.buffers),W.Assign(this._gltf.bufferViews),W.Assign(this._gltf.cameras),W.Assign(this._gltf.images),W.Assign(this._gltf.materials),W.Assign(this._gltf.meshes),W.Assign(this._gltf.nodes),W.Assign(this._gltf.samplers),W.Assign(this._gltf.scenes),W.Assign(this._gltf.skins),W.Assign(this._gltf.textures),this._gltf.nodes){const F={};for(const f of this._gltf.nodes)if(f.children)for(const P of f.children)F[P]=f.index;const P=this._createRootNode();for(const f of this._gltf.nodes){const c=F[f.index];f.parent=void 0===c?P:this._gltf.nodes[c]}}}async _loadExtensionsAsync(){const F=[];if(n.forEach(((P,f)=>{var c;!1===(null===(c=this.parent.extensionOptions[f])||void 0===c?void 0:c.enabled)?P.isGLTFExtension&&this.isExtensionUsed(f)&&C.d.Warn(`Extension ${f} is used but has been explicitly disabled.`):P.isGLTFExtension&&!this.isExtensionUsed(f)||F.push((async()=>{const F=await P.factory(this);return F.name!==f&&C.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${F.name} !== ${f}`),this._parent.onExtensionLoadedObservable.notifyObservers(F),F})())})),this._extensions.push(...await Promise.all(F)),this._extensions.sort(((F,P)=>(F.order||Number.MAX_VALUE)-(P.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const f of this._gltf.extensionsRequired){if(!this._extensions.some((F=>F.name===f&&F.enabled))){var P;if(!1===(null===(P=this.parent.extensionOptions[f])||void 0===P?void 0:P.enabled))throw new Error(`Required extension ${f} is disabled`);throw new Error(`Required extension ${f} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new M.d("__root__",this._babylonScene);this._rootBabylonMesh=F,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.To(!1);const P={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case k.f.AUTO:this._babylonScene.useRightHandedSystem||(P.rotation=[0,1,0,0],P.scale=[1,1,-1],v._LoadTransform(P,this._rootBabylonMesh));break;case k.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(F),P}loadSceneAsync(F,P){const f=this._extensionsLoadSceneAsync(F,P);if(f)return f;const c=new Array;if(this.logOpen(`${F} ${P.name||""}`),P.nodes)for(const N of P.nodes){const P=W.Get(`${F}/nodes/${N}`,this._gltf.nodes,N);c.push(this.loadNodeAsync(`/nodes/${P.index}`,P,(F=>{F.parent=this._rootBabylonMesh})))}for(const N of this._postSceneLoadActions)N();return c.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(c).then((()=>{}))}_forEachPrimitive(F,P){if(F._primitiveBabylonMeshes)for(const f of F._primitiveBabylonMeshes)P(f)}_getGeometries(){const F=[],P=this._gltf.nodes;if(P)for(const f of P)this._forEachPrimitive(f,(P=>{const f=P.Sf;f&&-1===F.indexOf(f)&&F.push(f)}));return F}_getMeshes(){const F=[];this._rootBabylonMesh instanceof d.b&&F.push(this._rootBabylonMesh);const P=this._gltf.nodes;if(P)for(const f of P)this._forEachPrimitive(f,(P=>{F.push(P)}));return F}_getTransformNodes(){const F=[],P=this._gltf.nodes;if(P)for(const f of P)f._babylonTransformNode&&"tc"===f._babylonTransformNode.getClassName()&&F.push(f._babylonTransformNode),f._babylonTransformNodeForSkin&&F.push(f._babylonTransformNodeForSkin);return F}_getSkeletons(){const F=[],P=this._gltf.skins;if(P)for(const f of P)f._data&&F.push(f._data.babylonSkeleton);return F}_getAnimationGroups(){const F=[],P=this._gltf.animations;if(P)for(const f of P)f._babylonAnimationGroup&&F.push(f._babylonAnimationGroup);return F}_startAnimations(){switch(this._parent.animationStartMode){case k.e.NONE:break;case k.e.FIRST:{const F=this._getAnimationGroups();0!==F.length&&F[0].start(!0);break}case k.e.ALL:{const F=this._getAnimationGroups();for(const P of F)P.start(!0);break}default:return void C.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const c=this._extensionsLoadNodeAsync(F,P,f);if(c)return c;if(P._babylonTransformNode)throw new Error(`${F}: Invalid recursive node hierarchy`);const N=new Array;this.logOpen(`${F} ${P.name||""}`);const q=c=>{if(v.AddPointerMetadata(c,F),v._LoadTransform(P,c),void 0!=P.camera){const f=W.Get(`${F}/camera`,this._gltf.cameras,P.camera);N.push(this.loadCameraAsync(`/cameras/${f.index}`,f,(F=>{F.parent=c,this._babylonScene.useRightHandedSystem||(c.cc.x=-1)})))}if(P.children)for(const f of P.children){const P=W.Get(`${F}/children/${f}`,this._gltf.nodes,f);N.push(this.loadNodeAsync(`/nodes/${P.index}`,P,(F=>{F.parent=c})))}f(c)},H=void 0!=P.mesh,A=this._parent.loadSkins&&void 0!=P.skin;if(!H||A){const F=P.name||`node${P.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new R.e(F,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==P.mesh?P._babylonTransformNode=f:P._babylonTransformNodeForSkin=f,q(f)}if(H)if(A){const f=W.Get(`${F}/mesh`,this._gltf.meshes,P.mesh);N.push(this._loadMeshAsync(`/meshes/${f.index}`,P,f,(f=>{const c=P._babylonTransformNodeForSkin;f.metadata=(0,D.c)(c.metadata,f.metadata||{});const q=W.Get(`${F}/skin`,this._gltf.skins,P.skin);N.push(this._loadSkinAsync(`/skins/${q.index}`,P,q,(F=>{this._forEachPrimitive(P,(P=>{P.skeleton=F})),this._postSceneLoadActions.push((()=>{if(void 0!=q.skeleton){const F=W.Get(`/skins/${q.index}/skeleton`,this._gltf.nodes,q.skeleton).parent;P.index===F.index?f.parent=c.parent:f.parent=F._babylonTransformNode}else f.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:c,skinnedNode:f})}))})))})))}else{const f=W.Get(`${F}/mesh`,this._gltf.meshes,P.mesh);N.push(this._loadMeshAsync(`/meshes/${f.index}`,P,f,q))}return this.logClose(),Promise.all(N).then((()=>(this._forEachPrimitive(P,(F=>{const P=F;!P.isAnInstance&&P.Sf&&P.Sf.useBoundingInfoFromGeometry?F.EF():F.refreshBoundingInfo(!0,!0)})),P._babylonTransformNode)))}_loadMeshAsync(F,P,f,c){const N=f.primitives;if(!N||!N.length)throw new Error(`${F}: Primitives are missing`);void 0==N[0].index&&W.Assign(N);const q=new Array;this.logOpen(`${F} ${f.name||""}`);const H=P.name||`node${P.index}`;if(1===N.length){const c=f.primitives[0];q.push(this._loadMeshPrimitiveAsync(`${F}/primitives/${c.index}`,H,P,f,c,(F=>{P._babylonTransformNode=F,P._primitiveBabylonMeshes=[F]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,P._babylonTransformNode=new R.e(H,this._babylonScene),P._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P._primitiveBabylonMeshes=[];for(const c of N)q.push(this._loadMeshPrimitiveAsync(`${F}/primitives/${c.index}`,`${H}_primitive${c.index}`,P,f,c,(F=>{F.parent=P._babylonTransformNode,P._primitiveBabylonMeshes.push(F)})))}return c(P._babylonTransformNode),this.logClose(),Promise.all(q).then((()=>P._babylonTransformNode))}_loadMeshPrimitiveAsync(F,P,f,c,N,q){const H=this._extensionsLoadMeshPrimitiveAsync(F,P,f,c,N,q);if(H)return H;this.logOpen(`${F}`);const A=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==f.skin&&!c.primitives[0].targets;let o,j;if(A&&N._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,o=N._instanceData.babylonSourceMesh.createInstance(P),o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j=N._instanceData.promise;else{const q=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new M.d(P,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.sideOrientation=this._babylonScene.useRightHandedSystem?B.d.CounterClockWiseSideOrientation:B.d.ClockWiseSideOrientation,this._createMorphTargets(F,f,c,N,H),q.push(this._loadVertexDataAsync(F,N,H).then((async P=>await this._loadMorphTargetsAsync(F,N,H,P).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,P.kF(H),P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const i=v._GetDrawMode(F,N.mode);if(void 0==N.material){let F=this._defaultBabylonMaterialData[i];F||(F=this._createDefaultMaterial("__GLTFLoader._default",i),this._parent.onMaterialLoadedObservable.notifyObservers(F),this._defaultBabylonMaterialData[i]=F),H.material=F}else if(!this.parent.skipMaterials){const P=W.Get(`${F}/material`,this._gltf.materials,N.material);q.push(this._loadMaterialAsync(`/materials/${P.index}`,P,H,i,(F=>{H.material=F})))}j=Promise.all(q),A&&(N._instanceData={babylonSourceMesh:H,promise:j}),o=H}return v.AddPointerMetadata(o,F),this._parent.onMeshLoadedObservable.notifyObservers(o),q(o),this.logClose(),j.then((()=>o))}_loadVertexDataAsync(F,P,f){const c=this._extensionsLoadVertexDataAsync(F,P,f);if(c)return c;const N=P.attributes;if(!N)throw new Error(`${F}: Attributes are missing`);const q=new Array,H=new O.e(f.name,this._babylonScene);if(void 0==P.indices)f.isUnIndexed=!0;else{const f=W.Get(`${F}/indices`,this._gltf.accessors,P.indices);q.push(this._loadIndicesAccessorAsync(`/accessors/${f.index}`,f).then((F=>{H.setIndices(F)})))}const A=(P,c,A)=>{if(void 0==N[P])return;f._delayInfo=f._delayInfo||[],-1===f._delayInfo.indexOf(c)&&f._delayInfo.push(c);const o=W.Get(`${F}/attributes/${P}`,this._gltf.accessors,N[P]);q.push(this._loadVertexAccessorAsync(`/accessors/${o.index}`,o,c).then((F=>{if(F.getKind()===y.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!f.skeleton){const F=b(o);F&&(H._boundingInfo=F,H.useBoundingInfoFromGeometry=!0)}H.setVerticesBuffer(F,o.count)}))),c==y.f.MatricesIndicesExtraKind&&(f.numBoneInfluencers=8),A&&A(o)};return A("POSITION",y.f.PositionKind),A("NORMAL",y.f.NormalKind),A("TANGENT",y.f.TangentKind),A("TEXCOORD_0",y.f.UVKind),A("TEXCOORD_1",y.f.UV2Kind),A("TEXCOORD_2",y.f.UV3Kind),A("TEXCOORD_3",y.f.UV4Kind),A("TEXCOORD_4",y.f.UV5Kind),A("TEXCOORD_5",y.f.UV6Kind),A("JOINTS_0",y.f.MatricesIndicesKind),A("WEIGHTS_0",y.f.MatricesWeightsKind),A("JOINTS_1",y.f.MatricesIndicesExtraKind),A("WEIGHTS_1",y.f.MatricesWeightsExtraKind),A("COLOR_0",y.f.ColorKind,(F=>{"VEC4"===F.type&&(f.hasVertexAlpha=!0)})),Promise.all(q).then((()=>H))}_createMorphTargets(F,P,f,c,N){if(!c.targets||!this._parent.loadMorphTargets)return;if(void 0==P._numMorphTargets)P._numMorphTargets=c.targets.length;else if(c.targets.length!==P._numMorphTargets)throw new Error(`${F}: Primitives do not have the same number of targets`);const q=f.extras?f.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,N.morphTargetManager=new x(this._babylonScene),N.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.morphTargetManager.areUpdatesFrozen=!0;for(let H=0;H<c.targets.length;H++){const F=P.weights?P.weights[H]:f.weights?f.weights[H]:0,c=q?q[H]:`morphTarget${H}`;N.morphTargetManager.addTarget(new V.c(c,F,N.OF()))}}_loadMorphTargetsAsync(F,P,f,c){if(!P.targets||!this._parent.loadMorphTargets)return Promise.resolve();const N=new Array,q=f.morphTargetManager;for(let H=0;H<q.numTargets;H++){const f=q.getTarget(H);N.push(this._loadMorphTargetVertexDataAsync(`${F}/targets/${H}`,c,P.targets[H],f))}return Promise.all(N).then((()=>{q.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(F,P,f,c){const N=new Array,q=(c,q,H)=>{if(void 0==f[c])return;const A=P.getVertexBuffer(q);if(!A)return;const o=W.Get(`${F}/${c}`,this._gltf.accessors,f[c]);N.push(this._loadFloatAccessorAsync(`/accessors/${o.index}`,o).then((F=>{H(A,F)})))};return q("POSITION",y.f.PositionKind,((F,P)=>{const f=new Float32Array(P.length);F.forEach(P.length,((F,c)=>{f[c]=P[c]+F})),c.setPositions(f)})),q("NORMAL",y.f.NormalKind,((F,P)=>{const f=new Float32Array(P.length);F.forEach(f.length,((F,c)=>{f[c]=P[c]+F})),c.setNormals(f)})),q("TANGENT",y.f.TangentKind,((F,P)=>{const f=new Float32Array(P.length/3*4);let N=0;F.forEach(P.length/3*4,((F,c)=>{(c+1)%4!==0&&(f[N]=P[N]+F,N++)})),c.setTangents(f)})),q("TEXCOORD_0",y.f.UVKind,((F,P)=>{const f=new Float32Array(P.length);F.forEach(P.length,((F,c)=>{f[c]=P[c]+F})),c.setUVs(f)})),q("TEXCOORD_1",y.f.UV2Kind,((F,P)=>{const f=new Float32Array(P.length);F.forEach(P.length,((F,c)=>{f[c]=P[c]+F})),c.setUV2s(f)})),q("COLOR_0",y.f.ColorKind,((P,f)=>{let N=null;const q=P.getSize();if(3===q){N=new Float32Array(f.length/3*4),P.forEach(f.length,((F,P)=>{const c=Math.floor(P/3),q=P%3;N[4*c+q]=f[3*c+q]+F}));for(let F=0;F<f.length/3;++F)N[4*F+3]=1}else{if(4!==q)throw new Error(`${F}: Invalid number of components (${q}) for COLOR_0 attribute`);N=new Float32Array(f.length),P.forEach(f.length,((F,P)=>{N[P]=f[P]+F}))}c.setColors(N)})),await Promise.all(N).then((()=>{}))}static _LoadTransform(F,P){if(void 0!=F.skin)return;let f=N.tP.Zero(),c=N.Quaternion.Identity(),q=N.tP.One();if(F.matrix){N.Matrix.zP(F.matrix).decompose(q,c,f)}else F.translation&&(f=N.tP.zP(F.translation)),F.rotation&&(c=N.Quaternion.zP(F.rotation)),F.scale&&(q=N.tP.zP(F.scale));P.position=f,P.rotationQuaternion=c,P.cc=q}_loadSkinAsync(F,P,f,c){if(!this._parent.loadSkins)return Promise.resolve();const N=this._extensionsLoadSkinAsync(F,P,f);if(N)return N;if(f._data)return c(f._data.babylonSkeleton),f._data.promise;const q=`skeleton${f.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new J(f.name||q,q,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(F,f,H);const A=this._loadSkinInverseBindMatricesDataAsync(F,f).then((F=>{this._updateBoneMatrices(H,F)}));return f._data={babylonSkeleton:H,promise:A},c(H),A}_loadBones(F,P,f){if(void 0==P.skeleton||this._parent.alwaysComputeSkeletonRootNode){const f=this._findSkeletonRootNode(`${F}/joints`,P.joints);if(f)if(void 0===P.skeleton)P.skeleton=f.index;else{const c=(F,P)=>{for(;P.parent;P=P.parent)if(P.parent===F)return!0;return!1},N=W.Get(`${F}/skeleton`,this._gltf.nodes,P.skeleton);N===f||c(N,f)||(C.d.Warn(`${F}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),P.skeleton=f.index)}else C.d.Warn(`${F}: Failed to find common root`)}const c={};for(const N of P.joints){const q=W.Get(`${F}/joints/${N}`,this._gltf.nodes,N);this._loadBone(q,P,f,c)}}_findSkeletonRootNode(F,P){if(0===P.length)return null;const f={};for(const N of P){const P=[];let c=W.Get(`${F}/${N}`,this._gltf.nodes,N);for(;-1!==c.index;)P.unshift(c),c=c.parent;f[N]=P}let c=null;for(let N=0;;++N){let F=f[P[0]];if(N>=F.length)return c;const q=F[N];for(let H=1;H<P.length;++H)if(F=f[P[H]],N>=F.length||q!==F[N])return c;c=q}}_loadBone(F,P,f,c){F._isJoint=!0;let N=c[F.index];if(N)return N;let q=null;F.index!==P.skeleton&&(F.parent&&-1!==F.parent.index?q=this._loadBone(F.parent,P,f,c):void 0!==P.skeleton&&C.d.Warn(`/skins/${P.index}/skeleton: Skeleton node is not a common root`));const H=P.joints.indexOf(F.index);return N=new j.c(F.name||`joint${F.index}`,f,q,this._getNodeMatrix(F),null,null,H),c[F.index]=N,this._postSceneLoadActions.push((()=>{N.linkTransformNode(F._babylonTransformNode)})),N}_loadSkinInverseBindMatricesDataAsync(F,P){if(void 0==P.inverseBindMatrices)return Promise.resolve(null);const f=W.Get(`${F}/inverseBindMatrices`,this._gltf.accessors,P.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${f.index}`,f)}_updateBoneMatrices(F,P){for(const f of F.bones){const F=N.Matrix.Identity(),c=f._index;P&&-1!==c&&(N.Matrix.FromArrayToRef(P,16*c,F),F.invertToRef(F));const q=f.getParent();q&&F.multiplyToRef(q.getAbsoluteInverseBindMatrix(),F),f.sf(F,!1,!1),f._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(F){return F.matrix?N.Matrix.zP(F.matrix):N.Matrix.Compose(F.scale?N.tP.zP(F.scale):N.tP.One(),F.rotation?N.Quaternion.zP(F.rotation):N.Quaternion.Identity(),F.translation?N.tP.zP(F.translation):N.tP.Zero())}loadCameraAsync(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const c=this._extensionsLoadCameraAsync(F,P,f);if(c)return c;const q=new Array;this.logOpen(`${F} ${P.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new o.d(P.name||`camera${P.index}`,N.tP.Zero(),this._babylonScene,!1);switch(H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P._babylonCamera=H,H.setTarget(new N.tP(0,0,-1)),P.type){case"perspective":{const f=P.perspective;if(!f)throw new Error(`${F}: Camera perspective properties are missing`);H.fov=f.yfov,H.Wf=f.znear,H.maxZ=f.zfar||0;break}case"orthographic":if(!P.orthographic)throw new Error(`${F}: Camera orthographic properties are missing`);H.mode=A.e.ORTHOGRAPHIC_CAMERA,H.orthoLeft=-P.orthographic.xmag,H.orthoRight=P.orthographic.xmag,H.orthoBottom=-P.orthographic.ymag,H.orthoTop=P.orthographic.ymag,H.Wf=P.orthographic.znear,H.maxZ=P.orthographic.zfar;break;default:throw new Error(`${F}: Invalid camera type (${P.type})`)}return v.AddPointerMetadata(H,F),this._parent.onCameraLoadedObservable.notifyObservers(H),f(H),this.logClose(),Promise.all(q).then((()=>H))}_loadAnimationsAsync(){const F=this._gltf.animations;if(!F)return Promise.resolve();const P=new Array;for(let f=0;f<F.length;f++){const c=F[f];P.push(this.loadAnimationAsync(`/animations/${c.index}`,c).then((F=>{0===F.targetedAnimations.length&&F.dispose()})))}return Promise.all(P).then((()=>{}))}loadAnimationAsync(F,P){const c=this._extensionsLoadAnimationAsync(F,P);return c||f.e(78).then(f.bind(f,14792)).then((f=>{let{AnimationGroup:c}=f;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new c(P.name||`animation${P.index}`,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P._babylonAnimationGroup=N;const q=new Array;W.Assign(P.channels),W.Assign(P.samplers);for(const H of P.channels)q.push(this._loadAnimationChannelAsync(`${F}/channels/${H.index}`,F,P,H,((F,P)=>{F.animations=F.animations||[],F.animations.push(P),N.addTargetedAnimation(P,F)})));return Promise.all(q).then((()=>(N.normalize(0),N)))}))}async _loadAnimationChannelAsync(F,P,c,N,q){const H=this._extensionsLoadAnimationChannelAsync(F,P,c,N,q);if(H)return await H;if(void 0==N.target.node)return await Promise.resolve();const A=W.Get(`${F}/target/node`,this._gltf.nodes,N.target.node),o=N.target.path,j="weights"===o;if(j&&!A._numMorphTargets||!j&&!A._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!j&&!A._isJoint)return await Promise.resolve();let i;switch(await Promise.resolve().then(f.bind(f,13210)),o){case"translation":var u;i=null===(u=(0,e.e)("/nodes/{}/translation"))||void 0===u?void 0:u.interpolation;break;case"rotation":var T;i=null===(T=(0,e.e)("/nodes/{}/rotation"))||void 0===T?void 0:T.interpolation;break;case"scale":var Y;i=null===(Y=(0,e.e)("/nodes/{}/scale"))||void 0===Y?void 0:Y.interpolation;break;case"weights":var t;i=null===(t=(0,e.e)("/nodes/{}/weights"))||void 0===t?void 0:t.interpolation;break;default:throw new Error(`${F}/target/path: Invalid value (${N.target.path})`)}if(!i)throw new Error(`${F}/target/path: Could not find interpolation properties for target path (${N.target.path})`);const C={object:A,info:i};return await this._loadAnimationChannelFromTargetInfoAsync(F,P,c,N,C,q)}_loadAnimationChannelFromTargetInfoAsync(F,P,f,c,N,q){const H=this.parent.targetFps,A=1/H,o=W.Get(`${F}/sampler`,f.samplers,c.sampler);return this._loadAnimationSamplerAsync(`${P}/samplers/${c.sampler}`,o).then((F=>{let P=0;const o=N.object,j=N.info;for(const N of j){const j=N.getStride(o),i=F.input,u=F.output,T=new Array(i.length);let Y=0;switch(F.interpolation){case"STEP":for(let F=0;F<i.length;F++){const P=N.getValue(o,u,Y,1);Y+=j,T[F]={frame:i[F]*H,value:P,interpolation:1}}break;case"CUBICSPLINE":for(let F=0;F<i.length;F++){const P=N.getValue(o,u,Y,A);Y+=j;const f=N.getValue(o,u,Y,1);Y+=j;const c=N.getValue(o,u,Y,A);Y+=j,T[F]={frame:i[F]*H,inTangent:P,value:f,outTangent:c}}break;case"LINEAR":for(let F=0;F<i.length;F++){const P=N.getValue(o,u,Y,1);Y+=j,T[F]={frame:i[F]*H,value:P}}}if(Y>0){const F=`${f.name||`animation${f.index}`}_channel${c.index}_${P}`,A=N.buildAnimations(o,F,H,T);for(const f of A)P++,q(f.babylonAnimatable,f.babylonAnimation)}}}))}_loadAnimationSamplerAsync(F,P){if(P._data)return P._data;const f=P.interpolation||"LINEAR";switch(f){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${F}/interpolation: Invalid value (${P.interpolation})`)}const c=W.Get(`${F}/input`,this._gltf.accessors,P.input),N=W.Get(`${F}/output`,this._gltf.accessors,P.output);return P._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${c.index}`,c),this._loadFloatAccessorAsync(`/accessors/${N.index}`,N)]).then((F=>{let[P,c]=F;return{input:P,interpolation:f,output:c}})),P._data}loadBufferAsync(F,P,f,c){const N=this._extensionsLoadBufferAsync(F,P,f,c);if(N)return N;if(!P._data)if(P.uri)P._data=this.loadUriAsync(`${F}/uri`,P,P.uri);else{if(!this._bin)throw new Error(`${F}: Uri is missing or the binary glTF is missing its binary chunk`);P._data=this._bin.readAsync(0,P.byteLength)}return P._data.then((P=>{try{return new Uint8Array(P.buffer,P.byteOffset+f,c)}catch(N){throw new Error(`${F}: ${N.message}`)}}))}loadBufferViewAsync(F,P){const f=this._extensionsLoadBufferViewAsync(F,P);if(f)return f;if(P._data)return P._data;const c=W.Get(`${F}/buffer`,this._gltf.buffers,P.buffer);return P._data=this.loadBufferAsync(`/buffers/${c.index}`,c,P.byteOffset||0,P.byteLength),P._data}_loadAccessorAsync(F,P,f){if(P._data)return P._data;const c=v._GetNumComponents(F,P.type),N=c*y.f.GetTypeByteLength(P.componentType),q=c*P.count;if(void 0==P.bufferView)P._data=Promise.resolve(new f(q));else{const H=W.Get(`${F}/bufferView`,this._gltf.bufferViews,P.bufferView);P._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((A=>{if(5126!==P.componentType||P.normalized||H.byteStride&&H.byteStride!==N){const F=new f(q);return y.f.ForEach(A,P.byteOffset||0,H.byteStride||N,c,P.componentType,F.length,P.normalized||!1,((P,f)=>{F[f]=P})),F}return v._GetTypedArray(F,P.componentType,A,P.byteOffset,q)}))}if(P.sparse){const q=P.sparse;P._data=P._data.then((H=>{const A=H,o=W.Get(`${F}/sparse/indices/bufferView`,this._gltf.bufferViews,q.indices.bufferView),j=W.Get(`${F}/sparse/values/bufferView`,this._gltf.bufferViews,q.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${o.index}`,o),this.loadBufferViewAsync(`/bufferViews/${j.index}`,j)]).then((H=>{let[o,j]=H;const i=v._GetTypedArray(`${F}/sparse/indices`,q.indices.componentType,o,q.indices.byteOffset,q.count),u=c*q.count;let T;if(5126!==P.componentType||P.normalized){const H=v._GetTypedArray(`${F}/sparse/values`,P.componentType,j,q.values.byteOffset,u);T=new f(u),y.f.ForEach(H,0,N,c,P.componentType,T.length,P.normalized||!1,((F,P)=>{T[P]=F}))}else T=v._GetTypedArray(`${F}/sparse/values`,P.componentType,j,q.values.byteOffset,u);let Y=0;for(let F=0;F<i.length;F++){let P=i[F]*c;for(let F=0;F<c;F++)A[P++]=T[Y++]}return A}))}))}return P._data}_loadFloatAccessorAsync(F,P){return this._loadAccessorAsync(F,P,Float32Array)}_loadIndicesAccessorAsync(F,P){if("SCALAR"!==P.type)throw new Error(`${F}/type: Invalid value ${P.type}`);if(5121!==P.componentType&&5123!==P.componentType&&5125!==P.componentType)throw new Error(`${F}/componentType: Invalid value ${P.componentType}`);if(P._data)return P._data;if(P.sparse){const f=v._GetTypedArrayConstructor(`${F}/componentType`,P.componentType);P._data=this._loadAccessorAsync(F,P,f)}else{const f=W.Get(`${F}/bufferView`,this._gltf.bufferViews,P.bufferView);P._data=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((f=>v._GetTypedArray(F,P.componentType,f,P.byteOffset,P.count)))}return P._data}_loadVertexBufferViewAsync(F){if(F._babylonBuffer)return F._babylonBuffer;const P=this._babylonScene.getEngine();return F._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((F=>new y.e(P,F,!1))),F._babylonBuffer}_loadVertexAccessorAsync(F,P,f){var c;if(null!==(c=P._babylonVertexBuffer)&&void 0!==c&&c[f])return P._babylonVertexBuffer[f];P._babylonVertexBuffer||(P._babylonVertexBuffer={});const N=this._babylonScene.getEngine();if(P.sparse||void 0==P.bufferView)P._babylonVertexBuffer[f]=this._loadFloatAccessorAsync(F,P).then((F=>new y.f(N,F,f,!1)));else{const c=W.Get(`${F}/bufferView`,this._gltf.bufferViews,P.bufferView);P._babylonVertexBuffer[f]=this._loadVertexBufferViewAsync(c).then((q=>{const H=v._GetNumComponents(F,P.type);return new y.f(N,q,f,!1,void 0,c.byteStride,void 0,P.byteOffset,H,P.componentType,P.normalized,!0,void 0,!0)}))}return P._babylonVertexBuffer[f]}_loadMaterialMetallicRoughnessPropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;return P&&(P.baseColorFactor?(f.albedoColor=q.BP.zP(P.baseColorFactor),f.alpha=P.baseColorFactor[3]):f.albedoColor=q.BP.White(),f.metallic=void 0==P.metallicFactor?1:P.metallicFactor,f.roughness=void 0==P.roughnessFactor?1:P.roughnessFactor,P.baseColorTexture&&c.push(this.loadTextureInfoAsync(`${F}/baseColorTexture`,P.baseColorTexture,(F=>{F.name=`${f.name} (Base Color)`,f.albedoTexture=F}))),P.metallicRoughnessTexture&&(P.metallicRoughnessTexture.nonColorData=!0,c.push(this.loadTextureInfoAsync(`${F}/metallicRoughnessTexture`,P.metallicRoughnessTexture,(F=>{F.name=`${f.name} (Metallic Roughness)`,f.metallicTexture=F}))),f.useMetallnessFromMetallicTextureBlue=!0,f.useRoughnessFromMetallicTextureGreen=!0,f.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(c).then((()=>{}))}_loadMaterialAsync(F,P,f,c){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const q=this._extensionsLoadMaterialAsync(F,P,f,c,N);if(q)return q;P._data=P._data||{};let H=P._data[c];if(!H){this.logOpen(`${F} ${P.name||""}`);const f=this.createMaterial(F,P,c);H={babylonMaterial:f,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(F,P,f)},P._data[c]=H,v.AddPointerMetadata(f,F),this._parent.onMaterialLoadedObservable.notifyObservers(f),this.logClose()}return f&&(H.babylonMeshes.push(f),f.Mf.addOnce((()=>{const F=H.babylonMeshes.indexOf(f);-1!==F&&H.babylonMeshes.splice(F,1)}))),N(H.babylonMaterial),H.promise.then((()=>H.babylonMaterial))}_createDefaultMaterial(F,P){this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new z.c(F,this._babylonScene);return f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f.fillMode=P,f.enableSpecularAntiAliasing=!0,f.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,f.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,f.transparencyMode=z.c.PBRMATERIAL_OPAQUE,f.metallic=1,f.roughness=1,f}createMaterial(F,P,f){const c=this._extensionsCreateMaterial(F,P,f);if(c)return c;const N=P.name||`material${P.index}`;return this._createDefaultMaterial(N,f)}loadMaterialPropertiesAsync(F,P,f){const c=this._extensionsLoadMaterialPropertiesAsync(F,P,f);if(c)return c;const N=new Array;return N.push(this.loadMaterialBasePropertiesAsync(F,P,f)),P.pbrMetallicRoughness&&N.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${F}/pbrMetallicRoughness`,P.pbrMetallicRoughness,f)),this.loadMaterialAlphaProperties(F,P,f),Promise.all(N).then((()=>{}))}loadMaterialBasePropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;return f.emissiveColor=P.emissiveFactor?q.BP.zP(P.emissiveFactor):new q.BP(0,0,0),P.doubleSided&&(f.Pc=!1,f.twoSidedLighting=!0),P.normalTexture&&(P.normalTexture.nonColorData=!0,c.push(this.loadTextureInfoAsync(`${F}/normalTexture`,P.normalTexture,(F=>{F.name=`${f.name} (Normal)`,f.bumpTexture=F}))),f.invertNormalMapX=!this._babylonScene.useRightHandedSystem,f.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=P.normalTexture.scale&&f.bumpTexture&&(f.bumpTexture.level=P.normalTexture.scale),f.forceIrradianceInFragment=!0),P.occlusionTexture&&(P.occlusionTexture.nonColorData=!0,c.push(this.loadTextureInfoAsync(`${F}/occlusionTexture`,P.occlusionTexture,(F=>{F.name=`${f.name} (Occlusion)`,f.ambientTexture=F}))),f.useAmbientInGrayScale=!0,void 0!=P.occlusionTexture.strength&&(f.ambientTextureStrength=P.occlusionTexture.strength)),P.emissiveTexture&&c.push(this.loadTextureInfoAsync(`${F}/emissiveTexture`,P.emissiveTexture,(F=>{F.name=`${f.name} (Emissive)`,f.emissiveTexture=F}))),Promise.all(c).then((()=>{}))}loadMaterialAlphaProperties(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);switch(P.alphaMode||"OPAQUE"){case"OPAQUE":f.transparencyMode=z.c.PBRMATERIAL_OPAQUE,f.alpha=1;break;case"MASK":f.transparencyMode=z.c.PBRMATERIAL_ALPHATEST,f.alphaCutOff=void 0==P.alphaCutoff?.5:P.alphaCutoff,f.albedoTexture&&(f.albedoTexture.ef=!0);break;case"BLEND":f.transparencyMode=z.c.PBRMATERIAL_ALPHABLEND,f.albedoTexture&&(f.albedoTexture.ef=!0,f.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${F}/alphaMode: Invalid value (${P.alphaMode})`)}}loadTextureInfoAsync(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const c=this._extensionsLoadTextureInfoAsync(F,P,f);if(c)return c;if(this.logOpen(`${F}`),P.texCoord>=6)throw new Error(`${F}/texCoord: Invalid value (${P.texCoord})`);const N=W.Get(`${F}/index`,this._gltf.textures,P.index);N._textureInfo=P;const q=this._loadTextureAsync(`/textures/${P.index}`,N,(c=>{c.coordinatesIndex=P.texCoord||0,v.AddPointerMetadata(c,F),this._parent.onTextureLoadedObservable.notifyObservers(c),f(c)}));return this.logClose(),q}_loadTextureAsync(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const c=this._extensionsLoadTextureAsync(F,P,f);if(c)return c;this.logOpen(`${F} ${P.name||""}`);const N=void 0==P.sampler?v.DefaultSampler:W.Get(`${F}/sampler`,this._gltf.samplers,P.sampler),q=W.Get(`${F}/source`,this._gltf.images,P.source),H=this._createTextureAsync(F,N,q,f,void 0,!P._textureInfo.nonColorData);return this.logClose(),H}_createTextureAsync(F,P,f){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},q=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0;const A=this._loadSampler(`/samplers/${P.index}`,P),o=new Array,j=new c;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i={noMipmap:A.noMipMaps,invertY:!1,samplingMode:A.samplingMode,G:()=>{this._disposed||j.resolve()},onError:(P,f)=>{this._disposed||j.reject(new Error(`${F}: ${f&&f.message?f.message:P||"Failed to load texture"}`))},mimeType:f.mimeType??(0,I.f)(f.uri??""),loaderOptions:q,useSRGBBuffer:!!H&&this._parent.useSRGBBuffers},u=new Z.e(null,this._babylonScene,i);return u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.push(j.promise),o.push(this.loadImageAsync(`/images/${f.index}`,f).then((F=>{const P=f.uri||`${this._fileName}#image${f.index}`,c=`data:${this._uniqueRootUrl}${P}`;u.updateURL(c,F);const N=u.getInternalTexture();N&&(N.label=f.name)}))),u.wrapU=A.wrapU,u.wrapV=A.wrapV,N(u),this._parent.useGltfTextureNames&&(u.name=f.name||f.uri||`image${f.index}`),Promise.all(o).then((()=>u))}_loadSampler(F,P){return P._data||(P._data={noMipMaps:9728===P.minFilter||9729===P.minFilter,samplingMode:v._GetTextureSamplingMode(F,P),wrapU:v._GetTextureWrapMode(`${F}/wrapS`,P.wrapS),wrapV:v._GetTextureWrapMode(`${F}/wrapT`,P.wrapT)}),P._data}loadImageAsync(F,P){if(!P._data){if(this.logOpen(`${F} ${P.name||""}`),P.uri)P._data=this.loadUriAsync(`${F}/uri`,P,P.uri);else{const f=W.Get(`${F}/bufferView`,this._gltf.bufferViews,P.bufferView);P._data=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f)}this.logClose()}return P._data}loadUriAsync(F,P,f){const c=this._extensionsLoadUriAsync(F,P,f);if(c)return c;if(!v._ValidateUri(f))throw new Error(`${F}: '${f}' is invalid`);if((0,I.i)(f)){const P=new Uint8Array((0,I.b)(f));return this.log(`${F}: Decoded ${f.substring(0,64)}... (${P.length} bytes)`),Promise.resolve(P)}return this.log(`${F}: Loading ${f}`),this._parent.preprocessUrlAsync(this._rootUrl+f).then((P=>new Promise(((c,N)=>{this._parent._loadFile(this._babylonScene,P,(P=>{this._disposed||(this.log(`${F}: Loaded ${f} (${P.byteLength} bytes)`),c(new Uint8Array(P)))}),!0,(P=>{N(new I.l(`${F}: Failed to load '${f}'${P?": "+P.status+" "+P.statusText:""}`,P))}))}))))}static AddPointerMetadata(F,P){F.metadata=F.metadata||{};const f=F._internalMetadata=F._internalMetadata||{},c=f.kf=f.kf||{};(c.pointers=c.pointers||[]).push(P)}static _GetTextureWrapMode(F,P){switch(P=void 0==P?10497:P){case 33071:return Z.e.CLAMP_ADDRESSMODE;case 33648:return Z.e.MIRROR_ADDRESSMODE;case 10497:return Z.e.WRAP_ADDRESSMODE;default:return C.d.Warn(`${F}: Invalid value (${P})`),Z.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(F,P){const f=void 0==P.magFilter?9729:P.magFilter,c=void 0==P.minFilter?9987:P.minFilter;if(9729===f)switch(c){case 9728:return Z.e.LINEAR_NEAREST;case 9729:return Z.e.LINEAR_LINEAR;case 9984:return Z.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return Z.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return Z.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return Z.e.LINEAR_LINEAR_MIPLINEAR;default:return C.d.Warn(`${F}/minFilter: Invalid value (${c})`),Z.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==f&&C.d.Warn(`${F}/magFilter: Invalid value (${f})`),c){case 9728:return Z.e.NEAREST_NEAREST;case 9729:return Z.e.NEAREST_LINEAR;case 9984:return Z.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return Z.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return Z.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return Z.e.NEAREST_LINEAR_MIPLINEAR;default:return C.d.Warn(`${F}/minFilter: Invalid value (${c})`),Z.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(F,P){try{return(0,l.u)(P)}catch(f){throw new Error(`${F}: ${f.message}`)}}static _GetTypedArray(F,P,f,c,N){const q=f.buffer;c=f.byteOffset+(c||0);const H=v._GetTypedArrayConstructor(`${F}/componentType`,P),A=y.f.GetTypeByteLength(P);return c%A!==0?(C.d.Warn(`${F}: Copying buffer as byte offset (${c}) is not a multiple of component type byte length (${A})`),new H(q.slice(c,c+N*A),0)):new H(q,c,N)}static _GetNumComponents(F,P){switch(P){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${F}: Invalid type (${P})`)}static _ValidateUri(F){return H.Tools.IsBase64(F)||-1===F.indexOf("..")}static _GetDrawMode(F,P){switch(void 0==P&&(P=4),P){case 0:return B.d.PointListDrawMode;case 1:return B.d.LineListDrawMode;case 2:return B.d.LineLoopDrawMode;case 3:return B.d.LineStripDrawMode;case 4:return B.d.TriangleFillMode;case 5:return B.d.TriangleStripDrawMode;case 6:return B.d.TriangleFanDrawMode}throw new Error(`${F}: Invalid mesh primitive mode (${P})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const F=new Array;if(this._gltf.materials)for(const P of this._gltf.materials)if(P._data)for(const f in P._data){const c=P._data[f];for(const P of c.babylonMeshes){P.gf(!0);const f=c.babylonMaterial;F.push(f.forceCompilationAsync(P)),F.push(f.forceCompilationAsync(P,{useInstances:!0})),this._parent.useClipPlane&&(F.push(f.forceCompilationAsync(P,{clipPlane:!0})),F.push(f.forceCompilationAsync(P,{clipPlane:!0,useInstances:!0})))}}return Promise.all(F).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const F=new Array,P=this._babylonScene.lights;for(const f of P){const P=f.getShadowGenerator();P&&F.push(P.forceCompilationAsync())}return Promise.all(F).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(F){for(const P of this._extensions)P.enabled&&F(P)}_applyExtensions(F,P,f){for(const c of this._extensions)if(c.enabled){const N=`${c.name}.${P}`,q=F;q._activeLoaderExtensionFunctions=q._activeLoaderExtensionFunctions||{};const H=q._activeLoaderExtensionFunctions;if(!H[N]){H[N]=!0;try{const F=f(c);if(F)return F}finally{delete H[N]}}}return null}_extensionsOnLoading(){this._forEachExtensions((F=>F.onLoading&&F.onLoading()))}_extensionsOnReady(){this._forEachExtensions((F=>F.onReady&&F.onReady()))}_extensionsLoadSceneAsync(F,P){return this._applyExtensions(P,"loadScene",(f=>f.loadSceneAsync&&f.loadSceneAsync(F,P)))}_extensionsLoadNodeAsync(F,P,f){return this._applyExtensions(P,"loadNode",(c=>c.loadNodeAsync&&c.loadNodeAsync(F,P,f)))}_extensionsLoadCameraAsync(F,P,f){return this._applyExtensions(P,"loadCamera",(c=>c.loadCameraAsync&&c.loadCameraAsync(F,P,f)))}_extensionsLoadVertexDataAsync(F,P,f){return this._applyExtensions(P,"loadVertexData",(c=>c._loadVertexDataAsync&&c._loadVertexDataAsync(F,P,f)))}_extensionsLoadMeshPrimitiveAsync(F,P,f,c,N,q){return this._applyExtensions(N,"loadMeshPrimitive",(H=>H._loadMeshPrimitiveAsync&&H._loadMeshPrimitiveAsync(F,P,f,c,N,q)))}_extensionsLoadMaterialAsync(F,P,f,c,N){return this._applyExtensions(P,"loadMaterial",(q=>q._loadMaterialAsync&&q._loadMaterialAsync(F,P,f,c,N)))}_extensionsCreateMaterial(F,P,f){return this._applyExtensions(P,"createMaterial",(c=>c.createMaterial&&c.createMaterial(F,P,f)))}_extensionsLoadMaterialPropertiesAsync(F,P,f){return this._applyExtensions(P,"loadMaterialProperties",(c=>c.loadMaterialPropertiesAsync&&c.loadMaterialPropertiesAsync(F,P,f)))}_extensionsLoadTextureInfoAsync(F,P,f){return this._applyExtensions(P,"loadTextureInfo",(c=>c.loadTextureInfoAsync&&c.loadTextureInfoAsync(F,P,f)))}_extensionsLoadTextureAsync(F,P,f){return this._applyExtensions(P,"loadTexture",(c=>c._loadTextureAsync&&c._loadTextureAsync(F,P,f)))}_extensionsLoadAnimationAsync(F,P){return this._applyExtensions(P,"loadAnimation",(f=>f.loadAnimationAsync&&f.loadAnimationAsync(F,P)))}_extensionsLoadAnimationChannelAsync(F,P,f,c,N){return this._applyExtensions(f,"loadAnimationChannel",(q=>q._loadAnimationChannelAsync&&q._loadAnimationChannelAsync(F,P,f,c,N)))}_extensionsLoadSkinAsync(F,P,f){return this._applyExtensions(f,"loadSkin",(c=>c._loadSkinAsync&&c._loadSkinAsync(F,P,f)))}_extensionsLoadUriAsync(F,P,f){return this._applyExtensions(P,"loadUri",(c=>c._loadUriAsync&&c._loadUriAsync(F,P,f)))}_extensionsLoadBufferViewAsync(F,P){return this._applyExtensions(P,"loadBufferView",(f=>f.loadBufferViewAsync&&f.loadBufferViewAsync(F,P)))}_extensionsLoadBufferAsync(F,P,f,c){return this._applyExtensions(P,"loadBuffer",(N=>N.loadBufferAsync&&N.loadBufferAsync(F,P,f,c)))}static LoadExtensionAsync(F,P,f,c){if(!P.extensions)return null;const N=P.extensions[f];return N?c(`${F}/extensions/${f}`,N):null}static LoadExtraAsync(F,P,f,c){if(!P.extras)return null;const N=P.extras[f];return N?c(`${F}/extras/${f}`,N):null}isExtensionUsed(F){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(F)}logOpen(F){this._parent._logOpen(F)}logClose(){this._parent._logClose()}log(F){this._parent._log(F)}startPerformanceCounter(F){this._parent._startPerformanceCounter(F)}endPerformanceCounter(F){this._parent._endPerformanceCounter(F)}}v.DefaultSampler={index:-1},k.c._CreateGLTF2Loader=F=>new v(F);var s=f(13210),X=f(11801),m=f(11677),a=f(13216),w=f(13222);class g extends w.d{constructor(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",F),this._texture=F.getEngine().createRawCubeTexture(P,f,c,N,q,H,A,o)}update(F,P,f,c){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,F,P,f,c,N)}updateRGBDAsync(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,a.l)(this._texture,F,P,f,c).then((()=>{}))}clone(){return m.e.Clone((()=>{const F=this.OF(),P=this._texture,f=new g(F,P._bufferViewArray,P.width,P.format,P.type,P.generateMipMaps,P.invertY,P.samplingMode,P._compression);return 13===P.source&&f.updateRGBDAsync(P._bufferViewArrayArray,P._sphericalPolynomial,P._lodGenerationScale,P._lodGenerationOffset),f}),this)}}const G="EXT_lights_image_based";class h{constructor(F){this.name=G,this._loader=F,this.enabled=this._loader.isExtensionUsed(G)}dispose(){this._loader=null,delete this._lights}onLoading(){const F=this._loader.kf.extensions;if(F&&F[this.name]){const P=F[this.name];this._lights=P.lights}}loadSceneAsync(F,P){return v.LoadExtensionAsync(F,P,this.name,(async(f,c)=>{this._loader._allMaterialsDirtyRequired=!0;const N=new Array;N.push(this._loader.loadSceneAsync(F,P)),this._loader.logOpen(`${f}`);const q=W.Get(`${f}/light`,this._lights,c.if);return N.push(this._loadLightAsync(`/extensions/${this.name}/lights/${c.if}`,q).then((F=>{this._loader.babylonScene.environmentTexture=F}))),this._loader.logClose(),await Promise.all(N).then((()=>{}))}))}_loadLightAsync(F,P){if(!P._loaded){const f=new Array;this._loader.logOpen(`${F}`);const c=new Array(P.specularImages.length);for(let N=0;N<P.specularImages.length;N++){const q=P.specularImages[N];c[N]=new Array(q.length);for(let P=0;P<q.length;P++){const H=`${F}/specularImages/${N}/${P}`;this._loader.logOpen(`${H}`);const A=q[P],o=W.Get(H,this._loader.kf.images,A);f.push(this._loader.loadImageAsync(`/images/${A}`,o).then((F=>{c[N][P]=F}))),this._loader.logClose()}}this._loader.logClose(),P._loaded=Promise.all(f).then((async()=>{const f=new g(this._loader.babylonScene,null,P.specularImageSize);if(f.name=P.name||"environment",P._babylonTexture=f,void 0!=P.jc&&(f.level=P.jc),P.rotation){let F=N.Quaternion.zP(P.rotation);this._loader.babylonScene.useRightHandedSystem||(F=N.Quaternion.Inverse(F)),N.Matrix.FromQuaternionToRef(F,f.getReflectionTextureMatrix())}if(!P.irradianceCoefficients)throw new Error(`${F}: Irradiance coefficients are missing`);const q=X.e.zP(P.irradianceCoefficients);q.scaleInPlace(P.jc),q.convertIrradianceToLambertianRadiance();const H=X.h.FromHarmonics(q),A=(c.length-1)/Math.log2(P.specularImageSize);return await f.updateRGBDAsync(c,H,A)}))}return P._loaded.then((()=>P._babylonTexture))}}U(G),p(G,!0,(F=>new h(F)));f(12188);const S="EXT_mesh_gpu_instancing";class FF{constructor(F){this.name=S,this._loader=F,this.enabled=this._loader.isExtensionUsed(S)}dispose(){this._loader=null}loadNodeAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(F,c)=>{this._loader._disableInstancedMesh++;const q=this._loader.loadNodeAsync(`/nodes/${P.index}`,P,f);if(this._loader._disableInstancedMesh--,!P._primitiveBabylonMeshes)return await q;const H=new Array;let A=0;const o=P=>{if(void 0==c.attributes[P])return void H.push(Promise.resolve(null));const f=W.Get(`${F}/attributes/${P}`,this._loader.kf.accessors,c.attributes[P]);if(H.push(this._loader._loadFloatAccessorAsync(`/accessors/${f.bufferView}`,f)),0===A)A=f.count;else if(A!==f.count)throw new Error(`${F}/attributes: Instance buffer accessors do not have the same count.`)};return o("TRANSLATION"),o("ROTATION"),o("SCALE"),await q.then((async F=>{const[f,c,q]=await Promise.all(H),o=new Float32Array(16*A);N.TmpVectors.tP[0].fc(0,0,0),N.TmpVectors.Quaternion[0].fc(0,0,0,1),N.TmpVectors.tP[1].fc(1,1,1);for(let P=0;P<A;++P)f&&N.tP.FromArrayToRef(f,3*P,N.TmpVectors.tP[0]),c&&N.Quaternion.FromArrayToRef(c,4*P,N.TmpVectors.Quaternion[0]),q&&N.tP.FromArrayToRef(q,3*P,N.TmpVectors.tP[1]),N.Matrix.ComposeToRef(N.TmpVectors.tP[1],N.TmpVectors.Quaternion[0],N.TmpVectors.tP[0],N.TmpVectors.Matrix[0]),N.TmpVectors.Matrix[0].copyToArray(o,16*P);for(const N of P._primitiveBabylonMeshes)N.lu("matrix",o,16,!0);return F}))}))}}U(S),p(S,!0,(F=>new FF(F)));let PF=0,fF=null;class cF{static get Default(){return cF._Default||(cF._Default=new cF),cF._Default}constructor(){const F=cF.Configuration.decoder;this._decoderModulePromise=H.Tools.LoadBabylonScriptAsync(F.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(F,P,f,c,N){await this._decoderModulePromise,0===PF&&(MeshoptDecoder.useWorkers(1),PF=1);const q=await MeshoptDecoder.decodeGltfBufferAsync(P,f,F,c,N);return null!==fF&&clearTimeout(fF),fF=setTimeout((()=>{MeshoptDecoder.useWorkers(0),PF=0,fF=null}),1e3),q}}cF.Configuration={decoder:{url:`${H.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},cF._Default=null;const NF="EXT_meshopt_compression";class qF{constructor(F){this.name=NF,this.enabled=F.isExtensionUsed(NF),this._loader=F}dispose(){this._loader=null}loadBufferViewAsync(F,P){return v.LoadExtensionAsync(F,P,this.name,(async(f,c)=>{const N=P;if(N._meshOptData)return await N._meshOptData;const q=W.Get(`${F}/buffer`,this._loader.kf.buffers,c.buffer);return N._meshOptData=this._loader.loadBufferAsync(`/buffers/${q.index}`,q,c.byteOffset||0,c.byteLength).then((async F=>await cF.Default.decodeGltfBufferAsync(F,c.count,c.byteStride,c.mode,c.filter))),await N._meshOptData}))}}U(NF),p(NF,!0,(F=>new qF(F)));const HF="EXT_texture_webp";class AF{constructor(F){this.name=HF,this._loader=F,this.enabled=F.isExtensionUsed(HF)}dispose(){this._loader=null}_loadTextureAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=void 0==P.sampler?v.DefaultSampler:W.Get(`${F}/sampler`,this._loader.kf.samplers,P.sampler),H=W.Get(`${c}/source`,this._loader.kf.images,N.source);return await this._loader._createTextureAsync(F,q,H,(F=>{f(F)}),void 0,!P._textureInfo.nonColorData)}))}}U(HF),p(HF,!0,(F=>new AF(F)));const oF="EXT_texture_avif";class jF{constructor(F){this.name=oF,this._loader=F,this.enabled=F.isExtensionUsed(oF)}dispose(){this._loader=null}_loadTextureAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=void 0==P.sampler?v.DefaultSampler:W.Get(`${F}/sampler`,this._loader.kf.samplers,P.sampler),H=W.Get(`${c}/source`,this._loader.kf.images,N.source);return await this._loader._createTextureAsync(F,q,H,(F=>{f(F)}),void 0,!P._textureInfo.nonColorData)}))}}U(oF),p(oF,!0,(F=>new jF(F)));var iF=f(13201),uF=f(12165);const TF="EXT_lights_ies";class YF{constructor(F){this.name=TF,this._loader=F,this.enabled=this._loader.isExtensionUsed(TF)}dispose(){this._loader=null,delete this._lights}onLoading(){const F=this._loader.kf.extensions;if(F&&F[this.name]){const P=F[this.name];this._lights=P.lights,W.Assign(this._lights)}}loadNodeAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,H)=>{let A,o;this._loader._allMaterialsDirtyRequired=!0;const j=await this._loader.loadNodeAsync(F,P,(F=>{o=W.Get(c,this._lights,H.if);const P=o.name||F.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,A=new iF.b(P,N.tP.Zero(),N.tP.Backward(),0,1,this._loader.babylonScene),A.angle=Math.PI/2,A.innerAngle=0,A._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,o._babylonLight=A,A.falloffType=uF.e.FALLOFF_GLTF,A.uc=H.color?q.BP.zP(H.color):q.BP.White(),A.jc=H.multiplier||1,A.range=Number.MAX_VALUE,A.parent=F,this._loader._babylonLights.push(A),v.AddPointerMetadata(A,c),f(F)}));let i;if(o.uri)i=await this._loader.loadUriAsync(F,o,o.uri);else{const P=W.Get(`${F}/bufferView`,this._loader.kf.bufferViews,o.bufferView);i=await this._loader.loadBufferViewAsync(`/bufferViews/${P.index}`,P)}return A.iesProfileTexture=new Z.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,i,!0,void 0,void 0,void 0,void 0,".ies"),j}))}}U(TF),p(TF,!0,(F=>new YF(F)));var tF=f(13229);const CF="KHR_draco_mesh_compression";class LF{constructor(F){this.name=CF,this.useNormalizedFlagFromAccessor=!0,this._loader=F,this.enabled=tF.d.DefaultAvailable&&this._loader.isExtensionUsed(CF)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{if(void 0!=P.mode&&4!==P.mode&&5!==P.mode)throw new Error(`${F}: Unsupported mode ${P.mode}`);const q={},H={},A=(F,c)=>{const A=N.attributes[F];if(void 0!=A&&(f._delayInfo=f._delayInfo||[],-1===f._delayInfo.indexOf(c)&&f._delayInfo.push(c),q[c]=A,this.useNormalizedFlagFromAccessor)){const f=W.TryGet(this._loader.kf.accessors,P.attributes[F]);f&&(H[c]=f.normalized||!1)}};A("POSITION",y.f.PositionKind),A("NORMAL",y.f.NormalKind),A("TANGENT",y.f.TangentKind),A("TEXCOORD_0",y.f.UVKind),A("TEXCOORD_1",y.f.UV2Kind),A("TEXCOORD_2",y.f.UV3Kind),A("TEXCOORD_3",y.f.UV4Kind),A("TEXCOORD_4",y.f.UV5Kind),A("TEXCOORD_5",y.f.UV6Kind),A("JOINTS_0",y.f.MatricesIndicesKind),A("WEIGHTS_0",y.f.MatricesWeightsKind),A("COLOR_0",y.f.ColorKind);const o=W.Get(c,this._loader.kf.bufferViews,N.bufferView);return o._dracoBabylonGeometry||(o._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((async c=>{const N=this.dracoDecoder||tF.d.Default,A=W.TryGet(this._loader.kf.accessors,P.attributes.POSITION),o=this._loader.parent.alwaysComputeBoundingBox||f.skeleton||!A?null:b(A);return await N._decodeMeshToGeometryForGltfAsync(f.name,this._loader.babylonScene,c,q,H,o).catch((P=>{throw new Error(`${F}: ${P.message}`)}))}))),await o._dracoBabylonGeometry}))}}U(CF),p(CF,!0,(F=>new LF(F)));var JF=f(13238),BF=f(11619),zF=f(11628),ZF=f(12033),RF=f(12217),yF=f(11587);ZF.c.AddNodeConstructor("Light_Type_0",((F,P)=>()=>new OF(F,N.tP.Zero(),P)));class OF extends RF.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(F){this._shadowAngle=F,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(F){const P=this.needCube();if(this._direction=F,this.needCube()!==P&&this._shadowGenerators){const F=this._shadowGenerators.values();for(let P=F.next();!0!==P.done;P=F.next()){P.value.recreateShadowMap()}}}constructor(F,P,f){super(F,f),this._shadowAngle=Math.PI/2,this.position=P}getClassName(){return"PointLight"}getTypeID(){return uF.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(F){if(this.direction)return super.getShadowDirection(F);switch(F){case 0:return new N.tP(1,0,0);case 1:return new N.tP(-1,0,0);case 2:return new N.tP(0,-1,0);case 3:return new N.tP(0,1,0);case 4:return new N.tP(0,0,1);case 5:return new N.tP(0,0,-1)}return N.tP.Zero()}_setDefaultShadowProjectionMatrix(F,P,f){const c=this.OF().activeCamera;if(!c)return;const q=void 0!==this.shadowMinZ?this.shadowMinZ:c.Wf,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,A=this.OF().getEngine().useReverseDepthBuffer;N.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,A?H:q,A?q:H,F,!0,this._scene.getEngine().isNDCHalfZRange,void 0,A)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(F,P){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,P):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,P),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,P),this}transferToNodeMaterialEffect(F,P){return this.computeTransformedInformation()?F.setFloat3(P,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):F.setFloat3(P,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(F,P){F["POINTLIGHT"+P]=!0}}(0,BF.e)([(0,zF.L)()],OF.prototype,"shadowAngle",null),(0,yF.f)("BABYLON.PointLight",OF);const dF="KHR_lights_punctual";class MF{constructor(F){this.name=dF,this._loader=F,this.enabled=this._loader.isExtensionUsed(dF)}dispose(){this._loader=null,delete this._lights}onLoading(){const F=this._loader.kf.extensions;if(F&&F[this.name]){const P=F[this.name];this._lights=P.lights,W.Assign(this._lights)}}loadNodeAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,H)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(F,P,(F=>{let P;const A=W.Get(c,this._lights,H.if),o=A.name||F.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,A.type){case"directional":{const F=new JF.d(o,N.tP.Backward(),this._loader.babylonScene);F.position.Nc(0),P=F;break}case"point":P=new OF(o,N.tP.Zero(),this._loader.babylonScene);break;case"spot":{const F=new iF.b(o,N.tP.Zero(),N.tP.Backward(),0,1,this._loader.babylonScene);F.angle=2*(A.spot&&A.spot.outerConeAngle||Math.PI/4),F.innerAngle=2*(A.spot&&A.spot.innerConeAngle||0),P=F;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${c}: Invalid light type (${A.type})`)}P._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,A._babylonLight=P,P.falloffType=uF.e.FALLOFF_GLTF,P.uc=A.color?q.BP.zP(A.color):q.BP.White(),P.jc=void 0==A.jc?1:A.jc,P.range=void 0==A.range?Number.MAX_VALUE:A.range,P.parent=F,this._loader._babylonLights.push(P),v.AddPointerMetadata(P,c),f(F)})))))}}U(dF),p(dF,!0,(F=>new MF(F)));const VF="KHR_materials_pbrSpecularGlossiness";class QF{constructor(F){this.name=VF,this.order=200,this._loader=F,this.enabled=this._loader.isExtensionUsed(VF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialBasePropertiesAsync(F,P,f)),q.push(this._loadSpecularGlossinessPropertiesAsync(c,N,f)),this._loader.loadMaterialAlphaProperties(F,P,f),await Promise.all(q).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;return f.metallic=null,f.roughness=null,P.diffuseFactor?(f.albedoColor=q.BP.zP(P.diffuseFactor),f.alpha=P.diffuseFactor[3]):f.albedoColor=q.BP.White(),f.reflectivityColor=P.specularFactor?q.BP.zP(P.specularFactor):q.BP.White(),f.microSurface=void 0==P.glossinessFactor?1:P.glossinessFactor,P.diffuseTexture&&c.push(this._loader.loadTextureInfoAsync(`${F}/diffuseTexture`,P.diffuseTexture,(F=>{F.name=`${f.name} (Diffuse)`,f.albedoTexture=F}))),P.specularGlossinessTexture&&(c.push(this._loader.loadTextureInfoAsync(`${F}/specularGlossinessTexture`,P.specularGlossinessTexture,(F=>{F.name=`${f.name} (Specular Glossiness)`,f.reflectivityTexture=F,f.reflectivityTexture.ef=!0}))),f.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(c).then((()=>{}))}}U(VF),p(VF,!0,(F=>new QF(F)));const KF="KHR_materials_unlit";class xF{constructor(F){this.name=KF,this.order=210,this._loader=F,this.enabled=this._loader.isExtensionUsed(KF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async()=>await this._loadUnlitPropertiesAsync(F,P,f)))}_loadUnlitPropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;f.unlit=!0;const N=P.pbrMetallicRoughness;return N&&(N.baseColorFactor?(f.albedoColor=q.BP.zP(N.baseColorFactor),f.alpha=N.baseColorFactor[3]):f.albedoColor=q.BP.White(),N.baseColorTexture&&c.push(this._loader.loadTextureInfoAsync(`${F}/baseColorTexture`,N.baseColorTexture,(F=>{F.name=`${f.name} (Base Color)`,f.albedoTexture=F})))),P.doubleSided&&(f.Pc=!1,f.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(F,P,f),Promise.all(c).then((()=>{}))}}U(KF),p(KF,!0,(F=>new xF(F)));const kF="KHR_materials_clearcoat";class IF{constructor(F){this.name=kF,this.order=190,this._loader=F,this.enabled=this._loader.isExtensionUsed(kF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadClearCoatPropertiesAsync(c,N,f)),await Promise.all(q)}))}_loadClearCoatPropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;return f.clearCoat.isEnabled=!0,f.clearCoat.useRoughnessFromMainTexture=!1,f.clearCoat.remapF0OnInterfaceChange=!1,void 0!=P.clearcoatFactor?f.clearCoat.jc=P.clearcoatFactor:f.clearCoat.jc=0,P.clearcoatTexture&&c.push(this._loader.loadTextureInfoAsync(`${F}/clearcoatTexture`,P.clearcoatTexture,(F=>{F.name=`${f.name} (ClearCoat)`,f.clearCoat.texture=F}))),void 0!=P.clearcoatRoughnessFactor?f.clearCoat.roughness=P.clearcoatRoughnessFactor:f.clearCoat.roughness=0,P.clearcoatRoughnessTexture&&(P.clearcoatRoughnessTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${F}/clearcoatRoughnessTexture`,P.clearcoatRoughnessTexture,(F=>{F.name=`${f.name} (ClearCoat Roughness)`,f.clearCoat.textureRoughness=F})))),P.clearcoatNormalTexture&&(P.clearcoatNormalTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${F}/clearcoatNormalTexture`,P.clearcoatNormalTexture,(F=>{F.name=`${f.name} (ClearCoat Normal)`,f.clearCoat.bumpTexture=F}))),f.invertNormalMapX=!f.OF().useRightHandedSystem,f.invertNormalMapY=f.OF().useRightHandedSystem,void 0!=P.clearcoatNormalTexture.scale&&(f.clearCoat.bumpTexture.level=P.clearcoatNormalTexture.scale)),Promise.all(c).then((()=>{}))}}U(kF),p(kF,!0,(F=>new IF(F)));const EF="KHR_materials_iridescence";class rF{constructor(F){this.name=EF,this.order=195,this._loader=F,this.enabled=this._loader.isExtensionUsed(EF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadIridescencePropertiesAsync(c,N,f)),await Promise.all(q).then((()=>{}))}))}_loadIridescencePropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;return f.iridescence.isEnabled=!0,f.iridescence.jc=P.iridescenceFactor??0,f.iridescence.indexOfRefraction=P.iridescenceIor??P.iridescenceIOR??1.3,f.iridescence.minimumThickness=P.iridescenceThicknessMinimum??100,f.iridescence.maximumThickness=P.iridescenceThicknessMaximum??400,P.iridescenceTexture&&c.push(this._loader.loadTextureInfoAsync(`${F}/iridescenceTexture`,P.iridescenceTexture,(F=>{F.name=`${f.name} (Iridescence)`,f.iridescence.texture=F}))),P.iridescenceThicknessTexture&&c.push(this._loader.loadTextureInfoAsync(`${F}/iridescenceThicknessTexture`,P.iridescenceThicknessTexture,(F=>{F.name=`${f.name} (Iridescence Thickness)`,f.iridescence.thicknessTexture=F}))),Promise.all(c).then((()=>{}))}}U(EF),p(EF,!0,(F=>new rF(F)));const nF="KHR_materials_anisotropy";class pF{constructor(F){this.name=nF,this.order=195,this._loader=F,this.enabled=this._loader.isExtensionUsed(nF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadIridescencePropertiesAsync(c,N,f)),await Promise.all(q)}))}async _loadIridescencePropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;f.anisotropy.isEnabled=!0,f.anisotropy.jc=P.anisotropyStrength??0,f.anisotropy.angle=P.anisotropyRotation??0,P.anisotropyTexture&&(P.anisotropyTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${F}/anisotropyTexture`,P.anisotropyTexture,(F=>{F.name=`${f.name} (Anisotropy Intensity)`,f.anisotropy.texture=F})))),await Promise.all(c)}}U(nF),p(nF,!0,(F=>new pF(F)));const UF="KHR_materials_emissive_strength";class eF{constructor(F){this.name=UF,this.order=170,this._loader=F,this.enabled=this._loader.isExtensionUsed(UF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>await this._loader.loadMaterialPropertiesAsync(F,P,f).then((()=>{this._loadEmissiveProperties(c,N,f)}))))}_loadEmissiveProperties(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);void 0!==P.emissiveStrength&&(f.emissiveIntensity=P.emissiveStrength)}}U(UF),p(UF,!0,(F=>new eF(F)));const DF="KHR_materials_sheen";class lF{constructor(F){this.name=DF,this.order=190,this._loader=F,this.enabled=this._loader.isExtensionUsed(DF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadSheenPropertiesAsync(c,N,f)),await Promise.all(q).then((()=>{}))}))}_loadSheenPropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;return f.sheen.isEnabled=!0,f.sheen.jc=1,void 0!=P.sheenColorFactor?f.sheen.color=q.BP.zP(P.sheenColorFactor):f.sheen.color=q.BP.Black(),P.sheenColorTexture&&c.push(this._loader.loadTextureInfoAsync(`${F}/sheenColorTexture`,P.sheenColorTexture,(F=>{F.name=`${f.name} (Sheen Color)`,f.sheen.texture=F}))),void 0!==P.sheenRoughnessFactor?f.sheen.roughness=P.sheenRoughnessFactor:f.sheen.roughness=0,P.sheenRoughnessTexture&&(P.sheenRoughnessTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${F}/sheenRoughnessTexture`,P.sheenRoughnessTexture,(F=>{F.name=`${f.name} (Sheen Roughness)`,f.sheen.textureRoughness=F})))),f.sheen.albedoScaling=!0,f.sheen.useRoughnessFromMainTexture=!1,Promise.all(c).then((()=>{}))}}U(DF),p(DF,!0,(F=>new lF(F)));var WF=f(12106);const bF="KHR_materials_specular";class vF{constructor(F){this.name=bF,this.order=190,this._loader=F,this.enabled=this._loader.isExtensionUsed(bF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;if(q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadSpecularPropertiesAsync(c,N,f)),N.extensions&&N.extensions.EXT_materials_specular_edge_color&&f instanceof z.c){N.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(f.brdf.dielectricSpecularModel=WF.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,f.brdf.conductorSpecularModel=WF.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(q).then((()=>{}))}))}_loadSpecularPropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;return void 0!==P.specularFactor&&(f.metallicF0Factor=P.specularFactor),void 0!==P.specularColorFactor&&(f.metallicReflectanceColor=q.BP.zP(P.specularColorFactor)),P.specularTexture&&(P.specularTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${F}/specularTexture`,P.specularTexture,(F=>{F.name=`${f.name} (Specular)`,f.metallicReflectanceTexture=F,f.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),P.specularColorTexture&&c.push(this._loader.loadTextureInfoAsync(`${F}/specularColorTexture`,P.specularColorTexture,(F=>{F.name=`${f.name} (Specular Color)`,f.reflectanceTexture=F}))),Promise.all(c).then((()=>{}))}}U(bF),p(bF,!0,(F=>new vF(F)));const sF="KHR_materials_ior";class XF{constructor(F){this.name=sF,this.order=180,this._loader=F,this.enabled=this._loader.isExtensionUsed(sF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadIorPropertiesAsync(c,N,f)),await Promise.all(q).then((()=>{}))}))}_loadIorPropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);return void 0!==P.ior?f.indexOfRefraction=P.ior:f.indexOfRefraction=XF._DEFAULT_IOR,Promise.resolve()}}XF._DEFAULT_IOR=1.5,U(sF),p(sF,!0,(F=>new XF(F)));const mF="KHR_materials_variants";class aF{constructor(F){this.name=mF,this._loader=F,this.enabled=this._loader.isExtensionUsed(mF)}dispose(){this._loader=null}static GetAvailableVariants(F){const P=this._GetExtensionMetadata(F);return P?Object.keys(P.variants):[]}getAvailableVariants(F){return aF.GetAvailableVariants(F)}static SelectVariant(F,P){const f=this._GetExtensionMetadata(F);if(!f)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${mF} extension`);const c=F=>{const P=f.variants[F];if(P)for(const f of P)f.mesh.material=f.material};if(P instanceof Array)for(const N of P)c(N);else c(P);f.lastSelected=P}selectVariant(F,P){aF.SelectVariant(F,P)}static Reset(F){const P=this._GetExtensionMetadata(F);if(!P)throw new Error(`Cannot reset on a glTF mesh that does not have the ${mF} extension`);for(const f of P.original)f.mesh.material=f.material;P.lastSelected=null}reset(F){aF.Reset(F)}static GetLastSelectedVariant(F){const P=this._GetExtensionMetadata(F);if(!P)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${mF} extension`);return P.lastSelected}getLastSelectedVariant(F){return aF.GetLastSelectedVariant(F)}static _GetExtensionMetadata(F){var P,f;return(null===F||void 0===F||null===(P=F._internalMetadata)||void 0===P||null===(f=P.kf)||void 0===f?void 0:f[mF])||null}onLoading(){const F=this._loader.kf.extensions;if(F&&F[this.name]){const P=F[this.name];this._variants=P.variants}}onReady(){const F=this._loader.rootBabylonMesh;if(F){var P;const f=this._loader.parent.extensionOptions[mF];null!==f&&void 0!==f&&f.defaultVariant&&aF.SelectVariant(F,f.defaultVariant),null===f||void 0===f||null===(P=f.onLoaded)||void 0===P||P.call(f,{get variants(){return aF.GetAvailableVariants(F)},get selectedVariant(){const P=aF.GetLastSelectedVariant(F);return P?Array.isArray(P)?P[0]:P:aF.GetAvailableVariants(F)[0]},set selectedVariant(P){aF.SelectVariant(F,P)}})}}_loadMeshPrimitiveAsync(F,P,f,c,N,q){return v.LoadExtensionAsync(F,N,this.name,(async(H,A)=>{const o=new Array;return o.push(this._loader._loadMeshPrimitiveAsync(F,P,f,c,N,(P=>{if(q(P),P instanceof M.d){const f=v._GetDrawMode(F,N.mode),c=this._loader.rootBabylonMesh,q=c?c._internalMetadata=c._internalMetadata||{}:{},j=q.kf=q.kf||{},i=j[mF]=j[mF]||{lastSelected:null,original:[],variants:{}};i.original.push({mesh:P,material:P.material});for(let F=0;F<A.mappings.length;++F){const N=A.mappings[F],q=W.Get(`${H}/mappings/${F}/material`,this._loader.kf.materials,N.material);o.push(this._loader._loadMaterialAsync(`#/materials/${N.material}`,q,P,f,(F=>{for(let f=0;f<N.variants.length;++f){const q=N.variants[f],H=W.Get(`/extensions/${mF}/variants/${q}`,this._variants,q);i.variants[H.name]=i.variants[H.name]||[],i.variants[H.name].push({mesh:P,material:F}),P.onClonedObservable.add((F=>{const f=F;let N=null,q=f;do{if(q=q.parent,!q)return;N=aF._GetExtensionMetadata(q)}while(null===N);if(c&&N===aF._GetExtensionMetadata(c)){q._internalMetadata={};for(const F in c._internalMetadata)q._internalMetadata[F]=c._internalMetadata[F];q._internalMetadata.kf=[];for(const F in c._internalMetadata.kf)q._internalMetadata.kf[F]=c._internalMetadata.kf[F];q._internalMetadata.kf[mF]={lastSelected:null,original:[],variants:{}};for(const F of N.original)q._internalMetadata.kf[mF].original.push({mesh:F.mesh,material:F.material});for(const F in N.variants)if(Object.prototype.hasOwnProperty.call(N.variants,F)){q._internalMetadata.kf[mF].variants[F]=[];for(const P of N.variants[F])q._internalMetadata.kf[mF].variants[F].push({mesh:P.mesh,material:P.material})}N=q._internalMetadata.kf[mF]}for(const c of N.original)c.mesh===P&&(c.mesh=f);for(const c of N.variants[H.name])c.mesh===P&&(c.mesh=f)}))}})))}}}))),await Promise.all(o).then((F=>{let[P]=F;return P}))}))}}U(mF),p(mF,!0,(F=>new aF(F)));var wF=f(11702);class gF{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:WF.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(F,P){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...gF._GetDefaultOptions(),...F},this._scene=P,this._scene._transmissionHelper=this,this.onErrorObservable=new i.d,this._scene.Mf.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(F){if(!Object.keys(F).filter((P=>this._options[P]!==F[P])).length)return;const P={...this._options,...F},f=this._options;this._options=P,P.renderSize===f.renderSize&&P.renderTargetTextureType===f.renderTargetTextureType&&P.generateMipmaps===f.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=P.samples,this._opaqueRenderTarget.lodGenerationScale=P.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=P.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(F){return!!F&&!!(F instanceof z.c&&F.subSurface.isRefractionEnabled)}_addMesh(F){this._materialObservers[F.uniqueId]=F.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),H.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(F.material)?(F.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(F)&&this._transparentMeshesCache.push(F)):-1===this._opaqueMeshesCache.indexOf(F)&&this._opaqueMeshesCache.push(F)}))}_removeMesh(F){F.onMaterialChangedObservable.remove(this._materialObservers[F.uniqueId]),delete this._materialObservers[F.uniqueId];let P=this._transparentMeshesCache.indexOf(F);-1!==P&&this._transparentMeshesCache.splice(P,1),P=this._opaqueMeshesCache.indexOf(F),-1!==P&&this._opaqueMeshesCache.splice(P,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(F){const P=this._transparentMeshesCache.indexOf(F),f=this._opaqueMeshesCache.indexOf(F);this._shouldRenderAsTransmission(F.material)?(F.material instanceof z.c&&(F.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==f?(this._opaqueMeshesCache.splice(f,1),this._transparentMeshesCache.push(F)):-1===P&&this._transparentMeshesCache.push(F)):-1!==P?(this._transparentMeshesCache.splice(P,1),this._opaqueMeshesCache.push(F)):-1===f&&this._opaqueMeshesCache.push(F)}_isRenderTargetValid(){var F;return null!==(null===(F=this._opaqueRenderTarget)||void 0===F?void 0:F.getInternalTexture())}_setupRenderTargets(){var F;let P;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new wF.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(F=this._options.clearColor)||void 0===F?void 0:F.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((F=>{P=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?F.clearColor.q(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(F.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=P}));for(const f of this._transparentMeshesCache)this._shouldRenderAsTransmission(f.material)&&(f.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const GF="KHR_materials_transmission";class hF{constructor(F){this.name=GF,this.order=175,this._loader=F,this.enabled=this._loader.isExtensionUsed(GF),this.enabled&&(F.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadTransparentPropertiesAsync(c,P,f,N)),await Promise.all(q).then((()=>{}))}))}_loadTransparentPropertiesAsync(F,P,f,c){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const N=f;if(N.subSurface.isRefractionEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.useAlbedoToTintRefraction=!0,void 0===c.transmissionFactor)return N.subSurface.refractionIntensity=0,N.subSurface.isRefractionEnabled=!1,Promise.resolve();{var q;N.subSurface.refractionIntensity=c.transmissionFactor;const F=N.OF();if(N.subSurface.refractionIntensity&&!F._transmissionHelper)new gF({},N.OF());else if(N.subSurface.refractionIntensity&&(null===(q=F._transmissionHelper)||void 0===q||!q._isRenderTargetValid())){var H;null===(H=F._transmissionHelper)||void 0===H||H._setupRenderTargets()}}return N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,c.transmissionTexture?(c.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${F}/transmissionTexture`,c.transmissionTexture,void 0).then((F=>{F.name=`${f.name} (Transmission)`,N.subSurface.refractionIntensityTexture=F,N.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}U(GF),p(GF,!0,(F=>new hF(F)));const SF="KHR_materials_diffuse_transmission";class FP{constructor(F){this.name=SF,this.order=174,this._loader=F,this.enabled=this._loader.isExtensionUsed(SF),this.enabled&&(F.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadTranslucentPropertiesAsync(c,P,f,N)),await Promise.all(q).then((()=>{}))}))}_loadTranslucentPropertiesAsync(F,P,f,c){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const N=f;if(N.subSurface.isTranslucencyEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,N.subSurface.useAlbedoToTintTranslucency=!1,void 0===c.diffuseTransmissionFactor)return N.subSurface.translucencyIntensity=0,N.subSurface.isTranslucencyEnabled=!1,Promise.resolve();N.subSurface.translucencyIntensity=c.diffuseTransmissionFactor;const H=new Array;return N.subSurface.useGltfStyleTextures=!0,c.diffuseTransmissionTexture&&(c.diffuseTransmissionTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${F}/diffuseTransmissionTexture`,c.diffuseTransmissionTexture).then((F=>{F.name=`${f.name} (Diffuse Transmission)`,N.subSurface.translucencyIntensityTexture=F})))),void 0!==c.diffuseTransmissionColorFactor?N.subSurface.translucencyColor=q.BP.zP(c.diffuseTransmissionColorFactor):N.subSurface.translucencyColor=q.BP.White(),c.diffuseTransmissionColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${F}/diffuseTransmissionColorTexture`,c.diffuseTransmissionColorTexture).then((F=>{F.name=`${f.name} (Diffuse Transmission Color)`,N.subSurface.translucencyColorTexture=F}))),Promise.all(H).then((()=>{}))}}U(SF),p(SF,!0,(F=>new FP(F)));const PP="KHR_materials_volume";class fP{constructor(F){this.name=PP,this.order=173,this._loader=F,this.enabled=this._loader.isExtensionUsed(PP),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadVolumePropertiesAsync(c,P,f,N)),await Promise.all(q).then((()=>{}))}))}_loadVolumePropertiesAsync(F,P,f,c){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);if(!f.subSurface.isRefractionEnabled&&!f.subSurface.isTranslucencyEnabled||!c.thicknessFactor)return Promise.resolve();f.subSurface.volumeIndexOfRefraction=f.indexOfRefraction;const N=void 0!==c.attenuationDistance?c.attenuationDistance:Number.MAX_VALUE;return f.subSurface.tintColorAtDistance=N,void 0!==c.attenuationColor&&3==c.attenuationColor.length&&f.subSurface.tintColor.fc(c.attenuationColor[0],c.attenuationColor[1],c.attenuationColor[2]),f.subSurface.minimumThickness=0,f.subSurface.maximumThickness=c.thicknessFactor,f.subSurface.useThicknessAsDepth=!0,c.thicknessTexture?(c.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${F}/thicknessTexture`,c.thicknessTexture).then((F=>{F.name=`${f.name} (Thickness)`,f.subSurface.thicknessTexture=F,f.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}U(PP),p(PP,!0,(F=>new fP(F)));const cP="KHR_materials_dispersion";class NP{constructor(F){this.name=cP,this.order=174,this._loader=F,this.enabled=this._loader.isExtensionUsed(cP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadDispersionPropertiesAsync(c,P,f,N)),await Promise.all(q).then((()=>{}))}))}_loadDispersionPropertiesAsync(F,P,f,c){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);return f.subSurface.isRefractionEnabled&&c.dispersion?(f.subSurface.isDispersionEnabled=!0,f.subSurface.dispersion=c.dispersion,Promise.resolve()):Promise.resolve()}}U(cP),p(cP,!0,(F=>new NP(F)));const qP="EXT_materials_diffuse_roughness";class HP{constructor(F){this.name=qP,this.order=190,this._loader=F,this.enabled=this._loader.isExtensionUsed(qP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(F,P,f)),q.push(this._loadDiffuseRoughnessPropertiesAsync(c,N,f)),await Promise.all(q).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(F,P,f){if(!(f instanceof z.c))throw new Error(`${F}: Material type not supported`);const c=new Array;return f.brdf.baseDiffuseModel=WF.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=P.diffuseRoughnessFactor?f.baseDiffuseRoughness=P.diffuseRoughnessFactor:f.baseDiffuseRoughness=0,P.diffuseRoughnessTexture&&c.push(this._loader.loadTextureInfoAsync(`${F}/diffuseRoughnessTexture`,P.diffuseRoughnessTexture,(F=>{F.name=`${f.name} (Diffuse Roughness)`,f.baseDiffuseRoughnessTexture=F}))),Promise.all(c).then((()=>{}))}}U(qP),p(qP,!0,(F=>new HP(F)));const AP="KHR_mesh_quantization";class oP{constructor(F){this.name=AP,this.enabled=F.isExtensionUsed(AP)}dispose(){}}U(AP),p(AP,!0,(F=>new oP(F)));const jP="KHR_texture_basisu";class iP{constructor(F){this.name=jP,this._loader=F,this.enabled=F.isExtensionUsed(jP)}dispose(){this._loader=null}_loadTextureAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>{const q=void 0==P.sampler?v.DefaultSampler:W.Get(`${F}/sampler`,this._loader.kf.samplers,P.sampler),H=W.Get(`${c}/source`,this._loader.kf.images,N.source);return await this._loader._createTextureAsync(F,q,H,(F=>{f(F)}),P._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!P._textureInfo.nonColorData)}))}}U(jP),p(jP,!0,(F=>new iP(F)));const uP="KHR_texture_transform";class TP{constructor(F){this.name=uP,this._loader=F,this.enabled=this._loader.isExtensionUsed(uP)}dispose(){this._loader=null}loadTextureInfoAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(c,N)=>await this._loader.loadTextureInfoAsync(F,P,(F=>{if(!(F instanceof Z.e))throw new Error(`${c}: Texture type not supported`);N.offset&&(F.uOffset=N.offset[0],F.vOffset=N.offset[1]),F.uRotationCenter=0,F.vRotationCenter=0,N.rotation&&(F.wAng=-N.rotation),N.scale&&(F.uScale=N.scale[0],F.vScale=N.scale[1]),void 0!=N.texCoord&&(F.coordinatesIndex=N.texCoord),f(F)}))))}}U(uP),p(uP,!0,(F=>new TP(F)));const YP="KHR_xmp_json_ld";class tP{constructor(F){this.name=YP,this.order=100,this._loader=F,this.enabled=this._loader.isExtensionUsed(YP)}dispose(){this._loader=null}onLoading(){var F,P,f;if(null===this._loader.rootBabylonMesh)return;const c=null===(F=this._loader.kf.extensions)||void 0===F?void 0:F.KHR_xmp_json_ld,N=null===(P=this._loader.kf.asset)||void 0===P||null===(f=P.extensions)||void 0===f?void 0:f.KHR_xmp_json_ld;if(c&&N){const F=+N.packet;c.packets&&F<c.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=c.packets[F])}}}function CP(F,P,f,c){return q.BP.zP(P,f).scale(c)}function LP(F,P,f,c){return P[f]*c}function JP(F,P,f,c){return-P[f]*c}function BP(F,P,f,c){return P[f+1]*c}function zP(F,P,f,c){return P[f]*c*2}function ZP(F){return{scale:[new yP(T.d.ANIMATIONTYPE_FLOAT,`${F}.uScale`,LP,(()=>2)),new yP(T.d.ANIMATIONTYPE_FLOAT,`${F}.vScale`,BP,(()=>2))],offset:[new yP(T.d.ANIMATIONTYPE_FLOAT,`${F}.uOffset`,LP,(()=>2)),new yP(T.d.ANIMATIONTYPE_FLOAT,`${F}.vOffset`,BP,(()=>2))],rotation:[new yP(T.d.ANIMATIONTYPE_FLOAT,`${F}.wAng`,JP,(()=>1))]}}U(YP),p(YP,!0,(F=>new tP(F)));class RP extends s.AnimationPropertyInfo{buildAnimations(F,P,f,c){return[{babylonAnimatable:F._babylonCamera,babylonAnimation:this._buildAnimation(P,f,c)}]}}class yP extends s.AnimationPropertyInfo{buildAnimations(F,P,f,c){const N=[];for(const q in F._data)N.push({babylonAnimatable:F._data[q].babylonMaterial,babylonAnimation:this._buildAnimation(P,f,c)});return N}}class OP extends s.AnimationPropertyInfo{buildAnimations(F,P,f,c){return[{babylonAnimatable:F._babylonLight,babylonAnimation:this._buildAnimation(P,f,c)}]}}(0,e.i)("/cameras/{}/orthographic/xmag",[new RP(T.d.ANIMATIONTYPE_FLOAT,"orthoLeft",JP,(()=>1)),new RP(T.d.ANIMATIONTYPE_FLOAT,"orthoRight",BP,(()=>1))]),(0,e.i)("/cameras/{}/orthographic/ymag",[new RP(T.d.ANIMATIONTYPE_FLOAT,"orthoBottom",JP,(()=>1)),new RP(T.d.ANIMATIONTYPE_FLOAT,"orthoTop",BP,(()=>1))]),(0,e.i)("/cameras/{}/orthographic/zfar",[new RP(T.d.ANIMATIONTYPE_FLOAT,"maxZ",LP,(()=>1))]),(0,e.i)("/cameras/{}/orthographic/znear",[new RP(T.d.ANIMATIONTYPE_FLOAT,"Wf",LP,(()=>1))]),(0,e.i)("/cameras/{}/perspective/yfov",[new RP(T.d.ANIMATIONTYPE_FLOAT,"fov",LP,(()=>1))]),(0,e.i)("/cameras/{}/perspective/zfar",[new RP(T.d.ANIMATIONTYPE_FLOAT,"maxZ",LP,(()=>1))]),(0,e.i)("/cameras/{}/perspective/znear",[new RP(T.d.ANIMATIONTYPE_FLOAT,"Wf",LP,(()=>1))]),(0,e.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new yP(T.d.ANIMATIONTYPE_COLOR3,"albedoColor",CP,(()=>4)),new yP(T.d.ANIMATIONTYPE_FLOAT,"alpha",(function(F,P,f,c){return P[f+3]*c}),(()=>4))]),(0,e.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"metallic",LP,(()=>1))]),(0,e.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"roughness",LP,(()=>1))]);const dP=ZP("albedoTexture");(0,e.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",dP.scale),(0,e.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",dP.offset),(0,e.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",dP.rotation);const MP=ZP("metallicTexture");(0,e.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",MP.scale),(0,e.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",MP.offset),(0,e.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",MP.rotation),(0,e.i)("/materials/{}/emissiveFactor",[new yP(T.d.ANIMATIONTYPE_COLOR3,"emissiveColor",CP,(()=>3))]);const VP=ZP("bumpTexture");(0,e.i)("/materials/{}/normalTexture/scale",[new yP(T.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",LP,(()=>1))]),(0,e.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",VP.scale),(0,e.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",VP.offset),(0,e.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",VP.rotation),(0,e.i)("/materials/{}/occlusionTexture/strength",[new yP(T.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",LP,(()=>1))]);const QP=ZP("ambientTexture");(0,e.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",QP.scale),(0,e.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",QP.offset),(0,e.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",QP.rotation);const KP=ZP("emissiveTexture");(0,e.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",KP.scale),(0,e.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",KP.offset),(0,e.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",KP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new yP(T.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new yP(T.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",LP,(()=>1))]);const xP=ZP("anisotropy.texture");(0,e.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",xP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",xP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",xP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",LP,(()=>1))]);const kP=ZP("clearCoat.texture");(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",kP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",kP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",kP.rotation);const IP=ZP("clearCoat.bumpTexture");(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new yP(T.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",IP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",IP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",IP.rotation);const EP=ZP("clearCoat.textureRoughness");(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",EP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",EP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",EP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new yP(T.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new yP(T.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new yP(T.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new yP(T.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",LP,(()=>1))]);const rP=ZP("iridescence.texture");(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",rP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",rP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",rP.rotation);const nP=ZP("iridescence.thicknessTexture");(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",nP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",nP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",nP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new yP(T.d.ANIMATIONTYPE_COLOR3,"sheen.color",CP,(()=>3))]),(0,e.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",LP,(()=>1))]);const pP=ZP("sheen.texture");(0,e.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",pP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",pP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",pP.rotation);const UP=ZP("sheen.textureRoughness");(0,e.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",UP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",UP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",UP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new yP(T.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",CP,(()=>3))]);const eP=ZP("metallicReflectanceTexture");(0,e.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",eP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",eP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",eP.rotation);const DP=ZP("reflectanceTexture");(0,e.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",DP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",DP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",DP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",LP,(()=>1))]);const lP=ZP("subSurface.refractionIntensityTexture");(0,e.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",lP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",lP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",lP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new yP(T.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",CP,(()=>3))]),(0,e.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new yP(T.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",LP,(()=>1))]),(0,e.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",LP,(()=>1))]);const WP=ZP("subSurface.thicknessTexture");(0,e.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",WP.scale),(0,e.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",WP.offset),(0,e.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",WP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new yP(T.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",LP,(()=>1))]);const bP=ZP("subSurface.translucencyIntensityTexture");(0,e.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",bP.scale),(0,e.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",bP.offset),(0,e.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",bP.rotation),(0,e.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new yP(T.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",CP,(()=>3))]);const vP=ZP("subSurface.translucencyColorTexture");(0,e.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",vP.scale),(0,e.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",vP.offset),(0,e.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",vP.rotation),(0,e.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new OP(T.d.ANIMATIONTYPE_COLOR3,"diffuse",CP,(()=>3))]),(0,e.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new OP(T.d.ANIMATIONTYPE_FLOAT,"intensity",LP,(()=>1))]),(0,e.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new OP(T.d.ANIMATIONTYPE_FLOAT,"range",LP,(()=>1))]),(0,e.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new OP(T.d.ANIMATIONTYPE_FLOAT,"innerAngle",zP,(()=>1))]),(0,e.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new OP(T.d.ANIMATIONTYPE_FLOAT,"angle",zP,(()=>1))]),(0,e.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new OP(T.d.ANIMATIONTYPE_COLOR3,"diffuse",CP,(()=>3))]),(0,e.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new OP(T.d.ANIMATIONTYPE_FLOAT,"intensity",LP,(()=>1))]);const sP="KHR_animation_pointer";class XP{constructor(F){this.name=sP,this._loader=F,this._pathToObjectConverter=(0,e.h)(this._loader.kf)}get enabled(){return this._loader.isExtensionUsed(sP)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(F,P,f,c,N){var q;const H=null===(q=c.target.extensions)||void 0===q?void 0:q.KHR_animation_pointer;if(!H||!this._pathToObjectConverter)return null;"pointer"!==c.target.path&&C.d.Warn(`${F}/target/path: Value (${c.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=c.target.node&&C.d.Warn(`${F}/target/node: Value (${c.target.node}) must not be present when using the ${this.name} extension`);const A=`${F}/extensions/${this.name}`,o=H.pointer;if(!o)throw new Error(`${A}: Pointer is missing`);try{const q=this._pathToObjectConverter.convert(o);if(!q.info.interpolation)throw new Error(`${A}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(F,P,f,c,{object:q.object,info:q.info.interpolation},N)}catch(j){return C.d.Warn(`${A}/pointer: Invalid pointer (${o}) skipped`),null}}}U(sP),p(sP,!0,(F=>new XP(F)));class mP{constructor(F,P,f){this.frame=F,this.action=P,this.onlyOnce=f,this.isDone=!1}_clone(){return new mP(this.frame,this.action,this.onlyOnce)}}var aP=f(11488),wP=f(11541),gP=f(11538);class GP{get loop(){return this._loop}set loop(F){F!==this._loop&&(this._loop=F,this.updateOptions({loop:F}))}get currentTime(){var F;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(F=wP.b.audioEngine)&&void 0!==F&&F.audioContext&&(this.isPlaying||this.isPaused)){const F=this.isPaused?0:wP.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+F}return 0}get spatialSound(){return this._spatialSound}set spatialSound(F){if(F==this._spatialSound)return;const P=this.isPlaying;this.pause(),F?(this._spatialSound=F,this._updateSpatialParameters()):this._disableSpatialSound(),P&&this.play()}constructor(F,P,f){var c;let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new i.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=N.tP.Zero(),this._localDirection=new N.tP(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=F,f=f||t.b.LastCreatedScene)if(this._scene=f,GP._SceneComponentInitialization(f),this._readyToPlayCallback=q,this._customAttenuationFunction=(F,P,f,c,N)=>P<f?F*(1-P/f):0,A&&(this.autoplay=A.autoplay||!1,this._loop=A.loop||!1,void 0!==A.volume&&(this._volume=A.volume),this._spatialSound=A.spatialSound??!1,this.maxDistance=A.maxDistance??100,this.useCustomAttenuation=A.useCustomAttenuation??!1,this.rolloffFactor=A.rolloffFactor||1,this.refDistance=A.refDistance||1,this.distanceModel=A.distanceModel||"linear",this._playbackRate=A.playbackRate||1,this._streaming=A.streaming??!1,this._length=A.length,this._offset=A.offset),null!==(c=wP.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&wP.b.audioEngine.audioContext){this._soundGain=wP.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let F=!0;if(P)try{"string"===typeof P?(this._urlType="String",this._url=P):P instanceof ArrayBuffer?this._urlType="ArrayBuffer":P instanceof HTMLMediaElement?this._urlType="MediaElement":P instanceof MediaStream?this._urlType="MediaStream":P instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(P)&&(this._urlType="Array");let f=[],c=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wP.b.audioEngine.audioContext.createMediaElementSource(P),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wP.b.audioEngine.audioContext.createMediaStreamSource(P),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":P.byteLength>0&&(c=!0,this._soundLoaded(P));break;case"AudioBuffer":this._audioBufferLoaded(P);break;case"String":f.push(P);case"Array":0===f.length&&(f=P);for(let F=0;F<f.length;F++){const P=f[F];if(c=A&&A.skipCodecCheck||-1!==P.indexOf(".mp3",P.length-4)&&wP.b.audioEngine.isMP3supported||-1!==P.indexOf(".ogg",P.length-4)&&wP.b.audioEngine.isOGGsupported||-1!==P.indexOf(".wav",P.length-4)||-1!==P.indexOf(".m4a",P.length-4)||-1!==P.indexOf(".mp4",P.length-4)||-1!==P.indexOf("blob:"),c){this._streaming?(this._htmlAudioElement=new Audio(P),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,H.Tools.SetCorsBehavior(P,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(P,(F=>{this._soundLoaded(F)}),void 0,!0,!0,(F=>{F&&C.d.Error("XHR "+F.status+" error on: "+P+"."),C.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:F=!1}F?c||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):C.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(o){C.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),wP.b.audioEngine&&!wP.b.audioEngine.WarnedWebAudioUnsupported&&(C.d.Error("Web Audio is not supported by your browser."),wP.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var F;null!==(F=wP.b.audioEngine)&&void 0!==F&&F.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(F){var P;null!==(P=wP.b.audioEngine)&&void 0!==P&&P.audioContext&&(this._audioBuffer=F,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(F){var P;null!==(P=wP.b.audioEngine)&&void 0!==P&&P.audioContext&&wP.b.audioEngine.audioContext.decodeAudioData(F,(F=>{this._audioBufferLoaded(F)}),(F=>{C.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+F)}))}setAudioBuffer(F){var P;null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&(this._audioBuffer=F,this._isReadyToPlay=!0)}updateOptions(F){F&&(this.loop=F.loop??this.loop,this.maxDistance=F.maxDistance??this.maxDistance,this.useCustomAttenuation=F.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=F.rolloffFactor??this.rolloffFactor,this.refDistance=F.refDistance??this.refDistance,this.distanceModel=F.distanceModel??this.distanceModel,this._playbackRate=F.playbackRate??this._playbackRate,this._length=F.length??void 0,this.spatialSound=F.spatialSound??this._spatialSound,this._setOffset(F.offset??void 0),this.setVolume(F.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var F;null!==(F=wP.b.audioEngine)&&void 0!==F&&F.canUseWebAudio&&wP.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??wP.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var F;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(F=this._soundPanner)||void 0===F||F.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var F;null!==(F=wP.b.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(F){var P;null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(F),this._isOutputConnected=!0)}setDirectionalCone(F,P,f){P<F?C.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=F,this._coneOuterAngle=P,this._coneOuterGain=f,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(F){if(F!=this._coneInnerAngle){var P;if(this._coneOuterAngle<F)return void C.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=F,null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(F){if(F!=this._coneOuterAngle){var P;if(F<this._coneInnerAngle)return void C.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=F,null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(F){var P;F.equals(this._position)||(this._position.q(F),null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(F){var P;this._localDirection=F,null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const F=this._connectedTransformNode.getWorldMatrix(),P=N.tP.TransformNormal(this._localDirection,F);P.normalize(),this._soundPanner.orientationX.value=P.x,this._soundPanner.orientationY.value=P.y,this._soundPanner.orientationZ.value=P.z}updateDistanceFromListener(){var F;if(null!==(F=wP.b.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const F=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.CP(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,F,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(F){this._customAttenuationFunction=F}play(F,P,f){var c;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(c=wP.b.audioEngine)&&void 0!==c&&c.audioContext)try{var N,q;this._clearTimeoutsAndObservers();let c=F?(null===(N=wP.b.audioEngine)||void 0===N?void 0:N.audioContext.currentTime)+F:null===(q=wP.b.audioEngine)||void 0===q?void 0:q.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=wP.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const F=()=>{var f;if(null!==(f=wP.b.audioEngine)&&void 0!==f&&f.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=P??0;const f=this._htmlAudioElement.play();void 0!==f&&f.catch((()=>{var P,f;(null===(P=wP.b.audioEngine)||void 0===P||P.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(f=wP.b.audioEngine)||void 0===f?void 0:f.onAudioUnlockedObservable.addOnce((()=>{F()})))}))}else{var c;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(c=wP.b.audioEngine)||void 0===c?void 0:c.onAudioUnlockedObservable.addOnce((()=>{F()}))}};F()}}else{var H;const N=()=>{var N;if(null!==(N=wP.b.audioEngine)&&void 0!==N&&N.audioContext){var q;if(f=f||this._length,void 0!==P&&this._setOffset(P),this._soundSource){const F=this._soundSource;F.onended=()=>{F.disconnect()}}if(this._soundSource=null===(q=wP.b.audioEngine)||void 0===q?void 0:q.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var H;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==P&&(this._soundSource.loopStart=P),void 0!==f&&(this._soundSource.loopEnd=(0|P)+f),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},c=F?(null===(H=wP.b.audioEngine)||void 0===H?void 0:H.audioContext.currentTime)+F:wP.b.audioEngine.audioContext.currentTime;const N=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(c,N,this.loop?void 0:f)}}};"suspended"===(null===(H=wP.b.audioEngine)||void 0===H?void 0:H.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var F;"suspended"===(null===(F=wP.b.audioEngine)||void 0===F?void 0:F.audioContext.state)?(wP.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=wP.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{N()})))):N()}),500):N()}this._startTime=c,this.isPlaying=!0,this.isPaused=!1}catch(A){C.d.Error("Error while trying to play audio: "+this.name+", "+A.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(F){var P;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var f;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(f=this._streamingSource)||void 0===f||f.disconnect();this.isPlaying=!1}else if(null!==(P=wP.b.audioEngine)&&void 0!==P&&P.audioContext&&this._soundSource){const P=F?wP.b.audioEngine.audioContext.currentTime+F:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(P)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var F;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var P;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(P=this._streamingSource)||void 0===P||P.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(F=wP.b.audioEngine)&&void 0!==F&&F.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=wP.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(F,P){var f;null!==(f=wP.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._soundGain&&(P&&wP.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(wP.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,wP.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(F,wP.b.audioEngine.audioContext.currentTime+P)):this._soundGain.gain.value=F),this._volume=F}setPlaybackRate(F){this._playbackRate=F,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(F){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=F,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=F=>this._onRegisterAfterWorldMatrixUpdate(F),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(F){var P;if(F.getBoundingInfo){const P=F.getBoundingInfo();this.setPosition(P.boundingSphere.centerWorld)}else this.setPosition(F.absolutePosition);null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const F=()=>{(0,gP.f)((()=>this._isReadyToPlay),(()=>{f._audioBuffer=this.getAudioBuffer(),f._isReadyToPlay=!0,f.autoplay&&f.play(0,this._offset,this._length)}),void 0,300)},P={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},f=new GP(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,P);return this.useCustomAttenuation&&f.setAttenuationFunction(this._customAttenuationFunction),f.setPosition(this._position),f.setPlaybackRate(this._playbackRate),F(),f}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const F={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(F.connectedMeshId=this._connectedTransformNode.id),F.position=this._position.pf(),F.refDistance=this.refDistance,F.distanceModel=this.distanceModel,F.isDirectional=this._isDirectional,F.localDirectionToMesh=this._localDirection.pf(),F.coneInnerAngle=this._coneInnerAngle,F.coneOuterAngle=this._coneOuterAngle,F.coneOuterGain=this._coneOuterGain),F}static Parse(F,P,f,c){const q=F.name;let H;H=F.url?f+F.url:f+q;const A={autoplay:F.autoplay,loop:F.loop,volume:F.volume,spatialSound:F.spatialSound,maxDistance:F.maxDistance,rolloffFactor:F.rolloffFactor,refDistance:F.refDistance,distanceModel:F.distanceModel,playbackRate:F.playbackRate};let o;if(c){const F=()=>{(0,gP.f)((()=>c._isReadyToPlay),(()=>{o._audioBuffer=c.getAudioBuffer(),o._isReadyToPlay=!0,o.autoplay&&o.play(0,o._offset,o._length)}),void 0,300)};o=new GP(q,new ArrayBuffer(0),P,null,A),F()}else o=new GP(q,H,P,(()=>{P.removePendingData(o)}),A),P.addPendingData(o);if(F.position){const P=N.tP.zP(F.position);o.setPosition(P)}if(F.isDirectional&&(o.setDirectionalCone(F.coneInnerAngle||360,F.coneOuterAngle||360,F.coneOuterGain||0),F.localDirectionToMesh)){const P=N.tP.zP(F.localDirectionToMesh);o.setLocalDirectionToMesh(P)}if(F.connectedMeshId){const f=P.getMeshById(F.connectedMeshId);f&&o.attachToMesh(f)}return F.metadata&&(o.metadata=F.metadata),o}_setOffset(F){this._offset!==F&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=F)}_clearTimeoutsAndObservers(){var F;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(F=wP.b.audioEngine)||void 0===F||F.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}GP._SceneComponentInitialization=F=>{throw(0,aP.e)("AudioSceneComponent")},(0,yF.f)("BABYLON.Sound",GP);class hP{constructor(F,P,f){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],P.length!==f.length)throw new Error("Sounds length does not equal weights length");this.loop=F,this._weights=f;let c=0;for(const q of f)c+=q;const N=c>0?1/c:0;for(let q=0;q<this._weights.length;q++)this._weights[q]*=N;this._sounds=P;for(const q of this._sounds)q.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(F){if(F!==this._coneInnerAngle){if(this._coneOuterAngle<F)return void C.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=F;for(const P of this._sounds)P.directionalConeInnerAngle=F}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(F){if(F!==this._coneOuterAngle){if(F<this._coneInnerAngle)return void C.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=F;for(const P of this._sounds)P.directionalConeOuterAngle=F}}get volume(){return this._volume}set volume(F){if(F!==this._volume)for(const P of this._sounds)P.setVolume(F)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(F){if(!this.isPaused){this.stop();const F=Math.random();let P=0;for(let f=0;f<this._weights.length;f++)if(P+=this._weights[f],F<=P){this._currentIndex=f;break}}const P=this._sounds[this._currentIndex??0];P.isReady()?P.play(0,this.isPaused?void 0:F):P.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class SP{constructor(F){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(F=F||t.b.LastCreatedScene)&&(this._scene=F,this.soundCollection=[],this._options=P,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var F;null!==(F=wP.b.audioEngine)&&void 0!==F&&F.canUseWebAudio&&wP.b.audioEngine.audioContext&&(this._outputAudioNode=wP.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(wP.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(wP.b.audioEngine&&wP.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(F){var P;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._outputAudioNode&&F.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==F.soundTrackId&&(-1===F.soundTrackId?this._scene.mainSoundTrack.removeSound(F):this._scene.soundTracks&&this._scene.soundTracks[F.soundTrackId].removeSound(F)),this.soundCollection.push(F),F.soundTrackId=this.id}removeSound(F){const P=this.soundCollection.indexOf(F);-1!==P&&this.soundCollection.splice(P,1)}setVolume(F){var P;null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=F)}switchPanningModelToHRTF(){var F;if(null!==(F=wP.b.audioEngine)&&void 0!==F&&F.canUseWebAudio)for(let P=0;P<this.soundCollection.length;P++)this.soundCollection[P].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var F;if(null!==(F=wP.b.audioEngine)&&void 0!==F&&F.canUseWebAudio)for(let P=0;P<this.soundCollection.length;P++)this.soundCollection[P].switchPanningModelToEqualPower()}connectToAnalyser(F){var P;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=F,null!==(P=wP.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,wP.b.audioEngine.masterGain))}}var Ff=f(11880),Pf=f(11845),ff=f(11471);wP.b.AudioEngineFactory=(F,P,f)=>new cf(F,P,f);class cf{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new i.d,this.onAudioLockedObservable=new i.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ff.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const c=document.createElement("audio");this._hostElement=F,this._audioContext=P,this._audioDestination=f;try{c&&c.canPlayType&&(c.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||c.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(N){}try{c&&c.canPlayType&&c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(N){}}lock(){this._triggerSuspendedState()}unlock(){var F,P;if("running"===(null===(F=this._audioContext)||void 0===F?void 0:F.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(P=this._audioContext)||void 0===P||P.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{C.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var F;null===(F=this._audioContext)||void 0===F||F.addEventListener("statechange",(()=>{var F;this.unlocked&&"running"!==(null===(F=this._audioContext)||void 0===F?void 0:F.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var F;return null!==(F=this._audioContext)&&void 0!==F&&F.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(F){this.canUseWebAudio=!1,C.d.Error("Web Audio: "+F.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(F){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const F=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",P=document.createElement("style");P.appendChild(document.createTextNode(F)),document.getElementsByTagName("head")[0].appendChild(P),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var F;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(F=this._audioContext)||void 0===F||F.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(F){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=F)}connectToAnalyser(F){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=F,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Nf=f(11480);(0,f(12963).g)(Ff.e.NAME_AUDIO,((F,P,f,c)=>{let N,q=[];if(f.FY=f.FY||[],void 0!==F.FY&&null!==F.FY)for(let A=0,o=F.FY.length;A<o;A++){var H;const o=F.FY[A];null!==(H=wP.b.audioEngine)&&void 0!==H&&H.canUseWebAudio?(o.url||(o.url=o.name),q[o.url]?f.FY.push(GP.Parse(o,P,c,q[o.url])):(N=GP.Parse(o,P,c),q[o.url]=N,f.FY.push(N))):f.FY.push(new GP(o.name,null,P))}q=[]})),Object.defineProperty(Pf.e.prototype,"mainSoundTrack",{get:function(){let F=this._getComponent(Ff.e.NAME_AUDIO);return F||(F=new qf(this),this.o(F)),this._mainSoundTrack||(this._mainSoundTrack=new SP(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Pf.e.prototype.getSoundByName=function(F){let P;for(P=0;P<this.mainSoundTrack.soundCollection.length;P++)if(this.mainSoundTrack.soundCollection[P].name===F)return this.mainSoundTrack.soundCollection[P];if(this.soundTracks)for(let f=0;f<this.soundTracks.length;f++)for(P=0;P<this.soundTracks[f].soundCollection.length;P++)if(this.soundTracks[f].soundCollection[P].name===F)return this.soundTracks[f].soundCollection[P];return null},Object.defineProperty(Pf.e.prototype,"audioEnabled",{get:function(){let F=this._getComponent(Ff.e.NAME_AUDIO);return F||(F=new qf(this),this.o(F)),F.audioEnabled},set:function(F){let P=this._getComponent(Ff.e.NAME_AUDIO);P||(P=new qf(this),this.o(P)),F?P.enableAudio():P.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Pf.e.prototype,"headphone",{get:function(){let F=this._getComponent(Ff.e.NAME_AUDIO);return F||(F=new qf(this),this.o(F)),F.headphone},set:function(F){let P=this._getComponent(Ff.e.NAME_AUDIO);P||(P=new qf(this),this.o(P)),F?P.switchAudioModeForHeadphones():P.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Pf.e.prototype,"audioListenerPositionProvider",{get:function(){let F=this._getComponent(Ff.e.NAME_AUDIO);return F||(F=new qf(this),this.o(F)),F.audioListenerPositionProvider},set:function(F){let P=this._getComponent(Ff.e.NAME_AUDIO);if(P||(P=new qf(this),this.o(P)),F&&"function"!==typeof F)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");P.audioListenerPositionProvider=F},enumerable:!0,configurable:!0}),Object.defineProperty(Pf.e.prototype,"audioListenerRotationProvider",{get:function(){let F=this._getComponent(Ff.e.NAME_AUDIO);return F||(F=new qf(this),this.o(F)),F.audioListenerRotationProvider},set:function(F){let P=this._getComponent(Ff.e.NAME_AUDIO);if(P||(P=new qf(this),this.o(P)),F&&"function"!==typeof F)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");P.audioListenerRotationProvider=F},enumerable:!0,configurable:!0}),Object.defineProperty(Pf.e.prototype,"audioPositioningRefreshRate",{get:function(){let F=this._getComponent(Ff.e.NAME_AUDIO);return F||(F=new qf(this),this.o(F)),F.audioPositioningRefreshRate},set:function(F){let P=this._getComponent(Ff.e.NAME_AUDIO);P||(P=new qf(this),this.o(P)),P.audioPositioningRefreshRate=F},enumerable:!0,configurable:!0});class qf{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(F){this.name=Ff.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new N.tP,this._cachedCameraPosition=new N.tP,this._lastCheck=0,this._invertMatrixTemp=new N.Matrix,this._cameraDirectionTemp=new N.tP,(F=F||t.b.LastCreatedScene)&&(this.LP=F,F.soundTracks=[],F.FY=[])}register(){this.LP._afterRenderStage.registerStep(Ff.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(F){if(F.FY=[],this.LP.soundTracks)for(let P=0;P<this.LP.soundTracks.length;P++){const f=this.LP.soundTracks[P];for(let P=0;P<f.soundCollection.length;P++)F.FY.push(f.soundCollection[P].serialize())}}addFromContainer(F){if(F.FY)for(const P of F.FY)P.play(),P.autoplay=!0,this.LP.mainSoundTrack.addSound(P)}removeFromContainer(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(F.FY)for(const f of F.FY)f.stop(),f.autoplay=!1,this.LP.mainSoundTrack.removeSound(f),P&&f.dispose()}dispose(){const F=this.LP;if(F._mainSoundTrack&&F.mainSoundTrack.dispose(),F.soundTracks)for(let P=0;P<F.soundTracks.length;P++)F.soundTracks[P].dispose()}disableAudio(){const F=this.LP;let P;for(this._audioEnabled=!1,wP.b.audioEngine&&wP.b.audioEngine.audioContext&&wP.b.audioEngine.audioContext.suspend(),P=0;P<F.mainSoundTrack.soundCollection.length;P++)F.mainSoundTrack.soundCollection[P].pause();if(F.soundTracks)for(P=0;P<F.soundTracks.length;P++)for(let f=0;f<F.soundTracks[P].soundCollection.length;f++)F.soundTracks[P].soundCollection[f].pause()}enableAudio(){const F=this.LP;let P;for(this._audioEnabled=!0,wP.b.audioEngine&&wP.b.audioEngine.audioContext&&wP.b.audioEngine.audioContext.resume(),P=0;P<F.mainSoundTrack.soundCollection.length;P++)F.mainSoundTrack.soundCollection[P].isPaused&&F.mainSoundTrack.soundCollection[P].play();if(F.soundTracks)for(P=0;P<F.soundTracks.length;P++)for(let f=0;f<F.soundTracks[P].soundCollection.length;f++)F.soundTracks[P].soundCollection[f].isPaused&&F.soundTracks[P].soundCollection[f].play()}switchAudioModeForHeadphones(){const F=this.LP;if(this._headphone=!0,F.mainSoundTrack.switchPanningModelToHRTF(),F.soundTracks)for(let P=0;P<F.soundTracks.length;P++)F.soundTracks[P].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const F=this.LP;if(this._headphone=!1,F.mainSoundTrack.switchPanningModelToEqualPower(),F.soundTracks)for(let P=0;P<F.soundTracks.length;P++)F.soundTracks[P].switchPanningModelToEqualPower()}_afterRender(){const F=Nf.d.Now;if(this._lastCheck&&F-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=F;const P=this.LP;if(!this._audioEnabled||!P._mainSoundTrack||!P.soundTracks||0===P._mainSoundTrack.soundCollection.length&&1===P.soundTracks.length)return;const f=wP.b.audioEngine;if(f&&f.audioContext){let F,c=P.activeCamera;if(P.activeCameras&&P.activeCameras.length>0&&(c=P.activeCameras[0]),this.audioListenerPositionProvider){const F=this.audioListenerPositionProvider();f.audioContext.listener.setPosition(F.x||0,F.y||0,F.z||0)}else c?this._cachedCameraPosition.equals(c.globalPosition)||(this._cachedCameraPosition.q(c.globalPosition),f.audioContext.listener.setPosition(c.globalPosition.x,c.globalPosition.y,c.globalPosition.z)):f.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const F=this.audioListenerRotationProvider();f.audioContext.listener.setOrientation(F.x||0,F.y||0,F.z||0,0,1,0)}else c?(c.rigCameras&&c.rigCameras.length>0&&(c=c.rigCameras[0]),c.getViewMatrix().invertToRef(this._invertMatrixTemp),N.tP.TransformNormalToRef(qf._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.q(this._cameraDirectionTemp),f.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):f.audioContext.listener.setOrientation(0,0,0,0,1,0);for(F=0;F<P.mainSoundTrack.soundCollection.length;F++){const f=P.mainSoundTrack.soundCollection[F];f.useCustomAttenuation&&f.updateDistanceFromListener()}if(P.soundTracks)for(F=0;F<P.soundTracks.length;F++)for(let f=0;f<P.soundTracks[F].soundCollection.length;f++){const c=P.soundTracks[F].soundCollection[f];c.useCustomAttenuation&&c.updateDistanceFromListener()}}}}qf._CameraDirection=new N.tP(0,0,-1),GP._SceneComponentInitialization=F=>{let P=F._getComponent(Ff.e.NAME_AUDIO);P||(P=new qf(F),F.o(P))};const Hf="MSFT_audio_emitter";class Af{constructor(F){this.name=Hf,this._loader=F,this.enabled=this._loader.isExtensionUsed(Hf)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const F=this._loader.kf.extensions;if(F&&F[this.name]){const P=F[this.name];this._clips=P.clips,this._emitters=P.emitters,W.Assign(this._clips),W.Assign(this._emitters)}}loadSceneAsync(F,P){return v.LoadExtensionAsync(F,P,this.name,(async(f,c)=>{const N=new Array;N.push(this._loader.loadSceneAsync(F,P));for(const F of c.emitters){const P=W.Get(`${f}/emitters`,this._emitters,F);if(void 0!=P.refDistance||void 0!=P.maxDistance||void 0!=P.rolloffFactor||void 0!=P.distanceModel||void 0!=P.innerAngle||void 0!=P.outerAngle)throw new Error(`${f}: Direction or Distance properties are not allowed on emitters attached to a scene`);N.push(this._loadEmitterAsync(`${f}/emitters/${P.index}`,P))}await Promise.all(N)}))}loadNodeAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(F,c)=>{const q=new Array,A=await this._loader.loadNodeAsync(F,P,(P=>{for(const f of c.emitters){const c=W.Get(`${F}/emitters`,this._emitters,f);q.push(this._loadEmitterAsync(`${F}/emitters/${c.index}`,c).then((()=>{for(const F of c._babylonSounds)F.attachToMesh(P),void 0==c.innerAngle&&void 0==c.outerAngle||(F.setLocalDirectionToMesh(N.tP.Forward()),F.setDirectionalCone(2*H.Tools.ToDegrees(void 0==c.innerAngle?Math.PI:c.innerAngle),2*H.Tools.ToDegrees(void 0==c.outerAngle?Math.PI:c.outerAngle),0))})))}f(P)}));return await Promise.all(q),A}))}loadAnimationAsync(F,P){return v.LoadExtensionAsync(F,P,this.name,(async(f,c)=>{const N=await this._loader.loadAnimationAsync(F,P),q=new Array;W.Assign(c.events);for(const H of c.events)q.push(this._loadAnimationEventAsync(`${f}/events/${H.index}`,F,P,H,N));return await Promise.all(q),N}))}_loadClipAsync(F,P){if(P._objectURL)return P._objectURL;let f;if(P.uri)f=this._loader.loadUriAsync(F,P,P.uri);else{const c=W.Get(`${F}/bufferView`,this._loader.kf.bufferViews,P.bufferView);f=this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}return P._objectURL=f.then((F=>URL.createObjectURL(new Blob([F],{type:P.mimeType})))),P._objectURL}_loadEmitterAsync(F,P){if(P._babylonSounds=P._babylonSounds||[],!P._babylonData){const F=new Array,f=P.name||`emitter${P.index}`,c={loop:!1,autoplay:!1,volume:void 0==P.volume?1:P.volume};for(let q=0;q<P.clips.length;q++){const N=`/extensions/${this.name}/clips`,H=W.Get(N,this._clips,P.clips[q].clip);F.push(this._loadClipAsync(`${N}/${P.clips[q].clip}`,H).then((F=>{const N=P._babylonSounds[q]=new GP(f,F,this._loader.babylonScene,null,c);N.refDistance=P.refDistance||1,N.maxDistance=P.maxDistance||256,N.rolloffFactor=P.rolloffFactor||1,N.distanceModel=P.distanceModel||"exponential"})))}const N=Promise.all(F).then((()=>{const F=P.clips.map((F=>F.weight||1)),f=new hP(P.loop||!1,P._babylonSounds,F);P.innerAngle&&(f.directionalConeInnerAngle=2*H.Tools.ToDegrees(P.innerAngle)),P.outerAngle&&(f.directionalConeOuterAngle=2*H.Tools.ToDegrees(P.outerAngle)),P.volume&&(f.volume=P.volume),P._babylonData.sound=f}));P._babylonData={loaded:N}}return P._babylonData.loaded}_getEventAction(F,P,f,c,N){switch(f){case"play":return F=>{const f=(N||0)+(F-c);P.play(f)};case"stop":return()=>{P.stop()};case"pause":return()=>{P.pause()};default:throw new Error(`${F}: Unsupported action ${f}`)}}_loadAnimationEventAsync(F,P,f,c,N){if(0==N.targetedAnimations.length)return Promise.resolve();const q=N.targetedAnimations[0],H=c.cP,A=W.Get(`/extensions/${this.name}/emitters`,this._emitters,H);return this._loadEmitterAsync(F,A).then((()=>{const P=A._babylonData.sound;if(P){const f=new mP(c.time,this._getEventAction(F,P,c.action,c.time,c.startOffset));q.animation.addEvent(f),N.onAnimationGroupEndObservable.add((()=>{P.stop()})),N.onAnimationGroupPauseObservable.add((()=>{P.pause()}))}}))}}U(Hf),p(Hf,!0,(F=>new Af(F)));const of="MSFT_lod";class jf{constructor(F){var P;this.name=of,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new i.d,this.onMaterialLODsLoadedObservable=new i.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=F,this.maxLODsToLoad=(null===(P=this._loader.parent.extensionOptions[of])||void 0===P?void 0:P.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(of)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let F=0;F<this._nodePromiseLODs.length;F++){const P=Promise.all(this._nodePromiseLODs[F]).then((()=>{0!==F&&(this._loader.endPerformanceCounter(`Node LOD ${F}`),this._loader.log(`Loaded node LOD ${F}`)),this.onNodeLODsLoadedObservable.notifyObservers(F),F!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${F+1}`),this._loadBufferLOD(this._nodeBufferLODs,F+1),this._nodeSignalLODs[F]&&this._nodeSignalLODs[F].resolve())}));this._loader._completePromises.push(P)}for(let F=0;F<this._materialPromiseLODs.length;F++){const P=Promise.all(this._materialPromiseLODs[F]).then((()=>{0!==F&&(this._loader.endPerformanceCounter(`Material LOD ${F}`),this._loader.log(`Loaded material LOD ${F}`)),this.onMaterialLODsLoadedObservable.notifyObservers(F),F!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${F+1}`),this._loadBufferLOD(this._materialBufferLODs,F+1),this._materialSignalLODs[F]&&this._materialSignalLODs[F].resolve())}));this._loader._completePromises.push(P)}}loadSceneAsync(F,P){const f=this._loader.loadSceneAsync(F,P);return this._loadBufferLOD(this._bufferLODs,0),f}loadNodeAsync(F,P,f){return v.LoadExtensionAsync(F,P,this.name,(async(F,N)=>{let q;const H=this._getLODs(F,P,this._loader.kf.nodes,N.ids);this._loader.logOpen(`${F}`);for(let P=0;P<H.length;P++){const F=H[P];0!==P&&(this._nodeIndexLOD=P,this._nodeSignalLODs[P]=this._nodeSignalLODs[P]||new c);const N=F=>{f(F),F.To(!1)},A=this._loader.loadNodeAsync(`/nodes/${F.index}`,F,N).then((F=>{if(0!==P){const F=H[P-1];F._babylonTransformNode&&(this._disposeTransformNode(F._babylonTransformNode),delete F._babylonTransformNode)}return F.To(!0),F}));this._nodePromiseLODs[P]=this._nodePromiseLODs[P]||[],0===P?q=A:(this._nodeIndexLOD=null,this._nodePromiseLODs[P].push(A))}return this._loader.logClose(),await q}))}_loadMaterialAsync(F,P,f,c,N){return this._nodeIndexLOD?null:v.LoadExtensionAsync(F,P,this.name,(async(F,q)=>{let H;const A=this._getLODs(F,P,this._loader.kf.materials,q.ids);this._loader.logOpen(`${F}`);for(let P=0;P<A.length;P++){const F=A[P];0!==P&&(this._materialIndexLOD=P);const q=this._loader._loadMaterialAsync(`/materials/${F.index}`,F,f,c,(F=>{0===P&&N(F)})).then((F=>{if(0!==P){N(F);const f=A[P-1]._data;f[c]&&(this._disposeMaterials([f[c].babylonMaterial]),delete f[c])}return F}));this._materialPromiseLODs[P]=this._materialPromiseLODs[P]||[],0===P?H=q:(this._materialIndexLOD=null,this._materialPromiseLODs[P].push(q))}return this._loader.logClose(),await H}))}_loadUriAsync(F,P,f){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const N=this._nodeIndexLOD-1;return this._nodeSignalLODs[N]=this._nodeSignalLODs[N]||new c,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(F,P,f)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const N=this._materialIndexLOD-1;return this._materialSignalLODs[N]=this._materialSignalLODs[N]||new c,this._materialSignalLODs[N].promise.then((async()=>await this._loader.loadUriAsync(F,P,f)))}return null}loadBufferAsync(F,P,f,N){if(this._loader.parent.useRangeRequests&&!P.uri){if(!this._loader.bin)throw new Error(`${F}: Uri is missing or the binary glTF is missing its binary chunk`);const P=async(F,P)=>{const q=f,H=q+N-1;let A=F[P];return A?(A.start=Math.min(A.start,q),A.end=Math.max(A.end,H)):(A={start:q,end:H,loaded:new c},F[P]=A),await A.loaded.promise.then((F=>new Uint8Array(F.buffer,F.byteOffset+f-A.start,N)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?P(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?P(this._materialBufferLODs,this._materialIndexLOD):P(this._bufferLODs,0)}return null}_loadBufferLOD(F,P){const f=F[P];f&&(this._loader.log(`Loading buffer range [${f.start}-${f.end}]`),this._loader.bin.readAsync(f.start,f.end-f.start+1).then((F=>{f.loaded.resolve(F)}),(F=>{f.loaded.reject(F)})))}_getLODs(F,P,f,c){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const N=[];for(let q=c.length-1;q>=0;q--)if(N.push(W.Get(`${F}/ids/${c[q]}`,f,c[q])),N.length===this.maxLODsToLoad)return N;return N.push(P),N}_disposeTransformNode(F){const P=[],f=F.material;f&&P.push(f);for(const N of F.getChildMeshes())N.material&&P.push(N.material);F.dispose();const c=P.filter((F=>this._loader.babylonScene.meshes.every((P=>P.material!=F))));this._disposeMaterials(c)}_disposeMaterials(F){const P={};for(const f of F){for(const F of f.getActiveTextures())P[F.uniqueId]=F;f.dispose()}for(const f in P)for(const F of this._loader.babylonScene.materials)F.hasTexture(P[f])&&delete P[f];for(const f in P)P[f].dispose()}}U(of),p(of,!0,(F=>new jf(F)));const uf="MSFT_minecraftMesh";class Tf{constructor(F){this.name=uf,this._loader=F,this.enabled=this._loader.isExtensionUsed(uf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtraAsync(F,P,this.name,(async(c,N)=>{if(N){if(!(f instanceof z.c))throw new Error(`${c}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(F,P,f);return f.needAlphaBlending()&&(f.forceDepthWrite=!0,f.separateCullingPass=!0),f.Pc=f.forceDepthWrite,f.twoSidedLighting=!0,await N}}))}}U(uf),p(uf,!0,(F=>new Tf(F)));const Yf="MSFT_sRGBFactors";class tf{constructor(F){this.name=Yf,this._loader=F,this.enabled=this._loader.isExtensionUsed(Yf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,P,f){return v.LoadExtraAsync(F,P,this.name,(async(c,N)=>{if(N){if(!(f instanceof z.c))throw new Error(`${c}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(F,P,f),q=f.OF().getEngine().useExactSrgbConversions;return f.albedoTexture||f.albedoColor.toLinearSpaceToRef(f.albedoColor,q),f.reflectivityTexture||f.reflectivityColor.toLinearSpaceToRef(f.reflectivityColor,q),await N}}))}}U(Yf),p(Yf,!0,(F=>new tf(F)));var Cf=f(13241);const Lf={};var Jf=f(13303),Bf=f(13280),zf=f(13249),Zf=f(13265);function Rf(F,P){for(const f of F)for(const F of f.dataOutputs)if(F.uniqueId===P)return F;throw new Error("Could not find data out connection with unique id "+P)}function yf(F,P){for(const f of F)if(f instanceof Bf.d)for(const F of f.signalInputs)if(F.uniqueId===P)return F;throw new Error("Could not find signal in connection with unique id "+P)}async function Of(F,P){const c=await Promise.all(F.allBlocks.map((async F=>{const P=function(F){switch(F){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([f.e(78),f.e(79)]).then(f.bind(f,14794))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await f.e(80).then(f.bind(f,14796))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await f.e(81).then(f.bind(f,14803))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await f.e(82).then(f.bind(f,14807))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await f.e(83).then(f.bind(f,14813))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await f.e(84).then(f.bind(f,14815))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await f.e(85).then(f.bind(f,14818))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await f.e(86).then(f.bind(f,14823))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await f.e(87).then(f.bind(f,14827))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await f.e(90).then(f.bind(f,14857))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await f.e(90).then(f.bind(f,14857))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await f.e(90).then(f.bind(f,14857))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await f.e(90).then(f.bind(f,14857))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await f.e(95).then(f.bind(f,14862))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await f.e(96).then(f.bind(f,14867))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await f.e(97).then(f.bind(f,14870))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await f.e(98).then(f.bind(f,14875))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await f.e(99).then(f.bind(f,14880))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await f.e(100).then(f.bind(f,14888))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await f.e(101).then(f.bind(f,14890))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await f.e(102).then(f.bind(f,14898))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await f.e(103).then(f.bind(f,14905))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await f.e(104).then(f.bind(f,14912))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await f.e(105).then(f.bind(f,14920))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await f.e(106).then(f.bind(f,14926))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await f.e(107).then(f.bind(f,14928))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await f.e(108).then(f.bind(f,14933))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await f.e(109).then(f.bind(f,14936))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await f.e(110).then(f.bind(f,14943))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await f.e(111).then(f.bind(f,14947))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await f.e(112).then(f.bind(f,14950))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await f.e(113).then(f.bind(f,14952))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await f.e(92).then(f.bind(f,14954))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await f.e(114).then(f.bind(f,14958))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await f.e(115).then(f.bind(f,14963))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await f.e(116).then(f.bind(f,14972))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await f.e(93).then(f.bind(f,14976))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await f.e(88).then(f.bind(f,14835))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await f.e(94).then(f.bind(f,14984))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await f.e(94).then(f.bind(f,14984))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await f.e(94).then(f.bind(f,14984))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await f.e(94).then(f.bind(f,14984))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await f.e(94).then(f.bind(f,14984))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await f.e(94).then(f.bind(f,14984))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await f.e(94).then(f.bind(f,14984))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await f.e(94).then(f.bind(f,14984))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await f.e(89).then(f.bind(f,14855))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await f.e(90).then(f.bind(f,14857))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await f.e(90).then(f.bind(f,14857))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await f.e(91).then(f.bind(f,14991))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await f.e(91).then(f.bind(f,14991))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await f.e(91).then(f.bind(f,14991))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await f.e(91).then(f.bind(f,14991))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await f.e(91).then(f.bind(f,14991))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await f.e(91).then(f.bind(f,14991))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await f.e(117).then(f.bind(f,14996))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await f.e(118).then(f.bind(f,15e3))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await f.e(119).then(f.bind(f,15002))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await f.e(120).then(f.bind(f,15006))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await f.e(121).then(f.bind(f,15014))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await f.e(122).then(f.bind(f,15023))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await f.e(123).then(f.bind(f,15031))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await f.e(124).then(f.bind(f,15036))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await f.e(125).then(f.bind(f,15041))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await f.e(126).then(f.bind(f,15045))).FlowGraphDataSwitchBlock;default:if(Lf[F])return Lf[F];throw new Error(`Unknown block name ${F}`)}}(F.className);return await P()})));return function(F,P,f){const c=P.coordinator.createGraph(),N=[],q=P.valueParseFunction??zf.d;for(let H=0;H<F.allBlocks.length;H++){const A=Mf(F.allBlocks[H],{LP:P.coordinator.config.LP,pathConverter:P.pathConverter,assetsContainer:P.coordinator.config.LP,valueParseFunction:q},f[H]);N.push(A),A instanceof Jf.e&&c.addEventBlock(A)}for(const H of N){for(const F of H.dataInputs)for(const P of F.connectedPointIds){const f=Rf(N,P);F.connectTo(f)}if(H instanceof Bf.d)for(const F of H.signalOutputs)for(const P of F.connectedPointIds){const f=yf(N,P);F.connectTo(f)}}for(const H of F.executionContexts)df(H,{graph:c,valueParseFunction:q},F.rightHanded);return c}(F,P,c)}function df(F,P,f){const c=P.graph.createContext();F.enableLogging&&(c.enableLogging=!0),c.treatDataAsRightHanded=f||!1;const N=P.valueParseFunction??zf.d;c.uniqueId=F.uniqueId;const q=c.OF();if(F._assetsContext){var H,A,o,j,i,u,T,Y,t,C;const P=F._assetsContext,f={meshes:null===(H=P.meshes)||void 0===H?void 0:H.map((F=>q.getMeshById(F))),lights:null===(A=P.lights)||void 0===A?void 0:A.map((F=>q.getLightByName(F))),cameras:null===(o=P.cameras)||void 0===o?void 0:o.map((F=>q.getCameraByName(F))),materials:null===(j=P.materials)||void 0===j?void 0:j.map((F=>q.getMaterialById(F))),textures:null===(i=P.textures)||void 0===i?void 0:i.map((F=>q.getTextureByName(F))),animations:null===(u=P.animations)||void 0===u?void 0:u.map((F=>q.animations.find((P=>P.name===F)))),skeletons:null===(T=P.skeletons)||void 0===T?void 0:T.map((F=>q.getSkeletonByName(F))),zT:null===(Y=P.zT)||void 0===Y?void 0:Y.map((F=>q.getParticleSystemById(F))),animationGroups:null===(t=P.animationGroups)||void 0===t?void 0:t.map((F=>q.getAnimationGroupByName(F))),transformNodes:null===(C=P.transformNodes)||void 0===C?void 0:C.map((F=>q.getTransformNodeById(F))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],FY:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};c.assetsContext=f}for(const L in F._userVariables){const P=N(L,F._userVariables,c.assetsContext,q);c.userVariables[L]=P}for(const L in F._connectionValues){const P=N(L,F._connectionValues,c.assetsContext,q);c._setConnectionValueByKey(L,P)}return c}function Mf(F,P,f){const c={},N=P.valueParseFunction??zf.d;if(F.config)for(const H in F.config)c[H]=N(H,F.config,P.assetsContainer||P.LP,P.LP);if((0,zf.i)(F.className)){if(!P.pathConverter)throw new Error("Path converter is required for this block");c.pathConverter=P.pathConverter}const q=new f(c);q.uniqueId=F.uniqueId;for(let H=0;H<F.dataInputs.length;H++){const P=q.getDataInput(F.dataInputs[H].name);if(!P)throw new Error("Could not find data input with name "+F.dataInputs[H].name+" in block "+F.className);P.deserialize(F.dataInputs[H])}for(let H=0;H<F.dataOutputs.length;H++){const P=q.getDataOutput(F.dataOutputs[H].name);if(!P)throw new Error("Could not find data output with name "+F.dataOutputs[H].name+" in block "+F.className);P.deserialize(F.dataOutputs[H])}return q.metadata=F.metadata,q.deserialize&&q.deserialize(F),q}function Vf(F){const[P,f]=F.split(":");return Qf({op:P,extension:f})}function Qf(F){var P;let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const c=F.extension?null===(P=xf[F.extension])||void 0===P?void 0:P[F.op]:kf[F.op];if(!c&&(C.d.Warn(`No mapping found for operation ${F.op} and extension ${F.extension||"KHR_interactivity"}`),f)){const P={},f={flows:{}};if(F.inputValueSockets){P.values={};for(const f in F.inputValueSockets)P.values[f]={name:f}}return F.outputValueSockets&&(f.values={},Object.keys(F.outputValueSockets).forEach((F=>{f.values[F]={name:F}}))),{ei:[],inputs:P,outputs:f}}return c}function Kf(F,P,f){xf[P]||(xf[P]={}),xf[P][F]=f}const xf={BABYLON:{"flow/log":{ei:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},kf={"event/onStart":{ei:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{ei:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{ei:["FlowGraphSendCustomEventBlock"],extraProcessor(F,P,f,c,N){if("event/send"!==P.op||!F.configuration||1!==Object.keys(F.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const q=F.configuration.event.value[0];if("number"!==typeof q)throw new Error("Event id should be a number");const H=c.arrays.events[q],A=N[0];return A.config||(A.config={}),A.config.eventId=H.eventId,A.config.eventData=H.eventData,N}},"event/receive":{ei:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(F,P){var f;if(!F.configuration)return C.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const c=F.configuration.event;if(!c)return C.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const N=c.value[0];if("number"!==typeof N)return C.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(f=P.events)||void 0===f?void 0:f[N])?{valid:!0}:(C.d.Error(`Event with id ${N} not found`),{valid:!1,error:`Event with id ${N} not found`})},extraProcessor(F,P,f,c,N){if("event/receive"!==P.op||!F.configuration||1!==Object.keys(F.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const q=F.configuration.event.value[0];if("number"!==typeof q)throw new Error("Event id should be a number");const H=c.arrays.events[q],A=N[0];return A.config||(A.config={}),A.config.eventId=H.eventId,A.config.eventData=H.eventData,N}},"math/e":If("FlowGraphEBlock"),"math/pi":If("FlowGraphPIBlock"),"math/inf":If("FlowGraphInfBlock"),"math/nan":If("FlowGraphNaNBlock"),"math/abs":If("FlowGraphAbsBlock"),"math/sign":If("FlowGraphSignBlock"),"math/trunc":If("FlowGraphTruncBlock"),"math/floor":If("FlowGraphFloorBlock"),"math/ceil":If("FlowGraphCeilBlock"),"math/round":{ei:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N){var q;return(q=N[0]).config||(q.config={}),N[0].config.roundHalfAwayFromZero=!0,N}},"math/fract":If("FlowGraphFractBlock"),"math/neg":If("FlowGraphNegationBlock"),"math/add":If("FlowGraphAddBlock",["a","b"],!0),"math/sub":If("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{ei:["FlowGraphMultiplyBlock"],extraProcessor(F,P,f,c,N){var q;(q=N[0]).config||(q.config={}),N[0].config.useMatrixPerComponent=!0,N[0].config.preventIntegerFloatArithmetic=!0;let H=-1;return Object.keys(F.values||{}).find((P=>{var f;return void 0!==(null===(f=F.values)||void 0===f?void 0:f[P].type)&&(H=F.values[P].type,!0)})),-1!==H&&(N[0].config.type=c.arrays.types[H].flowGraphType),N},validation:F=>F.values?Ef(F):{valid:!0}},"math/div":If("FlowGraphDivideBlock",["a","b"],!0),"math/rem":If("FlowGraphModuloBlock",["a","b"]),"math/min":If("FlowGraphMinBlock",["a","b"]),"math/max":If("FlowGraphMaxBlock",["a","b"]),"math/clamp":If("FlowGraphClampBlock",["a","b","c"]),"math/saturate":If("FlowGraphSaturateBlock"),"math/mix":If("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":If("FlowGraphEqualityBlock",["a","b"]),"math/lt":If("FlowGraphLessThanBlock",["a","b"]),"math/le":If("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":If("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":If("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":If("FlowGraphIsNaNBlock"),"math/isinf":If("FlowGraphIsInfBlock"),"math/select":{ei:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{ei:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":If("FlowGraphSinBlock"),"math/cos":If("FlowGraphCosBlock"),"math/tan":If("FlowGraphTanBlock"),"math/asin":If("FlowGraphASinBlock"),"math/acos":If("FlowGraphACosBlock"),"math/atan":If("FlowGraphATanBlock"),"math/atan2":If("FlowGraphATan2Block",["a","b"]),"math/sinh":If("FlowGraphSinhBlock"),"math/cosh":If("FlowGraphCoshBlock"),"math/tanh":If("FlowGraphTanhBlock"),"math/asinh":If("FlowGraphASinhBlock"),"math/acosh":If("FlowGraphACoshBlock"),"math/atanh":If("FlowGraphATanhBlock"),"math/exp":If("FlowGraphExponentialBlock"),"math/log":If("FlowGraphLogBlock"),"math/log2":If("FlowGraphLog2Block"),"math/log10":If("FlowGraphLog10Block"),"math/sqrt":If("FlowGraphSquareRootBlock"),"math/cbrt":If("FlowGraphCubeRootBlock"),"math/pow":If("FlowGraphPowerBlock",["a","b"]),"math/length":If("FlowGraphLengthBlock"),"math/normalize":If("FlowGraphNormalizeBlock"),"math/dot":If("FlowGraphDotBlock",["a","b"]),"math/cross":If("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":If("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":If("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{ei:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{ei:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{ei:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{ei:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{ei:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{ei:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{ei:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":If("FlowGraphTransposeBlock"),"math/determinant":If("FlowGraphDeterminantBlock"),"math/inverse":If("FlowGraphInvertMatrixBlock"),"math/matmul":If("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{ei:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"cc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N,q){const H=N[0].dataInputs.find((F=>"rotationQuaternion"===F.name));if(!H)throw new Error("Rotation quaternion input not found");return q._connectionValues[H.uniqueId]&&(q._connectionValues[H.uniqueId].type="Quaternion"),N}},"math/matDecompose":{ei:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"cc"}}}},"math/quatConjugate":If("FlowGraphConjugateBlock",["a"]),"math/quatMul":{ei:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N){var q;return(q=N[0]).config||(q.config={}),N[0].config.type="Quaternion",N}},"math/quatAngleBetween":If("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{ei:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":If("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":If("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{ei:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N){var q;return(q=N[0]).config||(q.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract2x2":{ei:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{ei:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N){var q;return(q=N[0]).config||(q.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract3x3":{ei:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{ei:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N){var q;return(q=N[0]).config||(q.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract4x4":{ei:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{ei:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N,q){var H,A;(A=N[0]).config||(A.config={});const o=N[0].dataInputs[0];return N[0].config.valueType=(null===(H=q._connectionValues[o.uniqueId])||void 0===H?void 0:H.type)??"FlowGraphInteger",N}},"math/and":{ei:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N,q){var H,A,o;(o=N[0]).config||(o.config={});const j=N[0].dataInputs[0],i=N[0].dataInputs[1];return N[0].config.valueType=(null===(H=q._connectionValues[j.uniqueId])||void 0===H?void 0:H.type)??(null===(A=q._connectionValues[i.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",N}},"math/or":{ei:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N,q){var H,A,o;(o=N[0]).config||(o.config={});const j=N[0].dataInputs[0],i=N[0].dataInputs[1];return N[0].config.valueType=(null===(H=q._connectionValues[j.uniqueId])||void 0===H?void 0:H.type)??(null===(A=q._connectionValues[i.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",N}},"math/xor":{ei:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,P,f,c,N,q){var H,A,o;(o=N[0]).config||(o.config={});const j=N[0].dataInputs[0],i=N[0].dataInputs[1];return N[0].config.valueType=(null===(H=q._connectionValues[j.uniqueId])||void 0===H?void 0:H.type)??(null===(A=q._connectionValues[i.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",N}},"math/asr":If("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":If("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":If("FlowGraphLeadingZerosBlock"),"math/ctz":If("FlowGraphTrailingZerosBlock"),"math/popcnt":If("FlowGraphOneBitsCounterBlock"),"math/rad":If("FlowGraphDegToRadBlock"),"math/deg":If("FlowGraphRadToDegBlock"),"type/boolToInt":If("FlowGraphBooleanToInt"),"type/boolToFloat":If("FlowGraphBooleanToFloat"),"type/intToBool":If("FlowGraphIntToBoolean"),"type/intToFloat":If("FlowGraphIntToFloat"),"type/floatToInt":If("FlowGraphFloatToInt"),"type/floatToBool":If("FlowGraphFloatToBoolean"),"flow/sequence":{ei:["FlowGraphSequenceBlock"],extraProcessor(F,P,f,c,N){const q=N[0];return q.config||(q.config={}),q.config.outputSignalCount=Object.keys(F.flows||[]).length,q.signalOutputs.forEach(((F,P)=>{F.name="out_"+P})),N}},"flow/branch":{ei:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{ei:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(F){if(F.configuration&&F.configuration.cases){const P=F.configuration.cases.value;if(!P.every((F=>"number"===typeof F&&/^-?\d+$/.test(F.toString()))))return C.d.Warn("Switch cases should be integers. Using empty array instead."),F.configuration.cases.value=[],{valid:!0};const f=new Set(P);F.configuration.cases.value=Array.from(f)}return{valid:!0}},extraProcessor(F,P,f,c,N){if("flow/switch"!==P.op||!F.flows||0===Object.keys(F.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return N[0].signalOutputs.forEach((F=>{"default"!==F.name&&(F.name="out_"+F.name)})),N}},"flow/while":{ei:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{ei:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(F,P,f,c,N){const q=N[0];return q.config||(q.config={}),q.config.incrementIndexWhenLoopDone=!0,N}},"flow/doN":{ei:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{ei:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(F,P,f,c,N){if("flow/multiGate"!==P.op||!F.flows||0===Object.keys(F.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const q=N[0];return q.config||(q.config={}),q.config.outputSignalCount=Object.keys(F.flows).length,q.signalOutputs.forEach(((F,P)=>{F.name="out_"+P})),N}},"flow/waitAll":{ei:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(F){var P,f;return"number"!==typeof(null===(P=F.configuration)||void 0===P||null===(f=P.inputFlows)||void 0===f?void 0:f.value[0])&&(F.configuration=F.configuration||{inputFlows:{value:[0]}},F.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{ei:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{ei:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{ei:["FlowGraphCancelDelayBlock"]},"variable/get":{ei:["FlowGraphGetVariableBlock"],validation(F){var P,f;return null!==(P=F.configuration)&&void 0!==P&&null!==(f=P.variable)&&void 0!==f&&f.value?{valid:!0}:(C.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(F,P)=>[P.getVariableName(F[0])]}}},"variable/set":{ei:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(F,P)=>[P.getVariableName(F[0])]}}},"variable/setMultiple":{ei:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(F,P)=>[F[0].map((F=>P.getVariableName(F)))]}},extraProcessor:(F,P,f,c,N)=>(N[0].dataInputs.forEach((F=>{F.name=c.getVariableName(+F.name)})),N)},"variable/interpolate":{ei:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(F,P)=>[P.getVariableName(F[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:F=>!0===F[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",df:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",df:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",df:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",df:"FlowGraphPlayAnimationBlock"},out:{name:"out",df:"FlowGraphPlayAnimationBlock"},done:{name:"done",df:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(F,P,f,c,N){var q,H,A;const o=N[0],j=null===(q=F.configuration)||void 0===q?void 0:q.variable.value[0];if("number"!==typeof j)throw C.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const i=c.arrays.staticVariables[j];"undefined"===typeof o.config.animationType.value&&(c.arrays.staticVariables,o.config.animationType.value=(0,Zf.y)(i.type));const u=N[4];return u.config||(u.config={}),(H=u.config).variable||(H.variable={}),u.config.variable.value=c.getVariableName(j),(A=N[3]).config||(A.config={}),N}},"pointer/get":{ei:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",df:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",df:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(F,P,f,c,N)=>(N.forEach((F=>{"FlowGraphJsonPointerParserBlock"===F.className&&(F.config||(F.config={}),F.config.outputValue=!0)})),N)},"pointer/set":{ei:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",df:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",df:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(F,P,f,c,N)=>(N.forEach((F=>{"FlowGraphJsonPointerParserBlock"===F.className&&(F.config||(F.config={}),F.config.outputValue=!0)})),N)},"pointer/interpolate":{ei:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",df:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",df:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",df:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",df:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",df:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",df:"FlowGraphPlayAnimationBlock"},out:{name:"out",df:"FlowGraphPlayAnimationBlock"},done:{name:"done",df:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(F,P,f,c,N)=>(N.forEach((P=>{"FlowGraphJsonPointerParserBlock"===P.className?(P.config||(P.config={}),P.config.outputValue=!0):"FlowGraphInterpolationBlock"===P.className&&(P.config||(P.config={}),Object.keys(F.values||[]).forEach((f=>{var N;const q=null===(N=F.values)||void 0===N?void 0:N[f];if("value"===f&&q){const F=q.type;void 0!==F&&(P.config.animationType=c.arrays.types[F].flowGraphType)}})))})),N)},"animation/start":{ei:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",df:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(F,P)=>[F[0]*P._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(F,P)=>[F[0]*P._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(F,P,f,c,N,q,H){const A=N[N.length-1];return A.config||(A.config={}),A.config.glTF=H,N}},"animation/stop":{ei:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",df:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(F,P,f,c,N,q,H){const A=N[N.length-1];return A.config||(A.config={}),A.config.glTF=H,N}},"animation/stopAt":{ei:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",df:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(F,P)=>[F[0]*P._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(F,P,f,c,N,q,H){const A=N[N.length-1];return A.config||(A.config={}),A.config.glTF=H,N}},"math/switch":{ei:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(F){if(F.configuration&&F.configuration.cases){const P=F.configuration.cases.value;if(!P.every((F=>"number"===typeof F&&/^-?\d+$/.test(F.toString()))))return C.d.Warn("Switch cases should be integers. Using empty array instead."),F.configuration.cases.value=[],{valid:!0};const f=new Set(P);F.configuration.cases.value=Array.from(f)}return{valid:!0}},extraProcessor(F,P,f,c,N){const q=N[0];return q.dataInputs.forEach((F=>{"default"!==F.name&&"case"!==F.name&&(F.name="in_"+F.name)})),q.config||(q.config={}),q.config.treatCasesAsIntegers=!0,N}},"debug/log":{ei:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function If(F){let P=arguments.length>2?arguments[2]:void 0;return{ei:[F],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((F,P)=>(F[P]={name:P},F)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(F,f,c,N,q){var H;if(P){(H=q[0]).config||(H.config={}),q[0].config.preventIntegerFloatArithmetic=!0;let P=-1;Object.keys(F.values||{}).find((f=>{var c;return void 0!==(null===(c=F.values)||void 0===c?void 0:c[f].type)&&(P=F.values[f].type,!0)})),-1!==P&&(q[0].config.type=N.arrays.types[P].flowGraphType)}return q},validation:F=>P?Ef(F):{valid:!0}}}function Ef(F){if(F.values){const P=Object.keys(F.values).map((P=>F.values[P].type)).filter((F=>void 0!==F));if(!P.every((F=>F===P[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}kf["math/compose"]=kf["math/matCompose"],kf["math/decompose"]=kf["math/matDecompose"];var rf=f(11596);const nf={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"tP",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class pf{constructor(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=F,this._gltf=P,this._animationTargetFps=f,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const F of this._interactivityGraph.types)this._types.push(nf[F.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const F of this._interactivityGraph.declarations){const P=Qf(F);if(!P)throw C.d.Error(["No mapping found for declaration",F]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:P,fullOperationName:F.extension?F.op+":"+F.extension:F.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const F of this._interactivityGraph.variables){const P=this._parseVariable(F);this._staticVariables.push(P)}}_parseVariable(F,P){const f=this._types[F.type];if(!f)throw C.d.Error(["No type found for variable",F]),new Error("Error parsing variables");if(F.value&&F.value.length!==f.length)throw C.d.Error(["Invalid value length for variable",F,f]),new Error("Error parsing variables");const c=F.value||[];if(!c.length)switch(f.flowGraphType){case"boolean":c.push(!1);break;case"FlowGraphInteger":c.push(0);break;case"number":c.push(NaN);break;case"Vector2":c.push(NaN,NaN);break;case"tP":c.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":c.fill(NaN,0,4);break;case"Matrix":c.fill(NaN,0,16);break;case"Matrix3D":c.fill(NaN,0,9)}return"number"===f.elementType&&"string"===typeof c[0]&&(c[0]=parseFloat(c[0])),{type:f.flowGraphType,value:P?P(c,this):c}}_parseEvents(){if(this._interactivityGraph.events)for(const F of this._interactivityGraph.events){const P={eventId:F.id||"internalEvent_"+this._internalEventsCounter++};F.values&&(P.eventData=Object.keys(F.values).map((P=>{var f;const c=null===(f=F.values)||void 0===f?void 0:f[P];if(!c)throw C.d.Error(["No value found for event key",P]),new Error("Error parsing events");const N=this._types[c.type];if(!N)throw C.d.Error(["No type found for event value",c]),new Error("Error parsing events");const q="undefined"!==typeof c.value?this._parseVariable(c):void 0;return{id:P,type:N.flowGraphType,eventData:!0,value:q}}))),this._events.push(P)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const P of this._interactivityGraph.nodes){if("number"!==typeof P.declaration)throw C.d.Error(["No declaration found for node",P]),new Error("Error parsing nodes");const f=this._mappings[P.declaration];if(!f)throw C.d.Error(["No mapping found for node",P]),new Error("Error parsing nodes");if(f.flowGraphMapping.validation){const c=f.flowGraphMapping.validation(P,this._interactivityGraph,this._gltf);var F;if(!c.valid)throw new Error(`Error validating interactivity node ${null===(F=this._interactivityGraph.declarations)||void 0===F?void 0:F[P.declaration].op} - ${c.error}`)}const c=[];for(const F of f.flowGraphMapping.ei){const N=this._getEmptyBlock(F,f.fullOperationName);this._parseNodeConfiguration(P,N,f.flowGraphMapping,F),c.push(N)}this._nodes.push({ei:c,fullOperationName:f.fullOperationName})}}_getEmptyBlock(F,P){return{uniqueId:(0,rf.e)(),className:F,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:P,metadata:{}}}_parseNodeConfiguration(F,P,f,c){const N=P.config;if(F.configuration){const P=Object.keys(F.configuration);for(const A of P){var q,H;const P=null===(q=F.configuration)||void 0===q?void 0:q[A];if(!P)throw C.d.Error(["No value found for node configuration",A]),new Error("Error parsing node configuration");const o=null===(H=f.configuration)||void 0===H?void 0:H[A];if(o&&o.df?o.df===c:0===f.ei.indexOf(c)){const F=(null===o||void 0===o?void 0:o.name)||A;P&&"undefined"!==typeof P.value||"undefined"===typeof(null===o||void 0===o?void 0:o.defaultValue)?P.value.length>=0?N[F]={value:1===P.value.length?P.value[0]:P.value}:C.d.Warn(["Invalid value for node configuration",P]):N[F]={value:o.defaultValue},o&&o.dataTransformer&&(N[F].value=o.dataTransformer([N[F].value],this)[0])}}}}_parseNodeConnections(F){for(let y=0;y<this._nodes.length;y++){var P;const O=null===(P=this._interactivityGraph.nodes)||void 0===P?void 0:P[y];if(!O)throw C.d.Error(["No node found for interactivity node",this._nodes[y]]),new Error("Error parsing node connections");const d=this._nodes[y],M=this._mappings[O.declaration];if(!M)throw C.d.Error(["No mapping found for node",O]),new Error("Error parsing node connections");const V=O.flows||{},Q=Object.keys(V).sort();for(const F of Q){var f,c,N,q;const P=V[F],j=null===(f=M.flowGraphMapping.outputs)||void 0===f||null===(c=f.flows)||void 0===c?void 0:c[F],i=(null===j||void 0===j?void 0:j.name)||F,u=this._createNewSocketConnection(i,!0);(j&&j.df&&d.ei.find((F=>F.className===j.df))||d.ei[0]).signalOutputs.push(u);const T=P.node,Y=this._nodes[T];if(!Y)throw C.d.Error(["No node found for input node id",T]),new Error("Error parsing node connections");const t=Vf(Y.fullOperationName);if(!t)throw C.d.Error(["No mapping found for input node",Y]),new Error("Error parsing node connections");let L=null===(N=t.inputs)||void 0===N||null===(q=N.flows)||void 0===q?void 0:q[P.socket||"in"],J=!1;if(!L)for(const F in null===(H=t.inputs)||void 0===H?void 0:H.flows){var H,A,o;if(F.startsWith("[")&&F.endsWith("]"))J=!0,L=null===(A=t.inputs)||void 0===A||null===(o=A.flows)||void 0===o?void 0:o[F]}const B=L?J?L.name.replace("$1",P.socket||""):L.name:P.socket||"in",z=L&&L.df&&Y.ei.find((F=>F.className===L.df))||Y.ei[0];let Z=z.signalInputs.find((F=>F.name===B));Z||(Z=this._createNewSocketConnection(B),z.signalInputs.push(Z)),Z.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(Z.uniqueId)}const K=O.values||{},x=Object.keys(K);for(const P of x){var j,i;const f=K[P];let c=null===(j=M.flowGraphMapping.inputs)||void 0===j||null===(i=j.values)||void 0===i?void 0:i[P],N=!1;if(!c)for(const F in null===(u=M.flowGraphMapping.inputs)||void 0===u?void 0:u.values){var u,T,Y;if(F.startsWith("[")&&F.endsWith("]"))N=!0,c=null===(T=M.flowGraphMapping.inputs)||void 0===T||null===(Y=T.values)||void 0===Y?void 0:Y[F]}const q=c?N?c.name.replace("$1",P):c.name:P,H=this._createNewSocketConnection(q);if((c&&c.df&&d.ei.find((F=>F.className===c.df))||d.ei[0]).dataInputs.push(H),void 0!==f.value){const P=this._parseVariable(f,c&&c.dataTransformer);F._connectionValues[H.uniqueId]=P}else{if("undefined"===typeof f.node)throw C.d.Error(["Invalid value for value connection",f]),new Error("Error parsing node connections");{var t,L,J;const F=f.node,P=f.socket||"value",c=this._nodes[F];if(!c)throw C.d.Error(["No node found for output socket reference",f]),new Error("Error parsing node connections");const N=Vf(c.fullOperationName);if(!N)throw C.d.Error(["No mapping found for output socket reference",f]),new Error("Error parsing node connections");let q=null===(t=N.outputs)||void 0===t||null===(L=t.values)||void 0===L?void 0:L[P],A=!1;if(!q)for(const f in null===(B=N.outputs)||void 0===B?void 0:B.values){var B,z,Z;if(f.startsWith("[")&&f.endsWith("]"))A=!0,q=null===(z=N.outputs)||void 0===z||null===(Z=z.values)||void 0===Z?void 0:Z[f]}const o=q?A?q.name.replace("$1",P):null===(J=q)||void 0===J?void 0:J.name:P,j=q&&q.df&&c.ei.find((F=>F.className===q.df))||c.ei[0];let i=j.dataOutputs.find((F=>F.name===o));i||(i=this._createNewSocketConnection(o,!0),j.dataOutputs.push(i)),H.connectedPointIds.push(i.uniqueId),i.connectedPointIds.push(H.uniqueId)}}}if(M.flowGraphMapping.interBlockConnectors)for(const F of M.flowGraphMapping.interBlockConnectors){const P=F.input,f=F.output,c=F.isVariable;this._connectFlowGraphNodes(P,f,d.ei[F.inputBlockIndex],d.ei[F.outputBlockIndex],c)}if(M.flowGraphMapping.extraProcessor){var R;const P=null===(R=this._interactivityGraph.declarations)||void 0===R?void 0:R[O.declaration];if(!P)throw C.d.Error(["No declaration found for extra processor",O]),new Error("Error parsing node connections");d.ei=M.flowGraphMapping.extraProcessor(O,P,M.flowGraphMapping,this,d.ei,F,this._gltf)}}}_createNewSocketConnection(F,P){return{uniqueId:(0,rf.e)(),name:F,_connectionType:P?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(F,P,f,c,N){const q=N?f.dataInputs:f.signalInputs,H=N?c.dataOutputs:c.signalOutputs,A=q.find((P=>P.name===F))||this._createNewSocketConnection(F),o=H.find((F=>F.name===P))||this._createNewSocketConnection(P,!0);q.find((P=>P.name===F))||q.push(A),H.find((F=>F.name===P))||H.push(o),A.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(A.uniqueId)}getVariableName(F){return"staticVariable_"+F}serializeToFlowGraph(){const F={uniqueId:(0,rf.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(F);for(let P=0;P<this._staticVariables.length;P++){const f=this._staticVariables[P];F._userVariables[this.getVariableName(P)]=f}return{rightHanded:!0,allBlocks:this._nodes.reduce(((F,P)=>F.concat(P.ei)),[]),executionContexts:[F]}}}const Uf="KHR_interactivity";class ef{constructor(F){this._loader=F,this.name=Uf,this.enabled=this._loader.isExtensionUsed(Uf),this._pathConverter=(0,e.h)(this._loader.kf),F._skipStartAnimationStep=!0;const P=F.babylonScene;P&&function(F){(0,e.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!F.activeCamera)return new N.Quaternion(NaN,NaN,NaN,NaN);const P=N.Quaternion.FromRotationMatrix(F.activeCamera.getWorldMatrix()).normalize();return F.useRightHandedSystem||(P.w*=-1,P.x*=-1),P},type:"Quaternion",getTarget:()=>F.activeCamera}),(0,e.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!F.activeCamera)return new N.tP(NaN,NaN,NaN);const P=F.activeCamera.getWorldMatrix().getTranslation();return F.useRightHandedSystem||(P.x*=-1),P},type:"tP",getTarget:()=>F.activeCamera}),(0,e.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:F=>{var P;return(null===(P=F._babylonAnimationGroup)||void 0===P?void 0:P.isPlaying)??!1},type:"boolean",getTarget:F=>F._babylonAnimationGroup}),(0,e.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:F=>{var P;return((null===(P=F._babylonAnimationGroup)||void 0===P?void 0:P.from)??0)/60},type:"number",getTarget:F=>F._babylonAnimationGroup}),(0,e.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:F=>{var P;return((null===(P=F._babylonAnimationGroup)||void 0===P?void 0:P.to)??0)/60},type:"number",getTarget:F=>F._babylonAnimationGroup}),(0,e.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:F=>{var P;return((null===(P=F._babylonAnimationGroup)||void 0===P?void 0:P.getCurrentFrame())??0)/60},type:"number",getTarget:F=>F._babylonAnimationGroup}),(0,e.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:F=>{var P;return((null===(P=F._babylonAnimationGroup)||void 0===P?void 0:P.getCurrentFrame())??0)/60},type:"number",getTarget:F=>F._babylonAnimationGroup})}(P)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var F;if(!this._loader.babylonScene||!this._pathConverter)return;const P=this._loader.babylonScene,f=null===(F=this._loader.kf.extensions)||void 0===F?void 0:F.KHR_interactivity;if(!f)return;const c=new Cf.c({LP:P});c.dispatchEventsSynchronously=!1;const N=f.graphs.map((F=>new pf(F,this._loader.kf,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(N.map((async F=>await Of(F,{coordinator:c,pathConverter:this._pathConverter})))),c.start()}}var Df;Df=async()=>(await Promise.resolve().then(f.bind(f,13321))).FlowGraphGLTFDataProvider,Lf[`${Uf}/${"FlowGraphGLTFDataProvider"}`]=Df,U(Uf),p(Uf,!0,(F=>new ef(F)));const lf="KHR_node_visibility";(0,e.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:F=>{const P=F._babylonTransformNode;return!P||void 0===P.isVisible||P.isVisible},set:(F,P)=>{var f,c;null===(f=P._primitiveBabylonMeshes)||void 0===f||f.forEach((F=>{F.inheritVisibility=!0})),P._babylonTransformNode&&(P._babylonTransformNode.isVisible=F),null===(c=P._primitiveBabylonMeshes)||void 0===c||c.forEach((P=>{P.isVisible=F}))},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Wf{constructor(F){this.name=lf,this._loader=F,this.enabled=F.isExtensionUsed(lf)}async onReady(){var F;null===(F=this._loader.kf.nodes)||void 0===F||F.forEach((F=>{var P,f,c,N;(null===(P=F._primitiveBabylonMeshes)||void 0===P||P.forEach((F=>{F.inheritVisibility=!0})),null!==(f=F.extensions)&&void 0!==f&&f.KHR_node_visibility)&&(!1===(null===(c=F.extensions)||void 0===c?void 0:c.KHR_node_visibility.visible)&&(F._babylonTransformNode&&(F._babylonTransformNode.isVisible=!1),null===(N=F._primitiveBabylonMeshes)||void 0===N||N.forEach((F=>{F.isVisible=!1}))))}))}dispose(){this._loader=null}}U(lf),p(lf,!0,(F=>new Wf(F)));const bf="KHR_node_selectability";Kf("event/onSelect",bf,{ei:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",df:"FlowGraphGetVariableBlock",dataTransformer:F=>["pickedMesh_"+F[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",df:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(F,P,f,c,N,q,H){var A,o,j,i,u,T;const Y=N[N.length-1];Y.config=Y.config||{},Y.config.glTF=H;const t=null===(A=F.configuration)||void 0===A||null===(o=A.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===t||"number"!==typeof t)throw new Error("nodeIndex not found in configuration");const C="pickedMesh_"+t;return N[1].config.variable=C,q._userVariables[C]={className:"Mesh",id:null===H||void 0===H||null===(j=H.nodes)||void 0===j||null===(i=j[t]._babylonTransformNode)||void 0===i?void 0:i.id,uniqueId:null===H||void 0===H||null===(u=H.nodes)||void 0===u||null===(T=u[t]._babylonTransformNode)||void 0===T?void 0:T.uniqueId},N}}),(0,e.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:F=>{const P=F._babylonTransformNode;return!P||void 0===P.jj||P.jj},set:(F,P)=>{var f;null===(f=P._primitiveBabylonMeshes)||void 0===f||f.forEach((P=>{P.jj=F}))},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"jj"],type:"boolean"});class vf{constructor(F){this.name=bf,this._loader=F,this.enabled=F.isExtensionUsed(bf)}async onReady(){var F;null===(F=this._loader.kf.nodes)||void 0===F||F.forEach((F=>{var P,f,c;null!==(P=F.extensions)&&void 0!==P&&P.KHR_node_selectability&&!1===(null===(f=F.extensions)||void 0===f?void 0:f.KHR_node_selectability.selectable)&&(null===(c=F._babylonTransformNode)||void 0===c||c.getChildMeshes().forEach((F=>{F.jj=!1})))}))}dispose(){this._loader=null}}U(bf),p(bf,!0,(F=>new vf(F)));const sf="KHR_node_hoverability",Xf="targetMeshPointerOver_";Kf("event/onHoverIn",sf,{ei:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",df:"FlowGraphGetVariableBlock",dataTransformer:F=>[Xf+F[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",df:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(F,P,f,c,N,q,H){var A,o,j,i,u,T;const Y=N[N.length-1];Y.config=Y.config||{},Y.config.glTF=H;const t=null===(A=F.configuration)||void 0===A||null===(o=A.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===t||"number"!==typeof t)throw new Error("nodeIndex not found in configuration");const C=Xf+t;return N[1].config.variable=C,q._userVariables[C]={className:"Mesh",id:null===H||void 0===H||null===(j=H.nodes)||void 0===j||null===(i=j[t]._babylonTransformNode)||void 0===i?void 0:i.id,uniqueId:null===H||void 0===H||null===(u=H.nodes)||void 0===u||null===(T=u[t]._babylonTransformNode)||void 0===T?void 0:T.uniqueId},N}});const mf="targetMeshPointerOut_";Kf("event/onHoverOut",sf,{ei:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",df:"FlowGraphGetVariableBlock",dataTransformer:F=>[mf+F[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",df:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(F,P,f,c,N,q,H){var A,o,j,i,u,T;const Y=N[N.length-1];Y.config=Y.config||{},Y.config.glTF=H;const t=null===(A=F.configuration)||void 0===A||null===(o=A.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===t||"number"!==typeof t)throw new Error("nodeIndex not found in configuration");const C=mf+t;return N[1].config.variable=C,q._userVariables[C]={className:"Mesh",id:null===H||void 0===H||null===(j=H.nodes)||void 0===j||null===(i=j[t]._babylonTransformNode)||void 0===i?void 0:i.id,uniqueId:null===H||void 0===H||null===(u=H.nodes)||void 0===u||null===(T=u[t]._babylonTransformNode)||void 0===T?void 0:T.uniqueId},N}}),(0,e.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:F=>{const P=F._babylonTransformNode;return!P||void 0===P.pointerOverDisableMeshTesting||P.pointerOverDisableMeshTesting},set:(F,P)=>{var f;null===(f=P._primitiveBabylonMeshes)||void 0===f||f.forEach((P=>{P.pointerOverDisableMeshTesting=!F}))},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class af{constructor(F){this.name=sf,this._loader=F,this.enabled=F.isExtensionUsed(sf)}async onReady(){var F;null===(F=this._loader.kf.nodes)||void 0===F||F.forEach((F=>{var P,f,c;null!==(P=F.extensions)&&void 0!==P&&P.KHR_node_hoverability&&!1===(null===(f=F.extensions)||void 0===f?void 0:f.KHR_node_hoverability.hoverable)&&(null===(c=F._babylonTransformNode)||void 0===c||c.getChildMeshes().forEach((F=>{F.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}U(sf),p(sf,!0,(F=>new af(F)));const wf="ExtrasAsMetadata";class gf{_assignExtras(F,P){if(P.extras&&Object.keys(P.extras).length>0){const f=F.metadata=F.metadata||{};(f.kf=f.kf||{}).extras=P.extras}}constructor(F){this.name=wf,this.enabled=!0,this._loader=F}dispose(){this._loader=null}loadNodeAsync(F,P,f){return this._loader.loadNodeAsync(F,P,(F=>{this._assignExtras(F,P),f(F)}))}loadCameraAsync(F,P,f){return this._loader.loadCameraAsync(F,P,(F=>{this._assignExtras(F,P),f(F)}))}createMaterial(F,P,f){const c=this._loader.createMaterial(F,P,f);return this._assignExtras(c,P),c}}U(wf),p(wf,!1,(F=>new gf(F)));f(13321)},13189:(F,P,f)=>{"use strict";f.d(P,{c:()=>I,e:()=>M,f:()=>d,g:()=>V});var c=f(11464),N=f(11462),q=f(12872),H=f(12063),A=f(12028),o=f(12042),j=f(11474),i=f(11501),u=f(12061),T=f(12165),Y=f(12070),t=f(11681);class C{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.zT=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.FY=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(F){this._environmentTexture=F}getNodes(){let F=[];F=F.concat(this.meshes),F=F.concat(this.lights),F=F.concat(this.cameras),F=F.concat(this.transformNodes);for(const P of this.skeletons)F=F.concat(P.bones);return F}}class L extends C{}class J{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const F=this.rootNodes;for(const c of F)c.dispose();F.length=0;const P=this.skeletons;for(const c of P)c.dispose();P.length=0;const f=this.animationGroups;for(const c of f)c.dispose();f.length=0}}class B extends C{constructor(F){super(),this._wasAddedToScene=!1,(F=F||i.b.LastCreatedScene)&&(this.LP=F,this.proceduralTextures=[],F.Mf.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=F.getEngine().onContextRestoredObservable.add((()=>{for(const F of this.geometries)F._rebuild();for(const F of this.meshes)F._rebuild();for(const F of this.zT)F.rebuild();for(const F of this.textures)F._rebuild()})))}_topologicalSort(F){const P=new Map;for(const H of F)P.set(H.uniqueId,H);const f={dependsOn:new Map,dependedBy:new Map};for(const H of F){const F=H.uniqueId;f.dependsOn.set(F,new Set),f.dependedBy.set(F,new Set)}for(const H of F){const F=H.uniqueId,c=f.dependsOn.get(F);if(H instanceof u.c){const N=H.sourceMesh;P.has(N.uniqueId)&&(c.add(N.uniqueId),f.dependedBy.get(N.uniqueId).add(F))}const N=f.dependedBy.get(F);for(const q of H.getDescendants()){const c=q.uniqueId;if(P.has(c)){N.add(c);f.dependsOn.get(c).add(F)}}}const c=[],N=[];for(const H of F){const F=H.uniqueId;0===f.dependsOn.get(F).size&&(N.push(H),P.delete(F))}const q=N;for(;q.length>0;){const F=q.shift();c.push(F);const N=f.dependedBy.get(F.uniqueId);for(const c of Array.from(N.values())){const N=f.dependsOn.get(c);N.delete(F.uniqueId),0===N.size&&P.get(c)&&(q.push(P.get(c)),P.delete(c))}}return P.size>0&&(j.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),P.forEach((F=>{j.d.Error(F.name)}))),c}_addNodeAndDescendantsToList(F,P,f,c){if(f&&(!c||c(f))&&!P.has(f.uniqueId)){F.push(f),P.add(f.uniqueId);for(const N of f.getDescendants(!0))this._addNodeAndDescendantsToList(F,P,N,c)}}_isNodeInContainer(F){return F instanceof o.b&&-1!==this.meshes.indexOf(F)||(F instanceof A.e&&-1!==this.transformNodes.indexOf(F)||(F instanceof T.e&&-1!==this.lights.indexOf(F)||F instanceof Y.e&&-1!==this.cameras.indexOf(F)))}_isValidHierarchy(){for(const F of this.meshes)if(F.parent&&!this._isNodeInContainer(F.parent))return j.d.Warn(`Node ${F.name} has a parent that is not in the container.`),!1;for(const F of this.transformNodes)if(F.parent&&!this._isNodeInContainer(F.parent))return j.d.Warn(`Node ${F.name} has a parent that is not in the container.`),!1;for(const F of this.lights)if(F.parent&&!this._isNodeInContainer(F.parent))return j.d.Warn(`Node ${F.name} has a parent that is not in the container.`),!1;for(const F of this.cameras)if(F.parent&&!this._isNodeInContainer(F.parent))return j.d.Warn(`Node ${F.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(F){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||N.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const c={},q={},A=new J,o=[],j=[],i={doNotInstantiate:!0,...f},u=[],T=new Set;for(const N of this.transformNodes)null===N.parent&&this._addNodeAndDescendantsToList(u,T,N,i.predicate);for(const N of this.meshes)null===N.parent&&this._addNodeAndDescendantsToList(u,T,N,i.predicate);const Y=this._topologicalSort(u),t=(f,N)=>{if(((P,f)=>{if(c[P.uniqueId]=f.uniqueId,q[f.uniqueId]=f,F&&(f.name=F(P.name)),f instanceof H.d){const F=f;if(F.morphTargetManager){const f=P.morphTargetManager;F.morphTargetManager=f.clone();for(let P=0;P<f.numTargets;P++){const N=f.getTarget(P),H=F.morphTargetManager.getTarget(P);c[N.uniqueId]=H.uniqueId,q[H.uniqueId]=H}}}})(f,N),f.parent){const F=c[f.parent.uniqueId],P=q[F];N.parent=P||f.parent}if(N.position&&f.position&&N.position.q(f.position),N.rotationQuaternion&&f.rotationQuaternion&&N.rotationQuaternion.q(f.rotationQuaternion),N.rotation&&f.rotation&&N.rotation.q(f.rotation),N.cc&&f.cc&&N.cc.q(f.cc),N.material){const H=N;if(H.material)if(P){const P=f.material;if(-1===j.indexOf(P)){let f=P.clone(F?F(P.name):"Clone of "+P.name);if(j.push(P),c[P.uniqueId]=f.uniqueId,q[f.uniqueId]=f,"MultiMaterial"===P.getClassName()){const N=P;for(const P of N.Hc)P&&(f=P.clone(F?F(P.name):"Clone of "+P.name),j.push(P),c[P.uniqueId]=f.uniqueId,q[f.uniqueId]=f);N.Hc=N.Hc.map((F=>F&&q[c[F.uniqueId]]))}}"InstancedMesh"!==H.getClassName()&&(H.material=q[c[P.uniqueId]])}else"MultiMaterial"===H.material.getClassName()?-1===this.LP.multiMaterials.indexOf(H.material)&&this.LP.addMultiMaterial(H.material):-1===this.LP.materials.indexOf(H.material)&&this.LP.addMaterial(H.material)}null===N.parent&&A.rootNodes.push(N)};for(const N of Y)if("InstancedMesh"===N.getClassName()){const F=N,P=F.sourceMesh,f=c[P.uniqueId];t(F,("number"===typeof f?q[f]:P).createInstance(F.name))}else{let F=!0;"tc"===N.getClassName()||"Node"===N.getClassName()||N.skeleton||!N.getTotalVertices||0===N.getTotalVertices()?F=!1:i.doNotInstantiate&&(F="function"===typeof i.doNotInstantiate?!i.doNotInstantiate(N):!i.doNotInstantiate);const P=F?N.createInstance(`instance of ${N.name}`):N.clone(`Clone of ${N.name}`,null,!0);if(!P)throw new Error(`Could not clone or instantiate node on Asset Container ${N.name}`);t(N,P)}for(const N of this.skeletons){if(i.predicate&&!i.predicate(N))continue;const P=N.clone(F?F(N.name):"Clone of "+N.name);for(const F of this.meshes)if(F.skeleton===N&&!F.isAnInstance){const f=q[c[F.uniqueId]];if(!f||f.isAnInstance)continue;if(f.skeleton=P,-1!==o.indexOf(P))continue;o.push(P);for(const F of P.bones)F._linkedTransformNode&&(F._linkedTransformNode=q[c[F._linkedTransformNode.uniqueId]])}A.skeletons.push(P)}for(const N of this.animationGroups){if(i.predicate&&!i.predicate(N))continue;const P=N.clone(F?F(N.name):"Clone of "+N.name,(F=>q[c[F.uniqueId]]||F));A.animationGroups.push(P)}return A}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||N.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.LP.environmentTexture=this.environmentTexture);for(const F of this.LP._serializableComponents)F.addFromContainer(this);this.LP.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const P=[];for(const f of this.cameras)F&&!F(f)||(this.LP.addCamera(f),P.push(f));for(const f of this.lights)F&&!F(f)||(this.LP.addLight(f),P.push(f));for(const f of this.meshes)F&&!F(f)||(this.LP.Mi(f),P.push(f));for(const f of this.skeletons)F&&!F(f)||this.LP.addSkeleton(f);for(const f of this.animations)F&&!F(f)||this.LP.addAnimation(f);for(const f of this.animationGroups)F&&!F(f)||this.LP.addAnimationGroup(f);for(const f of this.multiMaterials)F&&!F(f)||this.LP.addMultiMaterial(f);for(const f of this.materials)F&&!F(f)||this.LP.addMaterial(f);for(const f of this.morphTargetManagers)F&&!F(f)||this.LP.addMorphTargetManager(f);for(const f of this.geometries)F&&!F(f)||this.LP.addGeometry(f);for(const f of this.transformNodes)F&&!F(f)||(this.LP.addTransformNode(f),P.push(f));for(const f of this.actionManagers)F&&!F(f)||this.LP.addActionManager(f);for(const f of this.textures)F&&!F(f)||this.LP.addTexture(f);for(const f of this.reflectionProbes)F&&!F(f)||this.LP.addReflectionProbe(f);for(const f of P)f.parent&&-1===this.LP.getNodes().indexOf(f.parent)&&(f.setParent?f.setParent(null):f.parent=null)}removeAllFromScene(){this._isValidHierarchy()||N.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.LP.environmentTexture&&(this.LP.environmentTexture=null);for(const F of this.LP._serializableComponents)F.removeFromContainer(this)}removeFromScene(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const P of this.cameras)F&&!F(P)||this.LP.removeCamera(P);for(const P of this.lights)F&&!F(P)||this.LP.removeLight(P);for(const P of this.meshes)F&&!F(P)||this.LP.di(P,!0);for(const P of this.skeletons)F&&!F(P)||this.LP.removeSkeleton(P);for(const P of this.animations)F&&!F(P)||this.LP.removeAnimation(P);for(const P of this.animationGroups)F&&!F(P)||this.LP.removeAnimationGroup(P);for(const P of this.multiMaterials)F&&!F(P)||this.LP.removeMultiMaterial(P);for(const P of this.materials)F&&!F(P)||this.LP.removeMaterial(P);for(const P of this.morphTargetManagers)F&&!F(P)||this.LP.removeMorphTargetManager(P);for(const P of this.geometries)F&&!F(P)||this.LP.removeGeometry(P);for(const P of this.transformNodes)F&&!F(P)||this.LP.removeTransformNode(P);for(const P of this.actionManagers)F&&!F(P)||this.LP.removeActionManager(P);for(const P of this.textures)F&&!F(P)||this.LP.removeTexture(P);for(const P of this.reflectionProbes)F&&!F(P)||this.LP.removeReflectionProbe(P)}dispose(){const F=this.cameras.slice(0);for(const Y of F)Y.dispose();this.cameras.length=0;const P=this.lights.slice(0);for(const Y of P)Y.dispose();this.lights.length=0;const f=this.meshes.slice(0);for(const Y of f)Y.dispose();this.meshes.length=0;const c=this.skeletons.slice(0);for(const Y of c)Y.dispose();this.skeletons.length=0;const N=this.animationGroups.slice(0);for(const Y of N)Y.dispose();this.animationGroups.length=0;const q=this.multiMaterials.slice(0);for(const Y of q)Y.dispose();this.multiMaterials.length=0;const H=this.materials.slice(0);for(const Y of H)Y.dispose();this.materials.length=0;const A=this.geometries.slice(0);for(const Y of A)Y.dispose();this.geometries.length=0;const o=this.transformNodes.slice(0);for(const Y of o)Y.dispose();this.transformNodes.length=0;const j=this.actionManagers.slice(0);for(const Y of j)Y.dispose();this.actionManagers.length=0;const i=this.textures.slice(0);for(const Y of i)Y.dispose();this.textures.length=0;const u=this.reflectionProbes.slice(0);for(const Y of u)Y.dispose();this.reflectionProbes.length=0;const T=this.morphTargetManagers.slice(0);for(const Y of T)Y.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const Y of this.LP._serializableComponents)Y.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.LP.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(F,P,f){if(F&&P)for(const c of F){let F=!0;if(f)for(const P of f)if(c===P){F=!1;break}F&&(P.push(c),c._parentContainer=this)}}moveAllFromScene(F){this._wasAddedToScene=!1,void 0===F&&(F=new L);for(const P in this)Object.prototype.hasOwnProperty.call(this,P)&&(this[P]=this[P]||("_environmentTexture"===P?null:[]),this._moveAssets(this.LP[P],this[P],F[P]));this.environmentTexture=this.LP.environmentTexture,this.removeAllFromScene()}createRootMesh(){const F=new H.d("assetContainerRootMesh",this.LP);for(const P of this.meshes)P.parent||F.addChild(P);return this.meshes.unshift(F),F}mergeAnimationsTo(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.b.LastCreatedScene,P=arguments.length>1?arguments[1]:void 0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!F)return j.d.Error("No scene available to merge animations to"),[];const c=f||(P=>{let f=null;const c=P.animations.length?P.animations[0].targetProperty:"",N=P.name.split(".").join("").split("_primitive")[0];switch(c){case"position":case"rotationQuaternion":f=F.getTransformNodeByName(P.name)||F.getTransformNodeByName(N);break;case"influence":f=F.getMorphTargetByName(P.name)||F.getMorphTargetByName(N);break;default:f=F.getNodeByName(P.name)||F.getNodeByName(N)}return f}),N=this.getNodes();for(const A of N){const F=c(A);if(null!==F){for(const P of A.animations){const f=F.animations.filter((F=>F.targetProperty===P.targetProperty));for(const P of f){const f=F.animations.indexOf(P,0);f>-1&&F.animations.splice(f,1)}}F.animations=F.animations.concat(A.animations)}}const q=[],H=this.animationGroups.slice();for(const A of H){q.push(A.clone(A.name,c));for(const F of A.animatables)F.stop()}for(const A of P){const P=c(A.target);P&&(F.beginAnimation(P,A.fromFrame,A.toFrame,A.loopAnimation,A.speedRatio,A.onAnimationEnd?A.onAnimationEnd:void 0,void 0,!0,void 0,A.onAnimationLoop?A.onAnimationLoop:void 0),F.stopAnimation(A.target))}return q}populateRootNodes(){this.rootNodes.length=0;for(const F of this.meshes)F.parent||-1!==this.rootNodes.indexOf(F)||this.rootNodes.push(F);for(const F of this.transformNodes)F.parent||-1!==this.rootNodes.indexOf(F)||this.rootNodes.push(F);for(const F of this.lights)F.parent||-1!==this.rootNodes.indexOf(F)||this.rootNodes.push(F);for(const F of this.cameras)F.parent||-1!==this.rootNodes.indexOf(F)||this.rootNodes.push(F)}addAllAssetsToContainer(F){if(!F)return;const P=[],f=new Set;for(P.push(F);P.length>0;){const F=P.pop();if(F instanceof H.d?(F.Sf&&-1===this.geometries.indexOf(F.Sf)&&this.geometries.push(F.Sf),this.meshes.push(F)):F instanceof u.c?this.meshes.push(F):F instanceof A.e?this.transformNodes.push(F):F instanceof T.e?this.lights.push(F):F instanceof Y.e&&this.cameras.push(F),F instanceof o.b){if(F.material&&-1===this.materials.indexOf(F.material)){this.materials.push(F.material);for(const P of F.material.getActiveTextures())-1===this.textures.indexOf(P)&&this.textures.push(P)}F.skeleton&&-1===this.skeletons.indexOf(F.skeleton)&&this.skeletons.push(F.skeleton),F.morphTargetManager&&-1===this.morphTargetManagers.indexOf(F.morphTargetManager)&&this.morphTargetManagers.push(F.morphTargetManager)}for(const c of F.getChildren())f.has(c)||P.push(c);f.add(F)}this.populateRootNodes()}_getByTags(F,P,f){if(void 0===P)return F;const c=[];for(const N in F){const q=F[N];t.b&&t.b.MatchesQuery(q,P)&&(!f||f(q))&&c.push(q)}return c}getMeshesByTags(F,P){return this._getByTags(this.meshes,F,P)}getCamerasByTags(F,P){return this._getByTags(this.cameras,F,P)}getLightsByTags(F,P){return this._getByTags(this.lights,F,P)}getMaterialsByTags(F,P){return this._getByTags(this.materials,F,P).concat(this._getByTags(this.multiMaterials,F,P))}getTransformNodesByTags(F,P){return this._getByTags(this.transformNodes,F,P)}}var z=f(11521);class Z{constructor(F){this.byteOffset=0,this.buffer=F}async loadAsync(F){const P=await this.buffer.readAsync(this.byteOffset,F);this._dataView=new DataView(P.buffer,P.byteOffset,P.byteLength),this._dataByteOffset=0}readUint32(){const F=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,F}readUint8Array(F){const P=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,F);return this._dataByteOffset+=F,this.byteOffset+=F,P}readString(F){return(0,z.i)(this.readUint8Array(F))}skipBytes(F){this._dataByteOffset+=F,this.byteOffset+=F}}var R=f(13197);const y="Z2xURg",O={name:"kf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:F=>-1!==F.indexOf("asset")&&-1!==F.indexOf("version")||F.startsWith("data:base64,"+y)||F.startsWith("data:;base64,"+y)||F.startsWith("data:application/octet-stream;base64,"+y)||F.startsWith("data:model/gltf-binary;base64,"+y)};var d,M,V,Q=f(11510),K=f(11514);function x(F,P,f){try{return Promise.resolve(new Uint8Array(F,P,f))}catch(c){return Promise.reject(c)}}!function(F){F[F.AUTO=0]="AUTO",F[F.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(d||(d={})),function(F){F[F.NONE=0]="NONE",F[F.FIRST=1]="FIRST",F[F.ALL=2]="ALL"}(M||(M={})),function(F){F[F.LOADING=0]="LOADING",F[F.READY=1]="READY",F[F.COMPLETE=2]="COMPLETE"}(V||(V={}));class k{constructor(){this.coordinateSystemMode=d.AUTO,this.animationStartMode=M.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=F=>Promise.resolve(F),this.extensionOptions={}}q(F){F&&(this.onParsed=F.onParsed,this.coordinateSystemMode=F.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=F.animationStartMode??this.animationStartMode,this.loadNodeAnimations=F.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=F.loadSkins??this.loadSkins,this.loadMorphTargets=F.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=F.compileMaterials??this.compileMaterials,this.useClipPlane=F.useClipPlane??this.useClipPlane,this.compileShadowGenerators=F.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=F.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=F.useRangeRequests??this.useRangeRequests,this.createInstances=F.createInstances??this.createInstances,this.alwaysComputeBoundingBox=F.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=F.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=F.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=F.skipMaterials??this.skipMaterials,this.useSRGBBuffers=F.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=F.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=F.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=F.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=F.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=F.customRootNode,this.onMeshLoaded=F.onMeshLoaded,this.onSkinLoaded=F.onSkinLoaded,this.onTextureLoaded=F.onTextureLoaded,this.onMaterialLoaded=F.onMaterialLoaded,this.onCameraLoaded=F.onCameraLoaded,this.extensionOptions=F.extensionOptions??this.extensionOptions)}}class I extends k{constructor(F){super(),this.onParsedObservable=new c.d,this.onMeshLoadedObservable=new c.d,this.onSkinLoadedObservable=new c.d,this.onTextureLoadedObservable=new c.d,this.onMaterialLoadedObservable=new c.d,this.onCameraLoadedObservable=new c.d,this.onCompleteObservable=new c.d,this.onErrorObservable=new c.d,this.Mf=new c.d,this.onExtensionLoadedObservable=new c.d,this.validate=!1,this.onValidatedObservable=new c.d,this._loader=null,this._state=null,this._requests=new Array,this.name=O.name,this.extensions=O.extensions,this.onLoaderStateChangedObservable=new c.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.q(F)}set onParsed(F){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),F&&(this._onParsedObserver=this.onParsedObservable.add(F))}set onMeshLoaded(F){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),F&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(F))}set onSkinLoaded(F){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),F&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((P=>F(P.node,P.skinnedNode))))}set onTextureLoaded(F){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),F&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(F))}set onMaterialLoaded(F){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),F&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(F))}set onCameraLoaded(F){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),F&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(F))}set onComplete(F){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(F)}set onError(F){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(F)}set onDispose(F){this._onDisposeObserver&&this.Mf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Mf.add(F)}set onExtensionLoaded(F){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(F)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(F){this._loggingEnabled!==F&&(this._loggingEnabled=F,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(F){this._capturePerformanceCounters!==F&&(this._capturePerformanceCounters=F,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(F){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(F)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const F of this._requests)F.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=F=>Promise.resolve(F),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Mf.notifyObservers(void 0),this.Mf.clear()}loadFile(F,P,f,q,H,A,o,i){if(ArrayBuffer.isView(P))return this._loadBinary(F,P,f,q,o,i),null;this._progressCallback=H;const u=P.name||N.Tools.GetFilename(P);if(A){if(this.useRangeRequests){this.validate&&j.d.Warn("glTF validation is not supported when range requests are enabled");const f={abort:()=>{},onCompleteObservable:new c.d},N={readAsync:(f,c)=>new Promise(((N,q)=>{this._loadFile(F,P,(F=>{N(new Uint8Array(F))}),!0,(F=>{q(F)}),(F=>{F.setRequestHeader("Range",`bytes=${f}-${f+c-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Z(N)).then((F=>{f.onCompleteObservable.notifyObservers(f),q(F)}),o?F=>o(void 0,F):void 0),f}return this._loadFile(F,P,(P=>{this._validate(F,new Uint8Array(P,0,P.byteLength),f,u),this._unpackBinaryAsync(new Z({readAsync:(F,f)=>x(P,F,f),byteLength:P.byteLength})).then((F=>{q(F)}),o?F=>o(void 0,F):void 0)}),!0,o)}return this._loadFile(F,P,(P=>{try{this._validate(F,P,f,u),q({json:this._parseJson(P)})}catch{o&&o()}}),!1,o)}_loadBinary(F,P,f,c,N,q){this._validate(F,new Uint8Array(P.buffer,P.byteOffset,P.byteLength),f,q),this._unpackBinaryAsync(new Z({readAsync:(F,f)=>function(F,P,f){try{if(P<0||P>=F.byteLength)throw new RangeError("Offset is out of range.");if(P+f>F.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(F.buffer,F.byteOffset+P,f))}catch(c){return Promise.reject(c)}}(P,F,f),byteLength:P.byteLength})).then((F=>{c(F)}),N?F=>N(void 0,F):void 0)}importMeshAsync(F,P,f,c,N,q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(f),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(f),this._loader.importMeshAsync(F,P,null,f,c,N,q))))}loadAsync(F,P,f,c,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(P),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(P),this._loader.loadAsync(F,P,f,c,N))))}loadAssetContainerAsync(F,P,f,c,N){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(P),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(P);const q=new B(F),H=[];this.onMaterialLoadedObservable.add((F=>{H.push(F)}));const A=[];this.onTextureLoadedObservable.add((F=>{A.push(F)}));const o=[];this.onCameraLoadedObservable.add((F=>{o.push(F)}));const j=[];return this.onMeshLoadedObservable.add((F=>{F.morphTargetManager&&j.push(F.morphTargetManager)})),this._loader.importMeshAsync(null,F,q,P,f,c,N).then((F=>(Array.prototype.push.apply(q.geometries,F.geometries),Array.prototype.push.apply(q.meshes,F.meshes),Array.prototype.push.apply(q.zT,F.zT),Array.prototype.push.apply(q.skeletons,F.skeletons),Array.prototype.push.apply(q.animationGroups,F.animationGroups),Array.prototype.push.apply(q.materials,H),Array.prototype.push.apply(q.textures,A),Array.prototype.push.apply(q.lights,F.lights),Array.prototype.push.apply(q.transformNodes,F.transformNodes),Array.prototype.push.apply(q.cameras,o),Array.prototype.push.apply(q.morphTargetManagers,j),q)))}))}canDirectLoad(F){return O.canDirectLoad(F)}directLoad(F,P){if(P.startsWith("base64,"+y)||P.startsWith(";base64,"+y)||P.startsWith("application/octet-stream;base64,"+y)||P.startsWith("model/gltf-binary;base64,"+y)){const f=(0,Q.b)(P);return this._validate(F,new Uint8Array(f,0,f.byteLength)),this._unpackBinaryAsync(new Z({readAsync:(F,P)=>x(f,F,P),byteLength:f.byteLength}))}return this._validate(F,P),Promise.resolve({json:this._parseJson(P)})}createPlugin(F){return new I(F[O.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((F,P)=>{this.onCompleteObservable.addOnce((()=>{F()})),this.onErrorObservable.addOnce((F=>{P(F)}))}))}_setState(F){this._state!==F&&(this._state=F,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(V[this._state]))}_loadFile(F,P,f,c,N,q){const H=F._loadFile(P,f,(F=>{this._onProgress(F,H)}),!0,c,N,q);return H.onCompleteObservable.add((()=>{H._lengthComputable=!0,H._total=H._loaded})),this._requests.push(H),H}_onProgress(F,P){if(!this._progressCallback)return;P._lengthComputable=F.lengthComputable,P._loaded=F.loaded,P._total=F.total;let f=!0,c=0,N=0;for(const q of this._requests){if(void 0===q._lengthComputable||void 0===q._loaded||void 0===q._total)return;f=f&&q._lengthComputable,c+=q._loaded,N+=q._total}this._progressCallback({lengthComputable:f,loaded:c,total:f?N:0})}_validate(F,P){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),R.d.ValidateAsync(P,f,c,(P=>this.preprocessUrlAsync(f+P).then((P=>F._loadFileAsync(P,void 0,!0,!0).then((F=>new Uint8Array(F,0,F.byteLength))))))).then((F=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(F),this.onValidatedObservable.clear()}),(F=>{this._endPerformanceCounter("Validate JSON"),N.Tools.Warn(`Failed to validate: ${F.message}`),this.onValidatedObservable.clear()})))}_getLoader(F){const P=F.json.asset||{};this._log(`Asset version: ${P.version}`),P.minVersion&&this._log(`Asset minimum version: ${P.minVersion}`),P.generator&&this._log(`Asset generator: ${P.generator}`);const f=I._parseVersion(P.version);if(!f)throw new Error("Invalid version: "+P.version);if(void 0!==P.minVersion){const F=I._parseVersion(P.minVersion);if(!F)throw new Error("Invalid minimum version: "+P.minVersion);if(I._compareVersion(F,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+P.minVersion)}const c={1:I._CreateGLTF1Loader,2:I._CreateGLTF2Loader}[f.major];if(!c)throw new Error("Unsupported version: "+P.version);return c(this)}_parseJson(F){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${F.length}`);const P=JSON.parse(F);return this._endPerformanceCounter("Parse JSON"),P}_unpackBinaryAsync(F){return this._startPerformanceCounter("Unpack Binary"),F.loadAsync(20).then((()=>{const P=F.readUint32();if(1179937895!==P)throw new K.h("Unexpected magic: "+P,K.e.GLTFLoaderUnexpectedMagicError);const f=F.readUint32();this.loggingEnabled&&this._log(`Binary version: ${f}`);const c=F.readUint32();let N;switch(this.useRangeRequests||c===F.buffer.byteLength||j.d.Warn(`Length in header does not match actual data length: ${c} != ${F.buffer.byteLength}`),f){case 1:N=this._unpackBinaryV1Async(F,c);break;case 2:N=this._unpackBinaryV2Async(F,c);break;default:throw new Error("Unsupported version: "+f)}return this._endPerformanceCounter("Unpack Binary"),N}))}_unpackBinaryV1Async(F,P){const f=F.readUint32(),c=F.readUint32();if(0!==c)throw new Error(`Unexpected content format: ${c}`);const N=P-F.byteOffset,q={json:this._parseJson(F.readString(f)),bin:null};if(0!==N){const P=F.byteOffset;q.bin={readAsync:(f,c)=>F.buffer.readAsync(P+f,c),byteLength:N}}return Promise.resolve(q)}_unpackBinaryV2Async(F,P){const f=1313821514,c=5130562,N=F.readUint32();if(F.readUint32()!==f)throw new Error("First chunk format is not JSON");return F.byteOffset+N===P?F.loadAsync(N).then((()=>({json:this._parseJson(F.readString(N)),bin:null}))):F.loadAsync(N+8).then((()=>{const q={json:this._parseJson(F.readString(N)),bin:null},H=()=>{const N=F.readUint32();switch(F.readUint32()){case f:throw new Error("Unexpected JSON chunk");case c:{const P=F.byteOffset;q.bin={readAsync:(f,c)=>F.buffer.readAsync(P+f,c),byteLength:N},F.skipBytes(N);break}default:F.skipBytes(N)}return F.byteOffset!==P?F.loadAsync(8).then(H):Promise.resolve(q)};return H()}))}static _parseVersion(F){if("1.0"===F||"1.0.1"===F)return{major:1,minor:0};const P=(F+"").match(/^(\d+)\.(\d+)/);return P?{major:parseInt(P[1]),minor:parseInt(P[2])}:null}static _compareVersion(F,P){return F.major>P.major?1:F.major<P.major?-1:F.minor>P.minor?1:F.minor<P.minor?-1:0}_logOpen(F){this._log(F),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(F){const P=I._logSpaces.substring(0,2*this._logIndentLevel);j.d.Log(`${P}${F}`)}_logDisabled(F){}_startPerformanceCounterEnabled(F){N.Tools.StartPerformanceCounter(F)}_startPerformanceCounterDisabled(F){}_endPerformanceCounterEnabled(F){N.Tools.EndPerformanceCounter(F)}_endPerformanceCounterDisabled(F){}}I.IncrementalLoading=!0,I.HomogeneousCoordinates=!1,I._logSpaces="                                ",(0,q.c)(new I)},13197:(F,P,f)=>{"use strict";f.d(P,{d:()=>H});var c=f(11462);function N(F,P,f,c){const N={externalResourceFunction:c};return f&&(N.uri="file:"===P?f:P+f),ArrayBuffer.isView(F)?GLTFValidator.validateBytes(F,N):GLTFValidator.validateString(F,N)}function q(){const F=[];onmessage=P=>{const f=P.data;switch(f.id){case"init":importScripts(f.url);break;case"validate":N(f.data,f.rootUrl,f.fileName,(P=>new Promise(((f,c)=>{const N=F.length;F.push({resolve:f,reject:c}),postMessage({id:"getExternalResource",index:N,uri:P})})))).then((F=>{postMessage({id:"validate.resolve",value:F})}),(F=>{postMessage({id:"validate.reject",reason:F})}));break;case"getExternalResource.resolve":F[f.index].resolve(f.value);break;case"getExternalResource.reject":F[f.index].reject(f.reason)}}}class H{static ValidateAsync(F,P,f,H){return"function"===typeof Worker?new Promise(((A,o)=>{const j=`${N}(${q})()`,i=URL.createObjectURL(new Blob([j],{type:"application/javascript"})),u=new Worker(i),T=F=>{u.removeEventListener("error",T),u.removeEventListener("message",Y),o(F)},Y=F=>{const P=F.data;switch(P.id){case"getExternalResource":H(P.uri).then((F=>{u.postMessage({id:"getExternalResource.resolve",index:P.index,value:F},[F.buffer])}),(F=>{u.postMessage({id:"getExternalResource.reject",index:P.index,reason:F})}));break;case"validate.resolve":u.removeEventListener("error",T),u.removeEventListener("message",Y),A(P.value),u.terminate();break;case"validate.reject":u.removeEventListener("error",T),u.removeEventListener("message",Y),o(P.reason),u.terminate()}};if(u.addEventListener("error",T),u.addEventListener("message",Y),u.postMessage({id:"init",url:c.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(F)){const c=F.slice();u.postMessage({id:"validate",data:c,rootUrl:P,fileName:f},[c.buffer])}else u.postMessage({id:"validate",data:F,rootUrl:P,fileName:f})})):(this._LoadScriptPromise||(this._LoadScriptPromise=c.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>N(F,P,f,H))))}}H.Configuration={url:`${c.Tools._DefaultCdnUrl}/gltf_validator.js`}},13763:(F,P,f)=>{"use strict";f.d(P,{e:()=>O});var c=f(11619),N=f(11628),q=f(11677),H=f(11639),A=f(11994),o=f(11931),j=f(11706),i=f(11845),u=f(11587),T=f(11548);f(12993),f(12906),f(12924),f(12909),f(12929),f(12931),f(12933);const Y="imageProcessingCompatibility",t="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";T.c.IncludesShadersStore[Y]||(T.c.IncludesShadersStore[Y]=t);const C="skyPixelShader",L="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";T.c.ShadersStore[C]||(T.c.ShadersStore[C]=L);f(12998),f(12935),f(12944),f(12952),f(12950);const J="skyVertexShader",B="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";T.c.ShadersStore[J]||(T.c.ShadersStore[J]=B);var z=f(11926),Z=f(11976),R=f(11973);class y extends A.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class O extends o.d{constructor(F,P){super(F,P),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new H.tP(0,100,0),this.useSunPosition=!1,this.cameraOffset=H.tP.Zero(),this.up=H.tP.Up(),this.dithering=!1,this._cameraPosition=H.tP.Zero(),this._skyOrientation=new H.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(F,P){const f=P._drawWrapper;if(this.isFrozen&&f.effect&&f._wasPreviouslyReady)return!0;P.materialDefines||(P.materialDefines=new y);const c=P.materialDefines,N=this.OF();if(this._isReadyForSubMesh(P))return!0;if((0,R.Z)(F,N,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,c),(0,R.P)(F,c,!0,!1),c.IMAGEPROCESSINGPOSTPROCESS!==N.imageProcessingConfiguration.applyByPostProcess&&c.markAsMiscDirty(),c.DITHER!==this.dithering&&c.markAsMiscDirty(),c.isDirty){c.markAsProcessed(),N.resetCachedMaterial();const F=new z.c;c.FOG&&F.addFallback(1,"FOG"),c.IMAGEPROCESSINGPOSTPROCESS=N.imageProcessingConfiguration.applyByPostProcess,c.DITHER=this.dithering;const f=[j.f.PositionKind];c.VERTEXCOLOR&&f.push(j.f.ColorKind);const q="sky",H=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Z.c)(H);const A=c.toString();P.setEffect(N.getEngine().createEffect(q,f,H,[],A,F,this.onCompiled,this.onError),c,this._materialContext)}return!(!P.effect||!P.effect.isReady())&&(c._renderId=N.getRenderId(),f._wasPreviouslyReady=!0,!0)}bindForSubMesh(F,P,f){const c=this.OF(),N=f.materialDefines;if(!N)return;const q=f.effect;if(!q)return;this._activeEffect=q,this.bindOnlyWorldMatrix(F),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),this._mustRebind(c,q,f)&&((0,Z.d)(q,this,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,R.n)(N,q,c)),c.fogEnabled&&P.applyFog&&c.fogMode!==i.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),(0,R.f)(c,P,this._activeEffect);const A=c.activeCamera;if(A){const F=A.getWorldMatrix();this._cameraPosition.x=F.m[12],this._cameraPosition.y=F.m[13],this._cameraPosition.z=F.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const F=Math.PI*(this.inclination-.5),P=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(P)*Math.cos(F),this.sunPosition.y=this.distance*Math.sin(-F),this.sunPosition.z=this.distance*Math.sin(P)*Math.cos(F),H.Quaternion.FromUnitVectorsToRef(H.tP.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(P,this._activeEffect,f)}getAnimatables(){return[]}dispose(F){super.dispose(F)}clone(F){return q.e.Clone((()=>new O(F,this.OF())),this)}serialize(){const F=super.serialize();return F.customType="BABYLON.SkyMaterial",F}getClassName(){return"SkyMaterial"}static Parse(F,P,f){return q.e.Parse((()=>new O(F.name,P)),F,P,f)}}(0,c.e)([(0,N.L)()],O.prototype,"luminance",void 0),(0,c.e)([(0,N.L)()],O.prototype,"turbidity",void 0),(0,c.e)([(0,N.L)()],O.prototype,"rayleigh",void 0),(0,c.e)([(0,N.L)()],O.prototype,"mieCoefficient",void 0),(0,c.e)([(0,N.L)()],O.prototype,"mieDirectionalG",void 0),(0,c.e)([(0,N.L)()],O.prototype,"distance",void 0),(0,c.e)([(0,N.L)()],O.prototype,"inclination",void 0),(0,c.e)([(0,N.L)()],O.prototype,"azimuth",void 0),(0,c.e)([(0,N.H)()],O.prototype,"sunPosition",void 0),(0,c.e)([(0,N.L)()],O.prototype,"useSunPosition",void 0),(0,c.e)([(0,N.H)()],O.prototype,"cameraOffset",void 0),(0,c.e)([(0,N.H)()],O.prototype,"up",void 0),(0,c.e)([(0,N.L)()],O.prototype,"dithering",void 0),(0,u.f)("BABYLON.SkyMaterial",O)},12315:(F,P,f)=>{"use strict";function c(F,P){P.headers=F.headers||{},P.statusMessage=F.statusText,P.statusCode=F.status,P.data=F.response}function N(F,P,f){return new Promise((function(N,q){f=f||{};var H,A,o,j=new XMLHttpRequest,i=f.body,u=f.headers||{};for(H in f.timeout&&(j.timeout=f.timeout),j.ontimeout=j.onerror=function(F){F.timeout="timeout"==F.type,q(F)},j.open(F,P.href||P),j.onload=function(){for(o=j.getAllResponseHeaders().trim().split(/[\r\n]+/),c(j,j);A=o.shift();)A=A.split(": "),j.headers[A.shift().toLowerCase()]=A.join(": ");if((A=j.headers["content-type"])&&~A.indexOf("application/json"))try{j.data=JSON.parse(j.data,f.reviver)}catch(F){return c(j,F),q(F)}(j.status>=400?q:N)(j)},typeof FormData<"u"&&i instanceof FormData||i&&"object"==typeof i&&(u["content-type"]="application/json",i=JSON.stringify(i)),j.withCredentials=!!f.withCredentials,u)j.setRequestHeader(H,u[H]);j.send(i)}))}f.r(P),f.d(P,{del:()=>o,get:()=>q,patch:()=>A,post:()=>H,put:()=>j,send:()=>N});var q=N.bind(N,"GET"),H=N.bind(N,"POST"),A=N.bind(N,"PATCH"),o=N.bind(N,"DELETE"),j=N.bind(N,"PUT")},13883:(F,P,f)=>{"use strict";f.d(P,{b:()=>u});const c=.5*(Math.sqrt(3)-1),N=(3-Math.sqrt(3))/6,q=1/3,H=1/6,A=(Math.sqrt(5)-1)/4,o=(5-Math.sqrt(5))/20,j=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),i=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const u=class{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const P="function"==typeof F?F:function(F){let P=0,f=0,c=0,N=1;const q=function(){let F=4022871197;return function(P){P=P.toString();for(let f=0;f<P.length;f++){F+=P.charCodeAt(f);let c=.02519603282416938*F;F=c>>>0,c-=F,c*=F,F=c>>>0,c-=F,F+=4294967296*c}return 2.3283064365386963e-10*(F>>>0)}}();P=q(" "),f=q(" "),c=q(" "),P-=q(F),P<0&&(P+=1);f-=q(F),f<0&&(f+=1);c-=q(F),c<0&&(c+=1);return function(){const F=2091639*P+2.3283064365386963e-10*N;return P=f,f=c,c=F-(N=0|F)}}(F);this.p=function(F){const P=new Uint8Array(256);for(let f=0;f<256;f++)P[f]=f;for(let f=0;f<255;f++){const c=f+~~(F()*(256-f)),N=P[f];P[f]=P[c],P[c]=N}return P}(P),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let f=0;f<512;f++)this.perm[f]=this.p[255&f],this.permMod12[f]=this.perm[f]%12}noise2D(F,P){const f=this.permMod12,q=this.perm;let H=0,A=0,o=0;const i=(F+P)*c,u=Math.floor(F+i),T=Math.floor(P+i),Y=(u+T)*N,t=F-(u-Y),C=P-(T-Y);let L,J;t>C?(L=1,J=0):(L=0,J=1);const B=t-L+N,z=C-J+N,Z=t-1+2*N,R=C-1+2*N,y=255&u,O=255&T;let d=.5-t*t-C*C;if(d>=0){const F=3*f[y+q[O]];d*=d,H=d*d*(j[F]*t+j[F+1]*C)}let M=.5-B*B-z*z;if(M>=0){const F=3*f[y+L+q[O+J]];M*=M,A=M*M*(j[F]*B+j[F+1]*z)}let V=.5-Z*Z-R*R;if(V>=0){const F=3*f[y+1+q[O+1]];V*=V,o=V*V*(j[F]*Z+j[F+1]*R)}return 70*(H+A+o)}noise3D(F,P,f){const c=this.permMod12,N=this.perm;let A,o,i,u;const T=(F+P+f)*q,Y=Math.floor(F+T),t=Math.floor(P+T),C=Math.floor(f+T),L=(Y+t+C)*H,J=F-(Y-L),B=P-(t-L),z=f-(C-L);let Z,R,y,O,d,M;J>=B?B>=z?(Z=1,R=0,y=0,O=1,d=1,M=0):J>=z?(Z=1,R=0,y=0,O=1,d=0,M=1):(Z=0,R=0,y=1,O=1,d=0,M=1):B<z?(Z=0,R=0,y=1,O=0,d=1,M=1):J<z?(Z=0,R=1,y=0,O=0,d=1,M=1):(Z=0,R=1,y=0,O=1,d=1,M=0);const V=J-Z+H,Q=B-R+H,K=z-y+H,x=J-O+2*H,k=B-d+2*H,I=z-M+2*H,E=J-1+.5,r=B-1+.5,n=z-1+.5,p=255&Y,U=255&t,e=255&C;let D=.6-J*J-B*B-z*z;if(D<0)A=0;else{const F=3*c[p+N[U+N[e]]];D*=D,A=D*D*(j[F]*J+j[F+1]*B+j[F+2]*z)}let l=.6-V*V-Q*Q-K*K;if(l<0)o=0;else{const F=3*c[p+Z+N[U+R+N[e+y]]];l*=l,o=l*l*(j[F]*V+j[F+1]*Q+j[F+2]*K)}let W=.6-x*x-k*k-I*I;if(W<0)i=0;else{const F=3*c[p+O+N[U+d+N[e+M]]];W*=W,i=W*W*(j[F]*x+j[F+1]*k+j[F+2]*I)}let b=.6-E*E-r*r-n*n;if(b<0)u=0;else{const F=3*c[p+1+N[U+1+N[e+1]]];b*=b,u=b*b*(j[F]*E+j[F+1]*r+j[F+2]*n)}return 32*(A+o+i+u)}noise4D(F,P,f,c){const N=this.perm;let q,H,j,u,T;const Y=(F+P+f+c)*A,t=Math.floor(F+Y),C=Math.floor(P+Y),L=Math.floor(f+Y),J=Math.floor(c+Y),B=(t+C+L+J)*o,z=F-(t-B),Z=P-(C-B),R=f-(L-B),y=c-(J-B);let O=0,d=0,M=0,V=0;z>Z?O++:d++,z>R?O++:M++,z>y?O++:V++,Z>R?d++:M++,Z>y?d++:V++,R>y?M++:V++;const Q=O>=3?1:0,K=d>=3?1:0,x=M>=3?1:0,k=V>=3?1:0,I=O>=2?1:0,E=d>=2?1:0,r=M>=2?1:0,n=V>=2?1:0,p=O>=1?1:0,U=d>=1?1:0,e=M>=1?1:0,D=V>=1?1:0,l=z-Q+o,W=Z-K+o,b=R-x+o,v=y-k+o,s=z-I+2*o,X=Z-E+2*o,m=R-r+2*o,a=y-n+2*o,w=z-p+3*o,g=Z-U+3*o,G=R-e+3*o,h=y-D+3*o,S=z-1+4*o,FF=Z-1+4*o,PF=R-1+4*o,fF=y-1+4*o,cF=255&t,NF=255&C,qF=255&L,HF=255&J;let AF=.6-z*z-Z*Z-R*R-y*y;if(AF<0)q=0;else{const F=N[cF+N[NF+N[qF+N[HF]]]]%32*4;AF*=AF,q=AF*AF*(i[F]*z+i[F+1]*Z+i[F+2]*R+i[F+3]*y)}let oF=.6-l*l-W*W-b*b-v*v;if(oF<0)H=0;else{const F=N[cF+Q+N[NF+K+N[qF+x+N[HF+k]]]]%32*4;oF*=oF,H=oF*oF*(i[F]*l+i[F+1]*W+i[F+2]*b+i[F+3]*v)}let jF=.6-s*s-X*X-m*m-a*a;if(jF<0)j=0;else{const F=N[cF+I+N[NF+E+N[qF+r+N[HF+n]]]]%32*4;jF*=jF,j=jF*jF*(i[F]*s+i[F+1]*X+i[F+2]*m+i[F+3]*a)}let iF=.6-w*w-g*g-G*G-h*h;if(iF<0)u=0;else{const F=N[cF+p+N[NF+U+N[qF+e+N[HF+D]]]]%32*4;iF*=iF,u=iF*iF*(i[F]*w+i[F+1]*g+i[F+2]*G+i[F+3]*h)}let uF=.6-S*S-FF*FF-PF*PF-fF*fF;if(uF<0)T=0;else{const F=N[cF+1+N[NF+1+N[qF+1+N[HF+1]]]]%32*4;uF*=uF,T=uF*uF*(i[F]*S+i[F+1]*FF+i[F+2]*PF+i[F+3]*fF)}return 27*(q+H+j+u+T)}}}}]);