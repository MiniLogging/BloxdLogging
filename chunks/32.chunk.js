/*! For license information please see l3hvpl.32.84ee252f.chunk.js.LICENSE.txt */
(self.v2pspxy442l=self.v2pspxy442l||[]).push([[32],{14425:(l,a,N)=>{"use strict";var U=N(14429),c=N(14437),K=N(14446);N.g.__TYPEDARRAY_POOL||(N.g.__TYPEDARRAY_POOL={UINT8:c([32,0]),UINT16:c([32,0]),UINT32:c([32,0]),INT8:c([32,0]),INT16:c([32,0]),INT32:c([32,0]),FLOAT:c([32,0]),DOUBLE:c([32,0]),DATA:c([32,0]),UINT8C:c([32,0]),BUFFER:c([32,0])});var Z="undefined"!==typeof Uint8ClampedArray,w=N.g.__TYPEDARRAY_POOL;w.UINT8C||(w.UINT8C=c([32,0])),w.BUFFER||(w.BUFFER=c([32,0]));var S=w.DATA,T=w.BUFFER;function J(l){if(l){var a=l.length||l.byteLength,N=U.log2(a);S[N].push(l)}}function n(l){l=U.nextPow2(l);var a=U.log2(l),N=S[a];return N.length>0?N.pop():new ArrayBuffer(l)}function y(l){return new Uint8Array(n(l),0,l)}function H(l){return new Uint16Array(n(2*l),0,l)}function u(l){return new Uint32Array(n(4*l),0,l)}function W(l){return new Int8Array(n(l),0,l)}function B(l){return new Int16Array(n(2*l),0,l)}function Y(l){return new Int32Array(n(4*l),0,l)}function C(l){return new Float32Array(n(4*l),0,l)}function M(l){return new Float64Array(n(8*l),0,l)}function A(l){return Z?new Uint8ClampedArray(n(l),0,l):y(l)}function E(l){return new DataView(n(l),0,l)}a.free=function(l){if(K(l))T[U.log2(l.length)].push(l);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(l)&&(l=l.buffer),!l)return;var a=l.length||l.byteLength,N=0|U.log2(a);S[N].push(l)}},a.freeUint8=a.freeUint16=a.freeUint32=a.freeInt8=a.freeInt16=a.freeInt32=a.freeFloat32=a.freeFloat=a.freeFloat64=a.freeDouble=a.freeUint8Clamped=a.freeDataView=function(l){J(l.buffer)},a.freeArrayBuffer=J,a.freeBuffer=function(l){T[U.log2(l.length)].push(l)},a.malloc=function(l,a){if(void 0===a||"arraybuffer"===a)return n(l);switch(a){case"uint8":return y(l);case"uint16":return H(l);case"uint32":return u(l);case"int8":return W(l);case"int16":return B(l);case"int32":return Y(l);case"float":case"float32":return C(l);case"double":case"float64":return M(l);case"uint8_clamped":return A(l);case"buffer":throw"Buffer not supported";case"data":case"dataview":return E(l);default:return null}return null},a.mallocArrayBuffer=n,a.mallocUint8=y,a.mallocUint16=H,a.mallocUint32=u,a.mallocInt8=W,a.mallocInt16=B,a.mallocInt32=Y,a.mallocFloat32=a.mallocFloat=C,a.mallocFloat64=a.mallocDouble=M,a.mallocUint8Clamped=A,a.mallocDataView=E,a.clearCache=function(){for(var l=0;l<32;++l)w.UINT8[l].length=0,w.UINT16[l].length=0,w.UINT32[l].length=0,w.INT8[l].length=0,w.INT16[l].length=0,w.INT32[l].length=0,w.FLOAT[l].length=0,w.DOUBLE[l].length=0,w.UINT8C[l].length=0,S[l].length=0,T[l].length=0}},14522:(l,a,N)=>{l.exports=c;var U=N(13220);function c(l,a){if(!(this instanceof c))return new c(l,a);var N=U.create();U.add(N,l,a),this.base=U.min(U.create(),l,N),this.KJ=U.clone(a),this.max=U.max(U.create(),l,N),this.mag=U.length(this.KJ)}var K=c.prototype;K.width=function(){return this.KJ[0]},K.height=function(){return this.KJ[1]},K.depth=function(){return this.KJ[2]},K.x0=function(){return this.base[0]},K.y0=function(){return this.base[1]},K.z0=function(){return this.base[2]},K.x1=function(){return this.max[0]},K.y1=function(){return this.max[1]},K.z1=function(){return this.max[2]},K.translate=function(l){return U.add(this.max,this.max,l),U.add(this.base,this.base,l),this},K.setPosition=function(l){return U.add(this.max,l,this.KJ),U.j(this.base,l),this},K.expand=function(l){var a=U.create(),N=U.create();return U.max(a,l.max,this.max),U.min(N,l.base,this.base),U.Wa(a,a,N),new c(N,a)},K.intersects=function(l){return!(l.base[0]>this.max[0])&&(!(l.base[1]>this.max[1])&&(!(l.base[2]>this.max[2])&&(!(l.max[0]<this.base[0])&&(!(l.max[1]<this.base[1])&&!(l.max[2]<this.base[2])))))},K.touches=function(l){var a=this.union(l);return null!==a&&(0==a.width()||0==a.height()||0==a.depth())},K.union=function(l){if(!this.intersects(l))return null;var a=Math.max(l.base[0],this.base[0]),N=Math.max(l.base[1],this.base[1]),U=Math.max(l.base[2],this.base[2]);return new c([a,N,U],[Math.min(l.max[0],this.max[0])-a,Math.min(l.max[1],this.max[1])-N,Math.min(l.max[2],this.max[2])-U])}},14429:(l,a)=>{"use strict";function N(l){var a=32;return(l&=-l)&&a--,65535&l&&(a-=16),16711935&l&&(a-=8),252645135&l&&(a-=4),858993459&l&&(a-=2),1431655765&l&&(a-=1),a}a.INT_BITS=32,a.INT_MAX=2147483647,a.INT_MIN=-1<<31,a.sign=function(l){return(l>0)-(l<0)},a.abs=function(l){var a=l>>31;return(l^a)-a},a.min=function(l,a){return a^(l^a)&-(l<a)},a.max=function(l,a){return l^(l^a)&-(l<a)},a.isPow2=function(l){return!(l&l-1)&&!!l},a.log2=function(l){var a,N;return a=(l>65535)<<4,a|=N=((l>>>=a)>255)<<3,a|=N=((l>>>=N)>15)<<2,(a|=N=((l>>>=N)>3)<<1)|(l>>>=N)>>1},a.log10=function(l){return l>=1e9?9:l>=1e8?8:l>=1e7?7:l>=1e6?6:l>=1e5?5:l>=1e4?4:l>=1e3?3:l>=100?2:l>=10?1:0},a.popCount=function(l){return 16843009*((l=(858993459&(l-=l>>>1&1431655765))+(l>>>2&858993459))+(l>>>4)&252645135)>>>24},a.countTrailingZeros=N,a.nextPow2=function(l){return l+=0===l,--l,l|=l>>>1,l|=l>>>2,l|=l>>>4,l|=l>>>8,(l|=l>>>16)+1},a.prevPow2=function(l){return l|=l>>>1,l|=l>>>2,l|=l>>>4,l|=l>>>8,(l|=l>>>16)-(l>>>1)},a.parity=function(l){return l^=l>>>16,l^=l>>>8,l^=l>>>4,27030>>>(l&=15)&1};var U=new Array(256);!function(l){for(var a=0;a<256;++a){var N=a,U=a,c=7;for(N>>>=1;N;N>>>=1)U<<=1,U|=1&N,--c;l[a]=U<<c&255}}(U),a.reverse=function(l){return U[255&l]<<24|U[l>>>8&255]<<16|U[l>>>16&255]<<8|U[l>>>24&255]},a.interleave2=function(l,a){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l&=65535)|l<<8))|l<<4))|l<<2))|l<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))<<1},a.deinterleave2=function(l,a){return(l=65535&((l=16711935&((l=252645135&((l=858993459&((l=l>>>a&1431655765)|l>>>1))|l>>>2))|l>>>4))|l>>>16))<<16>>16},a.interleave3=function(l,a,N){return l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2),(l|=(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<1)|(N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2))<<2},a.deinterleave3=function(l,a){return(l=1023&((l=4278190335&((l=251719695&((l=3272356035&((l=l>>>a&1227133513)|l>>>2))|l>>>4))|l>>>8))|l>>>16))<<22>>22},a.nextCombination=function(l){var a=l|l-1;return a+1|(~a&-~a)-1>>>N(l)+1}},14420:(l,a,N)=>{"use strict";l.exports=function(l,a,N){switch(arguments.length){case 1:return U=[],T(c=l,c,J,!0),U;case 2:return"function"===typeof a?T(l,l,a,!0):function(l,a){return U=[],T(l,a,J,!1),U}(l,a);case 3:return T(l,a,N,!1);default:throw new Error("box-intersect: Invalid arguments")}var c};var U,c=N(14425),K=N(14452),Z=N(14462);function w(l,a){for(var N=0;N<l;++N)if(!(a[N]<=a[N+l]))return!0;return!1}function S(l,a,N,U){for(var c=0,K=0,Z=0,S=l.length;Z<S;++Z){var T=l[Z];if(!w(a,T)){for(var J=0;J<2*a;++J)N[c++]=T[J];U[K++]=Z}}return K}function T(l,a,N,U){var w=l.length,T=a.length;if(!(w<=0||T<=0)){var J=l[0].length>>>1;if(!(J<=0)){var n,y=c.mallocDouble(2*J*w),H=c.mallocInt32(w);if((w=S(l,J,y,H))>0){if(1===J&&U)K.init(w),n=K.sweepComplete(J,N,0,w,y,H,0,w,y,H);else{var u=c.mallocDouble(2*J*T),W=c.mallocInt32(T);(T=S(a,J,u,W))>0&&(K.init(w+T),n=1===J?K.sweepBipartite(J,N,0,w,y,H,0,T,u,W):Z(J,N,U,w,y,H,T,u,W),c.free(u),c.free(W))}c.free(y),c.free(H)}return n}}}function J(l,a){U.push([l,a])}},14470:(l,a)=>{"use strict";var N="d",U="ax",c="fp",K="es",Z="rs",w="re",S="rb",T="bs",J="be",n="bb",y=[N,U,"vv",Z,w,S,"ri",T,J,n,"bi"];function H(l){var a="bruteForce"+(l?"Full":"Partial"),U=[],Z=y.slice();l||Z.splice(3,0,c);var w=["function "+a+"("+Z.join()+"){"];function S(a,c){var Z=function(l,a,U){var c="bruteForce"+(l?"Red":"Blue")+(a?"Flip":"")+(U?"Full":""),Z=["function ",c,"(",y.join(),"){","var ",K,"=2*",N,";"],w="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",S="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(U?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return l?Z.push(w,"Q",":",S):Z.push(S,"Q",":",w),U?Z.push("if(y1<x0||x1<y0)continue;"):a?Z.push("if(y0<=x0||x1<y0)continue;"):Z.push("if(y0<x0||x1<y0)continue;"),Z.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),a?Z.push("yi,xi"):Z.push("xi,yi"),Z.push(");if(rv!==void 0)return rv;}}}"),{name:c,code:Z.join("")}}(a,c,l);U.push(Z.code),w.push("return "+Z.name+"("+y.join()+");")}w.push("if(re-rs>be-bs){"),l?(S(!0,!1),w.push("}else{"),S(!1,!1)):(w.push("if(fp){"),S(!0,!0),w.push("}else{"),S(!0,!1),w.push("}}else{if(fp){"),S(!1,!0),w.push("}else{"),S(!1,!1),w.push("}")),w.push("}}return "+a);var T=U.join("")+w.join("");return new Function(T)()}a.partial=H(!1),a.full=H(!0)},14462:(l,a,N)=>{"use strict";l.exports=function(l,a,N,K,J,O,h,i,k){!function(l,a){var N=8*c.log2(a+1)*(l+1)|0,K=c.nextPow2(A*N);q.length<K&&(U.free(q),q=U.mallocInt32(K));var Z=c.nextPow2(E*N);b.length<Z&&(U.free(b),b=U.mallocDouble(Z))}(l,K+h);var Q,j=0,f=2*l;z(j++,0,0,K,0,h,N?16:0,-1/0,1/0),N||z(j++,0,0,h,0,K,1,-1/0,1/0);for(;j>0;){var p=(j-=1)*A,R=q[p],L=q[p+1],r=q[p+2],X=q[p+3],P=q[p+4],d=q[p+5],F=j*E,e=b[F],s=b[F+1],o=1&d,G=!!(16&d),ml=J,x=O,V=i,D=k;if(o&&(ml=i,x=k,V=J,D=O),!(2&d&&L>=(r=B(l,R,L,r,ml,x,s)))&&!(4&d&&(L=Y(l,R,L,r,ml,x,e))>=r)){var v=r-L,g=P-X;if(G){if(l*v*(v+g)<H){if(void 0!==(Q=S.scanComplete(l,R,a,L,r,ml,x,X,P,V,D)))return Q;continue}}else{if(l*Math.min(v,g)<n){if(void 0!==(Q=Z(l,R,a,o,L,r,ml,x,X,P,V,D)))return Q;continue}if(l*v*g<y){if(void 0!==(Q=S.scanBipartite(l,R,a,o,L,r,ml,x,X,P,V,D)))return Q;continue}}var ll=u(l,R,L,r,ml,x,e,s);if(L<ll)if(l*(ll-L)<n){if(void 0!==(Q=w(l,R+1,a,L,ll,ml,x,X,P,V,D)))return Q}else if(R===l-2){if(void 0!==(Q=o?S.sweepBipartite(l,a,X,P,V,D,L,ll,ml,x):S.sweepBipartite(l,a,L,ll,ml,x,X,P,V,D)))return Q}else z(j++,R+1,L,ll,X,P,o,-1/0,1/0),z(j++,R+1,X,P,L,ll,1^o,-1/0,1/0);if(ll<r){var al=T(l,R,X,P,V,D),Nl=V[f*al+R],Ul=W(l,R,al,P,V,D,Nl);if(Ul<P&&z(j++,R,ll,r,Ul,P,(4|o)+(G?16:0),Nl,s),X<al&&z(j++,R,ll,r,X,al,(2|o)+(G?16:0),e,Nl),al+1===Ul){if(void 0!==(Q=G?t(l,R,a,ll,r,ml,x,al,V,D[al]):I(l,R,a,o,ll,r,ml,x,al,V,D[al])))return Q}else if(al<Ul){var cl;if(G){if(ll<(cl=C(l,R,ll,r,ml,x,Nl))){var Kl=W(l,R,ll,cl,ml,x,Nl);if(R===l-2){if(ll<Kl&&void 0!==(Q=S.sweepComplete(l,a,ll,Kl,ml,x,al,Ul,V,D)))return Q;if(Kl<cl&&void 0!==(Q=S.sweepBipartite(l,a,Kl,cl,ml,x,al,Ul,V,D)))return Q}else ll<Kl&&z(j++,R+1,ll,Kl,al,Ul,16,-1/0,1/0),Kl<cl&&(z(j++,R+1,Kl,cl,al,Ul,0,-1/0,1/0),z(j++,R+1,al,Ul,Kl,cl,1,-1/0,1/0))}}else ll<(cl=o?M(l,R,ll,r,ml,x,Nl):C(l,R,ll,r,ml,x,Nl))&&(R===l-2?Q=o?S.sweepBipartite(l,a,al,Ul,V,D,ll,cl,ml,x):S.sweepBipartite(l,a,ll,cl,ml,x,al,Ul,V,D):(z(j++,R+1,ll,cl,al,Ul,o,-1/0,1/0),z(j++,R+1,al,Ul,ll,cl,1^o,-1/0,1/0)))}}}}};var U=N(14425),c=N(14429),K=N(14470),Z=K.partial,w=K.full,S=N(14452),T=N(14474),J=N(14477),n=128,y=1<<22,H=1<<22,u=J("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),W=J("lo===p0",["p0"]),B=J("lo<p0",["p0"]),Y=J("hi<=p0",["p0"]),C=J("lo<=p0&&p0<=hi",["p0"]),M=J("lo<p0&&p0<=hi",["p0"]),A=6,E=2,q=U.mallocInt32(1024),b=U.mallocDouble(1024);function z(l,a,N,U,c,K,Z,w,S){var T=A*l;q[T]=a,q[T+1]=N,q[T+2]=U,q[T+3]=c,q[T+4]=K,q[T+5]=Z;var J=E*l;b[J]=w,b[J+1]=S}function I(l,a,N,U,c,K,Z,w,S,T,J){var n=2*l,y=S*n,H=T[y+a];l:for(var u=c,W=c*n;u<K;++u,W+=n){var B=Z[W+a],Y=Z[W+a+l];if(!(H<B||Y<H)&&(!U||H!==B)){for(var C,M=w[u],A=a+1;A<l;++A){B=Z[W+A],Y=Z[W+A+l];var E=T[y+A],q=T[y+A+l];if(Y<E||q<B)continue l}if(void 0!==(C=U?N(J,M):N(M,J)))return C}}}function t(l,a,N,U,c,K,Z,w,S,T){var J=2*l,n=w*J,y=S[n+a];l:for(var H=U,u=U*J;H<c;++H,u+=J){var W=Z[H];if(W!==T){var B=K[u+a],Y=K[u+a+l];if(!(y<B||Y<y)){for(var C=a+1;C<l;++C){B=K[u+C],Y=K[u+C+l];var M=S[n+C],A=S[n+C+l];if(Y<M||A<B)continue l}var E=N(W,T);if(void 0!==E)return E}}}}},14474:(l,a,N)=>{"use strict";l.exports=function(l,a,N,Z,w,S){if(Z<=N+1)return N;var T=N,J=Z,n=Z+N>>>1,y=2*l,H=n,u=w[y*n+a];for(;T<J;){if(J-T<c){K(l,a,T,J,w,S),u=w[y*n+a];break}var W=J-T,B=Math.random()*W+T|0,Y=w[y*B+a],C=Math.random()*W+T|0,M=w[y*C+a],A=Math.random()*W+T|0,E=w[y*A+a];Y<=M?E>=M?(H=C,u=M):Y>=E?(H=B,u=Y):(H=A,u=E):M>=E?(H=C,u=M):E>=Y?(H=B,u=Y):(H=A,u=E);for(var q=y*(J-1),b=y*H,z=0;z<y;++z,++q,++b){var I=w[q];w[q]=w[b],w[b]=I}var t=S[J-1];S[J-1]=S[H],S[H]=t;for(q=y*(J-1),b=y*(H=U(l,a,T,J-1,w,S,u)),z=0;z<y;++z,++q,++b){I=w[q];w[q]=w[b],w[b]=I}t=S[J-1];if(S[J-1]=S[H],S[H]=t,n<H){for(J=H-1;T<J&&w[y*(J-1)+a]===u;)J-=1;J+=1}else{if(!(H<n))break;for(T=H+1;T<J&&w[y*T+a]===u;)T+=1}}return U(l,a,N,n,w,S,w[y*n+a])};var U=N(14477)("lo<p0",["p0"]),c=8;function K(l,a,N,U,c,K){for(var Z=2*l,w=Z*(N+1)+a,S=N+1;S<U;++S,w+=Z)for(var T=c[w],J=S,n=Z*(S-1);J>N&&c[n+a]>T;--J,n-=Z){for(var y=n,H=n+Z,u=0;u<Z;++u,++y,++H){var W=c[y];c[y]=c[H],c[H]=W}var B=K[J];K[J]=K[J-1],K[J-1]=B}}},14477:l=>{"use strict";l.exports=function(l,N){var U="abcdef".split("").concat(N),c=[];l.indexOf("lo")>=0&&c.push("lo=e[k+n]");l.indexOf("hi")>=0&&c.push("hi=e[k+o]");return U.push(a.replace("_",c.join()).replace("$",l)),Function.apply(void 0,U)};var a="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14458:l=>{"use strict";l.exports=function(l,U){U<=4*a?N(0,U-1,l):T(0,U-1,l)};var a=32;function N(l,a,N){for(var U=2*(l+1),c=l+1;c<=a;++c){for(var K=N[U++],Z=N[U++],w=c,S=U-2;w-- >l;){var T=N[S-2],J=N[S-1];if(T<K)break;if(T===K&&J<Z)break;N[S]=T,N[S+1]=J,S-=2}N[S]=K,N[S+1]=Z}}function U(l,a,N){a*=2;var U=N[l*=2],c=N[l+1];N[l]=N[a],N[l+1]=N[a+1],N[a]=U,N[a+1]=c}function c(l,a,N){a*=2,N[l*=2]=N[a],N[l+1]=N[a+1]}function K(l,a,N,U){a*=2,N*=2;var c=U[l*=2],K=U[l+1];U[l]=U[a],U[l+1]=U[a+1],U[a]=U[N],U[a+1]=U[N+1],U[N]=c,U[N+1]=K}function Z(l,a,N,U,c){a*=2,c[l*=2]=c[a],c[a]=N,c[l+1]=c[a+1],c[a+1]=U}function w(l,a,N){a*=2;var U=N[l*=2],c=N[a];return!(U<c)&&(U!==c||N[l+1]>N[a+1])}function S(l,a,N,U){var c=U[l*=2];return c<a||c===a&&U[l+1]<N}function T(l,J,n){var y=(J-l+1)/6|0,H=l+y,u=J-y,W=l+J>>1,B=W-y,Y=W+y,C=H,M=B,A=W,E=Y,q=u,b=l+1,z=J-1,I=0;w(C,M,n)&&(I=C,C=M,M=I),w(E,q,n)&&(I=E,E=q,q=I),w(C,A,n)&&(I=C,C=A,A=I),w(M,A,n)&&(I=M,M=A,A=I),w(C,E,n)&&(I=C,C=E,E=I),w(A,E,n)&&(I=A,A=E,E=I),w(M,q,n)&&(I=M,M=q,q=I),w(M,A,n)&&(I=M,M=A,A=I),w(E,q,n)&&(I=E,E=q,q=I);for(var t=n[2*M],O=n[2*M+1],h=n[2*E],i=n[2*E+1],k=2*C,Q=2*A,j=2*q,f=2*H,p=2*W,R=2*u,L=0;L<2;++L){var r=n[k+L],X=n[Q+L],P=n[j+L];n[f+L]=r,n[p+L]=X,n[R+L]=P}c(B,l,n),c(Y,J,n);for(var d=b;d<=z;++d)if(S(d,t,O,n))d!==b&&U(d,b,n),++b;else if(!S(d,h,i,n))for(;;){if(S(z,h,i,n)){S(z,t,O,n)?(K(d,b,z,n),++b,--z):(U(d,z,n),--z);break}if(--z<d)break}Z(l,b-1,t,O,n),Z(J,z+1,h,i,n),b-2-l<=a?N(l,b-2,n):T(l,b-2,n),J-(z+2)<=a?N(z+2,J,n):T(z+2,J,n),z-b<=a?N(b,z,n):T(b,z,n)}},14452:(l,a,N)=>{"use strict";l.exports={init:function(l){var a=c.nextPow2(l);S.length<a&&(U.free(S),S=U.mallocInt32(a));T.length<a&&(U.free(T),T=U.mallocInt32(a));J.length<a&&(U.free(J),J=U.mallocInt32(a));n.length<a&&(U.free(n),n=U.mallocInt32(a));y.length<a&&(U.free(y),y=U.mallocInt32(a));H.length<a&&(U.free(H),H=U.mallocInt32(a));var N=8*a;u.length<N&&(U.free(u),u=U.mallocDouble(N))},sweepBipartite:function(l,a,N,U,c,w,y,H,Y,C){for(var M=0,A=2*l,E=l-1,q=A-1,b=N;b<U;++b){var z=w[b],I=A*b;u[M++]=c[I+E],u[M++]=-(z+1),u[M++]=c[I+q],u[M++]=z}for(b=y;b<H;++b){z=C[b]+Z;var t=A*b;u[M++]=Y[t+E],u[M++]=-z,u[M++]=Y[t+q],u[M++]=z}var O=M>>>1;K(u,O);var h=0,i=0;for(b=0;b<O;++b){var k=0|u[2*b+1];if(k>=Z)W(J,n,i--,k=k-Z|0);else if(k>=0)W(S,T,h--,k);else if(k<=-Z){k=-k-Z|0;for(var Q=0;Q<h;++Q){if(void 0!==(j=a(S[Q],k)))return j}B(J,n,i++,k)}else{k=-k-1|0;for(Q=0;Q<i;++Q){var j;if(void 0!==(j=a(k,J[Q])))return j}B(S,T,h++,k)}}},sweepComplete:function(l,a,N,U,c,Z,w,Y,C,M){for(var A=0,E=2*l,q=l-1,b=E-1,z=N;z<U;++z){var I=Z[z]+1<<1,t=E*z;u[A++]=c[t+q],u[A++]=-I,u[A++]=c[t+b],u[A++]=I}for(z=w;z<Y;++z){I=M[z]+1<<1;var O=E*z;u[A++]=C[O+q],u[A++]=1|-I,u[A++]=C[O+b],u[A++]=1|I}var h=A>>>1;K(u,h);var i=0,k=0,Q=0;for(z=0;z<h;++z){var j=0|u[2*z+1],f=1&j;if(z<h-1&&j>>1===u[2*z+3]>>1&&(f=2,z+=1),j<0){for(var p=-(j>>1)-1,R=0;R<Q;++R){if(void 0!==(L=a(y[R],p)))return L}if(0!==f)for(R=0;R<i;++R){if(void 0!==(L=a(S[R],p)))return L}if(1!==f)for(R=0;R<k;++R){var L;if(void 0!==(L=a(J[R],p)))return L}0===f?B(S,T,i++,p):1===f?B(J,n,k++,p):2===f&&B(y,H,Q++,p)}else{p=(j>>1)-1;0===f?W(S,T,i--,p):1===f?W(J,n,k--,p):2===f&&W(y,H,Q--,p)}}},scanBipartite:function(l,a,N,U,c,w,J,n,y,H,Y,C){var M=0,A=2*l,E=a,q=a+l,b=1,z=1;U?z=Z:b=Z;for(var I=c;I<w;++I){var t=I+b,O=A*I;u[M++]=J[O+E],u[M++]=-t,u[M++]=J[O+q],u[M++]=t}for(I=y;I<H;++I){t=I+z;var h=A*I;u[M++]=Y[h+E],u[M++]=-t}var i=M>>>1;K(u,i);var k=0;for(I=0;I<i;++I){var Q=0|u[2*I+1];if(Q<0){var j=!1;if((t=-Q)>=Z?(j=!U,t-=Z):(j=!!U,t-=1),j)B(S,T,k++,t);else{var f=C[t],p=A*t,R=Y[p+a+1],L=Y[p+a+1+l];l:for(var r=0;r<k;++r){var X=S[r],P=A*X;if(!(L<J[P+a+1]||J[P+a+1+l]<R)){for(var d=a+2;d<l;++d)if(Y[p+d+l]<J[P+d]||J[P+d+l]<Y[p+d])continue l;var F,e=n[X];if(void 0!==(F=U?N(f,e):N(e,f)))return F}}}}else W(S,T,k--,Q-b)}},scanComplete:function(l,a,N,U,c,w,T,J,n,y,H){for(var W=0,B=2*l,Y=a,C=a+l,M=U;M<c;++M){var A=M+Z,E=B*M;u[W++]=w[E+Y],u[W++]=-A,u[W++]=w[E+C],u[W++]=A}for(M=J;M<n;++M){A=M+1;var q=B*M;u[W++]=y[q+Y],u[W++]=-A}var b=W>>>1;K(u,b);var z=0;for(M=0;M<b;++M){var I=0|u[2*M+1];if(I<0){if((A=-I)>=Z)S[z++]=A-Z;else{var t=H[A-=1],O=B*A,h=y[O+a+1],i=y[O+a+1+l];l:for(var k=0;k<z;++k){var Q=S[k],j=T[Q];if(j===t)break;var f=B*Q;if(!(i<w[f+a+1]||w[f+a+1+l]<h)){for(var p=a+2;p<l;++p)if(y[O+p+l]<w[f+p]||w[f+p+l]<y[O+p])continue l;var R=N(j,t);if(void 0!==R)return R}}}}else{for(A=I-Z,k=z-1;k>=0;--k)if(S[k]===A){for(p=k+1;p<z;++p)S[p-1]=S[p];break}--z}}}};var U=N(14425),c=N(14429),K=N(14458),Z=1<<28,w=1024,S=U.mallocInt32(w),T=U.mallocInt32(w),J=U.mallocInt32(w),n=U.mallocInt32(w),y=U.mallocInt32(w),H=U.mallocInt32(w),u=U.mallocDouble(8192);function W(l,a,N,U){var c=a[U],K=l[N-1];l[c]=K,a[K]=c}function B(l,a,N,U){l[N]=U,a[U]=N}},14437:l=>{"use strict";function a(l,N,U){var c=0|l[U];if(c<=0)return[];var K,Z=new Array(c);if(U===l.length-1)for(K=0;K<c;++K)Z[K]=N;else for(K=0;K<c;++K)Z[K]=a(l,N,U+1);return Z}l.exports=function(l,N){switch("undefined"===typeof N&&(N=0),typeof l){case"number":if(l>0)return function(l,a){var N,U;for(N=new Array(l),U=0;U<l;++U)N[U]=a;return N}(0|l,N);break;case"object":if("number"===typeof l.length)return a(l,N,0)}return[]}},14401:(l,a,N)=>{l.exports=function(){var l=this;this.components={},this.comps=this.components;var a=this.components,N=1,c={},K=[],Z=[],w={timeout:!1,removals:[],multiComps:[]};function S(l,N){var U=a[N],K=c[N],Z=K.hash[l];Z&&(K.remove(l),U.mc&&(U.multi?(Z.forEach((a=>{a&&U.mc(l,a)})),Z.length=0):U.mc(l,Z)),w.removals.push(K),T())}function T(){w.timeout||(w.timeout=!0,setTimeout(J,1))}function J(){w.timeout=!1,n()}function n(){w.multiComps.length&&function(l){for(var a=0;a<l.length;a++){var{entID:N,data:U}=l[a],c=U.hash[N];if(c){for(var K=0;K<c.length;K++)c[K]||(c.splice(K,1),K--);0===c.length&&(U.remove(N),w.removals.push(U))}}l.length=0}(w.multiComps),w.removals.length&&function(l){for(var a=0;a<l.length;a++){l[a].flush()}l.length=0}(w.removals)}this.Mn=c,this._systems=K,this._renderSystems=Z,this.SJ=function(a){var U=N++;return Array.isArray(a)&&a.forEach((a=>l.oS(U,a))),U},this.deleteEntity=function(a){return Object.keys(c).forEach((l=>{c[l].hash[a]&&S(a,l)})),l},this.bJ=function(l){if(!l)throw new Error("Missing component definition");var N=l.name;if(!N)throw new Error("Component definition must have a name property.");if("string"!==typeof N)throw new Error("Component name must be a string.");if(""===N)throw new Error("Component name must be a non-empty string.");if(c[N])throw new Error(`Component ${N} already exists.`);var w={};return w.name=N,w.multi=!!l.multi,w.order=isNaN(l.order)?99:l.order,w.stateConstructor=l.stateConstructor||null,w.state=l.state||{},w.Fw=l.Fw||null,w.mc=l.mc||null,w.system=l.system||null,w.xw=l.xw||null,a[N]=w,c[N]=new U,c[N]._pendingMultiCleanup=!1,c[N]._multiCleanupIDs=w.multi?[]:null,w.system&&(K.push(N),K.sort(((l,N)=>a[l].order-a[N].order))),w.xw&&(Z.push(N),Z.sort(((l,N)=>a[l].order-a[N].order))),N},this.overwriteComponent=function(l,N){var U=a[l];if(!U)throw new Error(`Unknown component: ${l}`);if(!N)throw new Error("Missing component definition");if(U.name!==N.name)throw new Error("Overwriting component must use the same name property.");var w={};w.name=l,w.multi=!!N.multi,w.order=isNaN(N.order)?99:N.order,w.state=N.state||{},w.Fw=N.Fw||null,w.mc=N.mc||null,w.system=N.system||null,w.xw=N.xw||null,a[l]=w,c[l]._pendingMultiCleanup=!1,c[l]._multiCleanupIDs=w.multi?[]:null;var S=K.indexOf(l);w.system&&S<0&&K.push(l),!w.system&&S>=0&&K.splice(S,1),K.sort(((l,N)=>a[l].order-a[N].order));var T=Z.indexOf(l);w.xw&&T<0&&Z.push(l),!w.xw&&T>=0&&Z.splice(T,1),Z.sort(((l,N)=>a[l].order-a[N].order));var J=w.state;return this.eT(l).forEach((l=>{for(var a in J)a in l||(l[a]=J[a]);w.Fw&&w.Fw(l.Gw,l)})),l},this.deleteComponent=function(N){var U=c[N];if(!U)throw new Error(`Unknown component: ${N}`);U.flush(),U.list.forEach((l=>{l&&S(l.Gw||l[0].Gw,N)}));var w=K.indexOf(N),T=Z.indexOf(N);return w>-1&&K.splice(w,1),T>-1&&Z.splice(T,1),c[N].dispose(),delete c[N],delete a[N],l},this.oS=function(l,N,U){var K,Z=a[N],w=c[N];if(!w)throw new Error(`Unknown component: ${N}.`);if(w.hash[l]&&!Z.multi)throw new Error(`Entity ${l} already has component: ${N}.`);if(Z.stateConstructor){if(!(K=new Z.stateConstructor).hasOwnProperty("Gw"))throw new Error(`Component ${Z.name} stateConstructor type does not have property __id`)}else K=Object.assign({},{Gw:l},Z.state,U);if(K.Gw=l,Z.multi){var S=w.hash[l];S||(S=[],w.add(l,S)),S.push(K)}else w.add(l,K);return Z.Fw&&Z.Fw(l,K),this},this.NT=function(l,a){var N=c[a];if(!N)throw new Error(`Unknown component: ${a}.`);return!!N.hash[l]},this.VS=function(a,N){if(!c[N])throw new Error(`Unknown component: ${N}.`);return S(a,N),l},this.getState=function(l,a){var N=c[a];if(!N)throw new Error(`Unknown component: ${a}.`);return N.hash[l]},this.eT=function(l){var a=c[l];if(!a)throw new Error(`Unknown component: ${l}.`);return n(),a.list},this.YH=function(l){if(!c[l])throw new Error(`Unknown component: ${l}.`);var a=c[l].hash;return l=>a[l]},this.AH=function(l){if(!c[l])throw new Error(`Unknown component: ${l}.`);var a=c[l].hash;return l=>!!a[l]},this.Lw=function(N){n();for(var U=0;U<K.length;U++){var Z=K[U],w=a[Z],S=c[Z];w.system(N,S.list),n()}return l},this.render=function(N){n();for(var U=0;U<Z.length;U++){var K=Z[U],w=a[K],S=c[K];w.xw(N,S.list),n()}return l},this.removeMultiComponent=function(N,U,K){var Z=a[U],S=c[U];if(!S)throw new Error(`Unknown component: ${U}.`);if(!Z.multi)throw new Error("removeMultiComponent called on non-multi component");return function(l,a,N,U){var c=N.hash[l];if(c){var K=c[U];K&&(c[U]=null,a.mc&&a.mc(l,K),w.multiComps.push({entID:l,data:N}),T())}}(N,Z,S,K),l}};var U=N(14403)},14403:l=>{function a(l,a){var N=l._map[a];if(delete l.hash[a],delete l._map[a],N===l.list.length-1)l.list.pop();else{var U=l.list.pop();if(l.list[N]=U,null===U||null===U[0]){var c=l.list.length;for(var K in l._map)if(l._map[K]===c)return void(l._map[K]=N)}else{var Z=U.Gw||U[0].Gw;l._map[Z]=N}}}l.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(l,a){if("number"===typeof this._map[l]){var N=this._map[l];this.hash[l]=a,this.list[N]=a}else this._map[l]=this.list.length,this.hash[l]=a,this.list.push(a)}remove(l){var a=this._map[l];this.hash[l]=null,this.list[a]=null,this._pendingRemovals.push(l)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var l=0;l<this._pendingRemovals.length;l++){var N=this._pendingRemovals[l];null===this.hash[N]&&a(this,N)}this._pendingRemovals.length=0}}},14360:l=>{"use strict";var a,N="object"===typeof Reflect?Reflect:null,U=function(l,a,N){return Function.prototype.apply.call(l,a,N)};a=N&&"function"===typeof N.ownKeys?N.ownKeys:Object.getOwnPropertySymbols?function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:function(l){return Object.getOwnPropertyNames(l)};var c=Number.isNaN||function(l){return l!==l};function K(){K.init.call(this)}l.exports=K,l.exports.once=function(l,a){return new Promise((function(N,U){function c(N){l.removeListener(a,K),U(N)}function K(){"function"===typeof l.removeListener&&l.removeListener("error",c),N([].slice.call(arguments))}W(l,a,K,{once:!0}),"error"!==a&&function(l,a,N){"function"===typeof l.on&&W(l,"error",a,N)}(l,c,{once:!0})}))},K.EventEmitter=K,K.prototype._events=void 0,K.prototype._eventsCount=0,K.prototype._maxListeners=void 0;var Z=10;function w(l){if("function"!==typeof l)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof l)}function S(l){return void 0===l._maxListeners?K.defaultMaxListeners:l._maxListeners}function T(l,a,N,U){var c,K,Z,T;if(w(N),void 0===(K=l._events)?(K=l._events=Object.create(null),l._eventsCount=0):(void 0!==K.newListener&&(l.emit("newListener",a,N.listener?N.listener:N),K=l._events),Z=K[a]),void 0===Z)Z=K[a]=N,++l._eventsCount;else if("function"===typeof Z?Z=K[a]=U?[N,Z]:[Z,N]:U?Z.unshift(N):Z.push(N),(c=S(l))>0&&Z.length>c&&!Z.warned){Z.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+Z.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");J.name="MaxListenersExceededWarning",J.Ua=l,J.type=a,J.count=Z.length,T=J,console&&console.warn&&console.warn(T)}return l}function J(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function n(l,a,N){var U={fired:!1,wrapFn:void 0,target:l,type:a,listener:N},c=J.bind(U);return c.listener=N,U.wrapFn=c,c}function y(l,a,N){var U=l._events;if(void 0===U)return[];var c=U[a];return void 0===c?[]:"function"===typeof c?N?[c.listener||c]:[c]:N?function(l){for(var a=new Array(l.length),N=0;N<a.length;++N)a[N]=l[N].listener||l[N];return a}(c):u(c,c.length)}function H(l){var a=this._events;if(void 0!==a){var N=a[l];if("function"===typeof N)return 1;if(void 0!==N)return N.length}return 0}function u(l,a){for(var N=new Array(a),U=0;U<a;++U)N[U]=l[U];return N}function W(l,a,N,U){if("function"===typeof l.on)U.once?l.once(a,N):l.on(a,N);else{if("function"!==typeof l.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof l);l.addEventListener(a,(function c(K){U.once&&l.removeEventListener(a,c),N(K)}))}}Object.defineProperty(K,"defaultMaxListeners",{enumerable:!0,get:function(){return Z},set:function(l){if("number"!==typeof l||l<0||c(l))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+l+".");Z=l}}),K.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},K.prototype.setMaxListeners=function(l){if("number"!==typeof l||l<0||c(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this},K.prototype.getMaxListeners=function(){return S(this)},K.prototype.emit=function(l){for(var a=[],N=1;N<arguments.length;N++)a.push(arguments[N]);var c="error"===l,K=this._events;if(void 0!==K)c=c&&void 0===K.error;else if(!c)return!1;if(c){var Z;if(a.length>0&&(Z=a[0]),Z instanceof Error)throw Z;var w=new Error("Unhandled error."+(Z?" ("+Z.message+")":""));throw w.context=Z,w}var S=K[l];if(void 0===S)return!1;if("function"===typeof S)U(S,this,a);else{var T=S.length,J=u(S,T);for(N=0;N<T;++N)U(J[N],this,a)}return!0},K.prototype.addListener=function(l,a){return T(this,l,a,!1)},K.prototype.on=K.prototype.addListener,K.prototype.prependListener=function(l,a){return T(this,l,a,!0)},K.prototype.once=function(l,a){return w(a),this.on(l,n(this,l,a)),this},K.prototype.prependOnceListener=function(l,a){return w(a),this.prependListener(l,n(this,l,a)),this},K.prototype.removeListener=function(l,a){var N,U,c,K,Z;if(w(a),void 0===(U=this._events))return this;if(void 0===(N=U[l]))return this;if(N===a||N.listener===a)0===--this._eventsCount?this._events=Object.create(null):(delete U[l],U.removeListener&&this.emit("removeListener",l,N.listener||a));else if("function"!==typeof N){for(c=-1,K=N.length-1;K>=0;K--)if(N[K]===a||N[K].listener===a){Z=N[K].listener,c=K;break}if(c<0)return this;0===c?N.shift():function(l,a){for(;a+1<l.length;a++)l[a]=l[a+1];l.pop()}(N,c),1===N.length&&(U[l]=N[0]),void 0!==U.removeListener&&this.emit("removeListener",l,Z||a)}return this},K.prototype.off=K.prototype.removeListener,K.prototype.ca=function(l){var a,N,U;if(void 0===(N=this._events))return this;if(void 0===N.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==N[l]&&(0===--this._eventsCount?this._events=Object.create(null):delete N[l]),this;if(0===arguments.length){var c,K=Object.keys(N);for(U=0;U<K.length;++U)"removeListener"!==(c=K[U])&&this.ca(c);return this.ca("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(a=N[l]))this.removeListener(l,a);else if(void 0!==a)for(U=a.length-1;U>=0;U--)this.removeListener(l,a[U]);return this},K.prototype.listeners=function(l){return y(this,l,!0)},K.prototype.rawListeners=function(l){return y(this,l,!1)},K.listenerCount=function(l,a){return"function"===typeof l.listenerCount?l.listenerCount(a):H.call(l,a)},K.prototype.listenerCount=H,K.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]}},14640:l=>{"use strict";l.exports=function(l,a,N,U,c,K){var Z=+a[0],w=+a[1],S=+a[2],T=+N[0],J=+N[1],n=+N[2],y=Math.sqrt(T*T+J*J+n*n);if(0===y)throw new Error("Can't raycast along a zero vector");return function(l,a,N,U,c,K,Z,w,S,T){for(var J=0,n=Math.floor,y=0|n(a),H=0|n(N),u=0|n(U),W=c>0?1:-1,B=K>0?1:-1,Y=Z>0?1:-1,C=Math.abs(1/c),M=Math.abs(1/K),A=Math.abs(1/Z),E=C<1/0?C*(W>0?y+1-a:a-y):1/0,q=M<1/0?M*(B>0?H+1-N:N-H):1/0,b=A<1/0?A*(Y>0?u+1-U:U-u):1/0,z=-1;J<=w;){var I=l(y,H,u);if(I)return S&&(S[0]=a+J*c,S[1]=N+J*K,S[2]=U+J*Z),T&&(T[0]=T[1]=T[2]=0,0===z&&(T[0]=-W),1===z&&(T[1]=-B),2===z&&(T[2]=-Y)),I;E<q?E<b?(y+=W,J=E,E+=C,z=0):(u+=Y,J=b,b+=A,z=2):q<b?(H+=B,J=q,q+=M,z=1):(u+=Y,J=b,b+=A,z=2)}return S&&(S[0]=a+J*c,S[1]=N+J*K,S[2]=U+J*Z),T&&(T[0]=T[1]=T[2]=0),0}(l,Z,w,S,T/=y,J/=y,n/=y,U="undefined"===typeof U?64:+U,c,K)}},14668:(l,a,N)=>{"use strict";N.d(a,{b:()=>K});var U=N(14360);function c(){this.Hy=!1,this.stopPropagation=!1,this.uy=!1,this.disabled=!1}class K{constructor(l,a){this.version="0.7.0";var N=Object.assign({},new c,a||{});this.element=l||document,this.Hy=!!N.Hy,this.stopPropagation=!!N.stopPropagation,this.uy=!!N.uy,this.disabled=!!N.disabled,this.filterEvents=(l,a)=>!0,this.down=new U.EventEmitter,this.up=new U.EventEmitter,this.state={},this.LT={dx:0,dy:0,SH:0,RT:0,TH:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?w(this):document.addEventListener("DOMContentLoaded",(l=>{w(this)}),{once:!0})}bind(l){for(var a=arguments.length,N=new Array(a>1?a-1:0),U=1;U<a;U++)N[U-1]=arguments[U];N.forEach((a=>{var N=this._keyBindmap[a]||[];N.includes(l)||(N.push(l),this._keyBindmap[a]=N)})),this.state[l]=!!this.state[l],this.pressCount[l]=this.pressCount[l]||0,this.releaseCount[l]=this.releaseCount[l]||0}unbind(l){for(var a in this._keyBindmap){var N=this._keyBindmap[a],U=N.indexOf(l);U>-1&&N.splice(U,1)}}getBindings(){var l={};for(var a in this._keyBindmap){this._keyBindmap[a].forEach((N=>{l[N]=l[N]||[],l[N].push(a)}))}return l}Lw(){Z(this.LT),Z(this.pressCount),Z(this.releaseCount)}}function Z(l){for(var a in l)l[a]=0}function w(l){window.addEventListener("keydown",u.bind(null,l,!0),!1),window.addEventListener("keyup",u.bind(null,l,!1),!1);var a={passive:!0};l.element.addEventListener("touchstart",n.bind(void 0,l),{passive:!1}),l.element.addEventListener("touchend",H.bind(void 0,l),a),l.element.addEventListener("mousedown",W.bind(null,l,!0),a),window.document.addEventListener("mouseup",W.bind(null,l,!1),a),l.element.addEventListener("touchmove",B.bind(null,l),a),l.element.addEventListener("mousemove",B.bind(null,l),a),window.PointerEvent,l.element.addEventListener("wheel",Y.bind(null,l),a),l.element.addEventListener("contextmenu",C.bind(null,l),!1),window.addEventListener("blur",M.bind(null,l),!1)}var S=0,T=0,J=null;function n(l,a){a.preventDefault(),y(a)}function y(l){let a=!1;for(let N=0;N<l.touches.length;++N)if(l.touches[N].identifier===J){a=!0;break}if(!a){const a=l.changedTouches[0];S=a.clientX,T=a.clientY,J=a.identifier}}function H(l,a){for(var N=a.changedTouches,U=0;U<N.length;++U)N[U].identifier===J&&(J=null)}function u(l,a,N){A(N.code,a,l,N)}function W(l,a,N){if("pointerId"in N)if(a){if(null!==l._touches.currID)return;l._touches.currID=N.pointerId}else{if(l._touches.currID!==N.pointerId)return;l._touches.currID=null}return A("Mouse"+("button"in N?N.button+1:1),a,l,N),!1}function B(l,a){var N=a.movementX||a.mozMovementX||0,U=a.movementY||a.mozMovementY||0;if(a.touches&&0===(N|U)){var c=function(l){y(l);for(let a=0;a<l.changedTouches.length;++a)if(l.changedTouches[a].identifier==J){const N=l.changedTouches[a],U=[N.clientX-S,N.clientY-T];return S=N.clientX,T=N.clientY,U}return console.error(`Did not find touch id ${J}`),[0,0]}(a);N=c[0],U=c[1]}l.LT.dx+=N,l.LT.dy+=U}function Y(l,a){var N=1;switch(a.deltaMode){case 0:N=1;break;case 1:N=12;break;case 2:N=l.element.clientHeight||window.innerHeight}l.LT.SH+=(a.deltaX||0)*N,l.LT.RT+=(a.deltaY||0)*N,l.LT.TH+=(a.deltaZ||0)*N}function C(l,a){if(!l.uy)return a.preventDefault(),!1}function M(l){for(var a in l._keyStates)l._keyStates[a]&&(/^Mouse\d/.test(a)||A(a,!1,l,{code:a,note:"ce47gq240kt",preventDefault:()=>{},stopPropagation:()=>{}}))}function A(l,a,N,U){var c=N._keyBindmap[l];c&&(E(N._keyStates[l],a)&&(N._keyStates[l]=a,c.forEach((l=>{(!N.filterEvents||N.filterEvents(U,l))&&function(l,a,N,U){var c=a?N.pressCount:N.releaseCount;c[l]=(c[l]||0)+1;var K=N._bindPressCount[l]||0;(K+=a?1:-1)<0&&(K=0);N._bindPressCount[l]=K;var Z=N.state[l];if(E(Z,K)){N.state[l]=K>0;var w=a?N.down:N.up;N.disabled||w.emit(l,U)}}(l,a,N,U)}))),"button"in U||(N.Hy&&!U.defaultPrevented&&U.preventDefault(),N.stopPropagation&&U.stopPropagation()))}function E(l,a){return l?!a:a}},13283:l=>{l.exports=function(l,a,N){return l[0]=a[0]+N[0],l[1]=a[1]+N[1],l[2]=a[2]+N[2],l}},13242:(l,a,N)=>{l.exports=function(l,a){var N=U(l[0],l[1],l[2]),Z=U(a[0],a[1],a[2]);c(N,N),c(Z,Z);var w=K(N,Z);return w>1?0:Math.acos(w)};var U=N(13249),c=N(13252),K=N(13254)},13338:l=>{l.exports=function(l,a){return l[0]=Math.ceil(a[0]),l[1]=Math.ceil(a[1]),l[2]=Math.ceil(a[2]),l}},13235:l=>{l.exports=function(l){var a=new Float32Array(3);return a[0]=l[0],a[1]=l[1],a[2]=l[2],a}},13261:l=>{l.exports=function(l,a){return l[0]=a[0],l[1]=a[1],l[2]=a[2],l}},13231:l=>{l.exports=function(){var l=new Float32Array(3);return l[0]=0,l[1]=0,l[2]=0,l}},13420:l=>{l.exports=function(l,a,N){var U=a[0],c=a[1],K=a[2],Z=N[0],w=N[1],S=N[2];return l[0]=c*S-K*w,l[1]=K*Z-U*S,l[2]=U*w-c*Z,l}},13364:(l,a,N)=>{l.exports=N(13357)},13357:l=>{l.exports=function(l,a){var N=a[0]-l[0],U=a[1]-l[1],c=a[2]-l[2];return Math.sqrt(N*N+U*U+c*c)}},13318:(l,a,N)=>{l.exports=N(13315)},13315:l=>{l.exports=function(l,a,N){return l[0]=a[0]/N[0],l[1]=a[1]/N[1],l[2]=a[2]/N[2],l}},13254:l=>{l.exports=function(l,a){return l[0]*a[0]+l[1]*a[1]+l[2]*a[2]}},13228:l=>{l.exports=1e-6},13272:(l,a,N)=>{l.exports=function(l,a){var N=l[0],c=l[1],K=l[2],Z=a[0],w=a[1],S=a[2];return Math.abs(N-Z)<=U*Math.max(1,Math.abs(N),Math.abs(Z))&&Math.abs(c-w)<=U*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(K-S)<=U*Math.max(1,Math.abs(K),Math.abs(S))};var U=N(13228)},13276:l=>{l.exports=function(l,a){return l[0]===a[0]&&l[1]===a[1]&&l[2]===a[2]}},13336:l=>{l.exports=function(l,a){return l[0]=Math.floor(a[0]),l[1]=Math.floor(a[1]),l[2]=Math.floor(a[2]),l}},13474:(l,a,N)=>{l.exports=function(l,a,N,c,K,Z){var w,S;a||(a=3);N||(N=0);S=c?Math.min(c*a+N,l.length):l.length;for(w=N;w<S;w+=a)U[0]=l[w],U[1]=l[w+1],U[2]=l[w+2],K(U,U,Z),l[w]=U[0],l[w+1]=U[1],l[w+2]=U[2];return l};var U=N(13231)()},13249:l=>{l.exports=function(l,a,N){var U=new Float32Array(3);return U[0]=l,U[1]=a,U[2]=N,U}},13220:(l,a,N)=>{l.exports={EPSILON:N(13228),create:N(13231),clone:N(13235),angle:N(13242),Ow:N(13249),j:N(13261),set:N(13269),equals:N(13272),exactEquals:N(13276),add:N(13283),Wa:N(13290),sub:N(13295),multiply:N(13303),mul:N(13311),divide:N(13315),div:N(13318),min:N(13323),max:N(13328),floor:N(13336),ceil:N(13338),round:N(13347),scale:N(13349),hw:N(13352),distance:N(13357),i:N(13364),squaredDistance:N(13373),sqrDist:N(13379),length:N(13385),len:N(13388),squaredLength:N(13396),iw:N(13399),negate:N(13406),inverse:N(13412),normalize:N(13252),dot:N(13254),cross:N(13420),zw:N(13428),random:N(13435),transformMat4:N(13441),transformMat3:N(13443),transformQuat:N(13452),kw:N(13460),Qw:N(13464),jw:N(13470),forEach:N(13474)}},13412:l=>{l.exports=function(l,a){return l[0]=1/a[0],l[1]=1/a[1],l[2]=1/a[2],l}},13388:(l,a,N)=>{l.exports=N(13385)},13385:l=>{l.exports=function(l){var a=l[0],N=l[1],U=l[2];return Math.sqrt(a*a+N*N+U*U)}},13428:l=>{l.exports=function(l,a,N,U){var c=a[0],K=a[1],Z=a[2];return l[0]=c+U*(N[0]-c),l[1]=K+U*(N[1]-K),l[2]=Z+U*(N[2]-Z),l}},13328:l=>{l.exports=function(l,a,N){return l[0]=Math.max(a[0],N[0]),l[1]=Math.max(a[1],N[1]),l[2]=Math.max(a[2],N[2]),l}},13323:l=>{l.exports=function(l,a,N){return l[0]=Math.min(a[0],N[0]),l[1]=Math.min(a[1],N[1]),l[2]=Math.min(a[2],N[2]),l}},13311:(l,a,N)=>{l.exports=N(13303)},13303:l=>{l.exports=function(l,a,N){return l[0]=a[0]*N[0],l[1]=a[1]*N[1],l[2]=a[2]*N[2],l}},13406:l=>{l.exports=function(l,a){return l[0]=-a[0],l[1]=-a[1],l[2]=-a[2],l}},13252:l=>{l.exports=function(l,a){var N=a[0],U=a[1],c=a[2],K=N*N+U*U+c*c;K>0&&(K=1/Math.sqrt(K),l[0]=a[0]*K,l[1]=a[1]*K,l[2]=a[2]*K);return l}},13435:l=>{l.exports=function(l,a){a=a||1;var N=2*Math.random()*Math.PI,U=2*Math.random()-1,c=Math.sqrt(1-U*U)*a;return l[0]=Math.cos(N)*c,l[1]=Math.sin(N)*c,l[2]=U*a,l}},13460:l=>{l.exports=function(l,a,N,U){var c=N[1],K=N[2],Z=a[1]-c,w=a[2]-K,S=Math.sin(U),T=Math.cos(U);return l[0]=a[0],l[1]=c+Z*T-w*S,l[2]=K+Z*S+w*T,l}},13464:l=>{l.exports=function(l,a,N,U){var c=N[0],K=N[2],Z=a[0]-c,w=a[2]-K,S=Math.sin(U),T=Math.cos(U);return l[0]=c+w*S+Z*T,l[1]=a[1],l[2]=K+w*T-Z*S,l}},13470:l=>{l.exports=function(l,a,N,U){var c=N[0],K=N[1],Z=a[0]-c,w=a[1]-K,S=Math.sin(U),T=Math.cos(U);return l[0]=c+Z*T-w*S,l[1]=K+Z*S+w*T,l[2]=a[2],l}},13347:l=>{l.exports=function(l,a){return l[0]=Math.round(a[0]),l[1]=Math.round(a[1]),l[2]=Math.round(a[2]),l}},13349:l=>{l.exports=function(l,a,N){return l[0]=a[0]*N,l[1]=a[1]*N,l[2]=a[2]*N,l}},13352:l=>{l.exports=function(l,a,N,U){return l[0]=a[0]+N[0]*U,l[1]=a[1]+N[1]*U,l[2]=a[2]+N[2]*U,l}},13269:l=>{l.exports=function(l,a,N,U){return l[0]=a,l[1]=N,l[2]=U,l}},13379:(l,a,N)=>{l.exports=N(13373)},13399:(l,a,N)=>{l.exports=N(13396)},13373:l=>{l.exports=function(l,a){var N=a[0]-l[0],U=a[1]-l[1],c=a[2]-l[2];return N*N+U*U+c*c}},13396:l=>{l.exports=function(l){var a=l[0],N=l[1],U=l[2];return a*a+N*N+U*U}},13295:(l,a,N)=>{l.exports=N(13290)},13290:l=>{l.exports=function(l,a,N){return l[0]=a[0]-N[0],l[1]=a[1]-N[1],l[2]=a[2]-N[2],l}},13443:l=>{l.exports=function(l,a,N){var U=a[0],c=a[1],K=a[2];return l[0]=U*N[0]+c*N[3]+K*N[6],l[1]=U*N[1]+c*N[4]+K*N[7],l[2]=U*N[2]+c*N[5]+K*N[8],l}},13441:l=>{l.exports=function(l,a,N){var U=a[0],c=a[1],K=a[2],Z=N[3]*U+N[7]*c+N[11]*K+N[15];return Z=Z||1,l[0]=(N[0]*U+N[4]*c+N[8]*K+N[12])/Z,l[1]=(N[1]*U+N[5]*c+N[9]*K+N[13])/Z,l[2]=(N[2]*U+N[6]*c+N[10]*K+N[14])/Z,l}},13452:l=>{l.exports=function(l,a,N){var U=a[0],c=a[1],K=a[2],Z=N[0],w=N[1],S=N[2],T=N[3],J=T*U+w*K-S*c,n=T*c+S*U-Z*K,y=T*K+Z*c-w*U,H=-Z*U-w*c-S*K;return l[0]=J*T+H*-Z+n*-S-y*-w,l[1]=n*T+H*-w+y*-Z-J*-S,l[2]=y*T+H*-S+J*-w-n*-Z,l}},14386:l=>{"use strict";l.exports=function(l){for(var a=new Array(l),N=0;N<l;++N)a[N]=N;return a}},14446:l=>{l.exports=function(l){return null!=l&&null!=l.constructor&&"function"===typeof l.constructor.isBuffer&&l.constructor.isBuffer(l)}},14644:(l,a,N)=>{"use strict";N.d(a,{b:()=>U});class U{constructor(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.sJ=!1,this.oJ=!1,this.FJ=30,this.eJ=0,this.ln=!1,this.fullscreen=!1,this.mn=function(l){},this.xJ=function(){},this.vJ=function(){},this.ac=function(){},this.VJ=function(l){},this.onFullscreenChanged=function(l){},T((()=>{!function(l,a){l._nowObject=performance||Date,l._lastTick=0,l._renderAccum=0,l._rt=0,l._frameCB=w.bind(null,l),requestAnimationFrame(l._frameCB),a>0&&(l._intervalCB=Z.bind(null,l),l._interval=setInterval(l._intervalCB,Math.max(a,1e3/l.FJ/2)))}(this,a),function(l,a){if(!a)return;var N=!1,U=!1;document.addEventListener("pointerlockchange",(U=>{N=document.pointerLockElement===a,l.VJ(N)})),document.addEventListener("fullscreenchange",(N=>{U=document.fullscreenElement===a,l.onFullscreenChanged(U)})),Object.defineProperty(l,"ln",{get:()=>N,set:l=>{l&&!N?S(a):N&&!l&&function(l){l.exitPointerLock&&l.exitPointerLock()}(document)}}),Object.defineProperty(l,"fullscreen",{get:()=>U,set:l=>{l&&!U?a.requestFullscreen():U&&!l&&document.exitFullscreen()}}),a.addEventListener("click",(c=>{l.sJ&&!N&&S(a),l.oJ&&!U&&a.requestFullscreen()}));var c=()=>l.ac();if(window.ResizeObserver){new ResizeObserver(c).observe(a)}else window.addEventListener("resize",c)}(this,l),this.vJ()}))}}var c=3,K=20;function Z(l){for(var a=1e3/l.FJ,N=l._nowObject.now()+K,U=0;l._nowObject.now()>=l._lastTick+a&&l._nowObject.now()<N&&++U<=c;)l.mn(a),l._lastTick+=a;var Z=5*(a+5),w=l._nowObject.now();if(w-l._lastTick>Z)for(;w>=l._lastTick+a;)l._lastTick+=a}function w(l){requestAnimationFrame(l._frameCB),Z(l);var a=l._nowObject.now(),N=a-l._rt;if(l._rt=a,l.eJ>0){l._renderAccum+=N;var U=1e3/l.eJ;if(l._renderAccum<U)return;l._renderAccum=Math.min(l._renderAccum-U,U)}var c=1e3/l.FJ,K=(a-l._lastTick)/c;l.xJ(N,K,c)}function S(l){l.requestPointerLock&&l.requestPointerLock()}var T=l=>{if("loading"===document.readyState){var a=()=>{document.removeEventListener("readystatechange",a),l()};document.addEventListener("readystatechange",a)}else setTimeout(l,1)}},14383:(l,a,N)=>{var U=N(14386),c=N(14394),K="undefined"!==typeof Float64Array;function Z(l,a){return l[0]-a[0]}function w(){var l,a=this.stride,N=new Array(a.length);for(l=0;l<N.length;++l)N[l]=[Math.abs(a[l]),l];N.sort(Z);var U=new Array(N.length);for(l=0;l<U.length;++l)U[l]=N[l][1];return U}function S(l,a){var N=["View",a,"d",l].join("");a<0&&(N="View_Nil"+l);var c="generic"===l;if(-1===a){var K="function "+N+"(a){this.data=a;};var proto="+N+".prototype;proto.dtype='"+l+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+N+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+N+"(a){return new "+N+"(a);}";return new Function(K)()}if(0===a){K="function "+N+"(a,d) {this.data = a;this.offset = d};var proto="+N+".prototype;proto.dtype='"+l+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+N+"_copy() {return new "+N+"(this.data,this.offset)};proto.pick=function "+N+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+N+"_get(){return "+(c?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+N+"_set(v){return "+(c?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+N+"(a,b,c,d){return new "+N+"(a,d)}";return new Function("TrivialArray",K)(T[l][0])}K=["'use strict'"];var Z=U(a),S=Z.map((function(l){return"i"+l})),J="this.offset+"+Z.map((function(l){return"this.stride["+l+"]*i"+l})).join("+"),n=Z.map((function(l){return"b"+l})).join(","),y=Z.map((function(l){return"c"+l})).join(",");K.push("function "+N+"(a,"+n+","+y+",d){this.data=a","this.shape=["+n+"]","this.stride=["+y+"]","this.offset=d|0}","var proto="+N+".prototype","proto.dtype='"+l+"'","proto.dimension="+a),K.push("Object.defineProperty(proto,'size',{get:function "+N+"_size(){return "+Z.map((function(l){return"this.shape["+l+"]"})).join("*"),"}})"),1===a?K.push("proto.order=[0]"):(K.push("Object.defineProperty(proto,'order',{get:"),a<4?(K.push("function "+N+"_order(){"),2===a?K.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===a&&K.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):K.push("ORDER})")),K.push("proto.set=function "+N+"_set("+S.join(",")+",v){"),c?K.push("return this.data.set("+J+",v)}"):K.push("return this.data["+J+"]=v}"),K.push("proto.get=function "+N+"_get("+S.join(",")+"){"),c?K.push("return this.data.get("+J+")}"):K.push("return this.data["+J+"]}"),K.push("proto.index=function "+N+"_index(",S.join(),"){return "+J+"}"),K.push("proto.hi=function "+N+"_hi("+S.join(",")+"){return new "+N+"(this.data,"+Z.map((function(l){return["(typeof i",l,"!=='number'||i",l,"<0)?this.shape[",l,"]:i",l,"|0"].join("")})).join(",")+","+Z.map((function(l){return"this.stride["+l+"]"})).join(",")+",this.offset)}");var H=Z.map((function(l){return"a"+l+"=this.shape["+l+"]"})),u=Z.map((function(l){return"c"+l+"=this.stride["+l+"]"}));K.push("proto.lo=function "+N+"_lo("+S.join(",")+"){var b=this.offset,d=0,"+H.join(",")+","+u.join(","));for(var W=0;W<a;++W)K.push("if(typeof i"+W+"==='number'&&i"+W+">=0){d=i"+W+"|0;b+=c"+W+"*d;a"+W+"-=d}");K.push("return new "+N+"(this.data,"+Z.map((function(l){return"a"+l})).join(",")+","+Z.map((function(l){return"c"+l})).join(",")+",b)}"),K.push("proto.step=function "+N+"_step("+S.join(",")+"){var "+Z.map((function(l){return"a"+l+"=this.shape["+l+"]"})).join(",")+","+Z.map((function(l){return"b"+l+"=this.stride["+l+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(W=0;W<a;++W)K.push("if(typeof i"+W+"==='number'){d=i"+W+"|0;if(d<0){c+=b"+W+"*(a"+W+"-1);a"+W+"=ceil(-a"+W+"/d)}else{a"+W+"=ceil(a"+W+"/d)}b"+W+"*=d}");K.push("return new "+N+"(this.data,"+Z.map((function(l){return"a"+l})).join(",")+","+Z.map((function(l){return"b"+l})).join(",")+",c)}");var B=new Array(a),Y=new Array(a);for(W=0;W<a;++W)B[W]="a[i"+W+"]",Y[W]="b[i"+W+"]";K.push("proto.transpose=function "+N+"_transpose("+S+"){"+S.map((function(l,a){return l+"=("+l+"===undefined?"+a+":"+l+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+N+"(this.data,"+B.join(",")+","+Y.join(",")+",this.offset)}"),K.push("proto.pick=function "+N+"_pick("+S+"){var a=[],b=[],c=this.offset");for(W=0;W<a;++W)K.push("if(typeof i"+W+"==='number'&&i"+W+">=0){c=(c+this.stride["+W+"]*i"+W+")|0}else{a.push(this.shape["+W+"]);b.push(this.stride["+W+"])}");return K.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),K.push("return function construct_"+N+"(data,shape,stride,offset){return new "+N+"(data,"+Z.map((function(l){return"shape["+l+"]"})).join(",")+","+Z.map((function(l){return"stride["+l+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",K.join("\n"))(T[l],w)}var T={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};l.exports=function(l,a,N,U){if(void 0===l)return(0,T.array[0])([]);"number"===typeof l&&(l=[l]),void 0===a&&(a=[l.length]);var Z=a.length;if(void 0===N){N=new Array(Z);for(var w=Z-1,J=1;w>=0;--w)N[w]=J,J*=a[w]}if(void 0===U){U=0;for(w=0;w<Z;++w)N[w]<0&&(U-=(a[w]-1)*N[w])}for(var n=function(l){if(c(l))return"buffer";if(K)switch(Object.prototype.toString.call(l)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(l)?"array":"generic"}(l),y=T[n];y.length<=Z+1;)y.push(S(n,y.length-1));return(0,y[Z+1])(l,a,N,U)}},14394:l=>{function a(l){return!!l.constructor&&"function"===typeof l.constructor.isBuffer&&l.constructor.isBuffer(l)}l.exports=function(l){return null!=l&&(a(l)||function(l){return"function"===typeof l.readFloatLE&&"function"===typeof l.slice&&a(l.slice(0,0))}(l)||!!l._isBuffer)}},14524:l=>{"use strict";var a=[],N=[],U=[],c=[],K=[],Z=[],w=[],S=[],T=[],J=[],n=[],y=[];l.exports=function(l,H,u,W,B,Y){for(var C=w,M=T,A=J,E=y,q=0;q<3;q++)C[q]=+u[q],A[q]=+H.max[q],M[q]=+H.base[q];Y||(Y=1e-10);var b=function(l,w,T,J,y,H){var u=a,W=N,B=U,Y=c,C=K,M=Z,A=S,E=Math.floor,q=0,b=0,z=0,I=0,t=0;if(O(),0===z)return 0;for(I=k();b<=z;){if(h(I)&&i())return q;I=k()}for(q+=z,t=0;t<3;t++)J[t]+=T[t],y[t]+=T[t];return q;function O(){if(b=0,0!==(z=Math.sqrt(T[0]*T[0]+T[1]*T[1]+T[2]*T[2])))for(var l=0;l<3;l++){var a=T[l]>=0;Y[l]=a?1:-1;var N=a?y[l]:J[l];u[l]=a?J[l]:y[l],W[l]=Q(N,Y[l]),B[l]=j(u[l],Y[l]),A[l]=T[l]/z,C[l]=Math.abs(1/A[l]);var U=a?W[l]+1-N:N-W[l];M[l]=C[l]<1/0?C[l]*U:1/0}}function h(a){for(var N=Y[0],U=0===a?W[0]:B[0],c=W[0]+N,K=Y[1],Z=1===a?W[1]:B[1],w=W[1]+K,S=Y[2],T=2===a?W[2]:B[2],J=W[2]+S,n=U;n!=c;n+=N)for(var y=Z;y!=w;y+=K)for(var H=T;H!=J;H+=S)if(l(n,y,H))return!0;return!1}function i(){q+=b;var l=Y[I],a=b/z,N=n;for(t=0;t<3;t++){var U=T[t]*a;J[t]+=U,y[t]+=U,N[t]=T[t]-U}if(l>0?y[I]=Math.round(y[I]):J[I]=Math.round(J[I]),w(q,I,l,N))return!0;for(t=0;t<3;t++)T[t]=N[t];return O(),0===z}function k(){var l=M[0]<M[1]?M[0]<M[2]?0:2:M[1]<M[2]?1:2,a=M[l]-b;for(b=M[l],W[l]+=Y[l],M[l]+=C[l],t=0;t<3;t++)u[t]+=a*A[t],B[t]=j(u[t],Y[t]);return l}function Q(l,a){return E(l-a*H)}function j(l,a){return E(l+a*H)}}(l,W,C,M,A,Y);if(!B){for(q=0;q<3;q++)E[q]=u[q]>0?A[q]-H.max[q]:M[q]-H.base[q];H.translate(E)}return b}},14673:(l,a,N)=>{"use strict";N.d(a,{b:()=>n});var U=N(14522),c=N(13220);class K{constructor(l,a,N,K,Z,w,S){this.FT=new U(l.base,l.KJ),this.zK=a,this.friction=N,this.restitution=K,this.Yw=Z,this.hH=w,this.Cw=!!S,this.cJ=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Wu=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.YT=c.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=c.create(),this._impulses=c.create(),this._sleepFrameCount=10}loadFromCopy(l){c.j(this.FT.base,l.FT.base),c.j(this.FT.KJ,l.FT.KJ),c.j(this.FT.max,l.FT.max),this.FT.mag=l.FT.mag,this.zK=l.zK,this.friction=l.friction,this.restitution=l.restitution,this.Yw=l.Yw,this.hH=l.hH,this.Cw=l.Cw,this.cJ=l.cJ,this.fluidDrag=l.fluidDrag,this.Wu=l.Wu,this.preventFallOffEdge=l.preventFallOffEdge,this.rolledBackLastTick=l.rolledBackLastTick,c.j(this.YT,l.YT),c.j(this.resting,l.resting),this.inFluid=l.inFluid,this._ratioInFluid=l._ratioInFluid,c.j(this._forces,l._forces),c.j(this._impulses,l._impulses),this._sleepFrameCount=l._sleepFrameCount}setPosition(l){Z(l),c.Wa(l,l,this.FT.base),this.FT.translate(l),this.AT()}Uc(){return c.clone(this.FT.base)}applyForce(l){Z(l),c.add(this._forces,this._forces,l),this.AT()}applyImpulse(l){Z(l),c.add(this._impulses,this._impulses,l),this.AT()}AT(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Z=l=>{};var w=N(14522),S=N(13220),T=N(14524);function J(){this.cJ=.1,this.fluidDrag=.4,this.bw=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function n(l,a,N){l=Object.assign(new J,l),this.gravity=l.gravity||[0,-10,0],this.cJ=l.cJ||.1,this.bw=l.bw||2,this.fluidDrag=l.fluidDrag||.4,this.minBounceImpulse=l.minBounceImpulse,this.bodies=[],this.vy=l.vy,this.testSolid=a,this.testFluid=N}n.prototype.RH=function(l,a,N,U,c,Z){l=l||new w([0,0,0],[1,1,1]),"undefined"==typeof a&&(a=1),"undefined"==typeof N&&(N=1),"undefined"==typeof U&&(U=0),"undefined"==typeof c&&(c=1);var S=new K(l,a,N,U,c,Z);return this.bodies.push(S),S},n.prototype.LH=function(l){var a=this.bodies.indexOf(l);a<0||(this.bodies.splice(a,1),l.FT=l.hH=null)};var y=S.create(),H=S.create(),u=S.create(),W=S.create(),B=S.create(),Y=S.create(),C=S.create(),M=new w([0,0,0],[1,1,1]),A=new K(M,1,1,0,1,(()=>{}),!1);function E(l,a,N){return a=N,a*=1-(1-l.ratioInFluid)**2}n.prototype.Lw=function(l){l/=1e3;var a=r(0,S.squaredLength(this.gravity));this.bodies.forEach((N=>function(l,a,N,U){S.j(B,a.resting),l.vy&&A.loadFromCopy(a);if(a.zK<=0)return S.set(a.YT,0,0,0),S.set(a._forces,0,0,0),void S.set(a._impulses,0,0,0);var c=U||0===a.Yw;if(function(l,a,N,U){if(a._sleepFrameCount>0)return!1;if(U)return!0;var c=!1,K=.5*N*N*a.Yw;return S.scale(L,l.gravity,K),T(l.testSolid,a.FT,L,(function(){return c=!0,!0}),!0),c}(l,a,N,c))return;a._sleepFrameCount--,function(l,a){var N=a.FT,U=Math.floor(N.base[0]),c=Math.floor(N.base[2]),K=Math.floor(N.base[1]),Z=Math.floor(N.max[1]);if(!l.testFluid(U,K,c))return a.inFluid=!1,void(a.ratioInFluid=0);var w=1,T=K+1;for(;T<=Z&&l.testFluid(U,T,c);)w++,T++;var J=(K+w-N.base[1])/N.KJ[1];J>1&&(J=1);var n=N.KJ[0]*N.KJ[1]*N.KJ[2]*J,y=b;S.scale(y,l.gravity,-l.bw*n*a.Yw),a.applyForce(y),a.inFluid=!0,a.ratioInFluid=J}(l,a),P(a._forces),P(a._impulses),P(a.YT),P(a.resting),S.scale(y,a._forces,1/a.zK),S.hw(y,y,l.gravity,a.Yw),S.scale(H,a._impulses,1/a.zK),S.hw(H,H,y,N),S.add(a.YT,a.YT,H),a.friction&&(z(l,0,a,H,N),z(l,1,a,H,N),z(l,2,a,H,N));var K=a.fluidDrag>=0?a.fluidDrag:l.fluidDrag,Z=a.cJ>=0?a.cJ:l.cJ,w=Z,J=Z;a.inFluid&&(w=E(a,w,a.fluidDragHoriz>=0?a.fluidDragHoriz:K),J=E(a,J,a.fluidDragVert>=0?a.fluidDragVert:K));w=Math.max(1-w*N/a.zK,0),J=Math.max(1-J*N/a.zK,0),S.set(q,w,J,w),S.multiply(a.YT,a.YT,q),S.scale(u,a.YT,N),S.set(a._forces,0,0,0),S.set(a._impulses,0,0,0),a.Cw&&X(O,a.FT);S.j(Y,u),S.set(C,0,0,0),a.preventFallOffEdge&&function(l,a,N,U){if(!a.resting[1]||N[1]>0)return;var c=f;X(c,a.FT);for(var K=0;K<3;K+=2){S.set(j,0,0,0),j[K]=N[K];var Z=!0;(Z=(Z=(Z=(Z=Z&&!R(l,c.base[0]+j[0]+1e-5,c.base[1],c.base[2]+j[2]+1e-5))&&!R(l,c.max[0]+j[0]-1e-5,c.base[1],c.base[2]+j[2]+1e-5))&&!R(l,c.base[0]+j[0]+1e-5,c.base[1],c.max[2]+j[2]-1e-5))&&!R(l,c.max[0]+j[0]-1e-5,c.base[1],c.max[2]+j[2]-1e-5))?(U[K]=N[K]>0?1:-1,N[K]=0):0===K&&(S.set(p,N[0],0,0),t(l,c,p,U,a.slideOnCollision))}}(l,a,u,C);t(l,a.FT,u,a.resting,a.slideOnCollision),a.Cw&&function(l,a,N,U){if(a.resting[1]>=0&&!a.inFluid)return;var c=0!==a.resting[0],K=0!==a.resting[2];if(!c&&!K)return;var Z=Math.abs(U[0]/U[2]),w=4;if(!c&&Z>w)return;if(!K&&Z<1/w)return;S.add(i,N.base,U);var J=l.testSolid;T(J,N,U,(function(l,a,N,U){if(1!==a)return!0;U[a]=0}));var n=N.base[1],y=a.inFluid?1.951:1.001,H=Math.floor(n+y)-n;S.set(k,0,H,0);var u=!1;if(T(J,N,k,(function(l,a,N,U){return u=!0,!0})),u)return;S.Wa(Q,i,N.base),Q[1]=0,t(l,N,Q,h,!0);var W=r(N.base[0],i[0]),B=r(N.base[2],i[2]);if(c&&!W&&(!B||!K))return;if(K&&(!W||!c)&&!B)return;var Y=!0;if(Y=Y&&!R(l,N.base[0]+1e-5,N.base[1],N.base[2]+1e-5),Y=Y&&!R(l,N.max[0]-1e-5,N.base[1],N.base[2]+1e-5),Y=Y&&!R(l,N.base[0]+1e-5,N.base[1],N.max[2]-1e-5),Y=Y&&!R(l,N.max[0]-1e-5,N.base[1],N.max[2]-1e-5),Y)return;X(a.FT,N),a.resting[0]=h[0],a.resting[2]=h[2],a.Wu&&a.Wu()}(l,a,O,Y);for(var n=0;n<3;++n)a.resting[n]=a.resting[n]||C[n],W[n]=0,a.resting[n]&&(B[n]||(W[n]=-a.YT[n]),a.YT[n]=0);var M=S.length(W);M>.001&&(S.scale(W,W,a.zK),a.hH&&a.hH(W),a.restitution>0&&M>l.minBounceImpulse&&(S.scale(W,W,a.restitution),a.applyImpulse(W)));var I=S.squaredLength(a.YT);I>1e-5&&a.AT();l.vy&&l.vy(a)?(a.loadFromCopy(A),a.rolledBackLastTick=!0):a.rolledBackLastTick=!1}(this,N,l,a)))};var q=S.create([0,0,0]);var b=S.create();function z(l,a,N,U,c){var K=N.resting[a],Z=U[a];if(!N.alwaysApplyHorizFriction||1!==a){if(0===K)return;if(K*Z<=0)return}S.j(I,N.YT),I[a]=0;var w=S.length(I);if(!r(w,0)){var T=Math.abs(N.friction*l.gravity[a]*c),J=w>T?(w-T)/w:0;N.YT[(a+1)%3]*=J,N.YT[(a+2)%3]*=J}}var I=S.create();function t(l,a,N,U,c){return S.set(U,0,0,0),T(l.testSolid,a,N,(function(l,a,N,K){U[a]=N,K[a]=0,c||(K[0]=0,K[1]=0,K[2]=0)}))}var O=new w([],[]),h=S.create(),i=S.create(),k=S.create(),Q=S.create();var j=S.create(),f=new w([],[]),p=S.create();function R(l,a,N,U){return l.testSolid(Math.floor(a),Math.floor(N-1),Math.floor(U))}var L=S.create();function r(l,a){return Math.abs(l-a)<1e-5}function X(l,a){for(var N=0;N<3;N++)l.base[N]=a.base[N],l.max[N]=a.max[N],l.KJ[N]=a.KJ[N]}var P=function(l){}},13088:function(l,a){!function(l){"use strict";var a=function(l,N){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,a){l.__proto__=a}||function(l,a){for(var N in a)Object.prototype.hasOwnProperty.call(a,N)&&(l[N]=a[N])},a(l,N)};function N(l,N){if("function"!==typeof N&&null!==N)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function U(){this.constructor=l}a(l,N),l.prototype=null===N?Object.create(N):(U.prototype=N.prototype,new U)}function U(l,a,N,U){var c,K=arguments.length,Z=K<3?a:null===U?U=Object.getOwnPropertyDescriptor(a,N):U;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Z=Reflect.decorate(l,a,N,U);else for(var w=l.length-1;w>=0;w--)(c=l[w])&&(Z=(K<3?c(Z):K>3?c(a,N,Z):c(a,N))||Z);return K>3&&Z&&Object.defineProperty(a,N,Z),Z}function c(l,a,N){if(N||2===arguments.length)for(var U,c=0,K=a.length;c<K;c++)!U&&c in a||(U||(U=Array.prototype.slice.call(a,0,c)),U[c]=a[c]);return l.concat(U||Array.prototype.slice.call(a))}var K,Z=255,w=213;l.OPERATION=void 0,(K=l.OPERATION||(l.OPERATION={}))[K.ADD=128]="ADD",K[K.REPLACE=0]="REPLACE",K[K.DELETE=64]="DELETE",K[K.DELETE_AND_ADD=192]="DELETE_AND_ADD",K[K.TOUCH=1]="TOUCH",K[K.CLEAR=10]="CLEAR";var S=function(){function a(l,a,N){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=l,this.setParent(a,N)}return a.prototype.setParent=function(l,a,N){var U=this;if(this.indexes||(this.indexes=this.ref instanceof Ql?this.ref._definition.indexes:{}),this.parent=l,this.parentIndex=N,a)if(this.root=a,this.ref instanceof Ql){var c=this.ref._definition;for(var K in c.schema){var Z=this.ref[K];if(Z&&Z.$changes){var w=c.indexes[K];Z.$changes.setParent(this.ref,a,w)}}}else"object"===typeof this.ref&&this.ref.forEach((function(l,a){if(l instanceof Ql){var N=l.$changes,c=U.ref.$changes.indexes[a];N.setParent(U.ref,U.root,c)}}))},a.prototype.operation=function(l){this.changes.set(--this.currentCustomOperation,l)},a.prototype.change=function(a,N){void 0===N&&(N=l.OPERATION.ADD);var U="number"===typeof a?a:this.indexes[a];this.assertValidIndex(U,a);var c=this.changes.get(U);c&&c.op!==l.OPERATION.DELETE&&c.op!==l.OPERATION.TOUCH||this.changes.set(U,{op:c&&c.op===l.OPERATION.DELETE?l.OPERATION.DELETE_AND_ADD:N,index:U}),this.allChanges.add(U),this.changed=!0,this.touchParents()},a.prototype.touch=function(a){var N="number"===typeof a?a:this.indexes[a];this.assertValidIndex(N,a),this.changes.has(N)||this.changes.set(N,{op:l.OPERATION.TOUCH,index:N}),this.allChanges.add(N),this.touchParents()},a.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},a.prototype.getType=function(l){if(this.ref._definition)return(a=this.ref._definition).schema[a.fieldsByIndex[l]];var a,N=(a=this.parent._definition).schema[a.fieldsByIndex[this.parentIndex]];return Object.values(N)[0]},a.prototype.getChildrenFilter=function(){var l=this.parent._definition.childFilters;return l&&l[this.parentIndex]},a.prototype.getValue=function(l){return this.ref.getByIndex(l)},a.prototype.delete=function(a){var N="number"===typeof a?a:this.indexes[a];if(void 0!==N){var U=this.getValue(N);this.changes.set(N,{op:l.OPERATION.DELETE,index:N}),this.allChanges.delete(N),delete this.caches[N],U&&U.$changes&&(U.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(a," (").concat(N,")"))},a.prototype.discard=function(a,N){var U=this;void 0===a&&(a=!1),void 0===N&&(N=!1),this.ref instanceof Ql||this.changes.forEach((function(a){if(a.op===l.OPERATION.DELETE){var N=U.ref.getIndex(a.index);delete U.indexes[N]}})),this.changes.clear(),this.changed=a,N&&this.allChanges.clear(),this.currentCustomOperation=0},a.prototype.discardAll=function(){var l=this;this.changes.forEach((function(a){var N=l.getValue(a.index);N&&N.$changes&&N.$changes.discardAll()})),this.discard()},a.prototype.cache=function(l,a){this.caches[l]=a},a.prototype.clone=function(){return new a(this.ref,this.parent,this.root)},a.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},a.prototype.assertValidIndex=function(l,a){if(void 0===l)throw new Error('ChangeTree: missing index for field "'.concat(a,'"'))},a}();function T(l,a,N,U){return l[a]||(l[a]=[]),l[a].push(N),null===U||void 0===U||U.forEach((function(l,a){return N(l,a)})),function(){return n(l[a],l[a].indexOf(N))}}function J(a){var N=this,U="string"!==typeof this.$changes.getType();this.$items.forEach((function(c,K){a.push({refId:N.$changes.refId,op:l.OPERATION.DELETE,field:K,value:void 0,previousValue:c}),U&&N.$changes.root.removeRef(c.$changes.refId)}))}function n(l,a){if(-1===a||a>=l.length)return!1;for(var N=l.length-1,U=a;U<N;U++)l[U]=l[U+1];return l.length=N,!0}var y=function(l,a){var N=l.toString(),U=a.toString();return N<U?-1:N>U?1:0};function H(l){return l.$proxy=!0,l=new Proxy(l,{get:function(l,a){return"symbol"===typeof a||isNaN(a)?l[a]:l.at(a)},set:function(l,a,N){if("symbol"===typeof a||isNaN(a))l[a]=N;else{var U=Array.from(l.$items.keys()),c=parseInt(U[a]||a);void 0===N||null===N?l.deleteAt(c):l.setAt(c,N)}return!0},deleteProperty:function(l,a){return"number"===typeof a?l.deleteAt(a):delete l[a],!0}})}var u=function(){function a(){for(var l=[],a=0;a<arguments.length;a++)l[a]=arguments[a];this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,l)}return a.prototype.Fw=function(a,N){return void 0===N&&(N=!0),T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.ADD,a,N?this.$items:void 0)},a.prototype.mc=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.REPLACE,a)},a.is=function(l){return Array.isArray(l)||void 0!==l.array},Object.defineProperty(a.prototype,"length",{get:function(){return this.$items.size},set:function(l){0===l?this.clear():this.splice(l,this.length-l)},enumerable:!1,configurable:!0}),a.prototype.push=function(){for(var l,a=this,N=[],U=0;U<arguments.length;U++)N[U]=arguments[U];return N.forEach((function(N){l=a.$refId++,a.setAt(l,N)})),l},a.prototype.pop=function(){var l=Array.from(this.$indexes.values()).pop();if(void 0!==l){this.$changes.delete(l),this.$indexes.delete(l);var a=this.$items.get(l);return this.$items.delete(l),a}},a.prototype.at=function(l){var a=Array.from(this.$items.keys())[l];return this.$items.get(a)},a.prototype.setAt=function(a,N){var U,c;if(void 0!==N&&null!==N){if(this.$items.get(a)!==N){void 0!==N.$changes&&N.$changes.setParent(this,this.$changes.root,a);var K=null!==(c=null===(U=this.$changes.indexes[a])||void 0===U?void 0:U.op)&&void 0!==c?c:l.OPERATION.ADD;this.$changes.indexes[a]=a,this.$indexes.set(a,a),this.$items.set(a,N),this.$changes.change(a,K)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},a.prototype.deleteAt=function(l){var a=Array.from(this.$items.keys())[l];return void 0!==a&&this.$deleteAt(a)},a.prototype.$deleteAt=function(l){return this.$changes.delete(l),this.$indexes.delete(l),this.$items.delete(l)},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&J.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:l.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.concat=function(){for(var l,N=[],U=0;U<arguments.length;U++)N[U]=arguments[U];return new(a.bind.apply(a,c([void 0],(l=Array.from(this.$items.values())).concat.apply(l,N),!1)))},a.prototype.join=function(l){return Array.from(this.$items.values()).join(l)},a.prototype.reverse=function(){var l=this,a=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(N,U){l.setAt(a[U],N)})),this},a.prototype.shift=function(){var l=Array.from(this.$items.keys()).shift();if(void 0!==l){var a=this.$items.get(l);return this.$deleteAt(l),a}},a.prototype.slice=function(l,N){var U=new a;return U.push.apply(U,Array.from(this.$items.values()).slice(l,N)),U},a.prototype.sort=function(l){var a=this;void 0===l&&(l=y);var N=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(l).forEach((function(l,U){a.setAt(N[U],l)})),this},a.prototype.splice=function(l,a){void 0===a&&(a=this.length-l);for(var N=Array.from(this.$items.keys()),U=[],c=l;c<l+a;c++)U.push(this.$items.get(N[c])),this.$deleteAt(N[c]);return U},a.prototype.unshift=function(){for(var l=this,a=[],N=0;N<arguments.length;N++)a[N]=arguments[N];var U=this.length,c=a.length,K=Array.from(this.$items.values());return a.forEach((function(a,N){l.setAt(N,a)})),K.forEach((function(a,N){l.setAt(c+N,a)})),U+c},a.prototype.indexOf=function(l,a){return Array.from(this.$items.values()).indexOf(l,a)},a.prototype.lastIndexOf=function(l,a){return void 0===a&&(a=this.length-1),Array.from(this.$items.values()).lastIndexOf(l,a)},a.prototype.every=function(l,a){return Array.from(this.$items.values()).every(l,a)},a.prototype.some=function(l,a){return Array.from(this.$items.values()).some(l,a)},a.prototype.forEach=function(l,a){Array.from(this.$items.values()).forEach(l,a)},a.prototype.map=function(l,a){return Array.from(this.$items.values()).map(l,a)},a.prototype.filter=function(l,a){return Array.from(this.$items.values()).filter(l,a)},a.prototype.reduce=function(l,a){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},a.prototype.reduceRight=function(l,a){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},a.prototype.find=function(l,a){return Array.from(this.$items.values()).find(l,a)},a.prototype.findIndex=function(l,a){return Array.from(this.$items.values()).findIndex(l,a)},a.prototype.fill=function(l,a,N){throw new Error("ArraySchema#fill() not implemented")},a.prototype.copyWithin=function(l,a,N){throw new Error("ArraySchema#copyWithin() not implemented")},a.prototype.toString=function(){return this.$items.toString()},a.prototype.toLocaleString=function(){return this.$items.toLocaleString()},a.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(a,Symbol.species,{get:function(){return a},enumerable:!1,configurable:!0}),a.prototype.entries=function(){return this.$items.entries()},a.prototype.keys=function(){return this.$items.keys()},a.prototype.values=function(){return this.$items.values()},a.prototype.includes=function(l,a){return Array.from(this.$items.values()).includes(l,a)},a.prototype.flatMap=function(l,a){throw new Error("ArraySchema#flatMap() is not supported.")},a.prototype.flat=function(l){throw new Error("ArraySchema#flat() is not supported.")},a.prototype.findLast=function(){var l=Array.from(this.$items.values());return l.findLast.apply(l,arguments)},a.prototype.findLastIndex=function(){var l=Array.from(this.$items.values());return l.findLastIndex.apply(l,arguments)},a.prototype.setIndex=function(l,a){this.$indexes.set(l,a)},a.prototype.getIndex=function(l){return this.$indexes.get(l)},a.prototype.getByIndex=function(l){return this.$items.get(this.$indexes.get(l))},a.prototype.deleteByIndex=function(l){var a=this.$indexes.get(l);this.$items.delete(a),this.$indexes.delete(l)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){return this.toArray().map((function(l){return"function"===typeof l.toJSON?l.toJSON():l}))},a.prototype.clone=function(l){return l?new(a.bind.apply(a,c([void 0],Array.from(this.$items.values()),!1))):new(a.bind.apply(a,c([void 0],this.map((function(l){return l.$changes?l.clone():l})),!1)))},a}();function W(l){return l.$proxy=!0,l=new Proxy(l,{get:function(l,a){return"symbol"!==typeof a&&"undefined"===typeof l[a]?l.get(a):l[a]},set:function(l,a,N){return"symbol"!==typeof a&&-1===a.indexOf("$")&&"Fw"!==a&&"mc"!==a&&"onChange"!==a?l.set(a,N):l[a]=N,!0},deleteProperty:function(l,a){return l.delete(a),!0}})}var B=function(){function a(l){var N=this;if(this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,l)if(l instanceof Map||l instanceof a)l.forEach((function(l,a){return N.set(a,l)}));else for(var U in l)this.set(U,l[U])}return a.prototype.Fw=function(a,N){return void 0===N&&(N=!0),T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.ADD,a,N?this.$items:void 0)},a.prototype.mc=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.REPLACE,a)},a.is=function(l){return void 0!==l.map},a.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(a.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(a,Symbol.species,{get:function(){return a},enumerable:!1,configurable:!0}),a.prototype.set=function(a,N){if(void 0===N||null===N)throw new Error("MapSchema#set('".concat(a,"', ").concat(N,"): trying to set ").concat(N," value on '").concat(a,"'."));a=a.toString();var U="undefined"!==typeof this.$changes.indexes[a],c=U?this.$changes.indexes[a]:this.$refId++,K=U?l.OPERATION.REPLACE:l.OPERATION.ADD,Z=void 0!==N.$changes;if(Z&&N.$changes.setParent(this,this.$changes.root,c),U){if(!Z&&this.$items.get(a)===N)return;Z&&this.$items.get(a)!==N&&(K=l.OPERATION.ADD)}else this.$changes.indexes[a]=c,this.$indexes.set(c,a);return this.$items.set(a,N),this.$changes.change(a,K),this},a.prototype.get=function(l){return this.$items.get(l)},a.prototype.delete=function(l){return this.$changes.delete(l),this.$items.delete(l)},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&J.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:l.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(l){return this.$items.has(l)},a.prototype.forEach=function(l){this.$items.forEach(l)},a.prototype.entries=function(){return this.$items.entries()},a.prototype.keys=function(){return this.$items.keys()},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(l,a){this.$indexes.set(l,a)},a.prototype.getIndex=function(l){return this.$indexes.get(l)},a.prototype.getByIndex=function(l){return this.$items.get(this.$indexes.get(l))},a.prototype.deleteByIndex=function(l){var a=this.$indexes.get(l);this.$items.delete(a),this.$indexes.delete(l)},a.prototype.toJSON=function(){var l={};return this.forEach((function(a,N){l[N]="function"===typeof a.toJSON?a.toJSON():a})),l},a.prototype.clone=function(l){var N;return l?N=Object.assign(new a,this):(N=new a,this.forEach((function(l,a){l.$changes?N.set(a,l.clone()):N.set(a,l)}))),N},a}(),Y={};function C(l,a){Y[l]=a}function M(l){return Y[l]}var A=function(){function l(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return l.create=function(a){var N=new l;return N.schema=Object.assign({},a&&a.schema||{}),N.indexes=Object.assign({},a&&a.indexes||{}),N.fieldsByIndex=Object.assign({},a&&a.fieldsByIndex||{}),N.descriptors=Object.assign({},a&&a.descriptors||{}),N.deprecated=Object.assign({},a&&a.deprecated||{}),N},l.prototype.addField=function(l,a){var N=this.getNextFieldIndex();this.fieldsByIndex[N]=l,this.indexes[l]=N,this.schema[l]=Array.isArray(a)?{array:a[0]}:a},l.prototype.hasField=function(l){return void 0!==this.indexes[l]},l.prototype.addFilter=function(l,a){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[l]]=a,this.indexesWithFilters.push(this.indexes[l]),!0},l.prototype.addChildrenFilter=function(l,a){var N=this.indexes[l],U=this.schema[l];if(M(Object.keys(U)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[N]=a,!0;console.warn("@filterChildren: field '".concat(l,"' can't have children. Ignoring filter."))},l.prototype.getChildrenFilter=function(l){return this.childFilters&&this.childFilters[this.indexes[l]]},l.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},l}();function E(l){return l._context&&l._context.useFilters}var q=function(){function l(){this.types={},this.schemas=new Map,this.useFilters=!1}return l.prototype.has=function(l){return this.schemas.has(l)},l.prototype.get=function(l){return this.types[l]},l.prototype.add=function(l,a){void 0===a&&(a=this.schemas.size),l._definition=A.create(l._definition),l._typeid=a,this.types[a]=l,this.schemas.set(l,a)},l.create=function(a){return void 0===a&&(a={}),function(N){return a.context||(a.context=new l),z(N,a)}},l}(),b=new q;function z(l,a){return void 0===a&&(a={}),function(N,U){var K=a.context||b,Z=N.constructor;if(Z._context=K,!l)throw new Error("".concat(Z.name,': @type() reference provided for "').concat(U,"\" is undefined. Make sure you don't have any circular dependencies."));K.has(Z)||K.add(Z);var w=Z._definition;if(w.addField(U,l),w.descriptors[U]){if(w.deprecated[U])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(U,"' definition on '").concat(Z.name,"'.\nCheck @type() annotation"))}catch(Y){var S=Y.stack.split("\n")[4].trim();throw new Error("".concat(Y.message," ").concat(S))}}var T=u.is(l),J=!T&&B.is(l);if("string"!==typeof l&&!Ql.is(l)){var n=Object.values(l)[0];"string"===typeof n||K.has(n)||K.add(n)}if(a.manual)w.descriptors[U]={enumerable:!0,configurable:!0,writable:!0};else{var y="_".concat(U);w.descriptors[y]={enumerable:!1,configurable:!1,writable:!0},w.descriptors[U]={get:function(){return this[y]},set:function(l){l!==this[y]&&(void 0!==l&&null!==l?(!T||l instanceof u||(l=new(u.bind.apply(u,c([void 0],l,!1)))),!J||l instanceof B||(l=new B(l)),void 0===l.$proxy&&(J?l=W(l):T&&(l=H(l))),this.$changes.change(U),l.$changes&&l.$changes.setParent(this,this.$changes.root,this._definition.indexes[U])):this[y]&&this.$changes.delete(U),this[y]=l)},enumerable:!0,configurable:!0}}}}function I(l){return function(a,N){var U=a.constructor;U._definition.addFilter(N,l)&&(U._context.useFilters=!0)}}function t(l){return function(a,N){var U=a.constructor;U._definition.addChildrenFilter(N,l)&&(U._context.useFilters=!0)}}function O(l){return void 0===l&&(l=!0),function(a,N){var U=a.constructor._definition;U.deprecated[N]=!0,l&&(U.descriptors[N]={get:function(){throw new Error("".concat(N," is deprecated."))},set:function(l){},enumerable:!1,configurable:!0})}}function h(l,a,N){for(var U in void 0===N&&(N={}),N.context||(N.context=l._context||N.context||b),a)z(a[U],N)(l.prototype,U);return l}function i(l){for(var a=0,N=0,U=0,c=l.length;U<c;U++)(a=l.charCodeAt(U))<128?N+=1:a<2048?N+=2:a<55296||a>=57344?N+=3:(U++,N+=4);return N}function k(l,a,N){for(var U=0,c=0,K=N.length;c<K;c++)(U=N.charCodeAt(c))<128?l[a++]=U:U<2048?(l[a++]=192|U>>6,l[a++]=128|63&U):U<55296||U>=57344?(l[a++]=224|U>>12,l[a++]=128|U>>6&63,l[a++]=128|63&U):(c++,U=65536+((1023&U)<<10|1023&N.charCodeAt(c)),l[a++]=240|U>>18,l[a++]=128|U>>12&63,l[a++]=128|U>>6&63,l[a++]=128|63&U)}function Q(l,a){l.push(255&a)}function j(l,a){l.push(255&a)}function f(l,a){l.push(255&a),l.push(a>>8&255)}function p(l,a){l.push(255&a),l.push(a>>8&255)}function R(l,a){l.push(255&a),l.push(a>>8&255),l.push(a>>16&255),l.push(a>>24&255)}function L(l,a){var N=a>>24,U=a>>16,c=a>>8,K=a;l.push(255&K),l.push(255&c),l.push(255&U),l.push(255&N)}function r(l,a){var N=Math.floor(a/Math.pow(2,32));L(l,a>>>0),L(l,N)}function X(l,a){var N=a/Math.pow(2,32)|0;L(l,a>>>0),L(l,N)}function P(l,a){o(l,a)}function d(l,a){G(l,a)}var F=new Int32Array(2),e=new Float32Array(F.buffer),s=new Float64Array(F.buffer);function o(l,a){e[0]=a,R(l,F[0])}function G(l,a){s[0]=a,R(l,F[0]),R(l,F[1])}function ml(l,a){return j(l,a?1:0)}function x(l,a){a||(a="");var N=i(a),U=0;if(N<32)l.push(160|N),U=1;else if(N<256)l.push(217),j(l,N),U=2;else if(N<65536)l.push(218),p(l,N),U=3;else{if(!(N<4294967296))throw new Error("String too long");l.push(219),L(l,N),U=5}return k(l,l.length,a),U+N}function V(l,a){return isNaN(a)?V(l,0):isFinite(a)?a!==(0|a)?(l.push(203),G(l,a),9):a>=0?a<128?(j(l,a),1):a<256?(l.push(204),j(l,a),2):a<65536?(l.push(205),p(l,a),3):a<4294967296?(l.push(206),L(l,a),5):(l.push(207),X(l,a),9):a>=-32?(l.push(224|a+32),1):a>=-128?(l.push(208),Q(l,a),2):a>=-32768?(l.push(209),f(l,a),3):a>=-2147483648?(l.push(210),R(l,a),5):(l.push(211),r(l,a),9):V(l,a>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var D=Object.freeze({__proto__:null,utf8Write:k,int8:Q,uint8:j,int16:f,uint16:p,int32:R,uint32:L,int64:r,uint64:X,float32:P,float64:d,writeFloat32:o,writeFloat64:G,boolean:ml,string:x,number:V});function v(l,a,N){for(var U="",c=0,K=a,Z=a+N;K<Z;K++){var w=l[K];0!==(128&w)?192!==(224&w)?224!==(240&w)?240!==(248&w)?console.error("Invalid byte "+w.toString(16)):(c=(7&w)<<18|(63&l[++K])<<12|(63&l[++K])<<6|63&l[++K])>=65536?(c-=65536,U+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):U+=String.fromCharCode(c):U+=String.fromCharCode((15&w)<<12|(63&l[++K])<<6|63&l[++K]):U+=String.fromCharCode((31&w)<<6|63&l[++K]):U+=String.fromCharCode(w)}return U}function g(l,a){return ll(l,a)<<24>>24}function ll(l,a){return l[a.offset++]}function al(l,a){return Nl(l,a)<<16>>16}function Nl(l,a){return l[a.offset++]|l[a.offset++]<<8}function Ul(l,a){return l[a.offset++]|l[a.offset++]<<8|l[a.offset++]<<16|l[a.offset++]<<24}function cl(l,a){return Ul(l,a)>>>0}function Kl(l,a){return yl(l,a)}function Zl(l,a){return Hl(l,a)}function wl(l,a){var N=cl(l,a);return Ul(l,a)*Math.pow(2,32)+N}function Sl(l,a){var N=cl(l,a);return cl(l,a)*Math.pow(2,32)+N}var Tl=new Int32Array(2),Jl=new Float32Array(Tl.buffer),nl=new Float64Array(Tl.buffer);function yl(l,a){return Tl[0]=Ul(l,a),Jl[0]}function Hl(l,a){return Tl[0]=Ul(l,a),Tl[1]=Ul(l,a),nl[0]}function ul(l,a){return ll(l,a)>0}function Wl(l,a){var N,U=l[a.offset++];U<192?N=31&U:217===U?N=ll(l,a):218===U?N=Nl(l,a):219===U&&(N=cl(l,a));var c=v(l,a.offset,N);return a.offset+=N,c}function Bl(l,a){var N=l[a.offset];return N<192&&N>160||217===N||218===N||219===N}function Yl(l,a){var N=l[a.offset++];return N<128?N:202===N?yl(l,a):203===N?Hl(l,a):204===N?ll(l,a):205===N?Nl(l,a):206===N?cl(l,a):207===N?Sl(l,a):208===N?g(l,a):209===N?al(l,a):210===N?Ul(l,a):211===N?wl(l,a):N>223?-1*(255-N+1):void 0}function Cl(l,a){var N=l[a.offset];return N<128||N>=202&&N<=211}function Ml(l,a){return l[a.offset]<160}function Al(l,a){return l[a.offset-1]===Z&&(l[a.offset]<128||l[a.offset]>=202&&l[a.offset]<=211)}var El=Object.freeze({__proto__:null,int8:g,uint8:ll,int16:al,uint16:Nl,int32:Ul,uint32:cl,float32:Kl,float64:Zl,int64:wl,uint64:Sl,readFloat32:yl,readFloat64:Hl,boolean:ul,string:Wl,stringCheck:Bl,number:Yl,numberCheck:Cl,arrayCheck:Ml,switchStructureCheck:Al}),ql=function(){function a(l){var a=this;this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,l&&l.forEach((function(l){return a.add(l)}))}return a.prototype.Fw=function(a,N){return void 0===N&&(N=!0),T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.ADD,a,N?this.$items:void 0)},a.prototype.mc=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.REPLACE,a)},a.is=function(l){return void 0!==l.collection},a.prototype.add=function(l){var a=this.$refId++;return void 0!==l.$changes&&l.$changes.setParent(this,this.$changes.root,a),this.$changes.indexes[a]=a,this.$indexes.set(a,a),this.$items.set(a,l),this.$changes.change(a),a},a.prototype.at=function(l){var a=Array.from(this.$items.keys())[l];return this.$items.get(a)},a.prototype.entries=function(){return this.$items.entries()},a.prototype.delete=function(l){for(var a,N,U=this.$items.entries();(N=U.next())&&!N.done;)if(l===N.value[1]){a=N.value[0];break}return void 0!==a&&(this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a))},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&J.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:l.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(l){return Array.from(this.$items.values()).some((function(a){return a===l}))},a.prototype.forEach=function(l){var a=this;this.$items.forEach((function(N,U,c){return l(N,U,a)}))},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(l,a){this.$indexes.set(l,a)},a.prototype.getIndex=function(l){return this.$indexes.get(l)},a.prototype.getByIndex=function(l){return this.$items.get(this.$indexes.get(l))},a.prototype.deleteByIndex=function(l){var a=this.$indexes.get(l);this.$items.delete(a),this.$indexes.delete(l)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){var l=[];return this.forEach((function(a,N){l.push("function"===typeof a.toJSON?a.toJSON():a)})),l},a.prototype.clone=function(l){var N;return l?N=Object.assign(new a,this):(N=new a,this.forEach((function(l){l.$changes?N.add(l.clone()):N.add(l)}))),N},a}(),bl=function(){function a(l){var a=this;this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,l&&l.forEach((function(l){return a.add(l)}))}return a.prototype.Fw=function(a,N){return void 0===N&&(N=!0),T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.ADD,a,N?this.$items:void 0)},a.prototype.mc=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.REPLACE,a)},a.is=function(l){return void 0!==l.set},a.prototype.add=function(a){var N,U;if(this.has(a))return!1;var c=this.$refId++;void 0!==a.$changes&&a.$changes.setParent(this,this.$changes.root,c);var K=null!==(U=null===(N=this.$changes.indexes[c])||void 0===N?void 0:N.op)&&void 0!==U?U:l.OPERATION.ADD;return this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,a),this.$changes.change(c,K),c},a.prototype.entries=function(){return this.$items.entries()},a.prototype.delete=function(l){for(var a,N,U=this.$items.entries();(N=U.next())&&!N.done;)if(l===N.value[1]){a=N.value[0];break}return void 0!==a&&(this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a))},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&J.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:l.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(l){for(var a,N=this.$items.values(),U=!1;(a=N.next())&&!a.done;)if(l===a.value){U=!0;break}return U},a.prototype.forEach=function(l){var a=this;this.$items.forEach((function(N,U,c){return l(N,U,a)}))},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(l,a){this.$indexes.set(l,a)},a.prototype.getIndex=function(l){return this.$indexes.get(l)},a.prototype.getByIndex=function(l){return this.$items.get(this.$indexes.get(l))},a.prototype.deleteByIndex=function(l){var a=this.$indexes.get(l);this.$items.delete(a),this.$indexes.delete(l)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){var l=[];return this.forEach((function(a,N){l.push("function"===typeof a.toJSON?a.toJSON():a)})),l},a.prototype.clone=function(l){var N;return l?N=Object.assign(new a,this):(N=new a,this.forEach((function(l){l.$changes?N.add(l.clone()):N.add(l)}))),N},a}(),zl=function(){function l(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return l.prototype.addRefId=function(l){this.refIds.has(l)||(this.refIds.add(l),this.containerIndexes.set(l,new Set))},l.get=function(a){return void 0===a.$filterState&&(a.$filterState=new l),a.$filterState},l}(),Il=function(){function l(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return l.prototype.getNextUniqueId=function(){return this.nextUniqueId++},l.prototype.addRef=function(l,a,N){void 0===N&&(N=!0),this.refs.set(l,a),N&&(this.refCounts[l]=(this.refCounts[l]||0)+1)},l.prototype.removeRef=function(l){this.refCounts[l]=this.refCounts[l]-1,this.deletedRefs.add(l)},l.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},l.prototype.garbageCollectDeletedRefs=function(){var l=this;this.deletedRefs.forEach((function(a){if(!(l.refCounts[a]>0)){var N=l.refs.get(a);if(N instanceof Ql)for(var U in N._definition.schema)"string"!==typeof N._definition.schema[U]&&N[U]&&N[U].$changes&&l.removeRef(N[U].$changes.refId);else{var c=N.$changes.parent._definition,K=c.schema[c.fieldsByIndex[N.$changes.parentIndex]];"function"===typeof Object.values(K)[0]&&Array.from(N.values()).forEach((function(a){return l.removeRef(a.$changes.refId)}))}l.refs.delete(a),delete l.refCounts[a]}})),this.deletedRefs.clear()},l}(),tl=function(l){function a(){return null!==l&&l.apply(this,arguments)||this}return N(a,l),a}(Error);function Ol(l,a,N,U){var c,K=!1;switch(a){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(l)&&console.log('trying to encode "NaN" in '.concat(N.constructor.name,"#").concat(U));break;case"string":c="string",K=!0;break;case"boolean":return}if(typeof l!==c&&(!K||K&&null!==l)){var Z="'".concat(JSON.stringify(l),"'").concat(l&&l.constructor&&" (".concat(l.constructor.name,")")||"");throw new tl("a '".concat(c,"' was expected, but ").concat(Z," was provided in ").concat(N.constructor.name,"#").concat(U))}}function hl(l,a,N,U){if(!(l instanceof a))throw new tl("a '".concat(a.name,"' was expected, but '").concat(l.constructor.name,"' was provided in ").concat(N.constructor.name,"#").concat(U))}function il(l,a,N,U,c){Ol(N,l,U,c);var K=D[l];if(!K)throw new tl("a '".concat(l,"' was expected, but ").concat(N," was provided in ").concat(U.constructor.name,"#").concat(c));K(a,N)}function kl(l,a,N){return El[l](a,N)}var Ql=function(){function a(){for(var l=[],a=0;a<arguments.length;a++)l[a]=arguments[a];Object.defineProperties(this,{$changes:{value:new S(this,void 0,new Il),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var N=this._definition.descriptors;N&&Object.defineProperties(this,N),l[0]&&this.assign(l[0])}return a.onError=function(l){console.error(l)},a.is=function(l){return l._definition&&void 0!==l._definition.schema},a.prototype.onChange=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.REPLACE,a)},a.prototype.mc=function(a){return T(this.$callbacks||(this.$callbacks=[]),l.OPERATION.DELETE,a)},a.prototype.assign=function(l){return Object.assign(this,l),this},Object.defineProperty(a.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),a.prototype.setDirty=function(l,a){this.$changes.change(l,a)},a.prototype.listen=function(l,a,N){var U=this;return void 0===N&&(N=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[l]||(this.$callbacks[l]=[]),this.$callbacks[l].push(a),N&&void 0!==this[l]&&a(this[l],void 0),function(){return n(U.$callbacks[l],U.$callbacks[l].indexOf(a))}},a.prototype.decode=function(N,U,c){var K;void 0===U&&(U={offset:0}),void 0===c&&(c=this);var w=[],S=this.$changes.root,T=N.length,J=0;for(S.refs.set(J,this);U.offset<T;){var n=N[U.offset++];if(n!=Z){var y=c.$changes,H=void 0!==c._definition,W=H?n>>6<<6:n;if(W!==l.OPERATION.CLEAR){var Y=H?n%(W||255):Yl(N,U),C=H?c._definition.fieldsByIndex[Y]:"",A=y.getType(Y),E=void 0,q=void 0,b=void 0;if(H?q=c["_".concat(C)]:(q=c.getByIndex(Y),(W&l.OPERATION.ADD)===l.OPERATION.ADD?(b=c instanceof B?Wl(N,U):Y,c.setIndex(Y,b)):b=c.getIndex(Y)),(W&l.OPERATION.DELETE)===l.OPERATION.DELETE&&(W!==l.OPERATION.DELETE_AND_ADD&&c.deleteByIndex(Y),q&&q.$changes&&S.removeRef(q.$changes.refId),E=null),void 0!==C){if(W===l.OPERATION.DELETE);else if(a.is(A)){var z=Yl(N,U);if(E=S.refs.get(z),W!==l.OPERATION.REPLACE){var I=this.getSchemaType(N,U,A);E||((E=this.createTypeInstance(I)).$changes.refId=z,q&&(E.$callbacks=q.$callbacks,q.$changes.refId&&z!==q.$changes.refId&&S.removeRef(q.$changes.refId))),S.addRef(z,E,E!==q)}}else if("string"===typeof A)E=kl(A,N,U);else{var t=M(Object.keys(A)[0]),O=Yl(N,U),h=S.refs.has(O)?q||S.refs.get(O):new t.constructor;if((E=h.clone(!0)).$changes.refId=O,q&&(E.$callbacks=q.$callbacks,q.$changes.refId&&O!==q.$changes.refId)){S.removeRef(q.$changes.refId);for(var i=q.entries(),k=void 0;(k=i.next())&&!k.done;){var Q=(K=k.value)[0],j=K[1];w.push({refId:O,op:l.OPERATION.DELETE,field:Q,value:void 0,previousValue:j})}}S.addRef(O,E,h!==q)}if(null!==E&&void 0!==E)if(E.$changes&&E.$changes.setParent(y.ref,y.root,Y),c instanceof a)c[C]=E;else if(c instanceof B)Q=b,c.$items.set(Q,E),c.$changes.allChanges.add(Y);else if(c instanceof u)c.setAt(Y,E);else if(c instanceof ql){var f=c.add(E);c.setIndex(Y,f)}else c instanceof bl&&!1!==(f=c.add(E))&&c.setIndex(Y,f);q!==E&&w.push({refId:J,op:W,field:C,dynamicIndex:b,value:E,previousValue:q})}else{console.warn("@colyseus/schema: definition mismatch");for(var p={offset:U.offset};U.offset<T&&(!Al(N,U)||(p.offset=U.offset+1,!S.refs.has(Yl(N,p))));)U.offset++}}else c.clear(w)}else{J=Yl(N,U);var R=S.refs.get(J);if(!R)throw new Error('"refId" not found: '.concat(J));c=R}}return this._triggerChanges(w),S.garbageCollectDeletedRefs(),w},a.prototype.encode=function(N,U,c){void 0===N&&(N=!1),void 0===U&&(U=[]),void 0===c&&(c=!1);for(var K=this.$changes,w=new WeakSet,S=[K],T=1,J=0;J<T;J++){var n=S[J],y=n.ref,H=y instanceof a;n.ensureRefId(),w.add(n),n!==K&&(n.changed||N)&&(j(U,Z),V(U,n.refId));for(var u=N?Array.from(n.allChanges):Array.from(n.changes.values()),W=0,Y=u.length;W<Y;W++){var C=N?{op:l.OPERATION.ADD,index:u[W]}:u[W],A=C.index,E=H?y._definition.fieldsByIndex&&y._definition.fieldsByIndex[A]:A,q=U.length;if(C.op!==l.OPERATION.TOUCH)if(H)j(U,A|C.op);else{if(j(U,C.op),C.op===l.OPERATION.CLEAR)continue;V(U,A)}if(H||(C.op&l.OPERATION.ADD)!=l.OPERATION.ADD||y instanceof B&&x(U,n.ref.$indexes.get(A)),C.op!==l.OPERATION.DELETE){var b=n.getType(A),z=n.getValue(A);if(z&&z.$changes&&!w.has(z.$changes)&&(S.push(z.$changes),z.$changes.ensureRefId(),T++),C.op!==l.OPERATION.TOUCH){if(a.is(b))hl(z,b,y,E),V(U,z.$changes.refId),(C.op&l.OPERATION.ADD)===l.OPERATION.ADD&&this.tryEncodeTypeId(U,b,z.constructor);else if("string"===typeof b)il(b,U,z,y,E);else{var I=M(Object.keys(b)[0]);hl(y["_".concat(E)],I.constructor,y,E),V(U,z.$changes.refId)}c&&n.cache(A,U.slice(q))}}}N||c||n.discard()}return U},a.prototype.encodeAll=function(l){return this.encode(!0,[],l)},a.prototype.applyFilters=function(N,U){var c,K;void 0===U&&(U=!1);for(var w=this,S=new Set,T=zl.get(N),J=[this.$changes],n=1,y=[],H=function(H){var u=J[H];if(S.has(u.refId))return"continue";var W=u.ref,Y=W instanceof a;j(y,Z),V(y,u.refId);var C=T.refIds.has(u),M=U||!C;T.addRefId(u);var A=T.containerIndexes.get(u),E=M?Array.from(u.allChanges):Array.from(u.changes.values());!U&&Y&&W._definition.indexesWithFilters&&W._definition.indexesWithFilters.forEach((function(a){!A.has(a)&&u.allChanges.has(a)&&(M?E.push(a):E.push({op:l.OPERATION.ADD,index:a}))}));for(var q=0,b=E.length;q<b;q++){var z=M?{op:l.OPERATION.ADD,index:E[q]}:E[q];if(z.op!==l.OPERATION.CLEAR){var I=z.index;if(z.op!==l.OPERATION.DELETE){var t=u.getValue(I),O=u.getType(I);if(Y){if((h=W._definition.filters&&W._definition.filters[I])&&!h.call(W,N,t,w)){t&&t.$changes&&S.add(t.$changes.refId);continue}}else{var h,i=u.parent;if((h=u.getChildrenFilter())&&!h.call(i,N,W.$indexes.get(I),t,w)){t&&t.$changes&&S.add(t.$changes.refId);continue}}if(t.$changes&&(J.push(t.$changes),n++),z.op!==l.OPERATION.TOUCH)if(z.op===l.OPERATION.ADD||Y)y.push.apply(y,null!==(c=u.caches[I])&&void 0!==c?c:[]),A.add(I);else if(A.has(I))y.push.apply(y,null!==(K=u.caches[I])&&void 0!==K?K:[]);else{if(A.add(I),j(y,l.OPERATION.ADD),V(y,I),W instanceof B){var k=u.ref.$indexes.get(I);x(y,k)}t.$changes?V(y,t.$changes.refId):D[O](y,t)}else t.$changes&&!Y&&(j(y,l.OPERATION.ADD),V(y,I),W instanceof B&&(k=u.ref.$indexes.get(I),x(y,k)),V(y,t.$changes.refId))}else Y?j(y,z.op|I):(j(y,z.op),V(y,I))}else j(y,z.op)}},u=0;u<n;u++)H(u);return y},a.prototype.clone=function(){var l,a=new this.constructor,N=this._definition.schema;for(var U in N)"object"===typeof this[U]&&"function"===typeof(null===(l=this[U])||void 0===l?void 0:l.clone)?a[U]=this[U].clone():a[U]=this[U];return a},a.prototype.toJSON=function(){var l=this._definition.schema,a=this._definition.deprecated,N={};for(var U in l)a[U]||null===this[U]||"undefined"===typeof this[U]||(N[U]="function"===typeof this[U].toJSON?this[U].toJSON():this["_".concat(U)]);return N},a.prototype.discardAllChanges=function(){this.$changes.discardAll()},a.prototype.getByIndex=function(l){return this[this._definition.fieldsByIndex[l]]},a.prototype.deleteByIndex=function(l){this[this._definition.fieldsByIndex[l]]=void 0},a.prototype.tryEncodeTypeId=function(l,a,N){a._typeid!==N._typeid&&(j(l,w),V(l,N._typeid))},a.prototype.getSchemaType=function(l,a,N){var U;return l[a.offset]===w&&(a.offset++,U=this.constructor._context.get(Yl(l,a))),U||N},a.prototype.createTypeInstance=function(l){var a=new l;return a.$changes.root=this.$changes.root,a},a.prototype._triggerChanges=function(N){for(var U,c,K,Z,w,S,T,J,n,y=new Set,H=this.$changes.root.refs,u=function(u){var W=N[u],B=W.refId,Y=H.get(B),C=Y.$callbacks;if((W.op&l.OPERATION.DELETE)===l.OPERATION.DELETE&&W.previousValue instanceof a&&(null===(c=null===(U=W.previousValue.$callbacks)||void 0===U?void 0:U[l.OPERATION.DELETE])||void 0===c||c.forEach((function(l){return l()}))),!C)return"continue";if(Y instanceof a){if(!y.has(B))try{null===(K=null===C||void 0===C?void 0:C[l.OPERATION.REPLACE])||void 0===K||K.forEach((function(l){return l()}))}catch(M){a.onError(M)}try{C.hasOwnProperty(W.field)&&(null===(Z=C[W.field])||void 0===Z||Z.forEach((function(l){return l(W.value,W.previousValue)})))}catch(M){a.onError(M)}}else W.op===l.OPERATION.ADD&&void 0===W.previousValue?null===(w=C[l.OPERATION.ADD])||void 0===w||w.forEach((function(l){var a;return l(W.value,null!==(a=W.dynamicIndex)&&void 0!==a?a:W.field)})):W.op===l.OPERATION.DELETE?void 0!==W.previousValue&&(null===(S=C[l.OPERATION.DELETE])||void 0===S||S.forEach((function(l){var a;return l(W.previousValue,null!==(a=W.dynamicIndex)&&void 0!==a?a:W.field)}))):W.op===l.OPERATION.DELETE_AND_ADD&&(void 0!==W.previousValue&&(null===(T=C[l.OPERATION.DELETE])||void 0===T||T.forEach((function(l){var a;return l(W.previousValue,null!==(a=W.dynamicIndex)&&void 0!==a?a:W.field)}))),null===(J=C[l.OPERATION.ADD])||void 0===J||J.forEach((function(l){var a;return l(W.value,null!==(a=W.dynamicIndex)&&void 0!==a?a:W.field)}))),W.value!==W.previousValue&&(null===(n=C[l.OPERATION.REPLACE])||void 0===n||n.forEach((function(l){var a;return l(W.value,null!==(a=W.dynamicIndex)&&void 0!==a?a:W.field)})));y.add(B)},W=0;W<N.length;W++)u(W)},a._definition=A.create(),a}();function jl(l){for(var a=[l.$changes],N=1,U={},c=U,K=function(l){var N=a[l];N.changes.forEach((function(l){var a=N.ref,U=l.index,K=a._definition?a._definition.fieldsByIndex[U]:a.$indexes.get(U);c[K]=N.getValue(U)}))},Z=0;Z<N;Z++)K(Z);return U}var fl={context:new q},pl=function(l){function a(){return null!==l&&l.apply(this,arguments)||this}return N(a,l),U([z("string",fl)],a.prototype,"name",void 0),U([z("string",fl)],a.prototype,"type",void 0),U([z("number",fl)],a.prototype,"referencedType",void 0),a}(Ql),Rl=function(l){function a(){var a=null!==l&&l.apply(this,arguments)||this;return a.fields=new u,a}return N(a,l),U([z("number",fl)],a.prototype,"id",void 0),U([z([pl],fl)],a.prototype,"fields",void 0),a}(Ql),Ll=function(l){function a(){var a=null!==l&&l.apply(this,arguments)||this;return a.types=new u,a}return N(a,l),a.encode=function(l){var N=l.constructor,U=new a;U.rootType=N._typeid;var c=function(l,a){for(var N in a){var c=new pl;c.name=N;var K=void 0;if("string"===typeof a[N])K=a[N];else{var Z=a[N],w=void 0;Ql.is(Z)?(K="ref",w=a[N]):"string"===typeof Z[K=Object.keys(Z)[0]]?K+=":"+Z[K]:w=Z[K],c.referencedType=w?w._typeid:-1}c.type=K,l.fields.push(c)}U.types.push(l)},K=N._context.types;for(var Z in K){var w=new Rl;w.id=Number(Z),c(w,K[Z]._definition.schema)}return U.encodeAll()},a.decode=function(l,U){var c=new q,K=new a;K.decode(l,U);var Z=K.types.reduce((function(l,a){var U=function(l){function a(){return null!==l&&l.apply(this,arguments)||this}return N(a,l),a}(Ql),K=a.id;return l[K]=U,c.add(U,K),l}),{});K.types.forEach((function(l){var a=Z[l.id];l.fields.forEach((function(l){var N;if(void 0!==l.referencedType){var U=l.type,K=Z[l.referencedType];if(!K){var w=l.type.split(":");U=w[0],K=w[1]}"ref"===U?z(K,{context:c})(a.prototype,l.name):z(((N={})[U]=K,N),{context:c})(a.prototype,l.name)}else z(l.type,{context:c})(a.prototype,l.name)}))}));var w=Z[K.rootType],S=new w;for(var T in w._definition.schema){var J=w._definition.schema[T];"string"!==typeof J&&(S[T]="function"===typeof J?new J:new(M(Object.keys(J)[0]).constructor))}return S},U([z([Rl],fl)],a.prototype,"types",void 0),U([z("number",fl)],a.prototype,"rootType",void 0),a}(Ql);C("map",{constructor:B}),C("array",{constructor:u}),C("set",{constructor:bl}),C("collection",{constructor:ql}),l.ArraySchema=u,l.CollectionSchema=ql,l.Context=q,l.MapSchema=B,l.Reflection=Ll,l.ReflectionField=pl,l.ReflectionType=Rl,l.Schema=Ql,l.SchemaDefinition=A,l.SetSchema=bl,l.decode=El,l.defineTypes=h,l.deprecated=O,l.dumpChanges=jl,l.encode=D,l.filter=I,l.filterChildren=t,l.hasFilter=E,l.registerType=C,l.type=z,Object.defineProperty(l,"__esModule",{value:!0})}(a)},14558:l=>{"use strict";l.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14554:(l,a,N)=>{var U=N(14558),c=N(14563),K=Object.hasOwnProperty,Z=Object.create(null);for(var w in U)K.call(U,w)&&(Z[U[w]]=w);var S=l.exports={to:{},get:{}};function T(l,a,N){return Math.min(Math.max(a,l),N)}function J(l){var a=Math.round(l).toString(16).toUpperCase();return a.length<2?"0"+a:a}S.get=function(l){var a,N;switch(l.substring(0,3).toLowerCase()){case"hsl":a=S.get.hsl(l),N="hsl";break;case"hwb":a=S.get.hwb(l),N="hwb";break;default:a=S.get.rgb(l),N="rgb"}return a?{model:N,value:a}:null},S.get.rgb=function(l){if(!l)return null;var a,N,c,Z=[0,0,0,1];if(a=l.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(c=a[2],a=a[1],N=0;N<3;N++){var w=2*N;Z[N]=parseInt(a.slice(w,w+2),16)}c&&(Z[3]=parseInt(c,16)/255)}else if(a=l.match(/^#([a-f0-9]{3,4})$/i)){for(c=(a=a[1])[3],N=0;N<3;N++)Z[N]=parseInt(a[N]+a[N],16);c&&(Z[3]=parseInt(c+c,16)/255)}else if(a=l.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(N=0;N<3;N++)Z[N]=parseInt(a[N+1],0);a[4]&&(a[5]?Z[3]=.01*parseFloat(a[4]):Z[3]=parseFloat(a[4]))}else{if(!(a=l.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(a=l.match(/^(\w+)$/))?"transparent"===a[1]?[0,0,0,0]:K.call(U,a[1])?((Z=U[a[1]])[3]=1,Z):null:null;for(N=0;N<3;N++)Z[N]=Math.round(2.55*parseFloat(a[N+1]));a[4]&&(a[5]?Z[3]=.01*parseFloat(a[4]):Z[3]=parseFloat(a[4]))}for(N=0;N<3;N++)Z[N]=T(Z[N],0,255);return Z[3]=T(Z[3],0,1),Z},S.get.hsl=function(l){if(!l)return null;var a=l.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(a){var N=parseFloat(a[4]);return[(parseFloat(a[1])%360+360)%360,T(parseFloat(a[2]),0,100),T(parseFloat(a[3]),0,100),T(isNaN(N)?1:N,0,1)]}return null},S.get.hwb=function(l){if(!l)return null;var a=l.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(a){var N=parseFloat(a[4]);return[(parseFloat(a[1])%360+360)%360,T(parseFloat(a[2]),0,100),T(parseFloat(a[3]),0,100),T(isNaN(N)?1:N,0,1)]}return null},S.to.hex=function(){var l=c(arguments);return"#"+J(l[0])+J(l[1])+J(l[2])+(l[3]<1?J(Math.round(255*l[3])):"")},S.to.rgb=function(){var l=c(arguments);return l.length<4||1===l[3]?"rgb("+Math.round(l[0])+", "+Math.round(l[1])+", "+Math.round(l[2])+")":"rgba("+Math.round(l[0])+", "+Math.round(l[1])+", "+Math.round(l[2])+", "+l[3]+")"},S.to.rgb.percent=function(){var l=c(arguments),a=Math.round(l[0]/255*100),N=Math.round(l[1]/255*100),U=Math.round(l[2]/255*100);return l.length<4||1===l[3]?"rgb("+a+"%, "+N+"%, "+U+"%)":"rgba("+a+"%, "+N+"%, "+U+"%, "+l[3]+")"},S.to.hsl=function(){var l=c(arguments);return l.length<4||1===l[3]?"hsl("+l[0]+", "+l[1]+"%, "+l[2]+"%)":"hsla("+l[0]+", "+l[1]+"%, "+l[2]+"%, "+l[3]+")"},S.to.hwb=function(){var l=c(arguments),a="";return l.length>=4&&1!==l[3]&&(a=", "+l[3]),"hwb("+l[0]+", "+l[1]+"%, "+l[2]+"%"+a+")"},S.to.keyword=function(l){return Z[l.slice(0,3)]}},14552:(l,a,N)=>{const U=N(14554),c=N(14577),K=["keyword","gray","hex"],Z={};for(const H of Object.keys(c))Z[[...c[H].labels].sort().join("")]=H;const w={};function S(l,a){if(!(this instanceof S))return new S(l,a);if(a&&a in K&&(a=null),a&&!(a in c))throw new Error("Unknown model: "+a);let N,T;if(null==l)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(l instanceof S)this.model=l.model,this.color=[...l.color],this.valpha=l.valpha;else if("string"===typeof l){const a=U.get(l);if(null===a)throw new Error("Unable to parse color from string: "+l);this.model=a.model,T=c[this.model].channels,this.color=a.value.slice(0,T),this.valpha="number"===typeof a.value[T]?a.value[T]:1}else if(l.length>0){this.model=a||"rgb",T=c[this.model].channels;const N=Array.prototype.slice.call(l,0,T);this.color=y(N,T),this.valpha="number"===typeof l[T]?l[T]:1}else if("number"===typeof l)this.model="rgb",this.color=[l>>16&255,l>>8&255,255&l],this.valpha=1;else{this.valpha=1;const a=Object.keys(l);"alpha"in l&&(a.splice(a.indexOf("alpha"),1),this.valpha="number"===typeof l.alpha?l.alpha:0);const U=a.sort().join("");if(!(U in Z))throw new Error("Unable to parse color from object: "+JSON.stringify(l));this.model=Z[U];const{labels:K}=c[this.model],w=[];for(N=0;N<K.length;N++)w.push(l[K[N]]);this.color=y(w)}if(w[this.model])for(T=c[this.model].channels,N=0;N<T;N++){const l=w[this.model][N];l&&(this.color[N]=l(this.color[N]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}S.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(l){let a=this.model in U.to?this:this.rgb();a=a.round("number"===typeof l?l:1);const N=1===a.valpha?a.color:[...a.color,this.valpha];return U.to[a.model](N)},percentString(l){const a=this.rgb().round("number"===typeof l?l:1),N=1===a.valpha?a.color:[...a.color,this.valpha];return U.to.rgb.percent(N)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const l={},{channels:a}=c[this.model],{labels:N}=c[this.model];for(let U=0;U<a;U++)l[N[U]]=this.color[U];return 1!==this.valpha&&(l.alpha=this.valpha),l},unitArray(){const l=this.rgb().color;return l[0]/=255,l[1]/=255,l[2]/=255,1!==this.valpha&&l.push(this.valpha),l},unitObject(){const l=this.rgb().object();return l.r/=255,l.g/=255,l.b/=255,1!==this.valpha&&(l.alpha=this.valpha),l},round(l){return l=Math.max(l||0,0),new S([...this.color.map(T(l)),this.valpha],this.model)},alpha(l){return void 0!==l?new S([...this.color,Math.max(0,Math.min(1,l))],this.model):this.valpha},red:J("rgb",0,n(255)),green:J("rgb",1,n(255)),blue:J("rgb",2,n(255)),hue:J(["hsl","hsv","hsl","hwb","hcg"],0,(l=>(l%360+360)%360)),saturationl:J("hsl",1,n(100)),lightness:J("hsl",2,n(100)),saturationv:J("hsv",1,n(100)),value:J("hsv",2,n(100)),chroma:J("hcg",1,n(100)),gray:J("hcg",2,n(100)),white:J("hwb",1,n(100)),wblack:J("hwb",2,n(100)),cyan:J("cmyk",0,n(100)),magenta:J("cmyk",1,n(100)),yellow:J("cmyk",2,n(100)),black:J("cmyk",3,n(100)),x:J("xyz",0,n(95.047)),y:J("xyz",1,n(100)),z:J("xyz",2,n(108.833)),l:J("lab",0,n(100)),a:J("lab",1),b:J("lab",2),keyword(l){return void 0!==l?new S(l):c[this.model].keyword(this.color)},hex(l){return void 0!==l?new S(l):U.to.hex(this.rgb().round().color)},hexa(l){if(void 0!==l)return new S(l);const a=this.rgb().round().color;let N=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===N.length&&(N="0"+N),U.to.hex(a)+N},rgbNumber(){const l=this.rgb().color;return(255&l[0])<<16|(255&l[1])<<8|255&l[2]},luminosity(){const l=this.rgb().color,a=[];for(const[N,U]of l.entries()){const l=U/255;a[N]=l<=.04045?l/12.92:((l+.055)/1.055)**2.4}return.2126*a[0]+.7152*a[1]+.0722*a[2]},contrast(l){const a=this.luminosity(),N=l.luminosity();return a>N?(a+.05)/(N+.05):(N+.05)/(a+.05)},level(l){const a=this.contrast(l);return a>=7?"AAA":a>=4.5?"AA":""},isDark(){const l=this.rgb().color;return(2126*l[0]+7152*l[1]+722*l[2])/1e4<128},isLight(){return!this.isDark()},negate(){const l=this.rgb();for(let a=0;a<3;a++)l.color[a]=255-l.color[a];return l},lighten(l){const a=this.hsl();return a.color[2]+=a.color[2]*l,a},darken(l){const a=this.hsl();return a.color[2]-=a.color[2]*l,a},saturate(l){const a=this.hsl();return a.color[1]+=a.color[1]*l,a},desaturate(l){const a=this.hsl();return a.color[1]-=a.color[1]*l,a},whiten(l){const a=this.hwb();return a.color[1]+=a.color[1]*l,a},blacken(l){const a=this.hwb();return a.color[2]+=a.color[2]*l,a},grayscale(){const l=this.rgb().color,a=.3*l[0]+.59*l[1]+.11*l[2];return S.rgb(a,a,a)},fade(l){return this.alpha(this.valpha-this.valpha*l)},opaquer(l){return this.alpha(this.valpha+this.valpha*l)},rotate(l){const a=this.hsl();let N=a.color[0];return N=(N+l)%360,N=N<0?360+N:N,a.color[0]=N,a},mix(l,a){if(!l||!l.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof l);const N=l.rgb(),U=this.rgb(),c=void 0===a?.5:a,K=2*c-1,Z=N.alpha()-U.alpha(),w=((K*Z===-1?K:(K+Z)/(1+K*Z))+1)/2,T=1-w;return S.rgb(w*N.red()+T*U.red(),w*N.green()+T*U.green(),w*N.blue()+T*U.blue(),N.alpha()*c+U.alpha()*(1-c))}};for(const H of Object.keys(c)){if(K.includes(H))continue;const{channels:l}=c[H];S.prototype[H]=function(){if(this.model===H)return new S(this);for(var l=arguments.length,a=new Array(l),N=0;N<l;N++)a[N]=arguments[N];return a.length>0?new S(a,H):new S([...(U=c[this.model][H].raw(this.color),Array.isArray(U)?U:[U]),this.valpha],H);var U},S[H]=function(){for(var a=arguments.length,N=new Array(a),U=0;U<a;U++)N[U]=arguments[U];let c=N[0];return"number"===typeof c&&(c=y(N,l)),new S(c,H)}}function T(l){return function(a){return function(l,a){return Number(l.toFixed(a))}(a,l)}}function J(l,a,N){l=Array.isArray(l)?l:[l];for(const U of l)(w[U]||(w[U]=[]))[a]=N;return l=l[0],function(U){let c;return void 0!==U?(N&&(U=N(U)),c=this[l](),c.color[a]=U,c):(c=this[l]().color[a],N&&(c=N(c)),c)}}function n(l){return function(a){return Math.max(0,Math.min(l,a))}}function y(l,a){for(let N=0;N<a;N++)"number"!==typeof l[N]&&(l[N]=0);return l}l.exports=S},14579:(l,a,N)=>{const U=N(14584),c={};for(const Z of Object.keys(U))c[U[Z]]=Z;const K={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};l.exports=K;for(const Z of Object.keys(K)){if(!("channels"in K[Z]))throw new Error("missing channels property: "+Z);if(!("labels"in K[Z]))throw new Error("missing channel labels property: "+Z);if(K[Z].labels.length!==K[Z].channels)throw new Error("channel and label counts mismatch: "+Z);const{channels:l,labels:a}=K[Z];delete K[Z].channels,delete K[Z].labels,Object.defineProperty(K[Z],"channels",{value:l}),Object.defineProperty(K[Z],"labels",{value:a})}K.rgb.hsl=function(l){const a=l[0]/255,N=l[1]/255,U=l[2]/255,c=Math.min(a,N,U),K=Math.max(a,N,U),Z=K-c;let w,S;K===c?w=0:a===K?w=(N-U)/Z:N===K?w=2+(U-a)/Z:U===K&&(w=4+(a-N)/Z),w=Math.min(60*w,360),w<0&&(w+=360);const T=(c+K)/2;return S=K===c?0:T<=.5?Z/(K+c):Z/(2-K-c),[w,100*S,100*T]},K.rgb.hsv=function(l){let a,N,U,c,K;const Z=l[0]/255,w=l[1]/255,S=l[2]/255,T=Math.max(Z,w,S),J=T-Math.min(Z,w,S),n=function(l){return(T-l)/6/J+.5};return 0===J?(c=0,K=0):(K=J/T,a=n(Z),N=n(w),U=n(S),Z===T?c=U-N:w===T?c=1/3+a-U:S===T&&(c=2/3+N-a),c<0?c+=1:c>1&&(c-=1)),[360*c,100*K,100*T]},K.rgb.hwb=function(l){const a=l[0],N=l[1];let U=l[2];const c=K.rgb.hsl(l)[0],Z=1/255*Math.min(a,Math.min(N,U));return U=1-1/255*Math.max(a,Math.max(N,U)),[c,100*Z,100*U]},K.rgb.cmyk=function(l){const a=l[0]/255,N=l[1]/255,U=l[2]/255,c=Math.min(1-a,1-N,1-U);return[100*((1-a-c)/(1-c)||0),100*((1-N-c)/(1-c)||0),100*((1-U-c)/(1-c)||0),100*c]},K.rgb.keyword=function(l){const a=c[l];if(a)return a;let N,K=1/0;for(const c of Object.keys(U)){const a=U[c],S=(w=a,((Z=l)[0]-w[0])**2+(Z[1]-w[1])**2+(Z[2]-w[2])**2);S<K&&(K=S,N=c)}var Z,w;return N},K.keyword.rgb=function(l){return U[l]},K.rgb.xyz=function(l){let a=l[0]/255,N=l[1]/255,U=l[2]/255;a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,N=N>.04045?((N+.055)/1.055)**2.4:N/12.92,U=U>.04045?((U+.055)/1.055)**2.4:U/12.92;return[100*(.4124*a+.3576*N+.1805*U),100*(.2126*a+.7152*N+.0722*U),100*(.0193*a+.1192*N+.9505*U)]},K.rgb.lab=function(l){const a=K.rgb.xyz(l);let N=a[0],U=a[1],c=a[2];N/=95.047,U/=100,c/=108.883,N=N>.008856?N**(1/3):7.787*N+16/116,U=U>.008856?U**(1/3):7.787*U+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;return[116*U-16,500*(N-U),200*(U-c)]},K.hsl.rgb=function(l){const a=l[0]/360,N=l[1]/100,U=l[2]/100;let c,K,Z;if(0===N)return Z=255*U,[Z,Z,Z];c=U<.5?U*(1+N):U+N-U*N;const w=2*U-c,S=[0,0,0];for(let T=0;T<3;T++)K=a+1/3*-(T-1),K<0&&K++,K>1&&K--,Z=6*K<1?w+6*(c-w)*K:2*K<1?c:3*K<2?w+(c-w)*(2/3-K)*6:w,S[T]=255*Z;return S},K.hsl.hsv=function(l){const a=l[0];let N=l[1]/100,U=l[2]/100,c=N;const K=Math.max(U,.01);U*=2,N*=U<=1?U:2-U,c*=K<=1?K:2-K;return[a,100*(0===U?2*c/(K+c):2*N/(U+N)),100*((U+N)/2)]},K.hsv.rgb=function(l){const a=l[0]/60,N=l[1]/100;let U=l[2]/100;const c=Math.floor(a)%6,K=a-Math.floor(a),Z=255*U*(1-N),w=255*U*(1-N*K),S=255*U*(1-N*(1-K));switch(U*=255,c){case 0:return[U,S,Z];case 1:return[w,U,Z];case 2:return[Z,U,S];case 3:return[Z,w,U];case 4:return[S,Z,U];case 5:return[U,Z,w]}},K.hsv.hsl=function(l){const a=l[0],N=l[1]/100,U=l[2]/100,c=Math.max(U,.01);let K,Z;Z=(2-N)*U;const w=(2-N)*c;return K=N*c,K/=w<=1?w:2-w,K=K||0,Z/=2,[a,100*K,100*Z]},K.hwb.rgb=function(l){const a=l[0]/360;let N=l[1]/100,U=l[2]/100;const c=N+U;let K;c>1&&(N/=c,U/=c);const Z=Math.floor(6*a),w=1-U;K=6*a-Z,0!==(1&Z)&&(K=1-K);const S=N+K*(w-N);let T,J,n;switch(Z){default:case 6:case 0:T=w,J=S,n=N;break;case 1:T=S,J=w,n=N;break;case 2:T=N,J=w,n=S;break;case 3:T=N,J=S,n=w;break;case 4:T=S,J=N,n=w;break;case 5:T=w,J=N,n=S}return[255*T,255*J,255*n]},K.cmyk.rgb=function(l){const a=l[0]/100,N=l[1]/100,U=l[2]/100,c=l[3]/100;return[255*(1-Math.min(1,a*(1-c)+c)),255*(1-Math.min(1,N*(1-c)+c)),255*(1-Math.min(1,U*(1-c)+c))]},K.xyz.rgb=function(l){const a=l[0]/100,N=l[1]/100,U=l[2]/100;let c,K,Z;return c=3.2406*a+-1.5372*N+-.4986*U,K=-.9689*a+1.8758*N+.0415*U,Z=.0557*a+-.204*N+1.057*U,c=c>.0031308?1.055*c**(1/2.4)-.055:12.92*c,K=K>.0031308?1.055*K**(1/2.4)-.055:12.92*K,Z=Z>.0031308?1.055*Z**(1/2.4)-.055:12.92*Z,c=Math.min(Math.max(0,c),1),K=Math.min(Math.max(0,K),1),Z=Math.min(Math.max(0,Z),1),[255*c,255*K,255*Z]},K.xyz.lab=function(l){let a=l[0],N=l[1],U=l[2];a/=95.047,N/=100,U/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,N=N>.008856?N**(1/3):7.787*N+16/116,U=U>.008856?U**(1/3):7.787*U+16/116;return[116*N-16,500*(a-N),200*(N-U)]},K.lab.xyz=function(l){let a,N,U;N=(l[0]+16)/116,a=l[1]/500+N,U=N-l[2]/200;const c=N**3,K=a**3,Z=U**3;return N=c>.008856?c:(N-16/116)/7.787,a=K>.008856?K:(a-16/116)/7.787,U=Z>.008856?Z:(U-16/116)/7.787,a*=95.047,N*=100,U*=108.883,[a,N,U]},K.lab.lch=function(l){const a=l[0],N=l[1],U=l[2];let c;c=360*Math.atan2(U,N)/2/Math.PI,c<0&&(c+=360);return[a,Math.sqrt(N*N+U*U),c]},K.lch.lab=function(l){const a=l[0],N=l[1],U=l[2]/360*2*Math.PI;return[a,N*Math.cos(U),N*Math.sin(U)]},K.rgb.ansi16=function(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[N,U,c]=l;let Z=null===a?K.rgb.hsv(l)[2]:a;if(Z=Math.round(Z/50),0===Z)return 30;let w=30+(Math.round(c/255)<<2|Math.round(U/255)<<1|Math.round(N/255));return 2===Z&&(w+=60),w},K.hsv.ansi16=function(l){return K.rgb.ansi16(K.hsv.rgb(l),l[2])},K.rgb.ansi256=function(l){const a=l[0],N=l[1],U=l[2];if(a===N&&N===U)return a<8?16:a>248?231:Math.round((a-8)/247*24)+232;return 16+36*Math.round(a/255*5)+6*Math.round(N/255*5)+Math.round(U/255*5)},K.ansi16.rgb=function(l){let a=l%10;if(0===a||7===a)return l>50&&(a+=3.5),a=a/10.5*255,[a,a,a];const N=.5*(1+~~(l>50));return[(1&a)*N*255,(a>>1&1)*N*255,(a>>2&1)*N*255]},K.ansi256.rgb=function(l){if(l>=232){const a=10*(l-232)+8;return[a,a,a]}let a;l-=16;return[Math.floor(l/36)/5*255,Math.floor((a=l%36)/6)/5*255,a%6/5*255]},K.rgb.hex=function(l){const a=(((255&Math.round(l[0]))<<16)+((255&Math.round(l[1]))<<8)+(255&Math.round(l[2]))).toString(16).toUpperCase();return"000000".substring(a.length)+a},K.hex.rgb=function(l){const a=l.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];let N=a[0];3===a[0].length&&(N=N.split("").map((l=>l+l)).join(""));const U=parseInt(N,16);return[U>>16&255,U>>8&255,255&U]},K.rgb.hcg=function(l){const a=l[0]/255,N=l[1]/255,U=l[2]/255,c=Math.max(Math.max(a,N),U),K=Math.min(Math.min(a,N),U),Z=c-K;let w,S;return w=Z<1?K/(1-Z):0,S=Z<=0?0:c===a?(N-U)/Z%6:c===N?2+(U-a)/Z:4+(a-N)/Z,S/=6,S%=1,[360*S,100*Z,100*w]},K.hsl.hcg=function(l){const a=l[1]/100,N=l[2]/100,U=N<.5?2*a*N:2*a*(1-N);let c=0;return U<1&&(c=(N-.5*U)/(1-U)),[l[0],100*U,100*c]},K.hsv.hcg=function(l){const a=l[1]/100,N=l[2]/100,U=a*N;let c=0;return U<1&&(c=(N-U)/(1-U)),[l[0],100*U,100*c]},K.hcg.rgb=function(l){const a=l[0]/360,N=l[1]/100,U=l[2]/100;if(0===N)return[255*U,255*U,255*U];const c=[0,0,0],K=a%1*6,Z=K%1,w=1-Z;let S=0;switch(Math.floor(K)){case 0:c[0]=1,c[1]=Z,c[2]=0;break;case 1:c[0]=w,c[1]=1,c[2]=0;break;case 2:c[0]=0,c[1]=1,c[2]=Z;break;case 3:c[0]=0,c[1]=w,c[2]=1;break;case 4:c[0]=Z,c[1]=0,c[2]=1;break;default:c[0]=1,c[1]=0,c[2]=w}return S=(1-N)*U,[255*(N*c[0]+S),255*(N*c[1]+S),255*(N*c[2]+S)]},K.hcg.hsv=function(l){const a=l[1]/100,N=a+l[2]/100*(1-a);let U=0;return N>0&&(U=a/N),[l[0],100*U,100*N]},K.hcg.hsl=function(l){const a=l[1]/100,N=l[2]/100*(1-a)+.5*a;let U=0;return N>0&&N<.5?U=a/(2*N):N>=.5&&N<1&&(U=a/(2*(1-N))),[l[0],100*U,100*N]},K.hcg.hwb=function(l){const a=l[1]/100,N=a+l[2]/100*(1-a);return[l[0],100*(N-a),100*(1-N)]},K.hwb.hcg=function(l){const a=l[1]/100,N=1-l[2]/100,U=N-a;let c=0;return U<1&&(c=(N-U)/(1-U)),[l[0],100*U,100*c]},K.apple.rgb=function(l){return[l[0]/65535*255,l[1]/65535*255,l[2]/65535*255]},K.rgb.apple=function(l){return[l[0]/255*65535,l[1]/255*65535,l[2]/255*65535]},K.gray.rgb=function(l){return[l[0]/100*255,l[0]/100*255,l[0]/100*255]},K.gray.hsl=function(l){return[0,0,l[0]]},K.gray.hsv=K.gray.hsl,K.gray.hwb=function(l){return[0,100,l[0]]},K.gray.cmyk=function(l){return[0,0,0,l[0]]},K.gray.lab=function(l){return[l[0],0,0]},K.gray.hex=function(l){const a=255&Math.round(l[0]/100*255),N=((a<<16)+(a<<8)+a).toString(16).toUpperCase();return"000000".substring(N.length)+N},K.rgb.gray=function(l){return[(l[0]+l[1]+l[2])/3/255*100]}},14577:(l,a,N)=>{const U=N(14579),c=N(14590),K={};Object.keys(U).forEach((l=>{K[l]={},Object.defineProperty(K[l],"channels",{value:U[l].channels}),Object.defineProperty(K[l],"labels",{value:U[l].labels});const a=c(l);Object.keys(a).forEach((N=>{const U=a[N];K[l][N]=function(l){const a=function(){for(var a=arguments.length,N=new Array(a),U=0;U<a;U++)N[U]=arguments[U];const c=N[0];if(void 0===c||null===c)return c;c.length>1&&(N=c);const K=l(N);if("object"===typeof K)for(let l=K.length,Z=0;Z<l;Z++)K[Z]=Math.round(K[Z]);return K};return"conversion"in l&&(a.conversion=l.conversion),a}(U),K[l][N].raw=function(l){const a=function(){for(var a=arguments.length,N=new Array(a),U=0;U<a;U++)N[U]=arguments[U];const c=N[0];return void 0===c||null===c?c:(c.length>1&&(N=c),l(N))};return"conversion"in l&&(a.conversion=l.conversion),a}(U)}))})),l.exports=K},14590:(l,a,N)=>{const U=N(14579);function c(l){const a=function(){const l={},a=Object.keys(U);for(let N=a.length,U=0;U<N;U++)l[a[U]]={distance:-1,parent:null};return l}(),N=[l];for(a[l].distance=0;N.length;){const l=N.pop(),c=Object.keys(U[l]);for(let U=c.length,K=0;K<U;K++){const U=c[K],Z=a[U];-1===Z.distance&&(Z.distance=a[l].distance+1,Z.parent=l,N.unshift(U))}}return a}function K(l,a){return function(N){return a(l(N))}}function Z(l,a){const N=[a[l].parent,l];let c=U[a[l].parent][l],Z=a[l].parent;for(;a[Z].parent;)N.unshift(a[Z].parent),c=K(U[a[Z].parent][Z],c),Z=a[Z].parent;return c.conversion=N,c}l.exports=function(l){const a=c(l),N={},U=Object.keys(a);for(let c=U.length,K=0;K<c;K++){const l=U[K];null!==a[l].parent&&(N[l]=Z(l,a))}return N}},14584:l=>{"use strict";l.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13117:(l,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.discordURLBuilder=void 0,a.discordURLBuilder=function(l){var a;const N=(null===(a=null===window||void 0===window?void 0:window.location)||void 0===a?void 0:a.hostname)||"localhost",U=l.hostname.split("."),c=!l.hostname.includes("trycloudflare.com")&&!l.hostname.includes("discordsays.com")&&U.length>2?`/${U[0]}`:"";return l.pathname.startsWith("/.proxy")?`${l.protocol}//${N}${c}${l.pathname}${l.search}`:`${l.protocol}//${N}/.proxy/colyseus${c}${l.pathname}${l.search}`}},13102:function(l,a,N){"use strict";var U,c,K,Z,w=this&&this.__awaiter||function(l,a,N,U){return new(N||(N=Promise))((function(c,K){function Z(l){try{S(U.next(l))}catch(a){K(a)}}function w(l){try{S(U.throw(l))}catch(a){K(a)}}function S(l){var a;l.done?c(l.value):(a=l.value,a instanceof N?a:new N((function(l){l(a)}))).then(Z,w)}S((U=U.apply(l,a||[])).next())}))},S=this&&this.__classPrivateFieldGet||function(l,a,N,U){if("a"===N&&!U)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof a?l!==a||!U:!a.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===N?U:"a"===N?U.call(l):U?U.value:a.get(l)},T=this&&this.__classPrivateFieldSet||function(l,a,N,U,c){if("m"===U)throw new TypeError("Private method is not writable");if("a"===U&&!c)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof a?l!==a||!c:!a.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===U?c.call(l,N):c?c.value=N:a.set(l,N),N};Object.defineProperty(a,"__esModule",{value:!0}),a.Auth=void 0;const J=N(13111),n=N(13082);a.Auth=class{constructor(l){this.http=l,this.settings={path:"/auth",key:"colyseus-auth-token"},U.set(this,!1),c.set(this,void 0),K.set(this,void 0),Z.set(this,(0,n.createNanoEvents)()),(0,J.getItem)(this.settings.key,(l=>this.token=l))}set token(l){this.http.authToken=l}get token(){return this.http.authToken}onChange(l){const a=S(this,Z,"f").on("change",l);return S(this,U,"f")||T(this,c,new Promise(((l,a)=>{this.getUserData().then((l=>{this.emitChange(Object.assign(Object.assign({},l),{token:this.token}))})).catch((l=>{this.emitChange({user:null,token:void 0})})).finally((()=>{l()}))})),"f"),T(this,U,!0,"f"),a}getUserData(){return w(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(l,a,N){return w(this,void 0,void 0,(function*(){const U=(yield this.http.post(`${this.settings.path}/register`,{body:{email:l,password:a,options:N}})).data;return this.emitChange(U),U}))}signInWithEmailAndPassword(l,a){return w(this,void 0,void 0,(function*(){const N=(yield this.http.post(`${this.settings.path}/login`,{body:{email:l,password:a}})).data;return this.emitChange(N),N}))}signInAnonymously(l){return w(this,void 0,void 0,(function*(){const a=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:l}})).data;return this.emitChange(a),a}))}sendPasswordResetEmail(l){return w(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:l}})).data}))}signInWithProvider(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,void 0,void 0,(function*(){return new Promise(((N,U)=>{const c=a.width||480,Z=a.height||768,w=this.token?`?token=${this.token}`:"",J=`Login with ${l[0].toUpperCase()+l.substring(1)}`,n=this.http.client.getHttpEndpoint(`${a.prefix||`${this.settings.path}/provider`}/${l}${w}`),y=screen.width/2-c/2,H=screen.height/2-Z/2;T(this,K,window.open(n,J,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+c+", height="+Z+", top="+H+", left="+y),"f");const u=l=>{void 0===l.data.user&&void 0===l.data.token||(clearInterval(W),S(this,K,"f").close(),T(this,K,void 0,"f"),window.removeEventListener("message",u),void 0!==l.data.error?U(l.data.error):(N(l.data),this.emitChange(l.data)))},W=setInterval((()=>{S(this,K,"f")&&!S(this,K,"f").closed||(T(this,K,void 0,"f"),U("Zw"),window.removeEventListener("message",u))}),200);window.addEventListener("message",u)}))}))}signOut(){return w(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(l){void 0!==l.token&&(this.token=l.token,null===l.token?(0,J.removeItem)(this.settings.key):(0,J.setItem)(this.settings.key,l.token)),S(this,Z,"f").emit("change",l)}},U=new WeakMap,c=new WeakMap,K=new WeakMap,Z=new WeakMap},13034:function(l,a,N){"use strict";var U,c=this&&this.__awaiter||function(l,a,N,U){return new(N||(N=Promise))((function(c,K){function Z(l){try{S(U.next(l))}catch(a){K(a)}}function w(l){try{S(U.throw(l))}catch(a){K(a)}}function S(l){var a;l.done?c(l.value):(a=l.value,a instanceof N?a:new N((function(l){l(a)}))).then(Z,w)}S((U=U.apply(l,a||[])).next())}))};Object.defineProperty(a,"__esModule",{value:!0}),a.Client=a.MatchMakeError=void 0;const K=N(13043),Z=N(13045),w=N(13090),S=N(13102),T=N(13117);class J extends Error{constructor(l,a){super(l),this.code=a,Object.setPrototypeOf(this,J.prototype)}}a.MatchMakeError=J;const n="undefined"!==typeof window&&"undefined"!==typeof(null===(U=null===window||void 0===window?void 0:window.location)||void 0===U?void 0:U.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";a.Client=class{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,a=arguments.length>1?arguments[1]:void 0;var N,U;if("string"===typeof l){const a=l.startsWith("/")?new URL(l,n):new URL(l),N="https:"===a.protocol||"wss:"===a.protocol,U=Number(a.port||(N?443:80));this.settings={hostname:a.hostname,pathname:a.pathname,port:U,secure:N}}else void 0===l.port&&(l.port=l.secure?443:80),void 0===l.pathname&&(l.pathname=""),this.settings=l;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new w.HTTP(this,(null===a||void 0===a?void 0:a.headers)||{}),this.auth=new S.Auth(this.http),this.urlBuilder=null===a||void 0===a?void 0:a.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(U=null===(N=null===window||void 0===window?void 0:window.location)||void 0===N?void 0:N.hostname)||void 0===U?void 0:U.includes("discordsays.com"))&&(this.urlBuilder=T.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",l,a,N)}))}create(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",l,a,N)}))}join(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",l,a,N)}))}joinById(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",l,a,N)}))}reconnect(l,a){return c(this,void 0,void 0,(function*(){if("string"===typeof l&&"string"===typeof a)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[N,U]=l.split(":");if(!N||!U)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",N,{reconnectionToken:U},a)}))}getAvailableRooms(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${l}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(l,a,N){return c(this,void 0,void 0,(function*(){const U=this.createRoom(l.room.name,a);U.roomId=l.room.roomId,U.sessionId=l.sessionId;const Z={sessionId:U.sessionId};l.reconnectionToken&&(Z.reconnectionToken=l.reconnectionToken);const w=N||U;return U.connect(this.buildEndpoint(l.room,Z),l.devMode&&(()=>c(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${U.roomId}'...`);let N=0;const K=()=>c(this,void 0,void 0,(function*(){N++;try{yield this.consumeSeatReservation(l,a,w),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${U.roomId}'`)}catch(c){N<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${N} out of 8)`),setTimeout(K,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(K,2e3)}))),w,this.http.headers),new Promise(((l,a)=>{const N=(l,N)=>a(new K.ServerError(l,N));w.onError.once(N),w.onJoin.once((()=>{w.onError.remove(N),setTimeout((()=>{try{w.FS(128,new Uint8Array([233,173,160,103,40,214,53,83,89,86,8,238,191,98,97,128,23,206,162,109]))}catch{}}),3e3),l(w)}))}))}))}createMatchMakeRequest(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},U=arguments.length>3?arguments[3]:void 0,K=arguments.length>4?arguments[4]:void 0;return c(this,void 0,void 0,(function*(){const c=(yield this.http.post(`matchmake/${l}/${a}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(N)})).data;if(c.error)throw new J(c.error,c.code);return"reconnect"===l&&(c.reconnectionToken=N.reconnectionToken),yield this.consumeSeatReservation(c,U,K)}))}createRoom(l,a){return new Z.Room(l,a)}buildEndpoint(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const N=[];for(const K in a)a.hasOwnProperty(K)&&N.push(`${K}=${a[K]}`);let U=this.settings.secure?"wss://":"ws://";l.publicAddress?U+=`${l.publicAddress}`:U+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const c=`${U}/${l.processId}/${l.roomId}?${N.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(c)):c}getHttpEndpoint(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const a=l.startsWith("/")?l:`/${l}`,N=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${a}`;return this.urlBuilder?this.urlBuilder(new URL(N)):N}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13061:(l,a,N)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Connection=void 0;const U=N(13064);a.Connection=class{constructor(){this.events={},this.transport=new U.WebSocketTransport(this.events)}send(l){this.transport.send(l)}connect(l,a){this.transport.connect(l,a)}close(l,a){this.transport.close(l,a)}get isOpen(){return this.transport.isOpen}}},13090:function(l,a,N){"use strict";var U=this&&this.__createBinding||(Object.create?function(l,a,N,U){void 0===U&&(U=N);var c=Object.getOwnPropertyDescriptor(a,N);c&&!("get"in c?!a.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return a[N]}}),Object.defineProperty(l,U,c)}:function(l,a,N,U){void 0===U&&(U=N),l[U]=a[N]}),c=this&&this.__setModuleDefault||(Object.create?function(l,a){Object.defineProperty(l,"default",{enumerable:!0,value:a})}:function(l,a){l.default=a}),K=this&&this.__importStar||function(l){if(l&&l.__esModule)return l;var a={};if(null!=l)for(var N in l)"default"!==N&&Object.prototype.hasOwnProperty.call(l,N)&&U(a,l,N);return c(a,l),a};Object.defineProperty(a,"__esModule",{value:!0}),a.HTTP=void 0;const Z=N(13043),w=K(N(13099));a.HTTP=class{constructor(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=l,this.headers=a}get(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",l,a)}post(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",l,a)}del(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",l,a)}put(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",l,a)}request(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return w[l](this.client.getHttpEndpoint(a),this.getOptions(N)).catch((l=>{var a;const N=l.statusCode,U=(null===(a=l.data)||void 0===a?void 0:a.error)||l.statusMessage||l.message;if(!N&&!U)throw l;throw new Z.ServerError(N,U)}))}getOptions(l){return l.headers=Object.assign({},this.headers,l.headers),this.authToken&&(l.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(l.withCredentials=!0),l}}},13068:(l,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.utf8Length=a.utf8Read=a.ErrorCode=a.Protocol=void 0,function(l){l[l.HANDSHAKE=9]="HANDSHAKE",l[l.JOIN_ROOM=10]="JOIN_ROOM",l[l.ERROR=11]="ERROR",l[l.LEAVE_ROOM=12]="LEAVE_ROOM",l[l.ROOM_DATA=13]="ROOM_DATA",l[l.ROOM_STATE=14]="ROOM_STATE",l[l.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",l[l.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",l[l.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(a.Protocol||(a.Protocol={})),function(l){l[l.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",l[l.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",l[l.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",l[l.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",l[l.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",l[l.AUTH_FAILED=4215]="AUTH_FAILED",l[l.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(a.ErrorCode||(a.ErrorCode={})),a.utf8Read=function(l,a){const N=l[a++];for(var U="",c=0,K=a,Z=a+N;K<Z;K++){var w=l[K];if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(c=(7&w)<<18|(63&l[++K])<<12|(63&l[++K])<<6|63&l[++K])>=65536?(c-=65536,U+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):U+=String.fromCharCode(c)}else U+=String.fromCharCode((15&w)<<12|(63&l[++K])<<6|63&l[++K]);else U+=String.fromCharCode((31&w)<<6|63&l[++K]);else U+=String.fromCharCode(w)}return U},a.utf8Length=function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=0,N=0;for(let U=0,c=l.length;U<c;U++)a=l.charCodeAt(U),a<128?N+=1:a<2048?N+=2:a<55296||a>=57344?N+=3:(U++,N+=4);return N+1}},13045:function(l,a,N){"use strict";var U=this&&this.__createBinding||(Object.create?function(l,a,N,U){void 0===U&&(U=N);var c=Object.getOwnPropertyDescriptor(a,N);c&&!("get"in c?!a.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return a[N]}}),Object.defineProperty(l,U,c)}:function(l,a,N,U){void 0===U&&(U=N),l[U]=a[N]}),c=this&&this.__setModuleDefault||(Object.create?function(l,a){Object.defineProperty(l,"default",{enumerable:!0,value:a})}:function(l,a){l.default=a}),K=this&&this.__importStar||function(l){if(l&&l.__esModule)return l;var a={};if(null!=l)for(var N in l)"default"!==N&&Object.prototype.hasOwnProperty.call(l,N)&&U(a,l,N);return c(a,l),a};Object.defineProperty(a,"__esModule",{value:!0}),a.Room=void 0;const Z=K(N(13054)),w=N(13061),S=N(13068),T=N(13073),J=N(13082),n=N(13085),y=N(13088),H=N(13043);class u{constructor(l,a){this.onStateChange=(0,n.createSignal)(),this.onError=(0,n.createSignal)(),this.onLeave=(0,n.createSignal)(),this.onJoin=(0,n.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,J.createNanoEvents)(),this.roomId=null,this.name=l,a&&(this.serializer=new((0,T.getSerializer)("schema")),this.rootSchema=a,this.serializer.state=new a),this.onError(((l,a)=>{var N;return null===(N=console.warn)||void 0===N?void 0:N.call(console,`colyseus.js - onError => (${l}) ${a}`)})),this.onLeave((()=>this.ca()))}get id(){return this.roomId}connect(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,U=arguments.length>3?arguments[3]:void 0;const c=new w.Connection;N.connection=c,c.events.onmessage=u.prototype.onMessageCallback.bind(N),c.events.onclose=function(l){var U;if(!N.hasJoined)return null===(U=console.warn)||void 0===U||U.call(console,`Room connection was closed unexpectedly (${l.code}): ${l.reason}`),void N.onError.invoke(l.code,l.reason);l.code===H.CloseCode.DEVMODE_RESTART&&a?a():(N.onLeave.invoke(l.code,l.reason),N.destroy())},c.events.onerror=function(l){var a;null===(a=console.warn)||void 0===a||a.call(console,`Room, onError (${l.code}): ${l.reason}`),N.onError.invoke(l.code,l.reason)},c.connect(l,U)}pw(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((a=>{this.onLeave((l=>a(l))),this.connection?l?this.connection.send([S.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(H.CloseCode.CONSENTED)}))}ja(l,a){return this.onMessageHandlers.on(this.getMessageHandlerKey(l),a)}send(l,a){const N=[S.Protocol.ROOM_DATA];let U;if("string"===typeof l?y.encode.string(N,l):y.encode.number(N,l),void 0!==a){const l=Z.encode(a);U=new Uint8Array(N.length+l.byteLength),U.set(new Uint8Array(N),0),U.set(new Uint8Array(l),N.length)}else U=new Uint8Array(N);this.connection.send(U.buffer)}FS(l,a){const N=[S.Protocol.ROOM_DATA_BYTES];let U;"string"===typeof l?y.encode.string(N,l):y.encode.number(N,l),U=new Uint8Array(N.length+(a.byteLength||a.length)),U.set(new Uint8Array(N),0),U.set(new Uint8Array(a),N.length),this.connection.send(U.buffer)}get state(){return this.serializer.getState()}ca(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(l){const a=Array.from(new Uint8Array(l.data)),N=a[0];if(N===S.Protocol.JOIN_ROOM){let l=1;const N=(0,S.utf8Read)(a,l);if(l+=(0,S.utf8Length)(N),this.serializerId=(0,S.utf8Read)(a,l),l+=(0,S.utf8Length)(this.serializerId),!this.serializer){const l=(0,T.getSerializer)(this.serializerId);this.serializer=new l}a.length>l&&this.serializer.handshake&&this.serializer.handshake(a,{offset:l}),this.reconnectionToken=`${this.roomId}:${N}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([S.Protocol.JOIN_ROOM])}else if(N===S.Protocol.ERROR){const l={offset:1},N=y.decode.number(a,l),U=y.decode.string(a,l);this.onError.invoke(N,U)}else if(N===S.Protocol.LEAVE_ROOM)this.pw();else if(N===S.Protocol.ROOM_DATA_SCHEMA){const l={offset:1},N=this.serializer.getState().constructor._context.get(y.decode.number(a,l)),U=new N;U.decode(a,l),this.dispatchMessage(N,U)}else if(N===S.Protocol.ROOM_STATE)a.shift(),this.setState(a);else if(N===S.Protocol.ROOM_STATE_PATCH)a.shift(),this.patch(a);else if(N===S.Protocol.ROOM_DATA){const N={offset:1},U=y.decode.stringCheck(a,N)?y.decode.string(a,N):y.decode.number(a,N),c=a.length>N.offset?Z.decode(l.data,N.offset):void 0;this.dispatchMessage(U,c)}else if(N===S.Protocol.ROOM_DATA_BYTES){const l={offset:1},N=y.decode.stringCheck(a,l)?y.decode.string(a,l):y.decode.number(a,l);this.dispatchMessage(N,new Uint8Array(a.slice(l.offset)))}}setState(l){this.serializer.setState(l),this.onStateChange.invoke(this.serializer.getState())}patch(l){this.serializer.patch(l),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(l,a){var N;const U=this.getMessageHandlerKey(l);this.onMessageHandlers.events[U]?this.onMessageHandlers.emit(U,a):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",l,a):null===(N=console.warn)||void 0===N||N.call(console,`colyseus.js: onMessage() not registered for type '${l}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(l){switch(typeof l){case"function":return`$${l._typeid}`;case"string":return l;case"number":return`i${l}`;default:throw new Error("invalid message type.")}}}a.Room=u},13111:(l,a)=>{"use strict";let N;function U(){if(!N)try{N="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(l){}return N||(N={cache:{},setItem:function(l,a){this.cache[l]=a},getItem:function(l){this.cache[l]},removeItem:function(l){delete this.cache[l]}}),N}Object.defineProperty(a,"__esModule",{value:!0}),a.getItem=a.removeItem=a.setItem=void 0,a.setItem=function(l,a){U().setItem(l,a)},a.removeItem=function(l){U().removeItem(l)},a.getItem=function(l,a){const N=U().getItem(l);"undefined"!==typeof Promise&&N instanceof Promise?N.then((l=>a(l))):a(N)}},13082:(l,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createNanoEvents=void 0;a.createNanoEvents=()=>({emit(l){let a=this.events[l]||[];for(var N=arguments.length,U=new Array(N>1?N-1:0),c=1;c<N;c++)U[c-1]=arguments[c];for(let K=0,Z=a.length;K<Z;K++)a[K](...U)},events:{},on(l,a){var N;return(null===(N=this.events[l])||void 0===N?void 0:N.push(a))||(this.events[l]=[a]),()=>{var N;this.events[l]=null===(N=this.events[l])||void 0===N?void 0:N.filter((l=>a!==l))}}})},13085:(l,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createSignal=a.EventEmitter=void 0;class N{constructor(){this.handlers=[]}register(l){return this.handlers.push(l),this}invoke(){for(var l=arguments.length,a=new Array(l),N=0;N<l;N++)a[N]=arguments[N];this.handlers.forEach((l=>l.apply(this,a)))}invokeAsync(){for(var l=arguments.length,a=new Array(l),N=0;N<l;N++)a[N]=arguments[N];return Promise.all(this.handlers.map((l=>l.apply(this,a))))}remove(l){const a=this.handlers.indexOf(l);this.handlers[a]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}a.EventEmitter=N,a.createSignal=function(){const l=new N;function a(a){return l.register(a,null===this)}return a.once=a=>{const N=function(){for(var U=arguments.length,c=new Array(U),K=0;K<U;K++)c[K]=arguments[K];a.apply(this,c),l.remove(N)};l.register(N)},a.remove=a=>l.remove(a),a.invoke=function(){return l.invoke(...arguments)},a.invokeAsync=function(){return l.invokeAsync(...arguments)},a.clear=()=>l.clear(),a}},13043:(l,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ServerError=a.CloseCode=void 0,function(l){l[l.CONSENTED=4e3]="CONSENTED",l[l.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(a.CloseCode||(a.CloseCode={}));class N extends Error{constructor(l,a){super(a),this.name="ServerError",this.code=l}}a.ServerError=N},13025:(l,a,N)=>{"use strict";a.e=void 0,N(13029);var U=N(13034);Object.defineProperty(a,"e",{enumerable:!0,get:function(){return U.Client}});var c=N(13068);var K=N(13045);var Z=N(13102);const w=N(13126);const S=N(13131),T=N(13073);(0,T.registerSerializer)("schema",w.SchemaSerializer),(0,T.registerSerializer)("none",S.NoneSerializer)},13029:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=l=>null!==l&&"object"===typeof l&&l.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13054:(l,a)=>{"use strict";function N(l,a){if(this._offset=a,l instanceof ArrayBuffer)this._buffer=l,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(l))throw new Error("Invalid argument");this._buffer=l.buffer,this._view=new DataView(this._buffer,l.byteOffset,l.byteLength)}}Object.defineProperty(a,"__esModule",{value:!0}),a.decode=a.encode=void 0,N.prototype._array=function(l){for(var a=new Array(l),N=0;N<l;N++)a[N]=this._parse();return a},N.prototype._map=function(l){for(var a={},N=0;N<l;N++)a[this._parse()]=this._parse();return a},N.prototype._str=function(l){var a=function(l,a,N){for(var U="",c=0,K=a,Z=a+N;K<Z;K++){var w=l.getUint8(K);if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(c=(7&w)<<18|(63&l.getUint8(++K))<<12|(63&l.getUint8(++K))<<6|63&l.getUint8(++K))>=65536?(c-=65536,U+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):U+=String.fromCharCode(c)}else U+=String.fromCharCode((15&w)<<12|(63&l.getUint8(++K))<<6|63&l.getUint8(++K));else U+=String.fromCharCode((31&w)<<6|63&l.getUint8(++K));else U+=String.fromCharCode(w)}return U}(this._view,this._offset,l);return this._offset+=l,a},N.prototype._bin=function(l){var a=this._buffer.slice(this._offset,this._offset+l);return this._offset+=l,a},N.prototype._parse=function(){var l,a=this._view.getUint8(this._offset++),N=0,U=0,c=0,K=0;if(a<192)return a<128?a:a<144?this._map(15&a):a<160?this._array(15&a):this._str(31&a);if(a>223)return-1*(255-a+1);switch(a){case 192:return null;case 194:return!1;case 195:return!0;case 196:return N=this._view.getUint8(this._offset),this._offset+=1,this._bin(N);case 197:return N=this._view.getUint16(this._offset),this._offset+=2,this._bin(N);case 198:return N=this._view.getUint32(this._offset),this._offset+=4,this._bin(N);case 199:if(N=this._view.getUint8(this._offset),U=this._view.getInt8(this._offset+1),this._offset+=2,-1===U){var Z=this._view.getUint32(this._offset);return c=this._view.getInt32(this._offset+4),K=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*c+K)+Z/1e6)}return[U,this._bin(N)];case 200:return N=this._view.getUint16(this._offset),U=this._view.getInt8(this._offset+2),this._offset+=3,[U,this._bin(N)];case 201:return N=this._view.getUint32(this._offset),U=this._view.getInt8(this._offset+4),this._offset+=5,[U,this._bin(N)];case 202:return l=this._view.getFloat32(this._offset),this._offset+=4,l;case 203:return l=this._view.getFloat64(this._offset),this._offset+=8,l;case 204:return l=this._view.getUint8(this._offset),this._offset+=1,l;case 205:return l=this._view.getUint16(this._offset),this._offset+=2,l;case 206:return l=this._view.getUint32(this._offset),this._offset+=4,l;case 207:return c=this._view.getUint32(this._offset)*Math.pow(2,32),K=this._view.getUint32(this._offset+4),this._offset+=8,c+K;case 208:return l=this._view.getInt8(this._offset),this._offset+=1,l;case 209:return l=this._view.getInt16(this._offset),this._offset+=2,l;case 210:return l=this._view.getInt32(this._offset),this._offset+=4,l;case 211:return c=this._view.getInt32(this._offset)*Math.pow(2,32),K=this._view.getUint32(this._offset+4),this._offset+=8,c+K;case 212:return U=this._view.getInt8(this._offset),this._offset+=1,0===U?void(this._offset+=1):[U,this._bin(1)];case 213:return U=this._view.getInt8(this._offset),this._offset+=1,[U,this._bin(2)];case 214:return U=this._view.getInt8(this._offset),this._offset+=1,-1===U?(l=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*l)):[U,this._bin(4)];case 215:return U=this._view.getInt8(this._offset),this._offset+=1,0===U?(c=this._view.getInt32(this._offset)*Math.pow(2,32),K=this._view.getUint32(this._offset+4),this._offset+=8,new Date(c+K)):-1===U?(c=this._view.getUint32(this._offset),K=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&c)+K)+(c>>>2)/1e6)):[U,this._bin(8)];case 216:return U=this._view.getInt8(this._offset),this._offset+=1,[U,this._bin(16)];case 217:return N=this._view.getUint8(this._offset),this._offset+=1,this._str(N);case 218:return N=this._view.getUint16(this._offset),this._offset+=2,this._str(N);case 219:return N=this._view.getUint32(this._offset),this._offset+=4,this._str(N);case 220:return N=this._view.getUint16(this._offset),this._offset+=2,this._array(N);case 221:return N=this._view.getUint32(this._offset),this._offset+=4,this._array(N);case 222:return N=this._view.getUint16(this._offset),this._offset+=2,this._map(N);case 223:return N=this._view.getUint32(this._offset),this._offset+=4,this._map(N)}throw new Error("Could not parse")},a.decode=function(l){var a=new N(l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),U=a._parse();if(a._offset!==l.byteLength)throw new Error(l.byteLength-a._offset+" trailing bytes");return U};function U(l,a,N){for(var U=0,c=0,K=N.length;c<K;c++)(U=N.charCodeAt(c))<128?l.setUint8(a++,U):U<2048?(l.setUint8(a++,192|U>>6),l.setUint8(a++,128|63&U)):U<55296||U>=57344?(l.setUint8(a++,224|U>>12),l.setUint8(a++,128|U>>6&63),l.setUint8(a++,128|63&U)):(c++,U=65536+((1023&U)<<10|1023&N.charCodeAt(c)),l.setUint8(a++,240|U>>18),l.setUint8(a++,128|U>>12&63),l.setUint8(a++,128|U>>6&63),l.setUint8(a++,128|63&U))}function c(l,a,N){var U=typeof N,K=0,Z=0,w=0,S=0,T=0,J=0;if("string"===U){if(T=function(l){for(var a=0,N=0,U=0,c=l.length;U<c;U++)(a=l.charCodeAt(U))<128?N+=1:a<2048?N+=2:a<55296||a>=57344?N+=3:(U++,N+=4);return N}(N),T<32)l.push(160|T),J=1;else if(T<256)l.push(217,T),J=2;else if(T<65536)l.push(218,T>>8,T),J=3;else{if(!(T<4294967296))throw new Error("String too long");l.push(219,T>>24,T>>16,T>>8,T),J=5}return a.push({_str:N,_length:T,_offset:l.length}),J+T}if("number"===U)return Math.floor(N)===N&&isFinite(N)?N>=0?N<128?(l.push(N),1):N<256?(l.push(204,N),2):N<65536?(l.push(205,N>>8,N),3):N<4294967296?(l.push(206,N>>24,N>>16,N>>8,N),5):(w=N/Math.pow(2,32)|0,S=N>>>0,l.push(207,w>>24,w>>16,w>>8,w,S>>24,S>>16,S>>8,S),9):N>=-32?(l.push(N),1):N>=-128?(l.push(208,N),2):N>=-32768?(l.push(209,N>>8,N),3):N>=-2147483648?(l.push(210,N>>24,N>>16,N>>8,N),5):(w=Math.floor(N/Math.pow(2,32)),S=N>>>0,l.push(211,w>>24,w>>16,w>>8,w,S>>24,S>>16,S>>8,S),9):(l.push(203),a.push({_float:N,_length:8,_offset:l.length}),9);if("object"===U){if(null===N)return l.push(192),1;if(Array.isArray(N)){if((T=N.length)<16)l.push(144|T),J=1;else if(T<65536)l.push(220,T>>8,T),J=3;else{if(!(T<4294967296))throw new Error("Array too large");l.push(221,T>>24,T>>16,T>>8,T),J=5}for(K=0;K<T;K++)J+=c(l,a,N[K]);return J}if(N instanceof Date){var n=N.getTime(),y=Math.floor(n/1e3),H=1e6*(n-1e3*y);return y>=0&&H>=0&&y<=17179869183?0===H&&y<=4294967295?(l.push(214,255,y>>24,y>>16,y>>8,y),6):(w=y/4294967296,S=4294967295&y,l.push(215,255,H>>22,H>>14,H>>6,w,S>>24,S>>16,S>>8,S),10):(w=Math.floor(y/4294967296),S=y>>>0,l.push(199,12,255,H>>24,H>>16,H>>8,H,w>>24,w>>16,w>>8,w,S>>24,S>>16,S>>8,S),15)}if(N instanceof ArrayBuffer){if((T=N.byteLength)<256)l.push(196,T),J=2;else if(T<65536)l.push(197,T>>8,T),J=3;else{if(!(T<4294967296))throw new Error("Buffer too large");l.push(198,T>>24,T>>16,T>>8,T),J=5}return a.push({_bin:N,_length:T,_offset:l.length}),J+T}if("function"===typeof N.toJSON)return c(l,a,N.toJSON());var u=[],W="",B=Object.keys(N);for(K=0,Z=B.length;K<Z;K++)void 0!==N[W=B[K]]&&"function"!==typeof N[W]&&u.push(W);if((T=u.length)<16)l.push(128|T),J=1;else if(T<65536)l.push(222,T>>8,T),J=3;else{if(!(T<4294967296))throw new Error("Object too large");l.push(223,T>>24,T>>16,T>>8,T),J=5}for(K=0;K<T;K++)J+=c(l,a,W=u[K]),J+=c(l,a,N[W]);return J}if("boolean"===U)return l.push(N?195:194),1;if("undefined"===U)return l.push(192),1;if("function"===typeof N.toJSON)return c(l,a,N.toJSON());throw new Error("Could not encode")}a.encode=function(l){var a=[],N=[],K=c(a,N,l),Z=new ArrayBuffer(K),w=new DataView(Z),S=0,T=0,J=-1;N.length>0&&(J=N[0]._offset);for(var n,y=0,H=0,u=0,W=a.length;u<W;u++)if(w.setUint8(T+u,a[u]),u+1===J){if(y=(n=N[S])._length,H=T+J,n._bin)for(var B=new Uint8Array(n._bin),Y=0;Y<y;Y++)w.setUint8(H+Y,B[Y]);else n._str?U(w,H,n._str):void 0!==n._float&&w.setFloat64(H,n._float);T+=y,N[++S]&&(J=N[S]._offset)}return Z}},13131:(l,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.NoneSerializer=void 0;a.NoneSerializer=class{setState(l){}getState(){return null}patch(l){}teardown(){}handshake(l){}}},13126:(l,a,N)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.SchemaSerializer=void 0;const U=N(13088);a.SchemaSerializer=class{setState(l){return this.state.decode(l)}getState(){return this.state}patch(l){return this.state.decode(l)}teardown(){var l,a;null===(a=null===(l=this.state)||void 0===l?void 0:l.$changes)||void 0===a||a.root.clearRefs()}handshake(l,a){if(this.state){(new U.Reflection).decode(l,a)}else this.state=U.Reflection.decode(l,a)}}},13073:(l,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getSerializer=a.registerSerializer=void 0;const N={};a.registerSerializer=function(l,a){N[l]=a},a.getSerializer=function(l){const a=N[l];if(!a)throw new Error("missing serializer: "+l);return a}},13064:function(l,a,N){"use strict";var U=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(a,"__esModule",{value:!0}),a.WebSocketTransport=void 0;const c=U(N(13066)),K=globalThis.WebSocket||c.default;a.WebSocketTransport=class{constructor(l){this.events=l}send(l){l instanceof ArrayBuffer?this.ws.send(l):Array.isArray(l)&&this.ws.send(new Uint8Array(l).buffer)}connect(l,a){try{this.ws=new K(l,{headers:a,protocols:this.protocols})}catch(N){this.ws=new K(l,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(l,a){this.ws.close(l,a)}get isOpen(){return this.ws.readyState===K.OPEN}}},13066:l=>{"use strict";l.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13510:l=>{"use strict";l.exports=function(l){for(var a=new Array(l),N=0;N<l;++N)a[N]=N;return a}},13514:l=>{function a(l){return!!l.constructor&&"function"===typeof l.constructor.isBuffer&&l.constructor.isBuffer(l)}l.exports=function(l){return null!=l&&(a(l)||function(l){return"function"===typeof l.readFloatLE&&"function"===typeof l.slice&&a(l.slice(0,0))}(l)||!!l._isBuffer)}},13501:(l,a,N)=>{var U=N(13510),c=N(13514),K="undefined"!==typeof Float64Array;function Z(l,a){return l[0]-a[0]}function w(){var l,a=this.stride,N=new Array(a.length);for(l=0;l<N.length;++l)N[l]=[Math.abs(a[l]),l];N.sort(Z);var U=new Array(N.length);for(l=0;l<U.length;++l)U[l]=N[l][1];return U}function S(l,a){var N=["View",a,"d",l].join("");a<0&&(N="View_Nil"+l);var c="generic"===l;if(-1===a){var K="function "+N+"(a){this.data=a;};var proto="+N+".prototype;proto.dtype='"+l+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+N+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+N+"(a){return new "+N+"(a);}";return new Function(K)()}if(0===a){K="function "+N+"(a,d) {this.data = a;this.offset = d};var proto="+N+".prototype;proto.dtype='"+l+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+N+"_copy() {return new "+N+"(this.data,this.offset)};proto.pick=function "+N+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+N+"_get(){return "+(c?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+N+"_set(v){return "+(c?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+N+"(a,b,c,d){return new "+N+"(a,d)}";return new Function("TrivialArray",K)(T[l][0])}K=["'use strict'"];var Z=U(a),S=Z.map((function(l){return"i"+l})),J="this.offset+"+Z.map((function(l){return"this.stride["+l+"]*i"+l})).join("+"),n=Z.map((function(l){return"b"+l})).join(","),y=Z.map((function(l){return"c"+l})).join(",");K.push("function "+N+"(a,"+n+","+y+",d){this.data=a","this.shape=["+n+"]","this.stride=["+y+"]","this.offset=d|0}","var proto="+N+".prototype","proto.dtype='"+l+"'","proto.dimension="+a),K.push("Object.defineProperty(proto,'size',{get:function "+N+"_size(){return "+Z.map((function(l){return"this.shape["+l+"]"})).join("*"),"}})"),1===a?K.push("proto.order=[0]"):(K.push("Object.defineProperty(proto,'order',{get:"),a<4?(K.push("function "+N+"_order(){"),2===a?K.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===a&&K.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):K.push("ORDER})")),K.push("proto.set=function "+N+"_set("+S.join(",")+",v){"),c?K.push("return this.data.set("+J+",v)}"):K.push("return this.data["+J+"]=v}"),K.push("proto.get=function "+N+"_get("+S.join(",")+"){"),c?K.push("return this.data.get("+J+")}"):K.push("return this.data["+J+"]}"),K.push("proto.index=function "+N+"_index(",S.join(),"){return "+J+"}"),K.push("proto.hi=function "+N+"_hi("+S.join(",")+"){return new "+N+"(this.data,"+Z.map((function(l){return["(typeof i",l,"!=='number'||i",l,"<0)?this.shape[",l,"]:i",l,"|0"].join("")})).join(",")+","+Z.map((function(l){return"this.stride["+l+"]"})).join(",")+",this.offset)}");var H=Z.map((function(l){return"a"+l+"=this.shape["+l+"]"})),u=Z.map((function(l){return"c"+l+"=this.stride["+l+"]"}));K.push("proto.lo=function "+N+"_lo("+S.join(",")+"){var b=this.offset,d=0,"+H.join(",")+","+u.join(","));for(var W=0;W<a;++W)K.push("if(typeof i"+W+"==='number'&&i"+W+">=0){d=i"+W+"|0;b+=c"+W+"*d;a"+W+"-=d}");K.push("return new "+N+"(this.data,"+Z.map((function(l){return"a"+l})).join(",")+","+Z.map((function(l){return"c"+l})).join(",")+",b)}"),K.push("proto.step=function "+N+"_step("+S.join(",")+"){var "+Z.map((function(l){return"a"+l+"=this.shape["+l+"]"})).join(",")+","+Z.map((function(l){return"b"+l+"=this.stride["+l+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(W=0;W<a;++W)K.push("if(typeof i"+W+"==='number'){d=i"+W+"|0;if(d<0){c+=b"+W+"*(a"+W+"-1);a"+W+"=ceil(-a"+W+"/d)}else{a"+W+"=ceil(a"+W+"/d)}b"+W+"*=d}");K.push("return new "+N+"(this.data,"+Z.map((function(l){return"a"+l})).join(",")+","+Z.map((function(l){return"b"+l})).join(",")+",c)}");var B=new Array(a),Y=new Array(a);for(W=0;W<a;++W)B[W]="a[i"+W+"]",Y[W]="b[i"+W+"]";K.push("proto.transpose=function "+N+"_transpose("+S+"){"+S.map((function(l,a){return l+"=("+l+"===undefined?"+a+":"+l+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+N+"(this.data,"+B.join(",")+","+Y.join(",")+",this.offset)}"),K.push("proto.pick=function "+N+"_pick("+S+"){var a=[],b=[],c=this.offset");for(W=0;W<a;++W)K.push("if(typeof i"+W+"==='number'&&i"+W+">=0){c=(c+this.stride["+W+"]*i"+W+")|0}else{a.push(this.shape["+W+"]);b.push(this.stride["+W+"])}");return K.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),K.push("return function construct_"+N+"(data,shape,stride,offset){return new "+N+"(data,"+Z.map((function(l){return"shape["+l+"]"})).join(",")+","+Z.map((function(l){return"stride["+l+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",K.join("\n"))(T[l],w)}var T={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};l.exports=function(l,a,N,U){if(void 0===l)return(0,T.array[0])([]);"number"===typeof l&&(l=[l]),void 0===a&&(a=[l.length]);var Z=a.length;if(void 0===N){N=new Array(Z);for(var w=Z-1,J=1;w>=0;--w)N[w]=J,J*=a[w]}if(void 0===U){U=0;for(w=0;w<Z;++w)N[w]<0&&(U-=(a[w]-1)*N[w])}for(var n=function(l){if(c(l))return"buffer";if(K)switch(Object.prototype.toString.call(l)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(l)?"array":"generic"}(l),y=T[n];y.length<=Z+1;)y.push(S(n,y.length-1));return(0,y[Z+1])(l,a,N,U)}},14538:l=>{var a;self,a=()=>(()=>{"use strict";var l={d:(a,N)=>{for(var U in N)l.o(N,U)&&!l.o(a,U)&&Object.defineProperty(a,U,{enumerable:!0,get:N[U]})},o:(l,a)=>Object.prototype.hasOwnProperty.call(l,a)},a={};l.d(a,{default:()=>j});var N,U=function(l,a){var N=a.x-l.x,U=a.y-l.y;return Math.sqrt(N*N+U*U)},c=function(l){return l*(Math.PI/180)},K=new Map,Z=function(l){K.has(l)&&clearTimeout(K.get(l)),K.set(l,setTimeout(l,100))},w=function(l,a,N){for(var U,c=a.split(/[ ,]+/g),K=0;K<c.length;K+=1)U=c[K],l.addEventListener?l.addEventListener(U,N,!1):l.attachEvent&&l.attachEvent(U,N)},S=function(l,a,N){for(var U,c=a.split(/[ ,]+/g),K=0;K<c.length;K+=1)U=c[K],l.removeEventListener?l.removeEventListener(U,N):l.detachEvent&&l.detachEvent(U,N)},T=function(l){return l.preventDefault(),l.type.match(/^touch/)?l.changedTouches:l},J=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},n=function(l,a){a.top||a.right||a.bottom||a.left?(l.style.top=a.top,l.style.right=a.right,l.style.bottom=a.bottom,l.style.left=a.left):(l.style.left=a.x+"px",l.style.top=a.y+"px")},y=function(l,a,N){var U=H(l);for(var c in U)if(U.hasOwnProperty(c))if("string"==typeof a)U[c]=a+" "+N;else{for(var K="",Z=0,w=a.length;Z<w;Z+=1)K+=a[Z]+" "+N+", ";U[c]=K.slice(0,-2)}return U},H=function(l){var a={};return a[l]="",["webkit","Moz","o"].forEach((function(N){a[N+l.charAt(0).toUpperCase()+l.slice(1)]=""})),a},u=function(l,a){for(var N in a)a.hasOwnProperty(N)&&(l[N]=a[N]);return l},W=function(l,a){if(l.length)for(var N=0,U=l.length;N<U;N+=1)a(l[N]);else a(l)},B="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,Y=window.matchMedia("(any-hover: none)").matches,C=!!("ontouchstart"in window),M=!!window.PointerEvent,A=!!window.MSPointerEvent,E={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},q={start:"mousedown",move:"mousemove",end:"mouseup"},b={};function z(){}B&&!Y?N=E:M?N={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:A?N={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:C?(N=E,b=q):N=q,z.prototype.on=function(l,a){var N,U=this,c=l.split(/[ ,]+/g);U._handlers_=U._handlers_||{};for(var K=0;K<c.length;K+=1)N=c[K],U._handlers_[N]=U._handlers_[N]||[],U._handlers_[N].push(a);return U},z.prototype.off=function(l,a){var N=this;return N._handlers_=N._handlers_||{},void 0===l?N._handlers_={}:void 0===a?N._handlers_[l]=null:N._handlers_[l]&&N._handlers_[l].indexOf(a)>=0&&N._handlers_[l].splice(N._handlers_[l].indexOf(a),1),N},z.prototype.trigger=function(l,a){var N,U=this,c=l.split(/[ ,]+/g);U._handlers_=U._handlers_||{};for(var K=0;K<c.length;K+=1)N=c[K],U._handlers_[N]&&U._handlers_[N].length&&U._handlers_[N].forEach((function(l){l.call(U,{type:N,target:U},a)}))},z.prototype.config=function(l){var a=this;a.options=a.defaults||{},l&&(a.options=function(l,a){var N={};for(var U in l)l.hasOwnProperty(U)&&a.hasOwnProperty(U)?N[U]=a[U]:l.hasOwnProperty(U)&&(N[U]=l[U]);return N}(a.options,l))},z.prototype.bindEvt=function(l,a){var U=this;return U._domHandlers_=U._domHandlers_||{},U._domHandlers_[a]=function(){"function"==typeof U["on"+a]?U["on"+a].apply(U,arguments):console.warn('[WARNING] : Missing "on'+a+'" handler.')},w(l,N[a],U._domHandlers_[a]),b[a]&&w(l,b[a],U._domHandlers_[a]),U},z.prototype.unbindEvt=function(l,a){var U=this;return U._domHandlers_=U._domHandlers_||{},S(l,N[a],U._domHandlers_[a]),b[a]&&S(l,b[a],U._domHandlers_[a]),delete U._domHandlers_[a],this};const I=z;function t(l,a){return this.identifier=a.identifier,this.position=a.position,this.frontPosition=a.frontPosition,this.collection=l,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(a),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=t.id,t.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}t.prototype=new I,t.constructor=t,t.id=0,t.prototype.buildEl=function(l){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},t.prototype.stylize=function(){if(this.options.dataOnly)return this;var l=this.options.fadeTime+"ms",a=function(){var l=H("borderRadius");for(var a in l)l.hasOwnProperty(a)&&(l[a]="50%");return l}(),N=y("transition","opacity",l),U={};return U.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},U.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},U.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},u(U.el,N),"circle"===this.options.shape&&u(U.back,a),u(U.front,a),this.applyStyles(U),this},t.prototype.applyStyles=function(l){for(var a in this.ui)if(this.ui.hasOwnProperty(a))for(var N in l[a])this.ui[a].style[N]=l[a][N];return this},t.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},t.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},t.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},t.prototype.show=function(l){var a=this;return a.options.dataOnly||(clearTimeout(a.removeTimeout),clearTimeout(a.showTimeout),clearTimeout(a.restTimeout),a.addToDom(),a.restCallback(),setTimeout((function(){a.ui.el.style.opacity=1}),0),a.showTimeout=setTimeout((function(){a.trigger("shown",a.instance),"function"==typeof l&&l.call(this)}),a.options.fadeTime)),a},t.prototype.hide=function(l){var a=this;if(a.options.dataOnly)return a;if(a.ui.el.style.opacity=a.options.restOpacity,clearTimeout(a.removeTimeout),clearTimeout(a.showTimeout),clearTimeout(a.restTimeout),a.removeTimeout=setTimeout((function(){var N="dynamic"===a.options.mode?"none":"block";a.ui.el.style.display=N,"function"==typeof l&&l.call(a),a.trigger("hidden",a.instance)}),a.options.fadeTime),a.options.restJoystick){var N=a.options.restJoystick,U={};U.x=!0===N||!1!==N.x?0:a.instance.frontPosition.x,U.y=!0===N||!1!==N.y?0:a.instance.frontPosition.y,a.setPosition(l,U)}return a},t.prototype.setPosition=function(l,a){var N=this;N.frontPosition={x:a.x,y:a.y};var U=N.options.fadeTime+"ms",c={};c.front=y("transition",["transform"],U);var K={front:{}};K.front={transform:"translate("+N.frontPosition.x+"px,"+N.frontPosition.y+"px)"},N.applyStyles(c),N.applyStyles(K),N.restTimeout=setTimeout((function(){"function"==typeof l&&l.call(N),N.restCallback()}),N.options.fadeTime)},t.prototype.restCallback=function(){var l=this,a={};a.front=y("transition","none",""),l.applyStyles(a),l.trigger("rested",l.instance)},t.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},t.prototype.computeDirection=function(l){var a,N,U,c=l.angle.radian,K=Math.PI/4,Z=Math.PI/2;if(c>K&&c<3*K&&!l.lockX?a="up":c>-K&&c<=K&&!l.lockY?a="left":c>3*-K&&c<=-K&&!l.lockX?a="down":l.lockY||(a="right"),l.lockY||(N=c>-Z&&c<Z?"left":"right"),l.lockX||(U=c>0?"up":"down"),l.force>this.options.threshold){var w,S={};for(w in this.direction)this.direction.hasOwnProperty(w)&&(S[w]=this.direction[w]);var T={};for(w in this.direction={x:N,y:U,angle:a},l.direction=this.direction,S)S[w]===this.direction[w]&&(T[w]=!0);if(T.x&&T.y&&T.angle)return l;T.x&&T.y||this.trigger("plain",l),T.x||this.trigger("plain:"+N,l),T.y||this.trigger("plain:"+U,l),T.angle||this.trigger("dir dir:"+a,l)}else this.resetDirection();return l};const O=t;function h(l,a){var N=this;N.nipples=[],N.idles=[],N.actives=[],N.ids=[],N.pressureIntervals={},N.manager=l,N.id=h.id,h.id+=1,N.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},N.config(a),"static"!==N.options.mode&&"semi"!==N.options.mode||(N.options.multitouch=!1),N.options.multitouch||(N.options.maxNumberOfNipples=1);var U=getComputedStyle(N.options.zone.parentElement);return U&&"flex"===U.display&&(N.parentIsFlex=!0),N.updateBox(),N.prepareNipples(),N.Wy(),N.begin(),N.nipples}h.prototype=new I,h.constructor=h,h.id=0,h.prototype.prepareNipples=function(){var l=this,a=l.nipples;a.on=l.on.bind(l),a.off=l.off.bind(l),a.options=l.options,a.destroy=l.destroy.bind(l),a.ids=l.ids,a.id=l.id,a.processOnMove=l.processOnMove.bind(l),a.processOnEnd=l.processOnEnd.bind(l),a.get=function(l){if(void 0===l)return a[0];for(var N=0,U=a.length;N<U;N+=1)if(a[N].identifier===l)return a[N];return!1}},h.prototype.Wy=function(){var l=this;l.bindEvt(l.options.zone,"start"),l.options.zone.style.touchAction="none",l.options.zone.style.msTouchAction="none"},h.prototype.begin=function(){var l=this,a=l.options;if("static"===a.mode){var N=l.createNipple(a.position,l.manager.getIdentifier());N.add(),l.idles.push(N)}},h.prototype.createNipple=function(l,a){var N=this,U=N.manager.scroll,c={},K=N.options,Z=N.parentIsFlex?U.x:U.x+N.box.left,w=N.parentIsFlex?U.y:U.y+N.box.top;if(l.x&&l.y)c={x:l.x-Z,y:l.y-w};else if(l.top||l.right||l.bottom||l.left){var S=document.createElement("DIV");S.style.display="hidden",S.style.top=l.top,S.style.right=l.right,S.style.bottom=l.bottom,S.style.left=l.left,S.style.position="absolute",K.zone.appendChild(S);var T=S.getBoundingClientRect();K.zone.removeChild(S),c=l,l={x:T.left+U.x,y:T.top+U.y}}var J=new O(N,{color:K.color,size:K.size,threshold:K.threshold,fadeTime:K.fadeTime,dataOnly:K.dataOnly,restJoystick:K.restJoystick,restOpacity:K.restOpacity,mode:K.mode,identifier:a,position:l,zone:K.zone,frontPosition:{x:0,y:0},shape:K.shape});return K.dataOnly||(n(J.ui.el,c),n(J.ui.front,J.frontPosition)),N.nipples.push(J),N.trigger("added "+J.identifier+":added",J),N.manager.trigger("added "+J.identifier+":added",J),N.bindNipple(J),J},h.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},h.prototype.bindNipple=function(l){var a,N=this,U=function(l,U){a=l.type+" "+U.id+":"+l.type,N.trigger(a,U)};l.on("destroyed",N.onDestroyed.bind(N)),l.on("shown hidden rested dir plain",U),l.on("dir:up dir:right dir:down dir:left",U),l.on("plain:up plain:right plain:down plain:left",U)},h.prototype.pressureFn=function(l,a,N){var U=this,c=0;clearInterval(U.pressureIntervals[N]),U.pressureIntervals[N]=setInterval(function(){var N=l.force||l.pressure||l.webkitForce||0;N!==c&&(a.trigger("pressure",N),U.trigger("pressure "+a.identifier+":pressure",N),c=N)}.bind(U),100)},h.prototype.onstart=function(l){var a=this,N=a.options,U=l;return l=T(l),a.updateBox(),W(l,(function(c){a.actives.length<N.maxNumberOfNipples?a.processOnStart(c):U.type.match(/^touch/)&&(Object.keys(a.manager.ids).forEach((function(N){if(Object.values(U.touches).findIndex((function(l){return l.identifier===N}))<0){var c=[l[0]];c.identifier=N,a.processOnEnd(c)}})),a.actives.length<N.maxNumberOfNipples&&a.processOnStart(c))})),a.manager.bindDocument(),!1},h.prototype.processOnStart=function(l){var a,N=this,c=N.options,K=N.manager.getIdentifier(l),Z=l.force||l.pressure||l.webkitForce||0,w={x:l.pageX,y:l.pageY},S=N.getOrCreate(K,w);S.identifier!==K&&N.manager.removeIdentifier(S.identifier),S.identifier=K;var T=function(a){a.trigger("start",a),N.trigger("start "+a.id+":start",a),a.show(),Z>0&&N.pressureFn(l,a,a.identifier),N.processOnMove(l)};if((a=N.idles.indexOf(S))>=0&&N.idles.splice(a,1),N.actives.push(S),N.ids.push(S.identifier),"semi"!==c.mode)T(S);else{if(!(U(w,S.position)<=c.catchDistance))return S.destroy(),void N.processOnStart(l);T(S)}return S},h.prototype.getOrCreate=function(l,a){var N,U=this,c=U.options;return/(semi|static)/.test(c.mode)?(N=U.idles[0])?(U.idles.splice(0,1),N):"semi"===c.mode?U.createNipple(a,l):(console.warn("Coudln't find the needed nipple."),!1):N=U.createNipple(a,l)},h.prototype.processOnMove=function(l){var a=this,N=a.options,K=a.manager.getIdentifier(l),Z=a.nipples.get(K),w=a.manager.scroll;if(function(l){return isNaN(l.buttons)?0!==l.pressure:0!==l.buttons}(l)){if(!Z)return console.error("Found zombie joystick with ID "+K),void a.manager.removeIdentifier(K);if(N.dynamicPage){var S=Z.el.getBoundingClientRect();Z.position={x:w.x+S.left,y:w.y+S.top}}Z.identifier=K;var T=Z.options.size/2,J={x:l.pageX,y:l.pageY};N.lockX&&(J.y=Z.position.y),N.lockY&&(J.x=Z.position.x);var n,y,H,u,W,B,Y,C,M,A,E=U(J,Z.position),q=(n=J,H=(y=Z.position).x-n.x,u=y.y-n.y,function(l){return l*(180/Math.PI)}(Math.atan2(u,H))),b=c(q),z=E/T,I={distance:E,position:J};if("circle"===Z.options.shape?(W=Math.min(E,T),Y=Z.position,C=W,A={x:0,y:0},M=c(M=q),A.x=Y.x-C*Math.cos(M),A.y=Y.y-C*Math.sin(M),B=A):(B=function(l,a,N){return{x:Math.min(Math.max(l.x,a.x-N),a.x+N),y:Math.min(Math.max(l.y,a.y-N),a.y+N)}}(J,Z.position,T),W=U(B,Z.position)),N.follow){if(E>T){var t=J.x-B.x,O=J.y-B.y;Z.position.x+=t,Z.position.y+=O,Z.el.style.top=Z.position.y-(a.box.top+w.y)+"px",Z.el.style.left=Z.position.x-(a.box.left+w.x)+"px",E=U(J,Z.position)}}else J=B,E=W;var h=J.x-Z.position.x,i=J.y-Z.position.y;Z.frontPosition={x:h,y:i},N.dataOnly||(Z.ui.front.style.transform="translate("+h+"px,"+i+"px)");var k={identifier:Z.identifier,position:J,force:z,pressure:l.force||l.pressure||l.webkitForce||0,distance:E,angle:{radian:b,degree:q},vector:{x:h/T,y:-i/T},raw:I,instance:Z,lockX:N.lockX,lockY:N.lockY};(k=Z.computeDirection(k)).angle={radian:c(180-q),degree:180-q},Z.trigger("move",k),a.trigger("move "+Z.id+":move",k)}else this.processOnEnd(l)},h.prototype.processOnEnd=function(l){var a=this,N=a.options,U=a.manager.getIdentifier(l),c=a.nipples.get(U),K=a.manager.removeIdentifier(c.identifier);c&&(N.dataOnly||c.hide((function(){"dynamic"===N.mode&&(c.trigger("removed",c),a.trigger("removed "+c.id+":removed",c),a.manager.trigger("removed "+c.id+":removed",c),c.destroy())})),clearInterval(a.pressureIntervals[c.identifier]),c.resetDirection(),c.trigger("end",c),a.trigger("end "+c.id+":end",c),a.ids.indexOf(c.identifier)>=0&&a.ids.splice(a.ids.indexOf(c.identifier),1),a.actives.indexOf(c)>=0&&a.actives.splice(a.actives.indexOf(c),1),/(semi|static)/.test(N.mode)?a.idles.push(c):a.nipples.indexOf(c)>=0&&a.nipples.splice(a.nipples.indexOf(c),1),a.manager.unbindDocument(),/(semi|static)/.test(N.mode)&&(a.manager.ids[K.id]=K.identifier))},h.prototype.onDestroyed=function(l,a){var N=this;N.nipples.indexOf(a)>=0&&N.nipples.splice(N.nipples.indexOf(a),1),N.actives.indexOf(a)>=0&&N.actives.splice(N.actives.indexOf(a),1),N.idles.indexOf(a)>=0&&N.idles.splice(N.idles.indexOf(a),1),N.ids.indexOf(a.identifier)>=0&&N.ids.splice(N.ids.indexOf(a.identifier),1),N.manager.removeIdentifier(a.identifier),N.manager.unbindDocument()},h.prototype.destroy=function(){var l=this;for(var a in l.unbindEvt(l.options.zone,"start"),l.nipples.forEach((function(l){l.destroy()})),l.pressureIntervals)l.pressureIntervals.hasOwnProperty(a)&&clearInterval(l.pressureIntervals[a]);l.trigger("destroyed",l.nipples),l.manager.unbindDocument(),l.off()};const i=h;function k(l){var a=this;a.ids={},a.index=0,a.collections=[],a.scroll=J(),a.config(l),a.prepareCollections();var N=function(){var l;a.collections.forEach((function(N){N.forEach((function(N){l=N.el.getBoundingClientRect(),N.position={x:a.scroll.x+l.left,y:a.scroll.y+l.top}}))}))};w(window,"resize",(function(){Z(N)}));var U=function(){a.scroll=J()};return w(window,"scroll",(function(){Z(U)})),a.collections}k.prototype=new I,k.constructor=k,k.prototype.prepareCollections=function(){var l=this;l.collections.create=l.create.bind(l),l.collections.on=l.on.bind(l),l.collections.off=l.off.bind(l),l.collections.destroy=l.destroy.bind(l),l.collections.get=function(a){var N;return l.collections.every((function(l){return!(N=l.get(a))})),N}},k.prototype.create=function(l){return this.createCollection(l)},k.prototype.createCollection=function(l){var a=this,N=new i(a,l);return a.bindCollection(N),a.collections.push(N),N},k.prototype.bindCollection=function(l){var a,N=this,U=function(l,U){a=l.type+" "+U.id+":"+l.type,N.trigger(a,U)};l.on("destroyed",N.onDestroyed.bind(N)),l.on("shown hidden rested dir plain",U),l.on("dir:up dir:right dir:down dir:left",U),l.on("plain:up plain:right plain:down plain:left",U)},k.prototype.bindDocument=function(){var l=this;l.binded||(l.bindEvt(document,"move").bindEvt(document,"end"),l.binded=!0)},k.prototype.unbindDocument=function(l){var a=this;Object.keys(a.ids).length&&!0!==l||(a.unbindEvt(document,"move").unbindEvt(document,"end"),a.binded=!1)},k.prototype.getIdentifier=function(l){var a;return l?void 0===(a=void 0===l.identifier?l.pointerId:l.identifier)&&(a=this.latest||0):a=this.index,void 0===this.ids[a]&&(this.ids[a]=this.index,this.index+=1),this.latest=a,this.ids[a]},k.prototype.removeIdentifier=function(l){var a={};for(var N in this.ids)if(this.ids[N]===l){a.id=N,a.identifier=this.ids[N],delete this.ids[N];break}return a},k.prototype.onmove=function(l){return this.onAny("move",l),!1},k.prototype.onend=function(l){return this.onAny("end",l),!1},k.prototype.oncancel=function(l){return this.onAny("end",l),!1},k.prototype.onAny=function(l,a){var N,U=this,c="processOn"+l.charAt(0).toUpperCase()+l.slice(1);a=T(a);var K=function(l,a,N){N.ids.indexOf(a)>=0&&(N[c](l),l._found_=!0)};return W(a,(function(l){N=U.getIdentifier(l),W(U.collections,K.bind(null,l,N)),l._found_||U.removeIdentifier(N)})),!1},k.prototype.destroy=function(){var l=this;l.unbindDocument(!0),l.ids={},l.index=0,l.collections.forEach((function(l){l.destroy()})),l.off()},k.prototype.onDestroyed=function(l,a){var N=this;if(N.collections.indexOf(a)<0)return!1;N.collections.splice(N.collections.indexOf(a),1)};var Q=new k;const j={create:function(l){return Q.create(l)},factory:Q};return a.default})(),l.exports=a()},13539:(l,a,N)=>{"use strict";const{Deflate:U,deflate:c,deflateRaw:K,gzip:Z}=N(13541),{Inflate:w,inflate:S,inflateRaw:T,ungzip:J}=N(13600),n=N(13577);l.exports.Deflate=U,l.exports.deflate=c,l.exports.deflateRaw=K,l.exports.gzip=Z,l.exports.Inflate=w,l.exports.inflate=S,l.exports.inflateRaw=T,l.exports.ungzip=J,l.exports.constants=n},13541:(l,a,N)=>{"use strict";const U=N(13550),c=N(13583),K=N(13588),Z=N(13570),w=N(13597),S=Object.prototype.toString,{Z_NO_FLUSH:T,Z_SYNC_FLUSH:J,Z_FULL_FLUSH:n,Z_FINISH:y,Z_OK:H,Z_STREAM_END:u,Z_DEFAULT_COMPRESSION:W,Z_DEFAULT_STRATEGY:B,Z_DEFLATED:Y}=N(13577);function C(l){this.options=c.assign({level:W,method:Y,rl:16384,windowBits:15,memLevel:8,strategy:B},l||{});let a=this.options;a.raw&&a.windowBits>0?a.windowBits=-a.windowBits:a.gzip&&a.windowBits>0&&a.windowBits<16&&(a.windowBits+=16),this.err=0,this.Ta="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let N=U.deflateInit2(this.strm,a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(N!==H)throw new Error(Z[N]);if(a.header&&U.deflateSetHeader(this.strm,a.header),a.dictionary){let l;if(l="string"===typeof a.dictionary?K.string2buf(a.dictionary):"[object ArrayBuffer]"===S.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary,N=U.deflateSetDictionary(this.strm,l),N!==H)throw new Error(Z[N]);this._dict_set=!0}}function M(l,a){const N=new C(a);if(N.push(l,!0),N.err)throw N.Ta||Z[N.err];return N.result}C.prototype.push=function(l,a){const N=this.strm,c=this.options.rl;let Z,w;if(this.ended)return!1;for(w=a===~~a?a:!0===a?y:T,"string"===typeof l?N.input=K.string2buf(l):"[object ArrayBuffer]"===S.call(l)?N.input=new Uint8Array(l):N.input=l,N.next_in=0,N.avail_in=N.input.length;;)if(0===N.avail_out&&(N.output=new Uint8Array(c),N.next_out=0,N.avail_out=c),(w===J||w===n)&&N.avail_out<=6)this.onData(N.output.subarray(0,N.next_out)),N.avail_out=0;else{if(Z=U.deflate(N,w),Z===u)return N.next_out>0&&this.onData(N.output.subarray(0,N.next_out)),Z=U.deflateEnd(this.strm),this.onEnd(Z),this.ended=!0,Z===H;if(0!==N.avail_out){if(w>0&&N.next_out>0)this.onData(N.output.subarray(0,N.next_out)),N.avail_out=0;else if(0===N.avail_in)break}else this.onData(N.output)}return!0},C.prototype.onData=function(l){this.chunks.push(l)},C.prototype.onEnd=function(l){l===H&&(this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.Ta=this.strm.Ta},l.exports.Deflate=C,l.exports.deflate=M,l.exports.deflateRaw=function(l,a){return(a=a||{}).raw=!0,M(l,a)},l.exports.gzip=function(l,a){return(a=a||{}).gzip=!0,M(l,a)},l.exports.constants=N(13577)},13600:(l,a,N)=>{"use strict";const U=N(13605),c=N(13583),K=N(13588),Z=N(13570),w=N(13597),S=N(13617),T=Object.prototype.toString,{Z_NO_FLUSH:J,Z_FINISH:n,Z_OK:y,Z_STREAM_END:H,Z_NEED_DICT:u,Z_STREAM_ERROR:W,Z_DATA_ERROR:B,Z_MEM_ERROR:Y}=N(13577);function C(l){this.options=c.assign({rl:65536,windowBits:15,to:""},l||{});const a=this.options;a.raw&&a.windowBits>=0&&a.windowBits<16&&(a.windowBits=-a.windowBits,0===a.windowBits&&(a.windowBits=-15)),!(a.windowBits>=0&&a.windowBits<16)||l&&l.windowBits||(a.windowBits+=32),a.windowBits>15&&a.windowBits<48&&0===(15&a.windowBits)&&(a.windowBits|=15),this.err=0,this.Ta="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let N=U.inflateInit2(this.strm,a.windowBits);if(N!==y)throw new Error(Z[N]);if(this.header=new S,U.inflateGetHeader(this.strm,this.header),a.dictionary&&("string"===typeof a.dictionary?a.dictionary=K.string2buf(a.dictionary):"[object ArrayBuffer]"===T.call(a.dictionary)&&(a.dictionary=new Uint8Array(a.dictionary)),a.raw&&(N=U.inflateSetDictionary(this.strm,a.dictionary),N!==y)))throw new Error(Z[N])}function M(l,a){const N=new C(a);if(N.push(l),N.err)throw N.Ta||Z[N.err];return N.result}C.prototype.push=function(l,a){const N=this.strm,c=this.options.rl,Z=this.options.dictionary;let w,S,C;if(this.ended)return!1;for(S=a===~~a?a:!0===a?n:J,"[object ArrayBuffer]"===T.call(l)?N.input=new Uint8Array(l):N.input=l,N.next_in=0,N.avail_in=N.input.length;;){for(0===N.avail_out&&(N.output=new Uint8Array(c),N.next_out=0,N.avail_out=c),w=U.inflate(N,S),w===u&&Z&&(w=U.inflateSetDictionary(N,Z),w===y?w=U.inflate(N,S):w===B&&(w=u));N.avail_in>0&&w===H&&N.state.wrap>0&&0!==l[N.next_in];)U.inflateReset(N),w=U.inflate(N,S);switch(w){case W:case B:case u:case Y:return this.onEnd(w),this.ended=!0,!1}if(C=N.avail_out,N.next_out&&(0===N.avail_out||w===H))if("string"===this.options.to){let l=K.utf8border(N.output,N.next_out),a=N.next_out-l,U=K.buf2string(N.output,l);N.next_out=a,N.avail_out=c-a,a&&N.output.set(N.output.subarray(l,l+a),0),this.onData(U)}else this.onData(N.output.length===N.next_out?N.output:N.output.subarray(0,N.next_out));if(w!==y||0!==C){if(w===H)return w=U.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,!0;if(0===N.avail_in)break}}return!0},C.prototype.onData=function(l){this.chunks.push(l)},C.prototype.onEnd=function(l){l===y&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.Ta=this.strm.Ta},l.exports.Inflate=C,l.exports.inflate=M,l.exports.inflateRaw=function(l,a){return(a=a||{}).raw=!0,M(l,a)},l.exports.ungzip=M,l.exports.constants=N(13577)},13583:l=>{"use strict";const a=(l,a)=>Object.prototype.hasOwnProperty.call(l,a);l.exports.assign=function(l){const N=Array.prototype.slice.call(arguments,1);for(;N.length;){const U=N.shift();if(U){if("object"!==typeof U)throw new TypeError(U+"must be non-object");for(const N in U)a(U,N)&&(l[N]=U[N])}}return l},l.exports.flattenChunks=l=>{let a=0;for(let U=0,c=l.length;U<c;U++)a+=l[U].length;const N=new Uint8Array(a);for(let U=0,c=0,K=l.length;U<K;U++){let a=l[U];N.set(a,c),c+=a.length}return N}},13588:l=>{"use strict";let a=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(U){a=!1}const N=new Uint8Array(256);for(let c=0;c<256;c++)N[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;N[254]=N[254]=1,l.exports.string2buf=l=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(l);let a,N,U,c,K,Z=l.length,w=0;for(c=0;c<Z;c++)N=l.charCodeAt(c),55296===(64512&N)&&c+1<Z&&(U=l.charCodeAt(c+1),56320===(64512&U)&&(N=65536+(N-55296<<10)+(U-56320),c++)),w+=N<128?1:N<2048?2:N<65536?3:4;for(a=new Uint8Array(w),K=0,c=0;K<w;c++)N=l.charCodeAt(c),55296===(64512&N)&&c+1<Z&&(U=l.charCodeAt(c+1),56320===(64512&U)&&(N=65536+(N-55296<<10)+(U-56320),c++)),N<128?a[K++]=N:N<2048?(a[K++]=192|N>>>6,a[K++]=128|63&N):N<65536?(a[K++]=224|N>>>12,a[K++]=128|N>>>6&63,a[K++]=128|63&N):(a[K++]=240|N>>>18,a[K++]=128|N>>>12&63,a[K++]=128|N>>>6&63,a[K++]=128|63&N);return a};l.exports.buf2string=(l,U)=>{const c=U||l.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(l.subarray(0,U));let K,Z;const w=new Array(2*c);for(Z=0,K=0;K<c;){let a=l[K++];if(a<128){w[Z++]=a;continue}let U=N[a];if(U>4)w[Z++]=65533,K+=U-1;else{for(a&=2===U?31:3===U?15:7;U>1&&K<c;)a=a<<6|63&l[K++],U--;U>1?w[Z++]=65533:a<65536?w[Z++]=a:(a-=65536,w[Z++]=55296|a>>10&1023,w[Z++]=56320|1023&a)}}return((l,N)=>{if(N<65534&&l.subarray&&a)return String.fromCharCode.apply(null,l.length===N?l:l.subarray(0,N));let U="";for(let a=0;a<N;a++)U+=String.fromCharCode(l[a]);return U})(w,Z)},l.exports.utf8border=(l,a)=>{(a=a||l.length)>l.length&&(a=l.length);let U=a-1;for(;U>=0&&128===(192&l[U]);)U--;return U<0||0===U?a:U+N[l[U]]>a?U:a}},13561:l=>{"use strict";l.exports=(l,a,N,U)=>{let c=65535&l,K=l>>>16&65535,Z=0;for(;0!==N;){Z=N>2e3?2e3:N,N-=Z;do{c=c+a[U++]|0,K=K+c|0}while(--Z);c%=65521,K%=65521}return c|K<<16}},13577:l=>{"use strict";l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13567:l=>{"use strict";const a=new Uint32Array((()=>{let l,a=[];for(var N=0;N<256;N++){l=N;for(var U=0;U<8;U++)l=1&l?3988292384^l>>>1:l>>>1;a[N]=l}return a})());l.exports=(l,N,U,c)=>{const K=a,Z=c+U;l^=-1;for(let a=c;a<Z;a++)l=l>>>8^K[255&(l^N[a])];return~l}},13550:(l,a,N)=>{"use strict";const{_tr_init:U,_tr_stored_block:c,_tr_flush_block:K,_tr_tally:Z,_tr_align:w}=N(13557),S=N(13561),T=N(13567),J=N(13570),{Z_NO_FLUSH:n,Z_PARTIAL_FLUSH:y,Z_FULL_FLUSH:H,Z_FINISH:u,Z_BLOCK:W,Z_OK:B,Z_STREAM_END:Y,Z_STREAM_ERROR:C,Z_DATA_ERROR:M,Z_BUF_ERROR:A,Z_DEFAULT_COMPRESSION:E,Z_FILTERED:q,Z_HUFFMAN_ONLY:b,Z_RLE:z,Z_FIXED:I,Z_DEFAULT_STRATEGY:t,Z_UNKNOWN:O,Z_DEFLATED:h}=N(13577),i=258,k=262,Q=103,j=113,f=666,p=(l,a)=>(l.Ta=J[a],a),R=l=>(l<<1)-(l>4?9:0),L=l=>{let a=l.length;for(;--a>=0;)l[a]=0};let r=(l,a,N)=>(a<<l.hash_shift^N)&l.hash_mask;const X=l=>{const a=l.state;let N=a.pending;N>l.avail_out&&(N=l.avail_out),0!==N&&(l.output.set(a.pending_buf.subarray(a.pending_out,a.pending_out+N),l.next_out),l.next_out+=N,a.pending_out+=N,l.total_out+=N,l.avail_out-=N,a.pending-=N,0===a.pending&&(a.pending_out=0))},P=(l,a)=>{K(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,a),l.block_start=l.strstart,X(l.strm)},d=(l,a)=>{l.pending_buf[l.pending++]=a},F=(l,a)=>{l.pending_buf[l.pending++]=a>>>8&255,l.pending_buf[l.pending++]=255&a},e=(l,a,N,U)=>{let c=l.avail_in;return c>U&&(c=U),0===c?0:(l.avail_in-=c,a.set(l.input.subarray(l.next_in,l.next_in+c),N),1===l.state.wrap?l.adler=S(l.adler,a,c,N):2===l.state.wrap&&(l.adler=T(l.adler,a,c,N)),l.next_in+=c,l.total_in+=c,c)},s=(l,a)=>{let N,U,c=l.max_chain_length,K=l.strstart,Z=l.prev_length,w=l.nice_match;const S=l.strstart>l.w_size-k?l.strstart-(l.w_size-k):0,T=l.window,J=l.w_mask,n=l.prev,y=l.strstart+i;let H=T[K+Z-1],u=T[K+Z];l.prev_length>=l.good_match&&(c>>=2),w>l.lookahead&&(w=l.lookahead);do{if(N=a,T[N+Z]===u&&T[N+Z-1]===H&&T[N]===T[K]&&T[++N]===T[K+1]){K+=2,N++;do{}while(T[++K]===T[++N]&&T[++K]===T[++N]&&T[++K]===T[++N]&&T[++K]===T[++N]&&T[++K]===T[++N]&&T[++K]===T[++N]&&T[++K]===T[++N]&&T[++K]===T[++N]&&K<y);if(U=i-(y-K),K=y-i,U>Z){if(l.match_start=a,Z=U,U>=w)break;H=T[K+Z-1],u=T[K+Z]}}}while((a=n[a&J])>S&&0!==--c);return Z<=l.lookahead?Z:l.lookahead},o=l=>{const a=l.w_size;let N,U,c,K,Z;do{if(K=l.window_size-l.lookahead-l.strstart,l.strstart>=a+(a-k)){l.window.set(l.window.subarray(a,a+a),0),l.match_start-=a,l.strstart-=a,l.block_start-=a,U=l.hash_size,N=U;do{c=l.head[--N],l.head[N]=c>=a?c-a:0}while(--U);U=a,N=U;do{c=l.prev[--N],l.prev[N]=c>=a?c-a:0}while(--U);K+=a}if(0===l.strm.avail_in)break;if(U=e(l.strm,l.window,l.strstart+l.lookahead,K),l.lookahead+=U,l.lookahead+l.insert>=3)for(Z=l.strstart-l.insert,l.ins_h=l.window[Z],l.ins_h=r(l,l.ins_h,l.window[Z+1]);l.insert&&(l.ins_h=r(l,l.ins_h,l.window[Z+3-1]),l.prev[Z&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=Z,Z++,l.insert--,!(l.lookahead+l.insert<3)););}while(l.lookahead<k&&0!==l.strm.avail_in)},G=(l,a)=>{let N,U;for(;;){if(l.lookahead<k){if(o(l),l.lookahead<k&&a===n)return 1;if(0===l.lookahead)break}if(N=0,l.lookahead>=3&&(l.ins_h=r(l,l.ins_h,l.window[l.strstart+3-1]),N=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),0!==N&&l.strstart-N<=l.w_size-k&&(l.match_length=s(l,N)),l.match_length>=3)if(U=Z(l,l.strstart-l.match_start,l.match_length-3),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=3){l.match_length--;do{l.strstart++,l.ins_h=r(l,l.ins_h,l.window[l.strstart+3-1]),N=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart}while(0!==--l.match_length);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=r(l,l.ins_h,l.window[l.strstart+1]);else U=Z(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(U&&(P(l,!1),0===l.strm.avail_out))return 1}return l.insert=l.strstart<2?l.strstart:2,a===u?(P(l,!0),0===l.strm.avail_out?3:4):l.last_lit&&(P(l,!1),0===l.strm.avail_out)?1:2},ml=(l,a)=>{let N,U,c;for(;;){if(l.lookahead<k){if(o(l),l.lookahead<k&&a===n)return 1;if(0===l.lookahead)break}if(N=0,l.lookahead>=3&&(l.ins_h=r(l,l.ins_h,l.window[l.strstart+3-1]),N=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=2,0!==N&&l.prev_length<l.max_lazy_match&&l.strstart-N<=l.w_size-k&&(l.match_length=s(l,N),l.match_length<=5&&(l.strategy===q||3===l.match_length&&l.strstart-l.match_start>4096)&&(l.match_length=2)),l.prev_length>=3&&l.match_length<=l.prev_length){c=l.strstart+l.lookahead-3,U=Z(l,l.strstart-1-l.prev_match,l.prev_length-3),l.lookahead-=l.prev_length-1,l.prev_length-=2;do{++l.strstart<=c&&(l.ins_h=r(l,l.ins_h,l.window[l.strstart+3-1]),N=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart)}while(0!==--l.prev_length);if(l.match_available=0,l.match_length=2,l.strstart++,U&&(P(l,!1),0===l.strm.avail_out))return 1}else if(l.match_available){if(U=Z(l,0,l.window[l.strstart-1]),U&&P(l,!1),l.strstart++,l.lookahead--,0===l.strm.avail_out)return 1}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(U=Z(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<2?l.strstart:2,a===u?(P(l,!0),0===l.strm.avail_out?3:4):l.last_lit&&(P(l,!1),0===l.strm.avail_out)?1:2};function x(l,a,N,U,c){this.good_length=l,this.max_lazy=a,this.nice_length=N,this.max_chain=U,this.func=c}const V=[new x(0,0,0,0,((l,a)=>{let N=65535;for(N>l.pending_buf_size-5&&(N=l.pending_buf_size-5);;){if(l.lookahead<=1){if(o(l),0===l.lookahead&&a===n)return 1;if(0===l.lookahead)break}l.strstart+=l.lookahead,l.lookahead=0;const U=l.block_start+N;if((0===l.strstart||l.strstart>=U)&&(l.lookahead=l.strstart-U,l.strstart=U,P(l,!1),0===l.strm.avail_out))return 1;if(l.strstart-l.block_start>=l.w_size-k&&(P(l,!1),0===l.strm.avail_out))return 1}return l.insert=0,a===u?(P(l,!0),0===l.strm.avail_out?3:4):(l.strstart>l.block_start&&(P(l,!1),l.strm.avail_out),1)})),new x(4,4,8,4,G),new x(4,5,16,8,G),new x(4,6,32,32,G),new x(4,4,16,16,ml),new x(8,16,32,32,ml),new x(8,16,128,128,ml),new x(8,32,128,256,ml),new x(32,128,258,1024,ml),new x(32,258,258,4096,ml)];function D(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=h,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),L(this.dyn_ltree),L(this.dyn_dtree),L(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),L(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),L(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const v=l=>{if(!l||!l.state)return p(l,C);l.total_in=l.total_out=0,l.data_type=O;const a=l.state;return a.pending=0,a.pending_out=0,a.wrap<0&&(a.wrap=-a.wrap),a.status=a.wrap?42:j,l.adler=2===a.wrap?0:1,a.last_flush=n,U(a),B},g=l=>{const a=v(l);var N;return a===B&&((N=l.state).window_size=2*N.w_size,L(N.head),N.max_lazy_match=V[N.level].max_lazy,N.good_match=V[N.level].good_length,N.nice_match=V[N.level].nice_length,N.max_chain_length=V[N.level].max_chain,N.strstart=0,N.block_start=0,N.lookahead=0,N.insert=0,N.match_length=N.prev_length=2,N.match_available=0,N.ins_h=0),a},ll=(l,a,N,U,c,K)=>{if(!l)return C;let Z=1;if(a===E&&(a=6),U<0?(Z=0,U=-U):U>15&&(Z=2,U-=16),c<1||c>9||N!==h||U<8||U>15||a<0||a>9||K<0||K>I)return p(l,C);8===U&&(U=9);const w=new D;return l.state=w,w.strm=l,w.wrap=Z,w.gzhead=null,w.w_bits=U,w.w_size=1<<w.w_bits,w.w_mask=w.w_size-1,w.hash_bits=c+7,w.hash_size=1<<w.hash_bits,w.hash_mask=w.hash_size-1,w.hash_shift=~~((w.hash_bits+3-1)/3),w.window=new Uint8Array(2*w.w_size),w.head=new Uint16Array(w.hash_size),w.prev=new Uint16Array(w.w_size),w.lit_bufsize=1<<c+6,w.pending_buf_size=4*w.lit_bufsize,w.pending_buf=new Uint8Array(w.pending_buf_size),w.d_buf=1*w.lit_bufsize,w.l_buf=3*w.lit_bufsize,w.level=a,w.strategy=K,w.method=N,g(l)};l.exports.deflateInit=(l,a)=>ll(l,a,h,15,8,t),l.exports.deflateInit2=ll,l.exports.deflateReset=g,l.exports.deflateResetKeep=v,l.exports.deflateSetHeader=(l,a)=>l&&l.state?2!==l.state.wrap?C:(l.state.gzhead=a,B):C,l.exports.deflate=(l,a)=>{let N,U;if(!l||!l.state||a>W||a<0)return l?p(l,C):C;const K=l.state;if(!l.output||!l.input&&0!==l.avail_in||K.status===f&&a!==u)return p(l,0===l.avail_out?A:C);K.strm=l;const S=K.last_flush;if(K.last_flush=a,42===K.status)if(2===K.wrap)l.adler=0,d(K,31),d(K,139),d(K,8),K.gzhead?(d(K,(K.gzhead.text?1:0)+(K.gzhead.hcrc?2:0)+(K.gzhead.extra?4:0)+(K.gzhead.name?8:0)+(K.gzhead.comment?16:0)),d(K,255&K.gzhead.time),d(K,K.gzhead.time>>8&255),d(K,K.gzhead.time>>16&255),d(K,K.gzhead.time>>24&255),d(K,9===K.level?2:K.strategy>=b||K.level<2?4:0),d(K,255&K.gzhead.os),K.gzhead.extra&&K.gzhead.extra.length&&(d(K,255&K.gzhead.extra.length),d(K,K.gzhead.extra.length>>8&255)),K.gzhead.hcrc&&(l.adler=T(l.adler,K.pending_buf,K.pending,0)),K.gzindex=0,K.status=69):(d(K,0),d(K,0),d(K,0),d(K,0),d(K,0),d(K,9===K.level?2:K.strategy>=b||K.level<2?4:0),d(K,3),K.status=j);else{let a=h+(K.w_bits-8<<4)<<8,N=-1;N=K.strategy>=b||K.level<2?0:K.level<6?1:6===K.level?2:3,a|=N<<6,0!==K.strstart&&(a|=32),a+=31-a%31,K.status=j,F(K,a),0!==K.strstart&&(F(K,l.adler>>>16),F(K,65535&l.adler)),l.adler=1}if(69===K.status)if(K.gzhead.extra){for(N=K.pending;K.gzindex<(65535&K.gzhead.extra.length)&&(K.pending!==K.pending_buf_size||(K.gzhead.hcrc&&K.pending>N&&(l.adler=T(l.adler,K.pending_buf,K.pending-N,N)),X(l),N=K.pending,K.pending!==K.pending_buf_size));)d(K,255&K.gzhead.extra[K.gzindex]),K.gzindex++;K.gzhead.hcrc&&K.pending>N&&(l.adler=T(l.adler,K.pending_buf,K.pending-N,N)),K.gzindex===K.gzhead.extra.length&&(K.gzindex=0,K.status=73)}else K.status=73;if(73===K.status)if(K.gzhead.name){N=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>N&&(l.adler=T(l.adler,K.pending_buf,K.pending-N,N)),X(l),N=K.pending,K.pending===K.pending_buf_size)){U=1;break}U=K.gzindex<K.gzhead.name.length?255&K.gzhead.name.charCodeAt(K.gzindex++):0,d(K,U)}while(0!==U);K.gzhead.hcrc&&K.pending>N&&(l.adler=T(l.adler,K.pending_buf,K.pending-N,N)),0===U&&(K.gzindex=0,K.status=91)}else K.status=91;if(91===K.status)if(K.gzhead.comment){N=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>N&&(l.adler=T(l.adler,K.pending_buf,K.pending-N,N)),X(l),N=K.pending,K.pending===K.pending_buf_size)){U=1;break}U=K.gzindex<K.gzhead.comment.length?255&K.gzhead.comment.charCodeAt(K.gzindex++):0,d(K,U)}while(0!==U);K.gzhead.hcrc&&K.pending>N&&(l.adler=T(l.adler,K.pending_buf,K.pending-N,N)),0===U&&(K.status=Q)}else K.status=Q;if(K.status===Q&&(K.gzhead.hcrc?(K.pending+2>K.pending_buf_size&&X(l),K.pending+2<=K.pending_buf_size&&(d(K,255&l.adler),d(K,l.adler>>8&255),l.adler=0,K.status=j)):K.status=j),0!==K.pending){if(X(l),0===l.avail_out)return K.last_flush=-1,B}else if(0===l.avail_in&&R(a)<=R(S)&&a!==u)return p(l,A);if(K.status===f&&0!==l.avail_in)return p(l,A);if(0!==l.avail_in||0!==K.lookahead||a!==n&&K.status!==f){let N=K.strategy===b?((l,a)=>{let N;for(;;){if(0===l.lookahead&&(o(l),0===l.lookahead)){if(a===n)return 1;break}if(l.match_length=0,N=Z(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,N&&(P(l,!1),0===l.strm.avail_out))return 1}return l.insert=0,a===u?(P(l,!0),0===l.strm.avail_out?3:4):l.last_lit&&(P(l,!1),0===l.strm.avail_out)?1:2})(K,a):K.strategy===z?((l,a)=>{let N,U,c,K;const w=l.window;for(;;){if(l.lookahead<=i){if(o(l),l.lookahead<=i&&a===n)return 1;if(0===l.lookahead)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(c=l.strstart-1,U=w[c],U===w[++c]&&U===w[++c]&&U===w[++c])){K=l.strstart+i;do{}while(U===w[++c]&&U===w[++c]&&U===w[++c]&&U===w[++c]&&U===w[++c]&&U===w[++c]&&U===w[++c]&&U===w[++c]&&c<K);l.match_length=i-(K-c),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(N=Z(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(N=Z(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),N&&(P(l,!1),0===l.strm.avail_out))return 1}return l.insert=0,a===u?(P(l,!0),0===l.strm.avail_out?3:4):l.last_lit&&(P(l,!1),0===l.strm.avail_out)?1:2})(K,a):V[K.level].func(K,a);if(3!==N&&4!==N||(K.status=f),1===N||3===N)return 0===l.avail_out&&(K.last_flush=-1),B;if(2===N&&(a===y?w(K):a!==W&&(c(K,0,0,!1),a===H&&(L(K.head),0===K.lookahead&&(K.strstart=0,K.block_start=0,K.insert=0))),X(l),0===l.avail_out))return K.last_flush=-1,B}return a!==u?B:K.wrap<=0?Y:(2===K.wrap?(d(K,255&l.adler),d(K,l.adler>>8&255),d(K,l.adler>>16&255),d(K,l.adler>>24&255),d(K,255&l.total_in),d(K,l.total_in>>8&255),d(K,l.total_in>>16&255),d(K,l.total_in>>24&255)):(F(K,l.adler>>>16),F(K,65535&l.adler)),X(l),K.wrap>0&&(K.wrap=-K.wrap),0!==K.pending?B:Y)},l.exports.deflateEnd=l=>{if(!l||!l.state)return C;const a=l.state.status;return 42!==a&&69!==a&&73!==a&&91!==a&&a!==Q&&a!==j&&a!==f?p(l,C):(l.state=null,a===j?p(l,M):B)},l.exports.deflateSetDictionary=(l,a)=>{let N=a.length;if(!l||!l.state)return C;const U=l.state,c=U.wrap;if(2===c||1===c&&42!==U.status||U.lookahead)return C;if(1===c&&(l.adler=S(l.adler,a,N,0)),U.wrap=0,N>=U.w_size){0===c&&(L(U.head),U.strstart=0,U.block_start=0,U.insert=0);let l=new Uint8Array(U.w_size);l.set(a.subarray(N-U.w_size,N),0),a=l,N=U.w_size}const K=l.avail_in,Z=l.next_in,w=l.input;for(l.avail_in=N,l.next_in=0,l.input=a,o(U);U.lookahead>=3;){let l=U.strstart,a=U.lookahead-2;do{U.ins_h=r(U,U.ins_h,U.window[l+3-1]),U.prev[l&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=l,l++}while(--a);U.strstart=l,U.lookahead=2,o(U)}return U.strstart+=U.lookahead,U.block_start=U.strstart,U.insert=U.lookahead,U.lookahead=0,U.match_length=U.prev_length=2,U.match_available=0,l.next_in=Z,l.input=w,l.avail_in=K,U.wrap=c,B},l.exports.deflateInfo="pako deflate (from Nodeca project)"},13617:l=>{"use strict";l.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13609:l=>{"use strict";l.exports=function(l,a){let N,U,c,K,Z,w,S,T,J,n,y,H,u,W,B,Y,C,M,A,E,q,b,z,I;const t=l.state;N=l.next_in,z=l.input,U=N+(l.avail_in-5),c=l.next_out,I=l.output,K=c-(a-l.avail_out),Z=c+(l.avail_out-257),w=t.dmax,S=t.wsize,T=t.whave,J=t.wnext,n=t.window,y=t.hold,H=t.bits,u=t.lencode,W=t.distcode,B=(1<<t.lenbits)-1,Y=(1<<t.distbits)-1;l:do{H<15&&(y+=z[N++]<<H,H+=8,y+=z[N++]<<H,H+=8),C=u[y&B];a:for(;;){if(M=C>>>24,y>>>=M,H-=M,M=C>>>16&255,0===M)I[c++]=65535&C;else{if(!(16&M)){if(0===(64&M)){C=u[(65535&C)+(y&(1<<M)-1)];continue a}if(32&M){t.mode=12;break l}l.Ta="invalid literal/length code",t.mode=30;break l}A=65535&C,M&=15,M&&(H<M&&(y+=z[N++]<<H,H+=8),A+=y&(1<<M)-1,y>>>=M,H-=M),H<15&&(y+=z[N++]<<H,H+=8,y+=z[N++]<<H,H+=8),C=W[y&Y];N:for(;;){if(M=C>>>24,y>>>=M,H-=M,M=C>>>16&255,!(16&M)){if(0===(64&M)){C=W[(65535&C)+(y&(1<<M)-1)];continue N}l.Ta="invalid distance code",t.mode=30;break l}if(E=65535&C,M&=15,H<M&&(y+=z[N++]<<H,H+=8,H<M&&(y+=z[N++]<<H,H+=8)),E+=y&(1<<M)-1,E>w){l.Ta="invalid distance too far back",t.mode=30;break l}if(y>>>=M,H-=M,M=c-K,E>M){if(M=E-M,M>T&&t.sane){l.Ta="invalid distance too far back",t.mode=30;break l}if(q=0,b=n,0===J){if(q+=S-M,M<A){A-=M;do{I[c++]=n[q++]}while(--M);q=c-E,b=I}}else if(J<M){if(q+=S+J-M,M-=J,M<A){A-=M;do{I[c++]=n[q++]}while(--M);if(q=0,J<A){M=J,A-=M;do{I[c++]=n[q++]}while(--M);q=c-E,b=I}}}else if(q+=J-M,M<A){A-=M;do{I[c++]=n[q++]}while(--M);q=c-E,b=I}for(;A>2;)I[c++]=b[q++],I[c++]=b[q++],I[c++]=b[q++],A-=3;A&&(I[c++]=b[q++],A>1&&(I[c++]=b[q++]))}else{q=c-E;do{I[c++]=I[q++],I[c++]=I[q++],I[c++]=I[q++],A-=3}while(A>2);A&&(I[c++]=I[q++],A>1&&(I[c++]=I[q++]))}break}}break}}while(N<U&&c<Z);A=H>>3,N-=A,H-=A<<3,y&=(1<<H)-1,l.next_in=N,l.next_out=c,l.avail_in=N<U?U-N+5:5-(N-U),l.avail_out=c<Z?Z-c+257:257-(c-Z),t.hold=y,t.bits=H}},13605:(l,a,N)=>{"use strict";const U=N(13561),c=N(13567),K=N(13609),Z=N(13615),{Z_FINISH:w,Z_BLOCK:S,Z_TREES:T,Z_OK:J,Z_STREAM_END:n,Z_NEED_DICT:y,Z_STREAM_ERROR:H,Z_DATA_ERROR:u,Z_MEM_ERROR:W,Z_BUF_ERROR:B,Z_DEFLATED:Y}=N(13577),C=12,M=30,A=l=>(l>>>24&255)+(l>>>8&65280)+((65280&l)<<8)+((255&l)<<24);function E(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const q=l=>{if(!l||!l.state)return H;const a=l.state;return l.total_in=l.total_out=a.total=0,l.Ta="",a.wrap&&(l.adler=1&a.wrap),a.mode=1,a.last=0,a.havedict=0,a.dmax=32768,a.head=null,a.hold=0,a.bits=0,a.lencode=a.lendyn=new Int32Array(852),a.distcode=a.distdyn=new Int32Array(592),a.sane=1,a.back=-1,J},b=l=>{if(!l||!l.state)return H;const a=l.state;return a.wsize=0,a.whave=0,a.wnext=0,q(l)},z=(l,a)=>{let N;if(!l||!l.state)return H;const U=l.state;return a<0?(N=0,a=-a):(N=1+(a>>4),a<48&&(a&=15)),a&&(a<8||a>15)?H:(null!==U.window&&U.wbits!==a&&(U.window=null),U.wrap=N,U.wbits=a,b(l))},I=(l,a)=>{if(!l)return H;const N=new E;l.state=N,N.window=null;const U=z(l,a);return U!==J&&(l.state=null),U};let t,O,h=!0;const i=l=>{if(h){t=new Int32Array(512),O=new Int32Array(32);let a=0;for(;a<144;)l.lens[a++]=8;for(;a<256;)l.lens[a++]=9;for(;a<280;)l.lens[a++]=7;for(;a<288;)l.lens[a++]=8;for(Z(1,l.lens,0,288,t,0,l.work,{bits:9}),a=0;a<32;)l.lens[a++]=5;Z(2,l.lens,0,32,O,0,l.work,{bits:5}),h=!1}l.lencode=t,l.lenbits=9,l.distcode=O,l.distbits=5},k=(l,a,N,U)=>{let c;const K=l.state;return null===K.window&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new Uint8Array(K.wsize)),U>=K.wsize?(K.window.set(a.subarray(N-K.wsize,N),0),K.wnext=0,K.whave=K.wsize):(c=K.wsize-K.wnext,c>U&&(c=U),K.window.set(a.subarray(N-U,N-U+c),K.wnext),(U-=c)?(K.window.set(a.subarray(N-U,N),0),K.wnext=U,K.whave=K.wsize):(K.wnext+=c,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=c))),0};l.exports.inflateReset=b,l.exports.inflateReset2=z,l.exports.inflateResetKeep=q,l.exports.inflateInit=l=>I(l,15),l.exports.inflateInit2=I,l.exports.inflate=(l,a)=>{let N,E,q,b,z,I,t,O,h,Q,j,f,p,R,L,r,X,P,d,F,e,s,o=0;const G=new Uint8Array(4);let ml,x;const V=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!l||!l.state||!l.output||!l.input&&0!==l.avail_in)return H;N=l.state,N.mode===C&&(N.mode=13),z=l.next_out,q=l.output,t=l.avail_out,b=l.next_in,E=l.input,I=l.avail_in,O=N.hold,h=N.bits,Q=I,j=t,s=J;l:for(;;)switch(N.mode){case 1:if(0===N.wrap){N.mode=13;break}for(;h<16;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(2&N.wrap&&35615===O){N.check=0,G[0]=255&O,G[1]=O>>>8&255,N.check=c(N.check,G,2,0),O=0,h=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&O)<<8)+(O>>8))%31){l.Ta="incorrect header check",N.mode=M;break}if((15&O)!==Y){l.Ta="unknown compression method",N.mode=M;break}if(O>>>=4,h-=4,e=8+(15&O),0===N.wbits)N.wbits=e;else if(e>N.wbits){l.Ta="invalid window size",N.mode=M;break}N.dmax=1<<N.wbits,l.adler=N.check=1,N.mode=512&O?10:C,O=0,h=0;break;case 2:for(;h<16;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(N.flags=O,(255&N.flags)!==Y){l.Ta="unknown compression method",N.mode=M;break}if(57344&N.flags){l.Ta="unknown header flags set",N.mode=M;break}N.head&&(N.head.text=O>>8&1),512&N.flags&&(G[0]=255&O,G[1]=O>>>8&255,N.check=c(N.check,G,2,0)),O=0,h=0,N.mode=3;case 3:for(;h<32;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}N.head&&(N.head.time=O),512&N.flags&&(G[0]=255&O,G[1]=O>>>8&255,G[2]=O>>>16&255,G[3]=O>>>24&255,N.check=c(N.check,G,4,0)),O=0,h=0,N.mode=4;case 4:for(;h<16;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}N.head&&(N.head.xflags=255&O,N.head.os=O>>8),512&N.flags&&(G[0]=255&O,G[1]=O>>>8&255,N.check=c(N.check,G,2,0)),O=0,h=0,N.mode=5;case 5:if(1024&N.flags){for(;h<16;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}N.length=O,N.head&&(N.head.extra_len=O),512&N.flags&&(G[0]=255&O,G[1]=O>>>8&255,N.check=c(N.check,G,2,0)),O=0,h=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(f=N.length,f>I&&(f=I),f&&(N.head&&(e=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Uint8Array(N.head.extra_len)),N.head.extra.set(E.subarray(b,b+f),e)),512&N.flags&&(N.check=c(N.check,E,f,b)),I-=f,b+=f,N.length-=f),N.length))break l;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(0===I)break l;f=0;do{e=E[b+f++],N.head&&e&&N.length<65536&&(N.head.name+=String.fromCharCode(e))}while(e&&f<I);if(512&N.flags&&(N.check=c(N.check,E,f,b)),I-=f,b+=f,e)break l}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(0===I)break l;f=0;do{e=E[b+f++],N.head&&e&&N.length<65536&&(N.head.comment+=String.fromCharCode(e))}while(e&&f<I);if(512&N.flags&&(N.check=c(N.check,E,f,b)),I-=f,b+=f,e)break l}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;h<16;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(O!==(65535&N.check)){l.Ta="header crc mismatch",N.mode=M;break}O=0,h=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),l.adler=N.check=0,N.mode=C;break;case 10:for(;h<32;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}l.adler=N.check=A(O),O=0,h=0,N.mode=11;case 11:if(0===N.havedict)return l.next_out=z,l.avail_out=t,l.next_in=b,l.avail_in=I,N.hold=O,N.bits=h,y;l.adler=N.check=1,N.mode=C;case C:if(a===S||a===T)break l;case 13:if(N.last){O>>>=7&h,h-=7&h,N.mode=27;break}for(;h<3;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}switch(N.last=1&O,O>>>=1,h-=1,3&O){case 0:N.mode=14;break;case 1:if(i(N),N.mode=20,a===T){O>>>=2,h-=2;break l}break;case 2:N.mode=17;break;case 3:l.Ta="invalid block type",N.mode=M}O>>>=2,h-=2;break;case 14:for(O>>>=7&h,h-=7&h;h<32;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if((65535&O)!==(O>>>16^65535)){l.Ta="invalid stored block lengths",N.mode=M;break}if(N.length=65535&O,O=0,h=0,N.mode=15,a===T)break l;case 15:N.mode=16;case 16:if(f=N.length,f){if(f>I&&(f=I),f>t&&(f=t),0===f)break l;q.set(E.subarray(b,b+f),z),I-=f,b+=f,t-=f,z+=f,N.length-=f;break}N.mode=C;break;case 17:for(;h<14;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(N.nlen=257+(31&O),O>>>=5,h-=5,N.ndist=1+(31&O),O>>>=5,h-=5,N.ncode=4+(15&O),O>>>=4,h-=4,N.nlen>286||N.ndist>30){l.Ta="too many length or distance symbols",N.mode=M;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;h<3;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}N.lens[V[N.have++]]=7&O,O>>>=3,h-=3}for(;N.have<19;)N.lens[V[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,ml={bits:N.lenbits},s=Z(0,N.lens,0,19,N.lencode,0,N.work,ml),N.lenbits=ml.bits,s){l.Ta="invalid code lengths set",N.mode=M;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;o=N.lencode[O&(1<<N.lenbits)-1],L=o>>>24,r=o>>>16&255,X=65535&o,!(L<=h);){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(X<16)O>>>=L,h-=L,N.lens[N.have++]=X;else{if(16===X){for(x=L+2;h<x;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(O>>>=L,h-=L,0===N.have){l.Ta="invalid bit length repeat",N.mode=M;break}e=N.lens[N.have-1],f=3+(3&O),O>>>=2,h-=2}else if(17===X){for(x=L+3;h<x;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}O>>>=L,h-=L,e=0,f=3+(7&O),O>>>=3,h-=3}else{for(x=L+7;h<x;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}O>>>=L,h-=L,e=0,f=11+(127&O),O>>>=7,h-=7}if(N.have+f>N.nlen+N.ndist){l.Ta="invalid bit length repeat",N.mode=M;break}for(;f--;)N.lens[N.have++]=e}}if(N.mode===M)break;if(0===N.lens[256]){l.Ta="invalid code -- missing end-of-block",N.mode=M;break}if(N.lenbits=9,ml={bits:N.lenbits},s=Z(1,N.lens,0,N.nlen,N.lencode,0,N.work,ml),N.lenbits=ml.bits,s){l.Ta="invalid literal/lengths set",N.mode=M;break}if(N.distbits=6,N.distcode=N.distdyn,ml={bits:N.distbits},s=Z(2,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,ml),N.distbits=ml.bits,s){l.Ta="invalid distances set",N.mode=M;break}if(N.mode=20,a===T)break l;case 20:N.mode=21;case 21:if(I>=6&&t>=258){l.next_out=z,l.avail_out=t,l.next_in=b,l.avail_in=I,N.hold=O,N.bits=h,K(l,j),z=l.next_out,q=l.output,t=l.avail_out,b=l.next_in,E=l.input,I=l.avail_in,O=N.hold,h=N.bits,N.mode===C&&(N.back=-1);break}for(N.back=0;o=N.lencode[O&(1<<N.lenbits)-1],L=o>>>24,r=o>>>16&255,X=65535&o,!(L<=h);){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(r&&0===(240&r)){for(P=L,d=r,F=X;o=N.lencode[F+((O&(1<<P+d)-1)>>P)],L=o>>>24,r=o>>>16&255,X=65535&o,!(P+L<=h);){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}O>>>=P,h-=P,N.back+=P}if(O>>>=L,h-=L,N.back+=L,N.length=X,0===r){N.mode=26;break}if(32&r){N.back=-1,N.mode=C;break}if(64&r){l.Ta="invalid literal/length code",N.mode=M;break}N.extra=15&r,N.mode=22;case 22:if(N.extra){for(x=N.extra;h<x;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}N.length+=O&(1<<N.extra)-1,O>>>=N.extra,h-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;o=N.distcode[O&(1<<N.distbits)-1],L=o>>>24,r=o>>>16&255,X=65535&o,!(L<=h);){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(0===(240&r)){for(P=L,d=r,F=X;o=N.distcode[F+((O&(1<<P+d)-1)>>P)],L=o>>>24,r=o>>>16&255,X=65535&o,!(P+L<=h);){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}O>>>=P,h-=P,N.back+=P}if(O>>>=L,h-=L,N.back+=L,64&r){l.Ta="invalid distance code",N.mode=M;break}N.offset=X,N.extra=15&r,N.mode=24;case 24:if(N.extra){for(x=N.extra;h<x;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}N.offset+=O&(1<<N.extra)-1,O>>>=N.extra,h-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){l.Ta="invalid distance too far back",N.mode=M;break}N.mode=25;case 25:if(0===t)break l;if(f=j-t,N.offset>f){if(f=N.offset-f,f>N.whave&&N.sane){l.Ta="invalid distance too far back",N.mode=M;break}f>N.wnext?(f-=N.wnext,p=N.wsize-f):p=N.wnext-f,f>N.length&&(f=N.length),R=N.window}else R=q,p=z-N.offset,f=N.length;f>t&&(f=t),t-=f,N.length-=f;do{q[z++]=R[p++]}while(--f);0===N.length&&(N.mode=21);break;case 26:if(0===t)break l;q[z++]=N.length,t--,N.mode=21;break;case 27:if(N.wrap){for(;h<32;){if(0===I)break l;I--,O|=E[b++]<<h,h+=8}if(j-=t,l.total_out+=j,N.total+=j,j&&(l.adler=N.check=N.flags?c(N.check,q,j,z-j):U(N.check,q,j,z-j)),j=t,(N.flags?O:A(O))!==N.check){l.Ta="incorrect data check",N.mode=M;break}O=0,h=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;h<32;){if(0===I)break l;I--,O+=E[b++]<<h,h+=8}if(O!==(4294967295&N.total)){l.Ta="incorrect length check",N.mode=M;break}O=0,h=0}N.mode=29;case 29:s=n;break l;case M:s=u;break l;case 31:return W;default:return H}return l.next_out=z,l.avail_out=t,l.next_in=b,l.avail_in=I,N.hold=O,N.bits=h,(N.wsize||j!==l.avail_out&&N.mode<M&&(N.mode<27||a!==w))&&k(l,l.output,l.next_out,j-l.avail_out)?(N.mode=31,W):(Q-=l.avail_in,j-=l.avail_out,l.total_in+=Q,l.total_out+=j,N.total+=j,N.wrap&&j&&(l.adler=N.check=N.flags?c(N.check,q,j,l.next_out-j):U(N.check,q,j,l.next_out-j)),l.data_type=N.bits+(N.last?64:0)+(N.mode===C?128:0)+(20===N.mode||15===N.mode?256:0),(0===Q&&0===j||a===w)&&s===J&&(s=B),s)},l.exports.inflateEnd=l=>{if(!l||!l.state)return H;let a=l.state;return a.window&&(a.window=null),l.state=null,J},l.exports.inflateGetHeader=(l,a)=>{if(!l||!l.state)return H;const N=l.state;return 0===(2&N.wrap)?H:(N.head=a,a.done=!1,J)},l.exports.inflateSetDictionary=(l,a)=>{const N=a.length;let c,K,Z;return l&&l.state?(c=l.state,0!==c.wrap&&11!==c.mode?H:11===c.mode&&(K=1,K=U(K,a,N,0),K!==c.check)?u:(Z=k(l,a,N,N),Z?(c.mode=31,W):(c.havedict=1,J))):H},l.exports.inflateInfo="pako inflate (from Nodeca project)"},13615:l=>{"use strict";const a=15,N=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),U=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),c=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),K=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);l.exports=(l,Z,w,S,T,J,n,y)=>{const H=y.bits;let u,W,B,Y,C,M,A=0,E=0,q=0,b=0,z=0,I=0,t=0,O=0,h=0,i=0,k=null,Q=0;const j=new Uint16Array(16),f=new Uint16Array(16);let p,R,L,r=null,X=0;for(A=0;A<=a;A++)j[A]=0;for(E=0;E<S;E++)j[Z[w+E]]++;for(z=H,b=a;b>=1&&0===j[b];b--);if(z>b&&(z=b),0===b)return T[J++]=20971520,T[J++]=20971520,y.bits=1,0;for(q=1;q<b&&0===j[q];q++);for(z<q&&(z=q),O=1,A=1;A<=a;A++)if(O<<=1,O-=j[A],O<0)return-1;if(O>0&&(0===l||1!==b))return-1;for(f[1]=0,A=1;A<a;A++)f[A+1]=f[A]+j[A];for(E=0;E<S;E++)0!==Z[w+E]&&(n[f[Z[w+E]]++]=E);if(0===l?(k=r=n,M=19):1===l?(k=N,Q-=257,r=U,X-=257,M=256):(k=c,r=K,M=-1),i=0,E=0,A=q,C=J,I=z,t=0,B=-1,h=1<<z,Y=h-1,1===l&&h>852||2===l&&h>592)return 1;for(;;){p=A-t,n[E]<M?(R=0,L=n[E]):n[E]>M?(R=r[X+n[E]],L=k[Q+n[E]]):(R=96,L=0),u=1<<A-t,W=1<<I,q=W;do{W-=u,T[C+(i>>t)+W]=p<<24|R<<16|L}while(0!==W);for(u=1<<A-1;i&u;)u>>=1;if(0!==u?(i&=u-1,i+=u):i=0,E++,0===--j[A]){if(A===b)break;A=Z[w+n[E]]}if(A>z&&(i&Y)!==B){for(0===t&&(t=z),C+=q,I=A-t,O=1<<I;I+t<b&&(O-=j[I+t],!(O<=0));)I++,O<<=1;if(h+=1<<I,1===l&&h>852||2===l&&h>592)return 1;B=i&Y,T[B]=z<<24|I<<16|C-J}}return 0!==i&&(T[C+i]=A-t<<24|64<<16),y.bits=z,0}},13570:l=>{"use strict";l.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13557:l=>{"use strict";function a(l){let a=l.length;for(;--a>=0;)l[a]=0}const N=256,U=286,c=30,K=15,Z=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),w=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),S=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),J=new Array(576);a(J);const n=new Array(60);a(n);const y=new Array(512);a(y);const H=new Array(256);a(H);const u=new Array(29);a(u);const W=new Array(c);function B(l,a,N,U,c){this.static_tree=l,this.extra_bits=a,this.extra_base=N,this.elems=U,this.max_length=c,this.has_stree=l&&l.length}let Y,C,M;function A(l,a){this.dyn_tree=l,this.max_code=0,this.stat_desc=a}a(W);const E=l=>l<256?y[l]:y[256+(l>>>7)],q=(l,a)=>{l.pending_buf[l.pending++]=255&a,l.pending_buf[l.pending++]=a>>>8&255},b=(l,a,N)=>{l.bi_valid>16-N?(l.bi_buf|=a<<l.bi_valid&65535,q(l,l.bi_buf),l.bi_buf=a>>16-l.bi_valid,l.bi_valid+=N-16):(l.bi_buf|=a<<l.bi_valid&65535,l.bi_valid+=N)},z=(l,a,N)=>{b(l,N[2*a],N[2*a+1])},I=(l,a)=>{let N=0;do{N|=1&l,l>>>=1,N<<=1}while(--a>0);return N>>>1},t=(l,a,N)=>{const U=new Array(16);let c,Z,w=0;for(c=1;c<=K;c++)U[c]=w=w+N[c-1]<<1;for(Z=0;Z<=a;Z++){let a=l[2*Z+1];0!==a&&(l[2*Z]=I(U[a]++,a))}},O=l=>{let a;for(a=0;a<U;a++)l.dyn_ltree[2*a]=0;for(a=0;a<c;a++)l.dyn_dtree[2*a]=0;for(a=0;a<19;a++)l.bl_tree[2*a]=0;l.dyn_ltree[512]=1,l.opt_len=l.static_len=0,l.last_lit=l.matches=0},h=l=>{l.bi_valid>8?q(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},i=(l,a,N,U)=>{const c=2*a,K=2*N;return l[c]<l[K]||l[c]===l[K]&&U[a]<=U[N]},k=(l,a,N)=>{const U=l.heap[N];let c=N<<1;for(;c<=l.heap_len&&(c<l.heap_len&&i(a,l.heap[c+1],l.heap[c],l.depth)&&c++,!i(a,U,l.heap[c],l.depth));)l.heap[N]=l.heap[c],N=c,c<<=1;l.heap[N]=U},Q=(l,a,U)=>{let c,K,S,T,J=0;if(0!==l.last_lit)do{c=l.pending_buf[l.d_buf+2*J]<<8|l.pending_buf[l.d_buf+2*J+1],K=l.pending_buf[l.l_buf+J],J++,0===c?z(l,K,a):(S=H[K],z(l,S+N+1,a),T=Z[S],0!==T&&(K-=u[S],b(l,K,T)),c--,S=E(c),z(l,S,U),T=w[S],0!==T&&(c-=W[S],b(l,c,T)))}while(J<l.last_lit);z(l,256,a)},j=(l,a)=>{const N=a.dyn_tree,U=a.stat_desc.static_tree,c=a.stat_desc.has_stree,Z=a.stat_desc.elems;let w,S,T,J=-1;for(l.heap_len=0,l.heap_max=573,w=0;w<Z;w++)0!==N[2*w]?(l.heap[++l.heap_len]=J=w,l.depth[w]=0):N[2*w+1]=0;for(;l.heap_len<2;)T=l.heap[++l.heap_len]=J<2?++J:0,N[2*T]=1,l.depth[T]=0,l.opt_len--,c&&(l.static_len-=U[2*T+1]);for(a.max_code=J,w=l.heap_len>>1;w>=1;w--)k(l,N,w);T=Z;do{w=l.heap[1],l.heap[1]=l.heap[l.heap_len--],k(l,N,1),S=l.heap[1],l.heap[--l.heap_max]=w,l.heap[--l.heap_max]=S,N[2*T]=N[2*w]+N[2*S],l.depth[T]=(l.depth[w]>=l.depth[S]?l.depth[w]:l.depth[S])+1,N[2*w+1]=N[2*S+1]=T,l.heap[1]=T++,k(l,N,1)}while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],((l,a)=>{const N=a.dyn_tree,U=a.max_code,c=a.stat_desc.static_tree,Z=a.stat_desc.has_stree,w=a.stat_desc.extra_bits,S=a.stat_desc.extra_base,T=a.stat_desc.max_length;let J,n,y,H,u,W,B=0;for(H=0;H<=K;H++)l.bl_count[H]=0;for(N[2*l.heap[l.heap_max]+1]=0,J=l.heap_max+1;J<573;J++)n=l.heap[J],H=N[2*N[2*n+1]+1]+1,H>T&&(H=T,B++),N[2*n+1]=H,n>U||(l.bl_count[H]++,u=0,n>=S&&(u=w[n-S]),W=N[2*n],l.opt_len+=W*(H+u),Z&&(l.static_len+=W*(c[2*n+1]+u)));if(0!==B){do{for(H=T-1;0===l.bl_count[H];)H--;l.bl_count[H]--,l.bl_count[H+1]+=2,l.bl_count[T]--,B-=2}while(B>0);for(H=T;0!==H;H--)for(n=l.bl_count[H];0!==n;)y=l.heap[--J],y>U||(N[2*y+1]!==H&&(l.opt_len+=(H-N[2*y+1])*N[2*y],N[2*y+1]=H),n--)}})(l,a),t(N,J,l.bl_count)},f=(l,a,N)=>{let U,c,K=-1,Z=a[1],w=0,S=7,T=4;for(0===Z&&(S=138,T=3),a[2*(N+1)+1]=65535,U=0;U<=N;U++)c=Z,Z=a[2*(U+1)+1],++w<S&&c===Z||(w<T?l.bl_tree[2*c]+=w:0!==c?(c!==K&&l.bl_tree[2*c]++,l.bl_tree[32]++):w<=10?l.bl_tree[34]++:l.bl_tree[36]++,w=0,K=c,0===Z?(S=138,T=3):c===Z?(S=6,T=3):(S=7,T=4))},p=(l,a,N)=>{let U,c,K=-1,Z=a[1],w=0,S=7,T=4;for(0===Z&&(S=138,T=3),U=0;U<=N;U++)if(c=Z,Z=a[2*(U+1)+1],!(++w<S&&c===Z)){if(w<T)do{z(l,c,l.bl_tree)}while(0!==--w);else 0!==c?(c!==K&&(z(l,c,l.bl_tree),w--),z(l,16,l.bl_tree),b(l,w-3,2)):w<=10?(z(l,17,l.bl_tree),b(l,w-3,3)):(z(l,18,l.bl_tree),b(l,w-11,7));w=0,K=c,0===Z?(S=138,T=3):c===Z?(S=6,T=3):(S=7,T=4)}};let R=!1;const L=(l,a,N,U)=>{b(l,0+(U?1:0),3),((l,a,N,U)=>{h(l),U&&(q(l,N),q(l,~N)),l.pending_buf.set(l.window.subarray(a,a+N),l.pending),l.pending+=N})(l,a,N,!0)};l.exports._tr_init=l=>{R||((()=>{let l,a,N,T,A;const E=new Array(16);for(N=0,T=0;T<28;T++)for(u[T]=N,l=0;l<1<<Z[T];l++)H[N++]=T;for(H[N-1]=T,A=0,T=0;T<16;T++)for(W[T]=A,l=0;l<1<<w[T];l++)y[A++]=T;for(A>>=7;T<c;T++)for(W[T]=A<<7,l=0;l<1<<w[T]-7;l++)y[256+A++]=T;for(a=0;a<=K;a++)E[a]=0;for(l=0;l<=143;)J[2*l+1]=8,l++,E[8]++;for(;l<=255;)J[2*l+1]=9,l++,E[9]++;for(;l<=279;)J[2*l+1]=7,l++,E[7]++;for(;l<=287;)J[2*l+1]=8,l++,E[8]++;for(t(J,287,E),l=0;l<c;l++)n[2*l+1]=5,n[2*l]=I(l,5);Y=new B(J,Z,257,U,K),C=new B(n,w,0,c,K),M=new B(new Array(0),S,0,19,7)})(),R=!0),l.l_desc=new A(l.dyn_ltree,Y),l.d_desc=new A(l.dyn_dtree,C),l.bl_desc=new A(l.bl_tree,M),l.bi_buf=0,l.bi_valid=0,O(l)},l.exports._tr_stored_block=L,l.exports._tr_flush_block=(l,a,U,c)=>{let K,Z,w=0;l.level>0?(2===l.strm.data_type&&(l.strm.data_type=(l=>{let a,U=4093624447;for(a=0;a<=31;a++,U>>>=1)if(1&U&&0!==l.dyn_ltree[2*a])return 0;if(0!==l.dyn_ltree[18]||0!==l.dyn_ltree[20]||0!==l.dyn_ltree[26])return 1;for(a=32;a<N;a++)if(0!==l.dyn_ltree[2*a])return 1;return 0})(l)),j(l,l.l_desc),j(l,l.d_desc),w=(l=>{let a;for(f(l,l.dyn_ltree,l.l_desc.max_code),f(l,l.dyn_dtree,l.d_desc.max_code),j(l,l.bl_desc),a=18;a>=3&&0===l.bl_tree[2*T[a]+1];a--);return l.opt_len+=3*(a+1)+5+5+4,a})(l),K=l.opt_len+3+7>>>3,Z=l.static_len+3+7>>>3,Z<=K&&(K=Z)):K=Z=U+5,U+4<=K&&-1!==a?L(l,a,U,c):4===l.strategy||Z===K?(b(l,2+(c?1:0),3),Q(l,J,n)):(b(l,4+(c?1:0),3),((l,a,N,U)=>{let c;for(b(l,a-257,5),b(l,N-1,5),b(l,U-4,4),c=0;c<U;c++)b(l,l.bl_tree[2*T[c]+1],3);p(l,l.dyn_ltree,a-1),p(l,l.dyn_dtree,N-1)})(l,l.l_desc.max_code+1,l.d_desc.max_code+1,w+1),Q(l,l.dyn_ltree,l.dyn_dtree)),O(l),c&&h(l)},l.exports._tr_tally=(l,a,U)=>(l.pending_buf[l.d_buf+2*l.last_lit]=a>>>8&255,l.pending_buf[l.d_buf+2*l.last_lit+1]=255&a,l.pending_buf[l.l_buf+l.last_lit]=255&U,l.last_lit++,0===a?l.dyn_ltree[2*U]++:(l.matches++,a--,l.dyn_ltree[2*(H[U]+N+1)]++,l.dyn_dtree[2*E(a)]++),l.last_lit===l.lit_bufsize-1),l.exports._tr_align=l=>{b(l,2,3),z(l,256,J),(l=>{16===l.bi_valid?(q(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=255&l.bi_buf,l.bi_buf>>=8,l.bi_valid-=8)})(l)}},13597:l=>{"use strict";l.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Ta="",this.state=null,this.data_type=2,this.adler=0}},13207:l=>{function a(l,a,N){for(var U=l.length,c=-1/0,K=1/0,Z=0;Z<U;Z++){var w=(N[0][Z]-l[Z])/a[Z],S=(N[1][Z]-l[Z])/a[Z];if(w>S){var T=w;w=S,S=T}if(S<c||w>K)return 1/0;w>c&&(c=w),S<K&&(K=S)}return c>K?1/0:c}l.exports=function(l,N,U,c){var K=a(N,U,c);if(K===1/0)l=null;else{l=l||[];for(var Z=0;Z<N.length;Z++)l[Z]=N[Z]+U[Z]*K}return l},l.exports.distance=a},14610:(l,a,N)=>{"use strict";N.d(a,{c:()=>Z});var U=N(30);const c=U.useLayoutEffect;const K=function(l){var a=(0,U.useRef)(l);return c((function(){a.current=l})),a};var Z=function(l){var a=K(l);(0,U.Za)((function(){var l=function(l){var N;if(null!=a.current&&(N=a.current(l)),l.defaultPrevented&&(l.returnValue=""),"string"===typeof N)return l.returnValue=N,N};return window.addEventListener("beforeunload",l),function(){window.removeEventListener("beforeunload",l)}}),[])}},14563:(l,a,N)=>{"use strict";var U=N(14570),c=Array.prototype.concat,K=Array.prototype.slice,Z=l.exports=function(l){for(var a=[],N=0,Z=l.length;N<Z;N++){var w=l[N];U(w)?a=c.call(a,K.call(w)):a.push(w)}return a};Z.wrap=function(l){return function(){return l(Z(arguments))}}},14570:l=>{l.exports=function(l){return!(!l||"string"===typeof l)&&(l instanceof Array||Array.isArray(l)||l.length>=0&&(l.splice instanceof Function||Object.getOwnPropertyDescriptor(l,l.length-1)&&"String"!==l.constructor.name))}},13490:(l,a,N)=>{var U=N(13497);function c(l){for(var a,N,c=0,K=l.length,Z=0;Z<l.length;){for(a=l[Z],N=0;Z<K&&l[Z]===a;)++Z,++N;c+=U.log2(N)/7|0,c+=U.log2(a>>>0)/7|0,c+=2}return c}a.size=c,a.encode=function(l,a){a||(a=new Uint8Array(c(l)));for(var N,U,K=0,Z=a.length,w=0;w<l.length;){for(N=l[w],U=0;w<l.length&&l[w]===N;)++w,++U;for(;K<Z&&U>=128;)a[K++]=128+(127&U),U>>>=7;if(K>=Z)throw new Error("RLE buffer overflow");for(a[K++]=U,N>>>=0;K<Z&&N>=128;)a[K++]=128+(127&N),N>>>=7;if(K>=Z)throw new Error("RLE buffer overflow");a[K++]=N}return a},a.decode=function(l,a){for(var N,U,c,K,Z=a.length,w=l.length,S=0,T=0;T<w;){for(N=0,U=0;T<w&&l[T]>=128;)N+=(127&l[T++])<<U,U+=7;if(N+=l[T++]<<U,T>=w)throw new Error("RLE buffer underrun");if(S+N>Z)throw new Error("Chunk buffer overflow");for(c=0,U=0;T<w&&l[T]>=128;)c+=(127&l[T++])<<U,U+=7;if(T>=w)throw new Error("RLE buffer underrun");for(c+=l[T++]<<U,K=0;K<N;++K)a[S++]=c}return a}},13497:(l,a)=>{"use strict";function N(l){var a=32;return(l&=-l)&&a--,65535&l&&(a-=16),16711935&l&&(a-=8),252645135&l&&(a-=4),858993459&l&&(a-=2),1431655765&l&&(a-=1),a}a.INT_BITS=32,a.INT_MAX=2147483647,a.INT_MIN=-1<<31,a.sign=function(l){return(l>0)-(l<0)},a.abs=function(l){var a=l>>31;return(l^a)-a},a.min=function(l,a){return a^(l^a)&-(l<a)},a.max=function(l,a){return l^(l^a)&-(l<a)},a.isPow2=function(l){return!(l&l-1)&&!!l},a.log2=function(l){var a,N;return a=(l>65535)<<4,a|=N=((l>>>=a)>255)<<3,a|=N=((l>>>=N)>15)<<2,(a|=N=((l>>>=N)>3)<<1)|(l>>>=N)>>1},a.log10=function(l){return l>=1e9?9:l>=1e8?8:l>=1e7?7:l>=1e6?6:l>=1e5?5:l>=1e4?4:l>=1e3?3:l>=100?2:l>=10?1:0},a.popCount=function(l){return 16843009*((l=(858993459&(l-=l>>>1&1431655765))+(l>>>2&858993459))+(l>>>4)&252645135)>>>24},a.countTrailingZeros=N,a.nextPow2=function(l){return l+=0===l,--l,l|=l>>>1,l|=l>>>2,l|=l>>>4,l|=l>>>8,(l|=l>>>16)+1},a.prevPow2=function(l){return l|=l>>>1,l|=l>>>2,l|=l>>>4,l|=l>>>8,(l|=l>>>16)-(l>>>1)},a.parity=function(l){return l^=l>>>16,l^=l>>>8,l^=l>>>4,27030>>>(l&=15)&1};var U=new Array(256);!function(l){for(var a=0;a<256;++a){var N=a,U=a,c=7;for(N>>>=1;N;N>>>=1)U<<=1,U|=1&N,--c;l[a]=U<<c&255}}(U),a.reverse=function(l){return U[255&l]<<24|U[l>>>8&255]<<16|U[l>>>16&255]<<8|U[l>>>24&255]},a.interleave2=function(l,a){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l&=65535)|l<<8))|l<<4))|l<<2))|l<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))<<1},a.deinterleave2=function(l,a){return(l=65535&((l=16711935&((l=252645135&((l=858993459&((l=l>>>a&1431655765)|l>>>1))|l>>>2))|l>>>4))|l>>>16))<<16>>16},a.interleave3=function(l,a,N){return l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2),(l|=(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<1)|(N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2))<<2},a.deinterleave3=function(l,a){return(l=1023&((l=4278190335&((l=251719695&((l=3272356035&((l=l>>>a&1227133513)|l>>>2))|l>>>4))|l>>>8))|l>>>16))<<22>>22},a.nextCombination=function(l){var a=l|l-1;return a+1|(~a&-~a)-1>>>N(l)+1}},13530:l=>{"use strict";l.exports=function(l,a,N,U){var c=self||window;try{try{var K;try{K=new c.Blob([l])}catch(T){(K=new(c.BlobBuilder||c.WebKitBlobBuilder||c.MozBlobBuilder||c.MSBlobBuilder)).append(l),K=K.getBlob()}var Z=c.URL||c.webkitURL,w=Z.createObjectURL(K),S=new c[a](w,N);return Z.revokeObjectURL(w),S}catch(T){return new c[a]("data:application/javascript,".concat(encodeURIComponent(l)),N)}}catch(T){if(!U)throw Error("Inline worker is not supported");return new c[a](U,N)}}},13187:(l,a,N)=>{"use strict";function U(l,a,N,U,c){var K={};return Object.keys(U).forEach((function(l){K[l]=U[l]})),K.enumerable=!!K.enumerable,K.configurable=!!K.configurable,("value"in K||K.initializer)&&(K.writable=!0),K=N.slice().reverse().reduce((function(N,U){return U(l,a,N)||N}),K),c&&void 0!==K.initializer&&(K.value=K.initializer?K.initializer.call(c):void 0,K.initializer=void 0),void 0===K.initializer&&(Object.defineProperty(l,a,K),K=null),K}N.d(a,{c:()=>U})},13180:(l,a,N)=>{"use strict";function U(l,a,N,U){N&&Object.defineProperty(l,a,{enumerable:N.enumerable,configurable:N.configurable,writable:N.writable,value:N.initializer?N.initializer.call(U):void 0})}N.d(a,{e:()=>U})},14599:(l,a,N)=>{"use strict";N.d(a,{e:()=>Z,f:()=>n,h:()=>w,i:()=>K,j:()=>S,n:()=>c,q:()=>T,t:()=>J});var U=N(12647);class c{constructor(){this._easingMode=c.EASINGMODE_EASEIN}setEasingMode(l){const a=Math.min(Math.max(l,0),2);this._easingMode=a}getEasingMode(){return this._easingMode}easeInCore(l){throw new Error("You must implement this method")}ease(l){switch(this._easingMode){case c.EASINGMODE_EASEIN:return this.easeInCore(l);case c.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-l)}return l>=.5?.5*(1-this.easeInCore(2*(1-l)))+.5:.5*this.easeInCore(2*l)}}c.EASINGMODE_EASEIN=0,c.EASINGMODE_EASEOUT=1,c.EASINGMODE_EASEINOUT=2;class K extends c{easeInCore(l){return l=Math.max(0,Math.min(1,l)),1-Math.sqrt(1-l*l)}}class Z extends c{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=l}easeInCore(l){const a=Math.max(0,this.amplitude);return Math.pow(l,3)-l*a*Math.sin(3.141592653589793*l)}}class w extends c{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=l,this.bounciness=a}easeInCore(l){const a=Math.max(0,this.bounces);let N=this.bounciness;N<=1&&(N=1.001);const U=Math.pow(N,a),c=1-N,K=(1-U)/c+.5*U,Z=l*K,w=Math.log(-Z*(1-N)+1)/Math.log(N),S=Math.floor(w),T=S+1,J=(1-Math.pow(N,S))/(c*K),n=.5*(J+(1-Math.pow(N,T))/(c*K)),y=l-n,H=n-J;return-Math.pow(1/N,a-S)/(H*H)*(y-H)*(y+H)}}class S extends c{easeInCore(l){return l*l*l}}class T extends c{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=l,this.springiness=a}easeInCore(l){let a;const N=Math.max(0,this.oscillations),U=Math.max(0,this.springiness);return a=0==U?l:(Math.exp(U*l)-1)/(Math.exp(U)-1),a*Math.sin((6.283185307179586*N+1.5707963267948966)*l)}}class J extends c{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=l}easeInCore(l){return this.exponent<=0?l:(Math.exp(this.exponent*l)-1)/(Math.exp(this.exponent)-1)}}class n extends c{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=l,this.y1=a,this.x2=N,this.y2=U}easeInCore(l){return U.d.Interpolate(l,this.x1,this.y1,this.x2,this.y2)}}},14063:(l,a,N)=>{"use strict";N.d(a,{c:()=>Z});var U=N(12447),c=N(12457),K=N(12861);class Z extends K.c{get _matrix(){return this._compose(),this.ky}set _matrix(l){(l.updateFlag!==this.ky.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.ky.K(l),this._markAsDirtyAndDecompose())}constructor(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(l,a.bl(),!1),this.name=l,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=a,this.ky=(null===c||void 0===c?void 0:c.clone())??U.Matrix.Identity(),this._restMatrix=K??this.ky.clone(),this._bindMatrix=Z??this.ky.clone(),this._index=w,this._absoluteMatrix=new U.Matrix,this._absoluteBindMatrix=new U.Matrix,this._absoluteInverseBindMatrix=new U.Matrix,this._finalMatrix=new U.Matrix,a.bones.push(this),this.setParent(N,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(l){this.setParent(l)}setParent(l){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==l){if(this.parent){const l=this.parent.children.indexOf(this);-1!==l&&this.parent.children.splice(l,1)}this._parentNode=l,this.parent&&this.parent.children.push(this),a&&this._updateAbsoluteBindMatrices(),this.DT()}}getLocalMatrix(){return this._compose(),this.ky}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(l){this._restMatrix.K(l)}setRestPose(l){this.setRestMatrix(l)}getBindPose(){return this.getBindMatrix()}setBindMatrix(l){this.Ec(l)}setBindPose(l){this.setBindMatrix(l)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const l=U.TmpVectors.ua[0],a=U.TmpVectors.Quaternion[0],N=U.TmpVectors.ua[1];this.getRestMatrix().decompose(l,a,N),this._linkedTransformNode.position.K(N),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??U.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.K(a),this._linkedTransformNode.Oc.K(l)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(l){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=l,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.NS}set position(l){this._decompose(),this.NS.K(l),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(l){this.setRotation(l)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(l){this.setRotationQuaternion(l)}get Oc(){return this.getScale()}set Oc(l){this.setScale(l)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=U.ua.Zero(),this._localRotation=U.Quaternion.Zero(),this.NS=U.ua.Zero()),this.ky.decompose(this._localScaling,this._localRotation,this.NS))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,U.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.NS,this.ky)):this._needToCompose=!1)}Ec(l){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.K(l),a&&this._updateAbsoluteBindMatrices(),N?this._matrix=l:this.DT()}_updateAbsoluteBindMatrices(l){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(l||(l=this._bindMatrix),this.parent?l.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.K(l),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),a)for(let N=0;N<this.children.length;N++)this.children[N]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}DT(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.DT(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.DT(),this._needToDecompose=!0}_updatePosition(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const K=this.getLocalMatrix();if(0==a)c?(K.addAtIndex(12,l.x),K.addAtIndex(13,l.y),K.addAtIndex(14,l.z)):K.setTranslationFromFloats(l.x,l.y,l.z);else{let a=null;N&&(a=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=Z._TmpMats[0],S=Z._TmpVecs[0];this.parent?N&&a?(w.K(this.parent.getAbsoluteMatrix()),w.multiplyToRef(a,w)):w.K(this.parent.getAbsoluteMatrix()):U.Matrix.IdentityToRef(w),c&&w.setTranslationFromFloats(0,0,0),w.invert(),U.ua.TransformCoordinatesToRef(l,w,S),c?(K.addAtIndex(12,S.x),K.addAtIndex(13,S.y),K.addAtIndex(14,S.z)):K.setTranslationFromFloats(S.x,S.y,S.z)}this._markAsDirtyAndDecompose()}translate(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;this._updatePosition(l,a,N,!0)}setPosition(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;this._updatePosition(l,a,N,!1)}setAbsolutePosition(l,a){this.setPosition(l,1,a)}scale(l,a,N){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const K=this.getLocalMatrix(),w=Z._TmpMats[0];U.Matrix.ScalingToRef(l,a,N,w),w.multiplyToRef(K,K),w.invert();for(const U of this.children){const c=U.getLocalMatrix();c.multiplyToRef(w,c),c.multiplyAtIndex(12,l),c.multiplyAtIndex(13,a),c.multiplyAtIndex(14,N),U._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),c)for(const U of this.children)U.scale(l,a,N,c)}setScale(l){this._decompose(),this._localScaling.K(l),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(l){this._decompose(),l.K(this._localScaling)}setYawPitchRoll(l,a,N){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,K=arguments.length>4?arguments[4]:void 0;if(0===c){const w=Z._TmpQuat;return U.Quaternion.RotationYawPitchRollToRef(l,a,N,w),void this.setRotationQuaternion(w,c,K)}const w=Z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,K))return;const S=Z._TmpMats[1];U.Matrix.RotationYawPitchRollToRef(l,a,N,S),w.multiplyToRef(S,S),this._rotateWithMatrix(S,c,K)}rotate(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;const K=Z._TmpMats[0];K.setTranslationFromFloats(0,0,0),U.Matrix.RotationAxisToRef(l,a,K),this._rotateWithMatrix(K,N,c)}setAxisAngle(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;if(0===N){const K=Z._TmpQuat;return U.Quaternion.RotationAxisToRef(l,a,K),void this.setRotationQuaternion(K,N,c)}const K=Z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,c))return;const w=Z._TmpMats[1];U.Matrix.RotationAxisToRef(l,a,w),K.multiplyToRef(w,w),this._rotateWithMatrix(w,N,c)}setRotation(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(l.y,l.x,l.z,a,N)}setRotationQuaternion(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;if(0===a)return this._decompose(),this._localRotation.K(l),void this._markAsDirtyAndCompose();const c=Z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,N))return;const K=Z._TmpMats[1];U.Matrix.FromQuaternionToRef(l,K),c.multiplyToRef(K,K),this._rotateWithMatrix(K,a,N)}setRotationMatrix(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;if(0===a){const c=Z._TmpQuat;return U.Quaternion.FromRotationMatrixToRef(l,c),void this.setRotationQuaternion(c,a,N)}const c=Z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,N))return;const K=Z._TmpMats[1];K.K(l),c.multiplyToRef(l,K),this._rotateWithMatrix(K,a,N)}_rotateWithMatrix(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;const U=this.getLocalMatrix(),c=U.m[12],K=U.m[13],w=U.m[14],S=this.getParent(),T=Z._TmpMats[3],J=Z._TmpMats[4];S&&1==a?(N?(T.K(N.getWorldMatrix()),S.getAbsoluteMatrix().multiplyToRef(T,T)):T.K(S.getAbsoluteMatrix()),J.K(T),J.invert(),U.multiplyToRef(T,U),U.multiplyToRef(l,U),U.multiplyToRef(J,U)):1==a&&N?(T.K(N.getWorldMatrix()),J.K(T),J.invert(),U.multiplyToRef(T,U),U.multiplyToRef(l,U),U.multiplyToRef(J,U)):U.multiplyToRef(l,U),U.setTranslationFromFloats(c,K,w),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(l,a){const N=Z._TmpMats[2];return l.K(this.getAbsoluteMatrix()),a?(l.multiplyToRef(a.getWorldMatrix(),l),U.Matrix.ScalingToRef(a.Oc.x,a.Oc.y,a.Oc.z,N)):U.Matrix.IdentityToRef(N),l.invert(),!isNaN(l.m[0])&&(N.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyToRef(N,l),!0)}Uc(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=U.ua.Zero();return this.getPositionToRef(l,a,N),N}getPositionToRef(){let l=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const l=this.getLocalMatrix();a.x=l.m[12],a.y=l.m[13],a.z=l.m[14]}else{let N=null;l&&(N=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let U=Z._TmpMats[0];l&&N?(U.K(this.getAbsoluteMatrix()),U.multiplyToRef(N,U)):U=this.getAbsoluteMatrix(),a.x=U.m[12],a.y=U.m[13],a.z=U.m[14]}}getAbsolutePosition(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const a=U.ua.Zero();return this.getPositionToRef(1,l,a),a}getAbsolutePositionToRef(l,a){this.getPositionToRef(1,l,a)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.ky.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.K(this.ky);const l=this._skeleton.getPoseMatrix();l&&this._absoluteMatrix.multiplyToRef(l,this._absoluteMatrix)}const l=this.children,a=l.length;for(let N=0;N<a;N++)l[N].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}iS(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=U.ua.Zero();return this.getDirectionToRef(l,a,N),N}getDirectionToRef(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0,c=null;a&&(c=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=Z._TmpMats[0];K.K(this.getAbsoluteMatrix()),a&&c&&K.multiplyToRef(c,K),U.ua.TransformNormalToRef(l,K,N),N.normalize()}getRotation(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=U.ua.Zero();return this.getRotationToRef(l,a,N),N}getRotationToRef(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;const U=Z._TmpQuat;this.getRotationQuaternionToRef(l,a,U),U.toEulerAnglesToRef(N)}getRotationQuaternion(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=U.Quaternion.Identity();return this.getRotationQuaternionToRef(l,a,N),N}getRotationQuaternionToRef(){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),a.K(this._localRotation);else{const N=Z._TmpMats[0],U=this.getAbsoluteMatrix();l?U.multiplyToRef(l.getWorldMatrix(),N):N.K(U),N.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyAtIndex(1,this._scalingDeterminant),N.multiplyAtIndex(2,this._scalingDeterminant),N.decompose(void 0,a,void 0)}}getRotationMatrix(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0;const N=U.Matrix.Identity();return this.getRotationMatrixToRef(l,a,N),N}getRotationMatrixToRef(){let l=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(a);else{const N=Z._TmpMats[0],U=this.getAbsoluteMatrix();l?U.multiplyToRef(l.getWorldMatrix(),N):N.K(U),N.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyAtIndex(1,this._scalingDeterminant),N.multiplyAtIndex(2,this._scalingDeterminant),N.getRotationMatrixToRef(a)}}getAbsolutePositionFromLocal(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=U.ua.Zero();return this.getAbsolutePositionFromLocalToRef(l,a,N),N}getAbsolutePositionFromLocalToRef(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0,c=null;a&&(c=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=Z._TmpMats[0];K.K(this.getAbsoluteMatrix()),a&&c&&K.multiplyToRef(c,K),U.ua.TransformCoordinatesToRef(l,K,N)}getLocalPositionFromAbsolute(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=U.ua.Zero();return this.getLocalPositionFromAbsoluteToRef(l,a,N),N}getLocalPositionFromAbsoluteToRef(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0,c=null;a&&(c=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=Z._TmpMats[0];K.K(this.getAbsoluteMatrix()),a&&c&&K.multiplyToRef(c,K),K.invert(),U.ua.TransformCoordinatesToRef(l,K,N)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const l=this._skeleton.bones.indexOf(this);if(-1!==l&&this._skeleton.bones.splice(l,1),this._parentNode&&this._parentNode.children){const l=this._parentNode.children,a=l.indexOf(this);-1!==a&&l.splice(a,1)}super.dispose()}}Z._TmpVecs=(0,c.b)(2,U.ua.Zero),Z._TmpQuat=U.Quaternion.Identity(),Z._TmpMats=(0,c.b)(5,U.Matrix.Identity)},14595:(l,a,N)=>{"use strict";N.d(a,{c:()=>j});var U=N(12429),c=N(12432),K=N(12260),Z=N(12447),w=N(12461),S=N(12861),T=N(12883),J=N(12715),n=N(12283),y=N(12452);class H{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(l){this._zoomStopsAnimation=l}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(l){this._idleRotationSpeed=l}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(l){this._idleRotationWaitTime=l}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(l){this._idleRotationSpinupTime=l}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(l){this._attachedCamera=l;const a=this._attachedCamera.bl();this._onPrePointerObservableObserver=a.onPrePointerObservable.add((l=>{l.type!==J.d.POINTERDOWN?l.type===J.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=l.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const l=n.d.Now;let a=0;null!=this._lastFrameTime&&(a=l-this._lastFrameTime),this._lastFrameTime=l,this._applyUserInteraction();const N=l-this._lastInteractionTime-this._idleRotationWaitTime,U=Math.max(Math.min(N/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*U,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(a/1e3))}))}detach(){if(!this._attachedCamera)return;const l=this._attachedCamera.bl();this._onPrePointerObservableObserver&&l.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(l){this._lastInteractionTime=l??n.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<y.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let l=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(l=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?l:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=n.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var u=N(14599),W=N(12950);class B{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(l){if(this._autoTransitionRange===l)return;this._autoTransitionRange=l;const a=this._attachedCamera;a&&(l?this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add((l=>{if(l&&(l.qc(!0),l.getBoundingInfo)){const a=l.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*a,this.upperRadiusTransitionRange=.05*a}})):this._onMeshTargetChangedObserver&&a.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(l){this._attachedCamera=l,this._onAfterCheckInputsObserver=l.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(l){return!!this._attachedCamera&&(this._attachedCamera.radius===l&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(l){if(!this._attachedCamera)return;this._radiusBounceTransition||(B.EasingFunction.setEasingMode(B.EasingMode),this._radiusBounceTransition=W.d.CreateAnimation("radius",W.d.ANIMATIONTYPE_FLOAT,60,B.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const a=W.d.TransitionTo("radius",this._attachedCamera.radius+l,this._attachedCamera,this._attachedCamera.bl(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));a&&this._animatables.push(a)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}B.EasingFunction=new u.e(.3),B.EasingMode=u.n.EASINGMODE_EASEOUT;class Y{constructor(){this.onTargetFramingAnimationEndObservable=new K.e,this._mode=Y.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(l){this._mode=l}get mode(){return this._mode}set radiusScale(l){this._radiusScale=l}get radiusScale(){return this._radiusScale}set positionScale(l){this._positionScale=l}get positionScale(){return this._positionScale}set defaultElevation(l){this._defaultElevation=l}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(l){this._elevationReturnTime=l}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(l){this._elevationReturnWaitTime=l}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(l){this._zoomStopsAnimation=l}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(l){this._framingTime=l}get framingTime(){return this._framingTime}init(){}attach(l){this._attachedCamera=l;const a=this._attachedCamera.bl();Y.EasingFunction.setEasingMode(Y.EasingMode),this._onPrePointerObservableObserver=a.onPrePointerObservable.add((l=>{l.type!==J.d.POINTERDOWN?l.type===J.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=l.onMeshTargetChangedObservable.add((l=>{l&&l.getBoundingInfo&&this.zoomOnMesh(l,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=l.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const l=this._attachedCamera.bl();this._onPrePointerObservableObserver&&l.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l.qc(!0);const U=l.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(U.minimumWorld,U.maximumWorld,a,N)}zoomOnMeshHierarchy(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l.qc(!0);const U=l.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(U.min,U.max,a,N)}zoomOnMeshesHierarchy(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new Z.ua(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new Z.ua(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let K=0;K<l.length;K++){const a=l[K].getHierarchyBoundingVectors(!0);Z.ua.CheckExtends(a.min,U,c),Z.ua.CheckExtends(a.max,U,c)}this.zoomOnBoundingInfo(U,c,a,N)}zoomOnBoundingInfo(l,a){let N,U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const K=l.y,w=K+(a.y-K)*this._positionScale,S=a.Wa(l).scale(.5);if(!isFinite(w))return!1;if(U)N=new Z.ua(0,w,0);else{const a=l.add(S);N=new Z.ua(a.x,w,a.z)}this._vectorTransition||(this._vectorTransition=W.d.CreateAnimation("target",W.d.ANIMATIONTYPE_VECTOR3,60,Y.EasingFunction)),this._betaIsAnimating=!0;let T=W.d.TransitionTo("target",N,this._attachedCamera,this._attachedCamera.bl(),60,this._vectorTransition,this._framingTime);T&&this._animatables.push(T);let J=0;if(this._mode===Y.FitFrustumSidesMode){const N=this._calculateLowerRadiusFromModelBoundingSphere(l,a);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=S.length()+this._attachedCamera.Ac),J=N}else this._mode===Y.IgnoreBoundsSizeMode&&(J=this._calculateLowerRadiusFromModelBoundingSphere(l,a),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ac));if(this.autoCorrectCameraLimitsAndSensibility){const N=a.Wa(l).length();this._attachedCamera.panningSensibility=5e3/N,this._attachedCamera.wheelPrecision=100/J}return this._radiusTransition||(this._radiusTransition=W.d.CreateAnimation("radius",W.d.ANIMATIONTYPE_FLOAT,60,Y.EasingFunction)),T=W.d.TransitionTo("radius",J,this._attachedCamera,this._attachedCamera.bl(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),c&&c(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),T&&this._animatables.push(T),!0}_calculateLowerRadiusFromModelBoundingSphere(l,a){const N=this._attachedCamera;if(!N)return 0;let U=N._calculateLowerRadiusFromModelBoundingSphere(l,a,this._radiusScale);return N.lowerRadiusLimit&&this._mode===Y.IgnoreBoundsSizeMode&&(U=U<N.lowerRadiusLimit?N.lowerRadiusLimit:U),N.upperRadiusLimit&&(U=U>N.upperRadiusLimit?N.upperRadiusLimit:U),U}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const l=n.d.Now-this._lastInteractionTime,a=.5*Math.PI-this._defaultElevation,N=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>N&&l>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=W.d.CreateAnimation("beta",W.d.ANIMATIONTYPE_FLOAT,60,Y.EasingFunction));const l=W.d.TransitionTo("beta",a,this._attachedCamera,this._attachedCamera.bl(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));l&&this._animatables.push(l)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=n.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Y.EasingFunction=new u.t,Y.EasingMode=u.n.EASINGMODE_EASEINOUT,Y.IgnoreBoundsSizeMode=0,Y.FitFrustumSidesMode=1;var C=N(12885),M=N(12916),A=N(14057),E=N(12254);class q{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(l){l=E.Tools.BackCompatCameraNoPreventDefault(arguments);const a=this.camera.getEngine(),N=a.getInputElement();let U=0,c=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=K=>{var Z,w;const S=K.event,T="touch"===S.pointerType;if(K.type!==J.d.POINTERMOVE&&-1===this.buttons.indexOf(S.button))return;const n=S.target;if(this._altKey=S.altKey,this._ctrlKey=S.ctrlKey,this._metaKey=S.metaKey,this._shiftKey=S.shiftKey,this._buttonsPressed=S.buttons,a.isPointerLock){const l=S.movementX,a=S.movementY;this.onTouch(null,l,a),this._pointA=null,this._pointB=null}else{if(K.type!==J.d.POINTERDOWN&&K.type!==J.d.POINTERDOUBLETAP&&T&&(null===(Z=this._pointA)||void 0===Z?void 0:Z.pointerId)!==S.pointerId&&(null===(w=this._pointB)||void 0===w?void 0:w.pointerId)!==S.pointerId)return;if(K.type!==J.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!T)if(K.type===J.d.POINTERDOUBLETAP)this.onDoubleTap(S.pointerType);else if(K.type!==J.d.POINTERUP||this._currentMousePointerIdDown!==S.pointerId&&!T){if(K.type===J.d.POINTERMOVE)if(l||S.preventDefault(),this._pointA&&null===this._pointB){const l=S.clientX-this._pointA.x,a=S.clientY-this._pointA.y;this._pointA.x=S.clientX,this._pointA.y=S.clientY,this.onTouch(this._pointA,l,a)}else if(this._pointA&&this._pointB){const l=this._pointA.pointerId===S.pointerId?this._pointA:this._pointB;l.x=S.clientX,l.y=S.clientY;const a=this._pointA.x-this._pointB.x,N=this._pointA.y-this._pointB.y,Z=a*a+N*N,w={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:S.pointerId,type:K.type};this.onMultiTouch(this._pointA,this._pointB,U,Z,c,w),c=w,U=Z}}else{try{null===n||void 0===n||n.releasePointerCapture(S.pointerId)}catch(y){}T||(this._pointB=null),a._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==S.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==S.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==U||c)&&(this.onMultiTouch(this._pointA,this._pointB,U,0,c,null),U=0,c=null),this._currentMousePointerIdDown=-1,this.onButtonUp(S),l||S.preventDefault()}else{try{null===n||void 0===n||n.setPointerCapture(S.pointerId)}catch(y){}if(null===this._pointA)this._pointA={x:S.clientX,y:S.clientY,pointerId:S.pointerId,type:S.pointerType};else{if(null!==this._pointB)return;this._pointB={x:S.clientX,y:S.clientY,pointerId:S.pointerId,type:S.pointerType}}-1!==this._currentMousePointerIdDown||T||(this._currentMousePointerIdDown=S.pointerId),this.onButtonDown(S),l||(S.preventDefault(),N&&N.focus())}}},this._observer=this.camera.bl()._inputManager._addCameraPointerObserver(this._pointerInput,J.d.POINTERDOWN|J.d.POINTERUP|J.d.POINTERMOVE|J.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,U=0,c=null,this.onLostFocus()},this._contextMenuBind=l=>this.onContextMenu(l),N&&N.addEventListener("contextmenu",this._contextMenuBind,!1);const K=this.camera.bl().getEngine().getHostWindow();K&&E.Tools.RegisterTopRootEvents(K,[{name:"blur",handler:this._onLostFocus}])}rn(){if(this._onLostFocus){const l=this.camera.bl().getEngine().getHostWindow();l&&E.Tools.UnregisterTopRootEvents(l,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.bl()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const l=this.camera.bl().getEngine().getInputElement();l&&l.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(l){}onTouch(l,a,N){}onMultiTouch(l,a,N,U,c,K){}onContextMenu(l){l.preventDefault()}onButtonDown(l){}onButtonUp(l){}onLostFocus(){}}(0,U.d)([(0,c.K)()],q.prototype,"buttons",void 0);class b extends q{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(l,a){if(0!==this.panningSensibility&&l&&a){const N=a.x-l.x,U=a.y-l.y;this.camera.inertialPanningX+=-N/this.panningSensibility,this.camera.inertialPanningY+=U/this.panningSensibility}}_computePinchZoom(l,a){const N=this.camera.radius||b.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=N*Math.sqrt(l)/Math.sqrt(a):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(a-l)*N*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(a-l)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(l,a,N){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-a/this.panningSensibility,this.camera.inertialPanningY+=N/this.panningSensibility):(this.camera.inertialAlphaOffset-=a/this.angularSensibilityX,this.camera.inertialBetaOffset-=N/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(l,a,N,U,c,K){0===N&&null===c||0===U&&null===K||(this.multiTouchPanAndZoom?(this._computePinchZoom(N,U),this._computeMultiTouchPanning(c,K)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(U)-Math.sqrt(N))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(N,U),this._isPinching=!0):this._computeMultiTouchPanning(c,K)):this.multiTouchPanning?this._computeMultiTouchPanning(c,K):this.pinchZoom&&this._computePinchZoom(N,U))}onButtonDown(l){this._isPanClick=l.button===this.camera._panningMouseButton}onButtonUp(l){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}b.MinimumRadiusForPinch=.001,(0,U.d)([(0,c.K)()],b.prototype,"buttons",void 0),(0,U.d)([(0,c.K)()],b.prototype,"angularSensibilityX",void 0),(0,U.d)([(0,c.K)()],b.prototype,"angularSensibilityY",void 0),(0,U.d)([(0,c.K)()],b.prototype,"pinchPrecision",void 0),(0,U.d)([(0,c.K)()],b.prototype,"pinchDeltaPercentage",void 0),(0,U.d)([(0,c.K)()],b.prototype,"useNaturalPinchZoom",void 0),(0,U.d)([(0,c.K)()],b.prototype,"pinchZoom",void 0),(0,U.d)([(0,c.K)()],b.prototype,"panningSensibility",void 0),(0,U.d)([(0,c.K)()],b.prototype,"multiTouchPanning",void 0),(0,U.d)([(0,c.K)()],b.prototype,"multiTouchPanAndZoom",void 0),A.b.ArcRotateCameraPointersInput=b;var z=N(12717);class I{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(l){l=E.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.bl(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((a=>{const N=a.event;if(!N.metaKey)if(a.type===z.e.KEYDOWN){if(this._ctrlPressed=N.ctrlKey,this._altPressed=N.altKey,-1!==this.keysUp.indexOf(N.keyCode)||-1!==this.keysDown.indexOf(N.keyCode)||-1!==this.keysLeft.indexOf(N.keyCode)||-1!==this.keysRight.indexOf(N.keyCode)||-1!==this.keysReset.indexOf(N.keyCode)){-1===this._keys.indexOf(N.keyCode)&&this._keys.push(N.keyCode),N.preventDefault&&(l||N.preventDefault())}}else if(-1!==this.keysUp.indexOf(N.keyCode)||-1!==this.keysDown.indexOf(N.keyCode)||-1!==this.keysLeft.indexOf(N.keyCode)||-1!==this.keysRight.indexOf(N.keyCode)||-1!==this.keysReset.indexOf(N.keyCode)){const a=this._keys.indexOf(N.keyCode);a>=0&&this._keys.splice(a,1),N.preventDefault&&(l||N.preventDefault())}})))}rn(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const l=this.camera;for(let a=0;a<this._keys.length;a++){const N=this._keys[a];-1!==this.keysLeft.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?l.inertialPanningX-=1/this.panningSensibility:l.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?l.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?l.inertialRadiusOffset+=1/this.zoomingSensibility:l.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?l.inertialPanningX+=1/this.panningSensibility:l.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?l.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?l.inertialRadiusOffset-=1/this.zoomingSensibility:l.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(N)&&l.useInputToRestoreState&&l.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,U.d)([(0,c.K)()],I.prototype,"keysUp",void 0),(0,U.d)([(0,c.K)()],I.prototype,"keysDown",void 0),(0,U.d)([(0,c.K)()],I.prototype,"keysLeft",void 0),(0,U.d)([(0,c.K)()],I.prototype,"keysRight",void 0),(0,U.d)([(0,c.K)()],I.prototype,"keysReset",void 0),(0,U.d)([(0,c.K)()],I.prototype,"panningSensibility",void 0),(0,U.d)([(0,c.K)()],I.prototype,"zoomingSensibility",void 0),(0,U.d)([(0,c.K)()],I.prototype,"useAltToZoom",void 0),(0,U.d)([(0,c.K)()],I.prototype,"angularSpeed",void 0),A.b.ArcRotateCameraKeyboardMoveInput=I;var t=N(12483),O=N(12720);class h{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Z.ua(0,0,0),this._globalOffset=new Z.ua(0,0,0),this._inertialPanning=Z.ua.Zero()}_computeDeltaFromMouseWheelLegacyEvent(l,a){let N=0;const U=.01*l*this.wheelDeltaPercentage*a;return N=l>0?U/(1+this.wheelDeltaPercentage):U*(1+this.wheelDeltaPercentage),N}attachControl(l){l=E.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=a=>{if(a.type!==J.d.POINTERWHEEL)return;const N=a.event;let U=0;const c=N.deltaMode===O.d.DOM_DELTA_LINE?40:1,K=-N.deltaY*c;if(this.customComputeDeltaFromMouseWheel)U=this.customComputeDeltaFromMouseWheel(K,this,N);else if(this.wheelDeltaPercentage){if(U=this._computeDeltaFromMouseWheelLegacyEvent(K,this.camera.radius),U>0){let l=this.camera.radius,a=this.camera.inertialRadiusOffset+U;for(let N=0;N<20&&!(l<=a)&&!(Math.abs(a*this.camera.inertia)<.001);N++)l-=a,a*=this.camera.inertia;l=(0,w.Clamp)(l,0,Number.MAX_VALUE),U=this._computeDeltaFromMouseWheelLegacyEvent(K,l)}}else U=K/(40*this.wheelPrecision);U&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(U)):this.camera.inertialRadiusOffset+=U),N.preventDefault&&(l||N.preventDefault())},this._observer=this.camera.bl()._inputManager._addCameraPointerObserver(this._wheel,J.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.hc(0)}rn(){this._observer&&(this.camera.bl()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const l=this.camera;0+l.inertialAlphaOffset+l.inertialBetaOffset+l.inertialRadiusOffset&&(this._updateHitPlane(),l.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(l.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const l=this.camera,a=l.target.Wa(l.position);this._hitPlane=t.e.FromPositionAndNormal(l.target,a)}_getPosition(){const l=this.camera,a=l.bl(),N=a.createPickingRay(a.pointerX,a.pointerY,Z.Matrix.Identity(),l,!1);0===l.targetScreenOffset.x&&0===l.targetScreenOffset.y||(this._viewOffset.set(l.targetScreenOffset.x,l.targetScreenOffset.y,0),l.getViewMatrix().invertToRef(l._cameraTransformMatrix),this._globalOffset=Z.ua.TransformNormal(this._viewOffset,l._cameraTransformMatrix),N.origin.addInPlace(this._globalOffset));let U=0;return this._hitPlane&&(U=N.intersectsPlane(this._hitPlane)??0),N.origin.addInPlace(N.direction.scaleInPlace(U))}_zoomToMouse(l){const a=this.camera,N=1-a.inertia;if(a.lowerRadiusLimit){const U=a.lowerRadiusLimit??0;a.radius-(a.inertialRadiusOffset+l)/N<U&&(l=(a.radius-U)*N-a.inertialRadiusOffset)}if(a.upperRadiusLimit){const U=a.upperRadiusLimit??0;a.radius-(a.inertialRadiusOffset+l)/N>U&&(l=(a.radius-U)*N-a.inertialRadiusOffset)}const U=l/N/a.radius,c=this._getPosition(),K=Z.TmpVectors.ua[6];c.subtractToRef(a.target,K),K.scaleInPlace(U),K.scaleInPlace(N),this._inertialPanning.addInPlace(K),a.inertialRadiusOffset+=l}_zeroIfClose(l){Math.abs(l.x)<y.d&&(l.x=0),Math.abs(l.y)<y.d&&(l.y=0),Math.abs(l.z)<y.d&&(l.z=0)}}(0,U.d)([(0,c.K)()],h.prototype,"wheelPrecision",void 0),(0,U.d)([(0,c.K)()],h.prototype,"zoomToMouseLocation",void 0),(0,U.d)([(0,c.K)()],h.prototype,"wheelDeltaPercentage",void 0),A.b.ArcRotateCameraMouseWheelInput=h;class i extends A.c{constructor(l){super(l)}addMouseWheel(){return this.add(new h),this}addPointers(){return this.add(new b),this}addKeyboard(){return this.add(new I),this}}var k=N(12394);function Q(l,a){return isNaN(l)?a:l}S.c.AddNodeConstructor("ArcRotateCamera",((l,a)=>()=>new j(l,0,0,1,Z.ua.Zero(),a)));class j extends M.d{get target(){return this._target}set target(l){this.setTarget(l)}get targetHost(){return this._targetHost}set targetHost(l){l&&this.setTarget(l)}getTarget(){return this.target}get position(){return this._position}set position(l){this.setPosition(l)}set upVector(l){this._upToYMatrix||(this._yToUpMatrix=new Z.Matrix,this._upToYMatrix=new Z.Matrix,this._upVector=Z.ua.Zero()),l.normalize(),this._upVector.K(l),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Z.Matrix.RotationAlignToRef(Z.ua.UpReadOnly,this._upVector,this._yToUpMatrix),Z.Matrix.RotationAlignToRef(this._upVector,Z.ua.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const l=this.inputs.attached.pointers;return l?l.angularSensibilityX:0}set angularSensibilityX(l){const a=this.inputs.attached.pointers;a&&(a.angularSensibilityX=l)}get angularSensibilityY(){const l=this.inputs.attached.pointers;return l?l.angularSensibilityY:0}set angularSensibilityY(l){const a=this.inputs.attached.pointers;a&&(a.angularSensibilityY=l)}get pinchPrecision(){const l=this.inputs.attached.pointers;return l?l.pinchPrecision:0}set pinchPrecision(l){const a=this.inputs.attached.pointers;a&&(a.pinchPrecision=l)}get pinchDeltaPercentage(){const l=this.inputs.attached.pointers;return l?l.pinchDeltaPercentage:0}set pinchDeltaPercentage(l){const a=this.inputs.attached.pointers;a&&(a.pinchDeltaPercentage=l)}get useNaturalPinchZoom(){const l=this.inputs.attached.pointers;return!!l&&l.useNaturalPinchZoom}set useNaturalPinchZoom(l){const a=this.inputs.attached.pointers;a&&(a.useNaturalPinchZoom=l)}get panningSensibility(){const l=this.inputs.attached.pointers;return l?l.panningSensibility:0}set panningSensibility(l){const a=this.inputs.attached.pointers;a&&(a.panningSensibility=l)}get keysUp(){const l=this.inputs.attached.keyboard;return l?l.keysUp:[]}set keysUp(l){const a=this.inputs.attached.keyboard;a&&(a.keysUp=l)}get keysDown(){const l=this.inputs.attached.keyboard;return l?l.keysDown:[]}set keysDown(l){const a=this.inputs.attached.keyboard;a&&(a.keysDown=l)}get keysLeft(){const l=this.inputs.attached.keyboard;return l?l.keysLeft:[]}set keysLeft(l){const a=this.inputs.attached.keyboard;a&&(a.keysLeft=l)}get keysRight(){const l=this.inputs.attached.keyboard;return l?l.keysRight:[]}set keysRight(l){const a=this.inputs.attached.keyboard;a&&(a.keysRight=l)}get wheelPrecision(){const l=this.inputs.attached.mousewheel;return l?l.wheelPrecision:0}set wheelPrecision(l){const a=this.inputs.attached.mousewheel;a&&(a.wheelPrecision=l)}get zoomToMouseLocation(){const l=this.inputs.attached.mousewheel;return!!l&&l.zoomToMouseLocation}set zoomToMouseLocation(l){const a=this.inputs.attached.mousewheel;a&&(a.zoomToMouseLocation=l)}get wheelDeltaPercentage(){const l=this.inputs.attached.mousewheel;return l?l.wheelDeltaPercentage:0}set wheelDeltaPercentage(l){const a=this.inputs.attached.mousewheel;a&&(a.wheelDeltaPercentage=l)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(l){l!==this.useBouncingBehavior&&(l?(this._bouncingBehavior=new B,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(l){l!==this.useFramingBehavior&&(l?(this._framingBehavior=new Y,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(l){l!==this.useAutoRotationBehavior&&(l?(this._autoRotationBehavior=new H,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(l,a,N,U,c,w){var S;let T=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(l,Z.ua.Zero(),w,T),S=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Z.ua.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Z.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Z.Matrix,this.panningAxis=new Z.ua(1,1,0),this._transformedDirection=new Z.ua,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new K.e,this.checkCollisions=!1,this.collisionRadius=new Z.ua(.5,.5,.5),this._previousPosition=Z.ua.Zero(),this._collisionVelocity=Z.ua.Zero(),this._newPosition=Z.ua.Zero(),this._computationVector=Z.ua.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Z.ua(NaN,NaN,NaN),this._goalTargetScreenOffset=new Z.Vector2(NaN,NaN),this._onCollisionPositionChange=function(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N?(S.setPosition(a),S.hH&&S.hH(N)):S._previousPosition.K(S._position);const U=Math.cos(S.alpha),c=Math.sin(S.alpha),K=Math.cos(S.beta);let Z=Math.sin(S.beta);0===Z&&(Z=1e-4);const w=S._getTargetPosition();S._computationVector.tc(S.radius*U*Z,S.radius*K,S.radius*c*Z),w.addToRef(S._computationVector,S._newPosition),S._position.K(S._newPosition);let T=S.upVector;S.allowUpsideDown&&S.beta<0&&(T=T.clone(),T=T.negate()),S._computeViewMatrix(S._position,w,T),S._viewMatrix.addAtIndex(12,S.targetScreenOffset.x),S._viewMatrix.addAtIndex(13,S.targetScreenOffset.y),S._collisionTriggered=!1},this._target=Z.ua.Zero(),c&&this.setTarget(c),this.alpha=a,this.beta=N,this.radius=U,this.getViewMatrix(),this.inputs=new i(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Z.ua(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Z.Vector2.Zero()}_updateCache(l){l||super._updateCache(),this._cache._target.K(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.K(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const l=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?l.addToRef(this._targetBoundingCenter,this._target):this._target.K(l)}const l=this._getLockedTargetPosition();return l||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>y.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,K=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=K?this._currentInterpolationFactor=K:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=Q(l,this._goalAlpha),this._goalBeta=Q(a,this._goalBeta),this._goalRadius=Q(N,this._goalRadius),this._goalTarget.set(Q(U.x,this._goalTarget.x),Q(U.y,this._goalTarget.y),Q(U.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(Q(c.x,this._goalTargetScreenOffset.x),Q(c.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,w.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,w.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,w.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,w.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(l,a){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const c=arguments;a=E.Tools.BackCompatCameraNoPreventDefault(c),this._useCtrlForPanning=N,this._panningMouseButton=U,"boolean"===typeof c[0]&&(c.length>1&&(this._useCtrlForPanning=c[1]),c.length>2&&(this._panningMouseButton=c[2])),this.inputs.attachElement(a),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}rn(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let l=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){l=!0;const a=this.invertRotation?-1:1,N=this._calculateHandednessMultiplier();let U=this.inertialAlphaOffset*N;this.beta<0&&(U*=-1),this.alpha+=U*a,this.beta+=this.inertialBetaOffset*a,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<y.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<y.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*y.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){l=!0;const a=new Z.ua(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),a.multiplyInPlace(this.panningAxis),Z.ua.TransformNormalToRef(a,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const l=this.upVector,a=Z.ua.CrossToRef(this._transformedDirection,l,this._transformedDirection);Z.ua.CrossToRef(l,a,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Z.ua.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.K(this._transformedDirection)}else{if(this.parent){const l=Z.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(l),l.transposeToRef(l),Z.ua.TransformCoordinatesToRef(this._transformedDirection,l,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*y.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*y.d&&(this.inertialPanningY=0)}if(l)this.stopInterpolation();else if(this._isInterpolating){let l=!1;const a=this._scene.getEngine().getDeltaTime()/1e3,N=1-Math.pow(2,-a/this._currentInterpolationFactor),U=Q(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const a=Z.TmpVectors.ua[0].set(Q(this._goalTarget.x,this._target.x),Q(this._goalTarget.y,this._target.y),Q(this._goalTarget.z,this._target.z));Z.ua.LerpToRef(this.target,a,N,this._target),10*Z.ua.Distance(this.target,a)/U<y.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.K(a),this.setTarget(this.target,!1,!0,!0)):l=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const a=Z.Quaternion.RotationAlphaBetaGammaToRef(Q(this._goalAlpha,this.alpha),Q(this._goalBeta,this.beta),0,Z.TmpVectors.Quaternion[0]),U=Z.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Z.TmpVectors.Quaternion[1]),c=Z.Quaternion.SlerpToRef(U,a,N,Z.TmpVectors.Quaternion[2]);c.normalize();const K=c.toAlphaBetaGammaToRef(Z.TmpVectors.ua[0]);if(this.alpha=K.x,this.beta=K.y,c.isApprox(a,y.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const l=a.toAlphaBetaGammaToRef(Z.TmpVectors.ua[0]);this.alpha=l.x,this.beta=l.y}else l=!0}if(isNaN(this._goalRadius)||(this.radius+=(U-this.radius)*N,Math.abs(U/this.radius-1)<y.d?(this._goalRadius=NaN,this.radius=U):l=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const a=Z.TmpVectors.Vector2[0].set(Q(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),Q(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Z.Vector2.LerpToRef(this.targetScreenOffset,a,N,this.targetScreenOffset),Z.Vector2.Distance(this.targetScreenOffset,a)<y.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.K(a)):l=!0}this._isInterpolating=l}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Z.ua.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const l=this.alpha;var a,N;this.alpha=function(l){let a=Math.PI/2;return 0===l.x&&0===l.z||(a=Math.acos(l.x/Math.sqrt(Math.pow(l.x,2)+Math.pow(l.z,2)))),l.z<0&&(a=2*Math.PI-a),a}(this._computationVector),this.beta=(a=this._computationVector.y,N=this.radius,Math.acos(a/N));const U=Math.round((l-this.alpha)/(2*Math.PI));this.alpha+=2*U*Math.PI,this._checkLimits()}setPosition(l){this._position.equals(l)||(this._position.K(l),this.rebuildAnglesAndRadius())}setTarget(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(U=this.overrideCloneAlphaBetaRadius??U,l.qc)a&&l.getBoundingInfo?this._targetBoundingCenter=l.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,l.qc(),this._targetHost=l,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const a=l,U=this._getTargetPosition();if(U&&!N&&U.equals(a))return;this._targetHost=null,this._target=a,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}U||this.rebuildAnglesAndRadius()}_getViewMatrix(){const l=Math.cos(this.alpha),a=Math.sin(this.alpha),N=Math.cos(this.beta);let U=Math.sin(this.beta);0===U&&(U=1e-4),0===this.radius&&(this.radius=1e-4);const c=this._getTargetPosition();if(this._computationVector.tc(this.radius*l*U,this.radius*N,this.radius*a*U),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Z.ua.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),c.addToRef(this._computationVector,this._newPosition),this.bl().collisionsEnabled&&this.checkCollisions){const l=this.bl().collisionCoordinator;this._collider||(this._collider=l.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,l.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.K(this._newPosition);let l=this.upVector;this.allowUpsideDown&&U<0&&(l=l.negate()),this._computeViewMatrix(this._position,c,l),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.K(c),this._viewMatrix}zoomOn(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l=l||this.bl().meshes;const N=T.d.MinMax(l);let U=this._calculateLowerRadiusFromModelBoundingSphere(N.min,N.max);if(U=Math.max(Math.min(U,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=U*this.zoomOnFactor,this.mode===C.e.ORTHOGRAPHIC_CAMERA){const l=this.bl().getEngine().getAspectRatio(this),a=U*this.zoomOnFactor/2;this.orthoLeft=-a*l,this.orthoRight=a*l,this.orthoBottom=-a,this.orthoTop=a}this.focusOn({min:N.min,max:N.max,distance:U},a)}focusOn(l){let a,N,U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===l.min){const U=l||this.bl().meshes;a=T.d.MinMax(U),N=Z.ua.Distance(a.min,a.max)}else{a=l,N=l.distance}this._target=T.d.Center(a),U||(this.maxZ=2*N)}createRigCamera(l,a){let N=0;switch(this.cameraRigMode){case C.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.e.RIG_MODE_VR:N=this._cameraRigParams.stereoHalfAngle*(0===a?1:-1);break;case C.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:N=this._cameraRigParams.stereoHalfAngle*(0===a?-1:1)}const U=new j(l,this.alpha+N,this.beta,this.radius,this._target,this.bl());return U._cameraRigParams={},U.isRigCamera=!0,U.rigParent=this,U.upVector=this.upVector,U.mode=this.mode,U.orthoLeft=this.orthoLeft,U.orthoRight=this.orthoRight,U.orthoBottom=this.orthoBottom,U.orthoTop=this.orthoTop,U}_updateRigCameras(){const l=this._rigCameras[0],a=this._rigCameras[1];switch(l.beta=a.beta=this.beta,this.cameraRigMode){case C.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.e.RIG_MODE_VR:l.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case C.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:l.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,a.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const U=Z.ua.Distance(l,a),c=this.bl().getEngine().getAspectRatio(this),K=Math.tan(this.fov/2),w=K*c,S=.5*U*N,T=S*Math.sqrt(1+1/(w*w)),J=S*Math.sqrt(1+1/(K*K));return Math.max(T,J)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,U.d)([(0,c.K)()],j.prototype,"alpha",void 0),(0,U.d)([(0,c.K)()],j.prototype,"beta",void 0),(0,U.d)([(0,c.K)()],j.prototype,"radius",void 0),(0,U.d)([(0,c.K)()],j.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,U.d)([(0,c.G)("target")],j.prototype,"_target",void 0),(0,U.d)([(0,c.y)("targetHost")],j.prototype,"_targetHost",void 0),(0,U.d)([(0,c.K)()],j.prototype,"inertialAlphaOffset",void 0),(0,U.d)([(0,c.K)()],j.prototype,"inertialBetaOffset",void 0),(0,U.d)([(0,c.K)()],j.prototype,"inertialRadiusOffset",void 0),(0,U.d)([(0,c.K)()],j.prototype,"lowerAlphaLimit",void 0),(0,U.d)([(0,c.K)()],j.prototype,"upperAlphaLimit",void 0),(0,U.d)([(0,c.K)()],j.prototype,"lowerBetaLimit",void 0),(0,U.d)([(0,c.K)()],j.prototype,"upperBetaLimit",void 0),(0,U.d)([(0,c.K)()],j.prototype,"lowerRadiusLimit",void 0),(0,U.d)([(0,c.K)()],j.prototype,"upperRadiusLimit",void 0),(0,U.d)([(0,c.K)()],j.prototype,"lowerTargetYLimit",void 0),(0,U.d)([(0,c.K)()],j.prototype,"inertialPanningX",void 0),(0,U.d)([(0,c.K)()],j.prototype,"inertialPanningY",void 0),(0,U.d)([(0,c.K)()],j.prototype,"pinchToPanMaxDistance",void 0),(0,U.d)([(0,c.K)()],j.prototype,"panningDistanceLimit",void 0),(0,U.d)([(0,c.G)()],j.prototype,"panningOriginTarget",void 0),(0,U.d)([(0,c.K)()],j.prototype,"panningInertia",void 0),(0,U.d)([(0,c.K)()],j.prototype,"zoomToMouseLocation",null),(0,U.d)([(0,c.K)()],j.prototype,"zoomOnFactor",void 0),(0,U.d)([(0,c.E)()],j.prototype,"targetScreenOffset",void 0),(0,U.d)([(0,c.K)()],j.prototype,"allowUpsideDown",void 0),(0,U.d)([(0,c.K)()],j.prototype,"useInputToRestoreState",void 0),(0,U.d)([(0,c.K)()],j.prototype,"restoreStateInterpolationFactor",void 0),(0,k.g)("BABYLON.ArcRotateCamera",j)},14057:(l,a,N)=>{"use strict";N.d(a,{b:()=>Z,c:()=>w});var U=N(12268),c=N(12471),K=N(12885),Z={};class w{constructor(l){this.attachedToElement=!1,this.attached={},this.camera=l,this.checkInputs=()=>{}}add(l){const a=l.getSimpleName();this.attached[a]?U.b.Warn("camera input of type "+a+" already exists on camera"):(this.attached[a]=l,l.camera=this.camera,l.checkInputs&&(this.checkInputs=this._addCheckInputs(l.checkInputs.bind(l))),this.attachedToElement&&l.attachControl(this.noPreventDefault))}remove(l){for(const a in this.attached){const N=this.attached[a];if(N===l)return N.rn(),N.camera=null,delete this.attached[a],void this.rebuildInputCheck()}}removeByType(l){for(const a in this.attached){const N=this.attached[a];N.getClassName()===l&&(N.rn(),N.camera=null,delete this.attached[a],this.rebuildInputCheck())}}_addCheckInputs(l){const a=this.checkInputs;return()=>{a(),l()}}attachInput(l){this.attachedToElement&&l.attachControl(this.noPreventDefault)}attachElement(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){l=!K.e.ForceAttachControlToAlwaysPreventDefault&&l,this.attachedToElement=!0,this.noPreventDefault=l;for(const a in this.attached)this.attached[a].attachControl(l)}}detachElement(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const a in this.attached)this.attached[a].rn(),l&&(this.attached[a].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const l in this.attached){const a=this.attached[l];a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(l){const a={};for(const N in this.attached){const l=this.attached[N],U=c.c.Serialize(l);a[l.getClassName()]=U}l.inputsmgr=a}parse(l){const a=l.inputsmgr;if(a){this.clear();for(const l in a){const N=Z[l];if(N){const U=a[l],K=c.c.Parse((()=>new N),U,null);this.add(K)}}}else for(const N in this.attached){const a=Z[this.attached[N].getClassName()];if(a){const U=c.c.Parse((()=>new a),l,null);this.remove(this.attached[N]),this.add(U)}}}}},14053:(l,a,N)=>{"use strict";N.d(a,{e:()=>q});var U=N(12429),c=N(12432),K=N(12447),Z=N(12916),w=N(14057),S=N(12717),T=N(12254);class J{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(l){l=T.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.bl(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((a=>{const N=a.event;if(!N.metaKey)if(a.type===S.e.KEYDOWN){if(-1!==this.keysUp.indexOf(N.keyCode)||-1!==this.keysDown.indexOf(N.keyCode)||-1!==this.keysLeft.indexOf(N.keyCode)||-1!==this.keysRight.indexOf(N.keyCode)||-1!==this.keysUpward.indexOf(N.keyCode)||-1!==this.keysDownward.indexOf(N.keyCode)||-1!==this.keysRotateLeft.indexOf(N.keyCode)||-1!==this.keysRotateRight.indexOf(N.keyCode)||-1!==this.keysRotateUp.indexOf(N.keyCode)||-1!==this.keysRotateDown.indexOf(N.keyCode)){-1===this._keys.indexOf(N.keyCode)&&this._keys.push(N.keyCode),l||N.preventDefault()}}else if(-1!==this.keysUp.indexOf(N.keyCode)||-1!==this.keysDown.indexOf(N.keyCode)||-1!==this.keysLeft.indexOf(N.keyCode)||-1!==this.keysRight.indexOf(N.keyCode)||-1!==this.keysUpward.indexOf(N.keyCode)||-1!==this.keysDownward.indexOf(N.keyCode)||-1!==this.keysRotateLeft.indexOf(N.keyCode)||-1!==this.keysRotateRight.indexOf(N.keyCode)||-1!==this.keysRotateUp.indexOf(N.keyCode)||-1!==this.keysRotateDown.indexOf(N.keyCode)){const a=this._keys.indexOf(N.keyCode);a>=0&&this._keys.splice(a,1),l||N.preventDefault()}})))}rn(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const l=this.camera;for(let a=0;a<this._keys.length;a++){const N=this._keys[a],U=l._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(N)?l._localDirection.tc(-U,0,0):-1!==this.keysUp.indexOf(N)?l._localDirection.tc(0,0,U):-1!==this.keysRight.indexOf(N)?l._localDirection.tc(U,0,0):-1!==this.keysDown.indexOf(N)?l._localDirection.tc(0,0,-U):-1!==this.keysUpward.indexOf(N)?l._localDirection.tc(0,U,0):-1!==this.keysDownward.indexOf(N)?l._localDirection.tc(0,-U,0):-1!==this.keysRotateLeft.indexOf(N)?(l._localDirection.tc(0,0,0),l.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(N)?(l._localDirection.tc(0,0,0),l.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(N)?(l._localDirection.tc(0,0,0),l.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(N)&&(l._localDirection.tc(0,0,0),l.cameraRotation.x+=this._getLocalRotation()),l.bl().useRightHandedSystem&&(l._localDirection.z*=-1),l.getViewMatrix().invertToRef(l._cameraTransformMatrix),K.ua.TransformNormalToRef(l._localDirection,l._cameraTransformMatrix,l._transformedDirection),l.cameraDirection.addInPlace(l._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const l=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*l}}(0,U.d)([(0,c.K)()],J.prototype,"keysUp",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysUpward",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysDown",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysDownward",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysLeft",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysRight",void 0),(0,U.d)([(0,c.K)()],J.prototype,"rotationSpeed",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysRotateLeft",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysRotateRight",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysRotateUp",void 0),(0,U.d)([(0,c.K)()],J.prototype,"keysRotateDown",void 0),w.b.FreeCameraKeyboardMoveInput=J;var n=N(12260),y=N(12715);class H{constructor(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=l,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new n.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(l){l=T.Tools.BackCompatCameraNoPreventDefault(arguments);const a=this.camera.getEngine(),N=a.getInputElement();this._pointerInput||(this._pointerInput=U=>{const c=U.event,K="touch"===c.pointerType;if(!this.touchEnabled&&K)return;if(U.type!==y.d.POINTERMOVE&&-1===this.buttons.indexOf(c.button))return;const Z=c.target;if(U.type===y.d.POINTERDOWN){if(K&&-1!==this._activePointerId||!K&&-1!==this._currentActiveButton)return;this._activePointerId=c.pointerId;try{null===Z||void 0===Z||Z.setPointerCapture(c.pointerId)}catch(w){}-1===this._currentActiveButton&&(this._currentActiveButton=c.button),this._previousPosition={x:c.clientX,y:c.clientY},l||(c.preventDefault(),N&&N.focus()),a.isPointerLock&&this._onMouseMove&&this._onMouseMove(U.event)}else if(U.type===y.d.POINTERUP){if(K&&this._activePointerId!==c.pointerId||!K&&this._currentActiveButton!==c.button)return;try{null===Z||void 0===Z||Z.releasePointerCapture(c.pointerId)}catch(w){}this._currentActiveButton=-1,this._previousPosition=null,l||c.preventDefault(),this._activePointerId=-1}else if(U.type===y.d.POINTERMOVE&&(this._activePointerId===c.pointerId||!K))if(a.isPointerLock&&this._onMouseMove)this._onMouseMove(U.event);else if(this._previousPosition){const a=this.camera._calculateHandednessMultiplier(),N=(c.clientX-this._previousPosition.x)*a,U=c.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=N/this.angularSensibility,this.camera.cameraRotation.x+=U/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:N,offsetY:U}),this._previousPosition={x:c.clientX,y:c.clientY},l||c.preventDefault()}}),this._onMouseMove=N=>{if(!a.isPointerLock)return;const U=this.camera._calculateHandednessMultiplier(),c=N.movementX*U;this.camera.cameraRotation.y+=c/this.angularSensibility;const K=N.movementY;this.camera.cameraRotation.x+=K/this.angularSensibility,this._previousPosition=null,l||N.preventDefault()},this._observer=this.camera.bl()._inputManager._addCameraPointerObserver(this._pointerInput,y.d.POINTERDOWN|y.d.POINTERUP|y.d.POINTERMOVE),N&&(this._contextMenuBind=l=>this.onContextMenu(l),N.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(l){l.preventDefault()}rn(){if(this._observer){if(this.camera.bl()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const l=this.camera.getEngine().getInputElement();l&&l.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,U.d)([(0,c.K)()],H.prototype,"buttons",void 0),(0,U.d)([(0,c.K)()],H.prototype,"angularSensibility",void 0),w.b.FreeCameraMouseInput=H;var u,W=N(12720);class B{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new n.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(l){l=T.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=a=>{if(a.type!==y.d.POINTERWHEEL)return;const N=a.event,U=N.deltaMode===W.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*U*N.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*U*N.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*U*N.deltaZ/this._normalize,N.preventDefault&&(l||N.preventDefault())},this._observer=this.camera.bl()._inputManager._addCameraPointerObserver(this._wheel,y.d.POINTERWHEEL)}rn(){this._observer&&(this.camera.bl()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,U.d)([(0,c.K)()],B.prototype,"wheelPrecisionX",void 0),(0,U.d)([(0,c.K)()],B.prototype,"wheelPrecisionY",void 0),(0,U.d)([(0,c.K)()],B.prototype,"wheelPrecisionZ",void 0),function(l){l[l.MoveRelative=0]="MoveRelative",l[l.RotateRelative=1]="RotateRelative",l[l.MoveScene=2]="MoveScene"}(u||(u={}));class Y extends B{constructor(){super(...arguments),this._moveRelative=K.ua.Zero(),this._rotateRelative=K.ua.Zero(),this._moveScene=K.ua.Zero(),this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(l){null===l&&this._wheelXAction!==u.MoveRelative||(this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=l)}get wheelXMoveRelative(){return this._wheelXAction!==u.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(l){null===l&&this._wheelYAction!==u.MoveRelative||(this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=l)}get wheelYMoveRelative(){return this._wheelYAction!==u.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(l){null===l&&this._wheelZAction!==u.MoveRelative||(this._wheelZAction=u.MoveRelative,this._wheelZActionCoordinate=l)}get wheelZMoveRelative(){return this._wheelZAction!==u.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(l){null===l&&this._wheelXAction!==u.RotateRelative||(this._wheelXAction=u.RotateRelative,this._wheelXActionCoordinate=l)}get wheelXRotateRelative(){return this._wheelXAction!==u.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(l){null===l&&this._wheelYAction!==u.RotateRelative||(this._wheelYAction=u.RotateRelative,this._wheelYActionCoordinate=l)}get wheelYRotateRelative(){return this._wheelYAction!==u.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(l){null===l&&this._wheelZAction!==u.RotateRelative||(this._wheelZAction=u.RotateRelative,this._wheelZActionCoordinate=l)}get wheelZRotateRelative(){return this._wheelZAction!==u.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(l){null===l&&this._wheelXAction!==u.MoveScene||(this._wheelXAction=u.MoveScene,this._wheelXActionCoordinate=l)}get wheelXMoveScene(){return this._wheelXAction!==u.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(l){null===l&&this._wheelYAction!==u.MoveScene||(this._wheelYAction=u.MoveScene,this._wheelYActionCoordinate=l)}get wheelYMoveScene(){return this._wheelYAction!==u.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(l){null===l&&this._wheelZAction!==u.MoveScene||(this._wheelZAction=u.MoveScene,this._wheelZActionCoordinate=l)}get wheelZMoveScene(){return this._wheelZAction!==u.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.hc(0),this._rotateRelative.hc(0),this._moveScene.hc(0),this._updateCamera(),this.camera.bl().useRightHandedSystem&&(this._moveRelative.z*=-1);const l=K.Matrix.Zero();this.camera.getViewMatrix().invertToRef(l);const a=K.ua.Zero();K.ua.TransformNormalToRef(this._moveRelative,l,a),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(a),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(l,a,N){if(0===l)return;if(null===a||null===N)return;let U=null;switch(a){case u.MoveRelative:U=this._moveRelative;break;case u.RotateRelative:U=this._rotateRelative;break;case u.MoveScene:U=this._moveScene}switch(N){case 0:U.set(l,0,0);break;case 1:U.set(0,l,0);break;case 2:U.set(0,0,l)}}}(0,U.d)([(0,c.K)()],Y.prototype,"wheelXMoveRelative",null),(0,U.d)([(0,c.K)()],Y.prototype,"wheelYMoveRelative",null),(0,U.d)([(0,c.K)()],Y.prototype,"wheelZMoveRelative",null),(0,U.d)([(0,c.K)()],Y.prototype,"wheelXRotateRelative",null),(0,U.d)([(0,c.K)()],Y.prototype,"wheelYRotateRelative",null),(0,U.d)([(0,c.K)()],Y.prototype,"wheelZRotateRelative",null),(0,U.d)([(0,c.K)()],Y.prototype,"wheelXMoveScene",null),(0,U.d)([(0,c.K)()],Y.prototype,"wheelYMoveScene",null),(0,U.d)([(0,c.K)()],Y.prototype,"wheelZMoveScene",null),w.b.FreeCameraMouseWheelInput=Y;class C{constructor(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=l,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=T.Tools.IsSafari()}attachControl(l){l=T.Tools.BackCompatCameraNoPreventDefault(arguments);let a=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=N=>{const U=N.event,c="mouse"===U.pointerType||this._isSafari&&"undefined"===typeof U.pointerType;if(this.allowMouse||!c)if(N.type===y.d.POINTERDOWN){if(l||U.preventDefault(),this._pointerPressed.push(U.pointerId),1!==this._pointerPressed.length)return;a={x:U.clientX,y:U.clientY}}else if(N.type===y.d.POINTERUP){l||U.preventDefault();const N=this._pointerPressed.indexOf(U.pointerId);if(-1===N)return;if(this._pointerPressed.splice(N,1),0!=N)return;a=null,this._offsetX=null,this._offsetY=null}else if(N.type===y.d.POINTERMOVE){if(l||U.preventDefault(),!a)return;if(0!=this._pointerPressed.indexOf(U.pointerId))return;this._offsetX=U.clientX-a.x,this._offsetY=-(U.clientY-a.y)}}),this._observer=this.camera.bl()._inputManager._addCameraPointerObserver(this._pointerInput,y.d.POINTERDOWN|y.d.POINTERUP|y.d.POINTERMOVE),this._onLostFocus){const l=this.camera.getEngine().getInputElement();l&&l.addEventListener("blur",this._onLostFocus)}}rn(){if(this._pointerInput){if(this._observer&&(this.camera.bl()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const l=this.camera.getEngine().getInputElement();l&&l.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const l=this.camera,a=l._calculateHandednessMultiplier();l.cameraRotation.y=a*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)l.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const a=l._computeLocalCameraSpeed(),N=new K.ua(0,0,0!==this.touchMoveSensibility?a*this._offsetY/this.touchMoveSensibility:0);K.Matrix.RotationYawPitchRollToRef(l.rotation.y,l.rotation.x,0,l._cameraRotationMatrix),l.cameraDirection.addInPlace(K.ua.TransformCoordinates(N,l._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,U.d)([(0,c.K)()],C.prototype,"touchAngularSensibility",void 0),(0,U.d)([(0,c.K)()],C.prototype,"touchMoveSensibility",void 0),w.b.FreeCameraTouchInput=C;class M extends w.c{constructor(l){super(l),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new J),this}addMouse(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new H(l),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new Y,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new C),this}clear(){super.clear(),this._mouseInput=null}}var A=N(12394),E=N(12336);class q extends Z.d{get angularSensibility(){const l=this.inputs.attached.mouse;return l?l.angularSensibility:0}set angularSensibility(l){const a=this.inputs.attached.mouse;a&&(a.angularSensibility=l)}get keysUp(){const l=this.inputs.attached.keyboard;return l?l.keysUp:[]}set keysUp(l){const a=this.inputs.attached.keyboard;a&&(a.keysUp=l)}get keysUpward(){const l=this.inputs.attached.keyboard;return l?l.keysUpward:[]}set keysUpward(l){const a=this.inputs.attached.keyboard;a&&(a.keysUpward=l)}get keysDown(){const l=this.inputs.attached.keyboard;return l?l.keysDown:[]}set keysDown(l){const a=this.inputs.attached.keyboard;a&&(a.keysDown=l)}get keysDownward(){const l=this.inputs.attached.keyboard;return l?l.keysDownward:[]}set keysDownward(l){const a=this.inputs.attached.keyboard;a&&(a.keysDownward=l)}get keysLeft(){const l=this.inputs.attached.keyboard;return l?l.keysLeft:[]}set keysLeft(l){const a=this.inputs.attached.keyboard;a&&(a.keysLeft=l)}get keysRight(){const l=this.inputs.attached.keyboard;return l?l.keysRight:[]}set keysRight(l){const a=this.inputs.attached.keyboard;a&&(a.keysRight=l)}get keysRotateLeft(){const l=this.inputs.attached.keyboard;return l?l.keysRotateLeft:[]}set keysRotateLeft(l){const a=this.inputs.attached.keyboard;a&&(a.keysRotateLeft=l)}get keysRotateRight(){const l=this.inputs.attached.keyboard;return l?l.keysRotateRight:[]}set keysRotateRight(l){const a=this.inputs.attached.keyboard;a&&(a.keysRotateRight=l)}get keysRotateUp(){const l=this.inputs.attached.keyboard;return l?l.keysRotateUp:[]}set keysRotateUp(l){const a=this.inputs.attached.keyboard;a&&(a.keysRotateUp=l)}get keysRotateDown(){const l=this.inputs.attached.keyboard;return l?l.keysRotateDown:[]}set keysRotateDown(l){const a=this.inputs.attached.keyboard;a&&(a.keysRotateDown=l)}constructor(l,a,N){var U;super(l,a,N,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),U=this,this.ellipsoid=new K.ua(.5,1,.5),this.ellipsoidOffset=new K.ua(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=K.ua.Zero(),this._diffPosition=K.ua.Zero(),this._newPosition=K.ua.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U._newPosition.K(a),U._newPosition.subtractToRef(U._oldPosition,U._diffPosition),U._diffPosition.length()>E.c.CollisionsEpsilon&&(U.position.addToRef(U._diffPosition,U._deferredPositionUpdate),U._deferOnly?U._deferredUpdated=!0:U.position.K(U._deferredPositionUpdate),U.hH&&N&&U.hH(N))},this.inputs=new M(this),this.inputs.addKeyboard().addMouse()}attachControl(l,a){a=T.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(a)}rn(){this.inputs.detachElement(),this.cameraDirection=new K.ua(0,0,0),this.cameraRotation=new K.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(l){this._collisionMask=isNaN(l)?-1:l}_collideWithWorld(l){let a;a=this.parent?K.ua.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,a.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const N=this.bl().collisionCoordinator;this._collider||(this._collider=N.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let U=l;this.applyGravity&&(U=l.add(this.bl().gravity)),N.getNewPosition(this._oldPosition,U,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=K.ua.Zero(),this._transformedDirection=K.ua.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(l){this._needMoveForGravity=l}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.bl().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ec"}}(0,U.d)([(0,c.G)()],q.prototype,"ellipsoid",void 0),(0,U.d)([(0,c.G)()],q.prototype,"ellipsoidOffset",void 0),(0,U.d)([(0,c.K)()],q.prototype,"checkCollisions",void 0),(0,U.d)([(0,c.K)()],q.prototype,"applyGravity",void 0),(0,A.g)("BABYLON.FreeCamera",q)},14648:(l,a,N)=>{"use strict";N.d(a,{c:()=>K});var U=N(12530),c=N(14656);class K{constructor(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=N,this.Un=[],this._maxBlockCapacity=a||64,this._selectionContent=new U.e(1024),this._creationFunc=l}update(l,a,N){c.c._CreateBlocks(l,a,N,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}JJ(l){for(let a=0;a<this.qJ.length;a++){this.qJ[a].addEntry(l)}}TJ(l){for(let a=0;a<this.qJ.length;a++){this.qJ[a].removeEntry(l)}}select(l,a){this._selectionContent.reset();for(let N=0;N<this.qJ.length;N++){this.qJ[N].select(l,this._selectionContent,a)}return a?this._selectionContent.concat(this.Un):this._selectionContent.concatWithNoDuplicate(this.Un),this._selectionContent}intersects(l,a,N){this._selectionContent.reset();for(let U=0;U<this.qJ.length;U++){this.qJ[U].intersects(l,a,this._selectionContent,N)}return N?this._selectionContent.concat(this.Un):this._selectionContent.concatWithNoDuplicate(this.Un),this._selectionContent}intersectsRay(l){this._selectionContent.reset();for(let a=0;a<this.qJ.length;a++){this.qJ[a].intersectsRay(l,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Un),this._selectionContent}}K.CreationFuncForMeshes=(l,a)=>{const N=l.getBoundingInfo();!l.isBlocked&&N.boundingBox.intersectsMinMax(a.Sn,a.Tn)&&a.entries.push(l)},K.CreationFuncForSubMeshes=(l,a)=>{l.getBoundingInfo().boundingBox.intersectsMinMax(a.Sn,a.Tn)&&a.entries.push(l)}},14656:(l,a,N)=>{"use strict";N.d(a,{c:()=>K});var U=N(12447),c=N(12776);class K{constructor(l,a,N,U,c,K){this.entries=[],this.Jn=new Array,this._capacity=N,this._depth=U,this._maxDepth=c,this._creationFunc=K,this._minPoint=l,this._maxPoint=a,this.Jn.push(l.clone()),this.Jn.push(a.clone()),this.Jn.push(l.clone()),this.Jn[2].x=a.x,this.Jn.push(l.clone()),this.Jn[3].y=a.y,this.Jn.push(l.clone()),this.Jn[4].z=a.z,this.Jn.push(a.clone()),this.Jn[5].z=l.z,this.Jn.push(a.clone()),this.Jn[6].x=l.x,this.Jn.push(a.clone()),this.Jn[7].y=l.y}get kN(){return this._capacity}get Sn(){return this._minPoint}get Tn(){return this._maxPoint}addEntry(l){if(this.qJ)for(let a=0;a<this.qJ.length;a++){this.qJ[a].addEntry(l)}else this._creationFunc(l,this),this.entries.length>this.kN&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(l){if(this.qJ){for(let a=0;a<this.qJ.length;a++){this.qJ[a].removeEntry(l)}return}const a=this.entries.indexOf(l);a>-1&&this.entries.splice(a,1)}addEntries(l){for(let a=0;a<l.length;a++){const N=l[a];this.addEntry(N)}}select(l,a,N){if(c.e.IsInFrustum(this.Jn,l)){if(this.qJ){for(let U=0;U<this.qJ.length;U++){this.qJ[U].select(l,a,N)}return}N?a.concat(this.entries):a.concatWithNoDuplicate(this.entries)}}intersects(l,a,N,U){if(c.e.IntersectsSphere(this._minPoint,this._maxPoint,l,a)){if(this.qJ){for(let c=0;c<this.qJ.length;c++){this.qJ[c].intersects(l,a,N,U)}return}U?N.concat(this.entries):N.concatWithNoDuplicate(this.entries)}}intersectsRay(l,a){if(l.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.qJ){for(let N=0;N<this.qJ.length;N++){this.qJ[N].intersectsRay(l,a)}return}a.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){K._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(l,a,N,c,Z,w,S,T){S.qJ=new Array;const J=new U.ua((a.x-l.x)/2,(a.y-l.y)/2,(a.z-l.z)/2);for(let U=0;U<2;U++)for(let a=0;a<2;a++)for(let n=0;n<2;n++){const y=l.add(J.multiplyByFloats(U,a,n)),H=l.add(J.multiplyByFloats(U+1,a+1,n+1)),u=new K(y,H,c,Z+1,w,T);u.addEntries(N),S.qJ.push(u)}}}},14664:(l,a,N)=>{"use strict";N.d(a,{e:()=>J});var U=N(12678),c=N(12447),K=N(12868),Z=N(13818),w=N(12710),S=N(14648),T=N(12296);U.d.prototype.createOrUpdateSelectionOctree=function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,N=this._getComponent(w.e.NAME_OCTREE);N||(N=new J(this),this.Kc(N)),this.an||(this.an=new S.c(S.c.CreationFuncForMeshes,l,a));const U=this.getWorldExtends();return this.an.update(U.min,U.max,this.meshes),this.an},Object.defineProperty(U.d.prototype,"selectionOctree",{get:function(){return this.an},enumerable:!0,configurable:!0}),K.b.prototype.createOrUpdateSubmeshesOctree=function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const N=this.bl();let U=N._getComponent(w.e.NAME_OCTREE);U||(U=new J(N),N.Kc(U)),this._submeshesOctree||(this._submeshesOctree=new S.c(S.c.CreationFuncForSubMeshes,l,a)),this.qc(!0);const c=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(c.minimumWorld,c.maximumWorld,this.Wc),this._submeshesOctree};class J{constructor(l){this.name=w.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Z.e(c.ua.Zero(),new c.ua(1,1,1)),(l=l||T.e.LastCreatedScene)&&(this.Ba=l,this.Ba.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Ba.getActiveSubMeshCandidates=l=>this.getActiveSubMeshCandidates(l),this.Ba.getCollidingSubMeshCandidates=(l,a)=>this.getCollidingSubMeshCandidates(l,a),this.Ba.getIntersectingSubMeshCandidates=(l,a)=>this.getIntersectingSubMeshCandidates(l,a))}register(){this.Ba.onMeshRemovedObservable.add((l=>{const a=this.Ba.selectionOctree;if(void 0!==a&&null!==a){const N=a.Un.indexOf(l);-1!==N&&a.Un.splice(N,1)}})),this.Ba.onMeshImportedObservable.add((l=>{const a=this.Ba.selectionOctree;void 0!==a&&null!==a&&a.JJ(l)}))}getActiveMeshCandidates(){var l;return(null===(l=this.Ba.an)||void 0===l?void 0:l.select(this.Ba.frustumPlanes))||this.Ba._getDefaultMeshCandidates()}getActiveSubMeshCandidates(l){if(l._submeshesOctree&&l.useOctreeForRenderingSelection){return l._submeshesOctree.select(this.Ba.frustumPlanes)}return this.Ba._getDefaultSubMeshCandidates(l)}getIntersectingSubMeshCandidates(l,a){if(l._submeshesOctree&&l.useOctreeForPicking){Z.e.TransformToRef(a,l.getWorldMatrix(),this._tempRay);return l._submeshesOctree.intersectsRay(this._tempRay)}return this.Ba._getDefaultSubMeshCandidates(l)}getCollidingSubMeshCandidates(l,a){if(l._submeshesOctree&&l.useOctreeForCollisions){const N=a._velocityWorldLength+Math.max(a._radius.x,a._radius.y,a._radius.z);return l._submeshesOctree.intersects(a._basePointWorld,N)}return this.Ba._getDefaultSubMeshCandidates(l)}rebuild(){}dispose(){}}},13818:(l,a,N)=>{"use strict";N.d(a,{e:()=>H});var U=N(12678),c=N(12885),K=N(12452),Z=N(12447),w=N(12457),S=N(12764),T=N(12703),J=N(12296),n=N(12722);const y={internalPickerForMesh:void 0};class H{constructor(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.d;this.origin=l,this.direction=a,this.length=N,this.epsilon=U}clone(){return new H(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const U=H._TmpVector3[0].tc(l.x-N,l.y-N,l.z-N),c=H._TmpVector3[1].tc(a.x+N,a.y+N,a.z+N);let K,Z,w,S,T=0,J=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<U.x||this.origin.x>c.x)return!1}else if(K=1/this.direction.x,Z=(U.x-this.origin.x)*K,w=(c.x-this.origin.x)*K,w===-1/0&&(w=1/0),Z>w&&(S=Z,Z=w,w=S),T=Math.max(Z,T),J=Math.min(w,J),T>J)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<U.y||this.origin.y>c.y)return!1}else if(K=1/this.direction.y,Z=(U.y-this.origin.y)*K,w=(c.y-this.origin.y)*K,w===-1/0&&(w=1/0),Z>w&&(S=Z,Z=w,w=S),T=Math.max(Z,T),J=Math.min(w,J),T>J)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<U.z||this.origin.z>c.z)return!1}else if(K=1/this.direction.z,Z=(U.z-this.origin.z)*K,w=(c.z-this.origin.z)*K,w===-1/0&&(w=1/0),Z>w&&(S=Z,Z=w,w=S),T=Math.max(Z,T),J=Math.min(w,J),T>J)return!1;return!0}intersectsBox(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(l.minimum,l.maximum,a)}intersectsSphere(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const N=l.center.x-this.origin.x,U=l.center.y-this.origin.y,c=l.center.z-this.origin.z,K=N*N+U*U+c*c,Z=l.radius+a,w=Z*Z;if(K<=w)return!0;const S=N*this.direction.x+U*this.direction.y+c*this.direction.z;if(S<0)return!1;return K-S*S<=w}intersectsTriangle(l,a,N){const U=H._TmpVector3[0],c=H._TmpVector3[1],K=H._TmpVector3[2],w=H._TmpVector3[3],T=H._TmpVector3[4];a.subtractToRef(l,U),N.subtractToRef(l,c),Z.ua.CrossToRef(this.direction,c,K);const J=Z.ua.Dot(U,K);if(0===J)return null;const n=1/J;this.origin.subtractToRef(l,w);const y=Z.ua.Dot(w,K)*n;if(y<-this.epsilon||y>1+this.epsilon)return null;Z.ua.CrossToRef(w,U,T);const u=Z.ua.Dot(this.direction,T)*n;if(u<-this.epsilon||y+u>1+this.epsilon)return null;const W=Z.ua.Dot(c,T)*n;return W>this.length?null:new S.e(1-y-u,y,W)}intersectsPlane(l){let a;const N=Z.ua.Dot(l.normal,this.direction);if(Math.abs(N)<9.99999997475243e-7)return null;{const U=Z.ua.Dot(l.normal,this.origin);return a=(-l.d-U)/N,a<0?a<-9.99999997475243e-7?null:0:a}}intersectsAxis(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(l){case"y":{const l=(this.origin.y-a)/this.direction.y;return l>0?null:new Z.ua(this.origin.x+this.direction.x*-l,a,this.origin.z+this.direction.z*-l)}case"x":{const l=(this.origin.x-a)/this.direction.x;return l>0?null:new Z.ua(a,this.origin.y+this.direction.y*-l,this.origin.z+this.direction.z*-l)}case"z":{const l=(this.origin.z-a)/this.direction.z;return l>0?null:new Z.ua(this.origin.x+this.direction.x*-l,this.origin.y+this.direction.y*-l,a)}default:return null}}intersectsMesh(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=Z.TmpVectors.Matrix[0];return l.getWorldMatrix().invertToRef(w),this._tmpRay?H.TransformToRef(this,w,this._tmpRay):this._tmpRay=H.Transform(this,w),l.intersects(this._tmpRay,a,N,U,c,K)}intersectsMeshes(l,a,N){N?N.length=0:N=[];for(let U=0;U<l.length;U++){const c=this.intersectsMesh(l[U],a);c.hit&&N.push(c)}return N.sort(this._comparePickingInfo),N}_comparePickingInfo(l,a){return l.distance<a.distance?-1:l.distance>a.distance?1:0}intersectionSegment(l,a,N){const U=this.origin,c=Z.TmpVectors.ua[0],K=Z.TmpVectors.ua[1],w=Z.TmpVectors.ua[2],S=Z.TmpVectors.ua[3];a.subtractToRef(l,c),this.direction.scaleToRef(H._Rayl,w),U.addToRef(w,K),l.subtractToRef(U,S);const T=Z.ua.Dot(c,c),J=Z.ua.Dot(c,w),n=Z.ua.Dot(w,w),y=Z.ua.Dot(c,S),u=Z.ua.Dot(w,S),W=T*n-J*J;let B,Y,C=W,M=W;W<H._Smallnum?(B=0,C=1,Y=u,M=n):(B=J*u-n*y,Y=T*u-J*y,B<0?(B=0,Y=u,M=n):B>C&&(B=C,Y=u+J,M=n)),Y<0?(Y=0,-y<0?B=0:-y>T?B=C:(B=-y,C=T)):Y>M&&(Y=M,-y+J<0?B=0:-y+J>T?B=C:(B=-y+J,C=T));const A=Math.abs(B)<H._Smallnum?0:B/C,E=Math.abs(Y)<H._Smallnum?0:Y/M,q=Z.TmpVectors.ua[4];w.scaleToRef(E,q);const b=Z.TmpVectors.ua[5];c.scaleToRef(A,b),b.addInPlace(S);const z=Z.TmpVectors.ua[6];b.subtractToRef(q,z);return E>0&&E<=this.length&&z.lengthSquared()<N*N?b.length():-1}update(l,a,N,U,c,K,w){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){H._RayDistant||(H._RayDistant=H.Zero()),H._RayDistant.unprojectRayToRef(l,a,N,U,Z.Matrix.IdentityReadOnly,K,w);const S=Z.TmpVectors.Matrix[0];c.invertToRef(S),H.TransformToRef(H._RayDistant,S,this)}else this.unprojectRayToRef(l,a,N,U,c,K,w);return this}static Zero(){return new H(Z.ua.Zero(),Z.ua.Zero())}static CreateNew(l,a,N,U,c,K,Z){return H.Zero().update(l,a,N,U,c,K,Z)}static CreateNewFromTo(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z.Matrix.IdentityReadOnly;const U=new H(new Z.ua(0,0,0),new Z.ua(0,0,0));return H.CreateFromToToRef(l,a,U,N)}static CreateFromToToRef(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.Matrix.IdentityReadOnly;N.origin.K(l);const c=a.subtractToRef(l,N.direction),K=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);return N.length=K,N.direction.normalize(),H.TransformToRef(N,U,N)}static Transform(l,a){const N=new H(new Z.ua(0,0,0),new Z.ua(0,0,0));return H.TransformToRef(l,a,N),N}static TransformToRef(l,a,N){Z.ua.TransformCoordinatesToRef(l.origin,a,N.origin),Z.ua.TransformNormalToRef(l.direction,a,N.direction),N.length=l.length,N.epsilon=l.epsilon;const U=N.direction,c=U.length();if(0!==c&&1!==c){const l=1/c;U.x*=l,U.y*=l,U.z*=l,N.length*=c}return N}unprojectRayToRef(l,a,N,U,c,K,w){const S=Z.TmpVectors.Matrix[0];c.multiplyToRef(K,S),S.multiplyToRef(w,S),S.invert();const T=J.e.LastCreatedEngine,n=Z.TmpVectors.ua[0];n.x=l/N*2-1,n.y=-(a/U*2-1),n.z=null!==T&&void 0!==T&&T.Zc?1:null!==T&&void 0!==T&&T.isNDCHalfZRange?0:-1;const y=Z.TmpVectors.ua[1].tc(n.x,n.y,1-1e-8),H=Z.TmpVectors.ua[2],u=Z.TmpVectors.ua[3];Z.ua._UnprojectFromInvertedMatrixToRef(n,S,H),Z.ua._UnprojectFromInvertedMatrixToRef(y,S,u),this.origin.K(H),u.subtractToRef(H,this.direction),this.direction.normalize()}}function u(l,a,N,U,c){let K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Z=H.Zero();return W(l,a,N,U,Z,c,K),Z}function W(l,a,N,U,c,K){let w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const T=l.getEngine();if(!K&&!(K=l.activeCamera))return l;const J=K.viewport,n=T.getRenderHeight(),{x:y,y:H,width:u,height:W}=J.toGlobal(T.getRenderWidth(),n),B=1/T.getHardwareScalingLevel();return a=a*B-y,N=N*B-(n-H-W),c.update(a,N,u,W,U||Z.Matrix.IdentityReadOnly,w?Z.Matrix.IdentityReadOnly:K.getViewMatrix(),K.getProjectionMatrix(),S),l}function B(l,a,N,U,c){if(!T.c)return l;const K=l.getEngine();if(!c&&!(c=l.activeCamera))throw new Error("Active camera not set");const w=c.viewport,S=K.getRenderHeight(),{x:J,y:n,width:y,height:H}=w.toGlobal(K.getRenderWidth(),S),u=Z.Matrix.Identity(),W=1/K.getHardwareScalingLevel();return a=a*W-J,N=N*W-(S-n-H),U.update(a,N,y,H,u,u,c.getProjectionMatrix()),l}function Y(l,a,N,U,c,K,Z,w){const S=a(U,N.enableDistantPicking),T=N.intersects(S,c,Z,K,U,w);return T&&T.hit?!c&&null!=l&&T.distance>=l.distance?null:T:null}function C(l,a,N,U,c,K){let w=null;const S=!!(l.activeCameras&&l.activeCameras.length>1&&l.cameraToUseForPointers!==l.activeCamera),J=l.cameraToUseForPointers||l.activeCamera,n=y.internalPickerForMesh||Y;for(let T=0;T<l.meshes.length;T++){const y=l.meshes[T];if(N){if(!N(y,-1))continue}else if(!y.isEnabled()||!y.isVisible||!y.mT)continue;const H=S&&y.isWorldMatrixCameraDependent(),u=y.qc(H,J);if(y.hasThinInstances&&y.tT){const l=n(w,a,y,u,!0,!0,K);if(l){if(c)return l;const S=Z.TmpVectors.Matrix[1],T=y.thinInstanceGetWorldMatrices();for(let l=0;l<T.length;l++){if(N&&!N(y,l))continue;T[l].multiplyToRef(u,S);const Z=n(w,a,y,S,U,c,K,!0);if(Z&&(w=Z,w.thinInstanceIndex=l,U))return w}}}else{const l=n(w,a,y,u,U,c,K);if(l&&(w=l,U))return w}}return w||new T.c}function M(l,a,N,U){if(!T.c)return null;const c=[],K=!!(l.activeCameras&&l.activeCameras.length>1&&l.cameraToUseForPointers!==l.activeCamera),w=l.cameraToUseForPointers||l.activeCamera,S=y.internalPickerForMesh||Y;for(let T=0;T<l.meshes.length;T++){const J=l.meshes[T];if(N){if(!N(J,-1))continue}else if(!J.isEnabled()||!J.isVisible||!J.mT)continue;const n=K&&J.isWorldMatrixCameraDependent(),y=J.qc(n,w);if(J.hasThinInstances&&J.tT){if(S(null,a,J,y,!0,!0,U)){const l=Z.TmpVectors.Matrix[1],K=J.thinInstanceGetWorldMatrices();for(let Z=0;Z<K.length;Z++){if(N&&!N(J,Z))continue;K[Z].multiplyToRef(y,l);const w=S(null,a,J,l,!1,!1,U,!0);w&&(w.thinInstanceIndex=Z,c.push(w))}}}else{const l=S(null,a,J,y,!1,!1,U);l&&c.push(l)}}return c}function A(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,U=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;U||(U=l.getWorldMatrix()),a.length=N,c?a.origin.K(c):a.origin.K(l.position);const K=Z.TmpVectors.ua[2];K.set(0,0,l._scene.useRightHandedSystem?-1:1);const w=Z.TmpVectors.ua[3];return Z.ua.TransformNormalToRef(K,U,w),Z.ua.NormalizeToRef(w,a.direction),a}var E,q;H._TmpVector3=(0,w.b)(6,Z.ua.Zero),H._RayDistant=H.Zero(),H._Smallnum=1e-8,H._Rayl=1e9,E=U.d,(q=c.e)&&(q.prototype.getForwardRay=function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,a=arguments.length>1?arguments[1]:void 0,N=arguments.length>2?arguments[2]:void 0;return A(this,new H(Z.ua.Zero(),Z.ua.Zero(),l),l,a,N)},q.prototype.getForwardRayToRef=function(l){return A(this,l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),E&&(n.c._IsPickingAvailable=!0,E.prototype.createPickingRay=function(l,a,N,U){return u(this,l,a,N,U,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),U.d.prototype.createPickingRayToRef=function(l,a,N,U,c){return W(this,l,a,N,U,c,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},U.d.prototype.createPickingRayInCameraSpace=function(l,a,N){return function(l,a,N,U){const c=H.Zero();return B(l,a,N,c,U),c}(this,l,a,N)},U.d.prototype.createPickingRayInCameraSpaceToRef=function(l,a,N,U){return B(this,l,a,N,U)},U.d.prototype.pickWithBoundingInfo=function(l,a,N,U,c){return function(l,a,N,U,c,K){if(!T.c)return null;const w=C(l,(U=>(l._tempPickingRay||(l._tempPickingRay=H.Zero()),W(l,a,N,U,l._tempPickingRay,K||null),l._tempPickingRay)),U,c,!0);return w&&(w.ray=u(l,a,N,Z.Matrix.Identity(),K||null)),w}(this,l,a,N,U,c)},U.d.prototype.nN=function(l,a,N,U,c,K){return function(l,a,N,U,c,K,w){const S=C(l,((U,c)=>(l._tempPickingRay||(l._tempPickingRay=H.Zero()),W(l,a,N,U,l._tempPickingRay,K||null,!1,c),l._tempPickingRay)),U,c,!1,w);return S&&(S.ray=u(l,a,N,Z.Matrix.Identity(),K||null)),S}(this,l,a,N,U,c,K)},U.d.prototype.pickWithRay=function(l,a,N,U){return function(l,a,N,U,c){const K=C(l,(N=>(l._pickWithRayInverseMatrix||(l._pickWithRayInverseMatrix=Z.Matrix.Identity()),N.invertToRef(l._pickWithRayInverseMatrix),l._cachedRayForTransform||(l._cachedRayForTransform=H.Zero()),H.TransformToRef(a,l._pickWithRayInverseMatrix,l._cachedRayForTransform),l._cachedRayForTransform)),N,U,!1,c);return K&&(K.ray=a),K}(this,l,a,N,U)},U.d.prototype.multiPick=function(l,a,N,U,c){return function(l,a,N,U,c,K){return M(l,(U=>u(l,a,N,U,c||null)),U,K)}(this,l,a,N,U,c)},U.d.prototype.multiPickWithRay=function(l,a,N){return function(l,a,N,U){return M(l,(N=>(l._pickWithRayInverseMatrix||(l._pickWithRayInverseMatrix=Z.Matrix.Identity()),N.invertToRef(l._pickWithRayInverseMatrix),l._cachedRayForTransform||(l._cachedRayForTransform=H.Zero()),H.TransformToRef(a,l._pickWithRayInverseMatrix,l._cachedRayForTransform),l._cachedRayForTransform)),N,U)}(this,l,a,N)}},14107:(l,a,N)=>{"use strict";var U=N(12373),c=N(12268),K=N(12298),Z=N(12403),w=N(12336),S=N(12386);w.c.prototype._partialLoadFile=function(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(l,(l=>{N[a]=l,N._internalCount++,6===N._internalCount&&U(N)}),void 0,void 0,!0,((l,a)=>{c&&l&&c(l.status+" "+l.statusText,a)}))},w.c.prototype._cascadeLoadFiles=function(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const c=[];c._internalCount=0;for(let K=0;K<6;K++)this._partialLoadFile(N[K],K,c,a,U)},w.c.prototype._cascadeLoadImgs=function(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5?arguments[5]:void 0;const Z=[];Z._internalCount=0;for(let w=0;w<6;w++)this._partialLoadImg(U[w],w,Z,l,a,N,c,K)},w.c.prototype._partialLoadImg=function(l,a,N,U,c,w){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7?arguments[7]:void 0;const J=(0,Z.b)();(0,K.s)(l,(l=>{N[a]=l,N._internalCount++,U&&U.removePendingData(J),6===N._internalCount&&w&&w(c,N)}),((l,a)=>{U&&U.removePendingData(J),S&&S(l,a)}),U?U.offlineProvider:null,T),U&&U.addPendingData(J)},w.c.prototype.createCubeTextureBase=function(l,a,N,K){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,H=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,W=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,B=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,Y=arguments.length>14&&void 0!==arguments[14]&&arguments[14],C=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const M=u||new U.c(this,7);M.isCube=!0,M.url=l,M.generateMipMaps=!K,M._lodGenerationScale=y,M._lodGenerationOffset=H,M._useSRGBBuffer=!!Y&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!K),M!==u&&(M.label=l.substring(0,60)),this._doNotHandleContextLost||(M._extension=J,M._files=N,M._buffer=C);const A=l;this._transformTextureUrl&&!u&&(l=this._transformTextureUrl(l));const E=J??function(l){const a=l.split("?")[0],N=a.lastIndexOf(".");return N>-1?a.substring(N).toLowerCase():""}(l),q=(0,S.d)(E),b=(l,a)=>{M.dispose(),w?w(l,a):l&&c.b.Warn(l)},z=(U,w)=>{l===A?U&&b(U.status+" "+U.statusText,w):(c.b.Warn(`Failed to load ${l}, falling back to the ${A}`),this.createCubeTextureBase(A,a,N,!!K,Z,b,T,J,n,y,H,M,W,B,Y,C))};if(q)q.then((U=>{const c=l=>{W&&W(M,l),U.loadCubeData(l,M,n,Z,((l,a)=>{b(l,a)}))};C?c(C):N&&6===N.length?U.supportCascades?this._cascadeLoadFiles(a,(l=>c(l.map((l=>new Uint8Array(l))))),N,b):b("Textures type does not support cascades."):this._loadFile(l,(l=>c(new Uint8Array(l))),void 0,void 0,!0,z)}));else{if(!N||0===N.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(a,M,((l,a)=>{B&&B(l,a)}),N,b)}return this._internalTexturesCache.push(M),M}},14666:(l,a,N)=>{"use strict";N(12268);var U=N(12564);N(12373),N(12514),N(12367),N(12614),N(12575);U.d},14138:(l,a,N)=>{"use strict";N.d(a,{d:()=>c});var U=N(12394);class c{constructor(l){this.value=this._toInt(l)}_toInt(l){return 0|l}add(l){return new c(this.value+l.value)}Wa(l){return new c(this.value-l.value)}multiply(l){return new c(Math.imul(this.value,l.value))}divide(l){return new c(this.value/l.value)}getClassName(){return c.ClassName}equals(l){return this.value===l.value}static FromValue(l){return new c(l)}toString(){return this.value.toString()}}c.ClassName="FlowGraphInteger",(0,U.g)("FlowGraphInteger",c)},14154:(l,a,N)=>{"use strict";N.d(a,{e:()=>c,i:()=>K});var U=N(12447);class c{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.nc=l}get m(){return this.nc}transformVector(l){return this.transformVectorToRef(l,new U.Vector2)}transformVectorToRef(l,a){return a.x=l.x*this.nc[0]+l.y*this.nc[1],a.y=l.x*this.nc[2]+l.y*this.nc[3],a}Bc(){return this.toArray()}toArray(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let a=0;a<4;a++)l[a]=this.nc[a];return l}yN(l){for(let a=0;a<4;a++)this.nc[a]=l[a];return this}multiplyToRef(l,a){const N=l.nc,U=this.nc,c=a.nc;return c[0]=N[0]*U[0]+N[1]*U[2],c[1]=N[0]*U[1]+N[1]*U[3],c[2]=N[2]*U[0]+N[3]*U[2],c[3]=N[2]*U[1]+N[3]*U[3],a}multiply(l){return this.multiplyToRef(l,new c)}divideToRef(l,a){const N=this.nc,U=l.nc,c=a.nc;return c[0]=N[0]/U[0],c[1]=N[1]/U[1],c[2]=N[2]/U[2],c[3]=N[3]/U[3],a}divide(l){return this.divideToRef(l,new c)}addToRef(l,a){const N=this.nc,U=l.m,c=a.m;return c[0]=N[0]+U[0],c[1]=N[1]+U[1],c[2]=N[2]+U[2],c[3]=N[3]+U[3],a}add(l){return this.addToRef(l,new c)}subtractToRef(l,a){const N=this.nc,U=l.m,c=a.m;return c[0]=N[0]-U[0],c[1]=N[1]-U[1],c[2]=N[2]-U[2],c[3]=N[3]-U[3],a}Wa(l){return this.subtractToRef(l,new c)}transpose(){const l=this.nc;return new c([l[0],l[2],l[1],l[3]])}determinant(){const l=this.nc;return l[0]*l[3]-l[1]*l[2]}inverse(){const l=this.determinant();if(0===l)throw new Error("Matrix is not invertible");const a=this.nc,N=1/l;return new c([a[3]*N,-a[1]*N,-a[2]*N,a[0]*N])}equals(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const N=this.nc,U=l.m;return 0===a?N[0]===U[0]&&N[1]===U[1]&&N[2]===U[2]&&N[3]===U[3]:Math.abs(N[0]-U[0])<a&&Math.abs(N[1]-U[1])<a&&Math.abs(N[2]-U[2])<a&&Math.abs(N[3]-U[3])<a}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.nc.join(", ")})`}}class K{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.nc=l}get m(){return this.nc}transformVector(l){return this.transformVectorToRef(l,new U.ua)}transformVectorToRef(l,a){const N=this.nc;return a.x=l.x*N[0]+l.y*N[1]+l.z*N[2],a.y=l.x*N[3]+l.y*N[4]+l.z*N[5],a.z=l.x*N[6]+l.y*N[7]+l.z*N[8],a}multiplyToRef(l,a){const N=l.nc,U=this.nc,c=a.m;return c[0]=N[0]*U[0]+N[1]*U[3]+N[2]*U[6],c[1]=N[0]*U[1]+N[1]*U[4]+N[2]*U[7],c[2]=N[0]*U[2]+N[1]*U[5]+N[2]*U[8],c[3]=N[3]*U[0]+N[4]*U[3]+N[5]*U[6],c[4]=N[3]*U[1]+N[4]*U[4]+N[5]*U[7],c[5]=N[3]*U[2]+N[4]*U[5]+N[5]*U[8],c[6]=N[6]*U[0]+N[7]*U[3]+N[8]*U[6],c[7]=N[6]*U[1]+N[7]*U[4]+N[8]*U[7],c[8]=N[6]*U[2]+N[7]*U[5]+N[8]*U[8],a}multiply(l){return this.multiplyToRef(l,new K)}divideToRef(l,a){const N=this.nc,U=l.m,c=a.m;return c[0]=N[0]/U[0],c[1]=N[1]/U[1],c[2]=N[2]/U[2],c[3]=N[3]/U[3],c[4]=N[4]/U[4],c[5]=N[5]/U[5],c[6]=N[6]/U[6],c[7]=N[7]/U[7],c[8]=N[8]/U[8],a}divide(l){return this.divideToRef(l,new K)}addToRef(l,a){const N=this.nc,U=l.m,c=a.m;return c[0]=N[0]+U[0],c[1]=N[1]+U[1],c[2]=N[2]+U[2],c[3]=N[3]+U[3],c[4]=N[4]+U[4],c[5]=N[5]+U[5],c[6]=N[6]+U[6],c[7]=N[7]+U[7],c[8]=N[8]+U[8],a}add(l){return this.addToRef(l,new K)}subtractToRef(l,a){const N=this.nc,U=l.m,c=a.m;return c[0]=N[0]-U[0],c[1]=N[1]-U[1],c[2]=N[2]-U[2],c[3]=N[3]-U[3],c[4]=N[4]-U[4],c[5]=N[5]-U[5],c[6]=N[6]-U[6],c[7]=N[7]-U[7],c[8]=N[8]-U[8],a}Wa(l){return this.subtractToRef(l,new K)}toArray(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let a=0;a<9;a++)l[a]=this.nc[a];return l}Bc(){return this.toArray()}yN(l){for(let a=0;a<9;a++)this.nc[a]=l[a];return this}transpose(){const l=this.nc;return new K([l[0],l[3],l[6],l[1],l[4],l[7],l[2],l[5],l[8]])}determinant(){const l=this.nc;return l[0]*(l[4]*l[8]-l[5]*l[7])-l[1]*(l[3]*l[8]-l[5]*l[6])+l[2]*(l[3]*l[7]-l[4]*l[6])}inverse(){const l=this.determinant();if(0===l)throw new Error("Matrix is not invertible");const a=this.nc,N=1/l;return new K([(a[4]*a[8]-a[5]*a[7])*N,(a[2]*a[7]-a[1]*a[8])*N,(a[1]*a[5]-a[2]*a[4])*N,(a[5]*a[6]-a[3]*a[8])*N,(a[0]*a[8]-a[2]*a[6])*N,(a[2]*a[3]-a[0]*a[5])*N,(a[3]*a[7]-a[4]*a[6])*N,(a[1]*a[6]-a[0]*a[7])*N,(a[0]*a[4]-a[1]*a[3])*N])}equals(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const N=this.nc,U=l.m;return 0===a?N[0]===U[0]&&N[1]===U[1]&&N[2]===U[2]&&N[3]===U[3]&&N[4]===U[4]&&N[5]===U[5]&&N[6]===U[6]&&N[7]===U[7]&&N[8]===U[8]:Math.abs(N[0]-U[0])<a&&Math.abs(N[1]-U[1])<a&&Math.abs(N[2]-U[2])<a&&Math.abs(N[3]-U[3])<a&&Math.abs(N[4]-U[4])<a&&Math.abs(N[5]-U[5])<a&&Math.abs(N[6]-U[6])<a&&Math.abs(N[7]-U[7])<a&&Math.abs(N[8]-U[8])<a}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.nc.join(", ")})`}}},14159:(l,a,N)=>{"use strict";var U;function c(l,a,N,U){switch(a){case"Animation":return U?l.animations.find((l=>l.uniqueId===N))??null:l.animations[N]??null;case"AnimationGroup":return U?l.animationGroups.find((l=>l.uniqueId===N))??null:l.animationGroups[N]??null;case"Mesh":return U?l.meshes.find((l=>l.uniqueId===N))??null:l.meshes[N]??null;case"Material":return U?l.materials.find((l=>l.uniqueId===N))??null:l.materials[N]??null;case"CJ":return U?l.cameras.find((l=>l.uniqueId===N))??null:l.cameras[N]??null;case"Light":return U?l.lights.find((l=>l.uniqueId===N))??null:l.lights[N]??null;default:return null}}N.d(a,{c:()=>c}),function(l){l.Animation="Animation",l.AnimationGroup="AnimationGroup",l.Mesh="Mesh",l.Material="Material",l.CJ="CJ",l.Light="Light"}(U||(U={}))},14192:(l,a,N)=>{"use strict";N.d(a,{b:()=>c});var U=N(14195);class c extends U.b{constructor(l,a){if(super(l),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),a)for(const N of a)this._eventsSignalOutputs[N]=this._registerSignalOutput(N+"Event")}_executeOnTick(l){}_startPendingTasks(l){l._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(l),this._resetAfterCanceled(l)),this._preparePendingTasks(l),l._addPendingBlock(this),this.out._activateSignal(l),l._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(l){l._deleteExecutionVariable(this,"_initialized"),l._removePendingBlock(this)}}},14171:(l,a,N)=>{"use strict";N.d(a,{e:()=>T});var U=N(12403),c=N(12394),K=N(14176),Z=N(12260),w=N(14131);class S extends K.b{constructor(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:U.defaultValue,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(l,a,N),this.richType=U,this._defaultValue=c,this._optional=K,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Z.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(l){this._isDisabled!==l&&(this._isDisabled=l,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(l,a){a._getConnectionValue(this)!==l&&(a._setConnectionValue(this,l),this.onValueChangedObservable.notifyObservers(l))}resetToDefaultValue(l){l._setConnectionValue(this,this._defaultValue)}connectTo(l){this._isDisabled||super.connectTo(l)}_getValueOrDefault(l){const a=l._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(a):a}getValue(l){if(1===this.connectionType){l._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(l);const a=this._getValueOrDefault(l);return this._lastValue=a,this.richType.typeTransformer?this.richType.typeTransformer(a):a}const a=this.isConnected()?this._connectedPoint[0].getValue(l):this._getValueOrDefault(l);return this._lastValue=a,this.richType.typeTransformer?this.richType.typeTransformer(a):a}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(l),l.richType={},this.richType.serialize(l.richType),l.optional=this._optional,(0,w.e)("defaultValue",this._defaultValue,l)}}(0,c.g)("FlowGraphDataConnection",S);class T{constructor(l){var a;this.config=l,this.uniqueId=(0,U.b)(),this.name=(null===(a=this.config)||void 0===a?void 0:a.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(l){}registerDataInput(l,a,N){const U=new S(l,0,this,a,N);return this.dataInputs.push(U),U}registerDataOutput(l,a,N){const U=new S(l,1,this,a,N);return this.dataOutputs.push(U),U}getDataInput(l){return this.dataInputs.find((a=>a.name===l))}getDataOutput(l){return this.dataOutputs.find((a=>a.name===l))}serialize(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.e;if(l.uniqueId=this.uniqueId,l.config={},this.config){const N=this.config,U=Object.keys(N);for(const c of U)a(c,N[c],l.config)}l.dataInputs=[],l.dataOutputs=[],l.className=this.getClassName();for(const N of this.dataInputs){const a={};N.serialize(a),l.dataInputs.push(a)}for(const N of this.dataOutputs){const a={};N.serialize(a),l.dataOutputs.push(a)}}deserialize(l){}_log(l,a,N){var U;null===(U=l.logger)||void 0===U||U.addLogItem({action:a,HN:N,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14176:(l,a,N)=>{"use strict";N.d(a,{b:()=>K});var U,c=N(12403);!function(l){l[l.Input=0]="Input",l[l.Output=1]="Output"}(U||(U={}));class K{constructor(l,a,N){this._ownerBlock=N,this._connectedPoint=[],this.uniqueId=(0,c.b)(),this.connectedPointIds=[],this.name=l,this._connectionType=a}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(l){if(this._connectionType===l._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||l._isSingularConnection()&&l._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(l),l._connectedPoint.push(this)}disconnectFrom(l){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const N=this._connectedPoint.indexOf(l),U=l._connectedPoint.indexOf(this);-1!==N&&-1!==U&&(a&&this._connectedPoint.splice(N,1),l._connectedPoint.splice(U,1))}disconnectFromAll(){for(const l of this._connectedPoint)this.disconnectFrom(l,!1);this._connectedPoint.length=0}dispose(){for(const l of this._connectedPoint)this.disconnectFrom(l)}serialize(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l.uniqueId=this.uniqueId,l.name=this.name,l._connectionType=this._connectionType,l.connectedPointIds=[],l.className=this.getClassName();for(const a of this._connectedPoint)l.connectedPointIds.push(a.uniqueId)}getClassName(){return"FGConnection"}deserialize(l){this.uniqueId=l.uniqueId,this.name=l.name,this._connectionType=l._connectionType,this.connectedPointIds=l.connectedPointIds}}},14126:(l,a,N)=>{"use strict";N.d(a,{b:()=>M});var U,c=N(12260),K=N(12429),Z=N(12432),w=N(12403),S=N(14131),T=N(14159),J=N(12268);!function(l){l.ExecuteBlock="ExecuteBlock",l.ExecuteEvent="ExecuteEvent",l.TriggerConnection="TriggerConnection",l.ContextVariableSet="ContextVariableSet",l.GlobalVariableSet="GlobalVariableSet",l.GlobalVariableDelete="GlobalVariableDelete",l.GlobalVariableGet="GlobalVariableGet",l.AddConnection="AddConnection",l.GetConnectionValue="GetConnectionValue",l.SetConnectionValue="SetConnectionValue",l.ActivateSignal="ActivateSignal",l.ContextVariableGet="ContextVariableGet"}(U||(U={}));class n{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(l){if(l.time||(l.time=Date.now()),this.log.push(l),this.logToConsole){var a;const N=null===(a=l.HN)||void 0===a?void 0:a.value;"object"===typeof N&&N.getClassName?J.b.Log(`[FGLog] ${l.className}:${l.uniqueId.split("-")[0]} ${l.action} - ${JSON.stringify(N.getClassName())}: ${N.toString()}`):J.b.Log(`[FGLog] ${l.className}:${l.uniqueId.split("-")[0]} ${l.action} - ${JSON.stringify(l.HN)}`)}}getItemsOfType(l){return this.log.filter((a=>a.action===l))}}class y{get enableLogging(){return this._enableLogging}set enableLogging(l){this._enableLogging!==l&&(this._enableLogging=l,this._enableLogging?(this.logger=new n,this.logger.logToConsole=!0):this.logger=null)}constructor(l){this.uniqueId=(0,w.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new c.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=l,this.assetsContext=l.assetsContext??l.Ba}hasVariable(l){return l in this._userVariables}setVariable(l,a){var N;this._userVariables[l]=a,null===(N=this.logger)||void 0===N||N.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",HN:{name:l,value:a}})}getAsset(l,a){return(0,T.c)(this.assetsContext,l,a)}getVariable(l){var a;return null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",HN:{name:l,value:this._userVariables[l]}}),this._userVariables[l]}get userVariables(){return this._userVariables}bl(){return this._configuration.Ba}_getUniqueIdPrefixedName(l,a){return`${l.uniqueId}_${a}`}_getGlobalContextVariable(l,a){var N;return null===(N=this.logger)||void 0===N||N.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",HN:{name:l,defaultValue:a,possibleValue:this._globalContextVariables[l]}}),this._hasGlobalContextVariable(l)?this._globalContextVariables[l]:a}_setGlobalContextVariable(l,a){var N;null===(N=this.logger)||void 0===N||N.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",HN:{name:l,value:a}}),this._globalContextVariables[l]=a}_deleteGlobalContextVariable(l){var a;null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",HN:{name:l}}),delete this._globalContextVariables[l]}_hasGlobalContextVariable(l){return l in this._globalContextVariables}_setExecutionVariable(l,a,N){this._executionVariables[this._getUniqueIdPrefixedName(l,a)]=N}_getExecutionVariable(l,a,N){return this._hasExecutionVariable(l,a)?this._executionVariables[this._getUniqueIdPrefixedName(l,a)]:N}_deleteExecutionVariable(l,a){delete this._executionVariables[this._getUniqueIdPrefixedName(l,a)]}_hasExecutionVariable(l,a){return this._getUniqueIdPrefixedName(l,a)in this._executionVariables}_hasConnectionValue(l){return l.uniqueId in this._connectionValues}_setConnectionValue(l,a){var N;this._connectionValues[l.uniqueId]=a,null===(N=this.logger)||void 0===N||N.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",HN:{connectionPointId:l.uniqueId,value:a}})}_setConnectionValueByKey(l,a){this._connectionValues[l]=a}_getConnectionValue(l){var a;return null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",HN:{connectionPointId:l.uniqueId,value:this._connectionValues[l.uniqueId]}}),this._connectionValues[l.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(l){this._pendingBlocks.includes(l)||(this._pendingBlocks.push(l),this._pendingBlocks.sort(((l,a)=>l.priority-a.priority)))}_removePendingBlock(l){const a=this._pendingBlocks.indexOf(l);-1!==a&&this._pendingBlocks.splice(a,1)}_clearPendingBlocks(){for(const l of this._pendingBlocks)l._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(l){var a;this.onNodeExecutedObservable.notifyObservers(l),null===(a=this.logger)||void 0===a||a.addLogItem({time:Date.now(),className:l.getClassName(),uniqueId:l.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(l){this._setGlobalContextVariable("timeSinceStart",l.timeSinceStart),this._setGlobalContextVariable("deltaTime",l.deltaTime);for(const N of this._pendingBlocks){var a;null===(a=N._executeOnTick)||void 0===a||a.call(N,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.e;l.uniqueId=this.uniqueId,l._userVariables={};for(const U in this._userVariables)a(U,this._userVariables[U],l._userVariables);l._connectionValues={};for(const U in this._connectionValues)a(U,this._connectionValues[U],l._connectionValues);var N;this.assetsContext!==this.bl()&&(l._assetsContext={meshes:this.assetsContext.meshes.map((l=>l.id)),materials:this.assetsContext.materials.map((l=>l.id)),textures:this.assetsContext.textures.map((l=>l.name)),animations:this.assetsContext.animations.map((l=>l.name)),lights:this.assetsContext.lights.map((l=>l.id)),cameras:this.assetsContext.cameras.map((l=>l.id)),mH:null===(N=this.assetsContext.mH)||void 0===N?void 0:N.map((l=>l.name)),skeletons:this.assetsContext.skeletons.map((l=>l.id)),wy:this.assetsContext.wy.map((l=>l.name)),geometries:this.assetsContext.geometries.map((l=>l.id)),multiMaterials:this.assetsContext.multiMaterials.map((l=>l.id)),transformNodes:this.assetsContext.transformNodes.map((l=>l.id))})}getClassName(){return"FlowGraphContext"}}(0,K.d)([(0,Z.K)()],y.prototype,"uniqueId",void 0);var H=N(14167),u=N(12715);class W{constructor(l){this.onEventTriggeredObservable=new c.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=l,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Tc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const l=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",HN:{timeSinceStart:this._startingTime,deltaTime:l}}),this._startingTime+=l})),this._meshPickedObserver=this._scene.onPointerObservable.add((l=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",HN:l})}),u.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((l=>{const a=l.pointerId,N=l.mesh,U=this._pointerUnderMeshState[a];!U&&N?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",HN:{pointerId:a,mesh:N}}):U&&!N?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",HN:{pointerId:a,mesh:U}}):U&&N&&U!==N&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",HN:{pointerId:a,mesh:U,over:N}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",HN:{pointerId:a,mesh:N,out:U}})),this._pointerUnderMeshState[a]=N}),u.d.POINTERMOVE)}dispose(){var l,a,N,U,c;null===(l=this._sceneDisposeObserver)||void 0===l||l.remove(),null===(a=this._sceneReadyObserver)||void 0===a||a.remove(),null===(N=this._sceneOnBeforeRenderObserver)||void 0===N||N.remove(),null===(U=this._meshPickedObserver)||void 0===U||U.remove(),null===(c=this._meshUnderPointerObserver)||void 0===c||c.remove(),this.onEventTriggeredObservable.clear()}}var B,Y=N(14179);!function(l){l[l.Stopped=0]="Stopped",l[l.Started=1]="Started"}(B||(B={}));class C{get state(){return this._state}set state(l){this._state=l,this.onStateChangedObservable.notifyObservers(l)}constructor(l){this.onStateChangedObservable=new c.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=l.Ba,this._sceneEventCoordinator=new W(this._scene),this._coordinator=l.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((l=>{for(const a of this._executionContexts){const N=this._getContextualOrder(l.type,a);for(const U of N)if(!U._executeEvent(a,l.HN))break}switch(l.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const a of this._executionContexts)a._notifyOnTick(l.HN);break;case"SceneDispose":this.dispose()}}))}createContext(){const l=new y({Ba:this._scene,coordinator:this._coordinator});return this._executionContexts.push(l),l}getContext(l){return this._executionContexts[l]}addEventBlock(l){if("PointerOver"!==l.type&&"PointerOut"!==l.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==l.type&&this._eventBlocks[l.type].push(l),1===this.state)for(const a of this._executionContexts)l._startPendingTasks(a);else this.onStateChangedObservable.addOnce((a=>{if(1===a)for(const N of this._executionContexts)l._startPendingTasks(N)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((l=>{1===l&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const l of this._executionContexts)for(const a in this._eventBlocks){const N=this._getContextualOrder(a,l);for(const a of N)a._startPendingTasks(l)}}_getContextualOrder(l,a){const N=this._eventBlocks[l].sort(((l,a)=>a.initPriority-l.initPriority));if("MeshPick"===l){const l=[];for(const U of N){const c=U.asset.getValue(a);let K=0;for(;K<N.length;K++){const l=N[K].asset.getValue(a);if(c&&l&&(0,Y.l)(c,l))break}l.splice(K,0,U)}return l}return N}dispose(){var l;if(0!==this.state){this.state=0;for(const l of this._executionContexts)l._clearPendingBlocks();this._executionContexts.length=0;for(const l in this._eventBlocks)this._eventBlocks[l].length=0;null===(l=this._eventObserver)||void 0===l||l.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(l){const a=[],N=new Set;for(const U in this._eventBlocks)for(const l of this._eventBlocks[U])a.push(l),N.add(l.uniqueId);for(;a.length>0;){const U=a.pop();l(U);for(const l of U.dataInputs)for(const U of l._connectedPoint)N.has(U._ownerBlock.uniqueId)||(a.push(U._ownerBlock),N.add(U._ownerBlock.uniqueId));if(U instanceof H.b)for(const l of U.signalOutputs)for(const U of l._connectedPoint)N.has(U._ownerBlock.uniqueId)||(a.push(U._ownerBlock),N.add(U._ownerBlock.uniqueId))}}serialize(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;l.allBlocks=[],this.visitAllBlocks((a=>{const N={};a.serialize(N),l.allBlocks.push(N)})),l.executionContexts=[];for(const N of this._executionContexts){const U={};N.serialize(U,a),l.executionContexts.push(U)}}}class M{constructor(l){this.config=l,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Ba.Tc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Ba.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const l=this._executeOnNextFrame.slice(0);if(l.length)for(const a of l){this.notifyCustomEvent(a.id,a.data,!1);const l=this._executeOnNextFrame.findIndex((l=>l.uniqueId===a.uniqueId));-1!==l&&this._executeOnNextFrame.splice(l,1)}}));(M.SceneCoordinators.get(this.config.Ba)??[]).push(this)}createGraph(){const l=new C({Ba:this.config.Ba,coordinator:this});return this._flowGraphs.push(l),l}removeGraph(l){const a=this._flowGraphs.indexOf(l);-1!==a&&(l.dispose(),this._flowGraphs.splice(a,1))}start(){for(const l of this._flowGraphs)l.start()}dispose(){var l,a;for(const c of this._flowGraphs)c.dispose();this._flowGraphs.length=0,null===(l=this._disposeObserver)||void 0===l||l.remove(),null===(a=this._onBeforeRenderObserver)||void 0===a||a.remove();const N=M.SceneCoordinators.get(this.config.Ba)??[],U=N.indexOf(this);-1!==U&&N.splice(U,1)}serialize(l,a){l._flowGraphs=[];for(const N of this._flowGraphs){const U={};N.serialize(U,a),l._flowGraphs.push(U)}l.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(l){let a=this._customEventsMap.get(l);return a||(a=new c.e,this._customEventsMap.set(l,a)),a}notifyCustomEvent(l,a){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:l,data:a,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(l)){const a=this._eventExecutionCounter.get(l);if(this._eventExecutionCounter.set(l,a+1),a>=M.MaxEventTypeExecutionPerFrame)return void(a===M.MaxEventTypeExecutionPerFrame&&J.b.Warn(`FlowGraphCoordinator: Too many executions of event "${l}".`))}else this._eventExecutionCounter.set(l,1);const N=this._customEventsMap.get(l);N&&N.notifyObservers(a)}}M.MaxEventsPerType=30,M.MaxEventTypeExecutionPerFrame=30,M.SceneCoordinators=new Map},14188:(l,a,N)=>{"use strict";N.d(a,{e:()=>c});var U=N(14192);class c extends U.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(l){l._notifyExecuteNode(this),this.done._activateSignal(l)}}},14167:(l,a,N)=>{"use strict";N.d(a,{b:()=>w});var U=N(14171),c=N(14176),K=N(12394);class Z extends c.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(l){super.connectTo(l),this._connectedPoint.sort(((l,a)=>a.priority-l.priority))}_activateSignal(l){var a;if(null===(a=l.logger)||void 0===a||a.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,HN:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)l._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(l,this),l._increaseExecutionId();else for(const N of this._connectedPoint)N._activateSignal(l)}}(0,K.g)("FlowGraphSignalConnection",Z);class w extends U.e{constructor(l){super(l),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(l){const a=new Z(l,0,this);return this.signalInputs.push(a),a}_registerSignalOutput(l){const a=new Z(l,1,this);return this.signalOutputs.push(a),a}_unregisterSignalInput(l){const a=this.signalInputs.findIndex((a=>a.name===l));-1!==a&&(this.signalInputs[a].dispose(),this.signalInputs.splice(a,1))}_unregisterSignalOutput(l){const a=this.signalOutputs.findIndex((a=>a.name===l));-1!==a&&(this.signalOutputs[a].dispose(),this.signalOutputs.splice(a,1))}_reportError(l,a){this.error.HN="string"===typeof a?new Error(a):a,this.error._activateSignal(l)}getSignalInput(l){return this.signalInputs.find((a=>a.name===l))}getSignalOutput(l){return this.signalOutputs.find((a=>a.name===l))}serialize(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(l),l.signalInputs=[],l.signalOutputs=[];for(const a of this.signalInputs){const N={};a.serialize(N),l.signalInputs.push(N)}for(const a of this.signalOutputs){const N={};a.serialize(N),l.signalOutputs.push(N)}}deserialize(l){for(let a=0;a<l.signalInputs.length;a++){const N=this.getSignalInput(l.signalInputs[a].name);if(!N)throw new Error("Could not find signal input with name "+l.signalInputs[a].name+" in block "+l.className);N.deserialize(l.signalInputs[a])}for(let a=0;a<l.signalOutputs.length;a++){const N=this.getSignalOutput(l.signalOutputs[a].name);if(!N)throw new Error("Could not find signal output with name "+l.signalOutputs[a].name+" in block "+l.className);N.deserialize(l.signalOutputs[a])}}getClassName(){return"FlowGraphExecutionBlock"}}},14195:(l,a,N)=>{"use strict";N.d(a,{b:()=>c});var U=N(14167);class c extends U.b{constructor(l){super(l),this.out=this._registerSignalOutput("out")}}},14145:(l,a,N)=>{"use strict";N.d(a,{A:()=>H,B:()=>u,E:()=>W,H:()=>I,J:()=>t,M:()=>z,Q:()=>b,d:()=>T,h:()=>y,l:()=>q,m:()=>B,n:()=>Y,q:()=>C,t:()=>n,w:()=>E,x:()=>J});var U,c=N(12447),K=N(12479),Z=N(14138),w=N(14154);!function(l){l.Any="any",l.String="string",l.Number="number",l.Boolean="boolean",l.Object="object",l.Integer="FlowGraphInteger",l.Vector2="Vector2",l.ua="ua",l.Vector4="Vector4",l.Quaternion="Quaternion",l.Matrix="Matrix",l.Matrix2D="Matrix2D",l.Matrix3D="Matrix3D",l.Ca="Ca",l.Qc="Qc"}(U||(U={}));class S{constructor(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=l,this.defaultValue=a,this.animationType=N}serialize(l){l.typeName=this.typeName,l.defaultValue=this.defaultValue}}const T=new S("any",void 0),J=new S("string",""),n=new S("number",0,0),y=new S("boolean",!1),H=new S("Vector2",c.Vector2.Zero(),5),u=new S("ua",c.ua.Zero(),1),W=new S("Vector4",c.Vector4.Zero()),B=new S("Matrix",c.Matrix.Identity(),3),Y=new S("Matrix2D",new w.e),C=new S("Matrix3D",new w.i),M=new S("Ca",K.Ca.Black(),4),A=new S("Qc",new K.Qc(0,0,0,0),7),E=new S("Quaternion",c.Quaternion.Identity(),2);E.typeTransformer=l=>{if(l.getClassName){if("Vector4"===l.getClassName())return c.Quaternion.Ma(l.Bc());if("ua"===l.getClassName())return c.Quaternion.FromEulerVector(l);if("Matrix"===l.getClassName())return c.Quaternion.FromRotationMatrix(l)}return l};const q=new S("FlowGraphInteger",new Z.d(0),0);function b(l){const a=l;switch(typeof l){case"string":return J;case"number":return n;case"boolean":return y;case"object":if(a.getClassName)switch(a.getClassName()){case"Vector2":return H;case"ua":return u;case"Vector4":return W;case"Matrix":return B;case"Ca":return M;case"Qc":return A;case"Quaternion":return E;case"FlowGraphInteger":return q;case"Matrix2D":return Y;case"Matrix3D":return C}return T;default:return T}}function z(l){switch(l){case"string":return J;case"number":return n;case"boolean":return y;case"Vector2":return H;case"ua":return u;case"Vector4":return W;case"Matrix":return B;case"Ca":return M;case"Qc":return A;case"Quaternion":return E;case"FlowGraphInteger":return q;case"Matrix2D":return Y;case"Matrix3D":return C;default:return T}}function I(l){switch(l){case"number":default:return 0;case"Vector2":return 5;case"ua":return 1;case"Matrix":return 3;case"Ca":return 4;case"Qc":return 7;case"Quaternion":return 2}}function t(l){switch(l){case 0:return n;case 5:return H;case 1:return u;case 3:return B;case 4:return M;case 7:return A;case 2:return E;default:return T}}},14131:(l,a,N)=>{"use strict";N.d(a,{b:()=>J,e:()=>T,i:()=>n});var U=N(12479),c=N(12447),K=N(14138),Z=N(14145),w=N(14154);function S(l){return"Vector2"===l||"ua"===l||"Vector4"===l||"Quaternion"===l||"Ca"===l||"Qc"===l}function T(l,a,N){var U;const c=(null===a||void 0===a||null===(U=a.getClassName)||void 0===U?void 0:U.call(a))??"";if(S(c)||function(l){return"Matrix"===l||"Matrix2D"===l||"Matrix3D"===l}(c))N[l]={value:a.Bc(),className:c};else if("FlowGraphInteger"===c)N[l]={value:a.value,className:c};else if(c&&(a.id||a.name))N[l]={id:a.id,name:a.name,className:c};else{if("object"===typeof a)throw new Error(`Could not serialize value ${a}`);N[l]=a}}function J(l,a,N,T){const n=a[l];let y;const H=(null===n||void 0===n?void 0:n.type)??(null===n||void 0===n?void 0:n.className);if(function(l){return"Mesh"===l||"AbstractMesh"===l||"GroundMesh"===l||"InstanceMesh"===l||"LinesMesh"===l||"GoldbergMesh"===l||"GreasedLineMesh"===l||"TrailMesh"===l}(H)){let l=T.meshes.filter((l=>n.id?l.id===n.id:l.name===n.name));0===l.length&&(l=T.transformNodes.filter((l=>n.id?l.id===n.id:l.name===n.name))),y=n.uniqueId?l.find((l=>l.uniqueId===n.uniqueId)):l[0]}else if(S(H))y=function(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===l)return c.Vector2.Ma(a);if("ua"===l)return N&&(a[2]*=-1),c.ua.Ma(a);if("Vector4"===l)return c.Vector4.Ma(a);if("Quaternion"===l)return N&&(a[2]*=-1,a[3]*=-1),c.Quaternion.Ma(a);if("Ca"===l)return new U.Ca(a[0],a[1],a[2]);if("Qc"===l)return new U.Qc(a[0],a[1],a[2],a[3]);throw new Error(`Unknown vector class name ${l}`)}(H,n.value);else if(function(l){return"AnimationGroup"===l}(H)){const l=T.animationGroups.filter((l=>l.name===n.name));y=1===l.length?l[0]:l.find((l=>l.uniqueId===n.uniqueId))}else y="Matrix"===H?c.Matrix.Ma(n.value):"Matrix2D"===H?new w.e(n.value):"Matrix3D"===H?new w.i(n.value):"FlowGraphInteger"===H?K.d.FromValue(n.value):"number"===H||"string"===H||"boolean"===H?n.value[0]:n&&void 0!==n.value?n.value:Array.isArray(n)?n.reduce(((l,a)=>a.eventData?(l[a.id]={type:(0,Z.M)(a.type)},"undefined"!==typeof a.value&&(l[a.id].value=J("value",a,N,T)),l):l),{}):n;return y}function n(l){return"FlowGraphJsonPointerParserBlock"===l}},14179:(l,a,N)=>{"use strict";function U(l,a){return!(!l.parent||l.parent!==a&&!U(l.parent,a))}function c(l){if(l.getClassName)return l.getClassName()}function K(l,a){return l===a&&("Vector2"===l||"ua"===l||"Vector4"===l||"Quaternion"===l)}function Z(l,a){return l===a&&("Matrix"===l||"Matrix2D"===l||"Matrix3D"===l)}function w(l,a){return"FlowGraphInteger"===l&&"FlowGraphInteger"===a}function S(l,a){const N="number"===typeof l||"number"===typeof(null===l||void 0===l?void 0:l.value);return N&&!a?!isNaN(T(l)):N}function T(l){return"number"===typeof l?l:l.value}N.d(a,{b:()=>w,c:()=>Z,e:()=>K,h:()=>c,l:()=>U,n:()=>T,o:()=>S})},13521:(l,a,N)=>{"use strict";N.r(a),N.d(a,{SceneInstrumentation:()=>K});var U=N(12254),c=N(12655);class K{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(l){l!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=l,l?(this._onBeforeActiveMeshesEvaluationObserver=this.Ba.onBeforeActiveMeshesEvaluationObservable.add((()=>{U.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Ba.onAfterActiveMeshesEvaluationObservable.add((()=>{U.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Ba.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Ba.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(l){l!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=l,l?(this._onBeforeRenderTargetsRenderObserver=this.Ba.onBeforeRenderTargetsRenderObservable.add((()=>{U.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Ba.onAfterRenderTargetsRenderObservable.add((()=>{U.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Ba.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Ba.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(l){l!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=l,l?(this._onBeforeParticlesRenderingObserver=this.Ba.onBeforeParticlesRenderingObservable.add((()=>{U.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Ba.onAfterParticlesRenderingObservable.add((()=>{U.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Ba.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Ba.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(l){l!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=l,this.Ba.spriteManagers&&(l?(this._onBeforeSpritesRenderingObserver=this.Ba.onBeforeSpritesRenderingObservable.add((()=>{U.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Ba.onAfterSpritesRenderingObservable.add((()=>{U.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Ba.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Ba.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(l){l!==this._capturePhysicsTime&&this.Ba.onBeforePhysicsObservable&&(this._capturePhysicsTime=l,l?(this._onBeforePhysicsObserver=this.Ba.onBeforePhysicsObservable.add((()=>{U.Tools.StartPerformanceCounter("sc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Ba.onAfterPhysicsObservable.add((()=>{U.Tools.EndPerformanceCounter("sc"),this._physicsTime.endMonitoring()}))):(this.Ba.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Ba.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(l){l!==this._captureAnimationsTime&&(this._captureAnimationsTime=l,l?this._onAfterAnimationsObserver=this.Ba.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Ba.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(l){this._captureFrameTime=l}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(l){this._captureInterFrameTime=l}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(l){l!==this._captureRenderTime&&(this._captureRenderTime=l,l?(this._onBeforeDrawPhaseObserver=this.Ba.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),U.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Ba.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),U.Tools.EndPerformanceCounter("Main render")}))):(this.Ba.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Ba.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(l){l!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=l,l?(this._onBeforeCameraRenderObserver=this.Ba.onBeforeCameraRenderObservable.add((l=>{this._cameraRenderTime.beginMonitoring(),U.Tools.StartPerformanceCounter(`Rendering camera ${l.name}`)})),this._onAfterCameraRenderObserver=this.Ba.onAfterCameraRenderObservable.add((l=>{this._cameraRenderTime.endMonitoring(!1),U.Tools.EndPerformanceCounter(`Rendering camera ${l.name}`)}))):(this.Ba.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Ba.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Ba.getEngine()._drawCalls}constructor(l){this.Ba=l,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new c.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new c.e,this._captureFrameTime=!1,this._frameTime=new c.e,this._captureRenderTime=!1,this._renderTime=new c.e,this._captureInterFrameTime=!1,this._interFrameTime=new c.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new c.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new c.e,this._capturePhysicsTime=!1,this._physicsTime=new c.e,this._captureAnimationsTime=!1,this._animationsTime=new c.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new c.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=l.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(U.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Ba.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=l.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(U.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Sc(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Sc(),this._captureParticlesRenderTime&&this._particlesRenderTime.Sc(),this._captureSpritesRenderTime&&this._spritesRenderTime.Sc(),this._captureRenderTime&&this._renderTime.Sc(),this._captureCameraRenderTime&&this._cameraRenderTime.Sc()}))}dispose(){this._disposed||(this.Ba.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Ba.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Ba.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Ba.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Ba.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Ba.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Ba.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Ba.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Ba.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Ba.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Ba.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Ba.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Ba.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Ba.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Ba.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Ba.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Ba.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Ba=null,this._disposed=!0)}}},14120:(l,a,N)=>{"use strict";N.d(a,{d:()=>J});var U=N(12429),c=N(12432),K=N(12447),Z=N(12861),w=N(12966),S=N(13016),T=N(12394);Z.c.AddNodeConstructor("Light_Type_1",((l,a)=>()=>new J(l,K.ua.Zero(),a)));class J extends S.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(l){this._shadowFrustumSize=l,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(l){this._shadowOrthoScale=l,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(l){this._orthoLeft=l}get orthoRight(){return this._orthoRight}set orthoRight(l){this._orthoRight=l}get orthoTop(){return this._orthoTop}set orthoTop(l){this._orthoTop=l}get orthoBottom(){return this._orthoBottom}set orthoBottom(l){this._orthoBottom=l}constructor(l,a,N){super(l,N),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=a.scale(-1),this.direction=a}getClassName(){return"oc"}getTypeID(){return w.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(l,a,N){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(l):this._setDefaultAutoExtendShadowProjectionMatrix(l,a,N)}_setDefaultFixedFrustumShadowProjectionMatrix(l){const a=this.bl().activeCamera;a&&K.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:a.Ac,void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,l,this.bl().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(l,a,N){const U=this.bl().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const l=K.ua.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let U=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let Z=0;Z<N.length;Z++){const w=N[Z];if(!w)continue;const S=w.getBoundingInfo().boundingBox;for(let N=0;N<S.vectorsWorld.length;N++)K.ua.TransformCoordinatesToRef(S.vectorsWorld[N],a,l),l.x<this._orthoLeft&&(this._orthoLeft=l.x),l.y<this._orthoBottom&&(this._orthoBottom=l.y),l.x>this._orthoRight&&(this._orthoRight=l.x),l.y>this._orthoTop&&(this._orthoTop=l.y),this.autoCalcShadowZBounds&&(l.z<U&&(U=l.z),l.z>c&&(c=l.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=U,this._shadowMaxZ=c)}const c=this._orthoRight-this._orthoLeft,Z=this._orthoTop-this._orthoBottom,w=void 0!==this.shadowMinZ?this.shadowMinZ:(null===U||void 0===U?void 0:U.Ac)||0,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===U||void 0===U?void 0:U.maxZ)||1e4,T=this.bl().getEngine().Zc;K.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-c*this.shadowOrthoScale,this._orthoRight+c*this.shadowOrthoScale,this._orthoBottom-Z*this.shadowOrthoScale,this._orthoTop+Z*this.shadowOrthoScale,T?S:w,T?w:S,l,this.bl().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(l,a){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,a),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,a),this)}transferToNodeMaterialEffect(l,a){return this.computeTransformedInformation()?(l.setFloat3(a,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(l.setFloat3(a,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(l){const a=this._scene.getEngine();return!a.Zc&&a.isNDCHalfZRange?0:1}getDepthMaxZ(l){const a=this._scene.getEngine();return a.Zc&&a.isNDCHalfZRange?0:1}prepareLightSpecificDefines(l,a){l["DIRLIGHT"+a]=!0}}(0,U.d)([(0,c.K)()],J.prototype,"shadowFrustumSize",null),(0,U.d)([(0,c.K)()],J.prototype,"shadowOrthoScale",null),(0,U.d)([(0,c.K)()],J.prototype,"autoUpdateExtends",void 0),(0,U.d)([(0,c.K)()],J.prototype,"autoCalcShadowZBounds",void 0),(0,U.d)([(0,c.K)("orthoLeft")],J.prototype,"_orthoLeft",void 0),(0,U.d)([(0,c.K)("orthoRight")],J.prototype,"_orthoRight",void 0),(0,U.d)([(0,c.K)("orthoTop")],J.prototype,"_orthoTop",void 0),(0,U.d)([(0,c.K)("orthoBottom")],J.prototype,"_orthoBottom",void 0),(0,T.g)("BABYLON.DirectionalLight",J)},14605:(l,a,N)=>{"use strict";N.d(a,{c:()=>J});var U=N(12429),c=N(12432),K=N(12447),Z=N(12479),w=N(12861),S=N(12966),T=N(12394);w.c.AddNodeConstructor("Light_Type_3",((l,a)=>()=>new J(l,K.ua.Zero(),a)));class J extends S.c{constructor(l,a,N){super(l,N),this.groundColor=new Z.Ca(0,0,0),this.direction=a||K.ua.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Gc"}setDirectionToTarget(l){return this.direction=K.ua.Normalize(l.Wa(K.ua.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(l,a){const N=K.ua.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",N.x,N.y,N.z,0,a),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Rc),a),this}transferToNodeMaterialEffect(l,a){const N=K.ua.Normalize(this.direction);return l.setFloat3(a,N.x,N.y,N.z),this}qc(){return this._worldMatrix||(this._worldMatrix=K.Matrix.Identity()),this._worldMatrix}getTypeID(){return S.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(l,a){l["HEMILIGHT"+a]=!0}}(0,U.d)([(0,c.m)()],J.prototype,"groundColor",void 0),(0,U.d)([(0,c.G)()],J.prototype,"direction",void 0),(0,T.g)("BABYLON.HemisphericLight",J)},14086:(l,a,N)=>{"use strict";N.d(a,{e:()=>n});var U=N(12429),c=N(12432),K=N(12447),Z=N(12861),w=N(12966),S=N(13016),T=N(12422),J=N(12394);Z.c.AddNodeConstructor("Light_Type_2",((l,a)=>()=>new n(l,K.ua.Zero(),K.ua.Zero(),0,0,a)));class n extends S.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(l){this._iesProfileTexture!==l&&(this._iesProfileTexture=l,this._iesProfileTexture&&n._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(l){this._angle=l,this._cosHalfAngle=Math.cos(.5*l),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(l){this._innerAngle=l,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(l){this._shadowAngleScale=l,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(l){this._projectionTextureLightNear=l,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(l){this._projectionTextureLightFar=l,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(l){this._projectionTextureUpDirection=l,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(l){this._projectionTexture!==l&&(this._projectionTexture=l,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(n._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):n._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(l){return void 0!==l.onGeneratedObservable}static _IsTexture(l){return void 0!==l.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(l){this._projectionTextureProjectionLightMatrix=l,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(l,a,N,U,c,Z){super(l,Z),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=K.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=K.ua.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=K.ua.Zero(),this._projectionTextureViewLightMatrix=K.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=K.Matrix.Zero(),this._projectionTextureScalingMatrix=K.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=a,this.direction=N,this.angle=U,this.exponent=c}getClassName(){return"SpotLight"}getTypeID(){return w.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(l){super._setDirection(l),this._projectionTextureViewLightDirty=!0}_setPosition(l){super._setPosition(l),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(l,a,N){const U=this.bl().activeCamera;if(!U)return;this._shadowAngleScale=this._shadowAngleScale||1;const c=this._shadowAngleScale*this._angle,Z=void 0!==this.shadowMinZ?this.shadowMinZ:U.Ac,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,S=this.bl().getEngine().Zc;K.Matrix.PerspectiveFovLHToRef(c,1,S?w:Z,S?Z:w,l,!0,this._scene.getEngine().isNDCHalfZRange,void 0,S)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),K.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const l=this.projectionTextureLightFar,a=this.projectionTextureLightNear,N=l/(l-a),U=-N*a,c=1/Math.tan(this._angle/2);K.Matrix.FromValuesToRef(c/1,0,0,0,0,c,0,0,0,0,N,1,0,0,U,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof T.e){const l=this._projectionTexture.uScale/2,a=this._projectionTexture.vScale/2;K.Matrix.FromValuesToRef(l,0,0,0,0,a,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(l,a){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),l.setMatrix("textureProjectionMatrix"+a,this._projectionTextureMatrix),l.setTexture("projectionLightTexture"+a,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&l.setTexture("iesLightTexture"+a,this._iesProfileTexture),this}transferToEffect(l,a){let N;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,a),N=K.ua.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,a),N=K.ua.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",N.x,N.y,N.z,this._cosHalfAngle,a),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,a),this}transferToNodeMaterialEffect(l,a){let N;return N=this.computeTransformedInformation()?K.ua.Normalize(this.transformedDirection):K.ua.Normalize(this.direction),this.bl().useRightHandedSystem?l.setFloat3(a,-N.x,-N.y,-N.z):l.setFloat3(a,N.x,N.y,N.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(l){const a=this._scene.getEngine(),N=void 0!==this.shadowMinZ?this.shadowMinZ:(null===l||void 0===l?void 0:l.Ac)??0;return a.Zc&&a.isNDCHalfZRange?N:this._scene.getEngine().isNDCHalfZRange?0:N}getDepthMaxZ(l){const a=this._scene.getEngine(),N=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===l||void 0===l?void 0:l.maxZ)??1e4;return a.Zc&&a.isNDCHalfZRange?0:N}prepareLightSpecificDefines(l,a){l["SPOTLIGHT"+a]=!0,l["PROJECTEDLIGHTTEXTURE"+a]=!(!this.projectionTexture||!this.projectionTexture.isReady()),l["IESLIGHTTEXTURE"+a]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,U.d)([(0,c.K)()],n.prototype,"angle",null),(0,U.d)([(0,c.K)()],n.prototype,"innerAngle",null),(0,U.d)([(0,c.K)()],n.prototype,"shadowAngleScale",null),(0,U.d)([(0,c.K)()],n.prototype,"exponent",void 0),(0,U.d)([(0,c.K)()],n.prototype,"projectionTextureLightNear",null),(0,U.d)([(0,c.K)()],n.prototype,"projectionTextureLightFar",null),(0,U.d)([(0,c.K)()],n.prototype,"projectionTextureUpDirection",null),(0,U.d)([(0,c.C)("projectedLightTexture")],n.prototype,"_projectionTexture",void 0),(0,J.g)("BABYLON.SpotLight",n)},13809:(l,a,N)=>{"use strict";N.d(a,{c:()=>Z,f:()=>K,i:()=>w});const U={},c={};function K(l,a){U[l]=a}function Z(l,a){c[l]=a}function w(l){return c[l]?c[l]:null}},13692:(l,a,N)=>{"use strict";N.d(a,{d:()=>b,g:()=>p});var U,c=N(12254),K=N(12260),Z=N(12678),w=N(12296),S=N(12268),T=N(12894),J=N(12298),n=N(12301),y=N(12403),H=N(12336),u=N(12292);!function(l){l[l.Clean=0]="Clean",l[l.Stop=1]="Stop",l[l.Sync=2]="Sync",l[l.NoSync=3]="NoSync"}(U||(U={}));const W=new K.e,B={};let Y=!1;function C(){return B[".babylon"]}function M(l,a){const N=B[l];return N||(S.b.Warn("Unable to find a plugin to load "+l+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),a?C():void 0)}function A(l,a,N){let U="Unable to load from "+(l.rawData?"binary data":l.url);return a?U+=`: ${a}`:N&&(U+=`: ${N}`),U}async function E(l,a,N,U,c,K,Z,w,S){var T;const n="data:"===(y=l.url).substring(0,5)?y.substring(5):null;var y;if(l.rawData&&!Z)throw"When using ArrayBufferView to load data the file extension must be provided.";const Y=n||Z?"":function(l){const a=l.indexOf("?");-1!==a&&(l=l.substring(0,a));const N=l.lastIndexOf(".");return l.substring(N,l.length).toLowerCase()}(l.url);let A=Z?M(Z,!0):n?function(l){for(const a in B){const N=B[a].plugin;if(N.canDirectLoad&&N.canDirectLoad(l))return B[a]}return C()}(l.url):M(Y,!1);if(!A&&Y){if(l.url&&!l.url.startsWith("blob:")){const a=await async function(l,a){const N=a.method||"GET";return await new Promise(((U,c)=>{const K=new u.c;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const l={};if(a.responseHeaders)for(const N of a.responseHeaders)l[N]=K.getResponseHeader(N)||"";U({response:K.response,headerValues:l})}else c(`Unable to fetch data from ${l}. Error code: ${K.status}`)})),K.open(N,l),K.send()}))}(l.url,{method:"HEAD",responseHeaders:["Content-Type"]}),N=a.headerValues?a.headerValues["Content-Type"]:"";N&&(A=function(l){for(const a in B){const N=B[a];if(N.mimeType===l)return N}}(N))}A||(A=C())}if(!A)throw new Error(`No plugin or fallback for ${Z??l.url}`);if(!1===(null===S||void 0===S||null===(T=S[A.plugin.name])||void 0===T?void 0:T.enabled))throw new Error(`The '${A.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(l.rawData&&!A.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(l=>{if(A.plugin.createPlugin){const a=A.plugin.createPlugin(S??{});return a instanceof Promise?(a.then(l).catch((l=>{c("Error instantiating plugin.",l)})),null):(l(a),a)}return l(A.plugin),A.plugin})((S=>{var T;if(!S)throw`The loader plugin corresponding to the '${Z}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(W.notifyObservers(S),n&&(S.canDirectLoad&&S.canDirectLoad(l.url)||!(0,J.m)(l.url))){if(S.directLoad){const l=S.directLoad(a,n);l instanceof Promise?l.then((l=>{N(S,l)})).catch((l=>{c("Error in directLoad of _loadData: "+l,l)})):N(S,l)}else N(S,n);return}const y=A.isBinary,u=(l,U)=>{a.T?c("Scene has been disposed"):N(S,l,U)};let B=null,Y=!1;null===(T=S.Tc)||void 0===T||T.add((()=>{Y=!0,B&&(B.abort(),B=null),K()}));const C=()=>{if(Y)return;const N=(l,a)=>{c(null===l||void 0===l?void 0:l.statusText,a)};if(!S.loadFile&&l.rawData)throw"Plugin does not support loading ArrayBufferView.";B=S.loadFile?S.loadFile(a,l.rawData||l.file||l.url,l.rootUrl,u,U,y,N,w):a._loadFile(l.file||l.url,u,U,!0,y,N)},M=a.getEngine();let E=M.enableOfflineSupport;if(E){let N=!1;for(const U of a.disableOfflineSupportExceptionRules)if(U.test(l.url)){N=!0;break}E=!N}E&&H.c.OfflineProviderFactory?a.offlineProvider=H.c.OfflineProviderFactory(l.url,C,M.disableManifestCheck):C()}))}function q(l,a){let N,U,K=null,Z=null;if(a)if(a.name)N=`file:${a.name}`,U=a.name,K=a;else if(ArrayBuffer.isView(a))N="",U=(0,y.b)(),Z=a;else if(a.startsWith("data:"))N=a,U="";else if(l){const K=a;if("/"===K.substring(0,1))return c.Tools.Error("Wrong sceneFilename parameter"),null;N=l+K,U=K}else N=a,U=c.Tools.GetFilename(a),l=c.Tools.GetFolderPath(a);else N=l,U=c.Tools.GetFilename(l),l=c.Tools.GetFolderPath(l);return{url:N,rootUrl:l,name:U,file:K,rawData:Z}}function b(l){if("string"===typeof l.extensions){const a=l.extensions;B[a.toLowerCase()]={plugin:l,isBinary:!1}}else{const a=l.extensions,N=Object.keys(a);for(const U of N)B[U.toLowerCase()]={plugin:l,isBinary:a[U].isBinary,mimeType:a[U].mimeType}}}async function z(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.e.LastCreatedScene,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!U)return S.b.Error("No scene available to import mesh to"),null;const H=q(a,N);if(!H)return null;const u={};U.addPendingData(u);const W=()=>{U.removePendingData(u)},B=(l,a)=>{const N=A(H,l,a);Z?Z(U,N,new n.f(N,n.e.SceneLoaderError,a)):S.b.Error(N),W()},Y=K?l=>{try{K(l)}catch(a){B("Error in onProgress callback: "+a,a)}}:void 0,C=(l,a,N,K,Z,w,S,T)=>{if(U.importedMeshesFiles.push(H.url),c)try{c(l,a,N,K,Z,w,S,T)}catch(J){B("Error in onSuccess callback: "+J,J)}U.removePendingData(u)};return await E(H,U,((a,N,c)=>{if(a.rewriteRootURL&&(H.rootUrl=a.rewriteRootURL(H.rootUrl,c)),a.importMesh){const c=[],K=[],Z=[];if(!a.importMesh(l,U,N,H.rootUrl,c,K,Z,B))return;U.loadingPluginName=a.name,C(c,K,Z,[],[],[],[],[])}else{a.importMeshAsync(l,U,N,H.rootUrl,Y,H.name).then((l=>{U.loadingPluginName=a.name,C(l.meshes,l.wy,l.skeletons,l.animationGroups,l.transformNodes,l.geometries,l.lights,l.spriteManagers)})).catch((l=>{B(l.message,l)}))}}),Y,B,W,T,J,y)}async function I(l,a,N,U,c,K,Z,w){return await new Promise(((S,T)=>{try{z(l,a,N,U,((l,a,N,U,c,K,Z,w)=>{S({meshes:l,wy:a,skeletons:N,animationGroups:U,transformNodes:c,geometries:K,lights:Z,spriteManagers:w})}),c,((l,a,N)=>{T(N||new Error(a))}),K,Z,w).catch(T)}catch(n){T(n)}}))}async function t(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedEngine,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};N?await h(l,a,new Z.d(N),U,K,S,T,J,n):c.Tools.Error("No engine available")}async function O(l,a,N,U,c,K,Z){return await new Promise(((w,S)=>{t(l,a,N,(l=>{w(l)}),U,((l,a,N)=>{S(N||new Error(a))}),c,K,Z)}))}async function h(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!N)return S.b.Error("No scene available to append to"),null;const H=q(l,a);if(!H)return null;const u={};N.addPendingData(u);const W=()=>{N.removePendingData(u)};T.d.ShowLoadingScreen&&!Y&&(Y=!0,N.getEngine().displayLoadingUI(),N.executeWhenReady((()=>{N.getEngine().hideLoadingUI(),Y=!1})));const B=(l,a)=>{const U=A(H,l,a);K?K(N,U,new n.f(U,n.e.SceneLoaderError,a)):S.b.Error(U),W()},C=c?l=>{try{c(l)}catch(a){B("Error in onProgress callback",a)}}:void 0,M=()=>{if(U)try{U(N)}catch(l){B("Error in onSuccess callback",l)}N.removePendingData(u)};return await E(H,N,((l,a)=>{if(l.load){if(!l.load(N,a,H.rootUrl,B))return;N.loadingPluginName=l.name,M()}else{l.loadAsync(N,a,H.rootUrl,C,H.name).then((()=>{N.loadingPluginName=l.name,M()})).catch((l=>{B(l.message,l)}))}}),C,B,W,Z,J,y)}async function i(l,a,N,U,c,K,Z){return await new Promise(((w,S)=>{try{h(l,a,N,(l=>{w(l)}),U,((l,a,N)=>{S(N||new Error(a))}),c,K,Z).catch(S)}catch(n){S(n)}}))}async function k(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!N)return S.b.Error("No scene available to load asset container to"),null;const y=q(l,a);if(!y)return null;const H={};N.addPendingData(H);const u=()=>{N.removePendingData(H)},W=(l,a)=>{const U=A(y,l,a);K?K(N,U,new n.f(U,n.e.SceneLoaderError,a)):S.b.Error(U),u()},B=c?l=>{try{c(l)}catch(a){W("Error in onProgress callback",a)}}:void 0,Y=l=>{if(U)try{U(l)}catch(a){W("Error in onSuccess callback",a)}N.removePendingData(H)};return await E(y,N,((l,a)=>{if(l.loadAssetContainer){const U=l.loadAssetContainer(N,a,y.rootUrl,W);if(!U)return;U.populateRootNodes(),N.loadingPluginName=l.name,Y(U)}else if(l.loadAssetContainerAsync){l.loadAssetContainerAsync(N,a,y.rootUrl,B,y.name).then((a=>{a.populateRootNodes(),N.loadingPluginName=l.name,Y(a)})).catch((l=>{W(l.message,l)}))}else W("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),B,W,u,Z,T,J)}async function Q(l,a,N,U,c,K,Z){return await new Promise(((w,S)=>{try{k(l,a,N,(l=>{w(l)}),U,((l,a,N)=>{S(N||new Error(a))}),c,K,Z).catch(S)}catch(n){S(n)}}))}async function j(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!N)return void S.b.Error("No scene available to load animations to");if(U){for(const U of N.animatables)U.reset();N.stopAllAnimations();const l=N.animationGroups.slice();for(const N of l)N.dispose();const a=N.getNodes();for(const N of a)N.animations&&(N.animations=[])}else switch(c){case 0:const l=N.animationGroups.slice();for(const a of l)a.dispose();break;case 1:for(const a of N.animationGroups)a.stop();break;case 2:for(const a of N.animationGroups)a.reset(),a.restart();break;case 3:break;default:return void S.b.Error("Unknown animation group loading mode value '"+c+"'")}const u=N.animatables.length;await k(l,a,N,(l=>{l.mergeAnimationsTo(N,N.animatables.slice(u),K),l.dispose(),N.onAnimationFileImportedObservable.notifyObservers(N),Z&&Z(N)}),T,J,n,y,H)}async function f(l,a,N,U,c,K,Z,w,S,T){return await new Promise(((J,y)=>{try{j(l,a,N,U,c,K,(l=>{J(l)}),Z,((l,a,N)=>{y(N||new Error(a))}),w,S,T).catch(y)}catch(n){y(n)}}))}class p{static get ForceFullSceneLoadingForIncremental(){return T.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(l){T.d.ForceFullSceneLoadingForIncremental=l}static get ShowLoadingScreen(){return T.d.ShowLoadingScreen}static set ShowLoadingScreen(l){T.d.ShowLoadingScreen=l}static get loggingLevel(){return T.d.loggingLevel}static set loggingLevel(l){T.d.loggingLevel=l}static get CleanBoneMatrixWeights(){return T.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(l){T.d.CleanBoneMatrixWeights=l}static GetDefaultPlugin(){return C()}static GetPluginForExtension(l){var a;return null===(a=M(l,!0))||void 0===a?void 0:a.plugin}static IsPluginForExtensionAvailable(l){return function(l){return!!B[l]}(l)}static RegisterPlugin(l){b(l)}static ImportMesh(l,a,N,U,c,K,Z,S,T){z(l,a,N,U,c,K,Z,S,T).catch((l=>null===Z||void 0===Z?void 0:Z(w.e.LastCreatedScene,null===l||void 0===l?void 0:l.message,l)))}static async ImportMeshAsync(l,a,N,U,c,K,Z){return await I(l,a,N,U,c,K,Z)}static Load(l,a,N,U,c,K,Z,S){t(l,a,N,U,c,K,Z,S).catch((l=>null===K||void 0===K?void 0:K(w.e.LastCreatedScene,null===l||void 0===l?void 0:l.message,l)))}static async LoadAsync(l,a,N,U,c,K){return await O(l,a,N,U,c,K)}static Append(l,a,N,U,c,K,Z,S){h(l,a,N,U,c,K,Z,S).catch((l=>null===K||void 0===K?void 0:K(N??w.e.LastCreatedScene,null===l||void 0===l?void 0:l.message,l)))}static async AppendAsync(l,a,N,U,c,K){return await i(l,a,N,U,c,K)}static LoadAssetContainer(l,a,N,U,c,K,Z,S){k(l,a,N,U,c,K,Z,S).catch((l=>null===K||void 0===K?void 0:K(N??w.e.LastCreatedScene,null===l||void 0===l?void 0:l.message,l)))}static async LoadAssetContainerAsync(l,a,N,U,c,K){return await Q(l,a,N,U,c,K)}static ImportAnimations(l,a,N,U,c,K,Z,S,T,J,n){j(l,a,N,U,c,K,Z,S,T,J,n).catch((l=>null===T||void 0===T?void 0:T(N??w.e.LastCreatedScene,null===l||void 0===l?void 0:l.message,l)))}static async ImportAnimationsAsync(l,a,N,U,c,K,Z,w,S,T,J){return await f(l,a,N,U,c,K,w,T,J)}}p.NO_LOGGING=0,p.MINIMAL_LOGGING=1,p.SUMMARY_LOGGING=2,p.DETAILED_LOGGING=3,p.OnPluginActivatedObservable=W},14102:(l,a,N)=>{"use strict";N.d(a,{c:()=>y});var U=N(12429),c=N(12432),K=N(12254),Z=N(12447),w=N(12467),S=N(12422),T=N(12394),J=N(12260),n=N(12471);N(14107);class y extends w.b{set boundingBoxSize(l){if(this._boundingBoxSize&&this._boundingBoxSize.equals(l))return;this._boundingBoxSize=l;const a=this.bl();a&&a.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(l){this._rotationY=l,this.setReflectionTextureMatrix(Z.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(l,a,N){let U="";for(const c of l)U+=c;return new y(U,a,null,N,l)}static CreateFromPrefilteredData(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const c=a.useDelayedTextureLoading;a.useDelayedTextureLoading=!1;const K=new y(l,a,null,!1,null,null,null,void 0,!0,N,U);return a.useDelayedTextureLoading=c,K}constructor(l,a){var N;let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,B=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,Y=arguments.length>13?arguments[13]:void 0,C=arguments.length>14?arguments[14]:void 0;super(a),this.onLoadObservable=new J.e,this.boundingBoxPosition=Z.ua.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Z.Matrix,this._buffer=null,this.name=l,this.url=l,this._noMipmap=c,this.Mc=!1,this.isCube=!0,this._textureMatrix=Z.Matrix.Identity(),this.coordinatesMode=S.e.CUBIC_MODE;let M=null,A=null;null===U||Array.isArray(U)?(this._noMipmap=c,this._format=n,this._createPolynomials=u,M=U,this._loaderOptions=Y,this._useSRGBBuffer=C,this._lodScale=W,this._lodOffset=B):(M=U.extensions??null,this._noMipmap=U.noMipmap??!1,K=U.files??null,A=U.buffer??null,this._format=U.format??5,y=U.prefiltered??!1,H=U.forcedExtension??null,this._createPolynomials=U.createPolynomials??!1,this._lodScale=U.lodScale??.8,this._lodOffset=U.lodOffset??0,this._loaderOptions=U.loaderOptions,this._useSRGBBuffer=U.useSRGBBuffer,w=U.V??null,T=U.onError??null),(l||K)&&this.updateURL(l,H,w,y,T,M,null===(N=this.bl())||void 0===N?void 0:N.useDelayedTextureLoading,K,A)}getClassName(){return"CubeTexture"}updateURL(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=l),this.url=l,a&&(this._forcedExtension=a);const T=l.lastIndexOf("."),J=a||(T>-1?l.substring(T).toLowerCase():""),n=0===J.indexOf(".dds"),y=0===J.indexOf(".env"),H=0===J.indexOf(".basis");if(y?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=U,U&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),w)this._files=w;else if(H||y||n||K||(K=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,K){for(let a=0;a<K.length;a++)this._files.push(l+K[a]);this._extensions=K}this._buffer=S,Z?(this.delayLoadState=4,this._delayedOnLoad=N,this._delayedOnError=c):this._loadTexture(N,c)}delayLoad(l){4===this.delayLoadState&&(l&&(this._forcedExtension=l),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(l){var a,N;if(l.updateFlag===this._textureMatrix.updateFlag)return;l.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(N=this.bl())||void 0===N||N.markAllMaterialsAsDirty(1,(l=>-1!==l.getActiveTextures().indexOf(this))));if(this._textureMatrix=l,null===(a=this.bl())||void 0===a||!a.useRightHandedSystem)return;const U=Z.TmpVectors.ua[0],c=Z.TmpVectors.Quaternion[0],K=Z.TmpVectors.ua[1];this._textureMatrix.decompose(U,c,K),c.z*=-1,c.w*=-1,Z.Matrix.ComposeToRef(U,c,K,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var l;return null!==(l=this.bl())&&void 0!==l&&l.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=this.bl(),U=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const c=()=>{var a;(this.onLoadObservable.notifyObservers(this),U)&&(U.dispose(),null===(a=this.bl())||void 0===a||a.markAllMaterialsAsDirty(1));l&&l()},Z=(l,N)=>{this._loadingError=!0,this._errorObject={message:l,exception:N},a&&a(l,N),S.e.OnTextureLoadErrorObservable.notifyObservers(this)};var w;this._texture?this._texture.isReady?K.Tools.SetImmediate((()=>c())):this._texture.onLoadedObservable.add((()=>c())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,N,this._lodScale,this._lodOffset,l,Z,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,N,this._files,this._noMipmap,l,Z,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(w=this._texture)||void 0===w||w.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(l,a,N){const U=n.c.Parse((()=>{let U=!1;return l.prefiltered&&(U=l.prefiltered),new y(N+(l.url??l.name),a,l.extensions,!1,l.files||null,null,null,void 0,U,l.forcedExtension)}),l,a);if(l.boundingBoxPosition&&(U.boundingBoxPosition=Z.ua.Ma(l.boundingBoxPosition)),l.boundingBoxSize&&(U.boundingBoxSize=Z.ua.Ma(l.boundingBoxSize)),l.animations)for(let c=0;c<l.animations.length;c++){const a=l.animations[c],N=(0,T.e)("BABYLON.Animation");N&&U.animations.push(N.Parse(a))}return U}clone(){let l=0;const a=n.c.Clone((()=>{const a=new y(this.url,this.bl()||this._getEngine(),this._extensions,this._noMipmap,this._files);return l=a.uniqueId,a}),this);return a.uniqueId=l,a}}(0,U.d)([(0,c.K)()],y.prototype,"url",void 0),(0,U.d)([(0,c.G)()],y.prototype,"boundingBoxPosition",void 0),(0,U.d)([(0,c.G)()],y.prototype,"boundingBoxSize",null),(0,U.d)([(0,c.K)("rotationY")],y.prototype,"rotationY",null),(0,U.d)([(0,c.K)("files")],y.prototype,"_files",void 0),(0,U.d)([(0,c.K)("forcedExtension")],y.prototype,"_forcedExtension",void 0),(0,U.d)([(0,c.K)("extensions")],y.prototype,"_extensions",void 0),(0,U.d)([(0,c.v)("textureMatrix")],y.prototype,"_textureMatrix",void 0),(0,U.d)([(0,c.v)("textureMatrixRefraction")],y.prototype,"_textureMatrixRefraction",void 0),S.e._CubeTextureParser=y.Parse,(0,T.g)("BABYLON.CubeTexture",y)},14613:(l,a,N)=>{"use strict";N.d(a,{e:()=>S});var U=N(12268),c=N(12422),K=N(12411),Z=N(12566),w=N(12373);Z.ThinEngine.prototype.createDynamicTexture=function(l,a,N,U){const c=new w.c(this,4);return c.baseWidth=l,c.baseHeight=a,N&&(l=this.needPOTTextures?(0,K.f)(l,this._caps.maxTextureSize):l,a=this.needPOTTextures?(0,K.f)(a,this._caps.maxTextureSize):a),c.width=l,c.height=a,c.isReady=!1,c.generateMipMaps=N,c.samplingMode=U,this.updateTextureSamplingMode(U,c),this._internalTexturesCache.push(c),c},Z.ThinEngine.prototype.updateDynamicTexture=function(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!l)return;const Z=this._gl,w=Z.TEXTURE_2D,S=this._bindTextureDirectly(w,l,!0,K);this._unpackFlipY(void 0===N?l.invertY:N),U&&Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const T=this._getWebGLTextureType(l.type),J=this._getInternalFormat(c||l.format),n=this._getRGBABufferInternalSizedFormat(l.type,J);Z.texImage2D(w,0,n,J,T,a),l.generateMipMaps&&Z.generateMipmap(w),S||this._bindTextureDirectly(w,null),U&&Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),c&&(l.format=c),l._dynamicTextureSource=a,l._premulAlpha=U,l.invertY=N||!1,l.isReady=!0};class S extends c.e{constructor(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,w=arguments.length>6?arguments[6]:void 0;const S=!N||N._isScene;super(null,S?N:null===N||void 0===N?void 0:N.Ba,S?!U:N,w,K,void 0,void 0,void 0,void 0,Z),this.name=l,this.wrapU=c.e.CLAMP_ADDRESSMODE,this.wrapV=c.e.CLAMP_ADDRESSMODE,this._generateMipMaps=U;const T=this._getEngine();if(!T)return;if(a.getContext)this._canvas=a,this._ownCanvas=!1,this._texture=T.createDynamicTexture(this._canvas.width,this._canvas.height,U,K);else{this._canvas=T.createCanvas(1,1),this._ownCanvas=!0;const l=a;l.width||0===l.width?this._texture=T.createDynamicTexture(l.width,l.height,U,K):this._texture=T.createDynamicTexture(a,a,U,K)}const J=this.getSize();this._canvas.width!==J.width&&(this._canvas.width=J.width),this._canvas.height!==J.height&&(this._canvas.height=J.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(l){this._canvas.width=l.width,this._canvas.height=l.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(l.width,l.height,this._generateMipMaps,this.samplingMode)}scale(l){const a=this.getSize();a.width*=l,a.height*=l,this._recreate(a)}scaleTo(l,a){const N=this.getSize();N.width=l,N.height=a,this._recreate(N)}getContext(){return this._context}clear(l){const a=this.getSize();l&&(this._context.fillStyle=l),this._context.clearRect(0,0,a.width,a.height)}update(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===l||l,a,this._format||void 0,void 0,N)}drawText(l,a,N,U,c,K,Z){let w=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const S=this.getSize();if(K&&(this._context.fillStyle=K,this._context.fillRect(0,0,S.width,S.height)),this._context.font=U,null===a||void 0===a){const N=this._context.measureText(l);a=(S.width-N.width)/2}if(null===N||void 0===N){const l=parseInt(U.replace(/\D/g,""));N=S.height/2+l/3.65}this._context.fillStyle=c||"",this._context.fillText(l,a,N),w&&this.update(Z)}dispose(){var l,a;(super.dispose(),this._ownCanvas)&&(null===(l=this._canvas)||void 0===l||null===(a=l.remove)||void 0===a||a.call(l));this._canvas=null,this._context=null}clone(){const l=this.bl();if(!l)return this;const a=this.getSize(),N=new S(this.name,a,l,this._generateMipMaps);return N.Mc=this.Mc,N.level=this.level,N.wrapU=this.wrapU,N.wrapV=this.wrapV,N}serialize(){const l=this.bl();l&&!l.isReady()&&U.b.Warn("The scene must be ready before serializing the dynamic texture");const a=super.serialize();return S._IsCanvasElement(this._canvas)&&(a.base64String=this._canvas.toDataURL()),a.invertY=this._invertY,a.samplingMode=this.samplingMode,a}static _IsCanvasElement(l){return void 0!==l.toDataURL}_rebuild(){this.update()}}},14012:(l,a,N)=>{"use strict";N.d(a,{e:()=>c});var U=N(12422);class c extends U.e{get depth(){return this._depth}constructor(l,a,N,c,K,Z){let w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:U.e.TRILINEAR_SAMPLINGMODE,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,n=arguments.length>10?arguments[10]:void 0;super(null,Z,!w,S),this.format=K,this._texture=Z.getEngine().createRawTexture2DArray(l,a,N,c,K,w,S,T,null,J,n),this._depth=c,this.is2DArray=!0}update(l){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,l,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(l,a,N,U,K){return new c(l,a,N,U,5,K,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13822:(l,a,N)=>{"use strict";N.d(a,{d:()=>w,g:()=>S,j:()=>K,k:()=>Z});var U=N(12461),c=N(12447);function K(l,a){return`{X: ${l.x.toFixed(a)} Y: ${l.y.toFixed(a)}}`}function Z(l,a){return`{X: ${l._x.toFixed(a)} Y: ${l._y.toFixed(a)} Z: ${l._z.toFixed(a)}}`}function w(l,a){return 2*Math.acos((0,U.Clamp)(c.Quaternion.Dot(l,a)))}function S(l,a){const N=new c.Quaternion;return function(l,a,N){const K=c.ua.Cross(l,a),Z=Math.acos((0,U.Clamp)(c.ua.Dot(l,a),-1,1));c.Quaternion.RotationAxisToRef(K,Z,N)}(l,a,N),N}},13645:(l,a,N)=>{"use strict";N.d(a,{b:()=>T});var U=N(12447),c=N(12479),K=N(12883),Z=N(12870),w=N(12491);N(13653);function S(l){let a=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const N=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],K=[];let S=[];const T=l.width||l.size||1,J=l.height||l.size||1,n=l.depth||l.size||1,y=l.wrap||!1;let H=void 0===l.topBaseAt?1:l.topBaseAt,u=void 0===l.bottomBaseAt?0:l.bottomBaseAt;H=(H+4)%4,u=(u+4)%4;let W=[2,0,3,1][H],B=[2,0,1,3][u],Y=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(y){a=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],Y=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let l=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],N=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const U=[17,18,19,16],c=[22,23,20,21];for(;W>0;)l.unshift(l.pop()),U.unshift(U.pop()),W--;for(;B>0;)N.unshift(N.pop()),c.unshift(c.pop()),B--;l=l.flat(),N=N.flat(),Y=Y.concat(l).concat(N),a.push(U[0],U[2],U[3],U[0],U[1],U[2]),a.push(c[0],c[2],c[3],c[0],c[1],c[2])}const C=[T/2,J/2,n/2];S=Y.reduce(((l,a,N)=>l.concat(a*C[N%3])),[]);const M=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE,A=l.faceUV||new Array(6),E=l.faceColors,q=[];for(let Z=0;Z<6;Z++)void 0===A[Z]&&(A[Z]=new U.Vector4(0,0,1,1)),E&&void 0===E[Z]&&(E[Z]=new c.Qc(1,1,1,1));for(let U=0;U<6;U++)if(K.push(A[U].z,w.b?1-A[U].w:A[U].w),K.push(A[U].x,w.b?1-A[U].w:A[U].w),K.push(A[U].x,w.b?1-A[U].y:A[U].y),K.push(A[U].z,w.b?1-A[U].y:A[U].y),E)for(let l=0;l<4;l++)q.push(E[U].r,E[U].g,E[U].b,E[U].a);Z.b._ComputeSides(M,S,a,N,K,l.frontUVs,l.backUVs);const b=new Z.b;if(b.indices=a,b.Il=S,b.tl=N,b.hl=K,E){const l=M===Z.b.DOUBLESIDE?q.concat(q):q;b.Ol=l}return b}function T(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new K.d(l,N);a.sideOrientation=K.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return S(a).kl(U,a.updatable),U}Z.b.CreateBox=S,K.d.CreateBox=function(l,a){return T(l,{size:a,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13814:(l,a,N)=>{"use strict";N.d(a,{b:()=>w});var U=N(12883),c=N(12870),K=N(12491);function Z(l){const a=[],N=[],U=[],Z=[],w=l.radius||.5,S=l.tessellation||64,T=l.arc&&(l.arc<=0||l.arc>1)?1:l.arc||1,J=0===l.sideOrientation?0:l.sideOrientation||c.b.DEFAULTSIDE;a.push(0,0,0),Z.push(.5,.5);const n=2*Math.PI*T,y=1===T?n/S:n/(S-1);let H=0;for(let c=0;c<S;c++){const l=Math.cos(H),N=Math.sin(H),U=(l+1)/2,c=(1-N)/2;a.push(w*l,w*N,0),Z.push(U,K.b?1-c:c),H+=y}1===T&&(a.push(a[3],a[4],a[5]),Z.push(Z[2],K.b?1-Z[3]:Z[3]));const u=a.length/3;for(let c=1;c<u-1;c++)N.push(c+1,0,c);c.b.ComputeNormals(a,N,U),c.b._ComputeSides(J,a,N,U,Z,l.frontUVs,l.backUVs);const W=new c.b;return W.indices=N,W.Il=a,W.tl=U,W.hl=Z,W}function w(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new U.d(l,N);a.sideOrientation=U.d._GetDefaultSideOrientation(a.sideOrientation),c._originalBuilderSideOrientation=a.sideOrientation;return Z(a).kl(c,a.updatable),c}c.b.CreateDisc=Z,U.d.CreateDisc=function(l,a,N){return w(l,{radius:a,tessellation:N,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13653:(l,a,N)=>{"use strict";N.d(a,{g:()=>B,e:()=>C,i:()=>Y});var U=N(12447),c=N(12479),K=N(12883),Z=N(12870),w=N(12506);K.d._GroundMeshParser=(l,a)=>S.Parse(l,a);class S extends K.d{constructor(l,a){super(l,a),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=l,this._subdivisionsY=l,this.subdivide(l);const N=this;N.createOrUpdateSubmeshesOctree&&N.createOrUpdateSubmeshesOctree(a)}getHeightAtCoordinates(l,a){const N=this.getWorldMatrix(),c=U.TmpVectors.Matrix[5];N.invertToRef(c);const K=U.TmpVectors.ua[8];if(U.ua.TransformCoordinatesFromFloatsToRef(l,0,a,c,K),l=K.x,a=K.z,l<this._minX||l>=this._maxX||a<=this._minZ||a>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Z=this._getFacetAt(l,a),w=-(Z.x*l+Z.z*a+Z.w)/Z.y;return U.ua.TransformCoordinatesFromFloatsToRef(0,w,0,N,K),K.y}getNormalAtCoordinates(l,a){const N=new U.ua(0,1,0);return this.getNormalAtCoordinatesToRef(l,a,N),N}getNormalAtCoordinatesToRef(l,a,N){const c=this.getWorldMatrix(),K=U.TmpVectors.Matrix[5];c.invertToRef(K);const Z=U.TmpVectors.ua[8];if(U.ua.TransformCoordinatesFromFloatsToRef(l,0,a,K,Z),l=Z.x,a=Z.z,l<this._minX||l>this._maxX||a<this._minZ||a>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const w=this._getFacetAt(l,a);return U.ua.TransformNormalFromFloatsToRef(w.x,w.y,w.z,c,N),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(l,a){const N=Math.floor((l+this._maxX)*this._subdivisionsX/this._width),U=Math.floor(-(a+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),c=this._heightQuads[U*this._subdivisionsX+N];let K;return K=a<c.slope.x*l+c.slope.y?c.facet1:c.facet2,K}_initHeightQuads(){const l=this._subdivisionsX,a=this._subdivisionsY;this._heightQuads=[];for(let N=0;N<a;N++)for(let a=0;a<l;a++){const c={slope:U.Vector2.Zero(),facet1:new U.Vector4(0,0,0,0),facet2:new U.Vector4(0,0,0,0)};this._heightQuads[N*l+a]=c}return this}_computeHeightQuads(){const l=this.getVerticesData(w.h.PositionKind);if(!l)return this;const a=U.TmpVectors.ua[3],N=U.TmpVectors.ua[2],c=U.TmpVectors.ua[1],K=U.TmpVectors.ua[0],Z=U.TmpVectors.ua[4],S=U.TmpVectors.ua[5],T=U.TmpVectors.ua[6],J=U.TmpVectors.ua[7],n=U.TmpVectors.ua[8];let y=0,H=0,u=0,W=0,B=0,Y=0,C=0;const M=this._subdivisionsX,A=this._subdivisionsY;for(let w=0;w<A;w++)for(let A=0;A<M;A++){y=3*A,H=w*(M+1)*3,u=(w+1)*(M+1)*3,a.x=l[H+y],a.y=l[H+y+1],a.z=l[H+y+2],N.x=l[H+y+3],N.y=l[H+y+4],N.z=l[H+y+5],c.x=l[u+y],c.y=l[u+y+1],c.z=l[u+y+2],K.x=l[u+y+3],K.y=l[u+y+4],K.z=l[u+y+5],W=(K.z-a.z)/(K.x-a.x),B=a.z-W*a.x,N.subtractToRef(a,Z),c.subtractToRef(a,S),K.subtractToRef(a,T),U.ua.CrossToRef(T,S,J),U.ua.CrossToRef(Z,T,n),J.normalize(),n.normalize(),Y=-(J.x*a.x+J.y*a.y+J.z*a.z),C=-(n.x*N.x+n.y*N.y+n.z*N.z);const E=this._heightQuads[w*M+A];E.slope.tc(W,B),E.facet1.tc(J.x,J.y,J.z,Y),E.facet2.tc(n.x,n.y,n.z,C)}return this}serialize(l){super.serialize(l),l.subdivisionsX=this._subdivisionsX,l.subdivisionsY=this._subdivisionsY,l.minX=this._minX,l.maxX=this._maxX,l.Ac=this._minZ,l.maxZ=this._maxZ,l.width=this._width,l.height=this._height}static Parse(l,a){const N=new S(l.name,a);return N._subdivisionsX=l.subdivisionsX||1,N._subdivisionsY=l.subdivisionsY||1,N._minX=l.minX,N._maxX=l.maxX,N._minZ=l.Ac,N._maxZ=l.maxZ,N._width=l.width,N._height=l.height,N}}var T=N(12254),J=N(12296),n=N(12452),y=N(12491);function H(l){const a=[],N=[],c=[],K=[];let w,S;const T=l.width||l.size||1,J=l.height||l.size||1,n=0|(l.subdivisionsX||l.subdivisions||1),H=0|(l.subdivisionsY||l.subdivisions||1);for(w=0;w<=H;w++)for(S=0;S<=n;S++){const l=new U.ua(S*T/n-T/2,0,(H-w)*J/H-J/2),a=new U.ua(0,1,0);N.push(l.x,l.y,l.z),c.push(a.x,a.y,a.z),K.push(S/n,y.b?w/H:1-w/H)}for(w=0;w<H;w++)for(S=0;S<n;S++)a.push(S+1+(w+1)*(n+1)),a.push(S+1+w*(n+1)),a.push(S+w*(n+1)),a.push(S+(w+1)*(n+1)),a.push(S+1+(w+1)*(n+1)),a.push(S+w*(n+1));const u=new Z.b;return u.indices=a,u.Il=N,u.tl=c,u.hl=K,u}function u(l){const a=void 0!==l.xmin&&null!==l.xmin?l.xmin:-1,N=void 0!==l.zmin&&null!==l.zmin?l.zmin:-1,c=void 0!==l.xmax&&null!==l.xmax?l.xmax:1,K=void 0!==l.zmax&&null!==l.zmax?l.zmax:1,w=l.subdivisions||{w:1,h:1},S=l.precision||{w:1,h:1},T=[],J=[],n=[],y=[];let H,u,W,B;w.h=w.h<1?1:w.h,w.w=w.w<1?1:w.w,S.w=S.w<1?1:S.w,S.h=S.h<1?1:S.h;const Y=(c-a)/w.w,C=(K-N)/w.h;function M(l,a,N,c){const K=J.length/3,Z=S.w+1;for(H=0;H<S.h;H++)for(u=0;u<S.w;u++){const l=[K+u+H*Z,K+(u+1)+H*Z,K+(u+1)+(H+1)*Z,K+u+(H+1)*Z];T.push(l[1]),T.push(l[2]),T.push(l[3]),T.push(l[0]),T.push(l[1]),T.push(l[3])}const w=U.ua.Zero(),W=new U.ua(0,1,0);for(H=0;H<=S.h;H++)for(w.z=H*(c-a)/S.h+a,u=0;u<=S.w;u++)w.x=u*(N-l)/S.w+l,w.y=0,J.push(w.x,w.y,w.z),n.push(W.x,W.y,W.z),y.push(u/S.w,H/S.h)}for(W=0;W<w.h;W++)for(B=0;B<w.w;B++)M(a+B*Y,N+W*C,a+(B+1)*Y,N+(W+1)*C);const A=new Z.b;return A.indices=T,A.Il=J,A.tl=n,A.hl=y,A}function W(l){const a=[],N=[],K=[],w=[];let S,T;const J=l.colorFilter||new c.Ca(.3,.59,.11),y=l.alphaFilter||0;let H=!1;if(l.minHeight>l.maxHeight){H=!0;const a=l.maxHeight;l.maxHeight=l.minHeight,l.minHeight=a}for(S=0;S<=l.subdivisions;S++)for(T=0;T<=l.subdivisions;T++){const a=new U.ua(T*l.width/l.subdivisions-l.width/2,0,(l.subdivisions-S)*l.height/l.subdivisions-l.height/2),c=4*(((a.x+l.width/2)/l.width*(l.bufferWidth-1)|0)+((1-(a.z+l.height/2)/l.height)*(l.bufferHeight-1)|0)*l.bufferWidth);let Z=l.buffer[c]/255,u=l.buffer[c+1]/255,W=l.buffer[c+2]/255;const B=l.buffer[c+3]/255;H&&(Z=1-Z,u=1-u,W=1-W);const Y=Z*J.r+u*J.g+W*J.b;a.y=B>=y?l.minHeight+(l.maxHeight-l.minHeight)*Y:l.minHeight-n.d,l.heightBuffer&&(l.heightBuffer[S*(l.subdivisions+1)+T]=a.y),N.push(a.x,a.y,a.z),K.push(0,0,0),w.push(T/l.subdivisions,1-S/l.subdivisions)}for(S=0;S<l.subdivisions;S++)for(T=0;T<l.subdivisions;T++){const U=T+1+(S+1)*(l.subdivisions+1),c=T+1+S*(l.subdivisions+1),K=T+S*(l.subdivisions+1),Z=T+(S+1)*(l.subdivisions+1),w=N[3*U+1]>=l.minHeight,J=N[3*c+1]>=l.minHeight,n=N[3*K+1]>=l.minHeight;w&&J&&n&&(a.push(U),a.push(c),a.push(K));N[3*Z+1]>=l.minHeight&&w&&n&&(a.push(Z),a.push(U),a.push(K))}Z.b.ComputeNormals(N,a,K);const u=new Z.b;return u.indices=a,u.Il=N,u.tl=K,u.hl=w,u}function B(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const N=new S(l,arguments.length>2?arguments[2]:void 0);N._setReady(!1),N._subdivisionsX=a.subdivisionsX||a.subdivisions||1,N._subdivisionsY=a.subdivisionsY||a.subdivisions||1,N._width=a.width||1,N._height=a.height||1,N._maxX=N._width/2,N._maxZ=N._height/2,N._minX=-N._maxX,N._minZ=-N._maxZ;return H(a).kl(N,a.updatable),N._setReady(!0),N}function Y(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new K.d(l,N);return u(a).kl(U,a.updatable),U}function C(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const K=N.width||10,Z=N.height||10,w=N.subdivisions||1,n=N.minHeight||0,y=N.maxHeight||1,H=N.colorFilter||new c.Ca(.3,.59,.11),u=N.alphaFilter||0,B=N.updatable,Y=N.onReady;U=U||J.e.LastCreatedScene;const C=new S(l,U);let M;C._subdivisionsX=w,C._subdivisionsY=w,C._width=K,C._height=Z,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ,C._setReady(!1),N.passHeightBufferInCallback&&(M=new Float32Array((w+1)*(w+1)));const A=(l,a,N)=>{W({width:K,height:Z,subdivisions:w,minHeight:n,maxHeight:y,colorFilter:H,buffer:l,bufferWidth:a,bufferHeight:N,alphaFilter:u,heightBuffer:M}).kl(C,B),Y&&Y(C,M),C._setReady(!0)};if("string"===typeof a){const l=l=>{var a;const N=l.width,c=l.height;if(U.T)return;const K=null===(a=U)||void 0===a?void 0:a.getEngine().resizeImageBitmap(l,N,c);A(K,N,c)};T.Tools.LoadImage(a,l,N.onError?N.onError:()=>{},U.offlineProvider)}else A(a.data,a.width,a.height);return C}Z.b.CreateGround=H,Z.b.CreateTiledGround=u,Z.b.CreateGroundFromHeightMap=W,K.d.CreateGround=(l,a,N,U,c,K)=>B(l,{width:a,height:N,subdivisions:U,updatable:K},c),K.d.CreateTiledGround=(l,a,N,U,c,K,Z,w,S)=>Y(l,{xmin:a,zmin:N,xmax:U,zmax:c,subdivisions:K,precision:Z,updatable:S},w),K.d.CreateGroundFromHeightMap=(l,a,N,U,c,K,Z,w,S,T,J)=>C(l,a,{width:N,height:U,subdivisions:c,minHeight:K,maxHeight:Z,updatable:S,onReady:T,alphaFilter:J},w)},14335:(l,a,N)=>{"use strict";N.d(a,{b:()=>H,e:()=>n,h:()=>y});var U=N(12447),c=N(12883),K=N(12870),Z=N(12968),w=N(12506),S=N(12268);function T(l){const a=[],N=[],U=l.lines,c=l.Ol,Z=[];let w=0;for(let K=0;K<U.length;K++){const l=U[K];for(let U=0;U<l.length;U++){const{x:S,y:T,z:J}=l[U];if(N.push(S,T,J),c){const l=c[K],{r:a,g:N,b:w,a:S}=l[U];Z.push(a,N,w,S)}U>0&&(a.push(w-1),a.push(w)),w++}}const S=new K.b;return S.indices=a,S.Il=N,c&&(S.Ol=Z),S}function J(l){const a=l.dashSize||3,N=l.gapSize||1,c=l.dashNb||200,Z=l.points,w=[],S=[],T=U.ua.Zero();let J=0,n=0,y=0,H=0,u=0,W=0,B=0;for(B=0;B<Z.length-1;B++)Z[B+1].subtractToRef(Z[B],T),J+=T.length();for(y=J/c,H=a*y/(a+N),B=0;B<Z.length-1;B++){Z[B+1].subtractToRef(Z[B],T),n=Math.floor(T.length()/y),T.normalize();for(let l=0;l<n;l++)u=y*l,w.push(Z[B].x+u*T.x,Z[B].y+u*T.y,Z[B].z+u*T.z),w.push(Z[B].x+(u+H)*T.x,Z[B].y+(u+H)*T.y,Z[B].z+(u+H)*T.z),S.push(W,W+1),W+=2}const Y=new K.b;return Y.Il=w,Y.indices=S,Y}function n(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=a.instance,c=a.lines,K=a.Ol;if(U){const l=U.getVerticesData(w.h.PositionKind);let a,N;K&&(a=U.getVerticesData(w.h.ColorKind));let Z=0,S=0;for(let U=0;U<c.length;U++){const w=c[U];for(let c=0;c<w.length;c++)l[Z]=w[c].x,l[Z+1]=w[c].y,l[Z+2]=w[c].z,K&&a&&(N=K[U],a[S]=N[c].r,a[S+1]=N[c].g,a[S+2]=N[c].b,a[S+3]=N[c].a,S+=4),Z+=3}return U.updateVerticesData(w.h.PositionKind,l,!1,!1),K&&a&&U.updateVerticesData(w.h.ColorKind,a,!1,!1),U.refreshBoundingInfo(),U}const S=!!K,J=new Z.e(l,N,null,void 0,void 0,S,a.useVertexAlpha,a.material);return T(a).kl(J,a.updatable),J}function y(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=a.Ol?[a.Ol]:null;return n(l,{lines:[a.points],updatable:a.updatable,instance:a.instance,Ol:U,useVertexAlpha:a.useVertexAlpha,material:a.material},N)}function H(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=a.points,w=a.instance,T=a.gapSize||1,n=a.dashSize||3;if(w){const l=l=>{const a=U.ua.Zero(),N=l.length/6;let c=0,Z=0,S=0,T=0,J=0,n=0,y=0,H=0;for(y=0;y<K.length-1;y++)K[y+1].subtractToRef(K[y],a),c+=a.length();S=c/N;const u=w._creationDataStorage.dashSize;for(T=u*S/(u+w._creationDataStorage.gapSize),y=0;y<K.length-1;y++)for(K[y+1].subtractToRef(K[y],a),Z=Math.floor(a.length()/S),a.normalize(),H=0;H<Z&&n<l.length;)J=S*H,l[n]=K[y].x+J*a.x,l[n+1]=K[y].y+J*a.y,l[n+2]=K[y].z+J*a.z,l[n+3]=K[y].x+(J+T)*a.x,l[n+4]=K[y].y+(J+T)*a.y,l[n+5]=K[y].z+(J+T)*a.z,n+=6,H++;for(;n<l.length;)l[n]=K[y].x,l[n+1]=K[y].y,l[n+2]=K[y].z,n+=3};return(a.dashNb||a.dashSize||a.gapSize||a.useVertexAlpha||a.material)&&S.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),w.updateMeshPositions(l,!1),w}const y=new Z.e(l,N,null,void 0,void 0,void 0,a.useVertexAlpha,a.material);return J(a).kl(y,a.updatable),y._creationDataStorage=new c.g,y._creationDataStorage.dashSize=n,y._creationDataStorage.gapSize=T,y}K.b.CreateLineSystem=T,K.b.CreateDashedLines=J,c.d.IT=function(l,a){return y(l,{points:a,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},c.d.CreateDashedLines=function(l,a,N,U,c){return H(l,{points:a,dashSize:N,gapSize:U,dashNb:c,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13699:(l,a,N)=>{"use strict";N.d(a,{d:()=>w,e:()=>S});var U=N(12883),c=N(12870),K=N(12491);function Z(l){const a=[],N=[],U=[],Z=[],w=void 0!==l.width?l.width:void 0!==l.size?l.size:1,S=void 0!==l.height?l.height:void 0!==l.size?l.size:1,T=0===l.sideOrientation?0:l.sideOrientation||c.b.DEFAULTSIDE,J=w/2,n=S/2;N.push(-J,-n,0),U.push(0,0,-1),Z.push(0,K.b?1:0),N.push(J,-n,0),U.push(0,0,-1),Z.push(1,K.b?1:0),N.push(J,n,0),U.push(0,0,-1),Z.push(1,K.b?0:1),N.push(-J,n,0),U.push(0,0,-1),Z.push(0,K.b?0:1),a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),c.b._ComputeSides(T,N,a,U,Z,l.frontUVs,l.backUVs);const y=new c.b;return y.indices=a,y.Il=N,y.tl=U,y.hl=Z,y}function w(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new U.d(l,N);a.sideOrientation=U.d._GetDefaultSideOrientation(a.sideOrientation),c._originalBuilderSideOrientation=a.sideOrientation;return Z(a).kl(c,a.updatable),a.sourcePlane&&(c.translate(a.sourcePlane.normal,-a.sourcePlane.d),c.setDirection(a.sourcePlane.normal.scale(-1))),c}const S={hT:w};c.b.hT=Z,U.d.hT=(l,a,N,U,c)=>w(l,{size:a,width:a,height:a,sideOrientation:c,updatable:U},N)},13807:(l,a,N)=>{"use strict";N.d(a,{b:()=>S});var U=N(12447),c=N(12883),K=N(12870),Z=N(12491);function w(l){const a=0|(l.segments||32),N=l.diameterX||l.diameter||1,c=l.diameterY||l.diameter||1,w=l.diameterZ||l.diameter||1,S=l.arc&&(l.arc<=0||l.arc>1)?1:l.arc||1,T=l.slice&&l.slice<=0?1:l.slice||1,J=0===l.sideOrientation?0:l.sideOrientation||K.b.DEFAULTSIDE,n=!!l.dedupTopBottomIndices,y=new U.ua(N/2,c/2,w/2),H=2+a,u=2*H,W=[],B=[],Y=[],C=[];for(let K=0;K<=H;K++){const l=K/H,a=l*Math.PI*T;for(let N=0;N<=u;N++){const c=N/u,K=c*Math.PI*2*S,w=U.Matrix.RotationZ(-a),T=U.Matrix.RotationY(K),J=U.ua.TransformCoordinates(U.ua.Up(),w),n=U.ua.TransformCoordinates(J,T),H=n.multiply(y),W=n.divide(y).normalize();B.push(H.x,H.y,H.z),Y.push(W.x,W.y,W.z),C.push(c,Z.b?1-l:l)}if(K>0){const l=B.length/3;for(let a=l-2*(u+1);a+u+2<l;a++)n?(K>1&&(W.push(a),W.push(a+1),W.push(a+u+1)),(K<H||T<1)&&(W.push(a+u+1),W.push(a+1),W.push(a+u+2))):(W.push(a),W.push(a+1),W.push(a+u+1),W.push(a+u+1),W.push(a+1),W.push(a+u+2))}}K.b._ComputeSides(J,B,W,Y,C,l.frontUVs,l.backUVs);const M=new K.b;return M.indices=W,M.Il=B,M.tl=Y,M.hl=C,M}function S(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new c.d(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return w(a).kl(U,a.updatable),U}K.b.CreateSphere=w,c.d.CreateSphere=(l,a,N,U,c,K)=>S(l,{segments:a,diameterX:N,diameterY:N,diameterZ:N,sideOrientation:K,updatable:c},U)},14619:(l,a,N)=>{"use strict";N.d(a,{c:()=>w});var U=N(12986),c=N(14112),K=N(13009),Z=N(12870);class w{static get Configuration(){return{get decoder(){return c.e.DefaultConfiguration},set decoder(l){c.e.DefaultConfiguration=l}}}static set Configuration(l){c.e.DefaultConfiguration=l.decoder}static get DecoderAvailable(){return(0,U.f)(c.e.DefaultConfiguration)}static get Default(){return w._Default??(w._Default=new w),w._Default}static ResetDefault(l){w._Default&&(l||w._Default.dispose(),w._Default=null)}constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.DefaultNumWorkers;const a="number"===typeof l?{...c.e.DefaultConfiguration,numWorkers:l}:{...c.e.DefaultConfiguration,...l};this._decoder=new c.e(a)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(l,a,N){return this._decoder.decodeMeshToMeshDataAsync(l,a,N)}async decodeMeshToGeometryAsync(l,a,N,U){return await this._decoder.decodeMeshToGeometryAsync(l,a,N,U)}async _decodeMeshToGeometryForGltfAsync(l,a,N,U,c,K){return await this._decoder._decodeMeshToGeometryForGltfAsync(l,a,N,U,c,K)}async decodeMeshAsync(l,a){const N=await this._decoder.decodeMeshToMeshDataAsync(l,a),U=new Z.b;N.indices&&(U.indices=N.indices);for(const c of N.attributes){const l=K.e.GetFloatData(c.data,c.size,K.e.GetDataType(c.data),c.byteOffset,c.byteStride,c.normalized,N.totalVertices);U.set(l,c.kind)}return U}}w.DefaultNumWorkers=(0,U.d)(),w._Default=null},14112:(l,a,N)=>{"use strict";N.d(a,{e:()=>T});var U=N(12986),c=N(12254),K=N(12892),Z=N(13009),w=N(12268),S=N(13004);class T extends U.b{static get DefaultAvailable(){return(0,U.f)(T.DefaultConfiguration)}static get Default(){return T._Default??(T._Default=new T),T._Default}static ResetDefault(l){T._Default&&(l||T._Default.dispose(),T._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(l,a){return{module:await(a||DracoDecoderModule)({wasmBinary:l})}}_getWorkerContent(){return`${S.d}(${S.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.DefaultConfiguration)}decodeMeshToMeshDataAsync(l,a,N){const U=l instanceof ArrayBuffer?new Int8Array(l):new Int8Array(l.buffer,l.byteOffset,l.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async l=>await new Promise(((c,K)=>{l.push(((l,Z)=>{let S=null;const T=[],J=a=>{l.removeEventListener("error",J),l.removeEventListener("message",n),K(a),Z()},n=a=>{const U=a.data;switch(U.id){case"indices":S=U.data;break;case"attribute":T.push({kind:U.kind,data:U.data,size:U.size,byteOffset:U.byteOffset,byteStride:U.byteStride,normalized:(K=U.kind,y=U.normalized,N&&void 0!==N[K]?(y!==N[K]&&w.b.Warn(`Normalized flag from Draco data (${y}) does not match normalized flag from glTF accessor (${N[K]}). Using flag from glTF accessor.`),N[K]):y)});break;case"decodeMeshDone":l.removeEventListener("error",J),l.removeEventListener("message",n),c({indices:S,attributes:T,totalVertices:U.totalVertices}),Z()}var K,y};l.addEventListener("error",J),l.addEventListener("message",n);const y=U.slice();l.postMessage({id:"decodeMesh",dataView:y,attributes:a},[y.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((l=>{let N=null;const c=[],K=(0,S.d)(l.module,U,a,(l=>{N=l}),((l,a,N,U,K,Z)=>{c.push({kind:l,data:a,size:N,byteOffset:U,byteStride:K,normalized:Z})}));return{indices:N,attributes:c,totalVertices:K}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(l,a,N,U){const c=await this.decodeMeshToMeshDataAsync(N,U),w=new K.d(l,a);c.indices&&w.setIndices(c.indices);for(const K of c.attributes)w.setVerticesBuffer(new Z.e(a.getEngine(),K.data,K.kind,!1,void 0,K.byteStride,void 0,K.byteOffset,K.size,void 0,K.normalized,!0),c.totalVertices);return w}async _decodeMeshToGeometryForGltfAsync(l,a,N,U,c,w){const S=await this.decodeMeshToMeshDataAsync(N,U,c),T=new K.d(l,a);w&&(T._boundingInfo=w,T.useBoundingInfoFromGeometry=!0),S.indices&&T.setIndices(S.indices);for(const K of S.attributes)T.setVerticesBuffer(new Z.e(a.getEngine(),K.data,K.kind,!1,void 0,K.byteStride,void 0,K.byteOffset,K.size,void 0,K.normalized,!0),S.totalVertices);return T}}T.DefaultConfiguration={wasmUrl:`${c.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${c.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${c.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},T._Default=null},14327:(l,a,N)=>{"use strict";N.d(a,{d:()=>wl});var U=N(12447),c=N(12883),K=N(12506),Z=N(12870),w=N(12491);function S(l){let a=l.pathArray;const N=l.closeArray||!1,U=l.closePath||!1,c=l.invertUV||!1,S=Math.floor(a[0].length/2);let T=l.offset||S;T=T>S?S:Math.floor(T);const J=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE,n=l.hl,y=l.Ol,H=[],u=[],W=[],B=[],Y=[],C=[],M=[],A=[];let E;const q=[],b=[];let z,I,t;if(a.length<2){const l=[],N=[];for(I=0;I<a[0].length-T;I++)l.push(a[0][I]),N.push(a[0][I+T]);a=[l,N]}let O=0;const h=U?1:0,i=N?1:0;let k,Q,j,f,p,R;for(E=a[0].length,z=0;z<a.length+i;z++){for(M[z]=0,Y[z]=[0],k=z===a.length?a[0]:a[z],Q=k.length,E=E<Q?E:Q,t=0;t<Q;)H.push(k[t].x,k[t].y,k[t].z),t>0&&(j=k[t].Wa(k[t-1]).length(),f=j+M[z],Y[z].push(f),M[z]=f),t++;U&&(t--,H.push(k[0].x,k[0].y,k[0].z),j=k[t].Wa(k[0]).length(),f=j+M[z],Y[z].push(f),M[z]=f),q[z]=Q+h,b[z]=O,O+=Q+h}let L,r,X=null,P=null;for(I=0;I<E+h;I++)for(A[I]=0,C[I]=[0],z=0;z<a.length-1+i;z++)p=a[z],R=z===a.length-1?a[0]:a[z+1],I===E?(X=p[0],P=R[0]):(X=p[I],P=R[I]),j=P.Wa(X).length(),f=j+A[I],C[I].push(f),A[I]=f;if(n)for(z=0;z<n.length;z++)B.push(n[z].x,w.b?1-n[z].y:n[z].y);else for(z=0;z<a.length+i;z++)for(I=0;I<E+h;I++)L=0!=M[z]?Y[z][I]/M[z]:0,r=0!=A[I]?C[I][z]/A[I]:0,c?B.push(r,L):B.push(L,w.b?1-r:r);z=0;let d=0,F=q[z]-1,e=q[z+1]-1,s=F<e?F:e,o=b[1]-b[0];const G=q.length-1;for(;d<=s&&z<G;)u.push(d,d+o,d+1),u.push(d+o+1,d+1,d+o),d+=1,d===s&&(z++,o=b[z+1]-b[z],F=q[z]-1,e=q[z+1]-1,d=b[z],s=F<e?F+d:e+d);if(Z.b.ComputeNormals(H,u,W),U){let l=0,N=0;for(z=0;z<a.length;z++){l=3*b[z],N=z+1<a.length?3*(b[z+1]-1):W.length-3,W[l]=.5*(W[l]+W[N]),W[l+1]=.5*(W[l+1]+W[N+1]),W[l+2]=.5*(W[l+2]+W[N+2]);const U=Math.sqrt(W[l]*W[l]+W[l+1]*W[l+1]+W[l+2]*W[l+2]);W[l]/=U,W[l+1]/=U,W[l+2]/=U,W[N]=W[l],W[N+1]=W[l+1],W[N+2]=W[l+2]}}if(N){let l=3*b[0],N=3*b[a.length];for(I=0;I<E+h;I++){W[l]=.5*(W[l]+W[N]),W[l+1]=.5*(W[l+1]+W[N+1]),W[l+2]=.5*(W[l+2]+W[N+2]);const a=Math.sqrt(W[l]*W[l]+W[l+1]*W[l+1]+W[l+2]*W[l+2]);W[l]/=a,W[l+1]/=a,W[l+2]/=a,W[N]=W[l],W[N+1]=W[l+1],W[N+2]=W[l+2],l+=3,N+=3}}Z.b._ComputeSides(J,H,u,W,B,l.frontUVs,l.backUVs);let ml=null;if(y){ml=new Float32Array(4*y.length);for(let l=0;l<y.length;l++)ml[4*l]=y[l].r,ml[4*l+1]=y[l].g,ml[4*l+2]=y[l].b,ml[4*l+3]=y[l].a}const x=new Z.b,V=new Float32Array(H),D=new Float32Array(W),v=new Float32Array(B);return x.indices=u,x.Il=V,x.tl=D,x.hl=v,ml&&x.set(ml,K.h.ColorKind),U&&(x._idx=b),x}function T(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=a.pathArray,J=a.closeArray,n=a.closePath,y=c.d._GetDefaultSideOrientation(a.sideOrientation),H=a.instance,u=a.updatable;if(H){const l=U.TmpVectors.ua[0].hc(Number.MAX_VALUE),N=U.TmpVectors.ua[1].hc(-Number.MAX_VALUE),S=a=>{let U=T[0].length;const K=H;let Z=0;const w=K._originalBuilderSideOrientation===c.d.DOUBLESIDE?2:1;for(let c=1;c<=w;++c)for(let w=0;w<T.length;++w){const c=T[w],S=c.length;U=U<S?U:S;for(let K=0;K<U;++K){const U=c[K];a[Z]=U.x,a[Z+1]=U.y,a[Z+2]=U.z,l.minimizeInPlaceFromFloats(U.x,U.y,U.z),N.maximizeInPlaceFromFloats(U.x,U.y,U.z),Z+=3}if(K._creationDataStorage&&K._creationDataStorage.closePath){const l=c[0];a[Z]=l.x,a[Z+1]=l.y,a[Z+2]=l.z,Z+=3}}},J=H.getVerticesData(K.h.PositionKind);if(S(J),H.hasBoundingInfo?H.getBoundingInfo().reConstruct(l,N,H._worldMatrix):H.buildBoundingInfo(l,N,H._worldMatrix),H.updateVerticesData(K.h.PositionKind,J,!1,!1),a.Ol){const l=H.getVerticesData(K.h.ColorKind);for(let N=0,U=0;N<a.Ol.length;N++,U+=4){const c=a.Ol[N];l[U]=c.r,l[U+1]=c.g,l[U+2]=c.b,l[U+3]=c.a}H.updateVerticesData(K.h.ColorKind,l,!1,!1)}if(a.hl){const l=H.getVerticesData(K.h.UVKind);for(let N=0;N<a.hl.length;N++)l[2*N]=a.hl[N].x,l[2*N+1]=w.b?1-a.hl[N].y:a.hl[N].y;H.updateVerticesData(K.h.UVKind,l,!1,!1)}if(!H.areNormalsFrozen||H.isFacetDataEnabled){const l=H.zc(),a=H.getVerticesData(K.h.NormalKind),N=H.isFacetDataEnabled?H.getFacetDataParameters():null;if(Z.b.ComputeNormals(J,l,a,N),H._creationDataStorage&&H._creationDataStorage.closePath){let l=0,N=0;for(let U=0;U<T.length;U++)l=3*H._creationDataStorage.idx[U],N=U+1<T.length?3*(H._creationDataStorage.idx[U+1]-1):a.length-3,a[l]=.5*(a[l]+a[N]),a[l+1]=.5*(a[l+1]+a[N+1]),a[l+2]=.5*(a[l+2]+a[N+2]),a[N]=a[l],a[N+1]=a[l+1],a[N+2]=a[l+2]}H.areNormalsFrozen||H.updateVerticesData(K.h.NormalKind,a,!1,!1)}return H}{const U=new c.d(l,N);U._originalBuilderSideOrientation=y,U._creationDataStorage=new c.g;const K=S(a);return n&&(U._creationDataStorage.idx=K._idx),U._creationDataStorage.closePath=n,U._creationDataStorage.closeArray=J,K.kl(U,u),U}}Z.b.CreateRibbon=S,c.d.CreateRibbon=function(l,a){return T(l,{pathArray:a,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var J=N(13814),n=N(13645),y=N(12479);function H(l){const a=l.pattern||c.d.NO_FLIP,N=l.tileWidth||l.tileSize||1,U=l.tileHeight||l.tileSize||1,K=l.alignHorizontal||0,w=l.alignVertical||0,S=l.width||l.size||1,T=Math.floor(S/N);let J=S-T*N;const n=l.height||l.size||1,y=Math.floor(n/U);let H=n-y*U;const u=N*T/2,W=U*y/2;let B=0,Y=0,C=0,M=0,A=0,E=0;if(J>0||H>0){switch(C=-u,M=-W,A=u,E=W,K){case c.d.CENTER:J/=2,C-=J,A+=J;break;case c.d.LEFT:A+=J,B=-J/2;break;case c.d.RIGHT:C-=J,B=J/2}switch(w){case c.d.CENTER:H/=2,M-=H,E+=H;break;case c.d.BOTTOM:E+=H,Y=-H/2;break;case c.d.TOP:M-=H,Y=H/2}}const q=[],b=[],z=[];z[0]=[0,0,1,0,1,1,0,1],z[1]=[0,0,1,0,1,1,0,1],a!==c.d.ROTATE_TILE&&a!==c.d.ROTATE_ROW||(z[1]=[1,1,0,1,0,0,1,0]),a!==c.d.FLIP_TILE&&a!==c.d.FLIP_ROW||(z[1]=[1,0,0,0,0,1,1,1]),a!==c.d.FLIP_N_ROTATE_TILE&&a!==c.d.FLIP_N_ROTATE_ROW||(z[1]=[0,1,1,1,1,0,0,0]);let I=[];const t=[],O=[];let h=0;for(let Z=0;Z<y;Z++)for(let l=0;l<T;l++)q.push(l*N-u+B,Z*U-W+Y,0),q.push((l+1)*N-u+B,Z*U-W+Y,0),q.push((l+1)*N-u+B,(Z+1)*U-W+Y,0),q.push(l*N-u+B,(Z+1)*U-W+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),I=a===c.d.FLIP_TILE||a===c.d.ROTATE_TILE||a===c.d.FLIP_N_ROTATE_TILE?I.concat(z[(l%2+Z%2)%2]):a===c.d.FLIP_ROW||a===c.d.ROTATE_ROW||a===c.d.FLIP_N_ROTATE_ROW?I.concat(z[Z%2]):I.concat(z[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),h+=4;if(J>0||H>0){const l=H>0&&(w===c.d.CENTER||w===c.d.TOP),Z=H>0&&(w===c.d.CENTER||w===c.d.BOTTOM),S=J>0&&(K===c.d.CENTER||K===c.d.RIGHT),n=J>0&&(K===c.d.CENTER||K===c.d.LEFT);let z,i,k,Q,j=[];if(l&&S&&(q.push(C+B,M+Y,0),q.push(-u+B,M+Y,0),q.push(-u+B,M+H+Y,0),q.push(C+B,M+H+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,z=1-J/N,i=1-H/U,k=1,Q=1,j=[z,i,k,i,k,Q,z,Q],a===c.d.ROTATE_ROW&&(j=[1-z,1-i,1-k,1-i,1-k,1-Q,1-z,1-Q]),a===c.d.FLIP_ROW&&(j=[1-z,i,1-k,i,1-k,Q,1-z,Q]),a===c.d.FLIP_N_ROTATE_ROW&&(j=[z,1-i,k,1-i,k,1-Q,z,1-Q]),I=I.concat(j),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),l&&n&&(q.push(u+B,M+Y,0),q.push(A+B,M+Y,0),q.push(A+B,M+H+Y,0),q.push(u+B,M+H+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,z=0,i=1-H/U,k=J/N,Q=1,j=[z,i,k,i,k,Q,z,Q],(a===c.d.ROTATE_ROW||a===c.d.ROTATE_TILE&&T%2===0)&&(j=[1-z,1-i,1-k,1-i,1-k,1-Q,1-z,1-Q]),(a===c.d.FLIP_ROW||a===c.d.FLIP_TILE&&T%2===0)&&(j=[1-z,i,1-k,i,1-k,Q,1-z,Q]),(a===c.d.FLIP_N_ROTATE_ROW||a===c.d.FLIP_N_ROTATE_TILE&&T%2===0)&&(j=[z,1-i,k,1-i,k,1-Q,z,1-Q]),I=I.concat(j),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&S&&(q.push(C+B,W+Y,0),q.push(-u+B,W+Y,0),q.push(-u+B,E+Y,0),q.push(C+B,E+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,z=1-J/N,i=0,k=1,Q=H/U,j=[z,i,k,i,k,Q,z,Q],(a===c.d.ROTATE_ROW&&y%2===1||a===c.d.ROTATE_TILE&&y%1===0)&&(j=[1-z,1-i,1-k,1-i,1-k,1-Q,1-z,1-Q]),(a===c.d.FLIP_ROW&&y%2===1||a===c.d.FLIP_TILE&&y%2===0)&&(j=[1-z,i,1-k,i,1-k,Q,1-z,Q]),(a===c.d.FLIP_N_ROTATE_ROW&&y%2===1||a===c.d.FLIP_N_ROTATE_TILE&&y%2===0)&&(j=[z,1-i,k,1-i,k,1-Q,z,1-Q]),I=I.concat(j),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&n&&(q.push(u+B,W+Y,0),q.push(A+B,W+Y,0),q.push(A+B,E+Y,0),q.push(u+B,E+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,z=0,i=0,k=J/N,Q=H/U,j=[z,i,k,i,k,Q,z,Q],(a===c.d.ROTATE_ROW&&y%2===1||a===c.d.ROTATE_TILE&&(y+T)%2===1)&&(j=[1-z,1-i,1-k,1-i,1-k,1-Q,1-z,1-Q]),(a===c.d.FLIP_ROW&&y%2===1||a===c.d.FLIP_TILE&&(y+T)%2===1)&&(j=[1-z,i,1-k,i,1-k,Q,1-z,Q]),(a===c.d.FLIP_N_ROTATE_ROW&&y%2===1||a===c.d.FLIP_N_ROTATE_TILE&&(y+T)%2===1)&&(j=[z,1-i,k,1-i,k,1-Q,z,1-Q]),I=I.concat(j),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),l){const l=[];z=0,i=1-H/U,k=1,Q=1,l[0]=[z,i,k,i,k,Q,z,Q],l[1]=[z,i,k,i,k,Q,z,Q],a!==c.d.ROTATE_TILE&&a!==c.d.ROTATE_ROW||(l[1]=[1-z,1-i,1-k,1-i,1-k,1-Q,1-z,1-Q]),a!==c.d.FLIP_TILE&&a!==c.d.FLIP_ROW||(l[1]=[1-z,i,1-k,i,1-k,Q,1-z,Q]),a!==c.d.FLIP_N_ROTATE_TILE&&a!==c.d.FLIP_N_ROTATE_ROW||(l[1]=[z,1-i,k,1-i,k,1-Q,z,1-Q]);for(let U=0;U<T;U++)q.push(U*N-u+B,M+Y,0),q.push((U+1)*N-u+B,M+Y,0),q.push((U+1)*N-u+B,M+H+Y,0),q.push(U*N-u+B,M+H+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,I=a===c.d.FLIP_TILE||a===c.d.ROTATE_TILE||a===c.d.FLIP_N_ROTATE_TILE?I.concat(l[(U+1)%2]):a===c.d.FLIP_ROW||a===c.d.ROTATE_ROW||a===c.d.FLIP_N_ROTATE_ROW?I.concat(l[1]):I.concat(l[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Z){const l=[];z=0,i=0,k=1,Q=H/U,l[0]=[z,i,k,i,k,Q,z,Q],l[1]=[z,i,k,i,k,Q,z,Q],a!==c.d.ROTATE_TILE&&a!==c.d.ROTATE_ROW||(l[1]=[1-z,1-i,1-k,1-i,1-k,1-Q,1-z,1-Q]),a!==c.d.FLIP_TILE&&a!==c.d.FLIP_ROW||(l[1]=[1-z,i,1-k,i,1-k,Q,1-z,Q]),a!==c.d.FLIP_N_ROTATE_TILE&&a!==c.d.FLIP_N_ROTATE_ROW||(l[1]=[z,1-i,k,1-i,k,1-Q,z,1-Q]);for(let U=0;U<T;U++)q.push(U*N-u+B,E-H+Y,0),q.push((U+1)*N-u+B,E-H+Y,0),q.push((U+1)*N-u+B,E+Y,0),q.push(U*N-u+B,E+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,I=a===c.d.FLIP_TILE||a===c.d.ROTATE_TILE||a===c.d.FLIP_N_ROTATE_TILE?I.concat(l[(U+y)%2]):a===c.d.FLIP_ROW||a===c.d.ROTATE_ROW||a===c.d.FLIP_N_ROTATE_ROW?I.concat(l[y%2]):I.concat(l[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){const l=[];z=1-J/N,i=0,k=1,Q=1,l[0]=[z,i,k,i,k,Q,z,Q],l[1]=[z,i,k,i,k,Q,z,Q],a!==c.d.ROTATE_TILE&&a!==c.d.ROTATE_ROW||(l[1]=[1-z,1-i,1-k,1-i,1-k,1-Q,1-z,1-Q]),a!==c.d.FLIP_TILE&&a!==c.d.FLIP_ROW||(l[1]=[1-z,i,1-k,i,1-k,Q,1-z,Q]),a!==c.d.FLIP_N_ROTATE_TILE&&a!==c.d.FLIP_N_ROTATE_ROW||(l[1]=[z,1-i,k,1-i,k,1-Q,z,1-Q]);for(let N=0;N<y;N++)q.push(C+B,N*U-W+Y,0),q.push(C+J+B,N*U-W+Y,0),q.push(C+J+B,(N+1)*U-W+Y,0),q.push(C+B,(N+1)*U-W+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,I=a===c.d.FLIP_TILE||a===c.d.ROTATE_TILE||a===c.d.FLIP_N_ROTATE_TILE?I.concat(l[(N+1)%2]):a===c.d.FLIP_ROW||a===c.d.ROTATE_ROW||a===c.d.FLIP_N_ROTATE_ROW?I.concat(l[N%2]):I.concat(l[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(n){const l=[];z=0,i=0,k=J/U,Q=1,l[0]=[z,i,k,i,k,Q,z,Q],l[1]=[z,i,k,i,k,Q,z,Q],a!==c.d.ROTATE_TILE&&a!==c.d.ROTATE_ROW||(l[1]=[1-z,1-i,1-k,1-i,1-k,1-Q,1-z,1-Q]),a!==c.d.FLIP_TILE&&a!==c.d.FLIP_ROW||(l[1]=[1-z,i,1-k,i,1-k,Q,1-z,Q]),a!==c.d.FLIP_N_ROTATE_TILE&&a!==c.d.FLIP_N_ROTATE_ROW||(l[1]=[z,1-i,k,1-i,k,1-Q,z,1-Q]);for(let N=0;N<y;N++)q.push(A-J+B,N*U-W+Y,0),q.push(A+B,N*U-W+Y,0),q.push(A+B,(N+1)*U-W+Y,0),q.push(A-J+B,(N+1)*U-W+Y,0),O.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,I=a===c.d.FLIP_TILE||a===c.d.ROTATE_TILE||a===c.d.FLIP_N_ROTATE_TILE?I.concat(l[(N+T)%2]):a===c.d.FLIP_ROW||a===c.d.ROTATE_ROW||a===c.d.FLIP_N_ROTATE_ROW?I.concat(l[N%2]):I.concat(l[0]),t.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),b.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const i=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE;Z.b._ComputeSides(i,q,O,b,I,l.frontUVs,l.backUVs);const k=new Z.b;k.indices=O,k.Il=q,k.tl=b,k.hl=I;const Q=i===Z.b.DOUBLESIDE?t.concat(t):t;return k.Ol=Q,k}function u(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new c.d(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return H(a).kl(U,a.updatable),U}function W(l){const a=l.faceUV||new Array(6),N=l.faceColors,K=l.pattern||c.d.NO_FLIP,S=l.width||l.size||1,T=l.height||l.size||1,J=l.depth||l.size||1,n=l.tileWidth||l.tileSize||1,u=l.tileHeight||l.tileSize||1,W=l.alignHorizontal||0,B=l.alignVertical||0,Y=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE;for(let c=0;c<6;c++)void 0===a[c]&&(a[c]=new U.Vector4(0,0,1,1)),N&&void 0===N[c]&&(N[c]=new y.Qc(1,1,1,1));const C=S/2,M=T/2,A=J/2,E=[];for(let U=0;U<2;U++)E[U]=H({pattern:K,tileWidth:n,tileHeight:u,width:S,height:T,alignVertical:B,alignHorizontal:W,sideOrientation:Y});for(let U=2;U<4;U++)E[U]=H({pattern:K,tileWidth:n,tileHeight:u,width:J,height:T,alignVertical:B,alignHorizontal:W,sideOrientation:Y});let q=B;B===c.d.BOTTOM?q=c.d.TOP:B===c.d.TOP&&(q=c.d.BOTTOM);for(let U=4;U<6;U++)E[U]=H({pattern:K,tileWidth:n,tileHeight:u,width:S,height:J,alignVertical:q,alignHorizontal:W,sideOrientation:Y});let b=[],z=[],I=[],t=[];const O=[],h=[],i=[],k=[];let Q=0,j=0;for(let c=0;c<6;c++){const l=E[c].Il.length;h[c]=[],i[c]=[];for(let a=0;a<l/3;a++)h[c].push(new U.ua(E[c].Il[3*a],E[c].Il[3*a+1],E[c].Il[3*a+2])),i[c].push(new U.ua(E[c].tl[3*a],E[c].tl[3*a+1],E[c].tl[3*a+2]));Q=E[c].hl.length,k[c]=[];for(let N=0;N<Q;N+=2)k[c][N]=a[c].x+(a[c].z-a[c].x)*E[c].hl[N],k[c][N+1]=a[c].y+(a[c].w-a[c].y)*E[c].hl[N+1],w.b&&(k[c][N+1]=1-k[c][N+1]);if(I=I.concat(k[c]),t=t.concat(E[c].indices.map((l=>l+j))),j+=h[c].length,N)for(let a=0;a<4;a++)O.push(N[c].r,N[c].g,N[c].b,N[c].a)}const f=new U.ua(0,0,A),p=U.Matrix.RotationY(Math.PI);b=h[0].map((l=>U.ua.TransformNormal(l,p).add(f))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[]),z=i[0].map((l=>U.ua.TransformNormal(l,p))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[]),b=b.concat(h[1].map((l=>l.Wa(f))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[])),z=z.concat(i[1].map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[]));const R=new U.ua(C,0,0),L=U.Matrix.RotationY(-Math.PI/2);b=b.concat(h[2].map((l=>U.ua.TransformNormal(l,L).add(R))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[])),z=z.concat(i[2].map((l=>U.ua.TransformNormal(l,L))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[]));const r=U.Matrix.RotationY(Math.PI/2);b=b.concat(h[3].map((l=>U.ua.TransformNormal(l,r).Wa(R))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[])),z=z.concat(i[3].map((l=>U.ua.TransformNormal(l,r))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[]));const X=new U.ua(0,M,0),P=U.Matrix.RotationX(Math.PI/2);b=b.concat(h[4].map((l=>U.ua.TransformNormal(l,P).add(X))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[])),z=z.concat(i[4].map((l=>U.ua.TransformNormal(l,P))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[]));const d=U.Matrix.RotationX(-Math.PI/2);b=b.concat(h[5].map((l=>U.ua.TransformNormal(l,d).Wa(X))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[])),z=z.concat(i[5].map((l=>U.ua.TransformNormal(l,d))).map((l=>[l.x,l.y,l.z])).reduce(((l,a)=>l.concat(a)),[])),Z.b._ComputeSides(Y,b,t,z,I);const F=new Z.b;if(F.indices=t,F.Il=b,F.tl=z,F.hl=I,N){const l=Y===Z.b.DOUBLESIDE?O.concat(O):O;F.Ol=l}return F}function B(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new c.d(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return W(a).kl(U,a.updatable),U}Z.b.CreateTiledPlane=H;Z.b.CreateTiledBox=W;var Y=N(13807),C=N(12678),M=N(12632);function A(l){const a=l.height||2;let N=0===l.diameterTop?0:l.diameterTop||l.diameter||1,K=0===l.diameterBottom?0:l.diameterBottom||l.diameter||1;N=N||1e-5,K=K||1e-5;const S=0|(l.tessellation||24),T=0|(l.subdivisions||1),J=!!l.hasRings,n=!!l.enclose,H=0===l.cap?0:l.cap||c.d.CAP_ALL,u=l.arc&&(l.arc<=0||l.arc>1)?1:l.arc||1,W=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE,B=l.faceUV||new Array(3),Y=l.faceColors,C=2+(1+(1!==u&&n?2:0))*(J?T:1);let A;for(A=0;A<C;A++)Y&&void 0===Y[A]&&(Y[A]=new y.Qc(1,1,1,1));for(A=0;A<C;A++)B&&void 0===B[A]&&(B[A]=new U.Vector4(0,0,1,1));const E=[],q=[],b=[],z=[],I=[],t=2*Math.PI*u/S;let O,h,i;const k=(K-N)/2/a,Q=U.ua.Zero(),j=U.ua.Zero(),f=U.ua.Zero(),p=U.ua.Zero(),R=U.ua.Zero(),L=M.d.Y;let r,X,P,d=1,F=1,e=0,s=0;for(r=0;r<=T;r++)for(h=r/T,i=(h*(N-K)+K)/2,d=J&&0!==r&&r!==T?2:1,P=0;P<d;P++){for(J&&(F+=P),n&&(F+=2*P),X=0;X<=S;X++)O=X*t,Q.x=Math.cos(-O)*i,Q.y=-a/2+h*a,Q.z=Math.sin(-O)*i,0===N&&r===T?(j.x=b[b.length-3*(S+1)],j.y=b[b.length-3*(S+1)+1],j.z=b[b.length-3*(S+1)+2]):(j.x=Q.x,j.z=Q.z,j.y=Math.sqrt(j.x*j.x+j.z*j.z)*k,j.normalize()),0===X&&(f.K(Q),p.K(j)),q.push(Q.x,Q.y,Q.z),b.push(j.x,j.y,j.z),s=J?e!==F?B[F].y:B[F].w:B[F].y+(B[F].w-B[F].y)*h,z.push(B[F].x+(B[F].z-B[F].x)*X/S,w.b?1-s:s),Y&&I.push(Y[F].r,Y[F].g,Y[F].b,Y[F].a);1!==u&&n&&(q.push(Q.x,Q.y,Q.z),q.push(0,Q.y,0),q.push(0,Q.y,0),q.push(f.x,f.y,f.z),U.ua.CrossToRef(L,j,R),R.normalize(),b.push(R.x,R.y,R.z,R.x,R.y,R.z),U.ua.CrossToRef(p,L,R),R.normalize(),b.push(R.x,R.y,R.z,R.x,R.y,R.z),s=J?e!==F?B[F+1].y:B[F+1].w:B[F+1].y+(B[F+1].w-B[F+1].y)*h,z.push(B[F+1].x,w.b?1-s:s),z.push(B[F+1].z,w.b?1-s:s),s=J?e!==F?B[F+2].y:B[F+2].w:B[F+2].y+(B[F+2].w-B[F+2].y)*h,z.push(B[F+2].x,w.b?1-s:s),z.push(B[F+2].z,w.b?1-s:s),Y&&(I.push(Y[F+1].r,Y[F+1].g,Y[F+1].b,Y[F+1].a),I.push(Y[F+1].r,Y[F+1].g,Y[F+1].b,Y[F+1].a),I.push(Y[F+2].r,Y[F+2].g,Y[F+2].b,Y[F+2].a),I.push(Y[F+2].r,Y[F+2].g,Y[F+2].b,Y[F+2].a))),e!==F&&(e=F)}const o=1!==u&&n?S+4:S;for(r=0,F=0;F<T;F++){let l=0,a=0,N=0,U=0;for(X=0;X<S;X++)l=r*(o+1)+X,a=(r+1)*(o+1)+X,N=r*(o+1)+(X+1),U=(r+1)*(o+1)+(X+1),E.push(l,a,N),E.push(U,N,a);1!==u&&n&&(E.push(l+2,a+2,N+2),E.push(U+2,N+2,a+2),E.push(l+4,a+4,N+4),E.push(U+4,N+4,a+4)),r=J?r+2:r+1}const G=l=>{const c=l?N/2:K/2;if(0===c)return;let Z,T,J;const n=l?B[C-1]:B[0];let y=null;Y&&(y=l?Y[C-1]:Y[0]);const H=q.length/3,W=l?a/2:-a/2,M=new U.ua(0,W,0);q.push(M.x,M.y,M.z),b.push(0,l?1:-1,0);const A=n.y+.5*(n.w-n.y);z.push(n.x+.5*(n.z-n.x),w.b?1-A:A),y&&I.push(y.r,y.g,y.b,y.a);const t=new U.Vector2(.5,.5);for(J=0;J<=S;J++){Z=2*Math.PI*J*u/S;const a=Math.cos(-Z),N=Math.sin(-Z);T=new U.ua(a*c,W,N*c);const K=new U.Vector2(a*t.x+.5,N*t.y+.5);q.push(T.x,T.y,T.z),b.push(0,l?1:-1,0);const H=n.y+(n.w-n.y)*K.y;z.push(n.x+(n.z-n.x)*K.x,w.b?1-H:H),y&&I.push(y.r,y.g,y.b,y.a)}for(J=0;J<S;J++)l?(E.push(H),E.push(H+(J+2)),E.push(H+(J+1))):(E.push(H),E.push(H+(J+1)),E.push(H+(J+2)))};H!==c.d.CAP_START&&H!==c.d.CAP_ALL||G(!1),H!==c.d.CAP_END&&H!==c.d.CAP_ALL||G(!0),Z.b._ComputeSides(W,q,E,b,z,l.frontUVs,l.backUVs);const ml=new Z.b;return ml.indices=E,ml.Il=q,ml.tl=b,ml.hl=z,Y&&(ml.Ol=I),ml}function E(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;const U=new c.d(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return A(a).kl(U,a.updatable),U}function q(l){const a=[],N=[],c=[],K=[],S=l.diameter||1,T=l.thickness||.5,J=0|(l.tessellation||16),n=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE,y=J+1;for(let Z=0;Z<=J;Z++){const l=Z/J,n=Z*Math.PI*2/J-Math.PI/2,H=U.Matrix.Translation(S/2,0,0).multiply(U.Matrix.RotationY(n));for(let S=0;S<=J;S++){const n=1-S/J,u=S*Math.PI*2/J+Math.PI,W=Math.cos(u),B=Math.sin(u);let Y=new U.ua(W,B,0),C=Y.scale(T/2);const M=new U.Vector2(l,n);C=U.ua.TransformCoordinates(C,H),Y=U.ua.TransformNormal(Y,H),N.push(C.x,C.y,C.z),c.push(Y.x,Y.y,Y.z),K.push(M.x,w.b?1-M.y:M.y);const A=(Z+1)%y,E=(S+1)%y;a.push(Z*y+S),a.push(Z*y+E),a.push(A*y+S),a.push(Z*y+E),a.push(A*y+E),a.push(A*y+S)}}Z.b._ComputeSides(n,N,a,c,K,l.frontUVs,l.backUVs);const H=new Z.b;return H.indices=a,H.Il=N,H.tl=c,H.hl=K,H}function b(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;const U=new c.d(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return q(a).kl(U,a.updatable),U}Z.b.CreateCylinder=A,c.d.CreateCylinder=(l,a,N,U,K,Z,w,S,T)=>{void 0!==w&&w instanceof C.d||(void 0!==w&&(T=S||c.d.DEFAULTSIDE,S=w),w=Z,Z=1);return E(l,{height:a,diameterTop:N,diameterBottom:U,tessellation:K,subdivisions:Z,sideOrientation:T,updatable:S},w)};function z(l){const a=[],N=[],c=[],K=[],S=l.radius||2,T=l.tube||.5,J=l.radialSegments||32,n=l.tubularSegments||32,y=l.p||2,H=l.q||3,u=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE,W=l=>{const a=Math.cos(l),N=Math.sin(l),c=H/y*l,K=Math.cos(c),Z=S*(2+K)*.5*a,w=S*(2+K)*N*.5,T=S*Math.sin(c)*.5;return new U.ua(Z,w,T)};let B,Y;for(B=0;B<=J;B++){const l=B%J/J*2*y*Math.PI,a=W(l),c=W(l+.01),Z=c.Wa(a);let S=c.add(a);const H=U.ua.Cross(Z,S);for(S=U.ua.Cross(H,Z),H.normalize(),S.normalize(),Y=0;Y<n;Y++){const l=Y%n/n*2*Math.PI,U=-T*Math.cos(l),c=T*Math.sin(l);N.push(a.x+U*S.x+c*H.x),N.push(a.y+U*S.y+c*H.y),N.push(a.z+U*S.z+c*H.z),K.push(B/J),K.push(w.b?1-Y/n:Y/n)}}for(B=0;B<J;B++)for(Y=0;Y<n;Y++){const l=(Y+1)%n,N=B*n+Y,U=(B+1)*n+Y,c=(B+1)*n+l,K=B*n+l;a.push(K),a.push(U),a.push(N),a.push(K),a.push(c),a.push(U)}Z.b.ComputeNormals(N,a,c),Z.b._ComputeSides(u,N,a,c,K,l.frontUVs,l.backUVs);const C=new Z.b;return C.indices=a,C.Il=N,C.tl=c,C.hl=K,C}function I(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;const U=new c.d(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return z(a).kl(U,a.updatable),U}Z.b.CreateTorus=q,c.d.CreateTorus=(l,a,N,U,c,K,Z)=>b(l,{diameter:a,thickness:N,tessellation:U,sideOrientation:Z,updatable:K},c);Z.b.CreateTorusKnot=z,c.d.CreateTorusKnot=(l,a,N,U,c,K,Z,w,S,T)=>I(l,{radius:a,tube:N,radialSegments:U,tubularSegments:c,p:K,q:Z,sideOrientation:T,updatable:S},w);var t=N(14335),O=N(12974),h=N(12647);function i(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=a.path,K=a.shape,Z=a.scale||1,w=a.rotation||0,S=0===a.cap?0:a.cap||c.d.NO_CAP,T=a.updatable,J=c.d._GetDefaultSideOrientation(a.sideOrientation),n=a.instance||null,y=a.invertUV||!1,H=a.closeShape||!1,u=a.closePath||!1,W=a.capFunction||null;return Q(l,K,U,Z,w,null,null,u,H,S,!1,N,!!T,J,n,y,a.frontUVs||null,a.backUVs||null,a.firstNormal||null,!!a.adjustFrame,W)}function k(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=a.path,K=a.shape,Z=a.scaleFunction||(()=>1),w=a.rotationFunction||(()=>0),S=a.closePath||a.ribbonCloseArray||!1,T=a.closeShape||a.ribbonClosePath||!1,J=0===a.cap?0:a.cap||c.d.NO_CAP,n=a.updatable,y=a.firstNormal||null,H=a.adjustFrame||!1,u=c.d._GetDefaultSideOrientation(a.sideOrientation),W=a.instance,B=a.invertUV||!1,Y=a.capFunction||null;return Q(l,K,U,null,null,Z,w,S,T,J,!0,N,!!n,u,W||null,B,a.frontUVs||null,a.backUVs||null,y,H,Y||null)}function Q(l,a,N,K,Z,w,S,J,n,y,H,u,W,B,Y,C,M,A,E,q,b){const z=(l,a,N,K,Z,w,S,T,J,n,y)=>{const H=N.getTangents(),u=N.getNormals(),W=N.getBinormals(),B=N.getDistances();if(y)for(let c=0;c<H.length;c++)if(0==H[c].x&&0==H[c].y&&0==H[c].z&&H[c].K(H[c-1]),0==u[c].x&&0==u[c].y&&0==u[c].z&&u[c].K(u[c-1]),0==W[c].x&&0==W[c].y&&0==W[c].z&&W[c].K(W[c-1]),c>0){let l=H[c-1];U.ua.Dot(l,H[c])<0&&H[c].scaleInPlace(-1),l=u[c-1],U.ua.Dot(l,u[c])<0&&u[c].scaleInPlace(-1),l=W[c-1],U.ua.Dot(l,W[c])<0&&W[c].scaleInPlace(-1)}let Y=0;const C=n&&T?T:()=>null!==w?w:0,M=n&&S?S:()=>null!==Z?Z:1;let A=J===c.d.NO_CAP||J===c.d.CAP_END?0:2;const E=U.TmpVectors.Matrix[0];for(let c=0;c<a.length;c++){const N=[],Z=C(c,B[c]),w=M(c,B[c]);U.Matrix.RotationAxisToRef(H[c],Y,E);for(let K=0;K<l.length;K++){const Z=H[c].scale(l[K].z).add(u[c].scale(l[K].x)).add(W[c].scale(l[K].y)),S=U.ua.Zero();U.ua.TransformCoordinatesToRef(Z,E,S),S.scaleInPlace(w).addInPlace(a[c]),N[K]=S}K[A]=N,Y+=Z,A++}const q=b||(l=>{const a=Array(),N=U.ua.Zero();let c;for(c=0;c<l.length;c++)N.addInPlace(l[c]);for(N.scaleInPlace(1/l.length),c=0;c<l.length;c++)a.push(N);return a});switch(J){case c.d.NO_CAP:break;case c.d.CAP_START:K[0]=q(K[2]),K[1]=K[2];break;case c.d.CAP_END:K[A]=K[A-1],K[A+1]=q(K[A-1]);break;case c.d.CAP_ALL:K[0]=q(K[2]),K[1]=K[2],K[A]=K[A-1],K[A+1]=q(K[A-1])}return K};let I,t;if(Y){const l=Y._creationDataStorage;return I=E?l.path3D.update(N,E):l.path3D.update(N),t=z(a,N,l.path3D,l.pathArray,K,Z,w,S,l.cap,H,q),Y=T("",{pathArray:t,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:Y},u||void 0)}I=E?new h.m(N,E):new h.m(N);t=z(a,N,I,new Array,K,Z,w,S,y=y<0||y>3?0:y,H,q);const O=T(l,{pathArray:t,closeArray:J,closePath:n,updatable:W,sideOrientation:B,invertUV:C,frontUVs:M||void 0,backUVs:A||void 0},u);return O._creationDataStorage.pathArray=t,O._creationDataStorage.path3D=I,O._creationDataStorage.cap=y,O}function j(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=a.arc?a.arc<=0||a.arc>1?1:a.arc:1,Z=void 0===a.closed||a.closed,w=a.shape,S=a.radius||1,J=a.tessellation||64,n=a.clip||0,y=a.updatable,H=c.d._GetDefaultSideOrientation(a.sideOrientation),u=a.cap||c.d.NO_CAP,W=2*Math.PI,B=[],Y=a.invertUV||!1;let C=0,M=0;const A=W/J*K;let E,q;for(C=0;C<=J-n;C++){for(q=[],u!=c.d.CAP_START&&u!=c.d.CAP_ALL||(q.push(new U.ua(0,w[0].y,0)),q.push(new U.ua(Math.cos(C*A)*w[0].x*S,w[0].y,Math.sin(C*A)*w[0].x*S))),M=0;M<w.length;M++)E=new U.ua(Math.cos(C*A)*w[M].x*S,w[M].y,Math.sin(C*A)*w[M].x*S),q.push(E);u!=c.d.CAP_END&&u!=c.d.CAP_ALL||(q.push(new U.ua(Math.cos(C*A)*w[w.length-1].x*S,w[w.length-1].y,Math.sin(C*A)*w[w.length-1].x*S)),q.push(new U.ua(0,w[w.length-1].y,0))),B.push(q)}return T(l,{pathArray:B,closeArray:Z,sideOrientation:H,updatable:y,invertUV:Y,frontUVs:a.frontUVs,backUVs:a.backUVs},N)}c.d.ExtrudeShape=function(l,a,N,U,K,Z){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7?arguments[7]:void 0,T=arguments.length>8?arguments[8]:void 0,J=arguments.length>9?arguments[9]:void 0;return i(l,{shape:a,path:N,scale:U,rotation:K,cap:0===Z?0:Z||c.d.NO_CAP,sideOrientation:T,instance:J,updatable:S},w)},c.d.ExtrudeShapeCustom=(l,a,N,U,K,Z,w,S,T,J,n,y)=>k(l,{shape:a,path:N,scaleFunction:U,rotationFunction:K,ribbonCloseArray:Z,ribbonClosePath:w,cap:0===S?0:S||c.d.NO_CAP,sideOrientation:n,instance:y,updatable:J},T);c.d.CreateLathe=(l,a,N,U,c,K,Z)=>j(l,{shape:a,radius:N,tessellation:U,sideOrientation:Z,updatable:K},c);var f=N(13699),p=N(13653);function R(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=a.path;let Z=a.instance,w=1;void 0!==a.radius?w=a.radius:Z&&(w=Z._creationDataStorage.radius);const S=a.tessellation||64,J=a.radiusFunction||null;let n=a.cap||c.d.NO_CAP;const y=a.invertUV||!1,H=a.updatable,u=c.d._GetDefaultSideOrientation(a.sideOrientation);a.arc=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1;const W=(l,a,N,K,Z,w,S,T)=>{const J=a.getTangents(),n=a.getNormals(),y=a.getDistances(),H=2*Math.PI/Z*T,u=w||(()=>K);let W,B,Y,C;const M=U.TmpVectors.Matrix[0];let A=S===c.d.NO_CAP||S===c.d.CAP_END?0:2;for(let c=0;c<l.length;c++){B=u(c,y[c]),W=Array(),Y=n[c];for(let a=0;a<Z;a++)U.Matrix.RotationAxisToRef(J[c],H*a,M),C=W[a]?W[a]:U.ua.Zero(),U.ua.TransformCoordinatesToRef(Y,M,C),C.scaleInPlace(B).addInPlace(l[c]),W[a]=C;N[A]=W,A++}const E=(a,N)=>{const U=Array();for(let c=0;c<a;c++)U.push(l[N]);return U};switch(S){case c.d.NO_CAP:break;case c.d.CAP_START:N[0]=E(Z,0),N[1]=N[2].slice(0);break;case c.d.CAP_END:N[A]=N[A-1].slice(0),N[A+1]=E(Z,l.length-1);break;case c.d.CAP_ALL:N[0]=E(Z,0),N[1]=N[2].slice(0),N[A]=N[A-1].slice(0),N[A+1]=E(Z,l.length-1)}return N};let B,Y;if(Z){const l=Z._creationDataStorage,N=a.arc||l.arc;return B=l.path3D.update(K),Y=W(K,B,l.pathArray,w,l.tessellation,J,l.cap,N),Z=T("",{pathArray:Y,instance:Z}),l.path3D=B,l.pathArray=Y,l.arc=N,l.radius=w,Z}B=new h.m(K);n=n<0||n>3?0:n,Y=W(K,B,new Array,w,S,J,n,a.arc);const C=T(l,{pathArray:Y,closePath:!0,closeArray:!1,updatable:H,sideOrientation:u,invertUV:y,frontUVs:a.frontUVs,backUVs:a.backUVs},N);return C._creationDataStorage.pathArray=Y,C._creationDataStorage.path3D=B,C._creationDataStorage.tessellation=S,C._creationDataStorage.cap=n,C._creationDataStorage.arc=a.arc,C._creationDataStorage.radius=w,C}function L(l){const a=[];a[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},a[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},a[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},a[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},a[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},a[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},a[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},a[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},a[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},a[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},a[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},a[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},a[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},a[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},a[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const N=l.type&&(l.type<0||l.type>=a.length)?0:l.type||0,c=l.size,K=l.sizeX||c||1,S=l.sizeY||c||1,T=l.sizeZ||c||1,J=l.custom||a[N],n=J.face.length,H=l.faceUV||new Array(n),u=l.faceColors,W=void 0===l.flat||l.flat,B=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE,Y=[],C=[],M=[],A=[],E=[];let q=0,b=0;const z=[];let I,t,O,h,i,k,Q=0,j=0;if(W)for(j=0;j<n;j++)u&&void 0===u[j]&&(u[j]=new y.Qc(1,1,1,1)),H&&void 0===H[j]&&(H[j]=new U.Vector4(0,0,1,1));if(W)for(j=0;j<n;j++){const l=J.face[j].length;for(O=2*Math.PI/l,h=.5*Math.tan(O/2),i=.5,Q=0;Q<l;Q++)Y.push(J.vertex[J.face[j][Q]][0]*K,J.vertex[J.face[j][Q]][1]*S,J.vertex[J.face[j][Q]][2]*T),z.push(q),q++,I=H[j].x+(H[j].z-H[j].x)*(.5+h),t=H[j].y+(H[j].w-H[j].y)*(i-.5),A.push(I,w.b?1-t:t),k=h*Math.cos(O)-i*Math.sin(O),i=h*Math.sin(O)+i*Math.cos(O),h=k,u&&E.push(u[j].r,u[j].g,u[j].b,u[j].a);for(Q=0;Q<l-2;Q++)C.push(z[0+b],z[Q+2+b],z[Q+1+b]);b+=l}else{for(Q=0;Q<J.vertex.length;Q++)Y.push(J.vertex[Q][0]*K,J.vertex[Q][1]*S,J.vertex[Q][2]*T),A.push(0,w.b?1:0);for(j=0;j<n;j++)for(Q=0;Q<J.face[j].length-2;Q++)C.push(J.face[j][0],J.face[j][Q+2],J.face[j][Q+1])}Z.b.ComputeNormals(Y,C,M),Z.b._ComputeSides(B,Y,C,M,A,l.frontUVs,l.backUVs);const f=new Z.b;return f.Il=Y,f.indices=C,f.tl=M,f.hl=A,u&&W&&(f.Ol=E),f}function r(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new c.d(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return L(a).kl(U,a.updatable),U}c.d.CreateTube=(l,a,N,U,c,K,Z,w,S,T)=>R(l,{path:a,radius:N,tessellation:U,radiusFunction:c,arc:1,cap:K,updatable:w,sideOrientation:S,instance:T},Z);function X(l){const a=l.sideOrientation||Z.b.DEFAULTSIDE,N=l.radius||1,c=void 0===l.flat||l.flat,K=0|(l.subdivisions||4),S=l.radiusX||N,T=l.radiusY||N,J=l.radiusZ||N,n=(1+Math.sqrt(5))/2,y=[-1,n,-0,1,n,0,-1,-n,0,1,-n,0,0,-1,-n,0,1,-n,0,-1,n,0,1,n,n,0,1,n,0,-1,-n,0,1,-n,0,-1],H=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],W=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],B=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],Y=[],C=[],M=[],A=[];let E=0;const q=new Array(3),b=new Array(3);let z;for(z=0;z<3;z++)q[z]=U.ua.Zero(),b[z]=U.Vector2.Zero();for(let Z=0;Z<20;Z++){for(z=0;z<3;z++){const l=H[3*Z+z];q[z].tc(y[3*u[l]],y[3*u[l]+1],y[3*u[l]+2]),q[z].normalize(),b[z].tc(.134765625*W[2*l]+.05859375+-.0390625*B[Z],.2333984375*W[2*l+1]+.025390625+.01953125*B[Z])}const l=(l,a,N,Z)=>{const n=U.ua.Lerp(q[0],q[2],a/K),y=U.ua.Lerp(q[1],q[2],a/K),H=K===a?q[2]:U.ua.Lerp(n,y,l/(K-a));let u;if(H.normalize(),c){const l=U.ua.Lerp(q[0],q[2],Z/K),a=U.ua.Lerp(q[1],q[2],Z/K);u=U.ua.Lerp(l,a,N/(K-Z))}else u=new U.ua(H.x,H.y,H.z);u.x/=S,u.y/=T,u.z/=J,u.normalize();const W=U.Vector2.Lerp(b[0],b[2],a/K),B=U.Vector2.Lerp(b[1],b[2],a/K),z=K===a?b[2]:U.Vector2.Lerp(W,B,l/(K-a));C.push(H.x*S,H.y*T,H.z*J),M.push(u.x,u.y,u.z),A.push(z.x,w.b?1-z.y:z.y),Y.push(E),E++};for(let a=0;a<K;a++)for(let N=0;N+a<K;N++)l(N,a,N+1/3,a+1/3),l(N+1,a,N+1/3,a+1/3),l(N,a+1,N+1/3,a+1/3),N+a+1<K&&(l(N+1,a,N+2/3,a+2/3),l(N+1,a+1,N+2/3,a+2/3),l(N,a+1,N+2/3,a+2/3))}Z.b._ComputeSides(a,C,Y,M,A,l.frontUVs,l.backUVs);const I=new Z.b;return I.indices=Y,I.Il=C,I.tl=M,I.hl=A,I}function P(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new c.d(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),U._originalBuilderSideOrientation=a.sideOrientation;return X(a).kl(U,a.updatable),U}Z.b.CreatePolyhedron=L,c.d.CreatePolyhedron=(l,a,N)=>r(l,a,N);Z.b.CreateIcoSphere=X,c.d.CreateIcoSphere=(l,a,N)=>P(l,a,N);var d=N(12461);const F=new U.ua(1,0,0),e=new U.ua(-1,0,0),s=new U.ua(0,1,0),o=new U.ua(0,-1,0),G=new U.ua(0,0,1),ml=new U.ua(0,0,-1);class x{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.ua.Zero(),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.ua.Up(),N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.Vector2.Zero(),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=l,this.normal=a,this.uv=N,this.vertexIdx=c,this.vertexIdxForBones=K,this.localPositionOverride=Z,this.localNormalOverride=w,this.matrixIndicesOverride=S,this.matrixWeightsOverride=T}clone(){var l,a,N,U;return new x(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(l=this.localPositionOverride)||void 0===l?void 0:l.slice(),null===(a=this.localNormalOverride)||void 0===a?void 0:a.slice(),null===(N=this.matrixIndicesOverride)||void 0===N?void 0:N.slice(),null===(U=this.matrixWeightsOverride)||void 0===U?void 0:U.slice())}}function V(l,a,N){var S,T,J,n,y;const H=!!a.skeleton,u=!(null===(S=a.morphTargetManager)||void 0===S||!S.numTargets),W=N.localMode||H,B=a.zc(),Y=H||u?a.sw(!0,!0):a.getVerticesData(K.h.PositionKind),C=H||u?a.getNormalsData(!0,!0):a.getVerticesData(K.h.NormalKind),M=W?H?a.getVerticesData(K.h.PositionKind):Y:null,A=W?H?a.getVerticesData(K.h.NormalKind):C:null,E=a.getVerticesData(K.h.UVKind),q=H?a.getVerticesData(K.h.MatricesIndicesKind):null,b=H?a.getVerticesData(K.h.MatricesWeightsKind):null,z=H?a.getVerticesData(K.h.MatricesIndicesExtraKind):null,I=H?a.getVerticesData(K.h.MatricesWeightsExtraKind):null,t=N.position||U.ua.Zero();let O=N.normal||U.ua.Up();const h=N.size||U.ua.One(),i=N.angle||0;if(!O){const l=new U.ua(0,0,1),N=a.bl().activeCamera,c=U.ua.TransformCoordinates(l,N.getWorldMatrix());O=N.globalPosition.Wa(c)}const k=-Math.atan2(O.z,O.x)-Math.PI/2,Q=Math.sqrt(O.x*O.x+O.z*O.z),j=Math.atan2(O.y,Q),f=new Z.b;f.indices=[],f.Il=[],f.tl=[],f.hl=[],f.matricesIndices=H?[]:null,f.matricesWeights=H?[]:null,f.matricesIndicesExtra=z?[]:null,f.matricesWeightsExtra=I?[]:null;let p=0;const R=(l,a)=>{const c=new x;if(!B||!Y||!C)return c;const K=B[l];if(c.vertexIdx=3*K,c.vertexIdxForBones=4*K,c.position=new U.ua(Y[3*K],Y[3*K+1],Y[3*K+2]),U.ua.TransformCoordinatesToRef(c.position,a,c.position),c.normal=new U.ua(C[3*K],C[3*K+1],C[3*K+2]),U.ua.TransformNormalToRef(c.normal,a,c.normal),N.captureUVS&&E){const l=E[2*K+1];c.uv=new U.Vector2(E[2*K],w.b?1-l:l)}return c},L=[0,0,0,0],r=(l,a)=>{if(0===l.length)return l;const N=.5*Math.abs(U.ua.Dot(h,a)),c=(l,a,N,U)=>{for(let c=0;c<U;++c)if(l[N+c]===a)return N+c;return-1},K=(l,K)=>{const Z=U.ua.GetClipFactor(l.position,K.position,a,N);let w=L,S=L;if(q&&b){const a=l.matrixIndicesOverride?0:l.vertexIdxForBones,N=l.matrixIndicesOverride??q,U=l.matrixWeightsOverride??b,T=K.matrixIndicesOverride?0:K.vertexIdxForBones,J=K.matrixIndicesOverride??q,n=K.matrixWeightsOverride??b;w=[0,0,0,0],S=[0,0,0,0];let y=0;for(let l=0;l<4;++l)if(U[a+l]>0){const K=c(J,N[a+l],T,4);w[y]=N[a+l],S[y]=(0,d.Lerp)(U[a+l],K>=0?n[K]:0,Z),y++}for(let l=0;l<4&&y<4;++l){const U=J[T+l];-1===c(N,U,a,4)&&(w[y]=U,S[y]=(0,d.Lerp)(0,n[T+l],Z),y++)}const H=S[0]+S[1]+S[2]+S[3];S[0]/=H,S[1]/=H,S[2]/=H,S[3]/=H}const T=l.localPositionOverride?l.localPositionOverride[0]:(null===M||void 0===M?void 0:M[l.vertexIdx])??0,J=l.localPositionOverride?l.localPositionOverride[1]:(null===M||void 0===M?void 0:M[l.vertexIdx+1])??0,n=l.localPositionOverride?l.localPositionOverride[2]:(null===M||void 0===M?void 0:M[l.vertexIdx+2])??0,y=K.localPositionOverride?K.localPositionOverride[0]:(null===M||void 0===M?void 0:M[K.vertexIdx])??0,H=K.localPositionOverride?K.localPositionOverride[1]:(null===M||void 0===M?void 0:M[K.vertexIdx+1])??0,u=K.localPositionOverride?K.localPositionOverride[2]:(null===M||void 0===M?void 0:M[K.vertexIdx+2])??0,W=l.localNormalOverride?l.localNormalOverride[0]:(null===A||void 0===A?void 0:A[l.vertexIdx])??0,B=l.localNormalOverride?l.localNormalOverride[1]:(null===A||void 0===A?void 0:A[l.vertexIdx+1])??0,Y=l.localNormalOverride?l.localNormalOverride[2]:(null===A||void 0===A?void 0:A[l.vertexIdx+2])??0,C=W+((K.localNormalOverride?K.localNormalOverride[0]:(null===A||void 0===A?void 0:A[K.vertexIdx])??0)-W)*Z,E=B+((K.localNormalOverride?K.localNormalOverride[1]:(null===A||void 0===A?void 0:A[K.vertexIdx+1])??0)-B)*Z,z=Y+((K.localNormalOverride?K.localNormalOverride[2]:(null===A||void 0===A?void 0:A[K.vertexIdx+2])??0)-Y)*Z,I=Math.sqrt(C*C+E*E+z*z);return new x(U.ua.Lerp(l.position,K.position,Z),U.ua.Lerp(l.normal,K.normal,Z).normalize(),U.Vector2.Lerp(l.uv,K.uv,Z),-1,-1,M?[T+(y-T)*Z,J+(H-J)*Z,n+(u-n)*Z]:null,A?[C/I,E/I,z/I]:null,w,S)};let Z=null;l.length>3&&(Z=[]);for(let w=0;w<l.length;w+=3){let c=0,S=null,T=null,J=null,n=null;const y=U.ua.Dot(l[w].position,a)-N>0,H=U.ua.Dot(l[w+1].position,a)-N>0,u=U.ua.Dot(l[w+2].position,a)-N>0;switch(c=(y?1:0)+(H?1:0)+(u?1:0),c){case 0:l.length>3?(Z.push(l[w]),Z.push(l[w+1]),Z.push(l[w+2])):Z=l;break;case 1:if(Z=Z??new Array,y&&(S=l[w+1],T=l[w+2],J=K(l[w],S),n=K(l[w],T)),H){S=l[w],T=l[w+2],J=K(l[w+1],S),n=K(l[w+1],T),Z.push(J),Z.push(T.clone()),Z.push(S.clone()),Z.push(T.clone()),Z.push(J.clone()),Z.push(n);break}u&&(S=l[w],T=l[w+1],J=K(l[w+2],S),n=K(l[w+2],T)),S&&T&&J&&n&&(Z.push(S.clone()),Z.push(T.clone()),Z.push(J),Z.push(n),Z.push(J.clone()),Z.push(T.clone()));break;case 2:Z=Z??new Array,y||(S=l[w].clone(),T=K(S,l[w+1]),J=K(S,l[w+2]),Z.push(S),Z.push(T),Z.push(J)),H||(S=l[w+1].clone(),T=K(S,l[w+2]),J=K(S,l[w]),Z.push(S),Z.push(T),Z.push(J)),u||(S=l[w+2].clone(),T=K(S,l[w]),J=K(S,l[w+1]),Z.push(S),Z.push(T),Z.push(J))}}return Z},X=a instanceof c.d?a:null,P=null===X||void 0===X?void 0:X._thinInstanceDataStorage.matrixData,V=(null===X||void 0===X?void 0:X.fc)||1,D=U.TmpVectors.Matrix[0];D.K(U.Matrix.IdentityReadOnly);for(let c=0;c<V;++c){if(null!==X&&void 0!==X&&X.hasThinInstances&&P){const l=16*c;D.setRowFromFloats(0,P[l+0],P[l+1],P[l+2],P[l+3]),D.setRowFromFloats(1,P[l+4],P[l+5],P[l+6],P[l+7]),D.setRowFromFloats(2,P[l+8],P[l+9],P[l+10],P[l+11]),D.setRowFromFloats(3,P[l+12],P[l+13],P[l+14],P[l+15])}const l=U.Matrix.RotationYawPitchRoll(k,j,i).multiply(U.Matrix.Translation(t.x,t.y,t.z)),K=U.Matrix.Invert(l),Z=a.getWorldMatrix(),S=D.multiply(Z).multiply(K),T=new Array(3);for(let a=0;a<B.length;a+=3){let l=T;if(l[0]=R(a,S),l[1]=R(a+1,S),l[2]=R(a+2,S),!(N.cullBackFaces&&-l[0].normal.z<=0&&-l[1].normal.z<=0&&-l[2].normal.z<=0)&&(l=r(l,F),l&&(l=r(l,e),l&&(l=r(l,s),l&&(l=r(l,o),l&&(l=r(l,G),l&&(l=r(l,ml),l)))))))for(let a=0;a<l.length;a++){const U=l[a];if(f.indices.push(p),W?(U.localPositionOverride?(f.Il[3*p]=U.localPositionOverride[0],f.Il[3*p+1]=U.localPositionOverride[1],f.Il[3*p+2]=U.localPositionOverride[2]):M&&(f.Il[3*p]=M[U.vertexIdx],f.Il[3*p+1]=M[U.vertexIdx+1],f.Il[3*p+2]=M[U.vertexIdx+2]),U.localNormalOverride?(f.tl[3*p]=U.localNormalOverride[0],f.tl[3*p+1]=U.localNormalOverride[1],f.tl[3*p+2]=U.localNormalOverride[2]):A&&(f.tl[3*p]=A[U.vertexIdx],f.tl[3*p+1]=A[U.vertexIdx+1],f.tl[3*p+2]=A[U.vertexIdx+2])):(U.position.toArray(f.Il,3*p),U.normal.toArray(f.tl,3*p)),f.matricesIndices&&f.matricesWeights&&(U.matrixIndicesOverride?(f.matricesIndices[4*p]=U.matrixIndicesOverride[0],f.matricesIndices[4*p+1]=U.matrixIndicesOverride[1],f.matricesIndices[4*p+2]=U.matrixIndicesOverride[2],f.matricesIndices[4*p+3]=U.matrixIndicesOverride[3]):(q&&(f.matricesIndices[4*p]=q[U.vertexIdxForBones],f.matricesIndices[4*p+1]=q[U.vertexIdxForBones+1],f.matricesIndices[4*p+2]=q[U.vertexIdxForBones+2],f.matricesIndices[4*p+3]=q[U.vertexIdxForBones+3]),z&&f.matricesIndicesExtra&&(f.matricesIndicesExtra[4*p]=z[U.vertexIdxForBones],f.matricesIndicesExtra[4*p+1]=z[U.vertexIdxForBones+1],f.matricesIndicesExtra[4*p+2]=z[U.vertexIdxForBones+2],f.matricesIndicesExtra[4*p+3]=z[U.vertexIdxForBones+3])),U.matrixWeightsOverride?(f.matricesWeights[4*p]=U.matrixWeightsOverride[0],f.matricesWeights[4*p+1]=U.matrixWeightsOverride[1],f.matricesWeights[4*p+2]=U.matrixWeightsOverride[2],f.matricesWeights[4*p+3]=U.matrixWeightsOverride[3]):(b&&(f.matricesWeights[4*p]=b[U.vertexIdxForBones],f.matricesWeights[4*p+1]=b[U.vertexIdxForBones+1],f.matricesWeights[4*p+2]=b[U.vertexIdxForBones+2],f.matricesWeights[4*p+3]=b[U.vertexIdxForBones+3]),I&&f.matricesWeightsExtra&&(f.matricesWeightsExtra[4*p]=I[U.vertexIdxForBones],f.matricesWeightsExtra[4*p+1]=I[U.vertexIdxForBones+1],f.matricesWeightsExtra[4*p+2]=I[U.vertexIdxForBones+2],f.matricesWeightsExtra[4*p+3]=I[U.vertexIdxForBones+3]))),N.captureUVS)U.uv.toArray(f.hl,2*p);else{f.hl.push(.5+U.position.x/h.x);const l=.5+U.position.y/h.y;f.hl.push(w.b?1-l:l)}p++}}}0===f.indices.length&&(f.indices=null),0===f.Il.length&&(f.Il=null),0===f.tl.length&&(f.tl=null),0===f.hl.length&&(f.hl=null),0===(null===(T=f.matricesIndices)||void 0===T?void 0:T.length)&&(f.matricesIndices=null),0===(null===(J=f.matricesWeights)||void 0===J?void 0:J.length)&&(f.matricesWeights=null),0===(null===(n=f.matricesIndicesExtra)||void 0===n?void 0:n.length)&&(f.matricesIndicesExtra=null),0===(null===(y=f.matricesWeightsExtra)||void 0===y?void 0:y.length)&&(f.matricesWeightsExtra=null);const v=new c.d(l,a.bl());return f.kl(v),W?(v.skeleton=a.skeleton,v.parent=a):(v.position=t.clone(),v.rotation=new U.ua(j,k,i)),v.qc(!0),v.refreshBoundingInfo(!0,!0),v}function D(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const a=0|Math.max(l.subdivisions?l.subdivisions:2,1),N=0|Math.max(l.tessellation?l.tessellation:16,3),c=Math.max(l.height?l.height:1,0),K=Math.max(l.radius?l.radius:.25,0),S=0|Math.max(l.capSubdivisions?l.capSubdivisions:6,1),T=N,J=a,n=Math.max(l.radiusTop?l.radiusTop:K,0),y=Math.max(l.radiusBottom?l.radiusBottom:K,0),H=c-(n+y),u=2*Math.PI,W=Math.max(l.topCapSubdivisions?l.topCapSubdivisions:S,1),B=Math.max(l.bottomCapSubdivisions?l.bottomCapSubdivisions:S,1),Y=Math.acos((y-n)/c);let C=[];const M=[],A=[],E=[];let q=0;const b=[],z=.5*H,I=.5*Math.PI;let t,O;const h=U.ua.Zero(),i=U.ua.Zero(),k=Math.cos(Y),Q=Math.sin(Y),j=new U.Vector2(n*Q,z+n*k).Wa(new U.Vector2(y*Q,y*k-z)).length(),f=n*Y+j+y*(I-Y);let p=0;for(O=0;O<=W;O++){const l=[],a=I-Y*(O/W);p+=n*Y/W;const N=Math.cos(a),U=Math.sin(a),c=N*n;for(t=0;t<=T;t++){const a=t/T,K=a*u+0,Z=Math.sin(K),S=Math.cos(K);i.x=c*Z,i.y=z+U*n,i.z=c*S,M.push(i.x,i.y,i.z),h.set(N*Z,U,N*S),A.push(h.x,h.y,h.z),E.push(a,w.b?p/f:1-p/f),l.push(q),q++}b.push(l)}const R=c-n-y+k*n-k*y,L=Q*(y-n)/R;for(O=1;O<=J;O++){const l=[];p+=j/J;const a=Q*(O*(y-n)/J+n);for(t=0;t<=T;t++){const N=t/T,U=N*u+0,c=Math.sin(U),K=Math.cos(U);i.x=a*c,i.y=z+k*n-O*R/J,i.z=a*K,M.push(i.x,i.y,i.z),h.set(c,L,K).normalize(),A.push(h.x,h.y,h.z),E.push(N,w.b?p/f:1-p/f),l.push(q),q++}b.push(l)}for(O=1;O<=B;O++){const l=[],a=I-Y-(Math.PI-Y)*(O/B);p+=y*Y/B;const N=Math.cos(a),U=Math.sin(a),c=N*y;for(t=0;t<=T;t++){const a=t/T,K=a*u+0,Z=Math.sin(K),S=Math.cos(K);i.x=c*Z,i.y=U*y-z,i.z=c*S,M.push(i.x,i.y,i.z),h.set(N*Z,U,N*S),A.push(h.x,h.y,h.z),E.push(a,w.b?p/f:1-p/f),l.push(q),q++}b.push(l)}for(t=0;t<T;t++)for(O=0;O<W+J+B;O++){const l=b[O][t],a=b[O+1][t],N=b[O+1][t+1],U=b[O][t+1];C.push(l),C.push(a),C.push(U),C.push(a),C.push(N),C.push(U)}if(C=C.reverse(),l.orientation&&!l.orientation.equals(U.ua.Up())){const a=new U.Matrix;l.orientation.clone().scale(.5*Math.PI).cross(U.ua.Up()).toQuaternion().toRotationMatrix(a);const N=U.ua.Zero();for(let l=0;l<M.length;l+=3)N.set(M[l],M[l+1],M[l+2]),U.ua.TransformCoordinatesToRef(N.clone(),a,N),M[l]=N.x,M[l+1]=N.y,M[l+2]=N.z}const r=new Z.b;return r.Il=M,r.tl=A,r.hl=E,r.indices=C,r}function v(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:U.ua.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=new c.d(l,N);return D(a).kl(K,a.updatable),K}c.d.CreateDecal=(l,a,N,U,c,K)=>V(l,a,{position:N,normal:U,size:c,angle:K});c.d.CreateCapsule=(l,a,N)=>v(l,a,N),Z.b.CreateCapsule=D;var g=N(12268),ll=N(12452);class al{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=l,this.y=a,l!==Math.floor(l)&&(l=Math.floor(l),g.b.Warn("x is not an integer, floor(x) used")),a!==Math.floor(a)&&(a=Math.floor(a),g.b.Warn("y is not an integer, floor(y) used"))}clone(){return new al(this.x,this.y)}rotate60About(l){const a=this.x;return this.x=l.x+l.y-this.y,this.y=a+this.y-l.x,this}rotateNeg60About(l){const a=this.x;return this.x=a+this.y-l.y,this.y=l.x+l.y-a,this}rotate120(l,a){l!==Math.floor(l)&&(l=Math.floor(l),g.b.Warn("m not an integer only floor(m) used")),a!==Math.floor(a)&&(a=Math.floor(a),g.b.Warn("n not an integer only floor(n) used"));const N=this.x;return this.x=l-N-this.y,this.y=a+N,this}rotateNeg120(l,a){l!==Math.floor(l)&&(l=Math.floor(l),g.b.Warn("m is not an integer, floor(m) used")),a!==Math.floor(a)&&(a=Math.floor(a),g.b.Warn("n is not an integer,   floor(n) used"));const N=this.x;return this.x=this.y-a,this.y=l+a-N-this.y,this}toCartesianOrigin(l,a){const N=U.ua.Zero();return N.x=l.x+2*this.x*a+this.y*a,N.y=l.y+Math.sqrt(3)*this.y*a,N}static Zero(){return new al(0,0)}}class Nl{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Ul("icosahedron","Regular",[[0,ll.f,-1],[-ll.f,1,0],[-1,0,-ll.f],[1,0,-ll.f],[ll.f,1,0],[0,ll.f,1],[-1,0,ll.f],[-ll.f,-1,0],[0,-ll.f,-1],[ll.f,-1,0],[1,0,ll.f],[0,-ll.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let l=12;const a={},N=this.m,U=this.n;let c,K,Z,w,S,T=N,J=1,n=0;0!==U&&(T=(0,d.HighestCommonFactor)(N,U)),J=N/T,n=U/T;const y=al.Zero(),H=new al(N,U),u=new al(-U,N+U),W=al.Zero(),B=al.Zero(),Y=al.Zero();let C,M,A,E,q=[];const b=[],z=this.vertByDist,I=(N,U,c,K)=>{C=N+"|"+c,M=U+"|"+K,C in a||M in a?C in a&&!(M in a)?a[M]=a[C]:M in a&&!(C in a)&&(a[C]=a[M]):(a[C]=l,a[M]=l,l++),z[c][0]>2?b[a[C]]=[-z[c][0],z[c][1],a[C]]:b[a[C]]=[q[z[c][0]],z[c][1],a[C]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let t=0;t<20;t++){if(q=this.IDATA.face[t],Z=q[2],w=q[1],S=q[0],A=y.x+"|"+y.y,C=t+"|"+A,C in a||(a[C]=Z,b[Z]=[q[z[A][0]],z[A][1]]),A=H.x+"|"+H.y,C=t+"|"+A,C in a||(a[C]=w,b[w]=[q[z[A][0]],z[A][1]]),A=u.x+"|"+u.y,C=t+"|"+A,C in a||(a[C]=S,b[S]=[q[z[A][0]],z[A][1]]),c=this.IDATA.edgematch[t][0],K=this.IDATA.edgematch[t][1],"B"===K)for(let l=1;l<T;l++)B.x=N-l*(J+n),B.y=U+l*J,Y.x=-l*n,Y.y=l*(J+n),A=B.x+"|"+B.y,E=Y.x+"|"+Y.y,I(t,c,A,E);if("O"===K)for(let l=1;l<T;l++)Y.x=-l*n,Y.y=l*(J+n),W.x=l*J,W.y=l*n,A=Y.x+"|"+Y.y,E=W.x+"|"+W.y,I(t,c,A,E);if(c=this.IDATA.edgematch[t][2],K=this.IDATA.edgematch[t][3],K&&"A"===K)for(let l=1;l<T;l++)W.x=l*J,W.y=l*n,B.x=N-(T-l)*(J+n),B.y=U+(T-l)*J,A=W.x+"|"+W.y,E=B.x+"|"+B.y,I(t,c,A,E);for(let N=0;N<this.vertices.length;N++)A=this.vertices[N].x+"|"+this.vertices[N].y,C=t+"|"+A,C in a||(a[C]=l++,z[A][0]>2?b[a[C]]=[-z[A][0],z[A][1],a[C]]:b[a[C]]=[q[z[A][0]],z[A][1],a[C]])}this.closestTo=b,this.vecToidx=a}calcCoeffs(){const l=this.m,a=this.n,N=Math.sqrt(3)/3,U=l*l+a*a+l*a;this.coau=(l+a)/U,this.cobu=-a/U,this.coav=-N*(l-a)/U,this.cobv=N*(2*l+a)/U}createInnerFacets(){const l=this.m,a=this.n;for(let N=0;N<a+l+1;N++)for(let l=this.min[N];l<this.max[N]+1;l++)l<this.max[N]&&l<this.max[N+1]+1&&this.innerFacets.push(["|"+l+"|"+N,"|"+l+"|"+(N+1),"|"+(l+1)+"|"+N]),N>0&&l<this.max[N-1]&&l+1<this.max[N]+1&&this.innerFacets.push(["|"+l+"|"+N,"|"+(l+1)+"|"+N,"|"+(l+1)+"|"+(N-1)])}edgeVecsABOB(){const l=this.m,a=this.n,N=new al(-a,l+a);for(let U=1;U<l+a;U++){const l=new al(this.min[U],U),a=new al(this.min[U-1],U-1),c=new al(this.min[U+1],U+1),K=l.clone(),Z=a.clone(),w=c.clone();K.rotate60About(N),Z.rotate60About(N),w.rotate60About(N);const S=new al(this.max[K.y],K.y),T=new al(this.max[K.y-1],K.y-1),J=new al(this.max[K.y-1]-1,K.y-1);K.x===S.x&&K.y===S.y||(K.x!==T.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([l,T,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([l,J,S])):K.y===w.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([l,a,T]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([l,T,c])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([l,a,T]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([l,T,S])))}}mapABOBtoOBOA(){const l=new al(0,0);for(let a=0;a<this.isoVecsABOB.length;a++){const N=[];for(let U=0;U<3;U++)l.x=this.isoVecsABOB[a][U].x,l.y=this.isoVecsABOB[a][U].y,0===this.vertexTypes[a][U]&&l.rotateNeg120(this.m,this.n),N.push(l.clone());this.isoVecsOBOA.push(N)}}mapABOBtoBAOA(){const l=new al(0,0);for(let a=0;a<this.isoVecsABOB.length;a++){const N=[];for(let U=0;U<3;U++)l.x=this.isoVecsABOB[a][U].x,l.y=this.isoVecsABOB[a][U].y,1===this.vertexTypes[a][U]&&l.rotate120(this.m,this.n),N.push(l.clone());this.isoVecsBAOA.push(N)}}MapToFace(l,a){const N=this.IDATA.face[l],c=N[2],K=N[1],Z=N[0],w=U.ua.Ma(this.IDATA.vertex[c]),S=U.ua.Ma(this.IDATA.vertex[K]),T=U.ua.Ma(this.IDATA.vertex[Z]),J=S.Wa(w),n=T.Wa(w),y=J.scale(this.coau).add(n.scale(this.cobu)),H=J.scale(this.coav).add(n.scale(this.cobv)),u=[];let W,B=U.TmpVectors.ua[0];for(let U=0;U<this.cartesian.length;U++)B=y.scale(this.cartesian[U].x).add(H.scale(this.cartesian[U].y)).add(w),u[U]=[B.x,B.y,B.z],W=l+"|"+this.vertices[U].x+"|"+this.vertices[U].y,a.vertex[this.vecToidx[W]]=[B.x,B.y,B.z]}build(l,a){const N=[],U=al.Zero(),c=new al(l,a),K=new al(-a,l+a);N.push(U,c,K);for(let A=a;A<l+1;A++)for(let a=0;a<l+1-A;a++)N.push(new al(a,A));if(a>0){const U=(0,d.HighestCommonFactor)(l,a),c=l/U,K=a/U;for(let w=1;w<U;w++)N.push(new al(w*c,w*K)),N.push(new al(-w*K,w*(c+K))),N.push(new al(l-w*(c+K),a+w*c));const Z=l/a;for(let w=1;w<a;w++)for(let U=0;U<w*Z;U++)N.push(new al(U,w)),N.push(new al(U,w).rotate120(l,a)),N.push(new al(U,w).rotateNeg120(l,a))}N.sort(((l,a)=>l.x-a.x)),N.sort(((l,a)=>l.y-a.y));const Z=new Array(l+a+1),w=new Array(l+a+1);for(let A=0;A<Z.length;A++)Z[A]=1/0,w[A]=-1/0;let S=0,T=0;const J=N.length;for(let A=0;A<J;A++)T=N[A].x,S=N[A].y,Z[S]=Math.min(T,Z[S]),w[S]=Math.max(T,w[S]);const n=(N,U)=>{const c=N.clone();return"A"===U&&c.rotateNeg120(l,a),"B"===U&&c.rotate120(l,a),c.x<0?c.y:c.x+c.y},y=[],H=[],u=[],W=[],B={},Y=[];let C=-1,M=-1;for(let A=0;A<J;A++)y[A]=N[A].toCartesianOrigin(new al(0,0),.5),H[A]=n(N[A],"O"),u[A]=n(N[A],"A"),W[A]=n(N[A],"B"),H[A]===u[A]&&u[A]===W[A]?(C=3,M=H[A]):H[A]===u[A]?(C=4,M=H[A]):u[A]===W[A]?(C=5,M=u[A]):W[A]===H[A]&&(C=6,M=H[A]),H[A]<u[A]&&H[A]<W[A]&&(C=2,M=H[A]),u[A]<H[A]&&u[A]<W[A]&&(C=1,M=u[A]),W[A]<u[A]&&W[A]<H[A]&&(C=0,M=W[A]),Y.push([C,M,N[A].x,N[A].y]);Y.sort(((l,a)=>l[2]-a[2])),Y.sort(((l,a)=>l[3]-a[3])),Y.sort(((l,a)=>l[1]-a[1])),Y.sort(((l,a)=>l[0]-a[0]));for(let A=0;A<Y.length;A++)B[Y[A][2]+"|"+Y[A][3]]=[Y[A][0],Y[A][1],A];return this.m=l,this.n=a,this.vertices=N,this.vertByDist=B,this.cartesian=y,this.min=Z,this.max=w,this}}class Ul{constructor(l,a,N,U){this.name=l,this.category=a,this.vertex=N,this.face=U}}class cl extends Ul{innerToData(l,a){for(let N=0;N<a.innerFacets.length;N++)this.face.push(a.innerFacets[N].map((N=>a.vecToidx[l+N])))}mapABOBtoDATA(l,a){const N=a.IDATA.edgematch[l][0];for(let U=0;U<a.isoVecsABOB.length;U++){const c=[];for(let K=0;K<3;K++)0===a.vertexTypes[U][K]?c.push(l+"|"+a.isoVecsABOB[U][K].x+"|"+a.isoVecsABOB[U][K].y):c.push(N+"|"+a.isoVecsABOB[U][K].x+"|"+a.isoVecsABOB[U][K].y);this.face.push([a.vecToidx[c[0]],a.vecToidx[c[1]],a.vecToidx[c[2]]])}}mapOBOAtoDATA(l,a){const N=a.IDATA.edgematch[l][0];for(let U=0;U<a.isoVecsOBOA.length;U++){const c=[];for(let K=0;K<3;K++)1===a.vertexTypes[U][K]?c.push(l+"|"+a.isoVecsOBOA[U][K].x+"|"+a.isoVecsOBOA[U][K].y):c.push(N+"|"+a.isoVecsOBOA[U][K].x+"|"+a.isoVecsOBOA[U][K].y);this.face.push([a.vecToidx[c[0]],a.vecToidx[c[1]],a.vecToidx[c[2]]])}}mapBAOAtoDATA(l,a){const N=a.IDATA.edgematch[l][2];for(let U=0;U<a.isoVecsBAOA.length;U++){const c=[];for(let K=0;K<3;K++)1===a.vertexTypes[U][K]?c.push(l+"|"+a.isoVecsBAOA[U][K].x+"|"+a.isoVecsBAOA[U][K].y):c.push(N+"|"+a.isoVecsBAOA[U][K].x+"|"+a.isoVecsBAOA[U][K].y);this.face.push([a.vecToidx[c[0]],a.vecToidx[c[1]],a.vecToidx[c[2]]])}}orderData(l){const a=[];for(let K=0;K<13;K++)a[K]=[];const N=l.closestTo;for(let K=0;K<N.length;K++)N[K][0]>-1?N[K][1]>0&&a[N[K][0]].push([K,N[K][1]]):a[12].push([K,N[K][0]]);const U=[];for(let K=0;K<12;K++)U[K]=K;let c=12;for(let K=0;K<12;K++){a[K].sort(((l,a)=>l[1]-a[1]));for(let l=0;l<a[K].length;l++)U[a[K][l][0]]=c++}for(let K=0;K<a[12].length;K++)U[a[12][K][0]]=c++;for(let K=0;K<this.vertex.length;K++)this.vertex[K].push(U[K]);this.vertex.sort(((l,a)=>l[3]-a[3]));for(let K=0;K<this.vertex.length;K++)this.vertex[K].pop();for(let K=0;K<this.face.length;K++)for(let l=0;l<this.face[K].length;l++)this.face[K][l]=U[this.face[K][l]];this.sharedNodes=a[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(l,a){const N=[],U=[];let c=a.pop();U.push(c);let K=this.face[c].indexOf(l);K=(K+2)%3;let Z=this.face[c][K];N.push(Z);let w=0;for(;a.length>0;)c=a[w],this.face[c].indexOf(Z)>-1?(K=(this.face[c].indexOf(Z)+1)%3,Z=this.face[c][K],N.push(Z),U.push(c),a.splice(w,1),w=0):w++;return this.adjacentFaces.push(N),U}toGoldbergPolyhedronData(){const l=new Ul("GeoDual","Goldberg",[],[]);l.name="GD dual";const a=this.vertex.length,N=new Array(a);for(let S=0;S<a;S++)N[S]=[];for(let S=0;S<this.face.length;S++)for(let l=0;l<3;l++)N[this.face[S][l]].push(S);let U=0,c=0,K=0,Z=[],w=[];this.adjacentFaces=[];for(let S=0;S<N.length;S++){l.face[S]=this.setOrder(S,N[S].concat([]));for(const a of N[S]){U=0,c=0,K=0,Z=this.face[a];for(let l=0;l<3;l++)w=this.vertex[Z[l]],U+=w[0],c+=w[1],K+=w[2];l.vertex[a]=[U/3,c/3,K/3]}}return l}static BuildGeodesicData(l){const a=new cl("Geodesic-m-n","Geodesic",[[0,ll.f,-1],[-ll.f,1,0],[-1,0,-ll.f],[1,0,-ll.f],[ll.f,1,0],[0,ll.f,1],[-1,0,ll.f],[-ll.f,-1,0],[0,-ll.f,-1],[ll.f,-1,0],[1,0,ll.f],[0,-ll.f,1]],[]);l.setIndices(),l.calcCoeffs(),l.createInnerFacets(),l.edgeVecsABOB(),l.mapABOBtoOBOA(),l.mapABOBtoBAOA();for(let N=0;N<l.IDATA.face.length;N++)l.MapToFace(N,a),a.innerToData(N,l),"B"===l.IDATA.edgematch[N][1]&&a.mapABOBtoDATA(N,l),"O"===l.IDATA.edgematch[N][1]&&a.mapOBOAtoDATA(N,l),"A"===l.IDATA.edgematch[N][3]&&a.mapBAOAtoDATA(N,l);a.orderData(l);return a.vertex=a.vertex.map((function(l){const a=l[0],N=l[1],U=l[2],c=Math.sqrt(a*a+N*N+U*U);return l[0]*=1/c,l[1]*=1/c,l[2]*=1/c,l})),a}}c.d._GoldbergMeshParser=(l,a)=>Kl.Parse(l,a);class Kl extends c.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(l,a){return void 0===a?(l>this.goldbergData.nbUnsharedFaces-1&&(g.b.Warn("Maximum number of unshared faces used"),l=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+l):(l>11&&(g.b.Warn("Last pole used"),l=11),a>this.goldbergData.nbFacesAtPole-1&&(g.b.Warn("Maximum number of faces at a pole used"),a=this.goldbergData.nbFacesAtPole-1),12+l*this.goldbergData.nbFacesAtPole+a)}_changeGoldbergFaceColors(l){for(let N=0;N<l.length;N++){const a=l[N][0],U=l[N][1],c=l[N][2];for(let l=a;l<U+1;l++)this.goldbergData.faceColors[l]=c}const a=[];for(let N=0;N<12;N++)for(let l=0;l<5;l++)a.push(this.goldbergData.faceColors[N].r,this.goldbergData.faceColors[N].g,this.goldbergData.faceColors[N].b,this.goldbergData.faceColors[N].a);for(let N=12;N<this.goldbergData.faceColors.length;N++)for(let l=0;l<6;l++)a.push(this.goldbergData.faceColors[N].r,this.goldbergData.faceColors[N].g,this.goldbergData.faceColors[N].b,this.goldbergData.faceColors[N].a);return a}setGoldbergFaceColors(l){const a=this._changeGoldbergFaceColors(l);this.pl(K.h.ColorKind,a)}updateGoldbergFaceColors(l){const a=this._changeGoldbergFaceColors(l);this.updateVerticesData(K.h.ColorKind,a)}_changeGoldbergFaceUVs(l){const a=this.getVerticesData(K.h.UVKind);for(let N=0;N<l.length;N++){const U=l[N][0],c=l[N][1],K=l[N][2],Z=l[N][3],w=l[N][4],S=[],T=[];let J,n;for(let l=0;l<5;l++)J=K.x+Z*Math.cos(w+l*Math.PI/2.5),n=K.y+Z*Math.sin(w+l*Math.PI/2.5),J<0&&(J=0),J>1&&(J=1),S.push(J,n);for(let l=0;l<6;l++)J=K.x+Z*Math.cos(w+l*Math.PI/3),n=K.y+Z*Math.sin(w+l*Math.PI/3),J<0&&(J=0),J>1&&(J=1),T.push(J,n);for(let l=U;l<Math.min(12,c+1);l++)for(let N=0;N<5;N++)a[10*l+2*N]=S[2*N],a[10*l+2*N+1]=S[2*N+1];for(let l=Math.max(12,U);l<c+1;l++)for(let N=0;N<6;N++)a[12*l-24+2*N]=T[2*N],a[12*l-23+2*N]=T[2*N+1]}return a}setGoldbergFaceUVs(l){const a=this._changeGoldbergFaceUVs(l);this.pl(K.h.UVKind,a)}updateGoldbergFaceUVs(l){const a=this._changeGoldbergFaceUVs(l);this.updateVerticesData(K.h.UVKind,a)}placeOnGoldbergFaceAt(l,a,N){const c=U.ua.RotationFromAxis(this.goldbergData.faceXaxis[a],this.goldbergData.faceYaxis[a],this.goldbergData.faceZaxis[a]);l.rotation=c,l.position=this.goldbergData.faceCenters[a].add(this.goldbergData.faceXaxis[a].scale(N.x)).add(this.goldbergData.faceYaxis[a].scale(N.y)).add(this.goldbergData.faceZaxis[a].scale(N.z))}serialize(l){super.serialize(l),l.type="GoldbergMesh";const a={};if(a.adjacentFaces=this.goldbergData.adjacentFaces,a.nbSharedFaces=this.goldbergData.nbSharedFaces,a.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,a.nbFaces=this.goldbergData.nbFaces,a.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){a.faceColors=[];for(const l of this.goldbergData.faceColors)a.faceColors.push(l.Bc())}if(this.goldbergData.faceCenters){a.faceCenters=[];for(const l of this.goldbergData.faceCenters)a.faceCenters.push(l.Bc())}if(this.goldbergData.faceZaxis){a.faceZaxis=[];for(const l of this.goldbergData.faceZaxis)a.faceZaxis.push(l.Bc())}if(this.goldbergData.faceYaxis){a.faceYaxis=[];for(const l of this.goldbergData.faceYaxis)a.faceYaxis.push(l.Bc())}if(this.goldbergData.faceXaxis){a.faceXaxis=[];for(const l of this.goldbergData.faceXaxis)a.faceXaxis.push(l.Bc())}l.goldbergData=a}static Parse(l,a){const N=l.goldbergData;N.faceColors=N.faceColors.map((l=>y.Qc.Ma(l))),N.faceCenters=N.faceCenters.map((l=>U.ua.Ma(l))),N.faceZaxis=N.faceZaxis.map((l=>U.ua.Ma(l))),N.faceXaxis=N.faceXaxis.map((l=>U.ua.Ma(l))),N.faceYaxis=N.faceYaxis.map((l=>U.ua.Ma(l)));const c=new Kl(l.name,a);return c.goldbergData=N,c}}var Zl=N(12970);const wl={CreateBox:n.b,CreateTiledBox:B,CreateSphere:Y.b,CreateDisc:J.b,CreateIcoSphere:P,CreateRibbon:T,CreateCylinder:E,CreateTorus:b,CreateTorusKnot:I,CreateLineSystem:t.e,IT:t.h,CreateDashedLines:t.b,ExtrudeShape:i,ExtrudeShapeCustom:k,CreateLathe:j,CreateTiledPlane:u,hT:f.d,CreateGround:p.g,CreateTiledGround:p.i,CreateGroundFromHeightMap:p.e,CreatePolygon:O.d,ExtrudePolygon:O.f,CreateTube:R,CreatePolyhedron:r,CreateGeodesic:function(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=a.m||1;U!==Math.floor(U)&&(U=Math.floor(U),g.b.Warn("m not an integer only floor(m) used"));let c=a.n||0;if(c!==Math.floor(c)&&(c=Math.floor(c),g.b.Warn("n not an integer only floor(n) used")),c>U){const l=c;c=U,U=l,g.b.Warn("n > m therefore m and n swapped")}const K=new Nl;return K.build(U,c),r(l,{custom:cl.BuildGeodesicData(K),size:a.size,sizeX:a.sizeX,sizeY:a.sizeY,sizeZ:a.sizeZ,faceUV:a.faceUV,faceColors:a.faceColors,flat:a.flat,updatable:a.updatable,sideOrientation:a.sideOrientation,frontUVs:a.frontUVs,backUVs:a.backUVs},N)},CreateGoldberg:function(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=a.size,S=a.sizeX||K||1,T=a.sizeY||K||1,J=a.sizeZ||K||1;let n=a.m||1;n!==Math.floor(n)&&(n=Math.floor(n),g.b.Warn("m not an integer only floor(m) used"));let H=a.n||0;if(H!==Math.floor(H)&&(H=Math.floor(H),g.b.Warn("n not an integer only floor(n) used")),H>n){const l=H;H=n,n=l,g.b.Warn("n > m therefore m and n swapped")}const u=new Nl;u.build(n,H);const W=cl.BuildGeodesicData(u),B=W.toGoldbergPolyhedronData(),Y=new Kl(l,N);a.sideOrientation=c.d._GetDefaultSideOrientation(a.sideOrientation),Y._originalBuilderSideOrientation=a.sideOrientation;(function(l,a){const N=l.size,c=l.sizeX||N||1,K=l.sizeY||N||1,S=l.sizeZ||N||1,T=0===l.sideOrientation?0:l.sideOrientation||Z.b.DEFAULTSIDE,J=[],n=[],y=[],H=[];let u=1/0,W=-1/0,B=1/0,Y=-1/0;for(let U=0;U<a.vertex.length;U++)u=Math.min(u,a.vertex[U][0]*c),W=Math.max(W,a.vertex[U][0]*c),B=Math.min(B,a.vertex[U][1]*K),Y=Math.max(Y,a.vertex[U][1]*K);let C=0;for(let Z=0;Z<a.face.length;Z++){const l=a.face[Z],N=U.ua.Ma(a.vertex[l[0]]),T=U.ua.Ma(a.vertex[l[2]]),M=U.ua.Ma(a.vertex[l[1]]),A=T.Wa(N),E=M.Wa(N),q=U.ua.Cross(E,A).normalize();for(let U=0;U<l.length;U++){y.push(q.x,q.y,q.z);const N=a.vertex[l[U]];J.push(N[0]*c,N[1]*K,N[2]*S);const Z=(N[1]*K-B)/(Y-B);H.push((N[0]*c-u)/(W-u),w.b?1-Z:Z)}for(let a=0;a<l.length-2;a++)n.push(C,C+a+2,C+a+1);C+=l.length}Z.b._ComputeSides(T,J,n,y,H);const M=new Z.b;return M.Il=J,M.indices=n,M.tl=y,M.hl=H,M})(a,B).kl(Y,a.updatable),Y.goldbergData.nbSharedFaces=W.sharedNodes,Y.goldbergData.nbUnsharedFaces=W.poleNodes,Y.goldbergData.adjacentFaces=W.adjacentFaces,Y.goldbergData.nbFaces=Y.goldbergData.nbSharedFaces+Y.goldbergData.nbUnsharedFaces,Y.goldbergData.nbFacesAtPole=(Y.goldbergData.nbUnsharedFaces-12)/12;for(let c=0;c<W.vertex.length;c++)Y.goldbergData.faceCenters.push(U.ua.Ma(W.vertex[c])),Y.goldbergData.faceCenters[c].x*=S,Y.goldbergData.faceCenters[c].y*=T,Y.goldbergData.faceCenters[c].z*=J,Y.goldbergData.faceColors.push(new y.Qc(1,1,1,1));for(let c=0;c<B.face.length;c++){const l=B.face[c],a=U.ua.Ma(B.vertex[l[0]]),N=U.ua.Ma(B.vertex[l[2]]),K=U.ua.Ma(B.vertex[l[1]]),Z=N.Wa(a),w=K.Wa(a),S=U.ua.Cross(w,Z).normalize(),T=U.ua.Cross(w,S).normalize();Y.goldbergData.faceXaxis.push(w.normalize()),Y.goldbergData.faceYaxis.push(S),Y.goldbergData.faceZaxis.push(T)}return Y},CreateDecal:V,CreateCapsule:v,CreateText:Zl.i}},13723:(l,a,N)=>{"use strict";N.d(a,{e:()=>wa});var U=N(12447),c=N(12825);class K extends c.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Z=N(12479),w=(N(12601),N(12394));class S{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(l){this._targetStopDuration!==l&&(this._targetStopDuration=l)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(l){this._noiseTexture!==l&&(this._noiseTexture=l,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(l){this._animationSheetEnabled!==l&&(this._animationSheetEnabled=l)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(l){this._isAnimationSheetEnabled!=l&&(this._isAnimationSheetEnabled=l,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(l){this._useLogarithmicDepth=l&&this.bl().getEngine().getCaps().fragmentDepthSupported}bl(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(l){switch(l){case S.BLENDMODE_MULTIPLYADD:return;case S.BLENDMODE_ADD:l=1;break;case S.BLENDMODE_ONEONE:l=6;break;case S.BLENDMODE_STANDARD:l=2;break;case S.BLENDMODE_MULTIPLY:l=4;break;case S.BLENDMODE_SUBTRACT:l=3}this._engine.setAlphaMode(l)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:U.ua.Zero()}set direction1(l){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=l)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:U.ua.Zero()}set direction2(l){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=l)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:U.ua.Zero()}set minEmitBox(l){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=l)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:U.ua.Zero()}set maxEmitBox(l){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=l)}get billboardMode(){return this._billboardMode}set billboardMode(l){this._billboardMode!==l&&(this._billboardMode=l,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(l){this._isBillboardBased!==l&&(this._isBillboardBased=l,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(l){this._attachImageProcessingConfiguration(l)}_attachImageProcessingConfiguration(l){l!==this._imageProcessingConfiguration&&(!l&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=l)}_reset(){}_removeGradientAndTexture(l,a,N){if(!a)return this;let U=0;for(const c of a){if(c.gradient===l){a.splice(U,1);break}U++}return N&&N.dispose(),this}constructor(l){this.animations=[],this.renderingGroupId=0,this.Ua=U.ua.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new U.ua(10,10,10),this.onAnimationEnd=null,this.blendMode=S.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new U.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.qT=new U.ua(0,0,0),this._useLogarithmicDepth=!1,this.gravity=U.ua.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Z.Qc(1,1,1,1),this.color2=new Z.Qc(1,1,1,1),this.colorDead=new Z.Qc(0,0,0,1),this.textureMask=new Z.Qc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new K,this.id=l,this.name=l}createPointEmitter(l,a){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new U.ua(0,1,0),arguments.length>2&&void 0!==arguments[2]||new U.ua(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new U.ua(0,1,0),arguments.length>4&&void 0!==arguments[4]||new U.ua(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new U.ua(0,1,0),arguments.length>3&&void 0!==arguments[3]||new U.ua(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(l,a,N,U){throw new Error("Method not implemented.")}}S.BLENDMODE_ONEONE=0,S.BLENDMODE_STANDARD=1,S.BLENDMODE_ADD=2,S.BLENDMODE_MULTIPLY=3,S.BLENDMODE_MULTIPLYADD=4,S.BLENDMODE_SUBTRACT=-1,(0,w.g)("BABYLON.BaseParticleSystem",S);var T=N(12461),J=N(12274);class n{constructor(){this.direction1=new U.ua(0,1,0),this.direction2=new U.ua(0,1,0),this.minEmitBox=new U.ua(-.5,-.5,-.5),this.maxEmitBox=new U.ua(.5,.5,.5)}startDirectionFunction(l,a,N,c){const K=(0,T.RandomRange)(this.direction1.x,this.direction2.x),Z=(0,T.RandomRange)(this.direction1.y,this.direction2.y),w=(0,T.RandomRange)(this.direction1.z,this.direction2.z);if(c)return a.x=K,a.y=Z,void(a.z=w);U.ua.TransformNormalFromFloatsToRef(K,Z,w,l,a)}startPositionFunction(l,a,N,c){const K=(0,T.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Z=(0,T.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),w=(0,T.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(c)return a.x=K,a.y=Z,void(a.z=w);U.ua.TransformCoordinatesFromFloatsToRef(K,Z,w,l,a)}clone(){const l=new n;return J.b.DeepCopy(this,l),l}applyToShader(l){l.setVector3("direction1",this.direction1),l.setVector3("direction2",this.direction2),l.setVector3("minEmitBox",this.minEmitBox),l.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(l){l.addUniform("direction1",3),l.addUniform("direction2",3),l.addUniform("minEmitBox",3),l.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const l={};return l.type=this.getClassName(),l.direction1=this.direction1.Bc(),l.direction2=this.direction2.Bc(),l.minEmitBox=this.minEmitBox.Bc(),l.maxEmitBox=this.maxEmitBox.Bc(),l}parse(l){U.ua.FromArrayToRef(l.direction1,0,this.direction1),U.ua.FromArrayToRef(l.direction2,0,this.direction2),U.ua.FromArrayToRef(l.minEmitBox,0,this.minEmitBox),U.ua.FromArrayToRef(l.maxEmitBox,0,this.maxEmitBox)}}class y{get radius(){return this._radius}set radius(l){this._radius=l,this._buildHeight()}get angle(){return this._angle}set angle(l){this._angle=l,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=N,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=a,this.radius=l}startDirectionFunction(l,a,N,c){c?U.TmpVectors.ua[0].K(N.NS).normalize():N.position.subtractToRef(l.getTranslation(),U.TmpVectors.ua[0]).normalize();const K=(0,T.RandomRange)(0,this.directionRandomizer),Z=(0,T.RandomRange)(0,this.directionRandomizer),w=(0,T.RandomRange)(0,this.directionRandomizer);a.x=U.TmpVectors.ua[0].x+K,a.y=U.TmpVectors.ua[0].y+Z,a.z=U.TmpVectors.ua[0].z+w,a.normalize()}startPositionFunction(l,a,N,c){const K=(0,T.RandomRange)(0,2*Math.PI);let Z;this.emitFromSpawnPointOnly?Z=1e-4:(Z=(0,T.RandomRange)(0,this.heightRange),Z=1-Z*Z);let w=this._radius-(0,T.RandomRange)(0,this._radius*this.radiusRange);w*=Z;const S=w*Math.sin(K),J=w*Math.cos(K),n=Z*this._height;if(c)return a.x=S,a.y=n,void(a.z=J);U.ua.TransformCoordinatesFromFloatsToRef(S,n,J,l,a)}clone(){const l=new y(this._radius,this._angle,this.directionRandomizer);return J.b.DeepCopy(this,l),l}applyToShader(l){l.setFloat2("radius",this._radius,this.radiusRange),l.setFloat("coneAngle",this._angle),l.setFloat2("height",this._height,this.heightRange),l.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(l){l.addUniform("radius",2),l.addUniform("coneAngle",1),l.addUniform("height",2),l.addUniform("directionRandomizer",1)}getEffectDefines(){let l="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(l+="\n#define CONEEMITTERSPAWNPOINT"),l}getClassName(){return"ConeParticleEmitter"}serialize(){const l={};return l.type=this.getClassName(),l.radius=this._radius,l.angle=this._angle,l.directionRandomizer=this.directionRandomizer,l.radiusRange=this.radiusRange,l.heightRange=this.heightRange,l.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,l}parse(l){this.radius=l.radius,this.angle=l.angle,this.directionRandomizer=l.directionRandomizer,this.radiusRange=void 0!==l.radiusRange?l.radiusRange:1,this.heightRange=void 0!==l.radiusRange?l.heightRange:1,this.emitFromSpawnPointOnly=void 0!==l.emitFromSpawnPointOnly&&l.emitFromSpawnPointOnly}}class H extends y{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new U.ua(0,1,0),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new U.ua(0,1,0);super(l,a),this.direction1=N,this.direction2=c}startDirectionFunction(l,a){const N=(0,T.RandomRange)(this.direction1.x,this.direction2.x),c=(0,T.RandomRange)(this.direction1.y,this.direction2.y),K=(0,T.RandomRange)(this.direction1.z,this.direction2.z);U.ua.TransformNormalFromFloatsToRef(N,c,K,l,a)}clone(){const l=new H(this.radius,this.angle,this.direction1,this.direction2);return J.b.DeepCopy(this,l),l}applyToShader(l){l.setFloat("radius",this.radius),l.setFloat("radiusRange",this.radiusRange),l.setVector3("direction1",this.direction1),l.setVector3("direction2",this.direction2)}buildUniformLayout(l){l.addUniform("radius",1),l.addUniform("radiusRange",1),l.addUniform("direction1",3),l.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const l=super.serialize();return l.direction1=this.direction1.Bc(),l.direction2=this.direction2.Bc(),l}parse(l){super.parse(l),this.direction1.K(l.direction1),this.direction2.K(l.direction2)}}class u{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=l,this.height=a,this.radiusRange=N,this.directionRandomizer=c,this._tempVector=U.ua.Zero()}startDirectionFunction(l,a,N,c,K){N.position.subtractToRef(l.getTranslation(),this._tempVector),this._tempVector.normalize(),U.ua.TransformNormalToRef(this._tempVector,K,this._tempVector);const Z=(0,T.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let w=Math.atan2(this._tempVector.x,this._tempVector.z);w+=(0,T.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Z,this._tempVector.x=Math.sin(w),this._tempVector.z=Math.cos(w),this._tempVector.normalize(),c?a.K(this._tempVector):U.ua.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,l,a)}startPositionFunction(l,a,N,c){const K=(0,T.RandomRange)(-this.height/2,this.height/2),Z=(0,T.RandomRange)(0,2*Math.PI),w=(0,T.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),S=Math.sqrt(w)*this.radius,J=S*Math.cos(Z),n=S*Math.sin(Z);c?a.tc(J,K,n):U.ua.TransformCoordinatesFromFloatsToRef(J,K,n,l,a)}clone(){const l=new u(this.radius,this.directionRandomizer);return J.b.DeepCopy(this,l),l}applyToShader(l){l.setFloat("radius",this.radius),l.setFloat("height",this.height),l.setFloat("radiusRange",this.radiusRange),l.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(l){l.addUniform("radius",1),l.addUniform("height",1),l.addUniform("radiusRange",1),l.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const l={};return l.type=this.getClassName(),l.radius=this.radius,l.height=this.height,l.radiusRange=this.radiusRange,l.directionRandomizer=this.directionRandomizer,l}parse(l){this.radius=l.radius,this.height=l.height,this.radiusRange=l.radiusRange,this.directionRandomizer=l.directionRandomizer}}class W extends u{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new U.ua(0,1,0),K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new U.ua(0,1,0);super(l,a,N),this.direction1=c,this.direction2=K}startDirectionFunction(l,a,N,c){const K=(0,T.RandomRange)(this.direction1.x,this.direction2.x),Z=(0,T.RandomRange)(this.direction1.y,this.direction2.y),w=(0,T.RandomRange)(this.direction1.z,this.direction2.z);c?a.tc(K,Z,w):U.ua.TransformNormalFromFloatsToRef(K,Z,w,l,a)}clone(){const l=new W(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return J.b.DeepCopy(this,l),l}applyToShader(l){l.setFloat("radius",this.radius),l.setFloat("height",this.height),l.setFloat("radiusRange",this.radiusRange),l.setVector3("direction1",this.direction1),l.setVector3("direction2",this.direction2)}buildUniformLayout(l){l.addUniform("radius",1),l.addUniform("height",1),l.addUniform("radiusRange",1),l.addUniform("direction1",3),l.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const l=super.serialize();return l.direction1=this.direction1.Bc(),l.direction2=this.direction2.Bc(),l}parse(l){super.parse(l),U.ua.FromArrayToRef(l.direction1,0,this.direction1),U.ua.FromArrayToRef(l.direction2,0,this.direction2)}}class B{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=l,this.radiusRange=a,this.directionRandomizer=N}startDirectionFunction(l,a,N,c){const K=N.position.Wa(l.getTranslation()).normalize(),Z=(0,T.RandomRange)(0,this.directionRandomizer),w=(0,T.RandomRange)(0,this.directionRandomizer),S=(0,T.RandomRange)(0,this.directionRandomizer);K.x+=Z,K.y+=w,K.z+=S,K.normalize(),c?a.K(K):U.ua.TransformNormalFromFloatsToRef(K.x,K.y,K.z,l,a)}startPositionFunction(l,a,N,c){const K=this.radius-(0,T.RandomRange)(0,this.radius*this.radiusRange),Z=(0,T.RandomRange)(0,1),w=(0,T.RandomRange)(0,2*Math.PI),S=Math.acos(2*Z-1),J=K*Math.cos(w)*Math.sin(S),n=K*Math.cos(S),y=K*Math.sin(w)*Math.sin(S);c?a.tc(J,Math.abs(n),y):U.ua.TransformCoordinatesFromFloatsToRef(J,Math.abs(n),y,l,a)}clone(){const l=new B(this.radius,this.directionRandomizer);return J.b.DeepCopy(this,l),l}applyToShader(l){l.setFloat("radius",this.radius),l.setFloat("radiusRange",this.radiusRange),l.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(l){l.addUniform("radius",1),l.addUniform("radiusRange",1),l.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const l={};return l.type=this.getClassName(),l.radius=this.radius,l.radiusRange=this.radiusRange,l.directionRandomizer=this.directionRandomizer,l}parse(l){this.radius=l.radius,this.radiusRange=l.radiusRange,this.directionRandomizer=l.directionRandomizer}}class Y{constructor(){this.direction1=new U.ua(0,1,0),this.direction2=new U.ua(0,1,0)}startDirectionFunction(l,a,N,c){const K=(0,T.RandomRange)(this.direction1.x,this.direction2.x),Z=(0,T.RandomRange)(this.direction1.y,this.direction2.y),w=(0,T.RandomRange)(this.direction1.z,this.direction2.z);c?a.tc(K,Z,w):U.ua.TransformNormalFromFloatsToRef(K,Z,w,l,a)}startPositionFunction(l,a,N,c){c?a.tc(0,0,0):U.ua.TransformCoordinatesFromFloatsToRef(0,0,0,l,a)}clone(){const l=new Y;return J.b.DeepCopy(this,l),l}applyToShader(l){l.setVector3("direction1",this.direction1),l.setVector3("direction2",this.direction2)}buildUniformLayout(l){l.addUniform("direction1",3),l.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const l={};return l.type=this.getClassName(),l.direction1=this.direction1.Bc(),l.direction2=this.direction2.Bc(),l}parse(l){U.ua.FromArrayToRef(l.direction1,0,this.direction1),U.ua.FromArrayToRef(l.direction2,0,this.direction2)}}class C{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=l,this.radiusRange=a,this.directionRandomizer=N}startDirectionFunction(l,a,N,c){const K=N.position.Wa(l.getTranslation()).normalize(),Z=(0,T.RandomRange)(0,this.directionRandomizer),w=(0,T.RandomRange)(0,this.directionRandomizer),S=(0,T.RandomRange)(0,this.directionRandomizer);K.x+=Z,K.y+=w,K.z+=S,K.normalize(),c?a.K(K):U.ua.TransformNormalFromFloatsToRef(K.x,K.y,K.z,l,a)}startPositionFunction(l,a,N,c){const K=this.radius-(0,T.RandomRange)(0,this.radius*this.radiusRange),Z=(0,T.RandomRange)(0,1),w=(0,T.RandomRange)(0,2*Math.PI),S=Math.acos(2*Z-1),J=K*Math.cos(w)*Math.sin(S),n=K*Math.cos(S),y=K*Math.sin(w)*Math.sin(S);c?a.tc(J,n,y):U.ua.TransformCoordinatesFromFloatsToRef(J,n,y,l,a)}clone(){const l=new C(this.radius,this.directionRandomizer);return J.b.DeepCopy(this,l),l}applyToShader(l){l.setFloat("radius",this.radius),l.setFloat("radiusRange",this.radiusRange),l.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(l){l.addUniform("radius",1),l.addUniform("radiusRange",1),l.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const l={};return l.type=this.getClassName(),l.radius=this.radius,l.radiusRange=this.radiusRange,l.directionRandomizer=this.directionRandomizer,l}parse(l){this.radius=l.radius,this.radiusRange=l.radiusRange,this.directionRandomizer=l.directionRandomizer}}class M extends C{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new U.ua(0,1,0),N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new U.ua(0,1,0);super(l),this.direction1=a,this.direction2=N}startDirectionFunction(l,a){const N=(0,T.RandomRange)(this.direction1.x,this.direction2.x),c=(0,T.RandomRange)(this.direction1.y,this.direction2.y),K=(0,T.RandomRange)(this.direction1.z,this.direction2.z);U.ua.TransformNormalFromFloatsToRef(N,c,K,l,a)}clone(){const l=new M(this.radius,this.direction1,this.direction2);return J.b.DeepCopy(this,l),l}applyToShader(l){l.setFloat("radius",this.radius),l.setFloat("radiusRange",this.radiusRange),l.setVector3("direction1",this.direction1),l.setVector3("direction2",this.direction2)}buildUniformLayout(l){l.addUniform("radius",1),l.addUniform("radiusRange",1),l.addUniform("direction1",3),l.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const l=super.serialize();return l.direction1=this.direction1.Bc(),l.direction2=this.direction2.Bc(),l}parse(l){super.parse(l),this.direction1.K(l.direction1),this.direction2.K(l.direction2)}}class A{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(l,a,N,c){const K=U.TmpVectors.ua[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,N,K);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,N,K);const l=U.TmpVectors.ua[1];K.subtractToRef(N.position,l),l.scaleToRef(1/N.lifeTime,K)}else K.set(0,0,0);c?a.K(K):U.ua.TransformNormalToRef(K,l,a)}startPositionFunction(l,a,N,c){const K=U.TmpVectors.ua[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,N,K):K.set(0,0,0),c?a.K(K):U.ua.TransformCoordinatesToRef(K,l,a)}clone(){const l=new A;return J.b.DeepCopy(this,l),l}applyToShader(l){}buildUniformLayout(l){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const l={};return l.type=this.getClassName(),l.particlePositionGenerator=this.particlePositionGenerator,l.particleDestinationGenerator=this.particleDestinationGenerator,l}parse(l){l.particlePositionGenerator&&(this.particlePositionGenerator=l.particlePositionGenerator),l.particleDestinationGenerator&&(this.particleDestinationGenerator=l.particleDestinationGenerator)}}var E=N(12506);class q{get mesh(){return this._mesh}set mesh(l){this._mesh!==l&&(this._mesh=l,l?(this._indices=l.zc(),this._positions=l.getVerticesData(E.h.PositionKind),this._normals=l.getVerticesData(E.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=U.ua.Zero(),this._mesh=null,this.direction1=new U.ua(0,1,0),this.direction2=new U.ua(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=l}startDirectionFunction(l,a,N,c){if(this.useMeshNormalsForDirection&&this._normals)return void U.ua.TransformNormalToRef(this._storedNormal,l,a);const K=(0,T.RandomRange)(this.direction1.x,this.direction2.x),Z=(0,T.RandomRange)(this.direction1.y,this.direction2.y),w=(0,T.RandomRange)(this.direction1.z,this.direction2.z);c?a.tc(K,Z,w):U.ua.TransformNormalFromFloatsToRef(K,Z,w,l,a)}startPositionFunction(l,a,N,c){if(!this._indices||!this._positions)return;const K=3*(Math.random()*(this._indices.length/3)|0),Z=Math.random(),w=Math.random()*(1-Z),S=1-Z-w,T=this._indices[K],J=this._indices[K+1],n=this._indices[K+2],y=U.TmpVectors.ua[0],H=U.TmpVectors.ua[1],u=U.TmpVectors.ua[2],W=U.TmpVectors.ua[3];U.ua.FromArrayToRef(this._positions,3*T,y),U.ua.FromArrayToRef(this._positions,3*J,H),U.ua.FromArrayToRef(this._positions,3*n,u),W.x=Z*y.x+w*H.x+S*u.x,W.y=Z*y.y+w*H.y+S*u.y,W.z=Z*y.z+w*H.z+S*u.z,c?a.tc(W.x,W.y,W.z):U.ua.TransformCoordinatesFromFloatsToRef(W.x,W.y,W.z,l,a),this.useMeshNormalsForDirection&&this._normals&&(U.ua.FromArrayToRef(this._normals,3*T,y),U.ua.FromArrayToRef(this._normals,3*J,H),U.ua.FromArrayToRef(this._normals,3*n,u),this._storedNormal.x=Z*y.x+w*H.x+S*u.x,this._storedNormal.y=Z*y.y+w*H.y+S*u.y,this._storedNormal.z=Z*y.z+w*H.z+S*u.z)}clone(){const l=new q(this.mesh);return J.b.DeepCopy(this,l),l}applyToShader(l){l.setVector3("direction1",this.direction1),l.setVector3("direction2",this.direction2)}buildUniformLayout(l){l.addUniform("direction1",3),l.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var l;const a={};return a.type=this.getClassName(),a.direction1=this.direction1.Bc(),a.direction2=this.direction2.Bc(),a.meshId=null===(l=this.mesh)||void 0===l?void 0:l.id,a.useMeshNormalsForDirection=this.useMeshNormalsForDirection,a}parse(l,a){U.ua.FromArrayToRef(l.direction1,0,this.direction1),U.ua.FromArrayToRef(l.direction2,0,this.direction2),l.meshId&&a&&(this.mesh=a.getLastMeshById(l.meshId)),this.useMeshNormalsForDirection=l.useMeshNormalsForDirection}}class b{_isUbo(l){return void 0!==l.addUniform}constructor(l){this._isUbo(l)?(this.setMatrix3x3=l.updateMatrix3x3.bind(l),this.setMatrix2x2=l.updateMatrix2x2.bind(l),this.setFloat=l.updateFloat.bind(l),this.setFloat2=l.updateFloat2.bind(l),this.setFloat3=l.updateFloat3.bind(l),this.setFloat4=l.updateFloat4.bind(l),this.setFloatArray=l.updateFloatArray.bind(l),this.setArray=l.updateArray.bind(l),this.setIntArray=l.updateIntArray.bind(l),this.setMatrix=l.Ec.bind(l),this.setMatrices=l.updateMatrices.bind(l),this.setVector3=l.updateVector3.bind(l),this.setVector4=l.updateVector4.bind(l),this.setColor3=l.updateColor3.bind(l),this.setColor4=l.updateColor4.bind(l),this.setDirectColor4=l.updateDirectColor4.bind(l),this.setInt=l.updateInt.bind(l),this.setInt2=l.updateInt2.bind(l),this.setInt3=l.updateInt3.bind(l),this.setInt4=l.updateInt4.bind(l)):(this.setMatrix3x3=l.setMatrix3x3.bind(l),this.setMatrix2x2=l.setMatrix2x2.bind(l),this.setFloat=l.setFloat.bind(l),this.setFloat2=l.setFloat2.bind(l),this.setFloat3=l.setFloat3.bind(l),this.setFloat4=l.setFloat4.bind(l),this.setFloatArray=l.setFloatArray.bind(l),this.setArray=l.setArray.bind(l),this.setIntArray=l.setIntArray.bind(l),this.setMatrix=l.setMatrix.bind(l),this.setMatrices=l.setMatrices.bind(l),this.setVector3=l.setVector3.bind(l),this.setVector4=l.setVector4.bind(l),this.setColor3=l.setColor3.bind(l),this.setColor4=l.setColor4.bind(l),this.setDirectColor4=l.setDirectColor4.bind(l),this.setInt=l.setInt.bind(l),this.setInt2=l.setInt2.bind(l),this.setInt3=l.setInt3.bind(l),this.setInt4=l.setInt4.bind(l))}}var z=N(12350);const I="gpuUpdateParticlesPixelShader",t="#version 300 es\nvoid main() {discard;}\n";z.e.ShadersStore[I]||(z.e.ShadersStore[I]=t);const O="gpuUpdateParticlesVertexShader",h="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";z.e.ShadersStore[O]||(z.e.ShadersStore[O]=h);(0,w.g)("BABYLON.WebGL2ParticleSystem",class{constructor(l,a){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=l,this._engine=a,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var l;return(null===(l=this._updateEffect)||void 0===l?void 0:l.isReady())??!1}createUpdateBuffer(l){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof A&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=l,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new b(this._updateEffect)}createVertexBuffers(l,a){this._updateVAO.push(this._createUpdateVAO(l)),this._renderVAO.push(this._engine.recordVertexArrayObject(a,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=a}createParticleBuffer(l){return l}bindDrawBuffers(l,a,N){N?this._engine.bindBuffers(this._renderVertexBuffers,N,a):this._engine.bindVertexArrayObject(this._renderVAO[l],null)}preUpdateParticleBuffer(){const l=this._engine;if(this._engine.enableEffect(this._updateEffect),!l.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(l,a,N){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[l],null);const U=this._engine;U.bindTransformFeedbackBuffer(a.getBuffer()),U.setRasterizerState(!1),U.beginTransformFeedback(!0),U.drawArraysType(3,0,N),U.endTransformFeedback(),U.setRasterizerState(!0),U.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let l=0;l<this._updateVAO.length;l++)this._engine.releaseVertexArrayObject(this._updateVAO[l]);this._updateVAO.length=0;for(let l=0;l<this._renderVAO.length;l++)this._engine.releaseVertexArrayObject(this._renderVAO[l]);this._renderVAO.length=0}_createUpdateVAO(l){const a={};a.position=l.createVertexBuffer("position",0,3);let N=3;a.age=l.createVertexBuffer("age",N,1),N+=1,a.size=l.createVertexBuffer("size",N,3),N+=3,a.life=l.createVertexBuffer("life",N,1),N+=1,a.seed=l.createVertexBuffer("seed",N,4),N+=4,a.direction=l.createVertexBuffer("direction",N,3),N+=3,this._parent.particleEmitterType instanceof A&&(a.initialPosition=l.createVertexBuffer("initialPosition",N,3),N+=3),this._parent._colorGradientsTexture||(a.color=l.createVertexBuffer("color",N,4),N+=4),this._parent._isBillboardBased||(a.initialDirection=l.createVertexBuffer("initialDirection",N,3),N+=3),this._parent.noiseTexture&&(a.noiseCoordinates1=l.createVertexBuffer("noiseCoordinates1",N,3),N+=3,a.noiseCoordinates2=l.createVertexBuffer("noiseCoordinates2",N,3),N+=3),this._parent._angularSpeedGradientsTexture?(a.angle=l.createVertexBuffer("angle",N,1),N+=1):(a.angle=l.createVertexBuffer("angle",N,2),N+=2),this._parent._isAnimationSheetEnabled&&(a.cellIndex=l.createVertexBuffer("cellIndex",N,1),N+=1,this._parent.spriteRandomStartCell&&(a.cellStartOffset=l.createVertexBuffer("cellStartOffset",N,1),N+=1));const U=this._engine.recordVertexArrayObject(a,null,this._updateEffect);return this._engine.bindArrayBuffer(null),U}});class i{constructor(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,U=arguments.length>3?arguments[3]:void 0;this._engine=l,this._label=U,this._engine._storageBuffers.push(this),this._create(a,N)}_create(l,a){this._bufferSize=l,this._creationFlags=a,this._buffer=this._engine.createStorageBuffer(l,a,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(l,a,N){this._buffer&&this._engine.updateStorageBuffer(this._buffer,l,a,N)}async read(l,a,N,U){return await this._engine.readFromStorageBuffer(this._buffer,l,a,N,U)}dispose(){const l=this._engine._storageBuffers,a=l.indexOf(this);-1!==a&&(l[a]=l[l.length-1],l.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var k=N(12429),Q=N(12432),j=N(12471),f=N(12422),p=N(12727),R=N(12268),L=N(12381),r=N(12655);class X{constructor(){this._gpuTimeInFrameId=-1,this.counter=new r.e}_addDuration(l,a){l<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==l?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(a,!1),this._gpuTimeInFrameId=l):this.counter.addCount(a,!1))}}var P=N(12328);class d{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=l,this._engine=a,this.uniqueId=p.c.UniqueId,a.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new X),this._engine.getCaps().supportComputeShaders?U.bindingsMapping?(this._context=a.createComputeContext(),this._shaderPath=N,this._options={bindingsMapping:{},defines:[],...U}):R.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):R.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(l,a){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const U=this._bindings[l];this._bindings[l]={type:N?0:4,object:a,indexInGroupEntries:null===U||void 0===U?void 0:U.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!U||U.object!==a||U.type!==this._bindings[l].type)}setStorageTexture(l,a){const N=this._bindings[l];this._contextIsDirty||(this._contextIsDirty=!N||N.object!==a),this._bindings[l]={type:1,object:a,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}setExternalTexture(l,a){const N=this._bindings[l];this._contextIsDirty||(this._contextIsDirty=!N||N.object!==a),this._bindings[l]={type:6,object:a,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}setVideoTexture(l,a){return!!a.externalTexture&&(this.setExternalTexture(l,a.externalTexture),!0)}setUniformBuffer(l,a){const N=this._bindings[l];this._contextIsDirty||(this._contextIsDirty=!N||N.object!==a),this._bindings[l]={type:d._BufferIsDataBuffer(a)?7:2,object:a,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}setStorageBuffer(l,a){const N=this._bindings[l];this._contextIsDirty||(this._contextIsDirty=!N||N.object!==a),this._bindings[l]={type:d._BufferIsDataBuffer(a)?7:3,object:a,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}setTextureSampler(l,a){const N=this._bindings[l];this._contextIsDirty||(this._contextIsDirty=!N||!a.compareSampler(N.object)),this._bindings[l]={type:5,object:a,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}isReady(){let l=this._effect;for(const c in this._bindings){const l=this._bindings[c],a=l.type,N=l.object;switch(a){case 0:case 4:case 1:if(!N.isReady())return!1;break;case 6:if(!N.isReady())return!1;break}}const a=[],N=this._shaderPath;if(this._options.defines)for(let c=0;c<this._options.defines.length;c++)a.push(this._options.defines[c]);const U=a.join("\n");return this._cachedDefines!==U&&(this._cachedDefines=U,l=this._engine.createComputeEffect(N,{defines:U,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=l),!!l.isReady()}dispatch(l,a,N){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,l,a,N,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const N=d._BufferIsDataBuffer(l)?l:l.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,N,a,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const a in this._bindings){const N=this._bindings[a];if(!this._options.bindingsMapping[a])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+a+"'");switch(N.type){case 0:{const U=this._samplers[a],c=N.object;var l;if(!U||!c._texture||!U.compareSampler(c._texture))this._samplers[a]=(new L.e).setParameters(c.wrapU,c.wrapV,c.wrapR,c.anisotropicFilteringLevel,c._texture.samplingMode,null===(l=c._texture)||void 0===l?void 0:l._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const l=N.object;l.getBuffer()!==N.buffer&&(N.buffer=l.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((c=>{(0,P.d)((()=>this.dispatch(l,a,N)),c,void 0,U)}))}serialize(){const l=j.c.Serialize(this);l.options=this._options,l.shaderPath=this._shaderPath,l.Wy={},l.textures={};for(const a in this._bindings){const N=this._bindings[a],U=N.object;switch(N.type){case 0:case 4:case 1:{const c=U.serialize();c&&(l.textures[a]=c,l.Wy[a]={type:N.type});break}}}return l}static Parse(l,a,N){const U=j.c.Parse((()=>new d(l.name,a.getEngine(),l.shaderPath,l.options)),l,a,N);for(const c in l.textures){const K=l.Wy[c],Z=f.e.Parse(l.textures[c],a,N);0===K.type?U.setTexture(c,Z):4===K.type?U.setTexture(c,Z,!1):U.setStorageTexture(c,Z)}return U}static _BufferIsDataBuffer(l){return void 0!==l.underlyingResource}}(0,k.d)([(0,Q.K)()],d.prototype,"name",void 0),(0,k.d)([(0,Q.K)()],d.prototype,"fastMode",void 0),(0,w.g)("BABYLON.ComputeShader",d);var F=N(12697);const e="gpuUpdateParticlesComputeShader",s="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";z.e.ShadersStoreWGSL[e]||(z.e.ShadersStoreWGSL[e]=s);(0,w.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(l,a){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=l,this._engine=a}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var l;return(null===(l=this._updateComputeShader)||void 0===l?void 0:l.isReady())??!1}createUpdateBuffer(l){var a;const N={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(N.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(N.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(N.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(N.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(N.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(N.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(N.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new d("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:N,defines:l.split("\n")}),null===(a=this._simParamsComputeShader)||void 0===a||a.dispose(),this._simParamsComputeShader=new F.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new b(this._simParamsComputeShader)}createVertexBuffers(l,a){this._renderVertexBuffers.push(a)}createParticleBuffer(l){const a=new i(this._engine,4*l.length,11,"ComputeShaderParticleSystemBuffer");return a.update(l),this._bufferComputeShader.push(a),a.getBuffer()}bindDrawBuffers(l,a,N){this._engine.bindBuffers(this._renderVertexBuffers[l],N,a)}preUpdateParticleBuffer(){}updateParticleBuffer(l,a,N){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[l]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^l]),this._updateComputeShader.dispatch(Math.ceil(N/64))}releaseBuffers(){var l;for(let a=0;a<this._bufferComputeShader.length;++a)this._bufferComputeShader[a].dispose();this._bufferComputeShader.length=0,null===(l=this._simParamsComputeShader)||void 0===l||l.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class o{constructor(l,a,N){this.gradient=l,this.color1=a,this.color2=N}getColorToRef(l){this.color2?Z.Qc.LerpToRef(this.color1,this.color2,Math.random(),l):l.K(this.color1)}}class G{constructor(l,a){this.gradient=l,this.color=a}}class ml{constructor(l,a,N){this.gradient=l,this.factor1=a,this.factor2=N}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class x{static GetCurrentGradient(l,a,N){if(a[0].gradient>l)return void N(a[0],a[0],1);for(let c=0;c<a.length-1;c++){const U=a[c],K=a[c+1];if(l>=U.gradient&&l<=K.gradient){return void N(U,K,(l-U.gradient)/(K.gradient-U.gradient))}}const U=a.length-1;N(a[U],a[U],1)}}var V=N(12260),D=N(12903),v=N(12296);class g{constructor(l){this.particleSystem=l,this.position=U.ua.Zero(),this.direction=U.ua.Zero(),this.color=new Z.Qc(0,0,0,0),this.colorStep=new Z.Qc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new U.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Z.Qc(0,0,0,0),this._currentColor2=new Z.Qc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=g._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let l=this.age,a=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===a?(a=1,l=this._randomCellOffset):l+=this._randomCellOffset);const N=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let U;U=this._initialSpriteCellLoop?(0,T.Clamp)(l*a%this.lifeTime/this.lifeTime):(0,T.Clamp)(l*a/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+U*N|0}_inheritParticleInfoToSubEmitter(l){if(l.particleSystem.Ua.position){const a=l.particleSystem.Ua;if(a.position.K(this.position),l.inheritDirection){const l=U.TmpVectors.ua[0];this.direction.normalizeToRef(l),a.setDirection(l,0,Math.PI/2)}}else{l.particleSystem.Ua.K(this.position)}this.direction.scaleToRef(l.inheritedVelocityAmount/2,U.TmpVectors.ua[0]),l.particleSystem._inheritedVelocityOffset.K(U.TmpVectors.ua[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const l of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(l)}_reset(){this.age=0,this.id=g._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(l){l.position.K(this.position),this._initialDirection?l._initialDirection?l._initialDirection.K(this._initialDirection):l._initialDirection=this._initialDirection.clone():l._initialDirection=null,l.direction.K(this.direction),this.NS&&(l.NS?l.NS.K(this.NS):l.NS=this.NS.clone()),l.color.K(this.color),l.colorStep.K(this.colorStep),l.lifeTime=this.lifeTime,l.age=this.age,l._randomCellOffset=this._randomCellOffset,l.size=this.size,l.scale.K(this.scale),l.angle=this.angle,l.angularSpeed=this.angularSpeed,l.particleSystem=this.particleSystem,l.cellIndex=this.cellIndex,l.id=this.id,l._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(l._currentColorGradient=this._currentColorGradient,l._currentColor1.K(this._currentColor1),l._currentColor2.K(this._currentColor2)),this._currentSizeGradient&&(l._currentSizeGradient=this._currentSizeGradient,l._currentSize1=this._currentSize1,l._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(l._currentAngularSpeedGradient=this._currentAngularSpeedGradient,l._currentAngularSpeed1=this._currentAngularSpeed1,l._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(l._currentVelocityGradient=this._currentVelocityGradient,l._currentVelocity1=this._currentVelocity1,l._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(l._currentLimitVelocityGradient=this._currentLimitVelocityGradient,l._currentLimitVelocity1=this._currentLimitVelocity1,l._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(l._currentDragGradient=this._currentDragGradient,l._currentDrag1=this._currentDrag1,l._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(l._initialStartSpriteCellId=this._initialStartSpriteCellId,l._initialEndSpriteCellId=this._initialEndSpriteCellId,l._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(l.remapData&&this.remapData?l.remapData.K(this.remapData):l.remapData=new U.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(l._randomNoiseCoordinates1?(l._randomNoiseCoordinates1.K(this._randomNoiseCoordinates1),l._randomNoiseCoordinates2.K(this._randomNoiseCoordinates2)):(l._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),l._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}g._Count=0;var ll=N(12548),al=(N(12598),N(12804)),Nl=N(12798),Ul=N(12689);function cl(l,a){const N=(0,T.RandomRange)(0,1);Z.Qc.LerpToRef(a.color1,a.color2,N,l.color),a.colorDead.subtractToRef(l.color,a._colorDiff),a._colorDiff.scaleToRef(1/l.lifeTime,l.colorStep)}function Kl(l,a){l._currentColorGradient=a._colorGradients[0],l._currentColorGradient.getColorToRef(l.color),l._currentColor1.K(l.color),a._colorGradients.length>1?a._colorGradients[1].getColorToRef(l._currentColor2):l._currentColor2.K(l.color)}function Zl(l,a){const N=a._colorGradients;x.GetCurrentGradient(a._ratio,N,((a,N,U)=>{a!==l._currentColorGradient&&(l._currentColor1.K(l._currentColor2),N.getColorToRef(l._currentColor2),l._currentColorGradient=a),Z.Qc.LerpToRef(l._currentColor1,l._currentColor2,U,l.color)}))}function wl(l,a){l.colorStep.scaleToRef(a._scaledUpdateSpeed,a._scaledColorStep),l.color.addInPlace(a._scaledColorStep),l.color.a<0&&(l.color.a=0)}function Sl(l,a){x.GetCurrentGradient(a._ratio,a._angularSpeedGradients,((a,N,U)=>{a!==l._currentAngularSpeedGradient&&(l._currentAngularSpeed1=l._currentAngularSpeed2,l._currentAngularSpeed2=N.getFactor(),l._currentAngularSpeedGradient=a),l.angularSpeed=(0,T.Lerp)(l._currentAngularSpeed1,l._currentAngularSpeed2,U)}))}function Tl(l,a){l.angle+=l.angularSpeed*a._scaledUpdateSpeed}function Jl(l,a){a.particleEmitterType.startDirectionFunction(a._emitterWorldMatrix,l.direction,l,a.isLocal,a._emitterInverseWorldMatrix)}function nl(l,a){a.startDirectionFunction(a._emitterWorldMatrix,l.direction,l,a.isLocal)}function yl(l,a){l._currentVelocityGradient=a._velocityGradients[0],l._currentVelocity1=l._currentVelocityGradient.getFactor(),a._velocityGradients.length>1?l._currentVelocity2=a._velocityGradients[1].getFactor():l._currentVelocity2=l._currentVelocity1}function Hl(l,a){l._currentLimitVelocityGradient=a._limitVelocityGradients[0],l._currentLimitVelocity1=l._currentLimitVelocityGradient.getFactor(),a._limitVelocityGradients.length>1?l._currentLimitVelocity2=a._limitVelocityGradients[1].getFactor():l._currentLimitVelocity2=l._currentLimitVelocity1}function ul(l,a){x.GetCurrentGradient(a._ratio,a._velocityGradients,((N,U,c)=>{N!==l._currentVelocityGradient&&(l._currentVelocity1=l._currentVelocity2,l._currentVelocity2=U.getFactor(),l._currentVelocityGradient=N),a._directionScale*=(0,T.Lerp)(l._currentVelocity1,l._currentVelocity2,c)}))}function Wl(l,a){x.GetCurrentGradient(a._ratio,a._limitVelocityGradients,((N,U,c)=>{N!==l._currentLimitVelocityGradient&&(l._currentLimitVelocity1=l._currentLimitVelocity2,l._currentLimitVelocity2=U.getFactor(),l._currentLimitVelocityGradient=N);const K=(0,T.Lerp)(l._currentLimitVelocity1,l._currentLimitVelocity2,c);l.direction.length()>K&&l.direction.scaleInPlace(a.limitVelocityDamping)}))}function Bl(l,a){l.direction.scaleToRef(a._directionScale,a._scaledDirection)}function Yl(l,a){a.particleEmitterType.startPositionFunction(a._emitterWorldMatrix,l.position,l,a.isLocal)}function Cl(l,a){a.startPositionFunction(a._emitterWorldMatrix,l.position,l,a.isLocal)}function Ml(l,a){l.NS?l.NS.K(l.position):l.NS=l.position.clone(),U.ua.TransformCoordinatesToRef(l.NS,a._emitterWorldMatrix,l.position)}function Al(l,a){a.isLocal&&l.NS?(l.NS.addInPlace(a._scaledDirection),U.ua.TransformCoordinatesToRef(l.NS,a._emitterWorldMatrix,l.position)):l.position.addInPlace(a._scaledDirection)}function El(l,a){l._currentDragGradient=a._dragGradients[0],l._currentDrag1=l._currentDragGradient.getFactor(),a._dragGradients.length>1?l._currentDrag2=a._dragGradients[1].getFactor():l._currentDrag2=l._currentDrag1}function ql(l,a){x.GetCurrentGradient(a._ratio,a._dragGradients,((N,U,c)=>{N!==l._currentDragGradient&&(l._currentDrag1=l._currentDrag2,l._currentDrag2=U.getFactor(),l._currentDragGradient=N);const K=(0,T.Lerp)(l._currentDrag1,l._currentDrag2,c);a._scaledDirection.scaleInPlace(1-K)}))}function bl(l,a){l._randomNoiseCoordinates1?(l._randomNoiseCoordinates1.tc(Math.random(),Math.random(),Math.random()),l._randomNoiseCoordinates2.tc(Math.random(),Math.random(),Math.random())):(l._randomNoiseCoordinates1=new U.ua(Math.random(),Math.random(),Math.random()),l._randomNoiseCoordinates2=new U.ua(Math.random(),Math.random(),Math.random()))}function zl(l,a){const N=a._noiseTextureData,c=a._noiseTextureSize;if(N&&c&&l._randomNoiseCoordinates1){const K=a._fetchR(l._randomNoiseCoordinates1.x,l._randomNoiseCoordinates1.y,c.width,c.height,N),Z=a._fetchR(l._randomNoiseCoordinates1.z,l._randomNoiseCoordinates2.x,c.width,c.height,N),w=a._fetchR(l._randomNoiseCoordinates2.y,l._randomNoiseCoordinates2.z,c.width,c.height,N),S=U.TmpVectors.ua[0],T=U.TmpVectors.ua[1];S.tc((2*K-1)*a.noiseStrength.x,(2*Z-1)*a.noiseStrength.y,(2*w-1)*a.noiseStrength.z),S.scaleToRef(a._tempScaledUpdateSpeed,T),l.direction.addInPlace(T)}}function Il(l,a){a.gravity.scaleToRef(a._tempScaledUpdateSpeed,a._scaledGravity),l.direction.addInPlace(a._scaledGravity)}function tl(l,a){l.size=(0,T.RandomRange)(a.minSize,a.maxSize),l.scale.tc((0,T.RandomRange)(a.minScaleX,a.maxScaleX),(0,T.RandomRange)(a.minScaleY,a.maxScaleY))}function Ol(l,a){l._currentSizeGradient=a._sizeGradients[0],l._currentSize1=l._currentSizeGradient.getFactor(),l.size=l._currentSize1,a._sizeGradients.length>1?l._currentSize2=a._sizeGradients[1].getFactor():l._currentSize2=l._currentSize1,l.scale.tc((0,T.RandomRange)(a.minScaleX,a.maxScaleX),(0,T.RandomRange)(a.minScaleY,a.maxScaleY))}function hl(l,a){const N=a._actualFrame/a.targetStopDuration;x.GetCurrentGradient(N,a._startSizeGradients,((N,U,c)=>{N!==a._currentStartSizeGradient&&(a._currentStartSize1=a._currentStartSize2,a._currentStartSize2=U.getFactor(),a._currentStartSizeGradient=N);const K=(0,T.Lerp)(a._currentStartSize1,a._currentStartSize2,c);l.scale.scaleInPlace(K)}))}function il(l,a){x.GetCurrentGradient(a._ratio,a._sizeGradients,((a,N,U)=>{a!==l._currentSizeGradient&&(l._currentSize1=l._currentSize2,l._currentSize2=N.getFactor(),l._currentSizeGradient=a),l.size=(0,T.Lerp)(l._currentSize1,l._currentSize2,U)}))}function kl(l,a){l.remapData=new U.Vector4(0,1,0,1)}function Ql(l,a){a._colorRemapGradients&&a._colorRemapGradients.length>0&&x.GetCurrentGradient(a._ratio,a._colorRemapGradients,((a,N,U)=>{const c=(0,T.Lerp)(a.factor1,N.factor1,U),K=(0,T.Lerp)(a.factor2,N.factor2,U);l.remapData.x=c,l.remapData.y=K-c})),a._alphaRemapGradients&&a._alphaRemapGradients.length>0&&x.GetCurrentGradient(a._ratio,a._alphaRemapGradients,((a,N,U)=>{const c=(0,T.Lerp)(a.factor1,N.factor1,U),K=(0,T.Lerp)(a.factor2,N.factor2,U);l.remapData.z=c,l.remapData.w=K-c}))}function jl(l,a){const N=(0,T.Clamp)(a._actualFrame/a.targetStopDuration);x.GetCurrentGradient(N,a._lifeTimeGradients,((a,U)=>{const c=a,K=U,Z=c.getFactor(),w=K.getFactor(),S=(N-c.gradient)/(K.gradient-c.gradient);l.lifeTime=(0,T.Lerp)(Z,w,S)})),a._emitPower=(0,T.RandomRange)(a.minEmitPower,a.maxEmitPower)}function fl(l,a){l.lifeTime=(0,T.RandomRange)(a.minLifeTime,a.maxLifeTime),a._emitPower=(0,T.RandomRange)(a.minEmitPower,a.maxEmitPower)}function pl(l,a){0===a._emitPower?(l._initialDirection?l._initialDirection.K(l.direction):l._initialDirection=l.direction.clone(),l.direction.set(0,0,0)):(l._initialDirection=null,l.direction.scaleInPlace(a._emitPower)),l.direction.addInPlace(a._inheritedVelocityOffset)}function Rl(l,a){l.angularSpeed=(0,T.RandomRange)(a.minAngularSpeed,a.maxAngularSpeed),l.angle=(0,T.RandomRange)(a.minInitialRotation,a.maxInitialRotation)}function Ll(l,a){l._currentAngularSpeedGradient=a._angularSpeedGradients[0],l.angularSpeed=l._currentAngularSpeedGradient.getFactor(),l._currentAngularSpeed1=l.angularSpeed,a._angularSpeedGradients.length>1?l._currentAngularSpeed2=a._angularSpeedGradients[1].getFactor():l._currentAngularSpeed2=l._currentAngularSpeed1,l.angle=(0,T.RandomRange)(a.minInitialRotation,a.maxInitialRotation)}function rl(l,a){l._initialStartSpriteCellId=a.startSpriteCellID,l._initialEndSpriteCellId=a.endSpriteCellID,l._initialSpriteCellLoop=a.spriteCellLoop}function Xl(l,a){l.previousItem=a.previousItem,l.nextItem=a,a.previousItem&&(a.previousItem.nextItem=l),a.previousItem=l}function Pl(l,a){l.previousItem=a,l.nextItem=a.nextItem,a.nextItem&&(a.nextItem.previousItem=l),a.nextItem=l}function dl(l,a){let N=a;for(;N.nextItem;)N=N.nextItem;l.previousItem=N,l.nextItem=N.nextItem,N.nextItem=l}function Fl(l){l.previousItem&&(l.previousItem.nextItem=l.nextItem),l.nextItem&&(l.nextItem.previousItem=l.previousItem)}class el extends S{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(l){this._startDirectionFunction!==l&&(this._startDirectionFunction=l,this._directionProcessing.process=l?nl:Jl)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(l){this._startPositionFunction!==l&&(this._startPositionFunction=l,this._positionCreation.process=l?Cl:Yl)}set onDispose(l){this._onDisposeObserver&&this.Tc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Tc.add(l)}get T(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(l){this._useRampGradients!==l&&(this._useRampGradients=l,this._resetEffect(),l?(this._rampCreation={process:kl,previousItem:null,nextItem:null},Pl(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Ql,previousItem:null,nextItem:null},Pl(this._remapGradientProcessing,this._gravityProcessing)):(Fl(this._rampCreation),Fl(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(l){this._isLocal!==l&&(this._isLocal=l,l?(this._isLocalCreation={process:Ml,previousItem:null,nextItem:null},Pl(this._isLocalCreation,this._positionCreation)):Fl(this._isLocalCreation))}get particles(){return this.Ty}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(l){this._animationSheetEnabled!==l&&(this._animationSheetEnabled=l,l?(this._sheetCreation={process:rl,previousItem:null,nextItem:null},Pl(this._sheetCreation,this._colorCreation)):Fl(this._sheetCreation),this._reset())}getActiveCount(){return this.Ty.length}getClassName(){return"rc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var l;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(l=this._customWrappers[a])||void 0===l?void 0:l.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[l]??this._customWrappers[0]}setCustomEffect(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[a]=new ll.d(this._engine),this._customWrappers[a].effect=l,this._customWrappers[a].drawContext&&(this._customWrappers[a].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new V.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(l){if(this.noiseTexture!==l){if(this._noiseTexture=l,!l)return Fl(this._noiseCreation),void Fl(this._noiseProcessing);this._noiseCreation={process:bl,previousItem:null,nextItem:null},Pl(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:zl,previousItem:null,nextItem:null},Pl(this._noiseProcessing,this._positionProcessing)}}constructor(l,a,N){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(l),this._emitterInverseWorldMatrix=U.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new U.ua,this.Tc=new V.e,this.onStoppedObservable=new V.e,this.onStartedObservable=new V.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ty=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Z.Qc(0,0,0,0),this._colorDiff=new Z.Qc(0,0,0,0),this._scaledDirection=U.ua.Zero(),this._scaledGravity=U.ua.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=l=>{},this.recycleParticle=l=>{const a=this.Ty.pop();a!==l&&a.copyTo(l),this._stockParticles.push(a)},this._createParticle=()=>{let l;return 0!==this._stockParticles.length?(l=this._stockParticles.pop(),l._reset()):l=new g(this),this._prepareParticle(l),l},this.paused=!1,this._shadersLoaded=!1,this._capacity=a,this._epsilon=w,N&&"Scene"!==N.getClassName()?(this._engine=N,this.defaultProjectionMatrix=U.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=N||v.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.wy.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:fl,previousItem:null,nextItem:null},this._positionCreation={process:Yl,previousItem:null,nextItem:null},Pl(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Jl,previousItem:null,nextItem:null},Pl(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:pl,previousItem:null,nextItem:null},Pl(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:tl,previousItem:null,nextItem:null},Pl(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Rl,previousItem:null,nextItem:null},Pl(this._angleCreation,this._sizeCreation),this._colorCreation={process:cl,previousItem:null,nextItem:null},Pl(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,S||(this._colorProcessing={process:wl,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Tl,previousItem:null,nextItem:null},Pl(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Bl,previousItem:null,nextItem:null},Pl(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Al,previousItem:null,nextItem:null},Pl(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Il,previousItem:null,nextItem:null},Pl(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=K,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ll.d(this._engine)},this._customWrappers[0].effect=c,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new n,this.updateFunction=l=>{var a;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(a=this.noiseTexture.getContent())||void 0===a||a.then((l=>{this._noiseTextureData=l})));const N=l===this.Ty;for(let U=0;U<l.length;U++){const a=l[U];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const c=a.age;if(a.age+=this._tempScaledUpdateSpeed,a.age>a.lifeTime){const l=a.age-c,N=a.lifeTime-c;this._tempScaledUpdateSpeed=N*this._tempScaledUpdateSpeed/l,a.age=a.lifeTime}this._ratio=a.age/a.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let K=this._updateQueueStart;for(;K;)K.process(a,this),K=K.nextItem;if(this._isAnimationSheetEnabled&&!S&&a.updateCellIndex(),a._inheritParticleInfoToSubEmitters(),a.age>=a.lifeTime){if(this._emitFromParticle(a),a._attachedSubEmitters){for(const l of a._attachedSubEmitters)l.particleSystem.disposeOnStop=!0,l.particleSystem.stop();a._attachedSubEmitters=null}this.recycleParticle(a),N&&U--}else;}}}serialize(l){throw new Error("Method not implemented.")}clone(l,a){throw new Error("Method not implemented.")}_addFactorGradient(l,a,N,U){const c=new ml(a,N,U);l.push(c),l.sort(((l,a)=>l.gradient<a.gradient?-1:l.gradient>a.gradient?1:0))}_removeFactorGradient(l,a){if(!l)return;let N=0;for(const U of l){if(U.gradient===a){l.splice(N,1);break}N++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=jl:this._lifeTimeCreation.process=fl}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:hl,previousItem:null,nextItem:null},Pl(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Fl(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(l){this.targetStopDuration!==l&&(this._targetStopDuration=l,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(l,a,N){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,l,a,N),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(l){return this._removeFactorGradient(this._lifeTimeGradients,l),this._syncLifeTimeCreation(),this}addSizeGradient(l,a,N){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Ol,this._sizeGradientProcessing={process:il,previousItem:null,nextItem:null},Xl(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,l,a,N),this}removeSizeGradient(l){var a;return this._removeFactorGradient(this._sizeGradients,l),0===(null===(a=this._sizeGradients)||void 0===a?void 0:a.length)&&(Fl(this._sizeGradientProcessing),this._sizeCreation.process=tl),this}addColorRemapGradient(l,a,N){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,l,a,N),this}removeColorRemapGradient(l){return this._removeFactorGradient(this._colorRemapGradients,l),this}addAlphaRemapGradient(l,a,N){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,l,a,N),this}removeAlphaRemapGradient(l){return this._removeFactorGradient(this._alphaRemapGradients,l),this}addAngularSpeedGradient(l,a,N){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Ll,this._angularSpeedGradientProcessing={process:Sl,previousItem:null,nextItem:null},Xl(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,l,a,N),this}removeAngularSpeedGradient(l){var a;return this._removeFactorGradient(this._angularSpeedGradients,l),0===(null===(a=this._angularSpeedGradients)||void 0===a?void 0:a.length)&&(this._angleCreation.process=Rl,Fl(this._angularSpeedGradientProcessing)),this}addVelocityGradient(l,a,N){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:yl,previousItem:null,nextItem:null},Pl(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:ul,previousItem:null,nextItem:null},Xl(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,l,a,N),this}removeVelocityGradient(l){var a;return this._removeFactorGradient(this._velocityGradients,l),0===(null===(a=this._velocityGradients)||void 0===a?void 0:a.length)&&(Fl(this._velocityCreation),Fl(this._velocityGradientProcessing)),this}addLimitVelocityGradient(l,a,N){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Hl,previousItem:null,nextItem:null},Pl(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Wl,previousItem:null,nextItem:null},Pl(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,l,a,N),this}removeLimitVelocityGradient(l){var a;return this._removeFactorGradient(this._limitVelocityGradients,l),0===(null===(a=this._limitVelocityGradients)||void 0===a?void 0:a.length)&&(Fl(this._limitVelocityCreation),Fl(this._limitVelocityGradientProcessing)),this}addDragGradient(l,a,N){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:El,previousItem:null,nextItem:null},Xl(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:ql,previousItem:null,nextItem:null},Xl(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,l,a,N),this}removeDragGradient(l){var a;return this._removeFactorGradient(this._dragGradients,l),0===(null===(a=this._dragGradients)||void 0===a?void 0:a.length)&&(Fl(this._dragCreation),Fl(this._dragGradientProcessing)),this}addEmitRateGradient(l,a,N){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,l,a,N),this}removeEmitRateGradient(l){return this._removeFactorGradient(this._emitRateGradients,l),this}addStartSizeGradient(l,a,N){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,l,a,N),this._syncStartSizeCreation(),this}removeStartSizeGradient(l){return this._removeFactorGradient(this._startSizeGradients,l),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const l=new Uint8Array(4*this._rawTextureWidth),a=Z.TmpColors.Ca[0];for(let N=0;N<this._rawTextureWidth;N++){const U=N/this._rawTextureWidth;x.GetCurrentGradient(U,this._rampGradients,((U,c,K)=>{Z.Ca.LerpToRef(U.color,c.color,K,a),l[4*N]=255*a.r,l[4*N+1]=255*a.g,l[4*N+2]=255*a.b,l[4*N+3]=255}))}this._rampGradientsTexture=D.d.CreateRGBATexture(l,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((l,a)=>l.gradient<a.gradient?-1:l.gradient>a.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(l,a){this._rampGradients||(this._rampGradients=[]);const N=new G(l,a);return this._rampGradients.push(N),this._syncRampGradientTexture(),this}removeRampGradient(l){return this._removeGradientAndTexture(l,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(l,a,N){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Kl,this._colorProcessing.process=Zl);const U=new o(l,a,N);return this._colorGradients.push(U),this._colorGradients.sort(((l,a)=>l.gradient<a.gradient?-1:l.gradient>a.gradient?1:0)),this}removeColorGradient(l){if(!this._colorGradients)return this;let a=0;for(const N of this._colorGradients){if(N.gradient===l){this._colorGradients.splice(a,1);break}a++}return 0===this._colorGradients.length&&(this._colorCreation.process=cl,this._colorProcessing.process=wl),this}resetDrawCache(){if(this._drawWrappers){for(const l of this._drawWrappers)if(l)for(const a of l)null===a||void 0===a||a.dispose();this._drawWrappers=[]}}_fetchR(l,a,N,U,c){return c[4*(((l=.5*Math.abs(l)+.5)*N%N|0)+((a=.5*Math.abs(a)+.5)*U%U|0)*N)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const l=this._engine,a=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*a),this._vertexBuffer=new E.e(l,this._vertexData,!0,a);let N=0;const U=this._vertexBuffer.createVertexBuffer(E.h.PositionKind,N,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[E.h.PositionKind]=U,N+=3;const c=this._vertexBuffer.createVertexBuffer(E.h.ColorKind,N,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[E.h.ColorKind]=c,N+=4;const K=this._vertexBuffer.createVertexBuffer("angle",N,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=K,N+=1;const Z=this._vertexBuffer.createVertexBuffer("size",N,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Z,N+=2,this._isAnimationSheetEnabled){const l=this._vertexBuffer.createVertexBuffer("cellIndex",N,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=l,N+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const l=this._vertexBuffer.createVertexBuffer("direction",N,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=l,N+=3}if(this._useRampGradients){const l=this._vertexBuffer.createVertexBuffer("remapData",N,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=l,N+=4}let w;if(this._useInstancing){const a=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new E.e(l,a,!1,2),w=this._spriteBuffer.createVertexBuffer("offset",0,2)}else w=this._vertexBuffer.createVertexBuffer("offset",N,2,this._vertexBufferSize,this._useInstancing),N+=2;this._vertexBuffers.offset=w,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const l=[],a=[];let N=0;for(let U=0;U<this._capacity;U++)l.push(N),l.push(N+1),l.push(N+2),l.push(N),l.push(N+2),l.push(N+3),a.push(N,N+1,N+1,N+2,N+2,N+3,N+3,N,N,N+3),N+=4;this._indexBuffer=this._engine.createIndexBuffer(l),this._linesIndexBuffer=this._engine.createIndexBuffer(a)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(l)setTimeout((()=>{this.start(0)}),l);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var a;-1!==(null===(a=this.Ua)||void 0===a?void 0:a.getClassName().indexOf("Mesh"))&&this.Ua.qc(!0);const l=this.noiseTexture;if(l&&l.onGeneratedObservable)l.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let a=0;a<this.preWarmCycles;a++)this.animate(!0),l.render()}))}));else for(let a=0;a<this.preWarmCycles;a++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(l))}_postStop(l){}reset(){this._stockParticles.length=0,this.Ty.length=0}_appendParticleVertex(l,a,N,c){let K=l*this._vertexBufferSize;if(this._vertexData[K++]=a.position.x+this.qT.x,this._vertexData[K++]=a.position.y+this.qT.y,this._vertexData[K++]=a.position.z+this.qT.z,this._vertexData[K++]=a.color.r,this._vertexData[K++]=a.color.g,this._vertexData[K++]=a.color.b,this._vertexData[K++]=a.color.a,this._vertexData[K++]=a.angle,this._vertexData[K++]=a.scale.x*a.size,this._vertexData[K++]=a.scale.y*a.size,this._isAnimationSheetEnabled&&(this._vertexData[K++]=a.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[K++]=a.direction.x,this._vertexData[K++]=a.direction.y,this._vertexData[K++]=a.direction.z);else if(a._initialDirection){let l=a._initialDirection;this.isLocal&&(U.ua.TransformNormalToRef(l,this._emitterWorldMatrix,U.TmpVectors.ua[0]),l=U.TmpVectors.ua[0]),0===l.x&&0===l.z&&(l.x=.001),this._vertexData[K++]=l.x,this._vertexData[K++]=l.y,this._vertexData[K++]=l.z}else{let l=a.direction;this.isLocal&&(U.ua.TransformNormalToRef(l,this._emitterWorldMatrix,U.TmpVectors.ua[0]),l=U.TmpVectors.ua[0]),0===l.x&&0===l.z&&(l.x=.001),this._vertexData[K++]=l.x,this._vertexData[K++]=l.y,this._vertexData[K++]=l.z}this._useRampGradients&&a.remapData&&(this._vertexData[K++]=a.remapData.x,this._vertexData[K++]=a.remapData.y,this._vertexData[K++]=a.remapData.z,this._vertexData[K++]=a.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===N?N=this._epsilon:1===N&&(N=1-this._epsilon),0===c?c=this._epsilon:1===c&&(c=1-this._epsilon)),this._vertexData[K++]=N,this._vertexData[K++]=c)}_prepareParticle(l){}_createNewOnes(l){let a;for(let N=0;N<l&&this.Ty.length!==this._capacity;N++){a=this._createParticle(),this.Ty.push(a);let l=this._createQueueStart;for(;l;)l.process(a,this),l=l.nextItem;a._inheritParticleInfoToSubEmitters()}}_update(l){if(this._alive=this.Ty.length>0,this.Ua.position){const l=this.Ua;this._emitterWorldMatrix=l.getWorldMatrix()}else{const l=this.Ua;this._emitterWorldMatrix=U.Matrix.Translation(l.x,l.y,l.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ty),this._createNewOnes(l)}static _GetAttributeNamesOrOptions(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const U=[E.h.PositionKind,E.h.ColorKind,"angle","offset","size"];return l&&U.push("cellIndex"),a||U.push("direction"),N&&U.push("remapData"),U}static _GetEffectCreationOptions(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const U=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,al.c)(U),l&&U.push("particlesInfos"),a&&U.push("logarithmicDepthConstant"),N&&(U.push("vFogInfos"),U.push("vFogColor")),U}fillDefines(l,a){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,al.g)(this,this._scene,l),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&l.push("#define FOG")),this._isAnimationSheetEnabled&&l.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&l.push("#define LOGARITHMICDEPTH"),a===S.BLENDMODE_MULTIPLY&&l.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&l.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(l.push("#define BILLBOARD"),this.billboardMode){case 2:l.push("#define BILLBOARDY");break;case 8:case 9:l.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&l.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:l.push("#define BILLBOARDMODE_ALL")}N&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),l.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(l,a,N){a.push(...el._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),l.push(...el._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),N.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Ul.g)(l,this._imageProcessingConfigurationDefines),(0,Ul.e)(N,this._imageProcessingConfigurationDefines))}_getWrapper(l){const a=this._getCustomDrawWrapper(l);if(null!==a&&void 0!==a&&a.effect)return a;const N=[];this.fillDefines(N,l);const U=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let c=this._drawWrappers[U];c||(c=this._drawWrappers[U]=[]);let K=c[l];K||(K=new ll.d(this._engine),K.drawContext&&(K.drawContext.useInstancing=this._useInstancing),c[l]=K);const Z=N.join("\n");if(K.defines!==Z){const l=[],a=[],N=[];this.fillUniformsAttributesAndSamplerNames(a,l,N),K.setEffect(this._engine.createEffect("particles",l,a,N,Z,void 0,void 0,void 0,void 0,this._shaderLanguage),Z)}return K}animate(){var l;let a,N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!N&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(N?this.preWarmStepOffset:(null===(l=this._scene)||void 0===l?void 0:l.getAnimationRatio())||1),this.manualEmitCount>-1)a=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let l=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const a=this._actualFrame/this.targetStopDuration;x.GetCurrentGradient(a,this._emitRateGradients,((a,N,U)=>{a!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=N.getFactor(),this._currentEmitRateGradient=a),l=(0,T.Lerp)(this._currentEmitRate1,this._currentEmitRate2,U)}))}a=l*this._scaledUpdateSpeed|0,this._newPartsExcess+=l*this._scaledUpdateSpeed-a}if(this._newPartsExcess>1&&(a+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?a=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(a),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!N){let l=0;for(let a=0;a<this.Ty.length;a++){const N=this.Ty[a];this._appendParticleVertices(l,N),l+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ty.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(l,a){this._appendParticleVertex(l++,a,0,0),this._useInstancing||(this._appendParticleVertex(l++,a,1,0),this._appendParticleVertex(l++,a,1,1),this._appendParticleVertex(l++,a,0,1))}rebuild(){var l;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(l=this._spriteBuffer)||void 0===l||l._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!el.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(N.bind(N,13907)),Promise.resolve().then(N.bind(N,13846))])):await Promise.all([Promise.resolve().then(N.bind(N,13838)),Promise.resolve().then(N.bind(N,13829))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Ua||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==S.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(S.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(S.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(l){const a=this._getWrapper(l),N=a.effect,c=this._engine;c.enableEffect(a);const K=this.defaultViewMatrix??this._scene.getViewMatrix();if(N.setTexture("diffuseSampler",this.particleTexture),N.setMatrix("view",K),N.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const l=this.particleTexture.getBaseSize();N.setFloat3("particlesInfos",this.spriteCellWidth/l.width,this.spriteCellHeight/l.height,this.spriteCellWidth/l.width)}if(N.setVector2("translationPivot",this.translationPivot),N.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const l=this._scene.activeCamera;N.setVector3("eyePosition",l.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),N.setTexture("rampSampler",this._rampGradientsTexture));const Z=N.defines;var w,S,T,J,n,y;(this._scene&&((0,al.d)(N,this,this._scene),this.applyFog&&(0,Nl.h)(this._scene,void 0,N)),Z.indexOf("#define BILLBOARDMODE_ALL")>=0&&(K.invertToRef(U.TmpVectors.Matrix[0]),N.setMatrix("invView",U.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?c.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,N):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,N)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?c.bindBuffers(this._vertexBuffers,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBuffer:this._indexBuffer,N):c.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBufferUseInstancing:null,N);(this.useLogarithmicDepth&&this._scene&&(0,Nl.k)(Z,N,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(N),this._setEngineBasedOnBlendMode(l),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(N),this._useInstancing)?null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?c.drawElementsType(6,0,10,this.Ty.length):c.drawArraysType(7,0,4,this.Ty.length):null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?c.drawElementsType(1,0,10*this.Ty.length):c.drawElementsType(0,0,6*this.Ty.length);return this.Ty.length}render(){if(!this.isReady()||!this.Ty.length)return 0;const l=this._engine;l.setState&&(l.setState(!1),this.forceDepthWrite&&l.setDepthWrite(!0));let a=0;return a=this.blendMode===S.BLENDMODE_MULTIPLYADD?this._render(S.BLENDMODE_MULTIPLY)+this._render(S.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),a}_onDispose(){}dispose(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),l&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),l&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(a,N),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const l=this._scene.wy.indexOf(this);l>-1&&this._scene.wy.splice(l,1),this._scene._activeParticleSystems.dispose()}this.Tc.notifyObservers(this),this.Tc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}el.ForceGLSL=!1;var sl,ol=N(12288);!function(l){l[l.ATTACHED=0]="ATTACHED",l[l.END=1]="END"}(sl||(sl={}));class Gl{constructor(l){if(this.particleSystem=l,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!l.Ua||!l.Ua.dispose){const a=(0,w.e)("BABYLON.AbstractMesh");l.Ua=new a("SubemitterSystemEmitter",l.bl()),l._disposeEmitterOnDispose=!0}}clone(){let l=this.particleSystem.Ua;if(l){if(l instanceof U.ua)l=l.clone();else if(-1!==l.getClassName().indexOf("Mesh")){l=new((0,w.e)("BABYLON.Mesh"))("",l.bl()),l.isVisible=!1}}else l=new U.ua;const a=new Gl(this.particleSystem.clone(this.particleSystem.name,l));return a.particleSystem.name+="Clone",a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem._disposeEmitterOnDispose=!0,a.particleSystem.disposeOnStop=!0,a}serialize(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};return a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem=this.particleSystem.serialize(l),a}static _ParseParticleSystem(l,a,N){throw(0,ol.b)("ParseParticle")}static Parse(l,a,N){const U=l.particleSystem,c=new Gl(Gl._ParseParticleSystem(U,a,N,!0));return c.type=l.type,c.inheritDirection=l.inheritDirection,c.inheritedVelocityAmount=l.inheritedVelocityAmount,c.particleSystem._isSubEmitter=!0,c}dispose(){this.particleSystem.dispose()}}var ma=N(12336);function xl(l,a){const N=new Y;return N.direction1=l,N.direction2=a,N}function Vl(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Dl(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function vl(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new U.ua(0,1,0),N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new U.ua(0,1,0);return new M(l,a,N)}function gl(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function la(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new U.ua(0,1,0),K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new U.ua(0,1,0);return new W(l,a,N,c,K)}function aa(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new y(l,a)}function Na(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new U.ua(0,1,0),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new U.ua(0,1,0);return new H(l,a,N,c)}const Ua=U.ua.Zero(),ca=U.ua.Zero(),Ka=U.ua.Zero();class Za{constructor(){this.strength=0,this.position=U.ua.Zero()}_processParticle(l,a){this.position.subtractToRef(l.position,Ua);const N=Ua.lengthSquared()+1;Ua.normalize().scaleToRef(this.strength/N,ca),ca.scaleToRef(a._tempScaledUpdateSpeed,Ka),l.direction.addInPlace(Ka)}serialize(){return{position:this.position.Bc(),strength:this.strength}}}class wa extends el{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=l=>{if(!this._subEmitters||0===this._subEmitters.length)return;const a=Math.floor(Math.random()*this._subEmitters.length);for(const N of this._subEmitters[a])if(1===N.type){const a=N.clone();l._inheritParticleInfoToSubEmitter(a),a.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(a.particleSystem),a.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(l,a){const N=xl(l,a);return this.particleEmitterType=N,N}get flowMap(){return this._flowMap}set flowMap(l){this._flowMap!==l&&(this._flowMap=l,this._flowMapUpdate&&(Fl(this._flowMapUpdate),this._flowMapUpdate=null),l&&(this._flowMapUpdate={process:l=>{var a;const N=null===(a=this.bl())||void 0===a?void 0:a.getTransformMatrix();this._flowMap._processParticle(l,this.flowMapStrength*this._tempScaledUpdateSpeed,N)},previousItem:null,nextItem:null},Pl(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(l){this._attractors.push(l),1===this._attractors.length&&(this._attractorUpdate={process:l=>{for(const a of this._attractors)a._processParticle(l,this)},previousItem:null,nextItem:null},Pl(this._attractorUpdate,this._directionProcessing))}removeAttractor(l){const a=this._attractors.indexOf(l);-1!==a&&this._attractors.splice(a,1),0===this._attractors.length&&Fl(this._attractorUpdate)}start(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(l)}createHemisphericEmitter(){const l=Vl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=l,l}createSphereEmitter(){const l=Dl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=l,l}createDirectedSphereEmitter(){const l=vl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new U.ua(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new U.ua(0,1,0));return this.particleEmitterType=l,l}createCylinderEmitter(){const l=gl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=l,l}createDirectedCylinderEmitter(){const l=la(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new U.ua(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new U.ua(0,1,0));return this.particleEmitterType=l,l}createConeEmitter(){const l=aa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=l,l}createDirectedConeEmitter(){const l=Na(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new U.ua(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new U.ua(0,1,0));return this.particleEmitterType=l,l}createBoxEmitter(l,a,N,U){const c=new n;return this.particleEmitterType=c,this.direction1=l,this.direction2=a,this.minEmitBox=N,this.maxEmitBox=U,c}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const l of this.subEmitters)l instanceof wa?this._subEmitters.push([new Gl(l)]):l instanceof Gl?this._subEmitters.push([l]):l instanceof Array&&this._subEmitters.push(l)}_stopSubEmitters(){if(this.activeSubSystems){for(const l of this.activeSubSystems)l.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const l=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==l&&this._rootParticleSystem.activeSubSystems.splice(l,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(l){l&&this._stopSubEmitters()}_prepareParticle(l){if(this._subEmitters&&this._subEmitters.length>0){const a=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];l._attachedSubEmitters=[];for(const N of a)if(0===N.type){const a=N.clone();l._attachedSubEmitters.push(a),a.particleSystem.start()}}}_onDispose(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),l&&this.particles)for(const N of this.particles)if(N._attachedSubEmitters)for(let l=N._attachedSubEmitters.length-1;l>=0;l-=1)N._attachedSubEmitters[l].dispose();if(a&&this.activeSubSystems)for(let N=this.activeSubSystems.length-1;N>=0;N-=1)this.activeSubSystems[N].dispose();if(this._subEmitters&&this._subEmitters.length){for(let l=0;l<this._subEmitters.length;l++)for(const a of this._subEmitters[l])a.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Ua&&this.Ua.dispose&&this.Ua.dispose(!0)}static _Parse(l,a,N,c){let K;K=N instanceof ma.c?null:N;const S=(0,w.e)("BABYLON.Texture");if(S&&K&&(l.texture?a.particleTexture=S.Parse(l.texture,K,c):l.textureName&&(a.particleTexture=new S(c+l.textureName,K,!1,void 0===l.invertY||l.invertY),a.particleTexture.name=l.textureName)),l.emitterId||0===l.emitterId||void 0!==l.Ua?l.emitterId&&K?a.Ua=K.getLastMeshById(l.emitterId):a.Ua=U.ua.Ma(l.Ua):a.Ua=U.ua.Zero(),a.isLocal=!!l.isLocal,void 0!==l.renderingGroupId&&(a.renderingGroupId=l.renderingGroupId),void 0!==l.isBillboardBased&&(a.isBillboardBased=l.isBillboardBased),void 0!==l.billboardMode&&(a.billboardMode=l.billboardMode),void 0!==l.useLogarithmicDepth&&(a.useLogarithmicDepth=l.useLogarithmicDepth),l.animations){for(let N=0;N<l.animations.length;N++){const U=l.animations[N],c=(0,w.e)("BABYLON.Animation");c&&a.animations.push(c.Parse(U))}a.beginAnimationOnStart=l.beginAnimationOnStart,a.beginAnimationFrom=l.beginAnimationFrom,a.beginAnimationTo=l.beginAnimationTo,a.beginAnimationLoop=l.beginAnimationLoop}if(l.autoAnimate&&K&&K.beginAnimation(a,l.autoAnimateFrom,l.autoAnimateTo,l.autoAnimateLoop,l.autoAnimateSpeed||1),a.startDelay=0|l.startDelay,a.minAngularSpeed=l.minAngularSpeed,a.maxAngularSpeed=l.maxAngularSpeed,a.minSize=l.minSize,a.maxSize=l.maxSize,l.minScaleX&&(a.minScaleX=l.minScaleX,a.maxScaleX=l.maxScaleX,a.minScaleY=l.minScaleY,a.maxScaleY=l.maxScaleY),void 0!==l.preWarmCycles&&(a.preWarmCycles=l.preWarmCycles,a.preWarmStepOffset=l.preWarmStepOffset),void 0!==l.minInitialRotation&&(a.minInitialRotation=l.minInitialRotation,a.maxInitialRotation=l.maxInitialRotation),a.minLifeTime=l.minLifeTime,a.maxLifeTime=l.maxLifeTime,a.minEmitPower=l.minEmitPower,a.maxEmitPower=l.maxEmitPower,a.emitRate=l.emitRate,a.gravity=U.ua.Ma(l.gravity),l.noiseStrength&&(a.noiseStrength=U.ua.Ma(l.noiseStrength)),a.color1=Z.Qc.Ma(l.color1),a.color2=Z.Qc.Ma(l.color2),a.colorDead=Z.Qc.Ma(l.colorDead),a.updateSpeed=l.updateSpeed,a.targetStopDuration=l.targetStopDuration,a.blendMode=l.blendMode,l.colorGradients)for(const U of l.colorGradients)a.addColorGradient(U.gradient,Z.Qc.Ma(U.color1),U.color2?Z.Qc.Ma(U.color2):void 0);if(l.rampGradients){for(const N of l.rampGradients)a.addRampGradient(N.gradient,Z.Ca.Ma(N.color));a.useRampGradients=l.useRampGradients}if(l.colorRemapGradients)for(const U of l.colorRemapGradients)a.addColorRemapGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.alphaRemapGradients)for(const U of l.alphaRemapGradients)a.addAlphaRemapGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.sizeGradients)for(const U of l.sizeGradients)a.addSizeGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.angularSpeedGradients)for(const U of l.angularSpeedGradients)a.addAngularSpeedGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.velocityGradients)for(const U of l.velocityGradients)a.addVelocityGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.dragGradients)for(const U of l.dragGradients)a.addDragGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.emitRateGradients)for(const U of l.emitRateGradients)a.addEmitRateGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.startSizeGradients)for(const U of l.startSizeGradients)a.addStartSizeGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.lifeTimeGradients)for(const U of l.lifeTimeGradients)a.addLifeTimeGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2);if(l.limitVelocityGradients){for(const N of l.limitVelocityGradients)a.addLimitVelocityGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);a.limitVelocityDamping=l.limitVelocityDamping}if(l.noiseTexture&&K){const N=(0,w.e)("BABYLON.ProceduralTexture");a.noiseTexture=N.Parse(l.noiseTexture,K,c)}let T;if(l.particleEmitterType){switch(l.particleEmitterType.type){case"SphereParticleEmitter":T=new C;break;case"SphereDirectedParticleEmitter":T=new M;break;case"ConeEmitter":case"ConeParticleEmitter":T=new y;break;case"ConeDirectedParticleEmitter":T=new H;break;case"CylinderParticleEmitter":T=new u;break;case"CylinderDirectedParticleEmitter":T=new W;break;case"HemisphericParticleEmitter":T=new B;break;case"PointParticleEmitter":T=new Y;break;case"MeshParticleEmitter":T=new q;break;case"CustomParticleEmitter":T=new A;break;default:T=new n}T.parse(l.particleEmitterType,K)}else T=new n,T.parse(l,K);a.particleEmitterType=T,a.startSpriteCellID=l.startSpriteCellID,a.endSpriteCellID=l.endSpriteCellID,a.spriteCellLoop=l.spriteCellLoop??!0,a.spriteCellWidth=l.spriteCellWidth,a.spriteCellHeight=l.spriteCellHeight,a.spriteCellChangeSpeed=l.spriteCellChangeSpeed,a.spriteRandomStartCell=l.spriteRandomStartCell,a.disposeOnStop=l.disposeOnStop??!1,a.manualEmitCount=l.manualEmitCount??-1}static Parse(l,a,N){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4?arguments[4]:void 0;const w=l.name;let S,T,J=null,n=null;if(a instanceof ma.c?S=a:(T=a,S=T.getEngine()),l.customShader&&S.createEffectForParticles){n=l.customShader;const a=n.shaderOptions.defines.length>0?n.shaderOptions.defines.join("\n"):"";J=S.createEffectForParticles(n.shaderPath.fragmentElement,n.shaderOptions.uniforms,n.shaderOptions.samplers,a)}const y=new wa(w,K||l.kN,a,J,l.isAnimationSheetEnabled);if(y.customShader=n,y._rootUrl=N,l.id&&(y.id=l.id),l.subEmitters){y.subEmitters=[];for(const U of l.subEmitters){const l=[];for(const c of U)l.push(Gl.Parse(c,a,N));y.subEmitters.push(l)}}if(l.attractors)for(const Z of l.attractors){const l=new Za;l.position=U.ua.Ma(Z.position),l.strength=Z.strength,y.addAttractor(l)}return wa._Parse(l,y,a,N),l.textureMask&&(y.textureMask=Z.Qc.Ma(l.textureMask)),l.qT&&(y.qT=U.ua.Ma(l.qT)),l.preventAutoStart&&(y.preventAutoStart=l.preventAutoStart),c||y.preventAutoStart||y.start(),y}serialize(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};if(wa._Serialize(a,this,l),a.textureMask=this.textureMask.Bc(),a.customShader=this.customShader,a.preventAutoStart=this.preventAutoStart,a.qT=this.qT.Bc(),this.subEmitters){a.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const N of this._subEmitters){const U=[];for(const a of N)U.push(a.serialize(l));a.subEmitters.push(U)}}if(this._attractors&&this._attractors.length){a.attractors=[];for(const l of this._attractors)a.attractors.push(l.serialize())}return a}static _Serialize(l,a,N){if(l.name=a.name,l.id=a.id,l.kN=a.getCapacity(),l.disposeOnStop=a.disposeOnStop,l.manualEmitCount=a.manualEmitCount,a.Ua.position){const N=a.Ua;l.emitterId=N.id}else{const N=a.Ua;l.Ua=N.Bc()}a.particleEmitterType&&(l.particleEmitterType=a.particleEmitterType.serialize()),a.particleTexture&&(N?l.texture=a.particleTexture.serialize():(l.textureName=a.particleTexture.name,l.invertY=!!a.particleTexture._invertY)),l.isLocal=a.isLocal,j.c.AppendSerializedAnimations(a,l),l.beginAnimationOnStart=a.beginAnimationOnStart,l.beginAnimationFrom=a.beginAnimationFrom,l.beginAnimationTo=a.beginAnimationTo,l.beginAnimationLoop=a.beginAnimationLoop,l.startDelay=a.startDelay,l.renderingGroupId=a.renderingGroupId,l.isBillboardBased=a.isBillboardBased,l.billboardMode=a.billboardMode,l.minAngularSpeed=a.minAngularSpeed,l.maxAngularSpeed=a.maxAngularSpeed,l.minSize=a.minSize,l.maxSize=a.maxSize,l.minScaleX=a.minScaleX,l.maxScaleX=a.maxScaleX,l.minScaleY=a.minScaleY,l.maxScaleY=a.maxScaleY,l.minEmitPower=a.minEmitPower,l.maxEmitPower=a.maxEmitPower,l.minLifeTime=a.minLifeTime,l.maxLifeTime=a.maxLifeTime,l.emitRate=a.emitRate,l.gravity=a.gravity.Bc(),l.noiseStrength=a.noiseStrength.Bc(),l.color1=a.color1.Bc(),l.color2=a.color2.Bc(),l.colorDead=a.colorDead.Bc(),l.updateSpeed=a.updateSpeed,l.targetStopDuration=a.targetStopDuration,l.blendMode=a.blendMode,l.preWarmCycles=a.preWarmCycles,l.preWarmStepOffset=a.preWarmStepOffset,l.minInitialRotation=a.minInitialRotation,l.maxInitialRotation=a.maxInitialRotation,l.startSpriteCellID=a.startSpriteCellID,l.spriteCellLoop=a.spriteCellLoop,l.endSpriteCellID=a.endSpriteCellID,l.spriteCellChangeSpeed=a.spriteCellChangeSpeed,l.spriteCellWidth=a.spriteCellWidth,l.spriteCellHeight=a.spriteCellHeight,l.spriteRandomStartCell=a.spriteRandomStartCell,l.isAnimationSheetEnabled=a.isAnimationSheetEnabled,l.useLogarithmicDepth=a.useLogarithmicDepth;const U=a.getColorGradients();if(U){l.colorGradients=[];for(const a of U){const N={gradient:a.gradient,color1:a.color1.Bc()};a.color2?N.color2=a.color2.Bc():N.color2=a.color1.Bc(),l.colorGradients.push(N)}}const c=a.getRampGradients();if(c){l.rampGradients=[];for(const a of c){const N={gradient:a.gradient,color:a.color.Bc()};l.rampGradients.push(N)}l.useRampGradients=a.useRampGradients}const K=a.getColorRemapGradients();if(K){l.colorRemapGradients=[];for(const a of K){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.colorRemapGradients.push(N)}}const Z=a.getAlphaRemapGradients();if(Z){l.alphaRemapGradients=[];for(const a of Z){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.alphaRemapGradients.push(N)}}const w=a.getSizeGradients();if(w){l.sizeGradients=[];for(const a of w){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.sizeGradients.push(N)}}const S=a.getAngularSpeedGradients();if(S){l.angularSpeedGradients=[];for(const a of S){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.angularSpeedGradients.push(N)}}const T=a.getVelocityGradients();if(T){l.velocityGradients=[];for(const a of T){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.velocityGradients.push(N)}}const J=a.getDragGradients();if(J){l.dragGradients=[];for(const a of J){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.dragGradients.push(N)}}const n=a.getEmitRateGradients();if(n){l.emitRateGradients=[];for(const a of n){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.emitRateGradients.push(N)}}const y=a.getStartSizeGradients();if(y){l.startSizeGradients=[];for(const a of y){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.startSizeGradients.push(N)}}const H=a.getLifeTimeGradients();if(H){l.lifeTimeGradients=[];for(const a of H){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.lifeTimeGradients.push(N)}}const u=a.getLimitVelocityGradients();if(u){l.limitVelocityGradients=[];for(const a of u){const N={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?N.factor2=a.factor2:N.factor2=a.factor1,l.limitVelocityGradients.push(N)}l.limitVelocityDamping=a.limitVelocityDamping}a.noiseTexture&&(l.noiseTexture=a.noiseTexture.serialize())}clone(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const U={...this._customWrappers};let c=null;const K=this._engine;if(K.createEffectForParticles&&null!=this.customShader){c=this.customShader;const l=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",a=K.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,l);U[0]?U[0].effect=a:this.setCustomEffect(a,0)}const Z=this.serialize(N),w=wa.Parse(Z,this._scene||this._engine,this._rootUrl);return w.name=l,w.customShader=c,w._customWrappers=U,void 0===a&&(a=this.Ua),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.Ua=a,this.preventAutoStart||w.start(),w}}wa.BILLBOARDMODE_Y=2,wa.BILLBOARDMODE_ALL=7,wa.BILLBOARDMODE_STRETCHED=8,wa.BILLBOARDMODE_STRETCHED_LOCAL=9,Gl._ParseParticleSystem=wa.Parse;var Sa=N(12681),Ta=N(12678),Ja=N(12564);Ja.d.prototype.createTransformFeedback=function(){const l=this._gl.createTransformFeedback();if(!l)throw new Error("Unable to create Transform Feedback");return l},Ja.d.prototype.deleteTransformFeedback=function(l){this._gl.deleteTransformFeedback(l)},Ja.d.prototype.bindTransformFeedback=function(l){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,l)},Ja.d.prototype.beginTransformFeedback=function(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(l?this._gl.POINTS:this._gl.TRIANGLES)},Ja.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Ja.d.prototype.setTranformFeedbackVaryings=function(l,a){this._gl.transformFeedbackVaryings(l,a,this._gl.INTERLEAVED_ATTRIBS)},Ja.d.prototype.bindTransformFeedbackBuffer=function(l){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,l?l.underlyingResource:null)},Ja.d.prototype.readTransformFeedbackBuffer=function(l){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,l)};const na="clipPlaneFragmentDeclaration2",ya="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";z.e.IncludesShadersStore[na]||(z.e.IncludesShadersStore[na]=ya);N(13731),N(13735),N(13743),N(13748),N(13757),N(13762),N(13770),N(13779);const Ha="gpuRenderParticlesPixelShader",ua="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";z.e.ShadersStore[Ha]||(z.e.ShadersStore[Ha]=ua);const Wa="clipPlaneVertexDeclaration2",Ba="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";z.e.IncludesShadersStore[Wa]||(z.e.IncludesShadersStore[Wa]=Ba);N(13782),N(13788),N(13791),N(13800);const Ya="gpuRenderParticlesVertexShader",Ca="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";z.e.ShadersStore[Ya]||(z.e.ShadersStore[Ya]=Ca);class Ma extends S{static get IsSupported(){if(!v.e.LastCreatedEngine)return!1;const l=v.e.LastCreatedEngine.getCaps();return l.supportTransformFeedbacks||l.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(l){this._maxActiveParticleCount=Math.min(l,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(l){this.maxActiveParticleCount=l}createPointEmitter(l,a){const N=xl(l,a);return this.particleEmitterType=N,N}createHemisphericEmitter(){const l=Vl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=l,l}createSphereEmitter(){const l=Dl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=l,l}createDirectedSphereEmitter(){const l=vl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new U.ua(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new U.ua(0,1,0));return this.particleEmitterType=l,l}createCylinderEmitter(){const l=gl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=l,l}createDirectedCylinderEmitter(){const l=la(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new U.ua(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new U.ua(0,1,0));return this.particleEmitterType=l,l}createConeEmitter(){const l=aa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=l,l}createDirectedConeEmitter(){const l=Na(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new U.ua(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new U.ua(0,1,0));return this.particleEmitterType=l,l}createBoxEmitter(l,a,N,U){const c=new n;return this.particleEmitterType=c,this.direction1=l,this.direction2=a,this.minEmitBox=N,this.maxEmitBox=U,c}get flowMap(){return this._flowMap}set flowMap(l){this._flowMap!==l&&(this._flowMap=l)}isReady(){if(!this.Ua||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==wa.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(wa.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(wa.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";l?setTimeout((()=>{this.start(0)}),l):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var l;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(l=this._customWrappers[a])||void 0===l?void 0:l.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[l]??this._customWrappers[0]}setCustomEffect(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[a]=new ll.d(this._engine),this._customWrappers[a].effect=l}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new V.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(l,a,N){return super._removeGradientAndTexture(l,a,N),this._releaseBuffers(),this}addColorGradient(l,a){this._colorGradients||(this._colorGradients=[]);const N=new o(l,a);return this._colorGradients.push(N),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(l&&this._colorGradients.sort(((l,a)=>l.gradient<a.gradient?-1:l.gradient>a.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(l){return this._removeGradientAndTexture(l,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const a in this._drawWrappers){var l;null===(l=this._drawWrappers[a].drawContext)||void 0===l||l.reset()}}_addFactorGradient(l,a,N){const U=new ml(a,N);l.push(U),this._releaseBuffers()}addSizeGradient(l,a){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,l,a),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(l){return this._removeGradientAndTexture(l,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(l,a){if(!l)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&l.sort(((l,a)=>l.gradient<a.gradient?-1:l.gradient>a.gradient?1:0));const N=this;N[a]&&(N[a].dispose(),N[a]=null)}addAngularSpeedGradient(l,a){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,l,a),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(l){return this._removeGradientAndTexture(l,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(l,a){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,l,a),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(l){return this._removeGradientAndTexture(l,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(l,a){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,l,a),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(l){return this._removeGradientAndTexture(l,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(l,a){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,l,a),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(l){return this._removeGradientAndTexture(l,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(l){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(l,a,N){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(l),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Tc=new V.e,this.onStoppedObservable=new V.e,this.onStartedObservable=new V.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,N&&"Scene"!==N.getClassName()?(this._engine=N,this.defaultProjectionMatrix=U.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=N||v.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.wy.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,w.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,w.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ll.d(this._engine)},this._customWrappers[0].effect=c,this._drawWrappers={0:new ll.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(a=a??{}).randomTextureSize||delete a.randomTextureSize;const Z={kN:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...a},S=a;isFinite(S)&&(Z.kN=S),this._capacity=Z.kN,this._maxActiveParticleCount=Z.kN,this._currentActiveCount=0,this._isAnimationSheetEnabled=K,this.particleEmitterType=new n;const T=Math.min(this._engine.getCaps().maxTextureSize,Z.randomTextureSize);let J=[];for(let U=0;U<T;++U)J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random());this._randomTexture=new D.d(new Float32Array(J),T,1,5,N,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,J=[];for(let U=0;U<T;++U)J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random());this._randomTexture2=new D.d(new Float32Array(J),T,1,5,N,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=T}_reset(){this._releaseBuffers()}_createVertexBuffers(l,a,N){const U={};U.position=a.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let c=3;U.age=a.createVertexBuffer("age",c,1,this._attributesStrideSize,!0),c+=1,U.size=a.createVertexBuffer("size",c,3,this._attributesStrideSize,!0),c+=3,U.life=a.createVertexBuffer("life",c,1,this._attributesStrideSize,!0),c+=1,c+=4,this.billboardMode===wa.BILLBOARDMODE_STRETCHED&&(U.direction=a.createVertexBuffer("direction",c,3,this._attributesStrideSize,!0)),c+=3,this._platform.alignDataInBuffer&&(c+=1),this.particleEmitterType instanceof A&&(c+=3,this._platform.alignDataInBuffer&&(c+=1)),this._colorGradientsTexture||(U.color=a.createVertexBuffer("color",c,4,this._attributesStrideSize,!0),c+=4),this._isBillboardBased||(U.initialDirection=a.createVertexBuffer("initialDirection",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1)),this.noiseTexture&&(U.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1),U.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1)),U.angle=a.createVertexBuffer("angle",c,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?c++:c+=2,this._isAnimationSheetEnabled&&(U.cellIndex=a.createVertexBuffer("cellIndex",c,1,this._attributesStrideSize,!0),c+=1,this.spriteRandomStartCell&&(U.cellStartOffset=a.createVertexBuffer("cellStartOffset",c,1,this._attributesStrideSize,!0),c+=1)),U.offset=N.createVertexBuffer("offset",0,2),U.uv=N.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(U),this._platform.createVertexBuffers(l,U),this.resetDrawCache()}_initialize(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!l)return;const a=this._engine,N=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof A&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const c=this.particleEmitterType instanceof A,K=U.TmpVectors.ua[0];let Z=0;for(let U=0;U<this._capacity;U++)if(N.push(0),N.push(0),N.push(0),N.push(0),N.push(0),N.push(0),N.push(0),N.push(0),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),c?(this.particleEmitterType.particleDestinationGenerator(U,null,K),N.push(K.x),N.push(K.y),N.push(K.z)):(N.push(0),N.push(0),N.push(0)),this._platform.alignDataInBuffer&&N.push(0),Z+=16,c&&(this.particleEmitterType.particlePositionGenerator(U,null,K),N.push(K.x),N.push(K.y),N.push(K.z),this._platform.alignDataInBuffer&&N.push(0),Z+=4),this._colorGradientsTexture||(N.push(0),N.push(0),N.push(0),N.push(0),Z+=4),this.isBillboardBased||(N.push(0),N.push(0),N.push(0),this._platform.alignDataInBuffer&&N.push(0),Z+=4),this.noiseTexture&&(N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),this._platform.alignDataInBuffer&&N.push(0),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),this._platform.alignDataInBuffer&&N.push(0),Z+=8),N.push(0),Z+=1,this._angularSpeedGradientsTexture||(N.push(0),Z+=1),this._isAnimationSheetEnabled&&(N.push(0),Z+=1,this.spriteRandomStartCell&&(N.push(0),Z+=1)),this._platform.alignDataInBuffer){let l=3-(Z+3&3);for(Z+=l;l-- >0;)N.push(0)}const w=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),S=this._platform.createParticleBuffer(N),T=this._platform.createParticleBuffer(N);this._buffer0=new E.e(a,S,!1,this._attributesStrideSize),this._buffer1=new E.e(a,T,!1,this._attributesStrideSize),this._spriteBuffer=new E.e(a,w,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let l=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(l+="\n#define BILLBOARD"),this._colorGradientsTexture&&(l+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(l+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(l+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(l+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(l+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(l+="\n#define DRAGGRADIENTS"),this._flowMap&&(l+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(l+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(l+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(l+="\n#define NOISE"),this.isLocal&&(l+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===l||(this._cachedUpdateDefines=l,this._updateBuffer=this._platform.createUpdateBuffer(l)),this._platform.isUpdateBufferReady()}_getWrapper(l){const a=this._getCustomDrawWrapper(l);if(null!==a&&void 0!==a&&a.effect)return a;const N=[];this.fillDefines(N,l);let U=this._drawWrappers[l];U||(U=new ll.d(this._engine),U.drawContext&&(U.drawContext.useInstancing=!0),this._drawWrappers[l]=U);const c=N.join("\n");if(U.defines!==c){const l=[],a=[],N=[];this.fillUniformsAttributesAndSamplerNames(a,l,N),U.setEffect(this._engine.createEffect("gpuRenderParticles",l,a,N,c),c)}return U}static _GetAttributeNamesOrOptions(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const c=[E.h.PositionKind,"age","life","size","angle"];return l||c.push(E.h.ColorKind),a&&c.push("cellIndex"),N||c.push("initialDirection"),U&&c.push("direction"),c.push("offset",E.h.UVKind),c}static _GetEffectCreationOptions(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const U=["emitterWM","qT","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,al.c)(U),l&&U.push("sheetInfos"),a&&U.push("logarithmicDepthConstant"),N&&(U.push("vFogInfos"),U.push("vFogColor")),U}fillDefines(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,al.g)(this,this._scene,l),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ta.d.FOGMODE_NONE&&l.push("#define FOG")),a===wa.BLENDMODE_MULTIPLY&&l.push("#define BLENDMULTIPLYMODE"),this.isLocal&&l.push("#define LOCAL"),this.useLogarithmicDepth&&l.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(l.push("#define BILLBOARD"),this.billboardMode){case wa.BILLBOARDMODE_Y:l.push("#define BILLBOARDY");break;case wa.BILLBOARDMODE_STRETCHED:l.push("#define BILLBOARDSTRETCHED");break;case wa.BILLBOARDMODE_ALL:l.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&l.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&l.push("#define ANIMATESHEET"),N&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),l.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(l,a,N){a.push(...Ma._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===wa.BILLBOARDMODE_STRETCHED)),l.push(...Ma._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),N.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Sa.e.PrepareUniforms(l,this._imageProcessingConfigurationDefines),Sa.e.PrepareSamplers(N,this._imageProcessingConfigurationDefines))}animate(){var l;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(a?this.preWarmStepOffset:(null===(l=this._scene)||void 0===l?void 0:l.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(l,a){const N=this[a];if(!l||!l.length||N)return;const U=new Float32Array(this._rawTextureWidth);for(let c=0;c<this._rawTextureWidth;c++){const a=c/this._rawTextureWidth;x.GetCurrentGradient(a,l,((l,a,N)=>{U[c]=(0,T.Lerp)(l.factor1,a.factor1,N)}))}this[a]=D.d.CreateRTexture(U,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[a].name=a.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const l=new Uint8Array(4*this._rawTextureWidth),a=Z.TmpColors.Qc[0];for(let N=0;N<this._rawTextureWidth;N++){const U=N/this._rawTextureWidth;x.GetCurrentGradient(U,this._colorGradients,((U,c,K)=>{Z.Qc.LerpToRef(U.color1,c.color1,K,a),l[4*N]=255*a.r,l[4*N+1]=255*a.g,l[4*N+2]=255*a.b,l[4*N+3]=255*a.a}))}this._colorGradientsTexture=D.d.CreateRGBATexture(l,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(l,a){var N,c,K,Z;const w=this._getWrapper(l),S=w.effect;this._engine.enableEffect(w);const T=(null===(N=this._scene)||void 0===N?void 0:N.getViewMatrix())||U.Matrix.IdentityReadOnly;if(S.setMatrix("view",T),S.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),S.setTexture("diffuseSampler",this.particleTexture),S.setVector2("translationPivot",this.translationPivot),S.setVector3("qT",this.qT),this.isLocal&&S.setMatrix("emitterWM",a),this._colorGradientsTexture?S.setTexture("colorGradientSampler",this._colorGradientsTexture):S.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const l=this.particleTexture.getBaseSize();S.setFloat3("sheetInfos",this.spriteCellWidth/l.width,this.spriteCellHeight/l.height,l.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const l=this._scene.activeCamera;S.setVector3("eyePosition",l.globalPosition)}const J=S.defines;if(this._scene&&((0,al.d)(S,this,this._scene),this.applyFog&&(0,Nl.h)(this._scene,void 0,S)),J.indexOf("#define BILLBOARDMODE_ALL")>=0){const l=T.clone();l.invert(),S.setMatrix("invView",l)}return this.useLogarithmicDepth&&this._scene&&(0,Nl.k)(J,S,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(S),this._setEngineBasedOnBlendMode(l),this._platform.bindDrawBuffers(this._targetIndex,S,null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(S),null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(l){if(!this.Ua||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!l)if(this.Ua.position){l=this.Ua.getWorldMatrix()}else{const a=this.Ua;l=U.TmpVectors.Matrix[0],U.Matrix.TranslationToRef(a.x,a.y,a.z,l)}const a=this._engine,N=a.getDepthWrite();if(a.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const l=this.bl();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",l.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",l),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const c=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=c,a.setDepthWrite(N)}render(){let l,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!a&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let l=0;l<this.preWarmCycles;l++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const l=0|this._accumulatedCount;this._accumulatedCount-=l,this._currentActiveCount+=l}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Ua.position){l=this.Ua.getWorldMatrix()}else{const a=this.Ua;l=U.TmpVectors.Matrix[0],U.Matrix.TranslationToRef(a.x,a.y,a.z,l)}const c=this._engine;this.updateInAnimate||this._update(l);let K=0;return a||N||(c.setState(!1),this.forceDepthWrite&&c.setDepthWrite(!0),K=this.blendMode===wa.BLENDMODE_MULTIPLYADD?this._render(wa.BLENDMODE_MULTIPLY,l)+this._render(wa.BLENDMODE_ADD,l):this._render(this.blendMode,l),this._engine.setAlphaMode(0)),K}rebuild(){const l=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(l,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,l()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const a in this._drawWrappers){this._drawWrappers[a].dispose()}if(this._drawWrappers={},this._scene){const l=this._scene.wy.indexOf(this);l>-1&&this._scene.wy.splice(l,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let a=0;a<this._renderVertexBuffers.length;++a){const l=this._renderVertexBuffers[a];for(const a in l)l[a].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),l&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),l&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Tc.notifyObservers(this),this.Tc.clear()}clone(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const U={...this._customWrappers};let c=null;const K=this._engine;if(K.createEffectForParticles&&null!=this.customShader){c=this.customShader;const l=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"";U[0]=K.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,l,void 0,void 0,void 0,this)}const Z=this.serialize(N),w=Ma.Parse(Z,this._scene||this._engine,this._rootUrl);return w.name=l,w.customShader=c,w._customWrappers=U,void 0===a&&(a=this.Ua),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.Ua=a,w}serialize(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};return wa._Serialize(a,this,l),a.activeParticleCount=this.activeParticleCount,a.randomTextureSize=this._randomTextureSize,a.customShader=this.customShader,a}static Parse(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0;const K=l.name;let Z,w;a instanceof ma.c?Z=a:(w=a,Z=w.getEngine());const S=new Ma(K,{kN:c||l.kN,randomTextureSize:l.randomTextureSize},a,null,l.isAnimationSheetEnabled);if(S._rootUrl=N,l.customShader&&Z.createEffectForParticles){const a=l.customShader,N=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"",U=Z.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,N,void 0,void 0,void 0,S);S.setCustomEffect(U,0),S.customShader=a}return l.id&&(S.id=l.id),l.activeParticleCount&&(S.activeParticleCount=l.activeParticleCount),wa._Parse(l,S,a,N),l.preventAutoStart&&(S.preventAutoStart=l.preventAutoStart),U||S.preventAutoStart||S.start(),S}}var Aa=N(12254),Ea=N(13807),qa=N(12811);class ba{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(l){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const a of this.systems)a.Ua=l;this._emitterNode=l}setEmitterAsSphere(l,a,N){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:l,renderingGroupId:a};const U=(0,Ea.b)("emitterSphere",{diameter:l.diameter,segments:l.segments},N);U.renderingGroupId=a;const c=new qa.Ya("emitterSphereMaterial",N);c.emissiveColor=l.color,U.material=c;for(const K of this.systems)K.Ua=U;this._emitterNode=U}start(l){for(const a of this.systems)l&&(a.Ua=l),a.start()}dispose(){for(const l of this.systems)l.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={systems:[]};for(const N of this.systems)a.systems.push(N.serialize(l));return this._emitterNode&&(a.Ua=this._emitterCreationOptions),a}static Parse(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3?arguments[3]:void 0;const c=new ba,K=this.BaseAssetsUrl+"/textures/";a=a||v.e.LastCreatedScene;for(const Z of l.systems)c.systems.push(N?Ma.Parse(Z,a,K,!0,U):wa.Parse(Z,a,K,!0,U));if(l.Ua){const N=l.Ua.options;if("Sphere"===l.Ua.kind)c.setEmitterAsSphere({diameter:N.diameter,segments:N.segments,color:Z.Ca.Ma(N.color)},l.Ua.renderingGroupId,a)}return c}}ba.BaseAssetsUrl="https://assets.babylonjs.com/particles";var za=N(12292);class Ia{static CreateDefault(l){let a,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,U=arguments.length>2?arguments[2]:void 0;a=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Ma("default system",{kN:N},U):new wa("default system",N,U),a.Ua=l;const c=Aa.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return a.particleTexture=new f.e(c,a.bl()),a.createConeEmitter(.1,Math.PI/4),a.color1=new Z.Qc(1,1,1,1),a.color2=new Z.Qc(1,1,1,1),a.colorDead=new Z.Qc(1,1,1,0),a.minSize=.1,a.maxSize=.1,a.minEmitPower=2,a.maxEmitPower=2,a.updateSpeed=1/60,a.emitRate=30,a}static CreateAsync(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3?arguments[3]:void 0;a||(a=v.e.LastCreatedScene);const c={};return a.addPendingData(c),new Promise(((K,Z)=>{if(N&&!Ma.IsSupported)return a.removePendingData(c),Z("Particle system with GPU is not supported.");Aa.Tools.LoadFile(`${Ia.BaseAssetsUrl}/systems/${l}.json`,(l=>{a.removePendingData(c);const Z=JSON.parse(l.toString());return K(ba.Parse(Z,a,N,U))}),void 0,void 0,void 0,(()=>(a.removePendingData(c),Z(`An error occurred with the creation of your particle system. Check if your type '${l}' exists.`))))}))}static ExportSet(l){const a=new ba;for(const N of l)a.systems.push(N);return a}static ParseFromFileAsync(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",K=arguments.length>5?arguments[5]:void 0;return new Promise(((Z,w)=>{const S=new za.c;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const a=JSON.parse(S.responseText);let w;w=U?Ma.Parse(a,N,c,!1,K):wa.Parse(a,N,c,!1,K),l&&(w.name=l),Z(w)}else w("Unable to load the particle system")})),S.open("GET",a),S.send()}))}static ParseFromSnippetAsync(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",c=arguments.length>4?arguments[4]:void 0;if("_BLANK"===l){const l=this.CreateDefault(null);return l.start(),Promise.resolve(l)}return new Promise(((K,Z)=>{const w=new za.c;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const Z=JSON.parse(JSON.parse(w.responseText).jsonPayload),S=JSON.parse(Z.particleSystem);let T;T=N?Ma.Parse(S,a,U,!1,c):wa.Parse(S,a,U,!1,c),T.snippetId=l,K(T)}else Z("Unable to load the snippet "+l)})),w.open("GET",this.SnippetUrl+"/"+l.replace(/#/g,"/")),w.send()}))}}Ia.BaseAssetsUrl=ba.BaseAssetsUrl,Ia.SnippetUrl="https://snippet.babylonjs.com",Ia.CreateFromSnippetAsync=Ia.ParseFromSnippetAsync;var ta=N(12883),Oa=N(12710),ha=N(13809);(0,ha.f)(Oa.e.NAME_PARTICLESYSTEM,((l,a,N,U)=>{const c=(0,ha.i)(Oa.e.NAME_PARTICLESYSTEM);if(c&&void 0!==l.wy&&null!==l.wy)for(let K=0,Z=l.wy.length;K<Z;K++){const Z=l.wy[K];N.wy.push(c(Z,a,U))}})),(0,ha.c)(Oa.e.NAME_PARTICLESYSTEM,((l,a,N)=>{if(l.activeParticleCount){return Ma.Parse(l,a,N)}return wa.Parse(l,a,N)})),ma.c.prototype.createEffectForParticles=function(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",K=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0,S=arguments.length>7?arguments[7]:void 0,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,J=arguments.length>9?arguments[9]:void 0,n=[],y=[];const H=[];return S?S.fillUniformsAttributesAndSamplerNames(y,n,H):(n=wa._GetAttributeNamesOrOptions(),y=wa._GetEffectCreationOptions()),-1===c.indexOf(" BILLBOARD")&&(c+="\n#define BILLBOARD\n"),null!==S&&void 0!==S&&S.isAnimationSheetEnabled&&-1===c.indexOf(" ANIMATESHEET")&&(c+="\n#define ANIMATESHEET\n"),-1===U.indexOf("diffuseSampler")&&U.push("diffuseSampler"),this.createEffect({vertex:J??(null===S||void 0===S?void 0:S.vertexShaderName)??"particles",fragmentElement:l},n,y.concat(a),H.concat(U),c,K,Z,w,void 0,T,(async()=>{0===T?await Promise.resolve().then(N.bind(N,13838)):await Promise.resolve().then(N.bind(N,13907))}))},ta.d.prototype.getEmittedParticleSystems=function(){const l=[];for(let a=0;a<this.bl().wy.length;a++){const N=this.bl().wy[a];N.Ua===this&&l.push(N)}return l},ta.d.prototype.getHierarchyEmittedParticleSystems=function(){const l=[],a=this.getDescendants();a.push(this);for(let N=0;N<this.bl().wy.length;N++){const U=this.bl().wy[N],c=U.Ua;c.position&&-1!==a.indexOf(c)&&l.push(U)}return l};N(12771),N(12783),N(12868);N(12870),N(13814),N(12632),N(12757),N(12897);N(12628);var ia;N(13818),N(12467);!function(l){l[l.Color=2]="Color",l[l.UV=1]="UV",l[l.Random=0]="Random",l[l.Stated=3]="Stated"}(ia||(ia={}));var ka=N(12668);const Qa=new U.ua(0,0,0),ja=new U.ua(0,0,0),fa=new U.ua(0,0,0);class pa{constructor(l,a,N){this.width=l,this.height=a,this.data=N}processFlowable(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2?arguments[2]:void 0;if(!N)return;N instanceof U.Matrix?U.ua.TransformCoordinatesToRef(l.position,N,fa):(fa.x=N.x,fa.y=N.y,fa.z=N.z);const c=.5*fa.x+.5,K=1-(.5*fa.y+.5),Z=Math.floor(c*this.width),w=Math.floor(K*this.height);if(Z<0||Z>=this.width||w<0||w>=this.height)return;const S=4*(w*this.width+Z),T=this.data[S]/255*2-1,J=this.data[S+1]/255*2-1,n=this.data[S+2]/255*2-1,y=this.data[S+3]/255;Qa.set(T,J,n),Qa.scaleToRef(a*y,ja),l.direction.addInPlace(ja)}_processParticle(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2?arguments[2]:void 0;this.processFlowable(l,a,N)}static async FromUrlAsync(l){return await new Promise(((a,N)=>{const U=document.createElement("canvas"),c=U.getContext("2d");let K=null;const Z=new Image;Z.crossOrigin="anonymous",Z.src=l,Z.onerror=a=>{N(new Error(`Failed to load image: ${l} : ${a}`))},Z.onload=()=>{U.width=Z.width,U.height=Z.height,c.drawImage(Z,0,0),K=c.getImageData(0,0,U.width,U.height),a(new pa(U.width,U.height,K.data))}}))}static async ExtractFromTextureAsync(l){return await new Promise(((a,N)=>{if(!l.isReady())return void l.onLoadObservable.addOnce((async()=>{try{const N=await this.ExtractFromTextureAsync(l);a(N)}catch(U){N(U)}}));const U=l.getSize();ka.k.GetTextureDataAsync(l,U.width,U.height).then((l=>{a(new pa(U.width,U.height,new Uint8ClampedArray(l)))})).catch(N)}))}}var Ra,La,ra,Xa,Pa,da,Fa,ea,sa;!function(l){l[l.Int=1]="Int",l[l.Float=2]="Float",l[l.Vector2=4]="Vector2",l[l.ua=8]="ua",l[l.Matrix=16]="Matrix",l[l.Particle=32]="Particle",l[l.Texture=64]="Texture",l[l.Qc=128]="Qc",l[l.FloatGradient=256]="FloatGradient",l[l.Vector2Gradient=512]="Vector2Gradient",l[l.Vector3Gradient=1024]="Vector3Gradient",l[l.Color4Gradient=2048]="Color4Gradient",l[l.System=4096]="System",l[l.AutoDetect=8192]="AutoDetect",l[l.BasedOnInput=16384]="BasedOnInput",l[l.Undefined=32768]="Undefined",l[l.All=65535]="All"}(Ra||(Ra={})),function(l){l[l.Compatible=0]="Compatible",l[l.TypeIncompatible=1]="TypeIncompatible",l[l.HierarchyIssue=2]="HierarchyIssue"}(La||(La={})),function(l){l[l.Input=0]="Input",l[l.Output=1]="Output"}(ra||(ra={}));class oa{get direction(){return this._direction}get type(){if(this._type===Ra.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Ra.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(l){this._type=l}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((l=>l.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(l,a,N){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Ra.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new V.e,this.onDisconnectionObservable=new V.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=a,this.name=l,this._direction=N}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(l){var a;return this.isConnected?null!==(a=this._connectedPoint)&&void 0!==a&&a._storedFunction?this._connectedPoint._storedFunction(l):this._connectedPoint._storedValue:this.value}canConnectTo(l){return 0===this.checkCompatibilityState(l)}checkCompatibilityState(l){const a=this._ownerBlock,N=l.ownerBlock;if(this.type!==l.type&&l.innerType!==Ra.AutoDetect)return l.acceptedConnectionPointTypes&&-1!==l.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(l.excludedConnectionPointTypes&&-1!==l.excludedConnectionPointTypes.indexOf(this.type))return 1;let U=N,c=a;return 0===this.direction&&(U=a,c=N),U.isAnAncestorOf(c)?2:0}connectTo(l){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(l))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${l.ownerBlock.name}".${l.name}`;return this._endpoints.push(l),l._connectedPoint=this,this.onConnectionObservable.notifyObservers(l),l.onConnectionObservable.notifyObservers(this),this}disconnectFrom(l){const a=this._endpoints.indexOf(l);return-1===a||(this._endpoints.splice(a,1),l._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(l),l.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(l){let a=1;for(;a<Ra.All;)l&a||this.excludedConnectionPointTypes.push(a),a<<=1}serialize(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a={};return a.name=this.name,a.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Bc?(a.valueType="BABYLON."+this.value.getClassName(),a.value=this.value.Bc()):(a.valueType="number",a.value=this.value)),l&&this.connectedPoint&&(a.inputName=this.name,a.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,a.targetConnectionName=this.connectedPoint.name,a.isExposedOnFrame=!0,a.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(a.isExposedOnFrame=!0,a.exposedPortPosition=this.exposedPortPosition),a}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Ga{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(l){this._name=l}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(l){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new V.e,this.Tc=new V.e,this.onInputChangedObservable=new V.e,this.visibleOnFrame=!1,this._name=l,this.uniqueId=p.c.UniqueId}_inputRename(l){return l}_outputRename(l){return l}isAnAncestorOf(l){for(const a of this._outputs)if(a.hasEndpoints)for(const N of a.endpoints){if(N.ownerBlock===l)return!0;if(N.ownerBlock.isAnAncestorOf(l))return!0}return!1}isAnAncestorOfType(l){if(this.getClassName()===l)return!0;for(const a of this._outputs)if(a.hasEndpoints)for(const N of a.endpoints)if(N.ownerBlock.isAnAncestorOfType(l))return!0;return!1}getInputByName(l){const a=this._inputs.filter((a=>a.name===l));return a.length?a[0]:null}_linkConnectionTypes(l,a){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[a]._acceptedConnectionPointType=this._inputs[l]:(this._inputs[l]._linkedConnectionSource=this._inputs[a],this._inputs[l]._isMainLinkSource=!0),this._inputs[a]._linkedConnectionSource=this._inputs[l]}registerInput(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0;const Z=new oa(l,this,0);return Z.type=a,Z.isOptional=N,Z.defaultValue=U,Z.value=U,Z.valueMin=c,Z.valueMax=K,this._inputs.push(Z),this.onInputChangedObservable.notifyObservers(Z),this}registerOutput(l,a,N){return(N=N??new oa(l,this,1)).type=a,this._outputs.push(N),this}_build(l){}_customBuildStep(l){}build(l){if(this._buildId===l.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((l=>l.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=l.buildId;for(const a of this._inputs){if(!a.connectedPoint){a.isOptional||l.notConnectedNonOptionalInputs.push(a);continue}const N=a.connectedPoint.ownerBlock;N&&N!==this&&!N.isSystem&&N.build(l)}return this._customBuildStep(l),l.verbose&&R.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(l),this.onBuildObservable.notifyObservers(this),!1}serialize(){const l={};l.customType="BABYLON."+this.getClassName(),l.id=this.uniqueId,l.name=this.name,l.visibleOnFrame=this.visibleOnFrame,l.inputs=[],l.outputs=[];for(const a of this.inputs)l.inputs.push(a.serialize());for(const a of this.outputs)l.outputs.push(a.serialize(!1));return l}_deserialize(l){this._name=l.name,this.comments=l.comments,this.visibleOnFrame=!!l.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(l)}_deserializePortDisplayNamesAndExposedOnFrame(l){const a=l.inputs,N=l.outputs;if(a)for(const U of a){const l=this.inputs.find((l=>l.name===U.name));if(!l)return;if(U.displayName&&(l.displayName=U.displayName),U.isExposedOnFrame&&(l.isExposedOnFrame=U.isExposedOnFrame,l.exposedPortPosition=U.exposedPortPosition),void 0!==U.value&&null!==U.value)if("number"===U.valueType)l.value=U.value;else{const a=(0,w.e)(U.valueType);a&&(l.value=a.Ma(U.value))}}if(N)for(let U=0;U<N.length;U++){const l=N[U];l.displayName&&(this.outputs[U].displayName=l.displayName),l.isExposedOnFrame&&(this.outputs[U].isExposedOnFrame=l.isExposedOnFrame,this.outputs[U].exposedPortPosition=l.exposedPortPosition)}}clone(){const l=this.serialize(),a=(0,w.e)(l.customType);if(a){const N=new a;return N._deserialize(l),N}return null}dispose(){this.Tc.notifyObservers(this),this.Tc.clear();for(const l of this.inputs)l.dispose();for(const l of this.outputs)l.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function mN(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",U=arguments.length>3?arguments[3]:void 0;return(c,K)=>{let Z=c._propStore;Z||(Z=[],c._propStore=Z),Z.push({propertyName:K,displayName:l,type:a,groupName:N,options:U??{},className:c.getClassName()})}}(0,k.d)([(0,Q.K)("comment")],Ga.prototype,"comments",void 0),function(l){l[l.Boolean=0]="Boolean",l[l.Float=1]="Float",l[l.Int=2]="Int",l[l.Vector2=3]="Vector2",l[l.List=4]="List",l[l.Qc=5]="Qc",l[l.SamplingMode=6]="SamplingMode",l[l.TextureFormat=7]="TextureFormat",l[l.TextureType=8]="TextureType"}(Xa||(Xa={})),function(l){l[l.None=0]="None",l[l.Position=1]="Position",l[l.Direction=2]="Direction",l[l.Age=3]="Age",l[l.Lifetime=4]="Lifetime",l[l.Color=5]="Color",l[l.ScaledDirection=6]="ScaledDirection",l[l.Scale=7]="Scale",l[l.AgeGradient=8]="AgeGradient",l[l.Angle=9]="Angle",l[l.SpriteCellIndex=16]="SpriteCellIndex",l[l.SpriteCellStart=17]="SpriteCellStart",l[l.SpriteCellEnd=18]="SpriteCellEnd"}(Pa||(Pa={})),function(l){l[l.None=0]="None",l[l.Time=1]="Time",l[l.Delta=2]="Delta",l[l.Emitter=3]="Emitter"}(da||(da={}));class xa{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let l="";for(const a of this.notConnectedNonOptionalInputs)l+=`input ${a.name} from block ${a.ownerBlock.name}[${a.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(l)throw"Build of Node Particle System Set failed:\n"+l}adapt(l,a){const N=l.getConnectedValue(this)||0;if(l.type===a)return N;switch(a){case Ra.Vector2:return new U.Vector2(N,N);case Ra.ua:return new U.ua(N,N,N);case Ra.Qc:return new Z.Qc(N,N,N,N)}return null}getContextualValue(l){if(!this.particleContext||!this.systemContext)return null;switch(l){case Pa.Position:return this.particleContext.position;case Pa.Direction:return this.particleContext.direction;case Pa.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Pa.Color:return this.particleContext.color;case Pa.Age:return this.particleContext.age;case Pa.Lifetime:return this.particleContext.lifeTime;case Pa.Angle:return this.particleContext.angle;case Pa.Scale:return this.particleContext.scale;case Pa.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Pa.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Pa.SpriteCellIndex:return this.particleContext.cellIndex;case Pa.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Ua.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Ua.absolutePosition:this.systemContext.Ua:null}getSystemValue(l){if(!this.particleContext||!this.systemContext)return null;switch(l){case da.Time:return this.systemContext._actualFrame;case da.Delta:return this.systemContext._scaledUpdateSpeed;case da.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Ua.absolutePosition}return this.systemContext.Ua}return null}}function Va(l,a,N){const U=new xa;U.Ba=a;const c=l.createSystem(U);return c.canStart=()=>!0,c.Ua=N.clone(),c.disposeOnStop=!0,c.start(),c}class Da extends Ga{constructor(l){super(l),this.blendMode=S.BLENDMODE_ONEONE,this.kN=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Ra.Particle),this.registerInput("texture",Ra.Texture),this.registerInput("onStart",Ra.System,!0),this.registerInput("onEnd",Ra.System,!0),this.registerOutput("system",Ra.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(l){l.kN=this.kN,l.buildId=this._buildId++,this.build(l);const a=this.particle.getConnectedValue(l);return a.particleTexture=this.texture.getConnectedValue(l),a.emitRate=this.emitRate,a.blendMode=this.blendMode,a.name=this.name,a._nodeGenerated=!0,a._targetStopDuration=this.targetStopDuration,a.startDelay=this.startDelay,this.system._storedValue=this,a.canStart=()=>!this.doNoStart,a.onStartedObservable.add((N=>{const U=this.onStart.getConnectedValue(l);U&&N.onStartedObservable.addOnce((()=>{l.systemContext=a;const N=Va(U,l.Ba,l.emitterPosition);this.Tc.addOnce((()=>{N.dispose()}))}));const c=this.onEnd.getConnectedValue(l);c&&N.onStoppedObservable.addOnce((()=>{l.systemContext=a;const N=Va(c,l.Ba,l.emitterPosition);this.Tc.addOnce((()=>{N.dispose()}))}))})),this.Tc.addOnce((()=>{a.dispose()})),a}serialize(){const l=super.serialize();return l.kN=this.kN,l.emitRate=this.emitRate,l.blendMode=this.blendMode,l.doNoStart=this.doNoStart,l.targetStopDuration=this.targetStopDuration,l.startDelay=this.startDelay,l}_deserialize(l){super._deserialize(l),this.kN=l.kN,this.emitRate=l.emitRate,this.doNoStart=!!l.doNoStart,void 0!==l.blendMode&&(this.blendMode=l.blendMode),void 0!==l.targetStopDuration&&(this.targetStopDuration=l.targetStopDuration),void 0!==l.startDelay&&(this.startDelay=l.startDelay)}}(0,k.d)([mN("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:S.BLENDMODE_ONEONE},{label:"Standard",value:S.BLENDMODE_STANDARD},{label:"Add",value:S.BLENDMODE_ADD},{label:"Multiply",value:S.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:S.BLENDMODE_MULTIPLYADD}]})],Da.prototype,"blendMode",void 0),(0,k.d)([mN("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Da.prototype,"kN",void 0),(0,k.d)([mN("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Da.prototype,"emitRate",void 0),(0,k.d)([mN("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Da.prototype,"targetStopDuration",void 0),(0,k.d)([mN("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Da.prototype,"startDelay",void 0),(0,k.d)([mN("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Da.prototype,"doNoStart",void 0),(0,w.g)("BABYLON.SystemBlock",Da);class va extends Ga{get type(){if(this._type===Ra.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Ra.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Ra.Vector2,this._type;case"ua":return this._type=Ra.ua,this._type;case"Qc":return this._type=Ra.Qc,this._type;case"Matrix":return this._type=Ra.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Pa.None&&this._systemSource!==da.None}get systemSource(){return this._systemSource}set systemSource(l){if(this._systemSource=l,l!==da.None){switch(this._contextualSource=Pa.None,this._type=Ra.Float,l){case da.Time:case da.Delta:this._type=Ra.Float;break;case da.Emitter:this._type=Ra.ua}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Pa.None}get contextualValue(){return this._contextualSource}set contextualValue(l){if(this._contextualSource=l,l!==Pa.None){switch(this._systemSource=da.None,l){case Pa.Scale:this._type=Ra.Vector2;break;case Pa.Position:case Pa.Direction:case Pa.ScaledDirection:this._type=Ra.ua;break;case Pa.Color:this._type=Ra.Qc;break;case Pa.Age:case Pa.Lifetime:case Pa.Angle:case Pa.AgeGradient:this._type=Ra.Float;break;case Pa.SpriteCellEnd:case Pa.SpriteCellStart:case Pa.SpriteCellIndex:this._type=Ra.Int}this.output&&(this.output.type=this._type)}}constructor(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ra.AutoDetect;super(l),this._type=Ra.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new V.e,this._systemSource=da.None,this._contextualSource=Pa.None,this._type=a,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",a)}get value(){return this._storedValue}set value(l){this.type===Ra.Float&&this.min!==this.max&&(l=Math.max(this.min,l),l=Math.min(this.max,l)),this._storedValue=l,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(l){this._valueCallback=l}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Ra.Int:case Ra.Float:this.value=0;break;case Ra.Vector2:this.value=U.Vector2.Zero();break;case Ra.ua:this.value=U.ua.Zero();break;case Ra.Qc:this.value=new Z.Qc(1,1,1,1);break;case Ra.Matrix:this.value=U.Matrix.Identity()}}_build(l){super._build(l),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=l=>l.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=l=>l.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const l=super.serialize();return l.type=this.type,l.contextualValue=this.contextualValue,l.systemSource=this.systemSource,l.min=this.min,l.max=this.max,l.groupInInspector=this.groupInInspector,l.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Bc?(l.valueType="BABYLON."+this._storedValue.getClassName(),l.value=this._storedValue.Bc()):(l.valueType="number",l.value=this._storedValue)),l}_deserialize(l){if(super._deserialize(l),this._type=l.type,this.contextualValue=l.contextualValue,this.systemSource=l.systemSource||da.None,this.min=l.min||0,this.max=l.max||0,this.groupInInspector=l.groupInInspector||"",void 0!==l.displayInInspector&&(this.displayInInspector=l.displayInInspector),l.valueType)if("number"===l.valueType)this._storedValue=l.value;else{const a=(0,w.e)(l.valueType);a&&(this._storedValue=a.Ma(l.value))}}}(0,w.g)("BABYLON.ParticleInputBlock",va);class ga extends Ga{get url(){return this._url}set url(l){this._url!==l&&(this._cachedData=null,this._url=l,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(l){this._textureDataUrl!==l&&(this._cachedData=null,this._textureDataUrl=l,this._url="",this._sourceTexture=null)}set sourceTexture(l){this._sourceTexture!==l&&(this._cachedData=null,this._sourceTexture=l,this._url="",this._textureDataUrl="")}constructor(l){super(l),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Ra.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const l=this.texture._storedValue;return await new Promise(((a,N)=>{if(!l.isReady())return void l.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),a(this._cachedData)}catch(l){N(l)}}));const U=l.getSize();ka.k.GetTextureDataAsync(l,U.width,U.height).then((N=>{this._cachedData={width:U.width,height:U.height,data:new Uint8ClampedArray(N)},l.dispose(),a(this._cachedData)})).catch(N)}))}_build(l){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new f.e(this._textureDataUrl,l.Ba):this.texture._storedValue=new f.e(this._url,l.Ba):this.texture._storedValue=null}serialize(){const l=super.serialize();return l.url=this.url,l.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(l.textureDataUrl=this.textureDataUrl),l}_deserialize(l){super._deserialize(l),this.url=l.url,this.serializedCachedData=!!l.serializedCachedData,l.textureDataUrl&&(this.textureDataUrl=l.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,w.g)("BABYLON.ParticleTextureSourceBlock",ga);class lN extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("position",Ra.ua),this.registerOutput("output",Ra.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(l){const a=this.particle.getConnectedValue(l);if(this.output._storedValue=a,!this.position.isConnected)return;const N={process:N=>{l.particleContext=N,l.systemContext=a,N.position.K(this.position.getConnectedValue(l))},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N}}(0,w.g)("BABYLON.UpdatePositionBlock",lN),function(l){l[l.Add=0]="Add",l[l.Subtract=1]="Subtract",l[l.Multiply=2]="Multiply",l[l.Divide=3]="Divide",l[l.Max=4]="Max",l[l.Min=5]="Min"}(Fa||(Fa={}));class aN extends Ga{constructor(l){super(l),this.operation=Fa.Add,this.registerInput("left",Ra.AutoDetect),this.registerInput("right",Ra.AutoDetect),this.registerOutput("output",Ra.BasedOnInput),this.output._typeConnectionSource=this.left;const a=[Ra.Matrix,Ra.Particle,Ra.Texture,Ra.System,Ra.FloatGradient,Ra.Color4Gradient,Ra.Vector2Gradient,Ra.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...a),this.right.excludedConnectionPointTypes.push(...a),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(l){let a;const N=this.left,c=this.right;if(!N.isConnected||!c.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const K=N.type===Ra.Float||N.type===Ra.Int,w=c.type===Ra.Float||c.type===Ra.Int,S=K&&w;switch(this.operation){case Fa.Add:a=S?l=>N.getConnectedValue(l)+c.getConnectedValue(l):K?l=>l.adapt(N,c.type).add(c.getConnectedValue(l)):l=>N.getConnectedValue(l).add(l.adapt(c,N.type));break;case Fa.Subtract:a=S?l=>N.getConnectedValue(l)-c.getConnectedValue(l):K?l=>l.adapt(N,c.type).Wa(c.getConnectedValue(l)):l=>N.getConnectedValue(l).Wa(l.adapt(c,N.type));break;case Fa.Multiply:a=S?l=>N.getConnectedValue(l)*c.getConnectedValue(l):K?l=>l.adapt(N,c.type).multiply(c.getConnectedValue(l)):l=>N.getConnectedValue(l).multiply(l.adapt(c,N.type));break;case Fa.Divide:a=S?l=>N.getConnectedValue(l)/c.getConnectedValue(l):K?l=>l.adapt(N,c.type).divide(c.getConnectedValue(l)):l=>N.getConnectedValue(l).divide(l.adapt(c,N.type));break;case Fa.Min:if(S)a=l=>Math.min(N.getConnectedValue(l),c.getConnectedValue(l));else{const[l,w]=K?[c,N]:[N,c];switch(l.type){case Ra.Vector2:a=a=>U.Vector2.Minimize(l.getConnectedValue(a),a.adapt(w,l.type));break;case Ra.ua:a=a=>U.ua.Minimize(l.getConnectedValue(a),a.adapt(w,l.type));break;case Ra.Qc:a=a=>{const N=l.getConnectedValue(a),{r:U,g:c,b:K,a:S}=a.adapt(w,l.type);return new Z.Qc(Math.min(N.r,U),Math.min(N.g,c),Math.min(N.b,K),Math.min(N.a,S))}}}break;case Fa.Max:if(!S){const[l,w]=K?[c,N]:[N,c];switch(l.type){case Ra.Vector2:a=a=>U.Vector2.Maximize(l.getConnectedValue(a),a.adapt(w,l.type));break;case Ra.ua:a=a=>U.ua.Maximize(l.getConnectedValue(a),a.adapt(w,l.type));break;case Ra.Qc:a=a=>{const N=l.getConnectedValue(a),{r:U,g:c,b:K,a:S}=a.adapt(w,l.type);return new Z.Qc(Math.max(N.r,U),Math.min(N.g,c),Math.min(N.b,K),Math.min(N.a,S))}}break}a=l=>Math.max(N.getConnectedValue(l),c.getConnectedValue(l))}this.output._storedFunction=l=>N.type===Ra.Int?0|a(l):a(l)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Ra.Int||this.left.type===Ra.Float&&this.right.type!==Ra.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[l,a]of[[this.left,this.right],[this.right,this.left]])l.acceptedConnectionPointTypes=[Ra.Int,Ra.Float],a.isConnected&&(l.acceptedConnectionPointTypes.push(a.type),a.type!==Ra.Int&&a.type!==Ra.Float||l.acceptedConnectionPointTypes.push(Ra.Vector2,Ra.ua,Ra.Qc))}dispose(){super.dispose();for(const l of this._connectionObservers)l.remove();this._connectionObservers.length=0}serialize(){const l=super.serialize();return l.operation=this.operation,l}_deserialize(l){super._deserialize(l),this.operation=l.operation}}(0,k.d)([mN("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Fa.Add},{label:"Subtract",value:Fa.Subtract},{label:"Multiply",value:Fa.Multiply},{label:"Divide",value:Fa.Divide},{label:"Max",value:Fa.Max},{label:"Min",value:Fa.Min}]})],aN.prototype,"operation",void 0),(0,w.g)("BABYLON.ParticleMathBlock",aN);class NN extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("direction1",Ra.ua,!0,new U.ua(0,1,0)),this.registerInput("direction2",Ra.ua,!0,new U.ua(0,1,0)),this.registerInput("minEmitBox",Ra.ua,!0,new U.ua(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Ra.ua,!0,new U.ua(.5,.5,.5)),this.registerOutput("output",Ra.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(l){const a=this.particle.getConnectedValue(l);a._directionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.direction1.getConnectedValue(l),K=this.direction2.getConnectedValue(l),Z=(0,T.RandomRange)(c.x,K.x),w=(0,T.RandomRange)(c.y,K.y),S=(0,T.RandomRange)(c.z,K.z);l.isEmitterTransformNode?U.ua.TransformNormalFromFloatsToRef(Z,w,S,l.emitterWorldMatrix,N.direction):N.direction.tc(Z,w,S)},a._positionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.minEmitBox.getConnectedValue(l),K=this.maxEmitBox.getConnectedValue(l),Z=(0,T.RandomRange)(c.x,K.x),w=(0,T.RandomRange)(c.y,K.y),S=(0,T.RandomRange)(c.z,K.z);l.isEmitterTransformNode?U.ua.TransformCoordinatesFromFloatsToRef(Z,w,S,l.emitterWorldMatrix,N.position):(N.position.tc(Z,w,S),N.position.addInPlace(l.emitterPosition))},this.output._storedValue=a}}(0,w.g)("BABYLON.BoxShapeBlock",NN);class UN extends Ga{constructor(l){super(l),this.registerInput("emitPower",Ra.Float,!0,1),this.registerInput("lifeTime",Ra.Float,!0,1),this.registerInput("color",Ra.Qc,!0,new Z.Qc(1,1,1,1)),this.registerInput("scale",Ra.Vector2,!0,new U.Vector2(1,1)),this.registerInput("angle",Ra.Float,!0,0),this.registerOutput("particle",Ra.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(l){const a=new wa(this.name,l.kN,l.Ba,null,!1,void 0,!0);a.particleEmitterType=new Y,a._lifeTimeCreation.process=(a,N)=>{l.particleContext=a,a.lifeTime=this.lifeTime.getConnectedValue(l),N._emitPower=this.emitPower.getConnectedValue(l)},a._colorCreation.process=a=>{l.particleContext=a,a.color.K(this.color.getConnectedValue(l))},a._sizeCreation.process=a=>{l.particleContext=a,a.size=1,a.scale.K(this.scale.getConnectedValue(l))},a._angleCreation.process=a=>{l.particleContext=a,a.angle=this.angle.getConnectedValue(l)},this.particle._storedValue=a}}(0,w.g)("BABYLON.CreateParticleBlock",UN);class cN{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const l=[];for(const a of this.attachedBlocks)a.isInput&&l.push(a);return l}constructor(l){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new V.e,this.name=l}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(l){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(l)&&this.attachedBlocks.push(l);for(const N of l.inputs){const U=N.connectedPoint;if(U){const N=U.ownerBlock;N!==l&&this._initializeBlock(N,a)}}}async buildAsync(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((N=>{const U=new ba;for(const l of this._systemBlocks)this._initializeBlock(l);for(const c of this.systemBlocks){const N=new xa;N.buildId=this._buildId++,N.Ba=l,N.verbose=a;const K=c.createSystem(N);N.emitErrors(),U.systems.push(K)}this.onBuildObservable.notifyObservers(this),N(U)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const l=new Da("Particle system"),a=new lN("Update position");a.output.connectTo(l.particle);const N=new va("Position");N.contextualValue=Pa.Position;const U=new va("Scaled direction");U.contextualValue=Pa.ScaledDirection;const c=new aN("Add");c.operation=Fa.Add,N.output.connectTo(c.left),U.output.connectTo(c.right),c.output.connectTo(a.position);const K=new UN("Create particle"),Z=new NN("Box shape");K.particle.connectTo(Z.particle),Z.output.connectTo(a.particle);const w=new ga("Texture");w.texture.connectTo(l.texture),w.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(l)}removeBlock(l){const a=this.attachedBlocks.indexOf(l);if(a>-1&&this.attachedBlocks.splice(a,1),l.isSystem){const a=this._systemBlocks.indexOf(l);a>-1&&this._systemBlocks.splice(a,1)}}parseSerializedObject(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a||this.clear();const N={};for(const U of l.qJ){const l=(0,w.e)(U.customType);if(l){const a=new l;a._deserialize(U),N[U.id]=a,this.attachedBlocks.push(a),a.isSystem&&this._systemBlocks.push(a)}}for(const U of this.attachedBlocks)if(U.isTeleportOut){const l=U,a=l._tempEntryPointUniqueId;if(a){const U=N[a];U&&U.attachToEndpoint(l)}}for(let U=0;U<l.qJ.length;U++){const c=l.qJ[U],K=N[c.id];K&&(K.inputs.length&&c.inputs.some((l=>l.targetConnectionName))&&!a||this._restoreConnections(K,l,N))}if(l.locations||l.editorData&&l.editorData.locations){const U=l.locations||l.editorData.locations;for(const l of U)N[l.OU]&&(l.OU=N[l.OU].uniqueId);a&&this.editorData&&this.editorData.locations&&U.concat(this.editorData.locations),l.locations?this.editorData={locations:U}:(this.editorData=l.editorData,this.editorData.locations=U);const c=[];for(const l in N)c[l]=N[l].uniqueId;this.editorData.map=c}this.comment=l.comment}_restoreConnections(l,a,N){for(const U of l.outputs)for(const c of a.qJ){const K=N[c.id];if(K)for(const Z of c.inputs)if(N[Z.targetBlockId]!==l||Z.targetConnectionName!==U.name);else{const l=K.getInputByName(Z.inputName);if(!l||l.isConnected)continue;U.connectTo(l,!0),this._restoreConnections(K,a,N)}}}serialize(l){const a=l?{}:j.c.Serialize(this);a.editorData=JSON.parse(JSON.stringify(this.editorData));let N=[];l?N=l:a.customType="BABYLON.NodeParticleSystemSet",a.qJ=[];for(const U of N)a.qJ.push(U.serialize());if(!l)for(const U of this.attachedBlocks)-1===N.indexOf(U)&&a.qJ.push(U.serialize());return a}dispose(){for(const l of this.attachedBlocks)l.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(l){const a=new cN(l);return a.setToDefault(),a}static Parse(l){const a=j.c.Parse((()=>new cN(l.name)),l,null);return a.parseSerializedObject(l),a}static ParseFromSnippetAsync(l,a){return"_BLANK"===l?Promise.resolve(cN.CreateDefault("blank")):new Promise(((N,U)=>{const c=new za.c;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const Z=JSON.parse(JSON.parse(c.responseText).jsonPayload),w=JSON.parse(Z.nodeParticle);a||(a=j.c.Parse((()=>new cN(l)),w,null)),a.parseSerializedObject(w),a.snippetId=l;try{N(a)}catch(K){U(K)}}else U("Unable to load the snippet "+l)})),c.open("GET",this.SnippetUrl+"/"+l.replace(/#/g,"/")),c.send()}))}}cN.EditorURL=`${Aa.Tools._DefaultCdnUrl}/v${ma.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,cN.SnippetUrl="https://snippet.babylonjs.com",(0,k.d)([(0,Q.K)()],cN.prototype,"name",void 0),(0,k.d)([(0,Q.K)("comment")],cN.prototype,"comment",void 0),function(l){l[l.None=0]="None",l[l.PerParticle=1]="PerParticle",l[l.PerSystem=2]="PerSystem"}(ea||(ea={}));class KN extends Ga{constructor(l){super(l),this._currentLockId=-2,this.lockMode=ea.PerParticle,this.registerInput("min",Ra.AutoDetect,!0,0),this.registerInput("max",Ra.AutoDetect,!0,1),this.registerOutput("output",Ra.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ra.Float|Ra.Int|Ra.Vector2|Ra.ua|Ra.Qc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Ra.Float|Ra.Int|Ra.Vector2|Ra.ua|Ra.Qc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Ra.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let l=null;switch(this._currentLockId=-2,this.min.type){case Ra.AutoDetect:case Ra.Int:case Ra.Float:l=l=>{const a=this.min.getConnectedValue(l)||0,N=this.max.getConnectedValue(l)||1;return a+Math.random()*(N-a)};break;case Ra.Vector2:l=l=>{const a=this.min.getConnectedValue(l)||U.Vector2.Zero(),N=this.max.getConnectedValue(l)||U.Vector2.One();return new U.Vector2(a.x+Math.random()*(N.x-a.x),a.y+Math.random()*(N.y-a.y))};break;case Ra.ua:l=l=>{const a=this.min.getConnectedValue(l)||U.ua.Zero(),N=this.max.getConnectedValue(l)||U.ua.One();return new U.ua(a.x+Math.random()*(N.x-a.x),a.y+Math.random()*(N.y-a.y),a.z+Math.random()*(N.z-a.z))};break;case Ra.Qc:l=l=>{const a=this.min.getConnectedValue(l)||new Z.Qc(0,0,0,0),N=this.max.getConnectedValue(l)||new Z.Qc(1,1,1,1);return new Z.Qc(a.x+Math.random()*(N.x-a.x),a.y+Math.random()*(N.y-a.y),a.z+Math.random()*(N.z-a.z),a.w+Math.random()*(N.w-a.w))}}this.output._storedFunction=a=>{var N;let U=0;switch(this.lockMode){case ea.PerParticle:U=(null===(N=a.particleContext)||void 0===N?void 0:N.id)||-1;break;case ea.PerSystem:U=a.buildId||0}return this._currentLockId!==U&&(this.lockMode!==ea.None&&(this._currentLockId=U),this.output._storedValue=l(a)),this.output._storedValue}}serialize(){const l=super.serialize();return l.lockMode=this.lockMode,l}_deserialize(l){super._deserialize(l),this.lockMode=l.lockMode}}(0,k.d)([mN("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ea.None},{label:"Per particle",value:ea.PerParticle},{label:"Per system",value:ea.PerSystem}]})],KN.prototype,"lockMode",void 0),(0,w.g)("BABYLON.ParticleRandomBlock",KN);class ZN extends Ga{constructor(l){super(l),this._currentLockId=-2,this.lockMode=ea.PerParticle,this.registerInput("min",Ra.AutoDetect),this.registerInput("max",Ra.AutoDetect),this.registerOutput("output",Ra.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const a=[Ra.Matrix,Ra.Particle,Ra.Texture,Ra.System,Ra.FloatGradient,Ra.Color4Gradient,Ra.Vector2Gradient,Ra.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...a),this.max.excludedConnectionPointTypes.push(...a)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let l=null;switch(this._currentLockId=-2,this.min.type){case Ra.Float:case Ra.Int:l=l=>{const a=this.min.getConnectedValue(l),N=this.max.getConnectedValue(l);return Math.random()*(N-a)+a};break;case Ra.Vector2:l=l=>{const a=this.min.getConnectedValue(l),N=this.max.getConnectedValue(l);return new U.Vector2(Math.random()*(N.x-a.x)+a.x,Math.random()*(N.y-a.y)+a.y)};break;case Ra.ua:l=l=>{const a=this.min.getConnectedValue(l),N=this.max.getConnectedValue(l);return new U.ua(Math.random()*(N.x-a.x)+a.x,Math.random()*(N.y-a.y)+a.y,Math.random()*(N.z-a.z)+a.z)};break;case Ra.Qc:l=l=>{const a=this.min.getConnectedValue(l),N=this.max.getConnectedValue(l);return new Z.Qc(Math.random()*(N.r-a.r)+a.r,Math.random()*(N.g-a.g)+a.g,Math.random()*(N.b-a.b)+a.b,Math.random()*(N.a-a.a)+a.a)}}this.output._storedFunction=a=>{var N;let U=0;switch(this.lockMode){case ea.PerParticle:U=(null===(N=a.particleContext)||void 0===N?void 0:N.id)||-1;break;case ea.PerSystem:U=a.buildId||0}return this._currentLockId!==U&&(this.lockMode!==ea.None&&(this._currentLockId=U),this.output._storedValue=l(a)),this.output._storedValue}}serialize(){const l=super.serialize();return l.lockMode=this.lockMode,l}_deserialize(l){super._deserialize(l),void 0!==l.lockMode&&(this.lockMode=l.lockMode)}}(0,k.d)([mN("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ea.None},{label:"Per particle",value:ea.PerParticle},{label:"Per system",value:ea.PerSystem}]})],ZN.prototype,"lockMode",void 0),(0,w.g)("BABYLON.RandomRangeBlock",ZN);(0,w.g)("BABYLON.ParticleLerpBlock",class extends Ga{constructor(l){super(l),this.registerInput("left",Ra.AutoDetect),this.registerInput("right",Ra.AutoDetect),this.registerInput("gradient",Ra.Float,!0,0,0,1),this.registerOutput("output",Ra.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ra.Float|Ra.Int|Ra.Vector2|Ra.ua|Ra.Qc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const l=(l,a,N)=>(1-l)*a+l*N;this.output._storedFunction=a=>{const N=this.left.getConnectedValue(a),c=this.right.getConnectedValue(a),K=this.gradient.getConnectedValue(a);switch(this.left.type){case Ra.Int:case Ra.Float:return l(K,N,c);case Ra.Vector2:return new U.Vector2(l(K,N.x,c.x),l(K,N.y,c.y));case Ra.ua:return new U.ua(l(K,N.x,c.x),l(K,N.y,c.y),l(K,N.z,c.z));case Ra.Qc:return new Z.Qc(l(K,N.r,c.r),l(K,N.g,c.g),l(K,N.b,c.b),l(K,N.a,c.a))}return 0}}});(0,w.g)("BABYLON.UpdateDirectionBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("direction",Ra.ua),this.registerOutput("output",Ra.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(l){const a=this.particle.getConnectedValue(l);if(this.output._storedValue=a,!this.direction.isConnected)return;const N={process:N=>{l.particleContext=N,l.systemContext=a,N.direction.K(this.direction.getConnectedValue(l))},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N}});(0,w.g)("BABYLON.UpdateColorBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("color",Ra.Qc),this.registerOutput("output",Ra.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(l){const a=this.particle.getConnectedValue(l);if(this.output._storedValue=a,!this.color.isConnected)return;const N={process:N=>{l.particleContext=N,l.systemContext=a,N.color.K(this.color.getConnectedValue(l))},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N}});(0,w.g)("BABYLON.UpdateScaleBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("scale",Ra.Vector2),this.registerOutput("output",Ra.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(l){const a=this.particle.getConnectedValue(l);if(this.output._storedValue=a,!this.scale.isConnected)return;const N={process:N=>{l.particleContext=N,l.systemContext=a,N.scale.K(this.scale.getConnectedValue(l))},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N}});(0,w.g)("BABYLON.UpdateAngleBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("angle",Ra.Float),this.registerOutput("output",Ra.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(l){const a=this.particle.getConnectedValue(l);if(this.output._storedValue=a,!this.angle.isConnected)return;const N={process:N=>{l.particleContext=N,l.systemContext=a,N.angle=this.angle.getConnectedValue(l)},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N}});(0,w.g)("BABYLON.BasicPositionUpdateBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerOutput("output",Ra.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(l){const a=this.particle.getConnectedValue(l),N={process:N=>{l.particleContext=N,l.systemContext=a,N.direction.scaleToRef(a._directionScale,a._scaledDirection),N.position.addInPlace(a._scaledDirection)},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N,this.output._storedValue=a}});(0,w.g)("BABYLON.BasicSpriteUpdateBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerOutput("output",Ra.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(l){const a=this.particle.getConnectedValue(l),N={process:N=>{l.particleContext=N,l.systemContext=a,N.updateCellIndex()},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N,this.output._storedValue=a}});(0,w.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("cellIndex",Ra.Int),this.registerOutput("output",Ra.Particle),this.cellIndex.acceptedConnectionPointTypes=[Ra.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(l){const a=this.particle.getConnectedValue(l);if(this.output._storedValue=a,!this.cellIndex.isConnected)return;const N={process:N=>{l.particleContext=N,l.systemContext=a,N.cellIndex=Math.floor(this.cellIndex.getConnectedValue(l))},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N}});class wN extends Ga{constructor(l){super(l),this.strength=1,this.registerInput("particle",Ra.Particle),this.registerInput("flowMap",Ra.Texture),this.registerOutput("output",Ra.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(l){var a;const N=this.particle.getConnectedValue(l),U=l.Ba;let c;(null===(a=this.flowMap.connectedPoint)||void 0===a?void 0:a.ownerBlock).extractTextureContentAsync().then((l=>{l&&(c=new pa(l.width,l.height,l.data))}));const K={process:l=>{const a=U.getTransformMatrix();c&&c._processParticle(l,this.strength*N._tempScaledUpdateSpeed,a)},previousItem:null,nextItem:null};N._updateQueueStart?dl(K,N._updateQueueStart):N._updateQueueStart=K,this.output._storedValue=N}serialize(){const l=super.serialize();return l.strength=this.strength,l}_deserialize(l){super._deserialize(l),this.strength=l.strength}}(0,k.d)([mN("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wN.prototype,"strength",void 0),(0,w.g)("BABYLON.UpdateFlowMapBlock",wN);(0,w.g)("BABYLON.SphereShapeBlock",class extends Ga{constructor(l){super(l),this.registerInput("input",Ra.Particle),this.registerInput("radius",Ra.Float,!0,1),this.registerInput("radiusRange",Ra.Float,!0,1,0,1),this.registerInput("directionRandomizer",Ra.Float,!0,0,0,1),this.registerOutput("output",Ra.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(l){const a=this.input.getConnectedValue(l);a._directionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.directionRandomizer.getConnectedValue(l),K=N.position.Wa(l.emitterPosition).normalize(),Z=(0,T.RandomRange)(0,c),w=(0,T.RandomRange)(0,c),S=(0,T.RandomRange)(0,c);K.x+=Z,K.y+=w,K.z+=S,K.normalize(),l.isEmitterTransformNode?U.ua.TransformNormalFromFloatsToRef(Z,w,S,l.emitterWorldMatrix,N.direction):N.direction.tc(Z,w,S)},a._positionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.radius.getConnectedValue(l),K=this.radiusRange.getConnectedValue(l),Z=c-(0,T.RandomRange)(0,c*K),w=(0,T.RandomRange)(0,1),S=(0,T.RandomRange)(0,2*Math.PI),J=Math.acos(2*w-1),n=Z*Math.cos(S)*Math.sin(J),y=Z*Math.cos(J),H=Z*Math.sin(S)*Math.sin(J);l.isEmitterTransformNode?U.ua.TransformCoordinatesFromFloatsToRef(n,y,H,l.emitterWorldMatrix,N.position):(N.position.tc(n,y,H),N.position.addInPlace(l.emitterPosition))},this.output._storedValue=a}});(0,w.g)("BABYLON.PointShapeBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("direction1",Ra.ua,!0,new U.ua(0,1,0)),this.registerInput("direction2",Ra.ua,!0,new U.ua(0,1,0)),this.registerOutput("output",Ra.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(l){const a=this.particle.getConnectedValue(l);a._directionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.direction1.getConnectedValue(l),K=this.direction2.getConnectedValue(l),Z=(0,T.RandomRange)(c.x,K.x),w=(0,T.RandomRange)(c.y,K.y),S=(0,T.RandomRange)(c.z,K.z);l.isEmitterTransformNode?U.ua.TransformNormalFromFloatsToRef(Z,w,S,l.emitterWorldMatrix,N.direction):N.direction.tc(Z,w,S)},a._positionCreation.process=N=>{l.systemContext=a,l.isEmitterTransformNode?U.ua.TransformCoordinatesFromFloatsToRef(0,0,0,l.emitterWorldMatrix,N.position):N.position.K(l.emitterPosition)},this.output._storedValue=a}});(0,w.g)("BABYLON.CustomShapeBlock",class extends Ga{constructor(l){super(l),this.registerInput("particle",Ra.Particle),this.registerInput("position",Ra.ua,!0,new U.ua(0,0,0)),this.registerInput("direction",Ra.ua,!0,new U.ua(0,1,0)),this.registerOutput("output",Ra.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(l){const a=this.particle.getConnectedValue(l);a._directionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.direction.getConnectedValue(l);l.isEmitterTransformNode?U.ua.TransformNormalToRef(c,l.emitterWorldMatrix,N.direction):N.direction.K(c)},a._positionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.position.getConnectedValue(l);l.isEmitterTransformNode?U.ua.TransformCoordinatesToRef(c,l.emitterWorldMatrix,N.position):(N.position.K(c),N.position.addInPlace(l.emitterPosition))},this.output._storedValue=a}});(0,w.g)("BABYLON.CylinderShapeBlock",class extends Ga{constructor(l){super(l),this._tempVector=U.ua.Zero(),this.registerInput("particle",Ra.Particle),this.registerInput("radius",Ra.Float,!0,1),this.registerInput("height",Ra.Float,!0,1,0),this.registerInput("radiusRange",Ra.Float,!0,1,0,1),this.registerInput("directionRandomizer",Ra.Float,!0,0,0,1),this.registerOutput("output",Ra.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(l){const a=this.particle.getConnectedValue(l);a._directionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.directionRandomizer.getConnectedValue(l);N.position.subtractToRef(l.emitterPosition,this._tempVector),this._tempVector.normalize(),l.isEmitterTransformNode&&U.ua.TransformNormalToRef(this._tempVector,l.emitterInverseWorldMatrix,this._tempVector);const K=(0,T.RandomRange)(-c/2,c/2);let Z=Math.atan2(this._tempVector.x,this._tempVector.z);Z+=(0,T.RandomRange)(-Math.PI/2,Math.PI/2)*c,this._tempVector.y=K,this._tempVector.x=Math.sin(Z),this._tempVector.z=Math.cos(Z),this._tempVector.normalize(),l.isEmitterTransformNode?U.ua.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,l.emitterWorldMatrix,N.direction):N.direction.K(this._tempVector)},a._positionCreation.process=N=>{l.particleContext=N,l.systemContext=a;const c=this.height.getConnectedValue(l),K=this.radiusRange.getConnectedValue(l),Z=this.radius.getConnectedValue(l),w=(0,T.RandomRange)(-c/2,c/2),S=(0,T.RandomRange)(0,2*Math.PI),J=(0,T.RandomRange)((1-K)*(1-K),1),n=Math.sqrt(J)*Z,y=n*Math.cos(S),H=n*Math.sin(S);l.isEmitterTransformNode?U.ua.TransformCoordinatesFromFloatsToRef(y,w,H,l.emitterWorldMatrix,N.position):(N.position.tc(y,w,H),N.position.addInPlace(l.emitterPosition))},this.output._storedValue=a}});class SN extends Ga{constructor(l){super(l),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Ra.Particle),this.registerOutput("output",Ra.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(l){super._build(l);const a=this.particle.getConnectedValue(l);a._isAnimationSheetEnabled=!0,a.spriteCellWidth=this.width,a.spriteCellHeight=this.height,a.startSpriteCellID=this.start,a.endSpriteCellID=this.end,a.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=a}serialize(){const l=super.serialize();return l.width=this.width,l.height=this.height,l.start=this.start,l.end=this.end,l.randomStartCell=this.randomStartCell,l}_deserialize(l){super._deserialize(l),this.width=l.width,this.height=l.height,this.start=l.start,this.end=l.end,this.randomStartCell=l.randomStartCell}}(0,k.d)([mN("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],SN.prototype,"start",void 0),(0,k.d)([mN("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],SN.prototype,"end",void 0),(0,k.d)([mN("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],SN.prototype,"width",void 0),(0,k.d)([mN("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],SN.prototype,"height",void 0),(0,k.d)([mN("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],SN.prototype,"loop",void 0),(0,k.d)([mN("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],SN.prototype,"randomStartCell",void 0),(0,w.g)("BABYLON.SetupSpriteSheetBlock",SN);class TN extends Ga{constructor(l){super(l),this.reference=0,this.registerInput("value",Ra.AutoDetect),this.registerOutput("output",Ra.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=l=>{switch(l){case Ra.Float:return Ra.FloatGradient;case Ra.Vector2:return Ra.Vector2Gradient;case Ra.ua:return Ra.Vector3Gradient;case Ra.Qc:return Ra.Color4Gradient}return l},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ra.Float|Ra.Vector2|Ra.ua|Ra.Qc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=l=>null}serialize(){const l=super.serialize();return l.reference=this.reference,l}_deserialize(l){super._deserialize(l),this.reference=l.reference}}(0,k.d)([mN("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],TN.prototype,"reference",void 0),(0,w.g)("BABYLON.ParticleGradientValueBlock",TN);(0,w.g)("BABYLON.ParticleGradientBlock",class extends Ga{constructor(l){super(l),this._entryCount=1,this.registerInput("gradient",Ra.Float,!0,1,0,1),this.registerInput("value0",Ra.AutoDetect),this.registerOutput("output",Ra.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=l=>{switch(l){case Ra.FloatGradient:return Ra.Float;case Ra.Vector2Gradient:return Ra.Vector2;case Ra.Vector3Gradient:return Ra.ua;case Ra.Color4Gradient:return Ra.Qc}return l},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Ra.FloatGradient|Ra.Vector2Gradient|Ra.Vector3Gradient|Ra.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(l){this._inputs[l].onConnectionObservable.add((()=>{this._entryCount>l||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Ra.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const l=[];for(let N=1;N<this._inputs.length;N++){var a;if(this._inputs[N].isConnected)l.push(null===(a=this._inputs[N].connectedPoint)||void 0===a?void 0:a.ownerBlock)}l.sort(((l,a)=>l.reference-a.reference)),this.output._storedFunction=a=>{const N=this.gradient.getConnectedValue(a);if(1===l.length)return l[0].value.getConnectedValue(a);let c=null;for(let K=l.length-1;K>=0;K--){const w=l[K];if(w.reference<=N){const l=w.value.getConnectedValue(a);if(c){const K=c.value.getConnectedValue(a),S=c.reference,J=w.reference,n=Math.max(0,Math.min(1,(N-J)/(S-J)));switch(this.output.type){case Ra.Float:return(0,T.Lerp)(l,K,n);case Ra.Vector2:return U.Vector2.Lerp(l,K,n);case Ra.ua:return U.ua.Lerp(l,K,n);case Ra.Qc:return Z.Qc.Lerp(l,K,n)}}return l}c=w}return 0}}});(0,w.g)("BABYLON.ParticleConverterBlock",class extends Ga{constructor(l){super(l),this.registerInput("color ",Ra.Qc,!0),this.registerInput("xyz ",Ra.ua,!0),this.registerInput("xy ",Ra.Vector2,!0),this.registerInput("zw ",Ra.Vector2,!0),this.registerInput("x ",Ra.Float,!0),this.registerInput("y ",Ra.Float,!0),this.registerInput("z ",Ra.Float,!0),this.registerInput("w ",Ra.Float,!0),this.registerOutput("color",Ra.Qc),this.registerOutput("xyz",Ra.ua),this.registerOutput("xy",Ra.Vector2),this.registerOutput("zw",Ra.Vector2),this.registerOutput("x",Ra.Float),this.registerOutput("y",Ra.Float),this.registerOutput("z",Ra.Float),this.registerOutput("w",Ra.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(l){return"color "===l?"colorIn":"xyz "===l?"xyzIn":"xy "===l?"xyIn":"zw "===l?"zwIn":"x "===l?"xIn":"y "===l?"yIn":"z "===l?"zIn":"w "===l?"wIn":l}_outputRename(l){switch(l){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return l}}_build(l){super._build(l);const a=this.xIn,N=this.yIn,c=this.zIn,K=this.wIn,w=this.xyIn,S=this.zwIn,T=this.xyzIn,J=this.colorIn,n=this.colorOut,y=this.xyzOut,H=this.xyOut,u=this.zwOut,W=this.xOut,B=this.yOut,Y=this.zOut,C=this.wOut,M=l=>{if(J.isConnected)return J.getConnectedValue(l);let U=0,n=0,y=0,H=0;if(a.isConnected&&(U=a.getConnectedValue(l)),N.isConnected&&(n=N.getConnectedValue(l)),c.isConnected&&(y=c.getConnectedValue(l)),K.isConnected&&(H=K.getConnectedValue(l)),w.isConnected){const a=w.getConnectedValue(l);a&&(U=a.x,n=a.y)}if(S.isConnected){const a=S.getConnectedValue(l);a&&(y=a.x,H=a.y)}if(T.isConnected){const a=T.getConnectedValue(l);a&&(U=a.x,n=a.y,y=a.z)}return new Z.Qc(U,n,y,H)};n._storedFunction=l=>M(l),y._storedFunction=l=>{const a=M(l);return new U.ua(a.r,a.g,a.b)},H._storedFunction=l=>{const a=M(l);return new U.Vector2(a.r,a.g)},u._storedFunction=l=>{const a=M(l);return new U.Vector2(a.b,a.a)},W._storedFunction=l=>M(l).r,B._storedFunction=l=>M(l).g,Y._storedFunction=l=>M(l).b,C._storedFunction=l=>M(l).a}}),function(l){l[l.Cos=0]="Cos",l[l.Sin=1]="Sin",l[l.Abs=2]="Abs",l[l.Exp=3]="Exp",l[l.Exp2=4]="Exp2",l[l.Round=5]="Round",l[l.Floor=6]="Floor",l[l.Ceiling=7]="Ceiling",l[l.Sqrt=8]="Sqrt",l[l.Log=9]="Log",l[l.Tan=10]="Tan",l[l.ArcTan=11]="ArcTan",l[l.ArcCos=12]="ArcCos",l[l.ArcSin=13]="ArcSin",l[l.Sign=14]="Sign",l[l.Negate=15]="Negate",l[l.OneMinus=16]="OneMinus",l[l.Reciprocal=17]="Reciprocal",l[l.ToDegrees=18]="ToDegrees",l[l.ToRadians=19]="ToRadians",l[l.Fract=20]="Fract"}(sa||(sa={}));class JN extends Ga{constructor(l){super(l),this.operation=sa.Cos,this.registerInput("input",Ra.AutoDetect),this.registerOutput("output",Ra.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ra.Float|Ra.Int|Ra.Vector2|Ra.ua|Ra.Qc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(l){super._build(l);let a=null;switch(this.operation){case sa.Cos:a=l=>Math.cos(l);break;case sa.Sin:a=l=>Math.sin(l);break;case sa.Abs:a=l=>Math.abs(l);break;case sa.Exp:a=l=>Math.exp(l);break;case sa.Exp2:a=l=>Math.pow(2,l);break;case sa.Round:a=l=>Math.round(l);break;case sa.Floor:a=l=>Math.floor(l);break;case sa.Ceiling:a=l=>Math.ceil(l);break;case sa.Sqrt:a=l=>Math.sqrt(l);break;case sa.Log:a=l=>Math.log(l);break;case sa.Tan:a=l=>Math.tan(l);break;case sa.ArcTan:a=l=>Math.atan(l);break;case sa.ArcCos:a=l=>Math.acos(l);break;case sa.ArcSin:a=l=>Math.asin(l);break;case sa.Sign:a=l=>Math.sign(l);break;case sa.Negate:a=l=>-l;break;case sa.OneMinus:a=l=>1-l;break;case sa.Reciprocal:a=l=>1/l;break;case sa.ToRadians:a=l=>l*Math.PI/180;break;case sa.ToDegrees:a=l=>180*l/Math.PI;break;case sa.Fract:a=l=>l>=0?l-Math.floor(l):l-Math.ceil(l)}if(!a)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Ra.Int:case Ra.Float:this.output._storedFunction=l=>{const N=this.input.getConnectedValue(l);return a(N)};break;case Ra.Vector2:this.output._storedFunction=l=>{const N=this.input.getConnectedValue(l);return new U.Vector2(a(N.x),a(N.y))};break;case Ra.ua:this.output._storedFunction=l=>{const N=this.input.getConnectedValue(l);return new U.ua(a(N.x),a(N.y),a(N.z))};break;case Ra.Qc:this.output._storedFunction=l=>{const N=this.input.getConnectedValue(l);return new Z.Qc(a(N.r),a(N.g),a(N.b),a(N.a))}}return this}serialize(){const l=super.serialize();return l.operation=this.operation,l}_deserialize(l){super._deserialize(l),this.operation=l.operation}}(0,k.d)([mN("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:sa.Cos},{label:"Sin",value:sa.Sin},{label:"Abs",value:sa.Abs},{label:"Exp",value:sa.Exp},{label:"Exp2",value:sa.Exp2},{label:"Round",value:sa.Round},{label:"Floor",value:sa.Floor},{label:"Ceiling",value:sa.Ceiling},{label:"Sqrt",value:sa.Sqrt},{label:"Log",value:sa.Log},{label:"Tan",value:sa.Tan},{label:"ArcTan",value:sa.ArcTan},{label:"ArcCos",value:sa.ArcCos},{label:"ArcSin",value:sa.ArcSin},{label:"Sign",value:sa.Sign},{label:"Negate",value:sa.Negate},{label:"OneMinus",value:sa.OneMinus},{label:"Reciprocal",value:sa.Reciprocal},{label:"ToDegrees",value:sa.ToDegrees},{label:"ToRadians",value:sa.ToRadians},{label:"Fract",value:sa.Fract}]})],JN.prototype,"operation",void 0),(0,w.g)("BABYLON.ParticleTrigonometryBlock",JN);var nN,yN=N(13822);class HN extends Ga{constructor(l){super(l),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Ra.AutoDetect),this.registerOutput("output",Ra.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Ra.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Ra.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ra.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ra.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ra.System),this._inputs[0].excludedConnectionPointTypes.push(Ra.Particle),this._inputs[0].excludedConnectionPointTypes.push(Ra.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(l){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const a=l=>{const a=this.input.getConnectedValue(l);if(this.log.length>=this.stackSize)return a;if(null===a||void 0===a)return this.log.push(["null",""]),a;switch(this.input.type){case Ra.Vector2:this.log.push([(0,yN.j)(a,4),a.toString()]);break;case Ra.ua:this.log.push([(0,yN.k)(a,4),a.toString()]);break;case Ra.Qc:this.log.push([`{R: ${a.r.toFixed(4)} G: ${a.g.toFixed(4)} B: ${a.b.toFixed(4)} A: ${a.a.toFixed(4)}}`,a.toString()]);break;default:this.log.push([a.toString(),a.toString()])}return a};this.output.isConnected?this.output._storedFunction=a:this.output._storedValue=a(l)}serialize(){const l=super.serialize();return l.stackSize=this.stackSize,l}_deserialize(l){super._deserialize(l),this.stackSize=l.stackSize}}(0,k.d)([mN("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],HN.prototype,"stackSize",void 0),(0,w.g)("BABYLON.ParticleDebugBlock",HN);(0,w.g)("BABYLON.ParticleElbowBlock",class extends Ga{constructor(l){super(l),this.registerInput("input",Ra.AutoDetect),this.registerOutput("output",Ra.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(l){super._build(l);const a=this._outputs[0],N=this._inputs[0];a._storedFunction=l=>N.getConnectedValue(l)}});(0,w.g)("BABYLON.ParticleTeleportInBlock",class extends Ga{get endpoints(){return this._endpoints}constructor(l){super(l),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Ra.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(l){if(this.getClassName()===l)return!0;for(const a of this.endpoints)if(a.isAnAncestorOfType(l))return!0;return!1}isAnAncestorOf(l){for(const a of this.endpoints){if(a===l)return!0;if(a.isAnAncestorOf(l))return!0}return!1}attachToEndpoint(l){l.detach(),this._endpoints.push(l),l._entryPoint=this,l._outputs[0]._typeConnectionSource=this._inputs[0],l._tempEntryPointUniqueId=null,l.name="> "+this.name}detachFromEndpoint(l){const a=this._endpoints.indexOf(l);-1!==a&&(this._endpoints.splice(a,1),l._outputs[0]._typeConnectionSource=null,l._entryPoint=null)}_build(){for(const l of this._endpoints)l.output._storedFunction=l=>this.input.getConnectedValue(l)}});(0,w.g)("BABYLON.ParticleTeleportOutBlock",class extends Ga{constructor(l){super(l),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Ra.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(l){this.entryPoint&&this.entryPoint.build(l)}clone(){const l=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(l),l}serialize(){var l;const a=super.serialize();return a.entryPoint=(null===(l=this.entryPoint)||void 0===l?void 0:l.uniqueId)??"",a}_deserialize(l){super._deserialize(l),this._tempEntryPointUniqueId=l.entryPoint}}),function(l){l[l.Equal=0]="Equal",l[l.NotEqual=1]="NotEqual",l[l.LessThan=2]="LessThan",l[l.GreaterThan=3]="GreaterThan",l[l.LessOrEqual=4]="LessOrEqual",l[l.GreaterOrEqual=5]="GreaterOrEqual",l[l.Xor=6]="Xor",l[l.Or=7]="Or",l[l.And=8]="And"}(nN||(nN={}));class uN extends Ga{constructor(l){super(l),this.test=nN.Equal,this.epsilon=0,this.registerInput("left",Ra.Float),this.registerInput("right",Ra.Float,!0,0),this.registerInput("ifTrue",Ra.AutoDetect,!0,1),this.registerInput("ifFalse",Ra.AutoDetect,!0,0),this.registerOutput("output",Ra.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Ra.Float,this._inputs[0].acceptedConnectionPointTypes.push(Ra.Int),this._inputs[1].acceptedConnectionPointTypes.push(Ra.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const l=l=>{const a=this.left.getConnectedValue(l),N=this.right.getConnectedValue(l);let U=!1;switch(this.test){case nN.Equal:U=(0,T.WithinEpsilon)(a,N,this.epsilon);break;case nN.NotEqual:U=!(0,T.WithinEpsilon)(a,N,this.epsilon);break;case nN.LessThan:U=a<N+this.epsilon;break;case nN.GreaterThan:U=a>N-this.epsilon;break;case nN.LessOrEqual:U=a<=N+this.epsilon;break;case nN.GreaterOrEqual:U=a>=N-this.epsilon;break;case nN.Xor:U=!!a&&!N||!a&&!!N;break;case nN.Or:U=!!a||!!N;break;case nN.And:U=!!a&&!!N}return U};this.output._storedFunction=a=>l(a)?this.ifTrue.getConnectedValue(a):this.ifFalse.getConnectedValue(a)}serialize(){const l=super.serialize();return l.test=this.test,l.epsilon=this.epsilon,l}_deserialize(l){super._deserialize(l),this.test=l.test,void 0!==l.epsilon&&(this.epsilon=l.epsilon)}}(0,k.d)([mN("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:nN.Equal},{label:"NotEqual",value:nN.NotEqual},{label:"LessThan",value:nN.LessThan},{label:"GreaterThan",value:nN.GreaterThan},{label:"LessOrEqual",value:nN.LessOrEqual},{label:"GreaterOrEqual",value:nN.GreaterOrEqual},{label:"Xor",value:nN.Xor},{label:"Or",value:nN.Or},{label:"And",value:nN.And}]})],uN.prototype,"test",void 0),(0,k.d)([mN("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uN.prototype,"epsilon",void 0),(0,w.g)("BABYLON.ParticleConditionBlock",uN);class WN extends Ga{constructor(l){super(l),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Ra.Particle),this.registerInput("condition",Ra.Float,!0,0),this.registerInput("system",Ra.System),this.registerOutput("output",Ra.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(l){this._triggerCount=0;const a=this.input.getConnectedValue(l),N={process:N=>{if(l.particleContext=N,l.systemContext=a,0!==this.condition.getConnectedValue(l)&&(0===this.limit||this._triggerCount<this.limit)){const U=(new Date).getTime();if(this._previousOne&&U-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=U;const c=this.system.getConnectedValue(l);if(c){const U=Va(c,l.Ba,N.position);U.Tc.addOnce((()=>{this._triggerCount--})),a.Tc.addOnce((()=>{U.dispose()}))}}},previousItem:null,nextItem:null};a._updateQueueStart?dl(N,a._updateQueueStart):a._updateQueueStart=N,this.output._storedValue=a}serialize(){const l=super.serialize();return l.limit=this.limit,l.delay=this.delay,l}_deserialize(l){super._deserialize(l),void 0!==l.limit&&(this.limit=l.limit),void 0!==l.delay&&(this.delay=l.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,k.d)([mN("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WN.prototype,"limit",void 0),(0,k.d)([mN("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WN.prototype,"delay",void 0),(0,w.g)("BABYLON.ParticleTriggerBlock",WN);N(13829),N(13838),N(13846),N(13907)},13891:(l,a,N)=>{"use strict";var U=N(12350);const c="clipPlaneFragment",K="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13854:(l,a,N)=>{"use strict";var U=N(12350);const c="clipPlaneFragmentDeclaration",K="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13925:(l,a,N)=>{"use strict";var U=N(12350);const c="clipPlaneVertex",K="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13916:(l,a,N)=>{"use strict";var U=N(12350);const c="clipPlaneVertexDeclaration",K="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13902:(l,a,N)=>{"use strict";var U=N(12350);const c="fogFragment",K="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13889:(l,a,N)=>{"use strict";var U=N(12350);const c="fogFragmentDeclaration",K="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13932:(l,a,N)=>{"use strict";var U=N(12350);const c="fogVertex",K="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13922:(l,a,N)=>{"use strict";var U=N(12350);const c="fogVertexDeclaration",K="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13876:(l,a,N)=>{"use strict";var U=N(12350);const c="helperFunctions",K="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13862:(l,a,N)=>{"use strict";var U=N(12350);const c="imageProcessingDeclaration",K="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13881:(l,a,N)=>{"use strict";var U=N(12350);const c="imageProcessingFunctions",K="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13870:(l,a,N)=>{"use strict";var U=N(12350);const c="logDepthDeclaration",K="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13897:(l,a,N)=>{"use strict";var U=N(12350);const c="logDepthFragment",K="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13934:(l,a,N)=>{"use strict";var U=N(12350);const c="logDepthVertex",K="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";U.e.IncludesShadersStoreWGSL[c]||(U.e.IncludesShadersStoreWGSL[c]=K)},13846:(l,a,N)=>{"use strict";N.r(a),N.d(a,{particlesPixelShaderWGSL:()=>Z});var U=N(12350);N(13854),N(13862),N(13870),N(13876),N(13881),N(13889),N(13891),N(13897),N(13902);const c="particlesPixelShader",K="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";U.e.ShadersStoreWGSL[c]||(U.e.ShadersStoreWGSL[c]=K);const Z={name:c,shader:K}},13907:(l,a,N)=>{"use strict";N.r(a),N.d(a,{particlesVertexShaderWGSL:()=>Z});var U=N(12350);N(13916),N(13922),N(13870),N(13925),N(13932),N(13934);const c="particlesVertexShader",K="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";U.e.ShadersStoreWGSL[c]||(U.e.ShadersStoreWGSL[c]=K);const Z={name:c,shader:K}},13762:(l,a,N)=>{"use strict";var U=N(12350);const c="clipPlaneFragment",K="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13832:(l,a,N)=>{"use strict";var U=N(12350);const c="clipPlaneFragmentDeclaration",K="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13788:(l,a,N)=>{"use strict";var U=N(12350);const c="clipPlaneVertex",K="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13840:(l,a,N)=>{"use strict";var U=N(12350);const c="clipPlaneVertexDeclaration",K="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13779:(l,a,N)=>{"use strict";var U=N(12350);const c="fogFragment",K="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13757:(l,a,N)=>{"use strict";var U=N(12350);const c="fogFragmentDeclaration",K="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13791:(l,a,N)=>{"use strict";var U=N(12350);const c="fogVertex",K="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13782:(l,a,N)=>{"use strict";var U=N(12350);const c="fogVertexDeclaration",K="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13743:(l,a,N)=>{"use strict";var U=N(12350);const c="helperFunctions",K="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13731:(l,a,N)=>{"use strict";var U=N(12350);const c="imageProcessingDeclaration",K="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13748:(l,a,N)=>{"use strict";var U=N(12350);const c="imageProcessingFunctions",K="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13735:(l,a,N)=>{"use strict";var U=N(12350);const c="logDepthDeclaration",K="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13770:(l,a,N)=>{"use strict";var U=N(12350);const c="logDepthFragment",K="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13800:(l,a,N)=>{"use strict";var U=N(12350);const c="logDepthVertex",K="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";U.e.IncludesShadersStore[c]||(U.e.IncludesShadersStore[c]=K)},13829:(l,a,N)=>{"use strict";N.r(a),N.d(a,{particlesPixelShader:()=>Z});var U=N(12350);N(13832),N(13731),N(13735),N(13743),N(13748),N(13757),N(13762),N(13770),N(13779);const c="particlesPixelShader",K="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";U.e.ShadersStore[c]||(U.e.ShadersStore[c]=K);const Z={name:c,shader:K}},13838:(l,a,N)=>{"use strict";N.r(a),N.d(a,{particlesVertexShader:()=>Z});var U=N(12350);N(13840),N(13782),N(13735),N(13788),N(13791),N(13800);const c="particlesVertexShader",K="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";U.e.ShadersStore[c]||(U.e.ShadersStore[c]=K);const Z={name:c,shader:K}},14203:(l,a,N)=>{"use strict";N.r(a),N.d(a,{FlowGraphGLTFDataProvider:()=>K});var U=N(14171),c=N(14145);class K extends U.e{constructor(l){var a,N;super();const U=l.glTF,K=(null===(a=U.animations)||void 0===a?void 0:a.map((l=>l._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",c.d,K);const Z=(null===(N=U.nodes)||void 0===N?void 0:N.map((l=>l._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",c.d,Z)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14083:(l,a,N)=>{"use strict";N.d(a,{b:()=>B,d:()=>u,f:()=>H,g:()=>W});var U=N(12447),c=N(12909),K=N(12479),Z=N(14086);const w=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class S{constructor(l,a){this._gltf=l,this._infoTree=a}convert(l){let a,N=this._gltf,U=this._infoTree;if(!l.startsWith("/"))throw new Error("Path must start with a /");const c=l.split("/");if(c.shift(),c[c.length-1].includes(".length")){const l=c[c.length-1].split(".");c.pop(),c.push(...l)}let K=!1;for(const S of c){const c="length"===S;if(c&&!U.__array__)throw new Error(`Path ${l} is invalid`);if(U.__ignoreObjectTree__&&(K=!0),U.__array__&&!c)U=U.__array__;else if(U=U[S],!U)throw new Error(`Path ${l} is invalid`);if(!K)if(void 0===N){if(!w.find((a=>a.regex.test(l))))throw new Error(`Path ${l} is invalid`)}else if(!c){var Z;N=null===(Z=N)||void 0===Z?void 0:Z[S]}(U.__target__||c)&&(a=N)}return{object:a,info:U}}}function T(l,a,N,U){const c=J(l,a);return U?c[N][U]:c[N]}function J(l,a,N){var U,K;return null===(U=l._data)||void 0===U||null===(K=U[(null===N||void 0===N?void 0:N.fillMode)??c.c.MATERIAL_TriangleFillMode])||void 0===K?void 0:K.babylonMaterial}function n(l,a){return{offset:{componentsCount:2,type:"Vector2",get:(N,c,K)=>{const Z=T(N,K,l,a);return new U.Vector2(null===Z||void 0===Z?void 0:Z.uOffset,null===Z||void 0===Z?void 0:Z.vOffset)},getTarget:J,set:(N,U,c,K)=>{const Z=T(U,K,l,a);Z.uOffset=N.x,Z.vOffset=N.y},getPropertyName:[()=>`${l}${a?"."+a:""}.uOffset`,()=>`${l}${a?"."+a:""}.vOffset`]},rotation:{type:"number",get:(N,U,c)=>{var K;return null===(K=T(N,c,l,a))||void 0===K?void 0:K.wAng},getTarget:J,set:(N,U,c,K)=>T(U,K,l,a).wAng=N,getPropertyName:[()=>`${l}${a?"."+a:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(N,c,K)=>{const Z=T(N,K,l,a);return new U.Vector2(null===Z||void 0===Z?void 0:Z.uScale,null===Z||void 0===Z?void 0:Z.vScale)},getTarget:J,set:(N,U,c,K)=>{const Z=T(U,K,l,a);Z.uScale=N.x,Z.vScale=N.y},getPropertyName:[()=>`${l}${a?"."+a:""}.uScale`,()=>`${l}${a?"."+a:""}.vScale`]}}}const y={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:l=>{var a,N;return new U.Vector2((null===(a=l._babylonCamera)||void 0===a?void 0:a.orthoLeft)??0,(null===(N=l._babylonCamera)||void 0===N?void 0:N.orthoRight)??0)},set:(l,a)=>{a._babylonCamera&&(a._babylonCamera.orthoLeft=l.x,a._babylonCamera.orthoRight=l.y)},getTarget:l=>l,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:l=>{var a,N;return new U.Vector2((null===(a=l._babylonCamera)||void 0===a?void 0:a.orthoBottom)??0,(null===(N=l._babylonCamera)||void 0===N?void 0:N.orthoTop)??0)},set:(l,a)=>{a._babylonCamera&&(a._babylonCamera.orthoBottom=l.x,a._babylonCamera.orthoTop=l.y)},getTarget:l=>l,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:l=>{var a;return null===(a=l._babylonCamera)||void 0===a?void 0:a.maxZ},set:(l,a)=>{a._babylonCamera&&(a._babylonCamera.maxZ=l)},getTarget:l=>l,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:l=>{var a;return null===(a=l._babylonCamera)||void 0===a?void 0:a.Ac},set:(l,a)=>{a._babylonCamera&&(a._babylonCamera.Ac=l)},getTarget:l=>l,getPropertyName:[()=>"Ac"]}},perspective:{aspectRatio:{type:"number",get:l=>{var a;return null===(a=l._babylonCamera)||void 0===a?void 0:a.getEngine().getAspectRatio(l._babylonCamera)},getTarget:l=>l,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:l=>{var a;return null===(a=l._babylonCamera)||void 0===a?void 0:a.fov},set:(l,a)=>{a._babylonCamera&&(a._babylonCamera.fov=l)},getTarget:l=>l,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:l=>{var a;return null===(a=l._babylonCamera)||void 0===a?void 0:a.maxZ},set:(l,a)=>{a._babylonCamera&&(a._babylonCamera.maxZ=l)},getTarget:l=>l,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:l=>{var a;return null===(a=l._babylonCamera)||void 0===a?void 0:a.Ac},set:(l,a)=>{a._babylonCamera&&(a._babylonCamera.Ac=l)},getTarget:l=>l,getPropertyName:[()=>"Ac"]}}}},nodes:{length:{type:"number",get:l=>l.length,getTarget:l=>l.map((l=>l._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ua",get:l=>{var a;return null===(a=l._babylonTransformNode)||void 0===a?void 0:a.position},set:(l,a)=>{var N;return null===(N=a._babylonTransformNode)||void 0===N?void 0:N.position.K(l)},getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:l=>{var a;return null===(a=l._babylonTransformNode)||void 0===a?void 0:a.rotationQuaternion},set:(l,a)=>{var N,U;return null===(N=a._babylonTransformNode)||void 0===N||null===(U=N.rotationQuaternion)||void 0===U?void 0:U.K(l)},getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ua",get:l=>{var a;return null===(a=l._babylonTransformNode)||void 0===a?void 0:a.Oc},set:(l,a)=>{var N;return null===(N=a._babylonTransformNode)||void 0===N?void 0:N.Oc.K(l)},getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"Oc"]},weights:{length:{type:"number",get:l=>l._numMorphTargets,getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(l,a)=>{var N,U;return void 0!==a?null===(N=l._primitiveBabylonMeshes)||void 0===N||null===(U=N[0].morphTargetManager)||void 0===U?void 0:U.getTarget(a).influence:void 0},getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(l,a)=>[0],getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:l=>{var a,N,c;return U.Matrix.Compose(null===(a=l._babylonTransformNode)||void 0===a?void 0:a.Oc,null===(N=l._babylonTransformNode)||void 0===N?void 0:N.rotationQuaternion,null===(c=l._babylonTransformNode)||void 0===c?void 0:c.position)},getTarget:l=>l._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:l=>{var a,N,c,K;const Z=U.Matrix.Identity();let w=l.parent;for(;w&&w.parent;)w=w.parent;const S=(null===(a=l._babylonTransformNode)||void 0===a?void 0:a.position._isDirty)||(null===(N=l._babylonTransformNode)||void 0===N||null===(c=N.rotationQuaternion)||void 0===c?void 0:c._isDirty)||(null===(K=l._babylonTransformNode)||void 0===K?void 0:K.Oc._isDirty);if(w){var T;const a=null===(T=w._babylonTransformNode)||void 0===T?void 0:T.qc(!0).invert();var J,n;if(a)null===(J=l._babylonTransformNode)||void 0===J||null===(n=J.qc(S))||void 0===n||n.multiplyToRef(a,Z)}else l._babylonTransformNode&&Z.K(l._babylonTransformNode.qc(S));return Z},getTarget:l=>l._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:l=>{var a,N;return null===(a=l._babylonTransformNode)||void 0===a||null===(N=a.getChildren((l=>l instanceof Z.e),!0)[0])||void 0===N?void 0:N.Rc},getTarget:l=>{var a;return null===(a=l._babylonTransformNode)||void 0===a?void 0:a.getChildren((l=>l instanceof Z.e),!0)[0]},set:(l,a)=>{if(a._babylonTransformNode){const N=a._babylonTransformNode.getChildren((l=>l instanceof Z.e),!0)[0];N&&(N.Rc=l)}}},color:{type:"Ca",get:l=>{var a,N;return null===(a=l._babylonTransformNode)||void 0===a||null===(N=a.getChildren((l=>l instanceof Z.e),!0)[0])||void 0===N?void 0:N.Lc},getTarget:l=>{var a;return null===(a=l._babylonTransformNode)||void 0===a?void 0:a.getChildren((l=>l instanceof Z.e),!0)[0]},set:(l,a)=>{if(a._babylonTransformNode){const N=a._babylonTransformNode.getChildren((l=>l instanceof Z.e),!0)[0];N&&(N.Lc=l)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Ca",get:(l,a,N)=>J(l,a,N).emissiveColor,set:(l,a,N,U)=>J(a,N,U).emissiveColor.K(l),getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:n("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(l,a,N)=>{var U;return null===(U=T(l,N,"bumpTexture"))||void 0===U?void 0:U.level},set:(l,a,N,U)=>{const c=T(a,U,"bumpTexture");c&&(c.level=l)},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:n("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(l,a,N)=>J(l,a,N).ambientTextureStrength,set:(l,a,N,U)=>{const c=J(a,N,U);c&&(c.ambientTextureStrength=l)},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:n("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Qc",get:(l,a,N)=>{const U=J(l,a,N);return K.Qc.FromColor3(U.albedoColor,U.alpha)},set:(l,a,N,U)=>{const c=J(a,N,U);c.albedoColor.set(l.r,l.g,l.b),c.alpha=l.a},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:n("albedoTexture")}},metallicFactor:{type:"number",get:(l,a,N)=>J(l,a,N).metallic,set:(l,a,N,U)=>{const c=J(a,N,U);c&&(c.metallic=l)},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(l,a,N)=>J(l,a,N).roughness,set:(l,a,N,U)=>{const c=J(a,N,U);c&&(c.roughness=l)},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:n("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(l,a,N)=>J(l,a,N).anisotropy.Rc,set:(l,a,N,U)=>{J(a,N,U).anisotropy.Rc=l},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(l,a,N)=>J(l,a,N).anisotropy.angle,set:(l,a,N,U)=>{J(a,N,U).anisotropy.angle=l},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:n("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(l,a,N)=>J(l,a,N).clearCoat.Rc,set:(l,a,N,U)=>{J(a,N,U).clearCoat.Rc=l},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(l,a,N)=>J(l,a,N).clearCoat.roughness,set:(l,a,N,U)=>{J(a,N,U).clearCoat.roughness=l},getTarget:(l,a,N)=>J(l,a,N),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:n("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(l,a,N)=>{var U;return null===(U=J(l,a,N).clearCoat.bumpTexture)||void 0===U?void 0:U.level},getTarget:J,set:(l,a,N,U)=>J(a,N,U).clearCoat.bumpTexture.level=l},extensions:{KHR_texture_transform:n("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:n("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(l,a,N)=>J(l,a,N).subSurface.dispersion,getTarget:J,set:(l,a,N,U)=>J(a,N,U).subSurface.dispersion=l}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(l,a,N)=>J(l,a,N).emissiveIntensity,getTarget:J,set:(l,a,N,U)=>J(a,N,U).emissiveIntensity=l}},KHR_materials_ior:{ior:{type:"number",get:(l,a,N)=>J(l,a,N).indexOfRefraction,getTarget:J,set:(l,a,N,U)=>J(a,N,U).indexOfRefraction=l}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(l,a,N)=>J(l,a,N).iridescence.Rc,getTarget:J,set:(l,a,N,U)=>J(a,N,U).iridescence.Rc=l},iridescenceIor:{type:"number",get:(l,a,N)=>J(l,a,N).iridescence.indexOfRefraction,getTarget:J,set:(l,a,N,U)=>J(a,N,U).iridescence.indexOfRefraction=l},iridescenceTexture:{extensions:{KHR_texture_transform:n("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(l,a,N)=>J(l,a,N).iridescence.maximumThickness,getTarget:J,set:(l,a,N,U)=>J(a,N,U).iridescence.maximumThickness=l},iridescenceThicknessMinimum:{type:"number",get:(l,a,N)=>J(l,a,N).iridescence.minimumThickness,getTarget:J,set:(l,a,N,U)=>J(a,N,U).iridescence.minimumThickness=l},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:n("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Ca",get:(l,a,N)=>J(l,a,N).sheen.color,getTarget:J,set:(l,a,N,U)=>J(a,N,U).sheen.color.K(l)},sheenColorTexture:{extensions:{KHR_texture_transform:n("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(l,a,N)=>J(l,a,N).sheen.Rc,getTarget:J,set:(l,a,N,U)=>J(a,N,U).sheen.Rc=l},sheenRoughnessTexture:{extensions:{KHR_texture_transform:n("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(l,a,N)=>J(l,a,N).metallicF0Factor,getTarget:J,set:(l,a,N,U)=>J(a,N,U).metallicF0Factor=l,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Ca",get:(l,a,N)=>J(l,a,N).metallicReflectanceColor,getTarget:J,set:(l,a,N,U)=>J(a,N,U).metallicReflectanceColor.K(l),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:n("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:n("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(l,a,N)=>J(l,a,N).subSurface.refractionIntensity,getTarget:J,set:(l,a,N,U)=>J(a,N,U).subSurface.refractionIntensity=l,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:n("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(l,a,N)=>J(l,a,N).subSurface.translucencyIntensity,getTarget:J,set:(l,a,N,U)=>J(a,N,U).subSurface.translucencyIntensity=l},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:n("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Ca",get:(l,a,N)=>J(l,a,N).subSurface.translucencyColor,getTarget:J,set:(l,a,N,U)=>{var c;return l&&(null===(c=J(a,N,U).subSurface.translucencyColor)||void 0===c?void 0:c.K(l))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:n("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Ca",get:(l,a,N)=>J(l,a,N).subSurface.tintColor,getTarget:J,set:(l,a,N,U)=>J(a,N,U).subSurface.tintColor.K(l)},attenuationDistance:{type:"number",get:(l,a,N)=>J(l,a,N).subSurface.tintColorAtDistance,getTarget:J,set:(l,a,N,U)=>J(a,N,U).subSurface.tintColorAtDistance=l},thicknessFactor:{type:"number",get:(l,a,N)=>J(l,a,N).subSurface.maximumThickness,getTarget:J,set:(l,a,N,U)=>J(a,N,U).subSurface.maximumThickness=l},thicknessTexture:{extensions:{KHR_texture_transform:n("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:l=>l.length,getTarget:l=>l.map((l=>l._babylonLight)),getPropertyName:[l=>"length"]},__array__:{__target__:!0,color:{type:"Ca",get:l=>{var a;return null===(a=l._babylonLight)||void 0===a?void 0:a.Lc},set:(l,a)=>{var N;return null===(N=a._babylonLight)||void 0===N?void 0:N.Lc.K(l)},getTarget:l=>l._babylonLight,getPropertyName:[l=>"diffuse"]},Rc:{type:"number",get:l=>{var a;return null===(a=l._babylonLight)||void 0===a?void 0:a.Rc},set:(l,a)=>a._babylonLight?a._babylonLight.Rc=l:void 0,getTarget:l=>l._babylonLight,getPropertyName:[l=>"intensity"]},range:{type:"number",get:l=>{var a;return null===(a=l._babylonLight)||void 0===a?void 0:a.range},set:(l,a)=>a._babylonLight?a._babylonLight.range=l:void 0,getTarget:l=>l._babylonLight,getPropertyName:[l=>"range"]},spot:{innerConeAngle:{type:"number",get:l=>{var a;return null===(a=l._babylonLight)||void 0===a?void 0:a.innerAngle},set:(l,a)=>a._babylonLight?a._babylonLight.innerAngle=l:void 0,getTarget:l=>l._babylonLight,getPropertyName:[l=>"innerConeAngle"]},outerConeAngle:{type:"number",get:l=>{var a;return null===(a=l._babylonLight)||void 0===a?void 0:a.angle},set:(l,a)=>a._babylonLight?a._babylonLight.angle=l:void 0,getTarget:l=>l._babylonLight,getPropertyName:[l=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:l=>l.length,getTarget:l=>l.map((l=>l._babylonLight)),getPropertyName:[l=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:l=>l.length,getTarget:l=>l.map((l=>l._babylonTexture)),getPropertyName:[l=>"length"]},__array__:{__target__:!0,Rc:{type:"number",get:l=>{var a;return null===(a=l._babylonTexture)||void 0===a?void 0:a.level},set:(l,a)=>{a._babylonTexture&&(a._babylonTexture.level=l)},getTarget:l=>l._babylonTexture},rotation:{type:"Quaternion",get:l=>{var a;return l._babylonTexture&&U.Quaternion.FromRotationMatrix(null===(a=l._babylonTexture)||void 0===a?void 0:a.getReflectionTextureMatrix())},set:(l,a)=>{var N;a._babylonTexture&&(null!==(N=a._babylonTexture.bl())&&void 0!==N&&N.useRightHandedSystem||(l=U.Quaternion.Inverse(l)),U.Matrix.FromQuaternionToRef(l,a._babylonTexture.getReflectionTextureMatrix()))},getTarget:l=>l._babylonTexture}}}}},animations:{length:{type:"number",get:l=>l.length,getTarget:l=>l.map((l=>l._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:l=>l.length,getTarget:l=>l.map((l=>{var a;return null===(a=l.primitives[0]._instanceData)||void 0===a?void 0:a.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function H(l){return new S(l,y)}function u(l){const a=l.split("/").map((l=>l.replace(/{}/g,"__array__")));let N=y;for(const U of a)U&&(N=N[U]);if(N&&N.type&&N.get)return N}function W(l,a){const N=l.split("/").map((l=>l.replace(/{}/g,"__array__")));let U=y;for(const c of N)c&&(U=U[c]);U&&U.type&&U.get&&(U.interpolation=a)}function B(l,a){const N=l.split("/").map((l=>l.replace(/{}/g,"__array__")));let U=y;for(const c of N)if(c){if(!U[c]){if("?"===c){U.__ignoreObjectTree__=!0;continue}U[c]={},"__array__"===c&&(U[c].__target__=!0)}U=U[c]}Object.assign(U,a)}},14088:(l,a,N)=>{"use strict";N.r(a),N.d(a,{AnimationPropertyInfo:()=>T,TransformNodeAnimationPropertyInfo:()=>J,WeightAnimationPropertyInfo:()=>n,getQuaternion:()=>w,getVector3:()=>Z,getWeights:()=>S});var U=N(12950),c=N(12447),K=N(14083);function Z(l,a,N,U){return c.ua.Ma(a,N).scaleInPlace(U)}function w(l,a,N,U){return c.Quaternion.Ma(a,N).scaleInPlace(U)}function S(l,a,N,U){const c=new Array(l._numMorphTargets);for(let K=0;K<c.length;K++)c[K]=a[N++]*U;return c}class T{constructor(l,a,N,U){this.type=l,this.name=a,this.getValue=N,this.getStride=U}_buildAnimation(l,a,N){const c=new U.d(l,this.name,a,this.type);return c.setKeys(N),c}}class J extends T{buildAnimations(l,a,N,U){const c=[];return c.push({babylonAnimatable:l._babylonTransformNode,babylonAnimation:this._buildAnimation(a,N,U)}),c}}class n extends T{buildAnimations(l,a,N,c){const K=[];if(l._numMorphTargets)for(let Z=0;Z<l._numMorphTargets;Z++){const w=new U.d(`${a}_${Z}`,this.name,N,this.type);if(w.setKeys(c.map((l=>({frame:l.frame,inTangent:l.inTangent?l.inTangent[Z]:void 0,value:l.value[Z],outTangent:l.outTangent?l.outTangent[Z]:void 0,interpolation:l.interpolation})))),l._primitiveBabylonMeshes)for(const a of l._primitiveBabylonMeshes)if(a.morphTargetManager){const l=a.morphTargetManager.getTarget(Z),N=w.clone();l.animations.push(N),K.push({babylonAnimatable:l,babylonAnimation:N})}}return K}}(0,K.g)("/nodes/{}/translation",[new J(U.d.ANIMATIONTYPE_VECTOR3,"position",Z,(()=>3))]),(0,K.g)("/nodes/{}/rotation",[new J(U.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",w,(()=>4))]),(0,K.g)("/nodes/{}/scale",[new J(U.d.ANIMATIONTYPE_VECTOR3,"Oc",Z,(()=>3))]),(0,K.g)("/nodes/{}/weights",[new n(U.d.ANIMATIONTYPE_FLOAT,"influence",S,(l=>l._numMorphTargets))])},14045:(l,a,N)=>{"use strict";class U{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((l,a)=>{this._resolve=l,this._reject=a}))}}var c=N(12447),K=N(12479),Z=N(12254),w=N(12885),S=N(14053),T=N(14063),J=N(12260),n=N(12903),y=N(12950),H=N(12958),u=N(12296),W=N(12268),B=N(12274);class Y{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(l){this._useTextureToStoreBoneMatrices=l,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(l){this._animationPropertiesOverride=l}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(l,a,N){this.name=l,this.id=a,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=c.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new J.e,this.bones=[],this._scene=N||u.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const U=this._scene.getEngine().getCaps();this._canUseTextureForBones=U.textureFloat&&U.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((l=>!l.getParent()))}getTransformMatrices(l){if(this.needInitialSkinMatrix){if(!l)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return l._bonesTransformMatrices||this.prepare(!0),l._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(l){return this.needInitialSkinMatrix&&l._transformMatrixTexture?l._transformMatrixTexture:this._transformMatrixTexture}bl(){return this._scene}toString(l){let a=`Name: ${this.name}, nBones: ${this.bones.length}`;if(a+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,l){a+=", Ranges: {";let l=!0;for(const N in this._ranges)l&&(a+=", ",l=!1),a+=N;a+="}"}return a}getBoneIndexByName(l){for(let a=0,N=this.bones.length;a<N;a++)if(this.bones[a].name===l)return a;return-1}createAnimationRange(l,a,N){if(!this._ranges[l]){this._ranges[l]=new H.c(l,a,N);for(let U=0,c=this.bones.length;U<c;U++)this.bones[U].animations[0]&&this.bones[U].animations[0].createRange(l,a,N)}}deleteAnimationRange(l){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let N=0,U=this.bones.length;N<U;N++)this.bones[N].animations[0]&&this.bones[N].animations[0].deleteRange(l,a);this._ranges[l]=null}getAnimationRange(l){return this._ranges[l]||null}getAnimationRanges(){const l=[];let a;for(a in this._ranges)l.push(this._ranges[a]);return l}copyAnimationRange(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[a]||!l.getAnimationRange(a))return!1;let U=!0;const c=this._getHighestAnimationFrame()+1,K={},Z=l.bones;let w,S;for(S=0,w=Z.length;S<w;S++)K[Z[S].name]=Z[S];this.bones.length!==Z.length&&(W.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Z.length}`),U=!1);const T=N&&this.dimensionsAtRest&&l.dimensionsAtRest?this.dimensionsAtRest.divide(l.dimensionsAtRest):null;for(S=0,w=this.bones.length;S<w;S++){const l=this.bones[S].name,Z=K[l];Z?U=U&&this.bones[S].copyAnimationRange(Z,a,c,N,T):(W.b.Warn("copyAnimationRange: not same rig, missing source bone "+l),U=!1)}const J=l.getAnimationRange(a);return J&&(this._ranges[a]=new H.c(a,J.from+c,J.to+c)),U}returnToRest(){for(const l of this.bones)-1!==l._index&&l.returnToRest()}_getHighestAnimationFrame(){let l=0;for(let a=0,N=this.bones.length;a<N;a++)if(this.bones[a].animations[0]){const N=this.bones[a].animations[0].getHighestFrame();l<N&&(l=N)}return l}beginAnimation(l,a,N,U){const c=this.getAnimationRange(l);return c?this._scene.beginAnimation(this,c.from,c.to,a,N,U):null}static MakeAnimationAdditive(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;const U=l.getAnimationRange(N);if(!U)return null;const c=l._scene.getAllAnimatablesByTarget(l);let K=null;for(let w=0;w<c.length;w++){const l=c[w];if(l.fromFrame===(null===U||void 0===U?void 0:U.from)&&l.toFrame===(null===U||void 0===U?void 0:U.to)){K=l;break}}const Z=l.getAnimatables();for(let w=0;w<Z.length;w++){const l=Z[w].animations;if(l)for(let U=0;U<l.length;U++)y.d.MakeAnimationAdditive(l[U],a,N)}return K&&(K.isAdditive=!0),l}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(l){this._meshesWithPoseMatrix.push(l)}_unregisterMeshWithPoseMatrix(l){const a=this._meshesWithPoseMatrix.indexOf(l);a>-1&&this._meshesWithPoseMatrix.splice(a,1)}_computeTransformMatrices(l,a){this.onBeforeComputeObservable.notifyObservers(this);for(let N=0;N<this.bones.length;N++){const U=this.bones[N];U._childUpdateId++;const c=U.getParent();if(c?U.getLocalMatrix().multiplyToRef(c.getFinalMatrix(),U.getFinalMatrix()):a?U.getLocalMatrix().multiplyToRef(a,U.getFinalMatrix()):U.getFinalMatrix().K(U.getLocalMatrix()),-1!==U._index){const a=null===U._index?N:U._index;U.getAbsoluteInverseBindMatrix().multiplyToArray(U.getFinalMatrix(),l,16*a)}}this._identity.copyToArray(l,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const l=this.bl().getRenderId();if(this._currentRenderId===l)return;this._currentRenderId=l}if(this._numBonesWithLinkedTransformNode>0)for(const l of this.bones)if(l._linkedTransformNode){const a=l._linkedTransformNode;l.position=a.position,a.rotationQuaternion?l.rotationQuaternion=a.rotationQuaternion:l.rotation=a.rotation,l.Oc=a.Oc}if(this.needInitialSkinMatrix)for(const l of this._meshesWithPoseMatrix){const a=l.getPoseMatrix();let N=this._isDirty;if(l._bonesTransformMatrices&&l._bonesTransformMatrices.length===16*(this.bones.length+1)||(l._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),N=!0),N){if(this._synchronizedWithMesh!==l){this._synchronizedWithMesh=l;for(const l of this.bones)if(!l.getParent()){l.getBindMatrix().multiplyToRef(a,c.TmpVectors.Matrix[1]),l._updateAbsoluteBindMatrices(c.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const a=4*(this.bones.length+1);l._transformMatrixTexture&&l._transformMatrixTexture.getSize().width===a||(l._transformMatrixTexture&&l._transformMatrixTexture.dispose(),l._transformMatrixTexture=n.d.CreateRGBATexture(l._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(l._bonesTransformMatrices,a),this.isUsingTextureForMatrices&&l._transformMatrixTexture&&l._transformMatrixTexture.update(l._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=n.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let l=0;l<this.bones.length;l++)this._animatables.push(this.bones[l])}return this._animatables}clone(l,a){const N=new Y(l,a||l,this._scene);N.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let U=0;U<this.bones.length;U++){const l=this.bones[U];let a=null;const c=l.getParent();if(c){const l=this.bones.indexOf(c);a=N.bones[l]}const K=new T.c(l.name,N,a,l.getBindMatrix().clone(),l.getRestMatrix().clone());K._index=l._index,l._linkedTransformNode&&K.linkTransformNode(l._linkedTransformNode),B.b.DeepCopy(l.animations,K.animations)}if(this._ranges){N._ranges={};for(const l in this._ranges){const a=this._ranges[l];a&&(N._ranges[l]=a.clone())}}return this._isDirty=!0,N.prepare(!0),N}enableBlending(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const a of this.bones)for(const N of a.animations)N.enableBlending=!0,N.blendingSpeed=l}dispose(){if(this._meshesWithPoseMatrix.length=0,this.bl().stopAnimation(this),this.bl().removeSkeleton(this),this._parentContainer){const l=this._parentContainer.skeletons.indexOf(this);l>-1&&this._parentContainer.skeletons.splice(l,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const l={};l.name=this.name,l.id=this.id,this.dimensionsAtRest&&(l.dimensionsAtRest=this.dimensionsAtRest.Bc()),l.bones=[],l.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let N=0;N<this.bones.length;N++){var a;const U=this.bones[N],c=U.getParent(),K={parentBoneIndex:c?this.bones.indexOf(c):-1,index:U.getIndex(),name:U.name,id:U.id,matrix:U.getBindMatrix().Bc(),rest:U.getRestMatrix().Bc(),linkedTransformNodeId:null===(a=U.getTransformNode())||void 0===a?void 0:a.id};l.bones.push(K),U.length&&(K.length=U.length),U.metadata&&(K.metadata=U.metadata),U.animations&&U.animations.length>0&&(K.animation=U.animations[0].serialize()),l.ranges=[];for(const a in this._ranges){const N=this._ranges[a];if(!N)continue;const U={};U.name=a,U.from=N.from,U.to=N.to,l.ranges.push(U)}}return l}static Parse(l,a){const N=new Y(l.name,l.id,a);let U;for(l.dimensionsAtRest&&(N.dimensionsAtRest=c.ua.Ma(l.dimensionsAtRest)),N.needInitialSkinMatrix=l.needInitialSkinMatrix,U=0;U<l.bones.length;U++){const a=l.bones[U],K=l.bones[U].index;let Z=null;a.parentBoneIndex>-1&&(Z=N.bones[a.parentBoneIndex]);const w=a.rest?c.Matrix.Ma(a.rest):null,S=new T.c(a.name,N,Z,c.Matrix.Ma(a.matrix),w,null,K);void 0!==a.id&&null!==a.id&&(S.id=a.id),a.length&&(S.length=a.length),a.metadata&&(S.metadata=a.metadata),a.animation&&S.animations.push(y.d.Parse(a.animation)),void 0!==a.linkedTransformNodeId&&null!==a.linkedTransformNodeId&&(N._hasWaitingData=!0,S._waitingTransformNodeId=a.linkedTransformNodeId)}if(l.ranges)for(U=0;U<l.ranges.length;U++){const a=l.ranges[U];N.createAnimationRange(a.name,a.from,a.to)}return N}computeAbsoluteMatrices(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||l)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(l)}getPoseMatrix(){let l=null;return this._meshesWithPoseMatrix.length>0&&(l=this._meshesWithPoseMatrix[0].getPoseMatrix()),l}sortBones(){const l=[],a=new Array(this.bones.length);for(let N=0;N<this.bones.length;N++)this._sortBones(N,l,a);this.bones=l}_sortBones(l,a,N){if(N[l])return;N[l]=!0;const U=this.bones[l];if(!U)return;void 0===U._index&&(U._index=l);const c=U.getParent();c&&this._sortBones(this.bones.indexOf(c),a,N),a.push(U)}setCurrentPoseAsRest(){for(const l of this.bones)l.setCurrentPoseAsRest()}}var C=N(12753),M=N(12920),A=N(12422),E=N(12855),q=N(12506),b=N(12892),z=N(12868),I=N(12883),t=N(12962),O=N(12530),h=N(14012);class i{set areUpdatesFrozen(l){l?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new O.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,l||(l=u.e.LastCreatedScene),this._scene=l,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const l=this._scene.getEngine().getCaps();this._canUseTextureForTargets=l.canUseGLVertexID&&l.textureFloat&&l.maxVertexTextureImageUnits>0&&l.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return i.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?i.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(l){this._numMaxInfluencers!==l&&(this._numMaxInfluencers=l,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(l){this._useTextureToStoreTargets!==l&&(this._useTextureToStoreTargets=l,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var l;return i.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(l=this._scene)&&void 0!==l&&l.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(l){return this._activeTargets.data[l]}getTarget(l){return this._targets[l]}getTargetByName(l){for(const a of this._targets)if(a.name===l)return a;return null}addTarget(l){this._targets.push(l),this._targetInfluenceChangedObservers.push(l.onInfluenceChanged.add((l=>{this.areUpdatesFrozen&&l&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(l)}))),this._targetDataLayoutChangedObservers.push(l._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(l){const a=this._targets.indexOf(l);a>=0&&(this._targets.splice(a,1),l.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(a,1)[0]),l._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(a,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(l)}_bind(l){l.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),l.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),l.setTexture("morphTargets",this._targetStoreTexture),l.setInt("morphTargetCount",this.numInfluencers)}clone(){const l=new i(this._scene);for(const a of this._targets)l.addTarget(a.clone());return l.enablePositionMorphing=this.enablePositionMorphing,l.enableNormalMorphing=this.enableNormalMorphing,l.enableTangentMorphing=this.enableTangentMorphing,l.enableUVMorphing=this.enableUVMorphing,l.enableUV2Morphing=this.enableUV2Morphing,l.enableColorMorphing=this.enableColorMorphing,l}serialize(){const l={};l.id=this.uniqueId,l.targets=[];for(const a of this._targets)l.targets.push(a.serialize());return l}_syncActiveTargets(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const a=!!this._targetStoreTexture,N=this.isUsingTextureForTargets;(this._mustSynchronize||a!==N)&&(this._mustSynchronize=!1,this.synchronize());let U=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let c=-1;for(const K of this._targets)if(c++,0!==K.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=i.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(K),this._morphTargetTextureIndices[U]=c,this._tempInfluences[U++]=K.influence}this._morphTargetTextureIndices.length!==U&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,U)),this._influences&&this._influences.length===U||(this._influences=new Float32Array(U));for(let K=0;K<U;K++)this._influences[K]=this._tempInfluences[K];if(l&&this._scene)for(const K of this._scene.meshes)K.morphTargetManager===this&&(N?K._markSubMeshesAsAttributesDirty():K._syncGeometryWithMorphTargetManager())}synchronize(){var l;if(!this._scene||this.areUpdatesFrozen)return;const a=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(l=this._targetStoreTexture)||void 0===l||l.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>a.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const N of this._targets){this._supportsPositions=this._supportsPositions&&N.hasPositions,this._supportsNormals=this._supportsNormals&&N.hasNormals,this._supportsTangents=this._supportsTangents&&N.hasTangents,this._supportsUVs=this._supportsUVs&&N.hasUVs,this._supportsUV2s=this._supportsUV2s&&N.hasUV2s,this._supportsColors=this._supportsColors&&N.hasColors;const l=N.vertexCount;if(0===this._vertexCount)this._vertexCount=l;else if(this._vertexCount!==l)return void W.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${N.name}": ${l}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const l=a.getCaps().maxTextureSize;this._textureWidth>l&&(this._textureHeight=Math.ceil(this._textureWidth/l),this._textureWidth=l);const N=this._targets.length,U=new Float32Array(N*this._textureWidth*this._textureHeight*4);let c=0;for(let a=0;a<N;a++){const l=this._targets[a],N=l.getPositions(),K=l.getNormals(),Z=l.getUVs(),w=l.getTangents(),S=l.getUV2s(),T=l.getColors();c=a*this._textureWidth*this._textureHeight*4;for(let a=0;a<this._vertexCount;a++)this._supportsPositions&&N&&(U[c]=N[3*a],U[c+1]=N[3*a+1],U[c+2]=N[3*a+2],c+=4),this._supportsNormals&&K&&(U[c]=K[3*a],U[c+1]=K[3*a+1],U[c+2]=K[3*a+2],c+=4),this._supportsUVs&&Z&&(U[c]=Z[2*a],U[c+1]=Z[2*a+1],c+=4),this._supportsTangents&&w&&(U[c]=w[3*a],U[c+1]=w[3*a+1],U[c+2]=w[3*a+2],c+=4),this._supportsUV2s&&S&&(U[c]=S[2*a],U[c+1]=S[2*a+1],c+=4),this._supportsColors&&T&&(U[c]=T[4*a],U[c+1]=T[4*a+1],U[c+2]=T[4*a+2],U[c+3]=T[4*a+3],c+=4)}this._targetStoreTexture=h.e.CreateRGBATexture(U,this._textureWidth,this._textureHeight,N,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const N of this._scene.meshes)N.morphTargetManager===this&&N._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const l=this._parentContainer.morphTargetManagers.indexOf(this);l>-1&&this._parentContainer.morphTargetManagers.splice(l,1),this._parentContainer=null}for(const l of this._targets)this._scene.stopAnimation(l)}}static Parse(l,a){const N=new i(a);for(const U of l.targets)N.addTarget(t.b.Parse(U,a));return N}}i.EnableTextureStorage=!0,i.MaxActiveMorphTargetsInVertexAttributeMode=8,i.ConstantTargetCountForTextureMode=0;var k=N(14072),Q=N(12298),j=N(12771);const f=new Map,p=f;function R(l,a,N){L(l)&&W.b.Warn(`Extension with the name '${l}' already exists`),f.set(l,{isGLTFExtension:a,factory:N})}function L(l){return f.delete(l)}var r=N(14083),X=N(13012),P=N(12520);class d{static Get(l,a,N){if(!a||void 0==N||!a[N])throw new Error(`${l}: Failed to find index (${N})`);return a[N]}static TryGet(l,a){return l&&void 0!=a&&l[a]?l[a]:null}static Assign(l){if(l)for(let a=0;a<l.length;a++)l[a].index=a}}function F(l){if(l.min&&l.max){const a=l.min,N=l.max,U=c.TmpVectors.ua[0].tc(a[0],a[1],a[2]),K=c.TmpVectors.ua[1].tc(N[0],N[1],N[2]);if(l.normalized&&5126!==l.componentType){let a=1;switch(l.componentType){case 5120:a=127;break;case 5121:a=255;break;case 5122:a=32767;break;case 5123:a=65535}const N=1/a;U.scaleInPlace(N),K.scaleInPlace(N)}return new j.b(U,K)}return null}class e{static RegisterExtension(l,a){R(l,!1,a)}static UnregisterExtension(l){return L(l)}get Hc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(l){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=l}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((l=>l.dispose&&l.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(l,a,N,U,c,K){let Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=a,this._assetContainer=N,this._loadData(U);let K=null;if(l){const a={};if(this._gltf.nodes)for(const l of this._gltf.nodes)l.name&&(a[l.name]=l.index);K=(l instanceof Array?l:[l]).map((l=>{const N=a[l];if(void 0===N)throw new Error(`Failed to find node '${l}'`);return N}))}return await this._loadAsync(c,Z,K,(()=>({meshes:this._getMeshes(),wy:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=l,this._loadData(a),await this._loadAsync(N,c,null,(()=>{}))}async _loadAsync(l,a,N,U){return await Promise.resolve().then((async()=>{this._rootUrl=l,this._uniqueRootUrl=!l.startsWith("file:")&&a?l:`${l}${Date.now()}/`,this._fileName=a,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const c=`${k.n[k.n.LOADING]} => ${k.n[k.n.READY]}`,K=`${k.n[k.n.LOADING]} => ${k.n[k.n.COMPLETE]}`;this._parent._startPerformanceCounter(c),this._parent._startPerformanceCounter(K),this._parent._setState(k.n.LOADING),this._extensionsOnLoading();const w=new Array;if(!this.parent.loadOnlyMaterials)if(N)w.push(this.loadSceneAsync("/nodes",{nodes:N,index:-1}));else if(void 0!=this._gltf.Ba||this._gltf.scenes&&this._gltf.scenes[0]){const l=d.Get("/scene",this._gltf.scenes,this._gltf.Ba||0);w.push(this.loadSceneAsync(`/scenes/${l.index}`,l))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let l=0;l<this._gltf.materials.length;++l){const a=this._gltf.materials[l],N="/materials/"+l,U=C.c.TriangleFillMode;w.push(this._loadMaterialAsync(N,a,null,U,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&w.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&w.push(this._compileShadowGeneratorsAsync());const S=Promise.all(w).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.lS(!0);for(const l of this._babylonScene.materials){const a=l;void 0!==a.maxSimultaneousLights&&(a.maxSimultaneousLights=Math.max(a.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(k.n.READY),this._skipStartAnimationStep||this._startAnimations(),U()}));return await S.then((l=>(this._parent._endPerformanceCounter(c),Z.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(K),this._parent._setState(k.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(l=>{this._parent.onErrorObservable.notifyObservers(l),this._parent.onErrorObservable.clear(),this.dispose()}))})),l)))})).catch((l=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(l),this._parent.onErrorObservable.clear(),this.dispose()),l}))}_loadData(l){if(this._gltf=l.json,this._setupData(),l.bin){const a=this._gltf.buffers;if(a&&a[0]&&!a[0].uri){const N=a[0];(N.byteLength<l.bin.byteLength-3||N.byteLength>l.bin.byteLength)&&W.b.Warn(`Binary buffer length (${N.byteLength}) from JSON does not match chunk length (${l.bin.byteLength})`),this._bin=l.bin}else W.b.Warn("Unexpected BIN chunk")}}_setupData(){if(d.Assign(this._gltf.accessors),d.Assign(this._gltf.animations),d.Assign(this._gltf.buffers),d.Assign(this._gltf.bufferViews),d.Assign(this._gltf.cameras),d.Assign(this._gltf.images),d.Assign(this._gltf.materials),d.Assign(this._gltf.meshes),d.Assign(this._gltf.nodes),d.Assign(this._gltf.samplers),d.Assign(this._gltf.scenes),d.Assign(this._gltf.skins),d.Assign(this._gltf.textures),this._gltf.nodes){const l={};for(const N of this._gltf.nodes)if(N.children)for(const a of N.children)l[a]=N.index;const a=this._createRootNode();for(const N of this._gltf.nodes){const U=l[N.index];N.parent=void 0===U?a:this._gltf.nodes[U]}}}async _loadExtensionsAsync(){const l=[];if(p.forEach(((a,N)=>{var U;!1===(null===(U=this.parent.extensionOptions[N])||void 0===U?void 0:U.enabled)?a.isGLTFExtension&&this.isExtensionUsed(N)&&W.b.Warn(`Extension ${N} is used but has been explicitly disabled.`):a.isGLTFExtension&&!this.isExtensionUsed(N)||l.push((async()=>{const l=await a.factory(this);return l.name!==N&&W.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${l.name} !== ${N}`),this._parent.onExtensionLoadedObservable.notifyObservers(l),l})())})),this._extensions.push(...await Promise.all(l)),this._extensions.sort(((l,a)=>(l.order||Number.MAX_VALUE)-(a.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const N of this._gltf.extensionsRequired){if(!this._extensions.some((l=>l.name===N&&l.enabled))){var a;if(!1===(null===(a=this.parent.extensionOptions[N])||void 0===a?void 0:a.enabled))throw new Error(`Required extension ${N} is disabled`);throw new Error(`Required extension ${N} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new I.d("__root__",this._babylonScene);this._rootBabylonMesh=l,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.lS(!1);const a={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case k.m.AUTO:this._babylonScene.useRightHandedSystem||(a.rotation=[0,1,0,0],a.scale=[1,1,-1],e._LoadTransform(a,this._rootBabylonMesh));break;case k.m.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(l),a}loadSceneAsync(l,a){const N=this._extensionsLoadSceneAsync(l,a);if(N)return N;const U=new Array;if(this.logOpen(`${l} ${a.name||""}`),a.nodes)for(const c of a.nodes){const a=d.Get(`${l}/nodes/${c}`,this._gltf.nodes,c);U.push(this.loadNodeAsync(`/nodes/${a.index}`,a,(l=>{l.parent=this._rootBabylonMesh})))}for(const c of this._postSceneLoadActions)c();return U.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(U).then((()=>{}))}_forEachPrimitive(l,a){if(l._primitiveBabylonMeshes)for(const N of l._primitiveBabylonMeshes)a(N)}_getGeometries(){const l=[],a=this._gltf.nodes;if(a)for(const N of a)this._forEachPrimitive(N,(a=>{const N=a.bc;N&&-1===l.indexOf(N)&&l.push(N)}));return l}_getMeshes(){const l=[];this._rootBabylonMesh instanceof z.b&&l.push(this._rootBabylonMesh);const a=this._gltf.nodes;if(a)for(const N of a)this._forEachPrimitive(N,(a=>{l.push(a)}));return l}_getTransformNodes(){const l=[],a=this._gltf.nodes;if(a)for(const N of a)N._babylonTransformNode&&"Fc"===N._babylonTransformNode.getClassName()&&l.push(N._babylonTransformNode),N._babylonTransformNodeForSkin&&l.push(N._babylonTransformNodeForSkin);return l}_getSkeletons(){const l=[],a=this._gltf.skins;if(a)for(const N of a)N._data&&l.push(N._data.babylonSkeleton);return l}_getAnimationGroups(){const l=[],a=this._gltf.animations;if(a)for(const N of a)N._babylonAnimationGroup&&l.push(N._babylonAnimationGroup);return l}_startAnimations(){switch(this._parent.animationStartMode){case k.i.NONE:break;case k.i.FIRST:{const l=this._getAnimationGroups();0!==l.length&&l[0].start(!0);break}case k.i.ALL:{const l=this._getAnimationGroups();for(const a of l)a.start(!0);break}default:return void W.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const U=this._extensionsLoadNodeAsync(l,a,N);if(U)return U;if(a._babylonTransformNode)throw new Error(`${l}: Invalid recursive node hierarchy`);const c=new Array;this.logOpen(`${l} ${a.name||""}`);const K=U=>{if(e.AddPointerMetadata(U,l),e._LoadTransform(a,U),void 0!=a.camera){const N=d.Get(`${l}/camera`,this._gltf.cameras,a.camera);c.push(this.loadCameraAsync(`/cameras/${N.index}`,N,(l=>{l.parent=U,this._babylonScene.useRightHandedSystem||(U.Oc.x=-1)})))}if(a.children)for(const N of a.children){const a=d.Get(`${l}/children/${N}`,this._gltf.nodes,N);c.push(this.loadNodeAsync(`/nodes/${a.index}`,a,(l=>{l.parent=U})))}N(U)},Z=void 0!=a.mesh,w=this._parent.loadSkins&&void 0!=a.skin;if(!Z||w){const l=a.name||`node${a.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new E.e(l,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==a.mesh?a._babylonTransformNode=N:a._babylonTransformNodeForSkin=N,K(N)}if(Z)if(w){const N=d.Get(`${l}/mesh`,this._gltf.meshes,a.mesh);c.push(this._loadMeshAsync(`/meshes/${N.index}`,a,N,(N=>{const U=a._babylonTransformNodeForSkin;N.metadata=(0,X.e)(U.metadata,N.metadata||{});const K=d.Get(`${l}/skin`,this._gltf.skins,a.skin);c.push(this._loadSkinAsync(`/skins/${K.index}`,a,K,(l=>{this._forEachPrimitive(a,(a=>{a.skeleton=l})),this._postSceneLoadActions.push((()=>{if(void 0!=K.skeleton){const l=d.Get(`/skins/${K.index}/skeleton`,this._gltf.nodes,K.skeleton).parent;a.index===l.index?N.parent=U.parent:N.parent=l._babylonTransformNode}else N.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:U,skinnedNode:N})}))})))})))}else{const N=d.Get(`${l}/mesh`,this._gltf.meshes,a.mesh);c.push(this._loadMeshAsync(`/meshes/${N.index}`,a,N,K))}return this.logClose(),Promise.all(c).then((()=>(this._forEachPrimitive(a,(l=>{const a=l;!a.isAnInstance&&a.bc&&a.bc.useBoundingInfoFromGeometry?l.jl():l.refreshBoundingInfo(!0,!0)})),a._babylonTransformNode)))}_loadMeshAsync(l,a,N,U){const c=N.primitives;if(!c||!c.length)throw new Error(`${l}: Primitives are missing`);void 0==c[0].index&&d.Assign(c);const K=new Array;this.logOpen(`${l} ${N.name||""}`);const Z=a.name||`node${a.index}`;if(1===c.length){const U=N.primitives[0];K.push(this._loadMeshPrimitiveAsync(`${l}/primitives/${U.index}`,Z,a,N,U,(l=>{a._babylonTransformNode=l,a._primitiveBabylonMeshes=[l]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,a._babylonTransformNode=new E.e(Z,this._babylonScene),a._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a._primitiveBabylonMeshes=[];for(const U of c)K.push(this._loadMeshPrimitiveAsync(`${l}/primitives/${U.index}`,`${Z}_primitive${U.index}`,a,N,U,(l=>{l.parent=a._babylonTransformNode,a._primitiveBabylonMeshes.push(l)})))}return U(a._babylonTransformNode),this.logClose(),Promise.all(K).then((()=>a._babylonTransformNode))}_loadMeshPrimitiveAsync(l,a,N,U,c,K){const Z=this._extensionsLoadMeshPrimitiveAsync(l,a,N,U,c,K);if(Z)return Z;this.logOpen(`${l}`);const w=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==N.skin&&!U.primitives[0].targets;let S,T;if(w&&c._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,S=c._instanceData.babylonSourceMesh.createInstance(a),S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T=c._instanceData.promise;else{const K=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new I.d(a,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.sideOrientation=this._babylonScene.useRightHandedSystem?C.c.CounterClockWiseSideOrientation:C.c.ClockWiseSideOrientation,this._createMorphTargets(l,N,U,c,Z),K.push(this._loadVertexDataAsync(l,c,Z).then((async a=>await this._loadMorphTargetsAsync(l,c,Z,a).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,a.kl(Z),a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const J=e._GetDrawMode(l,c.mode);if(void 0==c.material){let l=this._defaultBabylonMaterialData[J];l||(l=this._createDefaultMaterial("__GLTFLoader._default",J),this._parent.onMaterialLoadedObservable.notifyObservers(l),this._defaultBabylonMaterialData[J]=l),Z.material=l}else if(!this.parent.skipMaterials){const a=d.Get(`${l}/material`,this._gltf.materials,c.material);K.push(this._loadMaterialAsync(`/materials/${a.index}`,a,Z,J,(l=>{Z.material=l})))}T=Promise.all(K),w&&(c._instanceData={babylonSourceMesh:Z,promise:T}),S=Z}return e.AddPointerMetadata(S,l),this._parent.onMeshLoadedObservable.notifyObservers(S),K(S),this.logClose(),T.then((()=>S))}_loadVertexDataAsync(l,a,N){const U=this._extensionsLoadVertexDataAsync(l,a,N);if(U)return U;const c=a.attributes;if(!c)throw new Error(`${l}: Attributes are missing`);const K=new Array,Z=new b.d(N.name,this._babylonScene);if(void 0==a.indices)N.isUnIndexed=!0;else{const N=d.Get(`${l}/indices`,this._gltf.accessors,a.indices);K.push(this._loadIndicesAccessorAsync(`/accessors/${N.index}`,N).then((l=>{Z.setIndices(l)})))}const w=(a,U,w)=>{if(void 0==c[a])return;N._delayInfo=N._delayInfo||[],-1===N._delayInfo.indexOf(U)&&N._delayInfo.push(U);const S=d.Get(`${l}/attributes/${a}`,this._gltf.accessors,c[a]);K.push(this._loadVertexAccessorAsync(`/accessors/${S.index}`,S,U).then((l=>{if(l.getKind()===q.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!N.skeleton){const l=F(S);l&&(Z._boundingInfo=l,Z.useBoundingInfoFromGeometry=!0)}Z.setVerticesBuffer(l,S.count)}))),U==q.h.MatricesIndicesExtraKind&&(N.numBoneInfluencers=8),w&&w(S)};return w("POSITION",q.h.PositionKind),w("NORMAL",q.h.NormalKind),w("TANGENT",q.h.TangentKind),w("TEXCOORD_0",q.h.UVKind),w("TEXCOORD_1",q.h.UV2Kind),w("TEXCOORD_2",q.h.UV3Kind),w("TEXCOORD_3",q.h.UV4Kind),w("TEXCOORD_4",q.h.UV5Kind),w("TEXCOORD_5",q.h.UV6Kind),w("JOINTS_0",q.h.MatricesIndicesKind),w("WEIGHTS_0",q.h.MatricesWeightsKind),w("JOINTS_1",q.h.MatricesIndicesExtraKind),w("WEIGHTS_1",q.h.MatricesWeightsExtraKind),w("COLOR_0",q.h.ColorKind,(l=>{"VEC4"===l.type&&(N.hasVertexAlpha=!0)})),Promise.all(K).then((()=>Z))}_createMorphTargets(l,a,N,U,c){if(!U.targets||!this._parent.loadMorphTargets)return;if(void 0==a._numMorphTargets)a._numMorphTargets=U.targets.length;else if(U.targets.length!==a._numMorphTargets)throw new Error(`${l}: Primitives do not have the same number of targets`);const K=N.extras?N.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,c.morphTargetManager=new i(this._babylonScene),c.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.morphTargetManager.areUpdatesFrozen=!0;for(let Z=0;Z<U.targets.length;Z++){const l=a.weights?a.weights[Z]:N.weights?N.weights[Z]:0,U=K?K[Z]:`morphTarget${Z}`;c.morphTargetManager.addTarget(new t.b(U,l,c.bl()))}}_loadMorphTargetsAsync(l,a,N,U){if(!a.targets||!this._parent.loadMorphTargets)return Promise.resolve();const c=new Array,K=N.morphTargetManager;for(let Z=0;Z<K.numTargets;Z++){const N=K.getTarget(Z);c.push(this._loadMorphTargetVertexDataAsync(`${l}/targets/${Z}`,U,a.targets[Z],N))}return Promise.all(c).then((()=>{K.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(l,a,N,U){const c=new Array,K=(U,K,Z)=>{if(void 0==N[U])return;const w=a.getVertexBuffer(K);if(!w)return;const S=d.Get(`${l}/${U}`,this._gltf.accessors,N[U]);c.push(this._loadFloatAccessorAsync(`/accessors/${S.index}`,S).then((l=>{Z(w,l)})))};return K("POSITION",q.h.PositionKind,((l,a)=>{const N=new Float32Array(a.length);l.forEach(a.length,((l,U)=>{N[U]=a[U]+l})),U.setPositions(N)})),K("NORMAL",q.h.NormalKind,((l,a)=>{const N=new Float32Array(a.length);l.forEach(N.length,((l,U)=>{N[U]=a[U]+l})),U.setNormals(N)})),K("TANGENT",q.h.TangentKind,((l,a)=>{const N=new Float32Array(a.length/3*4);let c=0;l.forEach(a.length/3*4,((l,U)=>{(U+1)%4!==0&&(N[c]=a[c]+l,c++)})),U.setTangents(N)})),K("TEXCOORD_0",q.h.UVKind,((l,a)=>{const N=new Float32Array(a.length);l.forEach(a.length,((l,U)=>{N[U]=a[U]+l})),U.setUVs(N)})),K("TEXCOORD_1",q.h.UV2Kind,((l,a)=>{const N=new Float32Array(a.length);l.forEach(a.length,((l,U)=>{N[U]=a[U]+l})),U.setUV2s(N)})),K("COLOR_0",q.h.ColorKind,((a,N)=>{let c=null;const K=a.getSize();if(3===K){c=new Float32Array(N.length/3*4),a.forEach(N.length,((l,a)=>{const U=Math.floor(a/3),K=a%3;c[4*U+K]=N[3*U+K]+l}));for(let l=0;l<N.length/3;++l)c[4*l+3]=1}else{if(4!==K)throw new Error(`${l}: Invalid number of components (${K}) for COLOR_0 attribute`);c=new Float32Array(N.length),a.forEach(N.length,((l,a)=>{c[a]=N[a]+l}))}U.setColors(c)})),await Promise.all(c).then((()=>{}))}static _LoadTransform(l,a){if(void 0!=l.skin)return;let N=c.ua.Zero(),U=c.Quaternion.Identity(),K=c.ua.One();if(l.matrix){c.Matrix.Ma(l.matrix).decompose(K,U,N)}else l.translation&&(N=c.ua.Ma(l.translation)),l.rotation&&(U=c.Quaternion.Ma(l.rotation)),l.scale&&(K=c.ua.Ma(l.scale));a.position=N,a.rotationQuaternion=U,a.Oc=K}_loadSkinAsync(l,a,N,U){if(!this._parent.loadSkins)return Promise.resolve();const c=this._extensionsLoadSkinAsync(l,a,N);if(c)return c;if(N._data)return U(N._data.babylonSkeleton),N._data.promise;const K=`skeleton${N.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new Y(N.name||K,K,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(l,N,Z);const w=this._loadSkinInverseBindMatricesDataAsync(l,N).then((l=>{this._updateBoneMatrices(Z,l)}));return N._data={babylonSkeleton:Z,promise:w},U(Z),w}_loadBones(l,a,N){if(void 0==a.skeleton||this._parent.alwaysComputeSkeletonRootNode){const N=this._findSkeletonRootNode(`${l}/joints`,a.joints);if(N)if(void 0===a.skeleton)a.skeleton=N.index;else{const U=(l,a)=>{for(;a.parent;a=a.parent)if(a.parent===l)return!0;return!1},c=d.Get(`${l}/skeleton`,this._gltf.nodes,a.skeleton);c===N||U(c,N)||(W.b.Warn(`${l}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),a.skeleton=N.index)}else W.b.Warn(`${l}: Failed to find common root`)}const U={};for(const c of a.joints){const K=d.Get(`${l}/joints/${c}`,this._gltf.nodes,c);this._loadBone(K,a,N,U)}}_findSkeletonRootNode(l,a){if(0===a.length)return null;const N={};for(const c of a){const a=[];let U=d.Get(`${l}/${c}`,this._gltf.nodes,c);for(;-1!==U.index;)a.unshift(U),U=U.parent;N[c]=a}let U=null;for(let c=0;;++c){let l=N[a[0]];if(c>=l.length)return U;const K=l[c];for(let Z=1;Z<a.length;++Z)if(l=N[a[Z]],c>=l.length||K!==l[c])return U;U=K}}_loadBone(l,a,N,U){l._isJoint=!0;let c=U[l.index];if(c)return c;let K=null;l.index!==a.skeleton&&(l.parent&&-1!==l.parent.index?K=this._loadBone(l.parent,a,N,U):void 0!==a.skeleton&&W.b.Warn(`/skins/${a.index}/skeleton: Skeleton node is not a common root`));const Z=a.joints.indexOf(l.index);return c=new T.c(l.name||`joint${l.index}`,N,K,this._getNodeMatrix(l),null,null,Z),U[l.index]=c,this._postSceneLoadActions.push((()=>{c.linkTransformNode(l._babylonTransformNode)})),c}_loadSkinInverseBindMatricesDataAsync(l,a){if(void 0==a.inverseBindMatrices)return Promise.resolve(null);const N=d.Get(`${l}/inverseBindMatrices`,this._gltf.accessors,a.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${N.index}`,N)}_updateBoneMatrices(l,a){for(const N of l.bones){const l=c.Matrix.Identity(),U=N._index;a&&-1!==U&&(c.Matrix.FromArrayToRef(a,16*U,l),l.invertToRef(l));const K=N.getParent();K&&l.multiplyToRef(K.getAbsoluteInverseBindMatrix(),l),N.Ec(l,!1,!1),N._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(l){return l.matrix?c.Matrix.Ma(l.matrix):c.Matrix.Compose(l.scale?c.ua.Ma(l.scale):c.ua.One(),l.rotation?c.Quaternion.Ma(l.rotation):c.Quaternion.Identity(),l.translation?c.ua.Ma(l.translation):c.ua.Zero())}loadCameraAsync(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const U=this._extensionsLoadCameraAsync(l,a,N);if(U)return U;const K=new Array;this.logOpen(`${l} ${a.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new S.e(a.name||`camera${a.index}`,c.ua.Zero(),this._babylonScene,!1);switch(Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a._babylonCamera=Z,Z.setTarget(new c.ua(0,0,-1)),a.type){case"perspective":{const N=a.perspective;if(!N)throw new Error(`${l}: Camera perspective properties are missing`);Z.fov=N.yfov,Z.Ac=N.znear,Z.maxZ=N.zfar||0;break}case"orthographic":if(!a.orthographic)throw new Error(`${l}: Camera orthographic properties are missing`);Z.mode=w.e.ORTHOGRAPHIC_CAMERA,Z.orthoLeft=-a.orthographic.xmag,Z.orthoRight=a.orthographic.xmag,Z.orthoBottom=-a.orthographic.ymag,Z.orthoTop=a.orthographic.ymag,Z.Ac=a.orthographic.znear,Z.maxZ=a.orthographic.zfar;break;default:throw new Error(`${l}: Invalid camera type (${a.type})`)}return e.AddPointerMetadata(Z,l),this._parent.onCameraLoadedObservable.notifyObservers(Z),N(Z),this.logClose(),Promise.all(K).then((()=>Z))}_loadAnimationsAsync(){const l=this._gltf.animations;if(!l)return Promise.resolve();const a=new Array;for(let N=0;N<l.length;N++){const U=l[N];a.push(this.loadAnimationAsync(`/animations/${U.index}`,U).then((l=>{0===l.targetedAnimations.length&&l.dispose()})))}return Promise.all(a).then((()=>{}))}loadAnimationAsync(l,a){const U=this._extensionsLoadAnimationAsync(l,a);return U||N.e(78).then(N.bind(N,15594)).then((N=>{let{AnimationGroup:U}=N;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new U(a.name||`animation${a.index}`,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a._babylonAnimationGroup=c;const K=new Array;d.Assign(a.channels),d.Assign(a.samplers);for(const Z of a.channels)K.push(this._loadAnimationChannelAsync(`${l}/channels/${Z.index}`,l,a,Z,((l,a)=>{l.animations=l.animations||[],l.animations.push(a),c.addTargetedAnimation(a,l)})));return Promise.all(K).then((()=>(c.normalize(0),c)))}))}async _loadAnimationChannelAsync(l,a,U,c,K){const Z=this._extensionsLoadAnimationChannelAsync(l,a,U,c,K);if(Z)return await Z;if(void 0==c.target.node)return await Promise.resolve();const w=d.Get(`${l}/target/node`,this._gltf.nodes,c.target.node),S=c.target.path,T="weights"===S;if(T&&!w._numMorphTargets||!T&&!w._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!T&&!w._isJoint)return await Promise.resolve();let J;switch(await Promise.resolve().then(N.bind(N,14088)),S){case"translation":var n;J=null===(n=(0,r.d)("/nodes/{}/translation"))||void 0===n?void 0:n.interpolation;break;case"rotation":var y;J=null===(y=(0,r.d)("/nodes/{}/rotation"))||void 0===y?void 0:y.interpolation;break;case"scale":var H;J=null===(H=(0,r.d)("/nodes/{}/scale"))||void 0===H?void 0:H.interpolation;break;case"weights":var u;J=null===(u=(0,r.d)("/nodes/{}/weights"))||void 0===u?void 0:u.interpolation;break;default:throw new Error(`${l}/target/path: Invalid value (${c.target.path})`)}if(!J)throw new Error(`${l}/target/path: Could not find interpolation properties for target path (${c.target.path})`);const W={object:w,info:J};return await this._loadAnimationChannelFromTargetInfoAsync(l,a,U,c,W,K)}_loadAnimationChannelFromTargetInfoAsync(l,a,N,U,c,K){const Z=this.parent.targetFps,w=1/Z,S=d.Get(`${l}/sampler`,N.samplers,U.sampler);return this._loadAnimationSamplerAsync(`${a}/samplers/${U.sampler}`,S).then((l=>{let a=0;const S=c.object,T=c.info;for(const c of T){const T=c.getStride(S),J=l.input,n=l.output,y=new Array(J.length);let H=0;switch(l.interpolation){case"STEP":for(let l=0;l<J.length;l++){const a=c.getValue(S,n,H,1);H+=T,y[l]={frame:J[l]*Z,value:a,interpolation:1}}break;case"CUBICSPLINE":for(let l=0;l<J.length;l++){const a=c.getValue(S,n,H,w);H+=T;const N=c.getValue(S,n,H,1);H+=T;const U=c.getValue(S,n,H,w);H+=T,y[l]={frame:J[l]*Z,inTangent:a,value:N,outTangent:U}}break;case"LINEAR":for(let l=0;l<J.length;l++){const a=c.getValue(S,n,H,1);H+=T,y[l]={frame:J[l]*Z,value:a}}}if(H>0){const l=`${N.name||`animation${N.index}`}_channel${U.index}_${a}`,w=c.buildAnimations(S,l,Z,y);for(const N of w)a++,K(N.babylonAnimatable,N.babylonAnimation)}}}))}_loadAnimationSamplerAsync(l,a){if(a._data)return a._data;const N=a.interpolation||"LINEAR";switch(N){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${l}/interpolation: Invalid value (${a.interpolation})`)}const U=d.Get(`${l}/input`,this._gltf.accessors,a.input),c=d.Get(`${l}/output`,this._gltf.accessors,a.output);return a._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${U.index}`,U),this._loadFloatAccessorAsync(`/accessors/${c.index}`,c)]).then((l=>{let[a,U]=l;return{input:a,interpolation:N,output:U}})),a._data}loadBufferAsync(l,a,N,U){const c=this._extensionsLoadBufferAsync(l,a,N,U);if(c)return c;if(!a._data)if(a.uri)a._data=this.loadUriAsync(`${l}/uri`,a,a.uri);else{if(!this._bin)throw new Error(`${l}: Uri is missing or the binary glTF is missing its binary chunk`);a._data=this._bin.readAsync(0,a.byteLength)}return a._data.then((a=>{try{return new Uint8Array(a.buffer,a.byteOffset+N,U)}catch(c){throw new Error(`${l}: ${c.message}`)}}))}loadBufferViewAsync(l,a){const N=this._extensionsLoadBufferViewAsync(l,a);if(N)return N;if(a._data)return a._data;const U=d.Get(`${l}/buffer`,this._gltf.buffers,a.buffer);return a._data=this.loadBufferAsync(`/buffers/${U.index}`,U,a.byteOffset||0,a.byteLength),a._data}_loadAccessorAsync(l,a,N){if(a._data)return a._data;const U=e._GetNumComponents(l,a.type),c=U*q.h.GetTypeByteLength(a.componentType),K=U*a.count;if(void 0==a.bufferView)a._data=Promise.resolve(new N(K));else{const Z=d.Get(`${l}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((w=>{if(5126!==a.componentType||a.normalized||Z.byteStride&&Z.byteStride!==c){const l=new N(K);return q.h.ForEach(w,a.byteOffset||0,Z.byteStride||c,U,a.componentType,l.length,a.normalized||!1,((a,N)=>{l[N]=a})),l}return e._GetTypedArray(l,a.componentType,w,a.byteOffset,K)}))}if(a.sparse){const K=a.sparse;a._data=a._data.then((Z=>{const w=Z,S=d.Get(`${l}/sparse/indices/bufferView`,this._gltf.bufferViews,K.indices.bufferView),T=d.Get(`${l}/sparse/values/bufferView`,this._gltf.bufferViews,K.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${S.index}`,S),this.loadBufferViewAsync(`/bufferViews/${T.index}`,T)]).then((Z=>{let[S,T]=Z;const J=e._GetTypedArray(`${l}/sparse/indices`,K.indices.componentType,S,K.indices.byteOffset,K.count),n=U*K.count;let y;if(5126!==a.componentType||a.normalized){const Z=e._GetTypedArray(`${l}/sparse/values`,a.componentType,T,K.values.byteOffset,n);y=new N(n),q.h.ForEach(Z,0,c,U,a.componentType,y.length,a.normalized||!1,((l,a)=>{y[a]=l}))}else y=e._GetTypedArray(`${l}/sparse/values`,a.componentType,T,K.values.byteOffset,n);let H=0;for(let l=0;l<J.length;l++){let a=J[l]*U;for(let l=0;l<U;l++)w[a++]=y[H++]}return w}))}))}return a._data}_loadFloatAccessorAsync(l,a){return this._loadAccessorAsync(l,a,Float32Array)}_loadIndicesAccessorAsync(l,a){if("SCALAR"!==a.type)throw new Error(`${l}/type: Invalid value ${a.type}`);if(5121!==a.componentType&&5123!==a.componentType&&5125!==a.componentType)throw new Error(`${l}/componentType: Invalid value ${a.componentType}`);if(a._data)return a._data;if(a.sparse){const N=e._GetTypedArrayConstructor(`${l}/componentType`,a.componentType);a._data=this._loadAccessorAsync(l,a,N)}else{const N=d.Get(`${l}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((N=>e._GetTypedArray(l,a.componentType,N,a.byteOffset,a.count)))}return a._data}_loadVertexBufferViewAsync(l){if(l._babylonBuffer)return l._babylonBuffer;const a=this._babylonScene.getEngine();return l._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((l=>new q.e(a,l,!1))),l._babylonBuffer}_loadVertexAccessorAsync(l,a,N){var U;if(null!==(U=a._babylonVertexBuffer)&&void 0!==U&&U[N])return a._babylonVertexBuffer[N];a._babylonVertexBuffer||(a._babylonVertexBuffer={});const c=this._babylonScene.getEngine();if(a.sparse||void 0==a.bufferView)a._babylonVertexBuffer[N]=this._loadFloatAccessorAsync(l,a).then((l=>new q.h(c,l,N,!1)));else{const U=d.Get(`${l}/bufferView`,this._gltf.bufferViews,a.bufferView);a._babylonVertexBuffer[N]=this._loadVertexBufferViewAsync(U).then((K=>{const Z=e._GetNumComponents(l,a.type);return new q.h(c,K,N,!1,void 0,U.byteStride,void 0,a.byteOffset,Z,a.componentType,a.normalized,!0,void 0,!0)}))}return a._babylonVertexBuffer[N]}_loadMaterialMetallicRoughnessPropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;return a&&(a.baseColorFactor?(N.albedoColor=K.Ca.Ma(a.baseColorFactor),N.alpha=a.baseColorFactor[3]):N.albedoColor=K.Ca.White(),N.metallic=void 0==a.metallicFactor?1:a.metallicFactor,N.roughness=void 0==a.roughnessFactor?1:a.roughnessFactor,a.baseColorTexture&&U.push(this.loadTextureInfoAsync(`${l}/baseColorTexture`,a.baseColorTexture,(l=>{l.name=`${N.name} (Base Color)`,N.albedoTexture=l}))),a.metallicRoughnessTexture&&(a.metallicRoughnessTexture.nonColorData=!0,U.push(this.loadTextureInfoAsync(`${l}/metallicRoughnessTexture`,a.metallicRoughnessTexture,(l=>{l.name=`${N.name} (Metallic Roughness)`,N.metallicTexture=l}))),N.useMetallnessFromMetallicTextureBlue=!0,N.useRoughnessFromMetallicTextureGreen=!0,N.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(U).then((()=>{}))}_loadMaterialAsync(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const K=this._extensionsLoadMaterialAsync(l,a,N,U,c);if(K)return K;a._data=a._data||{};let Z=a._data[U];if(!Z){this.logOpen(`${l} ${a.name||""}`);const N=this.createMaterial(l,a,U);Z={babylonMaterial:N,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(l,a,N)},a._data[U]=Z,e.AddPointerMetadata(N,l),this._parent.onMaterialLoadedObservable.notifyObservers(N),this.logClose()}return N&&(Z.babylonMeshes.push(N),N.Tc.addOnce((()=>{const l=Z.babylonMeshes.indexOf(N);-1!==l&&Z.babylonMeshes.splice(l,1)}))),c(Z.babylonMaterial),Z.promise.then((()=>Z.babylonMaterial))}_createDefaultMaterial(l,a){this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new M.b(l,this._babylonScene);return N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.fillMode=a,N.enableSpecularAntiAliasing=!0,N.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,N.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,N.transparencyMode=M.b.PBRMATERIAL_OPAQUE,N.metallic=1,N.roughness=1,N}createMaterial(l,a,N){const U=this._extensionsCreateMaterial(l,a,N);if(U)return U;const c=a.name||`material${a.index}`;return this._createDefaultMaterial(c,N)}loadMaterialPropertiesAsync(l,a,N){const U=this._extensionsLoadMaterialPropertiesAsync(l,a,N);if(U)return U;const c=new Array;return c.push(this.loadMaterialBasePropertiesAsync(l,a,N)),a.pbrMetallicRoughness&&c.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${l}/pbrMetallicRoughness`,a.pbrMetallicRoughness,N)),this.loadMaterialAlphaProperties(l,a,N),Promise.all(c).then((()=>{}))}loadMaterialBasePropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;return N.emissiveColor=a.emissiveFactor?K.Ca.Ma(a.emissiveFactor):new K.Ca(0,0,0),a.doubleSided&&(N.Ic=!1,N.twoSidedLighting=!0),a.normalTexture&&(a.normalTexture.nonColorData=!0,U.push(this.loadTextureInfoAsync(`${l}/normalTexture`,a.normalTexture,(l=>{l.name=`${N.name} (Normal)`,N.bumpTexture=l}))),N.invertNormalMapX=!this._babylonScene.useRightHandedSystem,N.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=a.normalTexture.scale&&N.bumpTexture&&(N.bumpTexture.level=a.normalTexture.scale),N.forceIrradianceInFragment=!0),a.occlusionTexture&&(a.occlusionTexture.nonColorData=!0,U.push(this.loadTextureInfoAsync(`${l}/occlusionTexture`,a.occlusionTexture,(l=>{l.name=`${N.name} (Occlusion)`,N.ambientTexture=l}))),N.useAmbientInGrayScale=!0,void 0!=a.occlusionTexture.strength&&(N.ambientTextureStrength=a.occlusionTexture.strength)),a.emissiveTexture&&U.push(this.loadTextureInfoAsync(`${l}/emissiveTexture`,a.emissiveTexture,(l=>{l.name=`${N.name} (Emissive)`,N.emissiveTexture=l}))),Promise.all(U).then((()=>{}))}loadMaterialAlphaProperties(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);switch(a.alphaMode||"OPAQUE"){case"OPAQUE":N.transparencyMode=M.b.PBRMATERIAL_OPAQUE,N.alpha=1;break;case"MASK":N.transparencyMode=M.b.PBRMATERIAL_ALPHATEST,N.alphaCutOff=void 0==a.alphaCutoff?.5:a.alphaCutoff,N.albedoTexture&&(N.albedoTexture.Mc=!0);break;case"BLEND":N.transparencyMode=M.b.PBRMATERIAL_ALPHABLEND,N.albedoTexture&&(N.albedoTexture.Mc=!0,N.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${l}/alphaMode: Invalid value (${a.alphaMode})`)}}loadTextureInfoAsync(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const U=this._extensionsLoadTextureInfoAsync(l,a,N);if(U)return U;if(this.logOpen(`${l}`),a.texCoord>=6)throw new Error(`${l}/texCoord: Invalid value (${a.texCoord})`);const c=d.Get(`${l}/index`,this._gltf.textures,a.index);c._textureInfo=a;const K=this._loadTextureAsync(`/textures/${a.index}`,c,(U=>{U.coordinatesIndex=a.texCoord||0,e.AddPointerMetadata(U,l),this._parent.onTextureLoadedObservable.notifyObservers(U),N(U)}));return this.logClose(),K}_loadTextureAsync(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const U=this._extensionsLoadTextureAsync(l,a,N);if(U)return U;this.logOpen(`${l} ${a.name||""}`);const c=void 0==a.sampler?e.DefaultSampler:d.Get(`${l}/sampler`,this._gltf.samplers,a.sampler),K=d.Get(`${l}/source`,this._gltf.images,a.source),Z=this._createTextureAsync(l,c,K,N,void 0,!a._textureInfo.nonColorData);return this.logClose(),Z}_createTextureAsync(l,a,N){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},K=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;const w=this._loadSampler(`/samplers/${a.index}`,a),S=new Array,T=new U;this._babylonScene._blockEntityCollection=!!this._assetContainer;const J={noMipmap:w.noMipMaps,invertY:!1,samplingMode:w.samplingMode,V:()=>{this._disposed||T.resolve()},onError:(a,N)=>{this._disposed||T.reject(new Error(`${l}: ${N&&N.message?N.message:a||"Failed to load texture"}`))},mimeType:N.mimeType??(0,Q.i)(N.uri??""),loaderOptions:K,useSRGBBuffer:!!Z&&this._parent.useSRGBBuffers},n=new A.e(null,this._babylonScene,J);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.push(T.promise),S.push(this.loadImageAsync(`/images/${N.index}`,N).then((l=>{const a=N.uri||`${this._fileName}#image${N.index}`,U=`data:${this._uniqueRootUrl}${a}`;n.updateURL(U,l);const c=n.getInternalTexture();c&&(c.label=N.name)}))),n.wrapU=w.wrapU,n.wrapV=w.wrapV,c(n),this._parent.useGltfTextureNames&&(n.name=N.name||N.uri||`image${N.index}`),Promise.all(S).then((()=>n))}_loadSampler(l,a){return a._data||(a._data={noMipMaps:9728===a.minFilter||9729===a.minFilter,samplingMode:e._GetTextureSamplingMode(l,a),wrapU:e._GetTextureWrapMode(`${l}/wrapS`,a.wrapS),wrapV:e._GetTextureWrapMode(`${l}/wrapT`,a.wrapT)}),a._data}loadImageAsync(l,a){if(!a._data){if(this.logOpen(`${l} ${a.name||""}`),a.uri)a._data=this.loadUriAsync(`${l}/uri`,a,a.uri);else{const N=d.Get(`${l}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N)}this.logClose()}return a._data}loadUriAsync(l,a,N){const U=this._extensionsLoadUriAsync(l,a,N);if(U)return U;if(!e._ValidateUri(N))throw new Error(`${l}: '${N}' is invalid`);if((0,Q.m)(N)){const a=new Uint8Array((0,Q.e)(N));return this.log(`${l}: Decoded ${N.substring(0,64)}... (${a.length} bytes)`),Promise.resolve(a)}return this.log(`${l}: Loading ${N}`),this._parent.preprocessUrlAsync(this._rootUrl+N).then((a=>new Promise(((U,c)=>{this._parent._loadFile(this._babylonScene,a,(a=>{this._disposed||(this.log(`${l}: Loaded ${N} (${a.byteLength} bytes)`),U(new Uint8Array(a)))}),!0,(a=>{c(new Q.o(`${l}: Failed to load '${N}'${a?": "+a.status+" "+a.statusText:""}`,a))}))}))))}static AddPointerMetadata(l,a){l.metadata=l.metadata||{};const N=l._internalMetadata=l._internalMetadata||{},U=N.Hc=N.Hc||{};(U.pointers=U.pointers||[]).push(a)}static _GetTextureWrapMode(l,a){switch(a=void 0==a?10497:a){case 33071:return A.e.CLAMP_ADDRESSMODE;case 33648:return A.e.MIRROR_ADDRESSMODE;case 10497:return A.e.WRAP_ADDRESSMODE;default:return W.b.Warn(`${l}: Invalid value (${a})`),A.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(l,a){const N=void 0==a.magFilter?9729:a.magFilter,U=void 0==a.minFilter?9987:a.minFilter;if(9729===N)switch(U){case 9728:return A.e.LINEAR_NEAREST;case 9729:return A.e.LINEAR_LINEAR;case 9984:return A.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return A.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return A.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return A.e.LINEAR_LINEAR_MIPLINEAR;default:return W.b.Warn(`${l}/minFilter: Invalid value (${U})`),A.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==N&&W.b.Warn(`${l}/magFilter: Invalid value (${N})`),U){case 9728:return A.e.NEAREST_NEAREST;case 9729:return A.e.NEAREST_LINEAR;case 9984:return A.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return A.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return A.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return A.e.NEAREST_LINEAR_MIPLINEAR;default:return W.b.Warn(`${l}/minFilter: Invalid value (${U})`),A.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(l,a){try{return(0,P.r)(a)}catch(N){throw new Error(`${l}: ${N.message}`)}}static _GetTypedArray(l,a,N,U,c){const K=N.buffer;U=N.byteOffset+(U||0);const Z=e._GetTypedArrayConstructor(`${l}/componentType`,a),w=q.h.GetTypeByteLength(a);return U%w!==0?(W.b.Warn(`${l}: Copying buffer as byte offset (${U}) is not a multiple of component type byte length (${w})`),new Z(K.slice(U,U+c*w),0)):new Z(K,U,c)}static _GetNumComponents(l,a){switch(a){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${l}: Invalid type (${a})`)}static _ValidateUri(l){return Z.Tools.IsBase64(l)||-1===l.indexOf("..")}static _GetDrawMode(l,a){switch(void 0==a&&(a=4),a){case 0:return C.c.PointListDrawMode;case 1:return C.c.LineListDrawMode;case 2:return C.c.LineLoopDrawMode;case 3:return C.c.LineStripDrawMode;case 4:return C.c.TriangleFillMode;case 5:return C.c.TriangleStripDrawMode;case 6:return C.c.TriangleFanDrawMode}throw new Error(`${l}: Invalid mesh primitive mode (${a})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const l=new Array;if(this._gltf.materials)for(const a of this._gltf.materials)if(a._data)for(const N in a._data){const U=a._data[N];for(const a of U.babylonMeshes){a.qc(!0);const N=U.babylonMaterial;l.push(N.forceCompilationAsync(a)),l.push(N.forceCompilationAsync(a,{useInstances:!0})),this._parent.useClipPlane&&(l.push(N.forceCompilationAsync(a,{clipPlane:!0})),l.push(N.forceCompilationAsync(a,{clipPlane:!0,useInstances:!0})))}}return Promise.all(l).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const l=new Array,a=this._babylonScene.lights;for(const N of a){const a=N.getShadowGenerator();a&&l.push(a.forceCompilationAsync())}return Promise.all(l).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(l){for(const a of this._extensions)a.enabled&&l(a)}_applyExtensions(l,a,N){for(const U of this._extensions)if(U.enabled){const c=`${U.name}.${a}`,K=l;K._activeLoaderExtensionFunctions=K._activeLoaderExtensionFunctions||{};const Z=K._activeLoaderExtensionFunctions;if(!Z[c]){Z[c]=!0;try{const l=N(U);if(l)return l}finally{delete Z[c]}}}return null}_extensionsOnLoading(){this._forEachExtensions((l=>l.onLoading&&l.onLoading()))}_extensionsOnReady(){this._forEachExtensions((l=>l.onReady&&l.onReady()))}_extensionsLoadSceneAsync(l,a){return this._applyExtensions(a,"loadScene",(N=>N.loadSceneAsync&&N.loadSceneAsync(l,a)))}_extensionsLoadNodeAsync(l,a,N){return this._applyExtensions(a,"loadNode",(U=>U.loadNodeAsync&&U.loadNodeAsync(l,a,N)))}_extensionsLoadCameraAsync(l,a,N){return this._applyExtensions(a,"loadCamera",(U=>U.loadCameraAsync&&U.loadCameraAsync(l,a,N)))}_extensionsLoadVertexDataAsync(l,a,N){return this._applyExtensions(a,"loadVertexData",(U=>U._loadVertexDataAsync&&U._loadVertexDataAsync(l,a,N)))}_extensionsLoadMeshPrimitiveAsync(l,a,N,U,c,K){return this._applyExtensions(c,"loadMeshPrimitive",(Z=>Z._loadMeshPrimitiveAsync&&Z._loadMeshPrimitiveAsync(l,a,N,U,c,K)))}_extensionsLoadMaterialAsync(l,a,N,U,c){return this._applyExtensions(a,"loadMaterial",(K=>K._loadMaterialAsync&&K._loadMaterialAsync(l,a,N,U,c)))}_extensionsCreateMaterial(l,a,N){return this._applyExtensions(a,"createMaterial",(U=>U.createMaterial&&U.createMaterial(l,a,N)))}_extensionsLoadMaterialPropertiesAsync(l,a,N){return this._applyExtensions(a,"loadMaterialProperties",(U=>U.loadMaterialPropertiesAsync&&U.loadMaterialPropertiesAsync(l,a,N)))}_extensionsLoadTextureInfoAsync(l,a,N){return this._applyExtensions(a,"loadTextureInfo",(U=>U.loadTextureInfoAsync&&U.loadTextureInfoAsync(l,a,N)))}_extensionsLoadTextureAsync(l,a,N){return this._applyExtensions(a,"loadTexture",(U=>U._loadTextureAsync&&U._loadTextureAsync(l,a,N)))}_extensionsLoadAnimationAsync(l,a){return this._applyExtensions(a,"loadAnimation",(N=>N.loadAnimationAsync&&N.loadAnimationAsync(l,a)))}_extensionsLoadAnimationChannelAsync(l,a,N,U,c){return this._applyExtensions(N,"loadAnimationChannel",(K=>K._loadAnimationChannelAsync&&K._loadAnimationChannelAsync(l,a,N,U,c)))}_extensionsLoadSkinAsync(l,a,N){return this._applyExtensions(N,"loadSkin",(U=>U._loadSkinAsync&&U._loadSkinAsync(l,a,N)))}_extensionsLoadUriAsync(l,a,N){return this._applyExtensions(a,"loadUri",(U=>U._loadUriAsync&&U._loadUriAsync(l,a,N)))}_extensionsLoadBufferViewAsync(l,a){return this._applyExtensions(a,"loadBufferView",(N=>N.loadBufferViewAsync&&N.loadBufferViewAsync(l,a)))}_extensionsLoadBufferAsync(l,a,N,U){return this._applyExtensions(a,"loadBuffer",(c=>c.loadBufferAsync&&c.loadBufferAsync(l,a,N,U)))}static LoadExtensionAsync(l,a,N,U){if(!a.extensions)return null;const c=a.extensions[N];return c?U(`${l}/extensions/${N}`,c):null}static LoadExtraAsync(l,a,N,U){if(!a.extras)return null;const c=a.extras[N];return c?U(`${l}/extras/${N}`,c):null}isExtensionUsed(l){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(l)}logOpen(l){this._parent._logOpen(l)}logClose(){this._parent._logClose()}log(l){this._parent._log(l)}startPerformanceCounter(l){this._parent._startPerformanceCounter(l)}endPerformanceCounter(l){this._parent._endPerformanceCounter(l)}}e.DefaultSampler={index:-1},k.e._CreateGLTF2Loader=l=>new e(l);var s=N(14088),o=N(12623),G=N(12471),ml=N(14096),x=N(14102);class V extends x.c{constructor(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",l),this._texture=l.getEngine().createRawCubeTexture(a,N,U,c,K,Z,w,S)}update(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,l,a,N,U,c)}updateRGBDAsync(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,ml.m)(this._texture,l,a,N,U).then((()=>{}))}clone(){return G.c.Clone((()=>{const l=this.bl(),a=this._texture,N=new V(l,a._bufferViewArray,a.width,a.format,a.type,a.generateMipMaps,a.invertY,a.samplingMode,a._compression);return 13===a.source&&N.updateRGBDAsync(a._bufferViewArrayArray,a._sphericalPolynomial,a._lodGenerationScale,a._lodGenerationOffset),N}),this)}}const D="EXT_lights_image_based";class v{constructor(l){this.name=D,this._loader=l,this.enabled=this._loader.isExtensionUsed(D)}dispose(){this._loader=null,delete this._lights}onLoading(){const l=this._loader.Hc.extensions;if(l&&l[this.name]){const a=l[this.name];this._lights=a.lights}}loadSceneAsync(l,a){return e.LoadExtensionAsync(l,a,this.name,(async(N,U)=>{this._loader._allMaterialsDirtyRequired=!0;const c=new Array;c.push(this._loader.loadSceneAsync(l,a)),this._loader.logOpen(`${N}`);const K=d.Get(`${N}/light`,this._lights,U.cc);return c.push(this._loadLightAsync(`/extensions/${this.name}/lights/${U.cc}`,K).then((l=>{this._loader.babylonScene.environmentTexture=l}))),this._loader.logClose(),await Promise.all(c).then((()=>{}))}))}_loadLightAsync(l,a){if(!a._loaded){const N=new Array;this._loader.logOpen(`${l}`);const U=new Array(a.specularImages.length);for(let c=0;c<a.specularImages.length;c++){const K=a.specularImages[c];U[c]=new Array(K.length);for(let a=0;a<K.length;a++){const Z=`${l}/specularImages/${c}/${a}`;this._loader.logOpen(`${Z}`);const w=K[a],S=d.Get(Z,this._loader.Hc.images,w);N.push(this._loader.loadImageAsync(`/images/${w}`,S).then((l=>{U[c][a]=l}))),this._loader.logClose()}}this._loader.logClose(),a._loaded=Promise.all(N).then((async()=>{const N=new V(this._loader.babylonScene,null,a.specularImageSize);if(N.name=a.name||"environment",a._babylonTexture=N,void 0!=a.Rc&&(N.level=a.Rc),a.rotation){let l=c.Quaternion.Ma(a.rotation);this._loader.babylonScene.useRightHandedSystem||(l=c.Quaternion.Inverse(l)),c.Matrix.FromQuaternionToRef(l,N.getReflectionTextureMatrix())}if(!a.irradianceCoefficients)throw new Error(`${l}: Irradiance coefficients are missing`);const K=o.c.Ma(a.irradianceCoefficients);K.scaleInPlace(a.Rc),K.convertIrradianceToLambertianRadiance();const Z=o.g.FromHarmonics(K),w=(U.length-1)/Math.log2(a.specularImageSize);return await N.updateRGBDAsync(U,Z,w)}))}return a._loaded.then((()=>a._babylonTexture))}}L(D),R(D,!0,(l=>new v(l)));N(12983);const g="EXT_mesh_gpu_instancing";class ll{constructor(l){this.name=g,this._loader=l,this.enabled=this._loader.isExtensionUsed(g)}dispose(){this._loader=null}loadNodeAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(l,U)=>{this._loader._disableInstancedMesh++;const K=this._loader.loadNodeAsync(`/nodes/${a.index}`,a,N);if(this._loader._disableInstancedMesh--,!a._primitiveBabylonMeshes)return await K;const Z=new Array;let w=0;const S=a=>{if(void 0==U.attributes[a])return void Z.push(Promise.resolve(null));const N=d.Get(`${l}/attributes/${a}`,this._loader.Hc.accessors,U.attributes[a]);if(Z.push(this._loader._loadFloatAccessorAsync(`/accessors/${N.bufferView}`,N)),0===w)w=N.count;else if(w!==N.count)throw new Error(`${l}/attributes: Instance buffer accessors do not have the same count.`)};return S("TRANSLATION"),S("ROTATION"),S("SCALE"),await K.then((async l=>{const[N,U,K]=await Promise.all(Z),S=new Float32Array(16*w);c.TmpVectors.ua[0].tc(0,0,0),c.TmpVectors.Quaternion[0].tc(0,0,0,1),c.TmpVectors.ua[1].tc(1,1,1);for(let a=0;a<w;++a)N&&c.ua.FromArrayToRef(N,3*a,c.TmpVectors.ua[0]),U&&c.Quaternion.FromArrayToRef(U,4*a,c.TmpVectors.Quaternion[0]),K&&c.ua.FromArrayToRef(K,3*a,c.TmpVectors.ua[1]),c.Matrix.ComposeToRef(c.TmpVectors.ua[1],c.TmpVectors.Quaternion[0],c.TmpVectors.ua[0],c.TmpVectors.Matrix[0]),c.TmpVectors.Matrix[0].copyToArray(S,16*a);for(const c of a._primitiveBabylonMeshes)c.bn("matrix",S,16,!0);return l}))}))}}L(g),R(g,!0,(l=>new ll(l)));let al=0,Nl=null;class Ul{static get Default(){return Ul._Default||(Ul._Default=new Ul),Ul._Default}constructor(){const l=Ul.Configuration.decoder;this._decoderModulePromise=Z.Tools.LoadBabylonScriptAsync(l.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(l,a,N,U,c){await this._decoderModulePromise,0===al&&(MeshoptDecoder.useWorkers(1),al=1);const K=await MeshoptDecoder.decodeGltfBufferAsync(a,N,l,U,c);return null!==Nl&&clearTimeout(Nl),Nl=setTimeout((()=>{MeshoptDecoder.useWorkers(0),al=0,Nl=null}),1e3),K}}Ul.Configuration={decoder:{url:`${Z.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Ul._Default=null;const cl="EXT_meshopt_compression";class Kl{constructor(l){this.name=cl,this.enabled=l.isExtensionUsed(cl),this._loader=l}dispose(){this._loader=null}loadBufferViewAsync(l,a){return e.LoadExtensionAsync(l,a,this.name,(async(N,U)=>{const c=a;if(c._meshOptData)return await c._meshOptData;const K=d.Get(`${l}/buffer`,this._loader.Hc.buffers,U.buffer);return c._meshOptData=this._loader.loadBufferAsync(`/buffers/${K.index}`,K,U.byteOffset||0,U.byteLength).then((async l=>await Ul.Default.decodeGltfBufferAsync(l,U.count,U.byteStride,U.mode,U.filter))),await c._meshOptData}))}}L(cl),R(cl,!0,(l=>new Kl(l)));const Zl="EXT_texture_webp";class wl{constructor(l){this.name=Zl,this._loader=l,this.enabled=l.isExtensionUsed(Zl)}dispose(){this._loader=null}_loadTextureAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=void 0==a.sampler?e.DefaultSampler:d.Get(`${l}/sampler`,this._loader.Hc.samplers,a.sampler),Z=d.Get(`${U}/source`,this._loader.Hc.images,c.source);return await this._loader._createTextureAsync(l,K,Z,(l=>{N(l)}),void 0,!a._textureInfo.nonColorData)}))}}L(Zl),R(Zl,!0,(l=>new wl(l)));const Sl="EXT_texture_avif";class Tl{constructor(l){this.name=Sl,this._loader=l,this.enabled=l.isExtensionUsed(Sl)}dispose(){this._loader=null}_loadTextureAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=void 0==a.sampler?e.DefaultSampler:d.Get(`${l}/sampler`,this._loader.Hc.samplers,a.sampler),Z=d.Get(`${U}/source`,this._loader.Hc.images,c.source);return await this._loader._createTextureAsync(l,K,Z,(l=>{N(l)}),void 0,!a._textureInfo.nonColorData)}))}}L(Sl),R(Sl,!0,(l=>new Tl(l)));var Jl=N(14086),nl=N(12966);const yl="EXT_lights_ies";class Hl{constructor(l){this.name=yl,this._loader=l,this.enabled=this._loader.isExtensionUsed(yl)}dispose(){this._loader=null,delete this._lights}onLoading(){const l=this._loader.Hc.extensions;if(l&&l[this.name]){const a=l[this.name];this._lights=a.lights,d.Assign(this._lights)}}loadNodeAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,Z)=>{let w,S;this._loader._allMaterialsDirtyRequired=!0;const T=await this._loader.loadNodeAsync(l,a,(l=>{S=d.Get(U,this._lights,Z.cc);const a=S.name||l.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w=new Jl.e(a,c.ua.Zero(),c.ua.Backward(),0,1,this._loader.babylonScene),w.angle=Math.PI/2,w.innerAngle=0,w._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,S._babylonLight=w,w.falloffType=nl.c.FALLOFF_GLTF,w.Lc=Z.color?K.Ca.Ma(Z.color):K.Ca.White(),w.Rc=Z.multiplier||1,w.range=Number.MAX_VALUE,w.parent=l,this._loader._babylonLights.push(w),e.AddPointerMetadata(w,U),N(l)}));let J;if(S.uri)J=await this._loader.loadUriAsync(l,S,S.uri);else{const a=d.Get(`${l}/bufferView`,this._loader.Hc.bufferViews,S.bufferView);J=await this._loader.loadBufferViewAsync(`/bufferViews/${a.index}`,a)}return w.iesProfileTexture=new A.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,J,!0,void 0,void 0,void 0,void 0,".ies"),T}))}}L(yl),R(yl,!0,(l=>new Hl(l)));var ul=N(14112);const Wl="KHR_draco_mesh_compression";class Bl{constructor(l){this.name=Wl,this.useNormalizedFlagFromAccessor=!0,this._loader=l,this.enabled=ul.e.DefaultAvailable&&this._loader.isExtensionUsed(Wl)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{if(void 0!=a.mode&&4!==a.mode&&5!==a.mode)throw new Error(`${l}: Unsupported mode ${a.mode}`);const K={},Z={},w=(l,U)=>{const w=c.attributes[l];if(void 0!=w&&(N._delayInfo=N._delayInfo||[],-1===N._delayInfo.indexOf(U)&&N._delayInfo.push(U),K[U]=w,this.useNormalizedFlagFromAccessor)){const N=d.TryGet(this._loader.Hc.accessors,a.attributes[l]);N&&(Z[U]=N.normalized||!1)}};w("POSITION",q.h.PositionKind),w("NORMAL",q.h.NormalKind),w("TANGENT",q.h.TangentKind),w("TEXCOORD_0",q.h.UVKind),w("TEXCOORD_1",q.h.UV2Kind),w("TEXCOORD_2",q.h.UV3Kind),w("TEXCOORD_3",q.h.UV4Kind),w("TEXCOORD_4",q.h.UV5Kind),w("TEXCOORD_5",q.h.UV6Kind),w("JOINTS_0",q.h.MatricesIndicesKind),w("WEIGHTS_0",q.h.MatricesWeightsKind),w("COLOR_0",q.h.ColorKind);const S=d.Get(U,this._loader.Hc.bufferViews,c.bufferView);return S._dracoBabylonGeometry||(S._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S).then((async U=>{const c=this.dracoDecoder||ul.e.Default,w=d.TryGet(this._loader.Hc.accessors,a.attributes.POSITION),S=this._loader.parent.alwaysComputeBoundingBox||N.skeleton||!w?null:F(w);return await c._decodeMeshToGeometryForGltfAsync(N.name,this._loader.babylonScene,U,K,Z,S).catch((a=>{throw new Error(`${l}: ${a.message}`)}))}))),await S._dracoBabylonGeometry}))}}L(Wl),R(Wl,!0,(l=>new Bl(l)));var Yl=N(14120),Cl=N(12429),Ml=N(12432),Al=N(12861),El=N(13016),ql=N(12394);Al.c.AddNodeConstructor("Light_Type_0",((l,a)=>()=>new bl(l,c.ua.Zero(),a)));class bl extends El.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(l){this._shadowAngle=l,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(l){const a=this.needCube();if(this._direction=l,this.needCube()!==a&&this._shadowGenerators){const l=this._shadowGenerators.values();for(let a=l.next();!0!==a.done;a=l.next()){a.value.recreateShadowMap()}}}constructor(l,a,N){super(l,N),this._shadowAngle=Math.PI/2,this.position=a}getClassName(){return"PointLight"}getTypeID(){return nl.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(l){if(this.direction)return super.getShadowDirection(l);switch(l){case 0:return new c.ua(1,0,0);case 1:return new c.ua(-1,0,0);case 2:return new c.ua(0,-1,0);case 3:return new c.ua(0,1,0);case 4:return new c.ua(0,0,1);case 5:return new c.ua(0,0,-1)}return c.ua.Zero()}_setDefaultShadowProjectionMatrix(l,a,N){const U=this.bl().activeCamera;if(!U)return;const K=void 0!==this.shadowMinZ?this.shadowMinZ:U.Ac,Z=void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,w=this.bl().getEngine().Zc;c.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,w?Z:K,w?K:Z,l,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(l,a){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,a):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,a),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,a),this}transferToNodeMaterialEffect(l,a){return this.computeTransformedInformation()?l.setFloat3(a,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):l.setFloat3(a,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(l,a){l["POINTLIGHT"+a]=!0}}(0,Cl.d)([(0,Ml.K)()],bl.prototype,"shadowAngle",null),(0,ql.g)("BABYLON.PointLight",bl);const zl="KHR_lights_punctual";class Il{constructor(l){this.name=zl,this._loader=l,this.enabled=this._loader.isExtensionUsed(zl)}dispose(){this._loader=null,delete this._lights}onLoading(){const l=this._loader.Hc.extensions;if(l&&l[this.name]){const a=l[this.name];this._lights=a.lights,d.Assign(this._lights)}}loadNodeAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,Z)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(l,a,(l=>{let a;const w=d.Get(U,this._lights,Z.cc),S=w.name||l.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w.type){case"directional":{const l=new Yl.d(S,c.ua.Backward(),this._loader.babylonScene);l.position.hc(0),a=l;break}case"point":a=new bl(S,c.ua.Zero(),this._loader.babylonScene);break;case"spot":{const l=new Jl.e(S,c.ua.Zero(),c.ua.Backward(),0,1,this._loader.babylonScene);l.angle=2*(w.spot&&w.spot.outerConeAngle||Math.PI/4),l.innerAngle=2*(w.spot&&w.spot.innerConeAngle||0),a=l;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${U}: Invalid light type (${w.type})`)}a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=a,a.falloffType=nl.c.FALLOFF_GLTF,a.Lc=w.color?K.Ca.Ma(w.color):K.Ca.White(),a.Rc=void 0==w.Rc?1:w.Rc,a.range=void 0==w.range?Number.MAX_VALUE:w.range,a.parent=l,this._loader._babylonLights.push(a),e.AddPointerMetadata(a,U),N(l)})))))}}L(zl),R(zl,!0,(l=>new Il(l)));const tl="KHR_materials_pbrSpecularGlossiness";class Ol{constructor(l){this.name=tl,this.order=200,this._loader=l,this.enabled=this._loader.isExtensionUsed(tl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialBasePropertiesAsync(l,a,N)),K.push(this._loadSpecularGlossinessPropertiesAsync(U,c,N)),this._loader.loadMaterialAlphaProperties(l,a,N),await Promise.all(K).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;return N.metallic=null,N.roughness=null,a.diffuseFactor?(N.albedoColor=K.Ca.Ma(a.diffuseFactor),N.alpha=a.diffuseFactor[3]):N.albedoColor=K.Ca.White(),N.reflectivityColor=a.specularFactor?K.Ca.Ma(a.specularFactor):K.Ca.White(),N.microSurface=void 0==a.glossinessFactor?1:a.glossinessFactor,a.diffuseTexture&&U.push(this._loader.loadTextureInfoAsync(`${l}/diffuseTexture`,a.diffuseTexture,(l=>{l.name=`${N.name} (Diffuse)`,N.albedoTexture=l}))),a.specularGlossinessTexture&&(U.push(this._loader.loadTextureInfoAsync(`${l}/specularGlossinessTexture`,a.specularGlossinessTexture,(l=>{l.name=`${N.name} (Specular Glossiness)`,N.reflectivityTexture=l,N.reflectivityTexture.Mc=!0}))),N.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(U).then((()=>{}))}}L(tl),R(tl,!0,(l=>new Ol(l)));const hl="KHR_materials_unlit";class il{constructor(l){this.name=hl,this.order=210,this._loader=l,this.enabled=this._loader.isExtensionUsed(hl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async()=>await this._loadUnlitPropertiesAsync(l,a,N)))}_loadUnlitPropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;N.unlit=!0;const c=a.pbrMetallicRoughness;return c&&(c.baseColorFactor?(N.albedoColor=K.Ca.Ma(c.baseColorFactor),N.alpha=c.baseColorFactor[3]):N.albedoColor=K.Ca.White(),c.baseColorTexture&&U.push(this._loader.loadTextureInfoAsync(`${l}/baseColorTexture`,c.baseColorTexture,(l=>{l.name=`${N.name} (Base Color)`,N.albedoTexture=l})))),a.doubleSided&&(N.Ic=!1,N.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(l,a,N),Promise.all(U).then((()=>{}))}}L(hl),R(hl,!0,(l=>new il(l)));const kl="KHR_materials_clearcoat";class Ql{constructor(l){this.name=kl,this.order=190,this._loader=l,this.enabled=this._loader.isExtensionUsed(kl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadClearCoatPropertiesAsync(U,c,N)),await Promise.all(K)}))}_loadClearCoatPropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;return N.clearCoat.isEnabled=!0,N.clearCoat.useRoughnessFromMainTexture=!1,N.clearCoat.remapF0OnInterfaceChange=!1,void 0!=a.clearcoatFactor?N.clearCoat.Rc=a.clearcoatFactor:N.clearCoat.Rc=0,a.clearcoatTexture&&U.push(this._loader.loadTextureInfoAsync(`${l}/clearcoatTexture`,a.clearcoatTexture,(l=>{l.name=`${N.name} (ClearCoat)`,N.clearCoat.texture=l}))),void 0!=a.clearcoatRoughnessFactor?N.clearCoat.roughness=a.clearcoatRoughnessFactor:N.clearCoat.roughness=0,a.clearcoatRoughnessTexture&&(a.clearcoatRoughnessTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${l}/clearcoatRoughnessTexture`,a.clearcoatRoughnessTexture,(l=>{l.name=`${N.name} (ClearCoat Roughness)`,N.clearCoat.textureRoughness=l})))),a.clearcoatNormalTexture&&(a.clearcoatNormalTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${l}/clearcoatNormalTexture`,a.clearcoatNormalTexture,(l=>{l.name=`${N.name} (ClearCoat Normal)`,N.clearCoat.bumpTexture=l}))),N.invertNormalMapX=!N.bl().useRightHandedSystem,N.invertNormalMapY=N.bl().useRightHandedSystem,void 0!=a.clearcoatNormalTexture.scale&&(N.clearCoat.bumpTexture.level=a.clearcoatNormalTexture.scale)),Promise.all(U).then((()=>{}))}}L(kl),R(kl,!0,(l=>new Ql(l)));const jl="KHR_materials_iridescence";class fl{constructor(l){this.name=jl,this.order=195,this._loader=l,this.enabled=this._loader.isExtensionUsed(jl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadIridescencePropertiesAsync(U,c,N)),await Promise.all(K).then((()=>{}))}))}_loadIridescencePropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;return N.iridescence.isEnabled=!0,N.iridescence.Rc=a.iridescenceFactor??0,N.iridescence.indexOfRefraction=a.iridescenceIor??a.iridescenceIOR??1.3,N.iridescence.minimumThickness=a.iridescenceThicknessMinimum??100,N.iridescence.maximumThickness=a.iridescenceThicknessMaximum??400,a.iridescenceTexture&&U.push(this._loader.loadTextureInfoAsync(`${l}/iridescenceTexture`,a.iridescenceTexture,(l=>{l.name=`${N.name} (Iridescence)`,N.iridescence.texture=l}))),a.iridescenceThicknessTexture&&U.push(this._loader.loadTextureInfoAsync(`${l}/iridescenceThicknessTexture`,a.iridescenceThicknessTexture,(l=>{l.name=`${N.name} (Iridescence Thickness)`,N.iridescence.thicknessTexture=l}))),Promise.all(U).then((()=>{}))}}L(jl),R(jl,!0,(l=>new fl(l)));const pl="KHR_materials_anisotropy";class Rl{constructor(l){this.name=pl,this.order=195,this._loader=l,this.enabled=this._loader.isExtensionUsed(pl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadIridescencePropertiesAsync(U,c,N)),await Promise.all(K)}))}async _loadIridescencePropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;N.anisotropy.isEnabled=!0,N.anisotropy.Rc=a.anisotropyStrength??0,N.anisotropy.angle=a.anisotropyRotation??0,a.anisotropyTexture&&(a.anisotropyTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${l}/anisotropyTexture`,a.anisotropyTexture,(l=>{l.name=`${N.name} (Anisotropy Intensity)`,N.anisotropy.texture=l})))),await Promise.all(U)}}L(pl),R(pl,!0,(l=>new Rl(l)));const Ll="KHR_materials_emissive_strength";class rl{constructor(l){this.name=Ll,this.order=170,this._loader=l,this.enabled=this._loader.isExtensionUsed(Ll)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>await this._loader.loadMaterialPropertiesAsync(l,a,N).then((()=>{this._loadEmissiveProperties(U,c,N)}))))}_loadEmissiveProperties(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);void 0!==a.emissiveStrength&&(N.emissiveIntensity=a.emissiveStrength)}}L(Ll),R(Ll,!0,(l=>new rl(l)));const Xl="KHR_materials_sheen";class Pl{constructor(l){this.name=Xl,this.order=190,this._loader=l,this.enabled=this._loader.isExtensionUsed(Xl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadSheenPropertiesAsync(U,c,N)),await Promise.all(K).then((()=>{}))}))}_loadSheenPropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;return N.sheen.isEnabled=!0,N.sheen.Rc=1,void 0!=a.sheenColorFactor?N.sheen.color=K.Ca.Ma(a.sheenColorFactor):N.sheen.color=K.Ca.Black(),a.sheenColorTexture&&U.push(this._loader.loadTextureInfoAsync(`${l}/sheenColorTexture`,a.sheenColorTexture,(l=>{l.name=`${N.name} (Sheen Color)`,N.sheen.texture=l}))),void 0!==a.sheenRoughnessFactor?N.sheen.roughness=a.sheenRoughnessFactor:N.sheen.roughness=0,a.sheenRoughnessTexture&&(a.sheenRoughnessTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${l}/sheenRoughnessTexture`,a.sheenRoughnessTexture,(l=>{l.name=`${N.name} (Sheen Roughness)`,N.sheen.textureRoughness=l})))),N.sheen.albedoScaling=!0,N.sheen.useRoughnessFromMainTexture=!1,Promise.all(U).then((()=>{}))}}L(Xl),R(Xl,!0,(l=>new Pl(l)));var dl=N(12909);const Fl="KHR_materials_specular";class el{constructor(l){this.name=Fl,this.order=190,this._loader=l,this.enabled=this._loader.isExtensionUsed(Fl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;if(K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadSpecularPropertiesAsync(U,c,N)),c.extensions&&c.extensions.EXT_materials_specular_edge_color&&N instanceof M.b){c.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(N.brdf.dielectricSpecularModel=dl.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,N.brdf.conductorSpecularModel=dl.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(K).then((()=>{}))}))}_loadSpecularPropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;return void 0!==a.specularFactor&&(N.metallicF0Factor=a.specularFactor),void 0!==a.specularColorFactor&&(N.metallicReflectanceColor=K.Ca.Ma(a.specularColorFactor)),a.specularTexture&&(a.specularTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${l}/specularTexture`,a.specularTexture,(l=>{l.name=`${N.name} (Specular)`,N.metallicReflectanceTexture=l,N.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),a.specularColorTexture&&U.push(this._loader.loadTextureInfoAsync(`${l}/specularColorTexture`,a.specularColorTexture,(l=>{l.name=`${N.name} (Specular Color)`,N.reflectanceTexture=l}))),Promise.all(U).then((()=>{}))}}L(Fl),R(Fl,!0,(l=>new el(l)));const sl="KHR_materials_ior";class ol{constructor(l){this.name=sl,this.order=180,this._loader=l,this.enabled=this._loader.isExtensionUsed(sl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadIorPropertiesAsync(U,c,N)),await Promise.all(K).then((()=>{}))}))}_loadIorPropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);return void 0!==a.ior?N.indexOfRefraction=a.ior:N.indexOfRefraction=ol._DEFAULT_IOR,Promise.resolve()}}ol._DEFAULT_IOR=1.5,L(sl),R(sl,!0,(l=>new ol(l)));const Gl="KHR_materials_variants";class ma{constructor(l){this.name=Gl,this._loader=l,this.enabled=this._loader.isExtensionUsed(Gl)}dispose(){this._loader=null}static GetAvailableVariants(l){const a=this._GetExtensionMetadata(l);return a?Object.keys(a.variants):[]}getAvailableVariants(l){return ma.GetAvailableVariants(l)}static SelectVariant(l,a){const N=this._GetExtensionMetadata(l);if(!N)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Gl} extension`);const U=l=>{const a=N.variants[l];if(a)for(const N of a)N.mesh.material=N.material};if(a instanceof Array)for(const c of a)U(c);else U(a);N.lastSelected=a}selectVariant(l,a){ma.SelectVariant(l,a)}static Reset(l){const a=this._GetExtensionMetadata(l);if(!a)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Gl} extension`);for(const N of a.original)N.mesh.material=N.material;a.lastSelected=null}reset(l){ma.Reset(l)}static GetLastSelectedVariant(l){const a=this._GetExtensionMetadata(l);if(!a)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Gl} extension`);return a.lastSelected}getLastSelectedVariant(l){return ma.GetLastSelectedVariant(l)}static _GetExtensionMetadata(l){var a,N;return(null===l||void 0===l||null===(a=l._internalMetadata)||void 0===a||null===(N=a.Hc)||void 0===N?void 0:N[Gl])||null}onLoading(){const l=this._loader.Hc.extensions;if(l&&l[this.name]){const a=l[this.name];this._variants=a.variants}}onReady(){const l=this._loader.rootBabylonMesh;if(l){var a;const N=this._loader.parent.extensionOptions[Gl];null!==N&&void 0!==N&&N.defaultVariant&&ma.SelectVariant(l,N.defaultVariant),null===N||void 0===N||null===(a=N.onLoaded)||void 0===a||a.call(N,{get variants(){return ma.GetAvailableVariants(l)},get selectedVariant(){const a=ma.GetLastSelectedVariant(l);return a?Array.isArray(a)?a[0]:a:ma.GetAvailableVariants(l)[0]},set selectedVariant(a){ma.SelectVariant(l,a)}})}}_loadMeshPrimitiveAsync(l,a,N,U,c,K){return e.LoadExtensionAsync(l,c,this.name,(async(Z,w)=>{const S=new Array;return S.push(this._loader._loadMeshPrimitiveAsync(l,a,N,U,c,(a=>{if(K(a),a instanceof I.d){const N=e._GetDrawMode(l,c.mode),U=this._loader.rootBabylonMesh,K=U?U._internalMetadata=U._internalMetadata||{}:{},T=K.Hc=K.Hc||{},J=T[Gl]=T[Gl]||{lastSelected:null,original:[],variants:{}};J.original.push({mesh:a,material:a.material});for(let l=0;l<w.mappings.length;++l){const c=w.mappings[l],K=d.Get(`${Z}/mappings/${l}/material`,this._loader.Hc.materials,c.material);S.push(this._loader._loadMaterialAsync(`#/materials/${c.material}`,K,a,N,(l=>{for(let N=0;N<c.variants.length;++N){const K=c.variants[N],Z=d.Get(`/extensions/${Gl}/variants/${K}`,this._variants,K);J.variants[Z.name]=J.variants[Z.name]||[],J.variants[Z.name].push({mesh:a,material:l}),a.onClonedObservable.add((l=>{const N=l;let c=null,K=N;do{if(K=K.parent,!K)return;c=ma._GetExtensionMetadata(K)}while(null===c);if(U&&c===ma._GetExtensionMetadata(U)){K._internalMetadata={};for(const l in U._internalMetadata)K._internalMetadata[l]=U._internalMetadata[l];K._internalMetadata.Hc=[];for(const l in U._internalMetadata.Hc)K._internalMetadata.Hc[l]=U._internalMetadata.Hc[l];K._internalMetadata.Hc[Gl]={lastSelected:null,original:[],variants:{}};for(const l of c.original)K._internalMetadata.Hc[Gl].original.push({mesh:l.mesh,material:l.material});for(const l in c.variants)if(Object.prototype.hasOwnProperty.call(c.variants,l)){K._internalMetadata.Hc[Gl].variants[l]=[];for(const a of c.variants[l])K._internalMetadata.Hc[Gl].variants[l].push({mesh:a.mesh,material:a.material})}c=K._internalMetadata.Hc[Gl]}for(const U of c.original)U.mesh===a&&(U.mesh=N);for(const U of c.variants[Z.name])U.mesh===a&&(U.mesh=N)}))}})))}}}))),await Promise.all(S).then((l=>{let[a]=l;return a}))}))}}L(Gl),R(Gl,!0,(l=>new ma(l)));var xl=N(12495);class Vl{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:dl.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(l,a){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Vl._GetDefaultOptions(),...l},this._scene=a,this._scene._transmissionHelper=this,this.onErrorObservable=new J.e,this._scene.Tc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(l){if(!Object.keys(l).filter((a=>this._options[a]!==l[a])).length)return;const a={...this._options,...l},N=this._options;this._options=a,a.renderSize===N.renderSize&&a.renderTargetTextureType===N.renderTargetTextureType&&a.generateMipmaps===N.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=a.samples,this._opaqueRenderTarget.lodGenerationScale=a.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=a.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(l){return!!l&&!!(l instanceof M.b&&l.subSurface.isRefractionEnabled)}_addMesh(l){this._materialObservers[l.uniqueId]=l.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Z.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(l.material)?(l.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(l)&&this._transparentMeshesCache.push(l)):-1===this._opaqueMeshesCache.indexOf(l)&&this._opaqueMeshesCache.push(l)}))}_removeMesh(l){l.onMaterialChangedObservable.remove(this._materialObservers[l.uniqueId]),delete this._materialObservers[l.uniqueId];let a=this._transparentMeshesCache.indexOf(l);-1!==a&&this._transparentMeshesCache.splice(a,1),a=this._opaqueMeshesCache.indexOf(l),-1!==a&&this._opaqueMeshesCache.splice(a,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(l){const a=this._transparentMeshesCache.indexOf(l),N=this._opaqueMeshesCache.indexOf(l);this._shouldRenderAsTransmission(l.material)?(l.material instanceof M.b&&(l.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==N?(this._opaqueMeshesCache.splice(N,1),this._transparentMeshesCache.push(l)):-1===a&&this._transparentMeshesCache.push(l)):-1!==a?(this._transparentMeshesCache.splice(a,1),this._opaqueMeshesCache.push(l)):-1===N&&this._opaqueMeshesCache.push(l)}_isRenderTargetValid(){var l;return null!==(null===(l=this._opaqueRenderTarget)||void 0===l?void 0:l.getInternalTexture())}_setupRenderTargets(){var l;let a;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new xl.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(l=this._options.clearColor)||void 0===l?void 0:l.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((l=>{a=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?l.clearColor.K(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(l.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=a}));for(const N of this._transparentMeshesCache)this._shouldRenderAsTransmission(N.material)&&(N.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Dl="KHR_materials_transmission";class vl{constructor(l){this.name=Dl,this.order=175,this._loader=l,this.enabled=this._loader.isExtensionUsed(Dl),this.enabled&&(l.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadTransparentPropertiesAsync(U,a,N,c)),await Promise.all(K).then((()=>{}))}))}_loadTransparentPropertiesAsync(l,a,N,U){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const c=N;if(c.subSurface.isRefractionEnabled=!0,c.subSurface.volumeIndexOfRefraction=1,c.subSurface.useAlbedoToTintRefraction=!0,void 0===U.transmissionFactor)return c.subSurface.refractionIntensity=0,c.subSurface.isRefractionEnabled=!1,Promise.resolve();{var K;c.subSurface.refractionIntensity=U.transmissionFactor;const l=c.bl();if(c.subSurface.refractionIntensity&&!l._transmissionHelper)new Vl({},c.bl());else if(c.subSurface.refractionIntensity&&(null===(K=l._transmissionHelper)||void 0===K||!K._isRenderTargetValid())){var Z;null===(Z=l._transmissionHelper)||void 0===Z||Z._setupRenderTargets()}}return c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=0,U.transmissionTexture?(U.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${l}/transmissionTexture`,U.transmissionTexture,void 0).then((l=>{l.name=`${N.name} (Transmission)`,c.subSurface.refractionIntensityTexture=l,c.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}L(Dl),R(Dl,!0,(l=>new vl(l)));const gl="KHR_materials_diffuse_transmission";class la{constructor(l){this.name=gl,this.order=174,this._loader=l,this.enabled=this._loader.isExtensionUsed(gl),this.enabled&&(l.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadTranslucentPropertiesAsync(U,a,N,c)),await Promise.all(K).then((()=>{}))}))}_loadTranslucentPropertiesAsync(l,a,N,U){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const c=N;if(c.subSurface.isTranslucencyEnabled=!0,c.subSurface.volumeIndexOfRefraction=1,c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=0,c.subSurface.useAlbedoToTintTranslucency=!1,void 0===U.diffuseTransmissionFactor)return c.subSurface.translucencyIntensity=0,c.subSurface.isTranslucencyEnabled=!1,Promise.resolve();c.subSurface.translucencyIntensity=U.diffuseTransmissionFactor;const Z=new Array;return c.subSurface.useGltfStyleTextures=!0,U.diffuseTransmissionTexture&&(U.diffuseTransmissionTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${l}/diffuseTransmissionTexture`,U.diffuseTransmissionTexture).then((l=>{l.name=`${N.name} (Diffuse Transmission)`,c.subSurface.translucencyIntensityTexture=l})))),void 0!==U.diffuseTransmissionColorFactor?c.subSurface.translucencyColor=K.Ca.Ma(U.diffuseTransmissionColorFactor):c.subSurface.translucencyColor=K.Ca.White(),U.diffuseTransmissionColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${l}/diffuseTransmissionColorTexture`,U.diffuseTransmissionColorTexture).then((l=>{l.name=`${N.name} (Diffuse Transmission Color)`,c.subSurface.translucencyColorTexture=l}))),Promise.all(Z).then((()=>{}))}}L(gl),R(gl,!0,(l=>new la(l)));const aa="KHR_materials_volume";class Na{constructor(l){this.name=aa,this.order=173,this._loader=l,this.enabled=this._loader.isExtensionUsed(aa),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadVolumePropertiesAsync(U,a,N,c)),await Promise.all(K).then((()=>{}))}))}_loadVolumePropertiesAsync(l,a,N,U){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);if(!N.subSurface.isRefractionEnabled&&!N.subSurface.isTranslucencyEnabled||!U.thicknessFactor)return Promise.resolve();N.subSurface.volumeIndexOfRefraction=N.indexOfRefraction;const c=void 0!==U.attenuationDistance?U.attenuationDistance:Number.MAX_VALUE;return N.subSurface.tintColorAtDistance=c,void 0!==U.attenuationColor&&3==U.attenuationColor.length&&N.subSurface.tintColor.tc(U.attenuationColor[0],U.attenuationColor[1],U.attenuationColor[2]),N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=U.thicknessFactor,N.subSurface.useThicknessAsDepth=!0,U.thicknessTexture?(U.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${l}/thicknessTexture`,U.thicknessTexture).then((l=>{l.name=`${N.name} (Thickness)`,N.subSurface.thicknessTexture=l,N.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}L(aa),R(aa,!0,(l=>new Na(l)));const Ua="KHR_materials_dispersion";class ca{constructor(l){this.name=Ua,this.order=174,this._loader=l,this.enabled=this._loader.isExtensionUsed(Ua)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadDispersionPropertiesAsync(U,a,N,c)),await Promise.all(K).then((()=>{}))}))}_loadDispersionPropertiesAsync(l,a,N,U){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);return N.subSurface.isRefractionEnabled&&U.dispersion?(N.subSurface.isDispersionEnabled=!0,N.subSurface.dispersion=U.dispersion,Promise.resolve()):Promise.resolve()}}L(Ua),R(Ua,!0,(l=>new ca(l)));const Ka="EXT_materials_diffuse_roughness";class Za{constructor(l){this.name=Ka,this.order=190,this._loader=l,this.enabled=this._loader.isExtensionUsed(Ka)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=new Array;return K.push(this._loader.loadMaterialPropertiesAsync(l,a,N)),K.push(this._loadDiffuseRoughnessPropertiesAsync(U,c,N)),await Promise.all(K).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(l,a,N){if(!(N instanceof M.b))throw new Error(`${l}: Material type not supported`);const U=new Array;return N.brdf.baseDiffuseModel=dl.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=a.diffuseRoughnessFactor?N.baseDiffuseRoughness=a.diffuseRoughnessFactor:N.baseDiffuseRoughness=0,a.diffuseRoughnessTexture&&U.push(this._loader.loadTextureInfoAsync(`${l}/diffuseRoughnessTexture`,a.diffuseRoughnessTexture,(l=>{l.name=`${N.name} (Diffuse Roughness)`,N.baseDiffuseRoughnessTexture=l}))),Promise.all(U).then((()=>{}))}}L(Ka),R(Ka,!0,(l=>new Za(l)));const wa="KHR_mesh_quantization";class Sa{constructor(l){this.name=wa,this.enabled=l.isExtensionUsed(wa)}dispose(){}}L(wa),R(wa,!0,(l=>new Sa(l)));const Ta="KHR_texture_basisu";class Ja{constructor(l){this.name=Ta,this._loader=l,this.enabled=l.isExtensionUsed(Ta)}dispose(){this._loader=null}_loadTextureAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>{const K=void 0==a.sampler?e.DefaultSampler:d.Get(`${l}/sampler`,this._loader.Hc.samplers,a.sampler),Z=d.Get(`${U}/source`,this._loader.Hc.images,c.source);return await this._loader._createTextureAsync(l,K,Z,(l=>{N(l)}),a._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!a._textureInfo.nonColorData)}))}}L(Ta),R(Ta,!0,(l=>new Ja(l)));const na="KHR_texture_transform";class ya{constructor(l){this.name=na,this._loader=l,this.enabled=this._loader.isExtensionUsed(na)}dispose(){this._loader=null}loadTextureInfoAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(U,c)=>await this._loader.loadTextureInfoAsync(l,a,(l=>{if(!(l instanceof A.e))throw new Error(`${U}: Texture type not supported`);c.offset&&(l.uOffset=c.offset[0],l.vOffset=c.offset[1]),l.uRotationCenter=0,l.vRotationCenter=0,c.rotation&&(l.wAng=-c.rotation),c.scale&&(l.uScale=c.scale[0],l.vScale=c.scale[1]),void 0!=c.texCoord&&(l.coordinatesIndex=c.texCoord),N(l)}))))}}L(na),R(na,!0,(l=>new ya(l)));const Ha="KHR_xmp_json_ld";class ua{constructor(l){this.name=Ha,this.order=100,this._loader=l,this.enabled=this._loader.isExtensionUsed(Ha)}dispose(){this._loader=null}onLoading(){var l,a,N;if(null===this._loader.rootBabylonMesh)return;const U=null===(l=this._loader.Hc.extensions)||void 0===l?void 0:l.KHR_xmp_json_ld,c=null===(a=this._loader.Hc.asset)||void 0===a||null===(N=a.extensions)||void 0===N?void 0:N.KHR_xmp_json_ld;if(U&&c){const l=+c.packet;U.packets&&l<U.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=U.packets[l])}}}function Wa(l,a,N,U){return K.Ca.Ma(a,N).scale(U)}function Ba(l,a,N,U){return a[N]*U}function Ya(l,a,N,U){return-a[N]*U}function Ca(l,a,N,U){return a[N+1]*U}function Ma(l,a,N,U){return a[N]*U*2}function Aa(l){return{scale:[new qa(y.d.ANIMATIONTYPE_FLOAT,`${l}.uScale`,Ba,(()=>2)),new qa(y.d.ANIMATIONTYPE_FLOAT,`${l}.vScale`,Ca,(()=>2))],offset:[new qa(y.d.ANIMATIONTYPE_FLOAT,`${l}.uOffset`,Ba,(()=>2)),new qa(y.d.ANIMATIONTYPE_FLOAT,`${l}.vOffset`,Ca,(()=>2))],rotation:[new qa(y.d.ANIMATIONTYPE_FLOAT,`${l}.wAng`,Ya,(()=>1))]}}L(Ha),R(Ha,!0,(l=>new ua(l)));class Ea extends s.AnimationPropertyInfo{buildAnimations(l,a,N,U){return[{babylonAnimatable:l._babylonCamera,babylonAnimation:this._buildAnimation(a,N,U)}]}}class qa extends s.AnimationPropertyInfo{buildAnimations(l,a,N,U){const c=[];for(const K in l._data)c.push({babylonAnimatable:l._data[K].babylonMaterial,babylonAnimation:this._buildAnimation(a,N,U)});return c}}class ba extends s.AnimationPropertyInfo{buildAnimations(l,a,N,U){return[{babylonAnimatable:l._babylonLight,babylonAnimation:this._buildAnimation(a,N,U)}]}}(0,r.g)("/cameras/{}/orthographic/xmag",[new Ea(y.d.ANIMATIONTYPE_FLOAT,"orthoLeft",Ya,(()=>1)),new Ea(y.d.ANIMATIONTYPE_FLOAT,"orthoRight",Ca,(()=>1))]),(0,r.g)("/cameras/{}/orthographic/ymag",[new Ea(y.d.ANIMATIONTYPE_FLOAT,"orthoBottom",Ya,(()=>1)),new Ea(y.d.ANIMATIONTYPE_FLOAT,"orthoTop",Ca,(()=>1))]),(0,r.g)("/cameras/{}/orthographic/zfar",[new Ea(y.d.ANIMATIONTYPE_FLOAT,"maxZ",Ba,(()=>1))]),(0,r.g)("/cameras/{}/orthographic/znear",[new Ea(y.d.ANIMATIONTYPE_FLOAT,"Ac",Ba,(()=>1))]),(0,r.g)("/cameras/{}/perspective/yfov",[new Ea(y.d.ANIMATIONTYPE_FLOAT,"fov",Ba,(()=>1))]),(0,r.g)("/cameras/{}/perspective/zfar",[new Ea(y.d.ANIMATIONTYPE_FLOAT,"maxZ",Ba,(()=>1))]),(0,r.g)("/cameras/{}/perspective/znear",[new Ea(y.d.ANIMATIONTYPE_FLOAT,"Ac",Ba,(()=>1))]),(0,r.g)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new qa(y.d.ANIMATIONTYPE_COLOR3,"albedoColor",Wa,(()=>4)),new qa(y.d.ANIMATIONTYPE_FLOAT,"alpha",(function(l,a,N,U){return a[N+3]*U}),(()=>4))]),(0,r.g)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"metallic",Ba,(()=>1))]),(0,r.g)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"roughness",Ba,(()=>1))]);const za=Aa("albedoTexture");(0,r.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",za.scale),(0,r.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",za.offset),(0,r.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",za.rotation);const Ia=Aa("metallicTexture");(0,r.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Ia.scale),(0,r.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Ia.offset),(0,r.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Ia.rotation),(0,r.g)("/materials/{}/emissiveFactor",[new qa(y.d.ANIMATIONTYPE_COLOR3,"emissiveColor",Wa,(()=>3))]);const ta=Aa("bumpTexture");(0,r.g)("/materials/{}/normalTexture/scale",[new qa(y.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Ba,(()=>1))]),(0,r.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",ta.scale),(0,r.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",ta.offset),(0,r.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",ta.rotation),(0,r.g)("/materials/{}/occlusionTexture/strength",[new qa(y.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Ba,(()=>1))]);const Oa=Aa("ambientTexture");(0,r.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Oa.scale),(0,r.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Oa.offset),(0,r.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Oa.rotation);const ha=Aa("emissiveTexture");(0,r.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",ha.scale),(0,r.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",ha.offset),(0,r.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",ha.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new qa(y.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new qa(y.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Ba,(()=>1))]);const ia=Aa("anisotropy.texture");(0,r.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",ia.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",ia.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",ia.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Ba,(()=>1))]);const ka=Aa("clearCoat.texture");(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",ka.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",ka.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",ka.rotation);const Qa=Aa("clearCoat.bumpTexture");(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new qa(y.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Qa.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Qa.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Qa.rotation);const ja=Aa("clearCoat.textureRoughness");(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",ja.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",ja.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",ja.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new qa(y.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_ior/ior",[new qa(y.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new qa(y.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new qa(y.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Ba,(()=>1))]);const fa=Aa("iridescence.texture");(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",fa.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",fa.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",fa.rotation);const pa=Aa("iridescence.thicknessTexture");(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",pa.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",pa.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",pa.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new qa(y.d.ANIMATIONTYPE_COLOR3,"sheen.color",Wa,(()=>3))]),(0,r.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",Ba,(()=>1))]);const Ra=Aa("sheen.texture");(0,r.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Ra.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Ra.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Ra.rotation);const La=Aa("sheen.textureRoughness");(0,r.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",La.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",La.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",La.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new qa(y.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Wa,(()=>3))]);const ra=Aa("metallicReflectanceTexture");(0,r.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",ra.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",ra.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",ra.rotation);const Xa=Aa("reflectanceTexture");(0,r.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Xa.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Xa.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Xa.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Ba,(()=>1))]);const Pa=Aa("subSurface.refractionIntensityTexture");(0,r.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Pa.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Pa.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Pa.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new qa(y.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Wa,(()=>3))]),(0,r.g)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new qa(y.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Ba,(()=>1))]),(0,r.g)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Ba,(()=>1))]);const da=Aa("subSurface.thicknessTexture");(0,r.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",da.scale),(0,r.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",da.offset),(0,r.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",da.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new qa(y.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Ba,(()=>1))]);const Fa=Aa("subSurface.translucencyIntensityTexture");(0,r.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Fa.scale),(0,r.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Fa.offset),(0,r.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Fa.rotation),(0,r.g)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new qa(y.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Wa,(()=>3))]);const ea=Aa("subSurface.translucencyColorTexture");(0,r.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",ea.scale),(0,r.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",ea.offset),(0,r.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",ea.rotation),(0,r.g)("/extensions/KHR_lights_punctual/lights/{}/color",[new ba(y.d.ANIMATIONTYPE_COLOR3,"diffuse",Wa,(()=>3))]),(0,r.g)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ba(y.d.ANIMATIONTYPE_FLOAT,"intensity",Ba,(()=>1))]),(0,r.g)("/extensions/KHR_lights_punctual/lights/{}/range",[new ba(y.d.ANIMATIONTYPE_FLOAT,"range",Ba,(()=>1))]),(0,r.g)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ba(y.d.ANIMATIONTYPE_FLOAT,"innerAngle",Ma,(()=>1))]),(0,r.g)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ba(y.d.ANIMATIONTYPE_FLOAT,"angle",Ma,(()=>1))]),(0,r.g)("/nodes/{}/extensions/EXT_lights_ies/color",[new ba(y.d.ANIMATIONTYPE_COLOR3,"diffuse",Wa,(()=>3))]),(0,r.g)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ba(y.d.ANIMATIONTYPE_FLOAT,"intensity",Ba,(()=>1))]);const sa="KHR_animation_pointer";class oa{constructor(l){this.name=sa,this._loader=l,this._pathToObjectConverter=(0,r.f)(this._loader.Hc)}get enabled(){return this._loader.isExtensionUsed(sa)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(l,a,N,U,c){var K;const Z=null===(K=U.target.extensions)||void 0===K?void 0:K.KHR_animation_pointer;if(!Z||!this._pathToObjectConverter)return null;"pointer"!==U.target.path&&W.b.Warn(`${l}/target/path: Value (${U.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=U.target.node&&W.b.Warn(`${l}/target/node: Value (${U.target.node}) must not be present when using the ${this.name} extension`);const w=`${l}/extensions/${this.name}`,S=Z.pointer;if(!S)throw new Error(`${w}: Pointer is missing`);try{const K=this._pathToObjectConverter.convert(S);if(!K.info.interpolation)throw new Error(`${w}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(l,a,N,U,{object:K.object,info:K.info.interpolation},c)}catch(T){return W.b.Warn(`${w}/pointer: Invalid pointer (${S}) skipped`),null}}}L(sa),R(sa,!0,(l=>new oa(l)));class Ga{constructor(l,a,N){this.frame=l,this.action=a,this.onlyOnce=N,this.isDone=!1}_clone(){return new Ga(this.frame,this.action,this.onlyOnce)}}var mN=N(12288),xa=N(12336),Va=N(12328);class Da{get loop(){return this._loop}set loop(l){l!==this._loop&&(this._loop=l,this.updateOptions({loop:l}))}get currentTime(){var l;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(l=xa.c.audioEngine)&&void 0!==l&&l.audioContext&&(this.isPlaying||this.isPaused)){const l=this.isPaused?0:xa.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+l}return 0}get spatialSound(){return this._spatialSound}set spatialSound(l){if(l==this._spatialSound)return;const a=this.isPlaying;this.pause(),l?(this._spatialSound=l,this._updateSpatialParameters()):this._disableSpatialSound(),a&&this.play()}constructor(l,a,N){var U;let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new J.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=c.ua.Zero(),this._localDirection=new c.ua(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=l,N=N||u.e.LastCreatedScene)if(this._scene=N,Da._SceneComponentInitialization(N),this._readyToPlayCallback=K,this._customAttenuationFunction=(l,a,N,U,c)=>a<N?l*(1-a/N):0,w&&(this.autoplay=w.autoplay||!1,this._loop=w.loop||!1,void 0!==w.volume&&(this._volume=w.volume),this._spatialSound=w.spatialSound??!1,this.maxDistance=w.maxDistance??100,this.useCustomAttenuation=w.useCustomAttenuation??!1,this.rolloffFactor=w.rolloffFactor||1,this.refDistance=w.refDistance||1,this.distanceModel=w.distanceModel||"linear",this._playbackRate=w.playbackRate||1,this._streaming=w.streaming??!1,this._length=w.length,this._offset=w.offset),null!==(U=xa.c.audioEngine)&&void 0!==U&&U.canUseWebAudio&&xa.c.audioEngine.audioContext){this._soundGain=xa.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let l=!0;if(a)try{"string"===typeof a?(this._urlType="String",this._url=a):a instanceof ArrayBuffer?this._urlType="ArrayBuffer":a instanceof HTMLMediaElement?this._urlType="MediaElement":a instanceof MediaStream?this._urlType="MediaStream":a instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(a)&&(this._urlType="Array");let N=[],U=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=xa.c.audioEngine.audioContext.createMediaElementSource(a),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=xa.c.audioEngine.audioContext.createMediaStreamSource(a),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":a.byteLength>0&&(U=!0,this._soundLoaded(a));break;case"AudioBuffer":this._audioBufferLoaded(a);break;case"String":N.push(a);case"Array":0===N.length&&(N=a);for(let l=0;l<N.length;l++){const a=N[l];if(U=w&&w.skipCodecCheck||-1!==a.indexOf(".mp3",a.length-4)&&xa.c.audioEngine.isMP3supported||-1!==a.indexOf(".ogg",a.length-4)&&xa.c.audioEngine.isOGGsupported||-1!==a.indexOf(".wav",a.length-4)||-1!==a.indexOf(".m4a",a.length-4)||-1!==a.indexOf(".mp4",a.length-4)||-1!==a.indexOf("blob:"),U){this._streaming?(this._htmlAudioElement=new Audio(a),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Z.Tools.SetCorsBehavior(a,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(a,(l=>{this._soundLoaded(l)}),void 0,!0,!0,(l=>{l&&W.b.Error("XHR "+l.status+" error on: "+a+"."),W.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:l=!1}l?U||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):W.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(S){W.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),xa.c.audioEngine&&!xa.c.audioEngine.WarnedWebAudioUnsupported&&(W.b.Error("Web Audio is not supported by your browser."),xa.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var l;null!==(l=xa.c.audioEngine)&&void 0!==l&&l.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(l){var a;null!==(a=xa.c.audioEngine)&&void 0!==a&&a.audioContext&&(this._audioBuffer=l,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(l){var a;null!==(a=xa.c.audioEngine)&&void 0!==a&&a.audioContext&&xa.c.audioEngine.audioContext.decodeAudioData(l,(l=>{this._audioBufferLoaded(l)}),(l=>{W.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+l)}))}setAudioBuffer(l){var a;null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&(this._audioBuffer=l,this._isReadyToPlay=!0)}updateOptions(l){l&&(this.loop=l.loop??this.loop,this.maxDistance=l.maxDistance??this.maxDistance,this.useCustomAttenuation=l.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=l.rolloffFactor??this.rolloffFactor,this.refDistance=l.refDistance??this.refDistance,this.distanceModel=l.distanceModel??this.distanceModel,this._playbackRate=l.playbackRate??this._playbackRate,this._length=l.length??void 0,this.spatialSound=l.spatialSound??this._spatialSound,this._setOffset(l.offset??void 0),this.setVolume(l.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var l;null!==(l=xa.c.audioEngine)&&void 0!==l&&l.canUseWebAudio&&xa.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??xa.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var l;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(l=this._soundPanner)||void 0===l||l.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var l;null!==(l=xa.c.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(l){var a;null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(l),this._isOutputConnected=!0)}setDirectionalCone(l,a,N){a<l?W.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=l,this._coneOuterAngle=a,this._coneOuterGain=N,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(l){if(l!=this._coneInnerAngle){var a;if(this._coneOuterAngle<l)return void W.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=l,null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(l){if(l!=this._coneOuterAngle){var a;if(l<this._coneInnerAngle)return void W.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=l,null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(l){var a;l.equals(this._position)||(this._position.K(l),null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(l){var a;this._localDirection=l,null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const l=this._connectedTransformNode.getWorldMatrix(),a=c.ua.TransformNormal(this._localDirection,l);a.normalize(),this._soundPanner.orientationX.value=a.x,this._soundPanner.orientationY.value=a.y,this._soundPanner.orientationZ.value=a.z}updateDistanceFromListener(){var l;if(null!==(l=xa.c.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const l=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Wa(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,l,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(l){this._customAttenuationFunction=l}play(l,a,N){var U;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(U=xa.c.audioEngine)&&void 0!==U&&U.audioContext)try{var c,K;this._clearTimeoutsAndObservers();let U=l?(null===(c=xa.c.audioEngine)||void 0===c?void 0:c.audioContext.currentTime)+l:null===(K=xa.c.audioEngine)||void 0===K?void 0:K.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=xa.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const l=()=>{var N;if(null!==(N=xa.c.audioEngine)&&void 0!==N&&N.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=a??0;const N=this._htmlAudioElement.play();void 0!==N&&N.catch((()=>{var a,N;(null===(a=xa.c.audioEngine)||void 0===a||a.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(N=xa.c.audioEngine)||void 0===N?void 0:N.onAudioUnlockedObservable.addOnce((()=>{l()})))}))}else{var U;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(U=xa.c.audioEngine)||void 0===U?void 0:U.onAudioUnlockedObservable.addOnce((()=>{l()}))}};l()}}else{var Z;const c=()=>{var c;if(null!==(c=xa.c.audioEngine)&&void 0!==c&&c.audioContext){var K;if(N=N||this._length,void 0!==a&&this._setOffset(a),this._soundSource){const l=this._soundSource;l.onended=()=>{l.disconnect()}}if(this._soundSource=null===(K=xa.c.audioEngine)||void 0===K?void 0:K.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Z;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==a&&(this._soundSource.loopStart=a),void 0!==N&&(this._soundSource.loopEnd=(0|a)+N),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},U=l?(null===(Z=xa.c.audioEngine)||void 0===Z?void 0:Z.audioContext.currentTime)+l:xa.c.audioEngine.audioContext.currentTime;const c=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(U,c,this.loop?void 0:N)}}};"suspended"===(null===(Z=xa.c.audioEngine)||void 0===Z?void 0:Z.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var l;"suspended"===(null===(l=xa.c.audioEngine)||void 0===l?void 0:l.audioContext.state)?(xa.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=xa.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{c()})))):c()}),500):c()}this._startTime=U,this.isPlaying=!0,this.isPaused=!1}catch(w){W.b.Error("Error while trying to play audio: "+this.name+", "+w.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(l){var a;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var N;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(N=this._streamingSource)||void 0===N||N.disconnect();this.isPlaying=!1}else if(null!==(a=xa.c.audioEngine)&&void 0!==a&&a.audioContext&&this._soundSource){const a=l?xa.c.audioEngine.audioContext.currentTime+l:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(a)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var l;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var a;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(a=this._streamingSource)||void 0===a||a.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(l=xa.c.audioEngine)&&void 0!==l&&l.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=xa.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(l,a){var N;null!==(N=xa.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._soundGain&&(a&&xa.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(xa.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,xa.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(l,xa.c.audioEngine.audioContext.currentTime+a)):this._soundGain.gain.value=l),this._volume=l}setPlaybackRate(l){this._playbackRate=l,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(l){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=l,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=l=>this._onRegisterAfterWorldMatrixUpdate(l),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(l){var a;if(l.getBoundingInfo){const a=l.getBoundingInfo();this.setPosition(a.boundingSphere.centerWorld)}else this.setPosition(l.absolutePosition);null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const l=()=>{(0,Va.d)((()=>this._isReadyToPlay),(()=>{N._audioBuffer=this.getAudioBuffer(),N._isReadyToPlay=!0,N.autoplay&&N.play(0,this._offset,this._length)}),void 0,300)},a={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},N=new Da(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,a);return this.useCustomAttenuation&&N.setAttenuationFunction(this._customAttenuationFunction),N.setPosition(this._position),N.setPlaybackRate(this._playbackRate),l(),N}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const l={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(l.connectedMeshId=this._connectedTransformNode.id),l.position=this._position.Bc(),l.refDistance=this.refDistance,l.distanceModel=this.distanceModel,l.isDirectional=this._isDirectional,l.localDirectionToMesh=this._localDirection.Bc(),l.coneInnerAngle=this._coneInnerAngle,l.coneOuterAngle=this._coneOuterAngle,l.coneOuterGain=this._coneOuterGain),l}static Parse(l,a,N,U){const K=l.name;let Z;Z=l.url?N+l.url:N+K;const w={autoplay:l.autoplay,loop:l.loop,volume:l.volume,spatialSound:l.spatialSound,maxDistance:l.maxDistance,rolloffFactor:l.rolloffFactor,refDistance:l.refDistance,distanceModel:l.distanceModel,playbackRate:l.playbackRate};let S;if(U){const l=()=>{(0,Va.d)((()=>U._isReadyToPlay),(()=>{S._audioBuffer=U.getAudioBuffer(),S._isReadyToPlay=!0,S.autoplay&&S.play(0,S._offset,S._length)}),void 0,300)};S=new Da(K,new ArrayBuffer(0),a,null,w),l()}else S=new Da(K,Z,a,(()=>{a.removePendingData(S)}),w),a.addPendingData(S);if(l.position){const a=c.ua.Ma(l.position);S.setPosition(a)}if(l.isDirectional&&(S.setDirectionalCone(l.coneInnerAngle||360,l.coneOuterAngle||360,l.coneOuterGain||0),l.localDirectionToMesh)){const a=c.ua.Ma(l.localDirectionToMesh);S.setLocalDirectionToMesh(a)}if(l.connectedMeshId){const N=a.getMeshById(l.connectedMeshId);N&&S.attachToMesh(N)}return l.metadata&&(S.metadata=l.metadata),S}_setOffset(l){this._offset!==l&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=l)}_clearTimeoutsAndObservers(){var l;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(l=xa.c.audioEngine)||void 0===l||l.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Da._SceneComponentInitialization=l=>{throw(0,mN.b)("AudioSceneComponent")},(0,ql.g)("BABYLON.Sound",Da);class va{constructor(l,a,N){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],a.length!==N.length)throw new Error("Sounds length does not equal weights length");this.loop=l,this._weights=N;let U=0;for(const K of N)U+=K;const c=U>0?1/U:0;for(let K=0;K<this._weights.length;K++)this._weights[K]*=c;this._sounds=a;for(const K of this._sounds)K.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(l){if(l!==this._coneInnerAngle){if(this._coneOuterAngle<l)return void W.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=l;for(const a of this._sounds)a.directionalConeInnerAngle=l}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(l){if(l!==this._coneOuterAngle){if(l<this._coneInnerAngle)return void W.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=l;for(const a of this._sounds)a.directionalConeOuterAngle=l}}get volume(){return this._volume}set volume(l){if(l!==this._volume)for(const a of this._sounds)a.setVolume(l)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(l){if(!this.isPaused){this.stop();const l=Math.random();let a=0;for(let N=0;N<this._weights.length;N++)if(a+=this._weights[N],l<=a){this._currentIndex=N;break}}const a=this._sounds[this._currentIndex??0];a.isReady()?a.play(0,this.isPaused?void 0:l):a.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class ga{constructor(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(l=l||u.e.LastCreatedScene)&&(this._scene=l,this.soundCollection=[],this._options=a,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var l;null!==(l=xa.c.audioEngine)&&void 0!==l&&l.canUseWebAudio&&xa.c.audioEngine.audioContext&&(this._outputAudioNode=xa.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(xa.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(xa.c.audioEngine&&xa.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(l){var a;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&l.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==l.soundTrackId&&(-1===l.soundTrackId?this._scene.mainSoundTrack.removeSound(l):this._scene.soundTracks&&this._scene.soundTracks[l.soundTrackId].removeSound(l)),this.soundCollection.push(l),l.soundTrackId=this.id}removeSound(l){const a=this.soundCollection.indexOf(l);-1!==a&&this.soundCollection.splice(a,1)}setVolume(l){var a;null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=l)}switchPanningModelToHRTF(){var l;if(null!==(l=xa.c.audioEngine)&&void 0!==l&&l.canUseWebAudio)for(let a=0;a<this.soundCollection.length;a++)this.soundCollection[a].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var l;if(null!==(l=xa.c.audioEngine)&&void 0!==l&&l.canUseWebAudio)for(let a=0;a<this.soundCollection.length;a++)this.soundCollection[a].switchPanningModelToEqualPower()}connectToAnalyser(l){var a;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=l,null!==(a=xa.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,xa.c.audioEngine.masterGain))}}var lN=N(12710),aN=N(12678),NN=N(12266);xa.c.AudioEngineFactory=(l,a,N)=>new UN(l,a,N);class UN{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new J.e,this.onAudioLockedObservable=new J.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,NN.o)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const U=document.createElement("audio");this._hostElement=l,this._audioContext=a,this._audioDestination=N;try{U&&U.canPlayType&&(U.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||U.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(c){}try{U&&U.canPlayType&&U.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(c){}}lock(){this._triggerSuspendedState()}unlock(){var l,a;if("running"===(null===(l=this._audioContext)||void 0===l?void 0:l.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(a=this._audioContext)||void 0===a||a.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{W.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var l;null===(l=this._audioContext)||void 0===l||l.addEventListener("statechange",(()=>{var l;this.unlocked&&"running"!==(null===(l=this._audioContext)||void 0===l?void 0:l.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var l;return null!==(l=this._audioContext)&&void 0!==l&&l.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(l){this.canUseWebAudio=!1,W.b.Error("Web Audio: "+l.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(l){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const l=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",a=document.createElement("style");a.appendChild(document.createTextNode(l)),document.getElementsByTagName("head")[0].appendChild(a),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var l;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(l=this._audioContext)||void 0===l||l.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(l){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=l)}connectToAnalyser(l){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=l,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var cN=N(12283);(0,N(13809).f)(lN.e.NAME_AUDIO,((l,a,N,U)=>{let c,K=[];if(N.mH=N.mH||[],void 0!==l.mH&&null!==l.mH)for(let w=0,S=l.mH.length;w<S;w++){var Z;const S=l.mH[w];null!==(Z=xa.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio?(S.url||(S.url=S.name),K[S.url]?N.mH.push(Da.Parse(S,a,U,K[S.url])):(c=Da.Parse(S,a,U),K[S.url]=c,N.mH.push(c))):N.mH.push(new Da(S.name,null,a))}K=[]})),Object.defineProperty(aN.d.prototype,"mainSoundTrack",{get:function(){let l=this._getComponent(lN.e.NAME_AUDIO);return l||(l=new KN(this),this.Kc(l)),this._mainSoundTrack||(this._mainSoundTrack=new ga(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),aN.d.prototype.getSoundByName=function(l){let a;for(a=0;a<this.mainSoundTrack.soundCollection.length;a++)if(this.mainSoundTrack.soundCollection[a].name===l)return this.mainSoundTrack.soundCollection[a];if(this.soundTracks)for(let N=0;N<this.soundTracks.length;N++)for(a=0;a<this.soundTracks[N].soundCollection.length;a++)if(this.soundTracks[N].soundCollection[a].name===l)return this.soundTracks[N].soundCollection[a];return null},Object.defineProperty(aN.d.prototype,"audioEnabled",{get:function(){let l=this._getComponent(lN.e.NAME_AUDIO);return l||(l=new KN(this),this.Kc(l)),l.audioEnabled},set:function(l){let a=this._getComponent(lN.e.NAME_AUDIO);a||(a=new KN(this),this.Kc(a)),l?a.enableAudio():a.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(aN.d.prototype,"headphone",{get:function(){let l=this._getComponent(lN.e.NAME_AUDIO);return l||(l=new KN(this),this.Kc(l)),l.headphone},set:function(l){let a=this._getComponent(lN.e.NAME_AUDIO);a||(a=new KN(this),this.Kc(a)),l?a.switchAudioModeForHeadphones():a.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(aN.d.prototype,"audioListenerPositionProvider",{get:function(){let l=this._getComponent(lN.e.NAME_AUDIO);return l||(l=new KN(this),this.Kc(l)),l.audioListenerPositionProvider},set:function(l){let a=this._getComponent(lN.e.NAME_AUDIO);if(a||(a=new KN(this),this.Kc(a)),l&&"function"!==typeof l)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");a.audioListenerPositionProvider=l},enumerable:!0,configurable:!0}),Object.defineProperty(aN.d.prototype,"audioListenerRotationProvider",{get:function(){let l=this._getComponent(lN.e.NAME_AUDIO);return l||(l=new KN(this),this.Kc(l)),l.audioListenerRotationProvider},set:function(l){let a=this._getComponent(lN.e.NAME_AUDIO);if(a||(a=new KN(this),this.Kc(a)),l&&"function"!==typeof l)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");a.audioListenerRotationProvider=l},enumerable:!0,configurable:!0}),Object.defineProperty(aN.d.prototype,"audioPositioningRefreshRate",{get:function(){let l=this._getComponent(lN.e.NAME_AUDIO);return l||(l=new KN(this),this.Kc(l)),l.audioPositioningRefreshRate},set:function(l){let a=this._getComponent(lN.e.NAME_AUDIO);a||(a=new KN(this),this.Kc(a)),a.audioPositioningRefreshRate=l},enumerable:!0,configurable:!0});class KN{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(l){this.name=lN.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new c.ua,this._cachedCameraPosition=new c.ua,this._lastCheck=0,this._invertMatrixTemp=new c.Matrix,this._cameraDirectionTemp=new c.ua,(l=l||u.e.LastCreatedScene)&&(this.Ba=l,l.soundTracks=[],l.mH=[])}register(){this.Ba._afterRenderStage.registerStep(lN.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(l){if(l.mH=[],this.Ba.soundTracks)for(let a=0;a<this.Ba.soundTracks.length;a++){const N=this.Ba.soundTracks[a];for(let a=0;a<N.soundCollection.length;a++)l.mH.push(N.soundCollection[a].serialize())}}addFromContainer(l){if(l.mH)for(const a of l.mH)a.play(),a.autoplay=!0,this.Ba.mainSoundTrack.addSound(a)}removeFromContainer(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l.mH)for(const N of l.mH)N.stop(),N.autoplay=!1,this.Ba.mainSoundTrack.removeSound(N),a&&N.dispose()}dispose(){const l=this.Ba;if(l._mainSoundTrack&&l.mainSoundTrack.dispose(),l.soundTracks)for(let a=0;a<l.soundTracks.length;a++)l.soundTracks[a].dispose()}disableAudio(){const l=this.Ba;let a;for(this._audioEnabled=!1,xa.c.audioEngine&&xa.c.audioEngine.audioContext&&xa.c.audioEngine.audioContext.suspend(),a=0;a<l.mainSoundTrack.soundCollection.length;a++)l.mainSoundTrack.soundCollection[a].pause();if(l.soundTracks)for(a=0;a<l.soundTracks.length;a++)for(let N=0;N<l.soundTracks[a].soundCollection.length;N++)l.soundTracks[a].soundCollection[N].pause()}enableAudio(){const l=this.Ba;let a;for(this._audioEnabled=!0,xa.c.audioEngine&&xa.c.audioEngine.audioContext&&xa.c.audioEngine.audioContext.resume(),a=0;a<l.mainSoundTrack.soundCollection.length;a++)l.mainSoundTrack.soundCollection[a].isPaused&&l.mainSoundTrack.soundCollection[a].play();if(l.soundTracks)for(a=0;a<l.soundTracks.length;a++)for(let N=0;N<l.soundTracks[a].soundCollection.length;N++)l.soundTracks[a].soundCollection[N].isPaused&&l.soundTracks[a].soundCollection[N].play()}switchAudioModeForHeadphones(){const l=this.Ba;if(this._headphone=!0,l.mainSoundTrack.switchPanningModelToHRTF(),l.soundTracks)for(let a=0;a<l.soundTracks.length;a++)l.soundTracks[a].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const l=this.Ba;if(this._headphone=!1,l.mainSoundTrack.switchPanningModelToEqualPower(),l.soundTracks)for(let a=0;a<l.soundTracks.length;a++)l.soundTracks[a].switchPanningModelToEqualPower()}_afterRender(){const l=cN.d.Now;if(this._lastCheck&&l-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=l;const a=this.Ba;if(!this._audioEnabled||!a._mainSoundTrack||!a.soundTracks||0===a._mainSoundTrack.soundCollection.length&&1===a.soundTracks.length)return;const N=xa.c.audioEngine;if(N&&N.audioContext){let l,U=a.activeCamera;if(a.activeCameras&&a.activeCameras.length>0&&(U=a.activeCameras[0]),this.audioListenerPositionProvider){const l=this.audioListenerPositionProvider();N.audioContext.listener.setPosition(l.x||0,l.y||0,l.z||0)}else U?this._cachedCameraPosition.equals(U.globalPosition)||(this._cachedCameraPosition.K(U.globalPosition),N.audioContext.listener.setPosition(U.globalPosition.x,U.globalPosition.y,U.globalPosition.z)):N.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const l=this.audioListenerRotationProvider();N.audioContext.listener.setOrientation(l.x||0,l.y||0,l.z||0,0,1,0)}else U?(U.rigCameras&&U.rigCameras.length>0&&(U=U.rigCameras[0]),U.getViewMatrix().invertToRef(this._invertMatrixTemp),c.ua.TransformNormalToRef(KN._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.K(this._cameraDirectionTemp),N.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):N.audioContext.listener.setOrientation(0,0,0,0,1,0);for(l=0;l<a.mainSoundTrack.soundCollection.length;l++){const N=a.mainSoundTrack.soundCollection[l];N.useCustomAttenuation&&N.updateDistanceFromListener()}if(a.soundTracks)for(l=0;l<a.soundTracks.length;l++)for(let N=0;N<a.soundTracks[l].soundCollection.length;N++){const U=a.soundTracks[l].soundCollection[N];U.useCustomAttenuation&&U.updateDistanceFromListener()}}}}KN._CameraDirection=new c.ua(0,0,-1),Da._SceneComponentInitialization=l=>{let a=l._getComponent(lN.e.NAME_AUDIO);a||(a=new KN(l),l.Kc(a))};const ZN="MSFT_audio_emitter";class wN{constructor(l){this.name=ZN,this._loader=l,this.enabled=this._loader.isExtensionUsed(ZN)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const l=this._loader.Hc.extensions;if(l&&l[this.name]){const a=l[this.name];this._clips=a.clips,this._emitters=a.emitters,d.Assign(this._clips),d.Assign(this._emitters)}}loadSceneAsync(l,a){return e.LoadExtensionAsync(l,a,this.name,(async(N,U)=>{const c=new Array;c.push(this._loader.loadSceneAsync(l,a));for(const l of U.emitters){const a=d.Get(`${N}/emitters`,this._emitters,l);if(void 0!=a.refDistance||void 0!=a.maxDistance||void 0!=a.rolloffFactor||void 0!=a.distanceModel||void 0!=a.innerAngle||void 0!=a.outerAngle)throw new Error(`${N}: Direction or Distance properties are not allowed on emitters attached to a scene`);c.push(this._loadEmitterAsync(`${N}/emitters/${a.index}`,a))}await Promise.all(c)}))}loadNodeAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(l,U)=>{const K=new Array,w=await this._loader.loadNodeAsync(l,a,(a=>{for(const N of U.emitters){const U=d.Get(`${l}/emitters`,this._emitters,N);K.push(this._loadEmitterAsync(`${l}/emitters/${U.index}`,U).then((()=>{for(const l of U._babylonSounds)l.attachToMesh(a),void 0==U.innerAngle&&void 0==U.outerAngle||(l.setLocalDirectionToMesh(c.ua.Forward()),l.setDirectionalCone(2*Z.Tools.ToDegrees(void 0==U.innerAngle?Math.PI:U.innerAngle),2*Z.Tools.ToDegrees(void 0==U.outerAngle?Math.PI:U.outerAngle),0))})))}N(a)}));return await Promise.all(K),w}))}loadAnimationAsync(l,a){return e.LoadExtensionAsync(l,a,this.name,(async(N,U)=>{const c=await this._loader.loadAnimationAsync(l,a),K=new Array;d.Assign(U.events);for(const Z of U.events)K.push(this._loadAnimationEventAsync(`${N}/events/${Z.index}`,l,a,Z,c));return await Promise.all(K),c}))}_loadClipAsync(l,a){if(a._objectURL)return a._objectURL;let N;if(a.uri)N=this._loader.loadUriAsync(l,a,a.uri);else{const U=d.Get(`${l}/bufferView`,this._loader.Hc.bufferViews,a.bufferView);N=this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U)}return a._objectURL=N.then((l=>URL.createObjectURL(new Blob([l],{type:a.mimeType})))),a._objectURL}_loadEmitterAsync(l,a){if(a._babylonSounds=a._babylonSounds||[],!a._babylonData){const l=new Array,N=a.name||`emitter${a.index}`,U={loop:!1,autoplay:!1,volume:void 0==a.volume?1:a.volume};for(let K=0;K<a.clips.length;K++){const c=`/extensions/${this.name}/clips`,Z=d.Get(c,this._clips,a.clips[K].clip);l.push(this._loadClipAsync(`${c}/${a.clips[K].clip}`,Z).then((l=>{const c=a._babylonSounds[K]=new Da(N,l,this._loader.babylonScene,null,U);c.refDistance=a.refDistance||1,c.maxDistance=a.maxDistance||256,c.rolloffFactor=a.rolloffFactor||1,c.distanceModel=a.distanceModel||"exponential"})))}const c=Promise.all(l).then((()=>{const l=a.clips.map((l=>l.weight||1)),N=new va(a.loop||!1,a._babylonSounds,l);a.innerAngle&&(N.directionalConeInnerAngle=2*Z.Tools.ToDegrees(a.innerAngle)),a.outerAngle&&(N.directionalConeOuterAngle=2*Z.Tools.ToDegrees(a.outerAngle)),a.volume&&(N.volume=a.volume),a._babylonData.sound=N}));a._babylonData={loaded:c}}return a._babylonData.loaded}_getEventAction(l,a,N,U,c){switch(N){case"play":return l=>{const N=(c||0)+(l-U);a.play(N)};case"stop":return()=>{a.stop()};case"pause":return()=>{a.pause()};default:throw new Error(`${l}: Unsupported action ${N}`)}}_loadAnimationEventAsync(l,a,N,U,c){if(0==c.targetedAnimations.length)return Promise.resolve();const K=c.targetedAnimations[0],Z=U.Ua,w=d.Get(`/extensions/${this.name}/emitters`,this._emitters,Z);return this._loadEmitterAsync(l,w).then((()=>{const a=w._babylonData.sound;if(a){const N=new Ga(U.time,this._getEventAction(l,a,U.action,U.time,U.startOffset));K.animation.addEvent(N),c.onAnimationGroupEndObservable.add((()=>{a.stop()})),c.onAnimationGroupPauseObservable.add((()=>{a.pause()}))}}))}}L(ZN),R(ZN,!0,(l=>new wN(l)));const SN="MSFT_lod";class TN{constructor(l){var a;this.name=SN,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new J.e,this.onMaterialLODsLoadedObservable=new J.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=l,this.maxLODsToLoad=(null===(a=this._loader.parent.extensionOptions[SN])||void 0===a?void 0:a.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(SN)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let l=0;l<this._nodePromiseLODs.length;l++){const a=Promise.all(this._nodePromiseLODs[l]).then((()=>{0!==l&&(this._loader.endPerformanceCounter(`Node LOD ${l}`),this._loader.log(`Loaded node LOD ${l}`)),this.onNodeLODsLoadedObservable.notifyObservers(l),l!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${l+1}`),this._loadBufferLOD(this._nodeBufferLODs,l+1),this._nodeSignalLODs[l]&&this._nodeSignalLODs[l].resolve())}));this._loader._completePromises.push(a)}for(let l=0;l<this._materialPromiseLODs.length;l++){const a=Promise.all(this._materialPromiseLODs[l]).then((()=>{0!==l&&(this._loader.endPerformanceCounter(`Material LOD ${l}`),this._loader.log(`Loaded material LOD ${l}`)),this.onMaterialLODsLoadedObservable.notifyObservers(l),l!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${l+1}`),this._loadBufferLOD(this._materialBufferLODs,l+1),this._materialSignalLODs[l]&&this._materialSignalLODs[l].resolve())}));this._loader._completePromises.push(a)}}loadSceneAsync(l,a){const N=this._loader.loadSceneAsync(l,a);return this._loadBufferLOD(this._bufferLODs,0),N}loadNodeAsync(l,a,N){return e.LoadExtensionAsync(l,a,this.name,(async(l,c)=>{let K;const Z=this._getLODs(l,a,this._loader.Hc.nodes,c.ids);this._loader.logOpen(`${l}`);for(let a=0;a<Z.length;a++){const l=Z[a];0!==a&&(this._nodeIndexLOD=a,this._nodeSignalLODs[a]=this._nodeSignalLODs[a]||new U);const c=l=>{N(l),l.lS(!1)},w=this._loader.loadNodeAsync(`/nodes/${l.index}`,l,c).then((l=>{if(0!==a){const l=Z[a-1];l._babylonTransformNode&&(this._disposeTransformNode(l._babylonTransformNode),delete l._babylonTransformNode)}return l.lS(!0),l}));this._nodePromiseLODs[a]=this._nodePromiseLODs[a]||[],0===a?K=w:(this._nodeIndexLOD=null,this._nodePromiseLODs[a].push(w))}return this._loader.logClose(),await K}))}_loadMaterialAsync(l,a,N,U,c){return this._nodeIndexLOD?null:e.LoadExtensionAsync(l,a,this.name,(async(l,K)=>{let Z;const w=this._getLODs(l,a,this._loader.Hc.materials,K.ids);this._loader.logOpen(`${l}`);for(let a=0;a<w.length;a++){const l=w[a];0!==a&&(this._materialIndexLOD=a);const K=this._loader._loadMaterialAsync(`/materials/${l.index}`,l,N,U,(l=>{0===a&&c(l)})).then((l=>{if(0!==a){c(l);const N=w[a-1]._data;N[U]&&(this._disposeMaterials([N[U].babylonMaterial]),delete N[U])}return l}));this._materialPromiseLODs[a]=this._materialPromiseLODs[a]||[],0===a?Z=K:(this._materialIndexLOD=null,this._materialPromiseLODs[a].push(K))}return this._loader.logClose(),await Z}))}_loadUriAsync(l,a,N){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const c=this._nodeIndexLOD-1;return this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new U,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(l,a,N)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const c=this._materialIndexLOD-1;return this._materialSignalLODs[c]=this._materialSignalLODs[c]||new U,this._materialSignalLODs[c].promise.then((async()=>await this._loader.loadUriAsync(l,a,N)))}return null}loadBufferAsync(l,a,N,c){if(this._loader.parent.useRangeRequests&&!a.uri){if(!this._loader.bin)throw new Error(`${l}: Uri is missing or the binary glTF is missing its binary chunk`);const a=async(l,a)=>{const K=N,Z=K+c-1;let w=l[a];return w?(w.start=Math.min(w.start,K),w.end=Math.max(w.end,Z)):(w={start:K,end:Z,loaded:new U},l[a]=w),await w.loaded.promise.then((l=>new Uint8Array(l.buffer,l.byteOffset+N-w.start,c)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?a(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?a(this._materialBufferLODs,this._materialIndexLOD):a(this._bufferLODs,0)}return null}_loadBufferLOD(l,a){const N=l[a];N&&(this._loader.log(`Loading buffer range [${N.start}-${N.end}]`),this._loader.bin.readAsync(N.start,N.end-N.start+1).then((l=>{N.loaded.resolve(l)}),(l=>{N.loaded.reject(l)})))}_getLODs(l,a,N,U){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const c=[];for(let K=U.length-1;K>=0;K--)if(c.push(d.Get(`${l}/ids/${U[K]}`,N,U[K])),c.length===this.maxLODsToLoad)return c;return c.push(a),c}_disposeTransformNode(l){const a=[],N=l.material;N&&a.push(N);for(const c of l.getChildMeshes())c.material&&a.push(c.material);l.dispose();const U=a.filter((l=>this._loader.babylonScene.meshes.every((a=>a.material!=l))));this._disposeMaterials(U)}_disposeMaterials(l){const a={};for(const N of l){for(const l of N.getActiveTextures())a[l.uniqueId]=l;N.dispose()}for(const N in a)for(const l of this._loader.babylonScene.materials)l.hasTexture(a[N])&&delete a[N];for(const N in a)a[N].dispose()}}L(SN),R(SN,!0,(l=>new TN(l)));const JN="MSFT_minecraftMesh";class nN{constructor(l){this.name=JN,this._loader=l,this.enabled=this._loader.isExtensionUsed(JN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtraAsync(l,a,this.name,(async(U,c)=>{if(c){if(!(N instanceof M.b))throw new Error(`${U}: Material type not supported`);const c=this._loader.loadMaterialPropertiesAsync(l,a,N);return N.needAlphaBlending()&&(N.forceDepthWrite=!0,N.separateCullingPass=!0),N.Ic=N.forceDepthWrite,N.twoSidedLighting=!0,await c}}))}}L(JN),R(JN,!0,(l=>new nN(l)));const yN="MSFT_sRGBFactors";class HN{constructor(l){this.name=yN,this._loader=l,this.enabled=this._loader.isExtensionUsed(yN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(l,a,N){return e.LoadExtraAsync(l,a,this.name,(async(U,c)=>{if(c){if(!(N instanceof M.b))throw new Error(`${U}: Material type not supported`);const c=this._loader.loadMaterialPropertiesAsync(l,a,N),K=N.bl().getEngine().useExactSrgbConversions;return N.albedoTexture||N.albedoColor.toLinearSpaceToRef(N.albedoColor,K),N.reflectivityTexture||N.reflectivityColor.toLinearSpaceToRef(N.reflectivityColor,K),await c}}))}}L(yN),R(yN,!0,(l=>new HN(l)));var uN=N(14126);const WN={};var BN=N(14188),YN=N(14167),CN=N(14131),MN=N(14145);function AN(l,a){for(const N of l)for(const l of N.dataOutputs)if(l.uniqueId===a)return l;throw new Error("Could not find data out connection with unique id "+a)}function EN(l,a){for(const N of l)if(N instanceof YN.b)for(const l of N.signalInputs)if(l.uniqueId===a)return l;throw new Error("Could not find signal in connection with unique id "+a)}async function qN(l,a){const U=await Promise.all(l.allBlocks.map((async l=>{const a=function(l){switch(l){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([N.e(78),N.e(79)]).then(N.bind(N,15603))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await N.e(80).then(N.bind(N,15606))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await N.e(81).then(N.bind(N,15610))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await N.e(82).then(N.bind(N,15619))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await N.e(83).then(N.bind(N,15621))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await N.e(84).then(N.bind(N,15627))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await N.e(85).then(N.bind(N,15631))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await N.e(86).then(N.bind(N,15633))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await N.e(87).then(N.bind(N,15635))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await N.e(90).then(N.bind(N,15661))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await N.e(90).then(N.bind(N,15661))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await N.e(90).then(N.bind(N,15661))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await N.e(90).then(N.bind(N,15661))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await N.e(95).then(N.bind(N,15668))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await N.e(96).then(N.bind(N,15677))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await N.e(97).then(N.bind(N,15683))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await N.e(98).then(N.bind(N,15692))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await N.e(99).then(N.bind(N,15697))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await N.e(100).then(N.bind(N,15706))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await N.e(101).then(N.bind(N,15711))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await N.e(102).then(N.bind(N,15715))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await N.e(103).then(N.bind(N,15719))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await N.e(104).then(N.bind(N,15724))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await N.e(105).then(N.bind(N,15731))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await N.e(106).then(N.bind(N,15733))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await N.e(107).then(N.bind(N,15737))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await N.e(108).then(N.bind(N,15740))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await N.e(109).then(N.bind(N,15748))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await N.e(110).then(N.bind(N,15752))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await N.e(111).then(N.bind(N,15758))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await N.e(112).then(N.bind(N,15761))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await N.e(113).then(N.bind(N,15767))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await N.e(92).then(N.bind(N,15769))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await N.e(114).then(N.bind(N,15777))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await N.e(115).then(N.bind(N,15785))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await N.e(116).then(N.bind(N,15790))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await N.e(93).then(N.bind(N,15799))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await N.e(88).then(N.bind(N,15640))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await N.e(94).then(N.bind(N,15808))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await N.e(94).then(N.bind(N,15808))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await N.e(94).then(N.bind(N,15808))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await N.e(94).then(N.bind(N,15808))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await N.e(94).then(N.bind(N,15808))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await N.e(94).then(N.bind(N,15808))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await N.e(94).then(N.bind(N,15808))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await N.e(94).then(N.bind(N,15808))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await N.e(89).then(N.bind(N,15654))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await N.e(90).then(N.bind(N,15661))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await N.e(90).then(N.bind(N,15661))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await N.e(91).then(N.bind(N,15813))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await N.e(91).then(N.bind(N,15813))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await N.e(91).then(N.bind(N,15813))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await N.e(91).then(N.bind(N,15813))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await N.e(91).then(N.bind(N,15813))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await N.e(91).then(N.bind(N,15813))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await N.e(117).then(N.bind(N,15819))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await N.e(118).then(N.bind(N,15822))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await N.e(119).then(N.bind(N,15828))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await N.e(120).then(N.bind(N,15836))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await N.e(121).then(N.bind(N,15841))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await N.e(122).then(N.bind(N,15849))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await N.e(123).then(N.bind(N,15853))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await N.e(124).then(N.bind(N,15859))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await N.e(125).then(N.bind(N,15865))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await N.e(126).then(N.bind(N,15869))).FlowGraphDataSwitchBlock;default:if(WN[l])return WN[l];throw new Error(`Unknown block name ${l}`)}}(l.className);return await a()})));return function(l,a,N){const U=a.coordinator.createGraph(),c=[],K=a.valueParseFunction??CN.b;for(let Z=0;Z<l.allBlocks.length;Z++){const w=zN(l.allBlocks[Z],{Ba:a.coordinator.config.Ba,pathConverter:a.pathConverter,assetsContainer:a.coordinator.config.Ba,valueParseFunction:K},N[Z]);c.push(w),w instanceof BN.e&&U.addEventBlock(w)}for(const Z of c){for(const l of Z.dataInputs)for(const a of l.connectedPointIds){const N=AN(c,a);l.connectTo(N)}if(Z instanceof YN.b)for(const l of Z.signalOutputs)for(const a of l.connectedPointIds){const N=EN(c,a);l.connectTo(N)}}for(const Z of l.executionContexts)bN(Z,{graph:U,valueParseFunction:K},l.rightHanded);return U}(l,a,U)}function bN(l,a,N){const U=a.graph.createContext();l.enableLogging&&(U.enableLogging=!0),U.treatDataAsRightHanded=N||!1;const c=a.valueParseFunction??CN.b;U.uniqueId=l.uniqueId;const K=U.bl();if(l._assetsContext){var Z,w,S,T,J,n,y,H,u,W;const a=l._assetsContext,N={meshes:null===(Z=a.meshes)||void 0===Z?void 0:Z.map((l=>K.getMeshById(l))),lights:null===(w=a.lights)||void 0===w?void 0:w.map((l=>K.getLightByName(l))),cameras:null===(S=a.cameras)||void 0===S?void 0:S.map((l=>K.getCameraByName(l))),materials:null===(T=a.materials)||void 0===T?void 0:T.map((l=>K.getMaterialById(l))),textures:null===(J=a.textures)||void 0===J?void 0:J.map((l=>K.getTextureByName(l))),animations:null===(n=a.animations)||void 0===n?void 0:n.map((l=>K.animations.find((a=>a.name===l)))),skeletons:null===(y=a.skeletons)||void 0===y?void 0:y.map((l=>K.getSkeletonByName(l))),wy:null===(H=a.wy)||void 0===H?void 0:H.map((l=>K.getParticleSystemById(l))),animationGroups:null===(u=a.animationGroups)||void 0===u?void 0:u.map((l=>K.getAnimationGroupByName(l))),transformNodes:null===(W=a.transformNodes)||void 0===W?void 0:W.map((l=>K.getTransformNodeById(l))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],mH:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};U.assetsContext=N}for(const B in l._userVariables){const a=c(B,l._userVariables,U.assetsContext,K);U.userVariables[B]=a}for(const B in l._connectionValues){const a=c(B,l._connectionValues,U.assetsContext,K);U._setConnectionValueByKey(B,a)}return U}function zN(l,a,N){const U={},c=a.valueParseFunction??CN.b;if(l.config)for(const Z in l.config)U[Z]=c(Z,l.config,a.assetsContainer||a.Ba,a.Ba);if((0,CN.i)(l.className)){if(!a.pathConverter)throw new Error("Path converter is required for this block");U.pathConverter=a.pathConverter}const K=new N(U);K.uniqueId=l.uniqueId;for(let Z=0;Z<l.dataInputs.length;Z++){const a=K.getDataInput(l.dataInputs[Z].name);if(!a)throw new Error("Could not find data input with name "+l.dataInputs[Z].name+" in block "+l.className);a.deserialize(l.dataInputs[Z])}for(let Z=0;Z<l.dataOutputs.length;Z++){const a=K.getDataOutput(l.dataOutputs[Z].name);if(!a)throw new Error("Could not find data output with name "+l.dataOutputs[Z].name+" in block "+l.className);a.deserialize(l.dataOutputs[Z])}return K.metadata=l.metadata,K.deserialize&&K.deserialize(l),K}function IN(l){const[a,N]=l.split(":");return tN({op:a,extension:N})}function tN(l){var a;let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const U=l.extension?null===(a=hN[l.extension])||void 0===a?void 0:a[l.op]:iN[l.op];if(!U&&(W.b.Warn(`No mapping found for operation ${l.op} and extension ${l.extension||"KHR_interactivity"}`),N)){const a={},N={flows:{}};if(l.inputValueSockets){a.values={};for(const N in l.inputValueSockets)a.values[N]={name:N}}return l.outputValueSockets&&(N.values={},Object.keys(l.outputValueSockets).forEach((l=>{N.values[l]={name:l}}))),{qJ:[],inputs:a,outputs:N}}return U}function ON(l,a,N){hN[a]||(hN[a]={}),hN[a][l]=N}const hN={BABYLON:{"flow/log":{qJ:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},iN={"event/onStart":{qJ:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{qJ:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{qJ:["FlowGraphSendCustomEventBlock"],extraProcessor(l,a,N,U,c){if("event/send"!==a.op||!l.configuration||1!==Object.keys(l.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const K=l.configuration.event.value[0];if("number"!==typeof K)throw new Error("Event id should be a number");const Z=U.arrays.events[K],w=c[0];return w.config||(w.config={}),w.config.eventId=Z.eventId,w.config.eventData=Z.eventData,c}},"event/receive":{qJ:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(l,a){var N;if(!l.configuration)return W.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const U=l.configuration.event;if(!U)return W.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const c=U.value[0];if("number"!==typeof c)return W.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(N=a.events)||void 0===N?void 0:N[c])?{valid:!0}:(W.b.Error(`Event with id ${c} not found`),{valid:!1,error:`Event with id ${c} not found`})},extraProcessor(l,a,N,U,c){if("event/receive"!==a.op||!l.configuration||1!==Object.keys(l.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const K=l.configuration.event.value[0];if("number"!==typeof K)throw new Error("Event id should be a number");const Z=U.arrays.events[K],w=c[0];return w.config||(w.config={}),w.config.eventId=Z.eventId,w.config.eventData=Z.eventData,c}},"math/e":kN("FlowGraphEBlock"),"math/pi":kN("FlowGraphPIBlock"),"math/inf":kN("FlowGraphInfBlock"),"math/nan":kN("FlowGraphNaNBlock"),"math/abs":kN("FlowGraphAbsBlock"),"math/sign":kN("FlowGraphSignBlock"),"math/trunc":kN("FlowGraphTruncBlock"),"math/floor":kN("FlowGraphFloorBlock"),"math/ceil":kN("FlowGraphCeilBlock"),"math/round":{qJ:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c){var K;return(K=c[0]).config||(K.config={}),c[0].config.roundHalfAwayFromZero=!0,c}},"math/fract":kN("FlowGraphFractBlock"),"math/neg":kN("FlowGraphNegationBlock"),"math/add":kN("FlowGraphAddBlock",["a","b"],!0),"math/sub":kN("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{qJ:["FlowGraphMultiplyBlock"],extraProcessor(l,a,N,U,c){var K;(K=c[0]).config||(K.config={}),c[0].config.useMatrixPerComponent=!0,c[0].config.preventIntegerFloatArithmetic=!0;let Z=-1;return Object.keys(l.values||{}).find((a=>{var N;return void 0!==(null===(N=l.values)||void 0===N?void 0:N[a].type)&&(Z=l.values[a].type,!0)})),-1!==Z&&(c[0].config.type=U.arrays.types[Z].flowGraphType),c},validation:l=>l.values?QN(l):{valid:!0}},"math/div":kN("FlowGraphDivideBlock",["a","b"],!0),"math/rem":kN("FlowGraphModuloBlock",["a","b"]),"math/min":kN("FlowGraphMinBlock",["a","b"]),"math/max":kN("FlowGraphMaxBlock",["a","b"]),"math/clamp":kN("FlowGraphClampBlock",["a","b","c"]),"math/saturate":kN("FlowGraphSaturateBlock"),"math/mix":kN("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":kN("FlowGraphEqualityBlock",["a","b"]),"math/lt":kN("FlowGraphLessThanBlock",["a","b"]),"math/le":kN("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":kN("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":kN("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":kN("FlowGraphIsNaNBlock"),"math/isinf":kN("FlowGraphIsInfBlock"),"math/select":{qJ:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{qJ:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":kN("FlowGraphSinBlock"),"math/cos":kN("FlowGraphCosBlock"),"math/tan":kN("FlowGraphTanBlock"),"math/asin":kN("FlowGraphASinBlock"),"math/acos":kN("FlowGraphACosBlock"),"math/atan":kN("FlowGraphATanBlock"),"math/atan2":kN("FlowGraphATan2Block",["a","b"]),"math/sinh":kN("FlowGraphSinhBlock"),"math/cosh":kN("FlowGraphCoshBlock"),"math/tanh":kN("FlowGraphTanhBlock"),"math/asinh":kN("FlowGraphASinhBlock"),"math/acosh":kN("FlowGraphACoshBlock"),"math/atanh":kN("FlowGraphATanhBlock"),"math/exp":kN("FlowGraphExponentialBlock"),"math/log":kN("FlowGraphLogBlock"),"math/log2":kN("FlowGraphLog2Block"),"math/log10":kN("FlowGraphLog10Block"),"math/sqrt":kN("FlowGraphSquareRootBlock"),"math/cbrt":kN("FlowGraphCubeRootBlock"),"math/pow":kN("FlowGraphPowerBlock",["a","b"]),"math/length":kN("FlowGraphLengthBlock"),"math/normalize":kN("FlowGraphNormalizeBlock"),"math/dot":kN("FlowGraphDotBlock",["a","b"]),"math/cross":kN("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":kN("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":kN("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{qJ:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{qJ:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{qJ:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{qJ:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{qJ:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{qJ:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{qJ:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":kN("FlowGraphTransposeBlock"),"math/determinant":kN("FlowGraphDeterminantBlock"),"math/inverse":kN("FlowGraphInvertMatrixBlock"),"math/matmul":kN("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{qJ:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Oc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c,K){const Z=c[0].dataInputs.find((l=>"rotationQuaternion"===l.name));if(!Z)throw new Error("Rotation quaternion input not found");return K._connectionValues[Z.uniqueId]&&(K._connectionValues[Z.uniqueId].type="Quaternion"),c}},"math/matDecompose":{qJ:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Oc"}}}},"math/quatConjugate":kN("FlowGraphConjugateBlock",["a"]),"math/quatMul":{qJ:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c){var K;return(K=c[0]).config||(K.config={}),c[0].config.type="Quaternion",c}},"math/quatAngleBetween":kN("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{qJ:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":kN("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":kN("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{qJ:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c){var K;return(K=c[0]).config||(K.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract2x2":{qJ:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{qJ:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c){var K;return(K=c[0]).config||(K.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract3x3":{qJ:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{qJ:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c){var K;return(K=c[0]).config||(K.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract4x4":{qJ:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{qJ:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c,K){var Z,w;(w=c[0]).config||(w.config={});const S=c[0].dataInputs[0];return c[0].config.valueType=(null===(Z=K._connectionValues[S.uniqueId])||void 0===Z?void 0:Z.type)??"FlowGraphInteger",c}},"math/and":{qJ:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c,K){var Z,w,S;(S=c[0]).config||(S.config={});const T=c[0].dataInputs[0],J=c[0].dataInputs[1];return c[0].config.valueType=(null===(Z=K._connectionValues[T.uniqueId])||void 0===Z?void 0:Z.type)??(null===(w=K._connectionValues[J.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",c}},"math/or":{qJ:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c,K){var Z,w,S;(S=c[0]).config||(S.config={});const T=c[0].dataInputs[0],J=c[0].dataInputs[1];return c[0].config.valueType=(null===(Z=K._connectionValues[T.uniqueId])||void 0===Z?void 0:Z.type)??(null===(w=K._connectionValues[J.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",c}},"math/xor":{qJ:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(l,a,N,U,c,K){var Z,w,S;(S=c[0]).config||(S.config={});const T=c[0].dataInputs[0],J=c[0].dataInputs[1];return c[0].config.valueType=(null===(Z=K._connectionValues[T.uniqueId])||void 0===Z?void 0:Z.type)??(null===(w=K._connectionValues[J.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",c}},"math/asr":kN("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":kN("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":kN("FlowGraphLeadingZerosBlock"),"math/ctz":kN("FlowGraphTrailingZerosBlock"),"math/popcnt":kN("FlowGraphOneBitsCounterBlock"),"math/rad":kN("FlowGraphDegToRadBlock"),"math/deg":kN("FlowGraphRadToDegBlock"),"type/boolToInt":kN("FlowGraphBooleanToInt"),"type/boolToFloat":kN("FlowGraphBooleanToFloat"),"type/intToBool":kN("FlowGraphIntToBoolean"),"type/intToFloat":kN("FlowGraphIntToFloat"),"type/floatToInt":kN("FlowGraphFloatToInt"),"type/floatToBool":kN("FlowGraphFloatToBoolean"),"flow/sequence":{qJ:["FlowGraphSequenceBlock"],extraProcessor(l,a,N,U,c){const K=c[0];return K.config||(K.config={}),K.config.outputSignalCount=Object.keys(l.flows||[]).length,K.signalOutputs.forEach(((l,a)=>{l.name="out_"+a})),c}},"flow/branch":{qJ:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{qJ:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(l){if(l.configuration&&l.configuration.cases){const a=l.configuration.cases.value;if(!a.every((l=>"number"===typeof l&&/^-?\d+$/.test(l.toString()))))return W.b.Warn("Switch cases should be integers. Using empty array instead."),l.configuration.cases.value=[],{valid:!0};const N=new Set(a);l.configuration.cases.value=Array.from(N)}return{valid:!0}},extraProcessor(l,a,N,U,c){if("flow/switch"!==a.op||!l.flows||0===Object.keys(l.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return c[0].signalOutputs.forEach((l=>{"default"!==l.name&&(l.name="out_"+l.name)})),c}},"flow/while":{qJ:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{qJ:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(l,a,N,U,c){const K=c[0];return K.config||(K.config={}),K.config.incrementIndexWhenLoopDone=!0,c}},"flow/doN":{qJ:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{qJ:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(l,a,N,U,c){if("flow/multiGate"!==a.op||!l.flows||0===Object.keys(l.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const K=c[0];return K.config||(K.config={}),K.config.outputSignalCount=Object.keys(l.flows).length,K.signalOutputs.forEach(((l,a)=>{l.name="out_"+a})),c}},"flow/waitAll":{qJ:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(l){var a,N;return"number"!==typeof(null===(a=l.configuration)||void 0===a||null===(N=a.inputFlows)||void 0===N?void 0:N.value[0])&&(l.configuration=l.configuration||{inputFlows:{value:[0]}},l.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{qJ:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{qJ:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{qJ:["FlowGraphCancelDelayBlock"]},"variable/get":{qJ:["FlowGraphGetVariableBlock"],validation(l){var a,N;return null!==(a=l.configuration)&&void 0!==a&&null!==(N=a.variable)&&void 0!==N&&N.value?{valid:!0}:(W.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(l,a)=>[a.getVariableName(l[0])]}}},"variable/set":{qJ:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(l,a)=>[a.getVariableName(l[0])]}}},"variable/setMultiple":{qJ:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(l,a)=>[l[0].map((l=>a.getVariableName(l)))]}},extraProcessor:(l,a,N,U,c)=>(c[0].dataInputs.forEach((l=>{l.name=U.getVariableName(+l.name)})),c)},"variable/interpolate":{qJ:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(l,a)=>[a.getVariableName(l[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:l=>!0===l[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",CN:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",CN:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",CN:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",CN:"FlowGraphPlayAnimationBlock"},out:{name:"out",CN:"FlowGraphPlayAnimationBlock"},done:{name:"done",CN:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(l,a,N,U,c){var K,Z,w;const S=c[0],T=null===(K=l.configuration)||void 0===K?void 0:K.variable.value[0];if("number"!==typeof T)throw W.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const J=U.arrays.staticVariables[T];"undefined"===typeof S.config.animationType.value&&(U.arrays.staticVariables,S.config.animationType.value=(0,MN.H)(J.type));const n=c[4];return n.config||(n.config={}),(Z=n.config).variable||(Z.variable={}),n.config.variable.value=U.getVariableName(T),(w=c[3]).config||(w.config={}),c}},"pointer/get":{qJ:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",CN:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",CN:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(l,a,N,U,c)=>(c.forEach((l=>{"FlowGraphJsonPointerParserBlock"===l.className&&(l.config||(l.config={}),l.config.outputValue=!0)})),c)},"pointer/set":{qJ:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",CN:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",CN:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(l,a,N,U,c)=>(c.forEach((l=>{"FlowGraphJsonPointerParserBlock"===l.className&&(l.config||(l.config={}),l.config.outputValue=!0)})),c)},"pointer/interpolate":{qJ:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",CN:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",CN:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",CN:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",CN:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",CN:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",CN:"FlowGraphPlayAnimationBlock"},out:{name:"out",CN:"FlowGraphPlayAnimationBlock"},done:{name:"done",CN:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(l,a,N,U,c)=>(c.forEach((a=>{"FlowGraphJsonPointerParserBlock"===a.className?(a.config||(a.config={}),a.config.outputValue=!0):"FlowGraphInterpolationBlock"===a.className&&(a.config||(a.config={}),Object.keys(l.values||[]).forEach((N=>{var c;const K=null===(c=l.values)||void 0===c?void 0:c[N];if("value"===N&&K){const l=K.type;void 0!==l&&(a.config.animationType=U.arrays.types[l].flowGraphType)}})))})),c)},"animation/start":{qJ:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",CN:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(l,a)=>[l[0]*a._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(l,a)=>[l[0]*a._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(l,a,N,U,c,K,Z){const w=c[c.length-1];return w.config||(w.config={}),w.config.glTF=Z,c}},"animation/stop":{qJ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",CN:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(l,a,N,U,c,K,Z){const w=c[c.length-1];return w.config||(w.config={}),w.config.glTF=Z,c}},"animation/stopAt":{qJ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",CN:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(l,a)=>[l[0]*a._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(l,a,N,U,c,K,Z){const w=c[c.length-1];return w.config||(w.config={}),w.config.glTF=Z,c}},"math/switch":{qJ:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(l){if(l.configuration&&l.configuration.cases){const a=l.configuration.cases.value;if(!a.every((l=>"number"===typeof l&&/^-?\d+$/.test(l.toString()))))return W.b.Warn("Switch cases should be integers. Using empty array instead."),l.configuration.cases.value=[],{valid:!0};const N=new Set(a);l.configuration.cases.value=Array.from(N)}return{valid:!0}},extraProcessor(l,a,N,U,c){const K=c[0];return K.dataInputs.forEach((l=>{"default"!==l.name&&"case"!==l.name&&(l.name="in_"+l.name)})),K.config||(K.config={}),K.config.treatCasesAsIntegers=!0,c}},"debug/log":{qJ:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function kN(l){let a=arguments.length>2?arguments[2]:void 0;return{qJ:[l],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((l,a)=>(l[a]={name:a},l)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(l,N,U,c,K){var Z;if(a){(Z=K[0]).config||(Z.config={}),K[0].config.preventIntegerFloatArithmetic=!0;let a=-1;Object.keys(l.values||{}).find((N=>{var U;return void 0!==(null===(U=l.values)||void 0===U?void 0:U[N].type)&&(a=l.values[N].type,!0)})),-1!==a&&(K[0].config.type=c.arrays.types[a].flowGraphType)}return K},validation:l=>a?QN(l):{valid:!0}}}function QN(l){if(l.values){const a=Object.keys(l.values).map((a=>l.values[a].type)).filter((l=>void 0!==l));if(!a.every((l=>l===a[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}iN["math/compose"]=iN["math/matCompose"],iN["math/decompose"]=iN["math/matDecompose"];var jN=N(12403);const fN={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ua",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class pN{constructor(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=l,this._gltf=a,this._animationTargetFps=N,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const l of this._interactivityGraph.types)this._types.push(fN[l.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const l of this._interactivityGraph.declarations){const a=tN(l);if(!a)throw W.b.Error(["No mapping found for declaration",l]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:a,fullOperationName:l.extension?l.op+":"+l.extension:l.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const l of this._interactivityGraph.variables){const a=this._parseVariable(l);this._staticVariables.push(a)}}_parseVariable(l,a){const N=this._types[l.type];if(!N)throw W.b.Error(["No type found for variable",l]),new Error("Error parsing variables");if(l.value&&l.value.length!==N.length)throw W.b.Error(["Invalid value length for variable",l,N]),new Error("Error parsing variables");const U=l.value||[];if(!U.length)switch(N.flowGraphType){case"boolean":U.push(!1);break;case"FlowGraphInteger":U.push(0);break;case"number":U.push(NaN);break;case"Vector2":U.push(NaN,NaN);break;case"ua":U.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":U.fill(NaN,0,4);break;case"Matrix":U.fill(NaN,0,16);break;case"Matrix3D":U.fill(NaN,0,9)}return"number"===N.elementType&&"string"===typeof U[0]&&(U[0]=parseFloat(U[0])),{type:N.flowGraphType,value:a?a(U,this):U}}_parseEvents(){if(this._interactivityGraph.events)for(const l of this._interactivityGraph.events){const a={eventId:l.id||"internalEvent_"+this._internalEventsCounter++};l.values&&(a.eventData=Object.keys(l.values).map((a=>{var N;const U=null===(N=l.values)||void 0===N?void 0:N[a];if(!U)throw W.b.Error(["No value found for event key",a]),new Error("Error parsing events");const c=this._types[U.type];if(!c)throw W.b.Error(["No type found for event value",U]),new Error("Error parsing events");const K="undefined"!==typeof U.value?this._parseVariable(U):void 0;return{id:a,type:c.flowGraphType,eventData:!0,value:K}}))),this._events.push(a)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const a of this._interactivityGraph.nodes){if("number"!==typeof a.declaration)throw W.b.Error(["No declaration found for node",a]),new Error("Error parsing nodes");const N=this._mappings[a.declaration];if(!N)throw W.b.Error(["No mapping found for node",a]),new Error("Error parsing nodes");if(N.flowGraphMapping.validation){const U=N.flowGraphMapping.validation(a,this._interactivityGraph,this._gltf);var l;if(!U.valid)throw new Error(`Error validating interactivity node ${null===(l=this._interactivityGraph.declarations)||void 0===l?void 0:l[a.declaration].op} - ${U.error}`)}const U=[];for(const l of N.flowGraphMapping.qJ){const c=this._getEmptyBlock(l,N.fullOperationName);this._parseNodeConfiguration(a,c,N.flowGraphMapping,l),U.push(c)}this._nodes.push({qJ:U,fullOperationName:N.fullOperationName})}}_getEmptyBlock(l,a){return{uniqueId:(0,jN.b)(),className:l,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:a,metadata:{}}}_parseNodeConfiguration(l,a,N,U){const c=a.config;if(l.configuration){const a=Object.keys(l.configuration);for(const w of a){var K,Z;const a=null===(K=l.configuration)||void 0===K?void 0:K[w];if(!a)throw W.b.Error(["No value found for node configuration",w]),new Error("Error parsing node configuration");const S=null===(Z=N.configuration)||void 0===Z?void 0:Z[w];if(S&&S.CN?S.CN===U:0===N.qJ.indexOf(U)){const l=(null===S||void 0===S?void 0:S.name)||w;a&&"undefined"!==typeof a.value||"undefined"===typeof(null===S||void 0===S?void 0:S.defaultValue)?a.value.length>=0?c[l]={value:1===a.value.length?a.value[0]:a.value}:W.b.Warn(["Invalid value for node configuration",a]):c[l]={value:S.defaultValue},S&&S.dataTransformer&&(c[l].value=S.dataTransformer([c[l].value],this)[0])}}}}_parseNodeConnections(l){for(let q=0;q<this._nodes.length;q++){var a;const b=null===(a=this._interactivityGraph.nodes)||void 0===a?void 0:a[q];if(!b)throw W.b.Error(["No node found for interactivity node",this._nodes[q]]),new Error("Error parsing node connections");const z=this._nodes[q],I=this._mappings[b.declaration];if(!I)throw W.b.Error(["No mapping found for node",b]),new Error("Error parsing node connections");const t=b.flows||{},O=Object.keys(t).sort();for(const l of O){var N,U,c,K;const a=t[l],T=null===(N=I.flowGraphMapping.outputs)||void 0===N||null===(U=N.flows)||void 0===U?void 0:U[l],J=(null===T||void 0===T?void 0:T.name)||l,n=this._createNewSocketConnection(J,!0);(T&&T.CN&&z.qJ.find((l=>l.className===T.CN))||z.qJ[0]).signalOutputs.push(n);const y=a.node,H=this._nodes[y];if(!H)throw W.b.Error(["No node found for input node id",y]),new Error("Error parsing node connections");const u=IN(H.fullOperationName);if(!u)throw W.b.Error(["No mapping found for input node",H]),new Error("Error parsing node connections");let B=null===(c=u.inputs)||void 0===c||null===(K=c.flows)||void 0===K?void 0:K[a.socket||"in"],Y=!1;if(!B)for(const l in null===(Z=u.inputs)||void 0===Z?void 0:Z.flows){var Z,w,S;if(l.startsWith("[")&&l.endsWith("]"))Y=!0,B=null===(w=u.inputs)||void 0===w||null===(S=w.flows)||void 0===S?void 0:S[l]}const C=B?Y?B.name.replace("$1",a.socket||""):B.name:a.socket||"in",M=B&&B.CN&&H.qJ.find((l=>l.className===B.CN))||H.qJ[0];let A=M.signalInputs.find((l=>l.name===C));A||(A=this._createNewSocketConnection(C),M.signalInputs.push(A)),A.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(A.uniqueId)}const h=b.values||{},i=Object.keys(h);for(const a of i){var T,J;const N=h[a];let U=null===(T=I.flowGraphMapping.inputs)||void 0===T||null===(J=T.values)||void 0===J?void 0:J[a],c=!1;if(!U)for(const l in null===(n=I.flowGraphMapping.inputs)||void 0===n?void 0:n.values){var n,y,H;if(l.startsWith("[")&&l.endsWith("]"))c=!0,U=null===(y=I.flowGraphMapping.inputs)||void 0===y||null===(H=y.values)||void 0===H?void 0:H[l]}const K=U?c?U.name.replace("$1",a):U.name:a,Z=this._createNewSocketConnection(K);if((U&&U.CN&&z.qJ.find((l=>l.className===U.CN))||z.qJ[0]).dataInputs.push(Z),void 0!==N.value){const a=this._parseVariable(N,U&&U.dataTransformer);l._connectionValues[Z.uniqueId]=a}else{if("undefined"===typeof N.node)throw W.b.Error(["Invalid value for value connection",N]),new Error("Error parsing node connections");{var u,B,Y;const l=N.node,a=N.socket||"value",U=this._nodes[l];if(!U)throw W.b.Error(["No node found for output socket reference",N]),new Error("Error parsing node connections");const c=IN(U.fullOperationName);if(!c)throw W.b.Error(["No mapping found for output socket reference",N]),new Error("Error parsing node connections");let K=null===(u=c.outputs)||void 0===u||null===(B=u.values)||void 0===B?void 0:B[a],w=!1;if(!K)for(const N in null===(C=c.outputs)||void 0===C?void 0:C.values){var C,M,A;if(N.startsWith("[")&&N.endsWith("]"))w=!0,K=null===(M=c.outputs)||void 0===M||null===(A=M.values)||void 0===A?void 0:A[N]}const S=K?w?K.name.replace("$1",a):null===(Y=K)||void 0===Y?void 0:Y.name:a,T=K&&K.CN&&U.qJ.find((l=>l.className===K.CN))||U.qJ[0];let J=T.dataOutputs.find((l=>l.name===S));J||(J=this._createNewSocketConnection(S,!0),T.dataOutputs.push(J)),Z.connectedPointIds.push(J.uniqueId),J.connectedPointIds.push(Z.uniqueId)}}}if(I.flowGraphMapping.interBlockConnectors)for(const l of I.flowGraphMapping.interBlockConnectors){const a=l.input,N=l.output,U=l.isVariable;this._connectFlowGraphNodes(a,N,z.qJ[l.inputBlockIndex],z.qJ[l.outputBlockIndex],U)}if(I.flowGraphMapping.extraProcessor){var E;const a=null===(E=this._interactivityGraph.declarations)||void 0===E?void 0:E[b.declaration];if(!a)throw W.b.Error(["No declaration found for extra processor",b]),new Error("Error parsing node connections");z.qJ=I.flowGraphMapping.extraProcessor(b,a,I.flowGraphMapping,this,z.qJ,l,this._gltf)}}}_createNewSocketConnection(l,a){return{uniqueId:(0,jN.b)(),name:l,_connectionType:a?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(l,a,N,U,c){const K=c?N.dataInputs:N.signalInputs,Z=c?U.dataOutputs:U.signalOutputs,w=K.find((a=>a.name===l))||this._createNewSocketConnection(l),S=Z.find((l=>l.name===a))||this._createNewSocketConnection(a,!0);K.find((a=>a.name===l))||K.push(w),Z.find((l=>l.name===a))||Z.push(S),w.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(w.uniqueId)}getVariableName(l){return"staticVariable_"+l}serializeToFlowGraph(){const l={uniqueId:(0,jN.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(l);for(let a=0;a<this._staticVariables.length;a++){const N=this._staticVariables[a];l._userVariables[this.getVariableName(a)]=N}return{rightHanded:!0,allBlocks:this._nodes.reduce(((l,a)=>l.concat(a.qJ)),[]),executionContexts:[l]}}}const RN="KHR_interactivity";class LN{constructor(l){this._loader=l,this.name=RN,this.enabled=this._loader.isExtensionUsed(RN),this._pathConverter=(0,r.f)(this._loader.Hc),l._skipStartAnimationStep=!0;const a=l.babylonScene;a&&function(l){(0,r.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!l.activeCamera)return new c.Quaternion(NaN,NaN,NaN,NaN);const a=c.Quaternion.FromRotationMatrix(l.activeCamera.getWorldMatrix()).normalize();return l.useRightHandedSystem||(a.w*=-1,a.x*=-1),a},type:"Quaternion",getTarget:()=>l.activeCamera}),(0,r.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!l.activeCamera)return new c.ua(NaN,NaN,NaN);const a=l.activeCamera.getWorldMatrix().getTranslation();return l.useRightHandedSystem||(a.x*=-1),a},type:"ua",getTarget:()=>l.activeCamera}),(0,r.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:l=>{var a;return(null===(a=l._babylonAnimationGroup)||void 0===a?void 0:a.isPlaying)??!1},type:"boolean",getTarget:l=>l._babylonAnimationGroup}),(0,r.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:l=>{var a;return((null===(a=l._babylonAnimationGroup)||void 0===a?void 0:a.from)??0)/60},type:"number",getTarget:l=>l._babylonAnimationGroup}),(0,r.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:l=>{var a;return((null===(a=l._babylonAnimationGroup)||void 0===a?void 0:a.to)??0)/60},type:"number",getTarget:l=>l._babylonAnimationGroup}),(0,r.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:l=>{var a;return((null===(a=l._babylonAnimationGroup)||void 0===a?void 0:a.getCurrentFrame())??0)/60},type:"number",getTarget:l=>l._babylonAnimationGroup}),(0,r.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:l=>{var a;return((null===(a=l._babylonAnimationGroup)||void 0===a?void 0:a.getCurrentFrame())??0)/60},type:"number",getTarget:l=>l._babylonAnimationGroup})}(a)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var l;if(!this._loader.babylonScene||!this._pathConverter)return;const a=this._loader.babylonScene,N=null===(l=this._loader.Hc.extensions)||void 0===l?void 0:l.KHR_interactivity;if(!N)return;const U=new uN.b({Ba:a});U.dispatchEventsSynchronously=!1;const c=N.graphs.map((l=>new pN(l,this._loader.Hc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(c.map((async l=>await qN(l,{coordinator:U,pathConverter:this._pathConverter})))),U.start()}}var rN;rN=async()=>(await Promise.resolve().then(N.bind(N,14203))).FlowGraphGLTFDataProvider,WN[`${RN}/${"FlowGraphGLTFDataProvider"}`]=rN,L(RN),R(RN,!0,(l=>new LN(l)));const XN="KHR_node_visibility";(0,r.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:l=>{const a=l._babylonTransformNode;return!a||void 0===a.isVisible||a.isVisible},set:(l,a)=>{var N,U;null===(N=a._primitiveBabylonMeshes)||void 0===N||N.forEach((l=>{l.inheritVisibility=!0})),a._babylonTransformNode&&(a._babylonTransformNode.isVisible=l),null===(U=a._primitiveBabylonMeshes)||void 0===U||U.forEach((a=>{a.isVisible=l}))},getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class PN{constructor(l){this.name=XN,this._loader=l,this.enabled=l.isExtensionUsed(XN)}async onReady(){var l;null===(l=this._loader.Hc.nodes)||void 0===l||l.forEach((l=>{var a,N,U,c;(null===(a=l._primitiveBabylonMeshes)||void 0===a||a.forEach((l=>{l.inheritVisibility=!0})),null!==(N=l.extensions)&&void 0!==N&&N.KHR_node_visibility)&&(!1===(null===(U=l.extensions)||void 0===U?void 0:U.KHR_node_visibility.visible)&&(l._babylonTransformNode&&(l._babylonTransformNode.isVisible=!1),null===(c=l._primitiveBabylonMeshes)||void 0===c||c.forEach((l=>{l.isVisible=!1}))))}))}dispose(){this._loader=null}}L(XN),R(XN,!0,(l=>new PN(l)));const dN="KHR_node_selectability";ON("event/onSelect",dN,{qJ:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",CN:"FlowGraphGetVariableBlock",dataTransformer:l=>["pickedMesh_"+l[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",CN:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(l,a,N,U,c,K,Z){var w,S,T,J,n,y;const H=c[c.length-1];H.config=H.config||{},H.config.glTF=Z;const u=null===(w=l.configuration)||void 0===w||null===(S=w.nodeIndex)||void 0===S?void 0:S.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const W="pickedMesh_"+u;return c[1].config.variable=W,K._userVariables[W]={className:"Mesh",id:null===Z||void 0===Z||null===(T=Z.nodes)||void 0===T||null===(J=T[u]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===Z||void 0===Z||null===(n=Z.nodes)||void 0===n||null===(y=n[u]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},c}}),(0,r.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:l=>{const a=l._babylonTransformNode;return!a||void 0===a.mT||a.mT},set:(l,a)=>{var N;null===(N=a._primitiveBabylonMeshes)||void 0===N||N.forEach((a=>{a.mT=l}))},getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"mT"],type:"boolean"});class FN{constructor(l){this.name=dN,this._loader=l,this.enabled=l.isExtensionUsed(dN)}async onReady(){var l;null===(l=this._loader.Hc.nodes)||void 0===l||l.forEach((l=>{var a,N,U;null!==(a=l.extensions)&&void 0!==a&&a.KHR_node_selectability&&!1===(null===(N=l.extensions)||void 0===N?void 0:N.KHR_node_selectability.selectable)&&(null===(U=l._babylonTransformNode)||void 0===U||U.getChildMeshes().forEach((l=>{l.mT=!1})))}))}dispose(){this._loader=null}}L(dN),R(dN,!0,(l=>new FN(l)));const eN="KHR_node_hoverability",sN="targetMeshPointerOver_";ON("event/onHoverIn",eN,{qJ:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",CN:"FlowGraphGetVariableBlock",dataTransformer:l=>[sN+l[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",CN:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(l,a,N,U,c,K,Z){var w,S,T,J,n,y;const H=c[c.length-1];H.config=H.config||{},H.config.glTF=Z;const u=null===(w=l.configuration)||void 0===w||null===(S=w.nodeIndex)||void 0===S?void 0:S.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const W=sN+u;return c[1].config.variable=W,K._userVariables[W]={className:"Mesh",id:null===Z||void 0===Z||null===(T=Z.nodes)||void 0===T||null===(J=T[u]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===Z||void 0===Z||null===(n=Z.nodes)||void 0===n||null===(y=n[u]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},c}});const oN="targetMeshPointerOut_";ON("event/onHoverOut",eN,{qJ:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",CN:"FlowGraphGetVariableBlock",dataTransformer:l=>[oN+l[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",CN:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(l,a,N,U,c,K,Z){var w,S,T,J,n,y;const H=c[c.length-1];H.config=H.config||{},H.config.glTF=Z;const u=null===(w=l.configuration)||void 0===w||null===(S=w.nodeIndex)||void 0===S?void 0:S.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const W=oN+u;return c[1].config.variable=W,K._userVariables[W]={className:"Mesh",id:null===Z||void 0===Z||null===(T=Z.nodes)||void 0===T||null===(J=T[u]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===Z||void 0===Z||null===(n=Z.nodes)||void 0===n||null===(y=n[u]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},c}}),(0,r.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:l=>{const a=l._babylonTransformNode;return!a||void 0===a.pointerOverDisableMeshTesting||a.pointerOverDisableMeshTesting},set:(l,a)=>{var N;null===(N=a._primitiveBabylonMeshes)||void 0===N||N.forEach((a=>{a.pointerOverDisableMeshTesting=!l}))},getTarget:l=>l._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class GN{constructor(l){this.name=eN,this._loader=l,this.enabled=l.isExtensionUsed(eN)}async onReady(){var l;null===(l=this._loader.Hc.nodes)||void 0===l||l.forEach((l=>{var a,N,U;null!==(a=l.extensions)&&void 0!==a&&a.KHR_node_hoverability&&!1===(null===(N=l.extensions)||void 0===N?void 0:N.KHR_node_hoverability.hoverable)&&(null===(U=l._babylonTransformNode)||void 0===U||U.getChildMeshes().forEach((l=>{l.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}L(eN),R(eN,!0,(l=>new GN(l)));const mU="ExtrasAsMetadata";class xN{_assignExtras(l,a){if(a.extras&&Object.keys(a.extras).length>0){const N=l.metadata=l.metadata||{};(N.Hc=N.Hc||{}).extras=a.extras}}constructor(l){this.name=mU,this.enabled=!0,this._loader=l}dispose(){this._loader=null}loadNodeAsync(l,a,N){return this._loader.loadNodeAsync(l,a,(l=>{this._assignExtras(l,a),N(l)}))}loadCameraAsync(l,a,N){return this._loader.loadCameraAsync(l,a,(l=>{this._assignExtras(l,a),N(l)}))}createMaterial(l,a,N){const U=this._loader.createMaterial(l,a,N);return this._assignExtras(U,a),U}}L(mU),R(mU,!1,(l=>new xN(l)));N(14203)},14072:(l,a,N)=>{"use strict";N.d(a,{e:()=>Q,i:()=>I,m:()=>z,n:()=>t});var U=N(12260),c=N(12254),K=N(13692),Z=N(12883),w=N(12855),S=N(12868),T=N(12268),J=N(12296),n=N(12878),y=N(12966),H=N(12885),u=N(12473);class W{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.wy=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.mH=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(l){this._environmentTexture=l}getNodes(){let l=[];l=l.concat(this.meshes),l=l.concat(this.lights),l=l.concat(this.cameras),l=l.concat(this.transformNodes);for(const a of this.skeletons)l=l.concat(a.bones);return l}}class B extends W{}class Y{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const l=this.rootNodes;for(const U of l)U.dispose();l.length=0;const a=this.skeletons;for(const U of a)U.dispose();a.length=0;const N=this.animationGroups;for(const U of N)U.dispose();N.length=0}}class C extends W{constructor(l){super(),this._wasAddedToScene=!1,(l=l||J.e.LastCreatedScene)&&(this.Ba=l,this.proceduralTextures=[],l.Tc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=l.getEngine().onContextRestoredObservable.add((()=>{for(const l of this.geometries)l._rebuild();for(const l of this.meshes)l._rebuild();for(const l of this.wy)l.rebuild();for(const l of this.textures)l._rebuild()})))}_topologicalSort(l){const a=new Map;for(const Z of l)a.set(Z.uniqueId,Z);const N={dependsOn:new Map,dependedBy:new Map};for(const Z of l){const l=Z.uniqueId;N.dependsOn.set(l,new Set),N.dependedBy.set(l,new Set)}for(const Z of l){const l=Z.uniqueId,U=N.dependsOn.get(l);if(Z instanceof n.d){const c=Z.sourceMesh;a.has(c.uniqueId)&&(U.add(c.uniqueId),N.dependedBy.get(c.uniqueId).add(l))}const c=N.dependedBy.get(l);for(const K of Z.getDescendants()){const U=K.uniqueId;if(a.has(U)){c.add(U);N.dependsOn.get(U).add(l)}}}const U=[],c=[];for(const Z of l){const l=Z.uniqueId;0===N.dependsOn.get(l).size&&(c.push(Z),a.delete(l))}const K=c;for(;K.length>0;){const l=K.shift();U.push(l);const c=N.dependedBy.get(l.uniqueId);for(const U of Array.from(c.values())){const c=N.dependsOn.get(U);c.delete(l.uniqueId),0===c.size&&a.get(U)&&(K.push(a.get(U)),a.delete(U))}}return a.size>0&&(T.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),a.forEach((l=>{T.b.Error(l.name)}))),U}_addNodeAndDescendantsToList(l,a,N,U){if(N&&(!U||U(N))&&!a.has(N.uniqueId)){l.push(N),a.add(N.uniqueId);for(const c of N.getDescendants(!0))this._addNodeAndDescendantsToList(l,a,c,U)}}_isNodeInContainer(l){return l instanceof S.b&&-1!==this.meshes.indexOf(l)||(l instanceof w.e&&-1!==this.transformNodes.indexOf(l)||(l instanceof y.c&&-1!==this.lights.indexOf(l)||l instanceof H.e&&-1!==this.cameras.indexOf(l)))}_isValidHierarchy(){for(const l of this.meshes)if(l.parent&&!this._isNodeInContainer(l.parent))return T.b.Warn(`Node ${l.name} has a parent that is not in the container.`),!1;for(const l of this.transformNodes)if(l.parent&&!this._isNodeInContainer(l.parent))return T.b.Warn(`Node ${l.name} has a parent that is not in the container.`),!1;for(const l of this.lights)if(l.parent&&!this._isNodeInContainer(l.parent))return T.b.Warn(`Node ${l.name} has a parent that is not in the container.`),!1;for(const l of this.cameras)if(l.parent&&!this._isNodeInContainer(l.parent))return T.b.Warn(`Node ${l.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const U={},K={},w=new Y,S=[],T=[],J={doNotInstantiate:!0,...N},n=[],y=new Set;for(const c of this.transformNodes)null===c.parent&&this._addNodeAndDescendantsToList(n,y,c,J.predicate);for(const c of this.meshes)null===c.parent&&this._addNodeAndDescendantsToList(n,y,c,J.predicate);const H=this._topologicalSort(n),u=(N,c)=>{if(((a,N)=>{if(U[a.uniqueId]=N.uniqueId,K[N.uniqueId]=N,l&&(N.name=l(a.name)),N instanceof Z.d){const l=N;if(l.morphTargetManager){const N=a.morphTargetManager;l.morphTargetManager=N.clone();for(let a=0;a<N.numTargets;a++){const c=N.getTarget(a),Z=l.morphTargetManager.getTarget(a);U[c.uniqueId]=Z.uniqueId,K[Z.uniqueId]=Z}}}})(N,c),N.parent){const l=U[N.parent.uniqueId],a=K[l];c.parent=a||N.parent}if(c.position&&N.position&&c.position.K(N.position),c.rotationQuaternion&&N.rotationQuaternion&&c.rotationQuaternion.K(N.rotationQuaternion),c.rotation&&N.rotation&&c.rotation.K(N.rotation),c.Oc&&N.Oc&&c.Oc.K(N.Oc),c.material){const Z=c;if(Z.material)if(a){const a=N.material;if(-1===T.indexOf(a)){let N=a.clone(l?l(a.name):"Clone of "+a.name);if(T.push(a),U[a.uniqueId]=N.uniqueId,K[N.uniqueId]=N,"MultiMaterial"===a.getClassName()){const c=a;for(const a of c.jc)a&&(N=a.clone(l?l(a.name):"Clone of "+a.name),T.push(a),U[a.uniqueId]=N.uniqueId,K[N.uniqueId]=N);c.jc=c.jc.map((l=>l&&K[U[l.uniqueId]]))}}"InstancedMesh"!==Z.getClassName()&&(Z.material=K[U[a.uniqueId]])}else"MultiMaterial"===Z.material.getClassName()?-1===this.Ba.multiMaterials.indexOf(Z.material)&&this.Ba.addMultiMaterial(Z.material):-1===this.Ba.materials.indexOf(Z.material)&&this.Ba.addMaterial(Z.material)}null===c.parent&&w.rootNodes.push(c)};for(const c of H)if("InstancedMesh"===c.getClassName()){const l=c,a=l.sourceMesh,N=U[a.uniqueId];u(l,("number"===typeof N?K[N]:a).createInstance(l.name))}else{let l=!0;"Fc"===c.getClassName()||"Node"===c.getClassName()||c.skeleton||!c.getTotalVertices||0===c.getTotalVertices()?l=!1:J.doNotInstantiate&&(l="function"===typeof J.doNotInstantiate?!J.doNotInstantiate(c):!J.doNotInstantiate);const a=l?c.createInstance(`instance of ${c.name}`):c.clone(`Clone of ${c.name}`,null,!0);if(!a)throw new Error(`Could not clone or instantiate node on Asset Container ${c.name}`);u(c,a)}for(const c of this.skeletons){if(J.predicate&&!J.predicate(c))continue;const a=c.clone(l?l(c.name):"Clone of "+c.name);for(const l of this.meshes)if(l.skeleton===c&&!l.isAnInstance){const N=K[U[l.uniqueId]];if(!N||N.isAnInstance)continue;if(N.skeleton=a,-1!==S.indexOf(a))continue;S.push(a);for(const l of a.bones)l._linkedTransformNode&&(l._linkedTransformNode=K[U[l._linkedTransformNode.uniqueId]])}w.skeletons.push(a)}for(const c of this.animationGroups){if(J.predicate&&!J.predicate(c))continue;const a=c.clone(l?l(c.name):"Clone of "+c.name,(l=>K[U[l.uniqueId]]||l));w.animationGroups.push(a)}return w}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Ba.environmentTexture=this.environmentTexture);for(const l of this.Ba._serializableComponents)l.addFromContainer(this);this.Ba.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const a=[];for(const N of this.cameras)l&&!l(N)||(this.Ba.addCamera(N),a.push(N));for(const N of this.lights)l&&!l(N)||(this.Ba.addLight(N),a.push(N));for(const N of this.meshes)l&&!l(N)||(this.Ba.JJ(N),a.push(N));for(const N of this.skeletons)l&&!l(N)||this.Ba.addSkeleton(N);for(const N of this.animations)l&&!l(N)||this.Ba.addAnimation(N);for(const N of this.animationGroups)l&&!l(N)||this.Ba.addAnimationGroup(N);for(const N of this.multiMaterials)l&&!l(N)||this.Ba.addMultiMaterial(N);for(const N of this.materials)l&&!l(N)||this.Ba.addMaterial(N);for(const N of this.morphTargetManagers)l&&!l(N)||this.Ba.addMorphTargetManager(N);for(const N of this.geometries)l&&!l(N)||this.Ba.addGeometry(N);for(const N of this.transformNodes)l&&!l(N)||(this.Ba.addTransformNode(N),a.push(N));for(const N of this.actionManagers)l&&!l(N)||this.Ba.addActionManager(N);for(const N of this.textures)l&&!l(N)||this.Ba.addTexture(N);for(const N of this.reflectionProbes)l&&!l(N)||this.Ba.addReflectionProbe(N);for(const N of a)N.parent&&-1===this.Ba.getNodes().indexOf(N.parent)&&(N.setParent?N.setParent(null):N.parent=null)}removeAllFromScene(){this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Ba.environmentTexture&&(this.Ba.environmentTexture=null);for(const l of this.Ba._serializableComponents)l.removeFromContainer(this)}removeFromScene(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const a of this.cameras)l&&!l(a)||this.Ba.removeCamera(a);for(const a of this.lights)l&&!l(a)||this.Ba.removeLight(a);for(const a of this.meshes)l&&!l(a)||this.Ba.TJ(a,!0);for(const a of this.skeletons)l&&!l(a)||this.Ba.removeSkeleton(a);for(const a of this.animations)l&&!l(a)||this.Ba.removeAnimation(a);for(const a of this.animationGroups)l&&!l(a)||this.Ba.removeAnimationGroup(a);for(const a of this.multiMaterials)l&&!l(a)||this.Ba.removeMultiMaterial(a);for(const a of this.materials)l&&!l(a)||this.Ba.removeMaterial(a);for(const a of this.morphTargetManagers)l&&!l(a)||this.Ba.removeMorphTargetManager(a);for(const a of this.geometries)l&&!l(a)||this.Ba.removeGeometry(a);for(const a of this.transformNodes)l&&!l(a)||this.Ba.removeTransformNode(a);for(const a of this.actionManagers)l&&!l(a)||this.Ba.removeActionManager(a);for(const a of this.textures)l&&!l(a)||this.Ba.removeTexture(a);for(const a of this.reflectionProbes)l&&!l(a)||this.Ba.removeReflectionProbe(a)}dispose(){const l=this.cameras.slice(0);for(const H of l)H.dispose();this.cameras.length=0;const a=this.lights.slice(0);for(const H of a)H.dispose();this.lights.length=0;const N=this.meshes.slice(0);for(const H of N)H.dispose();this.meshes.length=0;const U=this.skeletons.slice(0);for(const H of U)H.dispose();this.skeletons.length=0;const c=this.animationGroups.slice(0);for(const H of c)H.dispose();this.animationGroups.length=0;const K=this.multiMaterials.slice(0);for(const H of K)H.dispose();this.multiMaterials.length=0;const Z=this.materials.slice(0);for(const H of Z)H.dispose();this.materials.length=0;const w=this.geometries.slice(0);for(const H of w)H.dispose();this.geometries.length=0;const S=this.transformNodes.slice(0);for(const H of S)H.dispose();this.transformNodes.length=0;const T=this.actionManagers.slice(0);for(const H of T)H.dispose();this.actionManagers.length=0;const J=this.textures.slice(0);for(const H of J)H.dispose();this.textures.length=0;const n=this.reflectionProbes.slice(0);for(const H of n)H.dispose();this.reflectionProbes.length=0;const y=this.morphTargetManagers.slice(0);for(const H of y)H.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const H of this.Ba._serializableComponents)H.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Ba.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(l,a,N){if(l&&a)for(const U of l){let l=!0;if(N)for(const a of N)if(U===a){l=!1;break}l&&(a.push(U),U._parentContainer=this)}}moveAllFromScene(l){this._wasAddedToScene=!1,void 0===l&&(l=new B);for(const a in this)Object.prototype.hasOwnProperty.call(this,a)&&(this[a]=this[a]||("_environmentTexture"===a?null:[]),this._moveAssets(this.Ba[a],this[a],l[a]));this.environmentTexture=this.Ba.environmentTexture,this.removeAllFromScene()}createRootMesh(){const l=new Z.d("assetContainerRootMesh",this.Ba);for(const a of this.meshes)a.parent||l.addChild(a);return this.meshes.unshift(l),l}mergeAnimationsTo(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.e.LastCreatedScene,a=arguments.length>1?arguments[1]:void 0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!l)return T.b.Error("No scene available to merge animations to"),[];const U=N||(a=>{let N=null;const U=a.animations.length?a.animations[0].targetProperty:"",c=a.name.split(".").join("").split("_primitive")[0];switch(U){case"position":case"rotationQuaternion":N=l.getTransformNodeByName(a.name)||l.getTransformNodeByName(c);break;case"influence":N=l.getMorphTargetByName(a.name)||l.getMorphTargetByName(c);break;default:N=l.getNodeByName(a.name)||l.getNodeByName(c)}return N}),c=this.getNodes();for(const w of c){const l=U(w);if(null!==l){for(const a of w.animations){const N=l.animations.filter((l=>l.targetProperty===a.targetProperty));for(const a of N){const N=l.animations.indexOf(a,0);N>-1&&l.animations.splice(N,1)}}l.animations=l.animations.concat(w.animations)}}const K=[],Z=this.animationGroups.slice();for(const w of Z){K.push(w.clone(w.name,U));for(const l of w.animatables)l.stop()}for(const w of a){const a=U(w.target);a&&(l.beginAnimation(a,w.fromFrame,w.toFrame,w.loopAnimation,w.speedRatio,w.onAnimationEnd?w.onAnimationEnd:void 0,void 0,!0,void 0,w.onAnimationLoop?w.onAnimationLoop:void 0),l.stopAnimation(w.target))}return K}populateRootNodes(){this.rootNodes.length=0;for(const l of this.meshes)l.parent||-1!==this.rootNodes.indexOf(l)||this.rootNodes.push(l);for(const l of this.transformNodes)l.parent||-1!==this.rootNodes.indexOf(l)||this.rootNodes.push(l);for(const l of this.lights)l.parent||-1!==this.rootNodes.indexOf(l)||this.rootNodes.push(l);for(const l of this.cameras)l.parent||-1!==this.rootNodes.indexOf(l)||this.rootNodes.push(l)}addAllAssetsToContainer(l){if(!l)return;const a=[],N=new Set;for(a.push(l);a.length>0;){const l=a.pop();if(l instanceof Z.d?(l.bc&&-1===this.geometries.indexOf(l.bc)&&this.geometries.push(l.bc),this.meshes.push(l)):l instanceof n.d?this.meshes.push(l):l instanceof w.e?this.transformNodes.push(l):l instanceof y.c?this.lights.push(l):l instanceof H.e&&this.cameras.push(l),l instanceof S.b){if(l.material&&-1===this.materials.indexOf(l.material)){this.materials.push(l.material);for(const a of l.material.getActiveTextures())-1===this.textures.indexOf(a)&&this.textures.push(a)}l.skeleton&&-1===this.skeletons.indexOf(l.skeleton)&&this.skeletons.push(l.skeleton),l.morphTargetManager&&-1===this.morphTargetManagers.indexOf(l.morphTargetManager)&&this.morphTargetManagers.push(l.morphTargetManager)}for(const U of l.getChildren())N.has(U)||a.push(U);N.add(l)}this.populateRootNodes()}_getByTags(l,a,N){if(void 0===a)return l;const U=[];for(const c in l){const K=l[c];u.d&&u.d.MatchesQuery(K,a)&&(!N||N(K))&&U.push(K)}return U}getMeshesByTags(l,a){return this._getByTags(this.meshes,l,a)}getCamerasByTags(l,a){return this._getByTags(this.cameras,l,a)}getLightsByTags(l,a){return this._getByTags(this.lights,l,a)}getMaterialsByTags(l,a){return this._getByTags(this.materials,l,a).concat(this._getByTags(this.multiMaterials,l,a))}getTransformNodesByTags(l,a){return this._getByTags(this.transformNodes,l,a)}}var M=N(12305);class A{constructor(l){this.byteOffset=0,this.buffer=l}async loadAsync(l){const a=await this.buffer.readAsync(this.byteOffset,l);this._dataView=new DataView(a.buffer,a.byteOffset,a.byteLength),this._dataByteOffset=0}readUint32(){const l=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,l}readUint8Array(l){const a=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,l);return this._dataByteOffset+=l,this.byteOffset+=l,a}readString(l){return(0,M.g)(this.readUint8Array(l))}skipBytes(l){this._dataByteOffset+=l,this.byteOffset+=l}}var E=N(14078);const q="Z2xURg",b={name:"Hc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:l=>-1!==l.indexOf("asset")&&-1!==l.indexOf("version")||l.startsWith("data:base64,"+q)||l.startsWith("data:;base64,"+q)||l.startsWith("data:application/octet-stream;base64,"+q)||l.startsWith("data:model/gltf-binary;base64,"+q)};var z,I,t,O=N(12298),h=N(12301);function i(l,a,N){try{return Promise.resolve(new Uint8Array(l,a,N))}catch(U){return Promise.reject(U)}}!function(l){l[l.AUTO=0]="AUTO",l[l.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(z||(z={})),function(l){l[l.NONE=0]="NONE",l[l.FIRST=1]="FIRST",l[l.ALL=2]="ALL"}(I||(I={})),function(l){l[l.LOADING=0]="LOADING",l[l.READY=1]="READY",l[l.COMPLETE=2]="COMPLETE"}(t||(t={}));class k{constructor(){this.coordinateSystemMode=z.AUTO,this.animationStartMode=I.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=l=>Promise.resolve(l),this.extensionOptions={}}K(l){l&&(this.onParsed=l.onParsed,this.coordinateSystemMode=l.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=l.animationStartMode??this.animationStartMode,this.loadNodeAnimations=l.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=l.loadSkins??this.loadSkins,this.loadMorphTargets=l.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=l.compileMaterials??this.compileMaterials,this.useClipPlane=l.useClipPlane??this.useClipPlane,this.compileShadowGenerators=l.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=l.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=l.useRangeRequests??this.useRangeRequests,this.createInstances=l.createInstances??this.createInstances,this.alwaysComputeBoundingBox=l.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=l.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=l.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=l.skipMaterials??this.skipMaterials,this.useSRGBBuffers=l.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=l.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=l.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=l.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=l.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=l.customRootNode,this.onMeshLoaded=l.onMeshLoaded,this.onSkinLoaded=l.onSkinLoaded,this.onTextureLoaded=l.onTextureLoaded,this.onMaterialLoaded=l.onMaterialLoaded,this.onCameraLoaded=l.onCameraLoaded,this.extensionOptions=l.extensionOptions??this.extensionOptions)}}class Q extends k{constructor(l){super(),this.onParsedObservable=new U.e,this.onMeshLoadedObservable=new U.e,this.onSkinLoadedObservable=new U.e,this.onTextureLoadedObservable=new U.e,this.onMaterialLoadedObservable=new U.e,this.onCameraLoadedObservable=new U.e,this.onCompleteObservable=new U.e,this.onErrorObservable=new U.e,this.Tc=new U.e,this.onExtensionLoadedObservable=new U.e,this.validate=!1,this.onValidatedObservable=new U.e,this._loader=null,this._state=null,this._requests=new Array,this.name=b.name,this.extensions=b.extensions,this.onLoaderStateChangedObservable=new U.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.K(l)}set onParsed(l){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),l&&(this._onParsedObserver=this.onParsedObservable.add(l))}set onMeshLoaded(l){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),l&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(l))}set onSkinLoaded(l){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),l&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((a=>l(a.node,a.skinnedNode))))}set onTextureLoaded(l){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),l&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(l))}set onMaterialLoaded(l){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),l&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(l))}set onCameraLoaded(l){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),l&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(l))}set onComplete(l){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(l)}set onError(l){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(l)}set onDispose(l){this._onDisposeObserver&&this.Tc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Tc.add(l)}set onExtensionLoaded(l){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(l)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(l){this._loggingEnabled!==l&&(this._loggingEnabled=l,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(l){this._capturePerformanceCounters!==l&&(this._capturePerformanceCounters=l,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(l){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(l)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const l of this._requests)l.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=l=>Promise.resolve(l),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Tc.notifyObservers(void 0),this.Tc.clear()}loadFile(l,a,N,K,Z,w,S,J){if(ArrayBuffer.isView(a))return this._loadBinary(l,a,N,K,S,J),null;this._progressCallback=Z;const n=a.name||c.Tools.GetFilename(a);if(w){if(this.useRangeRequests){this.validate&&T.b.Warn("glTF validation is not supported when range requests are enabled");const N={abort:()=>{},onCompleteObservable:new U.e},c={readAsync:(N,U)=>new Promise(((c,K)=>{this._loadFile(l,a,(l=>{c(new Uint8Array(l))}),!0,(l=>{K(l)}),(l=>{l.setRequestHeader("Range",`bytes=${N}-${N+U-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new A(c)).then((l=>{N.onCompleteObservable.notifyObservers(N),K(l)}),S?l=>S(void 0,l):void 0),N}return this._loadFile(l,a,(a=>{this._validate(l,new Uint8Array(a,0,a.byteLength),N,n),this._unpackBinaryAsync(new A({readAsync:(l,N)=>i(a,l,N),byteLength:a.byteLength})).then((l=>{K(l)}),S?l=>S(void 0,l):void 0)}),!0,S)}return this._loadFile(l,a,(a=>{try{this._validate(l,a,N,n),K({json:this._parseJson(a)})}catch{S&&S()}}),!1,S)}_loadBinary(l,a,N,U,c,K){this._validate(l,new Uint8Array(a.buffer,a.byteOffset,a.byteLength),N,K),this._unpackBinaryAsync(new A({readAsync:(l,N)=>function(l,a,N){try{if(a<0||a>=l.byteLength)throw new RangeError("Offset is out of range.");if(a+N>l.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(l.buffer,l.byteOffset+a,N))}catch(U){return Promise.reject(U)}}(a,l,N),byteLength:a.byteLength})).then((l=>{U(l)}),c?l=>c(void 0,l):void 0)}importMeshAsync(l,a,N,U,c,K){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(N),this.onParsedObservable.clear(),this._log(`Loading ${K||""}`),this._loader=this._getLoader(N),this._loader.importMeshAsync(l,a,null,N,U,c,K))))}loadAsync(l,a,N,U,c){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(a),this.onParsedObservable.clear(),this._log(`Loading ${c||""}`),this._loader=this._getLoader(a),this._loader.loadAsync(l,a,N,U,c))))}loadAssetContainerAsync(l,a,N,U,c){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(a),this.onParsedObservable.clear(),this._log(`Loading ${c||""}`),this._loader=this._getLoader(a);const K=new C(l),Z=[];this.onMaterialLoadedObservable.add((l=>{Z.push(l)}));const w=[];this.onTextureLoadedObservable.add((l=>{w.push(l)}));const S=[];this.onCameraLoadedObservable.add((l=>{S.push(l)}));const T=[];return this.onMeshLoadedObservable.add((l=>{l.morphTargetManager&&T.push(l.morphTargetManager)})),this._loader.importMeshAsync(null,l,K,a,N,U,c).then((l=>(Array.prototype.push.apply(K.geometries,l.geometries),Array.prototype.push.apply(K.meshes,l.meshes),Array.prototype.push.apply(K.wy,l.wy),Array.prototype.push.apply(K.skeletons,l.skeletons),Array.prototype.push.apply(K.animationGroups,l.animationGroups),Array.prototype.push.apply(K.materials,Z),Array.prototype.push.apply(K.textures,w),Array.prototype.push.apply(K.lights,l.lights),Array.prototype.push.apply(K.transformNodes,l.transformNodes),Array.prototype.push.apply(K.cameras,S),Array.prototype.push.apply(K.morphTargetManagers,T),K)))}))}canDirectLoad(l){return b.canDirectLoad(l)}directLoad(l,a){if(a.startsWith("base64,"+q)||a.startsWith(";base64,"+q)||a.startsWith("application/octet-stream;base64,"+q)||a.startsWith("model/gltf-binary;base64,"+q)){const N=(0,O.e)(a);return this._validate(l,new Uint8Array(N,0,N.byteLength)),this._unpackBinaryAsync(new A({readAsync:(l,a)=>i(N,l,a),byteLength:N.byteLength}))}return this._validate(l,a),Promise.resolve({json:this._parseJson(a)})}createPlugin(l){return new Q(l[b.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((l,a)=>{this.onCompleteObservable.addOnce((()=>{l()})),this.onErrorObservable.addOnce((l=>{a(l)}))}))}_setState(l){this._state!==l&&(this._state=l,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(t[this._state]))}_loadFile(l,a,N,U,c,K){const Z=l._loadFile(a,N,(l=>{this._onProgress(l,Z)}),!0,U,c,K);return Z.onCompleteObservable.add((()=>{Z._lengthComputable=!0,Z._total=Z._loaded})),this._requests.push(Z),Z}_onProgress(l,a){if(!this._progressCallback)return;a._lengthComputable=l.lengthComputable,a._loaded=l.loaded,a._total=l.total;let N=!0,U=0,c=0;for(const K of this._requests){if(void 0===K._lengthComputable||void 0===K._loaded||void 0===K._total)return;N=N&&K._lengthComputable,U+=K._loaded,c+=K._total}this._progressCallback({lengthComputable:N,loaded:U,total:N?c:0})}_validate(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),E.b.ValidateAsync(a,N,U,(a=>this.preprocessUrlAsync(N+a).then((a=>l._loadFileAsync(a,void 0,!0,!0).then((l=>new Uint8Array(l,0,l.byteLength))))))).then((l=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(l),this.onValidatedObservable.clear()}),(l=>{this._endPerformanceCounter("Validate JSON"),c.Tools.Warn(`Failed to validate: ${l.message}`),this.onValidatedObservable.clear()})))}_getLoader(l){const a=l.json.asset||{};this._log(`Asset version: ${a.version}`),a.minVersion&&this._log(`Asset minimum version: ${a.minVersion}`),a.generator&&this._log(`Asset generator: ${a.generator}`);const N=Q._parseVersion(a.version);if(!N)throw new Error("Invalid version: "+a.version);if(void 0!==a.minVersion){const l=Q._parseVersion(a.minVersion);if(!l)throw new Error("Invalid minimum version: "+a.minVersion);if(Q._compareVersion(l,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+a.minVersion)}const U={1:Q._CreateGLTF1Loader,2:Q._CreateGLTF2Loader}[N.major];if(!U)throw new Error("Unsupported version: "+a.version);return U(this)}_parseJson(l){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${l.length}`);const a=JSON.parse(l);return this._endPerformanceCounter("Parse JSON"),a}_unpackBinaryAsync(l){return this._startPerformanceCounter("Unpack Binary"),l.loadAsync(20).then((()=>{const a=l.readUint32();if(1179937895!==a)throw new h.f("Unexpected magic: "+a,h.e.GLTFLoaderUnexpectedMagicError);const N=l.readUint32();this.loggingEnabled&&this._log(`Binary version: ${N}`);const U=l.readUint32();let c;switch(this.useRangeRequests||U===l.buffer.byteLength||T.b.Warn(`Length in header does not match actual data length: ${U} != ${l.buffer.byteLength}`),N){case 1:c=this._unpackBinaryV1Async(l,U);break;case 2:c=this._unpackBinaryV2Async(l,U);break;default:throw new Error("Unsupported version: "+N)}return this._endPerformanceCounter("Unpack Binary"),c}))}_unpackBinaryV1Async(l,a){const N=l.readUint32(),U=l.readUint32();if(0!==U)throw new Error(`Unexpected content format: ${U}`);const c=a-l.byteOffset,K={json:this._parseJson(l.readString(N)),bin:null};if(0!==c){const a=l.byteOffset;K.bin={readAsync:(N,U)=>l.buffer.readAsync(a+N,U),byteLength:c}}return Promise.resolve(K)}_unpackBinaryV2Async(l,a){const N=1313821514,U=5130562,c=l.readUint32();if(l.readUint32()!==N)throw new Error("First chunk format is not JSON");return l.byteOffset+c===a?l.loadAsync(c).then((()=>({json:this._parseJson(l.readString(c)),bin:null}))):l.loadAsync(c+8).then((()=>{const K={json:this._parseJson(l.readString(c)),bin:null},Z=()=>{const c=l.readUint32();switch(l.readUint32()){case N:throw new Error("Unexpected JSON chunk");case U:{const a=l.byteOffset;K.bin={readAsync:(N,U)=>l.buffer.readAsync(a+N,U),byteLength:c},l.skipBytes(c);break}default:l.skipBytes(c)}return l.byteOffset!==a?l.loadAsync(8).then(Z):Promise.resolve(K)};return Z()}))}static _parseVersion(l){if("1.0"===l||"1.0.1"===l)return{major:1,minor:0};const a=(l+"").match(/^(\d+)\.(\d+)/);return a?{major:parseInt(a[1]),minor:parseInt(a[2])}:null}static _compareVersion(l,a){return l.major>a.major?1:l.major<a.major?-1:l.minor>a.minor?1:l.minor<a.minor?-1:0}_logOpen(l){this._log(l),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(l){const a=Q._logSpaces.substring(0,2*this._logIndentLevel);T.b.Log(`${a}${l}`)}_logDisabled(l){}_startPerformanceCounterEnabled(l){c.Tools.StartPerformanceCounter(l)}_startPerformanceCounterDisabled(l){}_endPerformanceCounterEnabled(l){c.Tools.EndPerformanceCounter(l)}_endPerformanceCounterDisabled(l){}}Q.IncrementalLoading=!0,Q.HomogeneousCoordinates=!1,Q._logSpaces="                                ",(0,K.d)(new Q)},14078:(l,a,N)=>{"use strict";N.d(a,{b:()=>Z});var U=N(12254);function c(l,a,N,U){const c={externalResourceFunction:U};return N&&(c.uri="file:"===a?N:a+N),ArrayBuffer.isView(l)?GLTFValidator.validateBytes(l,c):GLTFValidator.validateString(l,c)}function K(){const l=[];onmessage=a=>{const N=a.data;switch(N.id){case"init":importScripts(N.url);break;case"validate":c(N.data,N.rootUrl,N.fileName,(a=>new Promise(((N,U)=>{const c=l.length;l.push({resolve:N,reject:U}),postMessage({id:"getExternalResource",index:c,uri:a})})))).then((l=>{postMessage({id:"validate.resolve",value:l})}),(l=>{postMessage({id:"validate.reject",reason:l})}));break;case"getExternalResource.resolve":l[N.index].resolve(N.value);break;case"getExternalResource.reject":l[N.index].reject(N.reason)}}}class Z{static ValidateAsync(l,a,N,Z){return"function"===typeof Worker?new Promise(((w,S)=>{const T=`${c}(${K})()`,J=URL.createObjectURL(new Blob([T],{type:"application/javascript"})),n=new Worker(J),y=l=>{n.removeEventListener("error",y),n.removeEventListener("message",H),S(l)},H=l=>{const a=l.data;switch(a.id){case"getExternalResource":Z(a.uri).then((l=>{n.postMessage({id:"getExternalResource.resolve",index:a.index,value:l},[l.buffer])}),(l=>{n.postMessage({id:"getExternalResource.reject",index:a.index,reason:l})}));break;case"validate.resolve":n.removeEventListener("error",y),n.removeEventListener("message",H),w(a.value),n.terminate();break;case"validate.reject":n.removeEventListener("error",y),n.removeEventListener("message",H),S(a.reason),n.terminate()}};if(n.addEventListener("error",y),n.addEventListener("message",H),n.postMessage({id:"init",url:U.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(l)){const U=l.slice();n.postMessage({id:"validate",data:U,rootUrl:a,fileName:N},[U.buffer])}else n.postMessage({id:"validate",data:l,rootUrl:a,fileName:N})})):(this._LoadScriptPromise||(this._LoadScriptPromise=U.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>c(l,a,N,Z))))}}Z.Configuration={url:`${U.Tools._DefaultCdnUrl}/gltf_validator.js`}},14617:(l,a,N)=>{"use strict";N.d(a,{d:()=>b});var U=N(12429),c=N(12432),K=N(12471),Z=N(12447),w=N(12825),S=N(12746),T=N(12506),J=N(12678),n=N(12394),y=N(12350);N(13832),N(13735),N(13757),N(13743),N(13762),N(13770),N(13779);const H="imageProcessingCompatibility",u="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";y.e.IncludesShadersStore[H]||(y.e.IncludesShadersStore[H]=u);const W="skyPixelShader",B="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";y.e.ShadersStore[W]||(y.e.ShadersStore[W]=B);N(13840),N(13782),N(13788),N(13800),N(13791);const Y="skyVertexShader",C="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";y.e.ShadersStore[Y]||(y.e.ShadersStore[Y]=C);var M=N(12737),A=N(12804),E=N(12798);class q extends w.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class b extends S.e{constructor(l,a){super(l,a),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Z.ua(0,100,0),this.useSunPosition=!1,this.cameraOffset=Z.ua.Zero(),this.up=Z.ua.Up(),this.dithering=!1,this._cameraPosition=Z.ua.Zero(),this._skyOrientation=new Z.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(l,a){const N=a._drawWrapper;if(this.isFrozen&&N.effect&&N._wasPreviouslyReady)return!0;a.materialDefines||(a.materialDefines=new q);const U=a.materialDefines,c=this.bl();if(this._isReadyForSubMesh(a))return!0;if((0,E.U)(l,c,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,U),(0,E.J)(l,U,!0,!1),U.IMAGEPROCESSINGPOSTPROCESS!==c.imageProcessingConfiguration.applyByPostProcess&&U.markAsMiscDirty(),U.DITHER!==this.dithering&&U.markAsMiscDirty(),U.isDirty){U.markAsProcessed(),c.resetCachedMaterial();const l=new M.e;U.FOG&&l.addFallback(1,"FOG"),U.IMAGEPROCESSINGPOSTPROCESS=c.imageProcessingConfiguration.applyByPostProcess,U.DITHER=this.dithering;const N=[T.h.PositionKind];U.VERTEXCOLOR&&N.push(T.h.ColorKind);const K="sky",Z=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,A.c)(Z);const w=U.toString();a.setEffect(c.getEngine().createEffect(K,N,Z,[],w,l,this.onCompiled,this.onError),U,this._materialContext)}return!(!a.effect||!a.effect.isReady())&&(U._renderId=c.getRenderId(),N._wasPreviouslyReady=!0,!0)}bindForSubMesh(l,a,N){const U=this.bl(),c=N.materialDefines;if(!c)return;const K=N.effect;if(!K)return;this._activeEffect=K,this.bindOnlyWorldMatrix(l),this._activeEffect.setMatrix("viewProjection",U.getTransformMatrix()),this._mustRebind(U,K,N)&&((0,A.d)(K,this,U),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,E.k)(c,K,U)),U.fogEnabled&&a.applyFog&&U.fogMode!==J.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",U.getViewMatrix()),(0,E.h)(U,a,this._activeEffect);const w=U.activeCamera;if(w){const l=w.getWorldMatrix();this._cameraPosition.x=l.m[12],this._cameraPosition.y=l.m[13],this._cameraPosition.z=l.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const l=Math.PI*(this.inclination-.5),a=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(a)*Math.cos(l),this.sunPosition.y=this.distance*Math.sin(-l),this.sunPosition.z=this.distance*Math.sin(a)*Math.cos(l),Z.Quaternion.FromUnitVectorsToRef(Z.ua.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(a,this._activeEffect,N)}getAnimatables(){return[]}dispose(l){super.dispose(l)}clone(l){return K.c.Clone((()=>new b(l,this.bl())),this)}serialize(){const l=super.serialize();return l.customType="BABYLON.SkyMaterial",l}getClassName(){return"SkyMaterial"}static Parse(l,a,N){return K.c.Parse((()=>new b(l.name,a)),l,a,N)}}(0,U.d)([(0,c.K)()],b.prototype,"luminance",void 0),(0,U.d)([(0,c.K)()],b.prototype,"turbidity",void 0),(0,U.d)([(0,c.K)()],b.prototype,"rayleigh",void 0),(0,U.d)([(0,c.K)()],b.prototype,"mieCoefficient",void 0),(0,U.d)([(0,c.K)()],b.prototype,"mieDirectionalG",void 0),(0,U.d)([(0,c.K)()],b.prototype,"distance",void 0),(0,U.d)([(0,c.K)()],b.prototype,"inclination",void 0),(0,U.d)([(0,c.K)()],b.prototype,"azimuth",void 0),(0,U.d)([(0,c.G)()],b.prototype,"sunPosition",void 0),(0,U.d)([(0,c.K)()],b.prototype,"useSunPosition",void 0),(0,U.d)([(0,c.G)()],b.prototype,"cameraOffset",void 0),(0,U.d)([(0,c.G)()],b.prototype,"up",void 0),(0,U.d)([(0,c.K)()],b.prototype,"dithering",void 0),(0,n.g)("BABYLON.SkyMaterial",b)},13099:(l,a,N)=>{"use strict";function U(l,a){a.headers=l.headers||{},a.statusMessage=l.statusText,a.statusCode=l.status,a.data=l.response}function c(l,a,N){return new Promise((function(c,K){N=N||{};var Z,w,S,T=new XMLHttpRequest,J=N.body,n=N.headers||{};for(Z in N.timeout&&(T.timeout=N.timeout),T.ontimeout=T.onerror=function(l){l.timeout="timeout"==l.type,K(l)},T.open(l,a.href||a),T.onload=function(){for(S=T.getAllResponseHeaders().trim().split(/[\r\n]+/),U(T,T);w=S.shift();)w=w.split(": "),T.headers[w.shift().toLowerCase()]=w.join(": ");if((w=T.headers["content-type"])&&~w.indexOf("application/json"))try{T.data=JSON.parse(T.data,N.reviver)}catch(l){return U(T,l),K(l)}(T.status>=400?K:c)(T)},typeof FormData<"u"&&J instanceof FormData||J&&"object"==typeof J&&(n["content-type"]="application/json",J=JSON.stringify(J)),T.withCredentials=!!N.withCredentials,n)T.setRequestHeader(Z,n[Z]);T.send(J)}))}N.r(a),N.d(a,{del:()=>S,get:()=>K,patch:()=>w,post:()=>Z,put:()=>T,send:()=>c});var K=c.bind(c,"GET"),Z=c.bind(c,"POST"),w=c.bind(c,"PATCH"),S=c.bind(c,"DELETE"),T=c.bind(c,"PUT")},14737:(l,a,N)=>{"use strict";N.d(a,{e:()=>n});const U=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6,K=1/3,Z=1/6,w=(Math.sqrt(5)-1)/4,S=(5-Math.sqrt(5))/20,T=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),J=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const n=class{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const a="function"==typeof l?l:function(l){let a=0,N=0,U=0,c=1;const K=function(){let l=4022871197;return function(a){a=a.toString();for(let N=0;N<a.length;N++){l+=a.charCodeAt(N);let U=.02519603282416938*l;l=U>>>0,U-=l,U*=l,l=U>>>0,U-=l,l+=4294967296*U}return 2.3283064365386963e-10*(l>>>0)}}();a=K(" "),N=K(" "),U=K(" "),a-=K(l),a<0&&(a+=1);N-=K(l),N<0&&(N+=1);U-=K(l),U<0&&(U+=1);return function(){const l=2091639*a+2.3283064365386963e-10*c;return a=N,N=U,U=l-(c=0|l)}}(l);this.p=function(l){const a=new Uint8Array(256);for(let N=0;N<256;N++)a[N]=N;for(let N=0;N<255;N++){const U=N+~~(l()*(256-N)),c=a[N];a[N]=a[U],a[U]=c}return a}(a),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let N=0;N<512;N++)this.perm[N]=this.p[255&N],this.permMod12[N]=this.perm[N]%12}noise2D(l,a){const N=this.permMod12,K=this.perm;let Z=0,w=0,S=0;const J=(l+a)*U,n=Math.floor(l+J),y=Math.floor(a+J),H=(n+y)*c,u=l-(n-H),W=a-(y-H);let B,Y;u>W?(B=1,Y=0):(B=0,Y=1);const C=u-B+c,M=W-Y+c,A=u-1+2*c,E=W-1+2*c,q=255&n,b=255&y;let z=.5-u*u-W*W;if(z>=0){const l=3*N[q+K[b]];z*=z,Z=z*z*(T[l]*u+T[l+1]*W)}let I=.5-C*C-M*M;if(I>=0){const l=3*N[q+B+K[b+Y]];I*=I,w=I*I*(T[l]*C+T[l+1]*M)}let t=.5-A*A-E*E;if(t>=0){const l=3*N[q+1+K[b+1]];t*=t,S=t*t*(T[l]*A+T[l+1]*E)}return 70*(Z+w+S)}noise3D(l,a,N){const U=this.permMod12,c=this.perm;let w,S,J,n;const y=(l+a+N)*K,H=Math.floor(l+y),u=Math.floor(a+y),W=Math.floor(N+y),B=(H+u+W)*Z,Y=l-(H-B),C=a-(u-B),M=N-(W-B);let A,E,q,b,z,I;Y>=C?C>=M?(A=1,E=0,q=0,b=1,z=1,I=0):Y>=M?(A=1,E=0,q=0,b=1,z=0,I=1):(A=0,E=0,q=1,b=1,z=0,I=1):C<M?(A=0,E=0,q=1,b=0,z=1,I=1):Y<M?(A=0,E=1,q=0,b=0,z=1,I=1):(A=0,E=1,q=0,b=1,z=1,I=0);const t=Y-A+Z,O=C-E+Z,h=M-q+Z,i=Y-b+2*Z,k=C-z+2*Z,Q=M-I+2*Z,j=Y-1+.5,f=C-1+.5,p=M-1+.5,R=255&H,L=255&u,r=255&W;let X=.6-Y*Y-C*C-M*M;if(X<0)w=0;else{const l=3*U[R+c[L+c[r]]];X*=X,w=X*X*(T[l]*Y+T[l+1]*C+T[l+2]*M)}let P=.6-t*t-O*O-h*h;if(P<0)S=0;else{const l=3*U[R+A+c[L+E+c[r+q]]];P*=P,S=P*P*(T[l]*t+T[l+1]*O+T[l+2]*h)}let d=.6-i*i-k*k-Q*Q;if(d<0)J=0;else{const l=3*U[R+b+c[L+z+c[r+I]]];d*=d,J=d*d*(T[l]*i+T[l+1]*k+T[l+2]*Q)}let F=.6-j*j-f*f-p*p;if(F<0)n=0;else{const l=3*U[R+1+c[L+1+c[r+1]]];F*=F,n=F*F*(T[l]*j+T[l+1]*f+T[l+2]*p)}return 32*(w+S+J+n)}noise4D(l,a,N,U){const c=this.perm;let K,Z,T,n,y;const H=(l+a+N+U)*w,u=Math.floor(l+H),W=Math.floor(a+H),B=Math.floor(N+H),Y=Math.floor(U+H),C=(u+W+B+Y)*S,M=l-(u-C),A=a-(W-C),E=N-(B-C),q=U-(Y-C);let b=0,z=0,I=0,t=0;M>A?b++:z++,M>E?b++:I++,M>q?b++:t++,A>E?z++:I++,A>q?z++:t++,E>q?I++:t++;const O=b>=3?1:0,h=z>=3?1:0,i=I>=3?1:0,k=t>=3?1:0,Q=b>=2?1:0,j=z>=2?1:0,f=I>=2?1:0,p=t>=2?1:0,R=b>=1?1:0,L=z>=1?1:0,r=I>=1?1:0,X=t>=1?1:0,P=M-O+S,d=A-h+S,F=E-i+S,e=q-k+S,s=M-Q+2*S,o=A-j+2*S,G=E-f+2*S,ml=q-p+2*S,x=M-R+3*S,V=A-L+3*S,D=E-r+3*S,v=q-X+3*S,g=M-1+4*S,ll=A-1+4*S,al=E-1+4*S,Nl=q-1+4*S,Ul=255&u,cl=255&W,Kl=255&B,Zl=255&Y;let wl=.6-M*M-A*A-E*E-q*q;if(wl<0)K=0;else{const l=c[Ul+c[cl+c[Kl+c[Zl]]]]%32*4;wl*=wl,K=wl*wl*(J[l]*M+J[l+1]*A+J[l+2]*E+J[l+3]*q)}let Sl=.6-P*P-d*d-F*F-e*e;if(Sl<0)Z=0;else{const l=c[Ul+O+c[cl+h+c[Kl+i+c[Zl+k]]]]%32*4;Sl*=Sl,Z=Sl*Sl*(J[l]*P+J[l+1]*d+J[l+2]*F+J[l+3]*e)}let Tl=.6-s*s-o*o-G*G-ml*ml;if(Tl<0)T=0;else{const l=c[Ul+Q+c[cl+j+c[Kl+f+c[Zl+p]]]]%32*4;Tl*=Tl,T=Tl*Tl*(J[l]*s+J[l+1]*o+J[l+2]*G+J[l+3]*ml)}let Jl=.6-x*x-V*V-D*D-v*v;if(Jl<0)n=0;else{const l=c[Ul+R+c[cl+L+c[Kl+r+c[Zl+X]]]]%32*4;Jl*=Jl,n=Jl*Jl*(J[l]*x+J[l+1]*V+J[l+2]*D+J[l+3]*v)}let nl=.6-g*g-ll*ll-al*al-Nl*Nl;if(nl<0)y=0;else{const l=c[Ul+1+c[cl+1+c[Kl+1+c[Zl+1]]]]%32*4;nl*=nl,y=nl*nl*(J[l]*g+J[l+1]*ll+J[l+2]*al+J[l+3]*Nl)}return 27*(K+Z+T+n+y)}}}}]);