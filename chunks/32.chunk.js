/*! For license information please see nmw19.32.84690a3e.chunk.js.LICENSE.txt */
(self["3gghkoft8x"]=self["3gghkoft8x"]||[]).push([[32],{14318:(y,S,I)=>{"use strict";var V=I(14320),i=I(14329),A=I(14333);I.g.__TYPEDARRAY_POOL||(I.g.__TYPEDARRAY_POOL={UINT8:i([32,0]),UINT16:i([32,0]),UINT32:i([32,0]),INT8:i([32,0]),INT16:i([32,0]),INT32:i([32,0]),FLOAT:i([32,0]),DOUBLE:i([32,0]),DATA:i([32,0]),UINT8C:i([32,0]),BUFFER:i([32,0])});var B="undefined"!==typeof Uint8ClampedArray,d=I.g.__TYPEDARRAY_POOL;d.UINT8C||(d.UINT8C=i([32,0])),d.BUFFER||(d.BUFFER=i([32,0]));var F=d.DATA,J=d.BUFFER;function u(y){if(y){var S=y.length||y.byteLength,I=V.log2(S);F[I].push(y)}}function K(y){y=V.nextPow2(y);var S=V.log2(y),I=F[S];return I.length>0?I.pop():new ArrayBuffer(y)}function G(y){return new Uint8Array(K(y),0,y)}function p(y){return new Uint16Array(K(2*y),0,y)}function L(y){return new Uint32Array(K(4*y),0,y)}function T(y){return new Int8Array(K(y),0,y)}function l(y){return new Int16Array(K(2*y),0,y)}function j(y){return new Int32Array(K(4*y),0,y)}function s(y){return new Float32Array(K(4*y),0,y)}function O(y){return new Float64Array(K(8*y),0,y)}function f(y){return B?new Uint8ClampedArray(K(y),0,y):G(y)}function my(y){return new DataView(K(y),0,y)}S.free=function(y){if(A(y))J[V.log2(y.length)].push(y);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(y)&&(y=y.buffer),!y)return;var S=y.length||y.byteLength,I=0|V.log2(S);F[I].push(y)}},S.freeUint8=S.freeUint16=S.freeUint32=S.freeInt8=S.freeInt16=S.freeInt32=S.freeFloat32=S.freeFloat=S.freeFloat64=S.freeDouble=S.freeUint8Clamped=S.freeDataView=function(y){u(y.buffer)},S.freeArrayBuffer=u,S.freeBuffer=function(y){J[V.log2(y.length)].push(y)},S.malloc=function(y,S){if(void 0===S||"arraybuffer"===S)return K(y);switch(S){case"uint8":return G(y);case"uint16":return p(y);case"uint32":return L(y);case"int8":return T(y);case"int16":return l(y);case"int32":return j(y);case"float":case"float32":return s(y);case"double":case"float64":return O(y);case"uint8_clamped":return f(y);case"buffer":throw"Buffer not supported";case"data":case"dataview":return my(y);default:return null}return null},S.mallocArrayBuffer=K,S.mallocUint8=G,S.mallocUint16=p,S.mallocUint32=L,S.mallocInt8=T,S.mallocInt16=l,S.mallocInt32=j,S.mallocFloat32=S.mallocFloat=s,S.mallocFloat64=S.mallocDouble=O,S.mallocUint8Clamped=f,S.mallocDataView=my,S.clearCache=function(){for(var y=0;y<32;++y)d.UINT8[y].length=0,d.UINT16[y].length=0,d.UINT32[y].length=0,d.INT8[y].length=0,d.INT16[y].length=0,d.INT32[y].length=0,d.FLOAT[y].length=0,d.DOUBLE[y].length=0,d.UINT8C[y].length=0,F[y].length=0,J[y].length=0}},14401:(y,S,I)=>{y.exports=i;var V=I(13122);function i(y,S){if(!(this instanceof i))return new i(y,S);var I=V.create();V.add(I,y,S),this.base=V.min(V.create(),y,I),this.Ju=V.clone(S),this.max=V.max(V.create(),y,I),this.mag=V.length(this.Ju)}var A=i.prototype;A.width=function(){return this.Ju[0]},A.height=function(){return this.Ju[1]},A.depth=function(){return this.Ju[2]},A.x0=function(){return this.base[0]},A.y0=function(){return this.base[1]},A.z0=function(){return this.base[2]},A.x1=function(){return this.max[0]},A.y1=function(){return this.max[1]},A.z1=function(){return this.max[2]},A.translate=function(y){return V.add(this.max,this.max,y),V.add(this.base,this.base,y),this},A.setPosition=function(y){return V.add(this.max,y,this.Ju),V.k(this.base,y),this},A.expand=function(y){var S=V.create(),I=V.create();return V.max(S,y.max,this.max),V.min(I,y.base,this.base),V.fS(S,S,I),new i(I,S)},A.intersects=function(y){return!(y.base[0]>this.max[0])&&(!(y.base[1]>this.max[1])&&(!(y.base[2]>this.max[2])&&(!(y.max[0]<this.base[0])&&(!(y.max[1]<this.base[1])&&!(y.max[2]<this.base[2])))))},A.touches=function(y){var S=this.union(y);return null!==S&&(0==S.width()||0==S.height()||0==S.depth())},A.union=function(y){if(!this.intersects(y))return null;var S=Math.max(y.base[0],this.base[0]),I=Math.max(y.base[1],this.base[1]),V=Math.max(y.base[2],this.base[2]);return new i([S,I,V],[Math.min(y.max[0],this.max[0])-S,Math.min(y.max[1],this.max[1])-I,Math.min(y.max[2],this.max[2])-V])}},14320:(y,S)=>{"use strict";function I(y){var S=32;return(y&=-y)&&S--,65535&y&&(S-=16),16711935&y&&(S-=8),252645135&y&&(S-=4),858993459&y&&(S-=2),1431655765&y&&(S-=1),S}S.INT_BITS=32,S.INT_MAX=2147483647,S.INT_MIN=-1<<31,S.sign=function(y){return(y>0)-(y<0)},S.abs=function(y){var S=y>>31;return(y^S)-S},S.min=function(y,S){return S^(y^S)&-(y<S)},S.max=function(y,S){return y^(y^S)&-(y<S)},S.isPow2=function(y){return!(y&y-1)&&!!y},S.log2=function(y){var S,I;return S=(y>65535)<<4,S|=I=((y>>>=S)>255)<<3,S|=I=((y>>>=I)>15)<<2,(S|=I=((y>>>=I)>3)<<1)|(y>>>=I)>>1},S.log10=function(y){return y>=1e9?9:y>=1e8?8:y>=1e7?7:y>=1e6?6:y>=1e5?5:y>=1e4?4:y>=1e3?3:y>=100?2:y>=10?1:0},S.popCount=function(y){return 16843009*((y=(858993459&(y-=y>>>1&1431655765))+(y>>>2&858993459))+(y>>>4)&252645135)>>>24},S.countTrailingZeros=I,S.nextPow2=function(y){return y+=0===y,--y,y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)+1},S.prevPow2=function(y){return y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)-(y>>>1)},S.parity=function(y){return y^=y>>>16,y^=y>>>8,y^=y>>>4,27030>>>(y&=15)&1};var V=new Array(256);!function(y){for(var S=0;S<256;++S){var I=S,V=S,i=7;for(I>>>=1;I;I>>>=1)V<<=1,V|=1&I,--i;y[S]=V<<i&255}}(V),S.reverse=function(y){return V[255&y]<<24|V[y>>>8&255]<<16|V[y>>>16&255]<<8|V[y>>>24&255]},S.interleave2=function(y,S){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))|(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S&=65535)|S<<8))|S<<4))|S<<2))|S<<1))<<1},S.deinterleave2=function(y,S){return(y=65535&((y=16711935&((y=252645135&((y=858993459&((y=y>>>S&1431655765)|y>>>1))|y>>>2))|y>>>4))|y>>>16))<<16>>16},S.interleave3=function(y,S,I){return y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2),(y|=(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<1)|(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<2},S.deinterleave3=function(y,S){return(y=1023&((y=4278190335&((y=251719695&((y=3272356035&((y=y>>>S&1227133513)|y>>>2))|y>>>4))|y>>>8))|y>>>16))<<22>>22},S.nextCombination=function(y){var S=y|y-1;return S+1|(~S&-~S)-1>>>I(y)+1}},14315:(y,S,I)=>{"use strict";y.exports=function(y,S,I){switch(arguments.length){case 1:return V=[],J(i=y,i,u,!0),V;case 2:return"function"===typeof S?J(y,y,S,!0):function(y,S){return V=[],J(y,S,u,!1),V}(y,S);case 3:return J(y,S,I,!1);default:throw new Error("box-intersect: Invalid arguments")}var i};var V,i=I(14318),A=I(14338),B=I(14346);function d(y,S){for(var I=0;I<y;++I)if(!(S[I]<=S[I+y]))return!0;return!1}function F(y,S,I,V){for(var i=0,A=0,B=0,F=y.length;B<F;++B){var J=y[B];if(!d(S,J)){for(var u=0;u<2*S;++u)I[i++]=J[u];V[A++]=B}}return A}function J(y,S,I,V){var d=y.length,J=S.length;if(!(d<=0||J<=0)){var u=y[0].length>>>1;if(!(u<=0)){var K,G=i.mallocDouble(2*u*d),p=i.mallocInt32(d);if((d=F(y,u,G,p))>0){if(1===u&&V)A.init(d),K=A.sweepComplete(u,I,0,d,G,p,0,d,G,p);else{var L=i.mallocDouble(2*u*J),T=i.mallocInt32(J);(J=F(S,u,L,T))>0&&(A.init(d+J),K=1===u?A.sweepBipartite(u,I,0,d,G,p,0,J,L,T):B(u,I,V,d,G,p,J,L,T),i.free(L),i.free(T))}i.free(G),i.free(p)}return K}}}function u(y,S){V.push([y,S])}},14353:(y,S)=>{"use strict";var I="d",V="ax",i="fp",A="es",B="rs",d="re",F="rb",J="bs",u="be",K="bb",G=[I,V,"vv",B,d,F,"ri",J,u,K,"bi"];function p(y){var S="bruteForce"+(y?"Full":"Partial"),V=[],B=G.slice();y||B.splice(3,0,i);var d=["function "+S+"("+B.join()+"){"];function F(S,i){var B=function(y,S,V){var i="bruteForce"+(y?"Red":"Blue")+(S?"Flip":"")+(V?"Full":""),B=["function ",i,"(",G.join(),"){","var ",A,"=2*",I,";"],d="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",F="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(V?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return y?B.push(d,"Q",":",F):B.push(F,"Q",":",d),V?B.push("if(y1<x0||x1<y0)continue;"):S?B.push("if(y0<=x0||x1<y0)continue;"):B.push("if(y0<x0||x1<y0)continue;"),B.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),S?B.push("yi,xi"):B.push("xi,yi"),B.push(");if(rv!==void 0)return rv;}}}"),{name:i,code:B.join("")}}(S,i,y);V.push(B.code),d.push("return "+B.name+"("+G.join()+");")}d.push("if(re-rs>be-bs){"),y?(F(!0,!1),d.push("}else{"),F(!1,!1)):(d.push("if(fp){"),F(!0,!0),d.push("}else{"),F(!0,!1),d.push("}}else{if(fp){"),F(!1,!0),d.push("}else{"),F(!1,!1),d.push("}")),d.push("}}return "+S);var J=V.join("")+d.join("");return new Function(J)()}S.partial=p(!1),S.full=p(!0)},14346:(y,S,I)=>{"use strict";y.exports=function(y,S,I,A,u,r,h,n,v){!function(y,S){var I=8*i.log2(S+1)*(y+1)|0,A=i.nextPow2(f*I);C.length<A&&(V.free(C),C=V.mallocInt32(A));var B=i.nextPow2(my*I);D.length<B&&(V.free(D),D=V.mallocDouble(B))}(y,A+h);var P,q=0,g=2*y;o(q++,0,0,A,0,h,I?16:0,-1/0,1/0),I||o(q++,0,0,h,0,A,1,-1/0,1/0);for(;q>0;){var k=(q-=1)*f,R=C[k],b=C[k+1],U=C[k+2],W=C[k+3],a=C[k+4],e=C[k+5],x=q*my,Q=D[x],c=D[x+1],X=1&e,M=!!(16&e),t=u,N=r,Y=n,H=v;if(X&&(t=n,N=v,Y=u,H=r),!(2&e&&b>=(U=l(y,R,b,U,t,N,c)))&&!(4&e&&(b=j(y,R,b,U,t,N,Q))>=U)){var Z=U-b,w=a-W;if(M){if(y*Z*(Z+w)<p){if(void 0!==(P=F.scanComplete(y,R,S,b,U,t,N,W,a,Y,H)))return P;continue}}else{if(y*Math.min(Z,w)<K){if(void 0!==(P=B(y,R,S,X,b,U,t,N,W,a,Y,H)))return P;continue}if(y*Z*w<G){if(void 0!==(P=F.scanBipartite(y,R,S,X,b,U,t,N,W,a,Y,H)))return P;continue}}var yy=L(y,R,b,U,t,N,Q,c);if(b<yy)if(y*(yy-b)<K){if(void 0!==(P=d(y,R+1,S,b,yy,t,N,W,a,Y,H)))return P}else if(R===y-2){if(void 0!==(P=X?F.sweepBipartite(y,S,W,a,Y,H,b,yy,t,N):F.sweepBipartite(y,S,b,yy,t,N,W,a,Y,H)))return P}else o(q++,R+1,b,yy,W,a,X,-1/0,1/0),o(q++,R+1,W,a,b,yy,1^X,-1/0,1/0);if(yy<U){var Sy=J(y,R,W,a,Y,H),Iy=Y[g*Sy+R],Vy=T(y,R,Sy,a,Y,H,Iy);if(Vy<a&&o(q++,R,yy,U,Vy,a,(4|X)+(M?16:0),Iy,c),W<Sy&&o(q++,R,yy,U,W,Sy,(2|X)+(M?16:0),Q,Iy),Sy+1===Vy){if(void 0!==(P=M?z(y,R,S,yy,U,t,N,Sy,Y,H[Sy]):E(y,R,S,X,yy,U,t,N,Sy,Y,H[Sy])))return P}else if(Sy<Vy){var iy;if(M){if(yy<(iy=s(y,R,yy,U,t,N,Iy))){var Ay=T(y,R,yy,iy,t,N,Iy);if(R===y-2){if(yy<Ay&&void 0!==(P=F.sweepComplete(y,S,yy,Ay,t,N,Sy,Vy,Y,H)))return P;if(Ay<iy&&void 0!==(P=F.sweepBipartite(y,S,Ay,iy,t,N,Sy,Vy,Y,H)))return P}else yy<Ay&&o(q++,R+1,yy,Ay,Sy,Vy,16,-1/0,1/0),Ay<iy&&(o(q++,R+1,Ay,iy,Sy,Vy,0,-1/0,1/0),o(q++,R+1,Sy,Vy,Ay,iy,1,-1/0,1/0))}}else yy<(iy=X?O(y,R,yy,U,t,N,Iy):s(y,R,yy,U,t,N,Iy))&&(R===y-2?P=X?F.sweepBipartite(y,S,Sy,Vy,Y,H,yy,iy,t,N):F.sweepBipartite(y,S,yy,iy,t,N,Sy,Vy,Y,H):(o(q++,R+1,yy,iy,Sy,Vy,X,-1/0,1/0),o(q++,R+1,Sy,Vy,yy,iy,1^X,-1/0,1/0)))}}}}};var V=I(14318),i=I(14320),A=I(14353),B=A.partial,d=A.full,F=I(14338),J=I(14356),u=I(14359),K=128,G=1<<22,p=1<<22,L=u("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),T=u("lo===p0",["p0"]),l=u("lo<p0",["p0"]),j=u("hi<=p0",["p0"]),s=u("lo<=p0&&p0<=hi",["p0"]),O=u("lo<p0&&p0<=hi",["p0"]),f=6,my=2,C=V.mallocInt32(1024),D=V.mallocDouble(1024);function o(y,S,I,V,i,A,B,d,F){var J=f*y;C[J]=S,C[J+1]=I,C[J+2]=V,C[J+3]=i,C[J+4]=A,C[J+5]=B;var u=my*y;D[u]=d,D[u+1]=F}function E(y,S,I,V,i,A,B,d,F,J,u){var K=2*y,G=F*K,p=J[G+S];y:for(var L=i,T=i*K;L<A;++L,T+=K){var l=B[T+S],j=B[T+S+y];if(!(p<l||j<p)&&(!V||p!==l)){for(var s,O=d[L],f=S+1;f<y;++f){l=B[T+f],j=B[T+f+y];var my=J[G+f],C=J[G+f+y];if(j<my||C<l)continue y}if(void 0!==(s=V?I(u,O):I(O,u)))return s}}}function z(y,S,I,V,i,A,B,d,F,J){var u=2*y,K=d*u,G=F[K+S];y:for(var p=V,L=V*u;p<i;++p,L+=u){var T=B[p];if(T!==J){var l=A[L+S],j=A[L+S+y];if(!(G<l||j<G)){for(var s=S+1;s<y;++s){l=A[L+s],j=A[L+s+y];var O=F[K+s],f=F[K+s+y];if(j<O||f<l)continue y}var my=I(T,J);if(void 0!==my)return my}}}}},14356:(y,S,I)=>{"use strict";y.exports=function(y,S,I,B,d,F){if(B<=I+1)return I;var J=I,u=B,K=B+I>>>1,G=2*y,p=K,L=d[G*K+S];for(;J<u;){if(u-J<i){A(y,S,J,u,d,F),L=d[G*K+S];break}var T=u-J,l=Math.random()*T+J|0,j=d[G*l+S],s=Math.random()*T+J|0,O=d[G*s+S],f=Math.random()*T+J|0,my=d[G*f+S];j<=O?my>=O?(p=s,L=O):j>=my?(p=l,L=j):(p=f,L=my):O>=my?(p=s,L=O):my>=j?(p=l,L=j):(p=f,L=my);for(var C=G*(u-1),D=G*p,o=0;o<G;++o,++C,++D){var E=d[C];d[C]=d[D],d[D]=E}var z=F[u-1];F[u-1]=F[p],F[p]=z;for(C=G*(u-1),D=G*(p=V(y,S,J,u-1,d,F,L)),o=0;o<G;++o,++C,++D){E=d[C];d[C]=d[D],d[D]=E}z=F[u-1];if(F[u-1]=F[p],F[p]=z,K<p){for(u=p-1;J<u&&d[G*(u-1)+S]===L;)u-=1;u+=1}else{if(!(p<K))break;for(J=p+1;J<u&&d[G*J+S]===L;)J+=1}}return V(y,S,I,K,d,F,d[G*K+S])};var V=I(14359)("lo<p0",["p0"]),i=8;function A(y,S,I,V,i,A){for(var B=2*y,d=B*(I+1)+S,F=I+1;F<V;++F,d+=B)for(var J=i[d],u=F,K=B*(F-1);u>I&&i[K+S]>J;--u,K-=B){for(var G=K,p=K+B,L=0;L<B;++L,++G,++p){var T=i[G];i[G]=i[p],i[p]=T}var l=A[u];A[u]=A[u-1],A[u-1]=l}}},14359:y=>{"use strict";y.exports=function(y,I){var V="abcdef".split("").concat(I),i=[];y.indexOf("lo")>=0&&i.push("lo=e[k+n]");y.indexOf("hi")>=0&&i.push("hi=e[k+o]");return V.push(S.replace("_",i.join()).replace("$",y)),Function.apply(void 0,V)};var S="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14340:y=>{"use strict";y.exports=function(y,V){V<=4*S?I(0,V-1,y):J(0,V-1,y)};var S=32;function I(y,S,I){for(var V=2*(y+1),i=y+1;i<=S;++i){for(var A=I[V++],B=I[V++],d=i,F=V-2;d-- >y;){var J=I[F-2],u=I[F-1];if(J<A)break;if(J===A&&u<B)break;I[F]=J,I[F+1]=u,F-=2}I[F]=A,I[F+1]=B}}function V(y,S,I){S*=2;var V=I[y*=2],i=I[y+1];I[y]=I[S],I[y+1]=I[S+1],I[S]=V,I[S+1]=i}function i(y,S,I){S*=2,I[y*=2]=I[S],I[y+1]=I[S+1]}function A(y,S,I,V){S*=2,I*=2;var i=V[y*=2],A=V[y+1];V[y]=V[S],V[y+1]=V[S+1],V[S]=V[I],V[S+1]=V[I+1],V[I]=i,V[I+1]=A}function B(y,S,I,V,i){S*=2,i[y*=2]=i[S],i[S]=I,i[y+1]=i[S+1],i[S+1]=V}function d(y,S,I){S*=2;var V=I[y*=2],i=I[S];return!(V<i)&&(V!==i||I[y+1]>I[S+1])}function F(y,S,I,V){var i=V[y*=2];return i<S||i===S&&V[y+1]<I}function J(y,u,K){var G=(u-y+1)/6|0,p=y+G,L=u-G,T=y+u>>1,l=T-G,j=T+G,s=p,O=l,f=T,my=j,C=L,D=y+1,o=u-1,E=0;d(s,O,K)&&(E=s,s=O,O=E),d(my,C,K)&&(E=my,my=C,C=E),d(s,f,K)&&(E=s,s=f,f=E),d(O,f,K)&&(E=O,O=f,f=E),d(s,my,K)&&(E=s,s=my,my=E),d(f,my,K)&&(E=f,f=my,my=E),d(O,C,K)&&(E=O,O=C,C=E),d(O,f,K)&&(E=O,O=f,f=E),d(my,C,K)&&(E=my,my=C,C=E);for(var z=K[2*O],r=K[2*O+1],h=K[2*my],n=K[2*my+1],v=2*s,P=2*f,q=2*C,g=2*p,k=2*T,R=2*L,b=0;b<2;++b){var U=K[v+b],W=K[P+b],a=K[q+b];K[g+b]=U,K[k+b]=W,K[R+b]=a}i(l,y,K),i(j,u,K);for(var e=D;e<=o;++e)if(F(e,z,r,K))e!==D&&V(e,D,K),++D;else if(!F(e,h,n,K))for(;;){if(F(o,h,n,K)){F(o,z,r,K)?(A(e,D,o,K),++D,--o):(V(e,o,K),--o);break}if(--o<e)break}B(y,D-1,z,r,K),B(u,o+1,h,n,K),D-2-y<=S?I(y,D-2,K):J(y,D-2,K),u-(o+2)<=S?I(o+2,u,K):J(o+2,u,K),o-D<=S?I(D,o,K):J(D,o,K)}},14338:(y,S,I)=>{"use strict";y.exports={init:function(y){var S=i.nextPow2(y);F.length<S&&(V.free(F),F=V.mallocInt32(S));J.length<S&&(V.free(J),J=V.mallocInt32(S));u.length<S&&(V.free(u),u=V.mallocInt32(S));K.length<S&&(V.free(K),K=V.mallocInt32(S));G.length<S&&(V.free(G),G=V.mallocInt32(S));p.length<S&&(V.free(p),p=V.mallocInt32(S));var I=8*S;L.length<I&&(V.free(L),L=V.mallocDouble(I))},sweepBipartite:function(y,S,I,V,i,d,G,p,j,s){for(var O=0,f=2*y,my=y-1,C=f-1,D=I;D<V;++D){var o=d[D],E=f*D;L[O++]=i[E+my],L[O++]=-(o+1),L[O++]=i[E+C],L[O++]=o}for(D=G;D<p;++D){o=s[D]+B;var z=f*D;L[O++]=j[z+my],L[O++]=-o,L[O++]=j[z+C],L[O++]=o}var r=O>>>1;A(L,r);var h=0,n=0;for(D=0;D<r;++D){var v=0|L[2*D+1];if(v>=B)T(u,K,n--,v=v-B|0);else if(v>=0)T(F,J,h--,v);else if(v<=-B){v=-v-B|0;for(var P=0;P<h;++P){if(void 0!==(q=S(F[P],v)))return q}l(u,K,n++,v)}else{v=-v-1|0;for(P=0;P<n;++P){var q;if(void 0!==(q=S(v,u[P])))return q}l(F,J,h++,v)}}},sweepComplete:function(y,S,I,V,i,B,d,j,s,O){for(var f=0,my=2*y,C=y-1,D=my-1,o=I;o<V;++o){var E=B[o]+1<<1,z=my*o;L[f++]=i[z+C],L[f++]=-E,L[f++]=i[z+D],L[f++]=E}for(o=d;o<j;++o){E=O[o]+1<<1;var r=my*o;L[f++]=s[r+C],L[f++]=1|-E,L[f++]=s[r+D],L[f++]=1|E}var h=f>>>1;A(L,h);var n=0,v=0,P=0;for(o=0;o<h;++o){var q=0|L[2*o+1],g=1&q;if(o<h-1&&q>>1===L[2*o+3]>>1&&(g=2,o+=1),q<0){for(var k=-(q>>1)-1,R=0;R<P;++R){if(void 0!==(b=S(G[R],k)))return b}if(0!==g)for(R=0;R<n;++R){if(void 0!==(b=S(F[R],k)))return b}if(1!==g)for(R=0;R<v;++R){var b;if(void 0!==(b=S(u[R],k)))return b}0===g?l(F,J,n++,k):1===g?l(u,K,v++,k):2===g&&l(G,p,P++,k)}else{k=(q>>1)-1;0===g?T(F,J,n--,k):1===g?T(u,K,v--,k):2===g&&T(G,p,P--,k)}}},scanBipartite:function(y,S,I,V,i,d,u,K,G,p,j,s){var O=0,f=2*y,my=S,C=S+y,D=1,o=1;V?o=B:D=B;for(var E=i;E<d;++E){var z=E+D,r=f*E;L[O++]=u[r+my],L[O++]=-z,L[O++]=u[r+C],L[O++]=z}for(E=G;E<p;++E){z=E+o;var h=f*E;L[O++]=j[h+my],L[O++]=-z}var n=O>>>1;A(L,n);var v=0;for(E=0;E<n;++E){var P=0|L[2*E+1];if(P<0){var q=!1;if((z=-P)>=B?(q=!V,z-=B):(q=!!V,z-=1),q)l(F,J,v++,z);else{var g=s[z],k=f*z,R=j[k+S+1],b=j[k+S+1+y];y:for(var U=0;U<v;++U){var W=F[U],a=f*W;if(!(b<u[a+S+1]||u[a+S+1+y]<R)){for(var e=S+2;e<y;++e)if(j[k+e+y]<u[a+e]||u[a+e+y]<j[k+e])continue y;var x,Q=K[W];if(void 0!==(x=V?I(g,Q):I(Q,g)))return x}}}}else T(F,J,v--,P-D)}},scanComplete:function(y,S,I,V,i,d,J,u,K,G,p){for(var T=0,l=2*y,j=S,s=S+y,O=V;O<i;++O){var f=O+B,my=l*O;L[T++]=d[my+j],L[T++]=-f,L[T++]=d[my+s],L[T++]=f}for(O=u;O<K;++O){f=O+1;var C=l*O;L[T++]=G[C+j],L[T++]=-f}var D=T>>>1;A(L,D);var o=0;for(O=0;O<D;++O){var E=0|L[2*O+1];if(E<0){if((f=-E)>=B)F[o++]=f-B;else{var z=p[f-=1],r=l*f,h=G[r+S+1],n=G[r+S+1+y];y:for(var v=0;v<o;++v){var P=F[v],q=J[P];if(q===z)break;var g=l*P;if(!(n<d[g+S+1]||d[g+S+1+y]<h)){for(var k=S+2;k<y;++k)if(G[r+k+y]<d[g+k]||d[g+k+y]<G[r+k])continue y;var R=I(q,z);if(void 0!==R)return R}}}}else{for(f=E-B,v=o-1;v>=0;--v)if(F[v]===f){for(k=v+1;k<o;++k)F[k-1]=F[k];break}--o}}}};var V=I(14318),i=I(14320),A=I(14340),B=1<<28,d=1024,F=V.mallocInt32(d),J=V.mallocInt32(d),u=V.mallocInt32(d),K=V.mallocInt32(d),G=V.mallocInt32(d),p=V.mallocInt32(d),L=V.mallocDouble(8192);function T(y,S,I,V){var i=S[V],A=y[I-1];y[i]=A,S[A]=i}function l(y,S,I,V){y[I]=V,S[V]=I}},14329:y=>{"use strict";function S(y,I,V){var i=0|y[V];if(i<=0)return[];var A,B=new Array(i);if(V===y.length-1)for(A=0;A<i;++A)B[A]=I;else for(A=0;A<i;++A)B[A]=S(y,I,V+1);return B}y.exports=function(y,I){switch("undefined"===typeof I&&(I=0),typeof y){case"number":if(y>0)return function(y,S){var I,V;for(I=new Array(y),V=0;V<y;++V)I[V]=S;return I}(0|y,I);break;case"object":if("number"===typeof y.length)return S(y,I,0)}return[]}},14292:(y,S,I)=>{y.exports=function(){var y=this;this.components={},this.comps=this.components;var S=this.components,I=1,i={},A=[],B=[],d={timeout:!1,removals:[],multiComps:[]};function F(y,I){var V=S[I],A=i[I],B=A.hash[y];B&&(A.remove(y),V.IV&&(V.multi?(B.forEach((S=>{S&&V.IV(y,S)})),B.length=0):V.IV(y,B)),d.removals.push(A),J())}function J(){d.timeout||(d.timeout=!0,setTimeout(u,1))}function u(){d.timeout=!1,K()}function K(){d.multiComps.length&&function(y){for(var S=0;S<y.length;S++){var{entID:I,data:V}=y[S],i=V.hash[I];if(i){for(var A=0;A<i.length;A++)i[A]||(i.splice(A,1),A--);0===i.length&&(V.remove(I),d.removals.push(V))}}y.length=0}(d.multiComps),d.removals.length&&function(y){for(var S=0;S<y.length;S++){y[S].flush()}y.length=0}(d.removals)}this.DK=i,this._systems=A,this._renderSystems=B,this.VJ=function(S){var V=I++;return Array.isArray(S)&&S.forEach((S=>y.NF(V,S))),V},this.deleteEntity=function(S){return Object.keys(i).forEach((y=>{i[y].hash[S]&&F(S,y)})),y},this.zu=function(y){if(!y)throw new Error("Missing component definition");var I=y.name;if(!I)throw new Error("Component definition must have a name property.");if("string"!==typeof I)throw new Error("Component name must be a string.");if(""===I)throw new Error("Component name must be a non-empty string.");if(i[I])throw new Error(`Component ${I} already exists.`);var d={};return d.name=I,d.multi=!!y.multi,d.order=isNaN(y.order)?99:y.order,d.stateConstructor=y.stateConstructor||null,d.state=y.state||{},d.Qd=y.Qd||null,d.IV=y.IV||null,d.system=y.system||null,d.wd=y.wd||null,S[I]=d,i[I]=new V,i[I]._pendingMultiCleanup=!1,i[I]._multiCleanupIDs=d.multi?[]:null,d.system&&(A.push(I),A.sort(((y,I)=>S[y].order-S[I].order))),d.wd&&(B.push(I),B.sort(((y,I)=>S[y].order-S[I].order))),I},this.overwriteComponent=function(y,I){var V=S[y];if(!V)throw new Error(`Unknown component: ${y}`);if(!I)throw new Error("Missing component definition");if(V.name!==I.name)throw new Error("Overwriting component must use the same name property.");var d={};d.name=y,d.multi=!!I.multi,d.order=isNaN(I.order)?99:I.order,d.state=I.state||{},d.Qd=I.Qd||null,d.IV=I.IV||null,d.system=I.system||null,d.wd=I.wd||null,S[y]=d,i[y]._pendingMultiCleanup=!1,i[y]._multiCleanupIDs=d.multi?[]:null;var F=A.indexOf(y);d.system&&F<0&&A.push(y),!d.system&&F>=0&&A.splice(F,1),A.sort(((y,I)=>S[y].order-S[I].order));var J=B.indexOf(y);d.wd&&J<0&&B.push(y),!d.wd&&J>=0&&B.splice(J,1),B.sort(((y,I)=>S[y].order-S[I].order));var u=d.state;return this.tJ(y).forEach((y=>{for(var S in u)S in y||(y[S]=u[S]);d.Qd&&d.Qd(y.Nd,y)})),y},this.deleteComponent=function(I){var V=i[I];if(!V)throw new Error(`Unknown component: ${I}`);V.flush(),V.list.forEach((y=>{y&&F(y.Nd||y[0].Nd,I)}));var d=A.indexOf(I),J=B.indexOf(I);return d>-1&&A.splice(d,1),J>-1&&B.splice(J,1),i[I].dispose(),delete i[I],delete S[I],y},this.NF=function(y,I,V){var A,B=S[I],d=i[I];if(!d)throw new Error(`Unknown component: ${I}.`);if(d.hash[y]&&!B.multi)throw new Error(`Entity ${y} already has component: ${I}.`);if(B.stateConstructor){if(!(A=new B.stateConstructor).hasOwnProperty("Nd"))throw new Error(`Component ${B.name} stateConstructor type does not have property __id`)}else A=Object.assign({},{Nd:y},B.state,V);if(A.Nd=y,B.multi){var F=d.hash[y];F||(F=[],d.add(y,F)),F.push(A)}else d.add(y,A);return B.Qd&&B.Qd(y,A),this},this.BJ=function(y,S){var I=i[S];if(!I)throw new Error(`Unknown component: ${S}.`);return!!I.hash[y]},this.wF=function(S,I){if(!i[I])throw new Error(`Unknown component: ${I}.`);return F(S,I),y},this.getState=function(y,S){var I=i[S];if(!I)throw new Error(`Unknown component: ${S}.`);return I.hash[y]},this.tJ=function(y){var S=i[y];if(!S)throw new Error(`Unknown component: ${y}.`);return K(),S.list},this.pp=function(y){if(!i[y])throw new Error(`Unknown component: ${y}.`);var S=i[y].hash;return y=>S[y]},this.lp=function(y){if(!i[y])throw new Error(`Unknown component: ${y}.`);var S=i[y].hash;return y=>!!S[y]},this.qd=function(I){K();for(var V=0;V<A.length;V++){var B=A[V],d=S[B],F=i[B];d.system(I,F.list),K()}return y},this.render=function(I){K();for(var V=0;V<B.length;V++){var A=B[V],d=S[A],F=i[A];d.wd(I,F.list),K()}return y},this.removeMultiComponent=function(I,V,A){var B=S[V],F=i[V];if(!F)throw new Error(`Unknown component: ${V}.`);if(!B.multi)throw new Error("removeMultiComponent called on non-multi component");return function(y,S,I,V){var i=I.hash[y];if(i){var A=i[V];A&&(i[V]=null,S.IV&&S.IV(y,A),d.multiComps.push({entID:y,data:I}),J())}}(I,B,F,A),y}};var V=I(14296)},14296:y=>{function S(y,S){var I=y._map[S];if(delete y.hash[S],delete y._map[S],I===y.list.length-1)y.list.pop();else{var V=y.list.pop();if(y.list[I]=V,null===V||null===V[0]){var i=y.list.length;for(var A in y._map)if(y._map[A]===i)return void(y._map[A]=I)}else{var B=V.Nd||V[0].Nd;y._map[B]=I}}}y.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(y,S){if("number"===typeof this._map[y]){var I=this._map[y];this.hash[y]=S,this.list[I]=S}else this._map[y]=this.list.length,this.hash[y]=S,this.list.push(S)}remove(y){var S=this._map[y];this.hash[y]=null,this.list[S]=null,this._pendingRemovals.push(y)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var y=0;y<this._pendingRemovals.length;y++){var I=this._pendingRemovals[y];null===this.hash[I]&&S(this,I)}this._pendingRemovals.length=0}}},14254:y=>{"use strict";var S,I="object"===typeof Reflect?Reflect:null,V=function(y,S,I){return Function.prototype.apply.call(y,S,I)};S=I&&"function"===typeof I.ownKeys?I.ownKeys:Object.getOwnPropertySymbols?function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:function(y){return Object.getOwnPropertyNames(y)};var i=Number.isNaN||function(y){return y!==y};function A(){A.init.call(this)}y.exports=A,y.exports.once=function(y,S){return new Promise((function(I,V){function i(I){y.removeListener(S,A),V(I)}function A(){"function"===typeof y.removeListener&&y.removeListener("error",i),I([].slice.call(arguments))}T(y,S,A,{once:!0}),"error"!==S&&function(y,S,I){"function"===typeof y.on&&T(y,"error",S,I)}(y,i,{once:!0})}))},A.EventEmitter=A,A.prototype._events=void 0,A.prototype._eventsCount=0,A.prototype._maxListeners=void 0;var B=10;function d(y){if("function"!==typeof y)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}function F(y){return void 0===y._maxListeners?A.defaultMaxListeners:y._maxListeners}function J(y,S,I,V){var i,A,B,J;if(d(I),void 0===(A=y._events)?(A=y._events=Object.create(null),y._eventsCount=0):(void 0!==A.newListener&&(y.emit("newListener",S,I.listener?I.listener:I),A=y._events),B=A[S]),void 0===B)B=A[S]=I,++y._eventsCount;else if("function"===typeof B?B=A[S]=V?[I,B]:[B,I]:V?B.unshift(I):B.push(I),(i=F(y))>0&&B.length>i&&!B.warned){B.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+B.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.FS=y,u.type=S,u.count=B.length,J=u,console&&console.warn&&console.warn(J)}return y}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function K(y,S,I){var V={fired:!1,wrapFn:void 0,target:y,type:S,listener:I},i=u.bind(V);return i.listener=I,V.wrapFn=i,i}function G(y,S,I){var V=y._events;if(void 0===V)return[];var i=V[S];return void 0===i?[]:"function"===typeof i?I?[i.listener||i]:[i]:I?function(y){for(var S=new Array(y.length),I=0;I<S.length;++I)S[I]=y[I].listener||y[I];return S}(i):L(i,i.length)}function p(y){var S=this._events;if(void 0!==S){var I=S[y];if("function"===typeof I)return 1;if(void 0!==I)return I.length}return 0}function L(y,S){for(var I=new Array(S),V=0;V<S;++V)I[V]=y[V];return I}function T(y,S,I,V){if("function"===typeof y.on)V.once?y.once(S,I):y.on(S,I);else{if("function"!==typeof y.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y);y.addEventListener(S,(function i(A){V.once&&y.removeEventListener(S,i),I(A)}))}}Object.defineProperty(A,"defaultMaxListeners",{enumerable:!0,get:function(){return B},set:function(y){if("number"!==typeof y||y<0||i(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");B=y}}),A.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},A.prototype.setMaxListeners=function(y){if("number"!==typeof y||y<0||i(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this},A.prototype.getMaxListeners=function(){return F(this)},A.prototype.emit=function(y){for(var S=[],I=1;I<arguments.length;I++)S.push(arguments[I]);var i="error"===y,A=this._events;if(void 0!==A)i=i&&void 0===A.error;else if(!i)return!1;if(i){var B;if(S.length>0&&(B=S[0]),B instanceof Error)throw B;var d=new Error("Unhandled error."+(B?" ("+B.message+")":""));throw d.context=B,d}var F=A[y];if(void 0===F)return!1;if("function"===typeof F)V(F,this,S);else{var J=F.length,u=L(F,J);for(I=0;I<J;++I)V(u[I],this,S)}return!0},A.prototype.addListener=function(y,S){return J(this,y,S,!1)},A.prototype.on=A.prototype.addListener,A.prototype.prependListener=function(y,S){return J(this,y,S,!0)},A.prototype.once=function(y,S){return d(S),this.on(y,K(this,y,S)),this},A.prototype.prependOnceListener=function(y,S){return d(S),this.prependListener(y,K(this,y,S)),this},A.prototype.removeListener=function(y,S){var I,V,i,A,B;if(d(S),void 0===(V=this._events))return this;if(void 0===(I=V[y]))return this;if(I===S||I.listener===S)0===--this._eventsCount?this._events=Object.create(null):(delete V[y],V.removeListener&&this.emit("removeListener",y,I.listener||S));else if("function"!==typeof I){for(i=-1,A=I.length-1;A>=0;A--)if(I[A]===S||I[A].listener===S){B=I[A].listener,i=A;break}if(i<0)return this;0===i?I.shift():function(y,S){for(;S+1<y.length;S++)y[S]=y[S+1];y.pop()}(I,i),1===I.length&&(V[y]=I[0]),void 0!==V.removeListener&&this.emit("removeListener",y,B||S)}return this},A.prototype.off=A.prototype.removeListener,A.prototype.JS=function(y){var S,I,V;if(void 0===(I=this._events))return this;if(void 0===I.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==I[y]&&(0===--this._eventsCount?this._events=Object.create(null):delete I[y]),this;if(0===arguments.length){var i,A=Object.keys(I);for(V=0;V<A.length;++V)"removeListener"!==(i=A[V])&&this.JS(i);return this.JS("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(S=I[y]))this.removeListener(y,S);else if(void 0!==S)for(V=S.length-1;V>=0;V--)this.removeListener(y,S[V]);return this},A.prototype.listeners=function(y){return G(this,y,!0)},A.prototype.rawListeners=function(y){return G(this,y,!1)},A.listenerCount=function(y,S){return"function"===typeof y.listenerCount?y.listenerCount(S):p.call(y,S)},A.prototype.listenerCount=p,A.prototype.eventNames=function(){return this._eventsCount>0?S(this._events):[]}},14538:y=>{"use strict";y.exports=function(y,S,I,V,i,A){var B=+S[0],d=+S[1],F=+S[2],J=+I[0],u=+I[1],K=+I[2],G=Math.sqrt(J*J+u*u+K*K);if(0===G)throw new Error("Can't raycast along a zero vector");return function(y,S,I,V,i,A,B,d,F,J){for(var u=0,K=Math.floor,G=0|K(S),p=0|K(I),L=0|K(V),T=i>0?1:-1,l=A>0?1:-1,j=B>0?1:-1,s=Math.abs(1/i),O=Math.abs(1/A),f=Math.abs(1/B),my=s<1/0?s*(T>0?G+1-S:S-G):1/0,C=O<1/0?O*(l>0?p+1-I:I-p):1/0,D=f<1/0?f*(j>0?L+1-V:V-L):1/0,o=-1;u<=d;){var E=y(G,p,L);if(E)return F&&(F[0]=S+u*i,F[1]=I+u*A,F[2]=V+u*B),J&&(J[0]=J[1]=J[2]=0,0===o&&(J[0]=-T),1===o&&(J[1]=-l),2===o&&(J[2]=-j)),E;my<C?my<D?(G+=T,u=my,my+=s,o=0):(L+=j,u=D,D+=f,o=2):C<D?(p+=l,u=C,C+=O,o=1):(L+=j,u=D,D+=f,o=2)}return F&&(F[0]=S+u*i,F[1]=I+u*A,F[2]=V+u*B),J&&(J[0]=J[1]=J[2]=0),0}(y,B,d,F,J/=G,u/=G,K/=G,V="undefined"===typeof V?64:+V,i,A)}},14571:(y,S,I)=>{"use strict";I.d(S,{e:()=>A});var V=I(14254);function i(){this.GG=!1,this.stopPropagation=!1,this.pG=!1,this.disabled=!1}class A{constructor(y,S){this.version="0.7.0";var I=Object.assign({},new i,S||{});this.element=y||document,this.GG=!!I.GG,this.stopPropagation=!!I.stopPropagation,this.pG=!!I.pG,this.disabled=!!I.disabled,this.filterEvents=(y,S)=>!0,this.down=new V.EventEmitter,this.up=new V.EventEmitter,this.state={},this.eJ={dx:0,dy:0,Vp:0,aJ:0,Ap:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?d(this):document.addEventListener("DOMContentLoaded",(y=>{d(this)}),{once:!0})}bind(y){for(var S=arguments.length,I=new Array(S>1?S-1:0),V=1;V<S;V++)I[V-1]=arguments[V];I.forEach((S=>{var I=this._keyBindmap[S]||[];I.includes(y)||(I.push(y),this._keyBindmap[S]=I)})),this.state[y]=!!this.state[y],this.pressCount[y]=this.pressCount[y]||0,this.releaseCount[y]=this.releaseCount[y]||0}unbind(y){for(var S in this._keyBindmap){var I=this._keyBindmap[S],V=I.indexOf(y);V>-1&&I.splice(V,1)}}getBindings(){var y={};for(var S in this._keyBindmap){this._keyBindmap[S].forEach((I=>{y[I]=y[I]||[],y[I].push(S)}))}return y}qd(){B(this.eJ),B(this.pressCount),B(this.releaseCount)}}function B(y){for(var S in y)y[S]=0}function d(y){window.addEventListener("keydown",L.bind(null,y,!0),!1),window.addEventListener("keyup",L.bind(null,y,!1),!1);var S={passive:!0};y.element.addEventListener("touchstart",K.bind(void 0,y),{passive:!1}),y.element.addEventListener("touchend",p.bind(void 0,y),S),y.element.addEventListener("mousedown",T.bind(null,y,!0),S),window.document.addEventListener("mouseup",T.bind(null,y,!1),S),y.element.addEventListener("touchmove",l.bind(null,y),S),y.element.addEventListener("mousemove",l.bind(null,y),S),window.PointerEvent,y.element.addEventListener("wheel",j.bind(null,y),S),y.element.addEventListener("contextmenu",s.bind(null,y),!1),window.addEventListener("blur",O.bind(null,y),!1)}var F=0,J=0,u=null;function K(y,S){S.preventDefault(),G(S)}function G(y){let S=!1;for(let I=0;I<y.touches.length;++I)if(y.touches[I].identifier===u){S=!0;break}if(!S){const S=y.changedTouches[0];F=S.clientX,J=S.clientY,u=S.identifier}}function p(y,S){for(var I=S.changedTouches,V=0;V<I.length;++V)I[V].identifier===u&&(u=null)}function L(y,S,I){f(I.code,S,y,I)}function T(y,S,I){if("pointerId"in I)if(S){if(null!==y._touches.currID)return;y._touches.currID=I.pointerId}else{if(y._touches.currID!==I.pointerId)return;y._touches.currID=null}return f("Mouse"+("button"in I?I.button+1:1),S,y,I),!1}function l(y,S){var I=S.movementX||S.mozMovementX||0,V=S.movementY||S.mozMovementY||0;if(S.touches&&0===(I|V)){var i=function(y){G(y);for(let S=0;S<y.changedTouches.length;++S)if(y.changedTouches[S].identifier==u){const I=y.changedTouches[S],V=[I.clientX-F,I.clientY-J];return F=I.clientX,J=I.clientY,V}return console.error(`Did not find touch id ${u}`),[0,0]}(S);I=i[0],V=i[1]}y.eJ.dx+=I,y.eJ.dy+=V}function j(y,S){var I=1;switch(S.deltaMode){case 0:I=1;break;case 1:I=12;break;case 2:I=y.element.clientHeight||window.innerHeight}y.eJ.Vp+=(S.deltaX||0)*I,y.eJ.aJ+=(S.deltaY||0)*I,y.eJ.Ap+=(S.deltaZ||0)*I}function s(y,S){if(!y.pG)return S.preventDefault(),!1}function O(y){for(var S in y._keyStates)y._keyStates[S]&&(/^Mouse\d/.test(S)||f(S,!1,y,{code:S,note:"ci453mfqc7",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(y,S,I,V){var i=I._keyBindmap[y];i&&(my(I._keyStates[y],S)&&(I._keyStates[y]=S,i.forEach((y=>{(!I.filterEvents||I.filterEvents(V,y))&&function(y,S,I,V){var i=S?I.pressCount:I.releaseCount;i[y]=(i[y]||0)+1;var A=I._bindPressCount[y]||0;(A+=S?1:-1)<0&&(A=0);I._bindPressCount[y]=A;var B=I.state[y];if(my(B,A)){I.state[y]=A>0;var d=S?I.down:I.up;I.disabled||d.emit(y,V)}}(y,S,I,V)}))),"button"in V||(I.GG&&!V.defaultPrevented&&V.preventDefault(),I.stopPropagation&&V.stopPropagation()))}function my(y,S){return y?!S:S}},13203:y=>{y.exports=function(y,S,I){return y[0]=S[0]+I[0],y[1]=S[1]+I[1],y[2]=S[2]+I[2],y}},13152:(y,S,I)=>{y.exports=function(y,S){var I=V(y[0],y[1],y[2]),B=V(S[0],S[1],S[2]);i(I,I),i(B,B);var d=A(I,B);return d>1?0:Math.acos(d)};var V=I(13157),i=I(13166),A=I(13174)},13263:y=>{y.exports=function(y,S){return y[0]=Math.ceil(S[0]),y[1]=Math.ceil(S[1]),y[2]=Math.ceil(S[2]),y}},13147:y=>{y.exports=function(y){var S=new Float32Array(3);return S[0]=y[0],S[1]=y[1],S[2]=y[2],S}},13178:y=>{y.exports=function(y,S){return y[0]=S[0],y[1]=S[1],y[2]=S[2],y}},13140:y=>{y.exports=function(){var y=new Float32Array(3);return y[0]=0,y[1]=0,y[2]=0,y}},13318:y=>{y.exports=function(y,S,I){var V=S[0],i=S[1],A=S[2],B=I[0],d=I[1],F=I[2];return y[0]=i*F-A*d,y[1]=A*B-V*F,y[2]=V*d-i*B,y}},13290:(y,S,I)=>{y.exports=I(13287)},13287:y=>{y.exports=function(y,S){var I=S[0]-y[0],V=S[1]-y[1],i=S[2]-y[2];return Math.sqrt(I*I+V*V+i*i)}},13244:(y,S,I)=>{y.exports=I(13236)},13236:y=>{y.exports=function(y,S,I){return y[0]=S[0]/I[0],y[1]=S[1]/I[1],y[2]=S[2]/I[2],y}},13174:y=>{y.exports=function(y,S){return y[0]*S[0]+y[1]*S[1]+y[2]*S[2]}},13131:y=>{y.exports=1e-6},13193:(y,S,I)=>{y.exports=function(y,S){var I=y[0],i=y[1],A=y[2],B=S[0],d=S[1],F=S[2];return Math.abs(I-B)<=V*Math.max(1,Math.abs(I),Math.abs(B))&&Math.abs(i-d)<=V*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(A-F)<=V*Math.max(1,Math.abs(A),Math.abs(F))};var V=I(13131)},13196:y=>{y.exports=function(y,S){return y[0]===S[0]&&y[1]===S[1]&&y[2]===S[2]}},13259:y=>{y.exports=function(y,S){return y[0]=Math.floor(S[0]),y[1]=Math.floor(S[1]),y[2]=Math.floor(S[2]),y}},13363:(y,S,I)=>{y.exports=function(y,S,I,i,A,B){var d,F;S||(S=3);I||(I=0);F=i?Math.min(i*S+I,y.length):y.length;for(d=I;d<F;d+=S)V[0]=y[d],V[1]=y[d+1],V[2]=y[d+2],A(V,V,B),y[d]=V[0],y[d+1]=V[1],y[d+2]=V[2];return y};var V=I(13140)()},13157:y=>{y.exports=function(y,S,I){var V=new Float32Array(3);return V[0]=y,V[1]=S,V[2]=I,V}},13122:(y,S,I)=>{y.exports={EPSILON:I(13131),create:I(13140),clone:I(13147),angle:I(13152),pd:I(13157),k:I(13178),set:I(13187),equals:I(13193),exactEquals:I(13196),add:I(13203),fS:I(13212),sub:I(13220),multiply:I(13225),mul:I(13232),divide:I(13236),div:I(13244),min:I(13248),max:I(13251),floor:I(13259),ceil:I(13263),round:I(13271),scale:I(13277),Td:I(13280),distance:I(13287),i:I(13290),squaredDistance:I(13292),sqrDist:I(13299),length:I(13301),len:I(13305),squaredLength:I(13308),ld:I(13311),negate:I(13313),inverse:I(13316),normalize:I(13166),dot:I(13174),cross:I(13318),Sd:I(13325),random:I(13327),transformMat4:I(13331),transformMat3:I(13335),transformQuat:I(13343),mF:I(13346),Cd:I(13350),Ed:I(13355),forEach:I(13363)}},13316:y=>{y.exports=function(y,S){return y[0]=1/S[0],y[1]=1/S[1],y[2]=1/S[2],y}},13305:(y,S,I)=>{y.exports=I(13301)},13301:y=>{y.exports=function(y){var S=y[0],I=y[1],V=y[2];return Math.sqrt(S*S+I*I+V*V)}},13325:y=>{y.exports=function(y,S,I,V){var i=S[0],A=S[1],B=S[2];return y[0]=i+V*(I[0]-i),y[1]=A+V*(I[1]-A),y[2]=B+V*(I[2]-B),y}},13251:y=>{y.exports=function(y,S,I){return y[0]=Math.max(S[0],I[0]),y[1]=Math.max(S[1],I[1]),y[2]=Math.max(S[2],I[2]),y}},13248:y=>{y.exports=function(y,S,I){return y[0]=Math.min(S[0],I[0]),y[1]=Math.min(S[1],I[1]),y[2]=Math.min(S[2],I[2]),y}},13232:(y,S,I)=>{y.exports=I(13225)},13225:y=>{y.exports=function(y,S,I){return y[0]=S[0]*I[0],y[1]=S[1]*I[1],y[2]=S[2]*I[2],y}},13313:y=>{y.exports=function(y,S){return y[0]=-S[0],y[1]=-S[1],y[2]=-S[2],y}},13166:y=>{y.exports=function(y,S){var I=S[0],V=S[1],i=S[2],A=I*I+V*V+i*i;A>0&&(A=1/Math.sqrt(A),y[0]=S[0]*A,y[1]=S[1]*A,y[2]=S[2]*A);return y}},13327:y=>{y.exports=function(y,S){S=S||1;var I=2*Math.random()*Math.PI,V=2*Math.random()-1,i=Math.sqrt(1-V*V)*S;return y[0]=Math.cos(I)*i,y[1]=Math.sin(I)*i,y[2]=V*S,y}},13346:y=>{y.exports=function(y,S,I,V){var i=I[1],A=I[2],B=S[1]-i,d=S[2]-A,F=Math.sin(V),J=Math.cos(V);return y[0]=S[0],y[1]=i+B*J-d*F,y[2]=A+B*F+d*J,y}},13350:y=>{y.exports=function(y,S,I,V){var i=I[0],A=I[2],B=S[0]-i,d=S[2]-A,F=Math.sin(V),J=Math.cos(V);return y[0]=i+d*F+B*J,y[1]=S[1],y[2]=A+d*J-B*F,y}},13355:y=>{y.exports=function(y,S,I,V){var i=I[0],A=I[1],B=S[0]-i,d=S[1]-A,F=Math.sin(V),J=Math.cos(V);return y[0]=i+B*J-d*F,y[1]=A+B*F+d*J,y[2]=S[2],y}},13271:y=>{y.exports=function(y,S){return y[0]=Math.round(S[0]),y[1]=Math.round(S[1]),y[2]=Math.round(S[2]),y}},13277:y=>{y.exports=function(y,S,I){return y[0]=S[0]*I,y[1]=S[1]*I,y[2]=S[2]*I,y}},13280:y=>{y.exports=function(y,S,I,V){return y[0]=S[0]+I[0]*V,y[1]=S[1]+I[1]*V,y[2]=S[2]+I[2]*V,y}},13187:y=>{y.exports=function(y,S,I,V){return y[0]=S,y[1]=I,y[2]=V,y}},13299:(y,S,I)=>{y.exports=I(13292)},13311:(y,S,I)=>{y.exports=I(13308)},13292:y=>{y.exports=function(y,S){var I=S[0]-y[0],V=S[1]-y[1],i=S[2]-y[2];return I*I+V*V+i*i}},13308:y=>{y.exports=function(y){var S=y[0],I=y[1],V=y[2];return S*S+I*I+V*V}},13220:(y,S,I)=>{y.exports=I(13212)},13212:y=>{y.exports=function(y,S,I){return y[0]=S[0]-I[0],y[1]=S[1]-I[1],y[2]=S[2]-I[2],y}},13335:y=>{y.exports=function(y,S,I){var V=S[0],i=S[1],A=S[2];return y[0]=V*I[0]+i*I[3]+A*I[6],y[1]=V*I[1]+i*I[4]+A*I[7],y[2]=V*I[2]+i*I[5]+A*I[8],y}},13331:y=>{y.exports=function(y,S,I){var V=S[0],i=S[1],A=S[2],B=I[3]*V+I[7]*i+I[11]*A+I[15];return B=B||1,y[0]=(I[0]*V+I[4]*i+I[8]*A+I[12])/B,y[1]=(I[1]*V+I[5]*i+I[9]*A+I[13])/B,y[2]=(I[2]*V+I[6]*i+I[10]*A+I[14])/B,y}},13343:y=>{y.exports=function(y,S,I){var V=S[0],i=S[1],A=S[2],B=I[0],d=I[1],F=I[2],J=I[3],u=J*V+d*A-F*i,K=J*i+F*V-B*A,G=J*A+B*i-d*V,p=-B*V-d*i-F*A;return y[0]=u*J+p*-B+K*-F-G*-d,y[1]=K*J+p*-d+G*-B-u*-F,y[2]=G*J+p*-F+u*-d-K*-B,y}},14271:y=>{"use strict";y.exports=function(y){for(var S=new Array(y),I=0;I<y;++I)S[I]=I;return S}},14333:y=>{y.exports=function(y){return null!=y&&null!=y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}},14543:(y,S,I)=>{"use strict";I.d(S,{b:()=>V});class V{constructor(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.tu=!1,this.Nu=!1,this.Xu=30,this.Mu=0,this.VK=!1,this.fullscreen=!1,this.Hu=function(y){},this.Zu=function(){},this.SK=function(){},this.yi=function(){},this.wu=function(y){},this.onFullscreenChanged=function(y){},J((()=>{!function(y,S){y._nowObject=performance||Date,y._lastTick=0,y._renderAccum=0,y._rt=0,y._frameCB=d.bind(null,y),requestAnimationFrame(y._frameCB),S>0&&(y._intervalCB=B.bind(null,y),y._interval=setInterval(y._intervalCB,Math.max(S,1e3/y.Xu/2)))}(this,S),function(y,S){if(!S)return;var I=!1,V=!1;document.addEventListener("pointerlockchange",(V=>{I=document.pointerLockElement===S,y.wu(I)})),document.addEventListener("fullscreenchange",(I=>{V=document.fullscreenElement===S,y.onFullscreenChanged(V)})),Object.defineProperty(y,"VK",{get:()=>I,set:y=>{y&&!I?F(S):I&&!y&&function(y){y.exitPointerLock&&y.exitPointerLock()}(document)}}),Object.defineProperty(y,"fullscreen",{get:()=>V,set:y=>{y&&!V?S.requestFullscreen():V&&!y&&document.exitFullscreen()}}),S.addEventListener("click",(i=>{y.tu&&!I&&F(S),y.Nu&&!V&&S.requestFullscreen()}));var i=()=>y.yi();if(window.ResizeObserver){new ResizeObserver(i).observe(S)}else window.addEventListener("resize",i)}(this,y),this.SK()}))}}var i=3,A=20;function B(y){for(var S=1e3/y.Xu,I=y._nowObject.now()+A,V=0;y._nowObject.now()>=y._lastTick+S&&y._nowObject.now()<I&&++V<=i;)y.Hu(S),y._lastTick+=S;var B=5*(S+5),d=y._nowObject.now();if(d-y._lastTick>B)for(;d>=y._lastTick+S;)y._lastTick+=S}function d(y){requestAnimationFrame(y._frameCB),B(y);var S=y._nowObject.now(),I=S-y._rt;if(y._rt=S,y.Mu>0){y._renderAccum+=I;var V=1e3/y.Mu;if(y._renderAccum<V)return;y._renderAccum=Math.min(y._renderAccum-V,V)}var i=1e3/y.Xu,A=(S-y._lastTick)/i;y.Zu(I,A,i)}function F(y){y.requestPointerLock&&y.requestPointerLock()}var J=y=>{if("loading"===document.readyState){var S=()=>{document.removeEventListener("readystatechange",S),y()};document.addEventListener("readystatechange",S)}else setTimeout(y,1)}},14267:(y,S,I)=>{var V=I(14271),i=I(14280),A="undefined"!==typeof Float64Array;function B(y,S){return y[0]-S[0]}function d(){var y,S=this.stride,I=new Array(S.length);for(y=0;y<I.length;++y)I[y]=[Math.abs(S[y]),y];I.sort(B);var V=new Array(I.length);for(y=0;y<V.length;++y)V[y]=I[y][1];return V}function F(y,S){var I=["View",S,"d",y].join("");S<0&&(I="View_Nil"+y);var i="generic"===y;if(-1===S){var A="function "+I+"(a){this.data=a;};var proto="+I+".prototype;proto.dtype='"+y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+I+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+I+"(a){return new "+I+"(a);}";return new Function(A)()}if(0===S){A="function "+I+"(a,d) {this.data = a;this.offset = d};var proto="+I+".prototype;proto.dtype='"+y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+I+"_copy() {return new "+I+"(this.data,this.offset)};proto.pick=function "+I+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+I+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+I+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+I+"(a,b,c,d){return new "+I+"(a,d)}";return new Function("TrivialArray",A)(J[y][0])}A=["'use strict'"];var B=V(S),F=B.map((function(y){return"i"+y})),u="this.offset+"+B.map((function(y){return"this.stride["+y+"]*i"+y})).join("+"),K=B.map((function(y){return"b"+y})).join(","),G=B.map((function(y){return"c"+y})).join(",");A.push("function "+I+"(a,"+K+","+G+",d){this.data=a","this.shape=["+K+"]","this.stride=["+G+"]","this.offset=d|0}","var proto="+I+".prototype","proto.dtype='"+y+"'","proto.dimension="+S),A.push("Object.defineProperty(proto,'size',{get:function "+I+"_size(){return "+B.map((function(y){return"this.shape["+y+"]"})).join("*"),"}})"),1===S?A.push("proto.order=[0]"):(A.push("Object.defineProperty(proto,'order',{get:"),S<4?(A.push("function "+I+"_order(){"),2===S?A.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===S&&A.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):A.push("ORDER})")),A.push("proto.set=function "+I+"_set("+F.join(",")+",v){"),i?A.push("return this.data.set("+u+",v)}"):A.push("return this.data["+u+"]=v}"),A.push("proto.get=function "+I+"_get("+F.join(",")+"){"),i?A.push("return this.data.get("+u+")}"):A.push("return this.data["+u+"]}"),A.push("proto.index=function "+I+"_index(",F.join(),"){return "+u+"}"),A.push("proto.hi=function "+I+"_hi("+F.join(",")+"){return new "+I+"(this.data,"+B.map((function(y){return["(typeof i",y,"!=='number'||i",y,"<0)?this.shape[",y,"]:i",y,"|0"].join("")})).join(",")+","+B.map((function(y){return"this.stride["+y+"]"})).join(",")+",this.offset)}");var p=B.map((function(y){return"a"+y+"=this.shape["+y+"]"})),L=B.map((function(y){return"c"+y+"=this.stride["+y+"]"}));A.push("proto.lo=function "+I+"_lo("+F.join(",")+"){var b=this.offset,d=0,"+p.join(",")+","+L.join(","));for(var T=0;T<S;++T)A.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");A.push("return new "+I+"(this.data,"+B.map((function(y){return"a"+y})).join(",")+","+B.map((function(y){return"c"+y})).join(",")+",b)}"),A.push("proto.step=function "+I+"_step("+F.join(",")+"){var "+B.map((function(y){return"a"+y+"=this.shape["+y+"]"})).join(",")+","+B.map((function(y){return"b"+y+"=this.stride["+y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(T=0;T<S;++T)A.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");A.push("return new "+I+"(this.data,"+B.map((function(y){return"a"+y})).join(",")+","+B.map((function(y){return"b"+y})).join(",")+",c)}");var l=new Array(S),j=new Array(S);for(T=0;T<S;++T)l[T]="a[i"+T+"]",j[T]="b[i"+T+"]";A.push("proto.transpose=function "+I+"_transpose("+F+"){"+F.map((function(y,S){return y+"=("+y+"===undefined?"+S+":"+y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+I+"(this.data,"+l.join(",")+","+j.join(",")+",this.offset)}"),A.push("proto.pick=function "+I+"_pick("+F+"){var a=[],b=[],c=this.offset");for(T=0;T<S;++T)A.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");return A.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),A.push("return function construct_"+I+"(data,shape,stride,offset){return new "+I+"(data,"+B.map((function(y){return"shape["+y+"]"})).join(",")+","+B.map((function(y){return"stride["+y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",A.join("\n"))(J[y],d)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};y.exports=function(y,S,I,V){if(void 0===y)return(0,J.array[0])([]);"number"===typeof y&&(y=[y]),void 0===S&&(S=[y.length]);var B=S.length;if(void 0===I){I=new Array(B);for(var d=B-1,u=1;d>=0;--d)I[d]=u,u*=S[d]}if(void 0===V){V=0;for(d=0;d<B;++d)I[d]<0&&(V-=(S[d]-1)*I[d])}for(var K=function(y){if(i(y))return"buffer";if(A)switch(Object.prototype.toString.call(y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(y)?"array":"generic"}(y),G=J[K];G.length<=B+1;)G.push(F(K,G.length-1));return(0,G[B+1])(y,S,I,V)}},14280:y=>{function S(y){return!!y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}y.exports=function(y){return null!=y&&(S(y)||function(y){return"function"===typeof y.readFloatLE&&"function"===typeof y.slice&&S(y.slice(0,0))}(y)||!!y._isBuffer)}},14405:y=>{"use strict";var S=[],I=[],V=[],i=[],A=[],B=[],d=[],F=[],J=[],u=[],K=[],G=[];y.exports=function(y,p,L,T,l,j){for(var s=d,O=J,f=u,my=G,C=0;C<3;C++)s[C]=+L[C],f[C]=+p.max[C],O[C]=+p.base[C];j||(j=1e-10);var D=function(y,d,J,u,G,p){var L=S,T=I,l=V,j=i,s=A,O=B,f=F,my=Math.floor,C=0,D=0,o=0,E=0,z=0;if(r(),0===o)return 0;for(E=v();D<=o;){if(h(E)&&n())return C;E=v()}for(C+=o,z=0;z<3;z++)u[z]+=J[z],G[z]+=J[z];return C;function r(){if(D=0,0!==(o=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2])))for(var y=0;y<3;y++){var S=J[y]>=0;j[y]=S?1:-1;var I=S?G[y]:u[y];L[y]=S?u[y]:G[y],T[y]=P(I,j[y]),l[y]=q(L[y],j[y]),f[y]=J[y]/o,s[y]=Math.abs(1/f[y]);var V=S?T[y]+1-I:I-T[y];O[y]=s[y]<1/0?s[y]*V:1/0}}function h(S){for(var I=j[0],V=0===S?T[0]:l[0],i=T[0]+I,A=j[1],B=1===S?T[1]:l[1],d=T[1]+A,F=j[2],J=2===S?T[2]:l[2],u=T[2]+F,K=V;K!=i;K+=I)for(var G=B;G!=d;G+=A)for(var p=J;p!=u;p+=F)if(y(K,G,p))return!0;return!1}function n(){C+=D;var y=j[E],S=D/o,I=K;for(z=0;z<3;z++){var V=J[z]*S;u[z]+=V,G[z]+=V,I[z]=J[z]-V}if(y>0?G[E]=Math.round(G[E]):u[E]=Math.round(u[E]),d(C,E,y,I))return!0;for(z=0;z<3;z++)J[z]=I[z];return r(),0===o}function v(){var y=O[0]<O[1]?O[0]<O[2]?0:2:O[1]<O[2]?1:2,S=O[y]-D;for(D=O[y],T[y]+=j[y],O[y]+=s[y],z=0;z<3;z++)L[z]+=S*f[z],l[z]=q(L[z],j[z]);return y}function P(y,S){return my(y-S*p)}function q(y,S){return my(y+S*p)}}(y,T,s,O,f,j);if(!l){for(C=0;C<3;C++)my[C]=L[C]>0?f[C]-p.max[C]:O[C]-p.base[C];p.translate(my)}return D}},14576:(y,S,I)=>{"use strict";I.d(S,{c:()=>K});var V=I(14401),i=I(13122);class A{constructor(y,S,I,A,B,d,F){this.MJ=new V(y.base,y.Ju),this.Ui=S,this.friction=I,this.restitution=A,this.tB=B,this.op=d,this.NB=!!F,this.Fu=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.KL=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.mu=i.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=i.create(),this._impulses=i.create(),this._sleepFrameCount=10}loadFromCopy(y){i.k(this.MJ.base,y.MJ.base),i.k(this.MJ.Ju,y.MJ.Ju),i.k(this.MJ.max,y.MJ.max),this.MJ.mag=y.MJ.mag,this.Ui=y.Ui,this.friction=y.friction,this.restitution=y.restitution,this.tB=y.tB,this.op=y.op,this.NB=y.NB,this.Fu=y.Fu,this.fluidDrag=y.fluidDrag,this.KL=y.KL,this.preventFallOffEdge=y.preventFallOffEdge,this.rolledBackLastTick=y.rolledBackLastTick,i.k(this.mu,y.mu),i.k(this.resting,y.resting),this.inFluid=y.inFluid,this._ratioInFluid=y._ratioInFluid,i.k(this._forces,y._forces),i.k(this._impulses,y._impulses),this._sleepFrameCount=y._sleepFrameCount}setPosition(y){B(y),i.fS(y,y,this.MJ.base),this.MJ.translate(y),this.oJ()}Ji(){return i.clone(this.MJ.base)}applyForce(y){B(y),i.add(this._forces,this._forces,y),this.oJ()}applyImpulse(y){B(y),i.add(this._impulses,this._impulses,y),this.oJ()}oJ(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var B=y=>{};var d=I(14401),F=I(13122),J=I(14405);function u(){this.Fu=.1,this.fluidDrag=.4,this.yd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function K(y,S,I){y=Object.assign(new u,y),this.gravity=y.gravity||[0,-10,0],this.Fu=y.Fu||.1,this.yd=y.yd||2,this.fluidDrag=y.fluidDrag||.4,this.minBounceImpulse=y.minBounceImpulse,this.bodies=[],this.MG=y.MG,this.testSolid=S,this.testFluid=I}K.prototype.Pp=function(y,S,I,V,i,B){y=y||new d([0,0,0],[1,1,1]),"undefined"==typeof S&&(S=1),"undefined"==typeof I&&(I=1),"undefined"==typeof V&&(V=0),"undefined"==typeof i&&(i=1);var F=new A(y,S,I,V,i,B);return this.bodies.push(F),F},K.prototype.qp=function(y){var S=this.bodies.indexOf(y);S<0||(this.bodies.splice(S,1),y.MJ=y.op=null)};var G=F.create(),p=F.create(),L=F.create(),T=F.create(),l=F.create(),j=F.create(),s=F.create(),O=new d([0,0,0],[1,1,1]),f=new A(O,1,1,0,1,(()=>{}),!1);function my(y,S,I){return S=I,S*=1-(1-y.ratioInFluid)**2}K.prototype.qd=function(y){y/=1e3;var S=U(0,F.squaredLength(this.gravity));this.bodies.forEach((I=>function(y,S,I,V){F.k(l,S.resting),y.MG&&f.loadFromCopy(S);if(S.Ui<=0)return F.set(S.mu,0,0,0),F.set(S._forces,0,0,0),void F.set(S._impulses,0,0,0);var i=V||0===S.tB;if(function(y,S,I,V){if(S._sleepFrameCount>0)return!1;if(V)return!0;var i=!1,A=.5*I*I*S.tB;return F.scale(b,y.gravity,A),J(y.testSolid,S.MJ,b,(function(){return i=!0,!0}),!0),i}(y,S,I,i))return;S._sleepFrameCount--,function(y,S){var I=S.MJ,V=Math.floor(I.base[0]),i=Math.floor(I.base[2]),A=Math.floor(I.base[1]),B=Math.floor(I.max[1]);if(!y.testFluid(V,A,i))return S.inFluid=!1,void(S.ratioInFluid=0);var d=1,J=A+1;for(;J<=B&&y.testFluid(V,J,i);)d++,J++;var u=(A+d-I.base[1])/I.Ju[1];u>1&&(u=1);var K=I.Ju[0]*I.Ju[1]*I.Ju[2]*u,G=D;F.scale(G,y.gravity,-y.yd*K*S.tB),S.applyForce(G),S.inFluid=!0,S.ratioInFluid=u}(y,S),a(S._forces),a(S._impulses),a(S.mu),a(S.resting),F.scale(G,S._forces,1/S.Ui),F.Td(G,G,y.gravity,S.tB),F.scale(p,S._impulses,1/S.Ui),F.Td(p,p,G,I),F.add(S.mu,S.mu,p),S.friction&&(o(y,0,S,p,I),o(y,1,S,p,I),o(y,2,S,p,I));var A=S.fluidDrag>=0?S.fluidDrag:y.fluidDrag,B=S.Fu>=0?S.Fu:y.Fu,d=B,u=B;S.inFluid&&(d=my(S,d,S.fluidDragHoriz>=0?S.fluidDragHoriz:A),u=my(S,u,S.fluidDragVert>=0?S.fluidDragVert:A));d=Math.max(1-d*I/S.Ui,0),u=Math.max(1-u*I/S.Ui,0),F.set(C,d,u,d),F.multiply(S.mu,S.mu,C),F.scale(L,S.mu,I),F.set(S._forces,0,0,0),F.set(S._impulses,0,0,0),S.NB&&W(r,S.MJ);F.k(j,L),F.set(s,0,0,0),S.preventFallOffEdge&&function(y,S,I,V){if(!S.resting[1]||I[1]>0)return;var i=g;W(i,S.MJ);for(var A=0;A<3;A+=2){F.set(q,0,0,0),q[A]=I[A];var B=!0;(B=(B=(B=(B=B&&!R(y,i.base[0]+q[0]+1e-5,i.base[1],i.base[2]+q[2]+1e-5))&&!R(y,i.max[0]+q[0]-1e-5,i.base[1],i.base[2]+q[2]+1e-5))&&!R(y,i.base[0]+q[0]+1e-5,i.base[1],i.max[2]+q[2]-1e-5))&&!R(y,i.max[0]+q[0]-1e-5,i.base[1],i.max[2]+q[2]-1e-5))?(V[A]=I[A]>0?1:-1,I[A]=0):0===A&&(F.set(k,I[0],0,0),z(y,i,k,V,S.slideOnCollision))}}(y,S,L,s);z(y,S.MJ,L,S.resting,S.slideOnCollision),S.NB&&function(y,S,I,V){if(S.resting[1]>=0&&!S.inFluid)return;var i=0!==S.resting[0],A=0!==S.resting[2];if(!i&&!A)return;var B=Math.abs(V[0]/V[2]),d=4;if(!i&&B>d)return;if(!A&&B<1/d)return;F.add(n,I.base,V);var u=y.testSolid;J(u,I,V,(function(y,S,I,V){if(1!==S)return!0;V[S]=0}));var K=I.base[1],G=S.inFluid?1.951:1.001,p=Math.floor(K+G)-K;F.set(v,0,p,0);var L=!1;if(J(u,I,v,(function(y,S,I,V){return L=!0,!0})),L)return;F.fS(P,n,I.base),P[1]=0,z(y,I,P,h,!0);var T=U(I.base[0],n[0]),l=U(I.base[2],n[2]);if(i&&!T&&(!l||!A))return;if(A&&(!T||!i)&&!l)return;var j=!0;if(j=j&&!R(y,I.base[0]+1e-5,I.base[1],I.base[2]+1e-5),j=j&&!R(y,I.max[0]-1e-5,I.base[1],I.base[2]+1e-5),j=j&&!R(y,I.base[0]+1e-5,I.base[1],I.max[2]-1e-5),j=j&&!R(y,I.max[0]-1e-5,I.base[1],I.max[2]-1e-5),j)return;W(S.MJ,I),S.resting[0]=h[0],S.resting[2]=h[2],S.KL&&S.KL()}(y,S,r,j);for(var K=0;K<3;++K)S.resting[K]=S.resting[K]||s[K],T[K]=0,S.resting[K]&&(l[K]||(T[K]=-S.mu[K]),S.mu[K]=0);var O=F.length(T);O>.001&&(F.scale(T,T,S.Ui),S.op&&S.op(T),S.restitution>0&&O>y.minBounceImpulse&&(F.scale(T,T,S.restitution),S.applyImpulse(T)));var E=F.squaredLength(S.mu);E>1e-5&&S.oJ();y.MG&&y.MG(S)?(S.loadFromCopy(f),S.rolledBackLastTick=!0):S.rolledBackLastTick=!1}(this,I,y,S)))};var C=F.create([0,0,0]);var D=F.create();function o(y,S,I,V,i){var A=I.resting[S],B=V[S];if(!I.alwaysApplyHorizFriction||1!==S){if(0===A)return;if(A*B<=0)return}F.k(E,I.mu),E[S]=0;var d=F.length(E);if(!U(d,0)){var J=Math.abs(I.friction*y.gravity[S]*i),u=d>J?(d-J)/d:0;I.mu[(S+1)%3]*=u,I.mu[(S+2)%3]*=u}}var E=F.create();function z(y,S,I,V,i){return F.set(V,0,0,0),J(y.testSolid,S,I,(function(y,S,I,A){V[S]=I,A[S]=0,i||(A[0]=0,A[1]=0,A[2]=0)}))}var r=new d([],[]),h=F.create(),n=F.create(),v=F.create(),P=F.create();var q=F.create(),g=new d([],[]),k=F.create();function R(y,S,I,V){return y.testSolid(Math.floor(S),Math.floor(I-1),Math.floor(V))}var b=F.create();function U(y,S){return Math.abs(y-S)<1e-5}function W(y,S){for(var I=0;I<3;I++)y.base[I]=S.base[I],y.max[I]=S.max[I],y.Ju[I]=S.Ju[I]}var a=function(y){}},12998:function(y,S){!function(y){"use strict";var S=function(y,I){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,S){y.__proto__=S}||function(y,S){for(var I in S)Object.prototype.hasOwnProperty.call(S,I)&&(y[I]=S[I])},S(y,I)};function I(y,I){if("function"!==typeof I&&null!==I)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function V(){this.constructor=y}S(y,I),y.prototype=null===I?Object.create(I):(V.prototype=I.prototype,new V)}function V(y,S,I,V){var i,A=arguments.length,B=A<3?S:null===V?V=Object.getOwnPropertyDescriptor(S,I):V;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)B=Reflect.decorate(y,S,I,V);else for(var d=y.length-1;d>=0;d--)(i=y[d])&&(B=(A<3?i(B):A>3?i(S,I,B):i(S,I))||B);return A>3&&B&&Object.defineProperty(S,I,B),B}function i(y,S,I){if(I||2===arguments.length)for(var V,i=0,A=S.length;i<A;i++)!V&&i in S||(V||(V=Array.prototype.slice.call(S,0,i)),V[i]=S[i]);return y.concat(V||Array.prototype.slice.call(S))}var A,B=255,d=213;y.OPERATION=void 0,(A=y.OPERATION||(y.OPERATION={}))[A.ADD=128]="ADD",A[A.REPLACE=0]="REPLACE",A[A.DELETE=64]="DELETE",A[A.DELETE_AND_ADD=192]="DELETE_AND_ADD",A[A.TOUCH=1]="TOUCH",A[A.CLEAR=10]="CLEAR";var F=function(){function S(y,S,I){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=y,this.setParent(S,I)}return S.prototype.setParent=function(y,S,I){var V=this;if(this.indexes||(this.indexes=this.ref instanceof Py?this.ref._definition.indexes:{}),this.parent=y,this.parentIndex=I,S)if(this.root=S,this.ref instanceof Py){var i=this.ref._definition;for(var A in i.schema){var B=this.ref[A];if(B&&B.$changes){var d=i.indexes[A];B.$changes.setParent(this.ref,S,d)}}}else"object"===typeof this.ref&&this.ref.forEach((function(y,S){if(y instanceof Py){var I=y.$changes,i=V.ref.$changes.indexes[S];I.setParent(V.ref,V.root,i)}}))},S.prototype.operation=function(y){this.changes.set(--this.currentCustomOperation,y)},S.prototype.change=function(S,I){void 0===I&&(I=y.OPERATION.ADD);var V="number"===typeof S?S:this.indexes[S];this.assertValidIndex(V,S);var i=this.changes.get(V);i&&i.op!==y.OPERATION.DELETE&&i.op!==y.OPERATION.TOUCH||this.changes.set(V,{op:i&&i.op===y.OPERATION.DELETE?y.OPERATION.DELETE_AND_ADD:I,index:V}),this.allChanges.add(V),this.changed=!0,this.touchParents()},S.prototype.touch=function(S){var I="number"===typeof S?S:this.indexes[S];this.assertValidIndex(I,S),this.changes.has(I)||this.changes.set(I,{op:y.OPERATION.TOUCH,index:I}),this.allChanges.add(I),this.touchParents()},S.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},S.prototype.getType=function(y){if(this.ref._definition)return(S=this.ref._definition).schema[S.fieldsByIndex[y]];var S,I=(S=this.parent._definition).schema[S.fieldsByIndex[this.parentIndex]];return Object.values(I)[0]},S.prototype.getChildrenFilter=function(){var y=this.parent._definition.childFilters;return y&&y[this.parentIndex]},S.prototype.getValue=function(y){return this.ref.getByIndex(y)},S.prototype.delete=function(S){var I="number"===typeof S?S:this.indexes[S];if(void 0!==I){var V=this.getValue(I);this.changes.set(I,{op:y.OPERATION.DELETE,index:I}),this.allChanges.delete(I),delete this.caches[I],V&&V.$changes&&(V.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(S," (").concat(I,")"))},S.prototype.discard=function(S,I){var V=this;void 0===S&&(S=!1),void 0===I&&(I=!1),this.ref instanceof Py||this.changes.forEach((function(S){if(S.op===y.OPERATION.DELETE){var I=V.ref.getIndex(S.index);delete V.indexes[I]}})),this.changes.clear(),this.changed=S,I&&this.allChanges.clear(),this.currentCustomOperation=0},S.prototype.discardAll=function(){var y=this;this.changes.forEach((function(S){var I=y.getValue(S.index);I&&I.$changes&&I.$changes.discardAll()})),this.discard()},S.prototype.cache=function(y,S){this.caches[y]=S},S.prototype.clone=function(){return new S(this.ref,this.parent,this.root)},S.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},S.prototype.assertValidIndex=function(y,S){if(void 0===y)throw new Error('ChangeTree: missing index for field "'.concat(S,'"'))},S}();function J(y,S,I,V){return y[S]||(y[S]=[]),y[S].push(I),null===V||void 0===V||V.forEach((function(y,S){return I(y,S)})),function(){return K(y[S],y[S].indexOf(I))}}function u(S){var I=this,V="string"!==typeof this.$changes.getType();this.$items.forEach((function(i,A){S.push({refId:I.$changes.refId,op:y.OPERATION.DELETE,field:A,value:void 0,previousValue:i}),V&&I.$changes.root.removeRef(i.$changes.refId)}))}function K(y,S){if(-1===S||S>=y.length)return!1;for(var I=y.length-1,V=S;V<I;V++)y[V]=y[V+1];return y.length=I,!0}var G=function(y,S){var I=y.toString(),V=S.toString();return I<V?-1:I>V?1:0};function p(y){return y.$proxy=!0,y=new Proxy(y,{get:function(y,S){return"symbol"===typeof S||isNaN(S)?y[S]:y.at(S)},set:function(y,S,I){if("symbol"===typeof S||isNaN(S))y[S]=I;else{var V=Array.from(y.$items.keys()),i=parseInt(V[S]||S);void 0===I||null===I?y.deleteAt(i):y.setAt(i,I)}return!0},deleteProperty:function(y,S){return"number"===typeof S?y.deleteAt(S):delete y[S],!0}})}var L=function(){function S(){for(var y=[],S=0;S<arguments.length;S++)y[S]=arguments[S];this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,y)}return S.prototype.Qd=function(S,I){return void 0===I&&(I=!0),J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,S,I?this.$items:void 0)},S.prototype.IV=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,S)},S.is=function(y){return Array.isArray(y)||void 0!==y.array},Object.defineProperty(S.prototype,"length",{get:function(){return this.$items.size},set:function(y){0===y?this.clear():this.splice(y,this.length-y)},enumerable:!1,configurable:!0}),S.prototype.push=function(){for(var y,S=this,I=[],V=0;V<arguments.length;V++)I[V]=arguments[V];return I.forEach((function(I){y=S.$refId++,S.setAt(y,I)})),y},S.prototype.pop=function(){var y=Array.from(this.$indexes.values()).pop();if(void 0!==y){this.$changes.delete(y),this.$indexes.delete(y);var S=this.$items.get(y);return this.$items.delete(y),S}},S.prototype.at=function(y){var S=Array.from(this.$items.keys())[y];return this.$items.get(S)},S.prototype.setAt=function(S,I){var V,i;if(void 0!==I&&null!==I){if(this.$items.get(S)!==I){void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,S);var A=null!==(i=null===(V=this.$changes.indexes[S])||void 0===V?void 0:V.op)&&void 0!==i?i:y.OPERATION.ADD;this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,I),this.$changes.change(S,A)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},S.prototype.deleteAt=function(y){var S=Array.from(this.$items.keys())[y];return void 0!==S&&this.$deleteAt(S)},S.prototype.$deleteAt=function(y){return this.$changes.delete(y),this.$indexes.delete(y),this.$items.delete(y)},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&u.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.concat=function(){for(var y,I=[],V=0;V<arguments.length;V++)I[V]=arguments[V];return new(S.bind.apply(S,i([void 0],(y=Array.from(this.$items.values())).concat.apply(y,I),!1)))},S.prototype.join=function(y){return Array.from(this.$items.values()).join(y)},S.prototype.reverse=function(){var y=this,S=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(I,V){y.setAt(S[V],I)})),this},S.prototype.shift=function(){var y=Array.from(this.$items.keys()).shift();if(void 0!==y){var S=this.$items.get(y);return this.$deleteAt(y),S}},S.prototype.slice=function(y,I){var V=new S;return V.push.apply(V,Array.from(this.$items.values()).slice(y,I)),V},S.prototype.sort=function(y){var S=this;void 0===y&&(y=G);var I=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(y).forEach((function(y,V){S.setAt(I[V],y)})),this},S.prototype.splice=function(y,S){void 0===S&&(S=this.length-y);for(var I=Array.from(this.$items.keys()),V=[],i=y;i<y+S;i++)V.push(this.$items.get(I[i])),this.$deleteAt(I[i]);return V},S.prototype.unshift=function(){for(var y=this,S=[],I=0;I<arguments.length;I++)S[I]=arguments[I];var V=this.length,i=S.length,A=Array.from(this.$items.values());return S.forEach((function(S,I){y.setAt(I,S)})),A.forEach((function(S,I){y.setAt(i+I,S)})),V+i},S.prototype.indexOf=function(y,S){return Array.from(this.$items.values()).indexOf(y,S)},S.prototype.lastIndexOf=function(y,S){return void 0===S&&(S=this.length-1),Array.from(this.$items.values()).lastIndexOf(y,S)},S.prototype.every=function(y,S){return Array.from(this.$items.values()).every(y,S)},S.prototype.some=function(y,S){return Array.from(this.$items.values()).some(y,S)},S.prototype.forEach=function(y,S){Array.from(this.$items.values()).forEach(y,S)},S.prototype.map=function(y,S){return Array.from(this.$items.values()).map(y,S)},S.prototype.filter=function(y,S){return Array.from(this.$items.values()).filter(y,S)},S.prototype.reduce=function(y,S){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},S.prototype.reduceRight=function(y,S){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},S.prototype.find=function(y,S){return Array.from(this.$items.values()).find(y,S)},S.prototype.findIndex=function(y,S){return Array.from(this.$items.values()).findIndex(y,S)},S.prototype.fill=function(y,S,I){throw new Error("ArraySchema#fill() not implemented")},S.prototype.copyWithin=function(y,S,I){throw new Error("ArraySchema#copyWithin() not implemented")},S.prototype.toString=function(){return this.$items.toString()},S.prototype.toLocaleString=function(){return this.$items.toLocaleString()},S.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(S,Symbol.species,{get:function(){return S},enumerable:!1,configurable:!0}),S.prototype.entries=function(){return this.$items.entries()},S.prototype.keys=function(){return this.$items.keys()},S.prototype.values=function(){return this.$items.values()},S.prototype.includes=function(y,S){return Array.from(this.$items.values()).includes(y,S)},S.prototype.flatMap=function(y,S){throw new Error("ArraySchema#flatMap() is not supported.")},S.prototype.flat=function(y){throw new Error("ArraySchema#flat() is not supported.")},S.prototype.findLast=function(){var y=Array.from(this.$items.values());return y.findLast.apply(y,arguments)},S.prototype.findLastIndex=function(){var y=Array.from(this.$items.values());return y.findLastIndex.apply(y,arguments)},S.prototype.setIndex=function(y,S){this.$indexes.set(y,S)},S.prototype.getIndex=function(y){return this.$indexes.get(y)},S.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},S.prototype.deleteByIndex=function(y){var S=this.$indexes.get(y);this.$items.delete(S),this.$indexes.delete(y)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){return this.toArray().map((function(y){return"function"===typeof y.toJSON?y.toJSON():y}))},S.prototype.clone=function(y){return y?new(S.bind.apply(S,i([void 0],Array.from(this.$items.values()),!1))):new(S.bind.apply(S,i([void 0],this.map((function(y){return y.$changes?y.clone():y})),!1)))},S}();function T(y){return y.$proxy=!0,y=new Proxy(y,{get:function(y,S){return"symbol"!==typeof S&&"undefined"===typeof y[S]?y.get(S):y[S]},set:function(y,S,I){return"symbol"!==typeof S&&-1===S.indexOf("$")&&"Qd"!==S&&"IV"!==S&&"onChange"!==S?y.set(S,I):y[S]=I,!0},deleteProperty:function(y,S){return y.delete(S),!0}})}var l=function(){function S(y){var I=this;if(this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y)if(y instanceof Map||y instanceof S)y.forEach((function(y,S){return I.set(S,y)}));else for(var V in y)this.set(V,y[V])}return S.prototype.Qd=function(S,I){return void 0===I&&(I=!0),J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,S,I?this.$items:void 0)},S.prototype.IV=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,S)},S.is=function(y){return void 0!==y.map},S.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(S.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(S,Symbol.species,{get:function(){return S},enumerable:!1,configurable:!0}),S.prototype.set=function(S,I){if(void 0===I||null===I)throw new Error("MapSchema#set('".concat(S,"', ").concat(I,"): trying to set ").concat(I," value on '").concat(S,"'."));S=S.toString();var V="undefined"!==typeof this.$changes.indexes[S],i=V?this.$changes.indexes[S]:this.$refId++,A=V?y.OPERATION.REPLACE:y.OPERATION.ADD,B=void 0!==I.$changes;if(B&&I.$changes.setParent(this,this.$changes.root,i),V){if(!B&&this.$items.get(S)===I)return;B&&this.$items.get(S)!==I&&(A=y.OPERATION.ADD)}else this.$changes.indexes[S]=i,this.$indexes.set(i,S);return this.$items.set(S,I),this.$changes.change(S,A),this},S.prototype.get=function(y){return this.$items.get(y)},S.prototype.delete=function(y){return this.$changes.delete(y),this.$items.delete(y)},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&u.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(y){return this.$items.has(y)},S.prototype.forEach=function(y){this.$items.forEach(y)},S.prototype.entries=function(){return this.$items.entries()},S.prototype.keys=function(){return this.$items.keys()},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(y,S){this.$indexes.set(y,S)},S.prototype.getIndex=function(y){return this.$indexes.get(y)},S.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},S.prototype.deleteByIndex=function(y){var S=this.$indexes.get(y);this.$items.delete(S),this.$indexes.delete(y)},S.prototype.toJSON=function(){var y={};return this.forEach((function(S,I){y[I]="function"===typeof S.toJSON?S.toJSON():S})),y},S.prototype.clone=function(y){var I;return y?I=Object.assign(new S,this):(I=new S,this.forEach((function(y,S){y.$changes?I.set(S,y.clone()):I.set(S,y)}))),I},S}(),j={};function s(y,S){j[y]=S}function O(y){return j[y]}var f=function(){function y(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return y.create=function(S){var I=new y;return I.schema=Object.assign({},S&&S.schema||{}),I.indexes=Object.assign({},S&&S.indexes||{}),I.fieldsByIndex=Object.assign({},S&&S.fieldsByIndex||{}),I.descriptors=Object.assign({},S&&S.descriptors||{}),I.deprecated=Object.assign({},S&&S.deprecated||{}),I},y.prototype.addField=function(y,S){var I=this.getNextFieldIndex();this.fieldsByIndex[I]=y,this.indexes[y]=I,this.schema[y]=Array.isArray(S)?{array:S[0]}:S},y.prototype.hasField=function(y){return void 0!==this.indexes[y]},y.prototype.addFilter=function(y,S){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[y]]=S,this.indexesWithFilters.push(this.indexes[y]),!0},y.prototype.addChildrenFilter=function(y,S){var I=this.indexes[y],V=this.schema[y];if(O(Object.keys(V)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[I]=S,!0;console.warn("@filterChildren: field '".concat(y,"' can't have children. Ignoring filter."))},y.prototype.getChildrenFilter=function(y){return this.childFilters&&this.childFilters[this.indexes[y]]},y.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},y}();function my(y){return y._context&&y._context.useFilters}var C=function(){function y(){this.types={},this.schemas=new Map,this.useFilters=!1}return y.prototype.has=function(y){return this.schemas.has(y)},y.prototype.get=function(y){return this.types[y]},y.prototype.add=function(y,S){void 0===S&&(S=this.schemas.size),y._definition=f.create(y._definition),y._typeid=S,this.types[S]=y,this.schemas.set(y,S)},y.create=function(S){return void 0===S&&(S={}),function(I){return S.context||(S.context=new y),o(I,S)}},y}(),D=new C;function o(y,S){return void 0===S&&(S={}),function(I,V){var A=S.context||D,B=I.constructor;if(B._context=A,!y)throw new Error("".concat(B.name,': @type() reference provided for "').concat(V,"\" is undefined. Make sure you don't have any circular dependencies."));A.has(B)||A.add(B);var d=B._definition;if(d.addField(V,y),d.descriptors[V]){if(d.deprecated[V])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(V,"' definition on '").concat(B.name,"'.\nCheck @type() annotation"))}catch(j){var F=j.stack.split("\n")[4].trim();throw new Error("".concat(j.message," ").concat(F))}}var J=L.is(y),u=!J&&l.is(y);if("string"!==typeof y&&!Py.is(y)){var K=Object.values(y)[0];"string"===typeof K||A.has(K)||A.add(K)}if(S.manual)d.descriptors[V]={enumerable:!0,configurable:!0,writable:!0};else{var G="_".concat(V);d.descriptors[G]={enumerable:!1,configurable:!1,writable:!0},d.descriptors[V]={get:function(){return this[G]},set:function(y){y!==this[G]&&(void 0!==y&&null!==y?(!J||y instanceof L||(y=new(L.bind.apply(L,i([void 0],y,!1)))),!u||y instanceof l||(y=new l(y)),void 0===y.$proxy&&(u?y=T(y):J&&(y=p(y))),this.$changes.change(V),y.$changes&&y.$changes.setParent(this,this.$changes.root,this._definition.indexes[V])):this[G]&&this.$changes.delete(V),this[G]=y)},enumerable:!0,configurable:!0}}}}function E(y){return function(S,I){var V=S.constructor;V._definition.addFilter(I,y)&&(V._context.useFilters=!0)}}function z(y){return function(S,I){var V=S.constructor;V._definition.addChildrenFilter(I,y)&&(V._context.useFilters=!0)}}function r(y){return void 0===y&&(y=!0),function(S,I){var V=S.constructor._definition;V.deprecated[I]=!0,y&&(V.descriptors[I]={get:function(){throw new Error("".concat(I," is deprecated."))},set:function(y){},enumerable:!1,configurable:!0})}}function h(y,S,I){for(var V in void 0===I&&(I={}),I.context||(I.context=y._context||I.context||D),S)o(S[V],I)(y.prototype,V);return y}function n(y){for(var S=0,I=0,V=0,i=y.length;V<i;V++)(S=y.charCodeAt(V))<128?I+=1:S<2048?I+=2:S<55296||S>=57344?I+=3:(V++,I+=4);return I}function v(y,S,I){for(var V=0,i=0,A=I.length;i<A;i++)(V=I.charCodeAt(i))<128?y[S++]=V:V<2048?(y[S++]=192|V>>6,y[S++]=128|63&V):V<55296||V>=57344?(y[S++]=224|V>>12,y[S++]=128|V>>6&63,y[S++]=128|63&V):(i++,V=65536+((1023&V)<<10|1023&I.charCodeAt(i)),y[S++]=240|V>>18,y[S++]=128|V>>12&63,y[S++]=128|V>>6&63,y[S++]=128|63&V)}function P(y,S){y.push(255&S)}function q(y,S){y.push(255&S)}function g(y,S){y.push(255&S),y.push(S>>8&255)}function k(y,S){y.push(255&S),y.push(S>>8&255)}function R(y,S){y.push(255&S),y.push(S>>8&255),y.push(S>>16&255),y.push(S>>24&255)}function b(y,S){var I=S>>24,V=S>>16,i=S>>8,A=S;y.push(255&A),y.push(255&i),y.push(255&V),y.push(255&I)}function U(y,S){var I=Math.floor(S/Math.pow(2,32));b(y,S>>>0),b(y,I)}function W(y,S){var I=S/Math.pow(2,32)|0;b(y,S>>>0),b(y,I)}function a(y,S){X(y,S)}function e(y,S){M(y,S)}var x=new Int32Array(2),Q=new Float32Array(x.buffer),c=new Float64Array(x.buffer);function X(y,S){Q[0]=S,R(y,x[0])}function M(y,S){c[0]=S,R(y,x[0]),R(y,x[1])}function t(y,S){return q(y,S?1:0)}function N(y,S){S||(S="");var I=n(S),V=0;if(I<32)y.push(160|I),V=1;else if(I<256)y.push(217),q(y,I),V=2;else if(I<65536)y.push(218),k(y,I),V=3;else{if(!(I<4294967296))throw new Error("String too long");y.push(219),b(y,I),V=5}return v(y,y.length,S),V+I}function Y(y,S){return isNaN(S)?Y(y,0):isFinite(S)?S!==(0|S)?(y.push(203),M(y,S),9):S>=0?S<128?(q(y,S),1):S<256?(y.push(204),q(y,S),2):S<65536?(y.push(205),k(y,S),3):S<4294967296?(y.push(206),b(y,S),5):(y.push(207),W(y,S),9):S>=-32?(y.push(224|S+32),1):S>=-128?(y.push(208),P(y,S),2):S>=-32768?(y.push(209),g(y,S),3):S>=-2147483648?(y.push(210),R(y,S),5):(y.push(211),U(y,S),9):Y(y,S>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var H=Object.freeze({__proto__:null,utf8Write:v,int8:P,uint8:q,int16:g,uint16:k,int32:R,uint32:b,int64:U,uint64:W,float32:a,float64:e,writeFloat32:X,writeFloat64:M,boolean:t,string:N,number:Y});function Z(y,S,I){for(var V="",i=0,A=S,B=S+I;A<B;A++){var d=y[A];0!==(128&d)?192!==(224&d)?224!==(240&d)?240!==(248&d)?console.error("Invalid byte "+d.toString(16)):(i=(7&d)<<18|(63&y[++A])<<12|(63&y[++A])<<6|63&y[++A])>=65536?(i-=65536,V+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):V+=String.fromCharCode(i):V+=String.fromCharCode((15&d)<<12|(63&y[++A])<<6|63&y[++A]):V+=String.fromCharCode((31&d)<<6|63&y[++A]):V+=String.fromCharCode(d)}return V}function w(y,S){return yy(y,S)<<24>>24}function yy(y,S){return y[S.offset++]}function Sy(y,S){return Iy(y,S)<<16>>16}function Iy(y,S){return y[S.offset++]|y[S.offset++]<<8}function Vy(y,S){return y[S.offset++]|y[S.offset++]<<8|y[S.offset++]<<16|y[S.offset++]<<24}function iy(y,S){return Vy(y,S)>>>0}function Ay(y,S){return Gy(y,S)}function By(y,S){return py(y,S)}function dy(y,S){var I=iy(y,S);return Vy(y,S)*Math.pow(2,32)+I}function Fy(y,S){var I=iy(y,S);return iy(y,S)*Math.pow(2,32)+I}var Jy=new Int32Array(2),uy=new Float32Array(Jy.buffer),Ky=new Float64Array(Jy.buffer);function Gy(y,S){return Jy[0]=Vy(y,S),uy[0]}function py(y,S){return Jy[0]=Vy(y,S),Jy[1]=Vy(y,S),Ky[0]}function Ly(y,S){return yy(y,S)>0}function Ty(y,S){var I,V=y[S.offset++];V<192?I=31&V:217===V?I=yy(y,S):218===V?I=Iy(y,S):219===V&&(I=iy(y,S));var i=Z(y,S.offset,I);return S.offset+=I,i}function ly(y,S){var I=y[S.offset];return I<192&&I>160||217===I||218===I||219===I}function jy(y,S){var I=y[S.offset++];return I<128?I:202===I?Gy(y,S):203===I?py(y,S):204===I?yy(y,S):205===I?Iy(y,S):206===I?iy(y,S):207===I?Fy(y,S):208===I?w(y,S):209===I?Sy(y,S):210===I?Vy(y,S):211===I?dy(y,S):I>223?-1*(255-I+1):void 0}function sy(y,S){var I=y[S.offset];return I<128||I>=202&&I<=211}function Oy(y,S){return y[S.offset]<160}function fy(y,S){return y[S.offset-1]===B&&(y[S.offset]<128||y[S.offset]>=202&&y[S.offset]<=211)}var mS=Object.freeze({__proto__:null,int8:w,uint8:yy,int16:Sy,uint16:Iy,int32:Vy,uint32:iy,float32:Ay,float64:By,int64:dy,uint64:Fy,readFloat32:Gy,readFloat64:py,boolean:Ly,string:Ty,stringCheck:ly,number:jy,numberCheck:sy,arrayCheck:Oy,switchStructureCheck:fy}),Cy=function(){function S(y){var S=this;this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y&&y.forEach((function(y){return S.add(y)}))}return S.prototype.Qd=function(S,I){return void 0===I&&(I=!0),J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,S,I?this.$items:void 0)},S.prototype.IV=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,S)},S.is=function(y){return void 0!==y.collection},S.prototype.add=function(y){var S=this.$refId++;return void 0!==y.$changes&&y.$changes.setParent(this,this.$changes.root,S),this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,y),this.$changes.change(S),S},S.prototype.at=function(y){var S=Array.from(this.$items.keys())[y];return this.$items.get(S)},S.prototype.entries=function(){return this.$items.entries()},S.prototype.delete=function(y){for(var S,I,V=this.$items.entries();(I=V.next())&&!I.done;)if(y===I.value[1]){S=I.value[0];break}return void 0!==S&&(this.$changes.delete(S),this.$indexes.delete(S),this.$items.delete(S))},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&u.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(y){return Array.from(this.$items.values()).some((function(S){return S===y}))},S.prototype.forEach=function(y){var S=this;this.$items.forEach((function(I,V,i){return y(I,V,S)}))},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(y,S){this.$indexes.set(y,S)},S.prototype.getIndex=function(y){return this.$indexes.get(y)},S.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},S.prototype.deleteByIndex=function(y){var S=this.$indexes.get(y);this.$items.delete(S),this.$indexes.delete(y)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){var y=[];return this.forEach((function(S,I){y.push("function"===typeof S.toJSON?S.toJSON():S)})),y},S.prototype.clone=function(y){var I;return y?I=Object.assign(new S,this):(I=new S,this.forEach((function(y){y.$changes?I.add(y.clone()):I.add(y)}))),I},S}(),Dy=function(){function S(y){var S=this;this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y&&y.forEach((function(y){return S.add(y)}))}return S.prototype.Qd=function(S,I){return void 0===I&&(I=!0),J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,S,I?this.$items:void 0)},S.prototype.IV=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,S)},S.is=function(y){return void 0!==y.set},S.prototype.add=function(S){var I,V;if(this.has(S))return!1;var i=this.$refId++;void 0!==S.$changes&&S.$changes.setParent(this,this.$changes.root,i);var A=null!==(V=null===(I=this.$changes.indexes[i])||void 0===I?void 0:I.op)&&void 0!==V?V:y.OPERATION.ADD;return this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,S),this.$changes.change(i,A),i},S.prototype.entries=function(){return this.$items.entries()},S.prototype.delete=function(y){for(var S,I,V=this.$items.entries();(I=V.next())&&!I.done;)if(y===I.value[1]){S=I.value[0];break}return void 0!==S&&(this.$changes.delete(S),this.$indexes.delete(S),this.$items.delete(S))},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&u.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(y){for(var S,I=this.$items.values(),V=!1;(S=I.next())&&!S.done;)if(y===S.value){V=!0;break}return V},S.prototype.forEach=function(y){var S=this;this.$items.forEach((function(I,V,i){return y(I,V,S)}))},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(y,S){this.$indexes.set(y,S)},S.prototype.getIndex=function(y){return this.$indexes.get(y)},S.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},S.prototype.deleteByIndex=function(y){var S=this.$indexes.get(y);this.$items.delete(S),this.$indexes.delete(y)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){var y=[];return this.forEach((function(S,I){y.push("function"===typeof S.toJSON?S.toJSON():S)})),y},S.prototype.clone=function(y){var I;return y?I=Object.assign(new S,this):(I=new S,this.forEach((function(y){y.$changes?I.add(y.clone()):I.add(y)}))),I},S}(),oy=function(){function y(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return y.prototype.addRefId=function(y){this.refIds.has(y)||(this.refIds.add(y),this.containerIndexes.set(y,new Set))},y.get=function(S){return void 0===S.$filterState&&(S.$filterState=new y),S.$filterState},y}(),Ey=function(){function y(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return y.prototype.getNextUniqueId=function(){return this.nextUniqueId++},y.prototype.addRef=function(y,S,I){void 0===I&&(I=!0),this.refs.set(y,S),I&&(this.refCounts[y]=(this.refCounts[y]||0)+1)},y.prototype.removeRef=function(y){this.refCounts[y]=this.refCounts[y]-1,this.deletedRefs.add(y)},y.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},y.prototype.garbageCollectDeletedRefs=function(){var y=this;this.deletedRefs.forEach((function(S){if(!(y.refCounts[S]>0)){var I=y.refs.get(S);if(I instanceof Py)for(var V in I._definition.schema)"string"!==typeof I._definition.schema[V]&&I[V]&&I[V].$changes&&y.removeRef(I[V].$changes.refId);else{var i=I.$changes.parent._definition,A=i.schema[i.fieldsByIndex[I.$changes.parentIndex]];"function"===typeof Object.values(A)[0]&&Array.from(I.values()).forEach((function(S){return y.removeRef(S.$changes.refId)}))}y.refs.delete(S),delete y.refCounts[S]}})),this.deletedRefs.clear()},y}(),zy=function(y){function S(){return null!==y&&y.apply(this,arguments)||this}return I(S,y),S}(Error);function ry(y,S,I,V){var i,A=!1;switch(S){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":i="number",isNaN(y)&&console.log('trying to encode "NaN" in '.concat(I.constructor.name,"#").concat(V));break;case"string":i="string",A=!0;break;case"boolean":return}if(typeof y!==i&&(!A||A&&null!==y)){var B="'".concat(JSON.stringify(y),"'").concat(y&&y.constructor&&" (".concat(y.constructor.name,")")||"");throw new zy("a '".concat(i,"' was expected, but ").concat(B," was provided in ").concat(I.constructor.name,"#").concat(V))}}function hy(y,S,I,V){if(!(y instanceof S))throw new zy("a '".concat(S.name,"' was expected, but '").concat(y.constructor.name,"' was provided in ").concat(I.constructor.name,"#").concat(V))}function ny(y,S,I,V,i){ry(I,y,V,i);var A=H[y];if(!A)throw new zy("a '".concat(y,"' was expected, but ").concat(I," was provided in ").concat(V.constructor.name,"#").concat(i));A(S,I)}function vy(y,S,I){return mS[y](S,I)}var Py=function(){function S(){for(var y=[],S=0;S<arguments.length;S++)y[S]=arguments[S];Object.defineProperties(this,{$changes:{value:new F(this,void 0,new Ey),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var I=this._definition.descriptors;I&&Object.defineProperties(this,I),y[0]&&this.assign(y[0])}return S.onError=function(y){console.error(y)},S.is=function(y){return y._definition&&void 0!==y._definition.schema},S.prototype.onChange=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,S)},S.prototype.IV=function(S){return J(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,S)},S.prototype.assign=function(y){return Object.assign(this,y),this},Object.defineProperty(S.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),S.prototype.setDirty=function(y,S){this.$changes.change(y,S)},S.prototype.listen=function(y,S,I){var V=this;return void 0===I&&(I=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[y]||(this.$callbacks[y]=[]),this.$callbacks[y].push(S),I&&void 0!==this[y]&&S(this[y],void 0),function(){return K(V.$callbacks[y],V.$callbacks[y].indexOf(S))}},S.prototype.decode=function(I,V,i){var A;void 0===V&&(V={offset:0}),void 0===i&&(i=this);var d=[],F=this.$changes.root,J=I.length,u=0;for(F.refs.set(u,this);V.offset<J;){var K=I[V.offset++];if(K!=B){var G=i.$changes,p=void 0!==i._definition,T=p?K>>6<<6:K;if(T!==y.OPERATION.CLEAR){var j=p?K%(T||255):jy(I,V),s=p?i._definition.fieldsByIndex[j]:"",f=G.getType(j),my=void 0,C=void 0,D=void 0;if(p?C=i["_".concat(s)]:(C=i.getByIndex(j),(T&y.OPERATION.ADD)===y.OPERATION.ADD?(D=i instanceof l?Ty(I,V):j,i.setIndex(j,D)):D=i.getIndex(j)),(T&y.OPERATION.DELETE)===y.OPERATION.DELETE&&(T!==y.OPERATION.DELETE_AND_ADD&&i.deleteByIndex(j),C&&C.$changes&&F.removeRef(C.$changes.refId),my=null),void 0!==s){if(T===y.OPERATION.DELETE);else if(S.is(f)){var o=jy(I,V);if(my=F.refs.get(o),T!==y.OPERATION.REPLACE){var E=this.getSchemaType(I,V,f);my||((my=this.createTypeInstance(E)).$changes.refId=o,C&&(my.$callbacks=C.$callbacks,C.$changes.refId&&o!==C.$changes.refId&&F.removeRef(C.$changes.refId))),F.addRef(o,my,my!==C)}}else if("string"===typeof f)my=vy(f,I,V);else{var z=O(Object.keys(f)[0]),r=jy(I,V),h=F.refs.has(r)?C||F.refs.get(r):new z.constructor;if((my=h.clone(!0)).$changes.refId=r,C&&(my.$callbacks=C.$callbacks,C.$changes.refId&&r!==C.$changes.refId)){F.removeRef(C.$changes.refId);for(var n=C.entries(),v=void 0;(v=n.next())&&!v.done;){var P=(A=v.value)[0],q=A[1];d.push({refId:r,op:y.OPERATION.DELETE,field:P,value:void 0,previousValue:q})}}F.addRef(r,my,h!==C)}if(null!==my&&void 0!==my)if(my.$changes&&my.$changes.setParent(G.ref,G.root,j),i instanceof S)i[s]=my;else if(i instanceof l)P=D,i.$items.set(P,my),i.$changes.allChanges.add(j);else if(i instanceof L)i.setAt(j,my);else if(i instanceof Cy){var g=i.add(my);i.setIndex(j,g)}else i instanceof Dy&&!1!==(g=i.add(my))&&i.setIndex(j,g);C!==my&&d.push({refId:u,op:T,field:s,dynamicIndex:D,value:my,previousValue:C})}else{console.warn("@colyseus/schema: definition mismatch");for(var k={offset:V.offset};V.offset<J&&(!fy(I,V)||(k.offset=V.offset+1,!F.refs.has(jy(I,k))));)V.offset++}}else i.clear(d)}else{u=jy(I,V);var R=F.refs.get(u);if(!R)throw new Error('"refId" not found: '.concat(u));i=R}}return this._triggerChanges(d),F.garbageCollectDeletedRefs(),d},S.prototype.encode=function(I,V,i){void 0===I&&(I=!1),void 0===V&&(V=[]),void 0===i&&(i=!1);for(var A=this.$changes,d=new WeakSet,F=[A],J=1,u=0;u<J;u++){var K=F[u],G=K.ref,p=G instanceof S;K.ensureRefId(),d.add(K),K!==A&&(K.changed||I)&&(q(V,B),Y(V,K.refId));for(var L=I?Array.from(K.allChanges):Array.from(K.changes.values()),T=0,j=L.length;T<j;T++){var s=I?{op:y.OPERATION.ADD,index:L[T]}:L[T],f=s.index,my=p?G._definition.fieldsByIndex&&G._definition.fieldsByIndex[f]:f,C=V.length;if(s.op!==y.OPERATION.TOUCH)if(p)q(V,f|s.op);else{if(q(V,s.op),s.op===y.OPERATION.CLEAR)continue;Y(V,f)}if(p||(s.op&y.OPERATION.ADD)!=y.OPERATION.ADD||G instanceof l&&N(V,K.ref.$indexes.get(f)),s.op!==y.OPERATION.DELETE){var D=K.getType(f),o=K.getValue(f);if(o&&o.$changes&&!d.has(o.$changes)&&(F.push(o.$changes),o.$changes.ensureRefId(),J++),s.op!==y.OPERATION.TOUCH){if(S.is(D))hy(o,D,G,my),Y(V,o.$changes.refId),(s.op&y.OPERATION.ADD)===y.OPERATION.ADD&&this.tryEncodeTypeId(V,D,o.constructor);else if("string"===typeof D)ny(D,V,o,G,my);else{var E=O(Object.keys(D)[0]);hy(G["_".concat(my)],E.constructor,G,my),Y(V,o.$changes.refId)}i&&K.cache(f,V.slice(C))}}}I||i||K.discard()}return V},S.prototype.encodeAll=function(y){return this.encode(!0,[],y)},S.prototype.applyFilters=function(I,V){var i,A;void 0===V&&(V=!1);for(var d=this,F=new Set,J=oy.get(I),u=[this.$changes],K=1,G=[],p=function(p){var L=u[p];if(F.has(L.refId))return"continue";var T=L.ref,j=T instanceof S;q(G,B),Y(G,L.refId);var s=J.refIds.has(L),O=V||!s;J.addRefId(L);var f=J.containerIndexes.get(L),my=O?Array.from(L.allChanges):Array.from(L.changes.values());!V&&j&&T._definition.indexesWithFilters&&T._definition.indexesWithFilters.forEach((function(S){!f.has(S)&&L.allChanges.has(S)&&(O?my.push(S):my.push({op:y.OPERATION.ADD,index:S}))}));for(var C=0,D=my.length;C<D;C++){var o=O?{op:y.OPERATION.ADD,index:my[C]}:my[C];if(o.op!==y.OPERATION.CLEAR){var E=o.index;if(o.op!==y.OPERATION.DELETE){var z=L.getValue(E),r=L.getType(E);if(j){if((h=T._definition.filters&&T._definition.filters[E])&&!h.call(T,I,z,d)){z&&z.$changes&&F.add(z.$changes.refId);continue}}else{var h,n=L.parent;if((h=L.getChildrenFilter())&&!h.call(n,I,T.$indexes.get(E),z,d)){z&&z.$changes&&F.add(z.$changes.refId);continue}}if(z.$changes&&(u.push(z.$changes),K++),o.op!==y.OPERATION.TOUCH)if(o.op===y.OPERATION.ADD||j)G.push.apply(G,null!==(i=L.caches[E])&&void 0!==i?i:[]),f.add(E);else if(f.has(E))G.push.apply(G,null!==(A=L.caches[E])&&void 0!==A?A:[]);else{if(f.add(E),q(G,y.OPERATION.ADD),Y(G,E),T instanceof l){var v=L.ref.$indexes.get(E);N(G,v)}z.$changes?Y(G,z.$changes.refId):H[r](G,z)}else z.$changes&&!j&&(q(G,y.OPERATION.ADD),Y(G,E),T instanceof l&&(v=L.ref.$indexes.get(E),N(G,v)),Y(G,z.$changes.refId))}else j?q(G,o.op|E):(q(G,o.op),Y(G,E))}else q(G,o.op)}},L=0;L<K;L++)p(L);return G},S.prototype.clone=function(){var y,S=new this.constructor,I=this._definition.schema;for(var V in I)"object"===typeof this[V]&&"function"===typeof(null===(y=this[V])||void 0===y?void 0:y.clone)?S[V]=this[V].clone():S[V]=this[V];return S},S.prototype.toJSON=function(){var y=this._definition.schema,S=this._definition.deprecated,I={};for(var V in y)S[V]||null===this[V]||"undefined"===typeof this[V]||(I[V]="function"===typeof this[V].toJSON?this[V].toJSON():this["_".concat(V)]);return I},S.prototype.discardAllChanges=function(){this.$changes.discardAll()},S.prototype.getByIndex=function(y){return this[this._definition.fieldsByIndex[y]]},S.prototype.deleteByIndex=function(y){this[this._definition.fieldsByIndex[y]]=void 0},S.prototype.tryEncodeTypeId=function(y,S,I){S._typeid!==I._typeid&&(q(y,d),Y(y,I._typeid))},S.prototype.getSchemaType=function(y,S,I){var V;return y[S.offset]===d&&(S.offset++,V=this.constructor._context.get(jy(y,S))),V||I},S.prototype.createTypeInstance=function(y){var S=new y;return S.$changes.root=this.$changes.root,S},S.prototype._triggerChanges=function(I){for(var V,i,A,B,d,F,J,u,K,G=new Set,p=this.$changes.root.refs,L=function(L){var T=I[L],l=T.refId,j=p.get(l),s=j.$callbacks;if((T.op&y.OPERATION.DELETE)===y.OPERATION.DELETE&&T.previousValue instanceof S&&(null===(i=null===(V=T.previousValue.$callbacks)||void 0===V?void 0:V[y.OPERATION.DELETE])||void 0===i||i.forEach((function(y){return y()}))),!s)return"continue";if(j instanceof S){if(!G.has(l))try{null===(A=null===s||void 0===s?void 0:s[y.OPERATION.REPLACE])||void 0===A||A.forEach((function(y){return y()}))}catch(O){S.onError(O)}try{s.hasOwnProperty(T.field)&&(null===(B=s[T.field])||void 0===B||B.forEach((function(y){return y(T.value,T.previousValue)})))}catch(O){S.onError(O)}}else T.op===y.OPERATION.ADD&&void 0===T.previousValue?null===(d=s[y.OPERATION.ADD])||void 0===d||d.forEach((function(y){var S;return y(T.value,null!==(S=T.dynamicIndex)&&void 0!==S?S:T.field)})):T.op===y.OPERATION.DELETE?void 0!==T.previousValue&&(null===(F=s[y.OPERATION.DELETE])||void 0===F||F.forEach((function(y){var S;return y(T.previousValue,null!==(S=T.dynamicIndex)&&void 0!==S?S:T.field)}))):T.op===y.OPERATION.DELETE_AND_ADD&&(void 0!==T.previousValue&&(null===(J=s[y.OPERATION.DELETE])||void 0===J||J.forEach((function(y){var S;return y(T.previousValue,null!==(S=T.dynamicIndex)&&void 0!==S?S:T.field)}))),null===(u=s[y.OPERATION.ADD])||void 0===u||u.forEach((function(y){var S;return y(T.value,null!==(S=T.dynamicIndex)&&void 0!==S?S:T.field)}))),T.value!==T.previousValue&&(null===(K=s[y.OPERATION.REPLACE])||void 0===K||K.forEach((function(y){var S;return y(T.value,null!==(S=T.dynamicIndex)&&void 0!==S?S:T.field)})));G.add(l)},T=0;T<I.length;T++)L(T)},S._definition=f.create(),S}();function qy(y){for(var S=[y.$changes],I=1,V={},i=V,A=function(y){var I=S[y];I.changes.forEach((function(y){var S=I.ref,V=y.index,A=S._definition?S._definition.fieldsByIndex[V]:S.$indexes.get(V);i[A]=I.getValue(V)}))},B=0;B<I;B++)A(B);return V}var gy={context:new C},ky=function(y){function S(){return null!==y&&y.apply(this,arguments)||this}return I(S,y),V([o("string",gy)],S.prototype,"name",void 0),V([o("string",gy)],S.prototype,"type",void 0),V([o("number",gy)],S.prototype,"referencedType",void 0),S}(Py),Ry=function(y){function S(){var S=null!==y&&y.apply(this,arguments)||this;return S.fields=new L,S}return I(S,y),V([o("number",gy)],S.prototype,"id",void 0),V([o([ky],gy)],S.prototype,"fields",void 0),S}(Py),by=function(y){function S(){var S=null!==y&&y.apply(this,arguments)||this;return S.types=new L,S}return I(S,y),S.encode=function(y){var I=y.constructor,V=new S;V.rootType=I._typeid;var i=function(y,S){for(var I in S){var i=new ky;i.name=I;var A=void 0;if("string"===typeof S[I])A=S[I];else{var B=S[I],d=void 0;Py.is(B)?(A="ref",d=S[I]):"string"===typeof B[A=Object.keys(B)[0]]?A+=":"+B[A]:d=B[A],i.referencedType=d?d._typeid:-1}i.type=A,y.fields.push(i)}V.types.push(y)},A=I._context.types;for(var B in A){var d=new Ry;d.id=Number(B),i(d,A[B]._definition.schema)}return V.encodeAll()},S.decode=function(y,V){var i=new C,A=new S;A.decode(y,V);var B=A.types.reduce((function(y,S){var V=function(y){function S(){return null!==y&&y.apply(this,arguments)||this}return I(S,y),S}(Py),A=S.id;return y[A]=V,i.add(V,A),y}),{});A.types.forEach((function(y){var S=B[y.id];y.fields.forEach((function(y){var I;if(void 0!==y.referencedType){var V=y.type,A=B[y.referencedType];if(!A){var d=y.type.split(":");V=d[0],A=d[1]}"ref"===V?o(A,{context:i})(S.prototype,y.name):o(((I={})[V]=A,I),{context:i})(S.prototype,y.name)}else o(y.type,{context:i})(S.prototype,y.name)}))}));var d=B[A.rootType],F=new d;for(var J in d._definition.schema){var u=d._definition.schema[J];"string"!==typeof u&&(F[J]="function"===typeof u?new u:new(O(Object.keys(u)[0]).constructor))}return F},V([o([Ry],gy)],S.prototype,"types",void 0),V([o("number",gy)],S.prototype,"rootType",void 0),S}(Py);s("map",{constructor:l}),s("array",{constructor:L}),s("set",{constructor:Dy}),s("collection",{constructor:Cy}),y.ArraySchema=L,y.CollectionSchema=Cy,y.Context=C,y.MapSchema=l,y.Reflection=by,y.ReflectionField=ky,y.ReflectionType=Ry,y.Schema=Py,y.SchemaDefinition=f,y.SetSchema=Dy,y.decode=mS,y.defineTypes=h,y.deprecated=r,y.dumpChanges=qy,y.encode=H,y.filter=E,y.filterChildren=z,y.hasFilter=my,y.registerType=s,y.type=o,Object.defineProperty(y,"__esModule",{value:!0})}(S)},14429:function(y,S,I){var V,i,A;function B(){const y=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(B=function(){return y})()}function d(y,S){const I=B();return(d=function(y,S){return I[y-=212]})(y,S)}y=I.nmd(y),function(y){const S=d,I=y();for(;;)try{if(368192===parseInt(S(328))/1+parseInt(S(379))/2*(-parseInt(S(226))/3)+parseInt(S(348))/4*(parseInt(S(264))/5)+parseInt(S(224))/6*(-parseInt(S(223))/7)+-parseInt(S(345))/8*(parseInt(S(325))/9)+-parseInt(S(215))/10+-parseInt(S(275))/11*(-parseInt(S(383))/12))break;I.push(I.shift())}catch(V){I.push(I.shift())}}(B),function(B,F){const J=d;J(262)==typeof S&&"object"==J(262)?y[J(337)]=F():"function"==J(237)&&I.amdD[J(400)]?(i=[],void 0===(A="function"===typeof(V=F)?V.apply(S,i):V)||(y.exports=A)):J(262)==typeof S?S[J(277)]=F():B[J(277)]=F()}(this,(()=>(()=>{var y={646:function(y){y[d(337)]=function(){"use strict";function y(y){const S=d;for(var I=1;I<arguments[S(302)];I++){var V=arguments[I];for(var i in V)y[i]=V[i]}return y}return function S(I,V){const i=d;function A(S,i,A){const B=d;if(B(363)!=typeof document){"number"==typeof(A=y({},V,A))[B(278)]&&(A[B(278)]=new Date(Date[B(235)]()+864e5*A[B(278)])),A[B(278)]&&(A[B(278)]=A[B(278)][B(351)]()),S=encodeURIComponent(S).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[B(320)](/[()]/g,escape);var F="";for(var J in A)A[J]&&(F+="; "+J,!0!==A[J]&&(F+="="+A[J][B(335)](";")[0]));return document[B(295)]=S+"="+I[B(349)](i,S)+F}}return Object[i(260)]({set:A,get:function(y){const S=d;if(S(363)!=typeof document&&(!arguments[S(302)]||y)){for(var V=document.cookie?document[S(295)][S(335)]("; "):[],i={},A=0;A<V[S(302)];A++){var B=V[A][S(335)]("="),F=B[S(396)](1)[S(323)]("=");try{var J=decodeURIComponent(B[0]);if(i[J]=I[S(366)](F,J),y===J)break}catch(u){}}return y?i[y]:i}},remove:function(S,I){A(S,"",y({},I,{expires:-1}))},withAttributes:function(I){return S(this[i(359)],y({},this.attributes,I))},withConverter:function(I){const V=i;return S(y({},this[V(359)],I),this[V(398)])}},{attributes:{value:Object[i(315)](V)},converter:{value:Object.freeze(I)}})}({read:function(y){const S=d;return'"'===y[0]&&(y=y[S(396)](1,-1)),y.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(y){const S=d;return encodeURIComponent(y)[S(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(y,S,I)=>{"use strict";const V=d;Object[V(228)](S,V(220),{value:!0}),S[V(382)]=void 0;const i=I(284);class A{static[V(218)](){const y=V;console[y(395)](y(212)),window.addEventListener(y(297),A[y(258)])}static onBeforeUnload(){const y=V;i[y(313)][y(236)]()}}S[V(382)]=A},719:(y,S,I)=>{"use strict";const V=d;Object.defineProperty(S,"__esModule",{value:!0}),S[V(290)]=void 0;const i=I(284),A=I(878);S[V(290)]=class{static[V(307)](y,S,I){const A=V;i.ByteBrewCore[A(307)](y,S,I)}static[V(339)](){const y=V;return i[y(313)][y(393)]}static[V(239)](y,S){const I=V;void 0===S?i.ByteBrewCore[I(239)](y):I(240)==typeof S?i.ByteBrewCore[I(247)](y,S):I(270)==typeof S?i[I(313)][I(243)](y,S):I(262)==typeof S&&i[I(313)][I(286)](y,S)}static loadRemoteConfigs(y){const S=V;A.RemoteConfigHandler[S(282)](y)}static[V(233)](y,S){const I=V;return A[I(272)][I(233)](y,S)}static[V(369)](){const y=V;return A[y(272)][y(369)]()}static[V(391)](){const y=V;i[y(313)][y(391)]()}static[V(384)](){const y=V;i[y(313)][y(384)]()}static[V(213)](){return i.ByteBrewCore.userID}}},441:function(y,S,I){"use strict";const V=d;var i=this&&this[V(329)]||function(y){return y&&y[V(220)]?y:{default:y}};Object[V(228)](S,V(220),{value:!0}),S[V(397)]=void 0;const A=i(I(646)),B=I(429);class F{static[V(332)](){const y=V,S=A[y(334)][y(311)](F[y(231)]);return S?{userID:S,isNewUser:!1,hasSuccessfullyInitialized:F[y(394)]()}:{userID:F.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[V(230)](){const y=V,S=(0,B.v4)();return A.default[y(242)](F[y(231)],S,{expires:365}),S}static setTrackingSettingsCookie(y){const S=V,I=S(y?248:367);A[S(334)].set(F[S(225)],I,{expires:365})}static[V(314)](){const y=V,S=A[y(334)][y(311)](F.trackingSettingsIDCookieKey);return!S||"true"===S}static[V(356)](){return F.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const y=V,S=A.default[y(311)](F[y(231)]);S&&A.default[y(242)](F.userHasInitializedSuccessfullyCookieKey,S,{expires:365})}static[V(330)](){const y=V,S=A[y(334)][y(311)](F[y(326)]),I=A[y(334)][y(311)](F[y(231)]);return!(!S||!I)&&S===I}static hasUserInitialized(){return F[V(330)]()}}S.ByteBrewCookieManager=F,F.userIDCookieKey=V(361),F.trackingSettingsIDCookieKey=V(357),F[V(326)]="bb_u_h_init"},284:(y,S,I)=>{"use strict";const V=d;Object[V(228)](S,V(220),{value:!0}),S[V(313)]=void 0;const i=I(441),A=I(797),B=I(334),F=I(429),J=I(147);class u{static[V(246)](){const y=V;let S=navigator[y(281)][y(335)]("-");return S.length<2?"??":S[S.length-1]||"??"}static[V(307)](y,S,I){const A=V;if(u[A(393)])return;if(console[A(395)]("ByteBrew: Starting Initialization"),!y||!S)return void console.log(A(256));if(u[A(221)]=i[A(397)][A(356)](),!u.trackingEnabled)return void console[A(395)](A(362));u[A(399)]=y,u[A(249)]=S,u[A(336)]=I,u.sessionID=(0,F.v4)(),u.sessionKey="",u[A(300)]=J[A(305)],u.language=navigator[A(281)],u[A(385)]=u[A(246)]();const d=i[A(397)][A(332)]();u[A(308)]=d[A(308)],d.isNewUser||!d[A(293)]?u.createNewUserEvent():u[A(344)](),u[A(331)]=new Date,B[A(382)][A(218)]()}static reinitializeByteBrew(){const y=V;console[y(395)](y(306)),u.initializeByteBrew(u[y(399)],u[y(249)],u[y(336)])}static[V(387)](y){const S=V;u[S(214)]=y,u[S(393)]=!0,u.hasBeenInitializedWhilePageOpen=!0,i[S(397)][S(296)](),console[S(395)](S(386))}static[V(301)](){const y=V;u[y(303)]&&(console.log(y(341)),this[y(217)]())}static[V(372)](){return u[V(393)]&&u.trackingEnabled}static getScreenResolution(){return window[V(227)]+"x"+window.innerHeight}static[V(241)](){const y=V;return{game_id:u[y(399)],user_id:u[y(308)],session_id:u[y(318)],session_key:u.sessionKey,platform:u.platform}}static[V(244)](){const y=V;return Object[y(219)](Object[y(219)]({},u[y(241)]()),{version_number:u[y(336)],sdk_version:u[y(300)],deviceScreenSize:u[y(280)](),tracking_enabled:u[y(221)]})}static[V(283)](y,S){const I=V;A.ByteBrewWebRequestor[I(380)](y,S).then((y=>{const S=I;if(y&&y.ok){const I=y.headers.get(S(354));I?u.onInitializationSuccessful(I):console[S(395)](S(381))}else console[S(395)](S(232)+(y?y[S(259)]:"No Response"))}))}static createUserEvent(){const y=V;if(!u[y(221)])return;console.log(y(353));let S={eventType:"game_open",userLocale:u[y(281)]};const I=Object[y(219)](Object[y(219)]({},u[y(244)]()),{category:y(269),geo:u[y(385)],externalData:S});u[y(283)](A.ByteBrewWebRequestor[y(238)],I)}static[V(285)](){const y=V;if(!u[y(221)])return;console[y(395)](y(352));let S={eventType:y(309),userLocale:u[y(281)]};const I=Object.assign(Object.assign({},u.getFullEventObject()),{category:y(269),geo:u[y(385)],externalData:S});u[y(283)](A[y(265)][y(238)],I)}static endCurrentSession(){const y=V;if(!u[y(372)]())return;u[y(393)]=!1,console.log(y(350));const S=new Date;let I={sessionLength:Math[y(287)]((S[y(253)]()-u[y(331)].getTime())/1e3)[y(251)]()};const i=Object[y(219)](Object[y(219)]({},u[y(244)]()),{category:y(401),externalData:I});A.ByteBrewWebRequestor[y(380)](A[y(265)][y(238)],i)}static[V(252)](y){const S=V;let I="";if(!y)return I;for(const[V,i]of Object.entries(y))I+=V+"="+i+";";return I[S(302)]>0&&(I=I[S(396)](0,-1)),I}static[V(368)](y,S){const I=V;if(!u.canSendData())return;console[I(395)](I(374)+y);let i={eventType:y};S&&(i=Object.assign(Object[I(219)]({},i),{value:"object"==typeof S?u[I(252)](S):S[I(251)]()}));const B=Object[I(219)](Object[I(219)]({},u[I(244)]()),{category:"custom",externalData:i});A.ByteBrewWebRequestor[I(380)](A[I(265)][I(238)],B)[I(378)]((y=>{const S=I;y&&y.ok?console.log(S(274)):console[S(395)](S(294)+(y?y.status:S(267)))}))}static[V(239)](y){u[V(368)](y,null)}static[V(247)](y,S){u.sendCustomEvent(y,S)}static newCustomEventWithNumber(y,S){u.sendCustomEvent(y,S)}static[V(286)](y,S){u[V(368)](y,S)}static[V(391)](){const y=V;console[y(395)]("ByteBrew: Restarting Tracking"),u[y(221)]=!0,i[y(397)][y(360)](!0),u[y(217)]()}static[V(384)](){const y=V;console[y(395)](y(257)),u[y(221)]=!1,i.ByteBrewCookieManager[y(360)](!1)}}S[V(313)]=u,u[V(393)]=!1,u[V(303)]=!1,u[V(261)]="Web"},797:function(y,S,I){"use strict";const V=d;var i=this&&this[V(342)]||function(y,S,I,V){return new(I||(I=Promise))((function(i,A){const B=d;function F(y){try{u(V.next(y))}catch(S){A(S)}}function J(y){try{u(V.throw(y))}catch(S){A(S)}}function u(y){const S=d;var V;y.done?i(y.value):(V=y[S(234)],V instanceof I?V:new I((function(y){y(V)})))[S(378)](F,J)}u((V=V[B(222)](y,S||[]))[B(255)]())}))};Object[V(228)](S,V(220),{value:!0}),S[V(265)]=void 0;const A=I(284);class B{static sendBasicRequest(y,S){return i(this,void 0,void 0,(function*(){const I=d;try{const V={method:"POST",mode:I(358),headers:{Accept:I(304),"Content-Type":I(289),"sdk-key":A[I(313)][I(249)]},body:JSON.stringify(S),keepalive:!0};return yield B[I(298)](y,V)}catch(V){console[I(284)](V)}}))}static[V(343)](y){return i(this,void 0,void 0,(function*(){const S=d;try{const I={method:S(392),mode:"cors",headers:{Accept:S(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":A[S(313)][S(249)],user_id:A[S(313)][S(308)]}};return yield B[S(298)](y,I)}catch(I){console[S(284)](I)}}))}static[V(298)](y,S){return i(this,void 0,void 0,(function*(){const I=d;try{const V=yield fetch(y,S);return V.ok||console[I(284)]("Request failed with status "+V[I(259)]),V}catch(V){console[I(284)](V)}}))}}S.ByteBrewWebRequestor=B,B[V(238)]=V(390),B[V(268)]=V(389)},878:(y,S,I)=>{"use strict";const V=d;Object.defineProperty(S,V(220),{value:!0}),S[V(272)]=void 0;const i=I(284),A=I(797);class B{static[V(292)](y){B.remoteConfigs=y}static hasRemoteConfigsBeenSet(){return!!B[V(216)]}static loadRemoteConfigs(y){const S=V;A[S(265)][S(343)](A[S(265)][S(268)]+i[S(313)].appID)[S(378)]((I=>{const V=S;I&&I.ok?I[V(371)]()[V(378)]((S=>{const I=V;let i=null;try{i=new Map(Object[I(370)](JSON[I(250)](S))),console[I(395)](I(266))}catch(A){i=null,console[I(284)](I(388))}finally{B[I(292)](i),i&&y(i)}})):I?console.error(V(322)+(I?I[V(259)]:V(267))+" "+(I?I.statusText:"")):console[V(284)](V(279))}))}static[V(233)](y,S){const I=V;return B[I(369)]()&&B.remoteConfigs[I(364)](y)?B[I(216)][I(311)](y):S}}S[V(272)]=B,B[V(216)]=null},429:(y,S,I)=>{"use strict";const V=d;Object.defineProperty(S,V(220),{value:!0}),Object[V(228)](S,V(319),{enumerable:!0,get:function(){return J[V(334)]}}),Object[V(228)](S,V(250),{enumerable:!0,get:function(){return p.default}}),Object[V(228)](S,V(333),{enumerable:!0,get:function(){return G[V(334)]}}),Object.defineProperty(S,"v1",{enumerable:!0,get:function(){return i[V(334)]}}),Object[V(228)](S,"v3",{enumerable:!0,get:function(){return A[V(334)]}}),Object[V(228)](S,"v4",{enumerable:!0,get:function(){return B[V(334)]}}),Object[V(228)](S,"v5",{enumerable:!0,get:function(){return F[V(334)]}}),Object.defineProperty(S,V(310),{enumerable:!0,get:function(){return K[V(334)]}}),Object[V(228)](S,"version",{enumerable:!0,get:function(){return u[V(334)]}});var i=L(I(990)),A=L(I(237)),B=L(I(355)),F=L(I(764)),J=L(I(314)),u=L(I(464)),K=L(I(435)),G=L(I(8)),p=L(I(222));function L(y){return y&&y[V(220)]?y:{default:y}}},163:(y,S)=>{"use strict";const I=d;function V(y){return 14+(y+64>>>9<<4)+1}function i(y,S){const I=(65535&y)+(65535&S);return(y>>16)+(S>>16)+(I>>16)<<16|65535&I}function A(y,S,I,V,A,B){return i((d=i(i(S,y),i(V,B)))<<(F=A)|d>>>32-F,I);var d,F}function B(y,S,I,V,i,B,d){return A(S&I|~S&V,y,S,i,B,d)}function F(y,S,I,V,i,B,d){return A(S&V|I&~V,y,S,i,B,d)}function J(y,S,I,V,i,B,d){return A(S^I^V,y,S,i,B,d)}function u(y,S,I,V,i,B,d){return A(I^(S|~V),y,S,i,B,d)}Object.defineProperty(S,I(220),{value:!0}),S[I(334)]=void 0;S.default=function(y){const S=I;if(S(240)==typeof y){const I=unescape(encodeURIComponent(y));y=new Uint8Array(I[S(302)]);for(let V=0;V<I[S(302)];++V)y[V]=I[S(312)](V)}return function(y){const I=S,V=[],i=32*y.length,A=I(276);for(let S=0;S<i;S+=8){const i=y[S>>5]>>>S%32&255,B=parseInt(A[I(376)](i>>>4&15)+A[I(376)](15&i),16);V[I(288)](B)}return V}(function(y,I){const A=S;y[I>>5]|=128<<I%32,y[V(I)-1]=I;let d=1732584193,K=-271733879,G=-1732584194,p=271733878;for(let S=0;S<y[A(302)];S+=16){const I=d,V=K,A=G,L=p;d=B(d,K,G,p,y[S],7,-680876936),p=B(p,d,K,G,y[S+1],12,-389564586),G=B(G,p,d,K,y[S+2],17,606105819),K=B(K,G,p,d,y[S+3],22,-1044525330),d=B(d,K,G,p,y[S+4],7,-176418897),p=B(p,d,K,G,y[S+5],12,1200080426),G=B(G,p,d,K,y[S+6],17,-1473231341),K=B(K,G,p,d,y[S+7],22,-45705983),d=B(d,K,G,p,y[S+8],7,1770035416),p=B(p,d,K,G,y[S+9],12,-1958414417),G=B(G,p,d,K,y[S+10],17,-42063),K=B(K,G,p,d,y[S+11],22,-1990404162),d=B(d,K,G,p,y[S+12],7,1804603682),p=B(p,d,K,G,y[S+13],12,-40341101),G=B(G,p,d,K,y[S+14],17,-1502002290),K=B(K,G,p,d,y[S+15],22,1236535329),d=F(d,K,G,p,y[S+1],5,-165796510),p=F(p,d,K,G,y[S+6],9,-1069501632),G=F(G,p,d,K,y[S+11],14,643717713),K=F(K,G,p,d,y[S],20,-373897302),d=F(d,K,G,p,y[S+5],5,-701558691),p=F(p,d,K,G,y[S+10],9,38016083),G=F(G,p,d,K,y[S+15],14,-660478335),K=F(K,G,p,d,y[S+4],20,-405537848),d=F(d,K,G,p,y[S+9],5,568446438),p=F(p,d,K,G,y[S+14],9,-1019803690),G=F(G,p,d,K,y[S+3],14,-187363961),K=F(K,G,p,d,y[S+8],20,1163531501),d=F(d,K,G,p,y[S+13],5,-1444681467),p=F(p,d,K,G,y[S+2],9,-51403784),G=F(G,p,d,K,y[S+7],14,1735328473),K=F(K,G,p,d,y[S+12],20,-1926607734),d=J(d,K,G,p,y[S+5],4,-378558),p=J(p,d,K,G,y[S+8],11,-2022574463),G=J(G,p,d,K,y[S+11],16,1839030562),K=J(K,G,p,d,y[S+14],23,-35309556),d=J(d,K,G,p,y[S+1],4,-1530992060),p=J(p,d,K,G,y[S+4],11,1272893353),G=J(G,p,d,K,y[S+7],16,-155497632),K=J(K,G,p,d,y[S+10],23,-1094730640),d=J(d,K,G,p,y[S+13],4,681279174),p=J(p,d,K,G,y[S],11,-358537222),G=J(G,p,d,K,y[S+3],16,-722521979),K=J(K,G,p,d,y[S+6],23,76029189),d=J(d,K,G,p,y[S+9],4,-640364487),p=J(p,d,K,G,y[S+12],11,-421815835),G=J(G,p,d,K,y[S+15],16,530742520),K=J(K,G,p,d,y[S+2],23,-995338651),d=u(d,K,G,p,y[S],6,-198630844),p=u(p,d,K,G,y[S+7],10,1126891415),G=u(G,p,d,K,y[S+14],15,-1416354905),K=u(K,G,p,d,y[S+5],21,-57434055),d=u(d,K,G,p,y[S+12],6,1700485571),p=u(p,d,K,G,y[S+3],10,-1894986606),G=u(G,p,d,K,y[S+10],15,-1051523),K=u(K,G,p,d,y[S+1],21,-2054922799),d=u(d,K,G,p,y[S+8],6,1873313359),p=u(p,d,K,G,y[S+15],10,-30611744),G=u(G,p,d,K,y[S+6],15,-1560198380),K=u(K,G,p,d,y[S+13],21,1309151649),d=u(d,K,G,p,y[S+4],6,-145523070),p=u(p,d,K,G,y[S+11],10,-1120210379),G=u(G,p,d,K,y[S+2],15,718787259),K=u(K,G,p,d,y[S+9],21,-343485551),d=i(d,I),K=i(K,V),G=i(G,A),p=i(p,L)}return[d,K,G,p]}(function(y){const I=S;if(0===y[I(302)])return[];const i=8*y[I(302)],A=new Uint32Array(V(i));for(let S=0;S<i;S+=8)A[S>>5]|=(255&y[S/8])<<S%32;return A}(y),8*y[S(302)]))}},790:(y,S)=>{"use strict";const I=d;Object[I(228)](S,I(220),{value:!0}),S[I(334)]=void 0;var V={randomUUID:I(363)!=typeof crypto&&crypto[I(273)]&&crypto[I(273)][I(229)](crypto)};S.default=V},314:(y,S)=>{"use strict";const I=d;Object[I(228)](S,"__esModule",{value:!0}),S.default=void 0,S[I(334)]="00000000-0000-0000-0000-000000000000"},222:(y,S,I)=>{"use strict";const V=d;Object.defineProperty(S,V(220),{value:!0}),S[V(334)]=void 0;var i,A=(i=I(435))&&i.__esModule?i:{default:i};S[V(334)]=function(y){const S=V;if(!(0,A.default)(y))throw TypeError(S(271));let I;const i=new Uint8Array(16);return i[0]=(I=parseInt(y[S(396)](0,8),16))>>>24,i[1]=I>>>16&255,i[2]=I>>>8&255,i[3]=255&I,i[4]=(I=parseInt(y[S(396)](9,13),16))>>>8,i[5]=255&I,i[6]=(I=parseInt(y[S(396)](14,18),16))>>>8,i[7]=255&I,i[8]=(I=parseInt(y[S(396)](19,23),16))>>>8,i[9]=255&I,i[10]=(I=parseInt(y[S(396)](24,36),16))/1099511627776&255,i[11]=I/4294967296&255,i[12]=I>>>24&255,i[13]=I>>>16&255,i[14]=I>>>8&255,i[15]=255&I,i}},58:(y,S)=>{"use strict";const I=d;Object[I(228)](S,"__esModule",{value:!0}),S[I(334)]=void 0,S[I(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(y,S)=>{"use strict";const I=d;let V;Object[I(228)](S,"__esModule",{value:!0}),S[I(334)]=function(){const y=I;if(!V&&(V="undefined"!=typeof crypto&&crypto[y(254)]&&crypto.getRandomValues.bind(crypto),!V))throw new Error(y(299));return V(i)};const i=new Uint8Array(16)},757:(y,S)=>{"use strict";const I=d;function V(y,S,I,V){switch(y){case 0:return S&I^~S&V;case 1:case 3:return S^I^V;case 2:return S&I^S&V^I&V}}function i(y,S){return y<<S|y>>>32-S}Object.defineProperty(S,I(220),{value:!0}),S[I(334)]=void 0;S[I(334)]=function(y){const S=I,A=[1518500249,1859775393,2400959708,3395469782],B=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof y){const I=unescape(encodeURIComponent(y));y=[];for(let V=0;V<I[S(302)];++V)y[S(288)](I.charCodeAt(V))}else Array[S(338)](y)||(y=Array[S(340)][S(396)].call(y));y[S(288)](128);const d=y[S(302)]/4+2,F=Math[S(375)](d/16),J=new Array(F);for(let I=0;I<F;++I){const S=new Uint32Array(16);for(let V=0;V<16;++V)S[V]=y[64*I+4*V]<<24|y[64*I+4*V+1]<<16|y[64*I+4*V+2]<<8|y[64*I+4*V+3];J[I]=S}J[F-1][14]=8*(y[S(302)]-1)/Math.pow(2,32),J[F-1][14]=Math.floor(J[F-1][14]),J[F-1][15]=8*(y.length-1)&4294967295;for(let I=0;I<F;++I){const y=new Uint32Array(80);for(let S=0;S<16;++S)y[S]=J[I][S];for(let S=16;S<80;++S)y[S]=i(y[S-3]^y[S-8]^y[S-14]^y[S-16],1);let d=B[0],F=B[1],u=B[2],K=B[3],G=B[4];for(let I=0;I<80;++I){const B=Math[S(365)](I/20),J=i(d,5)+V(B,F,u,K)+G+A[B]+y[I]>>>0;G=K,K=u,u=i(F,30)>>>0,F=d,d=J}B[0]=B[0]+d>>>0,B[1]=B[1]+F>>>0,B[2]=B[2]+u>>>0,B[3]=B[3]+K>>>0,B[4]=B[4]+G>>>0}return[B[0]>>24&255,B[0]>>16&255,B[0]>>8&255,255&B[0],B[1]>>24&255,B[1]>>16&255,B[1]>>8&255,255&B[1],B[2]>>24&255,B[2]>>16&255,B[2]>>8&255,255&B[2],B[3]>>24&255,B[3]>>16&255,B[3]>>8&255,255&B[3],B[4]>>24&255,B[4]>>16&255,B[4]>>8&255,255&B[4]]}},8:(y,S,I)=>{"use strict";const V=d;Object[V(228)](S,V(220),{value:!0}),S[V(334)]=void 0,S[V(263)]=F;var i,A=(i=I(435))&&i[V(220)]?i:{default:i};const B=[];for(let d=0;d<256;++d)B[V(288)]((d+256)[V(251)](16)[V(396)](1));function F(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const I=V;return(B[y[S+0]]+B[y[S+1]]+B[y[S+2]]+B[y[S+3]]+"-"+B[y[S+4]]+B[y[S+5]]+"-"+B[y[S+6]]+B[y[S+7]]+"-"+B[y[S+8]]+B[y[S+9]]+"-"+B[y[S+10]]+B[y[S+11]]+B[y[S+12]]+B[y[S+13]]+B[y[S+14]]+B[y[S+15]])[I(317)]()}S[V(334)]=function(y){const S=V,I=F(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,A.default)(I))throw TypeError(S(321));return I}},990:(y,S,I)=>{"use strict";const V=d;Object.defineProperty(S,"__esModule",{value:!0}),S[V(334)]=void 0;var i,A=(i=I(319))&&i[V(220)]?i:{default:i},B=I(8);let F,J,u=0,K=0;S[V(334)]=function(y,S,I){const i=V;let d=S&&I||0;const G=S||new Array(16);let p=(y=y||{}).node||F,L=void 0!==y[i(324)]?y[i(324)]:J;if(null==p||null==L){const S=y[i(347)]||(y[i(355)]||A[i(334)])();null==p&&(p=F=[1|S[0],S[1],S[2],S[3],S[4],S[5]]),null==L&&(L=J=16383&(S[6]<<8|S[7]))}let T=void 0!==y[i(327)]?y.msecs:Date.now(),l=void 0!==y[i(316)]?y.nsecs:K+1;const j=T-u+(l-K)/1e4;if(j<0&&void 0===y[i(324)]&&(L=L+1&16383),(j<0||T>u)&&void 0===y[i(316)]&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=T,K=l,J=L,T+=122192928e5;const s=(1e4*(268435455&T)+l)%4294967296;G[d++]=s>>>24&255,G[d++]=s>>>16&255,G[d++]=s>>>8&255,G[d++]=255&s;const O=T/4294967296*1e4&268435455;G[d++]=O>>>8&255,G[d++]=255&O,G[d++]=O>>>24&15|16,G[d++]=O>>>16&255,G[d++]=L>>>8|128,G[d++]=255&L;for(let V=0;V<6;++V)G[d+V]=p[V];return S||(0,B[i(263)])(G)}},237:(y,S,I)=>{"use strict";const V=d;Object[V(228)](S,V(220),{value:!0}),S[V(334)]=void 0;var i=B(I(925)),A=B(I(163));function B(y){return y&&y[V(220)]?y:{default:y}}var F=(0,i.default)("v3",48,A[V(334)]);S[V(334)]=F},925:(y,S,I)=>{"use strict";const V=d;Object[V(228)](S,V(220),{value:!0}),S[V(291)]=S.DNS=void 0,S[V(334)]=function(y,S,I){const i=V;function u(y,V,i,F){const J=d;var u;if(J(240)==typeof y&&(y=function(y){const S=J;y=unescape(encodeURIComponent(y));const I=[];for(let V=0;V<y.length;++V)I[S(288)](y.charCodeAt(V));return I}(y)),J(240)==typeof V&&(V=(0,B[J(334)])(V)),16!==(null===(u=V)||void 0===u?void 0:u[J(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let K=new Uint8Array(16+y[J(302)]);if(K.set(V),K[J(242)](y,V[J(302)]),K=I(K),K[6]=15&K[6]|S,K[8]=63&K[8]|128,i){F=F||0;for(let y=0;y<16;++y)i[F+y]=K[y];return i}return(0,A.unsafeStringify)(K)}try{u.name=y}catch(K){}return u[i(245)]=F,u[i(291)]=J,u};var i,A=I(8),B=(i=I(222))&&i[V(220)]?i:{default:i};const F="6ba7b810-9dad-11d1-80b4-00c04fd430c8";S.DNS=F;const J="6ba7b811-9dad-11d1-80b4-00c04fd430c8";S.URL=J},355:(y,S,I)=>{"use strict";const V=d;Object.defineProperty(S,"__esModule",{value:!0}),S[V(334)]=void 0;var i=F(I(790)),A=F(I(319)),B=I(8);function F(y){return y&&y.__esModule?y:{default:y}}S[V(334)]=function(y,S,I){const d=V;if(i[d(334)][d(273)]&&!S&&!y)return i.default[d(273)]();const F=(y=y||{}).random||(y[d(355)]||A.default)();if(F[6]=15&F[6]|64,F[8]=63&F[8]|128,S){I=I||0;for(let y=0;y<16;++y)S[I+y]=F[y];return S}return(0,B.unsafeStringify)(F)}},764:(y,S,I)=>{"use strict";const V=d;Object[V(228)](S,"__esModule",{value:!0}),S[V(334)]=void 0;var i=B(I(925)),A=B(I(757));function B(y){return y&&y[V(220)]?y:{default:y}}var F=(0,i[V(334)])("v5",80,A.default);S.default=F},435:(y,S,I)=>{"use strict";const V=d;Object[V(228)](S,V(220),{value:!0}),S[V(334)]=void 0;var i,A=(i=I(58))&&i.__esModule?i:{default:i};S[V(334)]=function(y){const S=V;return S(240)==typeof y&&A[S(334)][S(346)](y)}},464:(y,S,I)=>{"use strict";const V=d;Object[V(228)](S,V(220),{value:!0}),S[V(334)]=void 0;var i,A=(i=I(435))&&i[V(220)]?i:{default:i};S[V(334)]=function(y){const S=V;if(!(0,A[S(334)])(y))throw TypeError(S(271));return parseInt(y[S(396)](14,15),16)}},147:y=>{"use strict";const S=d;y[S(337)]=JSON[S(250)](S(373))}},S={};function I(V){const i=d;var A=S[V];if(void 0!==A)return A[i(337)];var B=S[V]={exports:{}};return y[V][i(377)](B[i(337)],B,B[i(337)],I),B.exports}var V={};return(()=>{"use strict";const y=d;var S=V;Object[y(228)](S,"__esModule",{value:!0}),S.ByteBrew=void 0;var i=I(719);Object[y(228)](S,y(290),{enumerable:!0,get:function(){return i[y(290)]}})})(),V})()))},14446:y=>{"use strict";y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14443:(y,S,I)=>{var V=I(14446),i=I(14453),A=Object.hasOwnProperty,B=Object.create(null);for(var d in V)A.call(V,d)&&(B[V[d]]=d);var F=y.exports={to:{},get:{}};function J(y,S,I){return Math.min(Math.max(S,y),I)}function u(y){var S=Math.round(y).toString(16).toUpperCase();return S.length<2?"0"+S:S}F.get=function(y){var S,I;switch(y.substring(0,3).toLowerCase()){case"hsl":S=F.get.hsl(y),I="hsl";break;case"hwb":S=F.get.hwb(y),I="hwb";break;default:S=F.get.rgb(y),I="rgb"}return S?{model:I,value:S}:null},F.get.rgb=function(y){if(!y)return null;var S,I,i,B=[0,0,0,1];if(S=y.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=S[2],S=S[1],I=0;I<3;I++){var d=2*I;B[I]=parseInt(S.slice(d,d+2),16)}i&&(B[3]=parseInt(i,16)/255)}else if(S=y.match(/^#([a-f0-9]{3,4})$/i)){for(i=(S=S[1])[3],I=0;I<3;I++)B[I]=parseInt(S[I]+S[I],16);i&&(B[3]=parseInt(i+i,16)/255)}else if(S=y.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(I=0;I<3;I++)B[I]=parseInt(S[I+1],0);S[4]&&(S[5]?B[3]=.01*parseFloat(S[4]):B[3]=parseFloat(S[4]))}else{if(!(S=y.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(S=y.match(/^(\w+)$/))?"transparent"===S[1]?[0,0,0,0]:A.call(V,S[1])?((B=V[S[1]])[3]=1,B):null:null;for(I=0;I<3;I++)B[I]=Math.round(2.55*parseFloat(S[I+1]));S[4]&&(S[5]?B[3]=.01*parseFloat(S[4]):B[3]=parseFloat(S[4]))}for(I=0;I<3;I++)B[I]=J(B[I],0,255);return B[3]=J(B[3],0,1),B},F.get.hsl=function(y){if(!y)return null;var S=y.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(S){var I=parseFloat(S[4]);return[(parseFloat(S[1])%360+360)%360,J(parseFloat(S[2]),0,100),J(parseFloat(S[3]),0,100),J(isNaN(I)?1:I,0,1)]}return null},F.get.hwb=function(y){if(!y)return null;var S=y.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(S){var I=parseFloat(S[4]);return[(parseFloat(S[1])%360+360)%360,J(parseFloat(S[2]),0,100),J(parseFloat(S[3]),0,100),J(isNaN(I)?1:I,0,1)]}return null},F.to.hex=function(){var y=i(arguments);return"#"+u(y[0])+u(y[1])+u(y[2])+(y[3]<1?u(Math.round(255*y[3])):"")},F.to.rgb=function(){var y=i(arguments);return y.length<4||1===y[3]?"rgb("+Math.round(y[0])+", "+Math.round(y[1])+", "+Math.round(y[2])+")":"rgba("+Math.round(y[0])+", "+Math.round(y[1])+", "+Math.round(y[2])+", "+y[3]+")"},F.to.rgb.percent=function(){var y=i(arguments),S=Math.round(y[0]/255*100),I=Math.round(y[1]/255*100),V=Math.round(y[2]/255*100);return y.length<4||1===y[3]?"rgb("+S+"%, "+I+"%, "+V+"%)":"rgba("+S+"%, "+I+"%, "+V+"%, "+y[3]+")"},F.to.hsl=function(){var y=i(arguments);return y.length<4||1===y[3]?"hsl("+y[0]+", "+y[1]+"%, "+y[2]+"%)":"hsla("+y[0]+", "+y[1]+"%, "+y[2]+"%, "+y[3]+")"},F.to.hwb=function(){var y=i(arguments),S="";return y.length>=4&&1!==y[3]&&(S=", "+y[3]),"hwb("+y[0]+", "+y[1]+"%, "+y[2]+"%"+S+")"},F.to.keyword=function(y){return B[y.slice(0,3)]}},14436:(y,S,I)=>{const V=I(14443),i=I(14467),A=["keyword","gray","hex"],B={};for(const p of Object.keys(i))B[[...i[p].labels].sort().join("")]=p;const d={};function F(y,S){if(!(this instanceof F))return new F(y,S);if(S&&S in A&&(S=null),S&&!(S in i))throw new Error("Unknown model: "+S);let I,J;if(null==y)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(y instanceof F)this.model=y.model,this.color=[...y.color],this.valpha=y.valpha;else if("string"===typeof y){const S=V.get(y);if(null===S)throw new Error("Unable to parse color from string: "+y);this.model=S.model,J=i[this.model].channels,this.color=S.value.slice(0,J),this.valpha="number"===typeof S.value[J]?S.value[J]:1}else if(y.length>0){this.model=S||"rgb",J=i[this.model].channels;const I=Array.prototype.slice.call(y,0,J);this.color=G(I,J),this.valpha="number"===typeof y[J]?y[J]:1}else if("number"===typeof y)this.model="rgb",this.color=[y>>16&255,y>>8&255,255&y],this.valpha=1;else{this.valpha=1;const S=Object.keys(y);"alpha"in y&&(S.splice(S.indexOf("alpha"),1),this.valpha="number"===typeof y.alpha?y.alpha:0);const V=S.sort().join("");if(!(V in B))throw new Error("Unable to parse color from object: "+JSON.stringify(y));this.model=B[V];const{labels:A}=i[this.model],d=[];for(I=0;I<A.length;I++)d.push(y[A[I]]);this.color=G(d)}if(d[this.model])for(J=i[this.model].channels,I=0;I<J;I++){const y=d[this.model][I];y&&(this.color[I]=y(this.color[I]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}F.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(y){let S=this.model in V.to?this:this.rgb();S=S.round("number"===typeof y?y:1);const I=1===S.valpha?S.color:[...S.color,this.valpha];return V.to[S.model](I)},percentString(y){const S=this.rgb().round("number"===typeof y?y:1),I=1===S.valpha?S.color:[...S.color,this.valpha];return V.to.rgb.percent(I)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const y={},{channels:S}=i[this.model],{labels:I}=i[this.model];for(let V=0;V<S;V++)y[I[V]]=this.color[V];return 1!==this.valpha&&(y.alpha=this.valpha),y},unitArray(){const y=this.rgb().color;return y[0]/=255,y[1]/=255,y[2]/=255,1!==this.valpha&&y.push(this.valpha),y},unitObject(){const y=this.rgb().object();return y.r/=255,y.g/=255,y.b/=255,1!==this.valpha&&(y.alpha=this.valpha),y},round(y){return y=Math.max(y||0,0),new F([...this.color.map(J(y)),this.valpha],this.model)},alpha(y){return void 0!==y?new F([...this.color,Math.max(0,Math.min(1,y))],this.model):this.valpha},red:u("rgb",0,K(255)),green:u("rgb",1,K(255)),blue:u("rgb",2,K(255)),hue:u(["hsl","hsv","hsl","hwb","hcg"],0,(y=>(y%360+360)%360)),saturationl:u("hsl",1,K(100)),lightness:u("hsl",2,K(100)),saturationv:u("hsv",1,K(100)),value:u("hsv",2,K(100)),chroma:u("hcg",1,K(100)),gray:u("hcg",2,K(100)),white:u("hwb",1,K(100)),wblack:u("hwb",2,K(100)),cyan:u("cmyk",0,K(100)),magenta:u("cmyk",1,K(100)),yellow:u("cmyk",2,K(100)),black:u("cmyk",3,K(100)),x:u("xyz",0,K(95.047)),y:u("xyz",1,K(100)),z:u("xyz",2,K(108.833)),l:u("lab",0,K(100)),a:u("lab",1),b:u("lab",2),keyword(y){return void 0!==y?new F(y):i[this.model].keyword(this.color)},hex(y){return void 0!==y?new F(y):V.to.hex(this.rgb().round().color)},hexa(y){if(void 0!==y)return new F(y);const S=this.rgb().round().color;let I=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===I.length&&(I="0"+I),V.to.hex(S)+I},rgbNumber(){const y=this.rgb().color;return(255&y[0])<<16|(255&y[1])<<8|255&y[2]},luminosity(){const y=this.rgb().color,S=[];for(const[I,V]of y.entries()){const y=V/255;S[I]=y<=.04045?y/12.92:((y+.055)/1.055)**2.4}return.2126*S[0]+.7152*S[1]+.0722*S[2]},contrast(y){const S=this.luminosity(),I=y.luminosity();return S>I?(S+.05)/(I+.05):(I+.05)/(S+.05)},level(y){const S=this.contrast(y);return S>=7?"AAA":S>=4.5?"AA":""},isDark(){const y=this.rgb().color;return(2126*y[0]+7152*y[1]+722*y[2])/1e4<128},isLight(){return!this.isDark()},negate(){const y=this.rgb();for(let S=0;S<3;S++)y.color[S]=255-y.color[S];return y},lighten(y){const S=this.hsl();return S.color[2]+=S.color[2]*y,S},darken(y){const S=this.hsl();return S.color[2]-=S.color[2]*y,S},saturate(y){const S=this.hsl();return S.color[1]+=S.color[1]*y,S},desaturate(y){const S=this.hsl();return S.color[1]-=S.color[1]*y,S},whiten(y){const S=this.hwb();return S.color[1]+=S.color[1]*y,S},blacken(y){const S=this.hwb();return S.color[2]+=S.color[2]*y,S},grayscale(){const y=this.rgb().color,S=.3*y[0]+.59*y[1]+.11*y[2];return F.rgb(S,S,S)},fade(y){return this.alpha(this.valpha-this.valpha*y)},opaquer(y){return this.alpha(this.valpha+this.valpha*y)},rotate(y){const S=this.hsl();let I=S.color[0];return I=(I+y)%360,I=I<0?360+I:I,S.color[0]=I,S},mix(y,S){if(!y||!y.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof y);const I=y.rgb(),V=this.rgb(),i=void 0===S?.5:S,A=2*i-1,B=I.alpha()-V.alpha(),d=((A*B===-1?A:(A+B)/(1+A*B))+1)/2,J=1-d;return F.rgb(d*I.red()+J*V.red(),d*I.green()+J*V.green(),d*I.blue()+J*V.blue(),I.alpha()*i+V.alpha()*(1-i))}};for(const p of Object.keys(i)){if(A.includes(p))continue;const{channels:y}=i[p];F.prototype[p]=function(){if(this.model===p)return new F(this);for(var y=arguments.length,S=new Array(y),I=0;I<y;I++)S[I]=arguments[I];return S.length>0?new F(S,p):new F([...(V=i[this.model][p].raw(this.color),Array.isArray(V)?V:[V]),this.valpha],p);var V},F[p]=function(){for(var S=arguments.length,I=new Array(S),V=0;V<S;V++)I[V]=arguments[V];let i=I[0];return"number"===typeof i&&(i=G(I,y)),new F(i,p)}}function J(y){return function(S){return function(y,S){return Number(y.toFixed(S))}(S,y)}}function u(y,S,I){y=Array.isArray(y)?y:[y];for(const V of y)(d[V]||(d[V]=[]))[S]=I;return y=y[0],function(V){let i;return void 0!==V?(I&&(V=I(V)),i=this[y](),i.color[S]=V,i):(i=this[y]().color[S],I&&(i=I(i)),i)}}function K(y){return function(S){return Math.max(0,Math.min(y,S))}}function G(y,S){for(let I=0;I<S;I++)"number"!==typeof y[I]&&(y[I]=0);return y}y.exports=F},14473:(y,S,I)=>{const V=I(14476),i={};for(const B of Object.keys(V))i[V[B]]=B;const A={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};y.exports=A;for(const B of Object.keys(A)){if(!("channels"in A[B]))throw new Error("missing channels property: "+B);if(!("labels"in A[B]))throw new Error("missing channel labels property: "+B);if(A[B].labels.length!==A[B].channels)throw new Error("channel and label counts mismatch: "+B);const{channels:y,labels:S}=A[B];delete A[B].channels,delete A[B].labels,Object.defineProperty(A[B],"channels",{value:y}),Object.defineProperty(A[B],"labels",{value:S})}A.rgb.hsl=function(y){const S=y[0]/255,I=y[1]/255,V=y[2]/255,i=Math.min(S,I,V),A=Math.max(S,I,V),B=A-i;let d,F;A===i?d=0:S===A?d=(I-V)/B:I===A?d=2+(V-S)/B:V===A&&(d=4+(S-I)/B),d=Math.min(60*d,360),d<0&&(d+=360);const J=(i+A)/2;return F=A===i?0:J<=.5?B/(A+i):B/(2-A-i),[d,100*F,100*J]},A.rgb.hsv=function(y){let S,I,V,i,A;const B=y[0]/255,d=y[1]/255,F=y[2]/255,J=Math.max(B,d,F),u=J-Math.min(B,d,F),K=function(y){return(J-y)/6/u+.5};return 0===u?(i=0,A=0):(A=u/J,S=K(B),I=K(d),V=K(F),B===J?i=V-I:d===J?i=1/3+S-V:F===J&&(i=2/3+I-S),i<0?i+=1:i>1&&(i-=1)),[360*i,100*A,100*J]},A.rgb.hwb=function(y){const S=y[0],I=y[1];let V=y[2];const i=A.rgb.hsl(y)[0],B=1/255*Math.min(S,Math.min(I,V));return V=1-1/255*Math.max(S,Math.max(I,V)),[i,100*B,100*V]},A.rgb.cmyk=function(y){const S=y[0]/255,I=y[1]/255,V=y[2]/255,i=Math.min(1-S,1-I,1-V);return[100*((1-S-i)/(1-i)||0),100*((1-I-i)/(1-i)||0),100*((1-V-i)/(1-i)||0),100*i]},A.rgb.keyword=function(y){const S=i[y];if(S)return S;let I,A=1/0;for(const i of Object.keys(V)){const S=V[i],F=(d=S,((B=y)[0]-d[0])**2+(B[1]-d[1])**2+(B[2]-d[2])**2);F<A&&(A=F,I=i)}var B,d;return I},A.keyword.rgb=function(y){return V[y]},A.rgb.xyz=function(y){let S=y[0]/255,I=y[1]/255,V=y[2]/255;S=S>.04045?((S+.055)/1.055)**2.4:S/12.92,I=I>.04045?((I+.055)/1.055)**2.4:I/12.92,V=V>.04045?((V+.055)/1.055)**2.4:V/12.92;return[100*(.4124*S+.3576*I+.1805*V),100*(.2126*S+.7152*I+.0722*V),100*(.0193*S+.1192*I+.9505*V)]},A.rgb.lab=function(y){const S=A.rgb.xyz(y);let I=S[0],V=S[1],i=S[2];I/=95.047,V/=100,i/=108.883,I=I>.008856?I**(1/3):7.787*I+16/116,V=V>.008856?V**(1/3):7.787*V+16/116,i=i>.008856?i**(1/3):7.787*i+16/116;return[116*V-16,500*(I-V),200*(V-i)]},A.hsl.rgb=function(y){const S=y[0]/360,I=y[1]/100,V=y[2]/100;let i,A,B;if(0===I)return B=255*V,[B,B,B];i=V<.5?V*(1+I):V+I-V*I;const d=2*V-i,F=[0,0,0];for(let J=0;J<3;J++)A=S+1/3*-(J-1),A<0&&A++,A>1&&A--,B=6*A<1?d+6*(i-d)*A:2*A<1?i:3*A<2?d+(i-d)*(2/3-A)*6:d,F[J]=255*B;return F},A.hsl.hsv=function(y){const S=y[0];let I=y[1]/100,V=y[2]/100,i=I;const A=Math.max(V,.01);V*=2,I*=V<=1?V:2-V,i*=A<=1?A:2-A;return[S,100*(0===V?2*i/(A+i):2*I/(V+I)),100*((V+I)/2)]},A.hsv.rgb=function(y){const S=y[0]/60,I=y[1]/100;let V=y[2]/100;const i=Math.floor(S)%6,A=S-Math.floor(S),B=255*V*(1-I),d=255*V*(1-I*A),F=255*V*(1-I*(1-A));switch(V*=255,i){case 0:return[V,F,B];case 1:return[d,V,B];case 2:return[B,V,F];case 3:return[B,d,V];case 4:return[F,B,V];case 5:return[V,B,d]}},A.hsv.hsl=function(y){const S=y[0],I=y[1]/100,V=y[2]/100,i=Math.max(V,.01);let A,B;B=(2-I)*V;const d=(2-I)*i;return A=I*i,A/=d<=1?d:2-d,A=A||0,B/=2,[S,100*A,100*B]},A.hwb.rgb=function(y){const S=y[0]/360;let I=y[1]/100,V=y[2]/100;const i=I+V;let A;i>1&&(I/=i,V/=i);const B=Math.floor(6*S),d=1-V;A=6*S-B,0!==(1&B)&&(A=1-A);const F=I+A*(d-I);let J,u,K;switch(B){default:case 6:case 0:J=d,u=F,K=I;break;case 1:J=F,u=d,K=I;break;case 2:J=I,u=d,K=F;break;case 3:J=I,u=F,K=d;break;case 4:J=F,u=I,K=d;break;case 5:J=d,u=I,K=F}return[255*J,255*u,255*K]},A.cmyk.rgb=function(y){const S=y[0]/100,I=y[1]/100,V=y[2]/100,i=y[3]/100;return[255*(1-Math.min(1,S*(1-i)+i)),255*(1-Math.min(1,I*(1-i)+i)),255*(1-Math.min(1,V*(1-i)+i))]},A.xyz.rgb=function(y){const S=y[0]/100,I=y[1]/100,V=y[2]/100;let i,A,B;return i=3.2406*S+-1.5372*I+-.4986*V,A=-.9689*S+1.8758*I+.0415*V,B=.0557*S+-.204*I+1.057*V,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,i=Math.min(Math.max(0,i),1),A=Math.min(Math.max(0,A),1),B=Math.min(Math.max(0,B),1),[255*i,255*A,255*B]},A.xyz.lab=function(y){let S=y[0],I=y[1],V=y[2];S/=95.047,I/=100,V/=108.883,S=S>.008856?S**(1/3):7.787*S+16/116,I=I>.008856?I**(1/3):7.787*I+16/116,V=V>.008856?V**(1/3):7.787*V+16/116;return[116*I-16,500*(S-I),200*(I-V)]},A.lab.xyz=function(y){let S,I,V;I=(y[0]+16)/116,S=y[1]/500+I,V=I-y[2]/200;const i=I**3,A=S**3,B=V**3;return I=i>.008856?i:(I-16/116)/7.787,S=A>.008856?A:(S-16/116)/7.787,V=B>.008856?B:(V-16/116)/7.787,S*=95.047,I*=100,V*=108.883,[S,I,V]},A.lab.lch=function(y){const S=y[0],I=y[1],V=y[2];let i;i=360*Math.atan2(V,I)/2/Math.PI,i<0&&(i+=360);return[S,Math.sqrt(I*I+V*V),i]},A.lch.lab=function(y){const S=y[0],I=y[1],V=y[2]/360*2*Math.PI;return[S,I*Math.cos(V),I*Math.sin(V)]},A.rgb.ansi16=function(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[I,V,i]=y;let B=null===S?A.rgb.hsv(y)[2]:S;if(B=Math.round(B/50),0===B)return 30;let d=30+(Math.round(i/255)<<2|Math.round(V/255)<<1|Math.round(I/255));return 2===B&&(d+=60),d},A.hsv.ansi16=function(y){return A.rgb.ansi16(A.hsv.rgb(y),y[2])},A.rgb.ansi256=function(y){const S=y[0],I=y[1],V=y[2];if(S===I&&I===V)return S<8?16:S>248?231:Math.round((S-8)/247*24)+232;return 16+36*Math.round(S/255*5)+6*Math.round(I/255*5)+Math.round(V/255*5)},A.ansi16.rgb=function(y){let S=y%10;if(0===S||7===S)return y>50&&(S+=3.5),S=S/10.5*255,[S,S,S];const I=.5*(1+~~(y>50));return[(1&S)*I*255,(S>>1&1)*I*255,(S>>2&1)*I*255]},A.ansi256.rgb=function(y){if(y>=232){const S=10*(y-232)+8;return[S,S,S]}let S;y-=16;return[Math.floor(y/36)/5*255,Math.floor((S=y%36)/6)/5*255,S%6/5*255]},A.rgb.hex=function(y){const S=(((255&Math.round(y[0]))<<16)+((255&Math.round(y[1]))<<8)+(255&Math.round(y[2]))).toString(16).toUpperCase();return"000000".substring(S.length)+S},A.hex.rgb=function(y){const S=y.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!S)return[0,0,0];let I=S[0];3===S[0].length&&(I=I.split("").map((y=>y+y)).join(""));const V=parseInt(I,16);return[V>>16&255,V>>8&255,255&V]},A.rgb.hcg=function(y){const S=y[0]/255,I=y[1]/255,V=y[2]/255,i=Math.max(Math.max(S,I),V),A=Math.min(Math.min(S,I),V),B=i-A;let d,F;return d=B<1?A/(1-B):0,F=B<=0?0:i===S?(I-V)/B%6:i===I?2+(V-S)/B:4+(S-I)/B,F/=6,F%=1,[360*F,100*B,100*d]},A.hsl.hcg=function(y){const S=y[1]/100,I=y[2]/100,V=I<.5?2*S*I:2*S*(1-I);let i=0;return V<1&&(i=(I-.5*V)/(1-V)),[y[0],100*V,100*i]},A.hsv.hcg=function(y){const S=y[1]/100,I=y[2]/100,V=S*I;let i=0;return V<1&&(i=(I-V)/(1-V)),[y[0],100*V,100*i]},A.hcg.rgb=function(y){const S=y[0]/360,I=y[1]/100,V=y[2]/100;if(0===I)return[255*V,255*V,255*V];const i=[0,0,0],A=S%1*6,B=A%1,d=1-B;let F=0;switch(Math.floor(A)){case 0:i[0]=1,i[1]=B,i[2]=0;break;case 1:i[0]=d,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=B;break;case 3:i[0]=0,i[1]=d,i[2]=1;break;case 4:i[0]=B,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=d}return F=(1-I)*V,[255*(I*i[0]+F),255*(I*i[1]+F),255*(I*i[2]+F)]},A.hcg.hsv=function(y){const S=y[1]/100,I=S+y[2]/100*(1-S);let V=0;return I>0&&(V=S/I),[y[0],100*V,100*I]},A.hcg.hsl=function(y){const S=y[1]/100,I=y[2]/100*(1-S)+.5*S;let V=0;return I>0&&I<.5?V=S/(2*I):I>=.5&&I<1&&(V=S/(2*(1-I))),[y[0],100*V,100*I]},A.hcg.hwb=function(y){const S=y[1]/100,I=S+y[2]/100*(1-S);return[y[0],100*(I-S),100*(1-I)]},A.hwb.hcg=function(y){const S=y[1]/100,I=1-y[2]/100,V=I-S;let i=0;return V<1&&(i=(I-V)/(1-V)),[y[0],100*V,100*i]},A.apple.rgb=function(y){return[y[0]/65535*255,y[1]/65535*255,y[2]/65535*255]},A.rgb.apple=function(y){return[y[0]/255*65535,y[1]/255*65535,y[2]/255*65535]},A.gray.rgb=function(y){return[y[0]/100*255,y[0]/100*255,y[0]/100*255]},A.gray.hsl=function(y){return[0,0,y[0]]},A.gray.hsv=A.gray.hsl,A.gray.hwb=function(y){return[0,100,y[0]]},A.gray.cmyk=function(y){return[0,0,0,y[0]]},A.gray.lab=function(y){return[y[0],0,0]},A.gray.hex=function(y){const S=255&Math.round(y[0]/100*255),I=((S<<16)+(S<<8)+S).toString(16).toUpperCase();return"000000".substring(I.length)+I},A.rgb.gray=function(y){return[(y[0]+y[1]+y[2])/3/255*100]}},14467:(y,S,I)=>{const V=I(14473),i=I(14485),A={};Object.keys(V).forEach((y=>{A[y]={},Object.defineProperty(A[y],"channels",{value:V[y].channels}),Object.defineProperty(A[y],"labels",{value:V[y].labels});const S=i(y);Object.keys(S).forEach((I=>{const V=S[I];A[y][I]=function(y){const S=function(){for(var S=arguments.length,I=new Array(S),V=0;V<S;V++)I[V]=arguments[V];const i=I[0];if(void 0===i||null===i)return i;i.length>1&&(I=i);const A=y(I);if("object"===typeof A)for(let y=A.length,B=0;B<y;B++)A[B]=Math.round(A[B]);return A};return"conversion"in y&&(S.conversion=y.conversion),S}(V),A[y][I].raw=function(y){const S=function(){for(var S=arguments.length,I=new Array(S),V=0;V<S;V++)I[V]=arguments[V];const i=I[0];return void 0===i||null===i?i:(i.length>1&&(I=i),y(I))};return"conversion"in y&&(S.conversion=y.conversion),S}(V)}))})),y.exports=A},14485:(y,S,I)=>{const V=I(14473);function i(y){const S=function(){const y={},S=Object.keys(V);for(let I=S.length,V=0;V<I;V++)y[S[V]]={distance:-1,parent:null};return y}(),I=[y];for(S[y].distance=0;I.length;){const y=I.pop(),i=Object.keys(V[y]);for(let V=i.length,A=0;A<V;A++){const V=i[A],B=S[V];-1===B.distance&&(B.distance=S[y].distance+1,B.parent=y,I.unshift(V))}}return S}function A(y,S){return function(I){return S(y(I))}}function B(y,S){const I=[S[y].parent,y];let i=V[S[y].parent][y],B=S[y].parent;for(;S[B].parent;)I.unshift(S[B].parent),i=A(V[S[B].parent][B],i),B=S[B].parent;return i.conversion=I,i}y.exports=function(y){const S=i(y),I={},V=Object.keys(S);for(let i=V.length,A=0;A<i;A++){const y=V[A];null!==S[y].parent&&(I[y]=B(y,S))}return I}},14476:y=>{"use strict";y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13023:(y,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.discordURLBuilder=void 0,S.discordURLBuilder=function(y){var S;const I=(null===(S=null===window||void 0===window?void 0:window.location)||void 0===S?void 0:S.hostname)||"localhost",V=y.hostname.split("."),i=!y.hostname.includes("trycloudflare.com")&&!y.hostname.includes("discordsays.com")&&V.length>2?`/${V[0]}`:"";return y.pathname.startsWith("/.proxy")?`${y.protocol}//${I}${i}${y.pathname}${y.search}`:`${y.protocol}//${I}/.proxy/colyseus${i}${y.pathname}${y.search}`}},13010:function(y,S,I){"use strict";var V,i,A,B,d=this&&this.__awaiter||function(y,S,I,V){return new(I||(I=Promise))((function(i,A){function B(y){try{F(V.next(y))}catch(S){A(S)}}function d(y){try{F(V.throw(y))}catch(S){A(S)}}function F(y){var S;y.done?i(y.value):(S=y.value,S instanceof I?S:new I((function(y){y(S)}))).then(B,d)}F((V=V.apply(y,S||[])).next())}))},F=this&&this.__classPrivateFieldGet||function(y,S,I,V){if("a"===I&&!V)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof S?y!==S||!V:!S.has(y))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===I?V:"a"===I?V.call(y):V?V.value:S.get(y)},J=this&&this.__classPrivateFieldSet||function(y,S,I,V,i){if("m"===V)throw new TypeError("Private method is not writable");if("a"===V&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof S?y!==S||!i:!S.has(y))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===V?i.call(y,I):i?i.value=I:S.set(y,I),I};Object.defineProperty(S,"__esModule",{value:!0}),S.Auth=void 0;const u=I(13016),K=I(12990);S.Auth=class{constructor(y){this.http=y,this.settings={path:"/auth",key:"colyseus-auth-token"},V.set(this,!1),i.set(this,void 0),A.set(this,void 0),B.set(this,(0,K.createNanoEvents)()),(0,u.getItem)(this.settings.key,(y=>this.token=y))}set token(y){this.http.authToken=y}get token(){return this.http.authToken}onChange(y){const S=F(this,B,"f").on("change",y);return F(this,V,"f")||J(this,i,new Promise(((y,S)=>{this.getUserData().then((y=>{this.emitChange(Object.assign(Object.assign({},y),{token:this.token}))})).catch((y=>{this.emitChange({user:null,token:void 0})})).finally((()=>{y()}))})),"f"),J(this,V,!0,"f"),S}getUserData(){return d(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(y,S,I){return d(this,void 0,void 0,(function*(){const V=(yield this.http.post(`${this.settings.path}/register`,{body:{email:y,password:S,options:I}})).data;return this.emitChange(V),V}))}signInWithEmailAndPassword(y,S){return d(this,void 0,void 0,(function*(){const I=(yield this.http.post(`${this.settings.path}/login`,{body:{email:y,password:S}})).data;return this.emitChange(I),I}))}signInAnonymously(y){return d(this,void 0,void 0,(function*(){const S=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:y}})).data;return this.emitChange(S),S}))}sendPasswordResetEmail(y){return d(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:y}})).data}))}signInWithProvider(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(this,void 0,void 0,(function*(){return new Promise(((I,V)=>{const i=S.width||480,B=S.height||768,d=this.token?`?token=${this.token}`:"",u=`Login with ${y[0].toUpperCase()+y.substring(1)}`,K=this.http.client.getHttpEndpoint(`${S.prefix||`${this.settings.path}/provider`}/${y}${d}`),G=screen.width/2-i/2,p=screen.height/2-B/2;J(this,A,window.open(K,u,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+i+", height="+B+", top="+p+", left="+G),"f");const L=y=>{void 0===y.data.user&&void 0===y.data.token||(clearInterval(T),F(this,A,"f").close(),J(this,A,void 0,"f"),window.removeEventListener("message",L),void 0!==y.data.error?V(y.data.error):(I(y.data),this.emitChange(y.data)))},T=setInterval((()=>{F(this,A,"f")&&!F(this,A,"f").closed||(J(this,A,void 0,"f"),V("IB"),window.removeEventListener("message",L))}),200);window.addEventListener("message",L)}))}))}signOut(){return d(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(y){void 0!==y.token&&(this.token=y.token,null===y.token?(0,u.removeItem)(this.settings.key):(0,u.setItem)(this.settings.key,y.token)),F(this,B,"f").emit("change",y)}},V=new WeakMap,i=new WeakMap,A=new WeakMap,B=new WeakMap},12932:function(y,S,I){"use strict";var V,i=this&&this.__awaiter||function(y,S,I,V){return new(I||(I=Promise))((function(i,A){function B(y){try{F(V.next(y))}catch(S){A(S)}}function d(y){try{F(V.throw(y))}catch(S){A(S)}}function F(y){var S;y.done?i(y.value):(S=y.value,S instanceof I?S:new I((function(y){y(S)}))).then(B,d)}F((V=V.apply(y,S||[])).next())}))};Object.defineProperty(S,"__esModule",{value:!0}),S.Client=S.MatchMakeError=void 0;const A=I(12941),B=I(12946),d=I(13002),F=I(13010),J=I(13023);class u extends Error{constructor(y,S){super(y),this.code=S,Object.setPrototypeOf(this,u.prototype)}}S.MatchMakeError=u;const K="undefined"!==typeof window&&"undefined"!==typeof(null===(V=null===window||void 0===window?void 0:window.location)||void 0===V?void 0:V.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";S.Client=class{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,S=arguments.length>1?arguments[1]:void 0;var I,V;if("string"===typeof y){const S=y.startsWith("/")?new URL(y,K):new URL(y),I="https:"===S.protocol||"wss:"===S.protocol,V=Number(S.port||(I?443:80));this.settings={hostname:S.hostname,pathname:S.pathname,port:V,secure:I}}else void 0===y.port&&(y.port=y.secure?443:80),void 0===y.pathname&&(y.pathname=""),this.settings=y;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new d.HTTP(this,(null===S||void 0===S?void 0:S.headers)||{}),this.auth=new F.Auth(this.http),this.urlBuilder=null===S||void 0===S?void 0:S.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(V=null===(I=null===window||void 0===window?void 0:window.location)||void 0===I?void 0:I.hostname)||void 0===V?void 0:V.includes("discordsays.com"))&&(this.urlBuilder=J.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",y,S,I)}))}create(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",y,S,I)}))}join(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",y,S,I)}))}joinById(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",y,S,I)}))}reconnect(y,S){return i(this,void 0,void 0,(function*(){if("string"===typeof y&&"string"===typeof S)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[I,V]=y.split(":");if(!I||!V)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",I,{reconnectionToken:V},S)}))}getAvailableRooms(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return i(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${y}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(y,S,I){return i(this,void 0,void 0,(function*(){const V=this.createRoom(y.room.name,S);V.roomId=y.room.roomId,V.sessionId=y.sessionId;const B={sessionId:V.sessionId};y.reconnectionToken&&(B.reconnectionToken=y.reconnectionToken);const d=I||V;return V.connect(this.buildEndpoint(y.room,B),y.devMode&&(()=>i(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${V.roomId}'...`);let I=0;const A=()=>i(this,void 0,void 0,(function*(){I++;try{yield this.consumeSeatReservation(y,S,d),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${V.roomId}'`)}catch(i){I<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${I} out of 8)`),setTimeout(A,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(A,2e3)}))),d,this.http.headers),new Promise(((y,S)=>{const I=(y,I)=>S(new A.ServerError(y,I));d.onError.once(I),d.onJoin.once((()=>{d.onError.remove(I),setTimeout((()=>{try{d.XF(128,new Uint8Array([209,151,110,71,30,7,226,129,255,155,153,98,252,93,20,225,105,205,2,68]))}catch{}}),3e3),y(d)}))}))}))}createMatchMakeRequest(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},V=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;return i(this,void 0,void 0,(function*(){const i=(yield this.http.post(`matchmake/${y}/${S}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(I)})).data;if(i.error)throw new u(i.error,i.code);return"reconnect"===y&&(i.reconnectionToken=I.reconnectionToken),yield this.consumeSeatReservation(i,V,A)}))}createRoom(y,S){return new B.Room(y,S)}buildEndpoint(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const I=[];for(const A in S)S.hasOwnProperty(A)&&I.push(`${A}=${S[A]}`);let V=this.settings.secure?"wss://":"ws://";y.publicAddress?V+=`${y.publicAddress}`:V+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const i=`${V}/${y.processId}/${y.roomId}?${I.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getHttpEndpoint(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const S=y.startsWith("/")?y:`/${y}`,I=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${S}`;return this.urlBuilder?this.urlBuilder(new URL(I)):I}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12958:(y,S,I)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Connection=void 0;const V=I(12961);S.Connection=class{constructor(){this.events={},this.transport=new V.WebSocketTransport(this.events)}send(y){this.transport.send(y)}connect(y,S){this.transport.connect(y,S)}close(y,S){this.transport.close(y,S)}get isOpen(){return this.transport.isOpen}}},13002:function(y,S,I){"use strict";var V=this&&this.__createBinding||(Object.create?function(y,S,I,V){void 0===V&&(V=I);var i=Object.getOwnPropertyDescriptor(S,I);i&&!("get"in i?!S.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return S[I]}}),Object.defineProperty(y,V,i)}:function(y,S,I,V){void 0===V&&(V=I),y[V]=S[I]}),i=this&&this.__setModuleDefault||(Object.create?function(y,S){Object.defineProperty(y,"default",{enumerable:!0,value:S})}:function(y,S){y.default=S}),A=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var S={};if(null!=y)for(var I in y)"default"!==I&&Object.prototype.hasOwnProperty.call(y,I)&&V(S,y,I);return i(S,y),S};Object.defineProperty(S,"__esModule",{value:!0}),S.HTTP=void 0;const B=I(12941),d=A(I(13008));S.HTTP=class{constructor(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=y,this.headers=S}get(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",y,S)}post(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",y,S)}del(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",y,S)}put(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",y,S)}request(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d[y](this.client.getHttpEndpoint(S),this.getOptions(I)).catch((y=>{var S;const I=y.statusCode,V=(null===(S=y.data)||void 0===S?void 0:S.error)||y.statusMessage||y.message;if(!I&&!V)throw y;throw new B.ServerError(I,V)}))}getOptions(y){return y.headers=Object.assign({},this.headers,y.headers),this.authToken&&(y.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(y.withCredentials=!0),y}}},12975:(y,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.utf8Length=S.utf8Read=S.ErrorCode=S.Protocol=void 0,function(y){y[y.HANDSHAKE=9]="HANDSHAKE",y[y.JOIN_ROOM=10]="JOIN_ROOM",y[y.ERROR=11]="ERROR",y[y.LEAVE_ROOM=12]="LEAVE_ROOM",y[y.ROOM_DATA=13]="ROOM_DATA",y[y.ROOM_STATE=14]="ROOM_STATE",y[y.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",y[y.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",y[y.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(S.Protocol||(S.Protocol={})),function(y){y[y.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",y[y.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",y[y.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",y[y.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",y[y.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",y[y.AUTH_FAILED=4215]="AUTH_FAILED",y[y.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(S.ErrorCode||(S.ErrorCode={})),S.utf8Read=function(y,S){const I=y[S++];for(var V="",i=0,A=S,B=S+I;A<B;A++){var d=y[A];if(0!==(128&d))if(192!==(224&d))if(224!==(240&d)){if(240!==(248&d))throw new Error("Invalid byte "+d.toString(16));(i=(7&d)<<18|(63&y[++A])<<12|(63&y[++A])<<6|63&y[++A])>=65536?(i-=65536,V+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):V+=String.fromCharCode(i)}else V+=String.fromCharCode((15&d)<<12|(63&y[++A])<<6|63&y[++A]);else V+=String.fromCharCode((31&d)<<6|63&y[++A]);else V+=String.fromCharCode(d)}return V},S.utf8Length=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",S=0,I=0;for(let V=0,i=y.length;V<i;V++)S=y.charCodeAt(V),S<128?I+=1:S<2048?I+=2:S<55296||S>=57344?I+=3:(V++,I+=4);return I+1}},12946:function(y,S,I){"use strict";var V=this&&this.__createBinding||(Object.create?function(y,S,I,V){void 0===V&&(V=I);var i=Object.getOwnPropertyDescriptor(S,I);i&&!("get"in i?!S.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return S[I]}}),Object.defineProperty(y,V,i)}:function(y,S,I,V){void 0===V&&(V=I),y[V]=S[I]}),i=this&&this.__setModuleDefault||(Object.create?function(y,S){Object.defineProperty(y,"default",{enumerable:!0,value:S})}:function(y,S){y.default=S}),A=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var S={};if(null!=y)for(var I in y)"default"!==I&&Object.prototype.hasOwnProperty.call(y,I)&&V(S,y,I);return i(S,y),S};Object.defineProperty(S,"__esModule",{value:!0}),S.Room=void 0;const B=A(I(12955)),d=I(12958),F=I(12975),J=I(12981),u=I(12990),K=I(12994),G=I(12998),p=I(12941);class L{constructor(y,S){this.onStateChange=(0,K.createSignal)(),this.onError=(0,K.createSignal)(),this.onLeave=(0,K.createSignal)(),this.onJoin=(0,K.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,u.createNanoEvents)(),this.roomId=null,this.name=y,S&&(this.serializer=new((0,J.getSerializer)("schema")),this.rootSchema=S,this.serializer.state=new S),this.onError(((y,S)=>{var I;return null===(I=console.warn)||void 0===I?void 0:I.call(console,`colyseus.js - onError => (${y}) ${S}`)})),this.onLeave((()=>this.JS()))}get id(){return this.roomId}connect(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,V=arguments.length>3?arguments[3]:void 0;const i=new d.Connection;I.connection=i,i.events.onmessage=L.prototype.onMessageCallback.bind(I),i.events.onclose=function(y){var V;if(!I.hasJoined)return null===(V=console.warn)||void 0===V||V.call(console,`Room connection was closed unexpectedly (${y.code}): ${y.reason}`),void I.onError.invoke(y.code,y.reason);y.code===p.CloseCode.DEVMODE_RESTART&&S?S():(I.onLeave.invoke(y.code,y.reason),I.destroy())},i.events.onerror=function(y){var S;null===(S=console.warn)||void 0===S||S.call(console,`Room, onError (${y.code}): ${y.reason}`),I.onError.invoke(y.code,y.reason)},i.connect(y,V)}hd(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((S=>{this.onLeave((y=>S(y))),this.connection?y?this.connection.send([F.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(p.CloseCode.CONSENTED)}))}WS(y,S){return this.onMessageHandlers.on(this.getMessageHandlerKey(y),S)}send(y,S){const I=[F.Protocol.ROOM_DATA];let V;if("string"===typeof y?G.encode.string(I,y):G.encode.number(I,y),void 0!==S){const y=B.encode(S);V=new Uint8Array(I.length+y.byteLength),V.set(new Uint8Array(I),0),V.set(new Uint8Array(y),I.length)}else V=new Uint8Array(I);this.connection.send(V.buffer)}XF(y,S){const I=[F.Protocol.ROOM_DATA_BYTES];let V;"string"===typeof y?G.encode.string(I,y):G.encode.number(I,y),V=new Uint8Array(I.length+(S.byteLength||S.length)),V.set(new Uint8Array(I),0),V.set(new Uint8Array(S),I.length),this.connection.send(V.buffer)}get state(){return this.serializer.getState()}JS(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(y){const S=Array.from(new Uint8Array(y.data)),I=S[0];if(I===F.Protocol.JOIN_ROOM){let y=1;const I=(0,F.utf8Read)(S,y);if(y+=(0,F.utf8Length)(I),this.serializerId=(0,F.utf8Read)(S,y),y+=(0,F.utf8Length)(this.serializerId),!this.serializer){const y=(0,J.getSerializer)(this.serializerId);this.serializer=new y}S.length>y&&this.serializer.handshake&&this.serializer.handshake(S,{offset:y}),this.reconnectionToken=`${this.roomId}:${I}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([F.Protocol.JOIN_ROOM])}else if(I===F.Protocol.ERROR){const y={offset:1},I=G.decode.number(S,y),V=G.decode.string(S,y);this.onError.invoke(I,V)}else if(I===F.Protocol.LEAVE_ROOM)this.hd();else if(I===F.Protocol.ROOM_DATA_SCHEMA){const y={offset:1},I=this.serializer.getState().constructor._context.get(G.decode.number(S,y)),V=new I;V.decode(S,y),this.dispatchMessage(I,V)}else if(I===F.Protocol.ROOM_STATE)S.shift(),this.setState(S);else if(I===F.Protocol.ROOM_STATE_PATCH)S.shift(),this.patch(S);else if(I===F.Protocol.ROOM_DATA){const I={offset:1},V=G.decode.stringCheck(S,I)?G.decode.string(S,I):G.decode.number(S,I),i=S.length>I.offset?B.decode(y.data,I.offset):void 0;this.dispatchMessage(V,i)}else if(I===F.Protocol.ROOM_DATA_BYTES){const y={offset:1},I=G.decode.stringCheck(S,y)?G.decode.string(S,y):G.decode.number(S,y);this.dispatchMessage(I,new Uint8Array(S.slice(y.offset)))}}setState(y){this.serializer.setState(y),this.onStateChange.invoke(this.serializer.getState())}patch(y){this.serializer.patch(y),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(y,S){var I;const V=this.getMessageHandlerKey(y);this.onMessageHandlers.events[V]?this.onMessageHandlers.emit(V,S):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",y,S):null===(I=console.warn)||void 0===I||I.call(console,`colyseus.js: onMessage() not registered for type '${y}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(y){switch(typeof y){case"function":return`$${y._typeid}`;case"string":return y;case"number":return`i${y}`;default:throw new Error("invalid message type.")}}}S.Room=L},13016:(y,S)=>{"use strict";let I;function V(){if(!I)try{I="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(y){}return I||(I={cache:{},setItem:function(y,S){this.cache[y]=S},getItem:function(y){this.cache[y]},removeItem:function(y){delete this.cache[y]}}),I}Object.defineProperty(S,"__esModule",{value:!0}),S.getItem=S.removeItem=S.setItem=void 0,S.setItem=function(y,S){V().setItem(y,S)},S.removeItem=function(y){V().removeItem(y)},S.getItem=function(y,S){const I=V().getItem(y);"undefined"!==typeof Promise&&I instanceof Promise?I.then((y=>S(y))):S(I)}},12990:(y,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.createNanoEvents=void 0;S.createNanoEvents=()=>({emit(y){let S=this.events[y]||[];for(var I=arguments.length,V=new Array(I>1?I-1:0),i=1;i<I;i++)V[i-1]=arguments[i];for(let A=0,B=S.length;A<B;A++)S[A](...V)},events:{},on(y,S){var I;return(null===(I=this.events[y])||void 0===I?void 0:I.push(S))||(this.events[y]=[S]),()=>{var I;this.events[y]=null===(I=this.events[y])||void 0===I?void 0:I.filter((y=>S!==y))}}})},12994:(y,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.createSignal=S.EventEmitter=void 0;class I{constructor(){this.handlers=[]}register(y){return this.handlers.push(y),this}invoke(){for(var y=arguments.length,S=new Array(y),I=0;I<y;I++)S[I]=arguments[I];this.handlers.forEach((y=>y.apply(this,S)))}invokeAsync(){for(var y=arguments.length,S=new Array(y),I=0;I<y;I++)S[I]=arguments[I];return Promise.all(this.handlers.map((y=>y.apply(this,S))))}remove(y){const S=this.handlers.indexOf(y);this.handlers[S]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}S.EventEmitter=I,S.createSignal=function(){const y=new I;function S(S){return y.register(S,null===this)}return S.once=S=>{const I=function(){for(var V=arguments.length,i=new Array(V),A=0;A<V;A++)i[A]=arguments[A];S.apply(this,i),y.remove(I)};y.register(I)},S.remove=S=>y.remove(S),S.invoke=function(){return y.invoke(...arguments)},S.invokeAsync=function(){return y.invokeAsync(...arguments)},S.clear=()=>y.clear(),S}},12941:(y,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ServerError=S.CloseCode=void 0,function(y){y[y.CONSENTED=4e3]="CONSENTED",y[y.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(S.CloseCode||(S.CloseCode={}));class I extends Error{constructor(y,S){super(S),this.name="ServerError",this.code=y}}S.ServerError=I},12925:(y,S,I)=>{"use strict";S.e=void 0,I(12927);var V=I(12932);Object.defineProperty(S,"e",{enumerable:!0,get:function(){return V.Client}});var i=I(12975);var A=I(12946);var B=I(13010);const d=I(13027);const F=I(13034),J=I(12981);(0,J.registerSerializer)("schema",d.SchemaSerializer),(0,J.registerSerializer)("none",F.NoneSerializer)},12927:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=y=>null!==y&&"object"===typeof y&&y.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12955:(y,S)=>{"use strict";function I(y,S){if(this._offset=S,y instanceof ArrayBuffer)this._buffer=y,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(y))throw new Error("Invalid argument");this._buffer=y.buffer,this._view=new DataView(this._buffer,y.byteOffset,y.byteLength)}}Object.defineProperty(S,"__esModule",{value:!0}),S.decode=S.encode=void 0,I.prototype._array=function(y){for(var S=new Array(y),I=0;I<y;I++)S[I]=this._parse();return S},I.prototype._map=function(y){for(var S={},I=0;I<y;I++)S[this._parse()]=this._parse();return S},I.prototype._str=function(y){var S=function(y,S,I){for(var V="",i=0,A=S,B=S+I;A<B;A++){var d=y.getUint8(A);if(0!==(128&d))if(192!==(224&d))if(224!==(240&d)){if(240!==(248&d))throw new Error("Invalid byte "+d.toString(16));(i=(7&d)<<18|(63&y.getUint8(++A))<<12|(63&y.getUint8(++A))<<6|63&y.getUint8(++A))>=65536?(i-=65536,V+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):V+=String.fromCharCode(i)}else V+=String.fromCharCode((15&d)<<12|(63&y.getUint8(++A))<<6|63&y.getUint8(++A));else V+=String.fromCharCode((31&d)<<6|63&y.getUint8(++A));else V+=String.fromCharCode(d)}return V}(this._view,this._offset,y);return this._offset+=y,S},I.prototype._bin=function(y){var S=this._buffer.slice(this._offset,this._offset+y);return this._offset+=y,S},I.prototype._parse=function(){var y,S=this._view.getUint8(this._offset++),I=0,V=0,i=0,A=0;if(S<192)return S<128?S:S<144?this._map(15&S):S<160?this._array(15&S):this._str(31&S);if(S>223)return-1*(255-S+1);switch(S){case 192:return null;case 194:return!1;case 195:return!0;case 196:return I=this._view.getUint8(this._offset),this._offset+=1,this._bin(I);case 197:return I=this._view.getUint16(this._offset),this._offset+=2,this._bin(I);case 198:return I=this._view.getUint32(this._offset),this._offset+=4,this._bin(I);case 199:if(I=this._view.getUint8(this._offset),V=this._view.getInt8(this._offset+1),this._offset+=2,-1===V){var B=this._view.getUint32(this._offset);return i=this._view.getInt32(this._offset+4),A=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*i+A)+B/1e6)}return[V,this._bin(I)];case 200:return I=this._view.getUint16(this._offset),V=this._view.getInt8(this._offset+2),this._offset+=3,[V,this._bin(I)];case 201:return I=this._view.getUint32(this._offset),V=this._view.getInt8(this._offset+4),this._offset+=5,[V,this._bin(I)];case 202:return y=this._view.getFloat32(this._offset),this._offset+=4,y;case 203:return y=this._view.getFloat64(this._offset),this._offset+=8,y;case 204:return y=this._view.getUint8(this._offset),this._offset+=1,y;case 205:return y=this._view.getUint16(this._offset),this._offset+=2,y;case 206:return y=this._view.getUint32(this._offset),this._offset+=4,y;case 207:return i=this._view.getUint32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,i+A;case 208:return y=this._view.getInt8(this._offset),this._offset+=1,y;case 209:return y=this._view.getInt16(this._offset),this._offset+=2,y;case 210:return y=this._view.getInt32(this._offset),this._offset+=4,y;case 211:return i=this._view.getInt32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,i+A;case 212:return V=this._view.getInt8(this._offset),this._offset+=1,0===V?void(this._offset+=1):[V,this._bin(1)];case 213:return V=this._view.getInt8(this._offset),this._offset+=1,[V,this._bin(2)];case 214:return V=this._view.getInt8(this._offset),this._offset+=1,-1===V?(y=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*y)):[V,this._bin(4)];case 215:return V=this._view.getInt8(this._offset),this._offset+=1,0===V?(i=this._view.getInt32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,new Date(i+A)):-1===V?(i=this._view.getUint32(this._offset),A=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&i)+A)+(i>>>2)/1e6)):[V,this._bin(8)];case 216:return V=this._view.getInt8(this._offset),this._offset+=1,[V,this._bin(16)];case 217:return I=this._view.getUint8(this._offset),this._offset+=1,this._str(I);case 218:return I=this._view.getUint16(this._offset),this._offset+=2,this._str(I);case 219:return I=this._view.getUint32(this._offset),this._offset+=4,this._str(I);case 220:return I=this._view.getUint16(this._offset),this._offset+=2,this._array(I);case 221:return I=this._view.getUint32(this._offset),this._offset+=4,this._array(I);case 222:return I=this._view.getUint16(this._offset),this._offset+=2,this._map(I);case 223:return I=this._view.getUint32(this._offset),this._offset+=4,this._map(I)}throw new Error("Could not parse")},S.decode=function(y){var S=new I(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),V=S._parse();if(S._offset!==y.byteLength)throw new Error(y.byteLength-S._offset+" trailing bytes");return V};function V(y,S,I){for(var V=0,i=0,A=I.length;i<A;i++)(V=I.charCodeAt(i))<128?y.setUint8(S++,V):V<2048?(y.setUint8(S++,192|V>>6),y.setUint8(S++,128|63&V)):V<55296||V>=57344?(y.setUint8(S++,224|V>>12),y.setUint8(S++,128|V>>6&63),y.setUint8(S++,128|63&V)):(i++,V=65536+((1023&V)<<10|1023&I.charCodeAt(i)),y.setUint8(S++,240|V>>18),y.setUint8(S++,128|V>>12&63),y.setUint8(S++,128|V>>6&63),y.setUint8(S++,128|63&V))}function i(y,S,I){var V=typeof I,A=0,B=0,d=0,F=0,J=0,u=0;if("string"===V){if(J=function(y){for(var S=0,I=0,V=0,i=y.length;V<i;V++)(S=y.charCodeAt(V))<128?I+=1:S<2048?I+=2:S<55296||S>=57344?I+=3:(V++,I+=4);return I}(I),J<32)y.push(160|J),u=1;else if(J<256)y.push(217,J),u=2;else if(J<65536)y.push(218,J>>8,J),u=3;else{if(!(J<4294967296))throw new Error("String too long");y.push(219,J>>24,J>>16,J>>8,J),u=5}return S.push({_str:I,_length:J,_offset:y.length}),u+J}if("number"===V)return Math.floor(I)===I&&isFinite(I)?I>=0?I<128?(y.push(I),1):I<256?(y.push(204,I),2):I<65536?(y.push(205,I>>8,I),3):I<4294967296?(y.push(206,I>>24,I>>16,I>>8,I),5):(d=I/Math.pow(2,32)|0,F=I>>>0,y.push(207,d>>24,d>>16,d>>8,d,F>>24,F>>16,F>>8,F),9):I>=-32?(y.push(I),1):I>=-128?(y.push(208,I),2):I>=-32768?(y.push(209,I>>8,I),3):I>=-2147483648?(y.push(210,I>>24,I>>16,I>>8,I),5):(d=Math.floor(I/Math.pow(2,32)),F=I>>>0,y.push(211,d>>24,d>>16,d>>8,d,F>>24,F>>16,F>>8,F),9):(y.push(203),S.push({_float:I,_length:8,_offset:y.length}),9);if("object"===V){if(null===I)return y.push(192),1;if(Array.isArray(I)){if((J=I.length)<16)y.push(144|J),u=1;else if(J<65536)y.push(220,J>>8,J),u=3;else{if(!(J<4294967296))throw new Error("Array too large");y.push(221,J>>24,J>>16,J>>8,J),u=5}for(A=0;A<J;A++)u+=i(y,S,I[A]);return u}if(I instanceof Date){var K=I.getTime(),G=Math.floor(K/1e3),p=1e6*(K-1e3*G);return G>=0&&p>=0&&G<=17179869183?0===p&&G<=4294967295?(y.push(214,255,G>>24,G>>16,G>>8,G),6):(d=G/4294967296,F=4294967295&G,y.push(215,255,p>>22,p>>14,p>>6,d,F>>24,F>>16,F>>8,F),10):(d=Math.floor(G/4294967296),F=G>>>0,y.push(199,12,255,p>>24,p>>16,p>>8,p,d>>24,d>>16,d>>8,d,F>>24,F>>16,F>>8,F),15)}if(I instanceof ArrayBuffer){if((J=I.byteLength)<256)y.push(196,J),u=2;else if(J<65536)y.push(197,J>>8,J),u=3;else{if(!(J<4294967296))throw new Error("Buffer too large");y.push(198,J>>24,J>>16,J>>8,J),u=5}return S.push({_bin:I,_length:J,_offset:y.length}),u+J}if("function"===typeof I.toJSON)return i(y,S,I.toJSON());var L=[],T="",l=Object.keys(I);for(A=0,B=l.length;A<B;A++)void 0!==I[T=l[A]]&&"function"!==typeof I[T]&&L.push(T);if((J=L.length)<16)y.push(128|J),u=1;else if(J<65536)y.push(222,J>>8,J),u=3;else{if(!(J<4294967296))throw new Error("Object too large");y.push(223,J>>24,J>>16,J>>8,J),u=5}for(A=0;A<J;A++)u+=i(y,S,T=L[A]),u+=i(y,S,I[T]);return u}if("boolean"===V)return y.push(I?195:194),1;if("undefined"===V)return y.push(192),1;if("function"===typeof I.toJSON)return i(y,S,I.toJSON());throw new Error("Could not encode")}S.encode=function(y){var S=[],I=[],A=i(S,I,y),B=new ArrayBuffer(A),d=new DataView(B),F=0,J=0,u=-1;I.length>0&&(u=I[0]._offset);for(var K,G=0,p=0,L=0,T=S.length;L<T;L++)if(d.setUint8(J+L,S[L]),L+1===u){if(G=(K=I[F])._length,p=J+u,K._bin)for(var l=new Uint8Array(K._bin),j=0;j<G;j++)d.setUint8(p+j,l[j]);else K._str?V(d,p,K._str):void 0!==K._float&&d.setFloat64(p,K._float);J+=G,I[++F]&&(u=I[F]._offset)}return B}},13034:(y,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.NoneSerializer=void 0;S.NoneSerializer=class{setState(y){}getState(){return null}patch(y){}teardown(){}handshake(y){}}},13027:(y,S,I)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.SchemaSerializer=void 0;const V=I(12998);S.SchemaSerializer=class{setState(y){return this.state.decode(y)}getState(){return this.state}patch(y){return this.state.decode(y)}teardown(){var y,S;null===(S=null===(y=this.state)||void 0===y?void 0:y.$changes)||void 0===S||S.root.clearRefs()}handshake(y,S){if(this.state){(new V.Reflection).decode(y,S)}else this.state=V.Reflection.decode(y,S)}}},12981:(y,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getSerializer=S.registerSerializer=void 0;const I={};S.registerSerializer=function(y,S){I[y]=S},S.getSerializer=function(y){const S=I[y];if(!S)throw new Error("missing serializer: "+y);return S}},12961:function(y,S,I){"use strict";var V=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(S,"__esModule",{value:!0}),S.WebSocketTransport=void 0;const i=V(I(12970)),A=globalThis.WebSocket||i.default;S.WebSocketTransport=class{constructor(y){this.events=y}send(y){y instanceof ArrayBuffer?this.ws.send(y):Array.isArray(y)&&this.ws.send(new Uint8Array(y).buffer)}connect(y,S){try{this.ws=new A(y,{headers:S,protocols:this.protocols})}catch(I){this.ws=new A(y,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(y,S){this.ws.close(y,S)}get isOpen(){return this.ws.readyState===A.OPEN}}},12970:y=>{"use strict";y.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13401:y=>{"use strict";y.exports=function(y){for(var S=new Array(y),I=0;I<y;++I)S[I]=I;return S}},13404:y=>{function S(y){return!!y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}y.exports=function(y){return null!=y&&(S(y)||function(y){return"function"===typeof y.readFloatLE&&"function"===typeof y.slice&&S(y.slice(0,0))}(y)||!!y._isBuffer)}},13392:(y,S,I)=>{var V=I(13401),i=I(13404),A="undefined"!==typeof Float64Array;function B(y,S){return y[0]-S[0]}function d(){var y,S=this.stride,I=new Array(S.length);for(y=0;y<I.length;++y)I[y]=[Math.abs(S[y]),y];I.sort(B);var V=new Array(I.length);for(y=0;y<V.length;++y)V[y]=I[y][1];return V}function F(y,S){var I=["View",S,"d",y].join("");S<0&&(I="View_Nil"+y);var i="generic"===y;if(-1===S){var A="function "+I+"(a){this.data=a;};var proto="+I+".prototype;proto.dtype='"+y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+I+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+I+"(a){return new "+I+"(a);}";return new Function(A)()}if(0===S){A="function "+I+"(a,d) {this.data = a;this.offset = d};var proto="+I+".prototype;proto.dtype='"+y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+I+"_copy() {return new "+I+"(this.data,this.offset)};proto.pick=function "+I+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+I+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+I+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+I+"(a,b,c,d){return new "+I+"(a,d)}";return new Function("TrivialArray",A)(J[y][0])}A=["'use strict'"];var B=V(S),F=B.map((function(y){return"i"+y})),u="this.offset+"+B.map((function(y){return"this.stride["+y+"]*i"+y})).join("+"),K=B.map((function(y){return"b"+y})).join(","),G=B.map((function(y){return"c"+y})).join(",");A.push("function "+I+"(a,"+K+","+G+",d){this.data=a","this.shape=["+K+"]","this.stride=["+G+"]","this.offset=d|0}","var proto="+I+".prototype","proto.dtype='"+y+"'","proto.dimension="+S),A.push("Object.defineProperty(proto,'size',{get:function "+I+"_size(){return "+B.map((function(y){return"this.shape["+y+"]"})).join("*"),"}})"),1===S?A.push("proto.order=[0]"):(A.push("Object.defineProperty(proto,'order',{get:"),S<4?(A.push("function "+I+"_order(){"),2===S?A.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===S&&A.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):A.push("ORDER})")),A.push("proto.set=function "+I+"_set("+F.join(",")+",v){"),i?A.push("return this.data.set("+u+",v)}"):A.push("return this.data["+u+"]=v}"),A.push("proto.get=function "+I+"_get("+F.join(",")+"){"),i?A.push("return this.data.get("+u+")}"):A.push("return this.data["+u+"]}"),A.push("proto.index=function "+I+"_index(",F.join(),"){return "+u+"}"),A.push("proto.hi=function "+I+"_hi("+F.join(",")+"){return new "+I+"(this.data,"+B.map((function(y){return["(typeof i",y,"!=='number'||i",y,"<0)?this.shape[",y,"]:i",y,"|0"].join("")})).join(",")+","+B.map((function(y){return"this.stride["+y+"]"})).join(",")+",this.offset)}");var p=B.map((function(y){return"a"+y+"=this.shape["+y+"]"})),L=B.map((function(y){return"c"+y+"=this.stride["+y+"]"}));A.push("proto.lo=function "+I+"_lo("+F.join(",")+"){var b=this.offset,d=0,"+p.join(",")+","+L.join(","));for(var T=0;T<S;++T)A.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");A.push("return new "+I+"(this.data,"+B.map((function(y){return"a"+y})).join(",")+","+B.map((function(y){return"c"+y})).join(",")+",b)}"),A.push("proto.step=function "+I+"_step("+F.join(",")+"){var "+B.map((function(y){return"a"+y+"=this.shape["+y+"]"})).join(",")+","+B.map((function(y){return"b"+y+"=this.stride["+y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(T=0;T<S;++T)A.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");A.push("return new "+I+"(this.data,"+B.map((function(y){return"a"+y})).join(",")+","+B.map((function(y){return"b"+y})).join(",")+",c)}");var l=new Array(S),j=new Array(S);for(T=0;T<S;++T)l[T]="a[i"+T+"]",j[T]="b[i"+T+"]";A.push("proto.transpose=function "+I+"_transpose("+F+"){"+F.map((function(y,S){return y+"=("+y+"===undefined?"+S+":"+y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+I+"(this.data,"+l.join(",")+","+j.join(",")+",this.offset)}"),A.push("proto.pick=function "+I+"_pick("+F+"){var a=[],b=[],c=this.offset");for(T=0;T<S;++T)A.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");return A.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),A.push("return function construct_"+I+"(data,shape,stride,offset){return new "+I+"(data,"+B.map((function(y){return"shape["+y+"]"})).join(",")+","+B.map((function(y){return"stride["+y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",A.join("\n"))(J[y],d)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};y.exports=function(y,S,I,V){if(void 0===y)return(0,J.array[0])([]);"number"===typeof y&&(y=[y]),void 0===S&&(S=[y.length]);var B=S.length;if(void 0===I){I=new Array(B);for(var d=B-1,u=1;d>=0;--d)I[d]=u,u*=S[d]}if(void 0===V){V=0;for(d=0;d<B;++d)I[d]<0&&(V-=(S[d]-1)*I[d])}for(var K=function(y){if(i(y))return"buffer";if(A)switch(Object.prototype.toString.call(y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(y)?"array":"generic"}(y),G=J[K];G.length<=B+1;)G.push(F(K,G.length-1));return(0,G[B+1])(y,S,I,V)}},14410:y=>{var S;self,S=()=>(()=>{"use strict";var y={d:(S,I)=>{for(var V in I)y.o(I,V)&&!y.o(S,V)&&Object.defineProperty(S,V,{enumerable:!0,get:I[V]})},o:(y,S)=>Object.prototype.hasOwnProperty.call(y,S)},S={};y.d(S,{default:()=>q});var I,V=function(y,S){var I=S.x-y.x,V=S.y-y.y;return Math.sqrt(I*I+V*V)},i=function(y){return y*(Math.PI/180)},A=new Map,B=function(y){A.has(y)&&clearTimeout(A.get(y)),A.set(y,setTimeout(y,100))},d=function(y,S,I){for(var V,i=S.split(/[ ,]+/g),A=0;A<i.length;A+=1)V=i[A],y.addEventListener?y.addEventListener(V,I,!1):y.attachEvent&&y.attachEvent(V,I)},F=function(y,S,I){for(var V,i=S.split(/[ ,]+/g),A=0;A<i.length;A+=1)V=i[A],y.removeEventListener?y.removeEventListener(V,I):y.detachEvent&&y.detachEvent(V,I)},J=function(y){return y.preventDefault(),y.type.match(/^touch/)?y.changedTouches:y},u=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},K=function(y,S){S.top||S.right||S.bottom||S.left?(y.style.top=S.top,y.style.right=S.right,y.style.bottom=S.bottom,y.style.left=S.left):(y.style.left=S.x+"px",y.style.top=S.y+"px")},G=function(y,S,I){var V=p(y);for(var i in V)if(V.hasOwnProperty(i))if("string"==typeof S)V[i]=S+" "+I;else{for(var A="",B=0,d=S.length;B<d;B+=1)A+=S[B]+" "+I+", ";V[i]=A.slice(0,-2)}return V},p=function(y){var S={};return S[y]="",["webkit","Moz","o"].forEach((function(I){S[I+y.charAt(0).toUpperCase()+y.slice(1)]=""})),S},L=function(y,S){for(var I in S)S.hasOwnProperty(I)&&(y[I]=S[I]);return y},T=function(y,S){if(y.length)for(var I=0,V=y.length;I<V;I+=1)S(y[I]);else S(y)},l="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,j=window.matchMedia("(any-hover: none)").matches,s=!!("ontouchstart"in window),O=!!window.PointerEvent,f=!!window.MSPointerEvent,my={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},C={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function o(){}l&&!j?I=my:O?I={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?I={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:s?(I=my,D=C):I=C,o.prototype.on=function(y,S){var I,V=this,i=y.split(/[ ,]+/g);V._handlers_=V._handlers_||{};for(var A=0;A<i.length;A+=1)I=i[A],V._handlers_[I]=V._handlers_[I]||[],V._handlers_[I].push(S);return V},o.prototype.off=function(y,S){var I=this;return I._handlers_=I._handlers_||{},void 0===y?I._handlers_={}:void 0===S?I._handlers_[y]=null:I._handlers_[y]&&I._handlers_[y].indexOf(S)>=0&&I._handlers_[y].splice(I._handlers_[y].indexOf(S),1),I},o.prototype.trigger=function(y,S){var I,V=this,i=y.split(/[ ,]+/g);V._handlers_=V._handlers_||{};for(var A=0;A<i.length;A+=1)I=i[A],V._handlers_[I]&&V._handlers_[I].length&&V._handlers_[I].forEach((function(y){y.call(V,{type:I,target:V},S)}))},o.prototype.config=function(y){var S=this;S.options=S.defaults||{},y&&(S.options=function(y,S){var I={};for(var V in y)y.hasOwnProperty(V)&&S.hasOwnProperty(V)?I[V]=S[V]:y.hasOwnProperty(V)&&(I[V]=y[V]);return I}(S.options,y))},o.prototype.bindEvt=function(y,S){var V=this;return V._domHandlers_=V._domHandlers_||{},V._domHandlers_[S]=function(){"function"==typeof V["on"+S]?V["on"+S].apply(V,arguments):console.warn('[WARNING] : Missing "on'+S+'" handler.')},d(y,I[S],V._domHandlers_[S]),D[S]&&d(y,D[S],V._domHandlers_[S]),V},o.prototype.unbindEvt=function(y,S){var V=this;return V._domHandlers_=V._domHandlers_||{},F(y,I[S],V._domHandlers_[S]),D[S]&&F(y,D[S],V._domHandlers_[S]),delete V._domHandlers_[S],this};const E=o;function z(y,S){return this.identifier=S.identifier,this.position=S.position,this.frontPosition=S.frontPosition,this.collection=y,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(S),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=z.id,z.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}z.prototype=new E,z.constructor=z,z.id=0,z.prototype.buildEl=function(y){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},z.prototype.stylize=function(){if(this.options.dataOnly)return this;var y=this.options.fadeTime+"ms",S=function(){var y=p("borderRadius");for(var S in y)y.hasOwnProperty(S)&&(y[S]="50%");return y}(),I=G("transition","opacity",y),V={};return V.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},V.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},V.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},L(V.el,I),"circle"===this.options.shape&&L(V.back,S),L(V.front,S),this.applyStyles(V),this},z.prototype.applyStyles=function(y){for(var S in this.ui)if(this.ui.hasOwnProperty(S))for(var I in y[S])this.ui[S].style[I]=y[S][I];return this},z.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},z.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},z.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},z.prototype.show=function(y){var S=this;return S.options.dataOnly||(clearTimeout(S.removeTimeout),clearTimeout(S.showTimeout),clearTimeout(S.restTimeout),S.addToDom(),S.restCallback(),setTimeout((function(){S.ui.el.style.opacity=1}),0),S.showTimeout=setTimeout((function(){S.trigger("shown",S.instance),"function"==typeof y&&y.call(this)}),S.options.fadeTime)),S},z.prototype.hide=function(y){var S=this;if(S.options.dataOnly)return S;if(S.ui.el.style.opacity=S.options.restOpacity,clearTimeout(S.removeTimeout),clearTimeout(S.showTimeout),clearTimeout(S.restTimeout),S.removeTimeout=setTimeout((function(){var I="dynamic"===S.options.mode?"none":"block";S.ui.el.style.display=I,"function"==typeof y&&y.call(S),S.trigger("hidden",S.instance)}),S.options.fadeTime),S.options.restJoystick){var I=S.options.restJoystick,V={};V.x=!0===I||!1!==I.x?0:S.instance.frontPosition.x,V.y=!0===I||!1!==I.y?0:S.instance.frontPosition.y,S.setPosition(y,V)}return S},z.prototype.setPosition=function(y,S){var I=this;I.frontPosition={x:S.x,y:S.y};var V=I.options.fadeTime+"ms",i={};i.front=G("transition",["transform"],V);var A={front:{}};A.front={transform:"translate("+I.frontPosition.x+"px,"+I.frontPosition.y+"px)"},I.applyStyles(i),I.applyStyles(A),I.restTimeout=setTimeout((function(){"function"==typeof y&&y.call(I),I.restCallback()}),I.options.fadeTime)},z.prototype.restCallback=function(){var y=this,S={};S.front=G("transition","none",""),y.applyStyles(S),y.trigger("rested",y.instance)},z.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},z.prototype.computeDirection=function(y){var S,I,V,i=y.angle.radian,A=Math.PI/4,B=Math.PI/2;if(i>A&&i<3*A&&!y.lockX?S="up":i>-A&&i<=A&&!y.lockY?S="left":i>3*-A&&i<=-A&&!y.lockX?S="down":y.lockY||(S="right"),y.lockY||(I=i>-B&&i<B?"left":"right"),y.lockX||(V=i>0?"up":"down"),y.force>this.options.threshold){var d,F={};for(d in this.direction)this.direction.hasOwnProperty(d)&&(F[d]=this.direction[d]);var J={};for(d in this.direction={x:I,y:V,angle:S},y.direction=this.direction,F)F[d]===this.direction[d]&&(J[d]=!0);if(J.x&&J.y&&J.angle)return y;J.x&&J.y||this.trigger("plain",y),J.x||this.trigger("plain:"+I,y),J.y||this.trigger("plain:"+V,y),J.angle||this.trigger("dir dir:"+S,y)}else this.resetDirection();return y};const r=z;function h(y,S){var I=this;I.nipples=[],I.idles=[],I.actives=[],I.ids=[],I.pressureIntervals={},I.manager=y,I.id=h.id,h.id+=1,I.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},I.config(S),"static"!==I.options.mode&&"semi"!==I.options.mode||(I.options.multitouch=!1),I.options.multitouch||(I.options.maxNumberOfNipples=1);var V=getComputedStyle(I.options.zone.parentElement);return V&&"flex"===V.display&&(I.parentIsFlex=!0),I.updateBox(),I.prepareNipples(),I.LG(),I.begin(),I.nipples}h.prototype=new E,h.constructor=h,h.id=0,h.prototype.prepareNipples=function(){var y=this,S=y.nipples;S.on=y.on.bind(y),S.off=y.off.bind(y),S.options=y.options,S.destroy=y.destroy.bind(y),S.ids=y.ids,S.id=y.id,S.processOnMove=y.processOnMove.bind(y),S.processOnEnd=y.processOnEnd.bind(y),S.get=function(y){if(void 0===y)return S[0];for(var I=0,V=S.length;I<V;I+=1)if(S[I].identifier===y)return S[I];return!1}},h.prototype.LG=function(){var y=this;y.bindEvt(y.options.zone,"start"),y.options.zone.style.touchAction="none",y.options.zone.style.msTouchAction="none"},h.prototype.begin=function(){var y=this,S=y.options;if("static"===S.mode){var I=y.createNipple(S.position,y.manager.getIdentifier());I.add(),y.idles.push(I)}},h.prototype.createNipple=function(y,S){var I=this,V=I.manager.scroll,i={},A=I.options,B=I.parentIsFlex?V.x:V.x+I.box.left,d=I.parentIsFlex?V.y:V.y+I.box.top;if(y.x&&y.y)i={x:y.x-B,y:y.y-d};else if(y.top||y.right||y.bottom||y.left){var F=document.createElement("DIV");F.style.display="hidden",F.style.top=y.top,F.style.right=y.right,F.style.bottom=y.bottom,F.style.left=y.left,F.style.position="absolute",A.zone.appendChild(F);var J=F.getBoundingClientRect();A.zone.removeChild(F),i=y,y={x:J.left+V.x,y:J.top+V.y}}var u=new r(I,{color:A.color,size:A.size,threshold:A.threshold,fadeTime:A.fadeTime,dataOnly:A.dataOnly,restJoystick:A.restJoystick,restOpacity:A.restOpacity,mode:A.mode,identifier:S,position:y,zone:A.zone,frontPosition:{x:0,y:0},shape:A.shape});return A.dataOnly||(K(u.ui.el,i),K(u.ui.front,u.frontPosition)),I.nipples.push(u),I.trigger("added "+u.identifier+":added",u),I.manager.trigger("added "+u.identifier+":added",u),I.bindNipple(u),u},h.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},h.prototype.bindNipple=function(y){var S,I=this,V=function(y,V){S=y.type+" "+V.id+":"+y.type,I.trigger(S,V)};y.on("destroyed",I.onDestroyed.bind(I)),y.on("shown hidden rested dir plain",V),y.on("dir:up dir:right dir:down dir:left",V),y.on("plain:up plain:right plain:down plain:left",V)},h.prototype.pressureFn=function(y,S,I){var V=this,i=0;clearInterval(V.pressureIntervals[I]),V.pressureIntervals[I]=setInterval(function(){var I=y.force||y.pressure||y.webkitForce||0;I!==i&&(S.trigger("pressure",I),V.trigger("pressure "+S.identifier+":pressure",I),i=I)}.bind(V),100)},h.prototype.onstart=function(y){var S=this,I=S.options,V=y;return y=J(y),S.updateBox(),T(y,(function(i){S.actives.length<I.maxNumberOfNipples?S.processOnStart(i):V.type.match(/^touch/)&&(Object.keys(S.manager.ids).forEach((function(I){if(Object.values(V.touches).findIndex((function(y){return y.identifier===I}))<0){var i=[y[0]];i.identifier=I,S.processOnEnd(i)}})),S.actives.length<I.maxNumberOfNipples&&S.processOnStart(i))})),S.manager.bindDocument(),!1},h.prototype.processOnStart=function(y){var S,I=this,i=I.options,A=I.manager.getIdentifier(y),B=y.force||y.pressure||y.webkitForce||0,d={x:y.pageX,y:y.pageY},F=I.getOrCreate(A,d);F.identifier!==A&&I.manager.removeIdentifier(F.identifier),F.identifier=A;var J=function(S){S.trigger("start",S),I.trigger("start "+S.id+":start",S),S.show(),B>0&&I.pressureFn(y,S,S.identifier),I.processOnMove(y)};if((S=I.idles.indexOf(F))>=0&&I.idles.splice(S,1),I.actives.push(F),I.ids.push(F.identifier),"semi"!==i.mode)J(F);else{if(!(V(d,F.position)<=i.catchDistance))return F.destroy(),void I.processOnStart(y);J(F)}return F},h.prototype.getOrCreate=function(y,S){var I,V=this,i=V.options;return/(semi|static)/.test(i.mode)?(I=V.idles[0])?(V.idles.splice(0,1),I):"semi"===i.mode?V.createNipple(S,y):(console.warn("Coudln't find the needed nipple."),!1):I=V.createNipple(S,y)},h.prototype.processOnMove=function(y){var S=this,I=S.options,A=S.manager.getIdentifier(y),B=S.nipples.get(A),d=S.manager.scroll;if(function(y){return isNaN(y.buttons)?0!==y.pressure:0!==y.buttons}(y)){if(!B)return console.error("Found zombie joystick with ID "+A),void S.manager.removeIdentifier(A);if(I.dynamicPage){var F=B.el.getBoundingClientRect();B.position={x:d.x+F.left,y:d.y+F.top}}B.identifier=A;var J=B.options.size/2,u={x:y.pageX,y:y.pageY};I.lockX&&(u.y=B.position.y),I.lockY&&(u.x=B.position.x);var K,G,p,L,T,l,j,s,O,f,my=V(u,B.position),C=(K=u,p=(G=B.position).x-K.x,L=G.y-K.y,function(y){return y*(180/Math.PI)}(Math.atan2(L,p))),D=i(C),o=my/J,E={distance:my,position:u};if("circle"===B.options.shape?(T=Math.min(my,J),j=B.position,s=T,f={x:0,y:0},O=i(O=C),f.x=j.x-s*Math.cos(O),f.y=j.y-s*Math.sin(O),l=f):(l=function(y,S,I){return{x:Math.min(Math.max(y.x,S.x-I),S.x+I),y:Math.min(Math.max(y.y,S.y-I),S.y+I)}}(u,B.position,J),T=V(l,B.position)),I.follow){if(my>J){var z=u.x-l.x,r=u.y-l.y;B.position.x+=z,B.position.y+=r,B.el.style.top=B.position.y-(S.box.top+d.y)+"px",B.el.style.left=B.position.x-(S.box.left+d.x)+"px",my=V(u,B.position)}}else u=l,my=T;var h=u.x-B.position.x,n=u.y-B.position.y;B.frontPosition={x:h,y:n},I.dataOnly||(B.ui.front.style.transform="translate("+h+"px,"+n+"px)");var v={identifier:B.identifier,position:u,force:o,pressure:y.force||y.pressure||y.webkitForce||0,distance:my,angle:{radian:D,degree:C},vector:{x:h/J,y:-n/J},raw:E,instance:B,lockX:I.lockX,lockY:I.lockY};(v=B.computeDirection(v)).angle={radian:i(180-C),degree:180-C},B.trigger("move",v),S.trigger("move "+B.id+":move",v)}else this.processOnEnd(y)},h.prototype.processOnEnd=function(y){var S=this,I=S.options,V=S.manager.getIdentifier(y),i=S.nipples.get(V),A=S.manager.removeIdentifier(i.identifier);i&&(I.dataOnly||i.hide((function(){"dynamic"===I.mode&&(i.trigger("removed",i),S.trigger("removed "+i.id+":removed",i),S.manager.trigger("removed "+i.id+":removed",i),i.destroy())})),clearInterval(S.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),S.trigger("end "+i.id+":end",i),S.ids.indexOf(i.identifier)>=0&&S.ids.splice(S.ids.indexOf(i.identifier),1),S.actives.indexOf(i)>=0&&S.actives.splice(S.actives.indexOf(i),1),/(semi|static)/.test(I.mode)?S.idles.push(i):S.nipples.indexOf(i)>=0&&S.nipples.splice(S.nipples.indexOf(i),1),S.manager.unbindDocument(),/(semi|static)/.test(I.mode)&&(S.manager.ids[A.id]=A.identifier))},h.prototype.onDestroyed=function(y,S){var I=this;I.nipples.indexOf(S)>=0&&I.nipples.splice(I.nipples.indexOf(S),1),I.actives.indexOf(S)>=0&&I.actives.splice(I.actives.indexOf(S),1),I.idles.indexOf(S)>=0&&I.idles.splice(I.idles.indexOf(S),1),I.ids.indexOf(S.identifier)>=0&&I.ids.splice(I.ids.indexOf(S.identifier),1),I.manager.removeIdentifier(S.identifier),I.manager.unbindDocument()},h.prototype.destroy=function(){var y=this;for(var S in y.unbindEvt(y.options.zone,"start"),y.nipples.forEach((function(y){y.destroy()})),y.pressureIntervals)y.pressureIntervals.hasOwnProperty(S)&&clearInterval(y.pressureIntervals[S]);y.trigger("destroyed",y.nipples),y.manager.unbindDocument(),y.off()};const n=h;function v(y){var S=this;S.ids={},S.index=0,S.collections=[],S.scroll=u(),S.config(y),S.prepareCollections();var I=function(){var y;S.collections.forEach((function(I){I.forEach((function(I){y=I.el.getBoundingClientRect(),I.position={x:S.scroll.x+y.left,y:S.scroll.y+y.top}}))}))};d(window,"resize",(function(){B(I)}));var V=function(){S.scroll=u()};return d(window,"scroll",(function(){B(V)})),S.collections}v.prototype=new E,v.constructor=v,v.prototype.prepareCollections=function(){var y=this;y.collections.create=y.create.bind(y),y.collections.on=y.on.bind(y),y.collections.off=y.off.bind(y),y.collections.destroy=y.destroy.bind(y),y.collections.get=function(S){var I;return y.collections.every((function(y){return!(I=y.get(S))})),I}},v.prototype.create=function(y){return this.createCollection(y)},v.prototype.createCollection=function(y){var S=this,I=new n(S,y);return S.bindCollection(I),S.collections.push(I),I},v.prototype.bindCollection=function(y){var S,I=this,V=function(y,V){S=y.type+" "+V.id+":"+y.type,I.trigger(S,V)};y.on("destroyed",I.onDestroyed.bind(I)),y.on("shown hidden rested dir plain",V),y.on("dir:up dir:right dir:down dir:left",V),y.on("plain:up plain:right plain:down plain:left",V)},v.prototype.bindDocument=function(){var y=this;y.binded||(y.bindEvt(document,"move").bindEvt(document,"end"),y.binded=!0)},v.prototype.unbindDocument=function(y){var S=this;Object.keys(S.ids).length&&!0!==y||(S.unbindEvt(document,"move").unbindEvt(document,"end"),S.binded=!1)},v.prototype.getIdentifier=function(y){var S;return y?void 0===(S=void 0===y.identifier?y.pointerId:y.identifier)&&(S=this.latest||0):S=this.index,void 0===this.ids[S]&&(this.ids[S]=this.index,this.index+=1),this.latest=S,this.ids[S]},v.prototype.removeIdentifier=function(y){var S={};for(var I in this.ids)if(this.ids[I]===y){S.id=I,S.identifier=this.ids[I],delete this.ids[I];break}return S},v.prototype.onmove=function(y){return this.onAny("move",y),!1},v.prototype.onend=function(y){return this.onAny("end",y),!1},v.prototype.oncancel=function(y){return this.onAny("end",y),!1},v.prototype.onAny=function(y,S){var I,V=this,i="processOn"+y.charAt(0).toUpperCase()+y.slice(1);S=J(S);var A=function(y,S,I){I.ids.indexOf(S)>=0&&(I[i](y),y._found_=!0)};return T(S,(function(y){I=V.getIdentifier(y),T(V.collections,A.bind(null,y,I)),y._found_||V.removeIdentifier(I)})),!1},v.prototype.destroy=function(){var y=this;y.unbindDocument(!0),y.ids={},y.index=0,y.collections.forEach((function(y){y.destroy()})),y.off()},v.prototype.onDestroyed=function(y,S){var I=this;if(I.collections.indexOf(S)<0)return!1;I.collections.splice(I.collections.indexOf(S),1)};var P=new v;const q={create:function(y){return P.create(y)},factory:P};return S.default})(),y.exports=S()},13424:(y,S,I)=>{"use strict";const{Deflate:V,deflate:i,deflateRaw:A,gzip:B}=I(13427),{Inflate:d,inflate:F,inflateRaw:J,ungzip:u}=I(13494),K=I(13465);y.exports.Deflate=V,y.exports.deflate=i,y.exports.deflateRaw=A,y.exports.gzip=B,y.exports.Inflate=d,y.exports.inflate=F,y.exports.inflateRaw=J,y.exports.ungzip=u,y.exports.constants=K},13427:(y,S,I)=>{"use strict";const V=I(13434),i=I(13470),A=I(13478),B=I(13461),d=I(13485),F=Object.prototype.toString,{Z_NO_FLUSH:J,Z_SYNC_FLUSH:u,Z_FULL_FLUSH:K,Z_FINISH:G,Z_OK:p,Z_STREAM_END:L,Z_DEFAULT_COMPRESSION:T,Z_DEFAULT_STRATEGY:l,Z_DEFLATED:j}=I(13465);function s(y){this.options=i.assign({level:T,method:j,xy:16384,windowBits:15,memLevel:8,strategy:l},y||{});let S=this.options;S.raw&&S.windowBits>0?S.windowBits=-S.windowBits:S.gzip&&S.windowBits>0&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.LS="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;let I=V.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(I!==p)throw new Error(B[I]);if(S.header&&V.deflateSetHeader(this.strm,S.header),S.dictionary){let y;if(y="string"===typeof S.dictionary?A.string2buf(S.dictionary):"[object ArrayBuffer]"===F.call(S.dictionary)?new Uint8Array(S.dictionary):S.dictionary,I=V.deflateSetDictionary(this.strm,y),I!==p)throw new Error(B[I]);this._dict_set=!0}}function O(y,S){const I=new s(S);if(I.push(y,!0),I.err)throw I.LS||B[I.err];return I.result}s.prototype.push=function(y,S){const I=this.strm,i=this.options.xy;let B,d;if(this.ended)return!1;for(d=S===~~S?S:!0===S?G:J,"string"===typeof y?I.input=A.string2buf(y):"[object ArrayBuffer]"===F.call(y)?I.input=new Uint8Array(y):I.input=y,I.next_in=0,I.avail_in=I.input.length;;)if(0===I.avail_out&&(I.output=new Uint8Array(i),I.next_out=0,I.avail_out=i),(d===u||d===K)&&I.avail_out<=6)this.onData(I.output.subarray(0,I.next_out)),I.avail_out=0;else{if(B=V.deflate(I,d),B===L)return I.next_out>0&&this.onData(I.output.subarray(0,I.next_out)),B=V.deflateEnd(this.strm),this.onEnd(B),this.ended=!0,B===p;if(0!==I.avail_out){if(d>0&&I.next_out>0)this.onData(I.output.subarray(0,I.next_out)),I.avail_out=0;else if(0===I.avail_in)break}else this.onData(I.output)}return!0},s.prototype.onData=function(y){this.chunks.push(y)},s.prototype.onEnd=function(y){y===p&&(this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.LS=this.strm.LS},y.exports.Deflate=s,y.exports.deflate=O,y.exports.deflateRaw=function(y,S){return(S=S||{}).raw=!0,O(y,S)},y.exports.gzip=function(y,S){return(S=S||{}).gzip=!0,O(y,S)},y.exports.constants=I(13465)},13494:(y,S,I)=>{"use strict";const V=I(13498),i=I(13470),A=I(13478),B=I(13461),d=I(13485),F=I(13515),J=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:K,Z_OK:G,Z_STREAM_END:p,Z_NEED_DICT:L,Z_STREAM_ERROR:T,Z_DATA_ERROR:l,Z_MEM_ERROR:j}=I(13465);function s(y){this.options=i.assign({xy:65536,windowBits:15,to:""},y||{});const S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,0===S.windowBits&&(S.windowBits=-15)),!(S.windowBits>=0&&S.windowBits<16)||y&&y.windowBits||(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&0===(15&S.windowBits)&&(S.windowBits|=15),this.err=0,this.LS="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;let I=V.inflateInit2(this.strm,S.windowBits);if(I!==G)throw new Error(B[I]);if(this.header=new F,V.inflateGetHeader(this.strm,this.header),S.dictionary&&("string"===typeof S.dictionary?S.dictionary=A.string2buf(S.dictionary):"[object ArrayBuffer]"===J.call(S.dictionary)&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(I=V.inflateSetDictionary(this.strm,S.dictionary),I!==G)))throw new Error(B[I])}function O(y,S){const I=new s(S);if(I.push(y),I.err)throw I.LS||B[I.err];return I.result}s.prototype.push=function(y,S){const I=this.strm,i=this.options.xy,B=this.options.dictionary;let d,F,s;if(this.ended)return!1;for(F=S===~~S?S:!0===S?K:u,"[object ArrayBuffer]"===J.call(y)?I.input=new Uint8Array(y):I.input=y,I.next_in=0,I.avail_in=I.input.length;;){for(0===I.avail_out&&(I.output=new Uint8Array(i),I.next_out=0,I.avail_out=i),d=V.inflate(I,F),d===L&&B&&(d=V.inflateSetDictionary(I,B),d===G?d=V.inflate(I,F):d===l&&(d=L));I.avail_in>0&&d===p&&I.state.wrap>0&&0!==y[I.next_in];)V.inflateReset(I),d=V.inflate(I,F);switch(d){case T:case l:case L:case j:return this.onEnd(d),this.ended=!0,!1}if(s=I.avail_out,I.next_out&&(0===I.avail_out||d===p))if("string"===this.options.to){let y=A.utf8border(I.output,I.next_out),S=I.next_out-y,V=A.buf2string(I.output,y);I.next_out=S,I.avail_out=i-S,S&&I.output.set(I.output.subarray(y,y+S),0),this.onData(V)}else this.onData(I.output.length===I.next_out?I.output:I.output.subarray(0,I.next_out));if(d!==G||0!==s){if(d===p)return d=V.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===I.avail_in)break}}return!0},s.prototype.onData=function(y){this.chunks.push(y)},s.prototype.onEnd=function(y){y===G&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.LS=this.strm.LS},y.exports.Inflate=s,y.exports.inflate=O,y.exports.inflateRaw=function(y,S){return(S=S||{}).raw=!0,O(y,S)},y.exports.ungzip=O,y.exports.constants=I(13465)},13470:y=>{"use strict";const S=(y,S)=>Object.prototype.hasOwnProperty.call(y,S);y.exports.assign=function(y){const I=Array.prototype.slice.call(arguments,1);for(;I.length;){const V=I.shift();if(V){if("object"!==typeof V)throw new TypeError(V+"must be non-object");for(const I in V)S(V,I)&&(y[I]=V[I])}}return y},y.exports.flattenChunks=y=>{let S=0;for(let V=0,i=y.length;V<i;V++)S+=y[V].length;const I=new Uint8Array(S);for(let V=0,i=0,A=y.length;V<A;V++){let S=y[V];I.set(S,i),i+=S.length}return I}},13478:y=>{"use strict";let S=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(V){S=!1}const I=new Uint8Array(256);for(let i=0;i<256;i++)I[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;I[254]=I[254]=1,y.exports.string2buf=y=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(y);let S,I,V,i,A,B=y.length,d=0;for(i=0;i<B;i++)I=y.charCodeAt(i),55296===(64512&I)&&i+1<B&&(V=y.charCodeAt(i+1),56320===(64512&V)&&(I=65536+(I-55296<<10)+(V-56320),i++)),d+=I<128?1:I<2048?2:I<65536?3:4;for(S=new Uint8Array(d),A=0,i=0;A<d;i++)I=y.charCodeAt(i),55296===(64512&I)&&i+1<B&&(V=y.charCodeAt(i+1),56320===(64512&V)&&(I=65536+(I-55296<<10)+(V-56320),i++)),I<128?S[A++]=I:I<2048?(S[A++]=192|I>>>6,S[A++]=128|63&I):I<65536?(S[A++]=224|I>>>12,S[A++]=128|I>>>6&63,S[A++]=128|63&I):(S[A++]=240|I>>>18,S[A++]=128|I>>>12&63,S[A++]=128|I>>>6&63,S[A++]=128|63&I);return S};y.exports.buf2string=(y,V)=>{const i=V||y.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(y.subarray(0,V));let A,B;const d=new Array(2*i);for(B=0,A=0;A<i;){let S=y[A++];if(S<128){d[B++]=S;continue}let V=I[S];if(V>4)d[B++]=65533,A+=V-1;else{for(S&=2===V?31:3===V?15:7;V>1&&A<i;)S=S<<6|63&y[A++],V--;V>1?d[B++]=65533:S<65536?d[B++]=S:(S-=65536,d[B++]=55296|S>>10&1023,d[B++]=56320|1023&S)}}return((y,I)=>{if(I<65534&&y.subarray&&S)return String.fromCharCode.apply(null,y.length===I?y:y.subarray(0,I));let V="";for(let S=0;S<I;S++)V+=String.fromCharCode(y[S]);return V})(d,B)},y.exports.utf8border=(y,S)=>{(S=S||y.length)>y.length&&(S=y.length);let V=S-1;for(;V>=0&&128===(192&y[V]);)V--;return V<0||0===V?S:V+I[y[V]]>S?V:S}},13445:y=>{"use strict";y.exports=(y,S,I,V)=>{let i=65535&y,A=y>>>16&65535,B=0;for(;0!==I;){B=I>2e3?2e3:I,I-=B;do{i=i+S[V++]|0,A=A+i|0}while(--B);i%=65521,A%=65521}return i|A<<16}},13465:y=>{"use strict";y.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13454:y=>{"use strict";const S=new Uint32Array((()=>{let y,S=[];for(var I=0;I<256;I++){y=I;for(var V=0;V<8;V++)y=1&y?3988292384^y>>>1:y>>>1;S[I]=y}return S})());y.exports=(y,I,V,i)=>{const A=S,B=i+V;y^=-1;for(let S=i;S<B;S++)y=y>>>8^A[255&(y^I[S])];return~y}},13434:(y,S,I)=>{"use strict";const{_tr_init:V,_tr_stored_block:i,_tr_flush_block:A,_tr_tally:B,_tr_align:d}=I(13441),F=I(13445),J=I(13454),u=I(13461),{Z_NO_FLUSH:K,Z_PARTIAL_FLUSH:G,Z_FULL_FLUSH:p,Z_FINISH:L,Z_BLOCK:T,Z_OK:l,Z_STREAM_END:j,Z_STREAM_ERROR:s,Z_DATA_ERROR:O,Z_BUF_ERROR:f,Z_DEFAULT_COMPRESSION:my,Z_FILTERED:C,Z_HUFFMAN_ONLY:D,Z_RLE:o,Z_FIXED:E,Z_DEFAULT_STRATEGY:z,Z_UNKNOWN:r,Z_DEFLATED:h}=I(13465),n=258,v=262,P=103,q=113,g=666,k=(y,S)=>(y.LS=u[S],S),R=y=>(y<<1)-(y>4?9:0),b=y=>{let S=y.length;for(;--S>=0;)y[S]=0};let U=(y,S,I)=>(S<<y.hash_shift^I)&y.hash_mask;const W=y=>{const S=y.state;let I=S.pending;I>y.avail_out&&(I=y.avail_out),0!==I&&(y.output.set(S.pending_buf.subarray(S.pending_out,S.pending_out+I),y.next_out),y.next_out+=I,S.pending_out+=I,y.total_out+=I,y.avail_out-=I,S.pending-=I,0===S.pending&&(S.pending_out=0))},a=(y,S)=>{A(y,y.block_start>=0?y.block_start:-1,y.strstart-y.block_start,S),y.block_start=y.strstart,W(y.strm)},e=(y,S)=>{y.pending_buf[y.pending++]=S},x=(y,S)=>{y.pending_buf[y.pending++]=S>>>8&255,y.pending_buf[y.pending++]=255&S},Q=(y,S,I,V)=>{let i=y.avail_in;return i>V&&(i=V),0===i?0:(y.avail_in-=i,S.set(y.input.subarray(y.next_in,y.next_in+i),I),1===y.state.wrap?y.adler=F(y.adler,S,i,I):2===y.state.wrap&&(y.adler=J(y.adler,S,i,I)),y.next_in+=i,y.total_in+=i,i)},c=(y,S)=>{let I,V,i=y.max_chain_length,A=y.strstart,B=y.prev_length,d=y.nice_match;const F=y.strstart>y.w_size-v?y.strstart-(y.w_size-v):0,J=y.window,u=y.w_mask,K=y.prev,G=y.strstart+n;let p=J[A+B-1],L=J[A+B];y.prev_length>=y.good_match&&(i>>=2),d>y.lookahead&&(d=y.lookahead);do{if(I=S,J[I+B]===L&&J[I+B-1]===p&&J[I]===J[A]&&J[++I]===J[A+1]){A+=2,I++;do{}while(J[++A]===J[++I]&&J[++A]===J[++I]&&J[++A]===J[++I]&&J[++A]===J[++I]&&J[++A]===J[++I]&&J[++A]===J[++I]&&J[++A]===J[++I]&&J[++A]===J[++I]&&A<G);if(V=n-(G-A),A=G-n,V>B){if(y.match_start=S,B=V,V>=d)break;p=J[A+B-1],L=J[A+B]}}}while((S=K[S&u])>F&&0!==--i);return B<=y.lookahead?B:y.lookahead},X=y=>{const S=y.w_size;let I,V,i,A,B;do{if(A=y.window_size-y.lookahead-y.strstart,y.strstart>=S+(S-v)){y.window.set(y.window.subarray(S,S+S),0),y.match_start-=S,y.strstart-=S,y.block_start-=S,V=y.hash_size,I=V;do{i=y.head[--I],y.head[I]=i>=S?i-S:0}while(--V);V=S,I=V;do{i=y.prev[--I],y.prev[I]=i>=S?i-S:0}while(--V);A+=S}if(0===y.strm.avail_in)break;if(V=Q(y.strm,y.window,y.strstart+y.lookahead,A),y.lookahead+=V,y.lookahead+y.insert>=3)for(B=y.strstart-y.insert,y.ins_h=y.window[B],y.ins_h=U(y,y.ins_h,y.window[B+1]);y.insert&&(y.ins_h=U(y,y.ins_h,y.window[B+3-1]),y.prev[B&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=B,B++,y.insert--,!(y.lookahead+y.insert<3)););}while(y.lookahead<v&&0!==y.strm.avail_in)},M=(y,S)=>{let I,V;for(;;){if(y.lookahead<v){if(X(y),y.lookahead<v&&S===K)return 1;if(0===y.lookahead)break}if(I=0,y.lookahead>=3&&(y.ins_h=U(y,y.ins_h,y.window[y.strstart+3-1]),I=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),0!==I&&y.strstart-I<=y.w_size-v&&(y.match_length=c(y,I)),y.match_length>=3)if(V=B(y,y.strstart-y.match_start,y.match_length-3),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=3){y.match_length--;do{y.strstart++,y.ins_h=U(y,y.ins_h,y.window[y.strstart+3-1]),I=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart}while(0!==--y.match_length);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=U(y,y.ins_h,y.window[y.strstart+1]);else V=B(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(V&&(a(y,!1),0===y.strm.avail_out))return 1}return y.insert=y.strstart<2?y.strstart:2,S===L?(a(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(a(y,!1),0===y.strm.avail_out)?1:2},t=(y,S)=>{let I,V,i;for(;;){if(y.lookahead<v){if(X(y),y.lookahead<v&&S===K)return 1;if(0===y.lookahead)break}if(I=0,y.lookahead>=3&&(y.ins_h=U(y,y.ins_h,y.window[y.strstart+3-1]),I=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=2,0!==I&&y.prev_length<y.max_lazy_match&&y.strstart-I<=y.w_size-v&&(y.match_length=c(y,I),y.match_length<=5&&(y.strategy===C||3===y.match_length&&y.strstart-y.match_start>4096)&&(y.match_length=2)),y.prev_length>=3&&y.match_length<=y.prev_length){i=y.strstart+y.lookahead-3,V=B(y,y.strstart-1-y.prev_match,y.prev_length-3),y.lookahead-=y.prev_length-1,y.prev_length-=2;do{++y.strstart<=i&&(y.ins_h=U(y,y.ins_h,y.window[y.strstart+3-1]),I=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart)}while(0!==--y.prev_length);if(y.match_available=0,y.match_length=2,y.strstart++,V&&(a(y,!1),0===y.strm.avail_out))return 1}else if(y.match_available){if(V=B(y,0,y.window[y.strstart-1]),V&&a(y,!1),y.strstart++,y.lookahead--,0===y.strm.avail_out)return 1}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(V=B(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<2?y.strstart:2,S===L?(a(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(a(y,!1),0===y.strm.avail_out)?1:2};function N(y,S,I,V,i){this.good_length=y,this.max_lazy=S,this.nice_length=I,this.max_chain=V,this.func=i}const Y=[new N(0,0,0,0,((y,S)=>{let I=65535;for(I>y.pending_buf_size-5&&(I=y.pending_buf_size-5);;){if(y.lookahead<=1){if(X(y),0===y.lookahead&&S===K)return 1;if(0===y.lookahead)break}y.strstart+=y.lookahead,y.lookahead=0;const V=y.block_start+I;if((0===y.strstart||y.strstart>=V)&&(y.lookahead=y.strstart-V,y.strstart=V,a(y,!1),0===y.strm.avail_out))return 1;if(y.strstart-y.block_start>=y.w_size-v&&(a(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,S===L?(a(y,!0),0===y.strm.avail_out?3:4):(y.strstart>y.block_start&&(a(y,!1),y.strm.avail_out),1)})),new N(4,4,8,4,M),new N(4,5,16,8,M),new N(4,6,32,32,M),new N(4,4,16,16,t),new N(8,16,32,32,t),new N(8,16,128,128,t),new N(8,32,128,256,t),new N(32,128,258,1024,t),new N(32,258,258,4096,t)];function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=h,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),b(this.dyn_ltree),b(this.dyn_dtree),b(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),b(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),b(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Z=y=>{if(!y||!y.state)return k(y,s);y.total_in=y.total_out=0,y.data_type=r;const S=y.state;return S.pending=0,S.pending_out=0,S.wrap<0&&(S.wrap=-S.wrap),S.status=S.wrap?42:q,y.adler=2===S.wrap?0:1,S.last_flush=K,V(S),l},w=y=>{const S=Z(y);var I;return S===l&&((I=y.state).window_size=2*I.w_size,b(I.head),I.max_lazy_match=Y[I.level].max_lazy,I.good_match=Y[I.level].good_length,I.nice_match=Y[I.level].nice_length,I.max_chain_length=Y[I.level].max_chain,I.strstart=0,I.block_start=0,I.lookahead=0,I.insert=0,I.match_length=I.prev_length=2,I.match_available=0,I.ins_h=0),S},yy=(y,S,I,V,i,A)=>{if(!y)return s;let B=1;if(S===my&&(S=6),V<0?(B=0,V=-V):V>15&&(B=2,V-=16),i<1||i>9||I!==h||V<8||V>15||S<0||S>9||A<0||A>E)return k(y,s);8===V&&(V=9);const d=new H;return y.state=d,d.strm=y,d.wrap=B,d.gzhead=null,d.w_bits=V,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=i+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+3-1)/3),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<i+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.d_buf=1*d.lit_bufsize,d.l_buf=3*d.lit_bufsize,d.level=S,d.strategy=A,d.method=I,w(y)};y.exports.deflateInit=(y,S)=>yy(y,S,h,15,8,z),y.exports.deflateInit2=yy,y.exports.deflateReset=w,y.exports.deflateResetKeep=Z,y.exports.deflateSetHeader=(y,S)=>y&&y.state?2!==y.state.wrap?s:(y.state.gzhead=S,l):s,y.exports.deflate=(y,S)=>{let I,V;if(!y||!y.state||S>T||S<0)return y?k(y,s):s;const A=y.state;if(!y.output||!y.input&&0!==y.avail_in||A.status===g&&S!==L)return k(y,0===y.avail_out?f:s);A.strm=y;const F=A.last_flush;if(A.last_flush=S,42===A.status)if(2===A.wrap)y.adler=0,e(A,31),e(A,139),e(A,8),A.gzhead?(e(A,(A.gzhead.text?1:0)+(A.gzhead.hcrc?2:0)+(A.gzhead.extra?4:0)+(A.gzhead.name?8:0)+(A.gzhead.comment?16:0)),e(A,255&A.gzhead.time),e(A,A.gzhead.time>>8&255),e(A,A.gzhead.time>>16&255),e(A,A.gzhead.time>>24&255),e(A,9===A.level?2:A.strategy>=D||A.level<2?4:0),e(A,255&A.gzhead.os),A.gzhead.extra&&A.gzhead.extra.length&&(e(A,255&A.gzhead.extra.length),e(A,A.gzhead.extra.length>>8&255)),A.gzhead.hcrc&&(y.adler=J(y.adler,A.pending_buf,A.pending,0)),A.gzindex=0,A.status=69):(e(A,0),e(A,0),e(A,0),e(A,0),e(A,0),e(A,9===A.level?2:A.strategy>=D||A.level<2?4:0),e(A,3),A.status=q);else{let S=h+(A.w_bits-8<<4)<<8,I=-1;I=A.strategy>=D||A.level<2?0:A.level<6?1:6===A.level?2:3,S|=I<<6,0!==A.strstart&&(S|=32),S+=31-S%31,A.status=q,x(A,S),0!==A.strstart&&(x(A,y.adler>>>16),x(A,65535&y.adler)),y.adler=1}if(69===A.status)if(A.gzhead.extra){for(I=A.pending;A.gzindex<(65535&A.gzhead.extra.length)&&(A.pending!==A.pending_buf_size||(A.gzhead.hcrc&&A.pending>I&&(y.adler=J(y.adler,A.pending_buf,A.pending-I,I)),W(y),I=A.pending,A.pending!==A.pending_buf_size));)e(A,255&A.gzhead.extra[A.gzindex]),A.gzindex++;A.gzhead.hcrc&&A.pending>I&&(y.adler=J(y.adler,A.pending_buf,A.pending-I,I)),A.gzindex===A.gzhead.extra.length&&(A.gzindex=0,A.status=73)}else A.status=73;if(73===A.status)if(A.gzhead.name){I=A.pending;do{if(A.pending===A.pending_buf_size&&(A.gzhead.hcrc&&A.pending>I&&(y.adler=J(y.adler,A.pending_buf,A.pending-I,I)),W(y),I=A.pending,A.pending===A.pending_buf_size)){V=1;break}V=A.gzindex<A.gzhead.name.length?255&A.gzhead.name.charCodeAt(A.gzindex++):0,e(A,V)}while(0!==V);A.gzhead.hcrc&&A.pending>I&&(y.adler=J(y.adler,A.pending_buf,A.pending-I,I)),0===V&&(A.gzindex=0,A.status=91)}else A.status=91;if(91===A.status)if(A.gzhead.comment){I=A.pending;do{if(A.pending===A.pending_buf_size&&(A.gzhead.hcrc&&A.pending>I&&(y.adler=J(y.adler,A.pending_buf,A.pending-I,I)),W(y),I=A.pending,A.pending===A.pending_buf_size)){V=1;break}V=A.gzindex<A.gzhead.comment.length?255&A.gzhead.comment.charCodeAt(A.gzindex++):0,e(A,V)}while(0!==V);A.gzhead.hcrc&&A.pending>I&&(y.adler=J(y.adler,A.pending_buf,A.pending-I,I)),0===V&&(A.status=P)}else A.status=P;if(A.status===P&&(A.gzhead.hcrc?(A.pending+2>A.pending_buf_size&&W(y),A.pending+2<=A.pending_buf_size&&(e(A,255&y.adler),e(A,y.adler>>8&255),y.adler=0,A.status=q)):A.status=q),0!==A.pending){if(W(y),0===y.avail_out)return A.last_flush=-1,l}else if(0===y.avail_in&&R(S)<=R(F)&&S!==L)return k(y,f);if(A.status===g&&0!==y.avail_in)return k(y,f);if(0!==y.avail_in||0!==A.lookahead||S!==K&&A.status!==g){let I=A.strategy===D?((y,S)=>{let I;for(;;){if(0===y.lookahead&&(X(y),0===y.lookahead)){if(S===K)return 1;break}if(y.match_length=0,I=B(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++,I&&(a(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,S===L?(a(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(a(y,!1),0===y.strm.avail_out)?1:2})(A,S):A.strategy===o?((y,S)=>{let I,V,i,A;const d=y.window;for(;;){if(y.lookahead<=n){if(X(y),y.lookahead<=n&&S===K)return 1;if(0===y.lookahead)break}if(y.match_length=0,y.lookahead>=3&&y.strstart>0&&(i=y.strstart-1,V=d[i],V===d[++i]&&V===d[++i]&&V===d[++i])){A=y.strstart+n;do{}while(V===d[++i]&&V===d[++i]&&V===d[++i]&&V===d[++i]&&V===d[++i]&&V===d[++i]&&V===d[++i]&&V===d[++i]&&i<A);y.match_length=n-(A-i),y.match_length>y.lookahead&&(y.match_length=y.lookahead)}if(y.match_length>=3?(I=B(y,1,y.match_length-3),y.lookahead-=y.match_length,y.strstart+=y.match_length,y.match_length=0):(I=B(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++),I&&(a(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,S===L?(a(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(a(y,!1),0===y.strm.avail_out)?1:2})(A,S):Y[A.level].func(A,S);if(3!==I&&4!==I||(A.status=g),1===I||3===I)return 0===y.avail_out&&(A.last_flush=-1),l;if(2===I&&(S===G?d(A):S!==T&&(i(A,0,0,!1),S===p&&(b(A.head),0===A.lookahead&&(A.strstart=0,A.block_start=0,A.insert=0))),W(y),0===y.avail_out))return A.last_flush=-1,l}return S!==L?l:A.wrap<=0?j:(2===A.wrap?(e(A,255&y.adler),e(A,y.adler>>8&255),e(A,y.adler>>16&255),e(A,y.adler>>24&255),e(A,255&y.total_in),e(A,y.total_in>>8&255),e(A,y.total_in>>16&255),e(A,y.total_in>>24&255)):(x(A,y.adler>>>16),x(A,65535&y.adler)),W(y),A.wrap>0&&(A.wrap=-A.wrap),0!==A.pending?l:j)},y.exports.deflateEnd=y=>{if(!y||!y.state)return s;const S=y.state.status;return 42!==S&&69!==S&&73!==S&&91!==S&&S!==P&&S!==q&&S!==g?k(y,s):(y.state=null,S===q?k(y,O):l)},y.exports.deflateSetDictionary=(y,S)=>{let I=S.length;if(!y||!y.state)return s;const V=y.state,i=V.wrap;if(2===i||1===i&&42!==V.status||V.lookahead)return s;if(1===i&&(y.adler=F(y.adler,S,I,0)),V.wrap=0,I>=V.w_size){0===i&&(b(V.head),V.strstart=0,V.block_start=0,V.insert=0);let y=new Uint8Array(V.w_size);y.set(S.subarray(I-V.w_size,I),0),S=y,I=V.w_size}const A=y.avail_in,B=y.next_in,d=y.input;for(y.avail_in=I,y.next_in=0,y.input=S,X(V);V.lookahead>=3;){let y=V.strstart,S=V.lookahead-2;do{V.ins_h=U(V,V.ins_h,V.window[y+3-1]),V.prev[y&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=y,y++}while(--S);V.strstart=y,V.lookahead=2,X(V)}return V.strstart+=V.lookahead,V.block_start=V.strstart,V.insert=V.lookahead,V.lookahead=0,V.match_length=V.prev_length=2,V.match_available=0,y.next_in=B,y.input=d,y.avail_in=A,V.wrap=i,l},y.exports.deflateInfo="pako deflate (from Nodeca project)"},13515:y=>{"use strict";y.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13505:y=>{"use strict";y.exports=function(y,S){let I,V,i,A,B,d,F,J,u,K,G,p,L,T,l,j,s,O,f,my,C,D,o,E;const z=y.state;I=y.next_in,o=y.input,V=I+(y.avail_in-5),i=y.next_out,E=y.output,A=i-(S-y.avail_out),B=i+(y.avail_out-257),d=z.dmax,F=z.wsize,J=z.whave,u=z.wnext,K=z.window,G=z.hold,p=z.bits,L=z.lencode,T=z.distcode,l=(1<<z.lenbits)-1,j=(1<<z.distbits)-1;y:do{p<15&&(G+=o[I++]<<p,p+=8,G+=o[I++]<<p,p+=8),s=L[G&l];S:for(;;){if(O=s>>>24,G>>>=O,p-=O,O=s>>>16&255,0===O)E[i++]=65535&s;else{if(!(16&O)){if(0===(64&O)){s=L[(65535&s)+(G&(1<<O)-1)];continue S}if(32&O){z.mode=12;break y}y.LS="invalid literal/length code",z.mode=30;break y}f=65535&s,O&=15,O&&(p<O&&(G+=o[I++]<<p,p+=8),f+=G&(1<<O)-1,G>>>=O,p-=O),p<15&&(G+=o[I++]<<p,p+=8,G+=o[I++]<<p,p+=8),s=T[G&j];I:for(;;){if(O=s>>>24,G>>>=O,p-=O,O=s>>>16&255,!(16&O)){if(0===(64&O)){s=T[(65535&s)+(G&(1<<O)-1)];continue I}y.LS="invalid distance code",z.mode=30;break y}if(my=65535&s,O&=15,p<O&&(G+=o[I++]<<p,p+=8,p<O&&(G+=o[I++]<<p,p+=8)),my+=G&(1<<O)-1,my>d){y.LS="invalid distance too far back",z.mode=30;break y}if(G>>>=O,p-=O,O=i-A,my>O){if(O=my-O,O>J&&z.sane){y.LS="invalid distance too far back",z.mode=30;break y}if(C=0,D=K,0===u){if(C+=F-O,O<f){f-=O;do{E[i++]=K[C++]}while(--O);C=i-my,D=E}}else if(u<O){if(C+=F+u-O,O-=u,O<f){f-=O;do{E[i++]=K[C++]}while(--O);if(C=0,u<f){O=u,f-=O;do{E[i++]=K[C++]}while(--O);C=i-my,D=E}}}else if(C+=u-O,O<f){f-=O;do{E[i++]=K[C++]}while(--O);C=i-my,D=E}for(;f>2;)E[i++]=D[C++],E[i++]=D[C++],E[i++]=D[C++],f-=3;f&&(E[i++]=D[C++],f>1&&(E[i++]=D[C++]))}else{C=i-my;do{E[i++]=E[C++],E[i++]=E[C++],E[i++]=E[C++],f-=3}while(f>2);f&&(E[i++]=E[C++],f>1&&(E[i++]=E[C++]))}break}}break}}while(I<V&&i<B);f=p>>3,I-=f,p-=f<<3,G&=(1<<p)-1,y.next_in=I,y.next_out=i,y.avail_in=I<V?V-I+5:5-(I-V),y.avail_out=i<B?B-i+257:257-(i-B),z.hold=G,z.bits=p}},13498:(y,S,I)=>{"use strict";const V=I(13445),i=I(13454),A=I(13505),B=I(13508),{Z_FINISH:d,Z_BLOCK:F,Z_TREES:J,Z_OK:u,Z_STREAM_END:K,Z_NEED_DICT:G,Z_STREAM_ERROR:p,Z_DATA_ERROR:L,Z_MEM_ERROR:T,Z_BUF_ERROR:l,Z_DEFLATED:j}=I(13465),s=12,O=30,f=y=>(y>>>24&255)+(y>>>8&65280)+((65280&y)<<8)+((255&y)<<24);function my(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const C=y=>{if(!y||!y.state)return p;const S=y.state;return y.total_in=y.total_out=S.total=0,y.LS="",S.wrap&&(y.adler=1&S.wrap),S.mode=1,S.last=0,S.havedict=0,S.dmax=32768,S.head=null,S.hold=0,S.bits=0,S.lencode=S.lendyn=new Int32Array(852),S.distcode=S.distdyn=new Int32Array(592),S.sane=1,S.back=-1,u},D=y=>{if(!y||!y.state)return p;const S=y.state;return S.wsize=0,S.whave=0,S.wnext=0,C(y)},o=(y,S)=>{let I;if(!y||!y.state)return p;const V=y.state;return S<0?(I=0,S=-S):(I=1+(S>>4),S<48&&(S&=15)),S&&(S<8||S>15)?p:(null!==V.window&&V.wbits!==S&&(V.window=null),V.wrap=I,V.wbits=S,D(y))},E=(y,S)=>{if(!y)return p;const I=new my;y.state=I,I.window=null;const V=o(y,S);return V!==u&&(y.state=null),V};let z,r,h=!0;const n=y=>{if(h){z=new Int32Array(512),r=new Int32Array(32);let S=0;for(;S<144;)y.lens[S++]=8;for(;S<256;)y.lens[S++]=9;for(;S<280;)y.lens[S++]=7;for(;S<288;)y.lens[S++]=8;for(B(1,y.lens,0,288,z,0,y.work,{bits:9}),S=0;S<32;)y.lens[S++]=5;B(2,y.lens,0,32,r,0,y.work,{bits:5}),h=!1}y.lencode=z,y.lenbits=9,y.distcode=r,y.distbits=5},v=(y,S,I,V)=>{let i;const A=y.state;return null===A.window&&(A.wsize=1<<A.wbits,A.wnext=0,A.whave=0,A.window=new Uint8Array(A.wsize)),V>=A.wsize?(A.window.set(S.subarray(I-A.wsize,I),0),A.wnext=0,A.whave=A.wsize):(i=A.wsize-A.wnext,i>V&&(i=V),A.window.set(S.subarray(I-V,I-V+i),A.wnext),(V-=i)?(A.window.set(S.subarray(I-V,I),0),A.wnext=V,A.whave=A.wsize):(A.wnext+=i,A.wnext===A.wsize&&(A.wnext=0),A.whave<A.wsize&&(A.whave+=i))),0};y.exports.inflateReset=D,y.exports.inflateReset2=o,y.exports.inflateResetKeep=C,y.exports.inflateInit=y=>E(y,15),y.exports.inflateInit2=E,y.exports.inflate=(y,S)=>{let I,my,C,D,o,E,z,r,h,P,q,g,k,R,b,U,W,a,e,x,Q,c,X=0;const M=new Uint8Array(4);let t,N;const Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!y||!y.state||!y.output||!y.input&&0!==y.avail_in)return p;I=y.state,I.mode===s&&(I.mode=13),o=y.next_out,C=y.output,z=y.avail_out,D=y.next_in,my=y.input,E=y.avail_in,r=I.hold,h=I.bits,P=E,q=z,c=u;y:for(;;)switch(I.mode){case 1:if(0===I.wrap){I.mode=13;break}for(;h<16;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(2&I.wrap&&35615===r){I.check=0,M[0]=255&r,M[1]=r>>>8&255,I.check=i(I.check,M,2,0),r=0,h=0,I.mode=2;break}if(I.flags=0,I.head&&(I.head.done=!1),!(1&I.wrap)||(((255&r)<<8)+(r>>8))%31){y.LS="incorrect header check",I.mode=O;break}if((15&r)!==j){y.LS="unknown compression method",I.mode=O;break}if(r>>>=4,h-=4,Q=8+(15&r),0===I.wbits)I.wbits=Q;else if(Q>I.wbits){y.LS="invalid window size",I.mode=O;break}I.dmax=1<<I.wbits,y.adler=I.check=1,I.mode=512&r?10:s,r=0,h=0;break;case 2:for(;h<16;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(I.flags=r,(255&I.flags)!==j){y.LS="unknown compression method",I.mode=O;break}if(57344&I.flags){y.LS="unknown header flags set",I.mode=O;break}I.head&&(I.head.text=r>>8&1),512&I.flags&&(M[0]=255&r,M[1]=r>>>8&255,I.check=i(I.check,M,2,0)),r=0,h=0,I.mode=3;case 3:for(;h<32;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}I.head&&(I.head.time=r),512&I.flags&&(M[0]=255&r,M[1]=r>>>8&255,M[2]=r>>>16&255,M[3]=r>>>24&255,I.check=i(I.check,M,4,0)),r=0,h=0,I.mode=4;case 4:for(;h<16;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}I.head&&(I.head.xflags=255&r,I.head.os=r>>8),512&I.flags&&(M[0]=255&r,M[1]=r>>>8&255,I.check=i(I.check,M,2,0)),r=0,h=0,I.mode=5;case 5:if(1024&I.flags){for(;h<16;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}I.length=r,I.head&&(I.head.extra_len=r),512&I.flags&&(M[0]=255&r,M[1]=r>>>8&255,I.check=i(I.check,M,2,0)),r=0,h=0}else I.head&&(I.head.extra=null);I.mode=6;case 6:if(1024&I.flags&&(g=I.length,g>E&&(g=E),g&&(I.head&&(Q=I.head.extra_len-I.length,I.head.extra||(I.head.extra=new Uint8Array(I.head.extra_len)),I.head.extra.set(my.subarray(D,D+g),Q)),512&I.flags&&(I.check=i(I.check,my,g,D)),E-=g,D+=g,I.length-=g),I.length))break y;I.length=0,I.mode=7;case 7:if(2048&I.flags){if(0===E)break y;g=0;do{Q=my[D+g++],I.head&&Q&&I.length<65536&&(I.head.name+=String.fromCharCode(Q))}while(Q&&g<E);if(512&I.flags&&(I.check=i(I.check,my,g,D)),E-=g,D+=g,Q)break y}else I.head&&(I.head.name=null);I.length=0,I.mode=8;case 8:if(4096&I.flags){if(0===E)break y;g=0;do{Q=my[D+g++],I.head&&Q&&I.length<65536&&(I.head.comment+=String.fromCharCode(Q))}while(Q&&g<E);if(512&I.flags&&(I.check=i(I.check,my,g,D)),E-=g,D+=g,Q)break y}else I.head&&(I.head.comment=null);I.mode=9;case 9:if(512&I.flags){for(;h<16;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(r!==(65535&I.check)){y.LS="header crc mismatch",I.mode=O;break}r=0,h=0}I.head&&(I.head.hcrc=I.flags>>9&1,I.head.done=!0),y.adler=I.check=0,I.mode=s;break;case 10:for(;h<32;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}y.adler=I.check=f(r),r=0,h=0,I.mode=11;case 11:if(0===I.havedict)return y.next_out=o,y.avail_out=z,y.next_in=D,y.avail_in=E,I.hold=r,I.bits=h,G;y.adler=I.check=1,I.mode=s;case s:if(S===F||S===J)break y;case 13:if(I.last){r>>>=7&h,h-=7&h,I.mode=27;break}for(;h<3;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}switch(I.last=1&r,r>>>=1,h-=1,3&r){case 0:I.mode=14;break;case 1:if(n(I),I.mode=20,S===J){r>>>=2,h-=2;break y}break;case 2:I.mode=17;break;case 3:y.LS="invalid block type",I.mode=O}r>>>=2,h-=2;break;case 14:for(r>>>=7&h,h-=7&h;h<32;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if((65535&r)!==(r>>>16^65535)){y.LS="invalid stored block lengths",I.mode=O;break}if(I.length=65535&r,r=0,h=0,I.mode=15,S===J)break y;case 15:I.mode=16;case 16:if(g=I.length,g){if(g>E&&(g=E),g>z&&(g=z),0===g)break y;C.set(my.subarray(D,D+g),o),E-=g,D+=g,z-=g,o+=g,I.length-=g;break}I.mode=s;break;case 17:for(;h<14;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(I.nlen=257+(31&r),r>>>=5,h-=5,I.ndist=1+(31&r),r>>>=5,h-=5,I.ncode=4+(15&r),r>>>=4,h-=4,I.nlen>286||I.ndist>30){y.LS="too many length or distance symbols",I.mode=O;break}I.have=0,I.mode=18;case 18:for(;I.have<I.ncode;){for(;h<3;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}I.lens[Y[I.have++]]=7&r,r>>>=3,h-=3}for(;I.have<19;)I.lens[Y[I.have++]]=0;if(I.lencode=I.lendyn,I.lenbits=7,t={bits:I.lenbits},c=B(0,I.lens,0,19,I.lencode,0,I.work,t),I.lenbits=t.bits,c){y.LS="invalid code lengths set",I.mode=O;break}I.have=0,I.mode=19;case 19:for(;I.have<I.nlen+I.ndist;){for(;X=I.lencode[r&(1<<I.lenbits)-1],b=X>>>24,U=X>>>16&255,W=65535&X,!(b<=h);){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(W<16)r>>>=b,h-=b,I.lens[I.have++]=W;else{if(16===W){for(N=b+2;h<N;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(r>>>=b,h-=b,0===I.have){y.LS="invalid bit length repeat",I.mode=O;break}Q=I.lens[I.have-1],g=3+(3&r),r>>>=2,h-=2}else if(17===W){for(N=b+3;h<N;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}r>>>=b,h-=b,Q=0,g=3+(7&r),r>>>=3,h-=3}else{for(N=b+7;h<N;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}r>>>=b,h-=b,Q=0,g=11+(127&r),r>>>=7,h-=7}if(I.have+g>I.nlen+I.ndist){y.LS="invalid bit length repeat",I.mode=O;break}for(;g--;)I.lens[I.have++]=Q}}if(I.mode===O)break;if(0===I.lens[256]){y.LS="invalid code -- missing end-of-block",I.mode=O;break}if(I.lenbits=9,t={bits:I.lenbits},c=B(1,I.lens,0,I.nlen,I.lencode,0,I.work,t),I.lenbits=t.bits,c){y.LS="invalid literal/lengths set",I.mode=O;break}if(I.distbits=6,I.distcode=I.distdyn,t={bits:I.distbits},c=B(2,I.lens,I.nlen,I.ndist,I.distcode,0,I.work,t),I.distbits=t.bits,c){y.LS="invalid distances set",I.mode=O;break}if(I.mode=20,S===J)break y;case 20:I.mode=21;case 21:if(E>=6&&z>=258){y.next_out=o,y.avail_out=z,y.next_in=D,y.avail_in=E,I.hold=r,I.bits=h,A(y,q),o=y.next_out,C=y.output,z=y.avail_out,D=y.next_in,my=y.input,E=y.avail_in,r=I.hold,h=I.bits,I.mode===s&&(I.back=-1);break}for(I.back=0;X=I.lencode[r&(1<<I.lenbits)-1],b=X>>>24,U=X>>>16&255,W=65535&X,!(b<=h);){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(U&&0===(240&U)){for(a=b,e=U,x=W;X=I.lencode[x+((r&(1<<a+e)-1)>>a)],b=X>>>24,U=X>>>16&255,W=65535&X,!(a+b<=h);){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}r>>>=a,h-=a,I.back+=a}if(r>>>=b,h-=b,I.back+=b,I.length=W,0===U){I.mode=26;break}if(32&U){I.back=-1,I.mode=s;break}if(64&U){y.LS="invalid literal/length code",I.mode=O;break}I.extra=15&U,I.mode=22;case 22:if(I.extra){for(N=I.extra;h<N;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}I.length+=r&(1<<I.extra)-1,r>>>=I.extra,h-=I.extra,I.back+=I.extra}I.was=I.length,I.mode=23;case 23:for(;X=I.distcode[r&(1<<I.distbits)-1],b=X>>>24,U=X>>>16&255,W=65535&X,!(b<=h);){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(0===(240&U)){for(a=b,e=U,x=W;X=I.distcode[x+((r&(1<<a+e)-1)>>a)],b=X>>>24,U=X>>>16&255,W=65535&X,!(a+b<=h);){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}r>>>=a,h-=a,I.back+=a}if(r>>>=b,h-=b,I.back+=b,64&U){y.LS="invalid distance code",I.mode=O;break}I.offset=W,I.extra=15&U,I.mode=24;case 24:if(I.extra){for(N=I.extra;h<N;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}I.offset+=r&(1<<I.extra)-1,r>>>=I.extra,h-=I.extra,I.back+=I.extra}if(I.offset>I.dmax){y.LS="invalid distance too far back",I.mode=O;break}I.mode=25;case 25:if(0===z)break y;if(g=q-z,I.offset>g){if(g=I.offset-g,g>I.whave&&I.sane){y.LS="invalid distance too far back",I.mode=O;break}g>I.wnext?(g-=I.wnext,k=I.wsize-g):k=I.wnext-g,g>I.length&&(g=I.length),R=I.window}else R=C,k=o-I.offset,g=I.length;g>z&&(g=z),z-=g,I.length-=g;do{C[o++]=R[k++]}while(--g);0===I.length&&(I.mode=21);break;case 26:if(0===z)break y;C[o++]=I.length,z--,I.mode=21;break;case 27:if(I.wrap){for(;h<32;){if(0===E)break y;E--,r|=my[D++]<<h,h+=8}if(q-=z,y.total_out+=q,I.total+=q,q&&(y.adler=I.check=I.flags?i(I.check,C,q,o-q):V(I.check,C,q,o-q)),q=z,(I.flags?r:f(r))!==I.check){y.LS="incorrect data check",I.mode=O;break}r=0,h=0}I.mode=28;case 28:if(I.wrap&&I.flags){for(;h<32;){if(0===E)break y;E--,r+=my[D++]<<h,h+=8}if(r!==(4294967295&I.total)){y.LS="incorrect length check",I.mode=O;break}r=0,h=0}I.mode=29;case 29:c=K;break y;case O:c=L;break y;case 31:return T;default:return p}return y.next_out=o,y.avail_out=z,y.next_in=D,y.avail_in=E,I.hold=r,I.bits=h,(I.wsize||q!==y.avail_out&&I.mode<O&&(I.mode<27||S!==d))&&v(y,y.output,y.next_out,q-y.avail_out)?(I.mode=31,T):(P-=y.avail_in,q-=y.avail_out,y.total_in+=P,y.total_out+=q,I.total+=q,I.wrap&&q&&(y.adler=I.check=I.flags?i(I.check,C,q,y.next_out-q):V(I.check,C,q,y.next_out-q)),y.data_type=I.bits+(I.last?64:0)+(I.mode===s?128:0)+(20===I.mode||15===I.mode?256:0),(0===P&&0===q||S===d)&&c===u&&(c=l),c)},y.exports.inflateEnd=y=>{if(!y||!y.state)return p;let S=y.state;return S.window&&(S.window=null),y.state=null,u},y.exports.inflateGetHeader=(y,S)=>{if(!y||!y.state)return p;const I=y.state;return 0===(2&I.wrap)?p:(I.head=S,S.done=!1,u)},y.exports.inflateSetDictionary=(y,S)=>{const I=S.length;let i,A,B;return y&&y.state?(i=y.state,0!==i.wrap&&11!==i.mode?p:11===i.mode&&(A=1,A=V(A,S,I,0),A!==i.check)?L:(B=v(y,S,I,I),B?(i.mode=31,T):(i.havedict=1,u))):p},y.exports.inflateInfo="pako inflate (from Nodeca project)"},13508:y=>{"use strict";const S=15,I=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),V=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),i=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),A=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);y.exports=(y,B,d,F,J,u,K,G)=>{const p=G.bits;let L,T,l,j,s,O,f=0,my=0,C=0,D=0,o=0,E=0,z=0,r=0,h=0,n=0,v=null,P=0;const q=new Uint16Array(16),g=new Uint16Array(16);let k,R,b,U=null,W=0;for(f=0;f<=S;f++)q[f]=0;for(my=0;my<F;my++)q[B[d+my]]++;for(o=p,D=S;D>=1&&0===q[D];D--);if(o>D&&(o=D),0===D)return J[u++]=20971520,J[u++]=20971520,G.bits=1,0;for(C=1;C<D&&0===q[C];C++);for(o<C&&(o=C),r=1,f=1;f<=S;f++)if(r<<=1,r-=q[f],r<0)return-1;if(r>0&&(0===y||1!==D))return-1;for(g[1]=0,f=1;f<S;f++)g[f+1]=g[f]+q[f];for(my=0;my<F;my++)0!==B[d+my]&&(K[g[B[d+my]]++]=my);if(0===y?(v=U=K,O=19):1===y?(v=I,P-=257,U=V,W-=257,O=256):(v=i,U=A,O=-1),n=0,my=0,f=C,s=u,E=o,z=0,l=-1,h=1<<o,j=h-1,1===y&&h>852||2===y&&h>592)return 1;for(;;){k=f-z,K[my]<O?(R=0,b=K[my]):K[my]>O?(R=U[W+K[my]],b=v[P+K[my]]):(R=96,b=0),L=1<<f-z,T=1<<E,C=T;do{T-=L,J[s+(n>>z)+T]=k<<24|R<<16|b}while(0!==T);for(L=1<<f-1;n&L;)L>>=1;if(0!==L?(n&=L-1,n+=L):n=0,my++,0===--q[f]){if(f===D)break;f=B[d+K[my]]}if(f>o&&(n&j)!==l){for(0===z&&(z=o),s+=C,E=f-z,r=1<<E;E+z<D&&(r-=q[E+z],!(r<=0));)E++,r<<=1;if(h+=1<<E,1===y&&h>852||2===y&&h>592)return 1;l=n&j,J[l]=o<<24|E<<16|s-u}}return 0!==n&&(J[s+n]=f-z<<24|64<<16),G.bits=o,0}},13461:y=>{"use strict";y.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13441:y=>{"use strict";function S(y){let S=y.length;for(;--S>=0;)y[S]=0}const I=256,V=286,i=30,A=15,B=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),d=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),F=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),J=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new Array(576);S(u);const K=new Array(60);S(K);const G=new Array(512);S(G);const p=new Array(256);S(p);const L=new Array(29);S(L);const T=new Array(i);function l(y,S,I,V,i){this.static_tree=y,this.extra_bits=S,this.extra_base=I,this.elems=V,this.max_length=i,this.has_stree=y&&y.length}let j,s,O;function f(y,S){this.dyn_tree=y,this.max_code=0,this.stat_desc=S}S(T);const my=y=>y<256?G[y]:G[256+(y>>>7)],C=(y,S)=>{y.pending_buf[y.pending++]=255&S,y.pending_buf[y.pending++]=S>>>8&255},D=(y,S,I)=>{y.bi_valid>16-I?(y.bi_buf|=S<<y.bi_valid&65535,C(y,y.bi_buf),y.bi_buf=S>>16-y.bi_valid,y.bi_valid+=I-16):(y.bi_buf|=S<<y.bi_valid&65535,y.bi_valid+=I)},o=(y,S,I)=>{D(y,I[2*S],I[2*S+1])},E=(y,S)=>{let I=0;do{I|=1&y,y>>>=1,I<<=1}while(--S>0);return I>>>1},z=(y,S,I)=>{const V=new Array(16);let i,B,d=0;for(i=1;i<=A;i++)V[i]=d=d+I[i-1]<<1;for(B=0;B<=S;B++){let S=y[2*B+1];0!==S&&(y[2*B]=E(V[S]++,S))}},r=y=>{let S;for(S=0;S<V;S++)y.dyn_ltree[2*S]=0;for(S=0;S<i;S++)y.dyn_dtree[2*S]=0;for(S=0;S<19;S++)y.bl_tree[2*S]=0;y.dyn_ltree[512]=1,y.opt_len=y.static_len=0,y.last_lit=y.matches=0},h=y=>{y.bi_valid>8?C(y,y.bi_buf):y.bi_valid>0&&(y.pending_buf[y.pending++]=y.bi_buf),y.bi_buf=0,y.bi_valid=0},n=(y,S,I,V)=>{const i=2*S,A=2*I;return y[i]<y[A]||y[i]===y[A]&&V[S]<=V[I]},v=(y,S,I)=>{const V=y.heap[I];let i=I<<1;for(;i<=y.heap_len&&(i<y.heap_len&&n(S,y.heap[i+1],y.heap[i],y.depth)&&i++,!n(S,V,y.heap[i],y.depth));)y.heap[I]=y.heap[i],I=i,i<<=1;y.heap[I]=V},P=(y,S,V)=>{let i,A,F,J,u=0;if(0!==y.last_lit)do{i=y.pending_buf[y.d_buf+2*u]<<8|y.pending_buf[y.d_buf+2*u+1],A=y.pending_buf[y.l_buf+u],u++,0===i?o(y,A,S):(F=p[A],o(y,F+I+1,S),J=B[F],0!==J&&(A-=L[F],D(y,A,J)),i--,F=my(i),o(y,F,V),J=d[F],0!==J&&(i-=T[F],D(y,i,J)))}while(u<y.last_lit);o(y,256,S)},q=(y,S)=>{const I=S.dyn_tree,V=S.stat_desc.static_tree,i=S.stat_desc.has_stree,B=S.stat_desc.elems;let d,F,J,u=-1;for(y.heap_len=0,y.heap_max=573,d=0;d<B;d++)0!==I[2*d]?(y.heap[++y.heap_len]=u=d,y.depth[d]=0):I[2*d+1]=0;for(;y.heap_len<2;)J=y.heap[++y.heap_len]=u<2?++u:0,I[2*J]=1,y.depth[J]=0,y.opt_len--,i&&(y.static_len-=V[2*J+1]);for(S.max_code=u,d=y.heap_len>>1;d>=1;d--)v(y,I,d);J=B;do{d=y.heap[1],y.heap[1]=y.heap[y.heap_len--],v(y,I,1),F=y.heap[1],y.heap[--y.heap_max]=d,y.heap[--y.heap_max]=F,I[2*J]=I[2*d]+I[2*F],y.depth[J]=(y.depth[d]>=y.depth[F]?y.depth[d]:y.depth[F])+1,I[2*d+1]=I[2*F+1]=J,y.heap[1]=J++,v(y,I,1)}while(y.heap_len>=2);y.heap[--y.heap_max]=y.heap[1],((y,S)=>{const I=S.dyn_tree,V=S.max_code,i=S.stat_desc.static_tree,B=S.stat_desc.has_stree,d=S.stat_desc.extra_bits,F=S.stat_desc.extra_base,J=S.stat_desc.max_length;let u,K,G,p,L,T,l=0;for(p=0;p<=A;p++)y.bl_count[p]=0;for(I[2*y.heap[y.heap_max]+1]=0,u=y.heap_max+1;u<573;u++)K=y.heap[u],p=I[2*I[2*K+1]+1]+1,p>J&&(p=J,l++),I[2*K+1]=p,K>V||(y.bl_count[p]++,L=0,K>=F&&(L=d[K-F]),T=I[2*K],y.opt_len+=T*(p+L),B&&(y.static_len+=T*(i[2*K+1]+L)));if(0!==l){do{for(p=J-1;0===y.bl_count[p];)p--;y.bl_count[p]--,y.bl_count[p+1]+=2,y.bl_count[J]--,l-=2}while(l>0);for(p=J;0!==p;p--)for(K=y.bl_count[p];0!==K;)G=y.heap[--u],G>V||(I[2*G+1]!==p&&(y.opt_len+=(p-I[2*G+1])*I[2*G],I[2*G+1]=p),K--)}})(y,S),z(I,u,y.bl_count)},g=(y,S,I)=>{let V,i,A=-1,B=S[1],d=0,F=7,J=4;for(0===B&&(F=138,J=3),S[2*(I+1)+1]=65535,V=0;V<=I;V++)i=B,B=S[2*(V+1)+1],++d<F&&i===B||(d<J?y.bl_tree[2*i]+=d:0!==i?(i!==A&&y.bl_tree[2*i]++,y.bl_tree[32]++):d<=10?y.bl_tree[34]++:y.bl_tree[36]++,d=0,A=i,0===B?(F=138,J=3):i===B?(F=6,J=3):(F=7,J=4))},k=(y,S,I)=>{let V,i,A=-1,B=S[1],d=0,F=7,J=4;for(0===B&&(F=138,J=3),V=0;V<=I;V++)if(i=B,B=S[2*(V+1)+1],!(++d<F&&i===B)){if(d<J)do{o(y,i,y.bl_tree)}while(0!==--d);else 0!==i?(i!==A&&(o(y,i,y.bl_tree),d--),o(y,16,y.bl_tree),D(y,d-3,2)):d<=10?(o(y,17,y.bl_tree),D(y,d-3,3)):(o(y,18,y.bl_tree),D(y,d-11,7));d=0,A=i,0===B?(F=138,J=3):i===B?(F=6,J=3):(F=7,J=4)}};let R=!1;const b=(y,S,I,V)=>{D(y,0+(V?1:0),3),((y,S,I,V)=>{h(y),V&&(C(y,I),C(y,~I)),y.pending_buf.set(y.window.subarray(S,S+I),y.pending),y.pending+=I})(y,S,I,!0)};y.exports._tr_init=y=>{R||((()=>{let y,S,I,J,f;const my=new Array(16);for(I=0,J=0;J<28;J++)for(L[J]=I,y=0;y<1<<B[J];y++)p[I++]=J;for(p[I-1]=J,f=0,J=0;J<16;J++)for(T[J]=f,y=0;y<1<<d[J];y++)G[f++]=J;for(f>>=7;J<i;J++)for(T[J]=f<<7,y=0;y<1<<d[J]-7;y++)G[256+f++]=J;for(S=0;S<=A;S++)my[S]=0;for(y=0;y<=143;)u[2*y+1]=8,y++,my[8]++;for(;y<=255;)u[2*y+1]=9,y++,my[9]++;for(;y<=279;)u[2*y+1]=7,y++,my[7]++;for(;y<=287;)u[2*y+1]=8,y++,my[8]++;for(z(u,287,my),y=0;y<i;y++)K[2*y+1]=5,K[2*y]=E(y,5);j=new l(u,B,257,V,A),s=new l(K,d,0,i,A),O=new l(new Array(0),F,0,19,7)})(),R=!0),y.l_desc=new f(y.dyn_ltree,j),y.d_desc=new f(y.dyn_dtree,s),y.bl_desc=new f(y.bl_tree,O),y.bi_buf=0,y.bi_valid=0,r(y)},y.exports._tr_stored_block=b,y.exports._tr_flush_block=(y,S,V,i)=>{let A,B,d=0;y.level>0?(2===y.strm.data_type&&(y.strm.data_type=(y=>{let S,V=4093624447;for(S=0;S<=31;S++,V>>>=1)if(1&V&&0!==y.dyn_ltree[2*S])return 0;if(0!==y.dyn_ltree[18]||0!==y.dyn_ltree[20]||0!==y.dyn_ltree[26])return 1;for(S=32;S<I;S++)if(0!==y.dyn_ltree[2*S])return 1;return 0})(y)),q(y,y.l_desc),q(y,y.d_desc),d=(y=>{let S;for(g(y,y.dyn_ltree,y.l_desc.max_code),g(y,y.dyn_dtree,y.d_desc.max_code),q(y,y.bl_desc),S=18;S>=3&&0===y.bl_tree[2*J[S]+1];S--);return y.opt_len+=3*(S+1)+5+5+4,S})(y),A=y.opt_len+3+7>>>3,B=y.static_len+3+7>>>3,B<=A&&(A=B)):A=B=V+5,V+4<=A&&-1!==S?b(y,S,V,i):4===y.strategy||B===A?(D(y,2+(i?1:0),3),P(y,u,K)):(D(y,4+(i?1:0),3),((y,S,I,V)=>{let i;for(D(y,S-257,5),D(y,I-1,5),D(y,V-4,4),i=0;i<V;i++)D(y,y.bl_tree[2*J[i]+1],3);k(y,y.dyn_ltree,S-1),k(y,y.dyn_dtree,I-1)})(y,y.l_desc.max_code+1,y.d_desc.max_code+1,d+1),P(y,y.dyn_ltree,y.dyn_dtree)),r(y),i&&h(y)},y.exports._tr_tally=(y,S,V)=>(y.pending_buf[y.d_buf+2*y.last_lit]=S>>>8&255,y.pending_buf[y.d_buf+2*y.last_lit+1]=255&S,y.pending_buf[y.l_buf+y.last_lit]=255&V,y.last_lit++,0===S?y.dyn_ltree[2*V]++:(y.matches++,S--,y.dyn_ltree[2*(p[V]+I+1)]++,y.dyn_dtree[2*my(S)]++),y.last_lit===y.lit_bufsize-1),y.exports._tr_align=y=>{D(y,2,3),o(y,256,u),(y=>{16===y.bi_valid?(C(y,y.bi_buf),y.bi_buf=0,y.bi_valid=0):y.bi_valid>=8&&(y.pending_buf[y.pending++]=255&y.bi_buf,y.bi_buf>>=8,y.bi_valid-=8)})(y)}},13485:y=>{"use strict";y.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.LS="",this.state=null,this.data_type=2,this.adler=0}},13112:y=>{function S(y,S,I){for(var V=y.length,i=-1/0,A=1/0,B=0;B<V;B++){var d=(I[0][B]-y[B])/S[B],F=(I[1][B]-y[B])/S[B];if(d>F){var J=d;d=F,F=J}if(F<i||d>A)return 1/0;d>i&&(i=d),F<A&&(A=F)}return i>A?1/0:i}y.exports=function(y,I,V,i){var A=S(I,V,i);if(A===1/0)y=null;else{y=y||[];for(var B=0;B<I.length;B++)y[B]=I[B]+V[B]*A}return y},y.exports.distance=S},14512:(y,S,I)=>{"use strict";I.d(S,{e:()=>B});var V=I(28);const i=V.useLayoutEffect;const A=function(y){var S=(0,V.useRef)(y);return i((function(){S.current=y})),S};var B=function(y){var S=A(y);(0,V.KS)((function(){var y=function(y){var I;if(null!=S.current&&(I=S.current(y)),y.defaultPrevented&&(y.returnValue=""),"string"===typeof I)return y.returnValue=I,I};return window.addEventListener("beforeunload",y),function(){window.removeEventListener("beforeunload",y)}}),[])}},14453:(y,S,I)=>{"use strict";var V=I(14460),i=Array.prototype.concat,A=Array.prototype.slice,B=y.exports=function(y){for(var S=[],I=0,B=y.length;I<B;I++){var d=y[I];V(d)?S=i.call(S,A.call(d)):S.push(d)}return S};B.wrap=function(y){return function(){return y(B(arguments))}}},14460:y=>{y.exports=function(y){return!(!y||"string"===typeof y)&&(y instanceof Array||Array.isArray(y)||y.length>=0&&(y.splice instanceof Function||Object.getOwnPropertyDescriptor(y,y.length-1)&&"String"!==y.constructor.name))}},13380:(y,S,I)=>{var V=I(13383);function i(y){for(var S,I,i=0,A=y.length,B=0;B<y.length;){for(S=y[B],I=0;B<A&&y[B]===S;)++B,++I;i+=V.log2(I)/7|0,i+=V.log2(S>>>0)/7|0,i+=2}return i}S.size=i,S.encode=function(y,S){S||(S=new Uint8Array(i(y)));for(var I,V,A=0,B=S.length,d=0;d<y.length;){for(I=y[d],V=0;d<y.length&&y[d]===I;)++d,++V;for(;A<B&&V>=128;)S[A++]=128+(127&V),V>>>=7;if(A>=B)throw new Error("RLE buffer overflow");for(S[A++]=V,I>>>=0;A<B&&I>=128;)S[A++]=128+(127&I),I>>>=7;if(A>=B)throw new Error("RLE buffer overflow");S[A++]=I}return S},S.decode=function(y,S){for(var I,V,i,A,B=S.length,d=y.length,F=0,J=0;J<d;){for(I=0,V=0;J<d&&y[J]>=128;)I+=(127&y[J++])<<V,V+=7;if(I+=y[J++]<<V,J>=d)throw new Error("RLE buffer underrun");if(F+I>B)throw new Error("Chunk buffer overflow");for(i=0,V=0;J<d&&y[J]>=128;)i+=(127&y[J++])<<V,V+=7;if(J>=d)throw new Error("RLE buffer underrun");for(i+=y[J++]<<V,A=0;A<I;++A)S[F++]=i}return S}},13383:(y,S)=>{"use strict";function I(y){var S=32;return(y&=-y)&&S--,65535&y&&(S-=16),16711935&y&&(S-=8),252645135&y&&(S-=4),858993459&y&&(S-=2),1431655765&y&&(S-=1),S}S.INT_BITS=32,S.INT_MAX=2147483647,S.INT_MIN=-1<<31,S.sign=function(y){return(y>0)-(y<0)},S.abs=function(y){var S=y>>31;return(y^S)-S},S.min=function(y,S){return S^(y^S)&-(y<S)},S.max=function(y,S){return y^(y^S)&-(y<S)},S.isPow2=function(y){return!(y&y-1)&&!!y},S.log2=function(y){var S,I;return S=(y>65535)<<4,S|=I=((y>>>=S)>255)<<3,S|=I=((y>>>=I)>15)<<2,(S|=I=((y>>>=I)>3)<<1)|(y>>>=I)>>1},S.log10=function(y){return y>=1e9?9:y>=1e8?8:y>=1e7?7:y>=1e6?6:y>=1e5?5:y>=1e4?4:y>=1e3?3:y>=100?2:y>=10?1:0},S.popCount=function(y){return 16843009*((y=(858993459&(y-=y>>>1&1431655765))+(y>>>2&858993459))+(y>>>4)&252645135)>>>24},S.countTrailingZeros=I,S.nextPow2=function(y){return y+=0===y,--y,y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)+1},S.prevPow2=function(y){return y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)-(y>>>1)},S.parity=function(y){return y^=y>>>16,y^=y>>>8,y^=y>>>4,27030>>>(y&=15)&1};var V=new Array(256);!function(y){for(var S=0;S<256;++S){var I=S,V=S,i=7;for(I>>>=1;I;I>>>=1)V<<=1,V|=1&I,--i;y[S]=V<<i&255}}(V),S.reverse=function(y){return V[255&y]<<24|V[y>>>8&255]<<16|V[y>>>16&255]<<8|V[y>>>24&255]},S.interleave2=function(y,S){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))|(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S&=65535)|S<<8))|S<<4))|S<<2))|S<<1))<<1},S.deinterleave2=function(y,S){return(y=65535&((y=16711935&((y=252645135&((y=858993459&((y=y>>>S&1431655765)|y>>>1))|y>>>2))|y>>>4))|y>>>16))<<16>>16},S.interleave3=function(y,S,I){return y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2),(y|=(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<1)|(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<2},S.deinterleave3=function(y,S){return(y=1023&((y=4278190335&((y=251719695&((y=3272356035&((y=y>>>S&1227133513)|y>>>2))|y>>>4))|y>>>8))|y>>>16))<<22>>22},S.nextCombination=function(y){var S=y|y-1;return S+1|(~S&-~S)-1>>>I(y)+1}},13417:y=>{"use strict";y.exports=function(y,S,I,V){var i=self||window;try{try{var A;try{A=new i.Blob([y])}catch(J){(A=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(y),A=A.getBlob()}var B=i.URL||i.webkitURL,d=B.createObjectURL(A),F=new i[S](d,I);return B.revokeObjectURL(d),F}catch(J){return new i[S]("data:application/javascript,".concat(encodeURIComponent(y)),I)}}catch(J){if(!V)throw Error("Inline worker is not supported");return new i[S](V,I)}}},13091:(y,S,I)=>{"use strict";function V(y,S,I,V,i){var A={};return Object.keys(V).forEach((function(y){A[y]=V[y]})),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=I.slice().reverse().reduce((function(I,V){return V(y,S,I)||I}),A),i&&void 0!==A.initializer&&(A.value=A.initializer?A.initializer.call(i):void 0,A.initializer=void 0),void 0===A.initializer&&(Object.defineProperty(y,S,A),A=null),A}I.d(S,{d:()=>V})},13084:(y,S,I)=>{"use strict";function V(y,S,I,V){I&&Object.defineProperty(y,S,{enumerable:I.enumerable,configurable:I.configurable,writable:I.writable,value:I.initializer?I.initializer.call(V):void 0})}I.d(S,{c:()=>V})},14501:(y,S,I)=>{"use strict";I.d(S,{b:()=>B,d:()=>K,g:()=>d,k:()=>A,n:()=>F,o:()=>i,q:()=>J,s:()=>u});var V=I(12535);class i{constructor(){this._easingMode=i.EASINGMODE_EASEIN}setEasingMode(y){const S=Math.min(Math.max(y,0),2);this._easingMode=S}getEasingMode(){return this._easingMode}easeInCore(y){throw new Error("You must implement this method")}ease(y){switch(this._easingMode){case i.EASINGMODE_EASEIN:return this.easeInCore(y);case i.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-y)}return y>=.5?.5*(1-this.easeInCore(2*(1-y)))+.5:.5*this.easeInCore(2*y)}}i.EASINGMODE_EASEIN=0,i.EASINGMODE_EASEOUT=1,i.EASINGMODE_EASEINOUT=2;class A extends i{easeInCore(y){return y=Math.max(0,Math.min(1,y)),1-Math.sqrt(1-y*y)}}class B extends i{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=y}easeInCore(y){const S=Math.max(0,this.amplitude);return Math.pow(y,3)-y*S*Math.sin(3.141592653589793*y)}}class d extends i{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=y,this.bounciness=S}easeInCore(y){const S=Math.max(0,this.bounces);let I=this.bounciness;I<=1&&(I=1.001);const V=Math.pow(I,S),i=1-I,A=(1-V)/i+.5*V,B=y*A,d=Math.log(-B*(1-I)+1)/Math.log(I),F=Math.floor(d),J=F+1,u=(1-Math.pow(I,F))/(i*A),K=.5*(u+(1-Math.pow(I,J))/(i*A)),G=y-K,p=K-u;return-Math.pow(1/I,S-F)/(p*p)*(G-p)*(G+p)}}class F extends i{easeInCore(y){return y*y*y}}class J extends i{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=y,this.springiness=S}easeInCore(y){let S;const I=Math.max(0,this.oscillations),V=Math.max(0,this.springiness);return S=0==V?y:(Math.exp(V*y)-1)/(Math.exp(V)-1),S*Math.sin((6.283185307179586*I+1.5707963267948966)*y)}}class u extends i{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=y}easeInCore(y){return this.exponent<=0?y:(Math.exp(this.exponent*y)-1)/(Math.exp(this.exponent)-1)}}class K extends i{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=y,this.y1=S,this.x2=I,this.y2=V}easeInCore(y){return V.d.Interpolate(y,this.x1,this.y1,this.x2,this.y2)}}},13967:(y,S,I)=>{"use strict";I.d(S,{c:()=>B});var V=I(12321),i=I(12331),A=I(12725);class B extends A.b{get _matrix(){return this._compose(),this.nG}set _matrix(y){(y.updateFlag!==this.nG.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.nG.A(y),this._markAsDirtyAndDecompose())}constructor(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(y,S.Ey(),!1),this.name=y,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=S,this.nG=(null===i||void 0===i?void 0:i.clone())??V.Matrix.Identity(),this._restMatrix=A??this.nG.clone(),this._bindMatrix=B??this.nG.clone(),this._index=d,this._absoluteMatrix=new V.Matrix,this._absoluteBindMatrix=new V.Matrix,this._absoluteInverseBindMatrix=new V.Matrix,this._finalMatrix=new V.Matrix,S.bones.push(this),this.setParent(I,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(y){this.setParent(y)}setParent(y){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==y){if(this.parent){const y=this.parent.children.indexOf(this);-1!==y&&this.parent.children.splice(y,1)}this._parentNode=y,this.parent&&this.parent.children.push(this),S&&this._updateAbsoluteBindMatrices(),this.Su()}}getLocalMatrix(){return this._compose(),this.nG}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(y){this._restMatrix.A(y)}setRestPose(y){this.setRestMatrix(y)}getBindPose(){return this.getBindMatrix()}setBindMatrix(y){this.jd(y)}setBindPose(y){this.setBindMatrix(y)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const y=V.TmpVectors.OS[0],S=V.TmpVectors.Quaternion[0],I=V.TmpVectors.OS[1];this.getRestMatrix().decompose(y,S,I),this._linkedTransformNode.position.A(I),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??V.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.A(S),this._linkedTransformNode.zd.A(y)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(y){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=y,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.AF}set position(y){this._decompose(),this.AF.A(y),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(y){this.setRotation(y)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(y){this.setRotationQuaternion(y)}get zd(){return this.getScale()}set zd(y){this.setScale(y)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=V.OS.Zero(),this._localRotation=V.Quaternion.Zero(),this.AF=V.OS.Zero()),this.nG.decompose(this._localScaling,this._localRotation,this.AF))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,V.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.AF,this.nG)):this._needToCompose=!1)}jd(y){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.A(y),S&&this._updateAbsoluteBindMatrices(),I?this._matrix=y:this.Su()}_updateAbsoluteBindMatrices(y){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(y||(y=this._bindMatrix),this.parent?y.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.A(y),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),S)for(let I=0;I<this.children.length;I++)this.children[I]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Su(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Su(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Su(),this._needToDecompose=!0}_updatePosition(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=this.getLocalMatrix();if(0==S)i?(A.addAtIndex(12,y.x),A.addAtIndex(13,y.y),A.addAtIndex(14,y.z)):A.setTranslationFromFloats(y.x,y.y,y.z);else{let S=null;I&&(S=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=B._TmpMats[0],F=B._TmpVecs[0];this.parent?I&&S?(d.A(this.parent.getAbsoluteMatrix()),d.multiplyToRef(S,d)):d.A(this.parent.getAbsoluteMatrix()):V.Matrix.IdentityToRef(d),i&&d.setTranslationFromFloats(0,0,0),d.invert(),V.OS.TransformCoordinatesToRef(y,d,F),i?(A.addAtIndex(12,F.x),A.addAtIndex(13,F.y),A.addAtIndex(14,F.z)):A.setTranslationFromFloats(F.x,F.y,F.z)}this._markAsDirtyAndDecompose()}translate(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;this._updatePosition(y,S,I,!0)}setPosition(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;this._updatePosition(y,S,I,!1)}setAbsolutePosition(y,S){this.setPosition(y,1,S)}scale(y,S,I){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.getLocalMatrix(),d=B._TmpMats[0];V.Matrix.ScalingToRef(y,S,I,d),d.multiplyToRef(A,A),d.invert();for(const V of this.children){const i=V.getLocalMatrix();i.multiplyToRef(d,i),i.multiplyAtIndex(12,y),i.multiplyAtIndex(13,S),i.multiplyAtIndex(14,I),V._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),i)for(const V of this.children)V.scale(y,S,I,i)}setScale(y){this._decompose(),this._localScaling.A(y),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(y){this._decompose(),y.A(this._localScaling)}setYawPitchRoll(y,S,I){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4?arguments[4]:void 0;if(0===i){const d=B._TmpQuat;return V.Quaternion.RotationYawPitchRollToRef(y,S,I,d),void this.setRotationQuaternion(d,i,A)}const d=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,A))return;const F=B._TmpMats[1];V.Matrix.RotationYawPitchRollToRef(y,S,I,F),d.multiplyToRef(F,F),this._rotateWithMatrix(F,i,A)}rotate(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const A=B._TmpMats[0];A.setTranslationFromFloats(0,0,0),V.Matrix.RotationAxisToRef(y,S,A),this._rotateWithMatrix(A,I,i)}setAxisAngle(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;if(0===I){const A=B._TmpQuat;return V.Quaternion.RotationAxisToRef(y,S,A),void this.setRotationQuaternion(A,I,i)}const A=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,i))return;const d=B._TmpMats[1];V.Matrix.RotationAxisToRef(y,S,d),A.multiplyToRef(d,d),this._rotateWithMatrix(d,I,i)}setRotation(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(y.y,y.x,y.z,S,I)}setRotationQuaternion(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;if(0===S)return this._decompose(),this._localRotation.A(y),void this._markAsDirtyAndCompose();const i=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,I))return;const A=B._TmpMats[1];V.Matrix.FromQuaternionToRef(y,A),i.multiplyToRef(A,A),this._rotateWithMatrix(A,S,I)}setRotationMatrix(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;if(0===S){const i=B._TmpQuat;return V.Quaternion.FromRotationMatrixToRef(y,i),void this.setRotationQuaternion(i,S,I)}const i=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,I))return;const A=B._TmpMats[1];A.A(y),i.multiplyToRef(y,A),this._rotateWithMatrix(A,S,I)}_rotateWithMatrix(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;const V=this.getLocalMatrix(),i=V.m[12],A=V.m[13],d=V.m[14],F=this.getParent(),J=B._TmpMats[3],u=B._TmpMats[4];F&&1==S?(I?(J.A(I.getWorldMatrix()),F.getAbsoluteMatrix().multiplyToRef(J,J)):J.A(F.getAbsoluteMatrix()),u.A(J),u.invert(),V.multiplyToRef(J,V),V.multiplyToRef(y,V),V.multiplyToRef(u,V)):1==S&&I?(J.A(I.getWorldMatrix()),u.A(J),u.invert(),V.multiplyToRef(J,V),V.multiplyToRef(y,V),V.multiplyToRef(u,V)):V.multiplyToRef(y,V),V.setTranslationFromFloats(i,A,d),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(y,S){const I=B._TmpMats[2];return y.A(this.getAbsoluteMatrix()),S?(y.multiplyToRef(S.getWorldMatrix(),y),V.Matrix.ScalingToRef(S.zd.x,S.zd.y,S.zd.z,I)):V.Matrix.IdentityToRef(I),y.invert(),!isNaN(y.m[0])&&(I.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyToRef(I,y),!0)}Ji(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=V.OS.Zero();return this.getPositionToRef(y,S,I),I}getPositionToRef(){let y=arguments.length>1?arguments[1]:void 0,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const y=this.getLocalMatrix();S.x=y.m[12],S.y=y.m[13],S.z=y.m[14]}else{let I=null;y&&(I=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let V=B._TmpMats[0];y&&I?(V.A(this.getAbsoluteMatrix()),V.multiplyToRef(I,V)):V=this.getAbsoluteMatrix(),S.x=V.m[12],S.y=V.m[13],S.z=V.m[14]}}getAbsolutePosition(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const S=V.OS.Zero();return this.getPositionToRef(1,y,S),S}getAbsolutePositionToRef(y,S){this.getPositionToRef(1,y,S)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.nG.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.A(this.nG);const y=this._skeleton.getPoseMatrix();y&&this._absoluteMatrix.multiplyToRef(y,this._absoluteMatrix)}const y=this.children,S=y.length;for(let I=0;I<S;I++)y[I].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}qF(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=V.OS.Zero();return this.getDirectionToRef(y,S,I),I}getDirectionToRef(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0,i=null;S&&(i=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=B._TmpMats[0];A.A(this.getAbsoluteMatrix()),S&&i&&A.multiplyToRef(i,A),V.OS.TransformNormalToRef(y,A,I),I.normalize()}getRotation(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=V.OS.Zero();return this.getRotationToRef(y,S,I),I}getRotationToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;const V=B._TmpQuat;this.getRotationQuaternionToRef(y,S,V),V.toEulerAnglesToRef(I)}getRotationQuaternion(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=V.Quaternion.Identity();return this.getRotationQuaternionToRef(y,S,I),I}getRotationQuaternionToRef(){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),S.A(this._localRotation);else{const I=B._TmpMats[0],V=this.getAbsoluteMatrix();y?V.multiplyToRef(y.getWorldMatrix(),I):I.A(V),I.multiplyAtIndex(0,this._scalingDeterminant),I.multiplyAtIndex(1,this._scalingDeterminant),I.multiplyAtIndex(2,this._scalingDeterminant),I.decompose(void 0,S,void 0)}}getRotationMatrix(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1?arguments[1]:void 0;const I=V.Matrix.Identity();return this.getRotationMatrixToRef(y,S,I),I}getRotationMatrixToRef(){let y=arguments.length>1?arguments[1]:void 0,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(S);else{const I=B._TmpMats[0],V=this.getAbsoluteMatrix();y?V.multiplyToRef(y.getWorldMatrix(),I):I.A(V),I.multiplyAtIndex(0,this._scalingDeterminant),I.multiplyAtIndex(1,this._scalingDeterminant),I.multiplyAtIndex(2,this._scalingDeterminant),I.getRotationMatrixToRef(S)}}getAbsolutePositionFromLocal(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=V.OS.Zero();return this.getAbsolutePositionFromLocalToRef(y,S,I),I}getAbsolutePositionFromLocalToRef(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0,i=null;S&&(i=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=B._TmpMats[0];A.A(this.getAbsoluteMatrix()),S&&i&&A.multiplyToRef(i,A),V.OS.TransformCoordinatesToRef(y,A,I)}getLocalPositionFromAbsolute(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=V.OS.Zero();return this.getLocalPositionFromAbsoluteToRef(y,S,I),I}getLocalPositionFromAbsoluteToRef(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0,i=null;S&&(i=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=B._TmpMats[0];A.A(this.getAbsoluteMatrix()),S&&i&&A.multiplyToRef(i,A),A.invert(),V.OS.TransformCoordinatesToRef(y,A,I)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const y=this._skeleton.bones.indexOf(this);if(-1!==y&&this._skeleton.bones.splice(y,1),this._parentNode&&this._parentNode.children){const y=this._parentNode.children,S=y.indexOf(this);-1!==S&&y.splice(S,1)}super.dispose()}}B._TmpVecs=(0,i.e)(2,V.OS.Zero),B._TmpQuat=V.Quaternion.Identity(),B._TmpMats=(0,i.e)(5,V.Matrix.Identity)},14493:(y,S,I)=>{"use strict";I.d(S,{c:()=>q});var V=I(12306),i=I(12309),A=I(12133),B=I(12321),d=I(12338),F=I(12725),J=I(12753),u=I(12587),K=I(12167),G=I(12325);class p{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(y){this._zoomStopsAnimation=y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(y){this._idleRotationSpeed=y}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(y){this._idleRotationWaitTime=y}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(y){this._idleRotationSpinupTime=y}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(y){this._attachedCamera=y;const S=this._attachedCamera.Ey();this._onPrePointerObservableObserver=S.onPrePointerObservable.add((y=>{y.type!==u.d.POINTERDOWN?y.type===u.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const y=K.b.Now;let S=0;null!=this._lastFrameTime&&(S=y-this._lastFrameTime),this._lastFrameTime=y,this._applyUserInteraction();const I=y-this._lastInteractionTime-this._idleRotationWaitTime,V=Math.max(Math.min(I/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*V,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(S/1e3))}))}detach(){if(!this._attachedCamera)return;const y=this._attachedCamera.Ey();this._onPrePointerObservableObserver&&y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(y){this._lastInteractionTime=y??K.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<G.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let y=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(y=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?y:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=K.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var L=I(14501),T=I(12838);class l{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(y){if(this._autoTransitionRange===y)return;this._autoTransitionRange=y;const S=this._attachedCamera;S&&(y?this._onMeshTargetChangedObserver=S.onMeshTargetChangedObservable.add((y=>{if(y&&(y.sd(!0),y.getBoundingInfo)){const S=y.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*S,this.upperRadiusTransitionRange=.05*S}})):this._onMeshTargetChangedObserver&&S.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(y){this._attachedCamera=y,this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(y){return!!this._attachedCamera&&(this._attachedCamera.radius===y&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(y){if(!this._attachedCamera)return;this._radiusBounceTransition||(l.EasingFunction.setEasingMode(l.EasingMode),this._radiusBounceTransition=T.b.CreateAnimation("radius",T.b.ANIMATIONTYPE_FLOAT,60,l.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const S=T.b.TransitionTo("radius",this._attachedCamera.radius+y,this._attachedCamera,this._attachedCamera.Ey(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));S&&this._animatables.push(S)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}l.EasingFunction=new L.b(.3),l.EasingMode=L.o.EASINGMODE_EASEOUT;class j{constructor(){this.onTargetFramingAnimationEndObservable=new A.b,this._mode=j.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(y){this._mode=y}get mode(){return this._mode}set radiusScale(y){this._radiusScale=y}get radiusScale(){return this._radiusScale}set positionScale(y){this._positionScale=y}get positionScale(){return this._positionScale}set defaultElevation(y){this._defaultElevation=y}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(y){this._elevationReturnTime=y}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(y){this._elevationReturnWaitTime=y}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(y){this._zoomStopsAnimation=y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(y){this._framingTime=y}get framingTime(){return this._framingTime}init(){}attach(y){this._attachedCamera=y;const S=this._attachedCamera.Ey();j.EasingFunction.setEasingMode(j.EasingMode),this._onPrePointerObservableObserver=S.onPrePointerObservable.add((y=>{y.type!==u.d.POINTERDOWN?y.type===u.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=y.onMeshTargetChangedObservable.add((y=>{y&&y.getBoundingInfo&&this.zoomOnMesh(y,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const y=this._attachedCamera.Ey();this._onPrePointerObservableObserver&&y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.sd(!0);const V=y.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(V.minimumWorld,V.maximumWorld,S,I)}zoomOnMeshHierarchy(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.sd(!0);const V=y.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(V.min,V.max,S,I)}zoomOnMeshesHierarchy(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new B.OS(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new B.OS(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let A=0;A<y.length;A++){const S=y[A].getHierarchyBoundingVectors(!0);B.OS.CheckExtends(S.min,V,i),B.OS.CheckExtends(S.max,V,i)}this.zoomOnBoundingInfo(V,i,S,I)}zoomOnBoundingInfo(y,S){let I,V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const A=y.y,d=A+(S.y-A)*this._positionScale,F=S.fS(y).scale(.5);if(!isFinite(d))return!1;if(V)I=new B.OS(0,d,0);else{const S=y.add(F);I=new B.OS(S.x,d,S.z)}this._vectorTransition||(this._vectorTransition=T.b.CreateAnimation("target",T.b.ANIMATIONTYPE_VECTOR3,60,j.EasingFunction)),this._betaIsAnimating=!0;let J=T.b.TransitionTo("target",I,this._attachedCamera,this._attachedCamera.Ey(),60,this._vectorTransition,this._framingTime);J&&this._animatables.push(J);let u=0;if(this._mode===j.FitFrustumSidesMode){const I=this._calculateLowerRadiusFromModelBoundingSphere(y,S);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=F.length()+this._attachedCamera.Ld),u=I}else this._mode===j.IgnoreBoundsSizeMode&&(u=this._calculateLowerRadiusFromModelBoundingSphere(y,S),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ld));if(this.autoCorrectCameraLimitsAndSensibility){const I=S.fS(y).length();this._attachedCamera.panningSensibility=5e3/I,this._attachedCamera.wheelPrecision=100/u}return this._radiusTransition||(this._radiusTransition=T.b.CreateAnimation("radius",T.b.ANIMATIONTYPE_FLOAT,60,j.EasingFunction)),J=T.b.TransitionTo("radius",u,this._attachedCamera,this._attachedCamera.Ey(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),i&&i(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),J&&this._animatables.push(J),!0}_calculateLowerRadiusFromModelBoundingSphere(y,S){const I=this._attachedCamera;if(!I)return 0;let V=I._calculateLowerRadiusFromModelBoundingSphere(y,S,this._radiusScale);return I.lowerRadiusLimit&&this._mode===j.IgnoreBoundsSizeMode&&(V=V<I.lowerRadiusLimit?I.lowerRadiusLimit:V),I.upperRadiusLimit&&(V=V>I.upperRadiusLimit?I.upperRadiusLimit:V),V}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const y=K.b.Now-this._lastInteractionTime,S=.5*Math.PI-this._defaultElevation,I=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>I&&y>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=T.b.CreateAnimation("beta",T.b.ANIMATIONTYPE_FLOAT,60,j.EasingFunction));const y=T.b.TransitionTo("beta",S,this._attachedCamera,this._attachedCamera.Ey(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));y&&this._animatables.push(y)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=K.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}j.EasingFunction=new L.s,j.EasingMode=L.o.EASINGMODE_EASEINOUT,j.IgnoreBoundsSizeMode=0,j.FitFrustumSidesMode=1;var s=I(12759),O=I(12791),f=I(13965),my=I(12128);class C{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(y){y=my.Tools.BackCompatCameraNoPreventDefault(arguments);const S=this.camera.getEngine(),I=S.getInputElement();let V=0,i=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=A=>{var B,d;const F=A.event,J="touch"===F.pointerType;if(A.type!==u.d.POINTERMOVE&&-1===this.buttons.indexOf(F.button))return;const K=F.target;if(this._altKey=F.altKey,this._ctrlKey=F.ctrlKey,this._metaKey=F.metaKey,this._shiftKey=F.shiftKey,this._buttonsPressed=F.buttons,S.isPointerLock){const y=F.movementX,S=F.movementY;this.onTouch(null,y,S),this._pointA=null,this._pointB=null}else{if(A.type!==u.d.POINTERDOWN&&A.type!==u.d.POINTERDOUBLETAP&&J&&(null===(B=this._pointA)||void 0===B?void 0:B.pointerId)!==F.pointerId&&(null===(d=this._pointB)||void 0===d?void 0:d.pointerId)!==F.pointerId)return;if(A.type!==u.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!J)if(A.type===u.d.POINTERDOUBLETAP)this.onDoubleTap(F.pointerType);else if(A.type!==u.d.POINTERUP||this._currentMousePointerIdDown!==F.pointerId&&!J){if(A.type===u.d.POINTERMOVE)if(y||F.preventDefault(),this._pointA&&null===this._pointB){const y=F.clientX-this._pointA.x,S=F.clientY-this._pointA.y;this._pointA.x=F.clientX,this._pointA.y=F.clientY,this.onTouch(this._pointA,y,S)}else if(this._pointA&&this._pointB){const y=this._pointA.pointerId===F.pointerId?this._pointA:this._pointB;y.x=F.clientX,y.y=F.clientY;const S=this._pointA.x-this._pointB.x,I=this._pointA.y-this._pointB.y,B=S*S+I*I,d={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:F.pointerId,type:A.type};this.onMultiTouch(this._pointA,this._pointB,V,B,i,d),i=d,V=B}}else{try{null===K||void 0===K||K.releasePointerCapture(F.pointerId)}catch(G){}J||(this._pointB=null),S._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==F.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==F.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==V||i)&&(this.onMultiTouch(this._pointA,this._pointB,V,0,i,null),V=0,i=null),this._currentMousePointerIdDown=-1,this.onButtonUp(F),y||F.preventDefault()}else{try{null===K||void 0===K||K.setPointerCapture(F.pointerId)}catch(G){}if(null===this._pointA)this._pointA={x:F.clientX,y:F.clientY,pointerId:F.pointerId,type:F.pointerType};else{if(null!==this._pointB)return;this._pointB={x:F.clientX,y:F.clientY,pointerId:F.pointerId,type:F.pointerType}}-1!==this._currentMousePointerIdDown||J||(this._currentMousePointerIdDown=F.pointerId),this.onButtonDown(F),y||(F.preventDefault(),I&&I.focus())}}},this._observer=this.camera.Ey()._inputManager._addCameraPointerObserver(this._pointerInput,u.d.POINTERDOWN|u.d.POINTERUP|u.d.POINTERMOVE|u.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,V=0,i=null,this.onLostFocus()},this._contextMenuBind=y=>this.onContextMenu(y),I&&I.addEventListener("contextmenu",this._contextMenuBind,!1);const A=this.camera.Ey().getEngine().getHostWindow();A&&my.Tools.RegisterTopRootEvents(A,[{name:"blur",handler:this._onLostFocus}])}eK(){if(this._onLostFocus){const y=this.camera.Ey().getEngine().getHostWindow();y&&my.Tools.UnregisterTopRootEvents(y,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Ey()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const y=this.camera.Ey().getEngine().getInputElement();y&&y.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(y){}onTouch(y,S,I){}onMultiTouch(y,S,I,V,i,A){}onContextMenu(y){y.preventDefault()}onButtonDown(y){}onButtonUp(y){}onLostFocus(){}}(0,V.c)([(0,i.E)()],C.prototype,"buttons",void 0);class D extends C{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(y,S){if(0!==this.panningSensibility&&y&&S){const I=S.x-y.x,V=S.y-y.y;this.camera.inertialPanningX+=-I/this.panningSensibility,this.camera.inertialPanningY+=V/this.panningSensibility}}_computePinchZoom(y,S){const I=this.camera.radius||D.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=I*Math.sqrt(y)/Math.sqrt(S):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(S-y)*I*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(S-y)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(y,S,I){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-S/this.panningSensibility,this.camera.inertialPanningY+=I/this.panningSensibility):(this.camera.inertialAlphaOffset-=S/this.angularSensibilityX,this.camera.inertialBetaOffset-=I/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(y,S,I,V,i,A){0===I&&null===i||0===V&&null===A||(this.multiTouchPanAndZoom?(this._computePinchZoom(I,V),this._computeMultiTouchPanning(i,A)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(V)-Math.sqrt(I))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(I,V),this._isPinching=!0):this._computeMultiTouchPanning(i,A)):this.multiTouchPanning?this._computeMultiTouchPanning(i,A):this.pinchZoom&&this._computePinchZoom(I,V))}onButtonDown(y){this._isPanClick=y.button===this.camera._panningMouseButton}onButtonUp(y){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}D.MinimumRadiusForPinch=.001,(0,V.c)([(0,i.E)()],D.prototype,"buttons",void 0),(0,V.c)([(0,i.E)()],D.prototype,"angularSensibilityX",void 0),(0,V.c)([(0,i.E)()],D.prototype,"angularSensibilityY",void 0),(0,V.c)([(0,i.E)()],D.prototype,"pinchPrecision",void 0),(0,V.c)([(0,i.E)()],D.prototype,"pinchDeltaPercentage",void 0),(0,V.c)([(0,i.E)()],D.prototype,"useNaturalPinchZoom",void 0),(0,V.c)([(0,i.E)()],D.prototype,"pinchZoom",void 0),(0,V.c)([(0,i.E)()],D.prototype,"panningSensibility",void 0),(0,V.c)([(0,i.E)()],D.prototype,"multiTouchPanning",void 0),(0,V.c)([(0,i.E)()],D.prototype,"multiTouchPanAndZoom",void 0),f.e.ArcRotateCameraPointersInput=D;var o=I(12596);class E{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(y){y=my.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ey(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((S=>{const I=S.event;if(!I.metaKey)if(S.type===o.b.KEYDOWN){if(this._ctrlPressed=I.ctrlKey,this._altPressed=I.altKey,-1!==this.keysUp.indexOf(I.keyCode)||-1!==this.keysDown.indexOf(I.keyCode)||-1!==this.keysLeft.indexOf(I.keyCode)||-1!==this.keysRight.indexOf(I.keyCode)||-1!==this.keysReset.indexOf(I.keyCode)){-1===this._keys.indexOf(I.keyCode)&&this._keys.push(I.keyCode),I.preventDefault&&(y||I.preventDefault())}}else if(-1!==this.keysUp.indexOf(I.keyCode)||-1!==this.keysDown.indexOf(I.keyCode)||-1!==this.keysLeft.indexOf(I.keyCode)||-1!==this.keysRight.indexOf(I.keyCode)||-1!==this.keysReset.indexOf(I.keyCode)){const S=this._keys.indexOf(I.keyCode);S>=0&&this._keys.splice(S,1),I.preventDefault&&(y||I.preventDefault())}})))}eK(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const y=this.camera;for(let S=0;S<this._keys.length;S++){const I=this._keys[S];-1!==this.keysLeft.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningX-=1/this.panningSensibility:y.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?y.inertialRadiusOffset+=1/this.zoomingSensibility:y.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningX+=1/this.panningSensibility:y.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?y.inertialRadiusOffset-=1/this.zoomingSensibility:y.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(I)&&y.useInputToRestoreState&&y.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,V.c)([(0,i.E)()],E.prototype,"keysUp",void 0),(0,V.c)([(0,i.E)()],E.prototype,"keysDown",void 0),(0,V.c)([(0,i.E)()],E.prototype,"keysLeft",void 0),(0,V.c)([(0,i.E)()],E.prototype,"keysRight",void 0),(0,V.c)([(0,i.E)()],E.prototype,"keysReset",void 0),(0,V.c)([(0,i.E)()],E.prototype,"panningSensibility",void 0),(0,V.c)([(0,i.E)()],E.prototype,"zoomingSensibility",void 0),(0,V.c)([(0,i.E)()],E.prototype,"useAltToZoom",void 0),(0,V.c)([(0,i.E)()],E.prototype,"angularSpeed",void 0),f.e.ArcRotateCameraKeyboardMoveInput=E;var z=I(12367),r=I(12601);class h{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new B.OS(0,0,0),this._globalOffset=new B.OS(0,0,0),this._inertialPanning=B.OS.Zero()}_computeDeltaFromMouseWheelLegacyEvent(y,S){let I=0;const V=.01*y*this.wheelDeltaPercentage*S;return I=y>0?V/(1+this.wheelDeltaPercentage):V*(1+this.wheelDeltaPercentage),I}attachControl(y){y=my.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=S=>{if(S.type!==u.d.POINTERWHEEL)return;const I=S.event;let V=0;const i=I.deltaMode===r.d.DOM_DELTA_LINE?40:1,A=-I.deltaY*i;if(this.customComputeDeltaFromMouseWheel)V=this.customComputeDeltaFromMouseWheel(A,this,I);else if(this.wheelDeltaPercentage){if(V=this._computeDeltaFromMouseWheelLegacyEvent(A,this.camera.radius),V>0){let y=this.camera.radius,S=this.camera.inertialRadiusOffset+V;for(let I=0;I<20&&!(y<=S)&&!(Math.abs(S*this.camera.inertia)<.001);I++)y-=S,S*=this.camera.inertia;y=(0,d.Clamp)(y,0,Number.MAX_VALUE),V=this._computeDeltaFromMouseWheelLegacyEvent(A,y)}}else V=A/(40*this.wheelPrecision);V&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(V)):this.camera.inertialRadiusOffset+=V),I.preventDefault&&(y||I.preventDefault())},this._observer=this.camera.Ey()._inputManager._addCameraPointerObserver(this._wheel,u.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.nd(0)}eK(){this._observer&&(this.camera.Ey()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const y=this.camera;0+y.inertialAlphaOffset+y.inertialBetaOffset+y.inertialRadiusOffset&&(this._updateHitPlane(),y.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(y.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const y=this.camera,S=y.target.fS(y.position);this._hitPlane=z.e.FromPositionAndNormal(y.target,S)}_getPosition(){const y=this.camera,S=y.Ey(),I=S.createPickingRay(S.pointerX,S.pointerY,B.Matrix.Identity(),y,!1);0===y.targetScreenOffset.x&&0===y.targetScreenOffset.y||(this._viewOffset.set(y.targetScreenOffset.x,y.targetScreenOffset.y,0),y.getViewMatrix().invertToRef(y._cameraTransformMatrix),this._globalOffset=B.OS.TransformNormal(this._viewOffset,y._cameraTransformMatrix),I.origin.addInPlace(this._globalOffset));let V=0;return this._hitPlane&&(V=I.intersectsPlane(this._hitPlane)??0),I.origin.addInPlace(I.direction.scaleInPlace(V))}_zoomToMouse(y){const S=this.camera,I=1-S.inertia;if(S.lowerRadiusLimit){const V=S.lowerRadiusLimit??0;S.radius-(S.inertialRadiusOffset+y)/I<V&&(y=(S.radius-V)*I-S.inertialRadiusOffset)}if(S.upperRadiusLimit){const V=S.upperRadiusLimit??0;S.radius-(S.inertialRadiusOffset+y)/I>V&&(y=(S.radius-V)*I-S.inertialRadiusOffset)}const V=y/I/S.radius,i=this._getPosition(),A=B.TmpVectors.OS[6];i.subtractToRef(S.target,A),A.scaleInPlace(V),A.scaleInPlace(I),this._inertialPanning.addInPlace(A),S.inertialRadiusOffset+=y}_zeroIfClose(y){Math.abs(y.x)<G.c&&(y.x=0),Math.abs(y.y)<G.c&&(y.y=0),Math.abs(y.z)<G.c&&(y.z=0)}}(0,V.c)([(0,i.E)()],h.prototype,"wheelPrecision",void 0),(0,V.c)([(0,i.E)()],h.prototype,"zoomToMouseLocation",void 0),(0,V.c)([(0,i.E)()],h.prototype,"wheelDeltaPercentage",void 0),f.e.ArcRotateCameraMouseWheelInput=h;class n extends f.g{constructor(y){super(y)}addMouseWheel(){return this.add(new h),this}addPointers(){return this.add(new D),this}addKeyboard(){return this.add(new E),this}}var v=I(12282);function P(y,S){return isNaN(y)?S:y}F.b.AddNodeConstructor("ArcRotateCamera",((y,S)=>()=>new q(y,0,0,1,B.OS.Zero(),S)));class q extends O.d{get target(){return this._target}set target(y){this.setTarget(y)}get targetHost(){return this._targetHost}set targetHost(y){y&&this.setTarget(y)}getTarget(){return this.target}get position(){return this._position}set position(y){this.setPosition(y)}set upVector(y){this._upToYMatrix||(this._yToUpMatrix=new B.Matrix,this._upToYMatrix=new B.Matrix,this._upVector=B.OS.Zero()),y.normalize(),this._upVector.A(y),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){B.Matrix.RotationAlignToRef(B.OS.UpReadOnly,this._upVector,this._yToUpMatrix),B.Matrix.RotationAlignToRef(this._upVector,B.OS.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const y=this.inputs.attached.pointers;return y?y.angularSensibilityX:0}set angularSensibilityX(y){const S=this.inputs.attached.pointers;S&&(S.angularSensibilityX=y)}get angularSensibilityY(){const y=this.inputs.attached.pointers;return y?y.angularSensibilityY:0}set angularSensibilityY(y){const S=this.inputs.attached.pointers;S&&(S.angularSensibilityY=y)}get pinchPrecision(){const y=this.inputs.attached.pointers;return y?y.pinchPrecision:0}set pinchPrecision(y){const S=this.inputs.attached.pointers;S&&(S.pinchPrecision=y)}get pinchDeltaPercentage(){const y=this.inputs.attached.pointers;return y?y.pinchDeltaPercentage:0}set pinchDeltaPercentage(y){const S=this.inputs.attached.pointers;S&&(S.pinchDeltaPercentage=y)}get useNaturalPinchZoom(){const y=this.inputs.attached.pointers;return!!y&&y.useNaturalPinchZoom}set useNaturalPinchZoom(y){const S=this.inputs.attached.pointers;S&&(S.useNaturalPinchZoom=y)}get panningSensibility(){const y=this.inputs.attached.pointers;return y?y.panningSensibility:0}set panningSensibility(y){const S=this.inputs.attached.pointers;S&&(S.panningSensibility=y)}get keysUp(){const y=this.inputs.attached.keyboard;return y?y.keysUp:[]}set keysUp(y){const S=this.inputs.attached.keyboard;S&&(S.keysUp=y)}get keysDown(){const y=this.inputs.attached.keyboard;return y?y.keysDown:[]}set keysDown(y){const S=this.inputs.attached.keyboard;S&&(S.keysDown=y)}get keysLeft(){const y=this.inputs.attached.keyboard;return y?y.keysLeft:[]}set keysLeft(y){const S=this.inputs.attached.keyboard;S&&(S.keysLeft=y)}get keysRight(){const y=this.inputs.attached.keyboard;return y?y.keysRight:[]}set keysRight(y){const S=this.inputs.attached.keyboard;S&&(S.keysRight=y)}get wheelPrecision(){const y=this.inputs.attached.mousewheel;return y?y.wheelPrecision:0}set wheelPrecision(y){const S=this.inputs.attached.mousewheel;S&&(S.wheelPrecision=y)}get zoomToMouseLocation(){const y=this.inputs.attached.mousewheel;return!!y&&y.zoomToMouseLocation}set zoomToMouseLocation(y){const S=this.inputs.attached.mousewheel;S&&(S.zoomToMouseLocation=y)}get wheelDeltaPercentage(){const y=this.inputs.attached.mousewheel;return y?y.wheelDeltaPercentage:0}set wheelDeltaPercentage(y){const S=this.inputs.attached.mousewheel;S&&(S.wheelDeltaPercentage=y)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(y){y!==this.useBouncingBehavior&&(y?(this._bouncingBehavior=new l,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(y){y!==this.useFramingBehavior&&(y?(this._framingBehavior=new j,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(y){y!==this.useAutoRotationBehavior&&(y?(this._autoRotationBehavior=new p,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(y,S,I,V,i,d){var F;let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(y,B.OS.Zero(),d,J),F=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=B.OS.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=B.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new B.Matrix,this.panningAxis=new B.OS(1,1,0),this._transformedDirection=new B.OS,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new A.b,this.checkCollisions=!1,this.collisionRadius=new B.OS(.5,.5,.5),this._previousPosition=B.OS.Zero(),this._collisionVelocity=B.OS.Zero(),this._newPosition=B.OS.Zero(),this._computationVector=B.OS.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new B.OS(NaN,NaN,NaN),this._goalTargetScreenOffset=new B.Vector2(NaN,NaN),this._onCollisionPositionChange=function(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I?(F.setPosition(S),F.op&&F.op(I)):F._previousPosition.A(F._position);const V=Math.cos(F.alpha),i=Math.sin(F.alpha),A=Math.cos(F.beta);let B=Math.sin(F.beta);0===B&&(B=1e-4);const d=F._getTargetPosition();F._computationVector.od(F.radius*V*B,F.radius*A,F.radius*i*B),d.addToRef(F._computationVector,F._newPosition),F._position.A(F._newPosition);let J=F.upVector;F.allowUpsideDown&&F.beta<0&&(J=J.clone(),J=J.negate()),F._computeViewMatrix(F._position,d,J),F._viewMatrix.addAtIndex(12,F.targetScreenOffset.x),F._viewMatrix.addAtIndex(13,F.targetScreenOffset.y),F._collisionTriggered=!1},this._target=B.OS.Zero(),i&&this.setTarget(i),this.alpha=S,this.beta=I,this.radius=V,this.getViewMatrix(),this.inputs=new n(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new B.OS(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=B.Vector2.Zero()}_updateCache(y){y||super._updateCache(),this._cache._target.A(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.A(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const y=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?y.addToRef(this._targetBoundingCenter,this._target):this._target.A(y)}const y=this._getLockedTargetPosition();return y||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>G.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,A=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=A?this._currentInterpolationFactor=A:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=P(y,this._goalAlpha),this._goalBeta=P(S,this._goalBeta),this._goalRadius=P(I,this._goalRadius),this._goalTarget.set(P(V.x,this._goalTarget.x),P(V.y,this._goalTarget.y),P(V.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(P(i.x,this._goalTargetScreenOffset.x),P(i.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,d.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,d.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,d.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,d.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(y,S){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const i=arguments;S=my.Tools.BackCompatCameraNoPreventDefault(i),this._useCtrlForPanning=I,this._panningMouseButton=V,"boolean"===typeof i[0]&&(i.length>1&&(this._useCtrlForPanning=i[1]),i.length>2&&(this._panningMouseButton=i[2])),this.inputs.attachElement(S),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}eK(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let y=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){y=!0;const S=this.invertRotation?-1:1,I=this._calculateHandednessMultiplier();let V=this.inertialAlphaOffset*I;this.beta<0&&(V*=-1),this.alpha+=V*S,this.beta+=this.inertialBetaOffset*S,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<G.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<G.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*G.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){y=!0;const S=new B.OS(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),S.multiplyInPlace(this.panningAxis),B.OS.TransformNormalToRef(S,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const y=this.upVector,S=B.OS.CrossToRef(this._transformedDirection,y,this._transformedDirection);B.OS.CrossToRef(y,S,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);B.OS.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.A(this._transformedDirection)}else{if(this.parent){const y=B.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(y),y.transposeToRef(y),B.OS.TransformCoordinatesToRef(this._transformedDirection,y,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*G.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*G.c&&(this.inertialPanningY=0)}if(y)this.stopInterpolation();else if(this._isInterpolating){let y=!1;const S=this._scene.getEngine().getDeltaTime()/1e3,I=1-Math.pow(2,-S/this._currentInterpolationFactor),V=P(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const S=B.TmpVectors.OS[0].set(P(this._goalTarget.x,this._target.x),P(this._goalTarget.y,this._target.y),P(this._goalTarget.z,this._target.z));B.OS.LerpToRef(this.target,S,I,this._target),10*B.OS.Distance(this.target,S)/V<G.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.A(S),this.setTarget(this.target,!1,!0,!0)):y=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const S=B.Quaternion.RotationAlphaBetaGammaToRef(P(this._goalAlpha,this.alpha),P(this._goalBeta,this.beta),0,B.TmpVectors.Quaternion[0]),V=B.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,B.TmpVectors.Quaternion[1]),i=B.Quaternion.SlerpToRef(V,S,I,B.TmpVectors.Quaternion[2]);i.normalize();const A=i.toAlphaBetaGammaToRef(B.TmpVectors.OS[0]);if(this.alpha=A.x,this.beta=A.y,i.isApprox(S,G.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const y=S.toAlphaBetaGammaToRef(B.TmpVectors.OS[0]);this.alpha=y.x,this.beta=y.y}else y=!0}if(isNaN(this._goalRadius)||(this.radius+=(V-this.radius)*I,Math.abs(V/this.radius-1)<G.c?(this._goalRadius=NaN,this.radius=V):y=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const S=B.TmpVectors.Vector2[0].set(P(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),P(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));B.Vector2.LerpToRef(this.targetScreenOffset,S,I,this.targetScreenOffset),B.Vector2.Distance(this.targetScreenOffset,S)<G.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.A(S)):y=!0}this._isInterpolating=y}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.OS.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const y=this.alpha;var S,I;this.alpha=function(y){let S=Math.PI/2;return 0===y.x&&0===y.z||(S=Math.acos(y.x/Math.sqrt(Math.pow(y.x,2)+Math.pow(y.z,2)))),y.z<0&&(S=2*Math.PI-S),S}(this._computationVector),this.beta=(S=this._computationVector.y,I=this.radius,Math.acos(S/I));const V=Math.round((y-this.alpha)/(2*Math.PI));this.alpha+=2*V*Math.PI,this._checkLimits()}setPosition(y){this._position.equals(y)||(this._position.A(y),this.rebuildAnglesAndRadius())}setTarget(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(V=this.overrideCloneAlphaBetaRadius??V,y.sd)S&&y.getBoundingInfo?this._targetBoundingCenter=y.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,y.sd(),this._targetHost=y,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const S=y,V=this._getTargetPosition();if(V&&!I&&V.equals(S))return;this._targetHost=null,this._target=S,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}V||this.rebuildAnglesAndRadius()}_getViewMatrix(){const y=Math.cos(this.alpha),S=Math.sin(this.alpha),I=Math.cos(this.beta);let V=Math.sin(this.beta);0===V&&(V=1e-4),0===this.radius&&(this.radius=1e-4);const i=this._getTargetPosition();if(this._computationVector.od(this.radius*y*V,this.radius*I,this.radius*S*V),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.OS.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),i.addToRef(this._computationVector,this._newPosition),this.Ey().collisionsEnabled&&this.checkCollisions){const y=this.Ey().collisionCoordinator;this._collider||(this._collider=y.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,y.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.A(this._newPosition);let y=this.upVector;this.allowUpsideDown&&V<0&&(y=y.negate()),this._computeViewMatrix(this._position,i,y),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.A(i),this._viewMatrix}zoomOn(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y=y||this.Ey().meshes;const I=J.c.MinMax(y);let V=this._calculateLowerRadiusFromModelBoundingSphere(I.min,I.max);if(V=Math.max(Math.min(V,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=V*this.zoomOnFactor,this.mode===s.b.ORTHOGRAPHIC_CAMERA){const y=this.Ey().getEngine().getAspectRatio(this),S=V*this.zoomOnFactor/2;this.orthoLeft=-S*y,this.orthoRight=S*y,this.orthoBottom=-S,this.orthoTop=S}this.focusOn({min:I.min,max:I.max,distance:V},S)}focusOn(y){let S,I,V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===y.min){const V=y||this.Ey().meshes;S=J.c.MinMax(V),I=B.OS.Distance(S.min,S.max)}else{S=y,I=y.distance}this._target=J.c.Center(S),V||(this.maxZ=2*I)}createRigCamera(y,S){let I=0;switch(this.cameraRigMode){case s.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case s.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case s.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case s.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case s.b.RIG_MODE_VR:I=this._cameraRigParams.stereoHalfAngle*(0===S?1:-1);break;case s.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:I=this._cameraRigParams.stereoHalfAngle*(0===S?-1:1)}const V=new q(y,this.alpha+I,this.beta,this.radius,this._target,this.Ey());return V._cameraRigParams={},V.isRigCamera=!0,V.rigParent=this,V.upVector=this.upVector,V.mode=this.mode,V.orthoLeft=this.orthoLeft,V.orthoRight=this.orthoRight,V.orthoBottom=this.orthoBottom,V.orthoTop=this.orthoTop,V}_updateRigCameras(){const y=this._rigCameras[0],S=this._rigCameras[1];switch(y.beta=S.beta=this.beta,this.cameraRigMode){case s.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case s.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case s.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case s.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case s.b.RIG_MODE_VR:y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,S.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case s.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,S.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const V=B.OS.Distance(y,S),i=this.Ey().getEngine().getAspectRatio(this),A=Math.tan(this.fov/2),d=A*i,F=.5*V*I,J=F*Math.sqrt(1+1/(d*d)),u=F*Math.sqrt(1+1/(A*A));return Math.max(J,u)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,V.c)([(0,i.E)()],q.prototype,"alpha",void 0),(0,V.c)([(0,i.E)()],q.prototype,"beta",void 0),(0,V.c)([(0,i.E)()],q.prototype,"radius",void 0),(0,V.c)([(0,i.E)()],q.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,V.c)([(0,i.D)("target")],q.prototype,"_target",void 0),(0,V.c)([(0,i.s)("targetHost")],q.prototype,"_targetHost",void 0),(0,V.c)([(0,i.E)()],q.prototype,"inertialAlphaOffset",void 0),(0,V.c)([(0,i.E)()],q.prototype,"inertialBetaOffset",void 0),(0,V.c)([(0,i.E)()],q.prototype,"inertialRadiusOffset",void 0),(0,V.c)([(0,i.E)()],q.prototype,"lowerAlphaLimit",void 0),(0,V.c)([(0,i.E)()],q.prototype,"upperAlphaLimit",void 0),(0,V.c)([(0,i.E)()],q.prototype,"lowerBetaLimit",void 0),(0,V.c)([(0,i.E)()],q.prototype,"upperBetaLimit",void 0),(0,V.c)([(0,i.E)()],q.prototype,"lowerRadiusLimit",void 0),(0,V.c)([(0,i.E)()],q.prototype,"upperRadiusLimit",void 0),(0,V.c)([(0,i.E)()],q.prototype,"lowerTargetYLimit",void 0),(0,V.c)([(0,i.E)()],q.prototype,"inertialPanningX",void 0),(0,V.c)([(0,i.E)()],q.prototype,"inertialPanningY",void 0),(0,V.c)([(0,i.E)()],q.prototype,"pinchToPanMaxDistance",void 0),(0,V.c)([(0,i.E)()],q.prototype,"panningDistanceLimit",void 0),(0,V.c)([(0,i.D)()],q.prototype,"panningOriginTarget",void 0),(0,V.c)([(0,i.E)()],q.prototype,"panningInertia",void 0),(0,V.c)([(0,i.E)()],q.prototype,"zoomToMouseLocation",null),(0,V.c)([(0,i.E)()],q.prototype,"zoomOnFactor",void 0),(0,V.c)([(0,i.B)()],q.prototype,"targetScreenOffset",void 0),(0,V.c)([(0,i.E)()],q.prototype,"allowUpsideDown",void 0),(0,V.c)([(0,i.E)()],q.prototype,"useInputToRestoreState",void 0),(0,V.c)([(0,i.E)()],q.prototype,"restoreStateInterpolationFactor",void 0),(0,v.e)("BABYLON.ArcRotateCamera",q)},13965:(y,S,I)=>{"use strict";I.d(S,{e:()=>B,g:()=>d});var V=I(12151),i=I(12352),A=I(12759),B={};class d{constructor(y){this.attachedToElement=!1,this.attached={},this.camera=y,this.checkInputs=()=>{}}add(y){const S=y.getSimpleName();this.attached[S]?V.b.Warn("camera input of type "+S+" already exists on camera"):(this.attached[S]=y,y.camera=this.camera,y.checkInputs&&(this.checkInputs=this._addCheckInputs(y.checkInputs.bind(y))),this.attachedToElement&&y.attachControl(this.noPreventDefault))}remove(y){for(const S in this.attached){const I=this.attached[S];if(I===y)return I.eK(),I.camera=null,delete this.attached[S],void this.rebuildInputCheck()}}removeByType(y){for(const S in this.attached){const I=this.attached[S];I.getClassName()===y&&(I.eK(),I.camera=null,delete this.attached[S],this.rebuildInputCheck())}}_addCheckInputs(y){const S=this.checkInputs;return()=>{S(),y()}}attachInput(y){this.attachedToElement&&y.attachControl(this.noPreventDefault)}attachElement(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){y=!A.b.ForceAttachControlToAlwaysPreventDefault&&y,this.attachedToElement=!0,this.noPreventDefault=y;for(const S in this.attached)this.attached[S].attachControl(y)}}detachElement(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const S in this.attached)this.attached[S].eK(),y&&(this.attached[S].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const y in this.attached){const S=this.attached[y];S.checkInputs&&(this.checkInputs=this._addCheckInputs(S.checkInputs.bind(S)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(y){const S={};for(const I in this.attached){const y=this.attached[I],V=i.d.Serialize(y);S[y.getClassName()]=V}y.inputsmgr=S}parse(y){const S=y.inputsmgr;if(S){this.clear();for(const y in S){const I=B[y];if(I){const V=S[y],A=i.d.Parse((()=>new I),V,null);this.add(A)}}}else for(const I in this.attached){const S=B[this.attached[I].getClassName()];if(S){const V=i.d.Parse((()=>new S),y,null);this.remove(this.attached[I]),this.add(V)}}}}},13959:(y,S,I)=>{"use strict";I.d(S,{b:()=>C});var V=I(12306),i=I(12309),A=I(12321),B=I(12791),d=I(13965),F=I(12596),J=I(12128);class u{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(y){y=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ey(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((S=>{const I=S.event;if(!I.metaKey)if(S.type===F.b.KEYDOWN){if(-1!==this.keysUp.indexOf(I.keyCode)||-1!==this.keysDown.indexOf(I.keyCode)||-1!==this.keysLeft.indexOf(I.keyCode)||-1!==this.keysRight.indexOf(I.keyCode)||-1!==this.keysUpward.indexOf(I.keyCode)||-1!==this.keysDownward.indexOf(I.keyCode)||-1!==this.keysRotateLeft.indexOf(I.keyCode)||-1!==this.keysRotateRight.indexOf(I.keyCode)||-1!==this.keysRotateUp.indexOf(I.keyCode)||-1!==this.keysRotateDown.indexOf(I.keyCode)){-1===this._keys.indexOf(I.keyCode)&&this._keys.push(I.keyCode),y||I.preventDefault()}}else if(-1!==this.keysUp.indexOf(I.keyCode)||-1!==this.keysDown.indexOf(I.keyCode)||-1!==this.keysLeft.indexOf(I.keyCode)||-1!==this.keysRight.indexOf(I.keyCode)||-1!==this.keysUpward.indexOf(I.keyCode)||-1!==this.keysDownward.indexOf(I.keyCode)||-1!==this.keysRotateLeft.indexOf(I.keyCode)||-1!==this.keysRotateRight.indexOf(I.keyCode)||-1!==this.keysRotateUp.indexOf(I.keyCode)||-1!==this.keysRotateDown.indexOf(I.keyCode)){const S=this._keys.indexOf(I.keyCode);S>=0&&this._keys.splice(S,1),y||I.preventDefault()}})))}eK(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const y=this.camera;for(let S=0;S<this._keys.length;S++){const I=this._keys[S],V=y._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(I)?y._localDirection.od(-V,0,0):-1!==this.keysUp.indexOf(I)?y._localDirection.od(0,0,V):-1!==this.keysRight.indexOf(I)?y._localDirection.od(V,0,0):-1!==this.keysDown.indexOf(I)?y._localDirection.od(0,0,-V):-1!==this.keysUpward.indexOf(I)?y._localDirection.od(0,V,0):-1!==this.keysDownward.indexOf(I)?y._localDirection.od(0,-V,0):-1!==this.keysRotateLeft.indexOf(I)?(y._localDirection.od(0,0,0),y.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(I)?(y._localDirection.od(0,0,0),y.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(I)?(y._localDirection.od(0,0,0),y.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(I)&&(y._localDirection.od(0,0,0),y.cameraRotation.x+=this._getLocalRotation()),y.Ey().useRightHandedSystem&&(y._localDirection.z*=-1),y.getViewMatrix().invertToRef(y._cameraTransformMatrix),A.OS.TransformNormalToRef(y._localDirection,y._cameraTransformMatrix,y._transformedDirection),y.cameraDirection.addInPlace(y._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const y=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*y}}(0,V.c)([(0,i.E)()],u.prototype,"keysUp",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysUpward",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysDown",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysDownward",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysLeft",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysRight",void 0),(0,V.c)([(0,i.E)()],u.prototype,"rotationSpeed",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysRotateLeft",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysRotateRight",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysRotateUp",void 0),(0,V.c)([(0,i.E)()],u.prototype,"keysRotateDown",void 0),d.e.FreeCameraKeyboardMoveInput=u;var K=I(12133),G=I(12587);class p{constructor(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=y,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new K.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(y){y=J.Tools.BackCompatCameraNoPreventDefault(arguments);const S=this.camera.getEngine(),I=S.getInputElement();this._pointerInput||(this._pointerInput=V=>{const i=V.event,A="touch"===i.pointerType;if(!this.touchEnabled&&A)return;if(V.type!==G.d.POINTERMOVE&&-1===this.buttons.indexOf(i.button))return;const B=i.target;if(V.type===G.d.POINTERDOWN){if(A&&-1!==this._activePointerId||!A&&-1!==this._currentActiveButton)return;this._activePointerId=i.pointerId;try{null===B||void 0===B||B.setPointerCapture(i.pointerId)}catch(d){}-1===this._currentActiveButton&&(this._currentActiveButton=i.button),this._previousPosition={x:i.clientX,y:i.clientY},y||(i.preventDefault(),I&&I.focus()),S.isPointerLock&&this._onMouseMove&&this._onMouseMove(V.event)}else if(V.type===G.d.POINTERUP){if(A&&this._activePointerId!==i.pointerId||!A&&this._currentActiveButton!==i.button)return;try{null===B||void 0===B||B.releasePointerCapture(i.pointerId)}catch(d){}this._currentActiveButton=-1,this._previousPosition=null,y||i.preventDefault(),this._activePointerId=-1}else if(V.type===G.d.POINTERMOVE&&(this._activePointerId===i.pointerId||!A))if(S.isPointerLock&&this._onMouseMove)this._onMouseMove(V.event);else if(this._previousPosition){const S=this.camera._calculateHandednessMultiplier(),I=(i.clientX-this._previousPosition.x)*S,V=i.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=I/this.angularSensibility,this.camera.cameraRotation.x+=V/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:I,offsetY:V}),this._previousPosition={x:i.clientX,y:i.clientY},y||i.preventDefault()}}),this._onMouseMove=I=>{if(!S.isPointerLock)return;const V=this.camera._calculateHandednessMultiplier(),i=I.movementX*V;this.camera.cameraRotation.y+=i/this.angularSensibility;const A=I.movementY;this.camera.cameraRotation.x+=A/this.angularSensibility,this._previousPosition=null,y||I.preventDefault()},this._observer=this.camera.Ey()._inputManager._addCameraPointerObserver(this._pointerInput,G.d.POINTERDOWN|G.d.POINTERUP|G.d.POINTERMOVE),I&&(this._contextMenuBind=y=>this.onContextMenu(y),I.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(y){y.preventDefault()}eK(){if(this._observer){if(this.camera.Ey()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const y=this.camera.getEngine().getInputElement();y&&y.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,V.c)([(0,i.E)()],p.prototype,"buttons",void 0),(0,V.c)([(0,i.E)()],p.prototype,"angularSensibility",void 0),d.e.FreeCameraMouseInput=p;var L,T=I(12601);class l{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new K.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(y){y=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=S=>{if(S.type!==G.d.POINTERWHEEL)return;const I=S.event,V=I.deltaMode===T.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*V*I.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*V*I.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*V*I.deltaZ/this._normalize,I.preventDefault&&(y||I.preventDefault())},this._observer=this.camera.Ey()._inputManager._addCameraPointerObserver(this._wheel,G.d.POINTERWHEEL)}eK(){this._observer&&(this.camera.Ey()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,V.c)([(0,i.E)()],l.prototype,"wheelPrecisionX",void 0),(0,V.c)([(0,i.E)()],l.prototype,"wheelPrecisionY",void 0),(0,V.c)([(0,i.E)()],l.prototype,"wheelPrecisionZ",void 0),function(y){y[y.MoveRelative=0]="MoveRelative",y[y.RotateRelative=1]="RotateRelative",y[y.MoveScene=2]="MoveScene"}(L||(L={}));class j extends l{constructor(){super(...arguments),this._moveRelative=A.OS.Zero(),this._rotateRelative=A.OS.Zero(),this._moveScene=A.OS.Zero(),this._wheelXAction=L.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=L.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(y){null===y&&this._wheelXAction!==L.MoveRelative||(this._wheelXAction=L.MoveRelative,this._wheelXActionCoordinate=y)}get wheelXMoveRelative(){return this._wheelXAction!==L.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(y){null===y&&this._wheelYAction!==L.MoveRelative||(this._wheelYAction=L.MoveRelative,this._wheelYActionCoordinate=y)}get wheelYMoveRelative(){return this._wheelYAction!==L.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(y){null===y&&this._wheelZAction!==L.MoveRelative||(this._wheelZAction=L.MoveRelative,this._wheelZActionCoordinate=y)}get wheelZMoveRelative(){return this._wheelZAction!==L.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(y){null===y&&this._wheelXAction!==L.RotateRelative||(this._wheelXAction=L.RotateRelative,this._wheelXActionCoordinate=y)}get wheelXRotateRelative(){return this._wheelXAction!==L.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(y){null===y&&this._wheelYAction!==L.RotateRelative||(this._wheelYAction=L.RotateRelative,this._wheelYActionCoordinate=y)}get wheelYRotateRelative(){return this._wheelYAction!==L.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(y){null===y&&this._wheelZAction!==L.RotateRelative||(this._wheelZAction=L.RotateRelative,this._wheelZActionCoordinate=y)}get wheelZRotateRelative(){return this._wheelZAction!==L.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(y){null===y&&this._wheelXAction!==L.MoveScene||(this._wheelXAction=L.MoveScene,this._wheelXActionCoordinate=y)}get wheelXMoveScene(){return this._wheelXAction!==L.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(y){null===y&&this._wheelYAction!==L.MoveScene||(this._wheelYAction=L.MoveScene,this._wheelYActionCoordinate=y)}get wheelYMoveScene(){return this._wheelYAction!==L.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(y){null===y&&this._wheelZAction!==L.MoveScene||(this._wheelZAction=L.MoveScene,this._wheelZActionCoordinate=y)}get wheelZMoveScene(){return this._wheelZAction!==L.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.nd(0),this._rotateRelative.nd(0),this._moveScene.nd(0),this._updateCamera(),this.camera.Ey().useRightHandedSystem&&(this._moveRelative.z*=-1);const y=A.Matrix.Zero();this.camera.getViewMatrix().invertToRef(y);const S=A.OS.Zero();A.OS.TransformNormalToRef(this._moveRelative,y,S),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(S),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(y,S,I){if(0===y)return;if(null===S||null===I)return;let V=null;switch(S){case L.MoveRelative:V=this._moveRelative;break;case L.RotateRelative:V=this._rotateRelative;break;case L.MoveScene:V=this._moveScene}switch(I){case 0:V.set(y,0,0);break;case 1:V.set(0,y,0);break;case 2:V.set(0,0,y)}}}(0,V.c)([(0,i.E)()],j.prototype,"wheelXMoveRelative",null),(0,V.c)([(0,i.E)()],j.prototype,"wheelYMoveRelative",null),(0,V.c)([(0,i.E)()],j.prototype,"wheelZMoveRelative",null),(0,V.c)([(0,i.E)()],j.prototype,"wheelXRotateRelative",null),(0,V.c)([(0,i.E)()],j.prototype,"wheelYRotateRelative",null),(0,V.c)([(0,i.E)()],j.prototype,"wheelZRotateRelative",null),(0,V.c)([(0,i.E)()],j.prototype,"wheelXMoveScene",null),(0,V.c)([(0,i.E)()],j.prototype,"wheelYMoveScene",null),(0,V.c)([(0,i.E)()],j.prototype,"wheelZMoveScene",null),d.e.FreeCameraMouseWheelInput=j;class s{constructor(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=y,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=J.Tools.IsSafari()}attachControl(y){y=J.Tools.BackCompatCameraNoPreventDefault(arguments);let S=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=I=>{const V=I.event,i="mouse"===V.pointerType||this._isSafari&&"undefined"===typeof V.pointerType;if(this.allowMouse||!i)if(I.type===G.d.POINTERDOWN){if(y||V.preventDefault(),this._pointerPressed.push(V.pointerId),1!==this._pointerPressed.length)return;S={x:V.clientX,y:V.clientY}}else if(I.type===G.d.POINTERUP){y||V.preventDefault();const I=this._pointerPressed.indexOf(V.pointerId);if(-1===I)return;if(this._pointerPressed.splice(I,1),0!=I)return;S=null,this._offsetX=null,this._offsetY=null}else if(I.type===G.d.POINTERMOVE){if(y||V.preventDefault(),!S)return;if(0!=this._pointerPressed.indexOf(V.pointerId))return;this._offsetX=V.clientX-S.x,this._offsetY=-(V.clientY-S.y)}}),this._observer=this.camera.Ey()._inputManager._addCameraPointerObserver(this._pointerInput,G.d.POINTERDOWN|G.d.POINTERUP|G.d.POINTERMOVE),this._onLostFocus){const y=this.camera.getEngine().getInputElement();y&&y.addEventListener("blur",this._onLostFocus)}}eK(){if(this._pointerInput){if(this._observer&&(this.camera.Ey()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const y=this.camera.getEngine().getInputElement();y&&y.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const y=this.camera,S=y._calculateHandednessMultiplier();y.cameraRotation.y=S*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)y.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const S=y._computeLocalCameraSpeed(),I=new A.OS(0,0,0!==this.touchMoveSensibility?S*this._offsetY/this.touchMoveSensibility:0);A.Matrix.RotationYawPitchRollToRef(y.rotation.y,y.rotation.x,0,y._cameraRotationMatrix),y.cameraDirection.addInPlace(A.OS.TransformCoordinates(I,y._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,V.c)([(0,i.E)()],s.prototype,"touchAngularSensibility",void 0),(0,V.c)([(0,i.E)()],s.prototype,"touchMoveSensibility",void 0),d.e.FreeCameraTouchInput=s;class O extends d.g{constructor(y){super(y),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new u),this}addMouse(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new p(y),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new j,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new s),this}clear(){super.clear(),this._mouseInput=null}}var f=I(12282),my=I(12223);class C extends B.d{get angularSensibility(){const y=this.inputs.attached.mouse;return y?y.angularSensibility:0}set angularSensibility(y){const S=this.inputs.attached.mouse;S&&(S.angularSensibility=y)}get keysUp(){const y=this.inputs.attached.keyboard;return y?y.keysUp:[]}set keysUp(y){const S=this.inputs.attached.keyboard;S&&(S.keysUp=y)}get keysUpward(){const y=this.inputs.attached.keyboard;return y?y.keysUpward:[]}set keysUpward(y){const S=this.inputs.attached.keyboard;S&&(S.keysUpward=y)}get keysDown(){const y=this.inputs.attached.keyboard;return y?y.keysDown:[]}set keysDown(y){const S=this.inputs.attached.keyboard;S&&(S.keysDown=y)}get keysDownward(){const y=this.inputs.attached.keyboard;return y?y.keysDownward:[]}set keysDownward(y){const S=this.inputs.attached.keyboard;S&&(S.keysDownward=y)}get keysLeft(){const y=this.inputs.attached.keyboard;return y?y.keysLeft:[]}set keysLeft(y){const S=this.inputs.attached.keyboard;S&&(S.keysLeft=y)}get keysRight(){const y=this.inputs.attached.keyboard;return y?y.keysRight:[]}set keysRight(y){const S=this.inputs.attached.keyboard;S&&(S.keysRight=y)}get keysRotateLeft(){const y=this.inputs.attached.keyboard;return y?y.keysRotateLeft:[]}set keysRotateLeft(y){const S=this.inputs.attached.keyboard;S&&(S.keysRotateLeft=y)}get keysRotateRight(){const y=this.inputs.attached.keyboard;return y?y.keysRotateRight:[]}set keysRotateRight(y){const S=this.inputs.attached.keyboard;S&&(S.keysRotateRight=y)}get keysRotateUp(){const y=this.inputs.attached.keyboard;return y?y.keysRotateUp:[]}set keysRotateUp(y){const S=this.inputs.attached.keyboard;S&&(S.keysRotateUp=y)}get keysRotateDown(){const y=this.inputs.attached.keyboard;return y?y.keysRotateDown:[]}set keysRotateDown(y){const S=this.inputs.attached.keyboard;S&&(S.keysRotateDown=y)}constructor(y,S,I){var V;super(y,S,I,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),V=this,this.ellipsoid=new A.OS(.5,1,.5),this.ellipsoidOffset=new A.OS(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=A.OS.Zero(),this._diffPosition=A.OS.Zero(),this._newPosition=A.OS.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V._newPosition.A(S),V._newPosition.subtractToRef(V._oldPosition,V._diffPosition),V._diffPosition.length()>my.c.CollisionsEpsilon&&(V.position.addToRef(V._diffPosition,V._deferredPositionUpdate),V._deferOnly?V._deferredUpdated=!0:V.position.A(V._deferredPositionUpdate),V.op&&I&&V.op(I))},this.inputs=new O(this),this.inputs.addKeyboard().addMouse()}attachControl(y,S){S=J.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(S)}eK(){this.inputs.detachElement(),this.cameraDirection=new A.OS(0,0,0),this.cameraRotation=new A.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(y){this._collisionMask=isNaN(y)?-1:y}_collideWithWorld(y){let S;S=this.parent?A.OS.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,S.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const I=this.Ey().collisionCoordinator;this._collider||(this._collider=I.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let V=y;this.applyGravity&&(V=y.add(this.Ey().gravity)),I.getNewPosition(this._oldPosition,V,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=A.OS.Zero(),this._transformedDirection=A.OS.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(y){this._needMoveForGravity=y}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Ey().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"yT"}}(0,V.c)([(0,i.D)()],C.prototype,"ellipsoid",void 0),(0,V.c)([(0,i.D)()],C.prototype,"ellipsoidOffset",void 0),(0,V.c)([(0,i.E)()],C.prototype,"checkCollisions",void 0),(0,V.c)([(0,i.E)()],C.prototype,"applyGravity",void 0),(0,f.e)("BABYLON.FreeCamera",C)},14549:(y,S,I)=>{"use strict";I.d(S,{d:()=>A});var V=I(12412),i=I(14556);class A{constructor(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=I,this.BK=[],this._maxBlockCapacity=S||64,this._selectionContent=new V.c(1024),this._creationFunc=y}update(y,S,I){i.b._CreateBlocks(y,S,I,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}pu(y){for(let S=0;S<this.Eu.length;S++){this.Eu[S].addEntry(y)}}Gu(y){for(let S=0;S<this.Eu.length;S++){this.Eu[S].removeEntry(y)}}select(y,S){this._selectionContent.reset();for(let I=0;I<this.Eu.length;I++){this.Eu[I].select(y,this._selectionContent,S)}return S?this._selectionContent.concat(this.BK):this._selectionContent.concatWithNoDuplicate(this.BK),this._selectionContent}intersects(y,S,I){this._selectionContent.reset();for(let V=0;V<this.Eu.length;V++){this.Eu[V].intersects(y,S,this._selectionContent,I)}return I?this._selectionContent.concat(this.BK):this._selectionContent.concatWithNoDuplicate(this.BK),this._selectionContent}intersectsRay(y){this._selectionContent.reset();for(let S=0;S<this.Eu.length;S++){this.Eu[S].intersectsRay(y,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.BK),this._selectionContent}}A.CreationFuncForMeshes=(y,S)=>{const I=y.getBoundingInfo();!y.isBlocked&&I.boundingBox.intersectsMinMax(S.KK,S.GK)&&S.entries.push(y)},A.CreationFuncForSubMeshes=(y,S)=>{y.getBoundingInfo().boundingBox.intersectsMinMax(S.KK,S.GK)&&S.entries.push(y)}},14556:(y,S,I)=>{"use strict";I.d(S,{b:()=>A});var V=I(12321),i=I(12665);class A{constructor(y,S,I,V,i,A){this.entries=[],this.pK=new Array,this._capacity=I,this._depth=V,this._maxDepth=i,this._creationFunc=A,this._minPoint=y,this._maxPoint=S,this.pK.push(y.clone()),this.pK.push(S.clone()),this.pK.push(y.clone()),this.pK[2].x=S.x,this.pK.push(y.clone()),this.pK[3].y=S.y,this.pK.push(y.clone()),this.pK[4].z=S.z,this.pK.push(S.clone()),this.pK[5].z=y.z,this.pK.push(S.clone()),this.pK[6].x=y.x,this.pK.push(S.clone()),this.pK[7].y=y.y}get zS(){return this._capacity}get KK(){return this._minPoint}get GK(){return this._maxPoint}addEntry(y){if(this.Eu)for(let S=0;S<this.Eu.length;S++){this.Eu[S].addEntry(y)}else this._creationFunc(y,this),this.entries.length>this.zS&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(y){if(this.Eu){for(let S=0;S<this.Eu.length;S++){this.Eu[S].removeEntry(y)}return}const S=this.entries.indexOf(y);S>-1&&this.entries.splice(S,1)}addEntries(y){for(let S=0;S<y.length;S++){const I=y[S];this.addEntry(I)}}select(y,S,I){if(i.c.IsInFrustum(this.pK,y)){if(this.Eu){for(let V=0;V<this.Eu.length;V++){this.Eu[V].select(y,S,I)}return}I?S.concat(this.entries):S.concatWithNoDuplicate(this.entries)}}intersects(y,S,I,V){if(i.c.IntersectsSphere(this._minPoint,this._maxPoint,y,S)){if(this.Eu){for(let i=0;i<this.Eu.length;i++){this.Eu[i].intersects(y,S,I,V)}return}V?I.concat(this.entries):I.concatWithNoDuplicate(this.entries)}}intersectsRay(y,S){if(y.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Eu){for(let I=0;I<this.Eu.length;I++){this.Eu[I].intersectsRay(y,S)}return}S.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){A._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(y,S,I,i,B,d,F,J){F.Eu=new Array;const u=new V.OS((S.x-y.x)/2,(S.y-y.y)/2,(S.z-y.z)/2);for(let V=0;V<2;V++)for(let S=0;S<2;S++)for(let K=0;K<2;K++){const G=y.add(u.multiplyByFloats(V,S,K)),p=y.add(u.multiplyByFloats(V+1,S+1,K+1)),L=new A(G,p,i,B+1,d,J);L.addEntries(I),F.Eu.push(L)}}}},14563:(y,S,I)=>{"use strict";I.d(S,{e:()=>u});var V=I(12556),i=I(12321),A=I(12734),B=I(13725),d=I(12583),F=I(14549),J=I(12185);V.e.prototype.createOrUpdateSelectionOctree=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,I=this._getComponent(d.c.NAME_OCTREE);I||(I=new u(this),this.o(I)),this.iK||(this.iK=new F.d(F.d.CreationFuncForMeshes,y,S));const V=this.getWorldExtends();return this.iK.update(V.min,V.max,this.meshes),this.iK},Object.defineProperty(V.e.prototype,"selectionOctree",{get:function(){return this.iK},enumerable:!0,configurable:!0}),A.e.prototype.createOrUpdateSubmeshesOctree=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const I=this.Ey();let V=I._getComponent(d.c.NAME_OCTREE);V||(V=new u(I),I.o(V)),this._submeshesOctree||(this._submeshesOctree=new F.d(F.d.CreationFuncForSubMeshes,y,S)),this.sd(!0);const i=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(i.minimumWorld,i.maximumWorld,this.wi),this._submeshesOctree};class u{constructor(y){this.name=d.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new B.d(i.OS.Zero(),new i.OS(1,1,1)),(y=y||J.e.LastCreatedScene)&&(this.mI=y,this.mI.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.mI.getActiveSubMeshCandidates=y=>this.getActiveSubMeshCandidates(y),this.mI.getCollidingSubMeshCandidates=(y,S)=>this.getCollidingSubMeshCandidates(y,S),this.mI.getIntersectingSubMeshCandidates=(y,S)=>this.getIntersectingSubMeshCandidates(y,S))}register(){this.mI.onMeshRemovedObservable.add((y=>{const S=this.mI.selectionOctree;if(void 0!==S&&null!==S){const I=S.BK.indexOf(y);-1!==I&&S.BK.splice(I,1)}})),this.mI.onMeshImportedObservable.add((y=>{const S=this.mI.selectionOctree;void 0!==S&&null!==S&&S.pu(y)}))}getActiveMeshCandidates(){var y;return(null===(y=this.mI.iK)||void 0===y?void 0:y.select(this.mI.frustumPlanes))||this.mI._getDefaultMeshCandidates()}getActiveSubMeshCandidates(y){if(y._submeshesOctree&&y.useOctreeForRenderingSelection){return y._submeshesOctree.select(this.mI.frustumPlanes)}return this.mI._getDefaultSubMeshCandidates(y)}getIntersectingSubMeshCandidates(y,S){if(y._submeshesOctree&&y.useOctreeForPicking){B.d.TransformToRef(S,y.getWorldMatrix(),this._tempRay);return y._submeshesOctree.intersectsRay(this._tempRay)}return this.mI._getDefaultSubMeshCandidates(y)}getCollidingSubMeshCandidates(y,S){if(y._submeshesOctree&&y.useOctreeForCollisions){const I=S._velocityWorldLength+Math.max(S._radius.x,S._radius.y,S._radius.z);return y._submeshesOctree.intersects(S._basePointWorld,I)}return this.mI._getDefaultSubMeshCandidates(y)}rebuild(){}dispose(){}}},13725:(y,S,I)=>{"use strict";I.d(S,{d:()=>p});var V=I(12556),i=I(12759),A=I(12325),B=I(12321),d=I(12331),F=I(12653),J=I(12576),u=I(12185),K=I(12610);const G={internalPickerForMesh:void 0};class p{constructor(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.c;this.origin=y,this.direction=S,this.length=I,this.epsilon=V}clone(){return new p(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const V=p._TmpVector3[0].od(y.x-I,y.y-I,y.z-I),i=p._TmpVector3[1].od(S.x+I,S.y+I,S.z+I);let A,B,d,F,J=0,u=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<V.x||this.origin.x>i.x)return!1}else if(A=1/this.direction.x,B=(V.x-this.origin.x)*A,d=(i.x-this.origin.x)*A,d===-1/0&&(d=1/0),B>d&&(F=B,B=d,d=F),J=Math.max(B,J),u=Math.min(d,u),J>u)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<V.y||this.origin.y>i.y)return!1}else if(A=1/this.direction.y,B=(V.y-this.origin.y)*A,d=(i.y-this.origin.y)*A,d===-1/0&&(d=1/0),B>d&&(F=B,B=d,d=F),J=Math.max(B,J),u=Math.min(d,u),J>u)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<V.z||this.origin.z>i.z)return!1}else if(A=1/this.direction.z,B=(V.z-this.origin.z)*A,d=(i.z-this.origin.z)*A,d===-1/0&&(d=1/0),B>d&&(F=B,B=d,d=F),J=Math.max(B,J),u=Math.min(d,u),J>u)return!1;return!0}intersectsBox(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(y.minimum,y.maximum,S)}intersectsSphere(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const I=y.center.x-this.origin.x,V=y.center.y-this.origin.y,i=y.center.z-this.origin.z,A=I*I+V*V+i*i,B=y.radius+S,d=B*B;if(A<=d)return!0;const F=I*this.direction.x+V*this.direction.y+i*this.direction.z;if(F<0)return!1;return A-F*F<=d}intersectsTriangle(y,S,I){const V=p._TmpVector3[0],i=p._TmpVector3[1],A=p._TmpVector3[2],d=p._TmpVector3[3],J=p._TmpVector3[4];S.subtractToRef(y,V),I.subtractToRef(y,i),B.OS.CrossToRef(this.direction,i,A);const u=B.OS.Dot(V,A);if(0===u)return null;const K=1/u;this.origin.subtractToRef(y,d);const G=B.OS.Dot(d,A)*K;if(G<-this.epsilon||G>1+this.epsilon)return null;B.OS.CrossToRef(d,V,J);const L=B.OS.Dot(this.direction,J)*K;if(L<-this.epsilon||G+L>1+this.epsilon)return null;const T=B.OS.Dot(i,J)*K;return T>this.length?null:new F.c(1-G-L,G,T)}intersectsPlane(y){let S;const I=B.OS.Dot(y.normal,this.direction);if(Math.abs(I)<9.99999997475243e-7)return null;{const V=B.OS.Dot(y.normal,this.origin);return S=(-y.d-V)/I,S<0?S<-9.99999997475243e-7?null:0:S}}intersectsAxis(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(y){case"y":{const y=(this.origin.y-S)/this.direction.y;return y>0?null:new B.OS(this.origin.x+this.direction.x*-y,S,this.origin.z+this.direction.z*-y)}case"x":{const y=(this.origin.x-S)/this.direction.x;return y>0?null:new B.OS(S,this.origin.y+this.direction.y*-y,this.origin.z+this.direction.z*-y)}case"z":{const y=(this.origin.z-S)/this.direction.z;return y>0?null:new B.OS(this.origin.x+this.direction.x*-y,this.origin.y+this.direction.y*-y,S)}default:return null}}intersectsMesh(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const d=B.TmpVectors.Matrix[0];return y.getWorldMatrix().invertToRef(d),this._tmpRay?p.TransformToRef(this,d,this._tmpRay):this._tmpRay=p.Transform(this,d),y.intersects(this._tmpRay,S,I,V,i,A)}intersectsMeshes(y,S,I){I?I.length=0:I=[];for(let V=0;V<y.length;V++){const i=this.intersectsMesh(y[V],S);i.hit&&I.push(i)}return I.sort(this._comparePickingInfo),I}_comparePickingInfo(y,S){return y.distance<S.distance?-1:y.distance>S.distance?1:0}intersectionSegment(y,S,I){const V=this.origin,i=B.TmpVectors.OS[0],A=B.TmpVectors.OS[1],d=B.TmpVectors.OS[2],F=B.TmpVectors.OS[3];S.subtractToRef(y,i),this.direction.scaleToRef(p._Rayl,d),V.addToRef(d,A),y.subtractToRef(V,F);const J=B.OS.Dot(i,i),u=B.OS.Dot(i,d),K=B.OS.Dot(d,d),G=B.OS.Dot(i,F),L=B.OS.Dot(d,F),T=J*K-u*u;let l,j,s=T,O=T;T<p._Smallnum?(l=0,s=1,j=L,O=K):(l=u*L-K*G,j=J*L-u*G,l<0?(l=0,j=L,O=K):l>s&&(l=s,j=L+u,O=K)),j<0?(j=0,-G<0?l=0:-G>J?l=s:(l=-G,s=J)):j>O&&(j=O,-G+u<0?l=0:-G+u>J?l=s:(l=-G+u,s=J));const f=Math.abs(l)<p._Smallnum?0:l/s,my=Math.abs(j)<p._Smallnum?0:j/O,C=B.TmpVectors.OS[4];d.scaleToRef(my,C);const D=B.TmpVectors.OS[5];i.scaleToRef(f,D),D.addInPlace(F);const o=B.TmpVectors.OS[6];D.subtractToRef(C,o);return my>0&&my<=this.length&&o.lengthSquared()<I*I?D.length():-1}update(y,S,I,V,i,A,d){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){p._RayDistant||(p._RayDistant=p.Zero()),p._RayDistant.unprojectRayToRef(y,S,I,V,B.Matrix.IdentityReadOnly,A,d);const F=B.TmpVectors.Matrix[0];i.invertToRef(F),p.TransformToRef(p._RayDistant,F,this)}else this.unprojectRayToRef(y,S,I,V,i,A,d);return this}static Zero(){return new p(B.OS.Zero(),B.OS.Zero())}static CreateNew(y,S,I,V,i,A,B){return p.Zero().update(y,S,I,V,i,A,B)}static CreateNewFromTo(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.Matrix.IdentityReadOnly;const V=new p(new B.OS(0,0,0),new B.OS(0,0,0));return p.CreateFromToToRef(y,S,V,I)}static CreateFromToToRef(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.Matrix.IdentityReadOnly;I.origin.A(y);const i=S.subtractToRef(y,I.direction),A=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);return I.length=A,I.direction.normalize(),p.TransformToRef(I,V,I)}static Transform(y,S){const I=new p(new B.OS(0,0,0),new B.OS(0,0,0));return p.TransformToRef(y,S,I),I}static TransformToRef(y,S,I){B.OS.TransformCoordinatesToRef(y.origin,S,I.origin),B.OS.TransformNormalToRef(y.direction,S,I.direction),I.length=y.length,I.epsilon=y.epsilon;const V=I.direction,i=V.length();if(0!==i&&1!==i){const y=1/i;V.x*=y,V.y*=y,V.z*=y,I.length*=i}return I}unprojectRayToRef(y,S,I,V,i,A,d){const F=B.TmpVectors.Matrix[0];i.multiplyToRef(A,F),F.multiplyToRef(d,F),F.invert();const J=u.e.LastCreatedEngine,K=B.TmpVectors.OS[0];K.x=y/I*2-1,K.y=-(S/V*2-1),K.z=null!==J&&void 0!==J&&J.si?1:null!==J&&void 0!==J&&J.isNDCHalfZRange?0:-1;const G=B.TmpVectors.OS[1].od(K.x,K.y,1-1e-8),p=B.TmpVectors.OS[2],L=B.TmpVectors.OS[3];B.OS._UnprojectFromInvertedMatrixToRef(K,F,p),B.OS._UnprojectFromInvertedMatrixToRef(G,F,L),this.origin.A(p),L.subtractToRef(p,this.direction),this.direction.normalize()}}function L(y,S,I,V,i){let A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=p.Zero();return T(y,S,I,V,B,i,A),B}function T(y,S,I,V,i,A){let d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const J=y.getEngine();if(!A&&!(A=y.activeCamera))return y;const u=A.viewport,K=J.getRenderHeight(),{x:G,y:p,width:L,height:T}=u.toGlobal(J.getRenderWidth(),K),l=1/J.getHardwareScalingLevel();return S=S*l-G,I=I*l-(K-p-T),i.update(S,I,L,T,V||B.Matrix.IdentityReadOnly,d?B.Matrix.IdentityReadOnly:A.getViewMatrix(),A.getProjectionMatrix(),F),y}function l(y,S,I,V,i){if(!J.c)return y;const A=y.getEngine();if(!i&&!(i=y.activeCamera))throw new Error("Active camera not set");const d=i.viewport,F=A.getRenderHeight(),{x:u,y:K,width:G,height:p}=d.toGlobal(A.getRenderWidth(),F),L=B.Matrix.Identity(),T=1/A.getHardwareScalingLevel();return S=S*T-u,I=I*T-(F-K-p),V.update(S,I,G,p,L,L,i.getProjectionMatrix()),y}function j(y,S,I,V,i,A,B,d){const F=S(V,I.enableDistantPicking),J=I.intersects(F,i,B,A,V,d);return J&&J.hit?!i&&null!=y&&J.distance>=y.distance?null:J:null}function s(y,S,I,V,i,A){let d=null;const F=!!(y.activeCameras&&y.activeCameras.length>1&&y.cameraToUseForPointers!==y.activeCamera),u=y.cameraToUseForPointers||y.activeCamera,K=G.internalPickerForMesh||j;for(let J=0;J<y.meshes.length;J++){const G=y.meshes[J];if(I){if(!I(G,-1))continue}else if(!G.isEnabled()||!G.isVisible||!G.HF)continue;const p=F&&G.isWorldMatrixCameraDependent(),L=G.sd(p,u);if(G.hasThinInstances&&G.vJ){const y=K(d,S,G,L,!0,!0,A);if(y){if(i)return y;const F=B.TmpVectors.Matrix[1],J=G.thinInstanceGetWorldMatrices();for(let y=0;y<J.length;y++){if(I&&!I(G,y))continue;J[y].multiplyToRef(L,F);const B=K(d,S,G,F,V,i,A,!0);if(B&&(d=B,d.thinInstanceIndex=y,V))return d}}}else{const y=K(d,S,G,L,V,i,A);if(y&&(d=y,V))return d}}return d||new J.c}function O(y,S,I,V){if(!J.c)return null;const i=[],A=!!(y.activeCameras&&y.activeCameras.length>1&&y.cameraToUseForPointers!==y.activeCamera),d=y.cameraToUseForPointers||y.activeCamera,F=G.internalPickerForMesh||j;for(let J=0;J<y.meshes.length;J++){const u=y.meshes[J];if(I){if(!I(u,-1))continue}else if(!u.isEnabled()||!u.isVisible||!u.HF)continue;const K=A&&u.isWorldMatrixCameraDependent(),G=u.sd(K,d);if(u.hasThinInstances&&u.vJ){if(F(null,S,u,G,!0,!0,V)){const y=B.TmpVectors.Matrix[1],A=u.thinInstanceGetWorldMatrices();for(let B=0;B<A.length;B++){if(I&&!I(u,B))continue;A[B].multiplyToRef(G,y);const d=F(null,S,u,y,!1,!1,V,!0);d&&(d.thinInstanceIndex=B,i.push(d))}}}else{const y=F(null,S,u,G,!1,!1,V);y&&i.push(y)}}return i}function f(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,V=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;V||(V=y.getWorldMatrix()),S.length=I,i?S.origin.A(i):S.origin.A(y.position);const A=B.TmpVectors.OS[2];A.set(0,0,y._scene.useRightHandedSystem?-1:1);const d=B.TmpVectors.OS[3];return B.OS.TransformNormalToRef(A,V,d),B.OS.NormalizeToRef(d,S.direction),S}var my,C;p._TmpVector3=(0,d.e)(6,B.OS.Zero),p._RayDistant=p.Zero(),p._Smallnum=1e-8,p._Rayl=1e9,my=V.e,(C=i.b)&&(C.prototype.getForwardRay=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,S=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;return f(this,new p(B.OS.Zero(),B.OS.Zero(),y),y,S,I)},C.prototype.getForwardRayToRef=function(y){return f(this,y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),my&&(K.d._IsPickingAvailable=!0,my.prototype.createPickingRay=function(y,S,I,V){return L(this,y,S,I,V,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),V.e.prototype.createPickingRayToRef=function(y,S,I,V,i){return T(this,y,S,I,V,i,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},V.e.prototype.createPickingRayInCameraSpace=function(y,S,I){return function(y,S,I,V){const i=p.Zero();return l(y,S,I,i,V),i}(this,y,S,I)},V.e.prototype.createPickingRayInCameraSpaceToRef=function(y,S,I,V){return l(this,y,S,I,V)},V.e.prototype.pickWithBoundingInfo=function(y,S,I,V,i){return function(y,S,I,V,i,A){if(!J.c)return null;const d=s(y,(V=>(y._tempPickingRay||(y._tempPickingRay=p.Zero()),T(y,S,I,V,y._tempPickingRay,A||null),y._tempPickingRay)),V,i,!0);return d&&(d.ray=L(y,S,I,B.Matrix.Identity(),A||null)),d}(this,y,S,I,V,i)},V.e.prototype.jI=function(y,S,I,V,i,A){return function(y,S,I,V,i,A,d){const F=s(y,((V,i)=>(y._tempPickingRay||(y._tempPickingRay=p.Zero()),T(y,S,I,V,y._tempPickingRay,A||null,!1,i),y._tempPickingRay)),V,i,!1,d);return F&&(F.ray=L(y,S,I,B.Matrix.Identity(),A||null)),F}(this,y,S,I,V,i,A)},V.e.prototype.pickWithRay=function(y,S,I,V){return function(y,S,I,V,i){const A=s(y,(I=>(y._pickWithRayInverseMatrix||(y._pickWithRayInverseMatrix=B.Matrix.Identity()),I.invertToRef(y._pickWithRayInverseMatrix),y._cachedRayForTransform||(y._cachedRayForTransform=p.Zero()),p.TransformToRef(S,y._pickWithRayInverseMatrix,y._cachedRayForTransform),y._cachedRayForTransform)),I,V,!1,i);return A&&(A.ray=S),A}(this,y,S,I,V)},V.e.prototype.multiPick=function(y,S,I,V,i){return function(y,S,I,V,i,A){return O(y,(V=>L(y,S,I,V,i||null)),V,A)}(this,y,S,I,V,i)},V.e.prototype.multiPickWithRay=function(y,S,I){return function(y,S,I,V){return O(y,(I=>(y._pickWithRayInverseMatrix||(y._pickWithRayInverseMatrix=B.Matrix.Identity()),I.invertToRef(y._pickWithRayInverseMatrix),y._cachedRayForTransform||(y._cachedRayForTransform=p.Zero()),p.TransformToRef(S,y._pickWithRayInverseMatrix,y._cachedRayForTransform),y._cachedRayForTransform)),I,V)}(this,y,S,I)}},14001:(y,S,I)=>{"use strict";var V=I(12265),i=I(12151),A=I(12193),B=I(12286),d=I(12223),F=I(12276);d.c.prototype._partialLoadFile=function(y,S,I,V){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(y,(y=>{I[S]=y,I._internalCount++,6===I._internalCount&&V(I)}),void 0,void 0,!0,((y,S)=>{i&&y&&i(y.status+" "+y.statusText,S)}))},d.c.prototype._cascadeLoadFiles=function(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=[];i._internalCount=0;for(let A=0;A<6;A++)this._partialLoadFile(I[A],A,i,S,V)},d.c.prototype._cascadeLoadImgs=function(y,S,I,V){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5?arguments[5]:void 0;const B=[];B._internalCount=0;for(let d=0;d<6;d++)this._partialLoadImg(V[d],d,B,y,S,I,i,A)},d.c.prototype._partialLoadImg=function(y,S,I,V,i,d){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0;const u=(0,B.d)();(0,A.w)(y,(y=>{I[S]=y,I._internalCount++,V&&V.removePendingData(u),6===I._internalCount&&d&&d(i,I)}),((y,S)=>{V&&V.removePendingData(u),F&&F(y,S)}),V?V.offlineProvider:null,J),V&&V.addPendingData(u)},d.c.prototype.createCubeTextureBase=function(y,S,I,A){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,L=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,T=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,l=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,j=arguments.length>14&&void 0!==arguments[14]&&arguments[14],s=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const O=L||new V.c(this,7);O.isCube=!0,O.url=y,O.generateMipMaps=!A,O._lodGenerationScale=G,O._lodGenerationOffset=p,O._useSRGBBuffer=!!j&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!A),O!==L&&(O.label=y.substring(0,60)),this._doNotHandleContextLost||(O._extension=u,O._files=I,O._buffer=s);const f=y;this._transformTextureUrl&&!L&&(y=this._transformTextureUrl(y));const my=u??function(y){const S=y.split("?")[0],I=S.lastIndexOf(".");return I>-1?S.substring(I).toLowerCase():""}(y),C=(0,F.c)(my),D=(y,S)=>{O.dispose(),d?d(y,S):y&&i.b.Warn(y)},o=(V,d)=>{y===f?V&&D(V.status+" "+V.statusText,d):(i.b.Warn(`Failed to load ${y}, falling back to the ${f}`),this.createCubeTextureBase(f,S,I,!!A,B,D,J,u,K,G,p,O,T,l,j,s))};if(C)C.then((V=>{const i=y=>{T&&T(O,y),V.loadCubeData(y,O,K,B,((y,S)=>{D(y,S)}))};s?i(s):I&&6===I.length?V.supportCascades?this._cascadeLoadFiles(S,(y=>i(y.map((y=>new Uint8Array(y))))),I,D):D("Textures type does not support cascades."):this._loadFile(y,(y=>i(new Uint8Array(y))),void 0,void 0,!0,o)}));else{if(!I||0===I.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(S,O,((y,S)=>{l&&l(y,S)}),I,D)}return this._internalTexturesCache.push(O),O}},14567:(y,S,I)=>{"use strict";I(12151);var V=I(12455);I(12265),I(12397),I(12260),I(12501),I(12463);V.c},14029:(y,S,I)=>{"use strict";I.d(S,{c:()=>i});var V=I(12282);class i{constructor(y){this.value=this._toInt(y)}_toInt(y){return 0|y}add(y){return new i(this.value+y.value)}fS(y){return new i(this.value-y.value)}multiply(y){return new i(Math.imul(this.value,y.value))}divide(y){return new i(this.value/y.value)}getClassName(){return i.ClassName}equals(y){return this.value===y.value}static FromValue(y){return new i(y)}toString(){return this.value.toString()}}i.ClassName="FlowGraphInteger",(0,V.e)("FlowGraphInteger",i)},14038:(y,S,I)=>{"use strict";I.d(S,{b:()=>i,c:()=>A});var V=I(12321);class i{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ki=y}get m(){return this.ki}transformVector(y){return this.transformVectorToRef(y,new V.Vector2)}transformVectorToRef(y,S){return S.x=y.x*this.ki[0]+y.y*this.ki[1],S.y=y.x*this.ki[2]+y.y*this.ki[3],S}Vd(){return this.toArray()}toArray(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let S=0;S<4;S++)y[S]=this.ki[S];return y}sI(y){for(let S=0;S<4;S++)this.ki[S]=y[S];return this}multiplyToRef(y,S){const I=y.ki,V=this.ki,i=S.ki;return i[0]=I[0]*V[0]+I[1]*V[2],i[1]=I[0]*V[1]+I[1]*V[3],i[2]=I[2]*V[0]+I[3]*V[2],i[3]=I[2]*V[1]+I[3]*V[3],S}multiply(y){return this.multiplyToRef(y,new i)}divideToRef(y,S){const I=this.ki,V=y.ki,i=S.ki;return i[0]=I[0]/V[0],i[1]=I[1]/V[1],i[2]=I[2]/V[2],i[3]=I[3]/V[3],S}divide(y){return this.divideToRef(y,new i)}addToRef(y,S){const I=this.ki,V=y.m,i=S.m;return i[0]=I[0]+V[0],i[1]=I[1]+V[1],i[2]=I[2]+V[2],i[3]=I[3]+V[3],S}add(y){return this.addToRef(y,new i)}subtractToRef(y,S){const I=this.ki,V=y.m,i=S.m;return i[0]=I[0]-V[0],i[1]=I[1]-V[1],i[2]=I[2]-V[2],i[3]=I[3]-V[3],S}fS(y){return this.subtractToRef(y,new i)}transpose(){const y=this.ki;return new i([y[0],y[2],y[1],y[3]])}determinant(){const y=this.ki;return y[0]*y[3]-y[1]*y[2]}inverse(){const y=this.determinant();if(0===y)throw new Error("Matrix is not invertible");const S=this.ki,I=1/y;return new i([S[3]*I,-S[1]*I,-S[2]*I,S[0]*I])}equals(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const I=this.ki,V=y.m;return 0===S?I[0]===V[0]&&I[1]===V[1]&&I[2]===V[2]&&I[3]===V[3]:Math.abs(I[0]-V[0])<S&&Math.abs(I[1]-V[1])<S&&Math.abs(I[2]-V[2])<S&&Math.abs(I[3]-V[3])<S}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ki.join(", ")})`}}class A{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ki=y}get m(){return this.ki}transformVector(y){return this.transformVectorToRef(y,new V.OS)}transformVectorToRef(y,S){const I=this.ki;return S.x=y.x*I[0]+y.y*I[1]+y.z*I[2],S.y=y.x*I[3]+y.y*I[4]+y.z*I[5],S.z=y.x*I[6]+y.y*I[7]+y.z*I[8],S}multiplyToRef(y,S){const I=y.ki,V=this.ki,i=S.m;return i[0]=I[0]*V[0]+I[1]*V[3]+I[2]*V[6],i[1]=I[0]*V[1]+I[1]*V[4]+I[2]*V[7],i[2]=I[0]*V[2]+I[1]*V[5]+I[2]*V[8],i[3]=I[3]*V[0]+I[4]*V[3]+I[5]*V[6],i[4]=I[3]*V[1]+I[4]*V[4]+I[5]*V[7],i[5]=I[3]*V[2]+I[4]*V[5]+I[5]*V[8],i[6]=I[6]*V[0]+I[7]*V[3]+I[8]*V[6],i[7]=I[6]*V[1]+I[7]*V[4]+I[8]*V[7],i[8]=I[6]*V[2]+I[7]*V[5]+I[8]*V[8],S}multiply(y){return this.multiplyToRef(y,new A)}divideToRef(y,S){const I=this.ki,V=y.m,i=S.m;return i[0]=I[0]/V[0],i[1]=I[1]/V[1],i[2]=I[2]/V[2],i[3]=I[3]/V[3],i[4]=I[4]/V[4],i[5]=I[5]/V[5],i[6]=I[6]/V[6],i[7]=I[7]/V[7],i[8]=I[8]/V[8],S}divide(y){return this.divideToRef(y,new A)}addToRef(y,S){const I=this.ki,V=y.m,i=S.m;return i[0]=I[0]+V[0],i[1]=I[1]+V[1],i[2]=I[2]+V[2],i[3]=I[3]+V[3],i[4]=I[4]+V[4],i[5]=I[5]+V[5],i[6]=I[6]+V[6],i[7]=I[7]+V[7],i[8]=I[8]+V[8],S}add(y){return this.addToRef(y,new A)}subtractToRef(y,S){const I=this.ki,V=y.m,i=S.m;return i[0]=I[0]-V[0],i[1]=I[1]-V[1],i[2]=I[2]-V[2],i[3]=I[3]-V[3],i[4]=I[4]-V[4],i[5]=I[5]-V[5],i[6]=I[6]-V[6],i[7]=I[7]-V[7],i[8]=I[8]-V[8],S}fS(y){return this.subtractToRef(y,new A)}toArray(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let S=0;S<9;S++)y[S]=this.ki[S];return y}Vd(){return this.toArray()}sI(y){for(let S=0;S<9;S++)this.ki[S]=y[S];return this}transpose(){const y=this.ki;return new A([y[0],y[3],y[6],y[1],y[4],y[7],y[2],y[5],y[8]])}determinant(){const y=this.ki;return y[0]*(y[4]*y[8]-y[5]*y[7])-y[1]*(y[3]*y[8]-y[5]*y[6])+y[2]*(y[3]*y[7]-y[4]*y[6])}inverse(){const y=this.determinant();if(0===y)throw new Error("Matrix is not invertible");const S=this.ki,I=1/y;return new A([(S[4]*S[8]-S[5]*S[7])*I,(S[2]*S[7]-S[1]*S[8])*I,(S[1]*S[5]-S[2]*S[4])*I,(S[5]*S[6]-S[3]*S[8])*I,(S[0]*S[8]-S[2]*S[6])*I,(S[2]*S[3]-S[0]*S[5])*I,(S[3]*S[7]-S[4]*S[6])*I,(S[1]*S[6]-S[0]*S[7])*I,(S[0]*S[4]-S[1]*S[3])*I])}equals(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const I=this.ki,V=y.m;return 0===S?I[0]===V[0]&&I[1]===V[1]&&I[2]===V[2]&&I[3]===V[3]&&I[4]===V[4]&&I[5]===V[5]&&I[6]===V[6]&&I[7]===V[7]&&I[8]===V[8]:Math.abs(I[0]-V[0])<S&&Math.abs(I[1]-V[1])<S&&Math.abs(I[2]-V[2])<S&&Math.abs(I[3]-V[3])<S&&Math.abs(I[4]-V[4])<S&&Math.abs(I[5]-V[5])<S&&Math.abs(I[6]-V[6])<S&&Math.abs(I[7]-V[7])<S&&Math.abs(I[8]-V[8])<S}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ki.join(", ")})`}}},14047:(y,S,I)=>{"use strict";var V;function i(y,S,I,V){switch(S){case"Animation":return V?y.animations.find((y=>y.uniqueId===I))??null:y.animations[I]??null;case"AnimationGroup":return V?y.animationGroups.find((y=>y.uniqueId===I))??null:y.animationGroups[I]??null;case"Mesh":return V?y.meshes.find((y=>y.uniqueId===I))??null:y.meshes[I]??null;case"Material":return V?y.materials.find((y=>y.uniqueId===I))??null:y.materials[I]??null;case"mK":return V?y.cameras.find((y=>y.uniqueId===I))??null:y.cameras[I]??null;case"Light":return V?y.lights.find((y=>y.uniqueId===I))??null:y.lights[I]??null;default:return null}}I.d(S,{c:()=>i}),function(y){y.Animation="Animation",y.AnimationGroup="AnimationGroup",y.Mesh="Mesh",y.Material="Material",y.mK="mK",y.Light="Light"}(V||(V={}))},14075:(y,S,I)=>{"use strict";I.d(S,{e:()=>i});var V=I(14080);class i extends V.d{constructor(y,S){if(super(y),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),S)for(const I of S)this._eventsSignalOutputs[I]=this._registerSignalOutput(I+"Event")}_executeOnTick(y){}_startPendingTasks(y){y._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(y),this._resetAfterCanceled(y)),this._preparePendingTasks(y),y._addPendingBlock(this),this.out._activateSignal(y),y._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(y){y._deleteExecutionVariable(this,"_initialized"),y._removePendingBlock(this)}}},14058:(y,S,I)=>{"use strict";I.d(S,{d:()=>J});var V=I(12286),i=I(12282),A=I(14061),B=I(12133),d=I(14026);class F extends A.c{constructor(y,S,I,V){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:V.defaultValue,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(y,S,I),this.richType=V,this._defaultValue=i,this._optional=A,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new B.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(y){this._isDisabled!==y&&(this._isDisabled=y,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(y,S){S._getConnectionValue(this)!==y&&(S._setConnectionValue(this,y),this.onValueChangedObservable.notifyObservers(y))}resetToDefaultValue(y){y._setConnectionValue(this,this._defaultValue)}connectTo(y){this._isDisabled||super.connectTo(y)}_getValueOrDefault(y){const S=y._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(S):S}getValue(y){if(1===this.connectionType){y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(y);const S=this._getValueOrDefault(y);return this._lastValue=S,this.richType.typeTransformer?this.richType.typeTransformer(S):S}const S=this.isConnected()?this._connectedPoint[0].getValue(y):this._getValueOrDefault(y);return this._lastValue=S,this.richType.typeTransformer?this.richType.typeTransformer(S):S}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(y),y.richType={},this.richType.serialize(y.richType),y.optional=this._optional,(0,d.e)("defaultValue",this._defaultValue,y)}}(0,i.e)("FlowGraphDataConnection",F);class J{constructor(y){var S;this.config=y,this.uniqueId=(0,V.d)(),this.name=(null===(S=this.config)||void 0===S?void 0:S.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(y){}registerDataInput(y,S,I){const V=new F(y,0,this,S,I);return this.dataInputs.push(V),V}registerDataOutput(y,S,I){const V=new F(y,1,this,S,I);return this.dataOutputs.push(V),V}getDataInput(y){return this.dataInputs.find((S=>S.name===y))}getDataOutput(y){return this.dataOutputs.find((S=>S.name===y))}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.e;if(y.uniqueId=this.uniqueId,y.config={},this.config){const I=this.config,V=Object.keys(I);for(const i of V)S(i,I[i],y.config)}y.dataInputs=[],y.dataOutputs=[],y.className=this.getClassName();for(const I of this.dataInputs){const S={};I.serialize(S),y.dataInputs.push(S)}for(const I of this.dataOutputs){const S={};I.serialize(S),y.dataOutputs.push(S)}}deserialize(y){}_log(y,S,I){var V;null===(V=y.logger)||void 0===V||V.addLogItem({action:S,OI:I,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14061:(y,S,I)=>{"use strict";I.d(S,{c:()=>A});var V,i=I(12286);!function(y){y[y.Input=0]="Input",y[y.Output=1]="Output"}(V||(V={}));class A{constructor(y,S,I){this._ownerBlock=I,this._connectedPoint=[],this.uniqueId=(0,i.d)(),this.connectedPointIds=[],this.name=y,this._connectionType=S}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(y){if(this._connectionType===y._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||y._isSingularConnection()&&y._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(y),y._connectedPoint.push(this)}disconnectFrom(y){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const I=this._connectedPoint.indexOf(y),V=y._connectedPoint.indexOf(this);-1!==I&&-1!==V&&(S&&this._connectedPoint.splice(I,1),y._connectedPoint.splice(V,1))}disconnectFromAll(){for(const y of this._connectedPoint)this.disconnectFrom(y,!1);this._connectedPoint.length=0}dispose(){for(const y of this._connectedPoint)this.disconnectFrom(y)}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y.uniqueId=this.uniqueId,y.name=this.name,y._connectionType=this._connectionType,y.connectedPointIds=[],y.className=this.getClassName();for(const S of this._connectedPoint)y.connectedPointIds.push(S.uniqueId)}getClassName(){return"FGConnection"}deserialize(y){this.uniqueId=y.uniqueId,this.name=y.name,this._connectionType=y._connectionType,this.connectedPointIds=y.connectedPointIds}}},14018:(y,S,I)=>{"use strict";I.d(S,{d:()=>O});var V,i=I(12133),A=I(12306),B=I(12309),d=I(12286),F=I(14026),J=I(14047),u=I(12151);!function(y){y.ExecuteBlock="ExecuteBlock",y.ExecuteEvent="ExecuteEvent",y.TriggerConnection="TriggerConnection",y.ContextVariableSet="ContextVariableSet",y.GlobalVariableSet="GlobalVariableSet",y.GlobalVariableDelete="GlobalVariableDelete",y.GlobalVariableGet="GlobalVariableGet",y.AddConnection="AddConnection",y.GetConnectionValue="GetConnectionValue",y.SetConnectionValue="SetConnectionValue",y.ActivateSignal="ActivateSignal",y.ContextVariableGet="ContextVariableGet"}(V||(V={}));class K{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(y){if(y.time||(y.time=Date.now()),this.log.push(y),this.logToConsole){var S;const I=null===(S=y.OI)||void 0===S?void 0:S.value;"object"===typeof I&&I.getClassName?u.b.Log(`[FGLog] ${y.className}:${y.uniqueId.split("-")[0]} ${y.action} - ${JSON.stringify(I.getClassName())}: ${I.toString()}`):u.b.Log(`[FGLog] ${y.className}:${y.uniqueId.split("-")[0]} ${y.action} - ${JSON.stringify(y.OI)}`)}}getItemsOfType(y){return this.log.filter((S=>S.action===y))}}class G{get enableLogging(){return this._enableLogging}set enableLogging(y){this._enableLogging!==y&&(this._enableLogging=y,this._enableLogging?(this.logger=new K,this.logger.logToConsole=!0):this.logger=null)}constructor(y){this.uniqueId=(0,d.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new i.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=y,this.assetsContext=y.assetsContext??y.mI}hasVariable(y){return y in this._userVariables}setVariable(y,S){var I;this._userVariables[y]=S,null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",OI:{name:y,value:S}})}getAsset(y,S){return(0,J.c)(this.assetsContext,y,S)}getVariable(y){var S;return null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",OI:{name:y,value:this._userVariables[y]}}),this._userVariables[y]}get userVariables(){return this._userVariables}Ey(){return this._configuration.mI}_getUniqueIdPrefixedName(y,S){return`${y.uniqueId}_${S}`}_getGlobalContextVariable(y,S){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",OI:{name:y,defaultValue:S,possibleValue:this._globalContextVariables[y]}}),this._hasGlobalContextVariable(y)?this._globalContextVariables[y]:S}_setGlobalContextVariable(y,S){var I;null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",OI:{name:y,value:S}}),this._globalContextVariables[y]=S}_deleteGlobalContextVariable(y){var S;null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",OI:{name:y}}),delete this._globalContextVariables[y]}_hasGlobalContextVariable(y){return y in this._globalContextVariables}_setExecutionVariable(y,S,I){this._executionVariables[this._getUniqueIdPrefixedName(y,S)]=I}_getExecutionVariable(y,S,I){return this._hasExecutionVariable(y,S)?this._executionVariables[this._getUniqueIdPrefixedName(y,S)]:I}_deleteExecutionVariable(y,S){delete this._executionVariables[this._getUniqueIdPrefixedName(y,S)]}_hasExecutionVariable(y,S){return this._getUniqueIdPrefixedName(y,S)in this._executionVariables}_hasConnectionValue(y){return y.uniqueId in this._connectionValues}_setConnectionValue(y,S){var I;this._connectionValues[y.uniqueId]=S,null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",OI:{connectionPointId:y.uniqueId,value:S}})}_setConnectionValueByKey(y,S){this._connectionValues[y]=S}_getConnectionValue(y){var S;return null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",OI:{connectionPointId:y.uniqueId,value:this._connectionValues[y.uniqueId]}}),this._connectionValues[y.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(y){this._pendingBlocks.includes(y)||(this._pendingBlocks.push(y),this._pendingBlocks.sort(((y,S)=>y.priority-S.priority)))}_removePendingBlock(y){const S=this._pendingBlocks.indexOf(y);-1!==S&&this._pendingBlocks.splice(S,1)}_clearPendingBlocks(){for(const y of this._pendingBlocks)y._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(y){var S;this.onNodeExecutedObservable.notifyObservers(y),null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:y.getClassName(),uniqueId:y.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(y){this._setGlobalContextVariable("timeSinceStart",y.timeSinceStart),this._setGlobalContextVariable("deltaTime",y.deltaTime);for(const I of this._pendingBlocks){var S;null===(S=I._executeOnTick)||void 0===S||S.call(I,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.e;y.uniqueId=this.uniqueId,y._userVariables={};for(const V in this._userVariables)S(V,this._userVariables[V],y._userVariables);y._connectionValues={};for(const V in this._connectionValues)S(V,this._connectionValues[V],y._connectionValues);var I;this.assetsContext!==this.Ey()&&(y._assetsContext={meshes:this.assetsContext.meshes.map((y=>y.id)),materials:this.assetsContext.materials.map((y=>y.id)),textures:this.assetsContext.textures.map((y=>y.name)),animations:this.assetsContext.animations.map((y=>y.name)),lights:this.assetsContext.lights.map((y=>y.id)),cameras:this.assetsContext.cameras.map((y=>y.id)),xG:null===(I=this.assetsContext.xG)||void 0===I?void 0:I.map((y=>y.name)),skeletons:this.assetsContext.skeletons.map((y=>y.id)),dG:this.assetsContext.dG.map((y=>y.name)),geometries:this.assetsContext.geometries.map((y=>y.id)),multiMaterials:this.assetsContext.multiMaterials.map((y=>y.id)),transformNodes:this.assetsContext.transformNodes.map((y=>y.id))})}getClassName(){return"FlowGraphContext"}}(0,A.c)([(0,B.E)()],G.prototype,"uniqueId",void 0);var p=I(14053),L=I(12587);class T{constructor(y){this.onEventTriggeredObservable=new i.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=y,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.zi.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const y=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",OI:{timeSinceStart:this._startingTime,deltaTime:y}}),this._startingTime+=y})),this._meshPickedObserver=this._scene.onPointerObservable.add((y=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",OI:y})}),L.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((y=>{const S=y.pointerId,I=y.mesh,V=this._pointerUnderMeshState[S];!V&&I?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",OI:{pointerId:S,mesh:I}}):V&&!I?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",OI:{pointerId:S,mesh:V}}):V&&I&&V!==I&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",OI:{pointerId:S,mesh:V,over:I}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",OI:{pointerId:S,mesh:I,out:V}})),this._pointerUnderMeshState[S]=I}),L.d.POINTERMOVE)}dispose(){var y,S,I,V,i;null===(y=this._sceneDisposeObserver)||void 0===y||y.remove(),null===(S=this._sceneReadyObserver)||void 0===S||S.remove(),null===(I=this._sceneOnBeforeRenderObserver)||void 0===I||I.remove(),null===(V=this._meshPickedObserver)||void 0===V||V.remove(),null===(i=this._meshUnderPointerObserver)||void 0===i||i.remove(),this.onEventTriggeredObservable.clear()}}var l,j=I(14064);!function(y){y[y.Stopped=0]="Stopped",y[y.Started=1]="Started"}(l||(l={}));class s{get state(){return this._state}set state(y){this._state=y,this.onStateChangedObservable.notifyObservers(y)}constructor(y){this.onStateChangedObservable=new i.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=y.mI,this._sceneEventCoordinator=new T(this._scene),this._coordinator=y.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((y=>{for(const S of this._executionContexts){const I=this._getContextualOrder(y.type,S);for(const V of I)if(!V._executeEvent(S,y.OI))break}switch(y.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const S of this._executionContexts)S._notifyOnTick(y.OI);break;case"SceneDispose":this.dispose()}}))}createContext(){const y=new G({mI:this._scene,coordinator:this._coordinator});return this._executionContexts.push(y),y}getContext(y){return this._executionContexts[y]}addEventBlock(y){if("PointerOver"!==y.type&&"PointerOut"!==y.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==y.type&&this._eventBlocks[y.type].push(y),1===this.state)for(const S of this._executionContexts)y._startPendingTasks(S);else this.onStateChangedObservable.addOnce((S=>{if(1===S)for(const I of this._executionContexts)y._startPendingTasks(I)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((y=>{1===y&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const y of this._executionContexts)for(const S in this._eventBlocks){const I=this._getContextualOrder(S,y);for(const S of I)S._startPendingTasks(y)}}_getContextualOrder(y,S){const I=this._eventBlocks[y].sort(((y,S)=>S.initPriority-y.initPriority));if("MeshPick"===y){const y=[];for(const V of I){const i=V.asset.getValue(S);let A=0;for(;A<I.length;A++){const y=I[A].asset.getValue(S);if(i&&y&&(0,j.l)(i,y))break}y.splice(A,0,V)}return y}return I}dispose(){var y;if(0!==this.state){this.state=0;for(const y of this._executionContexts)y._clearPendingBlocks();this._executionContexts.length=0;for(const y in this._eventBlocks)this._eventBlocks[y].length=0;null===(y=this._eventObserver)||void 0===y||y.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(y){const S=[],I=new Set;for(const V in this._eventBlocks)for(const y of this._eventBlocks[V])S.push(y),I.add(y.uniqueId);for(;S.length>0;){const V=S.pop();y(V);for(const y of V.dataInputs)for(const V of y._connectedPoint)I.has(V._ownerBlock.uniqueId)||(S.push(V._ownerBlock),I.add(V._ownerBlock.uniqueId));if(V instanceof p.c)for(const y of V.signalOutputs)for(const V of y._connectedPoint)I.has(V._ownerBlock.uniqueId)||(S.push(V._ownerBlock),I.add(V._ownerBlock.uniqueId))}}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1?arguments[1]:void 0;y.allBlocks=[],this.visitAllBlocks((S=>{const I={};S.serialize(I),y.allBlocks.push(I)})),y.executionContexts=[];for(const I of this._executionContexts){const V={};I.serialize(V,S),y.executionContexts.push(V)}}}class O{constructor(y){this.config=y,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.mI.zi.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.mI.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const y=this._executeOnNextFrame.slice(0);if(y.length)for(const S of y){this.notifyCustomEvent(S.id,S.data,!1);const y=this._executeOnNextFrame.findIndex((y=>y.uniqueId===S.uniqueId));-1!==y&&this._executeOnNextFrame.splice(y,1)}}));(O.SceneCoordinators.get(this.config.mI)??[]).push(this)}createGraph(){const y=new s({mI:this.config.mI,coordinator:this});return this._flowGraphs.push(y),y}removeGraph(y){const S=this._flowGraphs.indexOf(y);-1!==S&&(y.dispose(),this._flowGraphs.splice(S,1))}start(){for(const y of this._flowGraphs)y.start()}dispose(){var y,S;for(const i of this._flowGraphs)i.dispose();this._flowGraphs.length=0,null===(y=this._disposeObserver)||void 0===y||y.remove(),null===(S=this._onBeforeRenderObserver)||void 0===S||S.remove();const I=O.SceneCoordinators.get(this.config.mI)??[],V=I.indexOf(this);-1!==V&&I.splice(V,1)}serialize(y,S){y._flowGraphs=[];for(const I of this._flowGraphs){const V={};I.serialize(V,S),y._flowGraphs.push(V)}y.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(y){let S=this._customEventsMap.get(y);return S||(S=new i.b,this._customEventsMap.set(y,S)),S}notifyCustomEvent(y,S){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:y,data:S,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(y)){const S=this._eventExecutionCounter.get(y);if(this._eventExecutionCounter.set(y,S+1),S>=O.MaxEventTypeExecutionPerFrame)return void(S===O.MaxEventTypeExecutionPerFrame&&u.b.Warn(`FlowGraphCoordinator: Too many executions of event "${y}".`))}else this._eventExecutionCounter.set(y,1);const I=this._customEventsMap.get(y);I&&I.notifyObservers(S)}}O.MaxEventsPerType=30,O.MaxEventTypeExecutionPerFrame=30,O.SceneCoordinators=new Map},14068:(y,S,I)=>{"use strict";I.d(S,{c:()=>i});var V=I(14075);class i extends V.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(y){y._notifyExecuteNode(this),this.done._activateSignal(y)}}},14053:(y,S,I)=>{"use strict";I.d(S,{c:()=>d});var V=I(14058),i=I(14061),A=I(12282);class B extends i.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(y){super.connectTo(y),this._connectedPoint.sort(((y,S)=>S.priority-y.priority))}_activateSignal(y){var S;if(null===(S=y.logger)||void 0===S||S.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,OI:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(y,this),y._increaseExecutionId();else for(const I of this._connectedPoint)I._activateSignal(y)}}(0,A.e)("FlowGraphSignalConnection",B);class d extends V.d{constructor(y){super(y),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(y){const S=new B(y,0,this);return this.signalInputs.push(S),S}_registerSignalOutput(y){const S=new B(y,1,this);return this.signalOutputs.push(S),S}_unregisterSignalInput(y){const S=this.signalInputs.findIndex((S=>S.name===y));-1!==S&&(this.signalInputs[S].dispose(),this.signalInputs.splice(S,1))}_unregisterSignalOutput(y){const S=this.signalOutputs.findIndex((S=>S.name===y));-1!==S&&(this.signalOutputs[S].dispose(),this.signalOutputs.splice(S,1))}_reportError(y,S){this.error.OI="string"===typeof S?new Error(S):S,this.error._activateSignal(y)}getSignalInput(y){return this.signalInputs.find((S=>S.name===y))}getSignalOutput(y){return this.signalOutputs.find((S=>S.name===y))}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(y),y.signalInputs=[],y.signalOutputs=[];for(const S of this.signalInputs){const I={};S.serialize(I),y.signalInputs.push(I)}for(const S of this.signalOutputs){const I={};S.serialize(I),y.signalOutputs.push(I)}}deserialize(y){for(let S=0;S<y.signalInputs.length;S++){const I=this.getSignalInput(y.signalInputs[S].name);if(!I)throw new Error("Could not find signal input with name "+y.signalInputs[S].name+" in block "+y.className);I.deserialize(y.signalInputs[S])}for(let S=0;S<y.signalOutputs.length;S++){const I=this.getSignalOutput(y.signalOutputs[S].name);if(!I)throw new Error("Could not find signal output with name "+y.signalOutputs[S].name+" in block "+y.className);I.deserialize(y.signalOutputs[S])}}getClassName(){return"FlowGraphExecutionBlock"}}},14080:(y,S,I)=>{"use strict";I.d(S,{d:()=>i});var V=I(14053);class i extends V.c{constructor(y){super(y),this.out=this._registerSignalOutput("out")}}},14033:(y,S,I)=>{"use strict";I.d(S,{A:()=>u,B:()=>p,C:()=>L,E:()=>T,F:()=>E,H:()=>z,I:()=>o,L:()=>D,c:()=>J,f:()=>G,i:()=>C,k:()=>l,o:()=>j,q:()=>s,t:()=>K,x:()=>my});var V,i=I(12321),A=I(12362),B=I(14029),d=I(14038);!function(y){y.Any="any",y.String="string",y.Number="number",y.Boolean="boolean",y.Object="object",y.Integer="FlowGraphInteger",y.Vector2="Vector2",y.OS="OS",y.Vector4="Vector4",y.Quaternion="Quaternion",y.Matrix="Matrix",y.Matrix2D="Matrix2D",y.Matrix3D="Matrix3D",y.DS="DS",y.vd="vd"}(V||(V={}));class F{constructor(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=y,this.defaultValue=S,this.animationType=I}serialize(y){y.typeName=this.typeName,y.defaultValue=this.defaultValue}}const J=new F("any",void 0),u=new F("string",""),K=new F("number",0,0),G=new F("boolean",!1),p=new F("Vector2",i.Vector2.Zero(),5),L=new F("OS",i.OS.Zero(),1),T=new F("Vector4",i.Vector4.Zero()),l=new F("Matrix",i.Matrix.Identity(),3),j=new F("Matrix2D",new d.b),s=new F("Matrix3D",new d.c),O=new F("DS",A.DS.Black(),4),f=new F("vd",new A.vd(0,0,0,0),7),my=new F("Quaternion",i.Quaternion.Identity(),2);my.typeTransformer=y=>{if(y.getClassName){if("Vector4"===y.getClassName())return i.Quaternion.oS(y.Vd());if("OS"===y.getClassName())return i.Quaternion.FromEulerVector(y);if("Matrix"===y.getClassName())return i.Quaternion.FromRotationMatrix(y)}return y};const C=new F("FlowGraphInteger",new B.c(0),0);function D(y){const S=y;switch(typeof y){case"string":return u;case"number":return K;case"boolean":return G;case"object":if(S.getClassName)switch(S.getClassName()){case"Vector2":return p;case"OS":return L;case"Vector4":return T;case"Matrix":return l;case"DS":return O;case"vd":return f;case"Quaternion":return my;case"FlowGraphInteger":return C;case"Matrix2D":return j;case"Matrix3D":return s}return J;default:return J}}function o(y){switch(y){case"string":return u;case"number":return K;case"boolean":return G;case"Vector2":return p;case"OS":return L;case"Vector4":return T;case"Matrix":return l;case"DS":return O;case"vd":return f;case"Quaternion":return my;case"FlowGraphInteger":return C;case"Matrix2D":return j;case"Matrix3D":return s;default:return J}}function E(y){switch(y){case"number":default:return 0;case"Vector2":return 5;case"OS":return 1;case"Matrix":return 3;case"DS":return 4;case"vd":return 7;case"Quaternion":return 2}}function z(y){switch(y){case 0:return K;case 5:return p;case 1:return L;case 3:return l;case 4:return O;case 7:return f;case 2:return my;default:return J}}},14026:(y,S,I)=>{"use strict";I.d(S,{b:()=>u,e:()=>J,f:()=>K});var V=I(12362),i=I(12321),A=I(14029),B=I(14033),d=I(14038);function F(y){return"Vector2"===y||"OS"===y||"Vector4"===y||"Quaternion"===y||"DS"===y||"vd"===y}function J(y,S,I){var V;const i=(null===S||void 0===S||null===(V=S.getClassName)||void 0===V?void 0:V.call(S))??"";if(F(i)||function(y){return"Matrix"===y||"Matrix2D"===y||"Matrix3D"===y}(i))I[y]={value:S.Vd(),className:i};else if("FlowGraphInteger"===i)I[y]={value:S.value,className:i};else if(i&&(S.id||S.name))I[y]={id:S.id,name:S.name,className:i};else{if("object"===typeof S)throw new Error(`Could not serialize value ${S}`);I[y]=S}}function u(y,S,I,J){const K=S[y];let G;const p=(null===K||void 0===K?void 0:K.type)??(null===K||void 0===K?void 0:K.className);if(function(y){return"Mesh"===y||"AbstractMesh"===y||"GroundMesh"===y||"InstanceMesh"===y||"LinesMesh"===y||"GoldbergMesh"===y||"GreasedLineMesh"===y||"TrailMesh"===y}(p)){let y=J.meshes.filter((y=>K.id?y.id===K.id:y.name===K.name));0===y.length&&(y=J.transformNodes.filter((y=>K.id?y.id===K.id:y.name===K.name))),G=K.uniqueId?y.find((y=>y.uniqueId===K.uniqueId)):y[0]}else if(F(p))G=function(y,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===y)return i.Vector2.oS(S);if("OS"===y)return I&&(S[2]*=-1),i.OS.oS(S);if("Vector4"===y)return i.Vector4.oS(S);if("Quaternion"===y)return I&&(S[2]*=-1,S[3]*=-1),i.Quaternion.oS(S);if("DS"===y)return new V.DS(S[0],S[1],S[2]);if("vd"===y)return new V.vd(S[0],S[1],S[2],S[3]);throw new Error(`Unknown vector class name ${y}`)}(p,K.value);else if(function(y){return"AnimationGroup"===y}(p)){const y=J.animationGroups.filter((y=>y.name===K.name));G=1===y.length?y[0]:y.find((y=>y.uniqueId===K.uniqueId))}else G="Matrix"===p?i.Matrix.oS(K.value):"Matrix2D"===p?new d.b(K.value):"Matrix3D"===p?new d.c(K.value):"FlowGraphInteger"===p?A.c.FromValue(K.value):"number"===p||"string"===p||"boolean"===p?K.value[0]:K&&void 0!==K.value?K.value:Array.isArray(K)?K.reduce(((y,S)=>S.eventData?(y[S.id]={type:(0,B.I)(S.type)},"undefined"!==typeof S.value&&(y[S.id].value=u("value",S,I,J)),y):y),{}):K;return G}function K(y){return"FlowGraphJsonPointerParserBlock"===y}},14064:(y,S,I)=>{"use strict";function V(y,S){return!(!y.parent||y.parent!==S&&!V(y.parent,S))}function i(y){if(y.getClassName)return y.getClassName()}function A(y,S){return y===S&&("Vector2"===y||"OS"===y||"Vector4"===y||"Quaternion"===y)}function B(y,S){return y===S&&("Matrix"===y||"Matrix2D"===y||"Matrix3D"===y)}function d(y,S){return"FlowGraphInteger"===y&&"FlowGraphInteger"===S}function F(y,S){const I="number"===typeof y||"number"===typeof(null===y||void 0===y?void 0:y.value);return I&&!S?!isNaN(J(y)):I}function J(y){return"number"===typeof y?y:y.value}I.d(S,{c:()=>d,d:()=>B,h:()=>A,j:()=>i,l:()=>V,p:()=>J,q:()=>F})},13408:(y,S,I)=>{"use strict";I.r(S),I.d(S,{SceneInstrumentation:()=>A});var V=I(12128),i=I(12540);class A{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(y){y!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=y,y?(this._onBeforeActiveMeshesEvaluationObserver=this.mI.onBeforeActiveMeshesEvaluationObservable.add((()=>{V.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.mI.onAfterActiveMeshesEvaluationObservable.add((()=>{V.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.mI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.mI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(y){y!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=y,y?(this._onBeforeRenderTargetsRenderObserver=this.mI.onBeforeRenderTargetsRenderObservable.add((()=>{V.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.mI.onAfterRenderTargetsRenderObservable.add((()=>{V.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.mI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.mI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(y){y!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=y,y?(this._onBeforeParticlesRenderingObserver=this.mI.onBeforeParticlesRenderingObservable.add((()=>{V.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.mI.onAfterParticlesRenderingObservable.add((()=>{V.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.mI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.mI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(y){y!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=y,this.mI.spriteManagers&&(y?(this._onBeforeSpritesRenderingObserver=this.mI.onBeforeSpritesRenderingObservable.add((()=>{V.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.mI.onAfterSpritesRenderingObservable.add((()=>{V.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.mI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.mI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(y){y!==this._capturePhysicsTime&&this.mI.onBeforePhysicsObservable&&(this._capturePhysicsTime=y,y?(this._onBeforePhysicsObserver=this.mI.onBeforePhysicsObservable.add((()=>{V.Tools.StartPerformanceCounter("ST"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.mI.onAfterPhysicsObservable.add((()=>{V.Tools.EndPerformanceCounter("ST"),this._physicsTime.endMonitoring()}))):(this.mI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.mI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(y){y!==this._captureAnimationsTime&&(this._captureAnimationsTime=y,y?this._onAfterAnimationsObserver=this.mI.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.mI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(y){this._captureFrameTime=y}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(y){this._captureInterFrameTime=y}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(y){y!==this._captureRenderTime&&(this._captureRenderTime=y,y?(this._onBeforeDrawPhaseObserver=this.mI.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),V.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.mI.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),V.Tools.EndPerformanceCounter("Main render")}))):(this.mI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.mI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(y){y!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=y,y?(this._onBeforeCameraRenderObserver=this.mI.onBeforeCameraRenderObservable.add((y=>{this._cameraRenderTime.beginMonitoring(),V.Tools.StartPerformanceCounter(`Rendering camera ${y.name}`)})),this._onAfterCameraRenderObserver=this.mI.onAfterCameraRenderObservable.add((y=>{this._cameraRenderTime.endMonitoring(!1),V.Tools.EndPerformanceCounter(`Rendering camera ${y.name}`)}))):(this.mI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.mI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.mI.getEngine()._drawCalls}constructor(y){this.mI=y,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new i.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new i.b,this._captureFrameTime=!1,this._frameTime=new i.b,this._captureRenderTime=!1,this._renderTime=new i.b,this._captureInterFrameTime=!1,this._interFrameTime=new i.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new i.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new i.b,this._capturePhysicsTime=!1,this._physicsTime=new i.b,this._captureAnimationsTime=!1,this._animationsTime=new i.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new i.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=y.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(V.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.mI.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=y.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(V.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.oi(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.oi(),this._captureParticlesRenderTime&&this._particlesRenderTime.oi(),this._captureSpritesRenderTime&&this._spritesRenderTime.oi(),this._captureRenderTime&&this._renderTime.oi(),this._captureCameraRenderTime&&this._cameraRenderTime.oi()}))}dispose(){this._disposed||(this.mI.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.mI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.mI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.mI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.mI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.mI.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.mI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.mI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.mI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.mI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.mI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.mI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.mI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.mI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.mI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.mI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.mI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.mI=null,this._disposed=!0)}}},14010:(y,S,I)=>{"use strict";I.d(S,{b:()=>u});var V=I(12306),i=I(12309),A=I(12321),B=I(12725),d=I(12857),F=I(12919),J=I(12282);B.b.AddNodeConstructor("Light_Type_1",((y,S)=>()=>new u(y,A.OS.Zero(),S)));class u extends F.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(y){this._shadowFrustumSize=y,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(y){this._shadowOrthoScale=y,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(y){this._orthoLeft=y}get orthoRight(){return this._orthoRight}set orthoRight(y){this._orthoRight=y}get orthoTop(){return this._orthoTop}set orthoTop(y){this._orthoTop=y}get orthoBottom(){return this._orthoBottom}set orthoBottom(y){this._orthoBottom=y}constructor(y,S,I){super(y,I),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=S.scale(-1),this.direction=S}getClassName(){return"IT"}getTypeID(){return d.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(y,S,I){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(y):this._setDefaultAutoExtendShadowProjectionMatrix(y,S,I)}_setDefaultFixedFrustumShadowProjectionMatrix(y){const S=this.Ey().activeCamera;S&&A.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:S.Ld,void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,y,this.Ey().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(y,S,I){const V=this.Ey().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const y=A.OS.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let V=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let B=0;B<I.length;B++){const d=I[B];if(!d)continue;const F=d.getBoundingInfo().boundingBox;for(let I=0;I<F.vectorsWorld.length;I++)A.OS.TransformCoordinatesToRef(F.vectorsWorld[I],S,y),y.x<this._orthoLeft&&(this._orthoLeft=y.x),y.y<this._orthoBottom&&(this._orthoBottom=y.y),y.x>this._orthoRight&&(this._orthoRight=y.x),y.y>this._orthoTop&&(this._orthoTop=y.y),this.autoCalcShadowZBounds&&(y.z<V&&(V=y.z),y.z>i&&(i=y.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=V,this._shadowMaxZ=i)}const i=this._orthoRight-this._orthoLeft,B=this._orthoTop-this._orthoBottom,d=void 0!==this.shadowMinZ?this.shadowMinZ:(null===V||void 0===V?void 0:V.Ld)||0,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===V||void 0===V?void 0:V.maxZ)||1e4,J=this.Ey().getEngine().si;A.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-i*this.shadowOrthoScale,this._orthoRight+i*this.shadowOrthoScale,this._orthoBottom-B*this.shadowOrthoScale,this._orthoTop+B*this.shadowOrthoScale,J?F:d,J?d:F,y,this.Ey().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(y,S){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,S),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,S),this)}transferToNodeMaterialEffect(y,S){return this.computeTransformedInformation()?(y.setFloat3(S,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(y.setFloat3(S,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(y){const S=this._scene.getEngine();return!S.si&&S.isNDCHalfZRange?0:1}getDepthMaxZ(y){const S=this._scene.getEngine();return S.si&&S.isNDCHalfZRange?0:1}prepareLightSpecificDefines(y,S){y["DIRLIGHT"+S]=!0}}(0,V.c)([(0,i.E)()],u.prototype,"shadowFrustumSize",null),(0,V.c)([(0,i.E)()],u.prototype,"shadowOrthoScale",null),(0,V.c)([(0,i.E)()],u.prototype,"autoUpdateExtends",void 0),(0,V.c)([(0,i.E)()],u.prototype,"autoCalcShadowZBounds",void 0),(0,V.c)([(0,i.E)("orthoLeft")],u.prototype,"_orthoLeft",void 0),(0,V.c)([(0,i.E)("orthoRight")],u.prototype,"_orthoRight",void 0),(0,V.c)([(0,i.E)("orthoTop")],u.prototype,"_orthoTop",void 0),(0,V.c)([(0,i.E)("orthoBottom")],u.prototype,"_orthoBottom",void 0),(0,J.e)("BABYLON.DirectionalLight",u)},14508:(y,S,I)=>{"use strict";I.d(S,{b:()=>u});var V=I(12306),i=I(12309),A=I(12321),B=I(12362),d=I(12725),F=I(12857),J=I(12282);d.b.AddNodeConstructor("Light_Type_3",((y,S)=>()=>new u(y,A.OS.Zero(),S)));class u extends F.e{constructor(y,S,I){super(y,I),this.groundColor=new B.DS(0,0,0),this.direction=S||A.OS.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"VT"}setDirectionToTarget(y){return this.direction=A.OS.Normalize(y.fS(A.OS.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(y,S){const I=A.OS.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",I.x,I.y,I.z,0,S),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Rd),S),this}transferToNodeMaterialEffect(y,S){const I=A.OS.Normalize(this.direction);return y.setFloat3(S,I.x,I.y,I.z),this}sd(){return this._worldMatrix||(this._worldMatrix=A.Matrix.Identity()),this._worldMatrix}getTypeID(){return F.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(y,S){y["HEMILIGHT"+S]=!0}}(0,V.c)([(0,i.h)()],u.prototype,"groundColor",void 0),(0,V.c)([(0,i.D)()],u.prototype,"direction",void 0),(0,J.e)("BABYLON.HemisphericLight",u)},13986:(y,S,I)=>{"use strict";I.d(S,{b:()=>K});var V=I(12306),i=I(12309),A=I(12321),B=I(12725),d=I(12857),F=I(12919),J=I(12304),u=I(12282);B.b.AddNodeConstructor("Light_Type_2",((y,S)=>()=>new K(y,A.OS.Zero(),A.OS.Zero(),0,0,S)));class K extends F.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(y){this._iesProfileTexture!==y&&(this._iesProfileTexture=y,this._iesProfileTexture&&K._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(y){this._angle=y,this._cosHalfAngle=Math.cos(.5*y),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(y){this._innerAngle=y,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(y){this._shadowAngleScale=y,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(y){this._projectionTextureLightNear=y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(y){this._projectionTextureLightFar=y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(y){this._projectionTextureUpDirection=y,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(y){this._projectionTexture!==y&&(this._projectionTexture=y,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(K._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):K._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(y){return void 0!==y.onGeneratedObservable}static _IsTexture(y){return void 0!==y.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(y){this._projectionTextureProjectionLightMatrix=y,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(y,S,I,V,i,B){super(y,B),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=A.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=A.OS.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=A.OS.Zero(),this._projectionTextureViewLightMatrix=A.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=A.Matrix.Zero(),this._projectionTextureScalingMatrix=A.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=S,this.direction=I,this.angle=V,this.exponent=i}getClassName(){return"SpotLight"}getTypeID(){return d.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(y){super._setDirection(y),this._projectionTextureViewLightDirty=!0}_setPosition(y){super._setPosition(y),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(y,S,I){const V=this.Ey().activeCamera;if(!V)return;this._shadowAngleScale=this._shadowAngleScale||1;const i=this._shadowAngleScale*this._angle,B=void 0!==this.shadowMinZ?this.shadowMinZ:V.Ld,d=void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ,F=this.Ey().getEngine().si;A.Matrix.PerspectiveFovLHToRef(i,1,F?d:B,F?B:d,y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,F)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),A.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const y=this.projectionTextureLightFar,S=this.projectionTextureLightNear,I=y/(y-S),V=-I*S,i=1/Math.tan(this._angle/2);A.Matrix.FromValuesToRef(i/1,0,0,0,0,i,0,0,0,0,I,1,0,0,V,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof J.e){const y=this._projectionTexture.uScale/2,S=this._projectionTexture.vScale/2;A.Matrix.FromValuesToRef(y,0,0,0,0,S,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(y,S){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),y.setMatrix("textureProjectionMatrix"+S,this._projectionTextureMatrix),y.setTexture("projectionLightTexture"+S,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&y.setTexture("iesLightTexture"+S,this._iesProfileTexture),this}transferToEffect(y,S){let I;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,S),I=A.OS.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,S),I=A.OS.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",I.x,I.y,I.z,this._cosHalfAngle,S),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,S),this}transferToNodeMaterialEffect(y,S){let I;return I=this.computeTransformedInformation()?A.OS.Normalize(this.transformedDirection):A.OS.Normalize(this.direction),this.Ey().useRightHandedSystem?y.setFloat3(S,-I.x,-I.y,-I.z):y.setFloat3(S,I.x,I.y,I.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(y){const S=this._scene.getEngine(),I=void 0!==this.shadowMinZ?this.shadowMinZ:(null===y||void 0===y?void 0:y.Ld)??0;return S.si&&S.isNDCHalfZRange?I:this._scene.getEngine().isNDCHalfZRange?0:I}getDepthMaxZ(y){const S=this._scene.getEngine(),I=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===y||void 0===y?void 0:y.maxZ)??1e4;return S.si&&S.isNDCHalfZRange?0:I}prepareLightSpecificDefines(y,S){y["SPOTLIGHT"+S]=!0,y["PROJECTEDLIGHTTEXTURE"+S]=!(!this.projectionTexture||!this.projectionTexture.isReady()),y["IESLIGHTTEXTURE"+S]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,V.c)([(0,i.E)()],K.prototype,"angle",null),(0,V.c)([(0,i.E)()],K.prototype,"innerAngle",null),(0,V.c)([(0,i.E)()],K.prototype,"shadowAngleScale",null),(0,V.c)([(0,i.E)()],K.prototype,"exponent",void 0),(0,V.c)([(0,i.E)()],K.prototype,"projectionTextureLightNear",null),(0,V.c)([(0,i.E)()],K.prototype,"projectionTextureLightFar",null),(0,V.c)([(0,i.E)()],K.prototype,"projectionTextureUpDirection",null),(0,V.c)([(0,i.y)("projectedLightTexture")],K.prototype,"_projectionTexture",void 0),(0,u.e)("BABYLON.SpotLight",K)},13711:(y,S,I)=>{"use strict";I.d(S,{b:()=>B,f:()=>A,j:()=>d});const V={},i={};function A(y,S){V[y]=S}function B(y,S){i[y]=S}function d(y){return i[y]?i[y]:null}},13608:(y,S,I)=>{"use strict";I.d(S,{e:()=>D,i:()=>k});var V,i=I(12128),A=I(12133),B=I(12556),d=I(12185),F=I(12151),J=I(12768),u=I(12193),K=I(12197),G=I(12286),p=I(12223),L=I(12177);!function(y){y[y.Clean=0]="Clean",y[y.Stop=1]="Stop",y[y.Sync=2]="Sync",y[y.NoSync=3]="NoSync"}(V||(V={}));const T=new A.b,l={};let j=!1;function s(){return l[".babylon"]}function O(y,S){const I=l[y];return I||(F.b.Warn("Unable to find a plugin to load "+y+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),S?s():void 0)}function f(y,S,I){let V="Unable to load from "+(y.rawData?"binary data":y.url);return S?V+=`: ${S}`:I&&(V+=`: ${I}`),V}async function my(y,S,I,V,i,A,B,d,F){var J;const K="data:"===(G=y.url).substring(0,5)?G.substring(5):null;var G;if(y.rawData&&!B)throw"When using ArrayBufferView to load data the file extension must be provided.";const j=K||B?"":function(y){const S=y.indexOf("?");-1!==S&&(y=y.substring(0,S));const I=y.lastIndexOf(".");return y.substring(I,y.length).toLowerCase()}(y.url);let f=B?O(B,!0):K?function(y){for(const S in l){const I=l[S].plugin;if(I.canDirectLoad&&I.canDirectLoad(y))return l[S]}return s()}(y.url):O(j,!1);if(!f&&j){if(y.url&&!y.url.startsWith("blob:")){const S=await async function(y,S){const I=S.method||"GET";return await new Promise(((V,i)=>{const A=new L.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const y={};if(S.responseHeaders)for(const I of S.responseHeaders)y[I]=A.getResponseHeader(I)||"";V({response:A.response,headerValues:y})}else i(`Unable to fetch data from ${y}. Error code: ${A.status}`)})),A.open(I,y),A.send()}))}(y.url,{method:"HEAD",responseHeaders:["Content-Type"]}),I=S.headerValues?S.headerValues["Content-Type"]:"";I&&(f=function(y){for(const S in l){const I=l[S];if(I.mimeType===y)return I}}(I))}f||(f=s())}if(!f)throw new Error(`No plugin or fallback for ${B??y.url}`);if(!1===(null===F||void 0===F||null===(J=F[f.plugin.name])||void 0===J?void 0:J.enabled))throw new Error(`The '${f.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(y.rawData&&!f.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(y=>{if(f.plugin.createPlugin){const S=f.plugin.createPlugin(F??{});return S instanceof Promise?(S.then(y).catch((y=>{i("Error instantiating plugin.",y)})),null):(y(S),S)}return y(f.plugin),f.plugin})((F=>{var J;if(!F)throw`The loader plugin corresponding to the '${B}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(T.notifyObservers(F),K&&(F.canDirectLoad&&F.canDirectLoad(y.url)||!(0,u.l)(y.url))){if(F.directLoad){const y=F.directLoad(S,K);y instanceof Promise?y.then((y=>{I(F,y)})).catch((y=>{i("Error in directLoad of _loadData: "+y,y)})):I(F,y)}else I(F,K);return}const G=f.isBinary,L=(y,V)=>{S.J?i("Scene has been disposed"):I(F,y,V)};let l=null,j=!1;null===(J=F.zi)||void 0===J||J.add((()=>{j=!0,l&&(l.abort(),l=null),A()}));const s=()=>{if(j)return;const I=(y,S)=>{i(null===y||void 0===y?void 0:y.statusText,S)};if(!F.loadFile&&y.rawData)throw"Plugin does not support loading ArrayBufferView.";l=F.loadFile?F.loadFile(S,y.rawData||y.file||y.url,y.rootUrl,L,V,G,I,d):S._loadFile(y.file||y.url,L,V,!0,G,I)},O=S.getEngine();let my=O.enableOfflineSupport;if(my){let I=!1;for(const V of S.disableOfflineSupportExceptionRules)if(V.test(y.url)){I=!0;break}my=!I}my&&p.c.OfflineProviderFactory?S.offlineProvider=p.c.OfflineProviderFactory(y.url,s,O.disableManifestCheck):s()}))}function C(y,S){let I,V,A=null,B=null;if(S)if(S.name)I=`file:${S.name}`,V=S.name,A=S;else if(ArrayBuffer.isView(S))I="",V=(0,G.d)(),B=S;else if(S.startsWith("data:"))I=S,V="";else if(y){const A=S;if("/"===A.substring(0,1))return i.Tools.Error("Wrong sceneFilename parameter"),null;I=y+A,V=A}else I=S,V=i.Tools.GetFilename(S),y=i.Tools.GetFolderPath(S);else I=y,V=i.Tools.GetFilename(y),y=i.Tools.GetFolderPath(y);return{url:I,rootUrl:y,name:V,file:A,rawData:B}}function D(y){if("string"===typeof y.extensions){const S=y.extensions;l[S.toLowerCase()]={plugin:y,isBinary:!1}}else{const S=y.extensions,I=Object.keys(S);for(const V of I)l[V.toLowerCase()]={plugin:y,isBinary:S[V].isBinary,mimeType:S[V].mimeType}}}async function o(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.e.LastCreatedScene,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!V)return F.b.Error("No scene available to import mesh to"),null;const p=C(S,I);if(!p)return null;const L={};V.addPendingData(L);const T=()=>{V.removePendingData(L)},l=(y,S)=>{const I=f(p,y,S);B?B(V,I,new K.k(I,K.g.SceneLoaderError,S)):F.b.Error(I),T()},j=A?y=>{try{A(y)}catch(S){l("Error in onProgress callback: "+S,S)}}:void 0,s=(y,S,I,A,B,d,F,J)=>{if(V.importedMeshesFiles.push(p.url),i)try{i(y,S,I,A,B,d,F,J)}catch(u){l("Error in onSuccess callback: "+u,u)}V.removePendingData(L)};return await my(p,V,((S,I,i)=>{if(S.rewriteRootURL&&(p.rootUrl=S.rewriteRootURL(p.rootUrl,i)),S.importMesh){const i=[],A=[],B=[];if(!S.importMesh(y,V,I,p.rootUrl,i,A,B,l))return;V.loadingPluginName=S.name,s(i,A,B,[],[],[],[],[])}else{S.importMeshAsync(y,V,I,p.rootUrl,j,p.name).then((y=>{V.loadingPluginName=S.name,s(y.meshes,y.dG,y.skeletons,y.animationGroups,y.transformNodes,y.geometries,y.lights,y.spriteManagers)})).catch((y=>{l(y.message,y)}))}}),j,l,T,J,u,G)}async function E(y,S,I,V,i,A,B,d){return await new Promise(((F,J)=>{try{o(y,S,I,V,((y,S,I,V,i,A,B,d)=>{F({meshes:y,dG:S,skeletons:I,animationGroups:V,transformNodes:i,geometries:A,lights:B,spriteManagers:d})}),i,((y,S,I)=>{J(I||new Error(S))}),A,B,d).catch(J)}catch(K){J(K)}}))}async function z(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.e.LastCreatedEngine,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};I?await h(y,S,new B.e(I),V,A,F,J,u,K):i.Tools.Error("No engine available")}async function r(y,S,I,V,i,A,B){return await new Promise(((d,F)=>{z(y,S,I,(y=>{d(y)}),V,((y,S,I)=>{F(I||new Error(S))}),i,A,B)}))}async function h(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.e.LastCreatedScene,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!I)return F.b.Error("No scene available to append to"),null;const p=C(y,S);if(!p)return null;const L={};I.addPendingData(L);const T=()=>{I.removePendingData(L)};J.e.ShowLoadingScreen&&!j&&(j=!0,I.getEngine().displayLoadingUI(),I.executeWhenReady((()=>{I.getEngine().hideLoadingUI(),j=!1})));const l=(y,S)=>{const V=f(p,y,S);A?A(I,V,new K.k(V,K.g.SceneLoaderError,S)):F.b.Error(V),T()},s=i?y=>{try{i(y)}catch(S){l("Error in onProgress callback",S)}}:void 0,O=()=>{if(V)try{V(I)}catch(y){l("Error in onSuccess callback",y)}I.removePendingData(L)};return await my(p,I,((y,S)=>{if(y.load){if(!y.load(I,S,p.rootUrl,l))return;I.loadingPluginName=y.name,O()}else{y.loadAsync(I,S,p.rootUrl,s,p.name).then((()=>{I.loadingPluginName=y.name,O()})).catch((y=>{l(y.message,y)}))}}),s,l,T,B,u,G)}async function n(y,S,I,V,i,A,B){return await new Promise(((d,F)=>{try{h(y,S,I,(y=>{d(y)}),V,((y,S,I)=>{F(I||new Error(S))}),i,A,B).catch(F)}catch(K){F(K)}}))}async function v(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.e.LastCreatedScene,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!I)return F.b.Error("No scene available to load asset container to"),null;const G=C(y,S);if(!G)return null;const p={};I.addPendingData(p);const L=()=>{I.removePendingData(p)},T=(y,S)=>{const V=f(G,y,S);A?A(I,V,new K.k(V,K.g.SceneLoaderError,S)):F.b.Error(V),L()},l=i?y=>{try{i(y)}catch(S){T("Error in onProgress callback",S)}}:void 0,j=y=>{if(V)try{V(y)}catch(S){T("Error in onSuccess callback",S)}I.removePendingData(p)};return await my(G,I,((y,S)=>{if(y.loadAssetContainer){const V=y.loadAssetContainer(I,S,G.rootUrl,T);if(!V)return;V.populateRootNodes(),I.loadingPluginName=y.name,j(V)}else if(y.loadAssetContainerAsync){y.loadAssetContainerAsync(I,S,G.rootUrl,l,G.name).then((S=>{S.populateRootNodes(),I.loadingPluginName=y.name,j(S)})).catch((y=>{T(y.message,y)}))}else T("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),l,T,L,B,J,u)}async function P(y,S,I,V,i,A,B){return await new Promise(((d,F)=>{try{v(y,S,I,(y=>{d(y)}),V,((y,S,I)=>{F(I||new Error(S))}),i,A,B).catch(F)}catch(K){F(K)}}))}async function q(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.e.LastCreatedScene,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,G=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!I)return void F.b.Error("No scene available to load animations to");if(V){for(const V of I.animatables)V.reset();I.stopAllAnimations();const y=I.animationGroups.slice();for(const I of y)I.dispose();const S=I.getNodes();for(const I of S)I.animations&&(I.animations=[])}else switch(i){case 0:const y=I.animationGroups.slice();for(const S of y)S.dispose();break;case 1:for(const S of I.animationGroups)S.stop();break;case 2:for(const S of I.animationGroups)S.reset(),S.restart();break;case 3:break;default:return void F.b.Error("Unknown animation group loading mode value '"+i+"'")}const L=I.animatables.length;await v(y,S,I,(y=>{y.mergeAnimationsTo(I,I.animatables.slice(L),A),y.dispose(),I.onAnimationFileImportedObservable.notifyObservers(I),B&&B(I)}),J,u,K,G,p)}async function g(y,S,I,V,i,A,B,d,F,J){return await new Promise(((u,G)=>{try{q(y,S,I,V,i,A,(y=>{u(y)}),B,((y,S,I)=>{G(I||new Error(S))}),d,F,J).catch(G)}catch(K){G(K)}}))}class k{static get ForceFullSceneLoadingForIncremental(){return J.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(y){J.e.ForceFullSceneLoadingForIncremental=y}static get ShowLoadingScreen(){return J.e.ShowLoadingScreen}static set ShowLoadingScreen(y){J.e.ShowLoadingScreen=y}static get loggingLevel(){return J.e.loggingLevel}static set loggingLevel(y){J.e.loggingLevel=y}static get CleanBoneMatrixWeights(){return J.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(y){J.e.CleanBoneMatrixWeights=y}static GetDefaultPlugin(){return s()}static GetPluginForExtension(y){var S;return null===(S=O(y,!0))||void 0===S?void 0:S.plugin}static IsPluginForExtensionAvailable(y){return function(y){return!!l[y]}(y)}static RegisterPlugin(y){D(y)}static ImportMesh(y,S,I,V,i,A,B,F,J){o(y,S,I,V,i,A,B,F,J).catch((y=>null===B||void 0===B?void 0:B(d.e.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async ImportMeshAsync(y,S,I,V,i,A,B){return await E(y,S,I,V,i,A,B)}static Load(y,S,I,V,i,A,B,F){z(y,S,I,V,i,A,B,F).catch((y=>null===A||void 0===A?void 0:A(d.e.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async LoadAsync(y,S,I,V,i,A){return await r(y,S,I,V,i,A)}static Append(y,S,I,V,i,A,B,F){h(y,S,I,V,i,A,B,F).catch((y=>null===A||void 0===A?void 0:A(I??d.e.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async AppendAsync(y,S,I,V,i,A){return await n(y,S,I,V,i,A)}static LoadAssetContainer(y,S,I,V,i,A,B,F){v(y,S,I,V,i,A,B,F).catch((y=>null===A||void 0===A?void 0:A(I??d.e.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async LoadAssetContainerAsync(y,S,I,V,i,A){return await P(y,S,I,V,i,A)}static ImportAnimations(y,S,I,V,i,A,B,F,J,u,K){q(y,S,I,V,i,A,B,F,J,u,K).catch((y=>null===J||void 0===J?void 0:J(I??d.e.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async ImportAnimationsAsync(y,S,I,V,i,A,B,d,F,J,u){return await g(y,S,I,V,i,A,d,J,u)}}k.NO_LOGGING=0,k.MINIMAL_LOGGING=1,k.SUMMARY_LOGGING=2,k.DETAILED_LOGGING=3,k.OnPluginActivatedObservable=T},13999:(y,S,I)=>{"use strict";I.d(S,{d:()=>G});var V=I(12306),i=I(12309),A=I(12128),B=I(12321),d=I(12340),F=I(12304),J=I(12282),u=I(12133),K=I(12352);I(14001);class G extends d.b{set boundingBoxSize(y){if(this._boundingBoxSize&&this._boundingBoxSize.equals(y))return;this._boundingBoxSize=y;const S=this.Ey();S&&S.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(y){this._rotationY=y,this.setReflectionTextureMatrix(B.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(y,S,I){let V="";for(const i of y)V+=i;return new G(V,S,null,I,y)}static CreateFromPrefilteredData(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=S.useDelayedTextureLoading;S.useDelayedTextureLoading=!1;const A=new G(y,S,null,!1,null,null,null,void 0,!0,I,V);return S.useDelayedTextureLoading=i,A}constructor(y,S){var I;let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,G=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,L=arguments.length>10&&void 0!==arguments[10]&&arguments[10],T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,l=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,j=arguments.length>13?arguments[13]:void 0,s=arguments.length>14?arguments[14]:void 0;super(S),this.onLoadObservable=new u.b,this.boundingBoxPosition=B.OS.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new B.Matrix,this._buffer=null,this.name=y,this.url=y,this._noMipmap=i,this.Fd=!1,this.isCube=!0,this._textureMatrix=B.Matrix.Identity(),this.coordinatesMode=F.e.CUBIC_MODE;let O=null,f=null;null===V||Array.isArray(V)?(this._noMipmap=i,this._format=K,this._createPolynomials=L,O=V,this._loaderOptions=j,this._useSRGBBuffer=s,this._lodScale=T,this._lodOffset=l):(O=V.extensions??null,this._noMipmap=V.noMipmap??!1,A=V.files??null,f=V.buffer??null,this._format=V.format??5,G=V.prefiltered??!1,p=V.forcedExtension??null,this._createPolynomials=V.createPolynomials??!1,this._lodScale=V.lodScale??.8,this._lodOffset=V.lodOffset??0,this._loaderOptions=V.loaderOptions,this._useSRGBBuffer=V.useSRGBBuffer,d=V.Y??null,J=V.onError??null),(y||A)&&this.updateURL(y,p,d,G,J,O,null===(I=this.Ey())||void 0===I?void 0:I.useDelayedTextureLoading,A,f)}getClassName(){return"CubeTexture"}updateURL(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=y),this.url=y,S&&(this._forcedExtension=S);const J=y.lastIndexOf("."),u=S||(J>-1?y.substring(J).toLowerCase():""),K=0===u.indexOf(".dds"),G=0===u.indexOf(".env"),p=0===u.indexOf(".basis");if(G?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=V,V&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),d)this._files=d;else if(p||G||K||A||(A=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,A){for(let S=0;S<A.length;S++)this._files.push(y+A[S]);this._extensions=A}this._buffer=F,B?(this.delayLoadState=4,this._delayedOnLoad=I,this._delayedOnError=i):this._loadTexture(I,i)}delayLoad(y){4===this.delayLoadState&&(y&&(this._forcedExtension=y),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(y){var S,I;if(y.updateFlag===this._textureMatrix.updateFlag)return;y.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(I=this.Ey())||void 0===I||I.markAllMaterialsAsDirty(1,(y=>-1!==y.getActiveTextures().indexOf(this))));if(this._textureMatrix=y,null===(S=this.Ey())||void 0===S||!S.useRightHandedSystem)return;const V=B.TmpVectors.OS[0],i=B.TmpVectors.Quaternion[0],A=B.TmpVectors.OS[1];this._textureMatrix.decompose(V,i,A),i.z*=-1,i.w*=-1,B.Matrix.ComposeToRef(V,i,A,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var y;return null!==(y=this.Ey())&&void 0!==y&&y.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const I=this.Ey(),V=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const i=()=>{var S;(this.onLoadObservable.notifyObservers(this),V)&&(V.dispose(),null===(S=this.Ey())||void 0===S||S.markAllMaterialsAsDirty(1));y&&y()},B=(y,I)=>{this._loadingError=!0,this._errorObject={message:y,exception:I},S&&S(y,I),F.e.OnTextureLoadErrorObservable.notifyObservers(this)};var d;this._texture?this._texture.isReady?A.Tools.SetImmediate((()=>i())):this._texture.onLoadedObservable.add((()=>i())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,I,this._lodScale,this._lodOffset,y,B,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,I,this._files,this._noMipmap,y,B,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(d=this._texture)||void 0===d||d.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(y,S,I){const V=K.d.Parse((()=>{let V=!1;return y.prefiltered&&(V=y.prefiltered),new G(I+(y.url??y.name),S,y.extensions,!1,y.files||null,null,null,void 0,V,y.forcedExtension)}),y,S);if(y.boundingBoxPosition&&(V.boundingBoxPosition=B.OS.oS(y.boundingBoxPosition)),y.boundingBoxSize&&(V.boundingBoxSize=B.OS.oS(y.boundingBoxSize)),y.animations)for(let i=0;i<y.animations.length;i++){const S=y.animations[i],I=(0,J.d)("BABYLON.Animation");I&&V.animations.push(I.Parse(S))}return V}clone(){let y=0;const S=K.d.Clone((()=>{const S=new G(this.url,this.Ey()||this._getEngine(),this._extensions,this._noMipmap,this._files);return y=S.uniqueId,S}),this);return S.uniqueId=y,S}}(0,V.c)([(0,i.E)()],G.prototype,"url",void 0),(0,V.c)([(0,i.D)()],G.prototype,"boundingBoxPosition",void 0),(0,V.c)([(0,i.D)()],G.prototype,"boundingBoxSize",null),(0,V.c)([(0,i.E)("rotationY")],G.prototype,"rotationY",null),(0,V.c)([(0,i.E)("files")],G.prototype,"_files",void 0),(0,V.c)([(0,i.E)("forcedExtension")],G.prototype,"_forcedExtension",void 0),(0,V.c)([(0,i.E)("extensions")],G.prototype,"_extensions",void 0),(0,V.c)([(0,i.r)("textureMatrix")],G.prototype,"_textureMatrix",void 0),(0,V.c)([(0,i.r)("textureMatrixRefraction")],G.prototype,"_textureMatrixRefraction",void 0),F.e._CubeTextureParser=G.Parse,(0,J.e)("BABYLON.CubeTexture",G)},14519:(y,S,I)=>{"use strict";I.d(S,{e:()=>F});var V=I(12151),i=I(12304),A=I(12291),B=I(12459),d=I(12265);B.ThinEngine.prototype.createDynamicTexture=function(y,S,I,V){const i=new d.c(this,4);return i.baseWidth=y,i.baseHeight=S,I&&(y=this.needPOTTextures?(0,A.h)(y,this._caps.maxTextureSize):y,S=this.needPOTTextures?(0,A.h)(S,this._caps.maxTextureSize):S),i.width=y,i.height=S,i.isReady=!1,i.generateMipMaps=I,i.samplingMode=V,this.updateTextureSamplingMode(V,i),this._internalTexturesCache.push(i),i},B.ThinEngine.prototype.updateDynamicTexture=function(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!y)return;const B=this._gl,d=B.TEXTURE_2D,F=this._bindTextureDirectly(d,y,!0,A);this._unpackFlipY(void 0===I?y.invertY:I),V&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const J=this._getWebGLTextureType(y.type),u=this._getInternalFormat(i||y.format),K=this._getRGBABufferInternalSizedFormat(y.type,u);B.texImage2D(d,0,K,u,J,S),y.generateMipMaps&&B.generateMipmap(d),F||this._bindTextureDirectly(d,null),V&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),i&&(y.format=i),y._dynamicTextureSource=S,y._premulAlpha=V,y.invertY=I||!1,y.isReady=!0};class F extends i.e{constructor(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,d=arguments.length>6?arguments[6]:void 0;const F=!I||I._isScene;super(null,F?I:null===I||void 0===I?void 0:I.mI,F?!V:I,d,A,void 0,void 0,void 0,void 0,B),this.name=y,this.wrapU=i.e.CLAMP_ADDRESSMODE,this.wrapV=i.e.CLAMP_ADDRESSMODE,this._generateMipMaps=V;const J=this._getEngine();if(!J)return;if(S.getContext)this._canvas=S,this._ownCanvas=!1,this._texture=J.createDynamicTexture(this._canvas.width,this._canvas.height,V,A);else{this._canvas=J.createCanvas(1,1),this._ownCanvas=!0;const y=S;y.width||0===y.width?this._texture=J.createDynamicTexture(y.width,y.height,V,A):this._texture=J.createDynamicTexture(S,S,V,A)}const u=this.getSize();this._canvas.width!==u.width&&(this._canvas.width=u.width),this._canvas.height!==u.height&&(this._canvas.height=u.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(y){this._canvas.width=y.width,this._canvas.height=y.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(y.width,y.height,this._generateMipMaps,this.samplingMode)}scale(y){const S=this.getSize();S.width*=y,S.height*=y,this._recreate(S)}scaleTo(y,S){const I=this.getSize();I.width=y,I.height=S,this._recreate(I)}getContext(){return this._context}clear(y){const S=this.getSize();y&&(this._context.fillStyle=y),this._context.clearRect(0,0,S.width,S.height)}update(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===y||y,S,this._format||void 0,void 0,I)}drawText(y,S,I,V,i,A,B){let d=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const F=this.getSize();if(A&&(this._context.fillStyle=A,this._context.fillRect(0,0,F.width,F.height)),this._context.font=V,null===S||void 0===S){const I=this._context.measureText(y);S=(F.width-I.width)/2}if(null===I||void 0===I){const y=parseInt(V.replace(/\D/g,""));I=F.height/2+y/3.65}this._context.fillStyle=i||"",this._context.fillText(y,S,I),d&&this.update(B)}dispose(){var y,S;(super.dispose(),this._ownCanvas)&&(null===(y=this._canvas)||void 0===y||null===(S=y.remove)||void 0===S||S.call(y));this._canvas=null,this._context=null}clone(){const y=this.Ey();if(!y)return this;const S=this.getSize(),I=new F(this.name,S,y,this._generateMipMaps);return I.Fd=this.Fd,I.level=this.level,I.wrapU=this.wrapU,I.wrapV=this.wrapV,I}serialize(){const y=this.Ey();y&&!y.isReady()&&V.b.Warn("The scene must be ready before serializing the dynamic texture");const S=super.serialize();return F._IsCanvasElement(this._canvas)&&(S.base64String=this._canvas.toDataURL()),S.invertY=this._invertY,S.samplingMode=this.samplingMode,S}static _IsCanvasElement(y){return void 0!==y.toDataURL}_rebuild(){this.update()}}},13910:(y,S,I)=>{"use strict";I.d(S,{e:()=>i});var V=I(12304);class i extends V.e{get depth(){return this._depth}constructor(y,S,I,i,A,B){let d=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:V.e.TRILINEAR_SAMPLINGMODE,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,K=arguments.length>10?arguments[10]:void 0;super(null,B,!d,F),this.format=A,this._texture=B.getEngine().createRawTexture2DArray(y,S,I,i,A,d,F,J,null,u,K),this._depth=i,this.is2DArray=!0}update(y){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,y,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(y,S,I,V,A){return new i(y,S,I,V,5,A,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13729:(y,S,I)=>{"use strict";I.d(S,{c:()=>d,g:()=>F,i:()=>A,j:()=>B});var V=I(12338),i=I(12321);function A(y,S){return`{X: ${y.x.toFixed(S)} Y: ${y.y.toFixed(S)}}`}function B(y,S){return`{X: ${y._x.toFixed(S)} Y: ${y._y.toFixed(S)} Z: ${y._z.toFixed(S)}}`}function d(y,S){return 2*Math.acos((0,V.Clamp)(i.Quaternion.Dot(y,S)))}function F(y,S){const I=new i.Quaternion;return function(y,S,I){const A=i.OS.Cross(y,S),B=Math.acos((0,V.Clamp)(i.OS.Dot(y,S),-1,1));i.Quaternion.RotationAxisToRef(A,B,I)}(y,S,I),I}},13554:(y,S,I)=>{"use strict";I.d(S,{c:()=>J});var V=I(12321),i=I(12362),A=I(12753),B=I(12739),d=I(12375);I(13558);function F(y){let S=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const I=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],A=[];let F=[];const J=y.width||y.size||1,u=y.height||y.size||1,K=y.depth||y.size||1,G=y.wrap||!1;let p=void 0===y.topBaseAt?1:y.topBaseAt,L=void 0===y.bottomBaseAt?0:y.bottomBaseAt;p=(p+4)%4,L=(L+4)%4;let T=[2,0,3,1][p],l=[2,0,1,3][L],j=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(G){S=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],j=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let y=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],I=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const V=[17,18,19,16],i=[22,23,20,21];for(;T>0;)y.unshift(y.pop()),V.unshift(V.pop()),T--;for(;l>0;)I.unshift(I.pop()),i.unshift(i.pop()),l--;y=y.flat(),I=I.flat(),j=j.concat(y).concat(I),S.push(V[0],V[2],V[3],V[0],V[1],V[2]),S.push(i[0],i[2],i[3],i[0],i[1],i[2])}const s=[J/2,u/2,K/2];F=j.reduce(((y,S,I)=>y.concat(S*s[I%3])),[]);const O=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE,f=y.faceUV||new Array(6),my=y.faceColors,C=[];for(let B=0;B<6;B++)void 0===f[B]&&(f[B]=new V.Vector4(0,0,1,1)),my&&void 0===my[B]&&(my[B]=new i.vd(1,1,1,1));for(let V=0;V<6;V++)if(A.push(f[V].z,d.b?1-f[V].w:f[V].w),A.push(f[V].x,d.b?1-f[V].w:f[V].w),A.push(f[V].x,d.b?1-f[V].y:f[V].y),A.push(f[V].z,d.b?1-f[V].y:f[V].y),my)for(let y=0;y<4;y++)C.push(my[V].r,my[V].g,my[V].b,my[V].a);B.b._ComputeSides(O,F,S,I,A,y.frontUVs,y.backUVs);const D=new B.b;if(D.indices=S,D.hy=F,D.ny=I,D.Py=A,my){const y=O===B.b.DOUBLESIDE?C.concat(C):C;D.vy=y}return D}function J(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new A.c(y,I);S.sideOrientation=A.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return F(S).gy(V,S.updatable),V}B.b.CreateBox=F,A.c.CreateBox=function(y,S){return J(y,{size:S,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13718:(y,S,I)=>{"use strict";I.d(S,{c:()=>d});var V=I(12753),i=I(12739),A=I(12375);function B(y){const S=[],I=[],V=[],B=[],d=y.radius||.5,F=y.tessellation||64,J=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,u=0===y.sideOrientation?0:y.sideOrientation||i.b.DEFAULTSIDE;S.push(0,0,0),B.push(.5,.5);const K=2*Math.PI*J,G=1===J?K/F:K/(F-1);let p=0;for(let i=0;i<F;i++){const y=Math.cos(p),I=Math.sin(p),V=(y+1)/2,i=(1-I)/2;S.push(d*y,d*I,0),B.push(V,A.b?1-i:i),p+=G}1===J&&(S.push(S[3],S[4],S[5]),B.push(B[2],A.b?1-B[3]:B[3]));const L=S.length/3;for(let i=1;i<L-1;i++)I.push(i+1,0,i);i.b.ComputeNormals(S,I,V),i.b._ComputeSides(u,S,I,V,B,y.frontUVs,y.backUVs);const T=new i.b;return T.indices=I,T.hy=S,T.ny=V,T.Py=B,T}function d(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new V.c(y,I);S.sideOrientation=V.c._GetDefaultSideOrientation(S.sideOrientation),i._originalBuilderSideOrientation=S.sideOrientation;return B(S).gy(i,S.updatable),i}i.b.CreateDisc=B,V.c.CreateDisc=function(y,S,I){return d(y,{radius:S,tessellation:I,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13558:(y,S,I)=>{"use strict";I.d(S,{g:()=>l,c:()=>s,i:()=>j});var V=I(12321),i=I(12362),A=I(12753),B=I(12739),d=I(12390);A.c._GroundMeshParser=(y,S)=>F.Parse(y,S);class F extends A.c{constructor(y,S){super(y,S),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=y,this._subdivisionsY=y,this.subdivide(y);const I=this;I.createOrUpdateSubmeshesOctree&&I.createOrUpdateSubmeshesOctree(S)}getHeightAtCoordinates(y,S){const I=this.getWorldMatrix(),i=V.TmpVectors.Matrix[5];I.invertToRef(i);const A=V.TmpVectors.OS[8];if(V.OS.TransformCoordinatesFromFloatsToRef(y,0,S,i,A),y=A.x,S=A.z,y<this._minX||y>=this._maxX||S<=this._minZ||S>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const B=this._getFacetAt(y,S),d=-(B.x*y+B.z*S+B.w)/B.y;return V.OS.TransformCoordinatesFromFloatsToRef(0,d,0,I,A),A.y}getNormalAtCoordinates(y,S){const I=new V.OS(0,1,0);return this.getNormalAtCoordinatesToRef(y,S,I),I}getNormalAtCoordinatesToRef(y,S,I){const i=this.getWorldMatrix(),A=V.TmpVectors.Matrix[5];i.invertToRef(A);const B=V.TmpVectors.OS[8];if(V.OS.TransformCoordinatesFromFloatsToRef(y,0,S,A,B),y=B.x,S=B.z,y<this._minX||y>this._maxX||S<this._minZ||S>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const d=this._getFacetAt(y,S);return V.OS.TransformNormalFromFloatsToRef(d.x,d.y,d.z,i,I),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(y,S){const I=Math.floor((y+this._maxX)*this._subdivisionsX/this._width),V=Math.floor(-(S+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),i=this._heightQuads[V*this._subdivisionsX+I];let A;return A=S<i.slope.x*y+i.slope.y?i.facet1:i.facet2,A}_initHeightQuads(){const y=this._subdivisionsX,S=this._subdivisionsY;this._heightQuads=[];for(let I=0;I<S;I++)for(let S=0;S<y;S++){const i={slope:V.Vector2.Zero(),facet1:new V.Vector4(0,0,0,0),facet2:new V.Vector4(0,0,0,0)};this._heightQuads[I*y+S]=i}return this}_computeHeightQuads(){const y=this.getVerticesData(d.e.PositionKind);if(!y)return this;const S=V.TmpVectors.OS[3],I=V.TmpVectors.OS[2],i=V.TmpVectors.OS[1],A=V.TmpVectors.OS[0],B=V.TmpVectors.OS[4],F=V.TmpVectors.OS[5],J=V.TmpVectors.OS[6],u=V.TmpVectors.OS[7],K=V.TmpVectors.OS[8];let G=0,p=0,L=0,T=0,l=0,j=0,s=0;const O=this._subdivisionsX,f=this._subdivisionsY;for(let d=0;d<f;d++)for(let f=0;f<O;f++){G=3*f,p=d*(O+1)*3,L=(d+1)*(O+1)*3,S.x=y[p+G],S.y=y[p+G+1],S.z=y[p+G+2],I.x=y[p+G+3],I.y=y[p+G+4],I.z=y[p+G+5],i.x=y[L+G],i.y=y[L+G+1],i.z=y[L+G+2],A.x=y[L+G+3],A.y=y[L+G+4],A.z=y[L+G+5],T=(A.z-S.z)/(A.x-S.x),l=S.z-T*S.x,I.subtractToRef(S,B),i.subtractToRef(S,F),A.subtractToRef(S,J),V.OS.CrossToRef(J,F,u),V.OS.CrossToRef(B,J,K),u.normalize(),K.normalize(),j=-(u.x*S.x+u.y*S.y+u.z*S.z),s=-(K.x*I.x+K.y*I.y+K.z*I.z);const my=this._heightQuads[d*O+f];my.slope.od(T,l),my.facet1.od(u.x,u.y,u.z,j),my.facet2.od(K.x,K.y,K.z,s)}return this}serialize(y){super.serialize(y),y.subdivisionsX=this._subdivisionsX,y.subdivisionsY=this._subdivisionsY,y.minX=this._minX,y.maxX=this._maxX,y.Ld=this._minZ,y.maxZ=this._maxZ,y.width=this._width,y.height=this._height}static Parse(y,S){const I=new F(y.name,S);return I._subdivisionsX=y.subdivisionsX||1,I._subdivisionsY=y.subdivisionsY||1,I._minX=y.minX,I._maxX=y.maxX,I._minZ=y.Ld,I._maxZ=y.maxZ,I._width=y.width,I._height=y.height,I}}var J=I(12128),u=I(12185),K=I(12325),G=I(12375);function p(y){const S=[],I=[],i=[],A=[];let d,F;const J=y.width||y.size||1,u=y.height||y.size||1,K=0|(y.subdivisionsX||y.subdivisions||1),p=0|(y.subdivisionsY||y.subdivisions||1);for(d=0;d<=p;d++)for(F=0;F<=K;F++){const y=new V.OS(F*J/K-J/2,0,(p-d)*u/p-u/2),S=new V.OS(0,1,0);I.push(y.x,y.y,y.z),i.push(S.x,S.y,S.z),A.push(F/K,G.b?d/p:1-d/p)}for(d=0;d<p;d++)for(F=0;F<K;F++)S.push(F+1+(d+1)*(K+1)),S.push(F+1+d*(K+1)),S.push(F+d*(K+1)),S.push(F+(d+1)*(K+1)),S.push(F+1+(d+1)*(K+1)),S.push(F+d*(K+1));const L=new B.b;return L.indices=S,L.hy=I,L.ny=i,L.Py=A,L}function L(y){const S=void 0!==y.xmin&&null!==y.xmin?y.xmin:-1,I=void 0!==y.zmin&&null!==y.zmin?y.zmin:-1,i=void 0!==y.xmax&&null!==y.xmax?y.xmax:1,A=void 0!==y.zmax&&null!==y.zmax?y.zmax:1,d=y.subdivisions||{w:1,h:1},F=y.precision||{w:1,h:1},J=[],u=[],K=[],G=[];let p,L,T,l;d.h=d.h<1?1:d.h,d.w=d.w<1?1:d.w,F.w=F.w<1?1:F.w,F.h=F.h<1?1:F.h;const j=(i-S)/d.w,s=(A-I)/d.h;function O(y,S,I,i){const A=u.length/3,B=F.w+1;for(p=0;p<F.h;p++)for(L=0;L<F.w;L++){const y=[A+L+p*B,A+(L+1)+p*B,A+(L+1)+(p+1)*B,A+L+(p+1)*B];J.push(y[1]),J.push(y[2]),J.push(y[3]),J.push(y[0]),J.push(y[1]),J.push(y[3])}const d=V.OS.Zero(),T=new V.OS(0,1,0);for(p=0;p<=F.h;p++)for(d.z=p*(i-S)/F.h+S,L=0;L<=F.w;L++)d.x=L*(I-y)/F.w+y,d.y=0,u.push(d.x,d.y,d.z),K.push(T.x,T.y,T.z),G.push(L/F.w,p/F.h)}for(T=0;T<d.h;T++)for(l=0;l<d.w;l++)O(S+l*j,I+T*s,S+(l+1)*j,I+(T+1)*s);const f=new B.b;return f.indices=J,f.hy=u,f.ny=K,f.Py=G,f}function T(y){const S=[],I=[],A=[],d=[];let F,J;const u=y.colorFilter||new i.DS(.3,.59,.11),G=y.alphaFilter||0;let p=!1;if(y.minHeight>y.maxHeight){p=!0;const S=y.maxHeight;y.maxHeight=y.minHeight,y.minHeight=S}for(F=0;F<=y.subdivisions;F++)for(J=0;J<=y.subdivisions;J++){const S=new V.OS(J*y.width/y.subdivisions-y.width/2,0,(y.subdivisions-F)*y.height/y.subdivisions-y.height/2),i=4*(((S.x+y.width/2)/y.width*(y.bufferWidth-1)|0)+((1-(S.z+y.height/2)/y.height)*(y.bufferHeight-1)|0)*y.bufferWidth);let B=y.buffer[i]/255,L=y.buffer[i+1]/255,T=y.buffer[i+2]/255;const l=y.buffer[i+3]/255;p&&(B=1-B,L=1-L,T=1-T);const j=B*u.r+L*u.g+T*u.b;S.y=l>=G?y.minHeight+(y.maxHeight-y.minHeight)*j:y.minHeight-K.c,y.heightBuffer&&(y.heightBuffer[F*(y.subdivisions+1)+J]=S.y),I.push(S.x,S.y,S.z),A.push(0,0,0),d.push(J/y.subdivisions,1-F/y.subdivisions)}for(F=0;F<y.subdivisions;F++)for(J=0;J<y.subdivisions;J++){const V=J+1+(F+1)*(y.subdivisions+1),i=J+1+F*(y.subdivisions+1),A=J+F*(y.subdivisions+1),B=J+(F+1)*(y.subdivisions+1),d=I[3*V+1]>=y.minHeight,u=I[3*i+1]>=y.minHeight,K=I[3*A+1]>=y.minHeight;d&&u&&K&&(S.push(V),S.push(i),S.push(A));I[3*B+1]>=y.minHeight&&d&&K&&(S.push(B),S.push(V),S.push(A))}B.b.ComputeNormals(I,S,A);const L=new B.b;return L.indices=S,L.hy=I,L.ny=A,L.Py=d,L}function l(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const I=new F(y,arguments.length>2?arguments[2]:void 0);I._setReady(!1),I._subdivisionsX=S.subdivisionsX||S.subdivisions||1,I._subdivisionsY=S.subdivisionsY||S.subdivisions||1,I._width=S.width||1,I._height=S.height||1,I._maxX=I._width/2,I._maxZ=I._height/2,I._minX=-I._maxX,I._minZ=-I._maxZ;return p(S).gy(I,S.updatable),I._setReady(!0),I}function j(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new A.c(y,I);return L(S).gy(V,S.updatable),V}function s(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=I.width||10,B=I.height||10,d=I.subdivisions||1,K=I.minHeight||0,G=I.maxHeight||1,p=I.colorFilter||new i.DS(.3,.59,.11),L=I.alphaFilter||0,l=I.updatable,j=I.onReady;V=V||u.e.LastCreatedScene;const s=new F(y,V);let O;s._subdivisionsX=d,s._subdivisionsY=d,s._width=A,s._height=B,s._maxX=s._width/2,s._maxZ=s._height/2,s._minX=-s._maxX,s._minZ=-s._maxZ,s._setReady(!1),I.passHeightBufferInCallback&&(O=new Float32Array((d+1)*(d+1)));const f=(y,S,I)=>{T({width:A,height:B,subdivisions:d,minHeight:K,maxHeight:G,colorFilter:p,buffer:y,bufferWidth:S,bufferHeight:I,alphaFilter:L,heightBuffer:O}).gy(s,l),j&&j(s,O),s._setReady(!0)};if("string"===typeof S){const y=y=>{var S;const I=y.width,i=y.height;if(V.J)return;const A=null===(S=V)||void 0===S?void 0:S.getEngine().resizeImageBitmap(y,I,i);f(A,I,i)};J.Tools.LoadImage(S,y,I.onError?I.onError:()=>{},V.offlineProvider)}else f(S.data,S.width,S.height);return s}B.b.CreateGround=p,B.b.CreateTiledGround=L,B.b.CreateGroundFromHeightMap=T,A.c.CreateGround=(y,S,I,V,i,A)=>l(y,{width:S,height:I,subdivisions:V,updatable:A},i),A.c.CreateTiledGround=(y,S,I,V,i,A,B,d,F)=>j(y,{xmin:S,zmin:I,xmax:V,zmax:i,subdivisions:A,precision:B,updatable:F},d),A.c.CreateGroundFromHeightMap=(y,S,I,V,i,A,B,d,F,J,u)=>s(y,S,{width:I,height:V,subdivisions:i,minHeight:A,maxHeight:B,updatable:F,onReady:J,alphaFilter:u},d)},14230:(y,S,I)=>{"use strict";I.d(S,{e:()=>p,g:()=>K,h:()=>G});var V=I(12321),i=I(12753),A=I(12739),B=I(12861),d=I(12390),F=I(12151);function J(y){const S=[],I=[],V=y.lines,i=y.vy,B=[];let d=0;for(let A=0;A<V.length;A++){const y=V[A];for(let V=0;V<y.length;V++){const{x:F,y:J,z:u}=y[V];if(I.push(F,J,u),i){const y=i[A],{r:S,g:I,b:d,a:F}=y[V];B.push(S,I,d,F)}V>0&&(S.push(d-1),S.push(d)),d++}}const F=new A.b;return F.indices=S,F.hy=I,i&&(F.vy=B),F}function u(y){const S=y.dashSize||3,I=y.gapSize||1,i=y.dashNb||200,B=y.points,d=[],F=[],J=V.OS.Zero();let u=0,K=0,G=0,p=0,L=0,T=0,l=0;for(l=0;l<B.length-1;l++)B[l+1].subtractToRef(B[l],J),u+=J.length();for(G=u/i,p=S*G/(S+I),l=0;l<B.length-1;l++){B[l+1].subtractToRef(B[l],J),K=Math.floor(J.length()/G),J.normalize();for(let y=0;y<K;y++)L=G*y,d.push(B[l].x+L*J.x,B[l].y+L*J.y,B[l].z+L*J.z),d.push(B[l].x+(L+p)*J.x,B[l].y+(L+p)*J.y,B[l].z+(L+p)*J.z),F.push(T,T+1),T+=2}const j=new A.b;return j.hy=d,j.indices=F,j}function K(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=S.instance,i=S.lines,A=S.vy;if(V){const y=V.getVerticesData(d.e.PositionKind);let S,I;A&&(S=V.getVerticesData(d.e.ColorKind));let B=0,F=0;for(let V=0;V<i.length;V++){const d=i[V];for(let i=0;i<d.length;i++)y[B]=d[i].x,y[B+1]=d[i].y,y[B+2]=d[i].z,A&&S&&(I=A[V],S[F]=I[i].r,S[F+1]=I[i].g,S[F+2]=I[i].b,S[F+3]=I[i].a,F+=4),B+=3}return V.updateVerticesData(d.e.PositionKind,y,!1,!1),A&&S&&V.updateVerticesData(d.e.ColorKind,S,!1,!1),V.refreshBoundingInfo(),V}const F=!!A,u=new B.b(y,I,null,void 0,void 0,F,S.useVertexAlpha,S.material);return J(S).gy(u,S.updatable),u}function G(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=S.vy?[S.vy]:null;return K(y,{lines:[S.points],updatable:S.updatable,instance:S.instance,vy:V,useVertexAlpha:S.useVertexAlpha,material:S.material},I)}function p(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=S.points,d=S.instance,J=S.gapSize||1,K=S.dashSize||3;if(d){const y=y=>{const S=V.OS.Zero(),I=y.length/6;let i=0,B=0,F=0,J=0,u=0,K=0,G=0,p=0;for(G=0;G<A.length-1;G++)A[G+1].subtractToRef(A[G],S),i+=S.length();F=i/I;const L=d._creationDataStorage.dashSize;for(J=L*F/(L+d._creationDataStorage.gapSize),G=0;G<A.length-1;G++)for(A[G+1].subtractToRef(A[G],S),B=Math.floor(S.length()/F),S.normalize(),p=0;p<B&&K<y.length;)u=F*p,y[K]=A[G].x+u*S.x,y[K+1]=A[G].y+u*S.y,y[K+2]=A[G].z+u*S.z,y[K+3]=A[G].x+(u+J)*S.x,y[K+4]=A[G].y+(u+J)*S.y,y[K+5]=A[G].z+(u+J)*S.z,K+=6,p++;for(;K<y.length;)y[K]=A[G].x,y[K+1]=A[G].y,y[K+2]=A[G].z,K+=3};return(S.dashNb||S.dashSize||S.gapSize||S.useVertexAlpha||S.material)&&F.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),d.updateMeshPositions(y,!1),d}const G=new B.b(y,I,null,void 0,void 0,void 0,S.useVertexAlpha,S.material);return u(S).gy(G,S.updatable),G._creationDataStorage=new i.g,G._creationDataStorage.dashSize=K,G._creationDataStorage.gapSize=J,G}A.b.CreateLineSystem=J,A.b.CreateDashedLines=u,i.c.nJ=function(y,S){return G(y,{points:S,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},i.c.CreateDashedLines=function(y,S,I,V,i){return p(y,{points:S,dashSize:I,gapSize:V,dashNb:i,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13611:(y,S,I)=>{"use strict";I.d(S,{e:()=>d,i:()=>F});var V=I(12753),i=I(12739),A=I(12375);function B(y){const S=[],I=[],V=[],B=[],d=void 0!==y.width?y.width:void 0!==y.size?y.size:1,F=void 0!==y.height?y.height:void 0!==y.size?y.size:1,J=0===y.sideOrientation?0:y.sideOrientation||i.b.DEFAULTSIDE,u=d/2,K=F/2;I.push(-u,-K,0),V.push(0,0,-1),B.push(0,A.b?1:0),I.push(u,-K,0),V.push(0,0,-1),B.push(1,A.b?1:0),I.push(u,K,0),V.push(0,0,-1),B.push(1,A.b?0:1),I.push(-u,K,0),V.push(0,0,-1),B.push(0,A.b?0:1),S.push(0),S.push(1),S.push(2),S.push(0),S.push(2),S.push(3),i.b._ComputeSides(J,I,S,V,B,y.frontUVs,y.backUVs);const G=new i.b;return G.indices=S,G.hy=I,G.ny=V,G.Py=B,G}function d(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new V.c(y,I);S.sideOrientation=V.c._GetDefaultSideOrientation(S.sideOrientation),i._originalBuilderSideOrientation=S.sideOrientation;return B(S).gy(i,S.updatable),S.sourcePlane&&(i.translate(S.sourcePlane.normal,-S.sourcePlane.d),i.setDirection(S.sourcePlane.normal.scale(-1))),i}const F={qJ:d};i.b.qJ=B,V.c.qJ=(y,S,I,V,i)=>d(y,{size:S,width:S,height:S,sideOrientation:i,updatable:V},I)},13703:(y,S,I)=>{"use strict";I.d(S,{b:()=>F});var V=I(12321),i=I(12753),A=I(12739),B=I(12375);function d(y){const S=0|(y.segments||32),I=y.diameterX||y.diameter||1,i=y.diameterY||y.diameter||1,d=y.diameterZ||y.diameter||1,F=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,J=y.slice&&y.slice<=0?1:y.slice||1,u=0===y.sideOrientation?0:y.sideOrientation||A.b.DEFAULTSIDE,K=!!y.dedupTopBottomIndices,G=new V.OS(I/2,i/2,d/2),p=2+S,L=2*p,T=[],l=[],j=[],s=[];for(let A=0;A<=p;A++){const y=A/p,S=y*Math.PI*J;for(let I=0;I<=L;I++){const i=I/L,A=i*Math.PI*2*F,d=V.Matrix.RotationZ(-S),J=V.Matrix.RotationY(A),u=V.OS.TransformCoordinates(V.OS.Up(),d),K=V.OS.TransformCoordinates(u,J),p=K.multiply(G),T=K.divide(G).normalize();l.push(p.x,p.y,p.z),j.push(T.x,T.y,T.z),s.push(i,B.b?1-y:y)}if(A>0){const y=l.length/3;for(let S=y-2*(L+1);S+L+2<y;S++)K?(A>1&&(T.push(S),T.push(S+1),T.push(S+L+1)),(A<p||J<1)&&(T.push(S+L+1),T.push(S+1),T.push(S+L+2))):(T.push(S),T.push(S+1),T.push(S+L+1),T.push(S+L+1),T.push(S+1),T.push(S+L+2))}}A.b._ComputeSides(u,l,T,j,s,y.frontUVs,y.backUVs);const O=new A.b;return O.indices=T,O.hy=l,O.ny=j,O.Py=s,O}function F(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new i.c(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return d(S).gy(V,S.updatable),V}A.b.CreateSphere=d,i.c.CreateSphere=(y,S,I,V,i,A)=>F(y,{segments:S,diameterX:I,diameterY:I,diameterZ:I,sideOrientation:A,updatable:i},V)},14526:(y,S,I)=>{"use strict";I.d(S,{e:()=>d});var V=I(12883),i=I(14003),A=I(12906),B=I(12739);class d{static get Configuration(){return{get decoder(){return i.b.DefaultConfiguration},set decoder(y){i.b.DefaultConfiguration=y}}}static set Configuration(y){i.b.DefaultConfiguration=y.decoder}static get DecoderAvailable(){return(0,V.f)(i.b.DefaultConfiguration)}static get Default(){return d._Default??(d._Default=new d),d._Default}static ResetDefault(y){d._Default&&(y||d._Default.dispose(),d._Default=null)}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.DefaultNumWorkers;const S="number"===typeof y?{...i.b.DefaultConfiguration,numWorkers:y}:{...i.b.DefaultConfiguration,...y};this._decoder=new i.b(S)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(y,S,I){return this._decoder.decodeMeshToMeshDataAsync(y,S,I)}async decodeMeshToGeometryAsync(y,S,I,V){return await this._decoder.decodeMeshToGeometryAsync(y,S,I,V)}async _decodeMeshToGeometryForGltfAsync(y,S,I,V,i,A){return await this._decoder._decodeMeshToGeometryForGltfAsync(y,S,I,V,i,A)}async decodeMeshAsync(y,S){const I=await this._decoder.decodeMeshToMeshDataAsync(y,S),V=new B.b;I.indices&&(V.indices=I.indices);for(const i of I.attributes){const y=A.e.GetFloatData(i.data,i.size,A.e.GetDataType(i.data),i.byteOffset,i.byteStride,i.normalized,I.totalVertices);V.set(y,i.kind)}return V}}d.DefaultNumWorkers=(0,V.e)(),d._Default=null},14003:(y,S,I)=>{"use strict";I.d(S,{b:()=>J});var V=I(12883),i=I(12128),A=I(12766),B=I(12906),d=I(12151),F=I(12900);class J extends V.d{static get DefaultAvailable(){return(0,V.f)(J.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(y){J._Default&&(y||J._Default.dispose(),J._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(y,S){return{module:await(S||DracoDecoderModule)({wasmBinary:y})}}_getWorkerContent(){return`${F.d}(${F.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultConfiguration)}decodeMeshToMeshDataAsync(y,S,I){const V=y instanceof ArrayBuffer?new Int8Array(y):new Int8Array(y.buffer,y.byteOffset,y.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async y=>await new Promise(((i,A)=>{y.push(((y,B)=>{let F=null;const J=[],u=S=>{y.removeEventListener("error",u),y.removeEventListener("message",K),A(S),B()},K=S=>{const V=S.data;switch(V.id){case"indices":F=V.data;break;case"attribute":J.push({kind:V.kind,data:V.data,size:V.size,byteOffset:V.byteOffset,byteStride:V.byteStride,normalized:(A=V.kind,G=V.normalized,I&&void 0!==I[A]?(G!==I[A]&&d.b.Warn(`Normalized flag from Draco data (${G}) does not match normalized flag from glTF accessor (${I[A]}). Using flag from glTF accessor.`),I[A]):G)});break;case"decodeMeshDone":y.removeEventListener("error",u),y.removeEventListener("message",K),i({indices:F,attributes:J,totalVertices:V.totalVertices}),B()}var A,G};y.addEventListener("error",u),y.addEventListener("message",K);const G=V.slice();y.postMessage({id:"decodeMesh",dataView:G,attributes:S},[G.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((y=>{let I=null;const i=[],A=(0,F.d)(y.module,V,S,(y=>{I=y}),((y,S,I,V,A,B)=>{i.push({kind:y,data:S,size:I,byteOffset:V,byteStride:A,normalized:B})}));return{indices:I,attributes:i,totalVertices:A}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(y,S,I,V){const i=await this.decodeMeshToMeshDataAsync(I,V),d=new A.d(y,S);i.indices&&d.setIndices(i.indices);for(const A of i.attributes)d.setVerticesBuffer(new B.e(S.getEngine(),A.data,A.kind,!1,void 0,A.byteStride,void 0,A.byteOffset,A.size,void 0,A.normalized,!0),i.totalVertices);return d}async _decodeMeshToGeometryForGltfAsync(y,S,I,V,i,d){const F=await this.decodeMeshToMeshDataAsync(I,V,i),J=new A.d(y,S);d&&(J._boundingInfo=d,J.useBoundingInfoFromGeometry=!0),F.indices&&J.setIndices(F.indices);for(const A of F.attributes)J.setVerticesBuffer(new B.e(S.getEngine(),A.data,A.kind,!1,void 0,A.byteStride,void 0,A.byteOffset,A.size,void 0,A.normalized,!0),F.totalVertices);return J}}J.DefaultConfiguration={wasmUrl:`${i.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${i.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${i.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},J._Default=null},14225:(y,S,I)=>{"use strict";I.d(S,{c:()=>dy});var V=I(12321),i=I(12753),A=I(12390),B=I(12739),d=I(12375);function F(y){let S=y.pathArray;const I=y.closeArray||!1,V=y.closePath||!1,i=y.invertUV||!1,F=Math.floor(S[0].length/2);let J=y.offset||F;J=J>F?F:Math.floor(J);const u=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE,K=y.Py,G=y.vy,p=[],L=[],T=[],l=[],j=[],s=[],O=[],f=[];let my;const C=[],D=[];let o,E,z;if(S.length<2){const y=[],I=[];for(E=0;E<S[0].length-J;E++)y.push(S[0][E]),I.push(S[0][E+J]);S=[y,I]}let r=0;const h=V?1:0,n=I?1:0;let v,P,q,g,k,R;for(my=S[0].length,o=0;o<S.length+n;o++){for(O[o]=0,j[o]=[0],v=o===S.length?S[0]:S[o],P=v.length,my=my<P?my:P,z=0;z<P;)p.push(v[z].x,v[z].y,v[z].z),z>0&&(q=v[z].fS(v[z-1]).length(),g=q+O[o],j[o].push(g),O[o]=g),z++;V&&(z--,p.push(v[0].x,v[0].y,v[0].z),q=v[z].fS(v[0]).length(),g=q+O[o],j[o].push(g),O[o]=g),C[o]=P+h,D[o]=r,r+=P+h}let b,U,W=null,a=null;for(E=0;E<my+h;E++)for(f[E]=0,s[E]=[0],o=0;o<S.length-1+n;o++)k=S[o],R=o===S.length-1?S[0]:S[o+1],E===my?(W=k[0],a=R[0]):(W=k[E],a=R[E]),q=a.fS(W).length(),g=q+f[E],s[E].push(g),f[E]=g;if(K)for(o=0;o<K.length;o++)l.push(K[o].x,d.b?1-K[o].y:K[o].y);else for(o=0;o<S.length+n;o++)for(E=0;E<my+h;E++)b=0!=O[o]?j[o][E]/O[o]:0,U=0!=f[E]?s[E][o]/f[E]:0,i?l.push(U,b):l.push(b,d.b?1-U:U);o=0;let e=0,x=C[o]-1,Q=C[o+1]-1,c=x<Q?x:Q,X=D[1]-D[0];const M=C.length-1;for(;e<=c&&o<M;)L.push(e,e+X,e+1),L.push(e+X+1,e+1,e+X),e+=1,e===c&&(o++,X=D[o+1]-D[o],x=C[o]-1,Q=C[o+1]-1,e=D[o],c=x<Q?x+e:Q+e);if(B.b.ComputeNormals(p,L,T),V){let y=0,I=0;for(o=0;o<S.length;o++){y=3*D[o],I=o+1<S.length?3*(D[o+1]-1):T.length-3,T[y]=.5*(T[y]+T[I]),T[y+1]=.5*(T[y+1]+T[I+1]),T[y+2]=.5*(T[y+2]+T[I+2]);const V=Math.sqrt(T[y]*T[y]+T[y+1]*T[y+1]+T[y+2]*T[y+2]);T[y]/=V,T[y+1]/=V,T[y+2]/=V,T[I]=T[y],T[I+1]=T[y+1],T[I+2]=T[y+2]}}if(I){let y=3*D[0],I=3*D[S.length];for(E=0;E<my+h;E++){T[y]=.5*(T[y]+T[I]),T[y+1]=.5*(T[y+1]+T[I+1]),T[y+2]=.5*(T[y+2]+T[I+2]);const S=Math.sqrt(T[y]*T[y]+T[y+1]*T[y+1]+T[y+2]*T[y+2]);T[y]/=S,T[y+1]/=S,T[y+2]/=S,T[I]=T[y],T[I+1]=T[y+1],T[I+2]=T[y+2],y+=3,I+=3}}B.b._ComputeSides(u,p,L,T,l,y.frontUVs,y.backUVs);let t=null;if(G){t=new Float32Array(4*G.length);for(let y=0;y<G.length;y++)t[4*y]=G[y].r,t[4*y+1]=G[y].g,t[4*y+2]=G[y].b,t[4*y+3]=G[y].a}const N=new B.b,Y=new Float32Array(p),H=new Float32Array(T),Z=new Float32Array(l);return N.indices=L,N.hy=Y,N.ny=H,N.Py=Z,t&&N.set(t,A.e.ColorKind),V&&(N._idx=D),N}function J(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=S.pathArray,u=S.closeArray,K=S.closePath,G=i.c._GetDefaultSideOrientation(S.sideOrientation),p=S.instance,L=S.updatable;if(p){const y=V.TmpVectors.OS[0].nd(Number.MAX_VALUE),I=V.TmpVectors.OS[1].nd(-Number.MAX_VALUE),F=S=>{let V=J[0].length;const A=p;let B=0;const d=A._originalBuilderSideOrientation===i.c.DOUBLESIDE?2:1;for(let i=1;i<=d;++i)for(let d=0;d<J.length;++d){const i=J[d],F=i.length;V=V<F?V:F;for(let A=0;A<V;++A){const V=i[A];S[B]=V.x,S[B+1]=V.y,S[B+2]=V.z,y.minimizeInPlaceFromFloats(V.x,V.y,V.z),I.maximizeInPlaceFromFloats(V.x,V.y,V.z),B+=3}if(A._creationDataStorage&&A._creationDataStorage.closePath){const y=i[0];S[B]=y.x,S[B+1]=y.y,S[B+2]=y.z,B+=3}}},u=p.getVerticesData(A.e.PositionKind);if(F(u),p.hasBoundingInfo?p.getBoundingInfo().reConstruct(y,I,p._worldMatrix):p.buildBoundingInfo(y,I,p._worldMatrix),p.updateVerticesData(A.e.PositionKind,u,!1,!1),S.vy){const y=p.getVerticesData(A.e.ColorKind);for(let I=0,V=0;I<S.vy.length;I++,V+=4){const i=S.vy[I];y[V]=i.r,y[V+1]=i.g,y[V+2]=i.b,y[V+3]=i.a}p.updateVerticesData(A.e.ColorKind,y,!1,!1)}if(S.Py){const y=p.getVerticesData(A.e.UVKind);for(let I=0;I<S.Py.length;I++)y[2*I]=S.Py[I].x,y[2*I+1]=d.b?1-S.Py[I].y:S.Py[I].y;p.updateVerticesData(A.e.UVKind,y,!1,!1)}if(!p.areNormalsFrozen||p.isFacetDataEnabled){const y=p.fd(),S=p.getVerticesData(A.e.NormalKind),I=p.isFacetDataEnabled?p.getFacetDataParameters():null;if(B.b.ComputeNormals(u,y,S,I),p._creationDataStorage&&p._creationDataStorage.closePath){let y=0,I=0;for(let V=0;V<J.length;V++)y=3*p._creationDataStorage.idx[V],I=V+1<J.length?3*(p._creationDataStorage.idx[V+1]-1):S.length-3,S[y]=.5*(S[y]+S[I]),S[y+1]=.5*(S[y+1]+S[I+1]),S[y+2]=.5*(S[y+2]+S[I+2]),S[I]=S[y],S[I+1]=S[y+1],S[I+2]=S[y+2]}p.areNormalsFrozen||p.updateVerticesData(A.e.NormalKind,S,!1,!1)}return p}{const V=new i.c(y,I);V._originalBuilderSideOrientation=G,V._creationDataStorage=new i.g;const A=F(S);return K&&(V._creationDataStorage.idx=A._idx),V._creationDataStorage.closePath=K,V._creationDataStorage.closeArray=u,A.gy(V,L),V}}B.b.CreateRibbon=F,i.c.CreateRibbon=function(y,S){return J(y,{pathArray:S,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var u=I(13718),K=I(13554),G=I(12362);function p(y){const S=y.pattern||i.c.NO_FLIP,I=y.tileWidth||y.tileSize||1,V=y.tileHeight||y.tileSize||1,A=y.alignHorizontal||0,d=y.alignVertical||0,F=y.width||y.size||1,J=Math.floor(F/I);let u=F-J*I;const K=y.height||y.size||1,G=Math.floor(K/V);let p=K-G*V;const L=I*J/2,T=V*G/2;let l=0,j=0,s=0,O=0,f=0,my=0;if(u>0||p>0){switch(s=-L,O=-T,f=L,my=T,A){case i.c.CENTER:u/=2,s-=u,f+=u;break;case i.c.LEFT:f+=u,l=-u/2;break;case i.c.RIGHT:s-=u,l=u/2}switch(d){case i.c.CENTER:p/=2,O-=p,my+=p;break;case i.c.BOTTOM:my+=p,j=-p/2;break;case i.c.TOP:O-=p,j=p/2}}const C=[],D=[],o=[];o[0]=[0,0,1,0,1,1,0,1],o[1]=[0,0,1,0,1,1,0,1],S!==i.c.ROTATE_TILE&&S!==i.c.ROTATE_ROW||(o[1]=[1,1,0,1,0,0,1,0]),S!==i.c.FLIP_TILE&&S!==i.c.FLIP_ROW||(o[1]=[1,0,0,0,0,1,1,1]),S!==i.c.FLIP_N_ROTATE_TILE&&S!==i.c.FLIP_N_ROTATE_ROW||(o[1]=[0,1,1,1,1,0,0,0]);let E=[];const z=[],r=[];let h=0;for(let B=0;B<G;B++)for(let y=0;y<J;y++)C.push(y*I-L+l,B*V-T+j,0),C.push((y+1)*I-L+l,B*V-T+j,0),C.push((y+1)*I-L+l,(B+1)*V-T+j,0),C.push(y*I-L+l,(B+1)*V-T+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),E=S===i.c.FLIP_TILE||S===i.c.ROTATE_TILE||S===i.c.FLIP_N_ROTATE_TILE?E.concat(o[(y%2+B%2)%2]):S===i.c.FLIP_ROW||S===i.c.ROTATE_ROW||S===i.c.FLIP_N_ROTATE_ROW?E.concat(o[B%2]):E.concat(o[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),h+=4;if(u>0||p>0){const y=p>0&&(d===i.c.CENTER||d===i.c.TOP),B=p>0&&(d===i.c.CENTER||d===i.c.BOTTOM),F=u>0&&(A===i.c.CENTER||A===i.c.RIGHT),K=u>0&&(A===i.c.CENTER||A===i.c.LEFT);let o,n,v,P,q=[];if(y&&F&&(C.push(s+l,O+j,0),C.push(-L+l,O+j,0),C.push(-L+l,O+p+j,0),C.push(s+l,O+p+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,o=1-u/I,n=1-p/V,v=1,P=1,q=[o,n,v,n,v,P,o,P],S===i.c.ROTATE_ROW&&(q=[1-o,1-n,1-v,1-n,1-v,1-P,1-o,1-P]),S===i.c.FLIP_ROW&&(q=[1-o,n,1-v,n,1-v,P,1-o,P]),S===i.c.FLIP_N_ROTATE_ROW&&(q=[o,1-n,v,1-n,v,1-P,o,1-P]),E=E.concat(q),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&K&&(C.push(L+l,O+j,0),C.push(f+l,O+j,0),C.push(f+l,O+p+j,0),C.push(L+l,O+p+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,o=0,n=1-p/V,v=u/I,P=1,q=[o,n,v,n,v,P,o,P],(S===i.c.ROTATE_ROW||S===i.c.ROTATE_TILE&&J%2===0)&&(q=[1-o,1-n,1-v,1-n,1-v,1-P,1-o,1-P]),(S===i.c.FLIP_ROW||S===i.c.FLIP_TILE&&J%2===0)&&(q=[1-o,n,1-v,n,1-v,P,1-o,P]),(S===i.c.FLIP_N_ROTATE_ROW||S===i.c.FLIP_N_ROTATE_TILE&&J%2===0)&&(q=[o,1-n,v,1-n,v,1-P,o,1-P]),E=E.concat(q),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&F&&(C.push(s+l,T+j,0),C.push(-L+l,T+j,0),C.push(-L+l,my+j,0),C.push(s+l,my+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,o=1-u/I,n=0,v=1,P=p/V,q=[o,n,v,n,v,P,o,P],(S===i.c.ROTATE_ROW&&G%2===1||S===i.c.ROTATE_TILE&&G%1===0)&&(q=[1-o,1-n,1-v,1-n,1-v,1-P,1-o,1-P]),(S===i.c.FLIP_ROW&&G%2===1||S===i.c.FLIP_TILE&&G%2===0)&&(q=[1-o,n,1-v,n,1-v,P,1-o,P]),(S===i.c.FLIP_N_ROTATE_ROW&&G%2===1||S===i.c.FLIP_N_ROTATE_TILE&&G%2===0)&&(q=[o,1-n,v,1-n,v,1-P,o,1-P]),E=E.concat(q),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&K&&(C.push(L+l,T+j,0),C.push(f+l,T+j,0),C.push(f+l,my+j,0),C.push(L+l,my+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,o=0,n=0,v=u/I,P=p/V,q=[o,n,v,n,v,P,o,P],(S===i.c.ROTATE_ROW&&G%2===1||S===i.c.ROTATE_TILE&&(G+J)%2===1)&&(q=[1-o,1-n,1-v,1-n,1-v,1-P,1-o,1-P]),(S===i.c.FLIP_ROW&&G%2===1||S===i.c.FLIP_TILE&&(G+J)%2===1)&&(q=[1-o,n,1-v,n,1-v,P,1-o,P]),(S===i.c.FLIP_N_ROTATE_ROW&&G%2===1||S===i.c.FLIP_N_ROTATE_TILE&&(G+J)%2===1)&&(q=[o,1-n,v,1-n,v,1-P,o,1-P]),E=E.concat(q),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y){const y=[];o=0,n=1-p/V,v=1,P=1,y[0]=[o,n,v,n,v,P,o,P],y[1]=[o,n,v,n,v,P,o,P],S!==i.c.ROTATE_TILE&&S!==i.c.ROTATE_ROW||(y[1]=[1-o,1-n,1-v,1-n,1-v,1-P,1-o,1-P]),S!==i.c.FLIP_TILE&&S!==i.c.FLIP_ROW||(y[1]=[1-o,n,1-v,n,1-v,P,1-o,P]),S!==i.c.FLIP_N_ROTATE_TILE&&S!==i.c.FLIP_N_ROTATE_ROW||(y[1]=[o,1-n,v,1-n,v,1-P,o,1-P]);for(let V=0;V<J;V++)C.push(V*I-L+l,O+j,0),C.push((V+1)*I-L+l,O+j,0),C.push((V+1)*I-L+l,O+p+j,0),C.push(V*I-L+l,O+p+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,E=S===i.c.FLIP_TILE||S===i.c.ROTATE_TILE||S===i.c.FLIP_N_ROTATE_TILE?E.concat(y[(V+1)%2]):S===i.c.FLIP_ROW||S===i.c.ROTATE_ROW||S===i.c.FLIP_N_ROTATE_ROW?E.concat(y[1]):E.concat(y[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const y=[];o=0,n=0,v=1,P=p/V,y[0]=[o,n,v,n,v,P,o,P],y[1]=[o,n,v,n,v,P,o,P],S!==i.c.ROTATE_TILE&&S!==i.c.ROTATE_ROW||(y[1]=[1-o,1-n,1-v,1-n,1-v,1-P,1-o,1-P]),S!==i.c.FLIP_TILE&&S!==i.c.FLIP_ROW||(y[1]=[1-o,n,1-v,n,1-v,P,1-o,P]),S!==i.c.FLIP_N_ROTATE_TILE&&S!==i.c.FLIP_N_ROTATE_ROW||(y[1]=[o,1-n,v,1-n,v,1-P,o,1-P]);for(let V=0;V<J;V++)C.push(V*I-L+l,my-p+j,0),C.push((V+1)*I-L+l,my-p+j,0),C.push((V+1)*I-L+l,my+j,0),C.push(V*I-L+l,my+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,E=S===i.c.FLIP_TILE||S===i.c.ROTATE_TILE||S===i.c.FLIP_N_ROTATE_TILE?E.concat(y[(V+G)%2]):S===i.c.FLIP_ROW||S===i.c.ROTATE_ROW||S===i.c.FLIP_N_ROTATE_ROW?E.concat(y[G%2]):E.concat(y[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const y=[];o=1-u/I,n=0,v=1,P=1,y[0]=[o,n,v,n,v,P,o,P],y[1]=[o,n,v,n,v,P,o,P],S!==i.c.ROTATE_TILE&&S!==i.c.ROTATE_ROW||(y[1]=[1-o,1-n,1-v,1-n,1-v,1-P,1-o,1-P]),S!==i.c.FLIP_TILE&&S!==i.c.FLIP_ROW||(y[1]=[1-o,n,1-v,n,1-v,P,1-o,P]),S!==i.c.FLIP_N_ROTATE_TILE&&S!==i.c.FLIP_N_ROTATE_ROW||(y[1]=[o,1-n,v,1-n,v,1-P,o,1-P]);for(let I=0;I<G;I++)C.push(s+l,I*V-T+j,0),C.push(s+u+l,I*V-T+j,0),C.push(s+u+l,(I+1)*V-T+j,0),C.push(s+l,(I+1)*V-T+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,E=S===i.c.FLIP_TILE||S===i.c.ROTATE_TILE||S===i.c.FLIP_N_ROTATE_TILE?E.concat(y[(I+1)%2]):S===i.c.FLIP_ROW||S===i.c.ROTATE_ROW||S===i.c.FLIP_N_ROTATE_ROW?E.concat(y[I%2]):E.concat(y[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(K){const y=[];o=0,n=0,v=u/V,P=1,y[0]=[o,n,v,n,v,P,o,P],y[1]=[o,n,v,n,v,P,o,P],S!==i.c.ROTATE_TILE&&S!==i.c.ROTATE_ROW||(y[1]=[1-o,1-n,1-v,1-n,1-v,1-P,1-o,1-P]),S!==i.c.FLIP_TILE&&S!==i.c.FLIP_ROW||(y[1]=[1-o,n,1-v,n,1-v,P,1-o,P]),S!==i.c.FLIP_N_ROTATE_TILE&&S!==i.c.FLIP_N_ROTATE_ROW||(y[1]=[o,1-n,v,1-n,v,1-P,o,1-P]);for(let I=0;I<G;I++)C.push(f-u+l,I*V-T+j,0),C.push(f+l,I*V-T+j,0),C.push(f+l,(I+1)*V-T+j,0),C.push(f-u+l,(I+1)*V-T+j,0),r.push(h,h+1,h+3,h+1,h+2,h+3),h+=4,E=S===i.c.FLIP_TILE||S===i.c.ROTATE_TILE||S===i.c.FLIP_N_ROTATE_TILE?E.concat(y[(I+J)%2]):S===i.c.FLIP_ROW||S===i.c.ROTATE_ROW||S===i.c.FLIP_N_ROTATE_ROW?E.concat(y[I%2]):E.concat(y[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const n=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE;B.b._ComputeSides(n,C,r,D,E,y.frontUVs,y.backUVs);const v=new B.b;v.indices=r,v.hy=C,v.ny=D,v.Py=E;const P=n===B.b.DOUBLESIDE?z.concat(z):z;return v.vy=P,v}function L(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new i.c(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return p(S).gy(V,S.updatable),V}function T(y){const S=y.faceUV||new Array(6),I=y.faceColors,A=y.pattern||i.c.NO_FLIP,F=y.width||y.size||1,J=y.height||y.size||1,u=y.depth||y.size||1,K=y.tileWidth||y.tileSize||1,L=y.tileHeight||y.tileSize||1,T=y.alignHorizontal||0,l=y.alignVertical||0,j=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE;for(let i=0;i<6;i++)void 0===S[i]&&(S[i]=new V.Vector4(0,0,1,1)),I&&void 0===I[i]&&(I[i]=new G.vd(1,1,1,1));const s=F/2,O=J/2,f=u/2,my=[];for(let V=0;V<2;V++)my[V]=p({pattern:A,tileWidth:K,tileHeight:L,width:F,height:J,alignVertical:l,alignHorizontal:T,sideOrientation:j});for(let V=2;V<4;V++)my[V]=p({pattern:A,tileWidth:K,tileHeight:L,width:u,height:J,alignVertical:l,alignHorizontal:T,sideOrientation:j});let C=l;l===i.c.BOTTOM?C=i.c.TOP:l===i.c.TOP&&(C=i.c.BOTTOM);for(let V=4;V<6;V++)my[V]=p({pattern:A,tileWidth:K,tileHeight:L,width:F,height:u,alignVertical:C,alignHorizontal:T,sideOrientation:j});let D=[],o=[],E=[],z=[];const r=[],h=[],n=[],v=[];let P=0,q=0;for(let i=0;i<6;i++){const y=my[i].hy.length;h[i]=[],n[i]=[];for(let S=0;S<y/3;S++)h[i].push(new V.OS(my[i].hy[3*S],my[i].hy[3*S+1],my[i].hy[3*S+2])),n[i].push(new V.OS(my[i].ny[3*S],my[i].ny[3*S+1],my[i].ny[3*S+2]));P=my[i].Py.length,v[i]=[];for(let I=0;I<P;I+=2)v[i][I]=S[i].x+(S[i].z-S[i].x)*my[i].Py[I],v[i][I+1]=S[i].y+(S[i].w-S[i].y)*my[i].Py[I+1],d.b&&(v[i][I+1]=1-v[i][I+1]);if(E=E.concat(v[i]),z=z.concat(my[i].indices.map((y=>y+q))),q+=h[i].length,I)for(let S=0;S<4;S++)r.push(I[i].r,I[i].g,I[i].b,I[i].a)}const g=new V.OS(0,0,f),k=V.Matrix.RotationY(Math.PI);D=h[0].map((y=>V.OS.TransformNormal(y,k).add(g))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[]),o=n[0].map((y=>V.OS.TransformNormal(y,k))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[]),D=D.concat(h[1].map((y=>y.fS(g))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[])),o=o.concat(n[1].map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[]));const R=new V.OS(s,0,0),b=V.Matrix.RotationY(-Math.PI/2);D=D.concat(h[2].map((y=>V.OS.TransformNormal(y,b).add(R))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[])),o=o.concat(n[2].map((y=>V.OS.TransformNormal(y,b))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[]));const U=V.Matrix.RotationY(Math.PI/2);D=D.concat(h[3].map((y=>V.OS.TransformNormal(y,U).fS(R))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[])),o=o.concat(n[3].map((y=>V.OS.TransformNormal(y,U))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[]));const W=new V.OS(0,O,0),a=V.Matrix.RotationX(Math.PI/2);D=D.concat(h[4].map((y=>V.OS.TransformNormal(y,a).add(W))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[])),o=o.concat(n[4].map((y=>V.OS.TransformNormal(y,a))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[]));const e=V.Matrix.RotationX(-Math.PI/2);D=D.concat(h[5].map((y=>V.OS.TransformNormal(y,e).fS(W))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[])),o=o.concat(n[5].map((y=>V.OS.TransformNormal(y,e))).map((y=>[y.x,y.y,y.z])).reduce(((y,S)=>y.concat(S)),[])),B.b._ComputeSides(j,D,z,o,E);const x=new B.b;if(x.indices=z,x.hy=D,x.ny=o,x.Py=E,I){const y=j===B.b.DOUBLESIDE?r.concat(r):r;x.vy=y}return x}function l(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new i.c(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return T(S).gy(V,S.updatable),V}B.b.CreateTiledPlane=p;B.b.CreateTiledBox=T;var j=I(13703),s=I(12556),O=I(12524);function f(y){const S=y.height||2;let I=0===y.diameterTop?0:y.diameterTop||y.diameter||1,A=0===y.diameterBottom?0:y.diameterBottom||y.diameter||1;I=I||1e-5,A=A||1e-5;const F=0|(y.tessellation||24),J=0|(y.subdivisions||1),u=!!y.hasRings,K=!!y.enclose,p=0===y.cap?0:y.cap||i.c.CAP_ALL,L=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,T=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE,l=y.faceUV||new Array(3),j=y.faceColors,s=2+(1+(1!==L&&K?2:0))*(u?J:1);let f;for(f=0;f<s;f++)j&&void 0===j[f]&&(j[f]=new G.vd(1,1,1,1));for(f=0;f<s;f++)l&&void 0===l[f]&&(l[f]=new V.Vector4(0,0,1,1));const my=[],C=[],D=[],o=[],E=[],z=2*Math.PI*L/F;let r,h,n;const v=(A-I)/2/S,P=V.OS.Zero(),q=V.OS.Zero(),g=V.OS.Zero(),k=V.OS.Zero(),R=V.OS.Zero(),b=O.b.Y;let U,W,a,e=1,x=1,Q=0,c=0;for(U=0;U<=J;U++)for(h=U/J,n=(h*(I-A)+A)/2,e=u&&0!==U&&U!==J?2:1,a=0;a<e;a++){for(u&&(x+=a),K&&(x+=2*a),W=0;W<=F;W++)r=W*z,P.x=Math.cos(-r)*n,P.y=-S/2+h*S,P.z=Math.sin(-r)*n,0===I&&U===J?(q.x=D[D.length-3*(F+1)],q.y=D[D.length-3*(F+1)+1],q.z=D[D.length-3*(F+1)+2]):(q.x=P.x,q.z=P.z,q.y=Math.sqrt(q.x*q.x+q.z*q.z)*v,q.normalize()),0===W&&(g.A(P),k.A(q)),C.push(P.x,P.y,P.z),D.push(q.x,q.y,q.z),c=u?Q!==x?l[x].y:l[x].w:l[x].y+(l[x].w-l[x].y)*h,o.push(l[x].x+(l[x].z-l[x].x)*W/F,d.b?1-c:c),j&&E.push(j[x].r,j[x].g,j[x].b,j[x].a);1!==L&&K&&(C.push(P.x,P.y,P.z),C.push(0,P.y,0),C.push(0,P.y,0),C.push(g.x,g.y,g.z),V.OS.CrossToRef(b,q,R),R.normalize(),D.push(R.x,R.y,R.z,R.x,R.y,R.z),V.OS.CrossToRef(k,b,R),R.normalize(),D.push(R.x,R.y,R.z,R.x,R.y,R.z),c=u?Q!==x?l[x+1].y:l[x+1].w:l[x+1].y+(l[x+1].w-l[x+1].y)*h,o.push(l[x+1].x,d.b?1-c:c),o.push(l[x+1].z,d.b?1-c:c),c=u?Q!==x?l[x+2].y:l[x+2].w:l[x+2].y+(l[x+2].w-l[x+2].y)*h,o.push(l[x+2].x,d.b?1-c:c),o.push(l[x+2].z,d.b?1-c:c),j&&(E.push(j[x+1].r,j[x+1].g,j[x+1].b,j[x+1].a),E.push(j[x+1].r,j[x+1].g,j[x+1].b,j[x+1].a),E.push(j[x+2].r,j[x+2].g,j[x+2].b,j[x+2].a),E.push(j[x+2].r,j[x+2].g,j[x+2].b,j[x+2].a))),Q!==x&&(Q=x)}const X=1!==L&&K?F+4:F;for(U=0,x=0;x<J;x++){let y=0,S=0,I=0,V=0;for(W=0;W<F;W++)y=U*(X+1)+W,S=(U+1)*(X+1)+W,I=U*(X+1)+(W+1),V=(U+1)*(X+1)+(W+1),my.push(y,S,I),my.push(V,I,S);1!==L&&K&&(my.push(y+2,S+2,I+2),my.push(V+2,I+2,S+2),my.push(y+4,S+4,I+4),my.push(V+4,I+4,S+4)),U=u?U+2:U+1}const M=y=>{const i=y?I/2:A/2;if(0===i)return;let B,J,u;const K=y?l[s-1]:l[0];let G=null;j&&(G=y?j[s-1]:j[0]);const p=C.length/3,T=y?S/2:-S/2,O=new V.OS(0,T,0);C.push(O.x,O.y,O.z),D.push(0,y?1:-1,0);const f=K.y+.5*(K.w-K.y);o.push(K.x+.5*(K.z-K.x),d.b?1-f:f),G&&E.push(G.r,G.g,G.b,G.a);const z=new V.Vector2(.5,.5);for(u=0;u<=F;u++){B=2*Math.PI*u*L/F;const S=Math.cos(-B),I=Math.sin(-B);J=new V.OS(S*i,T,I*i);const A=new V.Vector2(S*z.x+.5,I*z.y+.5);C.push(J.x,J.y,J.z),D.push(0,y?1:-1,0);const p=K.y+(K.w-K.y)*A.y;o.push(K.x+(K.z-K.x)*A.x,d.b?1-p:p),G&&E.push(G.r,G.g,G.b,G.a)}for(u=0;u<F;u++)y?(my.push(p),my.push(p+(u+2)),my.push(p+(u+1))):(my.push(p),my.push(p+(u+1)),my.push(p+(u+2)))};p!==i.c.CAP_START&&p!==i.c.CAP_ALL||M(!1),p!==i.c.CAP_END&&p!==i.c.CAP_ALL||M(!0),B.b._ComputeSides(T,C,my,D,o,y.frontUVs,y.backUVs);const t=new B.b;return t.indices=my,t.hy=C,t.ny=D,t.Py=o,j&&(t.vy=E),t}function my(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;const V=new i.c(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return f(S).gy(V,S.updatable),V}function C(y){const S=[],I=[],i=[],A=[],F=y.diameter||1,J=y.thickness||.5,u=0|(y.tessellation||16),K=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE,G=u+1;for(let B=0;B<=u;B++){const y=B/u,K=B*Math.PI*2/u-Math.PI/2,p=V.Matrix.Translation(F/2,0,0).multiply(V.Matrix.RotationY(K));for(let F=0;F<=u;F++){const K=1-F/u,L=F*Math.PI*2/u+Math.PI,T=Math.cos(L),l=Math.sin(L);let j=new V.OS(T,l,0),s=j.scale(J/2);const O=new V.Vector2(y,K);s=V.OS.TransformCoordinates(s,p),j=V.OS.TransformNormal(j,p),I.push(s.x,s.y,s.z),i.push(j.x,j.y,j.z),A.push(O.x,d.b?1-O.y:O.y);const f=(B+1)%G,my=(F+1)%G;S.push(B*G+F),S.push(B*G+my),S.push(f*G+F),S.push(B*G+my),S.push(f*G+my),S.push(f*G+F)}}B.b._ComputeSides(K,I,S,i,A,y.frontUVs,y.backUVs);const p=new B.b;return p.indices=S,p.hy=I,p.ny=i,p.Py=A,p}function D(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;const V=new i.c(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return C(S).gy(V,S.updatable),V}B.b.CreateCylinder=f,i.c.CreateCylinder=(y,S,I,V,A,B,d,F,J)=>{void 0!==d&&d instanceof s.e||(void 0!==d&&(J=F||i.c.DEFAULTSIDE,F=d),d=B,B=1);return my(y,{height:S,diameterTop:I,diameterBottom:V,tessellation:A,subdivisions:B,sideOrientation:J,updatable:F},d)};function o(y){const S=[],I=[],i=[],A=[],F=y.radius||2,J=y.tube||.5,u=y.radialSegments||32,K=y.tubularSegments||32,G=y.p||2,p=y.q||3,L=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE,T=y=>{const S=Math.cos(y),I=Math.sin(y),i=p/G*y,A=Math.cos(i),B=F*(2+A)*.5*S,d=F*(2+A)*I*.5,J=F*Math.sin(i)*.5;return new V.OS(B,d,J)};let l,j;for(l=0;l<=u;l++){const y=l%u/u*2*G*Math.PI,S=T(y),i=T(y+.01),B=i.fS(S);let F=i.add(S);const p=V.OS.Cross(B,F);for(F=V.OS.Cross(p,B),p.normalize(),F.normalize(),j=0;j<K;j++){const y=j%K/K*2*Math.PI,V=-J*Math.cos(y),i=J*Math.sin(y);I.push(S.x+V*F.x+i*p.x),I.push(S.y+V*F.y+i*p.y),I.push(S.z+V*F.z+i*p.z),A.push(l/u),A.push(d.b?1-j/K:j/K)}}for(l=0;l<u;l++)for(j=0;j<K;j++){const y=(j+1)%K,I=l*K+j,V=(l+1)*K+j,i=(l+1)*K+y,A=l*K+y;S.push(A),S.push(V),S.push(I),S.push(A),S.push(i),S.push(V)}B.b.ComputeNormals(I,S,i),B.b._ComputeSides(L,I,S,i,A,y.frontUVs,y.backUVs);const s=new B.b;return s.indices=S,s.hy=I,s.ny=i,s.Py=A,s}function E(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;const V=new i.c(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return o(S).gy(V,S.updatable),V}B.b.CreateTorus=C,i.c.CreateTorus=(y,S,I,V,i,A,B)=>D(y,{diameter:S,thickness:I,tessellation:V,sideOrientation:B,updatable:A},i);B.b.CreateTorusKnot=o,i.c.CreateTorusKnot=(y,S,I,V,i,A,B,d,F,J)=>E(y,{radius:S,tube:I,radialSegments:V,tubularSegments:i,p:A,q:B,sideOrientation:J,updatable:F},d);var z=I(14230),r=I(12871),h=I(12535);function n(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=S.path,A=S.shape,B=S.scale||1,d=S.rotation||0,F=0===S.cap?0:S.cap||i.c.NO_CAP,J=S.updatable,u=i.c._GetDefaultSideOrientation(S.sideOrientation),K=S.instance||null,G=S.invertUV||!1,p=S.closeShape||!1,L=S.closePath||!1,T=S.capFunction||null;return P(y,A,V,B,d,null,null,L,p,F,!1,I,!!J,u,K,G,S.frontUVs||null,S.backUVs||null,S.firstNormal||null,!!S.adjustFrame,T)}function v(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=S.path,A=S.shape,B=S.scaleFunction||(()=>1),d=S.rotationFunction||(()=>0),F=S.closePath||S.ribbonCloseArray||!1,J=S.closeShape||S.ribbonClosePath||!1,u=0===S.cap?0:S.cap||i.c.NO_CAP,K=S.updatable,G=S.firstNormal||null,p=S.adjustFrame||!1,L=i.c._GetDefaultSideOrientation(S.sideOrientation),T=S.instance,l=S.invertUV||!1,j=S.capFunction||null;return P(y,A,V,null,null,B,d,F,J,u,!0,I,!!K,L,T||null,l,S.frontUVs||null,S.backUVs||null,G,p,j||null)}function P(y,S,I,A,B,d,F,u,K,G,p,L,T,l,j,s,O,f,my,C,D){const o=(y,S,I,A,B,d,F,J,u,K,G)=>{const p=I.getTangents(),L=I.getNormals(),T=I.getBinormals(),l=I.getDistances();if(G)for(let i=0;i<p.length;i++)if(0==p[i].x&&0==p[i].y&&0==p[i].z&&p[i].A(p[i-1]),0==L[i].x&&0==L[i].y&&0==L[i].z&&L[i].A(L[i-1]),0==T[i].x&&0==T[i].y&&0==T[i].z&&T[i].A(T[i-1]),i>0){let y=p[i-1];V.OS.Dot(y,p[i])<0&&p[i].scaleInPlace(-1),y=L[i-1],V.OS.Dot(y,L[i])<0&&L[i].scaleInPlace(-1),y=T[i-1],V.OS.Dot(y,T[i])<0&&T[i].scaleInPlace(-1)}let j=0;const s=K&&J?J:()=>null!==d?d:0,O=K&&F?F:()=>null!==B?B:1;let f=u===i.c.NO_CAP||u===i.c.CAP_END?0:2;const my=V.TmpVectors.Matrix[0];for(let i=0;i<S.length;i++){const I=[],B=s(i,l[i]),d=O(i,l[i]);V.Matrix.RotationAxisToRef(p[i],j,my);for(let A=0;A<y.length;A++){const B=p[i].scale(y[A].z).add(L[i].scale(y[A].x)).add(T[i].scale(y[A].y)),F=V.OS.Zero();V.OS.TransformCoordinatesToRef(B,my,F),F.scaleInPlace(d).addInPlace(S[i]),I[A]=F}A[f]=I,j+=B,f++}const C=D||(y=>{const S=Array(),I=V.OS.Zero();let i;for(i=0;i<y.length;i++)I.addInPlace(y[i]);for(I.scaleInPlace(1/y.length),i=0;i<y.length;i++)S.push(I);return S});switch(u){case i.c.NO_CAP:break;case i.c.CAP_START:A[0]=C(A[2]),A[1]=A[2];break;case i.c.CAP_END:A[f]=A[f-1],A[f+1]=C(A[f-1]);break;case i.c.CAP_ALL:A[0]=C(A[2]),A[1]=A[2],A[f]=A[f-1],A[f+1]=C(A[f-1])}return A};let E,z;if(j){const y=j._creationDataStorage;return E=my?y.path3D.update(I,my):y.path3D.update(I),z=o(S,I,y.path3D,y.pathArray,A,B,d,F,y.cap,p,C),j=J("",{pathArray:z,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:j},L||void 0)}E=my?new h.n(I,my):new h.n(I);z=o(S,I,E,new Array,A,B,d,F,G=G<0||G>3?0:G,p,C);const r=J(y,{pathArray:z,closeArray:u,closePath:K,updatable:T,sideOrientation:l,invertUV:s,frontUVs:O||void 0,backUVs:f||void 0},L);return r._creationDataStorage.pathArray=z,r._creationDataStorage.path3D=E,r._creationDataStorage.cap=G,r}function q(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=S.arc?S.arc<=0||S.arc>1?1:S.arc:1,B=void 0===S.closed||S.closed,d=S.shape,F=S.radius||1,u=S.tessellation||64,K=S.clip||0,G=S.updatable,p=i.c._GetDefaultSideOrientation(S.sideOrientation),L=S.cap||i.c.NO_CAP,T=2*Math.PI,l=[],j=S.invertUV||!1;let s=0,O=0;const f=T/u*A;let my,C;for(s=0;s<=u-K;s++){for(C=[],L!=i.c.CAP_START&&L!=i.c.CAP_ALL||(C.push(new V.OS(0,d[0].y,0)),C.push(new V.OS(Math.cos(s*f)*d[0].x*F,d[0].y,Math.sin(s*f)*d[0].x*F))),O=0;O<d.length;O++)my=new V.OS(Math.cos(s*f)*d[O].x*F,d[O].y,Math.sin(s*f)*d[O].x*F),C.push(my);L!=i.c.CAP_END&&L!=i.c.CAP_ALL||(C.push(new V.OS(Math.cos(s*f)*d[d.length-1].x*F,d[d.length-1].y,Math.sin(s*f)*d[d.length-1].x*F)),C.push(new V.OS(0,d[d.length-1].y,0))),l.push(C)}return J(y,{pathArray:l,closeArray:B,sideOrientation:p,updatable:G,invertUV:j,frontUVs:S.frontUVs,backUVs:S.backUVs},I)}i.c.ExtrudeShape=function(y,S,I,V,A,B){let d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0;return n(y,{shape:S,path:I,scale:V,rotation:A,cap:0===B?0:B||i.c.NO_CAP,sideOrientation:J,instance:u,updatable:F},d)},i.c.ExtrudeShapeCustom=(y,S,I,V,A,B,d,F,J,u,K,G)=>v(y,{shape:S,path:I,scaleFunction:V,rotationFunction:A,ribbonCloseArray:B,ribbonClosePath:d,cap:0===F?0:F||i.c.NO_CAP,sideOrientation:K,instance:G,updatable:u},J);i.c.CreateLathe=(y,S,I,V,i,A,B)=>q(y,{shape:S,radius:I,tessellation:V,sideOrientation:B,updatable:A},i);var g=I(13611),k=I(13558);function R(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=S.path;let B=S.instance,d=1;void 0!==S.radius?d=S.radius:B&&(d=B._creationDataStorage.radius);const F=S.tessellation||64,u=S.radiusFunction||null;let K=S.cap||i.c.NO_CAP;const G=S.invertUV||!1,p=S.updatable,L=i.c._GetDefaultSideOrientation(S.sideOrientation);S.arc=S.arc&&(S.arc<=0||S.arc>1)?1:S.arc||1;const T=(y,S,I,A,B,d,F,J)=>{const u=S.getTangents(),K=S.getNormals(),G=S.getDistances(),p=2*Math.PI/B*J,L=d||(()=>A);let T,l,j,s;const O=V.TmpVectors.Matrix[0];let f=F===i.c.NO_CAP||F===i.c.CAP_END?0:2;for(let i=0;i<y.length;i++){l=L(i,G[i]),T=Array(),j=K[i];for(let S=0;S<B;S++)V.Matrix.RotationAxisToRef(u[i],p*S,O),s=T[S]?T[S]:V.OS.Zero(),V.OS.TransformCoordinatesToRef(j,O,s),s.scaleInPlace(l).addInPlace(y[i]),T[S]=s;I[f]=T,f++}const my=(S,I)=>{const V=Array();for(let i=0;i<S;i++)V.push(y[I]);return V};switch(F){case i.c.NO_CAP:break;case i.c.CAP_START:I[0]=my(B,0),I[1]=I[2].slice(0);break;case i.c.CAP_END:I[f]=I[f-1].slice(0),I[f+1]=my(B,y.length-1);break;case i.c.CAP_ALL:I[0]=my(B,0),I[1]=I[2].slice(0),I[f]=I[f-1].slice(0),I[f+1]=my(B,y.length-1)}return I};let l,j;if(B){const y=B._creationDataStorage,I=S.arc||y.arc;return l=y.path3D.update(A),j=T(A,l,y.pathArray,d,y.tessellation,u,y.cap,I),B=J("",{pathArray:j,instance:B}),y.path3D=l,y.pathArray=j,y.arc=I,y.radius=d,B}l=new h.n(A);K=K<0||K>3?0:K,j=T(A,l,new Array,d,F,u,K,S.arc);const s=J(y,{pathArray:j,closePath:!0,closeArray:!1,updatable:p,sideOrientation:L,invertUV:G,frontUVs:S.frontUVs,backUVs:S.backUVs},I);return s._creationDataStorage.pathArray=j,s._creationDataStorage.path3D=l,s._creationDataStorage.tessellation=F,s._creationDataStorage.cap=K,s._creationDataStorage.arc=S.arc,s._creationDataStorage.radius=d,s}function b(y){const S=[];S[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},S[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},S[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},S[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},S[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},S[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},S[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},S[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},S[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},S[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},S[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},S[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},S[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},S[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},S[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const I=y.type&&(y.type<0||y.type>=S.length)?0:y.type||0,i=y.size,A=y.sizeX||i||1,F=y.sizeY||i||1,J=y.sizeZ||i||1,u=y.custom||S[I],K=u.face.length,p=y.faceUV||new Array(K),L=y.faceColors,T=void 0===y.flat||y.flat,l=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE,j=[],s=[],O=[],f=[],my=[];let C=0,D=0;const o=[];let E,z,r,h,n,v,P=0,q=0;if(T)for(q=0;q<K;q++)L&&void 0===L[q]&&(L[q]=new G.vd(1,1,1,1)),p&&void 0===p[q]&&(p[q]=new V.Vector4(0,0,1,1));if(T)for(q=0;q<K;q++){const y=u.face[q].length;for(r=2*Math.PI/y,h=.5*Math.tan(r/2),n=.5,P=0;P<y;P++)j.push(u.vertex[u.face[q][P]][0]*A,u.vertex[u.face[q][P]][1]*F,u.vertex[u.face[q][P]][2]*J),o.push(C),C++,E=p[q].x+(p[q].z-p[q].x)*(.5+h),z=p[q].y+(p[q].w-p[q].y)*(n-.5),f.push(E,d.b?1-z:z),v=h*Math.cos(r)-n*Math.sin(r),n=h*Math.sin(r)+n*Math.cos(r),h=v,L&&my.push(L[q].r,L[q].g,L[q].b,L[q].a);for(P=0;P<y-2;P++)s.push(o[0+D],o[P+2+D],o[P+1+D]);D+=y}else{for(P=0;P<u.vertex.length;P++)j.push(u.vertex[P][0]*A,u.vertex[P][1]*F,u.vertex[P][2]*J),f.push(0,d.b?1:0);for(q=0;q<K;q++)for(P=0;P<u.face[q].length-2;P++)s.push(u.face[q][0],u.face[q][P+2],u.face[q][P+1])}B.b.ComputeNormals(j,s,O),B.b._ComputeSides(l,j,s,O,f,y.frontUVs,y.backUVs);const g=new B.b;return g.hy=j,g.indices=s,g.ny=O,g.Py=f,L&&T&&(g.vy=my),g}function U(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new i.c(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return b(S).gy(V,S.updatable),V}i.c.CreateTube=(y,S,I,V,i,A,B,d,F,J)=>R(y,{path:S,radius:I,tessellation:V,radiusFunction:i,arc:1,cap:A,updatable:d,sideOrientation:F,instance:J},B);function W(y){const S=y.sideOrientation||B.b.DEFAULTSIDE,I=y.radius||1,i=void 0===y.flat||y.flat,A=0|(y.subdivisions||4),F=y.radiusX||I,J=y.radiusY||I,u=y.radiusZ||I,K=(1+Math.sqrt(5))/2,G=[-1,K,-0,1,K,0,-1,-K,0,1,-K,0,0,-1,-K,0,1,-K,0,-1,K,0,1,K,K,0,1,K,0,-1,-K,0,1,-K,0,-1],p=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],L=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],T=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],l=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],j=[],s=[],O=[],f=[];let my=0;const C=new Array(3),D=new Array(3);let o;for(o=0;o<3;o++)C[o]=V.OS.Zero(),D[o]=V.Vector2.Zero();for(let B=0;B<20;B++){for(o=0;o<3;o++){const y=p[3*B+o];C[o].od(G[3*L[y]],G[3*L[y]+1],G[3*L[y]+2]),C[o].normalize(),D[o].od(.134765625*T[2*y]+.05859375+-.0390625*l[B],.2333984375*T[2*y+1]+.025390625+.01953125*l[B])}const y=(y,S,I,B)=>{const K=V.OS.Lerp(C[0],C[2],S/A),G=V.OS.Lerp(C[1],C[2],S/A),p=A===S?C[2]:V.OS.Lerp(K,G,y/(A-S));let L;if(p.normalize(),i){const y=V.OS.Lerp(C[0],C[2],B/A),S=V.OS.Lerp(C[1],C[2],B/A);L=V.OS.Lerp(y,S,I/(A-B))}else L=new V.OS(p.x,p.y,p.z);L.x/=F,L.y/=J,L.z/=u,L.normalize();const T=V.Vector2.Lerp(D[0],D[2],S/A),l=V.Vector2.Lerp(D[1],D[2],S/A),o=A===S?D[2]:V.Vector2.Lerp(T,l,y/(A-S));s.push(p.x*F,p.y*J,p.z*u),O.push(L.x,L.y,L.z),f.push(o.x,d.b?1-o.y:o.y),j.push(my),my++};for(let S=0;S<A;S++)for(let I=0;I+S<A;I++)y(I,S,I+1/3,S+1/3),y(I+1,S,I+1/3,S+1/3),y(I,S+1,I+1/3,S+1/3),I+S+1<A&&(y(I+1,S,I+2/3,S+2/3),y(I+1,S+1,I+2/3,S+2/3),y(I,S+1,I+2/3,S+2/3))}B.b._ComputeSides(S,s,j,O,f,y.frontUVs,y.backUVs);const E=new B.b;return E.indices=j,E.hy=s,E.ny=O,E.Py=f,E}function a(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new i.c(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),V._originalBuilderSideOrientation=S.sideOrientation;return W(S).gy(V,S.updatable),V}B.b.CreatePolyhedron=b,i.c.CreatePolyhedron=(y,S,I)=>U(y,S,I);B.b.CreateIcoSphere=W,i.c.CreateIcoSphere=(y,S,I)=>a(y,S,I);var e=I(12338);const x=new V.OS(1,0,0),Q=new V.OS(-1,0,0),c=new V.OS(0,1,0),X=new V.OS(0,-1,0),M=new V.OS(0,0,1),t=new V.OS(0,0,-1);class N{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.OS.Zero(),S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.OS.Up(),I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.Vector2.Zero(),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=y,this.normal=S,this.uv=I,this.vertexIdx=i,this.vertexIdxForBones=A,this.localPositionOverride=B,this.localNormalOverride=d,this.matrixIndicesOverride=F,this.matrixWeightsOverride=J}clone(){var y,S,I,V;return new N(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(y=this.localPositionOverride)||void 0===y?void 0:y.slice(),null===(S=this.localNormalOverride)||void 0===S?void 0:S.slice(),null===(I=this.matrixIndicesOverride)||void 0===I?void 0:I.slice(),null===(V=this.matrixWeightsOverride)||void 0===V?void 0:V.slice())}}function Y(y,S,I){var F,J,u,K,G;const p=!!S.skeleton,L=!(null===(F=S.morphTargetManager)||void 0===F||!F.numTargets),T=I.localMode||p,l=S.fd(),j=p||L?S.Md(!0,!0):S.getVerticesData(A.e.PositionKind),s=p||L?S.getNormalsData(!0,!0):S.getVerticesData(A.e.NormalKind),O=T?p?S.getVerticesData(A.e.PositionKind):j:null,f=T?p?S.getVerticesData(A.e.NormalKind):s:null,my=S.getVerticesData(A.e.UVKind),C=p?S.getVerticesData(A.e.MatricesIndicesKind):null,D=p?S.getVerticesData(A.e.MatricesWeightsKind):null,o=p?S.getVerticesData(A.e.MatricesIndicesExtraKind):null,E=p?S.getVerticesData(A.e.MatricesWeightsExtraKind):null,z=I.position||V.OS.Zero();let r=I.normal||V.OS.Up();const h=I.size||V.OS.One(),n=I.angle||0;if(!r){const y=new V.OS(0,0,1),I=S.Ey().activeCamera,i=V.OS.TransformCoordinates(y,I.getWorldMatrix());r=I.globalPosition.fS(i)}const v=-Math.atan2(r.z,r.x)-Math.PI/2,P=Math.sqrt(r.x*r.x+r.z*r.z),q=Math.atan2(r.y,P),g=new B.b;g.indices=[],g.hy=[],g.ny=[],g.Py=[],g.matricesIndices=p?[]:null,g.matricesWeights=p?[]:null,g.matricesIndicesExtra=o?[]:null,g.matricesWeightsExtra=E?[]:null;let k=0;const R=(y,S)=>{const i=new N;if(!l||!j||!s)return i;const A=l[y];if(i.vertexIdx=3*A,i.vertexIdxForBones=4*A,i.position=new V.OS(j[3*A],j[3*A+1],j[3*A+2]),V.OS.TransformCoordinatesToRef(i.position,S,i.position),i.normal=new V.OS(s[3*A],s[3*A+1],s[3*A+2]),V.OS.TransformNormalToRef(i.normal,S,i.normal),I.captureUVS&&my){const y=my[2*A+1];i.uv=new V.Vector2(my[2*A],d.b?1-y:y)}return i},b=[0,0,0,0],U=(y,S)=>{if(0===y.length)return y;const I=.5*Math.abs(V.OS.Dot(h,S)),i=(y,S,I,V)=>{for(let i=0;i<V;++i)if(y[I+i]===S)return I+i;return-1},A=(y,A)=>{const B=V.OS.GetClipFactor(y.position,A.position,S,I);let d=b,F=b;if(C&&D){const S=y.matrixIndicesOverride?0:y.vertexIdxForBones,I=y.matrixIndicesOverride??C,V=y.matrixWeightsOverride??D,J=A.matrixIndicesOverride?0:A.vertexIdxForBones,u=A.matrixIndicesOverride??C,K=A.matrixWeightsOverride??D;d=[0,0,0,0],F=[0,0,0,0];let G=0;for(let y=0;y<4;++y)if(V[S+y]>0){const A=i(u,I[S+y],J,4);d[G]=I[S+y],F[G]=(0,e.Lerp)(V[S+y],A>=0?K[A]:0,B),G++}for(let y=0;y<4&&G<4;++y){const V=u[J+y];-1===i(I,V,S,4)&&(d[G]=V,F[G]=(0,e.Lerp)(0,K[J+y],B),G++)}const p=F[0]+F[1]+F[2]+F[3];F[0]/=p,F[1]/=p,F[2]/=p,F[3]/=p}const J=y.localPositionOverride?y.localPositionOverride[0]:(null===O||void 0===O?void 0:O[y.vertexIdx])??0,u=y.localPositionOverride?y.localPositionOverride[1]:(null===O||void 0===O?void 0:O[y.vertexIdx+1])??0,K=y.localPositionOverride?y.localPositionOverride[2]:(null===O||void 0===O?void 0:O[y.vertexIdx+2])??0,G=A.localPositionOverride?A.localPositionOverride[0]:(null===O||void 0===O?void 0:O[A.vertexIdx])??0,p=A.localPositionOverride?A.localPositionOverride[1]:(null===O||void 0===O?void 0:O[A.vertexIdx+1])??0,L=A.localPositionOverride?A.localPositionOverride[2]:(null===O||void 0===O?void 0:O[A.vertexIdx+2])??0,T=y.localNormalOverride?y.localNormalOverride[0]:(null===f||void 0===f?void 0:f[y.vertexIdx])??0,l=y.localNormalOverride?y.localNormalOverride[1]:(null===f||void 0===f?void 0:f[y.vertexIdx+1])??0,j=y.localNormalOverride?y.localNormalOverride[2]:(null===f||void 0===f?void 0:f[y.vertexIdx+2])??0,s=T+((A.localNormalOverride?A.localNormalOverride[0]:(null===f||void 0===f?void 0:f[A.vertexIdx])??0)-T)*B,my=l+((A.localNormalOverride?A.localNormalOverride[1]:(null===f||void 0===f?void 0:f[A.vertexIdx+1])??0)-l)*B,o=j+((A.localNormalOverride?A.localNormalOverride[2]:(null===f||void 0===f?void 0:f[A.vertexIdx+2])??0)-j)*B,E=Math.sqrt(s*s+my*my+o*o);return new N(V.OS.Lerp(y.position,A.position,B),V.OS.Lerp(y.normal,A.normal,B).normalize(),V.Vector2.Lerp(y.uv,A.uv,B),-1,-1,O?[J+(G-J)*B,u+(p-u)*B,K+(L-K)*B]:null,f?[s/E,my/E,o/E]:null,d,F)};let B=null;y.length>3&&(B=[]);for(let d=0;d<y.length;d+=3){let i=0,F=null,J=null,u=null,K=null;const G=V.OS.Dot(y[d].position,S)-I>0,p=V.OS.Dot(y[d+1].position,S)-I>0,L=V.OS.Dot(y[d+2].position,S)-I>0;switch(i=(G?1:0)+(p?1:0)+(L?1:0),i){case 0:y.length>3?(B.push(y[d]),B.push(y[d+1]),B.push(y[d+2])):B=y;break;case 1:if(B=B??new Array,G&&(F=y[d+1],J=y[d+2],u=A(y[d],F),K=A(y[d],J)),p){F=y[d],J=y[d+2],u=A(y[d+1],F),K=A(y[d+1],J),B.push(u),B.push(J.clone()),B.push(F.clone()),B.push(J.clone()),B.push(u.clone()),B.push(K);break}L&&(F=y[d],J=y[d+1],u=A(y[d+2],F),K=A(y[d+2],J)),F&&J&&u&&K&&(B.push(F.clone()),B.push(J.clone()),B.push(u),B.push(K),B.push(u.clone()),B.push(J.clone()));break;case 2:B=B??new Array,G||(F=y[d].clone(),J=A(F,y[d+1]),u=A(F,y[d+2]),B.push(F),B.push(J),B.push(u)),p||(F=y[d+1].clone(),J=A(F,y[d+2]),u=A(F,y[d]),B.push(F),B.push(J),B.push(u)),L||(F=y[d+2].clone(),J=A(F,y[d]),u=A(F,y[d+1]),B.push(F),B.push(J),B.push(u))}}return B},W=S instanceof i.c?S:null,a=null===W||void 0===W?void 0:W._thinInstanceDataStorage.matrixData,Y=(null===W||void 0===W?void 0:W.kd)||1,H=V.TmpVectors.Matrix[0];H.A(V.Matrix.IdentityReadOnly);for(let i=0;i<Y;++i){if(null!==W&&void 0!==W&&W.hasThinInstances&&a){const y=16*i;H.setRowFromFloats(0,a[y+0],a[y+1],a[y+2],a[y+3]),H.setRowFromFloats(1,a[y+4],a[y+5],a[y+6],a[y+7]),H.setRowFromFloats(2,a[y+8],a[y+9],a[y+10],a[y+11]),H.setRowFromFloats(3,a[y+12],a[y+13],a[y+14],a[y+15])}const y=V.Matrix.RotationYawPitchRoll(v,q,n).multiply(V.Matrix.Translation(z.x,z.y,z.z)),A=V.Matrix.Invert(y),B=S.getWorldMatrix(),F=H.multiply(B).multiply(A),J=new Array(3);for(let S=0;S<l.length;S+=3){let y=J;if(y[0]=R(S,F),y[1]=R(S+1,F),y[2]=R(S+2,F),!(I.cullBackFaces&&-y[0].normal.z<=0&&-y[1].normal.z<=0&&-y[2].normal.z<=0)&&(y=U(y,x),y&&(y=U(y,Q),y&&(y=U(y,c),y&&(y=U(y,X),y&&(y=U(y,M),y&&(y=U(y,t),y)))))))for(let S=0;S<y.length;S++){const V=y[S];if(g.indices.push(k),T?(V.localPositionOverride?(g.hy[3*k]=V.localPositionOverride[0],g.hy[3*k+1]=V.localPositionOverride[1],g.hy[3*k+2]=V.localPositionOverride[2]):O&&(g.hy[3*k]=O[V.vertexIdx],g.hy[3*k+1]=O[V.vertexIdx+1],g.hy[3*k+2]=O[V.vertexIdx+2]),V.localNormalOverride?(g.ny[3*k]=V.localNormalOverride[0],g.ny[3*k+1]=V.localNormalOverride[1],g.ny[3*k+2]=V.localNormalOverride[2]):f&&(g.ny[3*k]=f[V.vertexIdx],g.ny[3*k+1]=f[V.vertexIdx+1],g.ny[3*k+2]=f[V.vertexIdx+2])):(V.position.toArray(g.hy,3*k),V.normal.toArray(g.ny,3*k)),g.matricesIndices&&g.matricesWeights&&(V.matrixIndicesOverride?(g.matricesIndices[4*k]=V.matrixIndicesOverride[0],g.matricesIndices[4*k+1]=V.matrixIndicesOverride[1],g.matricesIndices[4*k+2]=V.matrixIndicesOverride[2],g.matricesIndices[4*k+3]=V.matrixIndicesOverride[3]):(C&&(g.matricesIndices[4*k]=C[V.vertexIdxForBones],g.matricesIndices[4*k+1]=C[V.vertexIdxForBones+1],g.matricesIndices[4*k+2]=C[V.vertexIdxForBones+2],g.matricesIndices[4*k+3]=C[V.vertexIdxForBones+3]),o&&g.matricesIndicesExtra&&(g.matricesIndicesExtra[4*k]=o[V.vertexIdxForBones],g.matricesIndicesExtra[4*k+1]=o[V.vertexIdxForBones+1],g.matricesIndicesExtra[4*k+2]=o[V.vertexIdxForBones+2],g.matricesIndicesExtra[4*k+3]=o[V.vertexIdxForBones+3])),V.matrixWeightsOverride?(g.matricesWeights[4*k]=V.matrixWeightsOverride[0],g.matricesWeights[4*k+1]=V.matrixWeightsOverride[1],g.matricesWeights[4*k+2]=V.matrixWeightsOverride[2],g.matricesWeights[4*k+3]=V.matrixWeightsOverride[3]):(D&&(g.matricesWeights[4*k]=D[V.vertexIdxForBones],g.matricesWeights[4*k+1]=D[V.vertexIdxForBones+1],g.matricesWeights[4*k+2]=D[V.vertexIdxForBones+2],g.matricesWeights[4*k+3]=D[V.vertexIdxForBones+3]),E&&g.matricesWeightsExtra&&(g.matricesWeightsExtra[4*k]=E[V.vertexIdxForBones],g.matricesWeightsExtra[4*k+1]=E[V.vertexIdxForBones+1],g.matricesWeightsExtra[4*k+2]=E[V.vertexIdxForBones+2],g.matricesWeightsExtra[4*k+3]=E[V.vertexIdxForBones+3]))),I.captureUVS)V.uv.toArray(g.Py,2*k);else{g.Py.push(.5+V.position.x/h.x);const y=.5+V.position.y/h.y;g.Py.push(d.b?1-y:y)}k++}}}0===g.indices.length&&(g.indices=null),0===g.hy.length&&(g.hy=null),0===g.ny.length&&(g.ny=null),0===g.Py.length&&(g.Py=null),0===(null===(J=g.matricesIndices)||void 0===J?void 0:J.length)&&(g.matricesIndices=null),0===(null===(u=g.matricesWeights)||void 0===u?void 0:u.length)&&(g.matricesWeights=null),0===(null===(K=g.matricesIndicesExtra)||void 0===K?void 0:K.length)&&(g.matricesIndicesExtra=null),0===(null===(G=g.matricesWeightsExtra)||void 0===G?void 0:G.length)&&(g.matricesWeightsExtra=null);const Z=new i.c(y,S.Ey());return g.gy(Z),T?(Z.skeleton=S.skeleton,Z.parent=S):(Z.position=z.clone(),Z.rotation=new V.OS(q,v,n)),Z.sd(!0),Z.refreshBoundingInfo(!0,!0),Z}function H(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const S=0|Math.max(y.subdivisions?y.subdivisions:2,1),I=0|Math.max(y.tessellation?y.tessellation:16,3),i=Math.max(y.height?y.height:1,0),A=Math.max(y.radius?y.radius:.25,0),F=0|Math.max(y.capSubdivisions?y.capSubdivisions:6,1),J=I,u=S,K=Math.max(y.radiusTop?y.radiusTop:A,0),G=Math.max(y.radiusBottom?y.radiusBottom:A,0),p=i-(K+G),L=2*Math.PI,T=Math.max(y.topCapSubdivisions?y.topCapSubdivisions:F,1),l=Math.max(y.bottomCapSubdivisions?y.bottomCapSubdivisions:F,1),j=Math.acos((G-K)/i);let s=[];const O=[],f=[],my=[];let C=0;const D=[],o=.5*p,E=.5*Math.PI;let z,r;const h=V.OS.Zero(),n=V.OS.Zero(),v=Math.cos(j),P=Math.sin(j),q=new V.Vector2(K*P,o+K*v).fS(new V.Vector2(G*P,G*v-o)).length(),g=K*j+q+G*(E-j);let k=0;for(r=0;r<=T;r++){const y=[],S=E-j*(r/T);k+=K*j/T;const I=Math.cos(S),V=Math.sin(S),i=I*K;for(z=0;z<=J;z++){const S=z/J,A=S*L+0,B=Math.sin(A),F=Math.cos(A);n.x=i*B,n.y=o+V*K,n.z=i*F,O.push(n.x,n.y,n.z),h.set(I*B,V,I*F),f.push(h.x,h.y,h.z),my.push(S,d.b?k/g:1-k/g),y.push(C),C++}D.push(y)}const R=i-K-G+v*K-v*G,b=P*(G-K)/R;for(r=1;r<=u;r++){const y=[];k+=q/u;const S=P*(r*(G-K)/u+K);for(z=0;z<=J;z++){const I=z/J,V=I*L+0,i=Math.sin(V),A=Math.cos(V);n.x=S*i,n.y=o+v*K-r*R/u,n.z=S*A,O.push(n.x,n.y,n.z),h.set(i,b,A).normalize(),f.push(h.x,h.y,h.z),my.push(I,d.b?k/g:1-k/g),y.push(C),C++}D.push(y)}for(r=1;r<=l;r++){const y=[],S=E-j-(Math.PI-j)*(r/l);k+=G*j/l;const I=Math.cos(S),V=Math.sin(S),i=I*G;for(z=0;z<=J;z++){const S=z/J,A=S*L+0,B=Math.sin(A),F=Math.cos(A);n.x=i*B,n.y=V*G-o,n.z=i*F,O.push(n.x,n.y,n.z),h.set(I*B,V,I*F),f.push(h.x,h.y,h.z),my.push(S,d.b?k/g:1-k/g),y.push(C),C++}D.push(y)}for(z=0;z<J;z++)for(r=0;r<T+u+l;r++){const y=D[r][z],S=D[r+1][z],I=D[r+1][z+1],V=D[r][z+1];s.push(y),s.push(S),s.push(V),s.push(S),s.push(I),s.push(V)}if(s=s.reverse(),y.orientation&&!y.orientation.equals(V.OS.Up())){const S=new V.Matrix;y.orientation.clone().scale(.5*Math.PI).cross(V.OS.Up()).toQuaternion().toRotationMatrix(S);const I=V.OS.Zero();for(let y=0;y<O.length;y+=3)I.set(O[y],O[y+1],O[y+2]),V.OS.TransformCoordinatesToRef(I.clone(),S,I),O[y]=I.x,O[y+1]=I.y,O[y+2]=I.z}const U=new B.b;return U.hy=O,U.ny=f,U.Py=my,U.indices=s,U}function Z(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:V.OS.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new i.c(y,I);return H(S).gy(A,S.updatable),A}i.c.CreateDecal=(y,S,I,V,i,A)=>Y(y,S,{position:I,normal:V,size:i,angle:A});i.c.CreateCapsule=(y,S,I)=>Z(y,S,I),B.b.CreateCapsule=H;var w=I(12151),yy=I(12325);class Sy{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=y,this.y=S,y!==Math.floor(y)&&(y=Math.floor(y),w.b.Warn("x is not an integer, floor(x) used")),S!==Math.floor(S)&&(S=Math.floor(S),w.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Sy(this.x,this.y)}rotate60About(y){const S=this.x;return this.x=y.x+y.y-this.y,this.y=S+this.y-y.x,this}rotateNeg60About(y){const S=this.x;return this.x=S+this.y-y.y,this.y=y.x+y.y-S,this}rotate120(y,S){y!==Math.floor(y)&&(y=Math.floor(y),w.b.Warn("m not an integer only floor(m) used")),S!==Math.floor(S)&&(S=Math.floor(S),w.b.Warn("n not an integer only floor(n) used"));const I=this.x;return this.x=y-I-this.y,this.y=S+I,this}rotateNeg120(y,S){y!==Math.floor(y)&&(y=Math.floor(y),w.b.Warn("m is not an integer, floor(m) used")),S!==Math.floor(S)&&(S=Math.floor(S),w.b.Warn("n is not an integer,   floor(n) used"));const I=this.x;return this.x=this.y-S,this.y=y+S-I-this.y,this}toCartesianOrigin(y,S){const I=V.OS.Zero();return I.x=y.x+2*this.x*S+this.y*S,I.y=y.y+Math.sqrt(3)*this.y*S,I}static Zero(){return new Sy(0,0)}}class Iy{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Vy("icosahedron","Regular",[[0,yy.f,-1],[-yy.f,1,0],[-1,0,-yy.f],[1,0,-yy.f],[yy.f,1,0],[0,yy.f,1],[-1,0,yy.f],[-yy.f,-1,0],[0,-yy.f,-1],[yy.f,-1,0],[1,0,yy.f],[0,-yy.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let y=12;const S={},I=this.m,V=this.n;let i,A,B,d,F,J=I,u=1,K=0;0!==V&&(J=(0,e.HighestCommonFactor)(I,V)),u=I/J,K=V/J;const G=Sy.Zero(),p=new Sy(I,V),L=new Sy(-V,I+V),T=Sy.Zero(),l=Sy.Zero(),j=Sy.Zero();let s,O,f,my,C=[];const D=[],o=this.vertByDist,E=(I,V,i,A)=>{s=I+"|"+i,O=V+"|"+A,s in S||O in S?s in S&&!(O in S)?S[O]=S[s]:O in S&&!(s in S)&&(S[s]=S[O]):(S[s]=y,S[O]=y,y++),o[i][0]>2?D[S[s]]=[-o[i][0],o[i][1],S[s]]:D[S[s]]=[C[o[i][0]],o[i][1],S[s]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let z=0;z<20;z++){if(C=this.IDATA.face[z],B=C[2],d=C[1],F=C[0],f=G.x+"|"+G.y,s=z+"|"+f,s in S||(S[s]=B,D[B]=[C[o[f][0]],o[f][1]]),f=p.x+"|"+p.y,s=z+"|"+f,s in S||(S[s]=d,D[d]=[C[o[f][0]],o[f][1]]),f=L.x+"|"+L.y,s=z+"|"+f,s in S||(S[s]=F,D[F]=[C[o[f][0]],o[f][1]]),i=this.IDATA.edgematch[z][0],A=this.IDATA.edgematch[z][1],"B"===A)for(let y=1;y<J;y++)l.x=I-y*(u+K),l.y=V+y*u,j.x=-y*K,j.y=y*(u+K),f=l.x+"|"+l.y,my=j.x+"|"+j.y,E(z,i,f,my);if("O"===A)for(let y=1;y<J;y++)j.x=-y*K,j.y=y*(u+K),T.x=y*u,T.y=y*K,f=j.x+"|"+j.y,my=T.x+"|"+T.y,E(z,i,f,my);if(i=this.IDATA.edgematch[z][2],A=this.IDATA.edgematch[z][3],A&&"A"===A)for(let y=1;y<J;y++)T.x=y*u,T.y=y*K,l.x=I-(J-y)*(u+K),l.y=V+(J-y)*u,f=T.x+"|"+T.y,my=l.x+"|"+l.y,E(z,i,f,my);for(let I=0;I<this.vertices.length;I++)f=this.vertices[I].x+"|"+this.vertices[I].y,s=z+"|"+f,s in S||(S[s]=y++,o[f][0]>2?D[S[s]]=[-o[f][0],o[f][1],S[s]]:D[S[s]]=[C[o[f][0]],o[f][1],S[s]])}this.closestTo=D,this.vecToidx=S}calcCoeffs(){const y=this.m,S=this.n,I=Math.sqrt(3)/3,V=y*y+S*S+y*S;this.coau=(y+S)/V,this.cobu=-S/V,this.coav=-I*(y-S)/V,this.cobv=I*(2*y+S)/V}createInnerFacets(){const y=this.m,S=this.n;for(let I=0;I<S+y+1;I++)for(let y=this.min[I];y<this.max[I]+1;y++)y<this.max[I]&&y<this.max[I+1]+1&&this.innerFacets.push(["|"+y+"|"+I,"|"+y+"|"+(I+1),"|"+(y+1)+"|"+I]),I>0&&y<this.max[I-1]&&y+1<this.max[I]+1&&this.innerFacets.push(["|"+y+"|"+I,"|"+(y+1)+"|"+I,"|"+(y+1)+"|"+(I-1)])}edgeVecsABOB(){const y=this.m,S=this.n,I=new Sy(-S,y+S);for(let V=1;V<y+S;V++){const y=new Sy(this.min[V],V),S=new Sy(this.min[V-1],V-1),i=new Sy(this.min[V+1],V+1),A=y.clone(),B=S.clone(),d=i.clone();A.rotate60About(I),B.rotate60About(I),d.rotate60About(I);const F=new Sy(this.max[A.y],A.y),J=new Sy(this.max[A.y-1],A.y-1),u=new Sy(this.max[A.y-1]-1,A.y-1);A.x===F.x&&A.y===F.y||(A.x!==J.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,J,u]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,u,F])):A.y===d.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([y,S,J]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([y,J,i])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([y,S,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,J,F])))}}mapABOBtoOBOA(){const y=new Sy(0,0);for(let S=0;S<this.isoVecsABOB.length;S++){const I=[];for(let V=0;V<3;V++)y.x=this.isoVecsABOB[S][V].x,y.y=this.isoVecsABOB[S][V].y,0===this.vertexTypes[S][V]&&y.rotateNeg120(this.m,this.n),I.push(y.clone());this.isoVecsOBOA.push(I)}}mapABOBtoBAOA(){const y=new Sy(0,0);for(let S=0;S<this.isoVecsABOB.length;S++){const I=[];for(let V=0;V<3;V++)y.x=this.isoVecsABOB[S][V].x,y.y=this.isoVecsABOB[S][V].y,1===this.vertexTypes[S][V]&&y.rotate120(this.m,this.n),I.push(y.clone());this.isoVecsBAOA.push(I)}}MapToFace(y,S){const I=this.IDATA.face[y],i=I[2],A=I[1],B=I[0],d=V.OS.oS(this.IDATA.vertex[i]),F=V.OS.oS(this.IDATA.vertex[A]),J=V.OS.oS(this.IDATA.vertex[B]),u=F.fS(d),K=J.fS(d),G=u.scale(this.coau).add(K.scale(this.cobu)),p=u.scale(this.coav).add(K.scale(this.cobv)),L=[];let T,l=V.TmpVectors.OS[0];for(let V=0;V<this.cartesian.length;V++)l=G.scale(this.cartesian[V].x).add(p.scale(this.cartesian[V].y)).add(d),L[V]=[l.x,l.y,l.z],T=y+"|"+this.vertices[V].x+"|"+this.vertices[V].y,S.vertex[this.vecToidx[T]]=[l.x,l.y,l.z]}build(y,S){const I=[],V=Sy.Zero(),i=new Sy(y,S),A=new Sy(-S,y+S);I.push(V,i,A);for(let f=S;f<y+1;f++)for(let S=0;S<y+1-f;S++)I.push(new Sy(S,f));if(S>0){const V=(0,e.HighestCommonFactor)(y,S),i=y/V,A=S/V;for(let d=1;d<V;d++)I.push(new Sy(d*i,d*A)),I.push(new Sy(-d*A,d*(i+A))),I.push(new Sy(y-d*(i+A),S+d*i));const B=y/S;for(let d=1;d<S;d++)for(let V=0;V<d*B;V++)I.push(new Sy(V,d)),I.push(new Sy(V,d).rotate120(y,S)),I.push(new Sy(V,d).rotateNeg120(y,S))}I.sort(((y,S)=>y.x-S.x)),I.sort(((y,S)=>y.y-S.y));const B=new Array(y+S+1),d=new Array(y+S+1);for(let f=0;f<B.length;f++)B[f]=1/0,d[f]=-1/0;let F=0,J=0;const u=I.length;for(let f=0;f<u;f++)J=I[f].x,F=I[f].y,B[F]=Math.min(J,B[F]),d[F]=Math.max(J,d[F]);const K=(I,V)=>{const i=I.clone();return"A"===V&&i.rotateNeg120(y,S),"B"===V&&i.rotate120(y,S),i.x<0?i.y:i.x+i.y},G=[],p=[],L=[],T=[],l={},j=[];let s=-1,O=-1;for(let f=0;f<u;f++)G[f]=I[f].toCartesianOrigin(new Sy(0,0),.5),p[f]=K(I[f],"O"),L[f]=K(I[f],"A"),T[f]=K(I[f],"B"),p[f]===L[f]&&L[f]===T[f]?(s=3,O=p[f]):p[f]===L[f]?(s=4,O=p[f]):L[f]===T[f]?(s=5,O=L[f]):T[f]===p[f]&&(s=6,O=p[f]),p[f]<L[f]&&p[f]<T[f]&&(s=2,O=p[f]),L[f]<p[f]&&L[f]<T[f]&&(s=1,O=L[f]),T[f]<L[f]&&T[f]<p[f]&&(s=0,O=T[f]),j.push([s,O,I[f].x,I[f].y]);j.sort(((y,S)=>y[2]-S[2])),j.sort(((y,S)=>y[3]-S[3])),j.sort(((y,S)=>y[1]-S[1])),j.sort(((y,S)=>y[0]-S[0]));for(let f=0;f<j.length;f++)l[j[f][2]+"|"+j[f][3]]=[j[f][0],j[f][1],f];return this.m=y,this.n=S,this.vertices=I,this.vertByDist=l,this.cartesian=G,this.min=B,this.max=d,this}}class Vy{constructor(y,S,I,V){this.name=y,this.category=S,this.vertex=I,this.face=V}}class iy extends Vy{innerToData(y,S){for(let I=0;I<S.innerFacets.length;I++)this.face.push(S.innerFacets[I].map((I=>S.vecToidx[y+I])))}mapABOBtoDATA(y,S){const I=S.IDATA.edgematch[y][0];for(let V=0;V<S.isoVecsABOB.length;V++){const i=[];for(let A=0;A<3;A++)0===S.vertexTypes[V][A]?i.push(y+"|"+S.isoVecsABOB[V][A].x+"|"+S.isoVecsABOB[V][A].y):i.push(I+"|"+S.isoVecsABOB[V][A].x+"|"+S.isoVecsABOB[V][A].y);this.face.push([S.vecToidx[i[0]],S.vecToidx[i[1]],S.vecToidx[i[2]]])}}mapOBOAtoDATA(y,S){const I=S.IDATA.edgematch[y][0];for(let V=0;V<S.isoVecsOBOA.length;V++){const i=[];for(let A=0;A<3;A++)1===S.vertexTypes[V][A]?i.push(y+"|"+S.isoVecsOBOA[V][A].x+"|"+S.isoVecsOBOA[V][A].y):i.push(I+"|"+S.isoVecsOBOA[V][A].x+"|"+S.isoVecsOBOA[V][A].y);this.face.push([S.vecToidx[i[0]],S.vecToidx[i[1]],S.vecToidx[i[2]]])}}mapBAOAtoDATA(y,S){const I=S.IDATA.edgematch[y][2];for(let V=0;V<S.isoVecsBAOA.length;V++){const i=[];for(let A=0;A<3;A++)1===S.vertexTypes[V][A]?i.push(y+"|"+S.isoVecsBAOA[V][A].x+"|"+S.isoVecsBAOA[V][A].y):i.push(I+"|"+S.isoVecsBAOA[V][A].x+"|"+S.isoVecsBAOA[V][A].y);this.face.push([S.vecToidx[i[0]],S.vecToidx[i[1]],S.vecToidx[i[2]]])}}orderData(y){const S=[];for(let A=0;A<13;A++)S[A]=[];const I=y.closestTo;for(let A=0;A<I.length;A++)I[A][0]>-1?I[A][1]>0&&S[I[A][0]].push([A,I[A][1]]):S[12].push([A,I[A][0]]);const V=[];for(let A=0;A<12;A++)V[A]=A;let i=12;for(let A=0;A<12;A++){S[A].sort(((y,S)=>y[1]-S[1]));for(let y=0;y<S[A].length;y++)V[S[A][y][0]]=i++}for(let A=0;A<S[12].length;A++)V[S[12][A][0]]=i++;for(let A=0;A<this.vertex.length;A++)this.vertex[A].push(V[A]);this.vertex.sort(((y,S)=>y[3]-S[3]));for(let A=0;A<this.vertex.length;A++)this.vertex[A].pop();for(let A=0;A<this.face.length;A++)for(let y=0;y<this.face[A].length;y++)this.face[A][y]=V[this.face[A][y]];this.sharedNodes=S[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(y,S){const I=[],V=[];let i=S.pop();V.push(i);let A=this.face[i].indexOf(y);A=(A+2)%3;let B=this.face[i][A];I.push(B);let d=0;for(;S.length>0;)i=S[d],this.face[i].indexOf(B)>-1?(A=(this.face[i].indexOf(B)+1)%3,B=this.face[i][A],I.push(B),V.push(i),S.splice(d,1),d=0):d++;return this.adjacentFaces.push(I),V}toGoldbergPolyhedronData(){const y=new Vy("GeoDual","Goldberg",[],[]);y.name="GD dual";const S=this.vertex.length,I=new Array(S);for(let F=0;F<S;F++)I[F]=[];for(let F=0;F<this.face.length;F++)for(let y=0;y<3;y++)I[this.face[F][y]].push(F);let V=0,i=0,A=0,B=[],d=[];this.adjacentFaces=[];for(let F=0;F<I.length;F++){y.face[F]=this.setOrder(F,I[F].concat([]));for(const S of I[F]){V=0,i=0,A=0,B=this.face[S];for(let y=0;y<3;y++)d=this.vertex[B[y]],V+=d[0],i+=d[1],A+=d[2];y.vertex[S]=[V/3,i/3,A/3]}}return y}static BuildGeodesicData(y){const S=new iy("Geodesic-m-n","Geodesic",[[0,yy.f,-1],[-yy.f,1,0],[-1,0,-yy.f],[1,0,-yy.f],[yy.f,1,0],[0,yy.f,1],[-1,0,yy.f],[-yy.f,-1,0],[0,-yy.f,-1],[yy.f,-1,0],[1,0,yy.f],[0,-yy.f,1]],[]);y.setIndices(),y.calcCoeffs(),y.createInnerFacets(),y.edgeVecsABOB(),y.mapABOBtoOBOA(),y.mapABOBtoBAOA();for(let I=0;I<y.IDATA.face.length;I++)y.MapToFace(I,S),S.innerToData(I,y),"B"===y.IDATA.edgematch[I][1]&&S.mapABOBtoDATA(I,y),"O"===y.IDATA.edgematch[I][1]&&S.mapOBOAtoDATA(I,y),"A"===y.IDATA.edgematch[I][3]&&S.mapBAOAtoDATA(I,y);S.orderData(y);return S.vertex=S.vertex.map((function(y){const S=y[0],I=y[1],V=y[2],i=Math.sqrt(S*S+I*I+V*V);return y[0]*=1/i,y[1]*=1/i,y[2]*=1/i,y})),S}}i.c._GoldbergMeshParser=(y,S)=>Ay.Parse(y,S);class Ay extends i.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(y,S){return void 0===S?(y>this.goldbergData.nbUnsharedFaces-1&&(w.b.Warn("Maximum number of unshared faces used"),y=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+y):(y>11&&(w.b.Warn("Last pole used"),y=11),S>this.goldbergData.nbFacesAtPole-1&&(w.b.Warn("Maximum number of faces at a pole used"),S=this.goldbergData.nbFacesAtPole-1),12+y*this.goldbergData.nbFacesAtPole+S)}_changeGoldbergFaceColors(y){for(let I=0;I<y.length;I++){const S=y[I][0],V=y[I][1],i=y[I][2];for(let y=S;y<V+1;y++)this.goldbergData.faceColors[y]=i}const S=[];for(let I=0;I<12;I++)for(let y=0;y<5;y++)S.push(this.goldbergData.faceColors[I].r,this.goldbergData.faceColors[I].g,this.goldbergData.faceColors[I].b,this.goldbergData.faceColors[I].a);for(let I=12;I<this.goldbergData.faceColors.length;I++)for(let y=0;y<6;y++)S.push(this.goldbergData.faceColors[I].r,this.goldbergData.faceColors[I].g,this.goldbergData.faceColors[I].b,this.goldbergData.faceColors[I].a);return S}setGoldbergFaceColors(y){const S=this._changeGoldbergFaceColors(y);this.Uy(A.e.ColorKind,S)}updateGoldbergFaceColors(y){const S=this._changeGoldbergFaceColors(y);this.updateVerticesData(A.e.ColorKind,S)}_changeGoldbergFaceUVs(y){const S=this.getVerticesData(A.e.UVKind);for(let I=0;I<y.length;I++){const V=y[I][0],i=y[I][1],A=y[I][2],B=y[I][3],d=y[I][4],F=[],J=[];let u,K;for(let y=0;y<5;y++)u=A.x+B*Math.cos(d+y*Math.PI/2.5),K=A.y+B*Math.sin(d+y*Math.PI/2.5),u<0&&(u=0),u>1&&(u=1),F.push(u,K);for(let y=0;y<6;y++)u=A.x+B*Math.cos(d+y*Math.PI/3),K=A.y+B*Math.sin(d+y*Math.PI/3),u<0&&(u=0),u>1&&(u=1),J.push(u,K);for(let y=V;y<Math.min(12,i+1);y++)for(let I=0;I<5;I++)S[10*y+2*I]=F[2*I],S[10*y+2*I+1]=F[2*I+1];for(let y=Math.max(12,V);y<i+1;y++)for(let I=0;I<6;I++)S[12*y-24+2*I]=J[2*I],S[12*y-23+2*I]=J[2*I+1]}return S}setGoldbergFaceUVs(y){const S=this._changeGoldbergFaceUVs(y);this.Uy(A.e.UVKind,S)}updateGoldbergFaceUVs(y){const S=this._changeGoldbergFaceUVs(y);this.updateVerticesData(A.e.UVKind,S)}placeOnGoldbergFaceAt(y,S,I){const i=V.OS.RotationFromAxis(this.goldbergData.faceXaxis[S],this.goldbergData.faceYaxis[S],this.goldbergData.faceZaxis[S]);y.rotation=i,y.position=this.goldbergData.faceCenters[S].add(this.goldbergData.faceXaxis[S].scale(I.x)).add(this.goldbergData.faceYaxis[S].scale(I.y)).add(this.goldbergData.faceZaxis[S].scale(I.z))}serialize(y){super.serialize(y),y.type="GoldbergMesh";const S={};if(S.adjacentFaces=this.goldbergData.adjacentFaces,S.nbSharedFaces=this.goldbergData.nbSharedFaces,S.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,S.nbFaces=this.goldbergData.nbFaces,S.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){S.faceColors=[];for(const y of this.goldbergData.faceColors)S.faceColors.push(y.Vd())}if(this.goldbergData.faceCenters){S.faceCenters=[];for(const y of this.goldbergData.faceCenters)S.faceCenters.push(y.Vd())}if(this.goldbergData.faceZaxis){S.faceZaxis=[];for(const y of this.goldbergData.faceZaxis)S.faceZaxis.push(y.Vd())}if(this.goldbergData.faceYaxis){S.faceYaxis=[];for(const y of this.goldbergData.faceYaxis)S.faceYaxis.push(y.Vd())}if(this.goldbergData.faceXaxis){S.faceXaxis=[];for(const y of this.goldbergData.faceXaxis)S.faceXaxis.push(y.Vd())}y.goldbergData=S}static Parse(y,S){const I=y.goldbergData;I.faceColors=I.faceColors.map((y=>G.vd.oS(y))),I.faceCenters=I.faceCenters.map((y=>V.OS.oS(y))),I.faceZaxis=I.faceZaxis.map((y=>V.OS.oS(y))),I.faceXaxis=I.faceXaxis.map((y=>V.OS.oS(y))),I.faceYaxis=I.faceYaxis.map((y=>V.OS.oS(y)));const i=new Ay(y.name,S);return i.goldbergData=I,i}}var By=I(12869);const dy={CreateBox:K.c,CreateTiledBox:l,CreateSphere:j.b,CreateDisc:u.c,CreateIcoSphere:a,CreateRibbon:J,CreateCylinder:my,CreateTorus:D,CreateTorusKnot:E,CreateLineSystem:z.g,nJ:z.h,CreateDashedLines:z.e,ExtrudeShape:n,ExtrudeShapeCustom:v,CreateLathe:q,CreateTiledPlane:L,qJ:g.e,CreateGround:k.g,CreateTiledGround:k.i,CreateGroundFromHeightMap:k.c,CreatePolygon:r.d,ExtrudePolygon:r.e,CreateTube:R,CreatePolyhedron:U,CreateGeodesic:function(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=S.m||1;V!==Math.floor(V)&&(V=Math.floor(V),w.b.Warn("m not an integer only floor(m) used"));let i=S.n||0;if(i!==Math.floor(i)&&(i=Math.floor(i),w.b.Warn("n not an integer only floor(n) used")),i>V){const y=i;i=V,V=y,w.b.Warn("n > m therefore m and n swapped")}const A=new Iy;return A.build(V,i),U(y,{custom:iy.BuildGeodesicData(A),size:S.size,sizeX:S.sizeX,sizeY:S.sizeY,sizeZ:S.sizeZ,faceUV:S.faceUV,faceColors:S.faceColors,flat:S.flat,updatable:S.updatable,sideOrientation:S.sideOrientation,frontUVs:S.frontUVs,backUVs:S.backUVs},I)},CreateGoldberg:function(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=S.size,F=S.sizeX||A||1,J=S.sizeY||A||1,u=S.sizeZ||A||1;let K=S.m||1;K!==Math.floor(K)&&(K=Math.floor(K),w.b.Warn("m not an integer only floor(m) used"));let p=S.n||0;if(p!==Math.floor(p)&&(p=Math.floor(p),w.b.Warn("n not an integer only floor(n) used")),p>K){const y=p;p=K,K=y,w.b.Warn("n > m therefore m and n swapped")}const L=new Iy;L.build(K,p);const T=iy.BuildGeodesicData(L),l=T.toGoldbergPolyhedronData(),j=new Ay(y,I);S.sideOrientation=i.c._GetDefaultSideOrientation(S.sideOrientation),j._originalBuilderSideOrientation=S.sideOrientation;(function(y,S){const I=y.size,i=y.sizeX||I||1,A=y.sizeY||I||1,F=y.sizeZ||I||1,J=0===y.sideOrientation?0:y.sideOrientation||B.b.DEFAULTSIDE,u=[],K=[],G=[],p=[];let L=1/0,T=-1/0,l=1/0,j=-1/0;for(let V=0;V<S.vertex.length;V++)L=Math.min(L,S.vertex[V][0]*i),T=Math.max(T,S.vertex[V][0]*i),l=Math.min(l,S.vertex[V][1]*A),j=Math.max(j,S.vertex[V][1]*A);let s=0;for(let B=0;B<S.face.length;B++){const y=S.face[B],I=V.OS.oS(S.vertex[y[0]]),J=V.OS.oS(S.vertex[y[2]]),O=V.OS.oS(S.vertex[y[1]]),f=J.fS(I),my=O.fS(I),C=V.OS.Cross(my,f).normalize();for(let V=0;V<y.length;V++){G.push(C.x,C.y,C.z);const I=S.vertex[y[V]];u.push(I[0]*i,I[1]*A,I[2]*F);const B=(I[1]*A-l)/(j-l);p.push((I[0]*i-L)/(T-L),d.b?1-B:B)}for(let S=0;S<y.length-2;S++)K.push(s,s+S+2,s+S+1);s+=y.length}B.b._ComputeSides(J,u,K,G,p);const O=new B.b;return O.hy=u,O.indices=K,O.ny=G,O.Py=p,O})(S,l).gy(j,S.updatable),j.goldbergData.nbSharedFaces=T.sharedNodes,j.goldbergData.nbUnsharedFaces=T.poleNodes,j.goldbergData.adjacentFaces=T.adjacentFaces,j.goldbergData.nbFaces=j.goldbergData.nbSharedFaces+j.goldbergData.nbUnsharedFaces,j.goldbergData.nbFacesAtPole=(j.goldbergData.nbUnsharedFaces-12)/12;for(let i=0;i<T.vertex.length;i++)j.goldbergData.faceCenters.push(V.OS.oS(T.vertex[i])),j.goldbergData.faceCenters[i].x*=F,j.goldbergData.faceCenters[i].y*=J,j.goldbergData.faceCenters[i].z*=u,j.goldbergData.faceColors.push(new G.vd(1,1,1,1));for(let i=0;i<l.face.length;i++){const y=l.face[i],S=V.OS.oS(l.vertex[y[0]]),I=V.OS.oS(l.vertex[y[2]]),A=V.OS.oS(l.vertex[y[1]]),B=I.fS(S),d=A.fS(S),F=V.OS.Cross(d,B).normalize(),J=V.OS.Cross(d,F).normalize();j.goldbergData.faceXaxis.push(d.normalize()),j.goldbergData.faceYaxis.push(F),j.goldbergData.faceZaxis.push(J)}return j},CreateDecal:Y,CreateCapsule:Z,CreateText:By.f}},13627:(y,S,I)=>{"use strict";I.d(S,{c:()=>dS});var V=I(12321),i=I(12694);class A extends i.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var B=I(12362),d=(I(12490),I(12282));class F{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(y){this._targetStopDuration!==y&&(this._targetStopDuration=y)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(y){this._noiseTexture!==y&&(this._noiseTexture=y,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(y){this._animationSheetEnabled!==y&&(this._animationSheetEnabled=y)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(y){this._isAnimationSheetEnabled!=y&&(this._isAnimationSheetEnabled=y,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(y){this._useLogarithmicDepth=y&&this.Ey().getEngine().getCaps().fragmentDepthSupported}Ey(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(y){switch(y){case F.BLENDMODE_MULTIPLYADD:return;case F.BLENDMODE_ADD:y=1;break;case F.BLENDMODE_ONEONE:y=6;break;case F.BLENDMODE_STANDARD:y=2;break;case F.BLENDMODE_MULTIPLY:y=4;break;case F.BLENDMODE_SUBTRACT:y=3}this._engine.setAlphaMode(y)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:V.OS.Zero()}set direction1(y){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=y)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:V.OS.Zero()}set direction2(y){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=y)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:V.OS.Zero()}set minEmitBox(y){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=y)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:V.OS.Zero()}set maxEmitBox(y){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=y)}get billboardMode(){return this._billboardMode}set billboardMode(y){this._billboardMode!==y&&(this._billboardMode=y,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(y){this._isBillboardBased!==y&&(this._isBillboardBased=y,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(y){this._attachImageProcessingConfiguration(y)}_attachImageProcessingConfiguration(y){y!==this._imageProcessingConfiguration&&(!y&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=y)}_reset(){}_removeGradientAndTexture(y,S,I){if(!S)return this;let V=0;for(const i of S){if(i.gradient===y){S.splice(V,1);break}V++}return I&&I.dispose(),this}constructor(y){this.animations=[],this.renderingGroupId=0,this.FS=V.OS.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new V.OS(10,10,10),this.onAnimationEnd=null,this.blendMode=F.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new V.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.zJ=new V.OS(0,0,0),this._useLogarithmicDepth=!1,this.gravity=V.OS.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new B.vd(1,1,1,1),this.color2=new B.vd(1,1,1,1),this.colorDead=new B.vd(0,0,0,1),this.textureMask=new B.vd(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new A,this.id=y,this.name=y}createPointEmitter(y,S){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new V.OS(0,1,0),arguments.length>2&&void 0!==arguments[2]||new V.OS(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new V.OS(0,1,0),arguments.length>4&&void 0!==arguments[4]||new V.OS(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new V.OS(0,1,0),arguments.length>3&&void 0!==arguments[3]||new V.OS(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(y,S,I,V){throw new Error("Method not implemented.")}}F.BLENDMODE_ONEONE=0,F.BLENDMODE_STANDARD=1,F.BLENDMODE_ADD=2,F.BLENDMODE_MULTIPLY=3,F.BLENDMODE_MULTIPLYADD=4,F.BLENDMODE_SUBTRACT=-1,(0,d.e)("BABYLON.BaseParticleSystem",F);var J=I(12338),u=I(12159);class K{constructor(){this.direction1=new V.OS(0,1,0),this.direction2=new V.OS(0,1,0),this.minEmitBox=new V.OS(-.5,-.5,-.5),this.maxEmitBox=new V.OS(.5,.5,.5)}startDirectionFunction(y,S,I,i){const A=(0,J.RandomRange)(this.direction1.x,this.direction2.x),B=(0,J.RandomRange)(this.direction1.y,this.direction2.y),d=(0,J.RandomRange)(this.direction1.z,this.direction2.z);if(i)return S.x=A,S.y=B,void(S.z=d);V.OS.TransformNormalFromFloatsToRef(A,B,d,y,S)}startPositionFunction(y,S,I,i){const A=(0,J.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),B=(0,J.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),d=(0,J.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(i)return S.x=A,S.y=B,void(S.z=d);V.OS.TransformCoordinatesFromFloatsToRef(A,B,d,y,S)}clone(){const y=new K;return u.d.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2),y.setVector3("minEmitBox",this.minEmitBox),y.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3),y.addUniform("minEmitBox",3),y.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.direction1=this.direction1.Vd(),y.direction2=this.direction2.Vd(),y.minEmitBox=this.minEmitBox.Vd(),y.maxEmitBox=this.maxEmitBox.Vd(),y}parse(y){V.OS.FromArrayToRef(y.direction1,0,this.direction1),V.OS.FromArrayToRef(y.direction2,0,this.direction2),V.OS.FromArrayToRef(y.minEmitBox,0,this.minEmitBox),V.OS.FromArrayToRef(y.maxEmitBox,0,this.maxEmitBox)}}class G{get radius(){return this._radius}set radius(y){this._radius=y,this._buildHeight()}get angle(){return this._angle}set angle(y){this._angle=y,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=I,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=S,this.radius=y}startDirectionFunction(y,S,I,i){i?V.TmpVectors.OS[0].A(I.AF).normalize():I.position.subtractToRef(y.getTranslation(),V.TmpVectors.OS[0]).normalize();const A=(0,J.RandomRange)(0,this.directionRandomizer),B=(0,J.RandomRange)(0,this.directionRandomizer),d=(0,J.RandomRange)(0,this.directionRandomizer);S.x=V.TmpVectors.OS[0].x+A,S.y=V.TmpVectors.OS[0].y+B,S.z=V.TmpVectors.OS[0].z+d,S.normalize()}startPositionFunction(y,S,I,i){const A=(0,J.RandomRange)(0,2*Math.PI);let B;this.emitFromSpawnPointOnly?B=1e-4:(B=(0,J.RandomRange)(0,this.heightRange),B=1-B*B);let d=this._radius-(0,J.RandomRange)(0,this._radius*this.radiusRange);d*=B;const F=d*Math.sin(A),u=d*Math.cos(A),K=B*this._height;if(i)return S.x=F,S.y=K,void(S.z=u);V.OS.TransformCoordinatesFromFloatsToRef(F,K,u,y,S)}clone(){const y=new G(this._radius,this._angle,this.directionRandomizer);return u.d.DeepCopy(this,y),y}applyToShader(y){y.setFloat2("radius",this._radius,this.radiusRange),y.setFloat("coneAngle",this._angle),y.setFloat2("height",this._height,this.heightRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",2),y.addUniform("coneAngle",1),y.addUniform("height",2),y.addUniform("directionRandomizer",1)}getEffectDefines(){let y="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(y+="\n#define CONEEMITTERSPAWNPOINT"),y}getClassName(){return"ConeParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this._radius,y.angle=this._angle,y.directionRandomizer=this.directionRandomizer,y.radiusRange=this.radiusRange,y.heightRange=this.heightRange,y.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,y}parse(y){this.radius=y.radius,this.angle=y.angle,this.directionRandomizer=y.directionRandomizer,this.radiusRange=void 0!==y.radiusRange?y.radiusRange:1,this.heightRange=void 0!==y.radiusRange?y.heightRange:1,this.emitFromSpawnPointOnly=void 0!==y.emitFromSpawnPointOnly&&y.emitFromSpawnPointOnly}}class p extends G{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.OS(0,1,0),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.OS(0,1,0);super(y,S),this.direction1=I,this.direction2=i}startDirectionFunction(y,S){const I=(0,J.RandomRange)(this.direction1.x,this.direction2.x),i=(0,J.RandomRange)(this.direction1.y,this.direction2.y),A=(0,J.RandomRange)(this.direction1.z,this.direction2.z);V.OS.TransformNormalFromFloatsToRef(I,i,A,y,S)}clone(){const y=new p(this.radius,this.angle,this.direction1,this.direction2);return u.d.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.Vd(),y.direction2=this.direction2.Vd(),y}parse(y){super.parse(y),this.direction1.A(y.direction1),this.direction2.A(y.direction2)}}class L{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=y,this.height=S,this.radiusRange=I,this.directionRandomizer=i,this._tempVector=V.OS.Zero()}startDirectionFunction(y,S,I,i,A){I.position.subtractToRef(y.getTranslation(),this._tempVector),this._tempVector.normalize(),V.OS.TransformNormalToRef(this._tempVector,A,this._tempVector);const B=(0,J.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let d=Math.atan2(this._tempVector.x,this._tempVector.z);d+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=B,this._tempVector.x=Math.sin(d),this._tempVector.z=Math.cos(d),this._tempVector.normalize(),i?S.A(this._tempVector):V.OS.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,y,S)}startPositionFunction(y,S,I,i){const A=(0,J.RandomRange)(-this.height/2,this.height/2),B=(0,J.RandomRange)(0,2*Math.PI),d=(0,J.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),F=Math.sqrt(d)*this.radius,u=F*Math.cos(B),K=F*Math.sin(B);i?S.od(u,A,K):V.OS.TransformCoordinatesFromFloatsToRef(u,A,K,y,S)}clone(){const y=new L(this.radius,this.directionRandomizer);return u.d.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("height",this.height),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("height",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.height=this.height,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.height=y.height,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class T extends L{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.OS(0,1,0),A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.OS(0,1,0);super(y,S,I),this.direction1=i,this.direction2=A}startDirectionFunction(y,S,I,i){const A=(0,J.RandomRange)(this.direction1.x,this.direction2.x),B=(0,J.RandomRange)(this.direction1.y,this.direction2.y),d=(0,J.RandomRange)(this.direction1.z,this.direction2.z);i?S.od(A,B,d):V.OS.TransformNormalFromFloatsToRef(A,B,d,y,S)}clone(){const y=new T(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return u.d.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("height",this.height),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("height",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.Vd(),y.direction2=this.direction2.Vd(),y}parse(y){super.parse(y),V.OS.FromArrayToRef(y.direction1,0,this.direction1),V.OS.FromArrayToRef(y.direction2,0,this.direction2)}}class l{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=y,this.radiusRange=S,this.directionRandomizer=I}startDirectionFunction(y,S,I,i){const A=I.position.fS(y.getTranslation()).normalize(),B=(0,J.RandomRange)(0,this.directionRandomizer),d=(0,J.RandomRange)(0,this.directionRandomizer),F=(0,J.RandomRange)(0,this.directionRandomizer);A.x+=B,A.y+=d,A.z+=F,A.normalize(),i?S.A(A):V.OS.TransformNormalFromFloatsToRef(A.x,A.y,A.z,y,S)}startPositionFunction(y,S,I,i){const A=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),B=(0,J.RandomRange)(0,1),d=(0,J.RandomRange)(0,2*Math.PI),F=Math.acos(2*B-1),u=A*Math.cos(d)*Math.sin(F),K=A*Math.cos(F),G=A*Math.sin(d)*Math.sin(F);i?S.od(u,Math.abs(K),G):V.OS.TransformCoordinatesFromFloatsToRef(u,Math.abs(K),G,y,S)}clone(){const y=new l(this.radius,this.directionRandomizer);return u.d.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class j{constructor(){this.direction1=new V.OS(0,1,0),this.direction2=new V.OS(0,1,0)}startDirectionFunction(y,S,I,i){const A=(0,J.RandomRange)(this.direction1.x,this.direction2.x),B=(0,J.RandomRange)(this.direction1.y,this.direction2.y),d=(0,J.RandomRange)(this.direction1.z,this.direction2.z);i?S.od(A,B,d):V.OS.TransformNormalFromFloatsToRef(A,B,d,y,S)}startPositionFunction(y,S,I,i){i?S.od(0,0,0):V.OS.TransformCoordinatesFromFloatsToRef(0,0,0,y,S)}clone(){const y=new j;return u.d.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.direction1=this.direction1.Vd(),y.direction2=this.direction2.Vd(),y}parse(y){V.OS.FromArrayToRef(y.direction1,0,this.direction1),V.OS.FromArrayToRef(y.direction2,0,this.direction2)}}class s{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=y,this.radiusRange=S,this.directionRandomizer=I}startDirectionFunction(y,S,I,i){const A=I.position.fS(y.getTranslation()).normalize(),B=(0,J.RandomRange)(0,this.directionRandomizer),d=(0,J.RandomRange)(0,this.directionRandomizer),F=(0,J.RandomRange)(0,this.directionRandomizer);A.x+=B,A.y+=d,A.z+=F,A.normalize(),i?S.A(A):V.OS.TransformNormalFromFloatsToRef(A.x,A.y,A.z,y,S)}startPositionFunction(y,S,I,i){const A=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),B=(0,J.RandomRange)(0,1),d=(0,J.RandomRange)(0,2*Math.PI),F=Math.acos(2*B-1),u=A*Math.cos(d)*Math.sin(F),K=A*Math.cos(F),G=A*Math.sin(d)*Math.sin(F);i?S.od(u,K,G):V.OS.TransformCoordinatesFromFloatsToRef(u,K,G,y,S)}clone(){const y=new s(this.radius,this.directionRandomizer);return u.d.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class O extends s{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.OS(0,1,0),I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.OS(0,1,0);super(y),this.direction1=S,this.direction2=I}startDirectionFunction(y,S){const I=(0,J.RandomRange)(this.direction1.x,this.direction2.x),i=(0,J.RandomRange)(this.direction1.y,this.direction2.y),A=(0,J.RandomRange)(this.direction1.z,this.direction2.z);V.OS.TransformNormalFromFloatsToRef(I,i,A,y,S)}clone(){const y=new O(this.radius,this.direction1,this.direction2);return u.d.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.Vd(),y.direction2=this.direction2.Vd(),y}parse(y){super.parse(y),this.direction1.A(y.direction1),this.direction2.A(y.direction2)}}class f{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(y,S,I,i){const A=V.TmpVectors.OS[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,I,A);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,I,A);const y=V.TmpVectors.OS[1];A.subtractToRef(I.position,y),y.scaleToRef(1/I.lifeTime,A)}else A.set(0,0,0);i?S.A(A):V.OS.TransformNormalToRef(A,y,S)}startPositionFunction(y,S,I,i){const A=V.TmpVectors.OS[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,I,A):A.set(0,0,0),i?S.A(A):V.OS.TransformCoordinatesToRef(A,y,S)}clone(){const y=new f;return u.d.DeepCopy(this,y),y}applyToShader(y){}buildUniformLayout(y){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.particlePositionGenerator=this.particlePositionGenerator,y.particleDestinationGenerator=this.particleDestinationGenerator,y}parse(y){y.particlePositionGenerator&&(this.particlePositionGenerator=y.particlePositionGenerator),y.particleDestinationGenerator&&(this.particleDestinationGenerator=y.particleDestinationGenerator)}}var my=I(12390);class C{get mesh(){return this._mesh}set mesh(y){this._mesh!==y&&(this._mesh=y,y?(this._indices=y.fd(),this._positions=y.getVerticesData(my.e.PositionKind),this._normals=y.getVerticesData(my.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=V.OS.Zero(),this._mesh=null,this.direction1=new V.OS(0,1,0),this.direction2=new V.OS(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=y}startDirectionFunction(y,S,I,i){if(this.useMeshNormalsForDirection&&this._normals)return void V.OS.TransformNormalToRef(this._storedNormal,y,S);const A=(0,J.RandomRange)(this.direction1.x,this.direction2.x),B=(0,J.RandomRange)(this.direction1.y,this.direction2.y),d=(0,J.RandomRange)(this.direction1.z,this.direction2.z);i?S.od(A,B,d):V.OS.TransformNormalFromFloatsToRef(A,B,d,y,S)}startPositionFunction(y,S,I,i){if(!this._indices||!this._positions)return;const A=3*(Math.random()*(this._indices.length/3)|0),B=Math.random(),d=Math.random()*(1-B),F=1-B-d,J=this._indices[A],u=this._indices[A+1],K=this._indices[A+2],G=V.TmpVectors.OS[0],p=V.TmpVectors.OS[1],L=V.TmpVectors.OS[2],T=V.TmpVectors.OS[3];V.OS.FromArrayToRef(this._positions,3*J,G),V.OS.FromArrayToRef(this._positions,3*u,p),V.OS.FromArrayToRef(this._positions,3*K,L),T.x=B*G.x+d*p.x+F*L.x,T.y=B*G.y+d*p.y+F*L.y,T.z=B*G.z+d*p.z+F*L.z,i?S.od(T.x,T.y,T.z):V.OS.TransformCoordinatesFromFloatsToRef(T.x,T.y,T.z,y,S),this.useMeshNormalsForDirection&&this._normals&&(V.OS.FromArrayToRef(this._normals,3*J,G),V.OS.FromArrayToRef(this._normals,3*u,p),V.OS.FromArrayToRef(this._normals,3*K,L),this._storedNormal.x=B*G.x+d*p.x+F*L.x,this._storedNormal.y=B*G.y+d*p.y+F*L.y,this._storedNormal.z=B*G.z+d*p.z+F*L.z)}clone(){const y=new C(this.mesh);return u.d.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var y;const S={};return S.type=this.getClassName(),S.direction1=this.direction1.Vd(),S.direction2=this.direction2.Vd(),S.meshId=null===(y=this.mesh)||void 0===y?void 0:y.id,S.useMeshNormalsForDirection=this.useMeshNormalsForDirection,S}parse(y,S){V.OS.FromArrayToRef(y.direction1,0,this.direction1),V.OS.FromArrayToRef(y.direction2,0,this.direction2),y.meshId&&S&&(this.mesh=S.getLastMeshById(y.meshId)),this.useMeshNormalsForDirection=y.useMeshNormalsForDirection}}class D{_isUbo(y){return void 0!==y.addUniform}constructor(y){this._isUbo(y)?(this.setMatrix3x3=y.updateMatrix3x3.bind(y),this.setMatrix2x2=y.updateMatrix2x2.bind(y),this.setFloat=y.updateFloat.bind(y),this.setFloat2=y.updateFloat2.bind(y),this.setFloat3=y.updateFloat3.bind(y),this.setFloat4=y.updateFloat4.bind(y),this.setFloatArray=y.updateFloatArray.bind(y),this.setArray=y.updateArray.bind(y),this.setIntArray=y.updateIntArray.bind(y),this.setMatrix=y.jd.bind(y),this.setMatrices=y.updateMatrices.bind(y),this.setVector3=y.updateVector3.bind(y),this.setVector4=y.updateVector4.bind(y),this.setColor3=y.updateColor3.bind(y),this.setColor4=y.updateColor4.bind(y),this.setDirectColor4=y.updateDirectColor4.bind(y),this.setInt=y.updateInt.bind(y),this.setInt2=y.updateInt2.bind(y),this.setInt3=y.updateInt3.bind(y),this.setInt4=y.updateInt4.bind(y)):(this.setMatrix3x3=y.setMatrix3x3.bind(y),this.setMatrix2x2=y.setMatrix2x2.bind(y),this.setFloat=y.setFloat.bind(y),this.setFloat2=y.setFloat2.bind(y),this.setFloat3=y.setFloat3.bind(y),this.setFloat4=y.setFloat4.bind(y),this.setFloatArray=y.setFloatArray.bind(y),this.setArray=y.setArray.bind(y),this.setIntArray=y.setIntArray.bind(y),this.setMatrix=y.setMatrix.bind(y),this.setMatrices=y.setMatrices.bind(y),this.setVector3=y.setVector3.bind(y),this.setVector4=y.setVector4.bind(y),this.setColor3=y.setColor3.bind(y),this.setColor4=y.setColor4.bind(y),this.setDirectColor4=y.setDirectColor4.bind(y),this.setInt=y.setInt.bind(y),this.setInt2=y.setInt2.bind(y),this.setInt3=y.setInt3.bind(y),this.setInt4=y.setInt4.bind(y))}}var o=I(12240);const E="gpuUpdateParticlesPixelShader",z="#version 300 es\nvoid main() {discard;}\n";o.b.ShadersStore[E]||(o.b.ShadersStore[E]=z);const r="gpuUpdateParticlesVertexShader",h="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";o.b.ShadersStore[r]||(o.b.ShadersStore[r]=h);(0,d.e)("BABYLON.WebGL2ParticleSystem",class{constructor(y,S){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=y,this._engine=S,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var y;return(null===(y=this._updateEffect)||void 0===y?void 0:y.isReady())??!1}createUpdateBuffer(y){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof f&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=y,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new D(this._updateEffect)}createVertexBuffers(y,S){this._updateVAO.push(this._createUpdateVAO(y)),this._renderVAO.push(this._engine.recordVertexArrayObject(S,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=S}createParticleBuffer(y){return y}bindDrawBuffers(y,S,I){I?this._engine.bindBuffers(this._renderVertexBuffers,I,S):this._engine.bindVertexArrayObject(this._renderVAO[y],null)}preUpdateParticleBuffer(){const y=this._engine;if(this._engine.enableEffect(this._updateEffect),!y.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(y,S,I){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[y],null);const V=this._engine;V.bindTransformFeedbackBuffer(S.getBuffer()),V.setRasterizerState(!1),V.beginTransformFeedback(!0),V.drawArraysType(3,0,I),V.endTransformFeedback(),V.setRasterizerState(!0),V.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let y=0;y<this._updateVAO.length;y++)this._engine.releaseVertexArrayObject(this._updateVAO[y]);this._updateVAO.length=0;for(let y=0;y<this._renderVAO.length;y++)this._engine.releaseVertexArrayObject(this._renderVAO[y]);this._renderVAO.length=0}_createUpdateVAO(y){const S={};S.position=y.createVertexBuffer("position",0,3);let I=3;S.age=y.createVertexBuffer("age",I,1),I+=1,S.size=y.createVertexBuffer("size",I,3),I+=3,S.life=y.createVertexBuffer("life",I,1),I+=1,S.seed=y.createVertexBuffer("seed",I,4),I+=4,S.direction=y.createVertexBuffer("direction",I,3),I+=3,this._parent.particleEmitterType instanceof f&&(S.initialPosition=y.createVertexBuffer("initialPosition",I,3),I+=3),this._parent._colorGradientsTexture||(S.color=y.createVertexBuffer("color",I,4),I+=4),this._parent._isBillboardBased||(S.initialDirection=y.createVertexBuffer("initialDirection",I,3),I+=3),this._parent.noiseTexture&&(S.noiseCoordinates1=y.createVertexBuffer("noiseCoordinates1",I,3),I+=3,S.noiseCoordinates2=y.createVertexBuffer("noiseCoordinates2",I,3),I+=3),this._parent._angularSpeedGradientsTexture?(S.angle=y.createVertexBuffer("angle",I,1),I+=1):(S.angle=y.createVertexBuffer("angle",I,2),I+=2),this._parent._isAnimationSheetEnabled&&(S.cellIndex=y.createVertexBuffer("cellIndex",I,1),I+=1,this._parent.spriteRandomStartCell&&(S.cellStartOffset=y.createVertexBuffer("cellStartOffset",I,1),I+=1));const V=this._engine.recordVertexArrayObject(S,null,this._updateEffect);return this._engine.bindArrayBuffer(null),V}});class n{constructor(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,V=arguments.length>3?arguments[3]:void 0;this._engine=y,this._label=V,this._engine._storageBuffers.push(this),this._create(S,I)}_create(y,S){this._bufferSize=y,this._creationFlags=S,this._buffer=this._engine.createStorageBuffer(y,S,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(y,S,I){this._buffer&&this._engine.updateStorageBuffer(this._buffer,y,S,I)}async read(y,S,I,V){return await this._engine.readFromStorageBuffer(this._buffer,y,S,I,V)}dispose(){const y=this._engine._storageBuffers,S=y.indexOf(this);-1!==S&&(y[S]=y[y.length-1],y.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var v=I(12306),P=I(12309),q=I(12352),g=I(12304),k=I(12614),R=I(12151),b=I(12268),U=I(12540);class W{constructor(){this._gpuTimeInFrameId=-1,this.counter=new U.b}_addDuration(y,S){y<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==y?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(S,!1),this._gpuTimeInFrameId=y):this.counter.addCount(S,!1))}}var a=I(12216);class e{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=y,this._engine=S,this.uniqueId=k.d.UniqueId,S.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new W),this._engine.getCaps().supportComputeShaders?V.bindingsMapping?(this._context=S.createComputeContext(),this._shaderPath=I,this._options={bindingsMapping:{},defines:[],...V}):R.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):R.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(y,S){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const V=this._bindings[y];this._bindings[y]={type:I?0:4,object:S,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!V||V.object!==S||V.type!==this._bindings[y].type)}setStorageTexture(y,S){const I=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==S),this._bindings[y]={type:1,object:S,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}setExternalTexture(y,S){const I=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==S),this._bindings[y]={type:6,object:S,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}setVideoTexture(y,S){return!!S.externalTexture&&(this.setExternalTexture(y,S.externalTexture),!0)}setUniformBuffer(y,S){const I=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==S),this._bindings[y]={type:e._BufferIsDataBuffer(S)?7:2,object:S,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}setStorageBuffer(y,S){const I=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==S),this._bindings[y]={type:e._BufferIsDataBuffer(S)?7:3,object:S,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}setTextureSampler(y,S){const I=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!I||!S.compareSampler(I.object)),this._bindings[y]={type:5,object:S,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}}isReady(){let y=this._effect;for(const i in this._bindings){const y=this._bindings[i],S=y.type,I=y.object;switch(S){case 0:case 4:case 1:if(!I.isReady())return!1;break;case 6:if(!I.isReady())return!1;break}}const S=[],I=this._shaderPath;if(this._options.defines)for(let i=0;i<this._options.defines.length;i++)S.push(this._options.defines[i]);const V=S.join("\n");return this._cachedDefines!==V&&(this._cachedDefines=V,y=this._engine.createComputeEffect(I,{defines:V,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=y),!!y.isReady()}dispatch(y,S,I){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,y,S,I,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const I=e._BufferIsDataBuffer(y)?y:y.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,I,S,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const S in this._bindings){const I=this._bindings[S];if(!this._options.bindingsMapping[S])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+S+"'");switch(I.type){case 0:{const V=this._samplers[S],i=I.object;var y;if(!V||!i._texture||!V.compareSampler(i._texture))this._samplers[S]=(new b.c).setParameters(i.wrapU,i.wrapV,i.wrapR,i.anisotropicFilteringLevel,i._texture.samplingMode,null===(y=i._texture)||void 0===y?void 0:y._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const y=I.object;y.getBuffer()!==I.buffer&&(I.buffer=y.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((i=>{(0,a.d)((()=>this.dispatch(y,S,I)),i,void 0,V)}))}serialize(){const y=q.d.Serialize(this);y.options=this._options,y.shaderPath=this._shaderPath,y.LG={},y.textures={};for(const S in this._bindings){const I=this._bindings[S],V=I.object;switch(I.type){case 0:case 4:case 1:{const i=V.serialize();i&&(y.textures[S]=i,y.LG[S]={type:I.type});break}}}return y}static Parse(y,S,I){const V=q.d.Parse((()=>new e(y.name,S.getEngine(),y.shaderPath,y.options)),y,S,I);for(const i in y.textures){const A=y.LG[i],B=g.e.Parse(y.textures[i],S,I);0===A.type?V.setTexture(i,B):4===A.type?V.setTexture(i,B,!1):V.setStorageTexture(i,B)}return V}static _BufferIsDataBuffer(y){return void 0!==y.underlyingResource}}(0,v.c)([(0,P.E)()],e.prototype,"name",void 0),(0,v.c)([(0,P.E)()],e.prototype,"fastMode",void 0),(0,d.e)("BABYLON.ComputeShader",e);var x=I(12574);const Q="gpuUpdateParticlesComputeShader",c="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";o.b.ShadersStoreWGSL[Q]||(o.b.ShadersStoreWGSL[Q]=c);(0,d.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(y,S){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=y,this._engine=S}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var y;return(null===(y=this._updateComputeShader)||void 0===y?void 0:y.isReady())??!1}createUpdateBuffer(y){var S;const I={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(I.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(I.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(I.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(I.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(I.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(I.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(I.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new e("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:I,defines:y.split("\n")}),null===(S=this._simParamsComputeShader)||void 0===S||S.dispose(),this._simParamsComputeShader=new x.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new D(this._simParamsComputeShader)}createVertexBuffers(y,S){this._renderVertexBuffers.push(S)}createParticleBuffer(y){const S=new n(this._engine,4*y.length,11,"ComputeShaderParticleSystemBuffer");return S.update(y),this._bufferComputeShader.push(S),S.getBuffer()}bindDrawBuffers(y,S,I){this._engine.bindBuffers(this._renderVertexBuffers[y],I,S)}preUpdateParticleBuffer(){}updateParticleBuffer(y,S,I){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[y]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^y]),this._updateComputeShader.dispatch(Math.ceil(I/64))}releaseBuffers(){var y;for(let S=0;S<this._bufferComputeShader.length;++S)this._bufferComputeShader[S].dispose();this._bufferComputeShader.length=0,null===(y=this._simParamsComputeShader)||void 0===y||y.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class X{constructor(y,S,I){this.gradient=y,this.color1=S,this.color2=I}getColorToRef(y){this.color2?B.vd.LerpToRef(this.color1,this.color2,Math.random(),y):y.A(this.color1)}}class M{constructor(y,S){this.gradient=y,this.color=S}}class t{constructor(y,S,I){this.gradient=y,this.factor1=S,this.factor2=I}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class N{static GetCurrentGradient(y,S,I){if(S[0].gradient>y)return void I(S[0],S[0],1);for(let i=0;i<S.length-1;i++){const V=S[i],A=S[i+1];if(y>=V.gradient&&y<=A.gradient){return void I(V,A,(y-V.gradient)/(A.gradient-V.gradient))}}const V=S.length-1;I(S[V],S[V],1)}}var Y=I(12133),H=I(12782),Z=I(12185);class w{constructor(y){this.particleSystem=y,this.position=V.OS.Zero(),this.direction=V.OS.Zero(),this.color=new B.vd(0,0,0,0),this.colorStep=new B.vd(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new V.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new B.vd(0,0,0,0),this._currentColor2=new B.vd(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=w._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let y=this.age,S=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===S?(S=1,y=this._randomCellOffset):y+=this._randomCellOffset);const I=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let V;V=this._initialSpriteCellLoop?(0,J.Clamp)(y*S%this.lifeTime/this.lifeTime):(0,J.Clamp)(y*S/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+V*I|0}_inheritParticleInfoToSubEmitter(y){if(y.particleSystem.FS.position){const S=y.particleSystem.FS;if(S.position.A(this.position),y.inheritDirection){const y=V.TmpVectors.OS[0];this.direction.normalizeToRef(y),S.setDirection(y,0,Math.PI/2)}}else{y.particleSystem.FS.A(this.position)}this.direction.scaleToRef(y.inheritedVelocityAmount/2,V.TmpVectors.OS[0]),y.particleSystem._inheritedVelocityOffset.A(V.TmpVectors.OS[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const y of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(y)}_reset(){this.age=0,this.id=w._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(y){y.position.A(this.position),this._initialDirection?y._initialDirection?y._initialDirection.A(this._initialDirection):y._initialDirection=this._initialDirection.clone():y._initialDirection=null,y.direction.A(this.direction),this.AF&&(y.AF?y.AF.A(this.AF):y.AF=this.AF.clone()),y.color.A(this.color),y.colorStep.A(this.colorStep),y.lifeTime=this.lifeTime,y.age=this.age,y._randomCellOffset=this._randomCellOffset,y.size=this.size,y.scale.A(this.scale),y.angle=this.angle,y.angularSpeed=this.angularSpeed,y.particleSystem=this.particleSystem,y.cellIndex=this.cellIndex,y.id=this.id,y._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(y._currentColorGradient=this._currentColorGradient,y._currentColor1.A(this._currentColor1),y._currentColor2.A(this._currentColor2)),this._currentSizeGradient&&(y._currentSizeGradient=this._currentSizeGradient,y._currentSize1=this._currentSize1,y._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(y._currentAngularSpeedGradient=this._currentAngularSpeedGradient,y._currentAngularSpeed1=this._currentAngularSpeed1,y._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(y._currentVelocityGradient=this._currentVelocityGradient,y._currentVelocity1=this._currentVelocity1,y._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(y._currentLimitVelocityGradient=this._currentLimitVelocityGradient,y._currentLimitVelocity1=this._currentLimitVelocity1,y._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(y._currentDragGradient=this._currentDragGradient,y._currentDrag1=this._currentDrag1,y._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(y._initialStartSpriteCellId=this._initialStartSpriteCellId,y._initialEndSpriteCellId=this._initialEndSpriteCellId,y._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(y.remapData&&this.remapData?y.remapData.A(this.remapData):y.remapData=new V.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(y._randomNoiseCoordinates1?(y._randomNoiseCoordinates1.A(this._randomNoiseCoordinates1),y._randomNoiseCoordinates2.A(this._randomNoiseCoordinates2)):(y._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),y._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}w._Count=0;var yy=I(12440),Sy=(I(12486),I(12683)),Iy=I(12675),Vy=I(12572);function iy(y,S){const I=(0,J.RandomRange)(0,1);B.vd.LerpToRef(S.color1,S.color2,I,y.color),S.colorDead.subtractToRef(y.color,S._colorDiff),S._colorDiff.scaleToRef(1/y.lifeTime,y.colorStep)}function Ay(y,S){y._currentColorGradient=S._colorGradients[0],y._currentColorGradient.getColorToRef(y.color),y._currentColor1.A(y.color),S._colorGradients.length>1?S._colorGradients[1].getColorToRef(y._currentColor2):y._currentColor2.A(y.color)}function By(y,S){const I=S._colorGradients;N.GetCurrentGradient(S._ratio,I,((S,I,V)=>{S!==y._currentColorGradient&&(y._currentColor1.A(y._currentColor2),I.getColorToRef(y._currentColor2),y._currentColorGradient=S),B.vd.LerpToRef(y._currentColor1,y._currentColor2,V,y.color)}))}function dy(y,S){y.colorStep.scaleToRef(S._scaledUpdateSpeed,S._scaledColorStep),y.color.addInPlace(S._scaledColorStep),y.color.a<0&&(y.color.a=0)}function Fy(y,S){N.GetCurrentGradient(S._ratio,S._angularSpeedGradients,((S,I,V)=>{S!==y._currentAngularSpeedGradient&&(y._currentAngularSpeed1=y._currentAngularSpeed2,y._currentAngularSpeed2=I.getFactor(),y._currentAngularSpeedGradient=S),y.angularSpeed=(0,J.Lerp)(y._currentAngularSpeed1,y._currentAngularSpeed2,V)}))}function Jy(y,S){y.angle+=y.angularSpeed*S._scaledUpdateSpeed}function uy(y,S){S.particleEmitterType.startDirectionFunction(S._emitterWorldMatrix,y.direction,y,S.isLocal,S._emitterInverseWorldMatrix)}function Ky(y,S){S.startDirectionFunction(S._emitterWorldMatrix,y.direction,y,S.isLocal)}function Gy(y,S){y._currentVelocityGradient=S._velocityGradients[0],y._currentVelocity1=y._currentVelocityGradient.getFactor(),S._velocityGradients.length>1?y._currentVelocity2=S._velocityGradients[1].getFactor():y._currentVelocity2=y._currentVelocity1}function py(y,S){y._currentLimitVelocityGradient=S._limitVelocityGradients[0],y._currentLimitVelocity1=y._currentLimitVelocityGradient.getFactor(),S._limitVelocityGradients.length>1?y._currentLimitVelocity2=S._limitVelocityGradients[1].getFactor():y._currentLimitVelocity2=y._currentLimitVelocity1}function Ly(y,S){N.GetCurrentGradient(S._ratio,S._velocityGradients,((I,V,i)=>{I!==y._currentVelocityGradient&&(y._currentVelocity1=y._currentVelocity2,y._currentVelocity2=V.getFactor(),y._currentVelocityGradient=I),S._directionScale*=(0,J.Lerp)(y._currentVelocity1,y._currentVelocity2,i)}))}function Ty(y,S){N.GetCurrentGradient(S._ratio,S._limitVelocityGradients,((I,V,i)=>{I!==y._currentLimitVelocityGradient&&(y._currentLimitVelocity1=y._currentLimitVelocity2,y._currentLimitVelocity2=V.getFactor(),y._currentLimitVelocityGradient=I);const A=(0,J.Lerp)(y._currentLimitVelocity1,y._currentLimitVelocity2,i);y.direction.length()>A&&y.direction.scaleInPlace(S.limitVelocityDamping)}))}function ly(y,S){y.direction.scaleToRef(S._directionScale,S._scaledDirection)}function jy(y,S){S.particleEmitterType.startPositionFunction(S._emitterWorldMatrix,y.position,y,S.isLocal)}function sy(y,S){S.startPositionFunction(S._emitterWorldMatrix,y.position,y,S.isLocal)}function Oy(y,S){y.AF?y.AF.A(y.position):y.AF=y.position.clone(),V.OS.TransformCoordinatesToRef(y.AF,S._emitterWorldMatrix,y.position)}function fy(y,S){S.isLocal&&y.AF?(y.AF.addInPlace(S._scaledDirection),V.OS.TransformCoordinatesToRef(y.AF,S._emitterWorldMatrix,y.position)):y.position.addInPlace(S._scaledDirection)}function mS(y,S){y._currentDragGradient=S._dragGradients[0],y._currentDrag1=y._currentDragGradient.getFactor(),S._dragGradients.length>1?y._currentDrag2=S._dragGradients[1].getFactor():y._currentDrag2=y._currentDrag1}function Cy(y,S){N.GetCurrentGradient(S._ratio,S._dragGradients,((I,V,i)=>{I!==y._currentDragGradient&&(y._currentDrag1=y._currentDrag2,y._currentDrag2=V.getFactor(),y._currentDragGradient=I);const A=(0,J.Lerp)(y._currentDrag1,y._currentDrag2,i);S._scaledDirection.scaleInPlace(1-A)}))}function Dy(y,S){y._randomNoiseCoordinates1?(y._randomNoiseCoordinates1.od(Math.random(),Math.random(),Math.random()),y._randomNoiseCoordinates2.od(Math.random(),Math.random(),Math.random())):(y._randomNoiseCoordinates1=new V.OS(Math.random(),Math.random(),Math.random()),y._randomNoiseCoordinates2=new V.OS(Math.random(),Math.random(),Math.random()))}function oy(y,S){const I=S._noiseTextureData,i=S._noiseTextureSize;if(I&&i&&y._randomNoiseCoordinates1){const A=S._fetchR(y._randomNoiseCoordinates1.x,y._randomNoiseCoordinates1.y,i.width,i.height,I),B=S._fetchR(y._randomNoiseCoordinates1.z,y._randomNoiseCoordinates2.x,i.width,i.height,I),d=S._fetchR(y._randomNoiseCoordinates2.y,y._randomNoiseCoordinates2.z,i.width,i.height,I),F=V.TmpVectors.OS[0],J=V.TmpVectors.OS[1];F.od((2*A-1)*S.noiseStrength.x,(2*B-1)*S.noiseStrength.y,(2*d-1)*S.noiseStrength.z),F.scaleToRef(S._tempScaledUpdateSpeed,J),y.direction.addInPlace(J)}}function Ey(y,S){S.gravity.scaleToRef(S._tempScaledUpdateSpeed,S._scaledGravity),y.direction.addInPlace(S._scaledGravity)}function zy(y,S){y.size=(0,J.RandomRange)(S.minSize,S.maxSize),y.scale.od((0,J.RandomRange)(S.minScaleX,S.maxScaleX),(0,J.RandomRange)(S.minScaleY,S.maxScaleY))}function ry(y,S){y._currentSizeGradient=S._sizeGradients[0],y._currentSize1=y._currentSizeGradient.getFactor(),y.size=y._currentSize1,S._sizeGradients.length>1?y._currentSize2=S._sizeGradients[1].getFactor():y._currentSize2=y._currentSize1,y.scale.od((0,J.RandomRange)(S.minScaleX,S.maxScaleX),(0,J.RandomRange)(S.minScaleY,S.maxScaleY))}function hy(y,S){const I=S._actualFrame/S.targetStopDuration;N.GetCurrentGradient(I,S._startSizeGradients,((I,V,i)=>{I!==S._currentStartSizeGradient&&(S._currentStartSize1=S._currentStartSize2,S._currentStartSize2=V.getFactor(),S._currentStartSizeGradient=I);const A=(0,J.Lerp)(S._currentStartSize1,S._currentStartSize2,i);y.scale.scaleInPlace(A)}))}function ny(y,S){N.GetCurrentGradient(S._ratio,S._sizeGradients,((S,I,V)=>{S!==y._currentSizeGradient&&(y._currentSize1=y._currentSize2,y._currentSize2=I.getFactor(),y._currentSizeGradient=S),y.size=(0,J.Lerp)(y._currentSize1,y._currentSize2,V)}))}function vy(y,S){y.remapData=new V.Vector4(0,1,0,1)}function Py(y,S){S._colorRemapGradients&&S._colorRemapGradients.length>0&&N.GetCurrentGradient(S._ratio,S._colorRemapGradients,((S,I,V)=>{const i=(0,J.Lerp)(S.factor1,I.factor1,V),A=(0,J.Lerp)(S.factor2,I.factor2,V);y.remapData.x=i,y.remapData.y=A-i})),S._alphaRemapGradients&&S._alphaRemapGradients.length>0&&N.GetCurrentGradient(S._ratio,S._alphaRemapGradients,((S,I,V)=>{const i=(0,J.Lerp)(S.factor1,I.factor1,V),A=(0,J.Lerp)(S.factor2,I.factor2,V);y.remapData.z=i,y.remapData.w=A-i}))}function qy(y,S){const I=(0,J.Clamp)(S._actualFrame/S.targetStopDuration);N.GetCurrentGradient(I,S._lifeTimeGradients,((S,V)=>{const i=S,A=V,B=i.getFactor(),d=A.getFactor(),F=(I-i.gradient)/(A.gradient-i.gradient);y.lifeTime=(0,J.Lerp)(B,d,F)})),S._emitPower=(0,J.RandomRange)(S.minEmitPower,S.maxEmitPower)}function gy(y,S){y.lifeTime=(0,J.RandomRange)(S.minLifeTime,S.maxLifeTime),S._emitPower=(0,J.RandomRange)(S.minEmitPower,S.maxEmitPower)}function ky(y,S){0===S._emitPower?(y._initialDirection?y._initialDirection.A(y.direction):y._initialDirection=y.direction.clone(),y.direction.set(0,0,0)):(y._initialDirection=null,y.direction.scaleInPlace(S._emitPower)),y.direction.addInPlace(S._inheritedVelocityOffset)}function Ry(y,S){y.angularSpeed=(0,J.RandomRange)(S.minAngularSpeed,S.maxAngularSpeed),y.angle=(0,J.RandomRange)(S.minInitialRotation,S.maxInitialRotation)}function by(y,S){y._currentAngularSpeedGradient=S._angularSpeedGradients[0],y.angularSpeed=y._currentAngularSpeedGradient.getFactor(),y._currentAngularSpeed1=y.angularSpeed,S._angularSpeedGradients.length>1?y._currentAngularSpeed2=S._angularSpeedGradients[1].getFactor():y._currentAngularSpeed2=y._currentAngularSpeed1,y.angle=(0,J.RandomRange)(S.minInitialRotation,S.maxInitialRotation)}function Uy(y,S){y._initialStartSpriteCellId=S.startSpriteCellID,y._initialEndSpriteCellId=S.endSpriteCellID,y._initialSpriteCellLoop=S.spriteCellLoop}function Wy(y,S){y.previousItem=S.previousItem,y.nextItem=S,S.previousItem&&(S.previousItem.nextItem=y),S.previousItem=y}function ay(y,S){y.previousItem=S,y.nextItem=S.nextItem,S.nextItem&&(S.nextItem.previousItem=y),S.nextItem=y}function ey(y,S){let I=S;for(;I.nextItem;)I=I.nextItem;y.previousItem=I,y.nextItem=I.nextItem,I.nextItem=y}function xy(y){y.previousItem&&(y.previousItem.nextItem=y.nextItem),y.nextItem&&(y.nextItem.previousItem=y.previousItem)}class Qy extends F{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(y){this._startDirectionFunction!==y&&(this._startDirectionFunction=y,this._directionProcessing.process=y?Ky:uy)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(y){this._startPositionFunction!==y&&(this._startPositionFunction=y,this._positionCreation.process=y?sy:jy)}set onDispose(y){this._onDisposeObserver&&this.zi.remove(this._onDisposeObserver),this._onDisposeObserver=this.zi.add(y)}get J(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(y){this._useRampGradients!==y&&(this._useRampGradients=y,this._resetEffect(),y?(this._rampCreation={process:vy,previousItem:null,nextItem:null},ay(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Py,previousItem:null,nextItem:null},ay(this._remapGradientProcessing,this._gravityProcessing)):(xy(this._rampCreation),xy(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(y){this._isLocal!==y&&(this._isLocal=y,y?(this._isLocalCreation={process:Oy,previousItem:null,nextItem:null},ay(this._isLocalCreation,this._positionCreation)):xy(this._isLocalCreation))}get particles(){return this.JG}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(y){this._animationSheetEnabled!==y&&(this._animationSheetEnabled=y,y?(this._sheetCreation={process:Uy,previousItem:null,nextItem:null},ay(this._sheetCreation,this._colorCreation)):xy(this._sheetCreation),this._reset())}getActiveCount(){return this.JG.length}getClassName(){return"Hd"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var y;let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(y=this._customWrappers[S])||void 0===y?void 0:y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[y]??this._customWrappers[0]}setCustomEffect(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[S]=new yy.e(this._engine),this._customWrappers[S].effect=y,this._customWrappers[S].drawContext&&(this._customWrappers[S].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Y.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(y){if(this.noiseTexture!==y){if(this._noiseTexture=y,!y)return xy(this._noiseCreation),void xy(this._noiseProcessing);this._noiseCreation={process:Dy,previousItem:null,nextItem:null},ay(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:oy,previousItem:null,nextItem:null},ay(this._noiseProcessing,this._positionProcessing)}}constructor(y,S,I){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(y),this._emitterInverseWorldMatrix=V.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new V.OS,this.zi=new Y.b,this.onStoppedObservable=new Y.b,this.onStartedObservable=new Y.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.JG=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new B.vd(0,0,0,0),this._colorDiff=new B.vd(0,0,0,0),this._scaledDirection=V.OS.Zero(),this._scaledGravity=V.OS.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=y=>{},this.recycleParticle=y=>{const S=this.JG.pop();S!==y&&S.copyTo(y),this._stockParticles.push(S)},this._createParticle=()=>{let y;return 0!==this._stockParticles.length?(y=this._stockParticles.pop(),y._reset()):y=new w(this),this._prepareParticle(y),y},this.paused=!1,this._shadersLoaded=!1,this._capacity=S,this._epsilon=d,I&&"Scene"!==I.getClassName()?(this._engine=I,this.defaultProjectionMatrix=V.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=I||Z.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.dG.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:gy,previousItem:null,nextItem:null},this._positionCreation={process:jy,previousItem:null,nextItem:null},ay(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:uy,previousItem:null,nextItem:null},ay(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:ky,previousItem:null,nextItem:null},ay(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:zy,previousItem:null,nextItem:null},ay(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Ry,previousItem:null,nextItem:null},ay(this._angleCreation,this._sizeCreation),this._colorCreation={process:iy,previousItem:null,nextItem:null},ay(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,F||(this._colorProcessing={process:dy,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Jy,previousItem:null,nextItem:null},ay(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:ly,previousItem:null,nextItem:null},ay(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:fy,previousItem:null,nextItem:null},ay(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Ey,previousItem:null,nextItem:null},ay(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=A,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new yy.e(this._engine)},this._customWrappers[0].effect=i,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new K,this.updateFunction=y=>{var S;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(S=this.noiseTexture.getContent())||void 0===S||S.then((y=>{this._noiseTextureData=y})));const I=y===this.JG;for(let V=0;V<y.length;V++){const S=y[V];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const i=S.age;if(S.age+=this._tempScaledUpdateSpeed,S.age>S.lifeTime){const y=S.age-i,I=S.lifeTime-i;this._tempScaledUpdateSpeed=I*this._tempScaledUpdateSpeed/y,S.age=S.lifeTime}this._ratio=S.age/S.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let A=this._updateQueueStart;for(;A;)A.process(S,this),A=A.nextItem;if(this._isAnimationSheetEnabled&&!F&&S.updateCellIndex(),S._inheritParticleInfoToSubEmitters(),S.age>=S.lifeTime){if(this._emitFromParticle(S),S._attachedSubEmitters){for(const y of S._attachedSubEmitters)y.particleSystem.disposeOnStop=!0,y.particleSystem.stop();S._attachedSubEmitters=null}this.recycleParticle(S),I&&V--}else;}}}serialize(y){throw new Error("Method not implemented.")}clone(y,S){throw new Error("Method not implemented.")}_addFactorGradient(y,S,I,V){const i=new t(S,I,V);y.push(i),y.sort(((y,S)=>y.gradient<S.gradient?-1:y.gradient>S.gradient?1:0))}_removeFactorGradient(y,S){if(!y)return;let I=0;for(const V of y){if(V.gradient===S){y.splice(I,1);break}I++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=qy:this._lifeTimeCreation.process=gy}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:hy,previousItem:null,nextItem:null},ay(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(xy(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(y){this.targetStopDuration!==y&&(this._targetStopDuration=y,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(y,S,I){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,y,S,I),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(y){return this._removeFactorGradient(this._lifeTimeGradients,y),this._syncLifeTimeCreation(),this}addSizeGradient(y,S,I){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=ry,this._sizeGradientProcessing={process:ny,previousItem:null,nextItem:null},Wy(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,y,S,I),this}removeSizeGradient(y){var S;return this._removeFactorGradient(this._sizeGradients,y),0===(null===(S=this._sizeGradients)||void 0===S?void 0:S.length)&&(xy(this._sizeGradientProcessing),this._sizeCreation.process=zy),this}addColorRemapGradient(y,S,I){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,y,S,I),this}removeColorRemapGradient(y){return this._removeFactorGradient(this._colorRemapGradients,y),this}addAlphaRemapGradient(y,S,I){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,y,S,I),this}removeAlphaRemapGradient(y){return this._removeFactorGradient(this._alphaRemapGradients,y),this}addAngularSpeedGradient(y,S,I){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=by,this._angularSpeedGradientProcessing={process:Fy,previousItem:null,nextItem:null},Wy(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,y,S,I),this}removeAngularSpeedGradient(y){var S;return this._removeFactorGradient(this._angularSpeedGradients,y),0===(null===(S=this._angularSpeedGradients)||void 0===S?void 0:S.length)&&(this._angleCreation.process=Ry,xy(this._angularSpeedGradientProcessing)),this}addVelocityGradient(y,S,I){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Gy,previousItem:null,nextItem:null},ay(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Ly,previousItem:null,nextItem:null},Wy(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,y,S,I),this}removeVelocityGradient(y){var S;return this._removeFactorGradient(this._velocityGradients,y),0===(null===(S=this._velocityGradients)||void 0===S?void 0:S.length)&&(xy(this._velocityCreation),xy(this._velocityGradientProcessing)),this}addLimitVelocityGradient(y,S,I){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:py,previousItem:null,nextItem:null},ay(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Ty,previousItem:null,nextItem:null},ay(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,y,S,I),this}removeLimitVelocityGradient(y){var S;return this._removeFactorGradient(this._limitVelocityGradients,y),0===(null===(S=this._limitVelocityGradients)||void 0===S?void 0:S.length)&&(xy(this._limitVelocityCreation),xy(this._limitVelocityGradientProcessing)),this}addDragGradient(y,S,I){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:mS,previousItem:null,nextItem:null},Wy(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Cy,previousItem:null,nextItem:null},Wy(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,y,S,I),this}removeDragGradient(y){var S;return this._removeFactorGradient(this._dragGradients,y),0===(null===(S=this._dragGradients)||void 0===S?void 0:S.length)&&(xy(this._dragCreation),xy(this._dragGradientProcessing)),this}addEmitRateGradient(y,S,I){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,y,S,I),this}removeEmitRateGradient(y){return this._removeFactorGradient(this._emitRateGradients,y),this}addStartSizeGradient(y,S,I){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,y,S,I),this._syncStartSizeCreation(),this}removeStartSizeGradient(y){return this._removeFactorGradient(this._startSizeGradients,y),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const y=new Uint8Array(4*this._rawTextureWidth),S=B.TmpColors.DS[0];for(let I=0;I<this._rawTextureWidth;I++){const V=I/this._rawTextureWidth;N.GetCurrentGradient(V,this._rampGradients,((V,i,A)=>{B.DS.LerpToRef(V.color,i.color,A,S),y[4*I]=255*S.r,y[4*I+1]=255*S.g,y[4*I+2]=255*S.b,y[4*I+3]=255}))}this._rampGradientsTexture=H.b.CreateRGBATexture(y,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((y,S)=>y.gradient<S.gradient?-1:y.gradient>S.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(y,S){this._rampGradients||(this._rampGradients=[]);const I=new M(y,S);return this._rampGradients.push(I),this._syncRampGradientTexture(),this}removeRampGradient(y){return this._removeGradientAndTexture(y,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(y,S,I){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Ay,this._colorProcessing.process=By);const V=new X(y,S,I);return this._colorGradients.push(V),this._colorGradients.sort(((y,S)=>y.gradient<S.gradient?-1:y.gradient>S.gradient?1:0)),this}removeColorGradient(y){if(!this._colorGradients)return this;let S=0;for(const I of this._colorGradients){if(I.gradient===y){this._colorGradients.splice(S,1);break}S++}return 0===this._colorGradients.length&&(this._colorCreation.process=iy,this._colorProcessing.process=dy),this}resetDrawCache(){if(this._drawWrappers){for(const y of this._drawWrappers)if(y)for(const S of y)null===S||void 0===S||S.dispose();this._drawWrappers=[]}}_fetchR(y,S,I,V,i){return i[4*(((y=.5*Math.abs(y)+.5)*I%I|0)+((S=.5*Math.abs(S)+.5)*V%V|0)*I)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const y=this._engine,S=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*S),this._vertexBuffer=new my.b(y,this._vertexData,!0,S);let I=0;const V=this._vertexBuffer.createVertexBuffer(my.e.PositionKind,I,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[my.e.PositionKind]=V,I+=3;const i=this._vertexBuffer.createVertexBuffer(my.e.ColorKind,I,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[my.e.ColorKind]=i,I+=4;const A=this._vertexBuffer.createVertexBuffer("angle",I,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=A,I+=1;const B=this._vertexBuffer.createVertexBuffer("size",I,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=B,I+=2,this._isAnimationSheetEnabled){const y=this._vertexBuffer.createVertexBuffer("cellIndex",I,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=y,I+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const y=this._vertexBuffer.createVertexBuffer("direction",I,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=y,I+=3}if(this._useRampGradients){const y=this._vertexBuffer.createVertexBuffer("remapData",I,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=y,I+=4}let d;if(this._useInstancing){const S=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new my.b(y,S,!1,2),d=this._spriteBuffer.createVertexBuffer("offset",0,2)}else d=this._vertexBuffer.createVertexBuffer("offset",I,2,this._vertexBufferSize,this._useInstancing),I+=2;this._vertexBuffers.offset=d,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const y=[],S=[];let I=0;for(let V=0;V<this._capacity;V++)y.push(I),y.push(I+1),y.push(I+2),y.push(I),y.push(I+2),y.push(I+3),S.push(I,I+1,I+1,I+2,I+2,I+3,I+3,I,I,I+3),I+=4;this._indexBuffer=this._engine.createIndexBuffer(y),this._linesIndexBuffer=this._engine.createIndexBuffer(S)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(y)setTimeout((()=>{this.start(0)}),y);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var S;-1!==(null===(S=this.FS)||void 0===S?void 0:S.getClassName().indexOf("Mesh"))&&this.FS.sd(!0);const y=this.noiseTexture;if(y&&y.onGeneratedObservable)y.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let S=0;S<this.preWarmCycles;S++)this.animate(!0),y.render()}))}));else for(let S=0;S<this.preWarmCycles;S++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(y))}_postStop(y){}reset(){this._stockParticles.length=0,this.JG.length=0}_appendParticleVertex(y,S,I,i){let A=y*this._vertexBufferSize;if(this._vertexData[A++]=S.position.x+this.zJ.x,this._vertexData[A++]=S.position.y+this.zJ.y,this._vertexData[A++]=S.position.z+this.zJ.z,this._vertexData[A++]=S.color.r,this._vertexData[A++]=S.color.g,this._vertexData[A++]=S.color.b,this._vertexData[A++]=S.color.a,this._vertexData[A++]=S.angle,this._vertexData[A++]=S.scale.x*S.size,this._vertexData[A++]=S.scale.y*S.size,this._isAnimationSheetEnabled&&(this._vertexData[A++]=S.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[A++]=S.direction.x,this._vertexData[A++]=S.direction.y,this._vertexData[A++]=S.direction.z);else if(S._initialDirection){let y=S._initialDirection;this.isLocal&&(V.OS.TransformNormalToRef(y,this._emitterWorldMatrix,V.TmpVectors.OS[0]),y=V.TmpVectors.OS[0]),0===y.x&&0===y.z&&(y.x=.001),this._vertexData[A++]=y.x,this._vertexData[A++]=y.y,this._vertexData[A++]=y.z}else{let y=S.direction;this.isLocal&&(V.OS.TransformNormalToRef(y,this._emitterWorldMatrix,V.TmpVectors.OS[0]),y=V.TmpVectors.OS[0]),0===y.x&&0===y.z&&(y.x=.001),this._vertexData[A++]=y.x,this._vertexData[A++]=y.y,this._vertexData[A++]=y.z}this._useRampGradients&&S.remapData&&(this._vertexData[A++]=S.remapData.x,this._vertexData[A++]=S.remapData.y,this._vertexData[A++]=S.remapData.z,this._vertexData[A++]=S.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===I?I=this._epsilon:1===I&&(I=1-this._epsilon),0===i?i=this._epsilon:1===i&&(i=1-this._epsilon)),this._vertexData[A++]=I,this._vertexData[A++]=i)}_prepareParticle(y){}_createNewOnes(y){let S;for(let I=0;I<y&&this.JG.length!==this._capacity;I++){S=this._createParticle(),this.JG.push(S);let y=this._createQueueStart;for(;y;)y.process(S,this),y=y.nextItem;S._inheritParticleInfoToSubEmitters()}}_update(y){if(this._alive=this.JG.length>0,this.FS.position){const y=this.FS;this._emitterWorldMatrix=y.getWorldMatrix()}else{const y=this.FS;this._emitterWorldMatrix=V.Matrix.Translation(y.x,y.y,y.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.JG),this._createNewOnes(y)}static _GetAttributeNamesOrOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=[my.e.PositionKind,my.e.ColorKind,"angle","offset","size"];return y&&V.push("cellIndex"),S||V.push("direction"),I&&V.push("remapData"),V}static _GetEffectCreationOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Sy.e)(V),y&&V.push("particlesInfos"),S&&V.push("logarithmicDepthConstant"),I&&(V.push("vFogInfos"),V.push("vFogColor")),V}fillDefines(y,S){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Sy.h)(this,this._scene,y),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&y.push("#define FOG")),this._isAnimationSheetEnabled&&y.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&y.push("#define LOGARITHMICDEPTH"),S===F.BLENDMODE_MULTIPLY&&y.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&y.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(y.push("#define BILLBOARD"),this.billboardMode){case 2:y.push("#define BILLBOARDY");break;case 8:case 9:y.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&y.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:y.push("#define BILLBOARDMODE_ALL")}I&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),y.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(y,S,I){S.push(...Qy._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),y.push(...Qy._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),I.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Vy.g)(y,this._imageProcessingConfigurationDefines),(0,Vy.c)(I,this._imageProcessingConfigurationDefines))}_getWrapper(y){const S=this._getCustomDrawWrapper(y);if(null!==S&&void 0!==S&&S.effect)return S;const I=[];this.fillDefines(I,y);const V=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let i=this._drawWrappers[V];i||(i=this._drawWrappers[V]=[]);let A=i[y];A||(A=new yy.e(this._engine),A.drawContext&&(A.drawContext.useInstancing=this._useInstancing),i[y]=A);const B=I.join("\n");if(A.defines!==B){const y=[],S=[],I=[];this.fillUniformsAttributesAndSamplerNames(S,y,I),A.setEffect(this._engine.createEffect("particles",y,S,I,B,void 0,void 0,void 0,void 0,this._shaderLanguage),B)}return A}animate(){var y;let S,I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!I&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(I?this.preWarmStepOffset:(null===(y=this._scene)||void 0===y?void 0:y.getAnimationRatio())||1),this.manualEmitCount>-1)S=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let y=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const S=this._actualFrame/this.targetStopDuration;N.GetCurrentGradient(S,this._emitRateGradients,((S,I,V)=>{S!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=I.getFactor(),this._currentEmitRateGradient=S),y=(0,J.Lerp)(this._currentEmitRate1,this._currentEmitRate2,V)}))}S=y*this._scaledUpdateSpeed|0,this._newPartsExcess+=y*this._scaledUpdateSpeed-S}if(this._newPartsExcess>1&&(S+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?S=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(S),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!I){let y=0;for(let S=0;S<this.JG.length;S++){const I=this.JG[S];this._appendParticleVertices(y,I),y+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.JG.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(y,S){this._appendParticleVertex(y++,S,0,0),this._useInstancing||(this._appendParticleVertex(y++,S,1,0),this._appendParticleVertex(y++,S,1,1),this._appendParticleVertex(y++,S,0,1))}rebuild(){var y;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(y=this._spriteBuffer)||void 0===y||y._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Qy.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(I.bind(I,13818)),Promise.resolve().then(I.bind(I,13758))])):await Promise.all([Promise.resolve().then(I.bind(I,13743)),Promise.resolve().then(I.bind(I,13737))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.FS||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==F.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(F.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(F.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(y){const S=this._getWrapper(y),I=S.effect,i=this._engine;i.enableEffect(S);const A=this.defaultViewMatrix??this._scene.getViewMatrix();if(I.setTexture("diffuseSampler",this.particleTexture),I.setMatrix("view",A),I.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const y=this.particleTexture.getBaseSize();I.setFloat3("particlesInfos",this.spriteCellWidth/y.width,this.spriteCellHeight/y.height,this.spriteCellWidth/y.width)}if(I.setVector2("translationPivot",this.translationPivot),I.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const y=this._scene.activeCamera;I.setVector3("eyePosition",y.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),I.setTexture("rampSampler",this._rampGradientsTexture));const B=I.defines;var d,F,J,u,K,G;(this._scene&&((0,Sy.f)(I,this,this._scene),this.applyFog&&(0,Iy.f)(this._scene,void 0,I)),B.indexOf("#define BILLBOARDMODE_ALL")>=0&&(A.invertToRef(V.TmpVectors.Matrix[0]),I.setMatrix("invView",V.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?i.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,I):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,I)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?i.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBuffer:this._indexBuffer,I):i.bindBuffers(this._vertexBuffers,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:null,I);(this.useLogarithmicDepth&&this._scene&&(0,Iy.k)(B,I,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(I),this._setEngineBasedOnBlendMode(y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(I),this._useInstancing)?null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?i.drawElementsType(6,0,10,this.JG.length):i.drawArraysType(7,0,4,this.JG.length):null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?i.drawElementsType(1,0,10*this.JG.length):i.drawElementsType(0,0,6*this.JG.length);return this.JG.length}render(){if(!this.isReady()||!this.JG.length)return 0;const y=this._engine;y.setState&&(y.setState(!1),this.forceDepthWrite&&y.setDepthWrite(!0));let S=0;return S=this.blendMode===F.BLENDMODE_MULTIPLYADD?this._render(F.BLENDMODE_MULTIPLY)+this._render(F.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),S}_onDispose(){}dispose(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(S,I),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const y=this._scene.dG.indexOf(this);y>-1&&this._scene.dG.splice(y,1),this._scene._activeParticleSystems.dispose()}this.zi.notifyObservers(this),this.zi.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Qy.ForceGLSL=!1;var cy,Xy=I(12172);!function(y){y[y.ATTACHED=0]="ATTACHED",y[y.END=1]="END"}(cy||(cy={}));class My{constructor(y){if(this.particleSystem=y,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!y.FS||!y.FS.dispose){const S=(0,d.d)("BABYLON.AbstractMesh");y.FS=new S("SubemitterSystemEmitter",y.Ey()),y._disposeEmitterOnDispose=!0}}clone(){let y=this.particleSystem.FS;if(y){if(y instanceof V.OS)y=y.clone();else if(-1!==y.getClassName().indexOf("Mesh")){y=new((0,d.d)("BABYLON.Mesh"))("",y.Ey()),y.isVisible=!1}}else y=new V.OS;const S=new My(this.particleSystem.clone(this.particleSystem.name,y));return S.particleSystem.name+="Clone",S.type=this.type,S.inheritDirection=this.inheritDirection,S.inheritedVelocityAmount=this.inheritedVelocityAmount,S.particleSystem._disposeEmitterOnDispose=!0,S.particleSystem.disposeOnStop=!0,S}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};return S.type=this.type,S.inheritDirection=this.inheritDirection,S.inheritedVelocityAmount=this.inheritedVelocityAmount,S.particleSystem=this.particleSystem.serialize(y),S}static _ParseParticleSystem(y,S,I){throw(0,Xy.b)("ParseParticle")}static Parse(y,S,I){const V=y.particleSystem,i=new My(My._ParseParticleSystem(V,S,I,!0));return i.type=y.type,i.inheritDirection=y.inheritDirection,i.inheritedVelocityAmount=y.inheritedVelocityAmount,i.particleSystem._isSubEmitter=!0,i}dispose(){this.particleSystem.dispose()}}var ty=I(12223);function Ny(y,S){const I=new j;return I.direction1=y,I.direction2=S,I}function Yy(){return new l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Hy(){return new s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Zy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.OS(0,1,0),I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.OS(0,1,0);return new O(y,S,I)}function wy(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function yS(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.OS(0,1,0),A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.OS(0,1,0);return new T(y,S,I,i,A)}function SS(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new G(y,S)}function IS(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.OS(0,1,0),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.OS(0,1,0);return new p(y,S,I,i)}const VS=V.OS.Zero(),iS=V.OS.Zero(),AS=V.OS.Zero();class BS{constructor(){this.strength=0,this.position=V.OS.Zero()}_processParticle(y,S){this.position.subtractToRef(y.position,VS);const I=VS.lengthSquared()+1;VS.normalize().scaleToRef(this.strength/I,iS),iS.scaleToRef(S._tempScaledUpdateSpeed,AS),y.direction.addInPlace(AS)}serialize(){return{position:this.position.Vd(),strength:this.strength}}}class dS extends Qy{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=y=>{if(!this._subEmitters||0===this._subEmitters.length)return;const S=Math.floor(Math.random()*this._subEmitters.length);for(const I of this._subEmitters[S])if(1===I.type){const S=I.clone();y._inheritParticleInfoToSubEmitter(S),S.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(S.particleSystem),S.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(y,S){const I=Ny(y,S);return this.particleEmitterType=I,I}get flowMap(){return this._flowMap}set flowMap(y){this._flowMap!==y&&(this._flowMap=y,this._flowMapUpdate&&(xy(this._flowMapUpdate),this._flowMapUpdate=null),y&&(this._flowMapUpdate={process:y=>{var S;const I=null===(S=this.Ey())||void 0===S?void 0:S.getTransformMatrix();this._flowMap._processParticle(y,this.flowMapStrength*this._tempScaledUpdateSpeed,I)},previousItem:null,nextItem:null},ay(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(y){this._attractors.push(y),1===this._attractors.length&&(this._attractorUpdate={process:y=>{for(const S of this._attractors)S._processParticle(y,this)},previousItem:null,nextItem:null},ay(this._attractorUpdate,this._directionProcessing))}removeAttractor(y){const S=this._attractors.indexOf(y);-1!==S&&this._attractors.splice(S,1),0===this._attractors.length&&xy(this._attractorUpdate)}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(y)}createHemisphericEmitter(){const y=Yy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createSphereEmitter(){const y=Hy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createDirectedSphereEmitter(){const y=Zy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.OS(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.OS(0,1,0));return this.particleEmitterType=y,y}createCylinderEmitter(){const y=wy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=y,y}createDirectedCylinderEmitter(){const y=yS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.OS(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.OS(0,1,0));return this.particleEmitterType=y,y}createConeEmitter(){const y=SS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=y,y}createDirectedConeEmitter(){const y=IS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.OS(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.OS(0,1,0));return this.particleEmitterType=y,y}createBoxEmitter(y,S,I,V){const i=new K;return this.particleEmitterType=i,this.direction1=y,this.direction2=S,this.minEmitBox=I,this.maxEmitBox=V,i}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const y of this.subEmitters)y instanceof dS?this._subEmitters.push([new My(y)]):y instanceof My?this._subEmitters.push([y]):y instanceof Array&&this._subEmitters.push(y)}_stopSubEmitters(){if(this.activeSubSystems){for(const y of this.activeSubSystems)y.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const y=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==y&&this._rootParticleSystem.activeSubSystems.splice(y,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(y){y&&this._stopSubEmitters()}_prepareParticle(y){if(this._subEmitters&&this._subEmitters.length>0){const S=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];y._attachedSubEmitters=[];for(const I of S)if(0===I.type){const S=I.clone();y._attachedSubEmitters.push(S),S.particleSystem.start()}}}_onDispose(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),y&&this.particles)for(const I of this.particles)if(I._attachedSubEmitters)for(let y=I._attachedSubEmitters.length-1;y>=0;y-=1)I._attachedSubEmitters[y].dispose();if(S&&this.activeSubSystems)for(let I=this.activeSubSystems.length-1;I>=0;I-=1)this.activeSubSystems[I].dispose();if(this._subEmitters&&this._subEmitters.length){for(let y=0;y<this._subEmitters.length;y++)for(const S of this._subEmitters[y])S.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.FS&&this.FS.dispose&&this.FS.dispose(!0)}static _Parse(y,S,I,i){let A;A=I instanceof ty.c?null:I;const F=(0,d.d)("BABYLON.Texture");if(F&&A&&(y.texture?S.particleTexture=F.Parse(y.texture,A,i):y.textureName&&(S.particleTexture=new F(i+y.textureName,A,!1,void 0===y.invertY||y.invertY),S.particleTexture.name=y.textureName)),y.emitterId||0===y.emitterId||void 0!==y.FS?y.emitterId&&A?S.FS=A.getLastMeshById(y.emitterId):S.FS=V.OS.oS(y.FS):S.FS=V.OS.Zero(),S.isLocal=!!y.isLocal,void 0!==y.renderingGroupId&&(S.renderingGroupId=y.renderingGroupId),void 0!==y.isBillboardBased&&(S.isBillboardBased=y.isBillboardBased),void 0!==y.billboardMode&&(S.billboardMode=y.billboardMode),void 0!==y.useLogarithmicDepth&&(S.useLogarithmicDepth=y.useLogarithmicDepth),y.animations){for(let I=0;I<y.animations.length;I++){const V=y.animations[I],i=(0,d.d)("BABYLON.Animation");i&&S.animations.push(i.Parse(V))}S.beginAnimationOnStart=y.beginAnimationOnStart,S.beginAnimationFrom=y.beginAnimationFrom,S.beginAnimationTo=y.beginAnimationTo,S.beginAnimationLoop=y.beginAnimationLoop}if(y.autoAnimate&&A&&A.beginAnimation(S,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),S.startDelay=0|y.startDelay,S.minAngularSpeed=y.minAngularSpeed,S.maxAngularSpeed=y.maxAngularSpeed,S.minSize=y.minSize,S.maxSize=y.maxSize,y.minScaleX&&(S.minScaleX=y.minScaleX,S.maxScaleX=y.maxScaleX,S.minScaleY=y.minScaleY,S.maxScaleY=y.maxScaleY),void 0!==y.preWarmCycles&&(S.preWarmCycles=y.preWarmCycles,S.preWarmStepOffset=y.preWarmStepOffset),void 0!==y.minInitialRotation&&(S.minInitialRotation=y.minInitialRotation,S.maxInitialRotation=y.maxInitialRotation),S.minLifeTime=y.minLifeTime,S.maxLifeTime=y.maxLifeTime,S.minEmitPower=y.minEmitPower,S.maxEmitPower=y.maxEmitPower,S.emitRate=y.emitRate,S.gravity=V.OS.oS(y.gravity),y.noiseStrength&&(S.noiseStrength=V.OS.oS(y.noiseStrength)),S.color1=B.vd.oS(y.color1),S.color2=B.vd.oS(y.color2),S.colorDead=B.vd.oS(y.colorDead),S.updateSpeed=y.updateSpeed,S.targetStopDuration=y.targetStopDuration,S.blendMode=y.blendMode,y.colorGradients)for(const V of y.colorGradients)S.addColorGradient(V.gradient,B.vd.oS(V.color1),V.color2?B.vd.oS(V.color2):void 0);if(y.rampGradients){for(const I of y.rampGradients)S.addRampGradient(I.gradient,B.DS.oS(I.color));S.useRampGradients=y.useRampGradients}if(y.colorRemapGradients)for(const V of y.colorRemapGradients)S.addColorRemapGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.alphaRemapGradients)for(const V of y.alphaRemapGradients)S.addAlphaRemapGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.sizeGradients)for(const V of y.sizeGradients)S.addSizeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.angularSpeedGradients)for(const V of y.angularSpeedGradients)S.addAngularSpeedGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.velocityGradients)for(const V of y.velocityGradients)S.addVelocityGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.dragGradients)for(const V of y.dragGradients)S.addDragGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.emitRateGradients)for(const V of y.emitRateGradients)S.addEmitRateGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.startSizeGradients)for(const V of y.startSizeGradients)S.addStartSizeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.lifeTimeGradients)for(const V of y.lifeTimeGradients)S.addLifeTimeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(y.limitVelocityGradients){for(const I of y.limitVelocityGradients)S.addLimitVelocityGradient(I.gradient,void 0!==I.factor1?I.factor1:I.factor,I.factor2);S.limitVelocityDamping=y.limitVelocityDamping}if(y.noiseTexture&&A){const I=(0,d.d)("BABYLON.ProceduralTexture");S.noiseTexture=I.Parse(y.noiseTexture,A,i)}let J;if(y.particleEmitterType){switch(y.particleEmitterType.type){case"SphereParticleEmitter":J=new s;break;case"SphereDirectedParticleEmitter":J=new O;break;case"ConeEmitter":case"ConeParticleEmitter":J=new G;break;case"ConeDirectedParticleEmitter":J=new p;break;case"CylinderParticleEmitter":J=new L;break;case"CylinderDirectedParticleEmitter":J=new T;break;case"HemisphericParticleEmitter":J=new l;break;case"PointParticleEmitter":J=new j;break;case"MeshParticleEmitter":J=new C;break;case"CustomParticleEmitter":J=new f;break;default:J=new K}J.parse(y.particleEmitterType,A)}else J=new K,J.parse(y,A);S.particleEmitterType=J,S.startSpriteCellID=y.startSpriteCellID,S.endSpriteCellID=y.endSpriteCellID,S.spriteCellLoop=y.spriteCellLoop??!0,S.spriteCellWidth=y.spriteCellWidth,S.spriteCellHeight=y.spriteCellHeight,S.spriteCellChangeSpeed=y.spriteCellChangeSpeed,S.spriteRandomStartCell=y.spriteRandomStartCell,S.disposeOnStop=y.disposeOnStop??!1,S.manualEmitCount=y.manualEmitCount??-1}static Parse(y,S,I){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0;const d=y.name;let F,J,u=null,K=null;if(S instanceof ty.c?F=S:(J=S,F=J.getEngine()),y.customShader&&F.createEffectForParticles){K=y.customShader;const S=K.shaderOptions.defines.length>0?K.shaderOptions.defines.join("\n"):"";u=F.createEffectForParticles(K.shaderPath.fragmentElement,K.shaderOptions.uniforms,K.shaderOptions.samplers,S)}const G=new dS(d,A||y.zS,S,u,y.isAnimationSheetEnabled);if(G.customShader=K,G._rootUrl=I,y.id&&(G.id=y.id),y.subEmitters){G.subEmitters=[];for(const V of y.subEmitters){const y=[];for(const i of V)y.push(My.Parse(i,S,I));G.subEmitters.push(y)}}if(y.attractors)for(const B of y.attractors){const y=new BS;y.position=V.OS.oS(B.position),y.strength=B.strength,G.addAttractor(y)}return dS._Parse(y,G,S,I),y.textureMask&&(G.textureMask=B.vd.oS(y.textureMask)),y.zJ&&(G.zJ=V.OS.oS(y.zJ)),y.preventAutoStart&&(G.preventAutoStart=y.preventAutoStart),i||G.preventAutoStart||G.start(),G}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};if(dS._Serialize(S,this,y),S.textureMask=this.textureMask.Vd(),S.customShader=this.customShader,S.preventAutoStart=this.preventAutoStart,S.zJ=this.zJ.Vd(),this.subEmitters){S.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const I of this._subEmitters){const V=[];for(const S of I)V.push(S.serialize(y));S.subEmitters.push(V)}}if(this._attractors&&this._attractors.length){S.attractors=[];for(const y of this._attractors)S.attractors.push(y.serialize())}return S}static _Serialize(y,S,I){if(y.name=S.name,y.id=S.id,y.zS=S.getCapacity(),y.disposeOnStop=S.disposeOnStop,y.manualEmitCount=S.manualEmitCount,S.FS.position){const I=S.FS;y.emitterId=I.id}else{const I=S.FS;y.FS=I.Vd()}S.particleEmitterType&&(y.particleEmitterType=S.particleEmitterType.serialize()),S.particleTexture&&(I?y.texture=S.particleTexture.serialize():(y.textureName=S.particleTexture.name,y.invertY=!!S.particleTexture._invertY)),y.isLocal=S.isLocal,q.d.AppendSerializedAnimations(S,y),y.beginAnimationOnStart=S.beginAnimationOnStart,y.beginAnimationFrom=S.beginAnimationFrom,y.beginAnimationTo=S.beginAnimationTo,y.beginAnimationLoop=S.beginAnimationLoop,y.startDelay=S.startDelay,y.renderingGroupId=S.renderingGroupId,y.isBillboardBased=S.isBillboardBased,y.billboardMode=S.billboardMode,y.minAngularSpeed=S.minAngularSpeed,y.maxAngularSpeed=S.maxAngularSpeed,y.minSize=S.minSize,y.maxSize=S.maxSize,y.minScaleX=S.minScaleX,y.maxScaleX=S.maxScaleX,y.minScaleY=S.minScaleY,y.maxScaleY=S.maxScaleY,y.minEmitPower=S.minEmitPower,y.maxEmitPower=S.maxEmitPower,y.minLifeTime=S.minLifeTime,y.maxLifeTime=S.maxLifeTime,y.emitRate=S.emitRate,y.gravity=S.gravity.Vd(),y.noiseStrength=S.noiseStrength.Vd(),y.color1=S.color1.Vd(),y.color2=S.color2.Vd(),y.colorDead=S.colorDead.Vd(),y.updateSpeed=S.updateSpeed,y.targetStopDuration=S.targetStopDuration,y.blendMode=S.blendMode,y.preWarmCycles=S.preWarmCycles,y.preWarmStepOffset=S.preWarmStepOffset,y.minInitialRotation=S.minInitialRotation,y.maxInitialRotation=S.maxInitialRotation,y.startSpriteCellID=S.startSpriteCellID,y.spriteCellLoop=S.spriteCellLoop,y.endSpriteCellID=S.endSpriteCellID,y.spriteCellChangeSpeed=S.spriteCellChangeSpeed,y.spriteCellWidth=S.spriteCellWidth,y.spriteCellHeight=S.spriteCellHeight,y.spriteRandomStartCell=S.spriteRandomStartCell,y.isAnimationSheetEnabled=S.isAnimationSheetEnabled,y.useLogarithmicDepth=S.useLogarithmicDepth;const V=S.getColorGradients();if(V){y.colorGradients=[];for(const S of V){const I={gradient:S.gradient,color1:S.color1.Vd()};S.color2?I.color2=S.color2.Vd():I.color2=S.color1.Vd(),y.colorGradients.push(I)}}const i=S.getRampGradients();if(i){y.rampGradients=[];for(const S of i){const I={gradient:S.gradient,color:S.color.Vd()};y.rampGradients.push(I)}y.useRampGradients=S.useRampGradients}const A=S.getColorRemapGradients();if(A){y.colorRemapGradients=[];for(const S of A){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.colorRemapGradients.push(I)}}const B=S.getAlphaRemapGradients();if(B){y.alphaRemapGradients=[];for(const S of B){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.alphaRemapGradients.push(I)}}const d=S.getSizeGradients();if(d){y.sizeGradients=[];for(const S of d){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.sizeGradients.push(I)}}const F=S.getAngularSpeedGradients();if(F){y.angularSpeedGradients=[];for(const S of F){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.angularSpeedGradients.push(I)}}const J=S.getVelocityGradients();if(J){y.velocityGradients=[];for(const S of J){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.velocityGradients.push(I)}}const u=S.getDragGradients();if(u){y.dragGradients=[];for(const S of u){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.dragGradients.push(I)}}const K=S.getEmitRateGradients();if(K){y.emitRateGradients=[];for(const S of K){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.emitRateGradients.push(I)}}const G=S.getStartSizeGradients();if(G){y.startSizeGradients=[];for(const S of G){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.startSizeGradients.push(I)}}const p=S.getLifeTimeGradients();if(p){y.lifeTimeGradients=[];for(const S of p){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.lifeTimeGradients.push(I)}}const L=S.getLimitVelocityGradients();if(L){y.limitVelocityGradients=[];for(const S of L){const I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,y.limitVelocityGradients.push(I)}y.limitVelocityDamping=S.limitVelocityDamping}S.noiseTexture&&(y.noiseTexture=S.noiseTexture.serialize())}clone(y,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V={...this._customWrappers};let i=null;const A=this._engine;if(A.createEffectForParticles&&null!=this.customShader){i=this.customShader;const y=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"",S=A.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,y);V[0]?V[0].effect=S:this.setCustomEffect(S,0)}const B=this.serialize(I),d=dS.Parse(B,this._scene||this._engine,this._rootUrl);return d.name=y,d.customShader=i,d._customWrappers=V,void 0===S&&(S=this.FS),this.noiseTexture&&(d.noiseTexture=this.noiseTexture.clone()),d.FS=S,this.preventAutoStart||d.start(),d}}dS.BILLBOARDMODE_Y=2,dS.BILLBOARDMODE_ALL=7,dS.BILLBOARDMODE_STRETCHED=8,dS.BILLBOARDMODE_STRETCHED_LOCAL=9,My._ParseParticleSystem=dS.Parse;var FS=I(12562),JS=I(12556),uS=I(12455);uS.c.prototype.createTransformFeedback=function(){const y=this._gl.createTransformFeedback();if(!y)throw new Error("Unable to create Transform Feedback");return y},uS.c.prototype.deleteTransformFeedback=function(y){this._gl.deleteTransformFeedback(y)},uS.c.prototype.bindTransformFeedback=function(y){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,y)},uS.c.prototype.beginTransformFeedback=function(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(y?this._gl.POINTS:this._gl.TRIANGLES)},uS.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},uS.c.prototype.setTranformFeedbackVaryings=function(y,S){this._gl.transformFeedbackVaryings(y,S,this._gl.INTERLEAVED_ATTRIBS)},uS.c.prototype.bindTransformFeedbackBuffer=function(y){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,y?y.underlyingResource:null)},uS.c.prototype.readTransformFeedbackBuffer=function(y){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,y)};const KS="clipPlaneFragmentDeclaration2",GS="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";o.b.IncludesShadersStore[KS]||(o.b.IncludesShadersStore[KS]=GS);I(13635),I(13641),I(13646),I(13650),I(13659),I(13668),I(13673),I(13676);const pS="gpuRenderParticlesPixelShader",LS="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";o.b.ShadersStore[pS]||(o.b.ShadersStore[pS]=LS);const TS="clipPlaneVertexDeclaration2",lS="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";o.b.IncludesShadersStore[TS]||(o.b.IncludesShadersStore[TS]=lS);I(13680),I(13689),I(13698),I(13701);const jS="gpuRenderParticlesVertexShader",sS="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";o.b.ShadersStore[jS]||(o.b.ShadersStore[jS]=sS);class OS extends F{static get IsSupported(){if(!Z.e.LastCreatedEngine)return!1;const y=Z.e.LastCreatedEngine.getCaps();return y.supportTransformFeedbacks||y.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(y){this._maxActiveParticleCount=Math.min(y,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(y){this.maxActiveParticleCount=y}createPointEmitter(y,S){const I=Ny(y,S);return this.particleEmitterType=I,I}createHemisphericEmitter(){const y=Yy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createSphereEmitter(){const y=Hy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createDirectedSphereEmitter(){const y=Zy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.OS(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.OS(0,1,0));return this.particleEmitterType=y,y}createCylinderEmitter(){const y=wy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=y,y}createDirectedCylinderEmitter(){const y=yS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.OS(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.OS(0,1,0));return this.particleEmitterType=y,y}createConeEmitter(){const y=SS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=y,y}createDirectedConeEmitter(){const y=IS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.OS(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.OS(0,1,0));return this.particleEmitterType=y,y}createBoxEmitter(y,S,I,V){const i=new K;return this.particleEmitterType=i,this.direction1=y,this.direction2=S,this.minEmitBox=I,this.maxEmitBox=V,i}get flowMap(){return this._flowMap}set flowMap(y){this._flowMap!==y&&(this._flowMap=y)}isReady(){if(!this.FS||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==dS.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(dS.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(dS.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";y?setTimeout((()=>{this.start(0)}),y):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var y;let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(y=this._customWrappers[S])||void 0===y?void 0:y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[y]??this._customWrappers[0]}setCustomEffect(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[S]=new yy.e(this._engine),this._customWrappers[S].effect=y}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Y.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(y,S,I){return super._removeGradientAndTexture(y,S,I),this._releaseBuffers(),this}addColorGradient(y,S){this._colorGradients||(this._colorGradients=[]);const I=new X(y,S);return this._colorGradients.push(I),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(y&&this._colorGradients.sort(((y,S)=>y.gradient<S.gradient?-1:y.gradient>S.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(y){return this._removeGradientAndTexture(y,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const S in this._drawWrappers){var y;null===(y=this._drawWrappers[S].drawContext)||void 0===y||y.reset()}}_addFactorGradient(y,S,I){const V=new t(S,I);y.push(V),this._releaseBuffers()}addSizeGradient(y,S){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,y,S),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(y){return this._removeGradientAndTexture(y,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(y,S){if(!y)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&y.sort(((y,S)=>y.gradient<S.gradient?-1:y.gradient>S.gradient?1:0));const I=this;I[S]&&(I[S].dispose(),I[S]=null)}addAngularSpeedGradient(y,S){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,y,S),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(y){return this._removeGradientAndTexture(y,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(y,S){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,y,S),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(y){return this._removeGradientAndTexture(y,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(y,S){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,y,S),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(y){return this._removeGradientAndTexture(y,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(y,S){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,y,S),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(y){return this._removeGradientAndTexture(y,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(y){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(y,S,I){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(y),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.zi=new Y.b,this.onStoppedObservable=new Y.b,this.onStartedObservable=new Y.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,I&&"Scene"!==I.getClassName()?(this._engine=I,this.defaultProjectionMatrix=V.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=I||Z.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.dG.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,d.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,d.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,d.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,d.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new yy.e(this._engine)},this._customWrappers[0].effect=i,this._drawWrappers={0:new yy.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(S=S??{}).randomTextureSize||delete S.randomTextureSize;const B={zS:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...S},F=S;isFinite(F)&&(B.zS=F),this._capacity=B.zS,this._maxActiveParticleCount=B.zS,this._currentActiveCount=0,this._isAnimationSheetEnabled=A,this.particleEmitterType=new K;const J=Math.min(this._engine.getCaps().maxTextureSize,B.randomTextureSize);let u=[];for(let V=0;V<J;++V)u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random());this._randomTexture=new H.b(new Float32Array(u),J,1,5,I,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,u=[];for(let V=0;V<J;++V)u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random());this._randomTexture2=new H.b(new Float32Array(u),J,1,5,I,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=J}_reset(){this._releaseBuffers()}_createVertexBuffers(y,S,I){const V={};V.position=S.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let i=3;V.age=S.createVertexBuffer("age",i,1,this._attributesStrideSize,!0),i+=1,V.size=S.createVertexBuffer("size",i,3,this._attributesStrideSize,!0),i+=3,V.life=S.createVertexBuffer("life",i,1,this._attributesStrideSize,!0),i+=1,i+=4,this.billboardMode===dS.BILLBOARDMODE_STRETCHED&&(V.direction=S.createVertexBuffer("direction",i,3,this._attributesStrideSize,!0)),i+=3,this._platform.alignDataInBuffer&&(i+=1),this.particleEmitterType instanceof f&&(i+=3,this._platform.alignDataInBuffer&&(i+=1)),this._colorGradientsTexture||(V.color=S.createVertexBuffer("color",i,4,this._attributesStrideSize,!0),i+=4),this._isBillboardBased||(V.initialDirection=S.createVertexBuffer("initialDirection",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1)),this.noiseTexture&&(V.noiseCoordinates1=S.createVertexBuffer("noiseCoordinates1",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1),V.noiseCoordinates2=S.createVertexBuffer("noiseCoordinates2",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1)),V.angle=S.createVertexBuffer("angle",i,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?i++:i+=2,this._isAnimationSheetEnabled&&(V.cellIndex=S.createVertexBuffer("cellIndex",i,1,this._attributesStrideSize,!0),i+=1,this.spriteRandomStartCell&&(V.cellStartOffset=S.createVertexBuffer("cellStartOffset",i,1,this._attributesStrideSize,!0),i+=1)),V.offset=I.createVertexBuffer("offset",0,2),V.uv=I.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(V),this._platform.createVertexBuffers(y,V),this.resetDrawCache()}_initialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!y)return;const S=this._engine,I=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof f&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const i=this.particleEmitterType instanceof f,A=V.TmpVectors.OS[0];let B=0;for(let V=0;V<this._capacity;V++)if(I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),i?(this.particleEmitterType.particleDestinationGenerator(V,null,A),I.push(A.x),I.push(A.y),I.push(A.z)):(I.push(0),I.push(0),I.push(0)),this._platform.alignDataInBuffer&&I.push(0),B+=16,i&&(this.particleEmitterType.particlePositionGenerator(V,null,A),I.push(A.x),I.push(A.y),I.push(A.z),this._platform.alignDataInBuffer&&I.push(0),B+=4),this._colorGradientsTexture||(I.push(0),I.push(0),I.push(0),I.push(0),B+=4),this.isBillboardBased||(I.push(0),I.push(0),I.push(0),this._platform.alignDataInBuffer&&I.push(0),B+=4),this.noiseTexture&&(I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),this._platform.alignDataInBuffer&&I.push(0),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),this._platform.alignDataInBuffer&&I.push(0),B+=8),I.push(0),B+=1,this._angularSpeedGradientsTexture||(I.push(0),B+=1),this._isAnimationSheetEnabled&&(I.push(0),B+=1,this.spriteRandomStartCell&&(I.push(0),B+=1)),this._platform.alignDataInBuffer){let y=3-(B+3&3);for(B+=y;y-- >0;)I.push(0)}const d=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),F=this._platform.createParticleBuffer(I),J=this._platform.createParticleBuffer(I);this._buffer0=new my.b(S,F,!1,this._attributesStrideSize),this._buffer1=new my.b(S,J,!1,this._attributesStrideSize),this._spriteBuffer=new my.b(S,d,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let y=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(y+="\n#define BILLBOARD"),this._colorGradientsTexture&&(y+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(y+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(y+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(y+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(y+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(y+="\n#define DRAGGRADIENTS"),this._flowMap&&(y+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(y+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(y+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(y+="\n#define NOISE"),this.isLocal&&(y+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===y||(this._cachedUpdateDefines=y,this._updateBuffer=this._platform.createUpdateBuffer(y)),this._platform.isUpdateBufferReady()}_getWrapper(y){const S=this._getCustomDrawWrapper(y);if(null!==S&&void 0!==S&&S.effect)return S;const I=[];this.fillDefines(I,y);let V=this._drawWrappers[y];V||(V=new yy.e(this._engine),V.drawContext&&(V.drawContext.useInstancing=!0),this._drawWrappers[y]=V);const i=I.join("\n");if(V.defines!==i){const y=[],S=[],I=[];this.fillUniformsAttributesAndSamplerNames(S,y,I),V.setEffect(this._engine.createEffect("gpuRenderParticles",y,S,I,i),i)}return V}static _GetAttributeNamesOrOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=[my.e.PositionKind,"age","life","size","angle"];return y||i.push(my.e.ColorKind),S&&i.push("cellIndex"),I||i.push("initialDirection"),V&&i.push("direction"),i.push("offset",my.e.UVKind),i}static _GetEffectCreationOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=["emitterWM","zJ","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Sy.e)(V),y&&V.push("sheetInfos"),S&&V.push("logarithmicDepthConstant"),I&&(V.push("vFogInfos"),V.push("vFogColor")),V}fillDefines(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Sy.h)(this,this._scene,y),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==JS.e.FOGMODE_NONE&&y.push("#define FOG")),S===dS.BLENDMODE_MULTIPLY&&y.push("#define BLENDMULTIPLYMODE"),this.isLocal&&y.push("#define LOCAL"),this.useLogarithmicDepth&&y.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(y.push("#define BILLBOARD"),this.billboardMode){case dS.BILLBOARDMODE_Y:y.push("#define BILLBOARDY");break;case dS.BILLBOARDMODE_STRETCHED:y.push("#define BILLBOARDSTRETCHED");break;case dS.BILLBOARDMODE_ALL:y.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&y.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&y.push("#define ANIMATESHEET"),I&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),y.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(y,S,I){S.push(...OS._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===dS.BILLBOARDMODE_STRETCHED)),y.push(...OS._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),I.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(FS.d.PrepareUniforms(y,this._imageProcessingConfigurationDefines),FS.d.PrepareSamplers(I,this._imageProcessingConfigurationDefines))}animate(){var y;let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(S?this.preWarmStepOffset:(null===(y=this._scene)||void 0===y?void 0:y.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(y,S){const I=this[S];if(!y||!y.length||I)return;const V=new Float32Array(this._rawTextureWidth);for(let i=0;i<this._rawTextureWidth;i++){const S=i/this._rawTextureWidth;N.GetCurrentGradient(S,y,((y,S,I)=>{V[i]=(0,J.Lerp)(y.factor1,S.factor1,I)}))}this[S]=H.b.CreateRTexture(V,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[S].name=S.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const y=new Uint8Array(4*this._rawTextureWidth),S=B.TmpColors.vd[0];for(let I=0;I<this._rawTextureWidth;I++){const V=I/this._rawTextureWidth;N.GetCurrentGradient(V,this._colorGradients,((V,i,A)=>{B.vd.LerpToRef(V.color1,i.color1,A,S),y[4*I]=255*S.r,y[4*I+1]=255*S.g,y[4*I+2]=255*S.b,y[4*I+3]=255*S.a}))}this._colorGradientsTexture=H.b.CreateRGBATexture(y,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(y,S){var I,i,A,B;const d=this._getWrapper(y),F=d.effect;this._engine.enableEffect(d);const J=(null===(I=this._scene)||void 0===I?void 0:I.getViewMatrix())||V.Matrix.IdentityReadOnly;if(F.setMatrix("view",J),F.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),F.setTexture("diffuseSampler",this.particleTexture),F.setVector2("translationPivot",this.translationPivot),F.setVector3("zJ",this.zJ),this.isLocal&&F.setMatrix("emitterWM",S),this._colorGradientsTexture?F.setTexture("colorGradientSampler",this._colorGradientsTexture):F.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const y=this.particleTexture.getBaseSize();F.setFloat3("sheetInfos",this.spriteCellWidth/y.width,this.spriteCellHeight/y.height,y.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const y=this._scene.activeCamera;F.setVector3("eyePosition",y.globalPosition)}const u=F.defines;if(this._scene&&((0,Sy.f)(F,this,this._scene),this.applyFog&&(0,Iy.f)(this._scene,void 0,F)),u.indexOf("#define BILLBOARDMODE_ALL")>=0){const y=J.clone();y.invert(),F.setMatrix("invView",y)}return this.useLogarithmicDepth&&this._scene&&(0,Iy.k)(u,F,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(F),this._setEngineBasedOnBlendMode(y),this._platform.bindDrawBuffers(this._targetIndex,F,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(F),null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(y){if(!this.FS||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!y)if(this.FS.position){y=this.FS.getWorldMatrix()}else{const S=this.FS;y=V.TmpVectors.Matrix[0],V.Matrix.TranslationToRef(S.x,S.y,S.z,y)}const S=this._engine,I=S.getDepthWrite();if(S.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const y=this.Ey();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",y.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",y),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const i=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=i,S.setDepthWrite(I)}render(){let y,S=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!S&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let y=0;y<this.preWarmCycles;y++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const y=0|this._accumulatedCount;this._accumulatedCount-=y,this._currentActiveCount+=y}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.FS.position){y=this.FS.getWorldMatrix()}else{const S=this.FS;y=V.TmpVectors.Matrix[0],V.Matrix.TranslationToRef(S.x,S.y,S.z,y)}const i=this._engine;this.updateInAnimate||this._update(y);let A=0;return S||I||(i.setState(!1),this.forceDepthWrite&&i.setDepthWrite(!0),A=this.blendMode===dS.BLENDMODE_MULTIPLYADD?this._render(dS.BLENDMODE_MULTIPLY,y)+this._render(dS.BLENDMODE_ADD,y):this._render(this.blendMode,y),this._engine.setAlphaMode(0)),A}rebuild(){const y=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(y,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,y()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const S in this._drawWrappers){this._drawWrappers[S].dispose()}if(this._drawWrappers={},this._scene){const y=this._scene.dG.indexOf(this);y>-1&&this._scene.dG.splice(y,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let S=0;S<this._renderVertexBuffers.length;++S){const y=this._renderVertexBuffers[S];for(const S in y)y[S].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.zi.notifyObservers(this),this.zi.clear()}clone(y,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V={...this._customWrappers};let i=null;const A=this._engine;if(A.createEffectForParticles&&null!=this.customShader){i=this.customShader;const y=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"";V[0]=A.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,y,void 0,void 0,void 0,this)}const B=this.serialize(I),d=OS.Parse(B,this._scene||this._engine,this._rootUrl);return d.name=y,d.customShader=i,d._customWrappers=V,void 0===S&&(S=this.FS),this.noiseTexture&&(d.noiseTexture=this.noiseTexture.clone()),d.FS=S,d}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};return dS._Serialize(S,this,y),S.activeParticleCount=this.activeParticleCount,S.randomTextureSize=this._randomTextureSize,S.customShader=this.customShader,S}static Parse(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;const A=y.name;let B,d;S instanceof ty.c?B=S:(d=S,B=d.getEngine());const F=new OS(A,{zS:i||y.zS,randomTextureSize:y.randomTextureSize},S,null,y.isAnimationSheetEnabled);if(F._rootUrl=I,y.customShader&&B.createEffectForParticles){const S=y.customShader,I=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"",V=B.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,I,void 0,void 0,void 0,F);F.setCustomEffect(V,0),F.customShader=S}return y.id&&(F.id=y.id),y.activeParticleCount&&(F.activeParticleCount=y.activeParticleCount),dS._Parse(y,F,S,I),y.preventAutoStart&&(F.preventAutoStart=y.preventAutoStart),V||F.preventAutoStart||F.start(),F}}var fS=I(12128),mI=I(13703),CS=I(12686);class DS{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(y){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const S of this.systems)S.FS=y;this._emitterNode=y}setEmitterAsSphere(y,S,I){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:y,renderingGroupId:S};const V=(0,mI.b)("emitterSphere",{diameter:y.diameter,segments:y.segments},I);V.renderingGroupId=S;const i=new CS.CS("emitterSphereMaterial",I);i.emissiveColor=y.color,V.material=i;for(const A of this.systems)A.FS=V;this._emitterNode=V}start(y){for(const S of this.systems)y&&(S.FS=y),S.start()}dispose(){for(const y of this.systems)y.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={systems:[]};for(const I of this.systems)S.systems.push(I.serialize(y));return this._emitterNode&&(S.FS=this._emitterCreationOptions),S}static Parse(y,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0;const i=new DS,A=this.BaseAssetsUrl+"/textures/";S=S||Z.e.LastCreatedScene;for(const B of y.systems)i.systems.push(I?OS.Parse(B,S,A,!0,V):dS.Parse(B,S,A,!0,V));if(y.FS){const I=y.FS.options;if("Sphere"===y.FS.kind)i.setEmitterAsSphere({diameter:I.diameter,segments:I.segments,color:B.DS.oS(I.color)},y.FS.renderingGroupId,S)}return i}}DS.BaseAssetsUrl="https://assets.babylonjs.com/particles";var oS=I(12177);class ES{static CreateDefault(y){let S,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,V=arguments.length>2?arguments[2]:void 0;S=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new OS("default system",{zS:I},V):new dS("default system",I,V),S.FS=y;const i=fS.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return S.particleTexture=new g.e(i,S.Ey()),S.createConeEmitter(.1,Math.PI/4),S.color1=new B.vd(1,1,1,1),S.color2=new B.vd(1,1,1,1),S.colorDead=new B.vd(1,1,1,0),S.minSize=.1,S.maxSize=.1,S.minEmitPower=2,S.maxEmitPower=2,S.updateSpeed=1/60,S.emitRate=30,S}static CreateAsync(y,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0;S||(S=Z.e.LastCreatedScene);const i={};return S.addPendingData(i),new Promise(((A,B)=>{if(I&&!OS.IsSupported)return S.removePendingData(i),B("Particle system with GPU is not supported.");fS.Tools.LoadFile(`${ES.BaseAssetsUrl}/systems/${y}.json`,(y=>{S.removePendingData(i);const B=JSON.parse(y.toString());return A(DS.Parse(B,S,I,V))}),void 0,void 0,void 0,(()=>(S.removePendingData(i),B(`An error occurred with the creation of your particle system. Check if your type '${y}' exists.`))))}))}static ExportSet(y){const S=new DS;for(const I of y)S.systems.push(I);return S}static ParseFromFileAsync(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",A=arguments.length>5?arguments[5]:void 0;return new Promise(((B,d)=>{const F=new oS.e;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const S=JSON.parse(F.responseText);let d;d=V?OS.Parse(S,I,i,!1,A):dS.Parse(S,I,i,!1,A),y&&(d.name=y),B(d)}else d("Unable to load the particle system")})),F.open("GET",S),F.send()}))}static ParseFromSnippetAsync(y,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;if("_BLANK"===y){const y=this.CreateDefault(null);return y.start(),Promise.resolve(y)}return new Promise(((A,B)=>{const d=new oS.e;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const B=JSON.parse(JSON.parse(d.responseText).jsonPayload),F=JSON.parse(B.particleSystem);let J;J=I?OS.Parse(F,S,V,!1,i):dS.Parse(F,S,V,!1,i),J.snippetId=y,A(J)}else B("Unable to load the snippet "+y)})),d.open("GET",this.SnippetUrl+"/"+y.replace(/#/g,"/")),d.send()}))}}ES.BaseAssetsUrl=DS.BaseAssetsUrl,ES.SnippetUrl="https://snippet.babylonjs.com",ES.CreateFromSnippetAsync=ES.ParseFromSnippetAsync;var zS=I(12753),rS=I(12583),hS=I(13711);(0,hS.f)(rS.c.NAME_PARTICLESYSTEM,((y,S,I,V)=>{const i=(0,hS.j)(rS.c.NAME_PARTICLESYSTEM);if(i&&void 0!==y.dG&&null!==y.dG)for(let A=0,B=y.dG.length;A<B;A++){const B=y.dG[A];I.dG.push(i(B,S,V))}})),(0,hS.b)(rS.c.NAME_PARTICLESYSTEM,((y,S,I)=>{if(y.activeParticleCount){return OS.Parse(y,S,I)}return dS.Parse(y,S,I)})),ty.c.prototype.createEffectForParticles=function(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",A=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,d=arguments.length>6?arguments[6]:void 0,F=arguments.length>7?arguments[7]:void 0,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9?arguments[9]:void 0,K=[],G=[];const p=[];return F?F.fillUniformsAttributesAndSamplerNames(G,K,p):(K=dS._GetAttributeNamesOrOptions(),G=dS._GetEffectCreationOptions()),-1===i.indexOf(" BILLBOARD")&&(i+="\n#define BILLBOARD\n"),null!==F&&void 0!==F&&F.isAnimationSheetEnabled&&-1===i.indexOf(" ANIMATESHEET")&&(i+="\n#define ANIMATESHEET\n"),-1===V.indexOf("diffuseSampler")&&V.push("diffuseSampler"),this.createEffect({vertex:u??(null===F||void 0===F?void 0:F.vertexShaderName)??"particles",fragmentElement:y},K,G.concat(S),p.concat(V),i,A,B,d,void 0,J,(async()=>{0===J?await Promise.resolve().then(I.bind(I,13743)):await Promise.resolve().then(I.bind(I,13818))}))},zS.c.prototype.getEmittedParticleSystems=function(){const y=[];for(let S=0;S<this.Ey().dG.length;S++){const I=this.Ey().dG[S];I.FS===this&&y.push(I)}return y},zS.c.prototype.getHierarchyEmittedParticleSystems=function(){const y=[],S=this.getDescendants();S.push(this);for(let I=0;I<this.Ey().dG.length;I++){const V=this.Ey().dG[I],i=V.FS;i.position&&-1!==S.indexOf(i)&&y.push(V)}return y};I(12660),I(12667),I(12734);I(12739),I(13718),I(12524),I(12644),I(12776);I(12518);var nS;I(13725),I(12340);!function(y){y[y.Color=2]="Color",y[y.UV=1]="UV",y[y.Random=0]="Random",y[y.Stated=3]="Stated"}(nS||(nS={}));var vS=I(12550);const PS=new V.OS(0,0,0),qS=new V.OS(0,0,0),gS=new V.OS(0,0,0);class kS{constructor(y,S,I){this.width=y,this.height=S,this.data=I}processFlowable(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2?arguments[2]:void 0;if(!I)return;I instanceof V.Matrix?V.OS.TransformCoordinatesToRef(y.position,I,gS):(gS.x=I.x,gS.y=I.y,gS.z=I.z);const i=.5*gS.x+.5,A=1-(.5*gS.y+.5),B=Math.floor(i*this.width),d=Math.floor(A*this.height);if(B<0||B>=this.width||d<0||d>=this.height)return;const F=4*(d*this.width+B),J=this.data[F]/255*2-1,u=this.data[F+1]/255*2-1,K=this.data[F+2]/255*2-1,G=this.data[F+3]/255;PS.set(J,u,K),PS.scaleToRef(S*G,qS),y.direction.addInPlace(qS)}_processParticle(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2?arguments[2]:void 0;this.processFlowable(y,S,I)}static async FromUrlAsync(y){return await new Promise(((S,I)=>{const V=document.createElement("canvas"),i=V.getContext("2d");let A=null;const B=new Image;B.crossOrigin="anonymous",B.src=y,B.onerror=S=>{I(new Error(`Failed to load image: ${y} : ${S}`))},B.onload=()=>{V.width=B.width,V.height=B.height,i.drawImage(B,0,0),A=i.getImageData(0,0,V.width,V.height),S(new kS(V.width,V.height,A.data))}}))}static async ExtractFromTextureAsync(y){return await new Promise(((S,I)=>{if(!y.isReady())return void y.onLoadObservable.addOnce((async()=>{try{const I=await this.ExtractFromTextureAsync(y);S(I)}catch(V){I(V)}}));const V=y.getSize();vS.m.GetTextureDataAsync(y,V.width,V.height).then((y=>{S(new kS(V.width,V.height,new Uint8ClampedArray(y)))})).catch(I)}))}}var RS,bS,US,WS,aS,eS,xS,QS,cS;!function(y){y[y.Int=1]="Int",y[y.Float=2]="Float",y[y.Vector2=4]="Vector2",y[y.OS=8]="OS",y[y.Matrix=16]="Matrix",y[y.Particle=32]="Particle",y[y.Texture=64]="Texture",y[y.vd=128]="vd",y[y.FloatGradient=256]="FloatGradient",y[y.Vector2Gradient=512]="Vector2Gradient",y[y.Vector3Gradient=1024]="Vector3Gradient",y[y.Color4Gradient=2048]="Color4Gradient",y[y.System=4096]="System",y[y.AutoDetect=8192]="AutoDetect",y[y.BasedOnInput=16384]="BasedOnInput",y[y.Undefined=32768]="Undefined",y[y.All=65535]="All"}(RS||(RS={})),function(y){y[y.Compatible=0]="Compatible",y[y.TypeIncompatible=1]="TypeIncompatible",y[y.HierarchyIssue=2]="HierarchyIssue"}(bS||(bS={})),function(y){y[y.Input=0]="Input",y[y.Output=1]="Output"}(US||(US={}));class XS{get direction(){return this._direction}get type(){if(this._type===RS.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===RS.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(y){this._type=y}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((y=>y.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(y,S,I){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=RS.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new Y.b,this.onDisconnectionObservable=new Y.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=S,this.name=y,this._direction=I}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(y){var S;return this.isConnected?null!==(S=this._connectedPoint)&&void 0!==S&&S._storedFunction?this._connectedPoint._storedFunction(y):this._connectedPoint._storedValue:this.value}canConnectTo(y){return 0===this.checkCompatibilityState(y)}checkCompatibilityState(y){const S=this._ownerBlock,I=y.ownerBlock;if(this.type!==y.type&&y.innerType!==RS.AutoDetect)return y.acceptedConnectionPointTypes&&-1!==y.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(y.excludedConnectionPointTypes&&-1!==y.excludedConnectionPointTypes.indexOf(this.type))return 1;let V=I,i=S;return 0===this.direction&&(V=S,i=I),V.isAnAncestorOf(i)?2:0}connectTo(y){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(y))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${y.ownerBlock.name}".${y.name}`;return this._endpoints.push(y),y._connectedPoint=this,this.onConnectionObservable.notifyObservers(y),y.onConnectionObservable.notifyObservers(this),this}disconnectFrom(y){const S=this._endpoints.indexOf(y);return-1===S||(this._endpoints.splice(S,1),y._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(y),y.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(y){let S=1;for(;S<RS.All;)y&S||this.excludedConnectionPointTypes.push(S),S<<=1}serialize(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const S={};return S.name=this.name,S.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Vd?(S.valueType="BABYLON."+this.value.getClassName(),S.value=this.value.Vd()):(S.valueType="number",S.value=this.value)),y&&this.connectedPoint&&(S.inputName=this.name,S.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,S.targetConnectionName=this.connectedPoint.name,S.isExposedOnFrame=!0,S.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(S.isExposedOnFrame=!0,S.exposedPortPosition=this.exposedPortPosition),S}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class MS{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(y){this._name=y}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(y){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new Y.b,this.zi=new Y.b,this.onInputChangedObservable=new Y.b,this.visibleOnFrame=!1,this._name=y,this.uniqueId=k.d.UniqueId}_inputRename(y){return y}_outputRename(y){return y}isAnAncestorOf(y){for(const S of this._outputs)if(S.hasEndpoints)for(const I of S.endpoints){if(I.ownerBlock===y)return!0;if(I.ownerBlock.isAnAncestorOf(y))return!0}return!1}isAnAncestorOfType(y){if(this.getClassName()===y)return!0;for(const S of this._outputs)if(S.hasEndpoints)for(const I of S.endpoints)if(I.ownerBlock.isAnAncestorOfType(y))return!0;return!1}getInputByName(y){const S=this._inputs.filter((S=>S.name===y));return S.length?S[0]:null}_linkConnectionTypes(y,S){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[S]._acceptedConnectionPointType=this._inputs[y]:(this._inputs[y]._linkedConnectionSource=this._inputs[S],this._inputs[y]._isMainLinkSource=!0),this._inputs[S]._linkedConnectionSource=this._inputs[y]}registerInput(y,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0;const B=new XS(y,this,0);return B.type=S,B.isOptional=I,B.defaultValue=V,B.value=V,B.valueMin=i,B.valueMax=A,this._inputs.push(B),this.onInputChangedObservable.notifyObservers(B),this}registerOutput(y,S,I){return(I=I??new XS(y,this,1)).type=S,this._outputs.push(I),this}_build(y){}_customBuildStep(y){}build(y){if(this._buildId===y.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((y=>y.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=y.buildId;for(const S of this._inputs){if(!S.connectedPoint){S.isOptional||y.notConnectedNonOptionalInputs.push(S);continue}const I=S.connectedPoint.ownerBlock;I&&I!==this&&!I.isSystem&&I.build(y)}return this._customBuildStep(y),y.verbose&&R.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(y),this.onBuildObservable.notifyObservers(this),!1}serialize(){const y={};y.customType="BABYLON."+this.getClassName(),y.id=this.uniqueId,y.name=this.name,y.visibleOnFrame=this.visibleOnFrame,y.inputs=[],y.outputs=[];for(const S of this.inputs)y.inputs.push(S.serialize());for(const S of this.outputs)y.outputs.push(S.serialize(!1));return y}_deserialize(y){this._name=y.name,this.comments=y.comments,this.visibleOnFrame=!!y.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(y)}_deserializePortDisplayNamesAndExposedOnFrame(y){const S=y.inputs,I=y.outputs;if(S)for(const V of S){const y=this.inputs.find((y=>y.name===V.name));if(!y)return;if(V.displayName&&(y.displayName=V.displayName),V.isExposedOnFrame&&(y.isExposedOnFrame=V.isExposedOnFrame,y.exposedPortPosition=V.exposedPortPosition),void 0!==V.value&&null!==V.value)if("number"===V.valueType)y.value=V.value;else{const S=(0,d.d)(V.valueType);S&&(y.value=S.oS(V.value))}}if(I)for(let V=0;V<I.length;V++){const y=I[V];y.displayName&&(this.outputs[V].displayName=y.displayName),y.isExposedOnFrame&&(this.outputs[V].isExposedOnFrame=y.isExposedOnFrame,this.outputs[V].exposedPortPosition=y.exposedPortPosition)}}clone(){const y=this.serialize(),S=(0,d.d)(y.customType);if(S){const I=new S;return I._deserialize(y),I}return null}dispose(){this.zi.notifyObservers(this),this.zi.clear();for(const y of this.inputs)y.dispose();for(const y of this.outputs)y.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function tS(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",V=arguments.length>3?arguments[3]:void 0;return(i,A)=>{let B=i._propStore;B||(B=[],i._propStore=B),B.push({propertyName:A,displayName:y,type:S,groupName:I,options:V??{},className:i.getClassName()})}}(0,v.c)([(0,P.E)("comment")],MS.prototype,"comments",void 0),function(y){y[y.Boolean=0]="Boolean",y[y.Float=1]="Float",y[y.Int=2]="Int",y[y.Vector2=3]="Vector2",y[y.List=4]="List",y[y.vd=5]="vd",y[y.SamplingMode=6]="SamplingMode",y[y.TextureFormat=7]="TextureFormat",y[y.TextureType=8]="TextureType"}(WS||(WS={})),function(y){y[y.None=0]="None",y[y.Position=1]="Position",y[y.Direction=2]="Direction",y[y.Age=3]="Age",y[y.Lifetime=4]="Lifetime",y[y.Color=5]="Color",y[y.ScaledDirection=6]="ScaledDirection",y[y.Scale=7]="Scale",y[y.AgeGradient=8]="AgeGradient",y[y.Angle=9]="Angle",y[y.SpriteCellIndex=16]="SpriteCellIndex",y[y.SpriteCellStart=17]="SpriteCellStart",y[y.SpriteCellEnd=18]="SpriteCellEnd"}(aS||(aS={})),function(y){y[y.None=0]="None",y[y.Time=1]="Time",y[y.Delta=2]="Delta",y[y.Emitter=3]="Emitter"}(eS||(eS={}));class NS{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let y="";for(const S of this.notConnectedNonOptionalInputs)y+=`input ${S.name} from block ${S.ownerBlock.name}[${S.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(y)throw"Build of Node Particle System Set failed:\n"+y}adapt(y,S){const I=y.getConnectedValue(this)||0;if(y.type===S)return I;switch(S){case RS.Vector2:return new V.Vector2(I,I);case RS.OS:return new V.OS(I,I,I);case RS.vd:return new B.vd(I,I,I,I)}return null}getContextualValue(y){if(!this.particleContext||!this.systemContext)return null;switch(y){case aS.Position:return this.particleContext.position;case aS.Direction:return this.particleContext.direction;case aS.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case aS.Color:return this.particleContext.color;case aS.Age:return this.particleContext.age;case aS.Lifetime:return this.particleContext.lifeTime;case aS.Angle:return this.particleContext.angle;case aS.Scale:return this.particleContext.scale;case aS.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case aS.SpriteCellEnd:return this.systemContext.endSpriteCellID;case aS.SpriteCellIndex:return this.particleContext.cellIndex;case aS.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.FS.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.FS.absolutePosition:this.systemContext.FS:null}getSystemValue(y){if(!this.particleContext||!this.systemContext)return null;switch(y){case eS.Time:return this.systemContext._actualFrame;case eS.Delta:return this.systemContext._scaledUpdateSpeed;case eS.Emitter:if(this.isEmitterTransformNode){return this.systemContext.FS.absolutePosition}return this.systemContext.FS}return null}}function YS(y,S,I){const V=new NS;V.mI=S;const i=y.createSystem(V);return i.canStart=()=>!0,i.FS=I.clone(),i.disposeOnStop=!0,i.start(),i}class HS extends MS{constructor(y){super(y),this.blendMode=F.BLENDMODE_ONEONE,this.zS=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",RS.Particle),this.registerInput("texture",RS.Texture),this.registerInput("onStart",RS.System,!0),this.registerInput("onEnd",RS.System,!0),this.registerOutput("system",RS.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(y){y.zS=this.zS,y.buildId=this._buildId++,this.build(y);const S=this.particle.getConnectedValue(y);return S.particleTexture=this.texture.getConnectedValue(y),S.emitRate=this.emitRate,S.blendMode=this.blendMode,S.name=this.name,S._nodeGenerated=!0,S._targetStopDuration=this.targetStopDuration,S.startDelay=this.startDelay,this.system._storedValue=this,S.canStart=()=>!this.doNoStart,S.onStartedObservable.add((I=>{const V=this.onStart.getConnectedValue(y);V&&I.onStartedObservable.addOnce((()=>{y.systemContext=S;const I=YS(V,y.mI,y.emitterPosition);this.zi.addOnce((()=>{I.dispose()}))}));const i=this.onEnd.getConnectedValue(y);i&&I.onStoppedObservable.addOnce((()=>{y.systemContext=S;const I=YS(i,y.mI,y.emitterPosition);this.zi.addOnce((()=>{I.dispose()}))}))})),this.zi.addOnce((()=>{S.dispose()})),S}serialize(){const y=super.serialize();return y.zS=this.zS,y.emitRate=this.emitRate,y.blendMode=this.blendMode,y.doNoStart=this.doNoStart,y.targetStopDuration=this.targetStopDuration,y.startDelay=this.startDelay,y}_deserialize(y){super._deserialize(y),this.zS=y.zS,this.emitRate=y.emitRate,this.doNoStart=!!y.doNoStart,void 0!==y.blendMode&&(this.blendMode=y.blendMode),void 0!==y.targetStopDuration&&(this.targetStopDuration=y.targetStopDuration),void 0!==y.startDelay&&(this.startDelay=y.startDelay)}}(0,v.c)([tS("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:F.BLENDMODE_ONEONE},{label:"Standard",value:F.BLENDMODE_STANDARD},{label:"Add",value:F.BLENDMODE_ADD},{label:"Multiply",value:F.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:F.BLENDMODE_MULTIPLYADD}]})],HS.prototype,"blendMode",void 0),(0,v.c)([tS("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],HS.prototype,"zS",void 0),(0,v.c)([tS("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HS.prototype,"emitRate",void 0),(0,v.c)([tS("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HS.prototype,"targetStopDuration",void 0),(0,v.c)([tS("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HS.prototype,"startDelay",void 0),(0,v.c)([tS("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],HS.prototype,"doNoStart",void 0),(0,d.e)("BABYLON.SystemBlock",HS);class ZS extends MS{get type(){if(this._type===RS.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=RS.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=RS.Vector2,this._type;case"OS":return this._type=RS.OS,this._type;case"vd":return this._type=RS.vd,this._type;case"Matrix":return this._type=RS.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===aS.None&&this._systemSource!==eS.None}get systemSource(){return this._systemSource}set systemSource(y){if(this._systemSource=y,y!==eS.None){switch(this._contextualSource=aS.None,this._type=RS.Float,y){case eS.Time:case eS.Delta:this._type=RS.Float;break;case eS.Emitter:this._type=RS.OS}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==aS.None}get contextualValue(){return this._contextualSource}set contextualValue(y){if(this._contextualSource=y,y!==aS.None){switch(this._systemSource=eS.None,y){case aS.Scale:this._type=RS.Vector2;break;case aS.Position:case aS.Direction:case aS.ScaledDirection:this._type=RS.OS;break;case aS.Color:this._type=RS.vd;break;case aS.Age:case aS.Lifetime:case aS.Angle:case aS.AgeGradient:this._type=RS.Float;break;case aS.SpriteCellEnd:case aS.SpriteCellStart:case aS.SpriteCellIndex:this._type=RS.Int}this.output&&(this.output.type=this._type)}}constructor(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:RS.AutoDetect;super(y),this._type=RS.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new Y.b,this._systemSource=eS.None,this._contextualSource=aS.None,this._type=S,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",S)}get value(){return this._storedValue}set value(y){this.type===RS.Float&&this.min!==this.max&&(y=Math.max(this.min,y),y=Math.min(this.max,y)),this._storedValue=y,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(y){this._valueCallback=y}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case RS.Int:case RS.Float:this.value=0;break;case RS.Vector2:this.value=V.Vector2.Zero();break;case RS.OS:this.value=V.OS.Zero();break;case RS.vd:this.value=new B.vd(1,1,1,1);break;case RS.Matrix:this.value=V.Matrix.Identity()}}_build(y){super._build(y),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=y=>y.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=y=>y.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const y=super.serialize();return y.type=this.type,y.contextualValue=this.contextualValue,y.systemSource=this.systemSource,y.min=this.min,y.max=this.max,y.groupInInspector=this.groupInInspector,y.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Vd?(y.valueType="BABYLON."+this._storedValue.getClassName(),y.value=this._storedValue.Vd()):(y.valueType="number",y.value=this._storedValue)),y}_deserialize(y){if(super._deserialize(y),this._type=y.type,this.contextualValue=y.contextualValue,this.systemSource=y.systemSource||eS.None,this.min=y.min||0,this.max=y.max||0,this.groupInInspector=y.groupInInspector||"",void 0!==y.displayInInspector&&(this.displayInInspector=y.displayInInspector),y.valueType)if("number"===y.valueType)this._storedValue=y.value;else{const S=(0,d.d)(y.valueType);S&&(this._storedValue=S.oS(y.value))}}}(0,d.e)("BABYLON.ParticleInputBlock",ZS);class wS extends MS{get url(){return this._url}set url(y){this._url!==y&&(this._cachedData=null,this._url=y,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(y){this._textureDataUrl!==y&&(this._cachedData=null,this._textureDataUrl=y,this._url="",this._sourceTexture=null)}set sourceTexture(y){this._sourceTexture!==y&&(this._cachedData=null,this._sourceTexture=y,this._url="",this._textureDataUrl="")}constructor(y){super(y),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",RS.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const y=this.texture._storedValue;return await new Promise(((S,I)=>{if(!y.isReady())return void y.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),S(this._cachedData)}catch(y){I(y)}}));const V=y.getSize();vS.m.GetTextureDataAsync(y,V.width,V.height).then((I=>{this._cachedData={width:V.width,height:V.height,data:new Uint8ClampedArray(I)},y.dispose(),S(this._cachedData)})).catch(I)}))}_build(y){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new g.e(this._textureDataUrl,y.mI):this.texture._storedValue=new g.e(this._url,y.mI):this.texture._storedValue=null}serialize(){const y=super.serialize();return y.url=this.url,y.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(y.textureDataUrl=this.textureDataUrl),y}_deserialize(y){super._deserialize(y),this.url=y.url,this.serializedCachedData=!!y.serializedCachedData,y.textureDataUrl&&(this.textureDataUrl=y.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,d.e)("BABYLON.ParticleTextureSourceBlock",wS);class yI extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("position",RS.OS),this.registerOutput("output",RS.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(y){const S=this.particle.getConnectedValue(y);if(this.output._storedValue=S,!this.position.isConnected)return;const I={process:I=>{y.particleContext=I,y.systemContext=S,I.position.A(this.position.getConnectedValue(y))},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I}}(0,d.e)("BABYLON.UpdatePositionBlock",yI),function(y){y[y.Add=0]="Add",y[y.Subtract=1]="Subtract",y[y.Multiply=2]="Multiply",y[y.Divide=3]="Divide",y[y.Max=4]="Max",y[y.Min=5]="Min"}(xS||(xS={}));class SI extends MS{constructor(y){super(y),this.operation=xS.Add,this.registerInput("left",RS.AutoDetect),this.registerInput("right",RS.AutoDetect),this.registerOutput("output",RS.BasedOnInput),this.output._typeConnectionSource=this.left;const S=[RS.Matrix,RS.Particle,RS.Texture,RS.System,RS.FloatGradient,RS.Color4Gradient,RS.Vector2Gradient,RS.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...S),this.right.excludedConnectionPointTypes.push(...S),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(y){let S;const I=this.left,i=this.right;if(!I.isConnected||!i.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const A=I.type===RS.Float||I.type===RS.Int,d=i.type===RS.Float||i.type===RS.Int,F=A&&d;switch(this.operation){case xS.Add:S=F?y=>I.getConnectedValue(y)+i.getConnectedValue(y):A?y=>y.adapt(I,i.type).add(i.getConnectedValue(y)):y=>I.getConnectedValue(y).add(y.adapt(i,I.type));break;case xS.Subtract:S=F?y=>I.getConnectedValue(y)-i.getConnectedValue(y):A?y=>y.adapt(I,i.type).fS(i.getConnectedValue(y)):y=>I.getConnectedValue(y).fS(y.adapt(i,I.type));break;case xS.Multiply:S=F?y=>I.getConnectedValue(y)*i.getConnectedValue(y):A?y=>y.adapt(I,i.type).multiply(i.getConnectedValue(y)):y=>I.getConnectedValue(y).multiply(y.adapt(i,I.type));break;case xS.Divide:S=F?y=>I.getConnectedValue(y)/i.getConnectedValue(y):A?y=>y.adapt(I,i.type).divide(i.getConnectedValue(y)):y=>I.getConnectedValue(y).divide(y.adapt(i,I.type));break;case xS.Min:if(F)S=y=>Math.min(I.getConnectedValue(y),i.getConnectedValue(y));else{const[y,d]=A?[i,I]:[I,i];switch(y.type){case RS.Vector2:S=S=>V.Vector2.Minimize(y.getConnectedValue(S),S.adapt(d,y.type));break;case RS.OS:S=S=>V.OS.Minimize(y.getConnectedValue(S),S.adapt(d,y.type));break;case RS.vd:S=S=>{const I=y.getConnectedValue(S),{r:V,g:i,b:A,a:F}=S.adapt(d,y.type);return new B.vd(Math.min(I.r,V),Math.min(I.g,i),Math.min(I.b,A),Math.min(I.a,F))}}}break;case xS.Max:if(!F){const[y,d]=A?[i,I]:[I,i];switch(y.type){case RS.Vector2:S=S=>V.Vector2.Maximize(y.getConnectedValue(S),S.adapt(d,y.type));break;case RS.OS:S=S=>V.OS.Maximize(y.getConnectedValue(S),S.adapt(d,y.type));break;case RS.vd:S=S=>{const I=y.getConnectedValue(S),{r:V,g:i,b:A,a:F}=S.adapt(d,y.type);return new B.vd(Math.max(I.r,V),Math.min(I.g,i),Math.min(I.b,A),Math.min(I.a,F))}}break}S=y=>Math.max(I.getConnectedValue(y),i.getConnectedValue(y))}this.output._storedFunction=y=>I.type===RS.Int?0|S(y):S(y)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===RS.Int||this.left.type===RS.Float&&this.right.type!==RS.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[y,S]of[[this.left,this.right],[this.right,this.left]])y.acceptedConnectionPointTypes=[RS.Int,RS.Float],S.isConnected&&(y.acceptedConnectionPointTypes.push(S.type),S.type!==RS.Int&&S.type!==RS.Float||y.acceptedConnectionPointTypes.push(RS.Vector2,RS.OS,RS.vd))}dispose(){super.dispose();for(const y of this._connectionObservers)y.remove();this._connectionObservers.length=0}serialize(){const y=super.serialize();return y.operation=this.operation,y}_deserialize(y){super._deserialize(y),this.operation=y.operation}}(0,v.c)([tS("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:xS.Add},{label:"Subtract",value:xS.Subtract},{label:"Multiply",value:xS.Multiply},{label:"Divide",value:xS.Divide},{label:"Max",value:xS.Max},{label:"Min",value:xS.Min}]})],SI.prototype,"operation",void 0),(0,d.e)("BABYLON.ParticleMathBlock",SI);class II extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("direction1",RS.OS,!0,new V.OS(0,1,0)),this.registerInput("direction2",RS.OS,!0,new V.OS(0,1,0)),this.registerInput("minEmitBox",RS.OS,!0,new V.OS(-.5,-.5,-.5)),this.registerInput("maxEmitBox",RS.OS,!0,new V.OS(.5,.5,.5)),this.registerOutput("output",RS.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(y){const S=this.particle.getConnectedValue(y);S._directionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.direction1.getConnectedValue(y),A=this.direction2.getConnectedValue(y),B=(0,J.RandomRange)(i.x,A.x),d=(0,J.RandomRange)(i.y,A.y),F=(0,J.RandomRange)(i.z,A.z);y.isEmitterTransformNode?V.OS.TransformNormalFromFloatsToRef(B,d,F,y.emitterWorldMatrix,I.direction):I.direction.od(B,d,F)},S._positionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.minEmitBox.getConnectedValue(y),A=this.maxEmitBox.getConnectedValue(y),B=(0,J.RandomRange)(i.x,A.x),d=(0,J.RandomRange)(i.y,A.y),F=(0,J.RandomRange)(i.z,A.z);y.isEmitterTransformNode?V.OS.TransformCoordinatesFromFloatsToRef(B,d,F,y.emitterWorldMatrix,I.position):(I.position.od(B,d,F),I.position.addInPlace(y.emitterPosition))},this.output._storedValue=S}}(0,d.e)("BABYLON.BoxShapeBlock",II);class VI extends MS{constructor(y){super(y),this.registerInput("emitPower",RS.Float,!0,1),this.registerInput("lifeTime",RS.Float,!0,1),this.registerInput("color",RS.vd,!0,new B.vd(1,1,1,1)),this.registerInput("scale",RS.Vector2,!0,new V.Vector2(1,1)),this.registerInput("angle",RS.Float,!0,0),this.registerOutput("particle",RS.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(y){const S=new dS(this.name,y.zS,y.mI,null,!1,void 0,!0);S.particleEmitterType=new j,S._lifeTimeCreation.process=(S,I)=>{y.particleContext=S,S.lifeTime=this.lifeTime.getConnectedValue(y),I._emitPower=this.emitPower.getConnectedValue(y)},S._colorCreation.process=S=>{y.particleContext=S,S.color.A(this.color.getConnectedValue(y))},S._sizeCreation.process=S=>{y.particleContext=S,S.size=1,S.scale.A(this.scale.getConnectedValue(y))},S._angleCreation.process=S=>{y.particleContext=S,S.angle=this.angle.getConnectedValue(y)},this.particle._storedValue=S}}(0,d.e)("BABYLON.CreateParticleBlock",VI);class iI{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const y=[];for(const S of this.attachedBlocks)S.isInput&&y.push(S);return y}constructor(y){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new Y.b,this.name=y}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(y){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(y)&&this.attachedBlocks.push(y);for(const I of y.inputs){const V=I.connectedPoint;if(V){const I=V.ownerBlock;I!==y&&this._initializeBlock(I,S)}}}async buildAsync(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((I=>{const V=new DS;for(const y of this._systemBlocks)this._initializeBlock(y);for(const i of this.systemBlocks){const I=new NS;I.buildId=this._buildId++,I.mI=y,I.verbose=S;const A=i.createSystem(I);I.emitErrors(),V.systems.push(A)}this.onBuildObservable.notifyObservers(this),I(V)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const y=new HS("Particle system"),S=new yI("Update position");S.output.connectTo(y.particle);const I=new ZS("Position");I.contextualValue=aS.Position;const V=new ZS("Scaled direction");V.contextualValue=aS.ScaledDirection;const i=new SI("Add");i.operation=xS.Add,I.output.connectTo(i.left),V.output.connectTo(i.right),i.output.connectTo(S.position);const A=new VI("Create particle"),B=new II("Box shape");A.particle.connectTo(B.particle),B.output.connectTo(S.particle);const d=new wS("Texture");d.texture.connectTo(y.texture),d.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(y)}removeBlock(y){const S=this.attachedBlocks.indexOf(y);if(S>-1&&this.attachedBlocks.splice(S,1),y.isSystem){const S=this._systemBlocks.indexOf(y);S>-1&&this._systemBlocks.splice(S,1)}}parseSerializedObject(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];S||this.clear();const I={};for(const V of y.Eu){const y=(0,d.d)(V.customType);if(y){const S=new y;S._deserialize(V),I[V.id]=S,this.attachedBlocks.push(S),S.isSystem&&this._systemBlocks.push(S)}}for(const V of this.attachedBlocks)if(V.isTeleportOut){const y=V,S=y._tempEntryPointUniqueId;if(S){const V=I[S];V&&V.attachToEndpoint(y)}}for(let V=0;V<y.Eu.length;V++){const i=y.Eu[V],A=I[i.id];A&&(A.inputs.length&&i.inputs.some((y=>y.targetConnectionName))&&!S||this._restoreConnections(A,y,I))}if(y.locations||y.editorData&&y.editorData.locations){const V=y.locations||y.editorData.locations;for(const y of V)I[y.Yi]&&(y.Yi=I[y.Yi].uniqueId);S&&this.editorData&&this.editorData.locations&&V.concat(this.editorData.locations),y.locations?this.editorData={locations:V}:(this.editorData=y.editorData,this.editorData.locations=V);const i=[];for(const y in I)i[y]=I[y].uniqueId;this.editorData.map=i}this.comment=y.comment}_restoreConnections(y,S,I){for(const V of y.outputs)for(const i of S.Eu){const A=I[i.id];if(A)for(const B of i.inputs)if(I[B.targetBlockId]!==y||B.targetConnectionName!==V.name);else{const y=A.getInputByName(B.inputName);if(!y||y.isConnected)continue;V.connectTo(y,!0),this._restoreConnections(A,S,I)}}}serialize(y){const S=y?{}:q.d.Serialize(this);S.editorData=JSON.parse(JSON.stringify(this.editorData));let I=[];y?I=y:S.customType="BABYLON.NodeParticleSystemSet",S.Eu=[];for(const V of I)S.Eu.push(V.serialize());if(!y)for(const V of this.attachedBlocks)-1===I.indexOf(V)&&S.Eu.push(V.serialize());return S}dispose(){for(const y of this.attachedBlocks)y.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(y){const S=new iI(y);return S.setToDefault(),S}static Parse(y){const S=q.d.Parse((()=>new iI(y.name)),y,null);return S.parseSerializedObject(y),S}static ParseFromSnippetAsync(y,S){return"_BLANK"===y?Promise.resolve(iI.CreateDefault("blank")):new Promise(((I,V)=>{const i=new oS.e;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){const B=JSON.parse(JSON.parse(i.responseText).jsonPayload),d=JSON.parse(B.nodeParticle);S||(S=q.d.Parse((()=>new iI(y)),d,null)),S.parseSerializedObject(d),S.snippetId=y;try{I(S)}catch(A){V(A)}}else V("Unable to load the snippet "+y)})),i.open("GET",this.SnippetUrl+"/"+y.replace(/#/g,"/")),i.send()}))}}iI.EditorURL=`${fS.Tools._DefaultCdnUrl}/v${ty.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,iI.SnippetUrl="https://snippet.babylonjs.com",(0,v.c)([(0,P.E)()],iI.prototype,"name",void 0),(0,v.c)([(0,P.E)("comment")],iI.prototype,"comment",void 0),function(y){y[y.None=0]="None",y[y.PerParticle=1]="PerParticle",y[y.PerSystem=2]="PerSystem"}(QS||(QS={}));class AI extends MS{constructor(y){super(y),this._currentLockId=-2,this.lockMode=QS.PerParticle,this.registerInput("min",RS.AutoDetect,!0,0),this.registerInput("max",RS.AutoDetect,!0,1),this.registerOutput("output",RS.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(RS.Float|RS.Int|RS.Vector2|RS.OS|RS.vd),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(RS.Float|RS.Int|RS.Vector2|RS.OS|RS.vd),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=RS.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let y=null;switch(this._currentLockId=-2,this.min.type){case RS.AutoDetect:case RS.Int:case RS.Float:y=y=>{const S=this.min.getConnectedValue(y)||0,I=this.max.getConnectedValue(y)||1;return S+Math.random()*(I-S)};break;case RS.Vector2:y=y=>{const S=this.min.getConnectedValue(y)||V.Vector2.Zero(),I=this.max.getConnectedValue(y)||V.Vector2.One();return new V.Vector2(S.x+Math.random()*(I.x-S.x),S.y+Math.random()*(I.y-S.y))};break;case RS.OS:y=y=>{const S=this.min.getConnectedValue(y)||V.OS.Zero(),I=this.max.getConnectedValue(y)||V.OS.One();return new V.OS(S.x+Math.random()*(I.x-S.x),S.y+Math.random()*(I.y-S.y),S.z+Math.random()*(I.z-S.z))};break;case RS.vd:y=y=>{const S=this.min.getConnectedValue(y)||new B.vd(0,0,0,0),I=this.max.getConnectedValue(y)||new B.vd(1,1,1,1);return new B.vd(S.x+Math.random()*(I.x-S.x),S.y+Math.random()*(I.y-S.y),S.z+Math.random()*(I.z-S.z),S.w+Math.random()*(I.w-S.w))}}this.output._storedFunction=S=>{var I;let V=0;switch(this.lockMode){case QS.PerParticle:V=(null===(I=S.particleContext)||void 0===I?void 0:I.id)||-1;break;case QS.PerSystem:V=S.buildId||0}return this._currentLockId!==V&&(this.lockMode!==QS.None&&(this._currentLockId=V),this.output._storedValue=y(S)),this.output._storedValue}}serialize(){const y=super.serialize();return y.lockMode=this.lockMode,y}_deserialize(y){super._deserialize(y),this.lockMode=y.lockMode}}(0,v.c)([tS("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:QS.None},{label:"Per particle",value:QS.PerParticle},{label:"Per system",value:QS.PerSystem}]})],AI.prototype,"lockMode",void 0),(0,d.e)("BABYLON.ParticleRandomBlock",AI);class BI extends MS{constructor(y){super(y),this._currentLockId=-2,this.lockMode=QS.PerParticle,this.registerInput("min",RS.AutoDetect),this.registerInput("max",RS.AutoDetect),this.registerOutput("output",RS.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const S=[RS.Matrix,RS.Particle,RS.Texture,RS.System,RS.FloatGradient,RS.Color4Gradient,RS.Vector2Gradient,RS.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...S),this.max.excludedConnectionPointTypes.push(...S)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let y=null;switch(this._currentLockId=-2,this.min.type){case RS.Float:case RS.Int:y=y=>{const S=this.min.getConnectedValue(y),I=this.max.getConnectedValue(y);return Math.random()*(I-S)+S};break;case RS.Vector2:y=y=>{const S=this.min.getConnectedValue(y),I=this.max.getConnectedValue(y);return new V.Vector2(Math.random()*(I.x-S.x)+S.x,Math.random()*(I.y-S.y)+S.y)};break;case RS.OS:y=y=>{const S=this.min.getConnectedValue(y),I=this.max.getConnectedValue(y);return new V.OS(Math.random()*(I.x-S.x)+S.x,Math.random()*(I.y-S.y)+S.y,Math.random()*(I.z-S.z)+S.z)};break;case RS.vd:y=y=>{const S=this.min.getConnectedValue(y),I=this.max.getConnectedValue(y);return new B.vd(Math.random()*(I.r-S.r)+S.r,Math.random()*(I.g-S.g)+S.g,Math.random()*(I.b-S.b)+S.b,Math.random()*(I.a-S.a)+S.a)}}this.output._storedFunction=S=>{var I;let V=0;switch(this.lockMode){case QS.PerParticle:V=(null===(I=S.particleContext)||void 0===I?void 0:I.id)||-1;break;case QS.PerSystem:V=S.buildId||0}return this._currentLockId!==V&&(this.lockMode!==QS.None&&(this._currentLockId=V),this.output._storedValue=y(S)),this.output._storedValue}}serialize(){const y=super.serialize();return y.lockMode=this.lockMode,y}_deserialize(y){super._deserialize(y),void 0!==y.lockMode&&(this.lockMode=y.lockMode)}}(0,v.c)([tS("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:QS.None},{label:"Per particle",value:QS.PerParticle},{label:"Per system",value:QS.PerSystem}]})],BI.prototype,"lockMode",void 0),(0,d.e)("BABYLON.RandomRangeBlock",BI);(0,d.e)("BABYLON.ParticleLerpBlock",class extends MS{constructor(y){super(y),this.registerInput("left",RS.AutoDetect),this.registerInput("right",RS.AutoDetect),this.registerInput("gradient",RS.Float,!0,0,0,1),this.registerOutput("output",RS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(RS.Float|RS.Int|RS.Vector2|RS.OS|RS.vd)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const y=(y,S,I)=>(1-y)*S+y*I;this.output._storedFunction=S=>{const I=this.left.getConnectedValue(S),i=this.right.getConnectedValue(S),A=this.gradient.getConnectedValue(S);switch(this.left.type){case RS.Int:case RS.Float:return y(A,I,i);case RS.Vector2:return new V.Vector2(y(A,I.x,i.x),y(A,I.y,i.y));case RS.OS:return new V.OS(y(A,I.x,i.x),y(A,I.y,i.y),y(A,I.z,i.z));case RS.vd:return new B.vd(y(A,I.r,i.r),y(A,I.g,i.g),y(A,I.b,i.b),y(A,I.a,i.a))}return 0}}});(0,d.e)("BABYLON.UpdateDirectionBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("direction",RS.OS),this.registerOutput("output",RS.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(y){const S=this.particle.getConnectedValue(y);if(this.output._storedValue=S,!this.direction.isConnected)return;const I={process:I=>{y.particleContext=I,y.systemContext=S,I.direction.A(this.direction.getConnectedValue(y))},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I}});(0,d.e)("BABYLON.UpdateColorBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("color",RS.vd),this.registerOutput("output",RS.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(y){const S=this.particle.getConnectedValue(y);if(this.output._storedValue=S,!this.color.isConnected)return;const I={process:I=>{y.particleContext=I,y.systemContext=S,I.color.A(this.color.getConnectedValue(y))},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I}});(0,d.e)("BABYLON.UpdateScaleBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("scale",RS.Vector2),this.registerOutput("output",RS.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(y){const S=this.particle.getConnectedValue(y);if(this.output._storedValue=S,!this.scale.isConnected)return;const I={process:I=>{y.particleContext=I,y.systemContext=S,I.scale.A(this.scale.getConnectedValue(y))},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I}});(0,d.e)("BABYLON.UpdateAngleBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("angle",RS.Float),this.registerOutput("output",RS.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(y){const S=this.particle.getConnectedValue(y);if(this.output._storedValue=S,!this.angle.isConnected)return;const I={process:I=>{y.particleContext=I,y.systemContext=S,I.angle=this.angle.getConnectedValue(y)},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I}});(0,d.e)("BABYLON.BasicPositionUpdateBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerOutput("output",RS.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(y){const S=this.particle.getConnectedValue(y),I={process:I=>{y.particleContext=I,y.systemContext=S,I.direction.scaleToRef(S._directionScale,S._scaledDirection),I.position.addInPlace(S._scaledDirection)},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I,this.output._storedValue=S}});(0,d.e)("BABYLON.BasicSpriteUpdateBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerOutput("output",RS.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(y){const S=this.particle.getConnectedValue(y),I={process:I=>{y.particleContext=I,y.systemContext=S,I.updateCellIndex()},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I,this.output._storedValue=S}});(0,d.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("cellIndex",RS.Int),this.registerOutput("output",RS.Particle),this.cellIndex.acceptedConnectionPointTypes=[RS.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(y){const S=this.particle.getConnectedValue(y);if(this.output._storedValue=S,!this.cellIndex.isConnected)return;const I={process:I=>{y.particleContext=I,y.systemContext=S,I.cellIndex=Math.floor(this.cellIndex.getConnectedValue(y))},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I}});class dI extends MS{constructor(y){super(y),this.strength=1,this.registerInput("particle",RS.Particle),this.registerInput("flowMap",RS.Texture),this.registerOutput("output",RS.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(y){var S;const I=this.particle.getConnectedValue(y),V=y.mI;let i;(null===(S=this.flowMap.connectedPoint)||void 0===S?void 0:S.ownerBlock).extractTextureContentAsync().then((y=>{y&&(i=new kS(y.width,y.height,y.data))}));const A={process:y=>{const S=V.getTransformMatrix();i&&i._processParticle(y,this.strength*I._tempScaledUpdateSpeed,S)},previousItem:null,nextItem:null};I._updateQueueStart?ey(A,I._updateQueueStart):I._updateQueueStart=A,this.output._storedValue=I}serialize(){const y=super.serialize();return y.strength=this.strength,y}_deserialize(y){super._deserialize(y),this.strength=y.strength}}(0,v.c)([tS("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dI.prototype,"strength",void 0),(0,d.e)("BABYLON.UpdateFlowMapBlock",dI);(0,d.e)("BABYLON.SphereShapeBlock",class extends MS{constructor(y){super(y),this.registerInput("input",RS.Particle),this.registerInput("radius",RS.Float,!0,1),this.registerInput("radiusRange",RS.Float,!0,1,0,1),this.registerInput("directionRandomizer",RS.Float,!0,0,0,1),this.registerOutput("output",RS.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(y){const S=this.input.getConnectedValue(y);S._directionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.directionRandomizer.getConnectedValue(y),A=I.position.fS(y.emitterPosition).normalize(),B=(0,J.RandomRange)(0,i),d=(0,J.RandomRange)(0,i),F=(0,J.RandomRange)(0,i);A.x+=B,A.y+=d,A.z+=F,A.normalize(),y.isEmitterTransformNode?V.OS.TransformNormalFromFloatsToRef(B,d,F,y.emitterWorldMatrix,I.direction):I.direction.od(B,d,F)},S._positionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.radius.getConnectedValue(y),A=this.radiusRange.getConnectedValue(y),B=i-(0,J.RandomRange)(0,i*A),d=(0,J.RandomRange)(0,1),F=(0,J.RandomRange)(0,2*Math.PI),u=Math.acos(2*d-1),K=B*Math.cos(F)*Math.sin(u),G=B*Math.cos(u),p=B*Math.sin(F)*Math.sin(u);y.isEmitterTransformNode?V.OS.TransformCoordinatesFromFloatsToRef(K,G,p,y.emitterWorldMatrix,I.position):(I.position.od(K,G,p),I.position.addInPlace(y.emitterPosition))},this.output._storedValue=S}});(0,d.e)("BABYLON.PointShapeBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("direction1",RS.OS,!0,new V.OS(0,1,0)),this.registerInput("direction2",RS.OS,!0,new V.OS(0,1,0)),this.registerOutput("output",RS.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(y){const S=this.particle.getConnectedValue(y);S._directionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.direction1.getConnectedValue(y),A=this.direction2.getConnectedValue(y),B=(0,J.RandomRange)(i.x,A.x),d=(0,J.RandomRange)(i.y,A.y),F=(0,J.RandomRange)(i.z,A.z);y.isEmitterTransformNode?V.OS.TransformNormalFromFloatsToRef(B,d,F,y.emitterWorldMatrix,I.direction):I.direction.od(B,d,F)},S._positionCreation.process=I=>{y.systemContext=S,y.isEmitterTransformNode?V.OS.TransformCoordinatesFromFloatsToRef(0,0,0,y.emitterWorldMatrix,I.position):I.position.A(y.emitterPosition)},this.output._storedValue=S}});(0,d.e)("BABYLON.CustomShapeBlock",class extends MS{constructor(y){super(y),this.registerInput("particle",RS.Particle),this.registerInput("position",RS.OS,!0,new V.OS(0,0,0)),this.registerInput("direction",RS.OS,!0,new V.OS(0,1,0)),this.registerOutput("output",RS.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(y){const S=this.particle.getConnectedValue(y);S._directionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.direction.getConnectedValue(y);y.isEmitterTransformNode?V.OS.TransformNormalToRef(i,y.emitterWorldMatrix,I.direction):I.direction.A(i)},S._positionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.position.getConnectedValue(y);y.isEmitterTransformNode?V.OS.TransformCoordinatesToRef(i,y.emitterWorldMatrix,I.position):(I.position.A(i),I.position.addInPlace(y.emitterPosition))},this.output._storedValue=S}});(0,d.e)("BABYLON.CylinderShapeBlock",class extends MS{constructor(y){super(y),this._tempVector=V.OS.Zero(),this.registerInput("particle",RS.Particle),this.registerInput("radius",RS.Float,!0,1),this.registerInput("height",RS.Float,!0,1,0),this.registerInput("radiusRange",RS.Float,!0,1,0,1),this.registerInput("directionRandomizer",RS.Float,!0,0,0,1),this.registerOutput("output",RS.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(y){const S=this.particle.getConnectedValue(y);S._directionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.directionRandomizer.getConnectedValue(y);I.position.subtractToRef(y.emitterPosition,this._tempVector),this._tempVector.normalize(),y.isEmitterTransformNode&&V.OS.TransformNormalToRef(this._tempVector,y.emitterInverseWorldMatrix,this._tempVector);const A=(0,J.RandomRange)(-i/2,i/2);let B=Math.atan2(this._tempVector.x,this._tempVector.z);B+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*i,this._tempVector.y=A,this._tempVector.x=Math.sin(B),this._tempVector.z=Math.cos(B),this._tempVector.normalize(),y.isEmitterTransformNode?V.OS.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,y.emitterWorldMatrix,I.direction):I.direction.A(this._tempVector)},S._positionCreation.process=I=>{y.particleContext=I,y.systemContext=S;const i=this.height.getConnectedValue(y),A=this.radiusRange.getConnectedValue(y),B=this.radius.getConnectedValue(y),d=(0,J.RandomRange)(-i/2,i/2),F=(0,J.RandomRange)(0,2*Math.PI),u=(0,J.RandomRange)((1-A)*(1-A),1),K=Math.sqrt(u)*B,G=K*Math.cos(F),p=K*Math.sin(F);y.isEmitterTransformNode?V.OS.TransformCoordinatesFromFloatsToRef(G,d,p,y.emitterWorldMatrix,I.position):(I.position.od(G,d,p),I.position.addInPlace(y.emitterPosition))},this.output._storedValue=S}});class FI extends MS{constructor(y){super(y),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",RS.Particle),this.registerOutput("output",RS.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(y){super._build(y);const S=this.particle.getConnectedValue(y);S._isAnimationSheetEnabled=!0,S.spriteCellWidth=this.width,S.spriteCellHeight=this.height,S.startSpriteCellID=this.start,S.endSpriteCellID=this.end,S.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=S}serialize(){const y=super.serialize();return y.width=this.width,y.height=this.height,y.start=this.start,y.end=this.end,y.randomStartCell=this.randomStartCell,y}_deserialize(y){super._deserialize(y),this.width=y.width,this.height=y.height,this.start=y.start,this.end=y.end,this.randomStartCell=y.randomStartCell}}(0,v.c)([tS("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FI.prototype,"start",void 0),(0,v.c)([tS("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FI.prototype,"end",void 0),(0,v.c)([tS("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FI.prototype,"width",void 0),(0,v.c)([tS("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FI.prototype,"height",void 0),(0,v.c)([tS("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],FI.prototype,"loop",void 0),(0,v.c)([tS("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],FI.prototype,"randomStartCell",void 0),(0,d.e)("BABYLON.SetupSpriteSheetBlock",FI);class JI extends MS{constructor(y){super(y),this.reference=0,this.registerInput("value",RS.AutoDetect),this.registerOutput("output",RS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=y=>{switch(y){case RS.Float:return RS.FloatGradient;case RS.Vector2:return RS.Vector2Gradient;case RS.OS:return RS.Vector3Gradient;case RS.vd:return RS.Color4Gradient}return y},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(RS.Float|RS.Vector2|RS.OS|RS.vd)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=y=>null}serialize(){const y=super.serialize();return y.reference=this.reference,y}_deserialize(y){super._deserialize(y),this.reference=y.reference}}(0,v.c)([tS("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],JI.prototype,"reference",void 0),(0,d.e)("BABYLON.ParticleGradientValueBlock",JI);(0,d.e)("BABYLON.ParticleGradientBlock",class extends MS{constructor(y){super(y),this._entryCount=1,this.registerInput("gradient",RS.Float,!0,1,0,1),this.registerInput("value0",RS.AutoDetect),this.registerOutput("output",RS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=y=>{switch(y){case RS.FloatGradient:return RS.Float;case RS.Vector2Gradient:return RS.Vector2;case RS.Vector3Gradient:return RS.OS;case RS.Color4Gradient:return RS.vd}return y},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(RS.FloatGradient|RS.Vector2Gradient|RS.Vector3Gradient|RS.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(y){this._inputs[y].onConnectionObservable.add((()=>{this._entryCount>y||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),RS.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const y=[];for(let I=1;I<this._inputs.length;I++){var S;if(this._inputs[I].isConnected)y.push(null===(S=this._inputs[I].connectedPoint)||void 0===S?void 0:S.ownerBlock)}y.sort(((y,S)=>y.reference-S.reference)),this.output._storedFunction=S=>{const I=this.gradient.getConnectedValue(S);if(1===y.length)return y[0].value.getConnectedValue(S);let i=null;for(let A=y.length-1;A>=0;A--){const d=y[A];if(d.reference<=I){const y=d.value.getConnectedValue(S);if(i){const A=i.value.getConnectedValue(S),F=i.reference,u=d.reference,K=Math.max(0,Math.min(1,(I-u)/(F-u)));switch(this.output.type){case RS.Float:return(0,J.Lerp)(y,A,K);case RS.Vector2:return V.Vector2.Lerp(y,A,K);case RS.OS:return V.OS.Lerp(y,A,K);case RS.vd:return B.vd.Lerp(y,A,K)}}return y}i=d}return 0}}});(0,d.e)("BABYLON.ParticleConverterBlock",class extends MS{constructor(y){super(y),this.registerInput("color ",RS.vd,!0),this.registerInput("xyz ",RS.OS,!0),this.registerInput("xy ",RS.Vector2,!0),this.registerInput("zw ",RS.Vector2,!0),this.registerInput("x ",RS.Float,!0),this.registerInput("y ",RS.Float,!0),this.registerInput("z ",RS.Float,!0),this.registerInput("w ",RS.Float,!0),this.registerOutput("color",RS.vd),this.registerOutput("xyz",RS.OS),this.registerOutput("xy",RS.Vector2),this.registerOutput("zw",RS.Vector2),this.registerOutput("x",RS.Float),this.registerOutput("y",RS.Float),this.registerOutput("z",RS.Float),this.registerOutput("w",RS.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(y){return"color "===y?"colorIn":"xyz "===y?"xyzIn":"xy "===y?"xyIn":"zw "===y?"zwIn":"x "===y?"xIn":"y "===y?"yIn":"z "===y?"zIn":"w "===y?"wIn":y}_outputRename(y){switch(y){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return y}}_build(y){super._build(y);const S=this.xIn,I=this.yIn,i=this.zIn,A=this.wIn,d=this.xyIn,F=this.zwIn,J=this.xyzIn,u=this.colorIn,K=this.colorOut,G=this.xyzOut,p=this.xyOut,L=this.zwOut,T=this.xOut,l=this.yOut,j=this.zOut,s=this.wOut,O=y=>{if(u.isConnected)return u.getConnectedValue(y);let V=0,K=0,G=0,p=0;if(S.isConnected&&(V=S.getConnectedValue(y)),I.isConnected&&(K=I.getConnectedValue(y)),i.isConnected&&(G=i.getConnectedValue(y)),A.isConnected&&(p=A.getConnectedValue(y)),d.isConnected){const S=d.getConnectedValue(y);S&&(V=S.x,K=S.y)}if(F.isConnected){const S=F.getConnectedValue(y);S&&(G=S.x,p=S.y)}if(J.isConnected){const S=J.getConnectedValue(y);S&&(V=S.x,K=S.y,G=S.z)}return new B.vd(V,K,G,p)};K._storedFunction=y=>O(y),G._storedFunction=y=>{const S=O(y);return new V.OS(S.r,S.g,S.b)},p._storedFunction=y=>{const S=O(y);return new V.Vector2(S.r,S.g)},L._storedFunction=y=>{const S=O(y);return new V.Vector2(S.b,S.a)},T._storedFunction=y=>O(y).r,l._storedFunction=y=>O(y).g,j._storedFunction=y=>O(y).b,s._storedFunction=y=>O(y).a}}),function(y){y[y.Cos=0]="Cos",y[y.Sin=1]="Sin",y[y.Abs=2]="Abs",y[y.Exp=3]="Exp",y[y.Exp2=4]="Exp2",y[y.Round=5]="Round",y[y.Floor=6]="Floor",y[y.Ceiling=7]="Ceiling",y[y.Sqrt=8]="Sqrt",y[y.Log=9]="Log",y[y.Tan=10]="Tan",y[y.ArcTan=11]="ArcTan",y[y.ArcCos=12]="ArcCos",y[y.ArcSin=13]="ArcSin",y[y.Sign=14]="Sign",y[y.Negate=15]="Negate",y[y.OneMinus=16]="OneMinus",y[y.Reciprocal=17]="Reciprocal",y[y.ToDegrees=18]="ToDegrees",y[y.ToRadians=19]="ToRadians",y[y.Fract=20]="Fract"}(cS||(cS={}));class uI extends MS{constructor(y){super(y),this.operation=cS.Cos,this.registerInput("input",RS.AutoDetect),this.registerOutput("output",RS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(RS.Float|RS.Int|RS.Vector2|RS.OS|RS.vd)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(y){super._build(y);let S=null;switch(this.operation){case cS.Cos:S=y=>Math.cos(y);break;case cS.Sin:S=y=>Math.sin(y);break;case cS.Abs:S=y=>Math.abs(y);break;case cS.Exp:S=y=>Math.exp(y);break;case cS.Exp2:S=y=>Math.pow(2,y);break;case cS.Round:S=y=>Math.round(y);break;case cS.Floor:S=y=>Math.floor(y);break;case cS.Ceiling:S=y=>Math.ceil(y);break;case cS.Sqrt:S=y=>Math.sqrt(y);break;case cS.Log:S=y=>Math.log(y);break;case cS.Tan:S=y=>Math.tan(y);break;case cS.ArcTan:S=y=>Math.atan(y);break;case cS.ArcCos:S=y=>Math.acos(y);break;case cS.ArcSin:S=y=>Math.asin(y);break;case cS.Sign:S=y=>Math.sign(y);break;case cS.Negate:S=y=>-y;break;case cS.OneMinus:S=y=>1-y;break;case cS.Reciprocal:S=y=>1/y;break;case cS.ToRadians:S=y=>y*Math.PI/180;break;case cS.ToDegrees:S=y=>180*y/Math.PI;break;case cS.Fract:S=y=>y>=0?y-Math.floor(y):y-Math.ceil(y)}if(!S)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case RS.Int:case RS.Float:this.output._storedFunction=y=>{const I=this.input.getConnectedValue(y);return S(I)};break;case RS.Vector2:this.output._storedFunction=y=>{const I=this.input.getConnectedValue(y);return new V.Vector2(S(I.x),S(I.y))};break;case RS.OS:this.output._storedFunction=y=>{const I=this.input.getConnectedValue(y);return new V.OS(S(I.x),S(I.y),S(I.z))};break;case RS.vd:this.output._storedFunction=y=>{const I=this.input.getConnectedValue(y);return new B.vd(S(I.r),S(I.g),S(I.b),S(I.a))}}return this}serialize(){const y=super.serialize();return y.operation=this.operation,y}_deserialize(y){super._deserialize(y),this.operation=y.operation}}(0,v.c)([tS("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:cS.Cos},{label:"Sin",value:cS.Sin},{label:"Abs",value:cS.Abs},{label:"Exp",value:cS.Exp},{label:"Exp2",value:cS.Exp2},{label:"Round",value:cS.Round},{label:"Floor",value:cS.Floor},{label:"Ceiling",value:cS.Ceiling},{label:"Sqrt",value:cS.Sqrt},{label:"Log",value:cS.Log},{label:"Tan",value:cS.Tan},{label:"ArcTan",value:cS.ArcTan},{label:"ArcCos",value:cS.ArcCos},{label:"ArcSin",value:cS.ArcSin},{label:"Sign",value:cS.Sign},{label:"Negate",value:cS.Negate},{label:"OneMinus",value:cS.OneMinus},{label:"Reciprocal",value:cS.Reciprocal},{label:"ToDegrees",value:cS.ToDegrees},{label:"ToRadians",value:cS.ToRadians},{label:"Fract",value:cS.Fract}]})],uI.prototype,"operation",void 0),(0,d.e)("BABYLON.ParticleTrigonometryBlock",uI);var KI,GI=I(13729);class pI extends MS{constructor(y){super(y),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",RS.AutoDetect),this.registerOutput("output",RS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(RS.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(RS.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(RS.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(RS.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(RS.System),this._inputs[0].excludedConnectionPointTypes.push(RS.Particle),this._inputs[0].excludedConnectionPointTypes.push(RS.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(y){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const S=y=>{const S=this.input.getConnectedValue(y);if(this.log.length>=this.stackSize)return S;if(null===S||void 0===S)return this.log.push(["null",""]),S;switch(this.input.type){case RS.Vector2:this.log.push([(0,GI.i)(S,4),S.toString()]);break;case RS.OS:this.log.push([(0,GI.j)(S,4),S.toString()]);break;case RS.vd:this.log.push([`{R: ${S.r.toFixed(4)} G: ${S.g.toFixed(4)} B: ${S.b.toFixed(4)} A: ${S.a.toFixed(4)}}`,S.toString()]);break;default:this.log.push([S.toString(),S.toString()])}return S};this.output.isConnected?this.output._storedFunction=S:this.output._storedValue=S(y)}serialize(){const y=super.serialize();return y.stackSize=this.stackSize,y}_deserialize(y){super._deserialize(y),this.stackSize=y.stackSize}}(0,v.c)([tS("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],pI.prototype,"stackSize",void 0),(0,d.e)("BABYLON.ParticleDebugBlock",pI);(0,d.e)("BABYLON.ParticleElbowBlock",class extends MS{constructor(y){super(y),this.registerInput("input",RS.AutoDetect),this.registerOutput("output",RS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(y){super._build(y);const S=this._outputs[0],I=this._inputs[0];S._storedFunction=y=>I.getConnectedValue(y)}});(0,d.e)("BABYLON.ParticleTeleportInBlock",class extends MS{get endpoints(){return this._endpoints}constructor(y){super(y),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",RS.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(y){if(this.getClassName()===y)return!0;for(const S of this.endpoints)if(S.isAnAncestorOfType(y))return!0;return!1}isAnAncestorOf(y){for(const S of this.endpoints){if(S===y)return!0;if(S.isAnAncestorOf(y))return!0}return!1}attachToEndpoint(y){y.detach(),this._endpoints.push(y),y._entryPoint=this,y._outputs[0]._typeConnectionSource=this._inputs[0],y._tempEntryPointUniqueId=null,y.name="> "+this.name}detachFromEndpoint(y){const S=this._endpoints.indexOf(y);-1!==S&&(this._endpoints.splice(S,1),y._outputs[0]._typeConnectionSource=null,y._entryPoint=null)}_build(){for(const y of this._endpoints)y.output._storedFunction=y=>this.input.getConnectedValue(y)}});(0,d.e)("BABYLON.ParticleTeleportOutBlock",class extends MS{constructor(y){super(y),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",RS.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(y){this.entryPoint&&this.entryPoint.build(y)}clone(){const y=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(y),y}serialize(){var y;const S=super.serialize();return S.entryPoint=(null===(y=this.entryPoint)||void 0===y?void 0:y.uniqueId)??"",S}_deserialize(y){super._deserialize(y),this._tempEntryPointUniqueId=y.entryPoint}}),function(y){y[y.Equal=0]="Equal",y[y.NotEqual=1]="NotEqual",y[y.LessThan=2]="LessThan",y[y.GreaterThan=3]="GreaterThan",y[y.LessOrEqual=4]="LessOrEqual",y[y.GreaterOrEqual=5]="GreaterOrEqual",y[y.Xor=6]="Xor",y[y.Or=7]="Or",y[y.And=8]="And"}(KI||(KI={}));class LI extends MS{constructor(y){super(y),this.test=KI.Equal,this.epsilon=0,this.registerInput("left",RS.Float),this.registerInput("right",RS.Float,!0,0),this.registerInput("ifTrue",RS.AutoDetect,!0,1),this.registerInput("ifFalse",RS.AutoDetect,!0,0),this.registerOutput("output",RS.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=RS.Float,this._inputs[0].acceptedConnectionPointTypes.push(RS.Int),this._inputs[1].acceptedConnectionPointTypes.push(RS.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const y=y=>{const S=this.left.getConnectedValue(y),I=this.right.getConnectedValue(y);let V=!1;switch(this.test){case KI.Equal:V=(0,J.WithinEpsilon)(S,I,this.epsilon);break;case KI.NotEqual:V=!(0,J.WithinEpsilon)(S,I,this.epsilon);break;case KI.LessThan:V=S<I+this.epsilon;break;case KI.GreaterThan:V=S>I-this.epsilon;break;case KI.LessOrEqual:V=S<=I+this.epsilon;break;case KI.GreaterOrEqual:V=S>=I-this.epsilon;break;case KI.Xor:V=!!S&&!I||!S&&!!I;break;case KI.Or:V=!!S||!!I;break;case KI.And:V=!!S&&!!I}return V};this.output._storedFunction=S=>y(S)?this.ifTrue.getConnectedValue(S):this.ifFalse.getConnectedValue(S)}serialize(){const y=super.serialize();return y.test=this.test,y.epsilon=this.epsilon,y}_deserialize(y){super._deserialize(y),this.test=y.test,void 0!==y.epsilon&&(this.epsilon=y.epsilon)}}(0,v.c)([tS("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:KI.Equal},{label:"NotEqual",value:KI.NotEqual},{label:"LessThan",value:KI.LessThan},{label:"GreaterThan",value:KI.GreaterThan},{label:"LessOrEqual",value:KI.LessOrEqual},{label:"GreaterOrEqual",value:KI.GreaterOrEqual},{label:"Xor",value:KI.Xor},{label:"Or",value:KI.Or},{label:"And",value:KI.And}]})],LI.prototype,"test",void 0),(0,v.c)([tS("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],LI.prototype,"epsilon",void 0),(0,d.e)("BABYLON.ParticleConditionBlock",LI);class TI extends MS{constructor(y){super(y),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",RS.Particle),this.registerInput("condition",RS.Float,!0,0),this.registerInput("system",RS.System),this.registerOutput("output",RS.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(y){this._triggerCount=0;const S=this.input.getConnectedValue(y),I={process:I=>{if(y.particleContext=I,y.systemContext=S,0!==this.condition.getConnectedValue(y)&&(0===this.limit||this._triggerCount<this.limit)){const V=(new Date).getTime();if(this._previousOne&&V-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=V;const i=this.system.getConnectedValue(y);if(i){const V=YS(i,y.mI,I.position);V.zi.addOnce((()=>{this._triggerCount--})),S.zi.addOnce((()=>{V.dispose()}))}}},previousItem:null,nextItem:null};S._updateQueueStart?ey(I,S._updateQueueStart):S._updateQueueStart=I,this.output._storedValue=S}serialize(){const y=super.serialize();return y.limit=this.limit,y.delay=this.delay,y}_deserialize(y){super._deserialize(y),void 0!==y.limit&&(this.limit=y.limit),void 0!==y.delay&&(this.delay=y.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,v.c)([tS("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],TI.prototype,"limit",void 0),(0,v.c)([tS("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],TI.prototype,"delay",void 0),(0,d.e)("BABYLON.ParticleTriggerBlock",TI);I(13737),I(13743),I(13758),I(13818)},13803:(y,S,I)=>{"use strict";var V=I(12240);const i="clipPlaneFragment",A="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13766:(y,S,I)=>{"use strict";var V=I(12240);const i="clipPlaneFragmentDeclaration",A="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13834:(y,S,I)=>{"use strict";var V=I(12240);const i="clipPlaneVertex",A="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13821:(y,S,I)=>{"use strict";var V=I(12240);const i="clipPlaneVertexDeclaration",A="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13816:(y,S,I)=>{"use strict";var V=I(12240);const i="fogFragment",A="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13797:(y,S,I)=>{"use strict";var V=I(12240);const i="fogFragmentDeclaration",A="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13840:(y,S,I)=>{"use strict";var V=I(12240);const i="fogVertex",A="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13826:(y,S,I)=>{"use strict";var V=I(12240);const i="fogVertexDeclaration",A="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13785:(y,S,I)=>{"use strict";var V=I(12240);const i="helperFunctions",A="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13774:(y,S,I)=>{"use strict";var V=I(12240);const i="imageProcessingDeclaration",A="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13788:(y,S,I)=>{"use strict";var V=I(12240);const i="imageProcessingFunctions",A="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13776:(y,S,I)=>{"use strict";var V=I(12240);const i="logDepthDeclaration",A="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13809:(y,S,I)=>{"use strict";var V=I(12240);const i="logDepthFragment",A="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13846:(y,S,I)=>{"use strict";var V=I(12240);const i="logDepthVertex",A="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";V.b.IncludesShadersStoreWGSL[i]||(V.b.IncludesShadersStoreWGSL[i]=A)},13758:(y,S,I)=>{"use strict";I.r(S),I.d(S,{particlesPixelShaderWGSL:()=>B});var V=I(12240);I(13766),I(13774),I(13776),I(13785),I(13788),I(13797),I(13803),I(13809),I(13816);const i="particlesPixelShader",A="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";V.b.ShadersStoreWGSL[i]||(V.b.ShadersStoreWGSL[i]=A);const B={name:i,shader:A}},13818:(y,S,I)=>{"use strict";I.r(S),I.d(S,{particlesVertexShaderWGSL:()=>B});var V=I(12240);I(13821),I(13826),I(13776),I(13834),I(13840),I(13846);const i="particlesVertexShader",A="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";V.b.ShadersStoreWGSL[i]||(V.b.ShadersStoreWGSL[i]=A);const B={name:i,shader:A}},13668:(y,S,I)=>{"use strict";var V=I(12240);const i="clipPlaneFragment",A="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13739:(y,S,I)=>{"use strict";var V=I(12240);const i="clipPlaneFragmentDeclaration",A="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13689:(y,S,I)=>{"use strict";var V=I(12240);const i="clipPlaneVertex",A="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13752:(y,S,I)=>{"use strict";var V=I(12240);const i="clipPlaneVertexDeclaration",A="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13676:(y,S,I)=>{"use strict";var V=I(12240);const i="fogFragment",A="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13659:(y,S,I)=>{"use strict";var V=I(12240);const i="fogFragmentDeclaration",A="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13698:(y,S,I)=>{"use strict";var V=I(12240);const i="fogVertex",A="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13680:(y,S,I)=>{"use strict";var V=I(12240);const i="fogVertexDeclaration",A="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13646:(y,S,I)=>{"use strict";var V=I(12240);const i="helperFunctions",A="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13635:(y,S,I)=>{"use strict";var V=I(12240);const i="imageProcessingDeclaration",A="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13650:(y,S,I)=>{"use strict";var V=I(12240);const i="imageProcessingFunctions",A="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13641:(y,S,I)=>{"use strict";var V=I(12240);const i="logDepthDeclaration",A="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13673:(y,S,I)=>{"use strict";var V=I(12240);const i="logDepthFragment",A="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13701:(y,S,I)=>{"use strict";var V=I(12240);const i="logDepthVertex",A="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";V.b.IncludesShadersStore[i]||(V.b.IncludesShadersStore[i]=A)},13737:(y,S,I)=>{"use strict";I.r(S),I.d(S,{particlesPixelShader:()=>B});var V=I(12240);I(13739),I(13635),I(13641),I(13646),I(13650),I(13659),I(13668),I(13673),I(13676);const i="particlesPixelShader",A="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";V.b.ShadersStore[i]||(V.b.ShadersStore[i]=A);const B={name:i,shader:A}},13743:(y,S,I)=>{"use strict";I.r(S),I.d(S,{particlesVertexShader:()=>B});var V=I(12240);I(13752),I(13680),I(13641),I(13689),I(13698),I(13701);const i="particlesVertexShader",A="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";V.b.ShadersStore[i]||(V.b.ShadersStore[i]=A);const B={name:i,shader:A}},14085:(y,S,I)=>{"use strict";I.r(S),I.d(S,{FlowGraphGLTFDataProvider:()=>A});var V=I(14058),i=I(14033);class A extends V.d{constructor(y){var S,I;super();const V=y.glTF,A=(null===(S=V.animations)||void 0===S?void 0:S.map((y=>y._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",i.c,A);const B=(null===(I=V.nodes)||void 0===I?void 0:I.map((y=>y._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",i.c,B)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13982:(y,S,I)=>{"use strict";I.d(S,{d:()=>l,h:()=>L,i:()=>p,l:()=>T});var V=I(12321),i=I(12789),A=I(12362),B=I(13986);const d=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class F{constructor(y,S){this._gltf=y,this._infoTree=S}convert(y){let S,I=this._gltf,V=this._infoTree;if(!y.startsWith("/"))throw new Error("Path must start with a /");const i=y.split("/");if(i.shift(),i[i.length-1].includes(".length")){const y=i[i.length-1].split(".");i.pop(),i.push(...y)}let A=!1;for(const F of i){const i="length"===F;if(i&&!V.__array__)throw new Error(`Path ${y} is invalid`);if(V.__ignoreObjectTree__&&(A=!0),V.__array__&&!i)V=V.__array__;else if(V=V[F],!V)throw new Error(`Path ${y} is invalid`);if(!A)if(void 0===I){if(!d.find((S=>S.regex.test(y))))throw new Error(`Path ${y} is invalid`)}else if(!i){var B;I=null===(B=I)||void 0===B?void 0:B[F]}(V.__target__||i)&&(S=I)}return{object:S,info:V}}}function J(y,S,I,V){const i=u(y,S);return V?i[I][V]:i[I]}function u(y,S,I){var V,A;return null===(V=y._data)||void 0===V||null===(A=V[(null===I||void 0===I?void 0:I.fillMode)??i.b.MATERIAL_TriangleFillMode])||void 0===A?void 0:A.babylonMaterial}function K(y,S){return{offset:{componentsCount:2,type:"Vector2",get:(I,i,A)=>{const B=J(I,A,y,S);return new V.Vector2(null===B||void 0===B?void 0:B.uOffset,null===B||void 0===B?void 0:B.vOffset)},getTarget:u,set:(I,V,i,A)=>{const B=J(V,A,y,S);B.uOffset=I.x,B.vOffset=I.y},getPropertyName:[()=>`${y}${S?"."+S:""}.uOffset`,()=>`${y}${S?"."+S:""}.vOffset`]},rotation:{type:"number",get:(I,V,i)=>{var A;return null===(A=J(I,i,y,S))||void 0===A?void 0:A.wAng},getTarget:u,set:(I,V,i,A)=>J(V,A,y,S).wAng=I,getPropertyName:[()=>`${y}${S?"."+S:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(I,i,A)=>{const B=J(I,A,y,S);return new V.Vector2(null===B||void 0===B?void 0:B.uScale,null===B||void 0===B?void 0:B.vScale)},getTarget:u,set:(I,V,i,A)=>{const B=J(V,A,y,S);B.uScale=I.x,B.vScale=I.y},getPropertyName:[()=>`${y}${S?"."+S:""}.uScale`,()=>`${y}${S?"."+S:""}.vScale`]}}}const G={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:y=>{var S,I;return new V.Vector2((null===(S=y._babylonCamera)||void 0===S?void 0:S.orthoLeft)??0,(null===(I=y._babylonCamera)||void 0===I?void 0:I.orthoRight)??0)},set:(y,S)=>{S._babylonCamera&&(S._babylonCamera.orthoLeft=y.x,S._babylonCamera.orthoRight=y.y)},getTarget:y=>y,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:y=>{var S,I;return new V.Vector2((null===(S=y._babylonCamera)||void 0===S?void 0:S.orthoBottom)??0,(null===(I=y._babylonCamera)||void 0===I?void 0:I.orthoTop)??0)},set:(y,S)=>{S._babylonCamera&&(S._babylonCamera.orthoBottom=y.x,S._babylonCamera.orthoTop=y.y)},getTarget:y=>y,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:y=>{var S;return null===(S=y._babylonCamera)||void 0===S?void 0:S.maxZ},set:(y,S)=>{S._babylonCamera&&(S._babylonCamera.maxZ=y)},getTarget:y=>y,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:y=>{var S;return null===(S=y._babylonCamera)||void 0===S?void 0:S.Ld},set:(y,S)=>{S._babylonCamera&&(S._babylonCamera.Ld=y)},getTarget:y=>y,getPropertyName:[()=>"Ld"]}},perspective:{aspectRatio:{type:"number",get:y=>{var S;return null===(S=y._babylonCamera)||void 0===S?void 0:S.getEngine().getAspectRatio(y._babylonCamera)},getTarget:y=>y,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:y=>{var S;return null===(S=y._babylonCamera)||void 0===S?void 0:S.fov},set:(y,S)=>{S._babylonCamera&&(S._babylonCamera.fov=y)},getTarget:y=>y,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:y=>{var S;return null===(S=y._babylonCamera)||void 0===S?void 0:S.maxZ},set:(y,S)=>{S._babylonCamera&&(S._babylonCamera.maxZ=y)},getTarget:y=>y,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:y=>{var S;return null===(S=y._babylonCamera)||void 0===S?void 0:S.Ld},set:(y,S)=>{S._babylonCamera&&(S._babylonCamera.Ld=y)},getTarget:y=>y,getPropertyName:[()=>"Ld"]}}}},nodes:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"OS",get:y=>{var S;return null===(S=y._babylonTransformNode)||void 0===S?void 0:S.position},set:(y,S)=>{var I;return null===(I=S._babylonTransformNode)||void 0===I?void 0:I.position.A(y)},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:y=>{var S;return null===(S=y._babylonTransformNode)||void 0===S?void 0:S.rotationQuaternion},set:(y,S)=>{var I,V;return null===(I=S._babylonTransformNode)||void 0===I||null===(V=I.rotationQuaternion)||void 0===V?void 0:V.A(y)},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"OS",get:y=>{var S;return null===(S=y._babylonTransformNode)||void 0===S?void 0:S.zd},set:(y,S)=>{var I;return null===(I=S._babylonTransformNode)||void 0===I?void 0:I.zd.A(y)},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"zd"]},weights:{length:{type:"number",get:y=>y._numMorphTargets,getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(y,S)=>{var I,V;return void 0!==S?null===(I=y._primitiveBabylonMeshes)||void 0===I||null===(V=I[0].morphTargetManager)||void 0===V?void 0:V.getTarget(S).influence:void 0},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(y,S)=>[0],getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:y=>{var S,I,i;return V.Matrix.Compose(null===(S=y._babylonTransformNode)||void 0===S?void 0:S.zd,null===(I=y._babylonTransformNode)||void 0===I?void 0:I.rotationQuaternion,null===(i=y._babylonTransformNode)||void 0===i?void 0:i.position)},getTarget:y=>y._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:y=>{var S,I,i,A;const B=V.Matrix.Identity();let d=y.parent;for(;d&&d.parent;)d=d.parent;const F=(null===(S=y._babylonTransformNode)||void 0===S?void 0:S.position._isDirty)||(null===(I=y._babylonTransformNode)||void 0===I||null===(i=I.rotationQuaternion)||void 0===i?void 0:i._isDirty)||(null===(A=y._babylonTransformNode)||void 0===A?void 0:A.zd._isDirty);if(d){var J;const S=null===(J=d._babylonTransformNode)||void 0===J?void 0:J.sd(!0).invert();var u,K;if(S)null===(u=y._babylonTransformNode)||void 0===u||null===(K=u.sd(F))||void 0===K||K.multiplyToRef(S,B)}else y._babylonTransformNode&&B.A(y._babylonTransformNode.sd(F));return B},getTarget:y=>y._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:y=>{var S,I;return null===(S=y._babylonTransformNode)||void 0===S||null===(I=S.getChildren((y=>y instanceof B.b),!0)[0])||void 0===I?void 0:I.Rd},getTarget:y=>{var S;return null===(S=y._babylonTransformNode)||void 0===S?void 0:S.getChildren((y=>y instanceof B.b),!0)[0]},set:(y,S)=>{if(S._babylonTransformNode){const I=S._babylonTransformNode.getChildren((y=>y instanceof B.b),!0)[0];I&&(I.Rd=y)}}},color:{type:"DS",get:y=>{var S,I;return null===(S=y._babylonTransformNode)||void 0===S||null===(I=S.getChildren((y=>y instanceof B.b),!0)[0])||void 0===I?void 0:I.bd},getTarget:y=>{var S;return null===(S=y._babylonTransformNode)||void 0===S?void 0:S.getChildren((y=>y instanceof B.b),!0)[0]},set:(y,S)=>{if(S._babylonTransformNode){const I=S._babylonTransformNode.getChildren((y=>y instanceof B.b),!0)[0];I&&(I.bd=y)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"DS",get:(y,S,I)=>u(y,S,I).emissiveColor,set:(y,S,I,V)=>u(S,I,V).emissiveColor.A(y),getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:K("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(y,S,I)=>{var V;return null===(V=J(y,I,"bumpTexture"))||void 0===V?void 0:V.level},set:(y,S,I,V)=>{const i=J(S,V,"bumpTexture");i&&(i.level=y)},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:K("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(y,S,I)=>u(y,S,I).ambientTextureStrength,set:(y,S,I,V)=>{const i=u(S,I,V);i&&(i.ambientTextureStrength=y)},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:K("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"vd",get:(y,S,I)=>{const V=u(y,S,I);return A.vd.FromColor3(V.albedoColor,V.alpha)},set:(y,S,I,V)=>{const i=u(S,I,V);i.albedoColor.set(y.r,y.g,y.b),i.alpha=y.a},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:K("albedoTexture")}},metallicFactor:{type:"number",get:(y,S,I)=>u(y,S,I).metallic,set:(y,S,I,V)=>{const i=u(S,I,V);i&&(i.metallic=y)},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(y,S,I)=>u(y,S,I).roughness,set:(y,S,I,V)=>{const i=u(S,I,V);i&&(i.roughness=y)},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:K("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(y,S,I)=>u(y,S,I).anisotropy.Rd,set:(y,S,I,V)=>{u(S,I,V).anisotropy.Rd=y},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(y,S,I)=>u(y,S,I).anisotropy.angle,set:(y,S,I,V)=>{u(S,I,V).anisotropy.angle=y},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:K("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(y,S,I)=>u(y,S,I).clearCoat.Rd,set:(y,S,I,V)=>{u(S,I,V).clearCoat.Rd=y},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(y,S,I)=>u(y,S,I).clearCoat.roughness,set:(y,S,I,V)=>{u(S,I,V).clearCoat.roughness=y},getTarget:(y,S,I)=>u(y,S,I),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:K("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(y,S,I)=>{var V;return null===(V=u(y,S,I).clearCoat.bumpTexture)||void 0===V?void 0:V.level},getTarget:u,set:(y,S,I,V)=>u(S,I,V).clearCoat.bumpTexture.level=y},extensions:{KHR_texture_transform:K("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:K("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(y,S,I)=>u(y,S,I).subSurface.dispersion,getTarget:u,set:(y,S,I,V)=>u(S,I,V).subSurface.dispersion=y}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(y,S,I)=>u(y,S,I).emissiveIntensity,getTarget:u,set:(y,S,I,V)=>u(S,I,V).emissiveIntensity=y}},KHR_materials_ior:{ior:{type:"number",get:(y,S,I)=>u(y,S,I).indexOfRefraction,getTarget:u,set:(y,S,I,V)=>u(S,I,V).indexOfRefraction=y}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(y,S,I)=>u(y,S,I).iridescence.Rd,getTarget:u,set:(y,S,I,V)=>u(S,I,V).iridescence.Rd=y},iridescenceIor:{type:"number",get:(y,S,I)=>u(y,S,I).iridescence.indexOfRefraction,getTarget:u,set:(y,S,I,V)=>u(S,I,V).iridescence.indexOfRefraction=y},iridescenceTexture:{extensions:{KHR_texture_transform:K("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(y,S,I)=>u(y,S,I).iridescence.maximumThickness,getTarget:u,set:(y,S,I,V)=>u(S,I,V).iridescence.maximumThickness=y},iridescenceThicknessMinimum:{type:"number",get:(y,S,I)=>u(y,S,I).iridescence.minimumThickness,getTarget:u,set:(y,S,I,V)=>u(S,I,V).iridescence.minimumThickness=y},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:K("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"DS",get:(y,S,I)=>u(y,S,I).sheen.color,getTarget:u,set:(y,S,I,V)=>u(S,I,V).sheen.color.A(y)},sheenColorTexture:{extensions:{KHR_texture_transform:K("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(y,S,I)=>u(y,S,I).sheen.Rd,getTarget:u,set:(y,S,I,V)=>u(S,I,V).sheen.Rd=y},sheenRoughnessTexture:{extensions:{KHR_texture_transform:K("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(y,S,I)=>u(y,S,I).metallicF0Factor,getTarget:u,set:(y,S,I,V)=>u(S,I,V).metallicF0Factor=y,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"DS",get:(y,S,I)=>u(y,S,I).metallicReflectanceColor,getTarget:u,set:(y,S,I,V)=>u(S,I,V).metallicReflectanceColor.A(y),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:K("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:K("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(y,S,I)=>u(y,S,I).subSurface.refractionIntensity,getTarget:u,set:(y,S,I,V)=>u(S,I,V).subSurface.refractionIntensity=y,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:K("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(y,S,I)=>u(y,S,I).subSurface.translucencyIntensity,getTarget:u,set:(y,S,I,V)=>u(S,I,V).subSurface.translucencyIntensity=y},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:K("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"DS",get:(y,S,I)=>u(y,S,I).subSurface.translucencyColor,getTarget:u,set:(y,S,I,V)=>{var i;return y&&(null===(i=u(S,I,V).subSurface.translucencyColor)||void 0===i?void 0:i.A(y))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:K("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"DS",get:(y,S,I)=>u(y,S,I).subSurface.tintColor,getTarget:u,set:(y,S,I,V)=>u(S,I,V).subSurface.tintColor.A(y)},attenuationDistance:{type:"number",get:(y,S,I)=>u(y,S,I).subSurface.tintColorAtDistance,getTarget:u,set:(y,S,I,V)=>u(S,I,V).subSurface.tintColorAtDistance=y},thicknessFactor:{type:"number",get:(y,S,I)=>u(y,S,I).subSurface.maximumThickness,getTarget:u,set:(y,S,I,V)=>u(S,I,V).subSurface.maximumThickness=y},thicknessTexture:{extensions:{KHR_texture_transform:K("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonLight)),getPropertyName:[y=>"length"]},__array__:{__target__:!0,color:{type:"DS",get:y=>{var S;return null===(S=y._babylonLight)||void 0===S?void 0:S.bd},set:(y,S)=>{var I;return null===(I=S._babylonLight)||void 0===I?void 0:I.bd.A(y)},getTarget:y=>y._babylonLight,getPropertyName:[y=>"diffuse"]},Rd:{type:"number",get:y=>{var S;return null===(S=y._babylonLight)||void 0===S?void 0:S.Rd},set:(y,S)=>S._babylonLight?S._babylonLight.Rd=y:void 0,getTarget:y=>y._babylonLight,getPropertyName:[y=>"intensity"]},range:{type:"number",get:y=>{var S;return null===(S=y._babylonLight)||void 0===S?void 0:S.range},set:(y,S)=>S._babylonLight?S._babylonLight.range=y:void 0,getTarget:y=>y._babylonLight,getPropertyName:[y=>"range"]},spot:{innerConeAngle:{type:"number",get:y=>{var S;return null===(S=y._babylonLight)||void 0===S?void 0:S.innerAngle},set:(y,S)=>S._babylonLight?S._babylonLight.innerAngle=y:void 0,getTarget:y=>y._babylonLight,getPropertyName:[y=>"innerConeAngle"]},outerConeAngle:{type:"number",get:y=>{var S;return null===(S=y._babylonLight)||void 0===S?void 0:S.angle},set:(y,S)=>S._babylonLight?S._babylonLight.angle=y:void 0,getTarget:y=>y._babylonLight,getPropertyName:[y=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonLight)),getPropertyName:[y=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonTexture)),getPropertyName:[y=>"length"]},__array__:{__target__:!0,Rd:{type:"number",get:y=>{var S;return null===(S=y._babylonTexture)||void 0===S?void 0:S.level},set:(y,S)=>{S._babylonTexture&&(S._babylonTexture.level=y)},getTarget:y=>y._babylonTexture},rotation:{type:"Quaternion",get:y=>{var S;return y._babylonTexture&&V.Quaternion.FromRotationMatrix(null===(S=y._babylonTexture)||void 0===S?void 0:S.getReflectionTextureMatrix())},set:(y,S)=>{var I;S._babylonTexture&&(null!==(I=S._babylonTexture.Ey())&&void 0!==I&&I.useRightHandedSystem||(y=V.Quaternion.Inverse(y)),V.Matrix.FromQuaternionToRef(y,S._babylonTexture.getReflectionTextureMatrix()))},getTarget:y=>y._babylonTexture}}}}},animations:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>{var S;return null===(S=y.primitives[0]._instanceData)||void 0===S?void 0:S.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function p(y){return new F(y,G)}function L(y){const S=y.split("/").map((y=>y.replace(/{}/g,"__array__")));let I=G;for(const V of S)V&&(I=I[V]);if(I&&I.type&&I.get)return I}function T(y,S){const I=y.split("/").map((y=>y.replace(/{}/g,"__array__")));let V=G;for(const i of I)i&&(V=V[i]);V&&V.type&&V.get&&(V.interpolation=S)}function l(y,S){const I=y.split("/").map((y=>y.replace(/{}/g,"__array__")));let V=G;for(const i of I)if(i){if(!V[i]){if("?"===i){V.__ignoreObjectTree__=!0;continue}V[i]={},"__array__"===i&&(V[i].__target__=!0)}V=V[i]}Object.assign(V,S)}},13992:(y,S,I)=>{"use strict";I.r(S),I.d(S,{AnimationPropertyInfo:()=>J,TransformNodeAnimationPropertyInfo:()=>u,WeightAnimationPropertyInfo:()=>K,getQuaternion:()=>d,getVector3:()=>B,getWeights:()=>F});var V=I(12838),i=I(12321),A=I(13982);function B(y,S,I,V){return i.OS.oS(S,I).scaleInPlace(V)}function d(y,S,I,V){return i.Quaternion.oS(S,I).scaleInPlace(V)}function F(y,S,I,V){const i=new Array(y._numMorphTargets);for(let A=0;A<i.length;A++)i[A]=S[I++]*V;return i}class J{constructor(y,S,I,V){this.type=y,this.name=S,this.getValue=I,this.getStride=V}_buildAnimation(y,S,I){const i=new V.b(y,this.name,S,this.type);return i.setKeys(I),i}}class u extends J{buildAnimations(y,S,I,V){const i=[];return i.push({babylonAnimatable:y._babylonTransformNode,babylonAnimation:this._buildAnimation(S,I,V)}),i}}class K extends J{buildAnimations(y,S,I,i){const A=[];if(y._numMorphTargets)for(let B=0;B<y._numMorphTargets;B++){const d=new V.b(`${S}_${B}`,this.name,I,this.type);if(d.setKeys(i.map((y=>({frame:y.frame,inTangent:y.inTangent?y.inTangent[B]:void 0,value:y.value[B],outTangent:y.outTangent?y.outTangent[B]:void 0,interpolation:y.interpolation})))),y._primitiveBabylonMeshes)for(const S of y._primitiveBabylonMeshes)if(S.morphTargetManager){const y=S.morphTargetManager.getTarget(B),I=d.clone();y.animations.push(I),A.push({babylonAnimatable:y,babylonAnimation:I})}}return A}}(0,A.l)("/nodes/{}/translation",[new u(V.b.ANIMATIONTYPE_VECTOR3,"position",B,(()=>3))]),(0,A.l)("/nodes/{}/rotation",[new u(V.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",d,(()=>4))]),(0,A.l)("/nodes/{}/scale",[new u(V.b.ANIMATIONTYPE_VECTOR3,"zd",B,(()=>3))]),(0,A.l)("/nodes/{}/weights",[new K(V.b.ANIMATIONTYPE_FLOAT,"influence",F,(y=>y._numMorphTargets))])},13955:(y,S,I)=>{"use strict";class V{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((y,S)=>{this._resolve=y,this._reject=S}))}}var i=I(12321),A=I(12362),B=I(12128),d=I(12759),F=I(13959),J=I(13967),u=I(12133),K=I(12782),G=I(12838),p=I(12847),L=I(12185),T=I(12151),l=I(12159);class j{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(y){this._useTextureToStoreBoneMatrices=y,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(y){this._animationPropertiesOverride=y}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(y,S,I){this.name=y,this.id=S,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=i.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new u.b,this.bones=[],this._scene=I||L.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const V=this._scene.getEngine().getCaps();this._canUseTextureForBones=V.textureFloat&&V.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((y=>!y.getParent()))}getTransformMatrices(y){if(this.needInitialSkinMatrix){if(!y)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return y._bonesTransformMatrices||this.prepare(!0),y._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(y){return this.needInitialSkinMatrix&&y._transformMatrixTexture?y._transformMatrixTexture:this._transformMatrixTexture}Ey(){return this._scene}toString(y){let S=`Name: ${this.name}, nBones: ${this.bones.length}`;if(S+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,y){S+=", Ranges: {";let y=!0;for(const I in this._ranges)y&&(S+=", ",y=!1),S+=I;S+="}"}return S}getBoneIndexByName(y){for(let S=0,I=this.bones.length;S<I;S++)if(this.bones[S].name===y)return S;return-1}createAnimationRange(y,S,I){if(!this._ranges[y]){this._ranges[y]=new p.d(y,S,I);for(let V=0,i=this.bones.length;V<i;V++)this.bones[V].animations[0]&&this.bones[V].animations[0].createRange(y,S,I)}}deleteAnimationRange(y){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let I=0,V=this.bones.length;I<V;I++)this.bones[I].animations[0]&&this.bones[I].animations[0].deleteRange(y,S);this._ranges[y]=null}getAnimationRange(y){return this._ranges[y]||null}getAnimationRanges(){const y=[];let S;for(S in this._ranges)y.push(this._ranges[S]);return y}copyAnimationRange(y,S){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[S]||!y.getAnimationRange(S))return!1;let V=!0;const i=this._getHighestAnimationFrame()+1,A={},B=y.bones;let d,F;for(F=0,d=B.length;F<d;F++)A[B[F].name]=B[F];this.bones.length!==B.length&&(T.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${B.length}`),V=!1);const J=I&&this.dimensionsAtRest&&y.dimensionsAtRest?this.dimensionsAtRest.divide(y.dimensionsAtRest):null;for(F=0,d=this.bones.length;F<d;F++){const y=this.bones[F].name,B=A[y];B?V=V&&this.bones[F].copyAnimationRange(B,S,i,I,J):(T.b.Warn("copyAnimationRange: not same rig, missing source bone "+y),V=!1)}const u=y.getAnimationRange(S);return u&&(this._ranges[S]=new p.d(S,u.from+i,u.to+i)),V}returnToRest(){for(const y of this.bones)-1!==y._index&&y.returnToRest()}_getHighestAnimationFrame(){let y=0;for(let S=0,I=this.bones.length;S<I;S++)if(this.bones[S].animations[0]){const I=this.bones[S].animations[0].getHighestFrame();y<I&&(y=I)}return y}beginAnimation(y,S,I,V){const i=this.getAnimationRange(y);return i?this._scene.beginAnimation(this,i.from,i.to,S,I,V):null}static MakeAnimationAdditive(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2?arguments[2]:void 0;const V=y.getAnimationRange(I);if(!V)return null;const i=y._scene.getAllAnimatablesByTarget(y);let A=null;for(let d=0;d<i.length;d++){const y=i[d];if(y.fromFrame===(null===V||void 0===V?void 0:V.from)&&y.toFrame===(null===V||void 0===V?void 0:V.to)){A=y;break}}const B=y.getAnimatables();for(let d=0;d<B.length;d++){const y=B[d].animations;if(y)for(let V=0;V<y.length;V++)G.b.MakeAnimationAdditive(y[V],S,I)}return A&&(A.isAdditive=!0),y}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(y){this._meshesWithPoseMatrix.push(y)}_unregisterMeshWithPoseMatrix(y){const S=this._meshesWithPoseMatrix.indexOf(y);S>-1&&this._meshesWithPoseMatrix.splice(S,1)}_computeTransformMatrices(y,S){this.onBeforeComputeObservable.notifyObservers(this);for(let I=0;I<this.bones.length;I++){const V=this.bones[I];V._childUpdateId++;const i=V.getParent();if(i?V.getLocalMatrix().multiplyToRef(i.getFinalMatrix(),V.getFinalMatrix()):S?V.getLocalMatrix().multiplyToRef(S,V.getFinalMatrix()):V.getFinalMatrix().A(V.getLocalMatrix()),-1!==V._index){const S=null===V._index?I:V._index;V.getAbsoluteInverseBindMatrix().multiplyToArray(V.getFinalMatrix(),y,16*S)}}this._identity.copyToArray(y,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const y=this.Ey().getRenderId();if(this._currentRenderId===y)return;this._currentRenderId=y}if(this._numBonesWithLinkedTransformNode>0)for(const y of this.bones)if(y._linkedTransformNode){const S=y._linkedTransformNode;y.position=S.position,S.rotationQuaternion?y.rotationQuaternion=S.rotationQuaternion:y.rotation=S.rotation,y.zd=S.zd}if(this.needInitialSkinMatrix)for(const y of this._meshesWithPoseMatrix){const S=y.getPoseMatrix();let I=this._isDirty;if(y._bonesTransformMatrices&&y._bonesTransformMatrices.length===16*(this.bones.length+1)||(y._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),I=!0),I){if(this._synchronizedWithMesh!==y){this._synchronizedWithMesh=y;for(const y of this.bones)if(!y.getParent()){y.getBindMatrix().multiplyToRef(S,i.TmpVectors.Matrix[1]),y._updateAbsoluteBindMatrices(i.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const S=4*(this.bones.length+1);y._transformMatrixTexture&&y._transformMatrixTexture.getSize().width===S||(y._transformMatrixTexture&&y._transformMatrixTexture.dispose(),y._transformMatrixTexture=K.b.CreateRGBATexture(y._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(y._bonesTransformMatrices,S),this.isUsingTextureForMatrices&&y._transformMatrixTexture&&y._transformMatrixTexture.update(y._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=K.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let y=0;y<this.bones.length;y++)this._animatables.push(this.bones[y])}return this._animatables}clone(y,S){const I=new j(y,S||y,this._scene);I.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let V=0;V<this.bones.length;V++){const y=this.bones[V];let S=null;const i=y.getParent();if(i){const y=this.bones.indexOf(i);S=I.bones[y]}const A=new J.c(y.name,I,S,y.getBindMatrix().clone(),y.getRestMatrix().clone());A._index=y._index,y._linkedTransformNode&&A.linkTransformNode(y._linkedTransformNode),l.d.DeepCopy(y.animations,A.animations)}if(this._ranges){I._ranges={};for(const y in this._ranges){const S=this._ranges[y];S&&(I._ranges[y]=S.clone())}}return this._isDirty=!0,I.prepare(!0),I}enableBlending(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const S of this.bones)for(const I of S.animations)I.enableBlending=!0,I.blendingSpeed=y}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Ey().stopAnimation(this),this.Ey().removeSkeleton(this),this._parentContainer){const y=this._parentContainer.skeletons.indexOf(this);y>-1&&this._parentContainer.skeletons.splice(y,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const y={};y.name=this.name,y.id=this.id,this.dimensionsAtRest&&(y.dimensionsAtRest=this.dimensionsAtRest.Vd()),y.bones=[],y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let I=0;I<this.bones.length;I++){var S;const V=this.bones[I],i=V.getParent(),A={parentBoneIndex:i?this.bones.indexOf(i):-1,index:V.getIndex(),name:V.name,id:V.id,matrix:V.getBindMatrix().Vd(),rest:V.getRestMatrix().Vd(),linkedTransformNodeId:null===(S=V.getTransformNode())||void 0===S?void 0:S.id};y.bones.push(A),V.length&&(A.length=V.length),V.metadata&&(A.metadata=V.metadata),V.animations&&V.animations.length>0&&(A.animation=V.animations[0].serialize()),y.ranges=[];for(const S in this._ranges){const I=this._ranges[S];if(!I)continue;const V={};V.name=S,V.from=I.from,V.to=I.to,y.ranges.push(V)}}return y}static Parse(y,S){const I=new j(y.name,y.id,S);let V;for(y.dimensionsAtRest&&(I.dimensionsAtRest=i.OS.oS(y.dimensionsAtRest)),I.needInitialSkinMatrix=y.needInitialSkinMatrix,V=0;V<y.bones.length;V++){const S=y.bones[V],A=y.bones[V].index;let B=null;S.parentBoneIndex>-1&&(B=I.bones[S.parentBoneIndex]);const d=S.rest?i.Matrix.oS(S.rest):null,F=new J.c(S.name,I,B,i.Matrix.oS(S.matrix),d,null,A);void 0!==S.id&&null!==S.id&&(F.id=S.id),S.length&&(F.length=S.length),S.metadata&&(F.metadata=S.metadata),S.animation&&F.animations.push(G.b.Parse(S.animation)),void 0!==S.linkedTransformNodeId&&null!==S.linkedTransformNodeId&&(I._hasWaitingData=!0,F._waitingTransformNodeId=S.linkedTransformNodeId)}if(y.ranges)for(V=0;V<y.ranges.length;V++){const S=y.ranges[V];I.createAnimationRange(S.name,S.from,S.to)}return I}computeAbsoluteMatrices(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||y)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(y)}getPoseMatrix(){let y=null;return this._meshesWithPoseMatrix.length>0&&(y=this._meshesWithPoseMatrix[0].getPoseMatrix()),y}sortBones(){const y=[],S=new Array(this.bones.length);for(let I=0;I<this.bones.length;I++)this._sortBones(I,y,S);this.bones=y}_sortBones(y,S,I){if(I[y])return;I[y]=!0;const V=this.bones[y];if(!V)return;void 0===V._index&&(V._index=y);const i=V.getParent();i&&this._sortBones(this.bones.indexOf(i),S,I),S.push(V)}setCurrentPoseAsRest(){for(const y of this.bones)y.setCurrentPoseAsRest()}}var s=I(12637),O=I(12794),f=I(12304),my=I(12723),C=I(12390),D=I(12766),o=I(12734),E=I(12753),z=I(12854),r=I(12412),h=I(13910);class n{set areUpdatesFrozen(y){y?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new r.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,y||(y=L.e.LastCreatedScene),this._scene=y,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const y=this._scene.getEngine().getCaps();this._canUseTextureForTargets=y.canUseGLVertexID&&y.textureFloat&&y.maxVertexTextureImageUnits>0&&y.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return n.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?n.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(y){this._numMaxInfluencers!==y&&(this._numMaxInfluencers=y,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(y){this._useTextureToStoreTargets!==y&&(this._useTextureToStoreTargets=y,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var y;return n.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(y=this._scene)&&void 0!==y&&y.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(y){return this._activeTargets.data[y]}getTarget(y){return this._targets[y]}getTargetByName(y){for(const S of this._targets)if(S.name===y)return S;return null}addTarget(y){this._targets.push(y),this._targetInfluenceChangedObservers.push(y.onInfluenceChanged.add((y=>{this.areUpdatesFrozen&&y&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(y)}))),this._targetDataLayoutChangedObservers.push(y._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(y){const S=this._targets.indexOf(y);S>=0&&(this._targets.splice(S,1),y.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(S,1)[0]),y._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(S,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(y)}_bind(y){y.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),y.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),y.setTexture("morphTargets",this._targetStoreTexture),y.setInt("morphTargetCount",this.numInfluencers)}clone(){const y=new n(this._scene);for(const S of this._targets)y.addTarget(S.clone());return y.enablePositionMorphing=this.enablePositionMorphing,y.enableNormalMorphing=this.enableNormalMorphing,y.enableTangentMorphing=this.enableTangentMorphing,y.enableUVMorphing=this.enableUVMorphing,y.enableUV2Morphing=this.enableUV2Morphing,y.enableColorMorphing=this.enableColorMorphing,y}serialize(){const y={};y.id=this.uniqueId,y.targets=[];for(const S of this._targets)y.targets.push(S.serialize());return y}_syncActiveTargets(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const S=!!this._targetStoreTexture,I=this.isUsingTextureForTargets;(this._mustSynchronize||S!==I)&&(this._mustSynchronize=!1,this.synchronize());let V=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let i=-1;for(const A of this._targets)if(i++,0!==A.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=n.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(A),this._morphTargetTextureIndices[V]=i,this._tempInfluences[V++]=A.influence}this._morphTargetTextureIndices.length!==V&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,V)),this._influences&&this._influences.length===V||(this._influences=new Float32Array(V));for(let A=0;A<V;A++)this._influences[A]=this._tempInfluences[A];if(y&&this._scene)for(const A of this._scene.meshes)A.morphTargetManager===this&&(I?A._markSubMeshesAsAttributesDirty():A._syncGeometryWithMorphTargetManager())}synchronize(){var y;if(!this._scene||this.areUpdatesFrozen)return;const S=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(y=this._targetStoreTexture)||void 0===y||y.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>S.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const I of this._targets){this._supportsPositions=this._supportsPositions&&I.hasPositions,this._supportsNormals=this._supportsNormals&&I.hasNormals,this._supportsTangents=this._supportsTangents&&I.hasTangents,this._supportsUVs=this._supportsUVs&&I.hasUVs,this._supportsUV2s=this._supportsUV2s&&I.hasUV2s,this._supportsColors=this._supportsColors&&I.hasColors;const y=I.vertexCount;if(0===this._vertexCount)this._vertexCount=y;else if(this._vertexCount!==y)return void T.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${I.name}": ${y}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const y=S.getCaps().maxTextureSize;this._textureWidth>y&&(this._textureHeight=Math.ceil(this._textureWidth/y),this._textureWidth=y);const I=this._targets.length,V=new Float32Array(I*this._textureWidth*this._textureHeight*4);let i=0;for(let S=0;S<I;S++){const y=this._targets[S],I=y.getPositions(),A=y.getNormals(),B=y.getUVs(),d=y.getTangents(),F=y.getUV2s(),J=y.getColors();i=S*this._textureWidth*this._textureHeight*4;for(let S=0;S<this._vertexCount;S++)this._supportsPositions&&I&&(V[i]=I[3*S],V[i+1]=I[3*S+1],V[i+2]=I[3*S+2],i+=4),this._supportsNormals&&A&&(V[i]=A[3*S],V[i+1]=A[3*S+1],V[i+2]=A[3*S+2],i+=4),this._supportsUVs&&B&&(V[i]=B[2*S],V[i+1]=B[2*S+1],i+=4),this._supportsTangents&&d&&(V[i]=d[3*S],V[i+1]=d[3*S+1],V[i+2]=d[3*S+2],i+=4),this._supportsUV2s&&F&&(V[i]=F[2*S],V[i+1]=F[2*S+1],i+=4),this._supportsColors&&J&&(V[i]=J[4*S],V[i+1]=J[4*S+1],V[i+2]=J[4*S+2],V[i+3]=J[4*S+3],i+=4)}this._targetStoreTexture=h.e.CreateRGBATexture(V,this._textureWidth,this._textureHeight,I,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const I of this._scene.meshes)I.morphTargetManager===this&&I._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const y=this._parentContainer.morphTargetManagers.indexOf(this);y>-1&&this._parentContainer.morphTargetManagers.splice(y,1),this._parentContainer=null}for(const y of this._targets)this._scene.stopAnimation(y)}}static Parse(y,S){const I=new n(S);for(const V of y.targets)I.addTarget(z.b.Parse(V,S));return I}}n.EnableTextureStorage=!0,n.MaxActiveMorphTargetsInVertexAttributeMode=8,n.ConstantTargetCountForTextureMode=0;var v=I(13969),P=I(12193),q=I(12660);const g=new Map,k=g;function R(y,S,I){b(y)&&T.b.Warn(`Extension with the name '${y}' already exists`),g.set(y,{isGLTFExtension:S,factory:I})}function b(y){return g.delete(y)}var U=I(13982),W=I(12913),a=I(12404);class e{static Get(y,S,I){if(!S||void 0==I||!S[I])throw new Error(`${y}: Failed to find index (${I})`);return S[I]}static TryGet(y,S){return y&&void 0!=S&&y[S]?y[S]:null}static Assign(y){if(y)for(let S=0;S<y.length;S++)y[S].index=S}}function x(y){if(y.min&&y.max){const S=y.min,I=y.max,V=i.TmpVectors.OS[0].od(S[0],S[1],S[2]),A=i.TmpVectors.OS[1].od(I[0],I[1],I[2]);if(y.normalized&&5126!==y.componentType){let S=1;switch(y.componentType){case 5120:S=127;break;case 5121:S=255;break;case 5122:S=32767;break;case 5123:S=65535}const I=1/S;V.scaleInPlace(I),A.scaleInPlace(I)}return new q.e(V,A)}return null}class Q{static RegisterExtension(y,S){R(y,!1,S)}static UnregisterExtension(y){return b(y)}get ai(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(y){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=y}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((y=>y.dispose&&y.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(y,S,I,V,i,A){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=S,this._assetContainer=I,this._loadData(V);let A=null;if(y){const S={};if(this._gltf.nodes)for(const y of this._gltf.nodes)y.name&&(S[y.name]=y.index);A=(y instanceof Array?y:[y]).map((y=>{const I=S[y];if(void 0===I)throw new Error(`Failed to find node '${y}'`);return I}))}return await this._loadAsync(i,B,A,(()=>({meshes:this._getMeshes(),dG:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(y,S,I,V){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=y,this._loadData(S),await this._loadAsync(I,i,null,(()=>{}))}async _loadAsync(y,S,I,V){return await Promise.resolve().then((async()=>{this._rootUrl=y,this._uniqueRootUrl=!y.startsWith("file:")&&S?y:`${y}${Date.now()}/`,this._fileName=S,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const i=`${v.n[v.n.LOADING]} => ${v.n[v.n.READY]}`,A=`${v.n[v.n.LOADING]} => ${v.n[v.n.COMPLETE]}`;this._parent._startPerformanceCounter(i),this._parent._startPerformanceCounter(A),this._parent._setState(v.n.LOADING),this._extensionsOnLoading();const d=new Array;if(!this.parent.loadOnlyMaterials)if(I)d.push(this.loadSceneAsync("/nodes",{nodes:I,index:-1}));else if(void 0!=this._gltf.mI||this._gltf.scenes&&this._gltf.scenes[0]){const y=e.Get("/scene",this._gltf.scenes,this._gltf.mI||0);d.push(this.loadSceneAsync(`/scenes/${y.index}`,y))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let y=0;y<this._gltf.materials.length;++y){const S=this._gltf.materials[y],I="/materials/"+y,V=s.d.TriangleFillMode;d.push(this._loadMaterialAsync(I,S,null,V,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&d.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&d.push(this._compileShadowGeneratorsAsync());const F=Promise.all(d).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.VF(!0);for(const y of this._babylonScene.materials){const S=y;void 0!==S.maxSimultaneousLights&&(S.maxSimultaneousLights=Math.max(S.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(v.n.READY),this._skipStartAnimationStep||this._startAnimations(),V()}));return await F.then((y=>(this._parent._endPerformanceCounter(i),B.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(A),this._parent._setState(v.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(y=>{this._parent.onErrorObservable.notifyObservers(y),this._parent.onErrorObservable.clear(),this.dispose()}))})),y)))})).catch((y=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(y),this._parent.onErrorObservable.clear(),this.dispose()),y}))}_loadData(y){if(this._gltf=y.json,this._setupData(),y.bin){const S=this._gltf.buffers;if(S&&S[0]&&!S[0].uri){const I=S[0];(I.byteLength<y.bin.byteLength-3||I.byteLength>y.bin.byteLength)&&T.b.Warn(`Binary buffer length (${I.byteLength}) from JSON does not match chunk length (${y.bin.byteLength})`),this._bin=y.bin}else T.b.Warn("Unexpected BIN chunk")}}_setupData(){if(e.Assign(this._gltf.accessors),e.Assign(this._gltf.animations),e.Assign(this._gltf.buffers),e.Assign(this._gltf.bufferViews),e.Assign(this._gltf.cameras),e.Assign(this._gltf.images),e.Assign(this._gltf.materials),e.Assign(this._gltf.meshes),e.Assign(this._gltf.nodes),e.Assign(this._gltf.samplers),e.Assign(this._gltf.scenes),e.Assign(this._gltf.skins),e.Assign(this._gltf.textures),this._gltf.nodes){const y={};for(const I of this._gltf.nodes)if(I.children)for(const S of I.children)y[S]=I.index;const S=this._createRootNode();for(const I of this._gltf.nodes){const V=y[I.index];I.parent=void 0===V?S:this._gltf.nodes[V]}}}async _loadExtensionsAsync(){const y=[];if(k.forEach(((S,I)=>{var V;!1===(null===(V=this.parent.extensionOptions[I])||void 0===V?void 0:V.enabled)?S.isGLTFExtension&&this.isExtensionUsed(I)&&T.b.Warn(`Extension ${I} is used but has been explicitly disabled.`):S.isGLTFExtension&&!this.isExtensionUsed(I)||y.push((async()=>{const y=await S.factory(this);return y.name!==I&&T.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${y.name} !== ${I}`),this._parent.onExtensionLoadedObservable.notifyObservers(y),y})())})),this._extensions.push(...await Promise.all(y)),this._extensions.sort(((y,S)=>(y.order||Number.MAX_VALUE)-(S.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const I of this._gltf.extensionsRequired){if(!this._extensions.some((y=>y.name===I&&y.enabled))){var S;if(!1===(null===(S=this.parent.extensionOptions[I])||void 0===S?void 0:S.enabled))throw new Error(`Required extension ${I} is disabled`);throw new Error(`Required extension ${I} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new E.c("__root__",this._babylonScene);this._rootBabylonMesh=y,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.VF(!1);const S={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case v.j.AUTO:this._babylonScene.useRightHandedSystem||(S.rotation=[0,1,0,0],S.scale=[1,1,-1],Q._LoadTransform(S,this._rootBabylonMesh));break;case v.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(y),S}loadSceneAsync(y,S){const I=this._extensionsLoadSceneAsync(y,S);if(I)return I;const V=new Array;if(this.logOpen(`${y} ${S.name||""}`),S.nodes)for(const i of S.nodes){const S=e.Get(`${y}/nodes/${i}`,this._gltf.nodes,i);V.push(this.loadNodeAsync(`/nodes/${S.index}`,S,(y=>{y.parent=this._rootBabylonMesh})))}for(const i of this._postSceneLoadActions)i();return V.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(V).then((()=>{}))}_forEachPrimitive(y,S){if(y._primitiveBabylonMeshes)for(const I of y._primitiveBabylonMeshes)S(I)}_getGeometries(){const y=[],S=this._gltf.nodes;if(S)for(const I of S)this._forEachPrimitive(I,(S=>{const I=S.Od;I&&-1===y.indexOf(I)&&y.push(I)}));return y}_getMeshes(){const y=[];this._rootBabylonMesh instanceof o.e&&y.push(this._rootBabylonMesh);const S=this._gltf.nodes;if(S)for(const I of S)this._forEachPrimitive(I,(S=>{y.push(S)}));return y}_getTransformNodes(){const y=[],S=this._gltf.nodes;if(S)for(const I of S)I._babylonTransformNode&&"ip"===I._babylonTransformNode.getClassName()&&y.push(I._babylonTransformNode),I._babylonTransformNodeForSkin&&y.push(I._babylonTransformNodeForSkin);return y}_getSkeletons(){const y=[],S=this._gltf.skins;if(S)for(const I of S)I._data&&y.push(I._data.babylonSkeleton);return y}_getAnimationGroups(){const y=[],S=this._gltf.animations;if(S)for(const I of S)I._babylonAnimationGroup&&y.push(I._babylonAnimationGroup);return y}_startAnimations(){switch(this._parent.animationStartMode){case v.f.NONE:break;case v.f.FIRST:{const y=this._getAnimationGroups();0!==y.length&&y[0].start(!0);break}case v.f.ALL:{const y=this._getAnimationGroups();for(const S of y)S.start(!0);break}default:return void T.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadNodeAsync(y,S,I);if(V)return V;if(S._babylonTransformNode)throw new Error(`${y}: Invalid recursive node hierarchy`);const i=new Array;this.logOpen(`${y} ${S.name||""}`);const A=V=>{if(Q.AddPointerMetadata(V,y),Q._LoadTransform(S,V),void 0!=S.camera){const I=e.Get(`${y}/camera`,this._gltf.cameras,S.camera);i.push(this.loadCameraAsync(`/cameras/${I.index}`,I,(y=>{y.parent=V,this._babylonScene.useRightHandedSystem||(V.zd.x=-1)})))}if(S.children)for(const I of S.children){const S=e.Get(`${y}/children/${I}`,this._gltf.nodes,I);i.push(this.loadNodeAsync(`/nodes/${S.index}`,S,(y=>{y.parent=V})))}I(V)},B=void 0!=S.mesh,d=this._parent.loadSkins&&void 0!=S.skin;if(!B||d){const y=S.name||`node${S.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new my.d(y,this._babylonScene);I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==S.mesh?S._babylonTransformNode=I:S._babylonTransformNodeForSkin=I,A(I)}if(B)if(d){const I=e.Get(`${y}/mesh`,this._gltf.meshes,S.mesh);i.push(this._loadMeshAsync(`/meshes/${I.index}`,S,I,(I=>{const V=S._babylonTransformNodeForSkin;I.metadata=(0,W.e)(V.metadata,I.metadata||{});const A=e.Get(`${y}/skin`,this._gltf.skins,S.skin);i.push(this._loadSkinAsync(`/skins/${A.index}`,S,A,(y=>{this._forEachPrimitive(S,(S=>{S.skeleton=y})),this._postSceneLoadActions.push((()=>{if(void 0!=A.skeleton){const y=e.Get(`/skins/${A.index}/skeleton`,this._gltf.nodes,A.skeleton).parent;S.index===y.index?I.parent=V.parent:I.parent=y._babylonTransformNode}else I.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:V,skinnedNode:I})}))})))})))}else{const I=e.Get(`${y}/mesh`,this._gltf.meshes,S.mesh);i.push(this._loadMeshAsync(`/meshes/${I.index}`,S,I,A))}return this.logClose(),Promise.all(i).then((()=>(this._forEachPrimitive(S,(y=>{const S=y;!S.isAnInstance&&S.Od&&S.Od.useBoundingInfoFromGeometry?y.Ry():y.refreshBoundingInfo(!0,!0)})),S._babylonTransformNode)))}_loadMeshAsync(y,S,I,V){const i=I.primitives;if(!i||!i.length)throw new Error(`${y}: Primitives are missing`);void 0==i[0].index&&e.Assign(i);const A=new Array;this.logOpen(`${y} ${I.name||""}`);const B=S.name||`node${S.index}`;if(1===i.length){const V=I.primitives[0];A.push(this._loadMeshPrimitiveAsync(`${y}/primitives/${V.index}`,B,S,I,V,(y=>{S._babylonTransformNode=y,S._primitiveBabylonMeshes=[y]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,S._babylonTransformNode=new my.d(B,this._babylonScene),S._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._primitiveBabylonMeshes=[];for(const V of i)A.push(this._loadMeshPrimitiveAsync(`${y}/primitives/${V.index}`,`${B}_primitive${V.index}`,S,I,V,(y=>{y.parent=S._babylonTransformNode,S._primitiveBabylonMeshes.push(y)})))}return V(S._babylonTransformNode),this.logClose(),Promise.all(A).then((()=>S._babylonTransformNode))}_loadMeshPrimitiveAsync(y,S,I,V,i,A){const B=this._extensionsLoadMeshPrimitiveAsync(y,S,I,V,i,A);if(B)return B;this.logOpen(`${y}`);const d=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==I.skin&&!V.primitives[0].targets;let F,J;if(d&&i._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,F=i._instanceData.babylonSourceMesh.createInstance(S),F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J=i._instanceData.promise;else{const A=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new E.c(S,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.sideOrientation=this._babylonScene.useRightHandedSystem?s.d.CounterClockWiseSideOrientation:s.d.ClockWiseSideOrientation,this._createMorphTargets(y,I,V,i,B),A.push(this._loadVertexDataAsync(y,i,B).then((async S=>await this._loadMorphTargetsAsync(y,i,B,S).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,S.gy(B),S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const u=Q._GetDrawMode(y,i.mode);if(void 0==i.material){let y=this._defaultBabylonMaterialData[u];y||(y=this._createDefaultMaterial("__GLTFLoader._default",u),this._parent.onMaterialLoadedObservable.notifyObservers(y),this._defaultBabylonMaterialData[u]=y),B.material=y}else if(!this.parent.skipMaterials){const S=e.Get(`${y}/material`,this._gltf.materials,i.material);A.push(this._loadMaterialAsync(`/materials/${S.index}`,S,B,u,(y=>{B.material=y})))}J=Promise.all(A),d&&(i._instanceData={babylonSourceMesh:B,promise:J}),F=B}return Q.AddPointerMetadata(F,y),this._parent.onMeshLoadedObservable.notifyObservers(F),A(F),this.logClose(),J.then((()=>F))}_loadVertexDataAsync(y,S,I){const V=this._extensionsLoadVertexDataAsync(y,S,I);if(V)return V;const i=S.attributes;if(!i)throw new Error(`${y}: Attributes are missing`);const A=new Array,B=new D.d(I.name,this._babylonScene);if(void 0==S.indices)I.isUnIndexed=!0;else{const I=e.Get(`${y}/indices`,this._gltf.accessors,S.indices);A.push(this._loadIndicesAccessorAsync(`/accessors/${I.index}`,I).then((y=>{B.setIndices(y)})))}const d=(S,V,d)=>{if(void 0==i[S])return;I._delayInfo=I._delayInfo||[],-1===I._delayInfo.indexOf(V)&&I._delayInfo.push(V);const F=e.Get(`${y}/attributes/${S}`,this._gltf.accessors,i[S]);A.push(this._loadVertexAccessorAsync(`/accessors/${F.index}`,F,V).then((y=>{if(y.getKind()===C.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!I.skeleton){const y=x(F);y&&(B._boundingInfo=y,B.useBoundingInfoFromGeometry=!0)}B.setVerticesBuffer(y,F.count)}))),V==C.e.MatricesIndicesExtraKind&&(I.numBoneInfluencers=8),d&&d(F)};return d("POSITION",C.e.PositionKind),d("NORMAL",C.e.NormalKind),d("TANGENT",C.e.TangentKind),d("TEXCOORD_0",C.e.UVKind),d("TEXCOORD_1",C.e.UV2Kind),d("TEXCOORD_2",C.e.UV3Kind),d("TEXCOORD_3",C.e.UV4Kind),d("TEXCOORD_4",C.e.UV5Kind),d("TEXCOORD_5",C.e.UV6Kind),d("JOINTS_0",C.e.MatricesIndicesKind),d("WEIGHTS_0",C.e.MatricesWeightsKind),d("JOINTS_1",C.e.MatricesIndicesExtraKind),d("WEIGHTS_1",C.e.MatricesWeightsExtraKind),d("COLOR_0",C.e.ColorKind,(y=>{"VEC4"===y.type&&(I.hasVertexAlpha=!0)})),Promise.all(A).then((()=>B))}_createMorphTargets(y,S,I,V,i){if(!V.targets||!this._parent.loadMorphTargets)return;if(void 0==S._numMorphTargets)S._numMorphTargets=V.targets.length;else if(V.targets.length!==S._numMorphTargets)throw new Error(`${y}: Primitives do not have the same number of targets`);const A=I.extras?I.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,i.morphTargetManager=new n(this._babylonScene),i.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.morphTargetManager.areUpdatesFrozen=!0;for(let B=0;B<V.targets.length;B++){const y=S.weights?S.weights[B]:I.weights?I.weights[B]:0,V=A?A[B]:`morphTarget${B}`;i.morphTargetManager.addTarget(new z.b(V,y,i.Ey()))}}_loadMorphTargetsAsync(y,S,I,V){if(!S.targets||!this._parent.loadMorphTargets)return Promise.resolve();const i=new Array,A=I.morphTargetManager;for(let B=0;B<A.numTargets;B++){const I=A.getTarget(B);i.push(this._loadMorphTargetVertexDataAsync(`${y}/targets/${B}`,V,S.targets[B],I))}return Promise.all(i).then((()=>{A.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(y,S,I,V){const i=new Array,A=(V,A,B)=>{if(void 0==I[V])return;const d=S.getVertexBuffer(A);if(!d)return;const F=e.Get(`${y}/${V}`,this._gltf.accessors,I[V]);i.push(this._loadFloatAccessorAsync(`/accessors/${F.index}`,F).then((y=>{B(d,y)})))};return A("POSITION",C.e.PositionKind,((y,S)=>{const I=new Float32Array(S.length);y.forEach(S.length,((y,V)=>{I[V]=S[V]+y})),V.setPositions(I)})),A("NORMAL",C.e.NormalKind,((y,S)=>{const I=new Float32Array(S.length);y.forEach(I.length,((y,V)=>{I[V]=S[V]+y})),V.setNormals(I)})),A("TANGENT",C.e.TangentKind,((y,S)=>{const I=new Float32Array(S.length/3*4);let i=0;y.forEach(S.length/3*4,((y,V)=>{(V+1)%4!==0&&(I[i]=S[i]+y,i++)})),V.setTangents(I)})),A("TEXCOORD_0",C.e.UVKind,((y,S)=>{const I=new Float32Array(S.length);y.forEach(S.length,((y,V)=>{I[V]=S[V]+y})),V.setUVs(I)})),A("TEXCOORD_1",C.e.UV2Kind,((y,S)=>{const I=new Float32Array(S.length);y.forEach(S.length,((y,V)=>{I[V]=S[V]+y})),V.setUV2s(I)})),A("COLOR_0",C.e.ColorKind,((S,I)=>{let i=null;const A=S.getSize();if(3===A){i=new Float32Array(I.length/3*4),S.forEach(I.length,((y,S)=>{const V=Math.floor(S/3),A=S%3;i[4*V+A]=I[3*V+A]+y}));for(let y=0;y<I.length/3;++y)i[4*y+3]=1}else{if(4!==A)throw new Error(`${y}: Invalid number of components (${A}) for COLOR_0 attribute`);i=new Float32Array(I.length),S.forEach(I.length,((y,S)=>{i[S]=I[S]+y}))}V.setColors(i)})),await Promise.all(i).then((()=>{}))}static _LoadTransform(y,S){if(void 0!=y.skin)return;let I=i.OS.Zero(),V=i.Quaternion.Identity(),A=i.OS.One();if(y.matrix){i.Matrix.oS(y.matrix).decompose(A,V,I)}else y.translation&&(I=i.OS.oS(y.translation)),y.rotation&&(V=i.Quaternion.oS(y.rotation)),y.scale&&(A=i.OS.oS(y.scale));S.position=I,S.rotationQuaternion=V,S.zd=A}_loadSkinAsync(y,S,I,V){if(!this._parent.loadSkins)return Promise.resolve();const i=this._extensionsLoadSkinAsync(y,S,I);if(i)return i;if(I._data)return V(I._data.babylonSkeleton),I._data.promise;const A=`skeleton${I.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new j(I.name||A,A,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(y,I,B);const d=this._loadSkinInverseBindMatricesDataAsync(y,I).then((y=>{this._updateBoneMatrices(B,y)}));return I._data={babylonSkeleton:B,promise:d},V(B),d}_loadBones(y,S,I){if(void 0==S.skeleton||this._parent.alwaysComputeSkeletonRootNode){const I=this._findSkeletonRootNode(`${y}/joints`,S.joints);if(I)if(void 0===S.skeleton)S.skeleton=I.index;else{const V=(y,S)=>{for(;S.parent;S=S.parent)if(S.parent===y)return!0;return!1},i=e.Get(`${y}/skeleton`,this._gltf.nodes,S.skeleton);i===I||V(i,I)||(T.b.Warn(`${y}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),S.skeleton=I.index)}else T.b.Warn(`${y}: Failed to find common root`)}const V={};for(const i of S.joints){const A=e.Get(`${y}/joints/${i}`,this._gltf.nodes,i);this._loadBone(A,S,I,V)}}_findSkeletonRootNode(y,S){if(0===S.length)return null;const I={};for(const i of S){const S=[];let V=e.Get(`${y}/${i}`,this._gltf.nodes,i);for(;-1!==V.index;)S.unshift(V),V=V.parent;I[i]=S}let V=null;for(let i=0;;++i){let y=I[S[0]];if(i>=y.length)return V;const A=y[i];for(let B=1;B<S.length;++B)if(y=I[S[B]],i>=y.length||A!==y[i])return V;V=A}}_loadBone(y,S,I,V){y._isJoint=!0;let i=V[y.index];if(i)return i;let A=null;y.index!==S.skeleton&&(y.parent&&-1!==y.parent.index?A=this._loadBone(y.parent,S,I,V):void 0!==S.skeleton&&T.b.Warn(`/skins/${S.index}/skeleton: Skeleton node is not a common root`));const B=S.joints.indexOf(y.index);return i=new J.c(y.name||`joint${y.index}`,I,A,this._getNodeMatrix(y),null,null,B),V[y.index]=i,this._postSceneLoadActions.push((()=>{i.linkTransformNode(y._babylonTransformNode)})),i}_loadSkinInverseBindMatricesDataAsync(y,S){if(void 0==S.inverseBindMatrices)return Promise.resolve(null);const I=e.Get(`${y}/inverseBindMatrices`,this._gltf.accessors,S.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${I.index}`,I)}_updateBoneMatrices(y,S){for(const I of y.bones){const y=i.Matrix.Identity(),V=I._index;S&&-1!==V&&(i.Matrix.FromArrayToRef(S,16*V,y),y.invertToRef(y));const A=I.getParent();A&&y.multiplyToRef(A.getAbsoluteInverseBindMatrix(),y),I.jd(y,!1,!1),I._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(y){return y.matrix?i.Matrix.oS(y.matrix):i.Matrix.Compose(y.scale?i.OS.oS(y.scale):i.OS.One(),y.rotation?i.Quaternion.oS(y.rotation):i.Quaternion.Identity(),y.translation?i.OS.oS(y.translation):i.OS.Zero())}loadCameraAsync(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadCameraAsync(y,S,I);if(V)return V;const A=new Array;this.logOpen(`${y} ${S.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new F.b(S.name||`camera${S.index}`,i.OS.Zero(),this._babylonScene,!1);switch(B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._babylonCamera=B,B.setTarget(new i.OS(0,0,-1)),S.type){case"perspective":{const I=S.perspective;if(!I)throw new Error(`${y}: Camera perspective properties are missing`);B.fov=I.yfov,B.Ld=I.znear,B.maxZ=I.zfar||0;break}case"orthographic":if(!S.orthographic)throw new Error(`${y}: Camera orthographic properties are missing`);B.mode=d.b.ORTHOGRAPHIC_CAMERA,B.orthoLeft=-S.orthographic.xmag,B.orthoRight=S.orthographic.xmag,B.orthoBottom=-S.orthographic.ymag,B.orthoTop=S.orthographic.ymag,B.Ld=S.orthographic.znear,B.maxZ=S.orthographic.zfar;break;default:throw new Error(`${y}: Invalid camera type (${S.type})`)}return Q.AddPointerMetadata(B,y),this._parent.onCameraLoadedObservable.notifyObservers(B),I(B),this.logClose(),Promise.all(A).then((()=>B))}_loadAnimationsAsync(){const y=this._gltf.animations;if(!y)return Promise.resolve();const S=new Array;for(let I=0;I<y.length;I++){const V=y[I];S.push(this.loadAnimationAsync(`/animations/${V.index}`,V).then((y=>{0===y.targetedAnimations.length&&y.dispose()})))}return Promise.all(S).then((()=>{}))}loadAnimationAsync(y,S){const V=this._extensionsLoadAnimationAsync(y,S);return V||I.e(78).then(I.bind(I,15458)).then((I=>{let{AnimationGroup:V}=I;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new V(S.name||`animation${S.index}`,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._babylonAnimationGroup=i;const A=new Array;e.Assign(S.channels),e.Assign(S.samplers);for(const B of S.channels)A.push(this._loadAnimationChannelAsync(`${y}/channels/${B.index}`,y,S,B,((y,S)=>{y.animations=y.animations||[],y.animations.push(S),i.addTargetedAnimation(S,y)})));return Promise.all(A).then((()=>(i.normalize(0),i)))}))}async _loadAnimationChannelAsync(y,S,V,i,A){const B=this._extensionsLoadAnimationChannelAsync(y,S,V,i,A);if(B)return await B;if(void 0==i.target.node)return await Promise.resolve();const d=e.Get(`${y}/target/node`,this._gltf.nodes,i.target.node),F=i.target.path,J="weights"===F;if(J&&!d._numMorphTargets||!J&&!d._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!J&&!d._isJoint)return await Promise.resolve();let u;switch(await Promise.resolve().then(I.bind(I,13992)),F){case"translation":var K;u=null===(K=(0,U.h)("/nodes/{}/translation"))||void 0===K?void 0:K.interpolation;break;case"rotation":var G;u=null===(G=(0,U.h)("/nodes/{}/rotation"))||void 0===G?void 0:G.interpolation;break;case"scale":var p;u=null===(p=(0,U.h)("/nodes/{}/scale"))||void 0===p?void 0:p.interpolation;break;case"weights":var L;u=null===(L=(0,U.h)("/nodes/{}/weights"))||void 0===L?void 0:L.interpolation;break;default:throw new Error(`${y}/target/path: Invalid value (${i.target.path})`)}if(!u)throw new Error(`${y}/target/path: Could not find interpolation properties for target path (${i.target.path})`);const T={object:d,info:u};return await this._loadAnimationChannelFromTargetInfoAsync(y,S,V,i,T,A)}_loadAnimationChannelFromTargetInfoAsync(y,S,I,V,i,A){const B=this.parent.targetFps,d=1/B,F=e.Get(`${y}/sampler`,I.samplers,V.sampler);return this._loadAnimationSamplerAsync(`${S}/samplers/${V.sampler}`,F).then((y=>{let S=0;const F=i.object,J=i.info;for(const i of J){const J=i.getStride(F),u=y.input,K=y.output,G=new Array(u.length);let p=0;switch(y.interpolation){case"STEP":for(let y=0;y<u.length;y++){const S=i.getValue(F,K,p,1);p+=J,G[y]={frame:u[y]*B,value:S,interpolation:1}}break;case"CUBICSPLINE":for(let y=0;y<u.length;y++){const S=i.getValue(F,K,p,d);p+=J;const I=i.getValue(F,K,p,1);p+=J;const V=i.getValue(F,K,p,d);p+=J,G[y]={frame:u[y]*B,inTangent:S,value:I,outTangent:V}}break;case"LINEAR":for(let y=0;y<u.length;y++){const S=i.getValue(F,K,p,1);p+=J,G[y]={frame:u[y]*B,value:S}}}if(p>0){const y=`${I.name||`animation${I.index}`}_channel${V.index}_${S}`,d=i.buildAnimations(F,y,B,G);for(const I of d)S++,A(I.babylonAnimatable,I.babylonAnimation)}}}))}_loadAnimationSamplerAsync(y,S){if(S._data)return S._data;const I=S.interpolation||"LINEAR";switch(I){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${y}/interpolation: Invalid value (${S.interpolation})`)}const V=e.Get(`${y}/input`,this._gltf.accessors,S.input),i=e.Get(`${y}/output`,this._gltf.accessors,S.output);return S._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${V.index}`,V),this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)]).then((y=>{let[S,V]=y;return{input:S,interpolation:I,output:V}})),S._data}loadBufferAsync(y,S,I,V){const i=this._extensionsLoadBufferAsync(y,S,I,V);if(i)return i;if(!S._data)if(S.uri)S._data=this.loadUriAsync(`${y}/uri`,S,S.uri);else{if(!this._bin)throw new Error(`${y}: Uri is missing or the binary glTF is missing its binary chunk`);S._data=this._bin.readAsync(0,S.byteLength)}return S._data.then((S=>{try{return new Uint8Array(S.buffer,S.byteOffset+I,V)}catch(i){throw new Error(`${y}: ${i.message}`)}}))}loadBufferViewAsync(y,S){const I=this._extensionsLoadBufferViewAsync(y,S);if(I)return I;if(S._data)return S._data;const V=e.Get(`${y}/buffer`,this._gltf.buffers,S.buffer);return S._data=this.loadBufferAsync(`/buffers/${V.index}`,V,S.byteOffset||0,S.byteLength),S._data}_loadAccessorAsync(y,S,I){if(S._data)return S._data;const V=Q._GetNumComponents(y,S.type),i=V*C.e.GetTypeByteLength(S.componentType),A=V*S.count;if(void 0==S.bufferView)S._data=Promise.resolve(new I(A));else{const B=e.Get(`${y}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((d=>{if(5126!==S.componentType||S.normalized||B.byteStride&&B.byteStride!==i){const y=new I(A);return C.e.ForEach(d,S.byteOffset||0,B.byteStride||i,V,S.componentType,y.length,S.normalized||!1,((S,I)=>{y[I]=S})),y}return Q._GetTypedArray(y,S.componentType,d,S.byteOffset,A)}))}if(S.sparse){const A=S.sparse;S._data=S._data.then((B=>{const d=B,F=e.Get(`${y}/sparse/indices/bufferView`,this._gltf.bufferViews,A.indices.bufferView),J=e.Get(`${y}/sparse/values/bufferView`,this._gltf.bufferViews,A.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${F.index}`,F),this.loadBufferViewAsync(`/bufferViews/${J.index}`,J)]).then((B=>{let[F,J]=B;const u=Q._GetTypedArray(`${y}/sparse/indices`,A.indices.componentType,F,A.indices.byteOffset,A.count),K=V*A.count;let G;if(5126!==S.componentType||S.normalized){const B=Q._GetTypedArray(`${y}/sparse/values`,S.componentType,J,A.values.byteOffset,K);G=new I(K),C.e.ForEach(B,0,i,V,S.componentType,G.length,S.normalized||!1,((y,S)=>{G[S]=y}))}else G=Q._GetTypedArray(`${y}/sparse/values`,S.componentType,J,A.values.byteOffset,K);let p=0;for(let y=0;y<u.length;y++){let S=u[y]*V;for(let y=0;y<V;y++)d[S++]=G[p++]}return d}))}))}return S._data}_loadFloatAccessorAsync(y,S){return this._loadAccessorAsync(y,S,Float32Array)}_loadIndicesAccessorAsync(y,S){if("SCALAR"!==S.type)throw new Error(`${y}/type: Invalid value ${S.type}`);if(5121!==S.componentType&&5123!==S.componentType&&5125!==S.componentType)throw new Error(`${y}/componentType: Invalid value ${S.componentType}`);if(S._data)return S._data;if(S.sparse){const I=Q._GetTypedArrayConstructor(`${y}/componentType`,S.componentType);S._data=this._loadAccessorAsync(y,S,I)}else{const I=e.Get(`${y}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${I.index}`,I).then((I=>Q._GetTypedArray(y,S.componentType,I,S.byteOffset,S.count)))}return S._data}_loadVertexBufferViewAsync(y){if(y._babylonBuffer)return y._babylonBuffer;const S=this._babylonScene.getEngine();return y._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((y=>new C.b(S,y,!1))),y._babylonBuffer}_loadVertexAccessorAsync(y,S,I){var V;if(null!==(V=S._babylonVertexBuffer)&&void 0!==V&&V[I])return S._babylonVertexBuffer[I];S._babylonVertexBuffer||(S._babylonVertexBuffer={});const i=this._babylonScene.getEngine();if(S.sparse||void 0==S.bufferView)S._babylonVertexBuffer[I]=this._loadFloatAccessorAsync(y,S).then((y=>new C.e(i,y,I,!1)));else{const V=e.Get(`${y}/bufferView`,this._gltf.bufferViews,S.bufferView);S._babylonVertexBuffer[I]=this._loadVertexBufferViewAsync(V).then((A=>{const B=Q._GetNumComponents(y,S.type);return new C.e(i,A,I,!1,void 0,V.byteStride,void 0,S.byteOffset,B,S.componentType,S.normalized,!0,void 0,!0)}))}return S._babylonVertexBuffer[I]}_loadMaterialMetallicRoughnessPropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;return S&&(S.baseColorFactor?(I.albedoColor=A.DS.oS(S.baseColorFactor),I.alpha=S.baseColorFactor[3]):I.albedoColor=A.DS.White(),I.metallic=void 0==S.metallicFactor?1:S.metallicFactor,I.roughness=void 0==S.roughnessFactor?1:S.roughnessFactor,S.baseColorTexture&&V.push(this.loadTextureInfoAsync(`${y}/baseColorTexture`,S.baseColorTexture,(y=>{y.name=`${I.name} (Base Color)`,I.albedoTexture=y}))),S.metallicRoughnessTexture&&(S.metallicRoughnessTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${y}/metallicRoughnessTexture`,S.metallicRoughnessTexture,(y=>{y.name=`${I.name} (Metallic Roughness)`,I.metallicTexture=y}))),I.useMetallnessFromMetallicTextureBlue=!0,I.useRoughnessFromMetallicTextureGreen=!0,I.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(V).then((()=>{}))}_loadMaterialAsync(y,S,I,V){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const A=this._extensionsLoadMaterialAsync(y,S,I,V,i);if(A)return A;S._data=S._data||{};let B=S._data[V];if(!B){this.logOpen(`${y} ${S.name||""}`);const I=this.createMaterial(y,S,V);B={babylonMaterial:I,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(y,S,I)},S._data[V]=B,Q.AddPointerMetadata(I,y),this._parent.onMaterialLoadedObservable.notifyObservers(I),this.logClose()}return I&&(B.babylonMeshes.push(I),I.zi.addOnce((()=>{const y=B.babylonMeshes.indexOf(I);-1!==y&&B.babylonMeshes.splice(y,1)}))),i(B.babylonMaterial),B.promise.then((()=>B.babylonMaterial))}_createDefaultMaterial(y,S){this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new O.d(y,this._babylonScene);return I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I.fillMode=S,I.enableSpecularAntiAliasing=!0,I.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,I.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,I.transparencyMode=O.d.PBRMATERIAL_OPAQUE,I.metallic=1,I.roughness=1,I}createMaterial(y,S,I){const V=this._extensionsCreateMaterial(y,S,I);if(V)return V;const i=S.name||`material${S.index}`;return this._createDefaultMaterial(i,I)}loadMaterialPropertiesAsync(y,S,I){const V=this._extensionsLoadMaterialPropertiesAsync(y,S,I);if(V)return V;const i=new Array;return i.push(this.loadMaterialBasePropertiesAsync(y,S,I)),S.pbrMetallicRoughness&&i.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${y}/pbrMetallicRoughness`,S.pbrMetallicRoughness,I)),this.loadMaterialAlphaProperties(y,S,I),Promise.all(i).then((()=>{}))}loadMaterialBasePropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;return I.emissiveColor=S.emissiveFactor?A.DS.oS(S.emissiveFactor):new A.DS(0,0,0),S.doubleSided&&(I.Dd=!1,I.twoSidedLighting=!0),S.normalTexture&&(S.normalTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${y}/normalTexture`,S.normalTexture,(y=>{y.name=`${I.name} (Normal)`,I.bumpTexture=y}))),I.invertNormalMapX=!this._babylonScene.useRightHandedSystem,I.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=S.normalTexture.scale&&I.bumpTexture&&(I.bumpTexture.level=S.normalTexture.scale),I.forceIrradianceInFragment=!0),S.occlusionTexture&&(S.occlusionTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${y}/occlusionTexture`,S.occlusionTexture,(y=>{y.name=`${I.name} (Occlusion)`,I.ambientTexture=y}))),I.useAmbientInGrayScale=!0,void 0!=S.occlusionTexture.strength&&(I.ambientTextureStrength=S.occlusionTexture.strength)),S.emissiveTexture&&V.push(this.loadTextureInfoAsync(`${y}/emissiveTexture`,S.emissiveTexture,(y=>{y.name=`${I.name} (Emissive)`,I.emissiveTexture=y}))),Promise.all(V).then((()=>{}))}loadMaterialAlphaProperties(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);switch(S.alphaMode||"OPAQUE"){case"OPAQUE":I.transparencyMode=O.d.PBRMATERIAL_OPAQUE,I.alpha=1;break;case"MASK":I.transparencyMode=O.d.PBRMATERIAL_ALPHATEST,I.alphaCutOff=void 0==S.alphaCutoff?.5:S.alphaCutoff,I.albedoTexture&&(I.albedoTexture.Fd=!0);break;case"BLEND":I.transparencyMode=O.d.PBRMATERIAL_ALPHABLEND,I.albedoTexture&&(I.albedoTexture.Fd=!0,I.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${y}/alphaMode: Invalid value (${S.alphaMode})`)}}loadTextureInfoAsync(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadTextureInfoAsync(y,S,I);if(V)return V;if(this.logOpen(`${y}`),S.texCoord>=6)throw new Error(`${y}/texCoord: Invalid value (${S.texCoord})`);const i=e.Get(`${y}/index`,this._gltf.textures,S.index);i._textureInfo=S;const A=this._loadTextureAsync(`/textures/${S.index}`,i,(V=>{V.coordinatesIndex=S.texCoord||0,Q.AddPointerMetadata(V,y),this._parent.onTextureLoadedObservable.notifyObservers(V),I(V)}));return this.logClose(),A}_loadTextureAsync(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadTextureAsync(y,S,I);if(V)return V;this.logOpen(`${y} ${S.name||""}`);const i=void 0==S.sampler?Q.DefaultSampler:e.Get(`${y}/sampler`,this._gltf.samplers,S.sampler),A=e.Get(`${y}/source`,this._gltf.images,S.source),B=this._createTextureAsync(y,i,A,I,void 0,!S._textureInfo.nonColorData);return this.logClose(),B}_createTextureAsync(y,S,I){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},A=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;const d=this._loadSampler(`/samplers/${S.index}`,S),F=new Array,J=new V;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u={noMipmap:d.noMipMaps,invertY:!1,samplingMode:d.samplingMode,Y:()=>{this._disposed||J.resolve()},onError:(S,I)=>{this._disposed||J.reject(new Error(`${y}: ${I&&I.message?I.message:S||"Failed to load texture"}`))},mimeType:I.mimeType??(0,P.j)(I.uri??""),loaderOptions:A,useSRGBBuffer:!!B&&this._parent.useSRGBBuffers},K=new f.e(null,this._babylonScene,u);return K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.push(J.promise),F.push(this.loadImageAsync(`/images/${I.index}`,I).then((y=>{const S=I.uri||`${this._fileName}#image${I.index}`,V=`data:${this._uniqueRootUrl}${S}`;K.updateURL(V,y);const i=K.getInternalTexture();i&&(i.label=I.name)}))),K.wrapU=d.wrapU,K.wrapV=d.wrapV,i(K),this._parent.useGltfTextureNames&&(K.name=I.name||I.uri||`image${I.index}`),Promise.all(F).then((()=>K))}_loadSampler(y,S){return S._data||(S._data={noMipMaps:9728===S.minFilter||9729===S.minFilter,samplingMode:Q._GetTextureSamplingMode(y,S),wrapU:Q._GetTextureWrapMode(`${y}/wrapS`,S.wrapS),wrapV:Q._GetTextureWrapMode(`${y}/wrapT`,S.wrapT)}),S._data}loadImageAsync(y,S){if(!S._data){if(this.logOpen(`${y} ${S.name||""}`),S.uri)S._data=this.loadUriAsync(`${y}/uri`,S,S.uri);else{const I=e.Get(`${y}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${I.index}`,I)}this.logClose()}return S._data}loadUriAsync(y,S,I){const V=this._extensionsLoadUriAsync(y,S,I);if(V)return V;if(!Q._ValidateUri(I))throw new Error(`${y}: '${I}' is invalid`);if((0,P.l)(I)){const S=new Uint8Array((0,P.b)(I));return this.log(`${y}: Decoded ${I.substring(0,64)}... (${S.length} bytes)`),Promise.resolve(S)}return this.log(`${y}: Loading ${I}`),this._parent.preprocessUrlAsync(this._rootUrl+I).then((S=>new Promise(((V,i)=>{this._parent._loadFile(this._babylonScene,S,(S=>{this._disposed||(this.log(`${y}: Loaded ${I} (${S.byteLength} bytes)`),V(new Uint8Array(S)))}),!0,(S=>{i(new P.o(`${y}: Failed to load '${I}'${S?": "+S.status+" "+S.statusText:""}`,S))}))}))))}static AddPointerMetadata(y,S){y.metadata=y.metadata||{};const I=y._internalMetadata=y._internalMetadata||{},V=I.ai=I.ai||{};(V.pointers=V.pointers||[]).push(S)}static _GetTextureWrapMode(y,S){switch(S=void 0==S?10497:S){case 33071:return f.e.CLAMP_ADDRESSMODE;case 33648:return f.e.MIRROR_ADDRESSMODE;case 10497:return f.e.WRAP_ADDRESSMODE;default:return T.b.Warn(`${y}: Invalid value (${S})`),f.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(y,S){const I=void 0==S.magFilter?9729:S.magFilter,V=void 0==S.minFilter?9987:S.minFilter;if(9729===I)switch(V){case 9728:return f.e.LINEAR_NEAREST;case 9729:return f.e.LINEAR_LINEAR;case 9984:return f.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return f.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return f.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return f.e.LINEAR_LINEAR_MIPLINEAR;default:return T.b.Warn(`${y}/minFilter: Invalid value (${V})`),f.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==I&&T.b.Warn(`${y}/magFilter: Invalid value (${I})`),V){case 9728:return f.e.NEAREST_NEAREST;case 9729:return f.e.NEAREST_LINEAR;case 9984:return f.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return f.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return f.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return f.e.NEAREST_LINEAR_MIPLINEAR;default:return T.b.Warn(`${y}/minFilter: Invalid value (${V})`),f.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(y,S){try{return(0,a.q)(S)}catch(I){throw new Error(`${y}: ${I.message}`)}}static _GetTypedArray(y,S,I,V,i){const A=I.buffer;V=I.byteOffset+(V||0);const B=Q._GetTypedArrayConstructor(`${y}/componentType`,S),d=C.e.GetTypeByteLength(S);return V%d!==0?(T.b.Warn(`${y}: Copying buffer as byte offset (${V}) is not a multiple of component type byte length (${d})`),new B(A.slice(V,V+i*d),0)):new B(A,V,i)}static _GetNumComponents(y,S){switch(S){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${y}: Invalid type (${S})`)}static _ValidateUri(y){return B.Tools.IsBase64(y)||-1===y.indexOf("..")}static _GetDrawMode(y,S){switch(void 0==S&&(S=4),S){case 0:return s.d.PointListDrawMode;case 1:return s.d.LineListDrawMode;case 2:return s.d.LineLoopDrawMode;case 3:return s.d.LineStripDrawMode;case 4:return s.d.TriangleFillMode;case 5:return s.d.TriangleStripDrawMode;case 6:return s.d.TriangleFanDrawMode}throw new Error(`${y}: Invalid mesh primitive mode (${S})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const y=new Array;if(this._gltf.materials)for(const S of this._gltf.materials)if(S._data)for(const I in S._data){const V=S._data[I];for(const S of V.babylonMeshes){S.sd(!0);const I=V.babylonMaterial;y.push(I.forceCompilationAsync(S)),y.push(I.forceCompilationAsync(S,{useInstances:!0})),this._parent.useClipPlane&&(y.push(I.forceCompilationAsync(S,{clipPlane:!0})),y.push(I.forceCompilationAsync(S,{clipPlane:!0,useInstances:!0})))}}return Promise.all(y).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const y=new Array,S=this._babylonScene.lights;for(const I of S){const S=I.getShadowGenerator();S&&y.push(S.forceCompilationAsync())}return Promise.all(y).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(y){for(const S of this._extensions)S.enabled&&y(S)}_applyExtensions(y,S,I){for(const V of this._extensions)if(V.enabled){const i=`${V.name}.${S}`,A=y;A._activeLoaderExtensionFunctions=A._activeLoaderExtensionFunctions||{};const B=A._activeLoaderExtensionFunctions;if(!B[i]){B[i]=!0;try{const y=I(V);if(y)return y}finally{delete B[i]}}}return null}_extensionsOnLoading(){this._forEachExtensions((y=>y.onLoading&&y.onLoading()))}_extensionsOnReady(){this._forEachExtensions((y=>y.onReady&&y.onReady()))}_extensionsLoadSceneAsync(y,S){return this._applyExtensions(S,"loadScene",(I=>I.loadSceneAsync&&I.loadSceneAsync(y,S)))}_extensionsLoadNodeAsync(y,S,I){return this._applyExtensions(S,"loadNode",(V=>V.loadNodeAsync&&V.loadNodeAsync(y,S,I)))}_extensionsLoadCameraAsync(y,S,I){return this._applyExtensions(S,"loadCamera",(V=>V.loadCameraAsync&&V.loadCameraAsync(y,S,I)))}_extensionsLoadVertexDataAsync(y,S,I){return this._applyExtensions(S,"loadVertexData",(V=>V._loadVertexDataAsync&&V._loadVertexDataAsync(y,S,I)))}_extensionsLoadMeshPrimitiveAsync(y,S,I,V,i,A){return this._applyExtensions(i,"loadMeshPrimitive",(B=>B._loadMeshPrimitiveAsync&&B._loadMeshPrimitiveAsync(y,S,I,V,i,A)))}_extensionsLoadMaterialAsync(y,S,I,V,i){return this._applyExtensions(S,"loadMaterial",(A=>A._loadMaterialAsync&&A._loadMaterialAsync(y,S,I,V,i)))}_extensionsCreateMaterial(y,S,I){return this._applyExtensions(S,"createMaterial",(V=>V.createMaterial&&V.createMaterial(y,S,I)))}_extensionsLoadMaterialPropertiesAsync(y,S,I){return this._applyExtensions(S,"loadMaterialProperties",(V=>V.loadMaterialPropertiesAsync&&V.loadMaterialPropertiesAsync(y,S,I)))}_extensionsLoadTextureInfoAsync(y,S,I){return this._applyExtensions(S,"loadTextureInfo",(V=>V.loadTextureInfoAsync&&V.loadTextureInfoAsync(y,S,I)))}_extensionsLoadTextureAsync(y,S,I){return this._applyExtensions(S,"loadTexture",(V=>V._loadTextureAsync&&V._loadTextureAsync(y,S,I)))}_extensionsLoadAnimationAsync(y,S){return this._applyExtensions(S,"loadAnimation",(I=>I.loadAnimationAsync&&I.loadAnimationAsync(y,S)))}_extensionsLoadAnimationChannelAsync(y,S,I,V,i){return this._applyExtensions(I,"loadAnimationChannel",(A=>A._loadAnimationChannelAsync&&A._loadAnimationChannelAsync(y,S,I,V,i)))}_extensionsLoadSkinAsync(y,S,I){return this._applyExtensions(I,"loadSkin",(V=>V._loadSkinAsync&&V._loadSkinAsync(y,S,I)))}_extensionsLoadUriAsync(y,S,I){return this._applyExtensions(S,"loadUri",(V=>V._loadUriAsync&&V._loadUriAsync(y,S,I)))}_extensionsLoadBufferViewAsync(y,S){return this._applyExtensions(S,"loadBufferView",(I=>I.loadBufferViewAsync&&I.loadBufferViewAsync(y,S)))}_extensionsLoadBufferAsync(y,S,I,V){return this._applyExtensions(S,"loadBuffer",(i=>i.loadBufferAsync&&i.loadBufferAsync(y,S,I,V)))}static LoadExtensionAsync(y,S,I,V){if(!S.extensions)return null;const i=S.extensions[I];return i?V(`${y}/extensions/${I}`,i):null}static LoadExtraAsync(y,S,I,V){if(!S.extras)return null;const i=S.extras[I];return i?V(`${y}/extras/${I}`,i):null}isExtensionUsed(y){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(y)}logOpen(y){this._parent._logOpen(y)}logClose(){this._parent._logClose()}log(y){this._parent._log(y)}startPerformanceCounter(y){this._parent._startPerformanceCounter(y)}endPerformanceCounter(y){this._parent._endPerformanceCounter(y)}}Q.DefaultSampler={index:-1},v.c._CreateGLTF2Loader=y=>new Q(y);var c=I(13992),X=I(12511),M=I(12352),t=I(13994),N=I(13999);class Y extends N.d{constructor(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",y),this._texture=y.getEngine().createRawCubeTexture(S,I,V,i,A,B,d,F)}update(y,S,I,V){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,y,S,I,V,i)}updateRGBDAsync(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,t.h)(this._texture,y,S,I,V).then((()=>{}))}clone(){return M.d.Clone((()=>{const y=this.Ey(),S=this._texture,I=new Y(y,S._bufferViewArray,S.width,S.format,S.type,S.generateMipMaps,S.invertY,S.samplingMode,S._compression);return 13===S.source&&I.updateRGBDAsync(S._bufferViewArrayArray,S._sphericalPolynomial,S._lodGenerationScale,S._lodGenerationOffset),I}),this)}}const H="EXT_lights_image_based";class Z{constructor(y){this.name=H,this._loader=y,this.enabled=this._loader.isExtensionUsed(H)}dispose(){this._loader=null,delete this._lights}onLoading(){const y=this._loader.ai.extensions;if(y&&y[this.name]){const S=y[this.name];this._lights=S.lights}}loadSceneAsync(y,S){return Q.LoadExtensionAsync(y,S,this.name,(async(I,V)=>{this._loader._allMaterialsDirtyRequired=!0;const i=new Array;i.push(this._loader.loadSceneAsync(y,S)),this._loader.logOpen(`${I}`);const A=e.Get(`${I}/light`,this._lights,V.Ki);return i.push(this._loadLightAsync(`/extensions/${this.name}/lights/${V.Ki}`,A).then((y=>{this._loader.babylonScene.environmentTexture=y}))),this._loader.logClose(),await Promise.all(i).then((()=>{}))}))}_loadLightAsync(y,S){if(!S._loaded){const I=new Array;this._loader.logOpen(`${y}`);const V=new Array(S.specularImages.length);for(let i=0;i<S.specularImages.length;i++){const A=S.specularImages[i];V[i]=new Array(A.length);for(let S=0;S<A.length;S++){const B=`${y}/specularImages/${i}/${S}`;this._loader.logOpen(`${B}`);const d=A[S],F=e.Get(B,this._loader.ai.images,d);I.push(this._loader.loadImageAsync(`/images/${d}`,F).then((y=>{V[i][S]=y}))),this._loader.logClose()}}this._loader.logClose(),S._loaded=Promise.all(I).then((async()=>{const I=new Y(this._loader.babylonScene,null,S.specularImageSize);if(I.name=S.name||"environment",S._babylonTexture=I,void 0!=S.Rd&&(I.level=S.Rd),S.rotation){let y=i.Quaternion.oS(S.rotation);this._loader.babylonScene.useRightHandedSystem||(y=i.Quaternion.Inverse(y)),i.Matrix.FromQuaternionToRef(y,I.getReflectionTextureMatrix())}if(!S.irradianceCoefficients)throw new Error(`${y}: Irradiance coefficients are missing`);const A=X.e.oS(S.irradianceCoefficients);A.scaleInPlace(S.Rd),A.convertIrradianceToLambertianRadiance();const B=X.h.FromHarmonics(A),d=(V.length-1)/Math.log2(S.specularImageSize);return await I.updateRGBDAsync(V,B,d)}))}return S._loaded.then((()=>S._babylonTexture))}}b(H),R(H,!0,(y=>new Z(y)));I(12874);const w="EXT_mesh_gpu_instancing";class yy{constructor(y){this.name=w,this._loader=y,this.enabled=this._loader.isExtensionUsed(w)}dispose(){this._loader=null}loadNodeAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(y,V)=>{this._loader._disableInstancedMesh++;const A=this._loader.loadNodeAsync(`/nodes/${S.index}`,S,I);if(this._loader._disableInstancedMesh--,!S._primitiveBabylonMeshes)return await A;const B=new Array;let d=0;const F=S=>{if(void 0==V.attributes[S])return void B.push(Promise.resolve(null));const I=e.Get(`${y}/attributes/${S}`,this._loader.ai.accessors,V.attributes[S]);if(B.push(this._loader._loadFloatAccessorAsync(`/accessors/${I.bufferView}`,I)),0===d)d=I.count;else if(d!==I.count)throw new Error(`${y}/attributes: Instance buffer accessors do not have the same count.`)};return F("TRANSLATION"),F("ROTATION"),F("SCALE"),await A.then((async y=>{const[I,V,A]=await Promise.all(B),F=new Float32Array(16*d);i.TmpVectors.OS[0].od(0,0,0),i.TmpVectors.Quaternion[0].od(0,0,0,1),i.TmpVectors.OS[1].od(1,1,1);for(let S=0;S<d;++S)I&&i.OS.FromArrayToRef(I,3*S,i.TmpVectors.OS[0]),V&&i.Quaternion.FromArrayToRef(V,4*S,i.TmpVectors.Quaternion[0]),A&&i.OS.FromArrayToRef(A,3*S,i.TmpVectors.OS[1]),i.Matrix.ComposeToRef(i.TmpVectors.OS[1],i.TmpVectors.Quaternion[0],i.TmpVectors.OS[0],i.TmpVectors.Matrix[0]),i.TmpVectors.Matrix[0].copyToArray(F,16*S);for(const i of S._primitiveBabylonMeshes)i.rK("matrix",F,16,!0);return y}))}))}}b(w),R(w,!0,(y=>new yy(y)));let Sy=0,Iy=null;class Vy{static get Default(){return Vy._Default||(Vy._Default=new Vy),Vy._Default}constructor(){const y=Vy.Configuration.decoder;this._decoderModulePromise=B.Tools.LoadBabylonScriptAsync(y.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(y,S,I,V,i){await this._decoderModulePromise,0===Sy&&(MeshoptDecoder.useWorkers(1),Sy=1);const A=await MeshoptDecoder.decodeGltfBufferAsync(S,I,y,V,i);return null!==Iy&&clearTimeout(Iy),Iy=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Sy=0,Iy=null}),1e3),A}}Vy.Configuration={decoder:{url:`${B.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Vy._Default=null;const iy="EXT_meshopt_compression";class Ay{constructor(y){this.name=iy,this.enabled=y.isExtensionUsed(iy),this._loader=y}dispose(){this._loader=null}loadBufferViewAsync(y,S){return Q.LoadExtensionAsync(y,S,this.name,(async(I,V)=>{const i=S;if(i._meshOptData)return await i._meshOptData;const A=e.Get(`${y}/buffer`,this._loader.ai.buffers,V.buffer);return i._meshOptData=this._loader.loadBufferAsync(`/buffers/${A.index}`,A,V.byteOffset||0,V.byteLength).then((async y=>await Vy.Default.decodeGltfBufferAsync(y,V.count,V.byteStride,V.mode,V.filter))),await i._meshOptData}))}}b(iy),R(iy,!0,(y=>new Ay(y)));const By="EXT_texture_webp";class dy{constructor(y){this.name=By,this._loader=y,this.enabled=y.isExtensionUsed(By)}dispose(){this._loader=null}_loadTextureAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=void 0==S.sampler?Q.DefaultSampler:e.Get(`${y}/sampler`,this._loader.ai.samplers,S.sampler),B=e.Get(`${V}/source`,this._loader.ai.images,i.source);return await this._loader._createTextureAsync(y,A,B,(y=>{I(y)}),void 0,!S._textureInfo.nonColorData)}))}}b(By),R(By,!0,(y=>new dy(y)));const Fy="EXT_texture_avif";class Jy{constructor(y){this.name=Fy,this._loader=y,this.enabled=y.isExtensionUsed(Fy)}dispose(){this._loader=null}_loadTextureAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=void 0==S.sampler?Q.DefaultSampler:e.Get(`${y}/sampler`,this._loader.ai.samplers,S.sampler),B=e.Get(`${V}/source`,this._loader.ai.images,i.source);return await this._loader._createTextureAsync(y,A,B,(y=>{I(y)}),void 0,!S._textureInfo.nonColorData)}))}}b(Fy),R(Fy,!0,(y=>new Jy(y)));var uy=I(13986),Ky=I(12857);const Gy="EXT_lights_ies";class py{constructor(y){this.name=Gy,this._loader=y,this.enabled=this._loader.isExtensionUsed(Gy)}dispose(){this._loader=null,delete this._lights}onLoading(){const y=this._loader.ai.extensions;if(y&&y[this.name]){const S=y[this.name];this._lights=S.lights,e.Assign(this._lights)}}loadNodeAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,B)=>{let d,F;this._loader._allMaterialsDirtyRequired=!0;const J=await this._loader.loadNodeAsync(y,S,(y=>{F=e.Get(V,this._lights,B.Ki);const S=F.name||y.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,d=new uy.b(S,i.OS.Zero(),i.OS.Backward(),0,1,this._loader.babylonScene),d.angle=Math.PI/2,d.innerAngle=0,d._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,F._babylonLight=d,d.falloffType=Ky.e.FALLOFF_GLTF,d.bd=B.color?A.DS.oS(B.color):A.DS.White(),d.Rd=B.multiplier||1,d.range=Number.MAX_VALUE,d.parent=y,this._loader._babylonLights.push(d),Q.AddPointerMetadata(d,V),I(y)}));let u;if(F.uri)u=await this._loader.loadUriAsync(y,F,F.uri);else{const S=e.Get(`${y}/bufferView`,this._loader.ai.bufferViews,F.bufferView);u=await this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}return d.iesProfileTexture=new f.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,u,!0,void 0,void 0,void 0,void 0,".ies"),J}))}}b(Gy),R(Gy,!0,(y=>new py(y)));var Ly=I(14003);const Ty="KHR_draco_mesh_compression";class ly{constructor(y){this.name=Ty,this.useNormalizedFlagFromAccessor=!0,this._loader=y,this.enabled=Ly.b.DefaultAvailable&&this._loader.isExtensionUsed(Ty)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{if(void 0!=S.mode&&4!==S.mode&&5!==S.mode)throw new Error(`${y}: Unsupported mode ${S.mode}`);const A={},B={},d=(y,V)=>{const d=i.attributes[y];if(void 0!=d&&(I._delayInfo=I._delayInfo||[],-1===I._delayInfo.indexOf(V)&&I._delayInfo.push(V),A[V]=d,this.useNormalizedFlagFromAccessor)){const I=e.TryGet(this._loader.ai.accessors,S.attributes[y]);I&&(B[V]=I.normalized||!1)}};d("POSITION",C.e.PositionKind),d("NORMAL",C.e.NormalKind),d("TANGENT",C.e.TangentKind),d("TEXCOORD_0",C.e.UVKind),d("TEXCOORD_1",C.e.UV2Kind),d("TEXCOORD_2",C.e.UV3Kind),d("TEXCOORD_3",C.e.UV4Kind),d("TEXCOORD_4",C.e.UV5Kind),d("TEXCOORD_5",C.e.UV6Kind),d("JOINTS_0",C.e.MatricesIndicesKind),d("WEIGHTS_0",C.e.MatricesWeightsKind),d("COLOR_0",C.e.ColorKind);const F=e.Get(V,this._loader.ai.bufferViews,i.bufferView);return F._dracoBabylonGeometry||(F._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((async V=>{const i=this.dracoDecoder||Ly.b.Default,d=e.TryGet(this._loader.ai.accessors,S.attributes.POSITION),F=this._loader.parent.alwaysComputeBoundingBox||I.skeleton||!d?null:x(d);return await i._decodeMeshToGeometryForGltfAsync(I.name,this._loader.babylonScene,V,A,B,F).catch((S=>{throw new Error(`${y}: ${S.message}`)}))}))),await F._dracoBabylonGeometry}))}}b(Ty),R(Ty,!0,(y=>new ly(y)));var jy=I(14010),sy=I(12306),Oy=I(12309),fy=I(12725),mS=I(12919),Cy=I(12282);fy.b.AddNodeConstructor("Light_Type_0",((y,S)=>()=>new Dy(y,i.OS.Zero(),S)));class Dy extends mS.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(y){this._shadowAngle=y,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(y){const S=this.needCube();if(this._direction=y,this.needCube()!==S&&this._shadowGenerators){const y=this._shadowGenerators.values();for(let S=y.next();!0!==S.done;S=y.next()){S.value.recreateShadowMap()}}}constructor(y,S,I){super(y,I),this._shadowAngle=Math.PI/2,this.position=S}getClassName(){return"PointLight"}getTypeID(){return Ky.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(y){if(this.direction)return super.getShadowDirection(y);switch(y){case 0:return new i.OS(1,0,0);case 1:return new i.OS(-1,0,0);case 2:return new i.OS(0,-1,0);case 3:return new i.OS(0,1,0);case 4:return new i.OS(0,0,1);case 5:return new i.OS(0,0,-1)}return i.OS.Zero()}_setDefaultShadowProjectionMatrix(y,S,I){const V=this.Ey().activeCamera;if(!V)return;const A=void 0!==this.shadowMinZ?this.shadowMinZ:V.Ld,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ,d=this.Ey().getEngine().si;i.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,d?B:A,d?A:B,y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,d)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(y,S){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,S):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,S),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,S),this}transferToNodeMaterialEffect(y,S){return this.computeTransformedInformation()?y.setFloat3(S,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):y.setFloat3(S,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(y,S){y["POINTLIGHT"+S]=!0}}(0,sy.c)([(0,Oy.E)()],Dy.prototype,"shadowAngle",null),(0,Cy.e)("BABYLON.PointLight",Dy);const oy="KHR_lights_punctual";class Ey{constructor(y){this.name=oy,this._loader=y,this.enabled=this._loader.isExtensionUsed(oy)}dispose(){this._loader=null,delete this._lights}onLoading(){const y=this._loader.ai.extensions;if(y&&y[this.name]){const S=y[this.name];this._lights=S.lights,e.Assign(this._lights)}}loadNodeAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,B)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(y,S,(y=>{let S;const d=e.Get(V,this._lights,B.Ki),F=d.name||y.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,d.type){case"directional":{const y=new jy.b(F,i.OS.Backward(),this._loader.babylonScene);y.position.nd(0),S=y;break}case"point":S=new Dy(F,i.OS.Zero(),this._loader.babylonScene);break;case"spot":{const y=new uy.b(F,i.OS.Zero(),i.OS.Backward(),0,1,this._loader.babylonScene);y.angle=2*(d.spot&&d.spot.outerConeAngle||Math.PI/4),y.innerAngle=2*(d.spot&&d.spot.innerConeAngle||0),S=y;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${V}: Invalid light type (${d.type})`)}S._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,d._babylonLight=S,S.falloffType=Ky.e.FALLOFF_GLTF,S.bd=d.color?A.DS.oS(d.color):A.DS.White(),S.Rd=void 0==d.Rd?1:d.Rd,S.range=void 0==d.range?Number.MAX_VALUE:d.range,S.parent=y,this._loader._babylonLights.push(S),Q.AddPointerMetadata(S,V),I(y)})))))}}b(oy),R(oy,!0,(y=>new Ey(y)));const zy="KHR_materials_pbrSpecularGlossiness";class ry{constructor(y){this.name=zy,this.order=200,this._loader=y,this.enabled=this._loader.isExtensionUsed(zy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialBasePropertiesAsync(y,S,I)),A.push(this._loadSpecularGlossinessPropertiesAsync(V,i,I)),this._loader.loadMaterialAlphaProperties(y,S,I),await Promise.all(A).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;return I.metallic=null,I.roughness=null,S.diffuseFactor?(I.albedoColor=A.DS.oS(S.diffuseFactor),I.alpha=S.diffuseFactor[3]):I.albedoColor=A.DS.White(),I.reflectivityColor=S.specularFactor?A.DS.oS(S.specularFactor):A.DS.White(),I.microSurface=void 0==S.glossinessFactor?1:S.glossinessFactor,S.diffuseTexture&&V.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTexture`,S.diffuseTexture,(y=>{y.name=`${I.name} (Diffuse)`,I.albedoTexture=y}))),S.specularGlossinessTexture&&(V.push(this._loader.loadTextureInfoAsync(`${y}/specularGlossinessTexture`,S.specularGlossinessTexture,(y=>{y.name=`${I.name} (Specular Glossiness)`,I.reflectivityTexture=y,I.reflectivityTexture.Fd=!0}))),I.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(V).then((()=>{}))}}b(zy),R(zy,!0,(y=>new ry(y)));const hy="KHR_materials_unlit";class ny{constructor(y){this.name=hy,this.order=210,this._loader=y,this.enabled=this._loader.isExtensionUsed(hy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async()=>await this._loadUnlitPropertiesAsync(y,S,I)))}_loadUnlitPropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;I.unlit=!0;const i=S.pbrMetallicRoughness;return i&&(i.baseColorFactor?(I.albedoColor=A.DS.oS(i.baseColorFactor),I.alpha=i.baseColorFactor[3]):I.albedoColor=A.DS.White(),i.baseColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${y}/baseColorTexture`,i.baseColorTexture,(y=>{y.name=`${I.name} (Base Color)`,I.albedoTexture=y})))),S.doubleSided&&(I.Dd=!1,I.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(y,S,I),Promise.all(V).then((()=>{}))}}b(hy),R(hy,!0,(y=>new ny(y)));const vy="KHR_materials_clearcoat";class Py{constructor(y){this.name=vy,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(vy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadClearCoatPropertiesAsync(V,i,I)),await Promise.all(A)}))}_loadClearCoatPropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;return I.clearCoat.isEnabled=!0,I.clearCoat.useRoughnessFromMainTexture=!1,I.clearCoat.remapF0OnInterfaceChange=!1,void 0!=S.clearcoatFactor?I.clearCoat.Rd=S.clearcoatFactor:I.clearCoat.Rd=0,S.clearcoatTexture&&V.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatTexture`,S.clearcoatTexture,(y=>{y.name=`${I.name} (ClearCoat)`,I.clearCoat.texture=y}))),void 0!=S.clearcoatRoughnessFactor?I.clearCoat.roughness=S.clearcoatRoughnessFactor:I.clearCoat.roughness=0,S.clearcoatRoughnessTexture&&(S.clearcoatRoughnessTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatRoughnessTexture`,S.clearcoatRoughnessTexture,(y=>{y.name=`${I.name} (ClearCoat Roughness)`,I.clearCoat.textureRoughness=y})))),S.clearcoatNormalTexture&&(S.clearcoatNormalTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatNormalTexture`,S.clearcoatNormalTexture,(y=>{y.name=`${I.name} (ClearCoat Normal)`,I.clearCoat.bumpTexture=y}))),I.invertNormalMapX=!I.Ey().useRightHandedSystem,I.invertNormalMapY=I.Ey().useRightHandedSystem,void 0!=S.clearcoatNormalTexture.scale&&(I.clearCoat.bumpTexture.level=S.clearcoatNormalTexture.scale)),Promise.all(V).then((()=>{}))}}b(vy),R(vy,!0,(y=>new Py(y)));const qy="KHR_materials_iridescence";class gy{constructor(y){this.name=qy,this.order=195,this._loader=y,this.enabled=this._loader.isExtensionUsed(qy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadIridescencePropertiesAsync(V,i,I)),await Promise.all(A).then((()=>{}))}))}_loadIridescencePropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;return I.iridescence.isEnabled=!0,I.iridescence.Rd=S.iridescenceFactor??0,I.iridescence.indexOfRefraction=S.iridescenceIor??S.iridescenceIOR??1.3,I.iridescence.minimumThickness=S.iridescenceThicknessMinimum??100,I.iridescence.maximumThickness=S.iridescenceThicknessMaximum??400,S.iridescenceTexture&&V.push(this._loader.loadTextureInfoAsync(`${y}/iridescenceTexture`,S.iridescenceTexture,(y=>{y.name=`${I.name} (Iridescence)`,I.iridescence.texture=y}))),S.iridescenceThicknessTexture&&V.push(this._loader.loadTextureInfoAsync(`${y}/iridescenceThicknessTexture`,S.iridescenceThicknessTexture,(y=>{y.name=`${I.name} (Iridescence Thickness)`,I.iridescence.thicknessTexture=y}))),Promise.all(V).then((()=>{}))}}b(qy),R(qy,!0,(y=>new gy(y)));const ky="KHR_materials_anisotropy";class Ry{constructor(y){this.name=ky,this.order=195,this._loader=y,this.enabled=this._loader.isExtensionUsed(ky)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadIridescencePropertiesAsync(V,i,I)),await Promise.all(A)}))}async _loadIridescencePropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;I.anisotropy.isEnabled=!0,I.anisotropy.Rd=S.anisotropyStrength??0,I.anisotropy.angle=S.anisotropyRotation??0,S.anisotropyTexture&&(S.anisotropyTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${y}/anisotropyTexture`,S.anisotropyTexture,(y=>{y.name=`${I.name} (Anisotropy Intensity)`,I.anisotropy.texture=y})))),await Promise.all(V)}}b(ky),R(ky,!0,(y=>new Ry(y)));const by="KHR_materials_emissive_strength";class Uy{constructor(y){this.name=by,this.order=170,this._loader=y,this.enabled=this._loader.isExtensionUsed(by)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>await this._loader.loadMaterialPropertiesAsync(y,S,I).then((()=>{this._loadEmissiveProperties(V,i,I)}))))}_loadEmissiveProperties(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);void 0!==S.emissiveStrength&&(I.emissiveIntensity=S.emissiveStrength)}}b(by),R(by,!0,(y=>new Uy(y)));const Wy="KHR_materials_sheen";class ay{constructor(y){this.name=Wy,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(Wy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadSheenPropertiesAsync(V,i,I)),await Promise.all(A).then((()=>{}))}))}_loadSheenPropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;return I.sheen.isEnabled=!0,I.sheen.Rd=1,void 0!=S.sheenColorFactor?I.sheen.color=A.DS.oS(S.sheenColorFactor):I.sheen.color=A.DS.Black(),S.sheenColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${y}/sheenColorTexture`,S.sheenColorTexture,(y=>{y.name=`${I.name} (Sheen Color)`,I.sheen.texture=y}))),void 0!==S.sheenRoughnessFactor?I.sheen.roughness=S.sheenRoughnessFactor:I.sheen.roughness=0,S.sheenRoughnessTexture&&(S.sheenRoughnessTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${y}/sheenRoughnessTexture`,S.sheenRoughnessTexture,(y=>{y.name=`${I.name} (Sheen Roughness)`,I.sheen.textureRoughness=y})))),I.sheen.albedoScaling=!0,I.sheen.useRoughnessFromMainTexture=!1,Promise.all(V).then((()=>{}))}}b(Wy),R(Wy,!0,(y=>new ay(y)));var ey=I(12789);const xy="KHR_materials_specular";class Qy{constructor(y){this.name=xy,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(xy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;if(A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadSpecularPropertiesAsync(V,i,I)),i.extensions&&i.extensions.EXT_materials_specular_edge_color&&I instanceof O.d){i.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(I.brdf.dielectricSpecularModel=ey.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,I.brdf.conductorSpecularModel=ey.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(A).then((()=>{}))}))}_loadSpecularPropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;return void 0!==S.specularFactor&&(I.metallicF0Factor=S.specularFactor),void 0!==S.specularColorFactor&&(I.metallicReflectanceColor=A.DS.oS(S.specularColorFactor)),S.specularTexture&&(S.specularTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${y}/specularTexture`,S.specularTexture,(y=>{y.name=`${I.name} (Specular)`,I.metallicReflectanceTexture=y,I.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),S.specularColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${y}/specularColorTexture`,S.specularColorTexture,(y=>{y.name=`${I.name} (Specular Color)`,I.reflectanceTexture=y}))),Promise.all(V).then((()=>{}))}}b(xy),R(xy,!0,(y=>new Qy(y)));const cy="KHR_materials_ior";class Xy{constructor(y){this.name=cy,this.order=180,this._loader=y,this.enabled=this._loader.isExtensionUsed(cy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadIorPropertiesAsync(V,i,I)),await Promise.all(A).then((()=>{}))}))}_loadIorPropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);return void 0!==S.ior?I.indexOfRefraction=S.ior:I.indexOfRefraction=Xy._DEFAULT_IOR,Promise.resolve()}}Xy._DEFAULT_IOR=1.5,b(cy),R(cy,!0,(y=>new Xy(y)));const My="KHR_materials_variants";class ty{constructor(y){this.name=My,this._loader=y,this.enabled=this._loader.isExtensionUsed(My)}dispose(){this._loader=null}static GetAvailableVariants(y){const S=this._GetExtensionMetadata(y);return S?Object.keys(S.variants):[]}getAvailableVariants(y){return ty.GetAvailableVariants(y)}static SelectVariant(y,S){const I=this._GetExtensionMetadata(y);if(!I)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${My} extension`);const V=y=>{const S=I.variants[y];if(S)for(const I of S)I.mesh.material=I.material};if(S instanceof Array)for(const i of S)V(i);else V(S);I.lastSelected=S}selectVariant(y,S){ty.SelectVariant(y,S)}static Reset(y){const S=this._GetExtensionMetadata(y);if(!S)throw new Error(`Cannot reset on a glTF mesh that does not have the ${My} extension`);for(const I of S.original)I.mesh.material=I.material;S.lastSelected=null}reset(y){ty.Reset(y)}static GetLastSelectedVariant(y){const S=this._GetExtensionMetadata(y);if(!S)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${My} extension`);return S.lastSelected}getLastSelectedVariant(y){return ty.GetLastSelectedVariant(y)}static _GetExtensionMetadata(y){var S,I;return(null===y||void 0===y||null===(S=y._internalMetadata)||void 0===S||null===(I=S.ai)||void 0===I?void 0:I[My])||null}onLoading(){const y=this._loader.ai.extensions;if(y&&y[this.name]){const S=y[this.name];this._variants=S.variants}}onReady(){const y=this._loader.rootBabylonMesh;if(y){var S;const I=this._loader.parent.extensionOptions[My];null!==I&&void 0!==I&&I.defaultVariant&&ty.SelectVariant(y,I.defaultVariant),null===I||void 0===I||null===(S=I.onLoaded)||void 0===S||S.call(I,{get variants(){return ty.GetAvailableVariants(y)},get selectedVariant(){const S=ty.GetLastSelectedVariant(y);return S?Array.isArray(S)?S[0]:S:ty.GetAvailableVariants(y)[0]},set selectedVariant(S){ty.SelectVariant(y,S)}})}}_loadMeshPrimitiveAsync(y,S,I,V,i,A){return Q.LoadExtensionAsync(y,i,this.name,(async(B,d)=>{const F=new Array;return F.push(this._loader._loadMeshPrimitiveAsync(y,S,I,V,i,(S=>{if(A(S),S instanceof E.c){const I=Q._GetDrawMode(y,i.mode),V=this._loader.rootBabylonMesh,A=V?V._internalMetadata=V._internalMetadata||{}:{},J=A.ai=A.ai||{},u=J[My]=J[My]||{lastSelected:null,original:[],variants:{}};u.original.push({mesh:S,material:S.material});for(let y=0;y<d.mappings.length;++y){const i=d.mappings[y],A=e.Get(`${B}/mappings/${y}/material`,this._loader.ai.materials,i.material);F.push(this._loader._loadMaterialAsync(`#/materials/${i.material}`,A,S,I,(y=>{for(let I=0;I<i.variants.length;++I){const A=i.variants[I],B=e.Get(`/extensions/${My}/variants/${A}`,this._variants,A);u.variants[B.name]=u.variants[B.name]||[],u.variants[B.name].push({mesh:S,material:y}),S.onClonedObservable.add((y=>{const I=y;let i=null,A=I;do{if(A=A.parent,!A)return;i=ty._GetExtensionMetadata(A)}while(null===i);if(V&&i===ty._GetExtensionMetadata(V)){A._internalMetadata={};for(const y in V._internalMetadata)A._internalMetadata[y]=V._internalMetadata[y];A._internalMetadata.ai=[];for(const y in V._internalMetadata.ai)A._internalMetadata.ai[y]=V._internalMetadata.ai[y];A._internalMetadata.ai[My]={lastSelected:null,original:[],variants:{}};for(const y of i.original)A._internalMetadata.ai[My].original.push({mesh:y.mesh,material:y.material});for(const y in i.variants)if(Object.prototype.hasOwnProperty.call(i.variants,y)){A._internalMetadata.ai[My].variants[y]=[];for(const S of i.variants[y])A._internalMetadata.ai[My].variants[y].push({mesh:S.mesh,material:S.material})}i=A._internalMetadata.ai[My]}for(const V of i.original)V.mesh===S&&(V.mesh=I);for(const V of i.variants[B.name])V.mesh===S&&(V.mesh=I)}))}})))}}}))),await Promise.all(F).then((y=>{let[S]=y;return S}))}))}}b(My),R(My,!0,(y=>new ty(y)));var Ny=I(12382);class Yy{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:ey.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(y,S){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Yy._GetDefaultOptions(),...y},this._scene=S,this._scene._transmissionHelper=this,this.onErrorObservable=new u.b,this._scene.zi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(y){if(!Object.keys(y).filter((S=>this._options[S]!==y[S])).length)return;const S={...this._options,...y},I=this._options;this._options=S,S.renderSize===I.renderSize&&S.renderTargetTextureType===I.renderTargetTextureType&&S.generateMipmaps===I.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=S.samples,this._opaqueRenderTarget.lodGenerationScale=S.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=S.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(y){return!!y&&!!(y instanceof O.d&&y.subSurface.isRefractionEnabled)}_addMesh(y){this._materialObservers[y.uniqueId]=y.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),B.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(y.material)?(y.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(y)&&this._transparentMeshesCache.push(y)):-1===this._opaqueMeshesCache.indexOf(y)&&this._opaqueMeshesCache.push(y)}))}_removeMesh(y){y.onMaterialChangedObservable.remove(this._materialObservers[y.uniqueId]),delete this._materialObservers[y.uniqueId];let S=this._transparentMeshesCache.indexOf(y);-1!==S&&this._transparentMeshesCache.splice(S,1),S=this._opaqueMeshesCache.indexOf(y),-1!==S&&this._opaqueMeshesCache.splice(S,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(y){const S=this._transparentMeshesCache.indexOf(y),I=this._opaqueMeshesCache.indexOf(y);this._shouldRenderAsTransmission(y.material)?(y.material instanceof O.d&&(y.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==I?(this._opaqueMeshesCache.splice(I,1),this._transparentMeshesCache.push(y)):-1===S&&this._transparentMeshesCache.push(y)):-1!==S?(this._transparentMeshesCache.splice(S,1),this._opaqueMeshesCache.push(y)):-1===I&&this._opaqueMeshesCache.push(y)}_isRenderTargetValid(){var y;return null!==(null===(y=this._opaqueRenderTarget)||void 0===y?void 0:y.getInternalTexture())}_setupRenderTargets(){var y;let S;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Ny.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(y=this._options.clearColor)||void 0===y?void 0:y.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((y=>{S=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?y.clearColor.A(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(y.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=S}));for(const I of this._transparentMeshesCache)this._shouldRenderAsTransmission(I.material)&&(I.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Hy="KHR_materials_transmission";class Zy{constructor(y){this.name=Hy,this.order=175,this._loader=y,this.enabled=this._loader.isExtensionUsed(Hy),this.enabled&&(y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadTransparentPropertiesAsync(V,S,I,i)),await Promise.all(A).then((()=>{}))}))}_loadTransparentPropertiesAsync(y,S,I,V){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const i=I;if(i.subSurface.isRefractionEnabled=!0,i.subSurface.volumeIndexOfRefraction=1,i.subSurface.useAlbedoToTintRefraction=!0,void 0===V.transmissionFactor)return i.subSurface.refractionIntensity=0,i.subSurface.isRefractionEnabled=!1,Promise.resolve();{var A;i.subSurface.refractionIntensity=V.transmissionFactor;const y=i.Ey();if(i.subSurface.refractionIntensity&&!y._transmissionHelper)new Yy({},i.Ey());else if(i.subSurface.refractionIntensity&&(null===(A=y._transmissionHelper)||void 0===A||!A._isRenderTargetValid())){var B;null===(B=y._transmissionHelper)||void 0===B||B._setupRenderTargets()}}return i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=0,V.transmissionTexture?(V.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${y}/transmissionTexture`,V.transmissionTexture,void 0).then((y=>{y.name=`${I.name} (Transmission)`,i.subSurface.refractionIntensityTexture=y,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}b(Hy),R(Hy,!0,(y=>new Zy(y)));const wy="KHR_materials_diffuse_transmission";class yS{constructor(y){this.name=wy,this.order=174,this._loader=y,this.enabled=this._loader.isExtensionUsed(wy),this.enabled&&(y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadTranslucentPropertiesAsync(V,S,I,i)),await Promise.all(A).then((()=>{}))}))}_loadTranslucentPropertiesAsync(y,S,I,V){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const i=I;if(i.subSurface.isTranslucencyEnabled=!0,i.subSurface.volumeIndexOfRefraction=1,i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=0,i.subSurface.useAlbedoToTintTranslucency=!1,void 0===V.diffuseTransmissionFactor)return i.subSurface.translucencyIntensity=0,i.subSurface.isTranslucencyEnabled=!1,Promise.resolve();i.subSurface.translucencyIntensity=V.diffuseTransmissionFactor;const B=new Array;return i.subSurface.useGltfStyleTextures=!0,V.diffuseTransmissionTexture&&(V.diffuseTransmissionTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTransmissionTexture`,V.diffuseTransmissionTexture).then((y=>{y.name=`${I.name} (Diffuse Transmission)`,i.subSurface.translucencyIntensityTexture=y})))),void 0!==V.diffuseTransmissionColorFactor?i.subSurface.translucencyColor=A.DS.oS(V.diffuseTransmissionColorFactor):i.subSurface.translucencyColor=A.DS.White(),V.diffuseTransmissionColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTransmissionColorTexture`,V.diffuseTransmissionColorTexture).then((y=>{y.name=`${I.name} (Diffuse Transmission Color)`,i.subSurface.translucencyColorTexture=y}))),Promise.all(B).then((()=>{}))}}b(wy),R(wy,!0,(y=>new yS(y)));const SS="KHR_materials_volume";class IS{constructor(y){this.name=SS,this.order=173,this._loader=y,this.enabled=this._loader.isExtensionUsed(SS),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadVolumePropertiesAsync(V,S,I,i)),await Promise.all(A).then((()=>{}))}))}_loadVolumePropertiesAsync(y,S,I,V){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);if(!I.subSurface.isRefractionEnabled&&!I.subSurface.isTranslucencyEnabled||!V.thicknessFactor)return Promise.resolve();I.subSurface.volumeIndexOfRefraction=I.indexOfRefraction;const i=void 0!==V.attenuationDistance?V.attenuationDistance:Number.MAX_VALUE;return I.subSurface.tintColorAtDistance=i,void 0!==V.attenuationColor&&3==V.attenuationColor.length&&I.subSurface.tintColor.od(V.attenuationColor[0],V.attenuationColor[1],V.attenuationColor[2]),I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=V.thicknessFactor,I.subSurface.useThicknessAsDepth=!0,V.thicknessTexture?(V.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${y}/thicknessTexture`,V.thicknessTexture).then((y=>{y.name=`${I.name} (Thickness)`,I.subSurface.thicknessTexture=y,I.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}b(SS),R(SS,!0,(y=>new IS(y)));const VS="KHR_materials_dispersion";class iS{constructor(y){this.name=VS,this.order=174,this._loader=y,this.enabled=this._loader.isExtensionUsed(VS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadDispersionPropertiesAsync(V,S,I,i)),await Promise.all(A).then((()=>{}))}))}_loadDispersionPropertiesAsync(y,S,I,V){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);return I.subSurface.isRefractionEnabled&&V.dispersion?(I.subSurface.isDispersionEnabled=!0,I.subSurface.dispersion=V.dispersion,Promise.resolve()):Promise.resolve()}}b(VS),R(VS,!0,(y=>new iS(y)));const AS="EXT_materials_diffuse_roughness";class BS{constructor(y){this.name=AS,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(AS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(y,S,I)),A.push(this._loadDiffuseRoughnessPropertiesAsync(V,i,I)),await Promise.all(A).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(y,S,I){if(!(I instanceof O.d))throw new Error(`${y}: Material type not supported`);const V=new Array;return I.brdf.baseDiffuseModel=ey.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=S.diffuseRoughnessFactor?I.baseDiffuseRoughness=S.diffuseRoughnessFactor:I.baseDiffuseRoughness=0,S.diffuseRoughnessTexture&&V.push(this._loader.loadTextureInfoAsync(`${y}/diffuseRoughnessTexture`,S.diffuseRoughnessTexture,(y=>{y.name=`${I.name} (Diffuse Roughness)`,I.baseDiffuseRoughnessTexture=y}))),Promise.all(V).then((()=>{}))}}b(AS),R(AS,!0,(y=>new BS(y)));const dS="KHR_mesh_quantization";class FS{constructor(y){this.name=dS,this.enabled=y.isExtensionUsed(dS)}dispose(){}}b(dS),R(dS,!0,(y=>new FS(y)));const JS="KHR_texture_basisu";class uS{constructor(y){this.name=JS,this._loader=y,this.enabled=y.isExtensionUsed(JS)}dispose(){this._loader=null}_loadTextureAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>{const A=void 0==S.sampler?Q.DefaultSampler:e.Get(`${y}/sampler`,this._loader.ai.samplers,S.sampler),B=e.Get(`${V}/source`,this._loader.ai.images,i.source);return await this._loader._createTextureAsync(y,A,B,(y=>{I(y)}),S._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!S._textureInfo.nonColorData)}))}}b(JS),R(JS,!0,(y=>new uS(y)));const KS="KHR_texture_transform";class GS{constructor(y){this.name=KS,this._loader=y,this.enabled=this._loader.isExtensionUsed(KS)}dispose(){this._loader=null}loadTextureInfoAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(V,i)=>await this._loader.loadTextureInfoAsync(y,S,(y=>{if(!(y instanceof f.e))throw new Error(`${V}: Texture type not supported`);i.offset&&(y.uOffset=i.offset[0],y.vOffset=i.offset[1]),y.uRotationCenter=0,y.vRotationCenter=0,i.rotation&&(y.wAng=-i.rotation),i.scale&&(y.uScale=i.scale[0],y.vScale=i.scale[1]),void 0!=i.texCoord&&(y.coordinatesIndex=i.texCoord),I(y)}))))}}b(KS),R(KS,!0,(y=>new GS(y)));const pS="KHR_xmp_json_ld";class LS{constructor(y){this.name=pS,this.order=100,this._loader=y,this.enabled=this._loader.isExtensionUsed(pS)}dispose(){this._loader=null}onLoading(){var y,S,I;if(null===this._loader.rootBabylonMesh)return;const V=null===(y=this._loader.ai.extensions)||void 0===y?void 0:y.KHR_xmp_json_ld,i=null===(S=this._loader.ai.asset)||void 0===S||null===(I=S.extensions)||void 0===I?void 0:I.KHR_xmp_json_ld;if(V&&i){const y=+i.packet;V.packets&&y<V.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=V.packets[y])}}}function TS(y,S,I,V){return A.DS.oS(S,I).scale(V)}function lS(y,S,I,V){return S[I]*V}function jS(y,S,I,V){return-S[I]*V}function sS(y,S,I,V){return S[I+1]*V}function OS(y,S,I,V){return S[I]*V*2}function fS(y){return{scale:[new CS(G.b.ANIMATIONTYPE_FLOAT,`${y}.uScale`,lS,(()=>2)),new CS(G.b.ANIMATIONTYPE_FLOAT,`${y}.vScale`,sS,(()=>2))],offset:[new CS(G.b.ANIMATIONTYPE_FLOAT,`${y}.uOffset`,lS,(()=>2)),new CS(G.b.ANIMATIONTYPE_FLOAT,`${y}.vOffset`,sS,(()=>2))],rotation:[new CS(G.b.ANIMATIONTYPE_FLOAT,`${y}.wAng`,jS,(()=>1))]}}b(pS),R(pS,!0,(y=>new LS(y)));class mI extends c.AnimationPropertyInfo{buildAnimations(y,S,I,V){return[{babylonAnimatable:y._babylonCamera,babylonAnimation:this._buildAnimation(S,I,V)}]}}class CS extends c.AnimationPropertyInfo{buildAnimations(y,S,I,V){const i=[];for(const A in y._data)i.push({babylonAnimatable:y._data[A].babylonMaterial,babylonAnimation:this._buildAnimation(S,I,V)});return i}}class DS extends c.AnimationPropertyInfo{buildAnimations(y,S,I,V){return[{babylonAnimatable:y._babylonLight,babylonAnimation:this._buildAnimation(S,I,V)}]}}(0,U.l)("/cameras/{}/orthographic/xmag",[new mI(G.b.ANIMATIONTYPE_FLOAT,"orthoLeft",jS,(()=>1)),new mI(G.b.ANIMATIONTYPE_FLOAT,"orthoRight",sS,(()=>1))]),(0,U.l)("/cameras/{}/orthographic/ymag",[new mI(G.b.ANIMATIONTYPE_FLOAT,"orthoBottom",jS,(()=>1)),new mI(G.b.ANIMATIONTYPE_FLOAT,"orthoTop",sS,(()=>1))]),(0,U.l)("/cameras/{}/orthographic/zfar",[new mI(G.b.ANIMATIONTYPE_FLOAT,"maxZ",lS,(()=>1))]),(0,U.l)("/cameras/{}/orthographic/znear",[new mI(G.b.ANIMATIONTYPE_FLOAT,"Ld",lS,(()=>1))]),(0,U.l)("/cameras/{}/perspective/yfov",[new mI(G.b.ANIMATIONTYPE_FLOAT,"fov",lS,(()=>1))]),(0,U.l)("/cameras/{}/perspective/zfar",[new mI(G.b.ANIMATIONTYPE_FLOAT,"maxZ",lS,(()=>1))]),(0,U.l)("/cameras/{}/perspective/znear",[new mI(G.b.ANIMATIONTYPE_FLOAT,"Ld",lS,(()=>1))]),(0,U.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new CS(G.b.ANIMATIONTYPE_COLOR3,"albedoColor",TS,(()=>4)),new CS(G.b.ANIMATIONTYPE_FLOAT,"alpha",(function(y,S,I,V){return S[I+3]*V}),(()=>4))]),(0,U.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"metallic",lS,(()=>1))]),(0,U.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"roughness",lS,(()=>1))]);const oS=fS("albedoTexture");(0,U.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",oS.scale),(0,U.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",oS.offset),(0,U.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",oS.rotation);const ES=fS("metallicTexture");(0,U.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",ES.scale),(0,U.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",ES.offset),(0,U.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",ES.rotation),(0,U.l)("/materials/{}/emissiveFactor",[new CS(G.b.ANIMATIONTYPE_COLOR3,"emissiveColor",TS,(()=>3))]);const zS=fS("bumpTexture");(0,U.l)("/materials/{}/normalTexture/scale",[new CS(G.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",lS,(()=>1))]),(0,U.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",zS.scale),(0,U.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",zS.offset),(0,U.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",zS.rotation),(0,U.l)("/materials/{}/occlusionTexture/strength",[new CS(G.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",lS,(()=>1))]);const rS=fS("ambientTexture");(0,U.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",rS.scale),(0,U.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",rS.offset),(0,U.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",rS.rotation);const hS=fS("emissiveTexture");(0,U.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",hS.scale),(0,U.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",hS.offset),(0,U.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",hS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new CS(G.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new CS(G.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",lS,(()=>1))]);const nS=fS("anisotropy.texture");(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",nS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",nS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",nS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",lS,(()=>1))]);const vS=fS("clearCoat.texture");(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",vS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",vS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",vS.rotation);const PS=fS("clearCoat.bumpTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new CS(G.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",PS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",PS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",PS.rotation);const qS=fS("clearCoat.textureRoughness");(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",qS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",qS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",qS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new CS(G.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new CS(G.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new CS(G.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new CS(G.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",lS,(()=>1))]);const gS=fS("iridescence.texture");(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",gS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",gS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",gS.rotation);const kS=fS("iridescence.thicknessTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",kS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",kS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",kS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new CS(G.b.ANIMATIONTYPE_COLOR3,"sheen.color",TS,(()=>3))]),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",lS,(()=>1))]);const RS=fS("sheen.texture");(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",RS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",RS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",RS.rotation);const bS=fS("sheen.textureRoughness");(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",bS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",bS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",bS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new CS(G.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",TS,(()=>3))]);const US=fS("metallicReflectanceTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",US.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",US.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",US.rotation);const WS=fS("reflectanceTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",WS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",WS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",WS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",lS,(()=>1))]);const aS=fS("subSurface.refractionIntensityTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",aS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",aS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",aS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new CS(G.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",TS,(()=>3))]),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new CS(G.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",lS,(()=>1))]),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",lS,(()=>1))]);const eS=fS("subSurface.thicknessTexture");(0,U.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",eS.scale),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",eS.offset),(0,U.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",eS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new CS(G.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",lS,(()=>1))]);const xS=fS("subSurface.translucencyIntensityTexture");(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",xS.scale),(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",xS.offset),(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",xS.rotation),(0,U.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new CS(G.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",TS,(()=>3))]);const QS=fS("subSurface.translucencyColorTexture");(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",QS.scale),(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",QS.offset),(0,U.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",QS.rotation),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new DS(G.b.ANIMATIONTYPE_COLOR3,"diffuse",TS,(()=>3))]),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new DS(G.b.ANIMATIONTYPE_FLOAT,"intensity",lS,(()=>1))]),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new DS(G.b.ANIMATIONTYPE_FLOAT,"range",lS,(()=>1))]),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new DS(G.b.ANIMATIONTYPE_FLOAT,"innerAngle",OS,(()=>1))]),(0,U.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new DS(G.b.ANIMATIONTYPE_FLOAT,"angle",OS,(()=>1))]),(0,U.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new DS(G.b.ANIMATIONTYPE_COLOR3,"diffuse",TS,(()=>3))]),(0,U.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new DS(G.b.ANIMATIONTYPE_FLOAT,"intensity",lS,(()=>1))]);const cS="KHR_animation_pointer";class XS{constructor(y){this.name=cS,this._loader=y,this._pathToObjectConverter=(0,U.i)(this._loader.ai)}get enabled(){return this._loader.isExtensionUsed(cS)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(y,S,I,V,i){var A;const B=null===(A=V.target.extensions)||void 0===A?void 0:A.KHR_animation_pointer;if(!B||!this._pathToObjectConverter)return null;"pointer"!==V.target.path&&T.b.Warn(`${y}/target/path: Value (${V.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=V.target.node&&T.b.Warn(`${y}/target/node: Value (${V.target.node}) must not be present when using the ${this.name} extension`);const d=`${y}/extensions/${this.name}`,F=B.pointer;if(!F)throw new Error(`${d}: Pointer is missing`);try{const A=this._pathToObjectConverter.convert(F);if(!A.info.interpolation)throw new Error(`${d}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(y,S,I,V,{object:A.object,info:A.info.interpolation},i)}catch(J){return T.b.Warn(`${d}/pointer: Invalid pointer (${F}) skipped`),null}}}b(cS),R(cS,!0,(y=>new XS(y)));class MS{constructor(y,S,I){this.frame=y,this.action=S,this.onlyOnce=I,this.isDone=!1}_clone(){return new MS(this.frame,this.action,this.onlyOnce)}}var tS=I(12172),NS=I(12223),YS=I(12216);class HS{get loop(){return this._loop}set loop(y){y!==this._loop&&(this._loop=y,this.updateOptions({loop:y}))}get currentTime(){var y;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(y=NS.c.audioEngine)&&void 0!==y&&y.audioContext&&(this.isPlaying||this.isPaused)){const y=this.isPaused?0:NS.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+y}return 0}get spatialSound(){return this._spatialSound}set spatialSound(y){if(y==this._spatialSound)return;const S=this.isPlaying;this.pause(),y?(this._spatialSound=y,this._updateSpatialParameters()):this._disableSpatialSound(),S&&this.play()}constructor(y,S,I){var V;let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new u.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=i.OS.Zero(),this._localDirection=new i.OS(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=y,I=I||L.e.LastCreatedScene)if(this._scene=I,HS._SceneComponentInitialization(I),this._readyToPlayCallback=A,this._customAttenuationFunction=(y,S,I,V,i)=>S<I?y*(1-S/I):0,d&&(this.autoplay=d.autoplay||!1,this._loop=d.loop||!1,void 0!==d.volume&&(this._volume=d.volume),this._spatialSound=d.spatialSound??!1,this.maxDistance=d.maxDistance??100,this.useCustomAttenuation=d.useCustomAttenuation??!1,this.rolloffFactor=d.rolloffFactor||1,this.refDistance=d.refDistance||1,this.distanceModel=d.distanceModel||"linear",this._playbackRate=d.playbackRate||1,this._streaming=d.streaming??!1,this._length=d.length,this._offset=d.offset),null!==(V=NS.c.audioEngine)&&void 0!==V&&V.canUseWebAudio&&NS.c.audioEngine.audioContext){this._soundGain=NS.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let y=!0;if(S)try{"string"===typeof S?(this._urlType="String",this._url=S):S instanceof ArrayBuffer?this._urlType="ArrayBuffer":S instanceof HTMLMediaElement?this._urlType="MediaElement":S instanceof MediaStream?this._urlType="MediaStream":S instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(S)&&(this._urlType="Array");let I=[],V=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=NS.c.audioEngine.audioContext.createMediaElementSource(S),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=NS.c.audioEngine.audioContext.createMediaStreamSource(S),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":S.byteLength>0&&(V=!0,this._soundLoaded(S));break;case"AudioBuffer":this._audioBufferLoaded(S);break;case"String":I.push(S);case"Array":0===I.length&&(I=S);for(let y=0;y<I.length;y++){const S=I[y];if(V=d&&d.skipCodecCheck||-1!==S.indexOf(".mp3",S.length-4)&&NS.c.audioEngine.isMP3supported||-1!==S.indexOf(".ogg",S.length-4)&&NS.c.audioEngine.isOGGsupported||-1!==S.indexOf(".wav",S.length-4)||-1!==S.indexOf(".m4a",S.length-4)||-1!==S.indexOf(".mp4",S.length-4)||-1!==S.indexOf("blob:"),V){this._streaming?(this._htmlAudioElement=new Audio(S),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,B.Tools.SetCorsBehavior(S,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(S,(y=>{this._soundLoaded(y)}),void 0,!0,!0,(y=>{y&&T.b.Error("XHR "+y.status+" error on: "+S+"."),T.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:y=!1}y?V||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):T.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(F){T.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),NS.c.audioEngine&&!NS.c.audioEngine.WarnedWebAudioUnsupported&&(T.b.Error("Web Audio is not supported by your browser."),NS.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var y;null!==(y=NS.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(y){var S;null!==(S=NS.c.audioEngine)&&void 0!==S&&S.audioContext&&(this._audioBuffer=y,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(y){var S;null!==(S=NS.c.audioEngine)&&void 0!==S&&S.audioContext&&NS.c.audioEngine.audioContext.decodeAudioData(y,(y=>{this._audioBufferLoaded(y)}),(y=>{T.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+y)}))}setAudioBuffer(y){var S;null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&(this._audioBuffer=y,this._isReadyToPlay=!0)}updateOptions(y){y&&(this.loop=y.loop??this.loop,this.maxDistance=y.maxDistance??this.maxDistance,this.useCustomAttenuation=y.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=y.rolloffFactor??this.rolloffFactor,this.refDistance=y.refDistance??this.refDistance,this.distanceModel=y.distanceModel??this.distanceModel,this._playbackRate=y.playbackRate??this._playbackRate,this._length=y.length??void 0,this.spatialSound=y.spatialSound??this._spatialSound,this._setOffset(y.offset??void 0),this.setVolume(y.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var y;null!==(y=NS.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&NS.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??NS.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var y;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(y=this._soundPanner)||void 0===y||y.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var y;null!==(y=NS.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(y){var S;null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(y),this._isOutputConnected=!0)}setDirectionalCone(y,S,I){S<y?T.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=y,this._coneOuterAngle=S,this._coneOuterGain=I,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(y){if(y!=this._coneInnerAngle){var S;if(this._coneOuterAngle<y)return void T.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=y,null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(y){if(y!=this._coneOuterAngle){var S;if(y<this._coneInnerAngle)return void T.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=y,null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(y){var S;y.equals(this._position)||(this._position.A(y),null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(y){var S;this._localDirection=y,null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const y=this._connectedTransformNode.getWorldMatrix(),S=i.OS.TransformNormal(this._localDirection,y);S.normalize(),this._soundPanner.orientationX.value=S.x,this._soundPanner.orientationY.value=S.y,this._soundPanner.orientationZ.value=S.z}updateDistanceFromListener(){var y;if(null!==(y=NS.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const y=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.fS(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,y,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(y){this._customAttenuationFunction=y}play(y,S,I){var V;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(V=NS.c.audioEngine)&&void 0!==V&&V.audioContext)try{var i,A;this._clearTimeoutsAndObservers();let V=y?(null===(i=NS.c.audioEngine)||void 0===i?void 0:i.audioContext.currentTime)+y:null===(A=NS.c.audioEngine)||void 0===A?void 0:A.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=NS.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const y=()=>{var I;if(null!==(I=NS.c.audioEngine)&&void 0!==I&&I.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=S??0;const I=this._htmlAudioElement.play();void 0!==I&&I.catch((()=>{var S,I;(null===(S=NS.c.audioEngine)||void 0===S||S.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(I=NS.c.audioEngine)||void 0===I?void 0:I.onAudioUnlockedObservable.addOnce((()=>{y()})))}))}else{var V;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(V=NS.c.audioEngine)||void 0===V?void 0:V.onAudioUnlockedObservable.addOnce((()=>{y()}))}};y()}}else{var B;const i=()=>{var i;if(null!==(i=NS.c.audioEngine)&&void 0!==i&&i.audioContext){var A;if(I=I||this._length,void 0!==S&&this._setOffset(S),this._soundSource){const y=this._soundSource;y.onended=()=>{y.disconnect()}}if(this._soundSource=null===(A=NS.c.audioEngine)||void 0===A?void 0:A.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var B;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==S&&(this._soundSource.loopStart=S),void 0!==I&&(this._soundSource.loopEnd=(0|S)+I),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},V=y?(null===(B=NS.c.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+y:NS.c.audioEngine.audioContext.currentTime;const i=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(V,i,this.loop?void 0:I)}}};"suspended"===(null===(B=NS.c.audioEngine)||void 0===B?void 0:B.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var y;"suspended"===(null===(y=NS.c.audioEngine)||void 0===y?void 0:y.audioContext.state)?(NS.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=NS.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{i()})))):i()}),500):i()}this._startTime=V,this.isPlaying=!0,this.isPaused=!1}catch(d){T.b.Error("Error while trying to play audio: "+this.name+", "+d.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(y){var S;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var I;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(I=this._streamingSource)||void 0===I||I.disconnect();this.isPlaying=!1}else if(null!==(S=NS.c.audioEngine)&&void 0!==S&&S.audioContext&&this._soundSource){const S=y?NS.c.audioEngine.audioContext.currentTime+y:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(S)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var y;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var S;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(S=this._streamingSource)||void 0===S||S.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(y=NS.c.audioEngine)&&void 0!==y&&y.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=NS.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(y,S){var I;null!==(I=NS.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._soundGain&&(S&&NS.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(NS.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,NS.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(y,NS.c.audioEngine.audioContext.currentTime+S)):this._soundGain.gain.value=y),this._volume=y}setPlaybackRate(y){this._playbackRate=y,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(y){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=y,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=y=>this._onRegisterAfterWorldMatrixUpdate(y),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(y){var S;if(y.getBoundingInfo){const S=y.getBoundingInfo();this.setPosition(S.boundingSphere.centerWorld)}else this.setPosition(y.absolutePosition);null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const y=()=>{(0,YS.d)((()=>this._isReadyToPlay),(()=>{I._audioBuffer=this.getAudioBuffer(),I._isReadyToPlay=!0,I.autoplay&&I.play(0,this._offset,this._length)}),void 0,300)},S={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},I=new HS(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,S);return this.useCustomAttenuation&&I.setAttenuationFunction(this._customAttenuationFunction),I.setPosition(this._position),I.setPlaybackRate(this._playbackRate),y(),I}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const y={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(y.connectedMeshId=this._connectedTransformNode.id),y.position=this._position.Vd(),y.refDistance=this.refDistance,y.distanceModel=this.distanceModel,y.isDirectional=this._isDirectional,y.localDirectionToMesh=this._localDirection.Vd(),y.coneInnerAngle=this._coneInnerAngle,y.coneOuterAngle=this._coneOuterAngle,y.coneOuterGain=this._coneOuterGain),y}static Parse(y,S,I,V){const A=y.name;let B;B=y.url?I+y.url:I+A;const d={autoplay:y.autoplay,loop:y.loop,volume:y.volume,spatialSound:y.spatialSound,maxDistance:y.maxDistance,rolloffFactor:y.rolloffFactor,refDistance:y.refDistance,distanceModel:y.distanceModel,playbackRate:y.playbackRate};let F;if(V){const y=()=>{(0,YS.d)((()=>V._isReadyToPlay),(()=>{F._audioBuffer=V.getAudioBuffer(),F._isReadyToPlay=!0,F.autoplay&&F.play(0,F._offset,F._length)}),void 0,300)};F=new HS(A,new ArrayBuffer(0),S,null,d),y()}else F=new HS(A,B,S,(()=>{S.removePendingData(F)}),d),S.addPendingData(F);if(y.position){const S=i.OS.oS(y.position);F.setPosition(S)}if(y.isDirectional&&(F.setDirectionalCone(y.coneInnerAngle||360,y.coneOuterAngle||360,y.coneOuterGain||0),y.localDirectionToMesh)){const S=i.OS.oS(y.localDirectionToMesh);F.setLocalDirectionToMesh(S)}if(y.connectedMeshId){const I=S.getMeshById(y.connectedMeshId);I&&F.attachToMesh(I)}return y.metadata&&(F.metadata=y.metadata),F}_setOffset(y){this._offset!==y&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=y)}_clearTimeoutsAndObservers(){var y;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(y=NS.c.audioEngine)||void 0===y||y.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}HS._SceneComponentInitialization=y=>{throw(0,tS.b)("AudioSceneComponent")},(0,Cy.e)("BABYLON.Sound",HS);class ZS{constructor(y,S,I){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],S.length!==I.length)throw new Error("Sounds length does not equal weights length");this.loop=y,this._weights=I;let V=0;for(const A of I)V+=A;const i=V>0?1/V:0;for(let A=0;A<this._weights.length;A++)this._weights[A]*=i;this._sounds=S;for(const A of this._sounds)A.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(y){if(y!==this._coneInnerAngle){if(this._coneOuterAngle<y)return void T.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=y;for(const S of this._sounds)S.directionalConeInnerAngle=y}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(y){if(y!==this._coneOuterAngle){if(y<this._coneInnerAngle)return void T.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=y;for(const S of this._sounds)S.directionalConeOuterAngle=y}}get volume(){return this._volume}set volume(y){if(y!==this._volume)for(const S of this._sounds)S.setVolume(y)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(y){if(!this.isPaused){this.stop();const y=Math.random();let S=0;for(let I=0;I<this._weights.length;I++)if(S+=this._weights[I],y<=S){this._currentIndex=I;break}}const S=this._sounds[this._currentIndex??0];S.isReady()?S.play(0,this.isPaused?void 0:y):S.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class wS{constructor(y){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(y=y||L.e.LastCreatedScene)&&(this._scene=y,this.soundCollection=[],this._options=S,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var y;null!==(y=NS.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&NS.c.audioEngine.audioContext&&(this._outputAudioNode=NS.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(NS.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(NS.c.audioEngine&&NS.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(y){var S;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&y.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==y.soundTrackId&&(-1===y.soundTrackId?this._scene.mainSoundTrack.removeSound(y):this._scene.soundTracks&&this._scene.soundTracks[y.soundTrackId].removeSound(y)),this.soundCollection.push(y),y.soundTrackId=this.id}removeSound(y){const S=this.soundCollection.indexOf(y);-1!==S&&this.soundCollection.splice(S,1)}setVolume(y){var S;null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=y)}switchPanningModelToHRTF(){var y;if(null!==(y=NS.c.audioEngine)&&void 0!==y&&y.canUseWebAudio)for(let S=0;S<this.soundCollection.length;S++)this.soundCollection[S].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var y;if(null!==(y=NS.c.audioEngine)&&void 0!==y&&y.canUseWebAudio)for(let S=0;S<this.soundCollection.length;S++)this.soundCollection[S].switchPanningModelToEqualPower()}connectToAnalyser(y){var S;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=y,null!==(S=NS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,NS.c.audioEngine.masterGain))}}var yI=I(12583),SI=I(12556),II=I(12142);NS.c.AudioEngineFactory=(y,S,I)=>new VI(y,S,I);class VI{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new u.b,this.onAudioLockedObservable=new u.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,II.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const V=document.createElement("audio");this._hostElement=y,this._audioContext=S,this._audioDestination=I;try{V&&V.canPlayType&&(V.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||V.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(i){}try{V&&V.canPlayType&&V.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(i){}}lock(){this._triggerSuspendedState()}unlock(){var y,S;if("running"===(null===(y=this._audioContext)||void 0===y?void 0:y.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(S=this._audioContext)||void 0===S||S.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{T.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var y;null===(y=this._audioContext)||void 0===y||y.addEventListener("statechange",(()=>{var y;this.unlocked&&"running"!==(null===(y=this._audioContext)||void 0===y?void 0:y.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var y;return null!==(y=this._audioContext)&&void 0!==y&&y.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(y){this.canUseWebAudio=!1,T.b.Error("Web Audio: "+y.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(y){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const y=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",S=document.createElement("style");S.appendChild(document.createTextNode(y)),document.getElementsByTagName("head")[0].appendChild(S),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var y;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(y=this._audioContext)||void 0===y||y.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(y){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=y)}connectToAnalyser(y){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=y,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var iI=I(12167);(0,I(13711).f)(yI.c.NAME_AUDIO,((y,S,I,V)=>{let i,A=[];if(I.xG=I.xG||[],void 0!==y.xG&&null!==y.xG)for(let d=0,F=y.xG.length;d<F;d++){var B;const F=y.xG[d];null!==(B=NS.c.audioEngine)&&void 0!==B&&B.canUseWebAudio?(F.url||(F.url=F.name),A[F.url]?I.xG.push(HS.Parse(F,S,V,A[F.url])):(i=HS.Parse(F,S,V),A[F.url]=i,I.xG.push(i))):I.xG.push(new HS(F.name,null,S))}A=[]})),Object.defineProperty(SI.e.prototype,"mainSoundTrack",{get:function(){let y=this._getComponent(yI.c.NAME_AUDIO);return y||(y=new AI(this),this.o(y)),this._mainSoundTrack||(this._mainSoundTrack=new wS(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),SI.e.prototype.getSoundByName=function(y){let S;for(S=0;S<this.mainSoundTrack.soundCollection.length;S++)if(this.mainSoundTrack.soundCollection[S].name===y)return this.mainSoundTrack.soundCollection[S];if(this.soundTracks)for(let I=0;I<this.soundTracks.length;I++)for(S=0;S<this.soundTracks[I].soundCollection.length;S++)if(this.soundTracks[I].soundCollection[S].name===y)return this.soundTracks[I].soundCollection[S];return null},Object.defineProperty(SI.e.prototype,"audioEnabled",{get:function(){let y=this._getComponent(yI.c.NAME_AUDIO);return y||(y=new AI(this),this.o(y)),y.audioEnabled},set:function(y){let S=this._getComponent(yI.c.NAME_AUDIO);S||(S=new AI(this),this.o(S)),y?S.enableAudio():S.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(SI.e.prototype,"headphone",{get:function(){let y=this._getComponent(yI.c.NAME_AUDIO);return y||(y=new AI(this),this.o(y)),y.headphone},set:function(y){let S=this._getComponent(yI.c.NAME_AUDIO);S||(S=new AI(this),this.o(S)),y?S.switchAudioModeForHeadphones():S.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(SI.e.prototype,"audioListenerPositionProvider",{get:function(){let y=this._getComponent(yI.c.NAME_AUDIO);return y||(y=new AI(this),this.o(y)),y.audioListenerPositionProvider},set:function(y){let S=this._getComponent(yI.c.NAME_AUDIO);if(S||(S=new AI(this),this.o(S)),y&&"function"!==typeof y)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");S.audioListenerPositionProvider=y},enumerable:!0,configurable:!0}),Object.defineProperty(SI.e.prototype,"audioListenerRotationProvider",{get:function(){let y=this._getComponent(yI.c.NAME_AUDIO);return y||(y=new AI(this),this.o(y)),y.audioListenerRotationProvider},set:function(y){let S=this._getComponent(yI.c.NAME_AUDIO);if(S||(S=new AI(this),this.o(S)),y&&"function"!==typeof y)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");S.audioListenerRotationProvider=y},enumerable:!0,configurable:!0}),Object.defineProperty(SI.e.prototype,"audioPositioningRefreshRate",{get:function(){let y=this._getComponent(yI.c.NAME_AUDIO);return y||(y=new AI(this),this.o(y)),y.audioPositioningRefreshRate},set:function(y){let S=this._getComponent(yI.c.NAME_AUDIO);S||(S=new AI(this),this.o(S)),S.audioPositioningRefreshRate=y},enumerable:!0,configurable:!0});class AI{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(y){this.name=yI.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new i.OS,this._cachedCameraPosition=new i.OS,this._lastCheck=0,this._invertMatrixTemp=new i.Matrix,this._cameraDirectionTemp=new i.OS,(y=y||L.e.LastCreatedScene)&&(this.mI=y,y.soundTracks=[],y.xG=[])}register(){this.mI._afterRenderStage.registerStep(yI.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(y){if(y.xG=[],this.mI.soundTracks)for(let S=0;S<this.mI.soundTracks.length;S++){const I=this.mI.soundTracks[S];for(let S=0;S<I.soundCollection.length;S++)y.xG.push(I.soundCollection[S].serialize())}}addFromContainer(y){if(y.xG)for(const S of y.xG)S.play(),S.autoplay=!0,this.mI.mainSoundTrack.addSound(S)}removeFromContainer(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(y.xG)for(const I of y.xG)I.stop(),I.autoplay=!1,this.mI.mainSoundTrack.removeSound(I),S&&I.dispose()}dispose(){const y=this.mI;if(y._mainSoundTrack&&y.mainSoundTrack.dispose(),y.soundTracks)for(let S=0;S<y.soundTracks.length;S++)y.soundTracks[S].dispose()}disableAudio(){const y=this.mI;let S;for(this._audioEnabled=!1,NS.c.audioEngine&&NS.c.audioEngine.audioContext&&NS.c.audioEngine.audioContext.suspend(),S=0;S<y.mainSoundTrack.soundCollection.length;S++)y.mainSoundTrack.soundCollection[S].pause();if(y.soundTracks)for(S=0;S<y.soundTracks.length;S++)for(let I=0;I<y.soundTracks[S].soundCollection.length;I++)y.soundTracks[S].soundCollection[I].pause()}enableAudio(){const y=this.mI;let S;for(this._audioEnabled=!0,NS.c.audioEngine&&NS.c.audioEngine.audioContext&&NS.c.audioEngine.audioContext.resume(),S=0;S<y.mainSoundTrack.soundCollection.length;S++)y.mainSoundTrack.soundCollection[S].isPaused&&y.mainSoundTrack.soundCollection[S].play();if(y.soundTracks)for(S=0;S<y.soundTracks.length;S++)for(let I=0;I<y.soundTracks[S].soundCollection.length;I++)y.soundTracks[S].soundCollection[I].isPaused&&y.soundTracks[S].soundCollection[I].play()}switchAudioModeForHeadphones(){const y=this.mI;if(this._headphone=!0,y.mainSoundTrack.switchPanningModelToHRTF(),y.soundTracks)for(let S=0;S<y.soundTracks.length;S++)y.soundTracks[S].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const y=this.mI;if(this._headphone=!1,y.mainSoundTrack.switchPanningModelToEqualPower(),y.soundTracks)for(let S=0;S<y.soundTracks.length;S++)y.soundTracks[S].switchPanningModelToEqualPower()}_afterRender(){const y=iI.b.Now;if(this._lastCheck&&y-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=y;const S=this.mI;if(!this._audioEnabled||!S._mainSoundTrack||!S.soundTracks||0===S._mainSoundTrack.soundCollection.length&&1===S.soundTracks.length)return;const I=NS.c.audioEngine;if(I&&I.audioContext){let y,V=S.activeCamera;if(S.activeCameras&&S.activeCameras.length>0&&(V=S.activeCameras[0]),this.audioListenerPositionProvider){const y=this.audioListenerPositionProvider();I.audioContext.listener.setPosition(y.x||0,y.y||0,y.z||0)}else V?this._cachedCameraPosition.equals(V.globalPosition)||(this._cachedCameraPosition.A(V.globalPosition),I.audioContext.listener.setPosition(V.globalPosition.x,V.globalPosition.y,V.globalPosition.z)):I.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const y=this.audioListenerRotationProvider();I.audioContext.listener.setOrientation(y.x||0,y.y||0,y.z||0,0,1,0)}else V?(V.rigCameras&&V.rigCameras.length>0&&(V=V.rigCameras[0]),V.getViewMatrix().invertToRef(this._invertMatrixTemp),i.OS.TransformNormalToRef(AI._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.A(this._cameraDirectionTemp),I.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):I.audioContext.listener.setOrientation(0,0,0,0,1,0);for(y=0;y<S.mainSoundTrack.soundCollection.length;y++){const I=S.mainSoundTrack.soundCollection[y];I.useCustomAttenuation&&I.updateDistanceFromListener()}if(S.soundTracks)for(y=0;y<S.soundTracks.length;y++)for(let I=0;I<S.soundTracks[y].soundCollection.length;I++){const V=S.soundTracks[y].soundCollection[I];V.useCustomAttenuation&&V.updateDistanceFromListener()}}}}AI._CameraDirection=new i.OS(0,0,-1),HS._SceneComponentInitialization=y=>{let S=y._getComponent(yI.c.NAME_AUDIO);S||(S=new AI(y),y.o(S))};const BI="MSFT_audio_emitter";class dI{constructor(y){this.name=BI,this._loader=y,this.enabled=this._loader.isExtensionUsed(BI)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const y=this._loader.ai.extensions;if(y&&y[this.name]){const S=y[this.name];this._clips=S.clips,this._emitters=S.emitters,e.Assign(this._clips),e.Assign(this._emitters)}}loadSceneAsync(y,S){return Q.LoadExtensionAsync(y,S,this.name,(async(I,V)=>{const i=new Array;i.push(this._loader.loadSceneAsync(y,S));for(const y of V.emitters){const S=e.Get(`${I}/emitters`,this._emitters,y);if(void 0!=S.refDistance||void 0!=S.maxDistance||void 0!=S.rolloffFactor||void 0!=S.distanceModel||void 0!=S.innerAngle||void 0!=S.outerAngle)throw new Error(`${I}: Direction or Distance properties are not allowed on emitters attached to a scene`);i.push(this._loadEmitterAsync(`${I}/emitters/${S.index}`,S))}await Promise.all(i)}))}loadNodeAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(y,V)=>{const A=new Array,d=await this._loader.loadNodeAsync(y,S,(S=>{for(const I of V.emitters){const V=e.Get(`${y}/emitters`,this._emitters,I);A.push(this._loadEmitterAsync(`${y}/emitters/${V.index}`,V).then((()=>{for(const y of V._babylonSounds)y.attachToMesh(S),void 0==V.innerAngle&&void 0==V.outerAngle||(y.setLocalDirectionToMesh(i.OS.Forward()),y.setDirectionalCone(2*B.Tools.ToDegrees(void 0==V.innerAngle?Math.PI:V.innerAngle),2*B.Tools.ToDegrees(void 0==V.outerAngle?Math.PI:V.outerAngle),0))})))}I(S)}));return await Promise.all(A),d}))}loadAnimationAsync(y,S){return Q.LoadExtensionAsync(y,S,this.name,(async(I,V)=>{const i=await this._loader.loadAnimationAsync(y,S),A=new Array;e.Assign(V.events);for(const B of V.events)A.push(this._loadAnimationEventAsync(`${I}/events/${B.index}`,y,S,B,i));return await Promise.all(A),i}))}_loadClipAsync(y,S){if(S._objectURL)return S._objectURL;let I;if(S.uri)I=this._loader.loadUriAsync(y,S,S.uri);else{const V=e.Get(`${y}/bufferView`,this._loader.ai.bufferViews,S.bufferView);I=this._loader.loadBufferViewAsync(`/bufferViews/${V.index}`,V)}return S._objectURL=I.then((y=>URL.createObjectURL(new Blob([y],{type:S.mimeType})))),S._objectURL}_loadEmitterAsync(y,S){if(S._babylonSounds=S._babylonSounds||[],!S._babylonData){const y=new Array,I=S.name||`emitter${S.index}`,V={loop:!1,autoplay:!1,volume:void 0==S.volume?1:S.volume};for(let A=0;A<S.clips.length;A++){const i=`/extensions/${this.name}/clips`,B=e.Get(i,this._clips,S.clips[A].clip);y.push(this._loadClipAsync(`${i}/${S.clips[A].clip}`,B).then((y=>{const i=S._babylonSounds[A]=new HS(I,y,this._loader.babylonScene,null,V);i.refDistance=S.refDistance||1,i.maxDistance=S.maxDistance||256,i.rolloffFactor=S.rolloffFactor||1,i.distanceModel=S.distanceModel||"exponential"})))}const i=Promise.all(y).then((()=>{const y=S.clips.map((y=>y.weight||1)),I=new ZS(S.loop||!1,S._babylonSounds,y);S.innerAngle&&(I.directionalConeInnerAngle=2*B.Tools.ToDegrees(S.innerAngle)),S.outerAngle&&(I.directionalConeOuterAngle=2*B.Tools.ToDegrees(S.outerAngle)),S.volume&&(I.volume=S.volume),S._babylonData.sound=I}));S._babylonData={loaded:i}}return S._babylonData.loaded}_getEventAction(y,S,I,V,i){switch(I){case"play":return y=>{const I=(i||0)+(y-V);S.play(I)};case"stop":return()=>{S.stop()};case"pause":return()=>{S.pause()};default:throw new Error(`${y}: Unsupported action ${I}`)}}_loadAnimationEventAsync(y,S,I,V,i){if(0==i.targetedAnimations.length)return Promise.resolve();const A=i.targetedAnimations[0],B=V.FS,d=e.Get(`/extensions/${this.name}/emitters`,this._emitters,B);return this._loadEmitterAsync(y,d).then((()=>{const S=d._babylonData.sound;if(S){const I=new MS(V.time,this._getEventAction(y,S,V.action,V.time,V.startOffset));A.animation.addEvent(I),i.onAnimationGroupEndObservable.add((()=>{S.stop()})),i.onAnimationGroupPauseObservable.add((()=>{S.pause()}))}}))}}b(BI),R(BI,!0,(y=>new dI(y)));const FI="MSFT_lod";class JI{constructor(y){var S;this.name=FI,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new u.b,this.onMaterialLODsLoadedObservable=new u.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=y,this.maxLODsToLoad=(null===(S=this._loader.parent.extensionOptions[FI])||void 0===S?void 0:S.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(FI)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let y=0;y<this._nodePromiseLODs.length;y++){const S=Promise.all(this._nodePromiseLODs[y]).then((()=>{0!==y&&(this._loader.endPerformanceCounter(`Node LOD ${y}`),this._loader.log(`Loaded node LOD ${y}`)),this.onNodeLODsLoadedObservable.notifyObservers(y),y!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${y+1}`),this._loadBufferLOD(this._nodeBufferLODs,y+1),this._nodeSignalLODs[y]&&this._nodeSignalLODs[y].resolve())}));this._loader._completePromises.push(S)}for(let y=0;y<this._materialPromiseLODs.length;y++){const S=Promise.all(this._materialPromiseLODs[y]).then((()=>{0!==y&&(this._loader.endPerformanceCounter(`Material LOD ${y}`),this._loader.log(`Loaded material LOD ${y}`)),this.onMaterialLODsLoadedObservable.notifyObservers(y),y!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${y+1}`),this._loadBufferLOD(this._materialBufferLODs,y+1),this._materialSignalLODs[y]&&this._materialSignalLODs[y].resolve())}));this._loader._completePromises.push(S)}}loadSceneAsync(y,S){const I=this._loader.loadSceneAsync(y,S);return this._loadBufferLOD(this._bufferLODs,0),I}loadNodeAsync(y,S,I){return Q.LoadExtensionAsync(y,S,this.name,(async(y,i)=>{let A;const B=this._getLODs(y,S,this._loader.ai.nodes,i.ids);this._loader.logOpen(`${y}`);for(let S=0;S<B.length;S++){const y=B[S];0!==S&&(this._nodeIndexLOD=S,this._nodeSignalLODs[S]=this._nodeSignalLODs[S]||new V);const i=y=>{I(y),y.VF(!1)},d=this._loader.loadNodeAsync(`/nodes/${y.index}`,y,i).then((y=>{if(0!==S){const y=B[S-1];y._babylonTransformNode&&(this._disposeTransformNode(y._babylonTransformNode),delete y._babylonTransformNode)}return y.VF(!0),y}));this._nodePromiseLODs[S]=this._nodePromiseLODs[S]||[],0===S?A=d:(this._nodeIndexLOD=null,this._nodePromiseLODs[S].push(d))}return this._loader.logClose(),await A}))}_loadMaterialAsync(y,S,I,V,i){return this._nodeIndexLOD?null:Q.LoadExtensionAsync(y,S,this.name,(async(y,A)=>{let B;const d=this._getLODs(y,S,this._loader.ai.materials,A.ids);this._loader.logOpen(`${y}`);for(let S=0;S<d.length;S++){const y=d[S];0!==S&&(this._materialIndexLOD=S);const A=this._loader._loadMaterialAsync(`/materials/${y.index}`,y,I,V,(y=>{0===S&&i(y)})).then((y=>{if(0!==S){i(y);const I=d[S-1]._data;I[V]&&(this._disposeMaterials([I[V].babylonMaterial]),delete I[V])}return y}));this._materialPromiseLODs[S]=this._materialPromiseLODs[S]||[],0===S?B=A:(this._materialIndexLOD=null,this._materialPromiseLODs[S].push(A))}return this._loader.logClose(),await B}))}_loadUriAsync(y,S,I){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const i=this._nodeIndexLOD-1;return this._nodeSignalLODs[i]=this._nodeSignalLODs[i]||new V,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(y,S,I)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const i=this._materialIndexLOD-1;return this._materialSignalLODs[i]=this._materialSignalLODs[i]||new V,this._materialSignalLODs[i].promise.then((async()=>await this._loader.loadUriAsync(y,S,I)))}return null}loadBufferAsync(y,S,I,i){if(this._loader.parent.useRangeRequests&&!S.uri){if(!this._loader.bin)throw new Error(`${y}: Uri is missing or the binary glTF is missing its binary chunk`);const S=async(y,S)=>{const A=I,B=A+i-1;let d=y[S];return d?(d.start=Math.min(d.start,A),d.end=Math.max(d.end,B)):(d={start:A,end:B,loaded:new V},y[S]=d),await d.loaded.promise.then((y=>new Uint8Array(y.buffer,y.byteOffset+I-d.start,i)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?S(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?S(this._materialBufferLODs,this._materialIndexLOD):S(this._bufferLODs,0)}return null}_loadBufferLOD(y,S){const I=y[S];I&&(this._loader.log(`Loading buffer range [${I.start}-${I.end}]`),this._loader.bin.readAsync(I.start,I.end-I.start+1).then((y=>{I.loaded.resolve(y)}),(y=>{I.loaded.reject(y)})))}_getLODs(y,S,I,V){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const i=[];for(let A=V.length-1;A>=0;A--)if(i.push(e.Get(`${y}/ids/${V[A]}`,I,V[A])),i.length===this.maxLODsToLoad)return i;return i.push(S),i}_disposeTransformNode(y){const S=[],I=y.material;I&&S.push(I);for(const i of y.getChildMeshes())i.material&&S.push(i.material);y.dispose();const V=S.filter((y=>this._loader.babylonScene.meshes.every((S=>S.material!=y))));this._disposeMaterials(V)}_disposeMaterials(y){const S={};for(const I of y){for(const y of I.getActiveTextures())S[y.uniqueId]=y;I.dispose()}for(const I in S)for(const y of this._loader.babylonScene.materials)y.hasTexture(S[I])&&delete S[I];for(const I in S)S[I].dispose()}}b(FI),R(FI,!0,(y=>new JI(y)));const uI="MSFT_minecraftMesh";class KI{constructor(y){this.name=uI,this._loader=y,this.enabled=this._loader.isExtensionUsed(uI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtraAsync(y,S,this.name,(async(V,i)=>{if(i){if(!(I instanceof O.d))throw new Error(`${V}: Material type not supported`);const i=this._loader.loadMaterialPropertiesAsync(y,S,I);return I.needAlphaBlending()&&(I.forceDepthWrite=!0,I.separateCullingPass=!0),I.Dd=I.forceDepthWrite,I.twoSidedLighting=!0,await i}}))}}b(uI),R(uI,!0,(y=>new KI(y)));const GI="MSFT_sRGBFactors";class pI{constructor(y){this.name=GI,this._loader=y,this.enabled=this._loader.isExtensionUsed(GI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,S,I){return Q.LoadExtraAsync(y,S,this.name,(async(V,i)=>{if(i){if(!(I instanceof O.d))throw new Error(`${V}: Material type not supported`);const i=this._loader.loadMaterialPropertiesAsync(y,S,I),A=I.Ey().getEngine().useExactSrgbConversions;return I.albedoTexture||I.albedoColor.toLinearSpaceToRef(I.albedoColor,A),I.reflectivityTexture||I.reflectivityColor.toLinearSpaceToRef(I.reflectivityColor,A),await i}}))}}b(GI),R(GI,!0,(y=>new pI(y)));var LI=I(14018);const TI={};var lI=I(14068),jI=I(14053),sI=I(14026),OI=I(14033);function fI(y,S){for(const I of y)for(const y of I.dataOutputs)if(y.uniqueId===S)return y;throw new Error("Could not find data out connection with unique id "+S)}function mV(y,S){for(const I of y)if(I instanceof jI.c)for(const y of I.signalInputs)if(y.uniqueId===S)return y;throw new Error("Could not find signal in connection with unique id "+S)}async function CI(y,S){const V=await Promise.all(y.allBlocks.map((async y=>{const S=function(y){switch(y){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([I.e(78),I.e(79)]).then(I.bind(I,15464))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await I.e(80).then(I.bind(I,15466))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await I.e(81).then(I.bind(I,15475))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await I.e(82).then(I.bind(I,15482))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await I.e(83).then(I.bind(I,15491))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await I.e(84).then(I.bind(I,15499))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await I.e(85).then(I.bind(I,15507))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await I.e(86).then(I.bind(I,15514))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await I.e(87).then(I.bind(I,15522))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await I.e(90).then(I.bind(I,15560))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await I.e(90).then(I.bind(I,15560))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await I.e(90).then(I.bind(I,15560))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await I.e(90).then(I.bind(I,15560))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await I.e(95).then(I.bind(I,15568))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await I.e(96).then(I.bind(I,15574))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await I.e(97).then(I.bind(I,15579))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await I.e(98).then(I.bind(I,15582))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await I.e(99).then(I.bind(I,15586))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await I.e(100).then(I.bind(I,15595))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await I.e(101).then(I.bind(I,15597))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await I.e(102).then(I.bind(I,15606))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await I.e(103).then(I.bind(I,15609))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await I.e(104).then(I.bind(I,15612))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await I.e(105).then(I.bind(I,15615))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await I.e(106).then(I.bind(I,15619))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await I.e(107).then(I.bind(I,15628))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await I.e(108).then(I.bind(I,15632))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await I.e(109).then(I.bind(I,15638))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await I.e(110).then(I.bind(I,15645))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await I.e(111).then(I.bind(I,15648))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await I.e(112).then(I.bind(I,15654))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await I.e(113).then(I.bind(I,15662))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await I.e(92).then(I.bind(I,15666))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await I.e(114).then(I.bind(I,15669))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await I.e(115).then(I.bind(I,15674))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await I.e(116).then(I.bind(I,15681))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await I.e(93).then(I.bind(I,15688))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await I.e(88).then(I.bind(I,15528))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await I.e(94).then(I.bind(I,15691))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await I.e(94).then(I.bind(I,15691))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await I.e(94).then(I.bind(I,15691))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await I.e(94).then(I.bind(I,15691))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await I.e(94).then(I.bind(I,15691))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await I.e(94).then(I.bind(I,15691))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await I.e(94).then(I.bind(I,15691))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await I.e(94).then(I.bind(I,15691))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await I.e(89).then(I.bind(I,15557))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await I.e(90).then(I.bind(I,15560))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await I.e(90).then(I.bind(I,15560))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await I.e(91).then(I.bind(I,15694))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await I.e(91).then(I.bind(I,15694))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await I.e(91).then(I.bind(I,15694))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await I.e(91).then(I.bind(I,15694))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await I.e(91).then(I.bind(I,15694))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await I.e(91).then(I.bind(I,15694))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await I.e(117).then(I.bind(I,15702))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await I.e(118).then(I.bind(I,15704))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await I.e(119).then(I.bind(I,15708))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await I.e(120).then(I.bind(I,15715))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await I.e(121).then(I.bind(I,15723))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await I.e(122).then(I.bind(I,15728))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await I.e(123).then(I.bind(I,15730))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await I.e(124).then(I.bind(I,15739))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await I.e(125).then(I.bind(I,15744))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await I.e(126).then(I.bind(I,15750))).FlowGraphDataSwitchBlock;default:if(TI[y])return TI[y];throw new Error(`Unknown block name ${y}`)}}(y.className);return await S()})));return function(y,S,I){const V=S.coordinator.createGraph(),i=[],A=S.valueParseFunction??sI.b;for(let B=0;B<y.allBlocks.length;B++){const d=oI(y.allBlocks[B],{mI:S.coordinator.config.mI,pathConverter:S.pathConverter,assetsContainer:S.coordinator.config.mI,valueParseFunction:A},I[B]);i.push(d),d instanceof lI.c&&V.addEventBlock(d)}for(const B of i){for(const y of B.dataInputs)for(const S of y.connectedPointIds){const I=fI(i,S);y.connectTo(I)}if(B instanceof jI.c)for(const y of B.signalOutputs)for(const S of y.connectedPointIds){const I=mV(i,S);y.connectTo(I)}}for(const B of y.executionContexts)DI(B,{graph:V,valueParseFunction:A},y.rightHanded);return V}(y,S,V)}function DI(y,S,I){const V=S.graph.createContext();y.enableLogging&&(V.enableLogging=!0),V.treatDataAsRightHanded=I||!1;const i=S.valueParseFunction??sI.b;V.uniqueId=y.uniqueId;const A=V.Ey();if(y._assetsContext){var B,d,F,J,u,K,G,p,L,T;const S=y._assetsContext,I={meshes:null===(B=S.meshes)||void 0===B?void 0:B.map((y=>A.getMeshById(y))),lights:null===(d=S.lights)||void 0===d?void 0:d.map((y=>A.getLightByName(y))),cameras:null===(F=S.cameras)||void 0===F?void 0:F.map((y=>A.getCameraByName(y))),materials:null===(J=S.materials)||void 0===J?void 0:J.map((y=>A.getMaterialById(y))),textures:null===(u=S.textures)||void 0===u?void 0:u.map((y=>A.getTextureByName(y))),animations:null===(K=S.animations)||void 0===K?void 0:K.map((y=>A.animations.find((S=>S.name===y)))),skeletons:null===(G=S.skeletons)||void 0===G?void 0:G.map((y=>A.getSkeletonByName(y))),dG:null===(p=S.dG)||void 0===p?void 0:p.map((y=>A.getParticleSystemById(y))),animationGroups:null===(L=S.animationGroups)||void 0===L?void 0:L.map((y=>A.getAnimationGroupByName(y))),transformNodes:null===(T=S.transformNodes)||void 0===T?void 0:T.map((y=>A.getTransformNodeById(y))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],xG:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};V.assetsContext=I}for(const l in y._userVariables){const S=i(l,y._userVariables,V.assetsContext,A);V.userVariables[l]=S}for(const l in y._connectionValues){const S=i(l,y._connectionValues,V.assetsContext,A);V._setConnectionValueByKey(l,S)}return V}function oI(y,S,I){const V={},i=S.valueParseFunction??sI.b;if(y.config)for(const B in y.config)V[B]=i(B,y.config,S.assetsContainer||S.mI,S.mI);if((0,sI.f)(y.className)){if(!S.pathConverter)throw new Error("Path converter is required for this block");V.pathConverter=S.pathConverter}const A=new I(V);A.uniqueId=y.uniqueId;for(let B=0;B<y.dataInputs.length;B++){const S=A.getDataInput(y.dataInputs[B].name);if(!S)throw new Error("Could not find data input with name "+y.dataInputs[B].name+" in block "+y.className);S.deserialize(y.dataInputs[B])}for(let B=0;B<y.dataOutputs.length;B++){const S=A.getDataOutput(y.dataOutputs[B].name);if(!S)throw new Error("Could not find data output with name "+y.dataOutputs[B].name+" in block "+y.className);S.deserialize(y.dataOutputs[B])}return A.metadata=y.metadata,A.deserialize&&A.deserialize(y),A}function EI(y){const[S,I]=y.split(":");return zI({op:S,extension:I})}function zI(y){var S;let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=y.extension?null===(S=hI[y.extension])||void 0===S?void 0:S[y.op]:nI[y.op];if(!V&&(T.b.Warn(`No mapping found for operation ${y.op} and extension ${y.extension||"KHR_interactivity"}`),I)){const S={},I={flows:{}};if(y.inputValueSockets){S.values={};for(const I in y.inputValueSockets)S.values[I]={name:I}}return y.outputValueSockets&&(I.values={},Object.keys(y.outputValueSockets).forEach((y=>{I.values[y]={name:y}}))),{Eu:[],inputs:S,outputs:I}}return V}function rI(y,S,I){hI[S]||(hI[S]={}),hI[S][y]=I}const hI={BABYLON:{"flow/log":{Eu:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},nI={"event/onStart":{Eu:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Eu:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Eu:["FlowGraphSendCustomEventBlock"],extraProcessor(y,S,I,V,i){if("event/send"!==S.op||!y.configuration||1!==Object.keys(y.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const A=y.configuration.event.value[0];if("number"!==typeof A)throw new Error("Event id should be a number");const B=V.arrays.events[A],d=i[0];return d.config||(d.config={}),d.config.eventId=B.eventId,d.config.eventData=B.eventData,i}},"event/receive":{Eu:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(y,S){var I;if(!y.configuration)return T.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const V=y.configuration.event;if(!V)return T.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const i=V.value[0];if("number"!==typeof i)return T.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(I=S.events)||void 0===I?void 0:I[i])?{valid:!0}:(T.b.Error(`Event with id ${i} not found`),{valid:!1,error:`Event with id ${i} not found`})},extraProcessor(y,S,I,V,i){if("event/receive"!==S.op||!y.configuration||1!==Object.keys(y.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const A=y.configuration.event.value[0];if("number"!==typeof A)throw new Error("Event id should be a number");const B=V.arrays.events[A],d=i[0];return d.config||(d.config={}),d.config.eventId=B.eventId,d.config.eventData=B.eventData,i}},"math/e":vI("FlowGraphEBlock"),"math/pi":vI("FlowGraphPIBlock"),"math/inf":vI("FlowGraphInfBlock"),"math/nan":vI("FlowGraphNaNBlock"),"math/abs":vI("FlowGraphAbsBlock"),"math/sign":vI("FlowGraphSignBlock"),"math/trunc":vI("FlowGraphTruncBlock"),"math/floor":vI("FlowGraphFloorBlock"),"math/ceil":vI("FlowGraphCeilBlock"),"math/round":{Eu:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i){var A;return(A=i[0]).config||(A.config={}),i[0].config.roundHalfAwayFromZero=!0,i}},"math/fract":vI("FlowGraphFractBlock"),"math/neg":vI("FlowGraphNegationBlock"),"math/add":vI("FlowGraphAddBlock",["a","b"],!0),"math/sub":vI("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Eu:["FlowGraphMultiplyBlock"],extraProcessor(y,S,I,V,i){var A;(A=i[0]).config||(A.config={}),i[0].config.useMatrixPerComponent=!0,i[0].config.preventIntegerFloatArithmetic=!0;let B=-1;return Object.keys(y.values||{}).find((S=>{var I;return void 0!==(null===(I=y.values)||void 0===I?void 0:I[S].type)&&(B=y.values[S].type,!0)})),-1!==B&&(i[0].config.type=V.arrays.types[B].flowGraphType),i},validation:y=>y.values?PI(y):{valid:!0}},"math/div":vI("FlowGraphDivideBlock",["a","b"],!0),"math/rem":vI("FlowGraphModuloBlock",["a","b"]),"math/min":vI("FlowGraphMinBlock",["a","b"]),"math/max":vI("FlowGraphMaxBlock",["a","b"]),"math/clamp":vI("FlowGraphClampBlock",["a","b","c"]),"math/saturate":vI("FlowGraphSaturateBlock"),"math/mix":vI("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":vI("FlowGraphEqualityBlock",["a","b"]),"math/lt":vI("FlowGraphLessThanBlock",["a","b"]),"math/le":vI("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":vI("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":vI("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":vI("FlowGraphIsNaNBlock"),"math/isinf":vI("FlowGraphIsInfBlock"),"math/select":{Eu:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Eu:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":vI("FlowGraphSinBlock"),"math/cos":vI("FlowGraphCosBlock"),"math/tan":vI("FlowGraphTanBlock"),"math/asin":vI("FlowGraphASinBlock"),"math/acos":vI("FlowGraphACosBlock"),"math/atan":vI("FlowGraphATanBlock"),"math/atan2":vI("FlowGraphATan2Block",["a","b"]),"math/sinh":vI("FlowGraphSinhBlock"),"math/cosh":vI("FlowGraphCoshBlock"),"math/tanh":vI("FlowGraphTanhBlock"),"math/asinh":vI("FlowGraphASinhBlock"),"math/acosh":vI("FlowGraphACoshBlock"),"math/atanh":vI("FlowGraphATanhBlock"),"math/exp":vI("FlowGraphExponentialBlock"),"math/log":vI("FlowGraphLogBlock"),"math/log2":vI("FlowGraphLog2Block"),"math/log10":vI("FlowGraphLog10Block"),"math/sqrt":vI("FlowGraphSquareRootBlock"),"math/cbrt":vI("FlowGraphCubeRootBlock"),"math/pow":vI("FlowGraphPowerBlock",["a","b"]),"math/length":vI("FlowGraphLengthBlock"),"math/normalize":vI("FlowGraphNormalizeBlock"),"math/dot":vI("FlowGraphDotBlock",["a","b"]),"math/cross":vI("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":vI("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":vI("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Eu:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Eu:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Eu:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Eu:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Eu:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Eu:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Eu:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":vI("FlowGraphTransposeBlock"),"math/determinant":vI("FlowGraphDeterminantBlock"),"math/inverse":vI("FlowGraphInvertMatrixBlock"),"math/matmul":vI("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Eu:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"zd",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i,A){const B=i[0].dataInputs.find((y=>"rotationQuaternion"===y.name));if(!B)throw new Error("Rotation quaternion input not found");return A._connectionValues[B.uniqueId]&&(A._connectionValues[B.uniqueId].type="Quaternion"),i}},"math/matDecompose":{Eu:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"zd"}}}},"math/quatConjugate":vI("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Eu:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i){var A;return(A=i[0]).config||(A.config={}),i[0].config.type="Quaternion",i}},"math/quatAngleBetween":vI("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Eu:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":vI("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":vI("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Eu:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i){var A;return(A=i[0]).config||(A.config={}),i[0].config.inputIsColumnMajor=!0,i}},"math/extract2x2":{Eu:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Eu:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i){var A;return(A=i[0]).config||(A.config={}),i[0].config.inputIsColumnMajor=!0,i}},"math/extract3x3":{Eu:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Eu:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i){var A;return(A=i[0]).config||(A.config={}),i[0].config.inputIsColumnMajor=!0,i}},"math/extract4x4":{Eu:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Eu:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i,A){var B,d;(d=i[0]).config||(d.config={});const F=i[0].dataInputs[0];return i[0].config.valueType=(null===(B=A._connectionValues[F.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",i}},"math/and":{Eu:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i,A){var B,d,F;(F=i[0]).config||(F.config={});const J=i[0].dataInputs[0],u=i[0].dataInputs[1];return i[0].config.valueType=(null===(B=A._connectionValues[J.uniqueId])||void 0===B?void 0:B.type)??(null===(d=A._connectionValues[u.uniqueId])||void 0===d?void 0:d.type)??"FlowGraphInteger",i}},"math/or":{Eu:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i,A){var B,d,F;(F=i[0]).config||(F.config={});const J=i[0].dataInputs[0],u=i[0].dataInputs[1];return i[0].config.valueType=(null===(B=A._connectionValues[J.uniqueId])||void 0===B?void 0:B.type)??(null===(d=A._connectionValues[u.uniqueId])||void 0===d?void 0:d.type)??"FlowGraphInteger",i}},"math/xor":{Eu:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,S,I,V,i,A){var B,d,F;(F=i[0]).config||(F.config={});const J=i[0].dataInputs[0],u=i[0].dataInputs[1];return i[0].config.valueType=(null===(B=A._connectionValues[J.uniqueId])||void 0===B?void 0:B.type)??(null===(d=A._connectionValues[u.uniqueId])||void 0===d?void 0:d.type)??"FlowGraphInteger",i}},"math/asr":vI("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":vI("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":vI("FlowGraphLeadingZerosBlock"),"math/ctz":vI("FlowGraphTrailingZerosBlock"),"math/popcnt":vI("FlowGraphOneBitsCounterBlock"),"math/rad":vI("FlowGraphDegToRadBlock"),"math/deg":vI("FlowGraphRadToDegBlock"),"type/boolToInt":vI("FlowGraphBooleanToInt"),"type/boolToFloat":vI("FlowGraphBooleanToFloat"),"type/intToBool":vI("FlowGraphIntToBoolean"),"type/intToFloat":vI("FlowGraphIntToFloat"),"type/floatToInt":vI("FlowGraphFloatToInt"),"type/floatToBool":vI("FlowGraphFloatToBoolean"),"flow/sequence":{Eu:["FlowGraphSequenceBlock"],extraProcessor(y,S,I,V,i){const A=i[0];return A.config||(A.config={}),A.config.outputSignalCount=Object.keys(y.flows||[]).length,A.signalOutputs.forEach(((y,S)=>{y.name="out_"+S})),i}},"flow/branch":{Eu:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Eu:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(y){if(y.configuration&&y.configuration.cases){const S=y.configuration.cases.value;if(!S.every((y=>"number"===typeof y&&/^-?\d+$/.test(y.toString()))))return T.b.Warn("Switch cases should be integers. Using empty array instead."),y.configuration.cases.value=[],{valid:!0};const I=new Set(S);y.configuration.cases.value=Array.from(I)}return{valid:!0}},extraProcessor(y,S,I,V,i){if("flow/switch"!==S.op||!y.flows||0===Object.keys(y.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return i[0].signalOutputs.forEach((y=>{"default"!==y.name&&(y.name="out_"+y.name)})),i}},"flow/while":{Eu:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Eu:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(y,S,I,V,i){const A=i[0];return A.config||(A.config={}),A.config.incrementIndexWhenLoopDone=!0,i}},"flow/doN":{Eu:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Eu:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(y,S,I,V,i){if("flow/multiGate"!==S.op||!y.flows||0===Object.keys(y.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const A=i[0];return A.config||(A.config={}),A.config.outputSignalCount=Object.keys(y.flows).length,A.signalOutputs.forEach(((y,S)=>{y.name="out_"+S})),i}},"flow/waitAll":{Eu:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(y){var S,I;return"number"!==typeof(null===(S=y.configuration)||void 0===S||null===(I=S.inputFlows)||void 0===I?void 0:I.value[0])&&(y.configuration=y.configuration||{inputFlows:{value:[0]}},y.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Eu:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Eu:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Eu:["FlowGraphCancelDelayBlock"]},"variable/get":{Eu:["FlowGraphGetVariableBlock"],validation(y){var S,I;return null!==(S=y.configuration)&&void 0!==S&&null!==(I=S.variable)&&void 0!==I&&I.value?{valid:!0}:(T.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(y,S)=>[S.getVariableName(y[0])]}}},"variable/set":{Eu:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(y,S)=>[S.getVariableName(y[0])]}}},"variable/setMultiple":{Eu:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(y,S)=>[y[0].map((y=>S.getVariableName(y)))]}},extraProcessor:(y,S,I,V,i)=>(i[0].dataInputs.forEach((y=>{y.name=V.getVariableName(+y.name)})),i)},"variable/interpolate":{Eu:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(y,S)=>[S.getVariableName(y[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:y=>!0===y[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",CI:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",CI:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",CI:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",CI:"FlowGraphPlayAnimationBlock"},out:{name:"out",CI:"FlowGraphPlayAnimationBlock"},done:{name:"done",CI:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(y,S,I,V,i){var A,B,d;const F=i[0],J=null===(A=y.configuration)||void 0===A?void 0:A.variable.value[0];if("number"!==typeof J)throw T.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const u=V.arrays.staticVariables[J];"undefined"===typeof F.config.animationType.value&&(V.arrays.staticVariables,F.config.animationType.value=(0,OI.F)(u.type));const K=i[4];return K.config||(K.config={}),(B=K.config).variable||(B.variable={}),K.config.variable.value=V.getVariableName(J),(d=i[3]).config||(d.config={}),i}},"pointer/get":{Eu:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",CI:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",CI:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(y,S,I,V,i)=>(i.forEach((y=>{"FlowGraphJsonPointerParserBlock"===y.className&&(y.config||(y.config={}),y.config.outputValue=!0)})),i)},"pointer/set":{Eu:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",CI:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",CI:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(y,S,I,V,i)=>(i.forEach((y=>{"FlowGraphJsonPointerParserBlock"===y.className&&(y.config||(y.config={}),y.config.outputValue=!0)})),i)},"pointer/interpolate":{Eu:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",CI:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",CI:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",CI:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",CI:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",CI:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",CI:"FlowGraphPlayAnimationBlock"},out:{name:"out",CI:"FlowGraphPlayAnimationBlock"},done:{name:"done",CI:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(y,S,I,V,i)=>(i.forEach((S=>{"FlowGraphJsonPointerParserBlock"===S.className?(S.config||(S.config={}),S.config.outputValue=!0):"FlowGraphInterpolationBlock"===S.className&&(S.config||(S.config={}),Object.keys(y.values||[]).forEach((I=>{var i;const A=null===(i=y.values)||void 0===i?void 0:i[I];if("value"===I&&A){const y=A.type;void 0!==y&&(S.config.animationType=V.arrays.types[y].flowGraphType)}})))})),i)},"animation/start":{Eu:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",CI:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(y,S)=>[y[0]*S._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(y,S)=>[y[0]*S._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(y,S,I,V,i,A,B){const d=i[i.length-1];return d.config||(d.config={}),d.config.glTF=B,i}},"animation/stop":{Eu:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",CI:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(y,S,I,V,i,A,B){const d=i[i.length-1];return d.config||(d.config={}),d.config.glTF=B,i}},"animation/stopAt":{Eu:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",CI:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(y,S)=>[y[0]*S._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(y,S,I,V,i,A,B){const d=i[i.length-1];return d.config||(d.config={}),d.config.glTF=B,i}},"math/switch":{Eu:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(y){if(y.configuration&&y.configuration.cases){const S=y.configuration.cases.value;if(!S.every((y=>"number"===typeof y&&/^-?\d+$/.test(y.toString()))))return T.b.Warn("Switch cases should be integers. Using empty array instead."),y.configuration.cases.value=[],{valid:!0};const I=new Set(S);y.configuration.cases.value=Array.from(I)}return{valid:!0}},extraProcessor(y,S,I,V,i){const A=i[0];return A.dataInputs.forEach((y=>{"default"!==y.name&&"case"!==y.name&&(y.name="in_"+y.name)})),A.config||(A.config={}),A.config.treatCasesAsIntegers=!0,i}},"debug/log":{Eu:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function vI(y){let S=arguments.length>2?arguments[2]:void 0;return{Eu:[y],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((y,S)=>(y[S]={name:S},y)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(y,I,V,i,A){var B;if(S){(B=A[0]).config||(B.config={}),A[0].config.preventIntegerFloatArithmetic=!0;let S=-1;Object.keys(y.values||{}).find((I=>{var V;return void 0!==(null===(V=y.values)||void 0===V?void 0:V[I].type)&&(S=y.values[I].type,!0)})),-1!==S&&(A[0].config.type=i.arrays.types[S].flowGraphType)}return A},validation:y=>S?PI(y):{valid:!0}}}function PI(y){if(y.values){const S=Object.keys(y.values).map((S=>y.values[S].type)).filter((y=>void 0!==y));if(!S.every((y=>y===S[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}nI["math/compose"]=nI["math/matCompose"],nI["math/decompose"]=nI["math/matDecompose"];var qI=I(12286);const gI={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"OS",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class kI{constructor(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=y,this._gltf=S,this._animationTargetFps=I,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const y of this._interactivityGraph.types)this._types.push(gI[y.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const y of this._interactivityGraph.declarations){const S=zI(y);if(!S)throw T.b.Error(["No mapping found for declaration",y]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:S,fullOperationName:y.extension?y.op+":"+y.extension:y.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const y of this._interactivityGraph.variables){const S=this._parseVariable(y);this._staticVariables.push(S)}}_parseVariable(y,S){const I=this._types[y.type];if(!I)throw T.b.Error(["No type found for variable",y]),new Error("Error parsing variables");if(y.value&&y.value.length!==I.length)throw T.b.Error(["Invalid value length for variable",y,I]),new Error("Error parsing variables");const V=y.value||[];if(!V.length)switch(I.flowGraphType){case"boolean":V.push(!1);break;case"FlowGraphInteger":V.push(0);break;case"number":V.push(NaN);break;case"Vector2":V.push(NaN,NaN);break;case"OS":V.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":V.fill(NaN,0,4);break;case"Matrix":V.fill(NaN,0,16);break;case"Matrix3D":V.fill(NaN,0,9)}return"number"===I.elementType&&"string"===typeof V[0]&&(V[0]=parseFloat(V[0])),{type:I.flowGraphType,value:S?S(V,this):V}}_parseEvents(){if(this._interactivityGraph.events)for(const y of this._interactivityGraph.events){const S={eventId:y.id||"internalEvent_"+this._internalEventsCounter++};y.values&&(S.eventData=Object.keys(y.values).map((S=>{var I;const V=null===(I=y.values)||void 0===I?void 0:I[S];if(!V)throw T.b.Error(["No value found for event key",S]),new Error("Error parsing events");const i=this._types[V.type];if(!i)throw T.b.Error(["No type found for event value",V]),new Error("Error parsing events");const A="undefined"!==typeof V.value?this._parseVariable(V):void 0;return{id:S,type:i.flowGraphType,eventData:!0,value:A}}))),this._events.push(S)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const S of this._interactivityGraph.nodes){if("number"!==typeof S.declaration)throw T.b.Error(["No declaration found for node",S]),new Error("Error parsing nodes");const I=this._mappings[S.declaration];if(!I)throw T.b.Error(["No mapping found for node",S]),new Error("Error parsing nodes");if(I.flowGraphMapping.validation){const V=I.flowGraphMapping.validation(S,this._interactivityGraph,this._gltf);var y;if(!V.valid)throw new Error(`Error validating interactivity node ${null===(y=this._interactivityGraph.declarations)||void 0===y?void 0:y[S.declaration].op} - ${V.error}`)}const V=[];for(const y of I.flowGraphMapping.Eu){const i=this._getEmptyBlock(y,I.fullOperationName);this._parseNodeConfiguration(S,i,I.flowGraphMapping,y),V.push(i)}this._nodes.push({Eu:V,fullOperationName:I.fullOperationName})}}_getEmptyBlock(y,S){return{uniqueId:(0,qI.d)(),className:y,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:S,metadata:{}}}_parseNodeConfiguration(y,S,I,V){const i=S.config;if(y.configuration){const S=Object.keys(y.configuration);for(const d of S){var A,B;const S=null===(A=y.configuration)||void 0===A?void 0:A[d];if(!S)throw T.b.Error(["No value found for node configuration",d]),new Error("Error parsing node configuration");const F=null===(B=I.configuration)||void 0===B?void 0:B[d];if(F&&F.CI?F.CI===V:0===I.Eu.indexOf(V)){const y=(null===F||void 0===F?void 0:F.name)||d;S&&"undefined"!==typeof S.value||"undefined"===typeof(null===F||void 0===F?void 0:F.defaultValue)?S.value.length>=0?i[y]={value:1===S.value.length?S.value[0]:S.value}:T.b.Warn(["Invalid value for node configuration",S]):i[y]={value:F.defaultValue},F&&F.dataTransformer&&(i[y].value=F.dataTransformer([i[y].value],this)[0])}}}}_parseNodeConnections(y){for(let C=0;C<this._nodes.length;C++){var S;const D=null===(S=this._interactivityGraph.nodes)||void 0===S?void 0:S[C];if(!D)throw T.b.Error(["No node found for interactivity node",this._nodes[C]]),new Error("Error parsing node connections");const o=this._nodes[C],E=this._mappings[D.declaration];if(!E)throw T.b.Error(["No mapping found for node",D]),new Error("Error parsing node connections");const z=D.flows||{},r=Object.keys(z).sort();for(const y of r){var I,V,i,A;const S=z[y],J=null===(I=E.flowGraphMapping.outputs)||void 0===I||null===(V=I.flows)||void 0===V?void 0:V[y],u=(null===J||void 0===J?void 0:J.name)||y,K=this._createNewSocketConnection(u,!0);(J&&J.CI&&o.Eu.find((y=>y.className===J.CI))||o.Eu[0]).signalOutputs.push(K);const G=S.node,p=this._nodes[G];if(!p)throw T.b.Error(["No node found for input node id",G]),new Error("Error parsing node connections");const L=EI(p.fullOperationName);if(!L)throw T.b.Error(["No mapping found for input node",p]),new Error("Error parsing node connections");let l=null===(i=L.inputs)||void 0===i||null===(A=i.flows)||void 0===A?void 0:A[S.socket||"in"],j=!1;if(!l)for(const y in null===(B=L.inputs)||void 0===B?void 0:B.flows){var B,d,F;if(y.startsWith("[")&&y.endsWith("]"))j=!0,l=null===(d=L.inputs)||void 0===d||null===(F=d.flows)||void 0===F?void 0:F[y]}const s=l?j?l.name.replace("$1",S.socket||""):l.name:S.socket||"in",O=l&&l.CI&&p.Eu.find((y=>y.className===l.CI))||p.Eu[0];let f=O.signalInputs.find((y=>y.name===s));f||(f=this._createNewSocketConnection(s),O.signalInputs.push(f)),f.connectedPointIds.push(K.uniqueId),K.connectedPointIds.push(f.uniqueId)}const h=D.values||{},n=Object.keys(h);for(const S of n){var J,u;const I=h[S];let V=null===(J=E.flowGraphMapping.inputs)||void 0===J||null===(u=J.values)||void 0===u?void 0:u[S],i=!1;if(!V)for(const y in null===(K=E.flowGraphMapping.inputs)||void 0===K?void 0:K.values){var K,G,p;if(y.startsWith("[")&&y.endsWith("]"))i=!0,V=null===(G=E.flowGraphMapping.inputs)||void 0===G||null===(p=G.values)||void 0===p?void 0:p[y]}const A=V?i?V.name.replace("$1",S):V.name:S,B=this._createNewSocketConnection(A);if((V&&V.CI&&o.Eu.find((y=>y.className===V.CI))||o.Eu[0]).dataInputs.push(B),void 0!==I.value){const S=this._parseVariable(I,V&&V.dataTransformer);y._connectionValues[B.uniqueId]=S}else{if("undefined"===typeof I.node)throw T.b.Error(["Invalid value for value connection",I]),new Error("Error parsing node connections");{var L,l,j;const y=I.node,S=I.socket||"value",V=this._nodes[y];if(!V)throw T.b.Error(["No node found for output socket reference",I]),new Error("Error parsing node connections");const i=EI(V.fullOperationName);if(!i)throw T.b.Error(["No mapping found for output socket reference",I]),new Error("Error parsing node connections");let A=null===(L=i.outputs)||void 0===L||null===(l=L.values)||void 0===l?void 0:l[S],d=!1;if(!A)for(const I in null===(s=i.outputs)||void 0===s?void 0:s.values){var s,O,f;if(I.startsWith("[")&&I.endsWith("]"))d=!0,A=null===(O=i.outputs)||void 0===O||null===(f=O.values)||void 0===f?void 0:f[I]}const F=A?d?A.name.replace("$1",S):null===(j=A)||void 0===j?void 0:j.name:S,J=A&&A.CI&&V.Eu.find((y=>y.className===A.CI))||V.Eu[0];let u=J.dataOutputs.find((y=>y.name===F));u||(u=this._createNewSocketConnection(F,!0),J.dataOutputs.push(u)),B.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(B.uniqueId)}}}if(E.flowGraphMapping.interBlockConnectors)for(const y of E.flowGraphMapping.interBlockConnectors){const S=y.input,I=y.output,V=y.isVariable;this._connectFlowGraphNodes(S,I,o.Eu[y.inputBlockIndex],o.Eu[y.outputBlockIndex],V)}if(E.flowGraphMapping.extraProcessor){var my;const S=null===(my=this._interactivityGraph.declarations)||void 0===my?void 0:my[D.declaration];if(!S)throw T.b.Error(["No declaration found for extra processor",D]),new Error("Error parsing node connections");o.Eu=E.flowGraphMapping.extraProcessor(D,S,E.flowGraphMapping,this,o.Eu,y,this._gltf)}}}_createNewSocketConnection(y,S){return{uniqueId:(0,qI.d)(),name:y,_connectionType:S?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(y,S,I,V,i){const A=i?I.dataInputs:I.signalInputs,B=i?V.dataOutputs:V.signalOutputs,d=A.find((S=>S.name===y))||this._createNewSocketConnection(y),F=B.find((y=>y.name===S))||this._createNewSocketConnection(S,!0);A.find((S=>S.name===y))||A.push(d),B.find((y=>y.name===S))||B.push(F),d.connectedPointIds.push(F.uniqueId),F.connectedPointIds.push(d.uniqueId)}getVariableName(y){return"staticVariable_"+y}serializeToFlowGraph(){const y={uniqueId:(0,qI.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(y);for(let S=0;S<this._staticVariables.length;S++){const I=this._staticVariables[S];y._userVariables[this.getVariableName(S)]=I}return{rightHanded:!0,allBlocks:this._nodes.reduce(((y,S)=>y.concat(S.Eu)),[]),executionContexts:[y]}}}const RI="KHR_interactivity";class bI{constructor(y){this._loader=y,this.name=RI,this.enabled=this._loader.isExtensionUsed(RI),this._pathConverter=(0,U.i)(this._loader.ai),y._skipStartAnimationStep=!0;const S=y.babylonScene;S&&function(y){(0,U.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!y.activeCamera)return new i.Quaternion(NaN,NaN,NaN,NaN);const S=i.Quaternion.FromRotationMatrix(y.activeCamera.getWorldMatrix()).normalize();return y.useRightHandedSystem||(S.w*=-1,S.x*=-1),S},type:"Quaternion",getTarget:()=>y.activeCamera}),(0,U.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!y.activeCamera)return new i.OS(NaN,NaN,NaN);const S=y.activeCamera.getWorldMatrix().getTranslation();return y.useRightHandedSystem||(S.x*=-1),S},type:"OS",getTarget:()=>y.activeCamera}),(0,U.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:y=>{var S;return(null===(S=y._babylonAnimationGroup)||void 0===S?void 0:S.isPlaying)??!1},type:"boolean",getTarget:y=>y._babylonAnimationGroup}),(0,U.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:y=>{var S;return((null===(S=y._babylonAnimationGroup)||void 0===S?void 0:S.from)??0)/60},type:"number",getTarget:y=>y._babylonAnimationGroup}),(0,U.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:y=>{var S;return((null===(S=y._babylonAnimationGroup)||void 0===S?void 0:S.to)??0)/60},type:"number",getTarget:y=>y._babylonAnimationGroup}),(0,U.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:y=>{var S;return((null===(S=y._babylonAnimationGroup)||void 0===S?void 0:S.getCurrentFrame())??0)/60},type:"number",getTarget:y=>y._babylonAnimationGroup}),(0,U.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:y=>{var S;return((null===(S=y._babylonAnimationGroup)||void 0===S?void 0:S.getCurrentFrame())??0)/60},type:"number",getTarget:y=>y._babylonAnimationGroup})}(S)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var y;if(!this._loader.babylonScene||!this._pathConverter)return;const S=this._loader.babylonScene,I=null===(y=this._loader.ai.extensions)||void 0===y?void 0:y.KHR_interactivity;if(!I)return;const V=new LI.d({mI:S});V.dispatchEventsSynchronously=!1;const i=I.graphs.map((y=>new kI(y,this._loader.ai,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(i.map((async y=>await CI(y,{coordinator:V,pathConverter:this._pathConverter})))),V.start()}}var UI;UI=async()=>(await Promise.resolve().then(I.bind(I,14085))).FlowGraphGLTFDataProvider,TI[`${RI}/${"FlowGraphGLTFDataProvider"}`]=UI,b(RI),R(RI,!0,(y=>new bI(y)));const WI="KHR_node_visibility";(0,U.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:y=>{const S=y._babylonTransformNode;return!S||void 0===S.isVisible||S.isVisible},set:(y,S)=>{var I,V;null===(I=S._primitiveBabylonMeshes)||void 0===I||I.forEach((y=>{y.inheritVisibility=!0})),S._babylonTransformNode&&(S._babylonTransformNode.isVisible=y),null===(V=S._primitiveBabylonMeshes)||void 0===V||V.forEach((S=>{S.isVisible=y}))},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class aI{constructor(y){this.name=WI,this._loader=y,this.enabled=y.isExtensionUsed(WI)}async onReady(){var y;null===(y=this._loader.ai.nodes)||void 0===y||y.forEach((y=>{var S,I,V,i;(null===(S=y._primitiveBabylonMeshes)||void 0===S||S.forEach((y=>{y.inheritVisibility=!0})),null!==(I=y.extensions)&&void 0!==I&&I.KHR_node_visibility)&&(!1===(null===(V=y.extensions)||void 0===V?void 0:V.KHR_node_visibility.visible)&&(y._babylonTransformNode&&(y._babylonTransformNode.isVisible=!1),null===(i=y._primitiveBabylonMeshes)||void 0===i||i.forEach((y=>{y.isVisible=!1}))))}))}dispose(){this._loader=null}}b(WI),R(WI,!0,(y=>new aI(y)));const eI="KHR_node_selectability";rI("event/onSelect",eI,{Eu:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",CI:"FlowGraphGetVariableBlock",dataTransformer:y=>["pickedMesh_"+y[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",CI:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(y,S,I,V,i,A,B){var d,F,J,u,K,G;const p=i[i.length-1];p.config=p.config||{},p.config.glTF=B;const L=null===(d=y.configuration)||void 0===d||null===(F=d.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===L||"number"!==typeof L)throw new Error("nodeIndex not found in configuration");const T="pickedMesh_"+L;return i[1].config.variable=T,A._userVariables[T]={className:"Mesh",id:null===B||void 0===B||null===(J=B.nodes)||void 0===J||null===(u=J[L]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===B||void 0===B||null===(K=B.nodes)||void 0===K||null===(G=K[L]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},i}}),(0,U.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:y=>{const S=y._babylonTransformNode;return!S||void 0===S.HF||S.HF},set:(y,S)=>{var I;null===(I=S._primitiveBabylonMeshes)||void 0===I||I.forEach((S=>{S.HF=y}))},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"HF"],type:"boolean"});class xI{constructor(y){this.name=eI,this._loader=y,this.enabled=y.isExtensionUsed(eI)}async onReady(){var y;null===(y=this._loader.ai.nodes)||void 0===y||y.forEach((y=>{var S,I,V;null!==(S=y.extensions)&&void 0!==S&&S.KHR_node_selectability&&!1===(null===(I=y.extensions)||void 0===I?void 0:I.KHR_node_selectability.selectable)&&(null===(V=y._babylonTransformNode)||void 0===V||V.getChildMeshes().forEach((y=>{y.HF=!1})))}))}dispose(){this._loader=null}}b(eI),R(eI,!0,(y=>new xI(y)));const QI="KHR_node_hoverability",cI="targetMeshPointerOver_";rI("event/onHoverIn",QI,{Eu:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",CI:"FlowGraphGetVariableBlock",dataTransformer:y=>[cI+y[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",CI:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(y,S,I,V,i,A,B){var d,F,J,u,K,G;const p=i[i.length-1];p.config=p.config||{},p.config.glTF=B;const L=null===(d=y.configuration)||void 0===d||null===(F=d.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===L||"number"!==typeof L)throw new Error("nodeIndex not found in configuration");const T=cI+L;return i[1].config.variable=T,A._userVariables[T]={className:"Mesh",id:null===B||void 0===B||null===(J=B.nodes)||void 0===J||null===(u=J[L]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===B||void 0===B||null===(K=B.nodes)||void 0===K||null===(G=K[L]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},i}});const XI="targetMeshPointerOut_";rI("event/onHoverOut",QI,{Eu:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",CI:"FlowGraphGetVariableBlock",dataTransformer:y=>[XI+y[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",CI:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(y,S,I,V,i,A,B){var d,F,J,u,K,G;const p=i[i.length-1];p.config=p.config||{},p.config.glTF=B;const L=null===(d=y.configuration)||void 0===d||null===(F=d.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===L||"number"!==typeof L)throw new Error("nodeIndex not found in configuration");const T=XI+L;return i[1].config.variable=T,A._userVariables[T]={className:"Mesh",id:null===B||void 0===B||null===(J=B.nodes)||void 0===J||null===(u=J[L]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===B||void 0===B||null===(K=B.nodes)||void 0===K||null===(G=K[L]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},i}}),(0,U.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:y=>{const S=y._babylonTransformNode;return!S||void 0===S.pointerOverDisableMeshTesting||S.pointerOverDisableMeshTesting},set:(y,S)=>{var I;null===(I=S._primitiveBabylonMeshes)||void 0===I||I.forEach((S=>{S.pointerOverDisableMeshTesting=!y}))},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class MI{constructor(y){this.name=QI,this._loader=y,this.enabled=y.isExtensionUsed(QI)}async onReady(){var y;null===(y=this._loader.ai.nodes)||void 0===y||y.forEach((y=>{var S,I,V;null!==(S=y.extensions)&&void 0!==S&&S.KHR_node_hoverability&&!1===(null===(I=y.extensions)||void 0===I?void 0:I.KHR_node_hoverability.hoverable)&&(null===(V=y._babylonTransformNode)||void 0===V||V.getChildMeshes().forEach((y=>{y.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}b(QI),R(QI,!0,(y=>new MI(y)));const tI="ExtrasAsMetadata";class NI{_assignExtras(y,S){if(S.extras&&Object.keys(S.extras).length>0){const I=y.metadata=y.metadata||{};(I.ai=I.ai||{}).extras=S.extras}}constructor(y){this.name=tI,this.enabled=!0,this._loader=y}dispose(){this._loader=null}loadNodeAsync(y,S,I){return this._loader.loadNodeAsync(y,S,(y=>{this._assignExtras(y,S),I(y)}))}loadCameraAsync(y,S,I){return this._loader.loadCameraAsync(y,S,(y=>{this._assignExtras(y,S),I(y)}))}createMaterial(y,S,I){const V=this._loader.createMaterial(y,S,I);return this._assignExtras(V,S),V}}b(tI),R(tI,!1,(y=>new NI(y)));I(14085)},13969:(y,S,I)=>{"use strict";I.d(S,{c:()=>P,f:()=>E,j:()=>o,n:()=>z});var V=I(12133),i=I(12128),A=I(13608),B=I(12753),d=I(12723),F=I(12734),J=I(12151),u=I(12185),K=I(12747),G=I(12857),p=I(12759),L=I(12355);class T{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.dG=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.xG=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(y){this._environmentTexture=y}getNodes(){let y=[];y=y.concat(this.meshes),y=y.concat(this.lights),y=y.concat(this.cameras),y=y.concat(this.transformNodes);for(const S of this.skeletons)y=y.concat(S.bones);return y}}class l extends T{}class j{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const y=this.rootNodes;for(const V of y)V.dispose();y.length=0;const S=this.skeletons;for(const V of S)V.dispose();S.length=0;const I=this.animationGroups;for(const V of I)V.dispose();I.length=0}}class s extends T{constructor(y){super(),this._wasAddedToScene=!1,(y=y||u.e.LastCreatedScene)&&(this.mI=y,this.proceduralTextures=[],y.zi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=y.getEngine().onContextRestoredObservable.add((()=>{for(const y of this.geometries)y._rebuild();for(const y of this.meshes)y._rebuild();for(const y of this.dG)y.rebuild();for(const y of this.textures)y._rebuild()})))}_topologicalSort(y){const S=new Map;for(const B of y)S.set(B.uniqueId,B);const I={dependsOn:new Map,dependedBy:new Map};for(const B of y){const y=B.uniqueId;I.dependsOn.set(y,new Set),I.dependedBy.set(y,new Set)}for(const B of y){const y=B.uniqueId,V=I.dependsOn.get(y);if(B instanceof K.e){const i=B.sourceMesh;S.has(i.uniqueId)&&(V.add(i.uniqueId),I.dependedBy.get(i.uniqueId).add(y))}const i=I.dependedBy.get(y);for(const A of B.getDescendants()){const V=A.uniqueId;if(S.has(V)){i.add(V);I.dependsOn.get(V).add(y)}}}const V=[],i=[];for(const B of y){const y=B.uniqueId;0===I.dependsOn.get(y).size&&(i.push(B),S.delete(y))}const A=i;for(;A.length>0;){const y=A.shift();V.push(y);const i=I.dependedBy.get(y.uniqueId);for(const V of Array.from(i.values())){const i=I.dependsOn.get(V);i.delete(y.uniqueId),0===i.size&&S.get(V)&&(A.push(S.get(V)),S.delete(V))}}return S.size>0&&(J.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),S.forEach((y=>{J.b.Error(y.name)}))),V}_addNodeAndDescendantsToList(y,S,I,V){if(I&&(!V||V(I))&&!S.has(I.uniqueId)){y.push(I),S.add(I.uniqueId);for(const i of I.getDescendants(!0))this._addNodeAndDescendantsToList(y,S,i,V)}}_isNodeInContainer(y){return y instanceof F.e&&-1!==this.meshes.indexOf(y)||(y instanceof d.d&&-1!==this.transformNodes.indexOf(y)||(y instanceof G.e&&-1!==this.lights.indexOf(y)||y instanceof p.b&&-1!==this.cameras.indexOf(y)))}_isValidHierarchy(){for(const y of this.meshes)if(y.parent&&!this._isNodeInContainer(y.parent))return J.b.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.transformNodes)if(y.parent&&!this._isNodeInContainer(y.parent))return J.b.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.lights)if(y.parent&&!this._isNodeInContainer(y.parent))return J.b.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.cameras)if(y.parent&&!this._isNodeInContainer(y.parent))return J.b.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(y){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||i.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const V={},A={},d=new j,F=[],J=[],u={doNotInstantiate:!0,...I},K=[],G=new Set;for(const i of this.transformNodes)null===i.parent&&this._addNodeAndDescendantsToList(K,G,i,u.predicate);for(const i of this.meshes)null===i.parent&&this._addNodeAndDescendantsToList(K,G,i,u.predicate);const p=this._topologicalSort(K),L=(I,i)=>{if(((S,I)=>{if(V[S.uniqueId]=I.uniqueId,A[I.uniqueId]=I,y&&(I.name=y(S.name)),I instanceof B.c){const y=I;if(y.morphTargetManager){const I=S.morphTargetManager;y.morphTargetManager=I.clone();for(let S=0;S<I.numTargets;S++){const i=I.getTarget(S),B=y.morphTargetManager.getTarget(S);V[i.uniqueId]=B.uniqueId,A[B.uniqueId]=B}}}})(I,i),I.parent){const y=V[I.parent.uniqueId],S=A[y];i.parent=S||I.parent}if(i.position&&I.position&&i.position.A(I.position),i.rotationQuaternion&&I.rotationQuaternion&&i.rotationQuaternion.A(I.rotationQuaternion),i.rotation&&I.rotation&&i.rotation.A(I.rotation),i.zd&&I.zd&&i.zd.A(I.zd),i.material){const B=i;if(B.material)if(S){const S=I.material;if(-1===J.indexOf(S)){let I=S.clone(y?y(S.name):"Clone of "+S.name);if(J.push(S),V[S.uniqueId]=I.uniqueId,A[I.uniqueId]=I,"MultiMaterial"===S.getClassName()){const i=S;for(const S of i.gd)S&&(I=S.clone(y?y(S.name):"Clone of "+S.name),J.push(S),V[S.uniqueId]=I.uniqueId,A[I.uniqueId]=I);i.gd=i.gd.map((y=>y&&A[V[y.uniqueId]]))}}"InstancedMesh"!==B.getClassName()&&(B.material=A[V[S.uniqueId]])}else"MultiMaterial"===B.material.getClassName()?-1===this.mI.multiMaterials.indexOf(B.material)&&this.mI.addMultiMaterial(B.material):-1===this.mI.materials.indexOf(B.material)&&this.mI.addMaterial(B.material)}null===i.parent&&d.rootNodes.push(i)};for(const i of p)if("InstancedMesh"===i.getClassName()){const y=i,S=y.sourceMesh,I=V[S.uniqueId];L(y,("number"===typeof I?A[I]:S).createInstance(y.name))}else{let y=!0;"ip"===i.getClassName()||"Node"===i.getClassName()||i.skeleton||!i.getTotalVertices||0===i.getTotalVertices()?y=!1:u.doNotInstantiate&&(y="function"===typeof u.doNotInstantiate?!u.doNotInstantiate(i):!u.doNotInstantiate);const S=y?i.createInstance(`instance of ${i.name}`):i.clone(`Clone of ${i.name}`,null,!0);if(!S)throw new Error(`Could not clone or instantiate node on Asset Container ${i.name}`);L(i,S)}for(const i of this.skeletons){if(u.predicate&&!u.predicate(i))continue;const S=i.clone(y?y(i.name):"Clone of "+i.name);for(const y of this.meshes)if(y.skeleton===i&&!y.isAnInstance){const I=A[V[y.uniqueId]];if(!I||I.isAnInstance)continue;if(I.skeleton=S,-1!==F.indexOf(S))continue;F.push(S);for(const y of S.bones)y._linkedTransformNode&&(y._linkedTransformNode=A[V[y._linkedTransformNode.uniqueId]])}d.skeletons.push(S)}for(const i of this.animationGroups){if(u.predicate&&!u.predicate(i))continue;const S=i.clone(y?y(i.name):"Clone of "+i.name,(y=>A[V[y.uniqueId]]||y));d.animationGroups.push(S)}return d}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||i.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.mI.environmentTexture=this.environmentTexture);for(const y of this.mI._serializableComponents)y.addFromContainer(this);this.mI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const S=[];for(const I of this.cameras)y&&!y(I)||(this.mI.addCamera(I),S.push(I));for(const I of this.lights)y&&!y(I)||(this.mI.addLight(I),S.push(I));for(const I of this.meshes)y&&!y(I)||(this.mI.pu(I),S.push(I));for(const I of this.skeletons)y&&!y(I)||this.mI.addSkeleton(I);for(const I of this.animations)y&&!y(I)||this.mI.addAnimation(I);for(const I of this.animationGroups)y&&!y(I)||this.mI.addAnimationGroup(I);for(const I of this.multiMaterials)y&&!y(I)||this.mI.addMultiMaterial(I);for(const I of this.materials)y&&!y(I)||this.mI.addMaterial(I);for(const I of this.morphTargetManagers)y&&!y(I)||this.mI.addMorphTargetManager(I);for(const I of this.geometries)y&&!y(I)||this.mI.addGeometry(I);for(const I of this.transformNodes)y&&!y(I)||(this.mI.addTransformNode(I),S.push(I));for(const I of this.actionManagers)y&&!y(I)||this.mI.addActionManager(I);for(const I of this.textures)y&&!y(I)||this.mI.addTexture(I);for(const I of this.reflectionProbes)y&&!y(I)||this.mI.addReflectionProbe(I);for(const I of S)I.parent&&-1===this.mI.getNodes().indexOf(I.parent)&&(I.setParent?I.setParent(null):I.parent=null)}removeAllFromScene(){this._isValidHierarchy()||i.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.mI.environmentTexture&&(this.mI.environmentTexture=null);for(const y of this.mI._serializableComponents)y.removeFromContainer(this)}removeFromScene(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const S of this.cameras)y&&!y(S)||this.mI.removeCamera(S);for(const S of this.lights)y&&!y(S)||this.mI.removeLight(S);for(const S of this.meshes)y&&!y(S)||this.mI.Gu(S,!0);for(const S of this.skeletons)y&&!y(S)||this.mI.removeSkeleton(S);for(const S of this.animations)y&&!y(S)||this.mI.removeAnimation(S);for(const S of this.animationGroups)y&&!y(S)||this.mI.removeAnimationGroup(S);for(const S of this.multiMaterials)y&&!y(S)||this.mI.removeMultiMaterial(S);for(const S of this.materials)y&&!y(S)||this.mI.removeMaterial(S);for(const S of this.morphTargetManagers)y&&!y(S)||this.mI.removeMorphTargetManager(S);for(const S of this.geometries)y&&!y(S)||this.mI.removeGeometry(S);for(const S of this.transformNodes)y&&!y(S)||this.mI.removeTransformNode(S);for(const S of this.actionManagers)y&&!y(S)||this.mI.removeActionManager(S);for(const S of this.textures)y&&!y(S)||this.mI.removeTexture(S);for(const S of this.reflectionProbes)y&&!y(S)||this.mI.removeReflectionProbe(S)}dispose(){const y=this.cameras.slice(0);for(const p of y)p.dispose();this.cameras.length=0;const S=this.lights.slice(0);for(const p of S)p.dispose();this.lights.length=0;const I=this.meshes.slice(0);for(const p of I)p.dispose();this.meshes.length=0;const V=this.skeletons.slice(0);for(const p of V)p.dispose();this.skeletons.length=0;const i=this.animationGroups.slice(0);for(const p of i)p.dispose();this.animationGroups.length=0;const A=this.multiMaterials.slice(0);for(const p of A)p.dispose();this.multiMaterials.length=0;const B=this.materials.slice(0);for(const p of B)p.dispose();this.materials.length=0;const d=this.geometries.slice(0);for(const p of d)p.dispose();this.geometries.length=0;const F=this.transformNodes.slice(0);for(const p of F)p.dispose();this.transformNodes.length=0;const J=this.actionManagers.slice(0);for(const p of J)p.dispose();this.actionManagers.length=0;const u=this.textures.slice(0);for(const p of u)p.dispose();this.textures.length=0;const K=this.reflectionProbes.slice(0);for(const p of K)p.dispose();this.reflectionProbes.length=0;const G=this.morphTargetManagers.slice(0);for(const p of G)p.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const p of this.mI._serializableComponents)p.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.mI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(y,S,I){if(y&&S)for(const V of y){let y=!0;if(I)for(const S of I)if(V===S){y=!1;break}y&&(S.push(V),V._parentContainer=this)}}moveAllFromScene(y){this._wasAddedToScene=!1,void 0===y&&(y=new l);for(const S in this)Object.prototype.hasOwnProperty.call(this,S)&&(this[S]=this[S]||("_environmentTexture"===S?null:[]),this._moveAssets(this.mI[S],this[S],y[S]));this.environmentTexture=this.mI.environmentTexture,this.removeAllFromScene()}createRootMesh(){const y=new B.c("assetContainerRootMesh",this.mI);for(const S of this.meshes)S.parent||y.addChild(S);return this.meshes.unshift(y),y}mergeAnimationsTo(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.e.LastCreatedScene,S=arguments.length>1?arguments[1]:void 0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!y)return J.b.Error("No scene available to merge animations to"),[];const V=I||(S=>{let I=null;const V=S.animations.length?S.animations[0].targetProperty:"",i=S.name.split(".").join("").split("_primitive")[0];switch(V){case"position":case"rotationQuaternion":I=y.getTransformNodeByName(S.name)||y.getTransformNodeByName(i);break;case"influence":I=y.getMorphTargetByName(S.name)||y.getMorphTargetByName(i);break;default:I=y.getNodeByName(S.name)||y.getNodeByName(i)}return I}),i=this.getNodes();for(const d of i){const y=V(d);if(null!==y){for(const S of d.animations){const I=y.animations.filter((y=>y.targetProperty===S.targetProperty));for(const S of I){const I=y.animations.indexOf(S,0);I>-1&&y.animations.splice(I,1)}}y.animations=y.animations.concat(d.animations)}}const A=[],B=this.animationGroups.slice();for(const d of B){A.push(d.clone(d.name,V));for(const y of d.animatables)y.stop()}for(const d of S){const S=V(d.target);S&&(y.beginAnimation(S,d.fromFrame,d.toFrame,d.loopAnimation,d.speedRatio,d.onAnimationEnd?d.onAnimationEnd:void 0,void 0,!0,void 0,d.onAnimationLoop?d.onAnimationLoop:void 0),y.stopAnimation(d.target))}return A}populateRootNodes(){this.rootNodes.length=0;for(const y of this.meshes)y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y);for(const y of this.transformNodes)y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y);for(const y of this.lights)y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y);for(const y of this.cameras)y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y)}addAllAssetsToContainer(y){if(!y)return;const S=[],I=new Set;for(S.push(y);S.length>0;){const y=S.pop();if(y instanceof B.c?(y.Od&&-1===this.geometries.indexOf(y.Od)&&this.geometries.push(y.Od),this.meshes.push(y)):y instanceof K.e?this.meshes.push(y):y instanceof d.d?this.transformNodes.push(y):y instanceof G.e?this.lights.push(y):y instanceof p.b&&this.cameras.push(y),y instanceof F.e){if(y.material&&-1===this.materials.indexOf(y.material)){this.materials.push(y.material);for(const S of y.material.getActiveTextures())-1===this.textures.indexOf(S)&&this.textures.push(S)}y.skeleton&&-1===this.skeletons.indexOf(y.skeleton)&&this.skeletons.push(y.skeleton),y.morphTargetManager&&-1===this.morphTargetManagers.indexOf(y.morphTargetManager)&&this.morphTargetManagers.push(y.morphTargetManager)}for(const V of y.getChildren())I.has(V)||S.push(V);I.add(y)}this.populateRootNodes()}_getByTags(y,S,I){if(void 0===S)return y;const V=[];for(const i in y){const A=y[i];L.d&&L.d.MatchesQuery(A,S)&&(!I||I(A))&&V.push(A)}return V}getMeshesByTags(y,S){return this._getByTags(this.meshes,y,S)}getCamerasByTags(y,S){return this._getByTags(this.cameras,y,S)}getLightsByTags(y,S){return this._getByTags(this.lights,y,S)}getMaterialsByTags(y,S){return this._getByTags(this.materials,y,S).concat(this._getByTags(this.multiMaterials,y,S))}getTransformNodesByTags(y,S){return this._getByTags(this.transformNodes,y,S)}}var O=I(12199);class f{constructor(y){this.byteOffset=0,this.buffer=y}async loadAsync(y){const S=await this.buffer.readAsync(this.byteOffset,y);this._dataView=new DataView(S.buffer,S.byteOffset,S.byteLength),this._dataByteOffset=0}readUint32(){const y=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,y}readUint8Array(y){const S=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,y);return this._dataByteOffset+=y,this.byteOffset+=y,S}readString(y){return(0,O.l)(this.readUint8Array(y))}skipBytes(y){this._dataByteOffset+=y,this.byteOffset+=y}}var my=I(13974);const C="Z2xURg",D={name:"ai",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:y=>-1!==y.indexOf("asset")&&-1!==y.indexOf("version")||y.startsWith("data:base64,"+C)||y.startsWith("data:;base64,"+C)||y.startsWith("data:application/octet-stream;base64,"+C)||y.startsWith("data:model/gltf-binary;base64,"+C)};var o,E,z,r=I(12193),h=I(12197);function n(y,S,I){try{return Promise.resolve(new Uint8Array(y,S,I))}catch(V){return Promise.reject(V)}}!function(y){y[y.AUTO=0]="AUTO",y[y.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(o||(o={})),function(y){y[y.NONE=0]="NONE",y[y.FIRST=1]="FIRST",y[y.ALL=2]="ALL"}(E||(E={})),function(y){y[y.LOADING=0]="LOADING",y[y.READY=1]="READY",y[y.COMPLETE=2]="COMPLETE"}(z||(z={}));class v{constructor(){this.coordinateSystemMode=o.AUTO,this.animationStartMode=E.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=y=>Promise.resolve(y),this.extensionOptions={}}A(y){y&&(this.onParsed=y.onParsed,this.coordinateSystemMode=y.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=y.animationStartMode??this.animationStartMode,this.loadNodeAnimations=y.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=y.loadSkins??this.loadSkins,this.loadMorphTargets=y.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=y.compileMaterials??this.compileMaterials,this.useClipPlane=y.useClipPlane??this.useClipPlane,this.compileShadowGenerators=y.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=y.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=y.useRangeRequests??this.useRangeRequests,this.createInstances=y.createInstances??this.createInstances,this.alwaysComputeBoundingBox=y.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=y.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=y.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=y.skipMaterials??this.skipMaterials,this.useSRGBBuffers=y.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=y.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=y.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=y.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=y.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=y.customRootNode,this.onMeshLoaded=y.onMeshLoaded,this.onSkinLoaded=y.onSkinLoaded,this.onTextureLoaded=y.onTextureLoaded,this.onMaterialLoaded=y.onMaterialLoaded,this.onCameraLoaded=y.onCameraLoaded,this.extensionOptions=y.extensionOptions??this.extensionOptions)}}class P extends v{constructor(y){super(),this.onParsedObservable=new V.b,this.onMeshLoadedObservable=new V.b,this.onSkinLoadedObservable=new V.b,this.onTextureLoadedObservable=new V.b,this.onMaterialLoadedObservable=new V.b,this.onCameraLoadedObservable=new V.b,this.onCompleteObservable=new V.b,this.onErrorObservable=new V.b,this.zi=new V.b,this.onExtensionLoadedObservable=new V.b,this.validate=!1,this.onValidatedObservable=new V.b,this._loader=null,this._state=null,this._requests=new Array,this.name=D.name,this.extensions=D.extensions,this.onLoaderStateChangedObservable=new V.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.A(y)}set onParsed(y){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),y&&(this._onParsedObserver=this.onParsedObservable.add(y))}set onMeshLoaded(y){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),y&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(y))}set onSkinLoaded(y){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),y&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((S=>y(S.node,S.skinnedNode))))}set onTextureLoaded(y){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),y&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(y))}set onMaterialLoaded(y){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),y&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(y))}set onCameraLoaded(y){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),y&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(y))}set onComplete(y){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(y)}set onError(y){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(y)}set onDispose(y){this._onDisposeObserver&&this.zi.remove(this._onDisposeObserver),this._onDisposeObserver=this.zi.add(y)}set onExtensionLoaded(y){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(y)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(y){this._loggingEnabled!==y&&(this._loggingEnabled=y,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(y){this._capturePerformanceCounters!==y&&(this._capturePerformanceCounters=y,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(y){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(y)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const y of this._requests)y.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=y=>Promise.resolve(y),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.zi.notifyObservers(void 0),this.zi.clear()}loadFile(y,S,I,A,B,d,F,u){if(ArrayBuffer.isView(S))return this._loadBinary(y,S,I,A,F,u),null;this._progressCallback=B;const K=S.name||i.Tools.GetFilename(S);if(d){if(this.useRangeRequests){this.validate&&J.b.Warn("glTF validation is not supported when range requests are enabled");const I={abort:()=>{},onCompleteObservable:new V.b},i={readAsync:(I,V)=>new Promise(((i,A)=>{this._loadFile(y,S,(y=>{i(new Uint8Array(y))}),!0,(y=>{A(y)}),(y=>{y.setRequestHeader("Range",`bytes=${I}-${I+V-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new f(i)).then((y=>{I.onCompleteObservable.notifyObservers(I),A(y)}),F?y=>F(void 0,y):void 0),I}return this._loadFile(y,S,(S=>{this._validate(y,new Uint8Array(S,0,S.byteLength),I,K),this._unpackBinaryAsync(new f({readAsync:(y,I)=>n(S,y,I),byteLength:S.byteLength})).then((y=>{A(y)}),F?y=>F(void 0,y):void 0)}),!0,F)}return this._loadFile(y,S,(S=>{try{this._validate(y,S,I,K),A({json:this._parseJson(S)})}catch{F&&F()}}),!1,F)}_loadBinary(y,S,I,V,i,A){this._validate(y,new Uint8Array(S.buffer,S.byteOffset,S.byteLength),I,A),this._unpackBinaryAsync(new f({readAsync:(y,I)=>function(y,S,I){try{if(S<0||S>=y.byteLength)throw new RangeError("Offset is out of range.");if(S+I>y.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(y.buffer,y.byteOffset+S,I))}catch(V){return Promise.reject(V)}}(S,y,I),byteLength:S.byteLength})).then((y=>{V(y)}),i?y=>i(void 0,y):void 0)}importMeshAsync(y,S,I,V,i,A){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(I),this._loader.importMeshAsync(y,S,null,I,V,i,A))))}loadAsync(y,S,I,V,i){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(S),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(S),this._loader.loadAsync(y,S,I,V,i))))}loadAssetContainerAsync(y,S,I,V,i){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(S),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(S);const A=new s(y),B=[];this.onMaterialLoadedObservable.add((y=>{B.push(y)}));const d=[];this.onTextureLoadedObservable.add((y=>{d.push(y)}));const F=[];this.onCameraLoadedObservable.add((y=>{F.push(y)}));const J=[];return this.onMeshLoadedObservable.add((y=>{y.morphTargetManager&&J.push(y.morphTargetManager)})),this._loader.importMeshAsync(null,y,A,S,I,V,i).then((y=>(Array.prototype.push.apply(A.geometries,y.geometries),Array.prototype.push.apply(A.meshes,y.meshes),Array.prototype.push.apply(A.dG,y.dG),Array.prototype.push.apply(A.skeletons,y.skeletons),Array.prototype.push.apply(A.animationGroups,y.animationGroups),Array.prototype.push.apply(A.materials,B),Array.prototype.push.apply(A.textures,d),Array.prototype.push.apply(A.lights,y.lights),Array.prototype.push.apply(A.transformNodes,y.transformNodes),Array.prototype.push.apply(A.cameras,F),Array.prototype.push.apply(A.morphTargetManagers,J),A)))}))}canDirectLoad(y){return D.canDirectLoad(y)}directLoad(y,S){if(S.startsWith("base64,"+C)||S.startsWith(";base64,"+C)||S.startsWith("application/octet-stream;base64,"+C)||S.startsWith("model/gltf-binary;base64,"+C)){const I=(0,r.b)(S);return this._validate(y,new Uint8Array(I,0,I.byteLength)),this._unpackBinaryAsync(new f({readAsync:(y,S)=>n(I,y,S),byteLength:I.byteLength}))}return this._validate(y,S),Promise.resolve({json:this._parseJson(S)})}createPlugin(y){return new P(y[D.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((y,S)=>{this.onCompleteObservable.addOnce((()=>{y()})),this.onErrorObservable.addOnce((y=>{S(y)}))}))}_setState(y){this._state!==y&&(this._state=y,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(z[this._state]))}_loadFile(y,S,I,V,i,A){const B=y._loadFile(S,I,(y=>{this._onProgress(y,B)}),!0,V,i,A);return B.onCompleteObservable.add((()=>{B._lengthComputable=!0,B._total=B._loaded})),this._requests.push(B),B}_onProgress(y,S){if(!this._progressCallback)return;S._lengthComputable=y.lengthComputable,S._loaded=y.loaded,S._total=y.total;let I=!0,V=0,i=0;for(const A of this._requests){if(void 0===A._lengthComputable||void 0===A._loaded||void 0===A._total)return;I=I&&A._lengthComputable,V+=A._loaded,i+=A._total}this._progressCallback({lengthComputable:I,loaded:V,total:I?i:0})}_validate(y,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),my.c.ValidateAsync(S,I,V,(S=>this.preprocessUrlAsync(I+S).then((S=>y._loadFileAsync(S,void 0,!0,!0).then((y=>new Uint8Array(y,0,y.byteLength))))))).then((y=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(y),this.onValidatedObservable.clear()}),(y=>{this._endPerformanceCounter("Validate JSON"),i.Tools.Warn(`Failed to validate: ${y.message}`),this.onValidatedObservable.clear()})))}_getLoader(y){const S=y.json.asset||{};this._log(`Asset version: ${S.version}`),S.minVersion&&this._log(`Asset minimum version: ${S.minVersion}`),S.generator&&this._log(`Asset generator: ${S.generator}`);const I=P._parseVersion(S.version);if(!I)throw new Error("Invalid version: "+S.version);if(void 0!==S.minVersion){const y=P._parseVersion(S.minVersion);if(!y)throw new Error("Invalid minimum version: "+S.minVersion);if(P._compareVersion(y,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+S.minVersion)}const V={1:P._CreateGLTF1Loader,2:P._CreateGLTF2Loader}[I.major];if(!V)throw new Error("Unsupported version: "+S.version);return V(this)}_parseJson(y){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${y.length}`);const S=JSON.parse(y);return this._endPerformanceCounter("Parse JSON"),S}_unpackBinaryAsync(y){return this._startPerformanceCounter("Unpack Binary"),y.loadAsync(20).then((()=>{const S=y.readUint32();if(1179937895!==S)throw new h.k("Unexpected magic: "+S,h.g.GLTFLoaderUnexpectedMagicError);const I=y.readUint32();this.loggingEnabled&&this._log(`Binary version: ${I}`);const V=y.readUint32();let i;switch(this.useRangeRequests||V===y.buffer.byteLength||J.b.Warn(`Length in header does not match actual data length: ${V} != ${y.buffer.byteLength}`),I){case 1:i=this._unpackBinaryV1Async(y,V);break;case 2:i=this._unpackBinaryV2Async(y,V);break;default:throw new Error("Unsupported version: "+I)}return this._endPerformanceCounter("Unpack Binary"),i}))}_unpackBinaryV1Async(y,S){const I=y.readUint32(),V=y.readUint32();if(0!==V)throw new Error(`Unexpected content format: ${V}`);const i=S-y.byteOffset,A={json:this._parseJson(y.readString(I)),bin:null};if(0!==i){const S=y.byteOffset;A.bin={readAsync:(I,V)=>y.buffer.readAsync(S+I,V),byteLength:i}}return Promise.resolve(A)}_unpackBinaryV2Async(y,S){const I=1313821514,V=5130562,i=y.readUint32();if(y.readUint32()!==I)throw new Error("First chunk format is not JSON");return y.byteOffset+i===S?y.loadAsync(i).then((()=>({json:this._parseJson(y.readString(i)),bin:null}))):y.loadAsync(i+8).then((()=>{const A={json:this._parseJson(y.readString(i)),bin:null},B=()=>{const i=y.readUint32();switch(y.readUint32()){case I:throw new Error("Unexpected JSON chunk");case V:{const S=y.byteOffset;A.bin={readAsync:(I,V)=>y.buffer.readAsync(S+I,V),byteLength:i},y.skipBytes(i);break}default:y.skipBytes(i)}return y.byteOffset!==S?y.loadAsync(8).then(B):Promise.resolve(A)};return B()}))}static _parseVersion(y){if("1.0"===y||"1.0.1"===y)return{major:1,minor:0};const S=(y+"").match(/^(\d+)\.(\d+)/);return S?{major:parseInt(S[1]),minor:parseInt(S[2])}:null}static _compareVersion(y,S){return y.major>S.major?1:y.major<S.major?-1:y.minor>S.minor?1:y.minor<S.minor?-1:0}_logOpen(y){this._log(y),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(y){const S=P._logSpaces.substring(0,2*this._logIndentLevel);J.b.Log(`${S}${y}`)}_logDisabled(y){}_startPerformanceCounterEnabled(y){i.Tools.StartPerformanceCounter(y)}_startPerformanceCounterDisabled(y){}_endPerformanceCounterEnabled(y){i.Tools.EndPerformanceCounter(y)}_endPerformanceCounterDisabled(y){}}P.IncrementalLoading=!0,P.HomogeneousCoordinates=!1,P._logSpaces="                                ",(0,A.e)(new P)},13974:(y,S,I)=>{"use strict";I.d(S,{c:()=>B});var V=I(12128);function i(y,S,I,V){const i={externalResourceFunction:V};return I&&(i.uri="file:"===S?I:S+I),ArrayBuffer.isView(y)?GLTFValidator.validateBytes(y,i):GLTFValidator.validateString(y,i)}function A(){const y=[];onmessage=S=>{const I=S.data;switch(I.id){case"init":importScripts(I.url);break;case"validate":i(I.data,I.rootUrl,I.fileName,(S=>new Promise(((I,V)=>{const i=y.length;y.push({resolve:I,reject:V}),postMessage({id:"getExternalResource",index:i,uri:S})})))).then((y=>{postMessage({id:"validate.resolve",value:y})}),(y=>{postMessage({id:"validate.reject",reason:y})}));break;case"getExternalResource.resolve":y[I.index].resolve(I.value);break;case"getExternalResource.reject":y[I.index].reject(I.reason)}}}class B{static ValidateAsync(y,S,I,B){return"function"===typeof Worker?new Promise(((d,F)=>{const J=`${i}(${A})()`,u=URL.createObjectURL(new Blob([J],{type:"application/javascript"})),K=new Worker(u),G=y=>{K.removeEventListener("error",G),K.removeEventListener("message",p),F(y)},p=y=>{const S=y.data;switch(S.id){case"getExternalResource":B(S.uri).then((y=>{K.postMessage({id:"getExternalResource.resolve",index:S.index,value:y},[y.buffer])}),(y=>{K.postMessage({id:"getExternalResource.reject",index:S.index,reason:y})}));break;case"validate.resolve":K.removeEventListener("error",G),K.removeEventListener("message",p),d(S.value),K.terminate();break;case"validate.reject":K.removeEventListener("error",G),K.removeEventListener("message",p),F(S.reason),K.terminate()}};if(K.addEventListener("error",G),K.addEventListener("message",p),K.postMessage({id:"init",url:V.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(y)){const V=y.slice();K.postMessage({id:"validate",data:V,rootUrl:S,fileName:I},[V.buffer])}else K.postMessage({id:"validate",data:y,rootUrl:S,fileName:I})})):(this._LoadScriptPromise||(this._LoadScriptPromise=V.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>i(y,S,I,B))))}}B.Configuration={url:`${V.Tools._DefaultCdnUrl}/gltf_validator.js`}},14521:(y,S,I)=>{"use strict";I.d(S,{c:()=>D});var V=I(12306),i=I(12309),A=I(12352),B=I(12321),d=I(12694),F=I(12631),J=I(12390),u=I(12556),K=I(12282),G=I(12240);I(13739),I(13641),I(13659),I(13646),I(13668),I(13673),I(13676);const p="imageProcessingCompatibility",L="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";G.b.IncludesShadersStore[p]||(G.b.IncludesShadersStore[p]=L);const T="skyPixelShader",l="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";G.b.ShadersStore[T]||(G.b.ShadersStore[T]=l);I(13752),I(13680),I(13689),I(13701),I(13698);const j="skyVertexShader",s="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";G.b.ShadersStore[j]||(G.b.ShadersStore[j]=s);var O=I(12625),f=I(12683),my=I(12675);class C extends d.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends F.d{constructor(y,S){super(y,S),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new B.OS(0,100,0),this.useSunPosition=!1,this.cameraOffset=B.OS.Zero(),this.up=B.OS.Up(),this.dithering=!1,this._cameraPosition=B.OS.Zero(),this._skyOrientation=new B.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(y,S){const I=S._drawWrapper;if(this.isFrozen&&I.effect&&I._wasPreviouslyReady)return!0;S.materialDefines||(S.materialDefines=new C);const V=S.materialDefines,i=this.Ey();if(this._isReadyForSubMesh(S))return!0;if((0,my.M)(y,i,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,V),(0,my.H)(y,V,!0,!1),V.IMAGEPROCESSINGPOSTPROCESS!==i.imageProcessingConfiguration.applyByPostProcess&&V.markAsMiscDirty(),V.DITHER!==this.dithering&&V.markAsMiscDirty(),V.isDirty){V.markAsProcessed(),i.resetCachedMaterial();const y=new O.e;V.FOG&&y.addFallback(1,"FOG"),V.IMAGEPROCESSINGPOSTPROCESS=i.imageProcessingConfiguration.applyByPostProcess,V.DITHER=this.dithering;const I=[J.e.PositionKind];V.VERTEXCOLOR&&I.push(J.e.ColorKind);const A="sky",B=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,f.e)(B);const d=V.toString();S.setEffect(i.getEngine().createEffect(A,I,B,[],d,y,this.onCompiled,this.onError),V,this._materialContext)}return!(!S.effect||!S.effect.isReady())&&(V._renderId=i.getRenderId(),I._wasPreviouslyReady=!0,!0)}bindForSubMesh(y,S,I){const V=this.Ey(),i=I.materialDefines;if(!i)return;const A=I.effect;if(!A)return;this._activeEffect=A,this.bindOnlyWorldMatrix(y),this._activeEffect.setMatrix("viewProjection",V.getTransformMatrix()),this._mustRebind(V,A,I)&&((0,f.f)(A,this,V),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,my.k)(i,A,V)),V.fogEnabled&&S.applyFog&&V.fogMode!==u.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",V.getViewMatrix()),(0,my.f)(V,S,this._activeEffect);const d=V.activeCamera;if(d){const y=d.getWorldMatrix();this._cameraPosition.x=y.m[12],this._cameraPosition.y=y.m[13],this._cameraPosition.z=y.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const y=Math.PI*(this.inclination-.5),S=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(S)*Math.cos(y),this.sunPosition.y=this.distance*Math.sin(-y),this.sunPosition.z=this.distance*Math.sin(S)*Math.cos(y),B.Quaternion.FromUnitVectorsToRef(B.OS.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(S,this._activeEffect,I)}getAnimatables(){return[]}dispose(y){super.dispose(y)}clone(y){return A.d.Clone((()=>new D(y,this.Ey())),this)}serialize(){const y=super.serialize();return y.customType="BABYLON.SkyMaterial",y}getClassName(){return"SkyMaterial"}static Parse(y,S,I){return A.d.Parse((()=>new D(y.name,S)),y,S,I)}}(0,V.c)([(0,i.E)()],D.prototype,"luminance",void 0),(0,V.c)([(0,i.E)()],D.prototype,"turbidity",void 0),(0,V.c)([(0,i.E)()],D.prototype,"rayleigh",void 0),(0,V.c)([(0,i.E)()],D.prototype,"mieCoefficient",void 0),(0,V.c)([(0,i.E)()],D.prototype,"mieDirectionalG",void 0),(0,V.c)([(0,i.E)()],D.prototype,"distance",void 0),(0,V.c)([(0,i.E)()],D.prototype,"inclination",void 0),(0,V.c)([(0,i.E)()],D.prototype,"azimuth",void 0),(0,V.c)([(0,i.D)()],D.prototype,"sunPosition",void 0),(0,V.c)([(0,i.E)()],D.prototype,"useSunPosition",void 0),(0,V.c)([(0,i.D)()],D.prototype,"cameraOffset",void 0),(0,V.c)([(0,i.D)()],D.prototype,"up",void 0),(0,V.c)([(0,i.E)()],D.prototype,"dithering",void 0),(0,K.e)("BABYLON.SkyMaterial",D)},13008:(y,S,I)=>{"use strict";function V(y,S){S.headers=y.headers||{},S.statusMessage=y.statusText,S.statusCode=y.status,S.data=y.response}function i(y,S,I){return new Promise((function(i,A){I=I||{};var B,d,F,J=new XMLHttpRequest,u=I.body,K=I.headers||{};for(B in I.timeout&&(J.timeout=I.timeout),J.ontimeout=J.onerror=function(y){y.timeout="timeout"==y.type,A(y)},J.open(y,S.href||S),J.onload=function(){for(F=J.getAllResponseHeaders().trim().split(/[\r\n]+/),V(J,J);d=F.shift();)d=d.split(": "),J.headers[d.shift().toLowerCase()]=d.join(": ");if((d=J.headers["content-type"])&&~d.indexOf("application/json"))try{J.data=JSON.parse(J.data,I.reviver)}catch(y){return V(J,y),A(y)}(J.status>=400?A:i)(J)},typeof FormData<"u"&&u instanceof FormData||u&&"object"==typeof u&&(K["content-type"]="application/json",u=JSON.stringify(u)),J.withCredentials=!!I.withCredentials,K)J.setRequestHeader(B,K[B]);J.send(u)}))}I.r(S),I.d(S,{del:()=>F,get:()=>A,patch:()=>d,post:()=>B,put:()=>J,send:()=>i});var A=i.bind(i,"GET"),B=i.bind(i,"POST"),d=i.bind(i,"PATCH"),F=i.bind(i,"DELETE"),J=i.bind(i,"PUT")},14617:(y,S,I)=>{"use strict";I.d(S,{e:()=>K});const V=.5*(Math.sqrt(3)-1),i=(3-Math.sqrt(3))/6,A=1/3,B=1/6,d=(Math.sqrt(5)-1)/4,F=(5-Math.sqrt(5))/20,J=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),u=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const K=class{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const S="function"==typeof y?y:function(y){let S=0,I=0,V=0,i=1;const A=function(){let y=4022871197;return function(S){S=S.toString();for(let I=0;I<S.length;I++){y+=S.charCodeAt(I);let V=.02519603282416938*y;y=V>>>0,V-=y,V*=y,y=V>>>0,V-=y,y+=4294967296*V}return 2.3283064365386963e-10*(y>>>0)}}();S=A(" "),I=A(" "),V=A(" "),S-=A(y),S<0&&(S+=1);I-=A(y),I<0&&(I+=1);V-=A(y),V<0&&(V+=1);return function(){const y=2091639*S+2.3283064365386963e-10*i;return S=I,I=V,V=y-(i=0|y)}}(y);this.p=function(y){const S=new Uint8Array(256);for(let I=0;I<256;I++)S[I]=I;for(let I=0;I<255;I++){const V=I+~~(y()*(256-I)),i=S[I];S[I]=S[V],S[V]=i}return S}(S),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let I=0;I<512;I++)this.perm[I]=this.p[255&I],this.permMod12[I]=this.perm[I]%12}noise2D(y,S){const I=this.permMod12,A=this.perm;let B=0,d=0,F=0;const u=(y+S)*V,K=Math.floor(y+u),G=Math.floor(S+u),p=(K+G)*i,L=y-(K-p),T=S-(G-p);let l,j;L>T?(l=1,j=0):(l=0,j=1);const s=L-l+i,O=T-j+i,f=L-1+2*i,my=T-1+2*i,C=255&K,D=255&G;let o=.5-L*L-T*T;if(o>=0){const y=3*I[C+A[D]];o*=o,B=o*o*(J[y]*L+J[y+1]*T)}let E=.5-s*s-O*O;if(E>=0){const y=3*I[C+l+A[D+j]];E*=E,d=E*E*(J[y]*s+J[y+1]*O)}let z=.5-f*f-my*my;if(z>=0){const y=3*I[C+1+A[D+1]];z*=z,F=z*z*(J[y]*f+J[y+1]*my)}return 70*(B+d+F)}noise3D(y,S,I){const V=this.permMod12,i=this.perm;let d,F,u,K;const G=(y+S+I)*A,p=Math.floor(y+G),L=Math.floor(S+G),T=Math.floor(I+G),l=(p+L+T)*B,j=y-(p-l),s=S-(L-l),O=I-(T-l);let f,my,C,D,o,E;j>=s?s>=O?(f=1,my=0,C=0,D=1,o=1,E=0):j>=O?(f=1,my=0,C=0,D=1,o=0,E=1):(f=0,my=0,C=1,D=1,o=0,E=1):s<O?(f=0,my=0,C=1,D=0,o=1,E=1):j<O?(f=0,my=1,C=0,D=0,o=1,E=1):(f=0,my=1,C=0,D=1,o=1,E=0);const z=j-f+B,r=s-my+B,h=O-C+B,n=j-D+2*B,v=s-o+2*B,P=O-E+2*B,q=j-1+.5,g=s-1+.5,k=O-1+.5,R=255&p,b=255&L,U=255&T;let W=.6-j*j-s*s-O*O;if(W<0)d=0;else{const y=3*V[R+i[b+i[U]]];W*=W,d=W*W*(J[y]*j+J[y+1]*s+J[y+2]*O)}let a=.6-z*z-r*r-h*h;if(a<0)F=0;else{const y=3*V[R+f+i[b+my+i[U+C]]];a*=a,F=a*a*(J[y]*z+J[y+1]*r+J[y+2]*h)}let e=.6-n*n-v*v-P*P;if(e<0)u=0;else{const y=3*V[R+D+i[b+o+i[U+E]]];e*=e,u=e*e*(J[y]*n+J[y+1]*v+J[y+2]*P)}let x=.6-q*q-g*g-k*k;if(x<0)K=0;else{const y=3*V[R+1+i[b+1+i[U+1]]];x*=x,K=x*x*(J[y]*q+J[y+1]*g+J[y+2]*k)}return 32*(d+F+u+K)}noise4D(y,S,I,V){const i=this.perm;let A,B,J,K,G;const p=(y+S+I+V)*d,L=Math.floor(y+p),T=Math.floor(S+p),l=Math.floor(I+p),j=Math.floor(V+p),s=(L+T+l+j)*F,O=y-(L-s),f=S-(T-s),my=I-(l-s),C=V-(j-s);let D=0,o=0,E=0,z=0;O>f?D++:o++,O>my?D++:E++,O>C?D++:z++,f>my?o++:E++,f>C?o++:z++,my>C?E++:z++;const r=D>=3?1:0,h=o>=3?1:0,n=E>=3?1:0,v=z>=3?1:0,P=D>=2?1:0,q=o>=2?1:0,g=E>=2?1:0,k=z>=2?1:0,R=D>=1?1:0,b=o>=1?1:0,U=E>=1?1:0,W=z>=1?1:0,a=O-r+F,e=f-h+F,x=my-n+F,Q=C-v+F,c=O-P+2*F,X=f-q+2*F,M=my-g+2*F,t=C-k+2*F,N=O-R+3*F,Y=f-b+3*F,H=my-U+3*F,Z=C-W+3*F,w=O-1+4*F,yy=f-1+4*F,Sy=my-1+4*F,Iy=C-1+4*F,Vy=255&L,iy=255&T,Ay=255&l,By=255&j;let dy=.6-O*O-f*f-my*my-C*C;if(dy<0)A=0;else{const y=i[Vy+i[iy+i[Ay+i[By]]]]%32*4;dy*=dy,A=dy*dy*(u[y]*O+u[y+1]*f+u[y+2]*my+u[y+3]*C)}let Fy=.6-a*a-e*e-x*x-Q*Q;if(Fy<0)B=0;else{const y=i[Vy+r+i[iy+h+i[Ay+n+i[By+v]]]]%32*4;Fy*=Fy,B=Fy*Fy*(u[y]*a+u[y+1]*e+u[y+2]*x+u[y+3]*Q)}let Jy=.6-c*c-X*X-M*M-t*t;if(Jy<0)J=0;else{const y=i[Vy+P+i[iy+q+i[Ay+g+i[By+k]]]]%32*4;Jy*=Jy,J=Jy*Jy*(u[y]*c+u[y+1]*X+u[y+2]*M+u[y+3]*t)}let uy=.6-N*N-Y*Y-H*H-Z*Z;if(uy<0)K=0;else{const y=i[Vy+R+i[iy+b+i[Ay+U+i[By+W]]]]%32*4;uy*=uy,K=uy*uy*(u[y]*N+u[y+1]*Y+u[y+2]*H+u[y+3]*Z)}let Ky=.6-w*w-yy*yy-Sy*Sy-Iy*Iy;if(Ky<0)G=0;else{const y=i[Vy+1+i[iy+1+i[Ay+1+i[By+1]]]]%32*4;Ky*=Ky,G=Ky*Ky*(u[y]*w+u[y+1]*yy+u[y+2]*Sy+u[y+3]*Iy)}return 27*(A+B+J+K+G)}}}}]);