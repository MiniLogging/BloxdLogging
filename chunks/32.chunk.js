/*! For license information please see 850dck.32.5a00b780.chunk.js.LICENSE.txt */
(self.nyfa010khv=self.nyfa010khv||[]).push([[32],{14137:(L,r,p)=>{"use strict";var J=p(14144),i=p(14152),n=p(14156);p.g.__TYPEDARRAY_POOL||(p.g.__TYPEDARRAY_POOL={UINT8:i([32,0]),UINT16:i([32,0]),UINT32:i([32,0]),INT8:i([32,0]),INT16:i([32,0]),INT32:i([32,0]),FLOAT:i([32,0]),DOUBLE:i([32,0]),DATA:i([32,0]),UINT8C:i([32,0]),BUFFER:i([32,0])});var j="undefined"!==typeof Uint8ClampedArray,z=p.g.__TYPEDARRAY_POOL;z.UINT8C||(z.UINT8C=i([32,0])),z.BUFFER||(z.BUFFER=i([32,0]));var G=z.DATA,C=z.BUFFER;function t(L){if(L){var r=L.length||L.byteLength,p=J.log2(r);G[p].push(L)}}function E(L){L=J.nextPow2(L);var r=J.log2(L),p=G[r];return p.length>0?p.pop():new ArrayBuffer(L)}function x(L){return new Uint8Array(E(L),0,L)}function w(L){return new Uint16Array(E(2*L),0,L)}function g(L){return new Uint32Array(E(4*L),0,L)}function b(L){return new Int8Array(E(L),0,L)}function c(L){return new Int16Array(E(2*L),0,L)}function P(L){return new Int32Array(E(4*L),0,L)}function O(L){return new Float32Array(E(4*L),0,L)}function h(L){return new Float64Array(E(8*L),0,L)}function U(L){return j?new Uint8ClampedArray(E(L),0,L):x(L)}function W(L){return new DataView(E(L),0,L)}r.free=function(L){if(n(L))C[J.log2(L.length)].push(L);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(L)&&(L=L.buffer),!L)return;var r=L.length||L.byteLength,p=0|J.log2(r);G[p].push(L)}},r.freeUint8=r.freeUint16=r.freeUint32=r.freeInt8=r.freeInt16=r.freeInt32=r.freeFloat32=r.freeFloat=r.freeFloat64=r.freeDouble=r.freeUint8Clamped=r.freeDataView=function(L){t(L.buffer)},r.freeArrayBuffer=t,r.freeBuffer=function(L){C[J.log2(L.length)].push(L)},r.malloc=function(L,r){if(void 0===r||"arraybuffer"===r)return E(L);switch(r){case"uint8":return x(L);case"uint16":return w(L);case"uint32":return g(L);case"int8":return b(L);case"int16":return c(L);case"int32":return P(L);case"float":case"float32":return O(L);case"double":case"float64":return h(L);case"uint8_clamped":return U(L);case"buffer":throw"Buffer not supported";case"data":case"dataview":return W(L);default:return null}return null},r.mallocArrayBuffer=E,r.mallocUint8=x,r.mallocUint16=w,r.mallocUint32=g,r.mallocInt8=b,r.mallocInt16=c,r.mallocInt32=P,r.mallocFloat32=r.mallocFloat=O,r.mallocFloat64=r.mallocDouble=h,r.mallocUint8Clamped=U,r.mallocDataView=W,r.clearCache=function(){for(var L=0;L<32;++L)z.UINT8[L].length=0,z.UINT16[L].length=0,z.UINT32[L].length=0,z.INT8[L].length=0,z.INT16[L].length=0,z.INT32[L].length=0,z.FLOAT[L].length=0,z.DOUBLE[L].length=0,z.UINT8C[L].length=0,G[L].length=0,C[L].length=0}},14221:(L,r,p)=>{L.exports=i;var J=p(12923);function i(L,r){if(!(this instanceof i))return new i(L,r);var p=J.create();J.add(p,L,r),this.base=J.min(J.create(),L,p),this.SC=J.clone(r),this.max=J.max(J.create(),L,p),this.mag=J.length(this.SC)}var n=i.prototype;n.width=function(){return this.SC[0]},n.height=function(){return this.SC[1]},n.depth=function(){return this.SC[2]},n.x0=function(){return this.base[0]},n.y0=function(){return this.base[1]},n.z0=function(){return this.base[2]},n.x1=function(){return this.max[0]},n.y1=function(){return this.max[1]},n.z1=function(){return this.max[2]},n.translate=function(L){return J.add(this.max,this.max,L),J.add(this.base,this.base,L),this},n.setPosition=function(L){return J.add(this.max,L,this.SC),J.k(this.base,L),this},n.expand=function(L){var r=J.create(),p=J.create();return J.max(r,L.max,this.max),J.min(p,L.base,this.base),J.Pr(r,r,p),new i(p,r)},n.intersects=function(L){return!(L.base[0]>this.max[0])&&(!(L.base[1]>this.max[1])&&(!(L.base[2]>this.max[2])&&(!(L.max[0]<this.base[0])&&(!(L.max[1]<this.base[1])&&!(L.max[2]<this.base[2])))))},n.touches=function(L){var r=this.union(L);return null!==r&&(0==r.width()||0==r.height()||0==r.depth())},n.union=function(L){if(!this.intersects(L))return null;var r=Math.max(L.base[0],this.base[0]),p=Math.max(L.base[1],this.base[1]),J=Math.max(L.base[2],this.base[2]);return new i([r,p,J],[Math.min(L.max[0],this.max[0])-r,Math.min(L.max[1],this.max[1])-p,Math.min(L.max[2],this.max[2])-J])}},14144:(L,r)=>{"use strict";function p(L){var r=32;return(L&=-L)&&r--,65535&L&&(r-=16),16711935&L&&(r-=8),252645135&L&&(r-=4),858993459&L&&(r-=2),1431655765&L&&(r-=1),r}r.INT_BITS=32,r.INT_MAX=2147483647,r.INT_MIN=-1<<31,r.sign=function(L){return(L>0)-(L<0)},r.abs=function(L){var r=L>>31;return(L^r)-r},r.min=function(L,r){return r^(L^r)&-(L<r)},r.max=function(L,r){return L^(L^r)&-(L<r)},r.isPow2=function(L){return!(L&L-1)&&!!L},r.log2=function(L){var r,p;return r=(L>65535)<<4,r|=p=((L>>>=r)>255)<<3,r|=p=((L>>>=p)>15)<<2,(r|=p=((L>>>=p)>3)<<1)|(L>>>=p)>>1},r.log10=function(L){return L>=1e9?9:L>=1e8?8:L>=1e7?7:L>=1e6?6:L>=1e5?5:L>=1e4?4:L>=1e3?3:L>=100?2:L>=10?1:0},r.popCount=function(L){return 16843009*((L=(858993459&(L-=L>>>1&1431655765))+(L>>>2&858993459))+(L>>>4)&252645135)>>>24},r.countTrailingZeros=p,r.nextPow2=function(L){return L+=0===L,--L,L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)+1},r.prevPow2=function(L){return L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)-(L>>>1)},r.parity=function(L){return L^=L>>>16,L^=L>>>8,L^=L>>>4,27030>>>(L&=15)&1};var J=new Array(256);!function(L){for(var r=0;r<256;++r){var p=r,J=r,i=7;for(p>>>=1;p;p>>>=1)J<<=1,J|=1&p,--i;L[r]=J<<i&255}}(J),r.reverse=function(L){return J[255&L]<<24|J[L>>>8&255]<<16|J[L>>>16&255]<<8|J[L>>>24&255]},r.interleave2=function(L,r){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L&=65535)|L<<8))|L<<4))|L<<2))|L<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r&=65535)|r<<8))|r<<4))|r<<2))|r<<1))<<1},r.deinterleave2=function(L,r){return(L=65535&((L=16711935&((L=252645135&((L=858993459&((L=L>>>r&1431655765)|L>>>1))|L>>>2))|L>>>4))|L>>>16))<<16>>16},r.interleave3=function(L,r,p){return L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2),(L|=(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<1)|(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<2},r.deinterleave3=function(L,r){return(L=1023&((L=4278190335&((L=251719695&((L=3272356035&((L=L>>>r&1227133513)|L>>>2))|L>>>4))|L>>>8))|L>>>16))<<22>>22},r.nextCombination=function(L){var r=L|L-1;return r+1|(~r&-~r)-1>>>p(L)+1}},14130:(L,r,p)=>{"use strict";L.exports=function(L,r,p){switch(arguments.length){case 1:return J=[],C(i=L,i,t,!0),J;case 2:return"function"===typeof r?C(L,L,r,!0):function(L,r){return J=[],C(L,r,t,!1),J}(L,r);case 3:return C(L,r,p,!1);default:throw new Error("box-intersect: Invalid arguments")}var i};var J,i=p(14137),n=p(14161),j=p(14171);function z(L,r){for(var p=0;p<L;++p)if(!(r[p]<=r[p+L]))return!0;return!1}function G(L,r,p,J){for(var i=0,n=0,j=0,G=L.length;j<G;++j){var C=L[j];if(!z(r,C)){for(var t=0;t<2*r;++t)p[i++]=C[t];J[n++]=j}}return n}function C(L,r,p,J){var z=L.length,C=r.length;if(!(z<=0||C<=0)){var t=L[0].length>>>1;if(!(t<=0)){var E,x=i.mallocDouble(2*t*z),w=i.mallocInt32(z);if((z=G(L,t,x,w))>0){if(1===t&&J)n.init(z),E=n.sweepComplete(t,p,0,z,x,w,0,z,x,w);else{var g=i.mallocDouble(2*t*C),b=i.mallocInt32(C);(C=G(r,t,g,b))>0&&(n.init(z+C),E=1===t?n.sweepBipartite(t,p,0,z,x,w,0,C,g,b):j(t,p,J,z,x,w,C,g,b),i.free(g),i.free(b))}i.free(x),i.free(w)}return E}}}function t(L,r){J.push([L,r])}},14179:(L,r)=>{"use strict";var p="d",J="ax",i="fp",n="es",j="rs",z="re",G="rb",C="bs",t="be",E="bb",x=[p,J,"vv",j,z,G,"ri",C,t,E,"bi"];function w(L){var r="bruteForce"+(L?"Full":"Partial"),J=[],j=x.slice();L||j.splice(3,0,i);var z=["function "+r+"("+j.join()+"){"];function G(r,i){var j=function(L,r,J){var i="bruteForce"+(L?"Red":"Blue")+(r?"Flip":"")+(J?"Full":""),j=["function ",i,"(",x.join(),"){","var ",n,"=2*",p,";"],z="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",G="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(J?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return L?j.push(z,"Q",":",G):j.push(G,"Q",":",z),J?j.push("if(y1<x0||x1<y0)continue;"):r?j.push("if(y0<=x0||x1<y0)continue;"):j.push("if(y0<x0||x1<y0)continue;"),j.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),r?j.push("yi,xi"):j.push("xi,yi"),j.push(");if(rv!==void 0)return rv;}}}"),{name:i,code:j.join("")}}(r,i,L);J.push(j.code),z.push("return "+j.name+"("+x.join()+");")}z.push("if(re-rs>be-bs){"),L?(G(!0,!1),z.push("}else{"),G(!1,!1)):(z.push("if(fp){"),G(!0,!0),z.push("}else{"),G(!0,!1),z.push("}}else{if(fp){"),G(!1,!0),z.push("}else{"),G(!1,!1),z.push("}")),z.push("}}return "+r);var C=J.join("")+z.join("");return new Function(C)()}r.partial=w(!1),r.full=w(!0)},14171:(L,r,p)=>{"use strict";L.exports=function(L,r,p,n,t,y,A,u,a){!function(L,r){var p=8*i.log2(r+1)*(L+1)|0,n=i.nextPow2(U*p);B.length<n&&(J.free(B),B=J.mallocInt32(n));var j=i.nextPow2(W*p);F.length<j&&(J.free(F),F=J.mallocDouble(j))}(L,n+A);var q,Z=0,X=2*L;Q(Z++,0,0,n,0,A,p?16:0,-1/0,1/0),p||Q(Z++,0,0,A,0,n,1,-1/0,1/0);for(;Z>0;){var D=(Z-=1)*U,l=B[D],T=B[D+1],Y=B[D+2],M=B[D+3],f=B[D+4],d=B[D+5],s=Z*W,H=F[s],o=F[s+1],k=1&d,R=!!(16&d),I=t,N=y,K=u,mL=a;if(k&&(I=u,N=a,K=t,mL=y),!(2&d&&T>=(Y=c(L,l,T,Y,I,N,o)))&&!(4&d&&(T=P(L,l,T,Y,I,N,H))>=Y)){var V=Y-T,S=f-M;if(R){if(L*V*(V+S)<w){if(void 0!==(q=G.scanComplete(L,l,r,T,Y,I,N,M,f,K,mL)))return q;continue}}else{if(L*Math.min(V,S)<E){if(void 0!==(q=j(L,l,r,k,T,Y,I,N,M,f,K,mL)))return q;continue}if(L*V*S<x){if(void 0!==(q=G.scanBipartite(L,l,r,k,T,Y,I,N,M,f,K,mL)))return q;continue}}var LL=g(L,l,T,Y,I,N,H,o);if(T<LL)if(L*(LL-T)<E){if(void 0!==(q=z(L,l+1,r,T,LL,I,N,M,f,K,mL)))return q}else if(l===L-2){if(void 0!==(q=k?G.sweepBipartite(L,r,M,f,K,mL,T,LL,I,N):G.sweepBipartite(L,r,T,LL,I,N,M,f,K,mL)))return q}else Q(Z++,l+1,T,LL,M,f,k,-1/0,1/0),Q(Z++,l+1,M,f,T,LL,1^k,-1/0,1/0);if(LL<Y){var rL=C(L,l,M,f,K,mL),pL=K[X*rL+l],JL=b(L,l,rL,f,K,mL,pL);if(JL<f&&Q(Z++,l,LL,Y,JL,f,(4|k)+(R?16:0),pL,o),M<rL&&Q(Z++,l,LL,Y,M,rL,(2|k)+(R?16:0),H,pL),rL+1===JL){if(void 0!==(q=R?v(L,l,r,LL,Y,I,N,rL,K,mL[rL]):e(L,l,r,k,LL,Y,I,N,rL,K,mL[rL])))return q}else if(rL<JL){var iL;if(R){if(LL<(iL=O(L,l,LL,Y,I,N,pL))){var nL=b(L,l,LL,iL,I,N,pL);if(l===L-2){if(LL<nL&&void 0!==(q=G.sweepComplete(L,r,LL,nL,I,N,rL,JL,K,mL)))return q;if(nL<iL&&void 0!==(q=G.sweepBipartite(L,r,nL,iL,I,N,rL,JL,K,mL)))return q}else LL<nL&&Q(Z++,l+1,LL,nL,rL,JL,16,-1/0,1/0),nL<iL&&(Q(Z++,l+1,nL,iL,rL,JL,0,-1/0,1/0),Q(Z++,l+1,rL,JL,nL,iL,1,-1/0,1/0))}}else LL<(iL=k?h(L,l,LL,Y,I,N,pL):O(L,l,LL,Y,I,N,pL))&&(l===L-2?q=k?G.sweepBipartite(L,r,rL,JL,K,mL,LL,iL,I,N):G.sweepBipartite(L,r,LL,iL,I,N,rL,JL,K,mL):(Q(Z++,l+1,LL,iL,rL,JL,k,-1/0,1/0),Q(Z++,l+1,rL,JL,LL,iL,1^k,-1/0,1/0)))}}}}};var J=p(14137),i=p(14144),n=p(14179),j=n.partial,z=n.full,G=p(14161),C=p(14183),t=p(14188),E=128,x=1<<22,w=1<<22,g=t("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),b=t("lo===p0",["p0"]),c=t("lo<p0",["p0"]),P=t("hi<=p0",["p0"]),O=t("lo<=p0&&p0<=hi",["p0"]),h=t("lo<p0&&p0<=hi",["p0"]),U=6,W=2,B=J.mallocInt32(1024),F=J.mallocDouble(1024);function Q(L,r,p,J,i,n,j,z,G){var C=U*L;B[C]=r,B[C+1]=p,B[C+2]=J,B[C+3]=i,B[C+4]=n,B[C+5]=j;var t=W*L;F[t]=z,F[t+1]=G}function e(L,r,p,J,i,n,j,z,G,C,t){var E=2*L,x=G*E,w=C[x+r];L:for(var g=i,b=i*E;g<n;++g,b+=E){var c=j[b+r],P=j[b+r+L];if(!(w<c||P<w)&&(!J||w!==c)){for(var O,h=z[g],U=r+1;U<L;++U){c=j[b+U],P=j[b+U+L];var W=C[x+U],B=C[x+U+L];if(P<W||B<c)continue L}if(void 0!==(O=J?p(t,h):p(h,t)))return O}}}function v(L,r,p,J,i,n,j,z,G,C){var t=2*L,E=z*t,x=G[E+r];L:for(var w=J,g=J*t;w<i;++w,g+=t){var b=j[w];if(b!==C){var c=n[g+r],P=n[g+r+L];if(!(x<c||P<x)){for(var O=r+1;O<L;++O){c=n[g+O],P=n[g+O+L];var h=G[E+O],U=G[E+O+L];if(P<h||U<c)continue L}var W=p(b,C);if(void 0!==W)return W}}}}},14183:(L,r,p)=>{"use strict";L.exports=function(L,r,p,j,z,G){if(j<=p+1)return p;var C=p,t=j,E=j+p>>>1,x=2*L,w=E,g=z[x*E+r];for(;C<t;){if(t-C<i){n(L,r,C,t,z,G),g=z[x*E+r];break}var b=t-C,c=Math.random()*b+C|0,P=z[x*c+r],O=Math.random()*b+C|0,h=z[x*O+r],U=Math.random()*b+C|0,W=z[x*U+r];P<=h?W>=h?(w=O,g=h):P>=W?(w=c,g=P):(w=U,g=W):h>=W?(w=O,g=h):W>=P?(w=c,g=P):(w=U,g=W);for(var B=x*(t-1),F=x*w,Q=0;Q<x;++Q,++B,++F){var e=z[B];z[B]=z[F],z[F]=e}var v=G[t-1];G[t-1]=G[w],G[w]=v;for(B=x*(t-1),F=x*(w=J(L,r,C,t-1,z,G,g)),Q=0;Q<x;++Q,++B,++F){e=z[B];z[B]=z[F],z[F]=e}v=G[t-1];if(G[t-1]=G[w],G[w]=v,E<w){for(t=w-1;C<t&&z[x*(t-1)+r]===g;)t-=1;t+=1}else{if(!(w<E))break;for(C=w+1;C<t&&z[x*C+r]===g;)C+=1}}return J(L,r,p,E,z,G,z[x*E+r])};var J=p(14188)("lo<p0",["p0"]),i=8;function n(L,r,p,J,i,n){for(var j=2*L,z=j*(p+1)+r,G=p+1;G<J;++G,z+=j)for(var C=i[z],t=G,E=j*(G-1);t>p&&i[E+r]>C;--t,E-=j){for(var x=E,w=E+j,g=0;g<j;++g,++x,++w){var b=i[x];i[x]=i[w],i[w]=b}var c=n[t];n[t]=n[t-1],n[t-1]=c}}},14188:L=>{"use strict";L.exports=function(L,p){var J="abcdef".split("").concat(p),i=[];L.indexOf("lo")>=0&&i.push("lo=e[k+n]");L.indexOf("hi")>=0&&i.push("hi=e[k+o]");return J.push(r.replace("_",i.join()).replace("$",L)),Function.apply(void 0,J)};var r="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14168:L=>{"use strict";L.exports=function(L,J){J<=4*r?p(0,J-1,L):C(0,J-1,L)};var r=32;function p(L,r,p){for(var J=2*(L+1),i=L+1;i<=r;++i){for(var n=p[J++],j=p[J++],z=i,G=J-2;z-- >L;){var C=p[G-2],t=p[G-1];if(C<n)break;if(C===n&&t<j)break;p[G]=C,p[G+1]=t,G-=2}p[G]=n,p[G+1]=j}}function J(L,r,p){r*=2;var J=p[L*=2],i=p[L+1];p[L]=p[r],p[L+1]=p[r+1],p[r]=J,p[r+1]=i}function i(L,r,p){r*=2,p[L*=2]=p[r],p[L+1]=p[r+1]}function n(L,r,p,J){r*=2,p*=2;var i=J[L*=2],n=J[L+1];J[L]=J[r],J[L+1]=J[r+1],J[r]=J[p],J[r+1]=J[p+1],J[p]=i,J[p+1]=n}function j(L,r,p,J,i){r*=2,i[L*=2]=i[r],i[r]=p,i[L+1]=i[r+1],i[r+1]=J}function z(L,r,p){r*=2;var J=p[L*=2],i=p[r];return!(J<i)&&(J!==i||p[L+1]>p[r+1])}function G(L,r,p,J){var i=J[L*=2];return i<r||i===r&&J[L+1]<p}function C(L,t,E){var x=(t-L+1)/6|0,w=L+x,g=t-x,b=L+t>>1,c=b-x,P=b+x,O=w,h=c,U=b,W=P,B=g,F=L+1,Q=t-1,e=0;z(O,h,E)&&(e=O,O=h,h=e),z(W,B,E)&&(e=W,W=B,B=e),z(O,U,E)&&(e=O,O=U,U=e),z(h,U,E)&&(e=h,h=U,U=e),z(O,W,E)&&(e=O,O=W,W=e),z(U,W,E)&&(e=U,U=W,W=e),z(h,B,E)&&(e=h,h=B,B=e),z(h,U,E)&&(e=h,h=U,U=e),z(W,B,E)&&(e=W,W=B,B=e);for(var v=E[2*h],y=E[2*h+1],A=E[2*W],u=E[2*W+1],a=2*O,q=2*U,Z=2*B,X=2*w,D=2*b,l=2*g,T=0;T<2;++T){var Y=E[a+T],M=E[q+T],f=E[Z+T];E[X+T]=Y,E[D+T]=M,E[l+T]=f}i(c,L,E),i(P,t,E);for(var d=F;d<=Q;++d)if(G(d,v,y,E))d!==F&&J(d,F,E),++F;else if(!G(d,A,u,E))for(;;){if(G(Q,A,u,E)){G(Q,v,y,E)?(n(d,F,Q,E),++F,--Q):(J(d,Q,E),--Q);break}if(--Q<d)break}j(L,F-1,v,y,E),j(t,Q+1,A,u,E),F-2-L<=r?p(L,F-2,E):C(L,F-2,E),t-(Q+2)<=r?p(Q+2,t,E):C(Q+2,t,E),Q-F<=r?p(F,Q,E):C(F,Q,E)}},14161:(L,r,p)=>{"use strict";L.exports={init:function(L){var r=i.nextPow2(L);G.length<r&&(J.free(G),G=J.mallocInt32(r));C.length<r&&(J.free(C),C=J.mallocInt32(r));t.length<r&&(J.free(t),t=J.mallocInt32(r));E.length<r&&(J.free(E),E=J.mallocInt32(r));x.length<r&&(J.free(x),x=J.mallocInt32(r));w.length<r&&(J.free(w),w=J.mallocInt32(r));var p=8*r;g.length<p&&(J.free(g),g=J.mallocDouble(p))},sweepBipartite:function(L,r,p,J,i,z,x,w,P,O){for(var h=0,U=2*L,W=L-1,B=U-1,F=p;F<J;++F){var Q=z[F],e=U*F;g[h++]=i[e+W],g[h++]=-(Q+1),g[h++]=i[e+B],g[h++]=Q}for(F=x;F<w;++F){Q=O[F]+j;var v=U*F;g[h++]=P[v+W],g[h++]=-Q,g[h++]=P[v+B],g[h++]=Q}var y=h>>>1;n(g,y);var A=0,u=0;for(F=0;F<y;++F){var a=0|g[2*F+1];if(a>=j)b(t,E,u--,a=a-j|0);else if(a>=0)b(G,C,A--,a);else if(a<=-j){a=-a-j|0;for(var q=0;q<A;++q){if(void 0!==(Z=r(G[q],a)))return Z}c(t,E,u++,a)}else{a=-a-1|0;for(q=0;q<u;++q){var Z;if(void 0!==(Z=r(a,t[q])))return Z}c(G,C,A++,a)}}},sweepComplete:function(L,r,p,J,i,j,z,P,O,h){for(var U=0,W=2*L,B=L-1,F=W-1,Q=p;Q<J;++Q){var e=j[Q]+1<<1,v=W*Q;g[U++]=i[v+B],g[U++]=-e,g[U++]=i[v+F],g[U++]=e}for(Q=z;Q<P;++Q){e=h[Q]+1<<1;var y=W*Q;g[U++]=O[y+B],g[U++]=1|-e,g[U++]=O[y+F],g[U++]=1|e}var A=U>>>1;n(g,A);var u=0,a=0,q=0;for(Q=0;Q<A;++Q){var Z=0|g[2*Q+1],X=1&Z;if(Q<A-1&&Z>>1===g[2*Q+3]>>1&&(X=2,Q+=1),Z<0){for(var D=-(Z>>1)-1,l=0;l<q;++l){if(void 0!==(T=r(x[l],D)))return T}if(0!==X)for(l=0;l<u;++l){if(void 0!==(T=r(G[l],D)))return T}if(1!==X)for(l=0;l<a;++l){var T;if(void 0!==(T=r(t[l],D)))return T}0===X?c(G,C,u++,D):1===X?c(t,E,a++,D):2===X&&c(x,w,q++,D)}else{D=(Z>>1)-1;0===X?b(G,C,u--,D):1===X?b(t,E,a--,D):2===X&&b(x,w,q--,D)}}},scanBipartite:function(L,r,p,J,i,z,t,E,x,w,P,O){var h=0,U=2*L,W=r,B=r+L,F=1,Q=1;J?Q=j:F=j;for(var e=i;e<z;++e){var v=e+F,y=U*e;g[h++]=t[y+W],g[h++]=-v,g[h++]=t[y+B],g[h++]=v}for(e=x;e<w;++e){v=e+Q;var A=U*e;g[h++]=P[A+W],g[h++]=-v}var u=h>>>1;n(g,u);var a=0;for(e=0;e<u;++e){var q=0|g[2*e+1];if(q<0){var Z=!1;if((v=-q)>=j?(Z=!J,v-=j):(Z=!!J,v-=1),Z)c(G,C,a++,v);else{var X=O[v],D=U*v,l=P[D+r+1],T=P[D+r+1+L];L:for(var Y=0;Y<a;++Y){var M=G[Y],f=U*M;if(!(T<t[f+r+1]||t[f+r+1+L]<l)){for(var d=r+2;d<L;++d)if(P[D+d+L]<t[f+d]||t[f+d+L]<P[D+d])continue L;var s,H=E[M];if(void 0!==(s=J?p(X,H):p(H,X)))return s}}}}else b(G,C,a--,q-F)}},scanComplete:function(L,r,p,J,i,z,C,t,E,x,w){for(var b=0,c=2*L,P=r,O=r+L,h=J;h<i;++h){var U=h+j,W=c*h;g[b++]=z[W+P],g[b++]=-U,g[b++]=z[W+O],g[b++]=U}for(h=t;h<E;++h){U=h+1;var B=c*h;g[b++]=x[B+P],g[b++]=-U}var F=b>>>1;n(g,F);var Q=0;for(h=0;h<F;++h){var e=0|g[2*h+1];if(e<0){if((U=-e)>=j)G[Q++]=U-j;else{var v=w[U-=1],y=c*U,A=x[y+r+1],u=x[y+r+1+L];L:for(var a=0;a<Q;++a){var q=G[a],Z=C[q];if(Z===v)break;var X=c*q;if(!(u<z[X+r+1]||z[X+r+1+L]<A)){for(var D=r+2;D<L;++D)if(x[y+D+L]<z[X+D]||z[X+D+L]<x[y+D])continue L;var l=p(Z,v);if(void 0!==l)return l}}}}else{for(U=e-j,a=Q-1;a>=0;--a)if(G[a]===U){for(D=a+1;D<Q;++D)G[D-1]=G[D];break}--Q}}}};var J=p(14137),i=p(14144),n=p(14168),j=1<<28,z=1024,G=J.mallocInt32(z),C=J.mallocInt32(z),t=J.mallocInt32(z),E=J.mallocInt32(z),x=J.mallocInt32(z),w=J.mallocInt32(z),g=J.mallocDouble(8192);function b(L,r,p,J){var i=r[J],n=L[p-1];L[i]=n,r[n]=i}function c(L,r,p,J){L[p]=J,r[J]=p}},14152:L=>{"use strict";function r(L,p,J){var i=0|L[J];if(i<=0)return[];var n,j=new Array(i);if(J===L.length-1)for(n=0;n<i;++n)j[n]=p;else for(n=0;n<i;++n)j[n]=r(L,p,J+1);return j}L.exports=function(L,p){switch("undefined"===typeof p&&(p=0),typeof L){case"number":if(L>0)return function(L,r){var p,J;for(p=new Array(L),J=0;J<L;++J)p[J]=r;return p}(0|L,p);break;case"object":if("number"===typeof L.length)return r(L,p,0)}return[]}},14104:(L,r,p)=>{L.exports=function(){var L=this;this.components={},this.comps=this.components;var r=this.components,p=1,i={},n=[],j=[],z={timeout:!1,removals:[],multiComps:[]};function G(L,p){var J=r[p],n=i[p],j=n.hash[L];j&&(n.remove(L),J.br&&(J.multi?(j.forEach((r=>{r&&J.br(L,r)})),j.length=0):J.br(L,j)),z.removals.push(n),C())}function C(){z.timeout||(z.timeout=!0,setTimeout(t,1))}function t(){z.timeout=!1,E()}function E(){z.multiComps.length&&function(L){for(var r=0;r<L.length;r++){var{entID:p,data:J}=L[r],i=J.hash[p];if(i){for(var n=0;n<i.length;n++)i[n]||(i.splice(n,1),n--);0===i.length&&(J.remove(p),z.removals.push(J))}}L.length=0}(z.multiComps),z.removals.length&&function(L){for(var r=0;r<L.length;r++){L[r].flush()}L.length=0}(z.removals)}this.bE=i,this._systems=n,this._renderSystems=j,this.Jt=function(r){var J=p++;return Array.isArray(r)&&r.forEach((r=>L.TG(J,r))),J},this.deleteEntity=function(r){return Object.keys(i).forEach((L=>{i[L].hash[r]&&G(r,L)})),L},this.Ot=function(L){if(!L)throw new Error("Missing component definition");var p=L.name;if(!p)throw new Error("Component definition must have a name property.");if("string"!==typeof p)throw new Error("Component name must be a string.");if(""===p)throw new Error("Component name must be a non-empty string.");if(i[p])throw new Error(`Component ${p} already exists.`);var z={};return z.name=p,z.multi=!!L.multi,z.order=isNaN(L.order)?99:L.order,z.stateConstructor=L.stateConstructor||null,z.state=L.state||{},z.Xz=L.Xz||null,z.br=L.br||null,z.system=L.system||null,z.fz=L.fz||null,r[p]=z,i[p]=new J,i[p]._pendingMultiCleanup=!1,i[p]._multiCleanupIDs=z.multi?[]:null,z.system&&(n.push(p),n.sort(((L,p)=>r[L].order-r[p].order))),z.fz&&(j.push(p),j.sort(((L,p)=>r[L].order-r[p].order))),p},this.overwriteComponent=function(L,p){var J=r[L];if(!J)throw new Error(`Unknown component: ${L}`);if(!p)throw new Error("Missing component definition");if(J.name!==p.name)throw new Error("Overwriting component must use the same name property.");var z={};z.name=L,z.multi=!!p.multi,z.order=isNaN(p.order)?99:p.order,z.state=p.state||{},z.Xz=p.Xz||null,z.br=p.br||null,z.system=p.system||null,z.fz=p.fz||null,r[L]=z,i[L]._pendingMultiCleanup=!1,i[L]._multiCleanupIDs=z.multi?[]:null;var G=n.indexOf(L);z.system&&G<0&&n.push(L),!z.system&&G>=0&&n.splice(G,1),n.sort(((L,p)=>r[L].order-r[p].order));var C=j.indexOf(L);z.fz&&C<0&&j.push(L),!z.fz&&C>=0&&j.splice(C,1),j.sort(((L,p)=>r[L].order-r[p].order));var t=z.state;return this.lC(L).forEach((L=>{for(var r in t)r in L||(L[r]=t[r]);z.Xz&&z.Xz(L.Yz,L)})),L},this.deleteComponent=function(p){var J=i[p];if(!J)throw new Error(`Unknown component: ${p}`);J.flush(),J.list.forEach((L=>{L&&G(L.Yz||L[0].Yz,p)}));var z=n.indexOf(p),C=j.indexOf(p);return z>-1&&n.splice(z,1),C>-1&&j.splice(C,1),i[p].dispose(),delete i[p],delete r[p],L},this.TG=function(L,p,J){var n,j=r[p],z=i[p];if(!z)throw new Error(`Unknown component: ${p}.`);if(z.hash[L]&&!j.multi)throw new Error(`Entity ${L} already has component: ${p}.`);if(j.stateConstructor){if(!(n=new j.stateConstructor).hasOwnProperty("Yz"))throw new Error(`Component ${j.name} stateConstructor type does not have property __id`)}else n=Object.assign({},{Yz:L},j.state,J);if(n.Yz=L,j.multi){var G=z.hash[L];G||(G=[],z.add(L,G)),G.push(n)}else z.add(L,n);return j.Xz&&j.Xz(L,n),this},this.NG=function(L,r){var p=i[r];if(!p)throw new Error(`Unknown component: ${r}.`);return!!p.hash[L]},this.dG=function(r,p){if(!i[p])throw new Error(`Unknown component: ${p}.`);return G(r,p),L},this.getState=function(L,r){var p=i[r];if(!p)throw new Error(`Unknown component: ${r}.`);return p.hash[L]},this.lC=function(L){var r=i[L];if(!r)throw new Error(`Unknown component: ${L}.`);return E(),r.list},this.Ew=function(L){if(!i[L])throw new Error(`Unknown component: ${L}.`);var r=i[L].hash;return L=>r[L]},this.gw=function(L){if(!i[L])throw new Error(`Unknown component: ${L}.`);var r=i[L].hash;return L=>!!r[L]},this.bz=function(p){E();for(var J=0;J<n.length;J++){var j=n[J],z=r[j],G=i[j];z.system(p,G.list),E()}return L},this.render=function(p){E();for(var J=0;J<j.length;J++){var n=j[J],z=r[n],G=i[n];z.fz(p,G.list),E()}return L},this.removeMultiComponent=function(p,J,n){var j=r[J],G=i[J];if(!G)throw new Error(`Unknown component: ${J}.`);if(!j.multi)throw new Error("removeMultiComponent called on non-multi component");return function(L,r,p,J){var i=p.hash[L];if(i){var n=i[J];n&&(i[J]=null,r.br&&r.br(L,n),z.multiComps.push({entID:L,data:p}),C())}}(p,j,G,n),L}};var J=p(14109)},14109:L=>{function r(L,r){var p=L._map[r];if(delete L.hash[r],delete L._map[r],p===L.list.length-1)L.list.pop();else{var J=L.list.pop();if(L.list[p]=J,null===J||null===J[0]){var i=L.list.length;for(var n in L._map)if(L._map[n]===i)return void(L._map[n]=p)}else{var j=J.Yz||J[0].Yz;L._map[j]=p}}}L.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(L,r){if("number"===typeof this._map[L]){var p=this._map[L];this.hash[L]=r,this.list[p]=r}else this._map[L]=this.list.length,this.hash[L]=r,this.list.push(r)}remove(L){var r=this._map[L];this.hash[L]=null,this.list[r]=null,this._pendingRemovals.push(L)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var L=0;L<this._pendingRemovals.length;L++){var p=this._pendingRemovals[L];null===this.hash[p]&&r(this,p)}this._pendingRemovals.length=0}}},14069:L=>{"use strict";var r,p="object"===typeof Reflect?Reflect:null,J=function(L,r,p){return Function.prototype.apply.call(L,r,p)};r=p&&"function"===typeof p.ownKeys?p.ownKeys:Object.getOwnPropertySymbols?function(L){return Object.getOwnPropertyNames(L).concat(Object.getOwnPropertySymbols(L))}:function(L){return Object.getOwnPropertyNames(L)};var i=Number.isNaN||function(L){return L!==L};function n(){n.init.call(this)}L.exports=n,L.exports.once=function(L,r){return new Promise((function(p,J){function i(p){L.removeListener(r,n),J(p)}function n(){"function"===typeof L.removeListener&&L.removeListener("error",i),p([].slice.call(arguments))}b(L,r,n,{once:!0}),"error"!==r&&function(L,r,p){"function"===typeof L.on&&b(L,"error",r,p)}(L,i,{once:!0})}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var j=10;function z(L){if("function"!==typeof L)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof L)}function G(L){return void 0===L._maxListeners?n.defaultMaxListeners:L._maxListeners}function C(L,r,p,J){var i,n,j,C;if(z(p),void 0===(n=L._events)?(n=L._events=Object.create(null),L._eventsCount=0):(void 0!==n.newListener&&(L.emit("newListener",r,p.listener?p.listener:p),n=L._events),j=n[r]),void 0===j)j=n[r]=p,++L._eventsCount;else if("function"===typeof j?j=n[r]=J?[p,j]:[j,p]:J?j.unshift(p):j.push(p),(i=G(L))>0&&j.length>i&&!j.warned){j.warned=!0;var t=new Error("Possible EventEmitter memory leak detected. "+j.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");t.name="MaxListenersExceededWarning",t.Jr=L,t.type=r,t.count=j.length,C=t,console&&console.warn&&console.warn(C)}return L}function t(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(L,r,p){var J={fired:!1,wrapFn:void 0,target:L,type:r,listener:p},i=t.bind(J);return i.listener=p,J.wrapFn=i,i}function x(L,r,p){var J=L._events;if(void 0===J)return[];var i=J[r];return void 0===i?[]:"function"===typeof i?p?[i.listener||i]:[i]:p?function(L){for(var r=new Array(L.length),p=0;p<r.length;++p)r[p]=L[p].listener||L[p];return r}(i):g(i,i.length)}function w(L){var r=this._events;if(void 0!==r){var p=r[L];if("function"===typeof p)return 1;if(void 0!==p)return p.length}return 0}function g(L,r){for(var p=new Array(r),J=0;J<r;++J)p[J]=L[J];return p}function b(L,r,p,J){if("function"===typeof L.on)J.once?L.once(r,p):L.on(r,p);else{if("function"!==typeof L.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof L);L.addEventListener(r,(function i(n){J.once&&L.removeEventListener(r,i),p(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return j},set:function(L){if("number"!==typeof L||L<0||i(L))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+L+".");j=L}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(L){if("number"!==typeof L||L<0||i(L))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+L+".");return this._maxListeners=L,this},n.prototype.getMaxListeners=function(){return G(this)},n.prototype.emit=function(L){for(var r=[],p=1;p<arguments.length;p++)r.push(arguments[p]);var i="error"===L,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var j;if(r.length>0&&(j=r[0]),j instanceof Error)throw j;var z=new Error("Unhandled error."+(j?" ("+j.message+")":""));throw z.context=j,z}var G=n[L];if(void 0===G)return!1;if("function"===typeof G)J(G,this,r);else{var C=G.length,t=g(G,C);for(p=0;p<C;++p)J(t[p],this,r)}return!0},n.prototype.addListener=function(L,r){return C(this,L,r,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(L,r){return C(this,L,r,!0)},n.prototype.once=function(L,r){return z(r),this.on(L,E(this,L,r)),this},n.prototype.prependOnceListener=function(L,r){return z(r),this.prependListener(L,E(this,L,r)),this},n.prototype.removeListener=function(L,r){var p,J,i,n,j;if(z(r),void 0===(J=this._events))return this;if(void 0===(p=J[L]))return this;if(p===r||p.listener===r)0===--this._eventsCount?this._events=Object.create(null):(delete J[L],J.removeListener&&this.emit("removeListener",L,p.listener||r));else if("function"!==typeof p){for(i=-1,n=p.length-1;n>=0;n--)if(p[n]===r||p[n].listener===r){j=p[n].listener,i=n;break}if(i<0)return this;0===i?p.shift():function(L,r){for(;r+1<L.length;r++)L[r]=L[r+1];L.pop()}(p,i),1===p.length&&(J[L]=p[0]),void 0!==J.removeListener&&this.emit("removeListener",L,j||r)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.ir=function(L){var r,p,J;if(void 0===(p=this._events))return this;if(void 0===p.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==p[L]&&(0===--this._eventsCount?this._events=Object.create(null):delete p[L]),this;if(0===arguments.length){var i,n=Object.keys(p);for(J=0;J<n.length;++J)"removeListener"!==(i=n[J])&&this.ir(i);return this.ir("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(r=p[L]))this.removeListener(L,r);else if(void 0!==r)for(J=r.length-1;J>=0;J--)this.removeListener(L,r[J]);return this},n.prototype.listeners=function(L){return x(this,L,!0)},n.prototype.rawListeners=function(L){return x(this,L,!1)},n.listenerCount=function(L,r){return"function"===typeof L.listenerCount?L.listenerCount(r):w.call(L,r)},n.prototype.listenerCount=w,n.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},14335:L=>{"use strict";L.exports=function(L,r,p,J,i,n){var j=+r[0],z=+r[1],G=+r[2],C=+p[0],t=+p[1],E=+p[2],x=Math.sqrt(C*C+t*t+E*E);if(0===x)throw new Error("Can't raycast along a zero vector");return function(L,r,p,J,i,n,j,z,G,C){for(var t=0,E=Math.floor,x=0|E(r),w=0|E(p),g=0|E(J),b=i>0?1:-1,c=n>0?1:-1,P=j>0?1:-1,O=Math.abs(1/i),h=Math.abs(1/n),U=Math.abs(1/j),W=O<1/0?O*(b>0?x+1-r:r-x):1/0,B=h<1/0?h*(c>0?w+1-p:p-w):1/0,F=U<1/0?U*(P>0?g+1-J:J-g):1/0,Q=-1;t<=z;){var e=L(x,w,g);if(e)return G&&(G[0]=r+t*i,G[1]=p+t*n,G[2]=J+t*j),C&&(C[0]=C[1]=C[2]=0,0===Q&&(C[0]=-b),1===Q&&(C[1]=-c),2===Q&&(C[2]=-P)),e;W<B?W<F?(x+=b,t=W,W+=O,Q=0):(g+=P,t=F,F+=U,Q=2):B<F?(w+=c,t=B,B+=h,Q=1):(g+=P,t=F,F+=U,Q=2)}return G&&(G[0]=r+t*i,G[1]=p+t*n,G[2]=J+t*j),C&&(C[0]=C[1]=C[2]=0),0}(L,j,z,G,C/=x,t/=x,E/=x,J="undefined"===typeof J?64:+J,i,n)}},14373:(L,r,p)=>{"use strict";p.d(r,{d:()=>n});var J=p(14069);function i(){this.zx=!1,this.stopPropagation=!1,this.Gx=!1,this.disabled=!1}class n{constructor(L,r){this.version="0.7.0";var p=Object.assign({},new i,r||{});this.element=L||document,this.zx=!!p.zx,this.stopPropagation=!!p.stopPropagation,this.Gx=!!p.Gx,this.disabled=!!p.disabled,this.filterEvents=(L,r)=>!0,this.down=new J.EventEmitter,this.up=new J.EventEmitter,this.state={},this.uC={dx:0,dy:0,pw:0,AC:0,Jw:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?z(this):document.addEventListener("DOMContentLoaded",(L=>{z(this)}),{once:!0})}bind(L){for(var r=arguments.length,p=new Array(r>1?r-1:0),J=1;J<r;J++)p[J-1]=arguments[J];p.forEach((r=>{var p=this._keyBindmap[r]||[];p.includes(L)||(p.push(L),this._keyBindmap[r]=p)})),this.state[L]=!!this.state[L],this.pressCount[L]=this.pressCount[L]||0,this.releaseCount[L]=this.releaseCount[L]||0}unbind(L){for(var r in this._keyBindmap){var p=this._keyBindmap[r],J=p.indexOf(L);J>-1&&p.splice(J,1)}}getBindings(){var L={};for(var r in this._keyBindmap){this._keyBindmap[r].forEach((p=>{L[p]=L[p]||[],L[p].push(r)}))}return L}bz(){j(this.uC),j(this.pressCount),j(this.releaseCount)}}function j(L){for(var r in L)L[r]=0}function z(L){window.addEventListener("keydown",g.bind(null,L,!0),!1),window.addEventListener("keyup",g.bind(null,L,!1),!1);var r={passive:!0};L.element.addEventListener("touchstart",E.bind(void 0,L),{passive:!1}),L.element.addEventListener("touchend",w.bind(void 0,L),r),L.element.addEventListener("mousedown",b.bind(null,L,!0),r),window.document.addEventListener("mouseup",b.bind(null,L,!1),r),L.element.addEventListener("touchmove",c.bind(null,L),r),L.element.addEventListener("mousemove",c.bind(null,L),r),window.PointerEvent,L.element.addEventListener("wheel",P.bind(null,L),r),L.element.addEventListener("contextmenu",O.bind(null,L),!1),window.addEventListener("blur",h.bind(null,L),!1)}var G=0,C=0,t=null;function E(L,r){r.preventDefault(),x(r)}function x(L){let r=!1;for(let p=0;p<L.touches.length;++p)if(L.touches[p].identifier===t){r=!0;break}if(!r){const r=L.changedTouches[0];G=r.clientX,C=r.clientY,t=r.identifier}}function w(L,r){for(var p=r.changedTouches,J=0;J<p.length;++J)p[J].identifier===t&&(t=null)}function g(L,r,p){U(p.code,r,L,p)}function b(L,r,p){if("pointerId"in p)if(r){if(null!==L._touches.currID)return;L._touches.currID=p.pointerId}else{if(L._touches.currID!==p.pointerId)return;L._touches.currID=null}return U("Mouse"+("button"in p?p.button+1:1),r,L,p),!1}function c(L,r){var p=r.movementX||r.mozMovementX||0,J=r.movementY||r.mozMovementY||0;if(r.touches&&0===(p|J)){var i=function(L){x(L);for(let r=0;r<L.changedTouches.length;++r)if(L.changedTouches[r].identifier==t){const p=L.changedTouches[r],J=[p.clientX-G,p.clientY-C];return G=p.clientX,C=p.clientY,J}return console.error(`Did not find touch id ${t}`),[0,0]}(r);p=i[0],J=i[1]}L.uC.dx+=p,L.uC.dy+=J}function P(L,r){var p=1;switch(r.deltaMode){case 0:p=1;break;case 1:p=12;break;case 2:p=L.element.clientHeight||window.innerHeight}L.uC.pw+=(r.deltaX||0)*p,L.uC.AC+=(r.deltaY||0)*p,L.uC.Jw+=(r.deltaZ||0)*p}function O(L,r){if(!L.Gx)return r.preventDefault(),!1}function h(L){for(var r in L._keyStates)L._keyStates[r]&&(/^Mouse\d/.test(r)||U(r,!1,L,{code:r,note:"2p3ehcmlatq",preventDefault:()=>{},stopPropagation:()=>{}}))}function U(L,r,p,J){var i=p._keyBindmap[L];i&&(W(p._keyStates[L],r)&&(p._keyStates[L]=r,i.forEach((L=>{(!p.filterEvents||p.filterEvents(J,L))&&function(L,r,p,J){var i=r?p.pressCount:p.releaseCount;i[L]=(i[L]||0)+1;var n=p._bindPressCount[L]||0;(n+=r?1:-1)<0&&(n=0);p._bindPressCount[L]=n;var j=p.state[L];if(W(j,n)){p.state[L]=n>0;var z=r?p.down:p.up;p.disabled||z.emit(L,J)}}(L,r,p,J)}))),"button"in J||(p.zx&&!J.defaultPrevented&&J.preventDefault(),p.stopPropagation&&J.stopPropagation()))}function W(L,r){return L?!r:r}},12991:L=>{L.exports=function(L,r,p){return L[0]=r[0]+p[0],L[1]=r[1]+p[1],L[2]=r[2]+p[2],L}},12947:(L,r,p)=>{L.exports=function(L,r){var p=J(L[0],L[1],L[2]),j=J(r[0],r[1],r[2]);i(p,p),i(j,j);var z=n(p,j);return z>1?0:Math.acos(z)};var J=p(12953),i=p(12960),n=p(12966)},13040:L=>{L.exports=function(L,r){return L[0]=Math.ceil(r[0]),L[1]=Math.ceil(r[1]),L[2]=Math.ceil(r[2]),L}},12941:L=>{L.exports=function(L){var r=new Float32Array(3);return r[0]=L[0],r[1]=L[1],r[2]=L[2],r}},12975:L=>{L.exports=function(L,r){return L[0]=r[0],L[1]=r[1],L[2]=r[2],L}},12933:L=>{L.exports=function(){var L=new Float32Array(3);return L[0]=0,L[1]=0,L[2]=0,L}},13114:L=>{L.exports=function(L,r,p){var J=r[0],i=r[1],n=r[2],j=p[0],z=p[1],G=p[2];return L[0]=i*G-n*z,L[1]=n*j-J*G,L[2]=J*z-i*j,L}},13066:(L,r,p)=>{L.exports=p(13063)},13063:L=>{L.exports=function(L,r){var p=r[0]-L[0],J=r[1]-L[1],i=r[2]-L[2];return Math.sqrt(p*p+J*J+i*i)}},13021:(L,r,p)=>{L.exports=p(13016)},13016:L=>{L.exports=function(L,r,p){return L[0]=r[0]/p[0],L[1]=r[1]/p[1],L[2]=r[2]/p[2],L}},12966:L=>{L.exports=function(L,r){return L[0]*r[0]+L[1]*r[1]+L[2]*r[2]}},12925:L=>{L.exports=1e-6},12985:(L,r,p)=>{L.exports=function(L,r){var p=L[0],i=L[1],n=L[2],j=r[0],z=r[1],G=r[2];return Math.abs(p-j)<=J*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(i-z)<=J*Math.max(1,Math.abs(i),Math.abs(z))&&Math.abs(n-G)<=J*Math.max(1,Math.abs(n),Math.abs(G))};var J=p(12925)},12987:L=>{L.exports=function(L,r){return L[0]===r[0]&&L[1]===r[1]&&L[2]===r[2]}},13038:L=>{L.exports=function(L,r){return L[0]=Math.floor(r[0]),L[1]=Math.floor(r[1]),L[2]=Math.floor(r[2]),L}},13162:(L,r,p)=>{L.exports=function(L,r,p,i,n,j){var z,G;r||(r=3);p||(p=0);G=i?Math.min(i*r+p,L.length):L.length;for(z=p;z<G;z+=r)J[0]=L[z],J[1]=L[z+1],J[2]=L[z+2],n(J,J,j),L[z]=J[0],L[z+1]=J[1],L[z+2]=J[2];return L};var J=p(12933)()},12953:L=>{L.exports=function(L,r,p){var J=new Float32Array(3);return J[0]=L,J[1]=r,J[2]=p,J}},12923:(L,r,p)=>{L.exports={EPSILON:p(12925),create:p(12933),clone:p(12941),angle:p(12947),iz:p(12953),k:p(12975),set:p(12983),equals:p(12985),exactEquals:p(12987),add:p(12991),Pr:p(12994),sub:p(12999),multiply:p(13008),mul:p(13013),divide:p(13016),div:p(13021),min:p(13028),max:p(13030),floor:p(13038),ceil:p(13040),round:p(13042),scale:p(13049),jz:p(13056),distance:p(13063),i:p(13066),squaredDistance:p(13070),sqrDist:p(13079),length:p(13082),len:p(13088),squaredLength:p(13092),zz:p(13101),negate:p(13103),inverse:p(13105),normalize:p(12960),dot:p(12966),cross:p(13114),Lz:p(13116),random:p(13125),transformMat4:p(13129),transformMat3:p(13137),transformQuat:p(13146),Gz:p(13149),Cz:p(13151),Ez:p(13155),forEach:p(13162)}},13105:L=>{L.exports=function(L,r){return L[0]=1/r[0],L[1]=1/r[1],L[2]=1/r[2],L}},13088:(L,r,p)=>{L.exports=p(13082)},13082:L=>{L.exports=function(L){var r=L[0],p=L[1],J=L[2];return Math.sqrt(r*r+p*p+J*J)}},13116:L=>{L.exports=function(L,r,p,J){var i=r[0],n=r[1],j=r[2];return L[0]=i+J*(p[0]-i),L[1]=n+J*(p[1]-n),L[2]=j+J*(p[2]-j),L}},13030:L=>{L.exports=function(L,r,p){return L[0]=Math.max(r[0],p[0]),L[1]=Math.max(r[1],p[1]),L[2]=Math.max(r[2],p[2]),L}},13028:L=>{L.exports=function(L,r,p){return L[0]=Math.min(r[0],p[0]),L[1]=Math.min(r[1],p[1]),L[2]=Math.min(r[2],p[2]),L}},13013:(L,r,p)=>{L.exports=p(13008)},13008:L=>{L.exports=function(L,r,p){return L[0]=r[0]*p[0],L[1]=r[1]*p[1],L[2]=r[2]*p[2],L}},13103:L=>{L.exports=function(L,r){return L[0]=-r[0],L[1]=-r[1],L[2]=-r[2],L}},12960:L=>{L.exports=function(L,r){var p=r[0],J=r[1],i=r[2],n=p*p+J*J+i*i;n>0&&(n=1/Math.sqrt(n),L[0]=r[0]*n,L[1]=r[1]*n,L[2]=r[2]*n);return L}},13125:L=>{L.exports=function(L,r){r=r||1;var p=2*Math.random()*Math.PI,J=2*Math.random()-1,i=Math.sqrt(1-J*J)*r;return L[0]=Math.cos(p)*i,L[1]=Math.sin(p)*i,L[2]=J*r,L}},13149:L=>{L.exports=function(L,r,p,J){var i=p[1],n=p[2],j=r[1]-i,z=r[2]-n,G=Math.sin(J),C=Math.cos(J);return L[0]=r[0],L[1]=i+j*C-z*G,L[2]=n+j*G+z*C,L}},13151:L=>{L.exports=function(L,r,p,J){var i=p[0],n=p[2],j=r[0]-i,z=r[2]-n,G=Math.sin(J),C=Math.cos(J);return L[0]=i+z*G+j*C,L[1]=r[1],L[2]=n+z*C-j*G,L}},13155:L=>{L.exports=function(L,r,p,J){var i=p[0],n=p[1],j=r[0]-i,z=r[1]-n,G=Math.sin(J),C=Math.cos(J);return L[0]=i+j*C-z*G,L[1]=n+j*G+z*C,L[2]=r[2],L}},13042:L=>{L.exports=function(L,r){return L[0]=Math.round(r[0]),L[1]=Math.round(r[1]),L[2]=Math.round(r[2]),L}},13049:L=>{L.exports=function(L,r,p){return L[0]=r[0]*p,L[1]=r[1]*p,L[2]=r[2]*p,L}},13056:L=>{L.exports=function(L,r,p,J){return L[0]=r[0]+p[0]*J,L[1]=r[1]+p[1]*J,L[2]=r[2]+p[2]*J,L}},12983:L=>{L.exports=function(L,r,p,J){return L[0]=r,L[1]=p,L[2]=J,L}},13079:(L,r,p)=>{L.exports=p(13070)},13101:(L,r,p)=>{L.exports=p(13092)},13070:L=>{L.exports=function(L,r){var p=r[0]-L[0],J=r[1]-L[1],i=r[2]-L[2];return p*p+J*J+i*i}},13092:L=>{L.exports=function(L){var r=L[0],p=L[1],J=L[2];return r*r+p*p+J*J}},12999:(L,r,p)=>{L.exports=p(12994)},12994:L=>{L.exports=function(L,r,p){return L[0]=r[0]-p[0],L[1]=r[1]-p[1],L[2]=r[2]-p[2],L}},13137:L=>{L.exports=function(L,r,p){var J=r[0],i=r[1],n=r[2];return L[0]=J*p[0]+i*p[3]+n*p[6],L[1]=J*p[1]+i*p[4]+n*p[7],L[2]=J*p[2]+i*p[5]+n*p[8],L}},13129:L=>{L.exports=function(L,r,p){var J=r[0],i=r[1],n=r[2],j=p[3]*J+p[7]*i+p[11]*n+p[15];return j=j||1,L[0]=(p[0]*J+p[4]*i+p[8]*n+p[12])/j,L[1]=(p[1]*J+p[5]*i+p[9]*n+p[13])/j,L[2]=(p[2]*J+p[6]*i+p[10]*n+p[14])/j,L}},13146:L=>{L.exports=function(L,r,p){var J=r[0],i=r[1],n=r[2],j=p[0],z=p[1],G=p[2],C=p[3],t=C*J+z*n-G*i,E=C*i+G*J-j*n,x=C*n+j*i-z*J,w=-j*J-z*i-G*n;return L[0]=t*C+w*-j+E*-G-x*-z,L[1]=E*C+w*-z+x*-j-t*-G,L[2]=x*C+w*-G+t*-z-E*-j,L}},14092:L=>{"use strict";L.exports=function(L){for(var r=new Array(L),p=0;p<L;++p)r[p]=p;return r}},14156:L=>{L.exports=function(L){return null!=L&&null!=L.constructor&&"function"===typeof L.constructor.isBuffer&&L.constructor.isBuffer(L)}},14342:(L,r,p)=>{"use strict";p.d(r,{d:()=>J});class J{constructor(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ft=!1,this.dt=!1,this.Yt=30,this.Mt=0,this.Kt=!1,this.fullscreen=!1,this.Ht=function(L){},this.ot=function(){},this.It=function(){},this.hr=function(){},this.kt=function(L){},this.onFullscreenChanged=function(L){},C((()=>{!function(L,r){L._nowObject=performance||Date,L._lastTick=0,L._renderAccum=0,L._rt=0,L._frameCB=z.bind(null,L),requestAnimationFrame(L._frameCB),r>0&&(L._intervalCB=j.bind(null,L),L._interval=setInterval(L._intervalCB,Math.max(r,1e3/L.Yt/2)))}(this,r),function(L,r){if(!r)return;var p=!1,J=!1;document.addEventListener("pointerlockchange",(J=>{p=document.pointerLockElement===r,L.kt(p)})),document.addEventListener("fullscreenchange",(p=>{J=document.fullscreenElement===r,L.onFullscreenChanged(J)})),Object.defineProperty(L,"Kt",{get:()=>p,set:L=>{L&&!p?G(r):p&&!L&&function(L){L.exitPointerLock&&L.exitPointerLock()}(document)}}),Object.defineProperty(L,"fullscreen",{get:()=>J,set:L=>{L&&!J?r.requestFullscreen():J&&!L&&document.exitFullscreen()}}),r.addEventListener("click",(i=>{L.ft&&!p&&G(r),L.dt&&!J&&r.requestFullscreen()}));var i=()=>L.hr();if(window.ResizeObserver){new ResizeObserver(i).observe(r)}else window.addEventListener("resize",i)}(this,L),this.It()}))}}var i=3,n=20;function j(L){for(var r=1e3/L.Yt,p=L._nowObject.now()+n,J=0;L._nowObject.now()>=L._lastTick+r&&L._nowObject.now()<p&&++J<=i;)L.Ht(r),L._lastTick+=r;var j=5*(r+5),z=L._nowObject.now();if(z-L._lastTick>j)for(;z>=L._lastTick+r;)L._lastTick+=r}function z(L){requestAnimationFrame(L._frameCB),j(L);var r=L._nowObject.now(),p=r-L._rt;if(L._rt=r,L.Mt>0){L._renderAccum+=p;var J=1e3/L.Mt;if(L._renderAccum<J)return;L._renderAccum=Math.min(L._renderAccum-J,J)}var i=1e3/L.Yt,n=(r-L._lastTick)/i;L.ot(p,n,i)}function G(L){L.requestPointerLock&&L.requestPointerLock()}var C=L=>{if("loading"===document.readyState){var r=()=>{document.removeEventListener("readystatechange",r),L()};document.addEventListener("readystatechange",r)}else setTimeout(L,1)}},14083:(L,r,p)=>{var J=p(14092),i=p(14094),n="undefined"!==typeof Float64Array;function j(L,r){return L[0]-r[0]}function z(){var L,r=this.stride,p=new Array(r.length);for(L=0;L<p.length;++L)p[L]=[Math.abs(r[L]),L];p.sort(j);var J=new Array(p.length);for(L=0;L<J.length;++L)J[L]=p[L][1];return J}function G(L,r){var p=["View",r,"d",L].join("");r<0&&(p="View_Nil"+L);var i="generic"===L;if(-1===r){var n="function "+p+"(a){this.data=a;};var proto="+p+".prototype;proto.dtype='"+L+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+p+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+p+"(a){return new "+p+"(a);}";return new Function(n)()}if(0===r){n="function "+p+"(a,d) {this.data = a;this.offset = d};var proto="+p+".prototype;proto.dtype='"+L+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+p+"_copy() {return new "+p+"(this.data,this.offset)};proto.pick=function "+p+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+p+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+p+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+p+"(a,b,c,d){return new "+p+"(a,d)}";return new Function("TrivialArray",n)(C[L][0])}n=["'use strict'"];var j=J(r),G=j.map((function(L){return"i"+L})),t="this.offset+"+j.map((function(L){return"this.stride["+L+"]*i"+L})).join("+"),E=j.map((function(L){return"b"+L})).join(","),x=j.map((function(L){return"c"+L})).join(",");n.push("function "+p+"(a,"+E+","+x+",d){this.data=a","this.shape=["+E+"]","this.stride=["+x+"]","this.offset=d|0}","var proto="+p+".prototype","proto.dtype='"+L+"'","proto.dimension="+r),n.push("Object.defineProperty(proto,'size',{get:function "+p+"_size(){return "+j.map((function(L){return"this.shape["+L+"]"})).join("*"),"}})"),1===r?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),r<4?(n.push("function "+p+"_order(){"),2===r?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+p+"_set("+G.join(",")+",v){"),i?n.push("return this.data.set("+t+",v)}"):n.push("return this.data["+t+"]=v}"),n.push("proto.get=function "+p+"_get("+G.join(",")+"){"),i?n.push("return this.data.get("+t+")}"):n.push("return this.data["+t+"]}"),n.push("proto.index=function "+p+"_index(",G.join(),"){return "+t+"}"),n.push("proto.hi=function "+p+"_hi("+G.join(",")+"){return new "+p+"(this.data,"+j.map((function(L){return["(typeof i",L,"!=='number'||i",L,"<0)?this.shape[",L,"]:i",L,"|0"].join("")})).join(",")+","+j.map((function(L){return"this.stride["+L+"]"})).join(",")+",this.offset)}");var w=j.map((function(L){return"a"+L+"=this.shape["+L+"]"})),g=j.map((function(L){return"c"+L+"=this.stride["+L+"]"}));n.push("proto.lo=function "+p+"_lo("+G.join(",")+"){var b=this.offset,d=0,"+w.join(",")+","+g.join(","));for(var b=0;b<r;++b)n.push("if(typeof i"+b+"==='number'&&i"+b+">=0){d=i"+b+"|0;b+=c"+b+"*d;a"+b+"-=d}");n.push("return new "+p+"(this.data,"+j.map((function(L){return"a"+L})).join(",")+","+j.map((function(L){return"c"+L})).join(",")+",b)}"),n.push("proto.step=function "+p+"_step("+G.join(",")+"){var "+j.map((function(L){return"a"+L+"=this.shape["+L+"]"})).join(",")+","+j.map((function(L){return"b"+L+"=this.stride["+L+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(b=0;b<r;++b)n.push("if(typeof i"+b+"==='number'){d=i"+b+"|0;if(d<0){c+=b"+b+"*(a"+b+"-1);a"+b+"=ceil(-a"+b+"/d)}else{a"+b+"=ceil(a"+b+"/d)}b"+b+"*=d}");n.push("return new "+p+"(this.data,"+j.map((function(L){return"a"+L})).join(",")+","+j.map((function(L){return"b"+L})).join(",")+",c)}");var c=new Array(r),P=new Array(r);for(b=0;b<r;++b)c[b]="a[i"+b+"]",P[b]="b[i"+b+"]";n.push("proto.transpose=function "+p+"_transpose("+G+"){"+G.map((function(L,r){return L+"=("+L+"===undefined?"+r+":"+L+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+p+"(this.data,"+c.join(",")+","+P.join(",")+",this.offset)}"),n.push("proto.pick=function "+p+"_pick("+G+"){var a=[],b=[],c=this.offset");for(b=0;b<r;++b)n.push("if(typeof i"+b+"==='number'&&i"+b+">=0){c=(c+this.stride["+b+"]*i"+b+")|0}else{a.push(this.shape["+b+"]);b.push(this.stride["+b+"])}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+p+"(data,shape,stride,offset){return new "+p+"(data,"+j.map((function(L){return"shape["+L+"]"})).join(",")+","+j.map((function(L){return"stride["+L+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(C[L],z)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};L.exports=function(L,r,p,J){if(void 0===L)return(0,C.array[0])([]);"number"===typeof L&&(L=[L]),void 0===r&&(r=[L.length]);var j=r.length;if(void 0===p){p=new Array(j);for(var z=j-1,t=1;z>=0;--z)p[z]=t,t*=r[z]}if(void 0===J){J=0;for(z=0;z<j;++z)p[z]<0&&(J-=(r[z]-1)*p[z])}for(var E=function(L){if(i(L))return"buffer";if(n)switch(Object.prototype.toString.call(L)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(L)?"array":"generic"}(L),x=C[E];x.length<=j+1;)x.push(G(E,x.length-1));return(0,x[j+1])(L,r,p,J)}},14094:L=>{function r(L){return!!L.constructor&&"function"===typeof L.constructor.isBuffer&&L.constructor.isBuffer(L)}L.exports=function(L){return null!=L&&(r(L)||function(L){return"function"===typeof L.readFloatLE&&"function"===typeof L.slice&&r(L.slice(0,0))}(L)||!!L._isBuffer)}},14229:L=>{"use strict";var r=[],p=[],J=[],i=[],n=[],j=[],z=[],G=[],C=[],t=[],E=[],x=[];L.exports=function(L,w,g,b,c,P){for(var O=z,h=C,U=t,W=x,B=0;B<3;B++)O[B]=+g[B],U[B]=+w.max[B],h[B]=+w.base[B];P||(P=1e-10);var F=function(L,z,C,t,x,w){var g=r,b=p,c=J,P=i,O=n,h=j,U=G,W=Math.floor,B=0,F=0,Q=0,e=0,v=0;if(y(),0===Q)return 0;for(e=a();F<=Q;){if(A(e)&&u())return B;e=a()}for(B+=Q,v=0;v<3;v++)t[v]+=C[v],x[v]+=C[v];return B;function y(){if(F=0,0!==(Q=Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])))for(var L=0;L<3;L++){var r=C[L]>=0;P[L]=r?1:-1;var p=r?x[L]:t[L];g[L]=r?t[L]:x[L],b[L]=q(p,P[L]),c[L]=Z(g[L],P[L]),U[L]=C[L]/Q,O[L]=Math.abs(1/U[L]);var J=r?b[L]+1-p:p-b[L];h[L]=O[L]<1/0?O[L]*J:1/0}}function A(r){for(var p=P[0],J=0===r?b[0]:c[0],i=b[0]+p,n=P[1],j=1===r?b[1]:c[1],z=b[1]+n,G=P[2],C=2===r?b[2]:c[2],t=b[2]+G,E=J;E!=i;E+=p)for(var x=j;x!=z;x+=n)for(var w=C;w!=t;w+=G)if(L(E,x,w))return!0;return!1}function u(){B+=F;var L=P[e],r=F/Q,p=E;for(v=0;v<3;v++){var J=C[v]*r;t[v]+=J,x[v]+=J,p[v]=C[v]-J}if(L>0?x[e]=Math.round(x[e]):t[e]=Math.round(t[e]),z(B,e,L,p))return!0;for(v=0;v<3;v++)C[v]=p[v];return y(),0===Q}function a(){var L=h[0]<h[1]?h[0]<h[2]?0:2:h[1]<h[2]?1:2,r=h[L]-F;for(F=h[L],b[L]+=P[L],h[L]+=O[L],v=0;v<3;v++)g[v]+=r*U[v],c[v]=Z(g[v],P[v]);return L}function q(L,r){return W(L-r*w)}function Z(L,r){return W(L+r*w)}}(L,b,O,h,U,P);if(!c){for(B=0;B<3;B++)W[B]=g[B]>0?U[B]-w.max[B]:h[B]-w.base[B];w.translate(W)}return F}},14376:(L,r,p)=>{"use strict";p.d(r,{d:()=>E});var J=p(14221),i=p(12923);class n{constructor(L,r,p,n,j,z,G){this.DC=new J(L.base,L.SC),this.qJ=r,this.friction=p,this.restitution=n,this.kj=j,this.Bw=z,this.Rj=!!G,this.VC=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Og=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.tC=i.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=i.create(),this._impulses=i.create(),this._sleepFrameCount=10}loadFromCopy(L){i.k(this.DC.base,L.DC.base),i.k(this.DC.SC,L.DC.SC),i.k(this.DC.max,L.DC.max),this.DC.mag=L.DC.mag,this.qJ=L.qJ,this.friction=L.friction,this.restitution=L.restitution,this.kj=L.kj,this.Bw=L.Bw,this.Rj=L.Rj,this.VC=L.VC,this.fluidDrag=L.fluidDrag,this.Og=L.Og,this.preventFallOffEdge=L.preventFallOffEdge,this.rolledBackLastTick=L.rolledBackLastTick,i.k(this.tC,L.tC),i.k(this.resting,L.resting),this.inFluid=L.inFluid,this._ratioInFluid=L._ratioInFluid,i.k(this._forces,L._forces),i.k(this._impulses,L._impulses),this._sleepFrameCount=L._sleepFrameCount}setPosition(L){j(L),i.Pr(L,L,this.DC.base),this.DC.translate(L),this.wC()}ip(){return i.clone(this.DC.base)}applyForce(L){j(L),i.add(this._forces,this._forces,L),this.wC()}applyImpulse(L){j(L),i.add(this._impulses,this._impulses,L),this.wC()}wC(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var j=L=>{};var z=p(14221),G=p(12923),C=p(14229);function t(){this.VC=.1,this.fluidDrag=.4,this.Sj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function E(L,r,p){L=Object.assign(new t,L),this.gravity=L.gravity||[0,-10,0],this.VC=L.VC||.1,this.Sj=L.Sj||2,this.fluidDrag=L.fluidDrag||.4,this.minBounceImpulse=L.minBounceImpulse,this.bodies=[],this.kx=L.kx,this.testSolid=r,this.testFluid=p}E.prototype.aw=function(L,r,p,J,i,j){L=L||new z([0,0,0],[1,1,1]),"undefined"==typeof r&&(r=1),"undefined"==typeof p&&(p=1),"undefined"==typeof J&&(J=0),"undefined"==typeof i&&(i=1);var G=new n(L,r,p,J,i,j);return this.bodies.push(G),G},E.prototype.qw=function(L){var r=this.bodies.indexOf(L);r<0||(this.bodies.splice(r,1),L.DC=L.Bw=null)};var x=G.create(),w=G.create(),g=G.create(),b=G.create(),c=G.create(),P=G.create(),O=G.create(),h=new z([0,0,0],[1,1,1]),U=new n(h,1,1,0,1,(()=>{}),!1);function W(L,r,p){return r=p,r*=1-(1-L.ratioInFluid)**2}E.prototype.bz=function(L){L/=1e3;var r=Y(0,G.squaredLength(this.gravity));this.bodies.forEach((p=>function(L,r,p,J){G.k(c,r.resting),L.kx&&U.loadFromCopy(r);if(r.qJ<=0)return G.set(r.tC,0,0,0),G.set(r._forces,0,0,0),void G.set(r._impulses,0,0,0);var i=J||0===r.kj;if(function(L,r,p,J){if(r._sleepFrameCount>0)return!1;if(J)return!0;var i=!1,n=.5*p*p*r.kj;return G.scale(T,L.gravity,n),C(L.testSolid,r.DC,T,(function(){return i=!0,!0}),!0),i}(L,r,p,i))return;r._sleepFrameCount--,function(L,r){var p=r.DC,J=Math.floor(p.base[0]),i=Math.floor(p.base[2]),n=Math.floor(p.base[1]),j=Math.floor(p.max[1]);if(!L.testFluid(J,n,i))return r.inFluid=!1,void(r.ratioInFluid=0);var z=1,C=n+1;for(;C<=j&&L.testFluid(J,C,i);)z++,C++;var t=(n+z-p.base[1])/p.SC[1];t>1&&(t=1);var E=p.SC[0]*p.SC[1]*p.SC[2]*t,x=F;G.scale(x,L.gravity,-L.Sj*E*r.kj),r.applyForce(x),r.inFluid=!0,r.ratioInFluid=t}(L,r),f(r._forces),f(r._impulses),f(r.tC),f(r.resting),G.scale(x,r._forces,1/r.qJ),G.jz(x,x,L.gravity,r.kj),G.scale(w,r._impulses,1/r.qJ),G.jz(w,w,x,p),G.add(r.tC,r.tC,w),r.friction&&(Q(L,0,r,w,p),Q(L,1,r,w,p),Q(L,2,r,w,p));var n=r.fluidDrag>=0?r.fluidDrag:L.fluidDrag,j=r.VC>=0?r.VC:L.VC,z=j,t=j;r.inFluid&&(z=W(r,z,r.fluidDragHoriz>=0?r.fluidDragHoriz:n),t=W(r,t,r.fluidDragVert>=0?r.fluidDragVert:n));z=Math.max(1-z*p/r.qJ,0),t=Math.max(1-t*p/r.qJ,0),G.set(B,z,t,z),G.multiply(r.tC,r.tC,B),G.scale(g,r.tC,p),G.set(r._forces,0,0,0),G.set(r._impulses,0,0,0),r.Rj&&M(y,r.DC);G.k(P,g),G.set(O,0,0,0),r.preventFallOffEdge&&function(L,r,p,J){if(!r.resting[1]||p[1]>0)return;var i=X;M(i,r.DC);for(var n=0;n<3;n+=2){G.set(Z,0,0,0),Z[n]=p[n];var j=!0;(j=(j=(j=(j=j&&!l(L,i.base[0]+Z[0]+1e-5,i.base[1],i.base[2]+Z[2]+1e-5))&&!l(L,i.max[0]+Z[0]-1e-5,i.base[1],i.base[2]+Z[2]+1e-5))&&!l(L,i.base[0]+Z[0]+1e-5,i.base[1],i.max[2]+Z[2]-1e-5))&&!l(L,i.max[0]+Z[0]-1e-5,i.base[1],i.max[2]+Z[2]-1e-5))?(J[n]=p[n]>0?1:-1,p[n]=0):0===n&&(G.set(D,p[0],0,0),v(L,i,D,J,r.slideOnCollision))}}(L,r,g,O);v(L,r.DC,g,r.resting,r.slideOnCollision),r.Rj&&function(L,r,p,J){if(r.resting[1]>=0&&!r.inFluid)return;var i=0!==r.resting[0],n=0!==r.resting[2];if(!i&&!n)return;var j=Math.abs(J[0]/J[2]),z=4;if(!i&&j>z)return;if(!n&&j<1/z)return;G.add(u,p.base,J);var t=L.testSolid;C(t,p,J,(function(L,r,p,J){if(1!==r)return!0;J[r]=0}));var E=p.base[1],x=r.inFluid?1.951:1.001,w=Math.floor(E+x)-E;G.set(a,0,w,0);var g=!1;if(C(t,p,a,(function(L,r,p,J){return g=!0,!0})),g)return;G.Pr(q,u,p.base),q[1]=0,v(L,p,q,A,!0);var b=Y(p.base[0],u[0]),c=Y(p.base[2],u[2]);if(i&&!b&&(!c||!n))return;if(n&&(!b||!i)&&!c)return;var P=!0;if(P=P&&!l(L,p.base[0]+1e-5,p.base[1],p.base[2]+1e-5),P=P&&!l(L,p.max[0]-1e-5,p.base[1],p.base[2]+1e-5),P=P&&!l(L,p.base[0]+1e-5,p.base[1],p.max[2]-1e-5),P=P&&!l(L,p.max[0]-1e-5,p.base[1],p.max[2]-1e-5),P)return;M(r.DC,p),r.resting[0]=A[0],r.resting[2]=A[2],r.Og&&r.Og()}(L,r,y,P);for(var E=0;E<3;++E)r.resting[E]=r.resting[E]||O[E],b[E]=0,r.resting[E]&&(c[E]||(b[E]=-r.tC[E]),r.tC[E]=0);var h=G.length(b);h>.001&&(G.scale(b,b,r.qJ),r.Bw&&r.Bw(b),r.restitution>0&&h>L.minBounceImpulse&&(G.scale(b,b,r.restitution),r.applyImpulse(b)));var e=G.squaredLength(r.tC);e>1e-5&&r.wC();L.kx&&L.kx(r)?(r.loadFromCopy(U),r.rolledBackLastTick=!0):r.rolledBackLastTick=!1}(this,p,L,r)))};var B=G.create([0,0,0]);var F=G.create();function Q(L,r,p,J,i){var n=p.resting[r],j=J[r];if(!p.alwaysApplyHorizFriction||1!==r){if(0===n)return;if(n*j<=0)return}G.k(e,p.tC),e[r]=0;var z=G.length(e);if(!Y(z,0)){var C=Math.abs(p.friction*L.gravity[r]*i),t=z>C?(z-C)/z:0;p.tC[(r+1)%3]*=t,p.tC[(r+2)%3]*=t}}var e=G.create();function v(L,r,p,J,i){return G.set(J,0,0,0),C(L.testSolid,r,p,(function(L,r,p,n){J[r]=p,n[r]=0,i||(n[0]=0,n[1]=0,n[2]=0)}))}var y=new z([],[]),A=G.create(),u=G.create(),a=G.create(),q=G.create();var Z=G.create(),X=new z([],[]),D=G.create();function l(L,r,p,J){return L.testSolid(Math.floor(r),Math.floor(p-1),Math.floor(J))}var T=G.create();function Y(L,r){return Math.abs(L-r)<1e-5}function M(L,r){for(var p=0;p<3;p++)L.base[p]=r.base[p],L.max[p]=r.max[p],L.SC[p]=r.SC[p]}var f=function(L){}},12820:function(L,r){!function(L){"use strict";var r=function(L,p){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,r){L.__proto__=r}||function(L,r){for(var p in r)Object.prototype.hasOwnProperty.call(r,p)&&(L[p]=r[p])},r(L,p)};function p(L,p){if("function"!==typeof p&&null!==p)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function J(){this.constructor=L}r(L,p),L.prototype=null===p?Object.create(p):(J.prototype=p.prototype,new J)}function J(L,r,p,J){var i,n=arguments.length,j=n<3?r:null===J?J=Object.getOwnPropertyDescriptor(r,p):J;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)j=Reflect.decorate(L,r,p,J);else for(var z=L.length-1;z>=0;z--)(i=L[z])&&(j=(n<3?i(j):n>3?i(r,p,j):i(r,p))||j);return n>3&&j&&Object.defineProperty(r,p,j),j}function i(L,r,p){if(p||2===arguments.length)for(var J,i=0,n=r.length;i<n;i++)!J&&i in r||(J||(J=Array.prototype.slice.call(r,0,i)),J[i]=r[i]);return L.concat(J||Array.prototype.slice.call(r))}var n,j=255,z=213;L.OPERATION=void 0,(n=L.OPERATION||(L.OPERATION={}))[n.ADD=128]="ADD",n[n.REPLACE=0]="REPLACE",n[n.DELETE=64]="DELETE",n[n.DELETE_AND_ADD=192]="DELETE_AND_ADD",n[n.TOUCH=1]="TOUCH",n[n.CLEAR=10]="CLEAR";var G=function(){function r(L,r,p){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=L,this.setParent(r,p)}return r.prototype.setParent=function(L,r,p){var J=this;if(this.indexes||(this.indexes=this.ref instanceof qL?this.ref._definition.indexes:{}),this.parent=L,this.parentIndex=p,r)if(this.root=r,this.ref instanceof qL){var i=this.ref._definition;for(var n in i.schema){var j=this.ref[n];if(j&&j.$changes){var z=i.indexes[n];j.$changes.setParent(this.ref,r,z)}}}else"object"===typeof this.ref&&this.ref.forEach((function(L,r){if(L instanceof qL){var p=L.$changes,i=J.ref.$changes.indexes[r];p.setParent(J.ref,J.root,i)}}))},r.prototype.operation=function(L){this.changes.set(--this.currentCustomOperation,L)},r.prototype.change=function(r,p){void 0===p&&(p=L.OPERATION.ADD);var J="number"===typeof r?r:this.indexes[r];this.assertValidIndex(J,r);var i=this.changes.get(J);i&&i.op!==L.OPERATION.DELETE&&i.op!==L.OPERATION.TOUCH||this.changes.set(J,{op:i&&i.op===L.OPERATION.DELETE?L.OPERATION.DELETE_AND_ADD:p,index:J}),this.allChanges.add(J),this.changed=!0,this.touchParents()},r.prototype.touch=function(r){var p="number"===typeof r?r:this.indexes[r];this.assertValidIndex(p,r),this.changes.has(p)||this.changes.set(p,{op:L.OPERATION.TOUCH,index:p}),this.allChanges.add(p),this.touchParents()},r.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},r.prototype.getType=function(L){if(this.ref._definition)return(r=this.ref._definition).schema[r.fieldsByIndex[L]];var r,p=(r=this.parent._definition).schema[r.fieldsByIndex[this.parentIndex]];return Object.values(p)[0]},r.prototype.getChildrenFilter=function(){var L=this.parent._definition.childFilters;return L&&L[this.parentIndex]},r.prototype.getValue=function(L){return this.ref.getByIndex(L)},r.prototype.delete=function(r){var p="number"===typeof r?r:this.indexes[r];if(void 0!==p){var J=this.getValue(p);this.changes.set(p,{op:L.OPERATION.DELETE,index:p}),this.allChanges.delete(p),delete this.caches[p],J&&J.$changes&&(J.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(r," (").concat(p,")"))},r.prototype.discard=function(r,p){var J=this;void 0===r&&(r=!1),void 0===p&&(p=!1),this.ref instanceof qL||this.changes.forEach((function(r){if(r.op===L.OPERATION.DELETE){var p=J.ref.getIndex(r.index);delete J.indexes[p]}})),this.changes.clear(),this.changed=r,p&&this.allChanges.clear(),this.currentCustomOperation=0},r.prototype.discardAll=function(){var L=this;this.changes.forEach((function(r){var p=L.getValue(r.index);p&&p.$changes&&p.$changes.discardAll()})),this.discard()},r.prototype.cache=function(L,r){this.caches[L]=r},r.prototype.clone=function(){return new r(this.ref,this.parent,this.root)},r.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},r.prototype.assertValidIndex=function(L,r){if(void 0===L)throw new Error('ChangeTree: missing index for field "'.concat(r,'"'))},r}();function C(L,r,p,J){return L[r]||(L[r]=[]),L[r].push(p),null===J||void 0===J||J.forEach((function(L,r){return p(L,r)})),function(){return E(L[r],L[r].indexOf(p))}}function t(r){var p=this,J="string"!==typeof this.$changes.getType();this.$items.forEach((function(i,n){r.push({refId:p.$changes.refId,op:L.OPERATION.DELETE,field:n,value:void 0,previousValue:i}),J&&p.$changes.root.removeRef(i.$changes.refId)}))}function E(L,r){if(-1===r||r>=L.length)return!1;for(var p=L.length-1,J=r;J<p;J++)L[J]=L[J+1];return L.length=p,!0}var x=function(L,r){var p=L.toString(),J=r.toString();return p<J?-1:p>J?1:0};function w(L){return L.$proxy=!0,L=new Proxy(L,{get:function(L,r){return"symbol"===typeof r||isNaN(r)?L[r]:L.at(r)},set:function(L,r,p){if("symbol"===typeof r||isNaN(r))L[r]=p;else{var J=Array.from(L.$items.keys()),i=parseInt(J[r]||r);void 0===p||null===p?L.deleteAt(i):L.setAt(i,p)}return!0},deleteProperty:function(L,r){return"number"===typeof r?L.deleteAt(r):delete L[r],!0}})}var g=function(){function r(){for(var L=[],r=0;r<arguments.length;r++)L[r]=arguments[r];this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,L)}return r.prototype.Xz=function(r,p){return void 0===p&&(p=!0),C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,r,p?this.$items:void 0)},r.prototype.br=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,r)},r.prototype.onChange=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,r)},r.is=function(L){return Array.isArray(L)||void 0!==L.array},Object.defineProperty(r.prototype,"length",{get:function(){return this.$items.size},set:function(L){0===L?this.clear():this.splice(L,this.length-L)},enumerable:!1,configurable:!0}),r.prototype.push=function(){for(var L,r=this,p=[],J=0;J<arguments.length;J++)p[J]=arguments[J];return p.forEach((function(p){L=r.$refId++,r.setAt(L,p)})),L},r.prototype.pop=function(){var L=Array.from(this.$indexes.values()).pop();if(void 0!==L){this.$changes.delete(L),this.$indexes.delete(L);var r=this.$items.get(L);return this.$items.delete(L),r}},r.prototype.at=function(L){var r=Array.from(this.$items.keys())[L];return this.$items.get(r)},r.prototype.setAt=function(r,p){var J,i;if(void 0!==p&&null!==p){if(this.$items.get(r)!==p){void 0!==p.$changes&&p.$changes.setParent(this,this.$changes.root,r);var n=null!==(i=null===(J=this.$changes.indexes[r])||void 0===J?void 0:J.op)&&void 0!==i?i:L.OPERATION.ADD;this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,p),this.$changes.change(r,n)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},r.prototype.deleteAt=function(L){var r=Array.from(this.$items.keys())[L];return void 0!==r&&this.$deleteAt(r)},r.prototype.$deleteAt=function(L){return this.$changes.delete(L),this.$indexes.delete(L),this.$items.delete(L)},r.prototype.clear=function(r){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),r&&t.call(this,r),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},r.prototype.concat=function(){for(var L,p=[],J=0;J<arguments.length;J++)p[J]=arguments[J];return new(r.bind.apply(r,i([void 0],(L=Array.from(this.$items.values())).concat.apply(L,p),!1)))},r.prototype.join=function(L){return Array.from(this.$items.values()).join(L)},r.prototype.reverse=function(){var L=this,r=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(p,J){L.setAt(r[J],p)})),this},r.prototype.shift=function(){var L=Array.from(this.$items.keys()).shift();if(void 0!==L){var r=this.$items.get(L);return this.$deleteAt(L),r}},r.prototype.slice=function(L,p){var J=new r;return J.push.apply(J,Array.from(this.$items.values()).slice(L,p)),J},r.prototype.sort=function(L){var r=this;void 0===L&&(L=x);var p=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(L).forEach((function(L,J){r.setAt(p[J],L)})),this},r.prototype.splice=function(L,r){void 0===r&&(r=this.length-L);for(var p=Array.from(this.$items.keys()),J=[],i=L;i<L+r;i++)J.push(this.$items.get(p[i])),this.$deleteAt(p[i]);return J},r.prototype.unshift=function(){for(var L=this,r=[],p=0;p<arguments.length;p++)r[p]=arguments[p];var J=this.length,i=r.length,n=Array.from(this.$items.values());return r.forEach((function(r,p){L.setAt(p,r)})),n.forEach((function(r,p){L.setAt(i+p,r)})),J+i},r.prototype.indexOf=function(L,r){return Array.from(this.$items.values()).indexOf(L,r)},r.prototype.lastIndexOf=function(L,r){return void 0===r&&(r=this.length-1),Array.from(this.$items.values()).lastIndexOf(L,r)},r.prototype.every=function(L,r){return Array.from(this.$items.values()).every(L,r)},r.prototype.some=function(L,r){return Array.from(this.$items.values()).some(L,r)},r.prototype.forEach=function(L,r){Array.from(this.$items.values()).forEach(L,r)},r.prototype.map=function(L,r){return Array.from(this.$items.values()).map(L,r)},r.prototype.filter=function(L,r){return Array.from(this.$items.values()).filter(L,r)},r.prototype.reduce=function(L,r){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},r.prototype.reduceRight=function(L,r){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},r.prototype.find=function(L,r){return Array.from(this.$items.values()).find(L,r)},r.prototype.findIndex=function(L,r){return Array.from(this.$items.values()).findIndex(L,r)},r.prototype.fill=function(L,r,p){throw new Error("ArraySchema#fill() not implemented")},r.prototype.copyWithin=function(L,r,p){throw new Error("ArraySchema#copyWithin() not implemented")},r.prototype.toString=function(){return this.$items.toString()},r.prototype.toLocaleString=function(){return this.$items.toLocaleString()},r.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(r,Symbol.species,{get:function(){return r},enumerable:!1,configurable:!0}),r.prototype.entries=function(){return this.$items.entries()},r.prototype.keys=function(){return this.$items.keys()},r.prototype.values=function(){return this.$items.values()},r.prototype.includes=function(L,r){return Array.from(this.$items.values()).includes(L,r)},r.prototype.flatMap=function(L,r){throw new Error("ArraySchema#flatMap() is not supported.")},r.prototype.flat=function(L){throw new Error("ArraySchema#flat() is not supported.")},r.prototype.findLast=function(){var L=Array.from(this.$items.values());return L.findLast.apply(L,arguments)},r.prototype.findLastIndex=function(){var L=Array.from(this.$items.values());return L.findLastIndex.apply(L,arguments)},r.prototype.setIndex=function(L,r){this.$indexes.set(L,r)},r.prototype.getIndex=function(L){return this.$indexes.get(L)},r.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},r.prototype.deleteByIndex=function(L){var r=this.$indexes.get(L);this.$items.delete(r),this.$indexes.delete(L)},r.prototype.toArray=function(){return Array.from(this.$items.values())},r.prototype.toJSON=function(){return this.toArray().map((function(L){return"function"===typeof L.toJSON?L.toJSON():L}))},r.prototype.clone=function(L){return L?new(r.bind.apply(r,i([void 0],Array.from(this.$items.values()),!1))):new(r.bind.apply(r,i([void 0],this.map((function(L){return L.$changes?L.clone():L})),!1)))},r}();function b(L){return L.$proxy=!0,L=new Proxy(L,{get:function(L,r){return"symbol"!==typeof r&&"undefined"===typeof L[r]?L.get(r):L[r]},set:function(L,r,p){return"symbol"!==typeof r&&-1===r.indexOf("$")&&"Xz"!==r&&"br"!==r&&"onChange"!==r?L.set(r,p):L[r]=p,!0},deleteProperty:function(L,r){return L.delete(r),!0}})}var c=function(){function r(L){var p=this;if(this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L)if(L instanceof Map||L instanceof r)L.forEach((function(L,r){return p.set(r,L)}));else for(var J in L)this.set(J,L[J])}return r.prototype.Xz=function(r,p){return void 0===p&&(p=!0),C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,r,p?this.$items:void 0)},r.prototype.br=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,r)},r.prototype.onChange=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,r)},r.is=function(L){return void 0!==L.map},r.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(r,Symbol.species,{get:function(){return r},enumerable:!1,configurable:!0}),r.prototype.set=function(r,p){if(void 0===p||null===p)throw new Error("MapSchema#set('".concat(r,"', ").concat(p,"): trying to set ").concat(p," value on '").concat(r,"'."));r=r.toString();var J="undefined"!==typeof this.$changes.indexes[r],i=J?this.$changes.indexes[r]:this.$refId++,n=J?L.OPERATION.REPLACE:L.OPERATION.ADD,j=void 0!==p.$changes;if(j&&p.$changes.setParent(this,this.$changes.root,i),J){if(!j&&this.$items.get(r)===p)return;j&&this.$items.get(r)!==p&&(n=L.OPERATION.ADD)}else this.$changes.indexes[r]=i,this.$indexes.set(i,r);return this.$items.set(r,p),this.$changes.change(r,n),this},r.prototype.get=function(L){return this.$items.get(L)},r.prototype.delete=function(L){return this.$changes.delete(L),this.$items.delete(L)},r.prototype.clear=function(r){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),r&&t.call(this,r),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},r.prototype.has=function(L){return this.$items.has(L)},r.prototype.forEach=function(L){this.$items.forEach(L)},r.prototype.entries=function(){return this.$items.entries()},r.prototype.keys=function(){return this.$items.keys()},r.prototype.values=function(){return this.$items.values()},Object.defineProperty(r.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),r.prototype.setIndex=function(L,r){this.$indexes.set(L,r)},r.prototype.getIndex=function(L){return this.$indexes.get(L)},r.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},r.prototype.deleteByIndex=function(L){var r=this.$indexes.get(L);this.$items.delete(r),this.$indexes.delete(L)},r.prototype.toJSON=function(){var L={};return this.forEach((function(r,p){L[p]="function"===typeof r.toJSON?r.toJSON():r})),L},r.prototype.clone=function(L){var p;return L?p=Object.assign(new r,this):(p=new r,this.forEach((function(L,r){L.$changes?p.set(r,L.clone()):p.set(r,L)}))),p},r}(),P={};function O(L,r){P[L]=r}function h(L){return P[L]}var U=function(){function L(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return L.create=function(r){var p=new L;return p.schema=Object.assign({},r&&r.schema||{}),p.indexes=Object.assign({},r&&r.indexes||{}),p.fieldsByIndex=Object.assign({},r&&r.fieldsByIndex||{}),p.descriptors=Object.assign({},r&&r.descriptors||{}),p.deprecated=Object.assign({},r&&r.deprecated||{}),p},L.prototype.addField=function(L,r){var p=this.getNextFieldIndex();this.fieldsByIndex[p]=L,this.indexes[L]=p,this.schema[L]=Array.isArray(r)?{array:r[0]}:r},L.prototype.hasField=function(L){return void 0!==this.indexes[L]},L.prototype.addFilter=function(L,r){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[L]]=r,this.indexesWithFilters.push(this.indexes[L]),!0},L.prototype.addChildrenFilter=function(L,r){var p=this.indexes[L],J=this.schema[L];if(h(Object.keys(J)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[p]=r,!0;console.warn("@filterChildren: field '".concat(L,"' can't have children. Ignoring filter."))},L.prototype.getChildrenFilter=function(L){return this.childFilters&&this.childFilters[this.indexes[L]]},L.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},L}();function W(L){return L._context&&L._context.useFilters}var B=function(){function L(){this.types={},this.schemas=new Map,this.useFilters=!1}return L.prototype.has=function(L){return this.schemas.has(L)},L.prototype.get=function(L){return this.types[L]},L.prototype.add=function(L,r){void 0===r&&(r=this.schemas.size),L._definition=U.create(L._definition),L._typeid=r,this.types[r]=L,this.schemas.set(L,r)},L.create=function(r){return void 0===r&&(r={}),function(p){return r.context||(r.context=new L),Q(p,r)}},L}(),F=new B;function Q(L,r){return void 0===r&&(r={}),function(p,J){var n=r.context||F,j=p.constructor;if(j._context=n,!L)throw new Error("".concat(j.name,': @type() reference provided for "').concat(J,"\" is undefined. Make sure you don't have any circular dependencies."));n.has(j)||n.add(j);var z=j._definition;if(z.addField(J,L),z.descriptors[J]){if(z.deprecated[J])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(J,"' definition on '").concat(j.name,"'.\nCheck @type() annotation"))}catch(P){var G=P.stack.split("\n")[4].trim();throw new Error("".concat(P.message," ").concat(G))}}var C=g.is(L),t=!C&&c.is(L);if("string"!==typeof L&&!qL.is(L)){var E=Object.values(L)[0];"string"===typeof E||n.has(E)||n.add(E)}if(r.manual)z.descriptors[J]={enumerable:!0,configurable:!0,writable:!0};else{var x="_".concat(J);z.descriptors[x]={enumerable:!1,configurable:!1,writable:!0},z.descriptors[J]={get:function(){return this[x]},set:function(L){L!==this[x]&&(void 0!==L&&null!==L?(!C||L instanceof g||(L=new(g.bind.apply(g,i([void 0],L,!1)))),!t||L instanceof c||(L=new c(L)),void 0===L.$proxy&&(t?L=b(L):C&&(L=w(L))),this.$changes.change(J),L.$changes&&L.$changes.setParent(this,this.$changes.root,this._definition.indexes[J])):this[x]&&this.$changes.delete(J),this[x]=L)},enumerable:!0,configurable:!0}}}}function e(L){return function(r,p){var J=r.constructor;J._definition.addFilter(p,L)&&(J._context.useFilters=!0)}}function v(L){return function(r,p){var J=r.constructor;J._definition.addChildrenFilter(p,L)&&(J._context.useFilters=!0)}}function y(L){return void 0===L&&(L=!0),function(r,p){var J=r.constructor._definition;J.deprecated[p]=!0,L&&(J.descriptors[p]={get:function(){throw new Error("".concat(p," is deprecated."))},set:function(L){},enumerable:!1,configurable:!0})}}function A(L,r,p){for(var J in void 0===p&&(p={}),p.context||(p.context=L._context||p.context||F),r)Q(r[J],p)(L.prototype,J);return L}function u(L){for(var r=0,p=0,J=0,i=L.length;J<i;J++)(r=L.charCodeAt(J))<128?p+=1:r<2048?p+=2:r<55296||r>=57344?p+=3:(J++,p+=4);return p}function a(L,r,p){for(var J=0,i=0,n=p.length;i<n;i++)(J=p.charCodeAt(i))<128?L[r++]=J:J<2048?(L[r++]=192|J>>6,L[r++]=128|63&J):J<55296||J>=57344?(L[r++]=224|J>>12,L[r++]=128|J>>6&63,L[r++]=128|63&J):(i++,J=65536+((1023&J)<<10|1023&p.charCodeAt(i)),L[r++]=240|J>>18,L[r++]=128|J>>12&63,L[r++]=128|J>>6&63,L[r++]=128|63&J)}function q(L,r){L.push(255&r)}function Z(L,r){L.push(255&r)}function X(L,r){L.push(255&r),L.push(r>>8&255)}function D(L,r){L.push(255&r),L.push(r>>8&255)}function l(L,r){L.push(255&r),L.push(r>>8&255),L.push(r>>16&255),L.push(r>>24&255)}function T(L,r){var p=r>>24,J=r>>16,i=r>>8,n=r;L.push(255&n),L.push(255&i),L.push(255&J),L.push(255&p)}function Y(L,r){var p=Math.floor(r/Math.pow(2,32));T(L,r>>>0),T(L,p)}function M(L,r){var p=r/Math.pow(2,32)|0;T(L,r>>>0),T(L,p)}function f(L,r){k(L,r)}function d(L,r){R(L,r)}var s=new Int32Array(2),H=new Float32Array(s.buffer),o=new Float64Array(s.buffer);function k(L,r){H[0]=r,l(L,s[0])}function R(L,r){o[0]=r,l(L,s[0]),l(L,s[1])}function I(L,r){return Z(L,r?1:0)}function N(L,r){r||(r="");var p=u(r),J=0;if(p<32)L.push(160|p),J=1;else if(p<256)L.push(217),Z(L,p),J=2;else if(p<65536)L.push(218),D(L,p),J=3;else{if(!(p<4294967296))throw new Error("String too long");L.push(219),T(L,p),J=5}return a(L,L.length,r),J+p}function K(L,r){return isNaN(r)?K(L,0):isFinite(r)?r!==(0|r)?(L.push(203),R(L,r),9):r>=0?r<128?(Z(L,r),1):r<256?(L.push(204),Z(L,r),2):r<65536?(L.push(205),D(L,r),3):r<4294967296?(L.push(206),T(L,r),5):(L.push(207),M(L,r),9):r>=-32?(L.push(224|r+32),1):r>=-128?(L.push(208),q(L,r),2):r>=-32768?(L.push(209),X(L,r),3):r>=-2147483648?(L.push(210),l(L,r),5):(L.push(211),Y(L,r),9):K(L,r>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var mL=Object.freeze({__proto__:null,utf8Write:a,int8:q,uint8:Z,int16:X,uint16:D,int32:l,uint32:T,int64:Y,uint64:M,float32:f,float64:d,writeFloat32:k,writeFloat64:R,boolean:I,string:N,number:K});function V(L,r,p){for(var J="",i=0,n=r,j=r+p;n<j;n++){var z=L[n];0!==(128&z)?192!==(224&z)?224!==(240&z)?240!==(248&z)?console.error("Invalid byte "+z.toString(16)):(i=(7&z)<<18|(63&L[++n])<<12|(63&L[++n])<<6|63&L[++n])>=65536?(i-=65536,J+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):J+=String.fromCharCode(i):J+=String.fromCharCode((15&z)<<12|(63&L[++n])<<6|63&L[++n]):J+=String.fromCharCode((31&z)<<6|63&L[++n]):J+=String.fromCharCode(z)}return J}function S(L,r){return LL(L,r)<<24>>24}function LL(L,r){return L[r.offset++]}function rL(L,r){return pL(L,r)<<16>>16}function pL(L,r){return L[r.offset++]|L[r.offset++]<<8}function JL(L,r){return L[r.offset++]|L[r.offset++]<<8|L[r.offset++]<<16|L[r.offset++]<<24}function iL(L,r){return JL(L,r)>>>0}function nL(L,r){return xL(L,r)}function jL(L,r){return wL(L,r)}function zL(L,r){var p=iL(L,r);return JL(L,r)*Math.pow(2,32)+p}function GL(L,r){var p=iL(L,r);return iL(L,r)*Math.pow(2,32)+p}var CL=new Int32Array(2),tL=new Float32Array(CL.buffer),EL=new Float64Array(CL.buffer);function xL(L,r){return CL[0]=JL(L,r),tL[0]}function wL(L,r){return CL[0]=JL(L,r),CL[1]=JL(L,r),EL[0]}function gL(L,r){return LL(L,r)>0}function bL(L,r){var p,J=L[r.offset++];J<192?p=31&J:217===J?p=LL(L,r):218===J?p=pL(L,r):219===J&&(p=iL(L,r));var i=V(L,r.offset,p);return r.offset+=p,i}function cL(L,r){var p=L[r.offset];return p<192&&p>160||217===p||218===p||219===p}function PL(L,r){var p=L[r.offset++];return p<128?p:202===p?xL(L,r):203===p?wL(L,r):204===p?LL(L,r):205===p?pL(L,r):206===p?iL(L,r):207===p?GL(L,r):208===p?S(L,r):209===p?rL(L,r):210===p?JL(L,r):211===p?zL(L,r):p>223?-1*(255-p+1):void 0}function OL(L,r){var p=L[r.offset];return p<128||p>=202&&p<=211}function hL(L,r){return L[r.offset]<160}function UL(L,r){return L[r.offset-1]===j&&(L[r.offset]<128||L[r.offset]>=202&&L[r.offset]<=211)}var WL=Object.freeze({__proto__:null,int8:S,uint8:LL,int16:rL,uint16:pL,int32:JL,uint32:iL,float32:nL,float64:jL,int64:zL,uint64:GL,readFloat32:xL,readFloat64:wL,boolean:gL,string:bL,stringCheck:cL,number:PL,numberCheck:OL,arrayCheck:hL,switchStructureCheck:UL}),BL=function(){function r(L){var r=this;this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L&&L.forEach((function(L){return r.add(L)}))}return r.prototype.Xz=function(r,p){return void 0===p&&(p=!0),C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,r,p?this.$items:void 0)},r.prototype.br=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,r)},r.prototype.onChange=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,r)},r.is=function(L){return void 0!==L.collection},r.prototype.add=function(L){var r=this.$refId++;return void 0!==L.$changes&&L.$changes.setParent(this,this.$changes.root,r),this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,L),this.$changes.change(r),r},r.prototype.at=function(L){var r=Array.from(this.$items.keys())[L];return this.$items.get(r)},r.prototype.entries=function(){return this.$items.entries()},r.prototype.delete=function(L){for(var r,p,J=this.$items.entries();(p=J.next())&&!p.done;)if(L===p.value[1]){r=p.value[0];break}return void 0!==r&&(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},r.prototype.clear=function(r){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),r&&t.call(this,r),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},r.prototype.has=function(L){return Array.from(this.$items.values()).some((function(r){return r===L}))},r.prototype.forEach=function(L){var r=this;this.$items.forEach((function(p,J,i){return L(p,J,r)}))},r.prototype.values=function(){return this.$items.values()},Object.defineProperty(r.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),r.prototype.setIndex=function(L,r){this.$indexes.set(L,r)},r.prototype.getIndex=function(L){return this.$indexes.get(L)},r.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},r.prototype.deleteByIndex=function(L){var r=this.$indexes.get(L);this.$items.delete(r),this.$indexes.delete(L)},r.prototype.toArray=function(){return Array.from(this.$items.values())},r.prototype.toJSON=function(){var L=[];return this.forEach((function(r,p){L.push("function"===typeof r.toJSON?r.toJSON():r)})),L},r.prototype.clone=function(L){var p;return L?p=Object.assign(new r,this):(p=new r,this.forEach((function(L){L.$changes?p.add(L.clone()):p.add(L)}))),p},r}(),FL=function(){function r(L){var r=this;this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,L&&L.forEach((function(L){return r.add(L)}))}return r.prototype.Xz=function(r,p){return void 0===p&&(p=!0),C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.ADD,r,p?this.$items:void 0)},r.prototype.br=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,r)},r.prototype.onChange=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,r)},r.is=function(L){return void 0!==L.set},r.prototype.add=function(r){var p,J;if(this.has(r))return!1;var i=this.$refId++;void 0!==r.$changes&&r.$changes.setParent(this,this.$changes.root,i);var n=null!==(J=null===(p=this.$changes.indexes[i])||void 0===p?void 0:p.op)&&void 0!==J?J:L.OPERATION.ADD;return this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,r),this.$changes.change(i,n),i},r.prototype.entries=function(){return this.$items.entries()},r.prototype.delete=function(L){for(var r,p,J=this.$items.entries();(p=J.next())&&!p.done;)if(L===p.value[1]){r=p.value[0];break}return void 0!==r&&(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},r.prototype.clear=function(r){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),r&&t.call(this,r),this.$items.clear(),this.$changes.operation({index:0,op:L.OPERATION.CLEAR}),this.$changes.touchParents()},r.prototype.has=function(L){for(var r,p=this.$items.values(),J=!1;(r=p.next())&&!r.done;)if(L===r.value){J=!0;break}return J},r.prototype.forEach=function(L){var r=this;this.$items.forEach((function(p,J,i){return L(p,J,r)}))},r.prototype.values=function(){return this.$items.values()},Object.defineProperty(r.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),r.prototype.setIndex=function(L,r){this.$indexes.set(L,r)},r.prototype.getIndex=function(L){return this.$indexes.get(L)},r.prototype.getByIndex=function(L){return this.$items.get(this.$indexes.get(L))},r.prototype.deleteByIndex=function(L){var r=this.$indexes.get(L);this.$items.delete(r),this.$indexes.delete(L)},r.prototype.toArray=function(){return Array.from(this.$items.values())},r.prototype.toJSON=function(){var L=[];return this.forEach((function(r,p){L.push("function"===typeof r.toJSON?r.toJSON():r)})),L},r.prototype.clone=function(L){var p;return L?p=Object.assign(new r,this):(p=new r,this.forEach((function(L){L.$changes?p.add(L.clone()):p.add(L)}))),p},r}(),QL=function(){function L(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return L.prototype.addRefId=function(L){this.refIds.has(L)||(this.refIds.add(L),this.containerIndexes.set(L,new Set))},L.get=function(r){return void 0===r.$filterState&&(r.$filterState=new L),r.$filterState},L}(),eL=function(){function L(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return L.prototype.getNextUniqueId=function(){return this.nextUniqueId++},L.prototype.addRef=function(L,r,p){void 0===p&&(p=!0),this.refs.set(L,r),p&&(this.refCounts[L]=(this.refCounts[L]||0)+1)},L.prototype.removeRef=function(L){this.refCounts[L]=this.refCounts[L]-1,this.deletedRefs.add(L)},L.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},L.prototype.garbageCollectDeletedRefs=function(){var L=this;this.deletedRefs.forEach((function(r){if(!(L.refCounts[r]>0)){var p=L.refs.get(r);if(p instanceof qL)for(var J in p._definition.schema)"string"!==typeof p._definition.schema[J]&&p[J]&&p[J].$changes&&L.removeRef(p[J].$changes.refId);else{var i=p.$changes.parent._definition,n=i.schema[i.fieldsByIndex[p.$changes.parentIndex]];"function"===typeof Object.values(n)[0]&&Array.from(p.values()).forEach((function(r){return L.removeRef(r.$changes.refId)}))}L.refs.delete(r),delete L.refCounts[r]}})),this.deletedRefs.clear()},L}(),vL=function(L){function r(){return null!==L&&L.apply(this,arguments)||this}return p(r,L),r}(Error);function yL(L,r,p,J){var i,n=!1;switch(r){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":i="number",isNaN(L)&&console.log('trying to encode "NaN" in '.concat(p.constructor.name,"#").concat(J));break;case"string":i="string",n=!0;break;case"boolean":return}if(typeof L!==i&&(!n||n&&null!==L)){var j="'".concat(JSON.stringify(L),"'").concat(L&&L.constructor&&" (".concat(L.constructor.name,")")||"");throw new vL("a '".concat(i,"' was expected, but ").concat(j," was provided in ").concat(p.constructor.name,"#").concat(J))}}function AL(L,r,p,J){if(!(L instanceof r))throw new vL("a '".concat(r.name,"' was expected, but '").concat(L.constructor.name,"' was provided in ").concat(p.constructor.name,"#").concat(J))}function uL(L,r,p,J,i){yL(p,L,J,i);var n=mL[L];if(!n)throw new vL("a '".concat(L,"' was expected, but ").concat(p," was provided in ").concat(J.constructor.name,"#").concat(i));n(r,p)}function aL(L,r,p){return WL[L](r,p)}var qL=function(){function r(){for(var L=[],r=0;r<arguments.length;r++)L[r]=arguments[r];Object.defineProperties(this,{$changes:{value:new G(this,void 0,new eL),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var p=this._definition.descriptors;p&&Object.defineProperties(this,p),L[0]&&this.assign(L[0])}return r.onError=function(L){console.error(L)},r.is=function(L){return L._definition&&void 0!==L._definition.schema},r.prototype.onChange=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.REPLACE,r)},r.prototype.br=function(r){return C(this.$callbacks||(this.$callbacks=[]),L.OPERATION.DELETE,r)},r.prototype.assign=function(L){return Object.assign(this,L),this},Object.defineProperty(r.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),r.prototype.setDirty=function(L,r){this.$changes.change(L,r)},r.prototype.listen=function(L,r,p){var J=this;return void 0===p&&(p=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[L]||(this.$callbacks[L]=[]),this.$callbacks[L].push(r),p&&void 0!==this[L]&&r(this[L],void 0),function(){return E(J.$callbacks[L],J.$callbacks[L].indexOf(r))}},r.prototype.decode=function(p,J,i){var n;void 0===J&&(J={offset:0}),void 0===i&&(i=this);var z=[],G=this.$changes.root,C=p.length,t=0;for(G.refs.set(t,this);J.offset<C;){var E=p[J.offset++];if(E!=j){var x=i.$changes,w=void 0!==i._definition,b=w?E>>6<<6:E;if(b!==L.OPERATION.CLEAR){var P=w?E%(b||255):PL(p,J),O=w?i._definition.fieldsByIndex[P]:"",U=x.getType(P),W=void 0,B=void 0,F=void 0;if(w?B=i["_".concat(O)]:(B=i.getByIndex(P),(b&L.OPERATION.ADD)===L.OPERATION.ADD?(F=i instanceof c?bL(p,J):P,i.setIndex(P,F)):F=i.getIndex(P)),(b&L.OPERATION.DELETE)===L.OPERATION.DELETE&&(b!==L.OPERATION.DELETE_AND_ADD&&i.deleteByIndex(P),B&&B.$changes&&G.removeRef(B.$changes.refId),W=null),void 0!==O){if(b===L.OPERATION.DELETE);else if(r.is(U)){var Q=PL(p,J);if(W=G.refs.get(Q),b!==L.OPERATION.REPLACE){var e=this.getSchemaType(p,J,U);W||((W=this.createTypeInstance(e)).$changes.refId=Q,B&&(W.$callbacks=B.$callbacks,B.$changes.refId&&Q!==B.$changes.refId&&G.removeRef(B.$changes.refId))),G.addRef(Q,W,W!==B)}}else if("string"===typeof U)W=aL(U,p,J);else{var v=h(Object.keys(U)[0]),y=PL(p,J),A=G.refs.has(y)?B||G.refs.get(y):new v.constructor;if((W=A.clone(!0)).$changes.refId=y,B&&(W.$callbacks=B.$callbacks,B.$changes.refId&&y!==B.$changes.refId)){G.removeRef(B.$changes.refId);for(var u=B.entries(),a=void 0;(a=u.next())&&!a.done;){var q=(n=a.value)[0],Z=n[1];z.push({refId:y,op:L.OPERATION.DELETE,field:q,value:void 0,previousValue:Z})}}G.addRef(y,W,A!==B)}if(null!==W&&void 0!==W)if(W.$changes&&W.$changes.setParent(x.ref,x.root,P),i instanceof r)i[O]=W;else if(i instanceof c)q=F,i.$items.set(q,W),i.$changes.allChanges.add(P);else if(i instanceof g)i.setAt(P,W);else if(i instanceof BL){var X=i.add(W);i.setIndex(P,X)}else i instanceof FL&&!1!==(X=i.add(W))&&i.setIndex(P,X);B!==W&&z.push({refId:t,op:b,field:O,dynamicIndex:F,value:W,previousValue:B})}else{console.warn("@colyseus/schema: definition mismatch");for(var D={offset:J.offset};J.offset<C&&(!UL(p,J)||(D.offset=J.offset+1,!G.refs.has(PL(p,D))));)J.offset++}}else i.clear(z)}else{t=PL(p,J);var l=G.refs.get(t);if(!l)throw new Error('"refId" not found: '.concat(t));i=l}}return this._triggerChanges(z),G.garbageCollectDeletedRefs(),z},r.prototype.encode=function(p,J,i){void 0===p&&(p=!1),void 0===J&&(J=[]),void 0===i&&(i=!1);for(var n=this.$changes,z=new WeakSet,G=[n],C=1,t=0;t<C;t++){var E=G[t],x=E.ref,w=x instanceof r;E.ensureRefId(),z.add(E),E!==n&&(E.changed||p)&&(Z(J,j),K(J,E.refId));for(var g=p?Array.from(E.allChanges):Array.from(E.changes.values()),b=0,P=g.length;b<P;b++){var O=p?{op:L.OPERATION.ADD,index:g[b]}:g[b],U=O.index,W=w?x._definition.fieldsByIndex&&x._definition.fieldsByIndex[U]:U,B=J.length;if(O.op!==L.OPERATION.TOUCH)if(w)Z(J,U|O.op);else{if(Z(J,O.op),O.op===L.OPERATION.CLEAR)continue;K(J,U)}if(w||(O.op&L.OPERATION.ADD)!=L.OPERATION.ADD||x instanceof c&&N(J,E.ref.$indexes.get(U)),O.op!==L.OPERATION.DELETE){var F=E.getType(U),Q=E.getValue(U);if(Q&&Q.$changes&&!z.has(Q.$changes)&&(G.push(Q.$changes),Q.$changes.ensureRefId(),C++),O.op!==L.OPERATION.TOUCH){if(r.is(F))AL(Q,F,x,W),K(J,Q.$changes.refId),(O.op&L.OPERATION.ADD)===L.OPERATION.ADD&&this.tryEncodeTypeId(J,F,Q.constructor);else if("string"===typeof F)uL(F,J,Q,x,W);else{var e=h(Object.keys(F)[0]);AL(x["_".concat(W)],e.constructor,x,W),K(J,Q.$changes.refId)}i&&E.cache(U,J.slice(B))}}}p||i||E.discard()}return J},r.prototype.encodeAll=function(L){return this.encode(!0,[],L)},r.prototype.applyFilters=function(p,J){var i,n;void 0===J&&(J=!1);for(var z=this,G=new Set,C=QL.get(p),t=[this.$changes],E=1,x=[],w=function(w){var g=t[w];if(G.has(g.refId))return"continue";var b=g.ref,P=b instanceof r;Z(x,j),K(x,g.refId);var O=C.refIds.has(g),h=J||!O;C.addRefId(g);var U=C.containerIndexes.get(g),W=h?Array.from(g.allChanges):Array.from(g.changes.values());!J&&P&&b._definition.indexesWithFilters&&b._definition.indexesWithFilters.forEach((function(r){!U.has(r)&&g.allChanges.has(r)&&(h?W.push(r):W.push({op:L.OPERATION.ADD,index:r}))}));for(var B=0,F=W.length;B<F;B++){var Q=h?{op:L.OPERATION.ADD,index:W[B]}:W[B];if(Q.op!==L.OPERATION.CLEAR){var e=Q.index;if(Q.op!==L.OPERATION.DELETE){var v=g.getValue(e),y=g.getType(e);if(P){if((A=b._definition.filters&&b._definition.filters[e])&&!A.call(b,p,v,z)){v&&v.$changes&&G.add(v.$changes.refId);continue}}else{var A,u=g.parent;if((A=g.getChildrenFilter())&&!A.call(u,p,b.$indexes.get(e),v,z)){v&&v.$changes&&G.add(v.$changes.refId);continue}}if(v.$changes&&(t.push(v.$changes),E++),Q.op!==L.OPERATION.TOUCH)if(Q.op===L.OPERATION.ADD||P)x.push.apply(x,null!==(i=g.caches[e])&&void 0!==i?i:[]),U.add(e);else if(U.has(e))x.push.apply(x,null!==(n=g.caches[e])&&void 0!==n?n:[]);else{if(U.add(e),Z(x,L.OPERATION.ADD),K(x,e),b instanceof c){var a=g.ref.$indexes.get(e);N(x,a)}v.$changes?K(x,v.$changes.refId):mL[y](x,v)}else v.$changes&&!P&&(Z(x,L.OPERATION.ADD),K(x,e),b instanceof c&&(a=g.ref.$indexes.get(e),N(x,a)),K(x,v.$changes.refId))}else P?Z(x,Q.op|e):(Z(x,Q.op),K(x,e))}else Z(x,Q.op)}},g=0;g<E;g++)w(g);return x},r.prototype.clone=function(){var L,r=new this.constructor,p=this._definition.schema;for(var J in p)"object"===typeof this[J]&&"function"===typeof(null===(L=this[J])||void 0===L?void 0:L.clone)?r[J]=this[J].clone():r[J]=this[J];return r},r.prototype.toJSON=function(){var L=this._definition.schema,r=this._definition.deprecated,p={};for(var J in L)r[J]||null===this[J]||"undefined"===typeof this[J]||(p[J]="function"===typeof this[J].toJSON?this[J].toJSON():this["_".concat(J)]);return p},r.prototype.discardAllChanges=function(){this.$changes.discardAll()},r.prototype.getByIndex=function(L){return this[this._definition.fieldsByIndex[L]]},r.prototype.deleteByIndex=function(L){this[this._definition.fieldsByIndex[L]]=void 0},r.prototype.tryEncodeTypeId=function(L,r,p){r._typeid!==p._typeid&&(Z(L,z),K(L,p._typeid))},r.prototype.getSchemaType=function(L,r,p){var J;return L[r.offset]===z&&(r.offset++,J=this.constructor._context.get(PL(L,r))),J||p},r.prototype.createTypeInstance=function(L){var r=new L;return r.$changes.root=this.$changes.root,r},r.prototype._triggerChanges=function(p){for(var J,i,n,j,z,G,C,t,E,x=new Set,w=this.$changes.root.refs,g=function(g){var b=p[g],c=b.refId,P=w.get(c),O=P.$callbacks;if((b.op&L.OPERATION.DELETE)===L.OPERATION.DELETE&&b.previousValue instanceof r&&(null===(i=null===(J=b.previousValue.$callbacks)||void 0===J?void 0:J[L.OPERATION.DELETE])||void 0===i||i.forEach((function(L){return L()}))),!O)return"continue";if(P instanceof r){if(!x.has(c))try{null===(n=null===O||void 0===O?void 0:O[L.OPERATION.REPLACE])||void 0===n||n.forEach((function(L){return L()}))}catch(h){r.onError(h)}try{O.hasOwnProperty(b.field)&&(null===(j=O[b.field])||void 0===j||j.forEach((function(L){return L(b.value,b.previousValue)})))}catch(h){r.onError(h)}}else b.op===L.OPERATION.ADD&&void 0===b.previousValue?null===(z=O[L.OPERATION.ADD])||void 0===z||z.forEach((function(L){var r;return L(b.value,null!==(r=b.dynamicIndex)&&void 0!==r?r:b.field)})):b.op===L.OPERATION.DELETE?void 0!==b.previousValue&&(null===(G=O[L.OPERATION.DELETE])||void 0===G||G.forEach((function(L){var r;return L(b.previousValue,null!==(r=b.dynamicIndex)&&void 0!==r?r:b.field)}))):b.op===L.OPERATION.DELETE_AND_ADD&&(void 0!==b.previousValue&&(null===(C=O[L.OPERATION.DELETE])||void 0===C||C.forEach((function(L){var r;return L(b.previousValue,null!==(r=b.dynamicIndex)&&void 0!==r?r:b.field)}))),null===(t=O[L.OPERATION.ADD])||void 0===t||t.forEach((function(L){var r;return L(b.value,null!==(r=b.dynamicIndex)&&void 0!==r?r:b.field)}))),b.value!==b.previousValue&&(null===(E=O[L.OPERATION.REPLACE])||void 0===E||E.forEach((function(L){var r;return L(b.value,null!==(r=b.dynamicIndex)&&void 0!==r?r:b.field)})));x.add(c)},b=0;b<p.length;b++)g(b)},r._definition=U.create(),r}();function ZL(L){for(var r=[L.$changes],p=1,J={},i=J,n=function(L){var p=r[L];p.changes.forEach((function(L){var r=p.ref,J=L.index,n=r._definition?r._definition.fieldsByIndex[J]:r.$indexes.get(J);i[n]=p.getValue(J)}))},j=0;j<p;j++)n(j);return J}var XL={context:new B},DL=function(L){function r(){return null!==L&&L.apply(this,arguments)||this}return p(r,L),J([Q("string",XL)],r.prototype,"name",void 0),J([Q("string",XL)],r.prototype,"type",void 0),J([Q("number",XL)],r.prototype,"referencedType",void 0),r}(qL),lL=function(L){function r(){var r=null!==L&&L.apply(this,arguments)||this;return r.fields=new g,r}return p(r,L),J([Q("number",XL)],r.prototype,"id",void 0),J([Q([DL],XL)],r.prototype,"fields",void 0),r}(qL),TL=function(L){function r(){var r=null!==L&&L.apply(this,arguments)||this;return r.types=new g,r}return p(r,L),r.encode=function(L){var p=L.constructor,J=new r;J.rootType=p._typeid;var i=function(L,r){for(var p in r){var i=new DL;i.name=p;var n=void 0;if("string"===typeof r[p])n=r[p];else{var j=r[p],z=void 0;qL.is(j)?(n="ref",z=r[p]):"string"===typeof j[n=Object.keys(j)[0]]?n+=":"+j[n]:z=j[n],i.referencedType=z?z._typeid:-1}i.type=n,L.fields.push(i)}J.types.push(L)},n=p._context.types;for(var j in n){var z=new lL;z.id=Number(j),i(z,n[j]._definition.schema)}return J.encodeAll()},r.decode=function(L,J){var i=new B,n=new r;n.decode(L,J);var j=n.types.reduce((function(L,r){var J=function(L){function r(){return null!==L&&L.apply(this,arguments)||this}return p(r,L),r}(qL),n=r.id;return L[n]=J,i.add(J,n),L}),{});n.types.forEach((function(L){var r=j[L.id];L.fields.forEach((function(L){var p;if(void 0!==L.referencedType){var J=L.type,n=j[L.referencedType];if(!n){var z=L.type.split(":");J=z[0],n=z[1]}"ref"===J?Q(n,{context:i})(r.prototype,L.name):Q(((p={})[J]=n,p),{context:i})(r.prototype,L.name)}else Q(L.type,{context:i})(r.prototype,L.name)}))}));var z=j[n.rootType],G=new z;for(var C in z._definition.schema){var t=z._definition.schema[C];"string"!==typeof t&&(G[C]="function"===typeof t?new t:new(h(Object.keys(t)[0]).constructor))}return G},J([Q([lL],XL)],r.prototype,"types",void 0),J([Q("number",XL)],r.prototype,"rootType",void 0),r}(qL);O("map",{constructor:c}),O("array",{constructor:g}),O("set",{constructor:FL}),O("collection",{constructor:BL}),L.ArraySchema=g,L.CollectionSchema=BL,L.Context=B,L.MapSchema=c,L.Reflection=TL,L.ReflectionField=DL,L.ReflectionType=lL,L.Schema=qL,L.SchemaDefinition=U,L.SetSchema=FL,L.decode=WL,L.defineTypes=A,L.deprecated=y,L.dumpChanges=ZL,L.encode=mL,L.filter=e,L.filterChildren=v,L.hasFilter=W,L.registerType=O,L.type=Q,Object.defineProperty(L,"__esModule",{value:!0})}(r)},14260:L=>{"use strict";L.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14257:(L,r,p)=>{var J=p(14260),i=p(14267),n=Object.hasOwnProperty,j=Object.create(null);for(var z in J)n.call(J,z)&&(j[J[z]]=z);var G=L.exports={to:{},get:{}};function C(L,r,p){return Math.min(Math.max(r,L),p)}function t(L){var r=Math.round(L).toString(16).toUpperCase();return r.length<2?"0"+r:r}G.get=function(L){var r,p;switch(L.substring(0,3).toLowerCase()){case"hsl":r=G.get.hsl(L),p="hsl";break;case"hwb":r=G.get.hwb(L),p="hwb";break;default:r=G.get.rgb(L),p="rgb"}return r?{model:p,value:r}:null},G.get.rgb=function(L){if(!L)return null;var r,p,i,j=[0,0,0,1];if(r=L.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=r[2],r=r[1],p=0;p<3;p++){var z=2*p;j[p]=parseInt(r.slice(z,z+2),16)}i&&(j[3]=parseInt(i,16)/255)}else if(r=L.match(/^#([a-f0-9]{3,4})$/i)){for(i=(r=r[1])[3],p=0;p<3;p++)j[p]=parseInt(r[p]+r[p],16);i&&(j[3]=parseInt(i+i,16)/255)}else if(r=L.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(p=0;p<3;p++)j[p]=parseInt(r[p+1],0);r[4]&&(r[5]?j[3]=.01*parseFloat(r[4]):j[3]=parseFloat(r[4]))}else{if(!(r=L.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(r=L.match(/^(\w+)$/))?"transparent"===r[1]?[0,0,0,0]:n.call(J,r[1])?((j=J[r[1]])[3]=1,j):null:null;for(p=0;p<3;p++)j[p]=Math.round(2.55*parseFloat(r[p+1]));r[4]&&(r[5]?j[3]=.01*parseFloat(r[4]):j[3]=parseFloat(r[4]))}for(p=0;p<3;p++)j[p]=C(j[p],0,255);return j[3]=C(j[3],0,1),j},G.get.hsl=function(L){if(!L)return null;var r=L.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(r){var p=parseFloat(r[4]);return[(parseFloat(r[1])%360+360)%360,C(parseFloat(r[2]),0,100),C(parseFloat(r[3]),0,100),C(isNaN(p)?1:p,0,1)]}return null},G.get.hwb=function(L){if(!L)return null;var r=L.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(r){var p=parseFloat(r[4]);return[(parseFloat(r[1])%360+360)%360,C(parseFloat(r[2]),0,100),C(parseFloat(r[3]),0,100),C(isNaN(p)?1:p,0,1)]}return null},G.to.hex=function(){var L=i(arguments);return"#"+t(L[0])+t(L[1])+t(L[2])+(L[3]<1?t(Math.round(255*L[3])):"")},G.to.rgb=function(){var L=i(arguments);return L.length<4||1===L[3]?"rgb("+Math.round(L[0])+", "+Math.round(L[1])+", "+Math.round(L[2])+")":"rgba("+Math.round(L[0])+", "+Math.round(L[1])+", "+Math.round(L[2])+", "+L[3]+")"},G.to.rgb.percent=function(){var L=i(arguments),r=Math.round(L[0]/255*100),p=Math.round(L[1]/255*100),J=Math.round(L[2]/255*100);return L.length<4||1===L[3]?"rgb("+r+"%, "+p+"%, "+J+"%)":"rgba("+r+"%, "+p+"%, "+J+"%, "+L[3]+")"},G.to.hsl=function(){var L=i(arguments);return L.length<4||1===L[3]?"hsl("+L[0]+", "+L[1]+"%, "+L[2]+"%)":"hsla("+L[0]+", "+L[1]+"%, "+L[2]+"%, "+L[3]+")"},G.to.hwb=function(){var L=i(arguments),r="";return L.length>=4&&1!==L[3]&&(r=", "+L[3]),"hwb("+L[0]+", "+L[1]+"%, "+L[2]+"%"+r+")"},G.to.keyword=function(L){return j[L.slice(0,3)]}},14251:(L,r,p)=>{const J=p(14257),i=p(14277),n=["keyword","gray","hex"],j={};for(const w of Object.keys(i))j[[...i[w].labels].sort().join("")]=w;const z={};function G(L,r){if(!(this instanceof G))return new G(L,r);if(r&&r in n&&(r=null),r&&!(r in i))throw new Error("Unknown model: "+r);let p,C;if(null==L)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(L instanceof G)this.model=L.model,this.color=[...L.color],this.valpha=L.valpha;else if("string"===typeof L){const r=J.get(L);if(null===r)throw new Error("Unable to parse color from string: "+L);this.model=r.model,C=i[this.model].channels,this.color=r.value.slice(0,C),this.valpha="number"===typeof r.value[C]?r.value[C]:1}else if(L.length>0){this.model=r||"rgb",C=i[this.model].channels;const p=Array.prototype.slice.call(L,0,C);this.color=x(p,C),this.valpha="number"===typeof L[C]?L[C]:1}else if("number"===typeof L)this.model="rgb",this.color=[L>>16&255,L>>8&255,255&L],this.valpha=1;else{this.valpha=1;const r=Object.keys(L);"alpha"in L&&(r.splice(r.indexOf("alpha"),1),this.valpha="number"===typeof L.alpha?L.alpha:0);const J=r.sort().join("");if(!(J in j))throw new Error("Unable to parse color from object: "+JSON.stringify(L));this.model=j[J];const{labels:n}=i[this.model],z=[];for(p=0;p<n.length;p++)z.push(L[n[p]]);this.color=x(z)}if(z[this.model])for(C=i[this.model].channels,p=0;p<C;p++){const L=z[this.model][p];L&&(this.color[p]=L(this.color[p]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}G.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(L){let r=this.model in J.to?this:this.rgb();r=r.round("number"===typeof L?L:1);const p=1===r.valpha?r.color:[...r.color,this.valpha];return J.to[r.model](p)},percentString(L){const r=this.rgb().round("number"===typeof L?L:1),p=1===r.valpha?r.color:[...r.color,this.valpha];return J.to.rgb.percent(p)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const L={},{channels:r}=i[this.model],{labels:p}=i[this.model];for(let J=0;J<r;J++)L[p[J]]=this.color[J];return 1!==this.valpha&&(L.alpha=this.valpha),L},unitArray(){const L=this.rgb().color;return L[0]/=255,L[1]/=255,L[2]/=255,1!==this.valpha&&L.push(this.valpha),L},unitObject(){const L=this.rgb().object();return L.r/=255,L.g/=255,L.b/=255,1!==this.valpha&&(L.alpha=this.valpha),L},round(L){return L=Math.max(L||0,0),new G([...this.color.map(C(L)),this.valpha],this.model)},alpha(L){return void 0!==L?new G([...this.color,Math.max(0,Math.min(1,L))],this.model):this.valpha},red:t("rgb",0,E(255)),green:t("rgb",1,E(255)),blue:t("rgb",2,E(255)),hue:t(["hsl","hsv","hsl","hwb","hcg"],0,(L=>(L%360+360)%360)),saturationl:t("hsl",1,E(100)),lightness:t("hsl",2,E(100)),saturationv:t("hsv",1,E(100)),value:t("hsv",2,E(100)),chroma:t("hcg",1,E(100)),gray:t("hcg",2,E(100)),white:t("hwb",1,E(100)),wblack:t("hwb",2,E(100)),cyan:t("cmyk",0,E(100)),magenta:t("cmyk",1,E(100)),yellow:t("cmyk",2,E(100)),black:t("cmyk",3,E(100)),x:t("xyz",0,E(95.047)),y:t("xyz",1,E(100)),z:t("xyz",2,E(108.833)),l:t("lab",0,E(100)),a:t("lab",1),b:t("lab",2),keyword(L){return void 0!==L?new G(L):i[this.model].keyword(this.color)},hex(L){return void 0!==L?new G(L):J.to.hex(this.rgb().round().color)},hexa(L){if(void 0!==L)return new G(L);const r=this.rgb().round().color;let p=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===p.length&&(p="0"+p),J.to.hex(r)+p},rgbNumber(){const L=this.rgb().color;return(255&L[0])<<16|(255&L[1])<<8|255&L[2]},luminosity(){const L=this.rgb().color,r=[];for(const[p,J]of L.entries()){const L=J/255;r[p]=L<=.04045?L/12.92:((L+.055)/1.055)**2.4}return.2126*r[0]+.7152*r[1]+.0722*r[2]},contrast(L){const r=this.luminosity(),p=L.luminosity();return r>p?(r+.05)/(p+.05):(p+.05)/(r+.05)},level(L){const r=this.contrast(L);return r>=7?"AAA":r>=4.5?"AA":""},isDark(){const L=this.rgb().color;return(2126*L[0]+7152*L[1]+722*L[2])/1e4<128},isLight(){return!this.isDark()},negate(){const L=this.rgb();for(let r=0;r<3;r++)L.color[r]=255-L.color[r];return L},lighten(L){const r=this.hsl();return r.color[2]+=r.color[2]*L,r},darken(L){const r=this.hsl();return r.color[2]-=r.color[2]*L,r},saturate(L){const r=this.hsl();return r.color[1]+=r.color[1]*L,r},desaturate(L){const r=this.hsl();return r.color[1]-=r.color[1]*L,r},whiten(L){const r=this.hwb();return r.color[1]+=r.color[1]*L,r},blacken(L){const r=this.hwb();return r.color[2]+=r.color[2]*L,r},grayscale(){const L=this.rgb().color,r=.3*L[0]+.59*L[1]+.11*L[2];return G.rgb(r,r,r)},fade(L){return this.alpha(this.valpha-this.valpha*L)},opaquer(L){return this.alpha(this.valpha+this.valpha*L)},rotate(L){const r=this.hsl();let p=r.color[0];return p=(p+L)%360,p=p<0?360+p:p,r.color[0]=p,r},mix(L,r){if(!L||!L.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof L);const p=L.rgb(),J=this.rgb(),i=void 0===r?.5:r,n=2*i-1,j=p.alpha()-J.alpha(),z=((n*j===-1?n:(n+j)/(1+n*j))+1)/2,C=1-z;return G.rgb(z*p.red()+C*J.red(),z*p.green()+C*J.green(),z*p.blue()+C*J.blue(),p.alpha()*i+J.alpha()*(1-i))}};for(const w of Object.keys(i)){if(n.includes(w))continue;const{channels:L}=i[w];G.prototype[w]=function(){if(this.model===w)return new G(this);for(var L=arguments.length,r=new Array(L),p=0;p<L;p++)r[p]=arguments[p];return r.length>0?new G(r,w):new G([...(J=i[this.model][w].raw(this.color),Array.isArray(J)?J:[J]),this.valpha],w);var J},G[w]=function(){for(var r=arguments.length,p=new Array(r),J=0;J<r;J++)p[J]=arguments[J];let i=p[0];return"number"===typeof i&&(i=x(p,L)),new G(i,w)}}function C(L){return function(r){return function(L,r){return Number(L.toFixed(r))}(r,L)}}function t(L,r,p){L=Array.isArray(L)?L:[L];for(const J of L)(z[J]||(z[J]=[]))[r]=p;return L=L[0],function(J){let i;return void 0!==J?(p&&(J=p(J)),i=this[L](),i.color[r]=J,i):(i=this[L]().color[r],p&&(i=p(i)),i)}}function E(L){return function(r){return Math.max(0,Math.min(L,r))}}function x(L,r){for(let p=0;p<r;p++)"number"!==typeof L[p]&&(L[p]=0);return L}L.exports=G},14284:(L,r,p)=>{const J=p(14286),i={};for(const j of Object.keys(J))i[J[j]]=j;const n={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};L.exports=n;for(const j of Object.keys(n)){if(!("channels"in n[j]))throw new Error("missing channels property: "+j);if(!("labels"in n[j]))throw new Error("missing channel labels property: "+j);if(n[j].labels.length!==n[j].channels)throw new Error("channel and label counts mismatch: "+j);const{channels:L,labels:r}=n[j];delete n[j].channels,delete n[j].labels,Object.defineProperty(n[j],"channels",{value:L}),Object.defineProperty(n[j],"labels",{value:r})}n.rgb.hsl=function(L){const r=L[0]/255,p=L[1]/255,J=L[2]/255,i=Math.min(r,p,J),n=Math.max(r,p,J),j=n-i;let z,G;n===i?z=0:r===n?z=(p-J)/j:p===n?z=2+(J-r)/j:J===n&&(z=4+(r-p)/j),z=Math.min(60*z,360),z<0&&(z+=360);const C=(i+n)/2;return G=n===i?0:C<=.5?j/(n+i):j/(2-n-i),[z,100*G,100*C]},n.rgb.hsv=function(L){let r,p,J,i,n;const j=L[0]/255,z=L[1]/255,G=L[2]/255,C=Math.max(j,z,G),t=C-Math.min(j,z,G),E=function(L){return(C-L)/6/t+.5};return 0===t?(i=0,n=0):(n=t/C,r=E(j),p=E(z),J=E(G),j===C?i=J-p:z===C?i=1/3+r-J:G===C&&(i=2/3+p-r),i<0?i+=1:i>1&&(i-=1)),[360*i,100*n,100*C]},n.rgb.hwb=function(L){const r=L[0],p=L[1];let J=L[2];const i=n.rgb.hsl(L)[0],j=1/255*Math.min(r,Math.min(p,J));return J=1-1/255*Math.max(r,Math.max(p,J)),[i,100*j,100*J]},n.rgb.cmyk=function(L){const r=L[0]/255,p=L[1]/255,J=L[2]/255,i=Math.min(1-r,1-p,1-J);return[100*((1-r-i)/(1-i)||0),100*((1-p-i)/(1-i)||0),100*((1-J-i)/(1-i)||0),100*i]},n.rgb.keyword=function(L){const r=i[L];if(r)return r;let p,n=1/0;for(const i of Object.keys(J)){const r=J[i],G=(z=r,((j=L)[0]-z[0])**2+(j[1]-z[1])**2+(j[2]-z[2])**2);G<n&&(n=G,p=i)}var j,z;return p},n.keyword.rgb=function(L){return J[L]},n.rgb.xyz=function(L){let r=L[0]/255,p=L[1]/255,J=L[2]/255;r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,p=p>.04045?((p+.055)/1.055)**2.4:p/12.92,J=J>.04045?((J+.055)/1.055)**2.4:J/12.92;return[100*(.4124*r+.3576*p+.1805*J),100*(.2126*r+.7152*p+.0722*J),100*(.0193*r+.1192*p+.9505*J)]},n.rgb.lab=function(L){const r=n.rgb.xyz(L);let p=r[0],J=r[1],i=r[2];p/=95.047,J/=100,i/=108.883,p=p>.008856?p**(1/3):7.787*p+16/116,J=J>.008856?J**(1/3):7.787*J+16/116,i=i>.008856?i**(1/3):7.787*i+16/116;return[116*J-16,500*(p-J),200*(J-i)]},n.hsl.rgb=function(L){const r=L[0]/360,p=L[1]/100,J=L[2]/100;let i,n,j;if(0===p)return j=255*J,[j,j,j];i=J<.5?J*(1+p):J+p-J*p;const z=2*J-i,G=[0,0,0];for(let C=0;C<3;C++)n=r+1/3*-(C-1),n<0&&n++,n>1&&n--,j=6*n<1?z+6*(i-z)*n:2*n<1?i:3*n<2?z+(i-z)*(2/3-n)*6:z,G[C]=255*j;return G},n.hsl.hsv=function(L){const r=L[0];let p=L[1]/100,J=L[2]/100,i=p;const n=Math.max(J,.01);J*=2,p*=J<=1?J:2-J,i*=n<=1?n:2-n;return[r,100*(0===J?2*i/(n+i):2*p/(J+p)),100*((J+p)/2)]},n.hsv.rgb=function(L){const r=L[0]/60,p=L[1]/100;let J=L[2]/100;const i=Math.floor(r)%6,n=r-Math.floor(r),j=255*J*(1-p),z=255*J*(1-p*n),G=255*J*(1-p*(1-n));switch(J*=255,i){case 0:return[J,G,j];case 1:return[z,J,j];case 2:return[j,J,G];case 3:return[j,z,J];case 4:return[G,j,J];case 5:return[J,j,z]}},n.hsv.hsl=function(L){const r=L[0],p=L[1]/100,J=L[2]/100,i=Math.max(J,.01);let n,j;j=(2-p)*J;const z=(2-p)*i;return n=p*i,n/=z<=1?z:2-z,n=n||0,j/=2,[r,100*n,100*j]},n.hwb.rgb=function(L){const r=L[0]/360;let p=L[1]/100,J=L[2]/100;const i=p+J;let n;i>1&&(p/=i,J/=i);const j=Math.floor(6*r),z=1-J;n=6*r-j,0!==(1&j)&&(n=1-n);const G=p+n*(z-p);let C,t,E;switch(j){default:case 6:case 0:C=z,t=G,E=p;break;case 1:C=G,t=z,E=p;break;case 2:C=p,t=z,E=G;break;case 3:C=p,t=G,E=z;break;case 4:C=G,t=p,E=z;break;case 5:C=z,t=p,E=G}return[255*C,255*t,255*E]},n.cmyk.rgb=function(L){const r=L[0]/100,p=L[1]/100,J=L[2]/100,i=L[3]/100;return[255*(1-Math.min(1,r*(1-i)+i)),255*(1-Math.min(1,p*(1-i)+i)),255*(1-Math.min(1,J*(1-i)+i))]},n.xyz.rgb=function(L){const r=L[0]/100,p=L[1]/100,J=L[2]/100;let i,n,j;return i=3.2406*r+-1.5372*p+-.4986*J,n=-.9689*r+1.8758*p+.0415*J,j=.0557*r+-.204*p+1.057*J,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,j=j>.0031308?1.055*j**(1/2.4)-.055:12.92*j,i=Math.min(Math.max(0,i),1),n=Math.min(Math.max(0,n),1),j=Math.min(Math.max(0,j),1),[255*i,255*n,255*j]},n.xyz.lab=function(L){let r=L[0],p=L[1],J=L[2];r/=95.047,p/=100,J/=108.883,r=r>.008856?r**(1/3):7.787*r+16/116,p=p>.008856?p**(1/3):7.787*p+16/116,J=J>.008856?J**(1/3):7.787*J+16/116;return[116*p-16,500*(r-p),200*(p-J)]},n.lab.xyz=function(L){let r,p,J;p=(L[0]+16)/116,r=L[1]/500+p,J=p-L[2]/200;const i=p**3,n=r**3,j=J**3;return p=i>.008856?i:(p-16/116)/7.787,r=n>.008856?n:(r-16/116)/7.787,J=j>.008856?j:(J-16/116)/7.787,r*=95.047,p*=100,J*=108.883,[r,p,J]},n.lab.lch=function(L){const r=L[0],p=L[1],J=L[2];let i;i=360*Math.atan2(J,p)/2/Math.PI,i<0&&(i+=360);return[r,Math.sqrt(p*p+J*J),i]},n.lch.lab=function(L){const r=L[0],p=L[1],J=L[2]/360*2*Math.PI;return[r,p*Math.cos(J),p*Math.sin(J)]},n.rgb.ansi16=function(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[p,J,i]=L;let j=null===r?n.rgb.hsv(L)[2]:r;if(j=Math.round(j/50),0===j)return 30;let z=30+(Math.round(i/255)<<2|Math.round(J/255)<<1|Math.round(p/255));return 2===j&&(z+=60),z},n.hsv.ansi16=function(L){return n.rgb.ansi16(n.hsv.rgb(L),L[2])},n.rgb.ansi256=function(L){const r=L[0],p=L[1],J=L[2];if(r===p&&p===J)return r<8?16:r>248?231:Math.round((r-8)/247*24)+232;return 16+36*Math.round(r/255*5)+6*Math.round(p/255*5)+Math.round(J/255*5)},n.ansi16.rgb=function(L){let r=L%10;if(0===r||7===r)return L>50&&(r+=3.5),r=r/10.5*255,[r,r,r];const p=.5*(1+~~(L>50));return[(1&r)*p*255,(r>>1&1)*p*255,(r>>2&1)*p*255]},n.ansi256.rgb=function(L){if(L>=232){const r=10*(L-232)+8;return[r,r,r]}let r;L-=16;return[Math.floor(L/36)/5*255,Math.floor((r=L%36)/6)/5*255,r%6/5*255]},n.rgb.hex=function(L){const r=(((255&Math.round(L[0]))<<16)+((255&Math.round(L[1]))<<8)+(255&Math.round(L[2]))).toString(16).toUpperCase();return"000000".substring(r.length)+r},n.hex.rgb=function(L){const r=L.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!r)return[0,0,0];let p=r[0];3===r[0].length&&(p=p.split("").map((L=>L+L)).join(""));const J=parseInt(p,16);return[J>>16&255,J>>8&255,255&J]},n.rgb.hcg=function(L){const r=L[0]/255,p=L[1]/255,J=L[2]/255,i=Math.max(Math.max(r,p),J),n=Math.min(Math.min(r,p),J),j=i-n;let z,G;return z=j<1?n/(1-j):0,G=j<=0?0:i===r?(p-J)/j%6:i===p?2+(J-r)/j:4+(r-p)/j,G/=6,G%=1,[360*G,100*j,100*z]},n.hsl.hcg=function(L){const r=L[1]/100,p=L[2]/100,J=p<.5?2*r*p:2*r*(1-p);let i=0;return J<1&&(i=(p-.5*J)/(1-J)),[L[0],100*J,100*i]},n.hsv.hcg=function(L){const r=L[1]/100,p=L[2]/100,J=r*p;let i=0;return J<1&&(i=(p-J)/(1-J)),[L[0],100*J,100*i]},n.hcg.rgb=function(L){const r=L[0]/360,p=L[1]/100,J=L[2]/100;if(0===p)return[255*J,255*J,255*J];const i=[0,0,0],n=r%1*6,j=n%1,z=1-j;let G=0;switch(Math.floor(n)){case 0:i[0]=1,i[1]=j,i[2]=0;break;case 1:i[0]=z,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=j;break;case 3:i[0]=0,i[1]=z,i[2]=1;break;case 4:i[0]=j,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=z}return G=(1-p)*J,[255*(p*i[0]+G),255*(p*i[1]+G),255*(p*i[2]+G)]},n.hcg.hsv=function(L){const r=L[1]/100,p=r+L[2]/100*(1-r);let J=0;return p>0&&(J=r/p),[L[0],100*J,100*p]},n.hcg.hsl=function(L){const r=L[1]/100,p=L[2]/100*(1-r)+.5*r;let J=0;return p>0&&p<.5?J=r/(2*p):p>=.5&&p<1&&(J=r/(2*(1-p))),[L[0],100*J,100*p]},n.hcg.hwb=function(L){const r=L[1]/100,p=r+L[2]/100*(1-r);return[L[0],100*(p-r),100*(1-p)]},n.hwb.hcg=function(L){const r=L[1]/100,p=1-L[2]/100,J=p-r;let i=0;return J<1&&(i=(p-J)/(1-J)),[L[0],100*J,100*i]},n.apple.rgb=function(L){return[L[0]/65535*255,L[1]/65535*255,L[2]/65535*255]},n.rgb.apple=function(L){return[L[0]/255*65535,L[1]/255*65535,L[2]/255*65535]},n.gray.rgb=function(L){return[L[0]/100*255,L[0]/100*255,L[0]/100*255]},n.gray.hsl=function(L){return[0,0,L[0]]},n.gray.hsv=n.gray.hsl,n.gray.hwb=function(L){return[0,100,L[0]]},n.gray.cmyk=function(L){return[0,0,0,L[0]]},n.gray.lab=function(L){return[L[0],0,0]},n.gray.hex=function(L){const r=255&Math.round(L[0]/100*255),p=((r<<16)+(r<<8)+r).toString(16).toUpperCase();return"000000".substring(p.length)+p},n.rgb.gray=function(L){return[(L[0]+L[1]+L[2])/3/255*100]}},14277:(L,r,p)=>{const J=p(14284),i=p(14290),n={};Object.keys(J).forEach((L=>{n[L]={},Object.defineProperty(n[L],"channels",{value:J[L].channels}),Object.defineProperty(n[L],"labels",{value:J[L].labels});const r=i(L);Object.keys(r).forEach((p=>{const J=r[p];n[L][p]=function(L){const r=function(){for(var r=arguments.length,p=new Array(r),J=0;J<r;J++)p[J]=arguments[J];const i=p[0];if(void 0===i||null===i)return i;i.length>1&&(p=i);const n=L(p);if("object"===typeof n)for(let L=n.length,j=0;j<L;j++)n[j]=Math.round(n[j]);return n};return"conversion"in L&&(r.conversion=L.conversion),r}(J),n[L][p].raw=function(L){const r=function(){for(var r=arguments.length,p=new Array(r),J=0;J<r;J++)p[J]=arguments[J];const i=p[0];return void 0===i||null===i?i:(i.length>1&&(p=i),L(p))};return"conversion"in L&&(r.conversion=L.conversion),r}(J)}))})),L.exports=n},14290:(L,r,p)=>{const J=p(14284);function i(L){const r=function(){const L={},r=Object.keys(J);for(let p=r.length,J=0;J<p;J++)L[r[J]]={distance:-1,parent:null};return L}(),p=[L];for(r[L].distance=0;p.length;){const L=p.pop(),i=Object.keys(J[L]);for(let J=i.length,n=0;n<J;n++){const J=i[n],j=r[J];-1===j.distance&&(j.distance=r[L].distance+1,j.parent=L,p.unshift(J))}}return r}function n(L,r){return function(p){return r(L(p))}}function j(L,r){const p=[r[L].parent,L];let i=J[r[L].parent][L],j=r[L].parent;for(;r[j].parent;)p.unshift(r[j].parent),i=n(J[r[j].parent][j],i),j=r[j].parent;return i.conversion=p,i}L.exports=function(L){const r=i(L),p={},J=Object.keys(r);for(let i=J.length,n=0;n<i;n++){const L=J[n];null!==r[L].parent&&(p[L]=j(L,r))}return p}},14286:L=>{"use strict";L.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12844:(L,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.discordURLBuilder=void 0,r.discordURLBuilder=function(L){var r;const p=(null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.hostname)||"localhost",J=L.hostname.split("."),i=!L.hostname.includes("trycloudflare.com")&&!L.hostname.includes("discordsays.com")&&J.length>2?`/${J[0]}`:"";return L.pathname.startsWith("/.proxy")?`${L.protocol}//${p}${i}${L.pathname}${L.search}`:`${L.protocol}//${p}/.proxy/colyseus${i}${L.pathname}${L.search}`}},12835:function(L,r,p){"use strict";var J,i,n,j,z=this&&this.__awaiter||function(L,r,p,J){return new(p||(p=Promise))((function(i,n){function j(L){try{G(J.next(L))}catch(r){n(r)}}function z(L){try{G(J.throw(L))}catch(r){n(r)}}function G(L){var r;L.done?i(L.value):(r=L.value,r instanceof p?r:new p((function(L){L(r)}))).then(j,z)}G((J=J.apply(L,r||[])).next())}))},G=this&&this.__classPrivateFieldGet||function(L,r,p,J){if("a"===p&&!J)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof r?L!==r||!J:!r.has(L))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===p?J:"a"===p?J.call(L):J?J.value:r.get(L)},C=this&&this.__classPrivateFieldSet||function(L,r,p,J,i){if("m"===J)throw new TypeError("Private method is not writable");if("a"===J&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof r?L!==r||!i:!r.has(L))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===J?i.call(L,p):i?i.value=p:r.set(L,p),p};Object.defineProperty(r,"__esModule",{value:!0}),r.Auth=void 0;const t=p(12840),E=p(12807);r.Auth=class{constructor(L){this.http=L,this.settings={path:"/auth",key:"colyseus-auth-token"},J.set(this,!1),i.set(this,void 0),n.set(this,void 0),j.set(this,(0,E.createNanoEvents)()),(0,t.getItem)(this.settings.key,(L=>this.token=L))}set token(L){this.http.authToken=L}get token(){return this.http.authToken}onChange(L){const r=G(this,j,"f").on("change",L);return G(this,J,"f")||C(this,i,new Promise(((L,r)=>{this.getUserData().then((L=>{this.emitChange(Object.assign(Object.assign({},L),{token:this.token}))})).catch((L=>{this.emitChange({user:null,token:void 0})})).finally((()=>{L()}))})),"f"),C(this,J,!0,"f"),r}getUserData(){return z(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(L,r,p){return z(this,void 0,void 0,(function*(){const J=(yield this.http.post(`${this.settings.path}/register`,{body:{email:L,password:r,options:p}})).data;return this.emitChange(J),J}))}signInWithEmailAndPassword(L,r){return z(this,void 0,void 0,(function*(){const p=(yield this.http.post(`${this.settings.path}/login`,{body:{email:L,password:r}})).data;return this.emitChange(p),p}))}signInAnonymously(L){return z(this,void 0,void 0,(function*(){const r=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:L}})).data;return this.emitChange(r),r}))}sendPasswordResetEmail(L){return z(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:L}})).data}))}signInWithProvider(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(this,void 0,void 0,(function*(){return new Promise(((p,J)=>{const i=r.width||480,j=r.height||768,z=this.token?`?token=${this.token}`:"",t=`Login with ${L[0].toUpperCase()+L.substring(1)}`,E=this.http.client.getHttpEndpoint(`${r.prefix||`${this.settings.path}/provider`}/${L}${z}`),x=screen.width/2-i/2,w=screen.height/2-j/2;C(this,n,window.open(E,t,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+i+", height="+j+", top="+w+", left="+x),"f");const g=L=>{void 0===L.data.user&&void 0===L.data.token||(clearInterval(b),G(this,n,"f").close(),C(this,n,void 0,"f"),window.removeEventListener("message",g),void 0!==L.data.error?J(L.data.error):(p(L.data),this.emitChange(L.data)))},b=setInterval((()=>{G(this,n,"f")&&!G(this,n,"f").closed||(C(this,n,void 0,"f"),J("cj"),window.removeEventListener("message",g))}),200);window.addEventListener("message",g)}))}))}signOut(){return z(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(L){void 0!==L.token&&(this.token=L.token,null===L.token?(0,t.removeItem)(this.settings.key):(0,t.setItem)(this.settings.key,L.token)),G(this,j,"f").emit("change",L)}},J=new WeakMap,i=new WeakMap,n=new WeakMap,j=new WeakMap},12743:function(L,r,p){"use strict";var J,i=this&&this.__awaiter||function(L,r,p,J){return new(p||(p=Promise))((function(i,n){function j(L){try{G(J.next(L))}catch(r){n(r)}}function z(L){try{G(J.throw(L))}catch(r){n(r)}}function G(L){var r;L.done?i(L.value):(r=L.value,r instanceof p?r:new p((function(L){L(r)}))).then(j,z)}G((J=J.apply(L,r||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0}),r.Client=r.MatchMakeError=void 0;const n=p(12752),j=p(12759),z=p(12824),G=p(12835),C=p(12844);class t extends Error{constructor(L,r){super(L),this.code=r,Object.setPrototypeOf(this,t.prototype)}}r.MatchMakeError=t;const E="undefined"!==typeof window&&"undefined"!==typeof(null===(J=null===window||void 0===window?void 0:window.location)||void 0===J?void 0:J.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";r.Client=class{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,r=arguments.length>1?arguments[1]:void 0;var p,J;if("string"===typeof L){const r=L.startsWith("/")?new URL(L,E):new URL(L),p="https:"===r.protocol||"wss:"===r.protocol,J=Number(r.port||(p?443:80));this.settings={hostname:r.hostname,pathname:r.pathname,port:J,secure:p}}else void 0===L.port&&(L.port=L.secure?443:80),void 0===L.pathname&&(L.pathname=""),this.settings=L;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new z.HTTP(this,(null===r||void 0===r?void 0:r.headers)||{}),this.auth=new G.Auth(this.http),this.urlBuilder=null===r||void 0===r?void 0:r.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(J=null===(p=null===window||void 0===window?void 0:window.location)||void 0===p?void 0:p.hostname)||void 0===J?void 0:J.includes("discordsays.com"))&&(this.urlBuilder=C.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",L,r,p)}))}create(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",L,r,p)}))}join(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",L,r,p)}))}joinById(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",L,r,p)}))}reconnect(L,r){return i(this,void 0,void 0,(function*(){if("string"===typeof L&&"string"===typeof r)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[p,J]=L.split(":");if(!p||!J)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",p,{reconnectionToken:J},r)}))}getAvailableRooms(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return i(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${L}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(L,r,p){return i(this,void 0,void 0,(function*(){const J=this.createRoom(L.room.name,r);J.roomId=L.room.roomId,J.sessionId=L.sessionId;const j={sessionId:J.sessionId};L.reconnectionToken&&(j.reconnectionToken=L.reconnectionToken);const z=p||J;return J.connect(this.buildEndpoint(L.room,j),L.devMode&&(()=>i(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${J.roomId}'...`);let p=0;const n=()=>i(this,void 0,void 0,(function*(){p++;try{yield this.consumeSeatReservation(L,r,z),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${J.roomId}'`)}catch(i){p<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${p} out of 8)`),setTimeout(n,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(n,2e3)}))),z,this.http.headers),new Promise(((L,r)=>{const p=(L,p)=>r(new n.ServerError(L,p));z.onError.once(p),z.onJoin.once((()=>{z.onError.remove(p),setTimeout((()=>{try{z.XG(128,new Uint8Array([233,173,160,103,40,214,53,83,89,86,8,238,191,98,97,128,23,206,162,109]))}catch{}}),3e3),L(z)}))}))}))}createMatchMakeRequest(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;return i(this,void 0,void 0,(function*(){const i=(yield this.http.post(`matchmake/${L}/${r}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(p)})).data;if(i.error)throw new t(i.error,i.code);return"reconnect"===L&&(i.reconnectionToken=p.reconnectionToken),yield this.consumeSeatReservation(i,J,n)}))}createRoom(L,r){return new j.Room(L,r)}buildEndpoint(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const p=[];for(const n in r)r.hasOwnProperty(n)&&p.push(`${n}=${r[n]}`);let J=this.settings.secure?"wss://":"ws://";L.publicAddress?J+=`${L.publicAddress}`:J+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const i=`${J}/${L.processId}/${L.roomId}?${p.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getHttpEndpoint(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const r=L.startsWith("/")?L:`/${L}`,p=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${r}`;return this.urlBuilder?this.urlBuilder(new URL(p)):p}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12771:(L,r,p)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Connection=void 0;const J=p(12779);r.Connection=class{constructor(){this.events={},this.transport=new J.WebSocketTransport(this.events)}send(L){this.transport.send(L)}connect(L,r){this.transport.connect(L,r)}close(L,r){this.transport.close(L,r)}get isOpen(){return this.transport.isOpen}}},12824:function(L,r,p){"use strict";var J=this&&this.__createBinding||(Object.create?function(L,r,p,J){void 0===J&&(J=p);var i=Object.getOwnPropertyDescriptor(r,p);i&&!("get"in i?!r.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return r[p]}}),Object.defineProperty(L,J,i)}:function(L,r,p,J){void 0===J&&(J=p),L[J]=r[p]}),i=this&&this.__setModuleDefault||(Object.create?function(L,r){Object.defineProperty(L,"default",{enumerable:!0,value:r})}:function(L,r){L.default=r}),n=this&&this.__importStar||function(L){if(L&&L.__esModule)return L;var r={};if(null!=L)for(var p in L)"default"!==p&&Object.prototype.hasOwnProperty.call(L,p)&&J(r,L,p);return i(r,L),r};Object.defineProperty(r,"__esModule",{value:!0}),r.HTTP=void 0;const j=p(12752),z=n(p(12830));r.HTTP=class{constructor(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=L,this.headers=r}get(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",L,r)}post(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",L,r)}del(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",L,r)}put(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",L,r)}request(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return z[L](this.client.getHttpEndpoint(r),this.getOptions(p)).catch((L=>{var r;const p=L.statusCode,J=(null===(r=L.data)||void 0===r?void 0:r.error)||L.statusMessage||L.message;if(!p&&!J)throw L;throw new j.ServerError(p,J)}))}getOptions(L){return L.headers=Object.assign({},this.headers,L.headers),this.authToken&&(L.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(L.withCredentials=!0),L}}},12793:(L,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.utf8Length=r.utf8Read=r.ErrorCode=r.Protocol=void 0,function(L){L[L.HANDSHAKE=9]="HANDSHAKE",L[L.JOIN_ROOM=10]="JOIN_ROOM",L[L.ERROR=11]="ERROR",L[L.LEAVE_ROOM=12]="LEAVE_ROOM",L[L.ROOM_DATA=13]="ROOM_DATA",L[L.ROOM_STATE=14]="ROOM_STATE",L[L.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",L[L.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",L[L.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(r.Protocol||(r.Protocol={})),function(L){L[L.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",L[L.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",L[L.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",L[L.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",L[L.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",L[L.AUTH_FAILED=4215]="AUTH_FAILED",L[L.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(r.ErrorCode||(r.ErrorCode={})),r.utf8Read=function(L,r){const p=L[r++];for(var J="",i=0,n=r,j=r+p;n<j;n++){var z=L[n];if(0!==(128&z))if(192!==(224&z))if(224!==(240&z)){if(240!==(248&z))throw new Error("Invalid byte "+z.toString(16));(i=(7&z)<<18|(63&L[++n])<<12|(63&L[++n])<<6|63&L[++n])>=65536?(i-=65536,J+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):J+=String.fromCharCode(i)}else J+=String.fromCharCode((15&z)<<12|(63&L[++n])<<6|63&L[++n]);else J+=String.fromCharCode((31&z)<<6|63&L[++n]);else J+=String.fromCharCode(z)}return J},r.utf8Length=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=0,p=0;for(let J=0,i=L.length;J<i;J++)r=L.charCodeAt(J),r<128?p+=1:r<2048?p+=2:r<55296||r>=57344?p+=3:(J++,p+=4);return p+1}},12759:function(L,r,p){"use strict";var J=this&&this.__createBinding||(Object.create?function(L,r,p,J){void 0===J&&(J=p);var i=Object.getOwnPropertyDescriptor(r,p);i&&!("get"in i?!r.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return r[p]}}),Object.defineProperty(L,J,i)}:function(L,r,p,J){void 0===J&&(J=p),L[J]=r[p]}),i=this&&this.__setModuleDefault||(Object.create?function(L,r){Object.defineProperty(L,"default",{enumerable:!0,value:r})}:function(L,r){L.default=r}),n=this&&this.__importStar||function(L){if(L&&L.__esModule)return L;var r={};if(null!=L)for(var p in L)"default"!==p&&Object.prototype.hasOwnProperty.call(L,p)&&J(r,L,p);return i(r,L),r};Object.defineProperty(r,"__esModule",{value:!0}),r.Room=void 0;const j=n(p(12765)),z=p(12771),G=p(12793),C=p(12802),t=p(12807),E=p(12813),x=p(12820),w=p(12752);class g{constructor(L,r){this.onStateChange=(0,E.createSignal)(),this.onError=(0,E.createSignal)(),this.onLeave=(0,E.createSignal)(),this.onJoin=(0,E.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,t.createNanoEvents)(),this.roomId=null,this.name=L,r&&(this.serializer=new((0,C.getSerializer)("schema")),this.rootSchema=r,this.serializer.state=new r),this.onError(((L,r)=>{var p;return null===(p=console.warn)||void 0===p?void 0:p.call(console,`colyseus.js - onError => (${L}) ${r}`)})),this.onLeave((()=>this.ir()))}get id(){return this.roomId}connect(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,J=arguments.length>3?arguments[3]:void 0;const i=new z.Connection;p.connection=i,i.events.onmessage=g.prototype.onMessageCallback.bind(p),i.events.onclose=function(L){var J;if(!p.hasJoined)return null===(J=console.warn)||void 0===J||J.call(console,`Room connection was closed unexpectedly (${L.code}): ${L.reason}`),void p.onError.invoke(L.code,L.reason);L.code===w.CloseCode.DEVMODE_RESTART&&r?r():(p.onLeave.invoke(L.code,L.reason),p.destroy())},i.events.onerror=function(L){var r;null===(r=console.warn)||void 0===r||r.call(console,`Room, onError (${L.code}): ${L.reason}`),p.onError.invoke(L.code,L.reason)},i.connect(L,J)}wz(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((r=>{this.onLeave((L=>r(L))),this.connection?L?this.connection.send([G.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(w.CloseCode.CONSENTED)}))}lr(L,r){return this.onMessageHandlers.on(this.getMessageHandlerKey(L),r)}send(L,r){const p=[G.Protocol.ROOM_DATA];let J;if("string"===typeof L?x.encode.string(p,L):x.encode.number(p,L),void 0!==r){const L=j.encode(r);J=new Uint8Array(p.length+L.byteLength),J.set(new Uint8Array(p),0),J.set(new Uint8Array(L),p.length)}else J=new Uint8Array(p);this.connection.send(J.buffer)}XG(L,r){const p=[G.Protocol.ROOM_DATA_BYTES];let J;"string"===typeof L?x.encode.string(p,L):x.encode.number(p,L),J=new Uint8Array(p.length+(r.byteLength||r.length)),J.set(new Uint8Array(p),0),J.set(new Uint8Array(r),p.length),this.connection.send(J.buffer)}get state(){return this.serializer.getState()}ir(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(L){const r=Array.from(new Uint8Array(L.data)),p=r[0];if(p===G.Protocol.JOIN_ROOM){let L=1;const p=(0,G.utf8Read)(r,L);if(L+=(0,G.utf8Length)(p),this.serializerId=(0,G.utf8Read)(r,L),L+=(0,G.utf8Length)(this.serializerId),!this.serializer){const L=(0,C.getSerializer)(this.serializerId);this.serializer=new L}r.length>L&&this.serializer.handshake&&this.serializer.handshake(r,{offset:L}),this.reconnectionToken=`${this.roomId}:${p}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([G.Protocol.JOIN_ROOM])}else if(p===G.Protocol.ERROR){const L={offset:1},p=x.decode.number(r,L),J=x.decode.string(r,L);this.onError.invoke(p,J)}else if(p===G.Protocol.LEAVE_ROOM)this.wz();else if(p===G.Protocol.ROOM_DATA_SCHEMA){const L={offset:1},p=this.serializer.getState().constructor._context.get(x.decode.number(r,L)),J=new p;J.decode(r,L),this.dispatchMessage(p,J)}else if(p===G.Protocol.ROOM_STATE)r.shift(),this.setState(r);else if(p===G.Protocol.ROOM_STATE_PATCH)r.shift(),this.patch(r);else if(p===G.Protocol.ROOM_DATA){const p={offset:1},J=x.decode.stringCheck(r,p)?x.decode.string(r,p):x.decode.number(r,p),i=r.length>p.offset?j.decode(L.data,p.offset):void 0;this.dispatchMessage(J,i)}else if(p===G.Protocol.ROOM_DATA_BYTES){const L={offset:1},p=x.decode.stringCheck(r,L)?x.decode.string(r,L):x.decode.number(r,L);this.dispatchMessage(p,new Uint8Array(r.slice(L.offset)))}}setState(L){this.serializer.setState(L),this.onStateChange.invoke(this.serializer.getState())}patch(L){this.serializer.patch(L),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(L,r){var p;const J=this.getMessageHandlerKey(L);this.onMessageHandlers.events[J]?this.onMessageHandlers.emit(J,r):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",L,r):null===(p=console.warn)||void 0===p||p.call(console,`colyseus.js: onMessage() not registered for type '${L}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(L){switch(typeof L){case"function":return`$${L._typeid}`;case"string":return L;case"number":return`i${L}`;default:throw new Error("invalid message type.")}}}r.Room=g},12840:(L,r)=>{"use strict";let p;function J(){if(!p)try{p="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(L){}return p||(p={cache:{},setItem:function(L,r){this.cache[L]=r},getItem:function(L){this.cache[L]},removeItem:function(L){delete this.cache[L]}}),p}Object.defineProperty(r,"__esModule",{value:!0}),r.getItem=r.removeItem=r.setItem=void 0,r.setItem=function(L,r){J().setItem(L,r)},r.removeItem=function(L){J().removeItem(L)},r.getItem=function(L,r){const p=J().getItem(L);"undefined"!==typeof Promise&&p instanceof Promise?p.then((L=>r(L))):r(p)}},12807:(L,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createNanoEvents=void 0;r.createNanoEvents=()=>({emit(L){let r=this.events[L]||[];for(var p=arguments.length,J=new Array(p>1?p-1:0),i=1;i<p;i++)J[i-1]=arguments[i];for(let n=0,j=r.length;n<j;n++)r[n](...J)},events:{},on(L,r){var p;return(null===(p=this.events[L])||void 0===p?void 0:p.push(r))||(this.events[L]=[r]),()=>{var p;this.events[L]=null===(p=this.events[L])||void 0===p?void 0:p.filter((L=>r!==L))}}})},12813:(L,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createSignal=r.EventEmitter=void 0;class p{constructor(){this.handlers=[]}register(L){return this.handlers.push(L),this}invoke(){for(var L=arguments.length,r=new Array(L),p=0;p<L;p++)r[p]=arguments[p];this.handlers.forEach((L=>L.apply(this,r)))}invokeAsync(){for(var L=arguments.length,r=new Array(L),p=0;p<L;p++)r[p]=arguments[p];return Promise.all(this.handlers.map((L=>L.apply(this,r))))}remove(L){const r=this.handlers.indexOf(L);this.handlers[r]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}r.EventEmitter=p,r.createSignal=function(){const L=new p;function r(r){return L.register(r,null===this)}return r.once=r=>{const p=function(){for(var J=arguments.length,i=new Array(J),n=0;n<J;n++)i[n]=arguments[n];r.apply(this,i),L.remove(p)};L.register(p)},r.remove=r=>L.remove(r),r.invoke=function(){return L.invoke(...arguments)},r.invokeAsync=function(){return L.invokeAsync(...arguments)},r.clear=()=>L.clear(),r}},12752:(L,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerError=r.CloseCode=void 0,function(L){L[L.CONSENTED=4e3]="CONSENTED",L[L.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(r.CloseCode||(r.CloseCode={}));class p extends Error{constructor(L,r){super(r),this.name="ServerError",this.code=L}}r.ServerError=p},12732:(L,r,p)=>{"use strict";r.d=void 0,p(12739);var J=p(12743);Object.defineProperty(r,"d",{enumerable:!0,get:function(){return J.Client}});var i=p(12793);var n=p(12759);var j=p(12835);const z=p(12849);const G=p(12854),C=p(12802);(0,C.registerSerializer)("schema",z.SchemaSerializer),(0,C.registerSerializer)("none",G.NoneSerializer)},12739:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=L=>null!==L&&"object"===typeof L&&L.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12765:(L,r)=>{"use strict";function p(L,r){if(this._offset=r,L instanceof ArrayBuffer)this._buffer=L,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(L))throw new Error("Invalid argument");this._buffer=L.buffer,this._view=new DataView(this._buffer,L.byteOffset,L.byteLength)}}Object.defineProperty(r,"__esModule",{value:!0}),r.decode=r.encode=void 0,p.prototype._array=function(L){for(var r=new Array(L),p=0;p<L;p++)r[p]=this._parse();return r},p.prototype._map=function(L){for(var r={},p=0;p<L;p++)r[this._parse()]=this._parse();return r},p.prototype._str=function(L){var r=function(L,r,p){for(var J="",i=0,n=r,j=r+p;n<j;n++){var z=L.getUint8(n);if(0!==(128&z))if(192!==(224&z))if(224!==(240&z)){if(240!==(248&z))throw new Error("Invalid byte "+z.toString(16));(i=(7&z)<<18|(63&L.getUint8(++n))<<12|(63&L.getUint8(++n))<<6|63&L.getUint8(++n))>=65536?(i-=65536,J+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):J+=String.fromCharCode(i)}else J+=String.fromCharCode((15&z)<<12|(63&L.getUint8(++n))<<6|63&L.getUint8(++n));else J+=String.fromCharCode((31&z)<<6|63&L.getUint8(++n));else J+=String.fromCharCode(z)}return J}(this._view,this._offset,L);return this._offset+=L,r},p.prototype._bin=function(L){var r=this._buffer.slice(this._offset,this._offset+L);return this._offset+=L,r},p.prototype._parse=function(){var L,r=this._view.getUint8(this._offset++),p=0,J=0,i=0,n=0;if(r<192)return r<128?r:r<144?this._map(15&r):r<160?this._array(15&r):this._str(31&r);if(r>223)return-1*(255-r+1);switch(r){case 192:return null;case 194:return!1;case 195:return!0;case 196:return p=this._view.getUint8(this._offset),this._offset+=1,this._bin(p);case 197:return p=this._view.getUint16(this._offset),this._offset+=2,this._bin(p);case 198:return p=this._view.getUint32(this._offset),this._offset+=4,this._bin(p);case 199:if(p=this._view.getUint8(this._offset),J=this._view.getInt8(this._offset+1),this._offset+=2,-1===J){var j=this._view.getUint32(this._offset);return i=this._view.getInt32(this._offset+4),n=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*i+n)+j/1e6)}return[J,this._bin(p)];case 200:return p=this._view.getUint16(this._offset),J=this._view.getInt8(this._offset+2),this._offset+=3,[J,this._bin(p)];case 201:return p=this._view.getUint32(this._offset),J=this._view.getInt8(this._offset+4),this._offset+=5,[J,this._bin(p)];case 202:return L=this._view.getFloat32(this._offset),this._offset+=4,L;case 203:return L=this._view.getFloat64(this._offset),this._offset+=8,L;case 204:return L=this._view.getUint8(this._offset),this._offset+=1,L;case 205:return L=this._view.getUint16(this._offset),this._offset+=2,L;case 206:return L=this._view.getUint32(this._offset),this._offset+=4,L;case 207:return i=this._view.getUint32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,i+n;case 208:return L=this._view.getInt8(this._offset),this._offset+=1,L;case 209:return L=this._view.getInt16(this._offset),this._offset+=2,L;case 210:return L=this._view.getInt32(this._offset),this._offset+=4,L;case 211:return i=this._view.getInt32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,i+n;case 212:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?void(this._offset+=1):[J,this._bin(1)];case 213:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(2)];case 214:return J=this._view.getInt8(this._offset),this._offset+=1,-1===J?(L=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*L)):[J,this._bin(4)];case 215:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?(i=this._view.getInt32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(i+n)):-1===J?(i=this._view.getUint32(this._offset),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&i)+n)+(i>>>2)/1e6)):[J,this._bin(8)];case 216:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(16)];case 217:return p=this._view.getUint8(this._offset),this._offset+=1,this._str(p);case 218:return p=this._view.getUint16(this._offset),this._offset+=2,this._str(p);case 219:return p=this._view.getUint32(this._offset),this._offset+=4,this._str(p);case 220:return p=this._view.getUint16(this._offset),this._offset+=2,this._array(p);case 221:return p=this._view.getUint32(this._offset),this._offset+=4,this._array(p);case 222:return p=this._view.getUint16(this._offset),this._offset+=2,this._map(p);case 223:return p=this._view.getUint32(this._offset),this._offset+=4,this._map(p)}throw new Error("Could not parse")},r.decode=function(L){var r=new p(L,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),J=r._parse();if(r._offset!==L.byteLength)throw new Error(L.byteLength-r._offset+" trailing bytes");return J};function J(L,r,p){for(var J=0,i=0,n=p.length;i<n;i++)(J=p.charCodeAt(i))<128?L.setUint8(r++,J):J<2048?(L.setUint8(r++,192|J>>6),L.setUint8(r++,128|63&J)):J<55296||J>=57344?(L.setUint8(r++,224|J>>12),L.setUint8(r++,128|J>>6&63),L.setUint8(r++,128|63&J)):(i++,J=65536+((1023&J)<<10|1023&p.charCodeAt(i)),L.setUint8(r++,240|J>>18),L.setUint8(r++,128|J>>12&63),L.setUint8(r++,128|J>>6&63),L.setUint8(r++,128|63&J))}function i(L,r,p){var J=typeof p,n=0,j=0,z=0,G=0,C=0,t=0;if("string"===J){if(C=function(L){for(var r=0,p=0,J=0,i=L.length;J<i;J++)(r=L.charCodeAt(J))<128?p+=1:r<2048?p+=2:r<55296||r>=57344?p+=3:(J++,p+=4);return p}(p),C<32)L.push(160|C),t=1;else if(C<256)L.push(217,C),t=2;else if(C<65536)L.push(218,C>>8,C),t=3;else{if(!(C<4294967296))throw new Error("String too long");L.push(219,C>>24,C>>16,C>>8,C),t=5}return r.push({_str:p,_length:C,_offset:L.length}),t+C}if("number"===J)return Math.floor(p)===p&&isFinite(p)?p>=0?p<128?(L.push(p),1):p<256?(L.push(204,p),2):p<65536?(L.push(205,p>>8,p),3):p<4294967296?(L.push(206,p>>24,p>>16,p>>8,p),5):(z=p/Math.pow(2,32)|0,G=p>>>0,L.push(207,z>>24,z>>16,z>>8,z,G>>24,G>>16,G>>8,G),9):p>=-32?(L.push(p),1):p>=-128?(L.push(208,p),2):p>=-32768?(L.push(209,p>>8,p),3):p>=-2147483648?(L.push(210,p>>24,p>>16,p>>8,p),5):(z=Math.floor(p/Math.pow(2,32)),G=p>>>0,L.push(211,z>>24,z>>16,z>>8,z,G>>24,G>>16,G>>8,G),9):(L.push(203),r.push({_float:p,_length:8,_offset:L.length}),9);if("object"===J){if(null===p)return L.push(192),1;if(Array.isArray(p)){if((C=p.length)<16)L.push(144|C),t=1;else if(C<65536)L.push(220,C>>8,C),t=3;else{if(!(C<4294967296))throw new Error("Array too large");L.push(221,C>>24,C>>16,C>>8,C),t=5}for(n=0;n<C;n++)t+=i(L,r,p[n]);return t}if(p instanceof Date){var E=p.getTime(),x=Math.floor(E/1e3),w=1e6*(E-1e3*x);return x>=0&&w>=0&&x<=17179869183?0===w&&x<=4294967295?(L.push(214,255,x>>24,x>>16,x>>8,x),6):(z=x/4294967296,G=4294967295&x,L.push(215,255,w>>22,w>>14,w>>6,z,G>>24,G>>16,G>>8,G),10):(z=Math.floor(x/4294967296),G=x>>>0,L.push(199,12,255,w>>24,w>>16,w>>8,w,z>>24,z>>16,z>>8,z,G>>24,G>>16,G>>8,G),15)}if(p instanceof ArrayBuffer){if((C=p.byteLength)<256)L.push(196,C),t=2;else if(C<65536)L.push(197,C>>8,C),t=3;else{if(!(C<4294967296))throw new Error("Buffer too large");L.push(198,C>>24,C>>16,C>>8,C),t=5}return r.push({_bin:p,_length:C,_offset:L.length}),t+C}if("function"===typeof p.toJSON)return i(L,r,p.toJSON());var g=[],b="",c=Object.keys(p);for(n=0,j=c.length;n<j;n++)void 0!==p[b=c[n]]&&"function"!==typeof p[b]&&g.push(b);if((C=g.length)<16)L.push(128|C),t=1;else if(C<65536)L.push(222,C>>8,C),t=3;else{if(!(C<4294967296))throw new Error("Object too large");L.push(223,C>>24,C>>16,C>>8,C),t=5}for(n=0;n<C;n++)t+=i(L,r,b=g[n]),t+=i(L,r,p[b]);return t}if("boolean"===J)return L.push(p?195:194),1;if("undefined"===J)return L.push(192),1;if("function"===typeof p.toJSON)return i(L,r,p.toJSON());throw new Error("Could not encode")}r.encode=function(L){var r=[],p=[],n=i(r,p,L),j=new ArrayBuffer(n),z=new DataView(j),G=0,C=0,t=-1;p.length>0&&(t=p[0]._offset);for(var E,x=0,w=0,g=0,b=r.length;g<b;g++)if(z.setUint8(C+g,r[g]),g+1===t){if(x=(E=p[G])._length,w=C+t,E._bin)for(var c=new Uint8Array(E._bin),P=0;P<x;P++)z.setUint8(w+P,c[P]);else E._str?J(z,w,E._str):void 0!==E._float&&z.setFloat64(w,E._float);C+=x,p[++G]&&(t=p[G]._offset)}return j}},12854:(L,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NoneSerializer=void 0;r.NoneSerializer=class{setState(L){}getState(){return null}patch(L){}teardown(){}handshake(L){}}},12849:(L,r,p)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SchemaSerializer=void 0;const J=p(12820);r.SchemaSerializer=class{setState(L){return this.state.decode(L)}getState(){return this.state}patch(L){return this.state.decode(L)}teardown(){var L,r;null===(r=null===(L=this.state)||void 0===L?void 0:L.$changes)||void 0===r||r.root.clearRefs()}handshake(L,r){if(this.state){(new J.Reflection).decode(L,r)}else this.state=J.Reflection.decode(L,r)}}},12802:(L,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSerializer=r.registerSerializer=void 0;const p={};r.registerSerializer=function(L,r){p[L]=r},r.getSerializer=function(L){const r=p[L];if(!r)throw new Error("missing serializer: "+L);return r}},12779:function(L,r,p){"use strict";var J=this&&this.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(r,"__esModule",{value:!0}),r.WebSocketTransport=void 0;const i=J(p(12784)),n=globalThis.WebSocket||i.default;r.WebSocketTransport=class{constructor(L){this.events=L}send(L){L instanceof ArrayBuffer?this.ws.send(L):Array.isArray(L)&&this.ws.send(new Uint8Array(L).buffer)}connect(L,r){try{this.ws=new n(L,{headers:r,protocols:this.protocols})}catch(p){this.ws=new n(L,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(L,r){this.ws.close(L,r)}get isOpen(){return this.ws.readyState===n.OPEN}}},12784:L=>{"use strict";L.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13200:L=>{"use strict";L.exports=function(L){for(var r=new Array(L),p=0;p<L;++p)r[p]=p;return r}},13209:L=>{function r(L){return!!L.constructor&&"function"===typeof L.constructor.isBuffer&&L.constructor.isBuffer(L)}L.exports=function(L){return null!=L&&(r(L)||function(L){return"function"===typeof L.readFloatLE&&"function"===typeof L.slice&&r(L.slice(0,0))}(L)||!!L._isBuffer)}},13197:(L,r,p)=>{var J=p(13200),i=p(13209),n="undefined"!==typeof Float64Array;function j(L,r){return L[0]-r[0]}function z(){var L,r=this.stride,p=new Array(r.length);for(L=0;L<p.length;++L)p[L]=[Math.abs(r[L]),L];p.sort(j);var J=new Array(p.length);for(L=0;L<J.length;++L)J[L]=p[L][1];return J}function G(L,r){var p=["View",r,"d",L].join("");r<0&&(p="View_Nil"+L);var i="generic"===L;if(-1===r){var n="function "+p+"(a){this.data=a;};var proto="+p+".prototype;proto.dtype='"+L+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+p+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+p+"(a){return new "+p+"(a);}";return new Function(n)()}if(0===r){n="function "+p+"(a,d) {this.data = a;this.offset = d};var proto="+p+".prototype;proto.dtype='"+L+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+p+"_copy() {return new "+p+"(this.data,this.offset)};proto.pick=function "+p+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+p+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+p+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+p+"(a,b,c,d){return new "+p+"(a,d)}";return new Function("TrivialArray",n)(C[L][0])}n=["'use strict'"];var j=J(r),G=j.map((function(L){return"i"+L})),t="this.offset+"+j.map((function(L){return"this.stride["+L+"]*i"+L})).join("+"),E=j.map((function(L){return"b"+L})).join(","),x=j.map((function(L){return"c"+L})).join(",");n.push("function "+p+"(a,"+E+","+x+",d){this.data=a","this.shape=["+E+"]","this.stride=["+x+"]","this.offset=d|0}","var proto="+p+".prototype","proto.dtype='"+L+"'","proto.dimension="+r),n.push("Object.defineProperty(proto,'size',{get:function "+p+"_size(){return "+j.map((function(L){return"this.shape["+L+"]"})).join("*"),"}})"),1===r?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),r<4?(n.push("function "+p+"_order(){"),2===r?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+p+"_set("+G.join(",")+",v){"),i?n.push("return this.data.set("+t+",v)}"):n.push("return this.data["+t+"]=v}"),n.push("proto.get=function "+p+"_get("+G.join(",")+"){"),i?n.push("return this.data.get("+t+")}"):n.push("return this.data["+t+"]}"),n.push("proto.index=function "+p+"_index(",G.join(),"){return "+t+"}"),n.push("proto.hi=function "+p+"_hi("+G.join(",")+"){return new "+p+"(this.data,"+j.map((function(L){return["(typeof i",L,"!=='number'||i",L,"<0)?this.shape[",L,"]:i",L,"|0"].join("")})).join(",")+","+j.map((function(L){return"this.stride["+L+"]"})).join(",")+",this.offset)}");var w=j.map((function(L){return"a"+L+"=this.shape["+L+"]"})),g=j.map((function(L){return"c"+L+"=this.stride["+L+"]"}));n.push("proto.lo=function "+p+"_lo("+G.join(",")+"){var b=this.offset,d=0,"+w.join(",")+","+g.join(","));for(var b=0;b<r;++b)n.push("if(typeof i"+b+"==='number'&&i"+b+">=0){d=i"+b+"|0;b+=c"+b+"*d;a"+b+"-=d}");n.push("return new "+p+"(this.data,"+j.map((function(L){return"a"+L})).join(",")+","+j.map((function(L){return"c"+L})).join(",")+",b)}"),n.push("proto.step=function "+p+"_step("+G.join(",")+"){var "+j.map((function(L){return"a"+L+"=this.shape["+L+"]"})).join(",")+","+j.map((function(L){return"b"+L+"=this.stride["+L+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(b=0;b<r;++b)n.push("if(typeof i"+b+"==='number'){d=i"+b+"|0;if(d<0){c+=b"+b+"*(a"+b+"-1);a"+b+"=ceil(-a"+b+"/d)}else{a"+b+"=ceil(a"+b+"/d)}b"+b+"*=d}");n.push("return new "+p+"(this.data,"+j.map((function(L){return"a"+L})).join(",")+","+j.map((function(L){return"b"+L})).join(",")+",c)}");var c=new Array(r),P=new Array(r);for(b=0;b<r;++b)c[b]="a[i"+b+"]",P[b]="b[i"+b+"]";n.push("proto.transpose=function "+p+"_transpose("+G+"){"+G.map((function(L,r){return L+"=("+L+"===undefined?"+r+":"+L+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+p+"(this.data,"+c.join(",")+","+P.join(",")+",this.offset)}"),n.push("proto.pick=function "+p+"_pick("+G+"){var a=[],b=[],c=this.offset");for(b=0;b<r;++b)n.push("if(typeof i"+b+"==='number'&&i"+b+">=0){c=(c+this.stride["+b+"]*i"+b+")|0}else{a.push(this.shape["+b+"]);b.push(this.stride["+b+"])}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+p+"(data,shape,stride,offset){return new "+p+"(data,"+j.map((function(L){return"shape["+L+"]"})).join(",")+","+j.map((function(L){return"stride["+L+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(C[L],z)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};L.exports=function(L,r,p,J){if(void 0===L)return(0,C.array[0])([]);"number"===typeof L&&(L=[L]),void 0===r&&(r=[L.length]);var j=r.length;if(void 0===p){p=new Array(j);for(var z=j-1,t=1;z>=0;--z)p[z]=t,t*=r[z]}if(void 0===J){J=0;for(z=0;z<j;++z)p[z]<0&&(J-=(r[z]-1)*p[z])}for(var E=function(L){if(i(L))return"buffer";if(n)switch(Object.prototype.toString.call(L)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(L)?"array":"generic"}(L),x=C[E];x.length<=j+1;)x.push(G(E,x.length-1));return(0,x[j+1])(L,r,p,J)}},14242:L=>{var r;self,r=()=>(()=>{"use strict";var L={d:(r,p)=>{for(var J in p)L.o(p,J)&&!L.o(r,J)&&Object.defineProperty(r,J,{enumerable:!0,get:p[J]})},o:(L,r)=>Object.prototype.hasOwnProperty.call(L,r)},r={};L.d(r,{default:()=>Z});var p,J=function(L,r){var p=r.x-L.x,J=r.y-L.y;return Math.sqrt(p*p+J*J)},i=function(L){return L*(Math.PI/180)},n=new Map,j=function(L){n.has(L)&&clearTimeout(n.get(L)),n.set(L,setTimeout(L,100))},z=function(L,r,p){for(var J,i=r.split(/[ ,]+/g),n=0;n<i.length;n+=1)J=i[n],L.addEventListener?L.addEventListener(J,p,!1):L.attachEvent&&L.attachEvent(J,p)},G=function(L,r,p){for(var J,i=r.split(/[ ,]+/g),n=0;n<i.length;n+=1)J=i[n],L.removeEventListener?L.removeEventListener(J,p):L.detachEvent&&L.detachEvent(J,p)},C=function(L){return L.preventDefault(),L.type.match(/^touch/)?L.changedTouches:L},t=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},E=function(L,r){r.top||r.right||r.bottom||r.left?(L.style.top=r.top,L.style.right=r.right,L.style.bottom=r.bottom,L.style.left=r.left):(L.style.left=r.x+"px",L.style.top=r.y+"px")},x=function(L,r,p){var J=w(L);for(var i in J)if(J.hasOwnProperty(i))if("string"==typeof r)J[i]=r+" "+p;else{for(var n="",j=0,z=r.length;j<z;j+=1)n+=r[j]+" "+p+", ";J[i]=n.slice(0,-2)}return J},w=function(L){var r={};return r[L]="",["webkit","Moz","o"].forEach((function(p){r[p+L.charAt(0).toUpperCase()+L.slice(1)]=""})),r},g=function(L,r){for(var p in r)r.hasOwnProperty(p)&&(L[p]=r[p]);return L},b=function(L,r){if(L.length)for(var p=0,J=L.length;p<J;p+=1)r(L[p]);else r(L)},c="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,P=window.matchMedia("(any-hover: none)").matches,O=!!("ontouchstart"in window),h=!!window.PointerEvent,U=!!window.MSPointerEvent,W={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},B={start:"mousedown",move:"mousemove",end:"mouseup"},F={};function Q(){}c&&!P?p=W:h?p={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:U?p={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:O?(p=W,F=B):p=B,Q.prototype.on=function(L,r){var p,J=this,i=L.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var n=0;n<i.length;n+=1)p=i[n],J._handlers_[p]=J._handlers_[p]||[],J._handlers_[p].push(r);return J},Q.prototype.off=function(L,r){var p=this;return p._handlers_=p._handlers_||{},void 0===L?p._handlers_={}:void 0===r?p._handlers_[L]=null:p._handlers_[L]&&p._handlers_[L].indexOf(r)>=0&&p._handlers_[L].splice(p._handlers_[L].indexOf(r),1),p},Q.prototype.trigger=function(L,r){var p,J=this,i=L.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var n=0;n<i.length;n+=1)p=i[n],J._handlers_[p]&&J._handlers_[p].length&&J._handlers_[p].forEach((function(L){L.call(J,{type:p,target:J},r)}))},Q.prototype.config=function(L){var r=this;r.options=r.defaults||{},L&&(r.options=function(L,r){var p={};for(var J in L)L.hasOwnProperty(J)&&r.hasOwnProperty(J)?p[J]=r[J]:L.hasOwnProperty(J)&&(p[J]=L[J]);return p}(r.options,L))},Q.prototype.bindEvt=function(L,r){var J=this;return J._domHandlers_=J._domHandlers_||{},J._domHandlers_[r]=function(){"function"==typeof J["on"+r]?J["on"+r].apply(J,arguments):console.warn('[WARNING] : Missing "on'+r+'" handler.')},z(L,p[r],J._domHandlers_[r]),F[r]&&z(L,F[r],J._domHandlers_[r]),J},Q.prototype.unbindEvt=function(L,r){var J=this;return J._domHandlers_=J._domHandlers_||{},G(L,p[r],J._domHandlers_[r]),F[r]&&G(L,F[r],J._domHandlers_[r]),delete J._domHandlers_[r],this};const e=Q;function v(L,r){return this.identifier=r.identifier,this.position=r.position,this.frontPosition=r.frontPosition,this.collection=L,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(r),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=v.id,v.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}v.prototype=new e,v.constructor=v,v.id=0,v.prototype.buildEl=function(L){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},v.prototype.stylize=function(){if(this.options.dataOnly)return this;var L=this.options.fadeTime+"ms",r=function(){var L=w("borderRadius");for(var r in L)L.hasOwnProperty(r)&&(L[r]="50%");return L}(),p=x("transition","opacity",L),J={};return J.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},J.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},J.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},g(J.el,p),"circle"===this.options.shape&&g(J.back,r),g(J.front,r),this.applyStyles(J),this},v.prototype.applyStyles=function(L){for(var r in this.ui)if(this.ui.hasOwnProperty(r))for(var p in L[r])this.ui[r].style[p]=L[r][p];return this},v.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},v.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},v.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},v.prototype.show=function(L){var r=this;return r.options.dataOnly||(clearTimeout(r.removeTimeout),clearTimeout(r.showTimeout),clearTimeout(r.restTimeout),r.addToDom(),r.restCallback(),setTimeout((function(){r.ui.el.style.opacity=1}),0),r.showTimeout=setTimeout((function(){r.trigger("shown",r.instance),"function"==typeof L&&L.call(this)}),r.options.fadeTime)),r},v.prototype.hide=function(L){var r=this;if(r.options.dataOnly)return r;if(r.ui.el.style.opacity=r.options.restOpacity,clearTimeout(r.removeTimeout),clearTimeout(r.showTimeout),clearTimeout(r.restTimeout),r.removeTimeout=setTimeout((function(){var p="dynamic"===r.options.mode?"none":"block";r.ui.el.style.display=p,"function"==typeof L&&L.call(r),r.trigger("hidden",r.instance)}),r.options.fadeTime),r.options.restJoystick){var p=r.options.restJoystick,J={};J.x=!0===p||!1!==p.x?0:r.instance.frontPosition.x,J.y=!0===p||!1!==p.y?0:r.instance.frontPosition.y,r.setPosition(L,J)}return r},v.prototype.setPosition=function(L,r){var p=this;p.frontPosition={x:r.x,y:r.y};var J=p.options.fadeTime+"ms",i={};i.front=x("transition",["transform"],J);var n={front:{}};n.front={transform:"translate("+p.frontPosition.x+"px,"+p.frontPosition.y+"px)"},p.applyStyles(i),p.applyStyles(n),p.restTimeout=setTimeout((function(){"function"==typeof L&&L.call(p),p.restCallback()}),p.options.fadeTime)},v.prototype.restCallback=function(){var L=this,r={};r.front=x("transition","none",""),L.applyStyles(r),L.trigger("rested",L.instance)},v.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},v.prototype.computeDirection=function(L){var r,p,J,i=L.angle.radian,n=Math.PI/4,j=Math.PI/2;if(i>n&&i<3*n&&!L.lockX?r="up":i>-n&&i<=n&&!L.lockY?r="left":i>3*-n&&i<=-n&&!L.lockX?r="down":L.lockY||(r="right"),L.lockY||(p=i>-j&&i<j?"left":"right"),L.lockX||(J=i>0?"up":"down"),L.force>this.options.threshold){var z,G={};for(z in this.direction)this.direction.hasOwnProperty(z)&&(G[z]=this.direction[z]);var C={};for(z in this.direction={x:p,y:J,angle:r},L.direction=this.direction,G)G[z]===this.direction[z]&&(C[z]=!0);if(C.x&&C.y&&C.angle)return L;C.x&&C.y||this.trigger("plain",L),C.x||this.trigger("plain:"+p,L),C.y||this.trigger("plain:"+J,L),C.angle||this.trigger("dir dir:"+r,L)}else this.resetDirection();return L};const y=v;function A(L,r){var p=this;p.nipples=[],p.idles=[],p.actives=[],p.ids=[],p.pressureIntervals={},p.manager=L,p.id=A.id,A.id+=1,p.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},p.config(r),"static"!==p.options.mode&&"semi"!==p.options.mode||(p.options.multitouch=!1),p.options.multitouch||(p.options.maxNumberOfNipples=1);var J=getComputedStyle(p.options.zone.parentElement);return J&&"flex"===J.display&&(p.parentIsFlex=!0),p.updateBox(),p.prepareNipples(),p.Cx(),p.begin(),p.nipples}A.prototype=new e,A.constructor=A,A.id=0,A.prototype.prepareNipples=function(){var L=this,r=L.nipples;r.on=L.on.bind(L),r.off=L.off.bind(L),r.options=L.options,r.destroy=L.destroy.bind(L),r.ids=L.ids,r.id=L.id,r.processOnMove=L.processOnMove.bind(L),r.processOnEnd=L.processOnEnd.bind(L),r.get=function(L){if(void 0===L)return r[0];for(var p=0,J=r.length;p<J;p+=1)if(r[p].identifier===L)return r[p];return!1}},A.prototype.Cx=function(){var L=this;L.bindEvt(L.options.zone,"start"),L.options.zone.style.touchAction="none",L.options.zone.style.msTouchAction="none"},A.prototype.begin=function(){var L=this,r=L.options;if("static"===r.mode){var p=L.createNipple(r.position,L.manager.getIdentifier());p.add(),L.idles.push(p)}},A.prototype.createNipple=function(L,r){var p=this,J=p.manager.scroll,i={},n=p.options,j=p.parentIsFlex?J.x:J.x+p.box.left,z=p.parentIsFlex?J.y:J.y+p.box.top;if(L.x&&L.y)i={x:L.x-j,y:L.y-z};else if(L.top||L.right||L.bottom||L.left){var G=document.createElement("DIV");G.style.display="hidden",G.style.top=L.top,G.style.right=L.right,G.style.bottom=L.bottom,G.style.left=L.left,G.style.position="absolute",n.zone.appendChild(G);var C=G.getBoundingClientRect();n.zone.removeChild(G),i=L,L={x:C.left+J.x,y:C.top+J.y}}var t=new y(p,{color:n.color,size:n.size,threshold:n.threshold,fadeTime:n.fadeTime,dataOnly:n.dataOnly,restJoystick:n.restJoystick,restOpacity:n.restOpacity,mode:n.mode,identifier:r,position:L,zone:n.zone,frontPosition:{x:0,y:0},shape:n.shape});return n.dataOnly||(E(t.ui.el,i),E(t.ui.front,t.frontPosition)),p.nipples.push(t),p.trigger("added "+t.identifier+":added",t),p.manager.trigger("added "+t.identifier+":added",t),p.bindNipple(t),t},A.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},A.prototype.bindNipple=function(L){var r,p=this,J=function(L,J){r=L.type+" "+J.id+":"+L.type,p.trigger(r,J)};L.on("destroyed",p.onDestroyed.bind(p)),L.on("shown hidden rested dir plain",J),L.on("dir:up dir:right dir:down dir:left",J),L.on("plain:up plain:right plain:down plain:left",J)},A.prototype.pressureFn=function(L,r,p){var J=this,i=0;clearInterval(J.pressureIntervals[p]),J.pressureIntervals[p]=setInterval(function(){var p=L.force||L.pressure||L.webkitForce||0;p!==i&&(r.trigger("pressure",p),J.trigger("pressure "+r.identifier+":pressure",p),i=p)}.bind(J),100)},A.prototype.onstart=function(L){var r=this,p=r.options,J=L;return L=C(L),r.updateBox(),b(L,(function(i){r.actives.length<p.maxNumberOfNipples?r.processOnStart(i):J.type.match(/^touch/)&&(Object.keys(r.manager.ids).forEach((function(p){if(Object.values(J.touches).findIndex((function(L){return L.identifier===p}))<0){var i=[L[0]];i.identifier=p,r.processOnEnd(i)}})),r.actives.length<p.maxNumberOfNipples&&r.processOnStart(i))})),r.manager.bindDocument(),!1},A.prototype.processOnStart=function(L){var r,p=this,i=p.options,n=p.manager.getIdentifier(L),j=L.force||L.pressure||L.webkitForce||0,z={x:L.pageX,y:L.pageY},G=p.getOrCreate(n,z);G.identifier!==n&&p.manager.removeIdentifier(G.identifier),G.identifier=n;var C=function(r){r.trigger("start",r),p.trigger("start "+r.id+":start",r),r.show(),j>0&&p.pressureFn(L,r,r.identifier),p.processOnMove(L)};if((r=p.idles.indexOf(G))>=0&&p.idles.splice(r,1),p.actives.push(G),p.ids.push(G.identifier),"semi"!==i.mode)C(G);else{if(!(J(z,G.position)<=i.catchDistance))return G.destroy(),void p.processOnStart(L);C(G)}return G},A.prototype.getOrCreate=function(L,r){var p,J=this,i=J.options;return/(semi|static)/.test(i.mode)?(p=J.idles[0])?(J.idles.splice(0,1),p):"semi"===i.mode?J.createNipple(r,L):(console.warn("Coudln't find the needed nipple."),!1):p=J.createNipple(r,L)},A.prototype.processOnMove=function(L){var r=this,p=r.options,n=r.manager.getIdentifier(L),j=r.nipples.get(n),z=r.manager.scroll;if(function(L){return isNaN(L.buttons)?0!==L.pressure:0!==L.buttons}(L)){if(!j)return console.error("Found zombie joystick with ID "+n),void r.manager.removeIdentifier(n);if(p.dynamicPage){var G=j.el.getBoundingClientRect();j.position={x:z.x+G.left,y:z.y+G.top}}j.identifier=n;var C=j.options.size/2,t={x:L.pageX,y:L.pageY};p.lockX&&(t.y=j.position.y),p.lockY&&(t.x=j.position.x);var E,x,w,g,b,c,P,O,h,U,W=J(t,j.position),B=(E=t,w=(x=j.position).x-E.x,g=x.y-E.y,function(L){return L*(180/Math.PI)}(Math.atan2(g,w))),F=i(B),Q=W/C,e={distance:W,position:t};if("circle"===j.options.shape?(b=Math.min(W,C),P=j.position,O=b,U={x:0,y:0},h=i(h=B),U.x=P.x-O*Math.cos(h),U.y=P.y-O*Math.sin(h),c=U):(c=function(L,r,p){return{x:Math.min(Math.max(L.x,r.x-p),r.x+p),y:Math.min(Math.max(L.y,r.y-p),r.y+p)}}(t,j.position,C),b=J(c,j.position)),p.follow){if(W>C){var v=t.x-c.x,y=t.y-c.y;j.position.x+=v,j.position.y+=y,j.el.style.top=j.position.y-(r.box.top+z.y)+"px",j.el.style.left=j.position.x-(r.box.left+z.x)+"px",W=J(t,j.position)}}else t=c,W=b;var A=t.x-j.position.x,u=t.y-j.position.y;j.frontPosition={x:A,y:u},p.dataOnly||(j.ui.front.style.transform="translate("+A+"px,"+u+"px)");var a={identifier:j.identifier,position:t,force:Q,pressure:L.force||L.pressure||L.webkitForce||0,distance:W,angle:{radian:F,degree:B},vector:{x:A/C,y:-u/C},raw:e,instance:j,lockX:p.lockX,lockY:p.lockY};(a=j.computeDirection(a)).angle={radian:i(180-B),degree:180-B},j.trigger("move",a),r.trigger("move "+j.id+":move",a)}else this.processOnEnd(L)},A.prototype.processOnEnd=function(L){var r=this,p=r.options,J=r.manager.getIdentifier(L),i=r.nipples.get(J),n=r.manager.removeIdentifier(i.identifier);i&&(p.dataOnly||i.hide((function(){"dynamic"===p.mode&&(i.trigger("removed",i),r.trigger("removed "+i.id+":removed",i),r.manager.trigger("removed "+i.id+":removed",i),i.destroy())})),clearInterval(r.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),r.trigger("end "+i.id+":end",i),r.ids.indexOf(i.identifier)>=0&&r.ids.splice(r.ids.indexOf(i.identifier),1),r.actives.indexOf(i)>=0&&r.actives.splice(r.actives.indexOf(i),1),/(semi|static)/.test(p.mode)?r.idles.push(i):r.nipples.indexOf(i)>=0&&r.nipples.splice(r.nipples.indexOf(i),1),r.manager.unbindDocument(),/(semi|static)/.test(p.mode)&&(r.manager.ids[n.id]=n.identifier))},A.prototype.onDestroyed=function(L,r){var p=this;p.nipples.indexOf(r)>=0&&p.nipples.splice(p.nipples.indexOf(r),1),p.actives.indexOf(r)>=0&&p.actives.splice(p.actives.indexOf(r),1),p.idles.indexOf(r)>=0&&p.idles.splice(p.idles.indexOf(r),1),p.ids.indexOf(r.identifier)>=0&&p.ids.splice(p.ids.indexOf(r.identifier),1),p.manager.removeIdentifier(r.identifier),p.manager.unbindDocument()},A.prototype.destroy=function(){var L=this;for(var r in L.unbindEvt(L.options.zone,"start"),L.nipples.forEach((function(L){L.destroy()})),L.pressureIntervals)L.pressureIntervals.hasOwnProperty(r)&&clearInterval(L.pressureIntervals[r]);L.trigger("destroyed",L.nipples),L.manager.unbindDocument(),L.off()};const u=A;function a(L){var r=this;r.ids={},r.index=0,r.collections=[],r.scroll=t(),r.config(L),r.prepareCollections();var p=function(){var L;r.collections.forEach((function(p){p.forEach((function(p){L=p.el.getBoundingClientRect(),p.position={x:r.scroll.x+L.left,y:r.scroll.y+L.top}}))}))};z(window,"resize",(function(){j(p)}));var J=function(){r.scroll=t()};return z(window,"scroll",(function(){j(J)})),r.collections}a.prototype=new e,a.constructor=a,a.prototype.prepareCollections=function(){var L=this;L.collections.create=L.create.bind(L),L.collections.on=L.on.bind(L),L.collections.off=L.off.bind(L),L.collections.destroy=L.destroy.bind(L),L.collections.get=function(r){var p;return L.collections.every((function(L){return!(p=L.get(r))})),p}},a.prototype.create=function(L){return this.createCollection(L)},a.prototype.createCollection=function(L){var r=this,p=new u(r,L);return r.bindCollection(p),r.collections.push(p),p},a.prototype.bindCollection=function(L){var r,p=this,J=function(L,J){r=L.type+" "+J.id+":"+L.type,p.trigger(r,J)};L.on("destroyed",p.onDestroyed.bind(p)),L.on("shown hidden rested dir plain",J),L.on("dir:up dir:right dir:down dir:left",J),L.on("plain:up plain:right plain:down plain:left",J)},a.prototype.bindDocument=function(){var L=this;L.binded||(L.bindEvt(document,"move").bindEvt(document,"end"),L.binded=!0)},a.prototype.unbindDocument=function(L){var r=this;Object.keys(r.ids).length&&!0!==L||(r.unbindEvt(document,"move").unbindEvt(document,"end"),r.binded=!1)},a.prototype.getIdentifier=function(L){var r;return L?void 0===(r=void 0===L.identifier?L.pointerId:L.identifier)&&(r=this.latest||0):r=this.index,void 0===this.ids[r]&&(this.ids[r]=this.index,this.index+=1),this.latest=r,this.ids[r]},a.prototype.removeIdentifier=function(L){var r={};for(var p in this.ids)if(this.ids[p]===L){r.id=p,r.identifier=this.ids[p],delete this.ids[p];break}return r},a.prototype.onmove=function(L){return this.onAny("move",L),!1},a.prototype.onend=function(L){return this.onAny("end",L),!1},a.prototype.oncancel=function(L){return this.onAny("end",L),!1},a.prototype.onAny=function(L,r){var p,J=this,i="processOn"+L.charAt(0).toUpperCase()+L.slice(1);r=C(r);var n=function(L,r,p){p.ids.indexOf(r)>=0&&(p[i](L),L._found_=!0)};return b(r,(function(L){p=J.getIdentifier(L),b(J.collections,n.bind(null,L,p)),L._found_||J.removeIdentifier(p)})),!1},a.prototype.destroy=function(){var L=this;L.unbindDocument(!0),L.ids={},L.index=0,L.collections.forEach((function(L){L.destroy()})),L.off()},a.prototype.onDestroyed=function(L,r){var p=this;if(p.collections.indexOf(r)<0)return!1;p.collections.splice(p.collections.indexOf(r),1)};var q=new a;const Z={create:function(L){return q.create(L)},factory:q};return r.default})(),L.exports=r()},13217:(L,r,p)=>{"use strict";const{Deflate:J,deflate:i,deflateRaw:n,gzip:j}=p(13226),{Inflate:z,inflate:G,inflateRaw:C,ungzip:t}=p(13284),E=p(13255);L.exports.Deflate=J,L.exports.deflate=i,L.exports.deflateRaw=n,L.exports.gzip=j,L.exports.Inflate=z,L.exports.inflate=G,L.exports.inflateRaw=C,L.exports.ungzip=t,L.exports.constants=E},13226:(L,r,p)=>{"use strict";const J=p(13230),i=p(13262),n=p(13268),j=p(13252),z=p(13277),G=Object.prototype.toString,{Z_NO_FLUSH:C,Z_SYNC_FLUSH:t,Z_FULL_FLUSH:E,Z_FINISH:x,Z_OK:w,Z_STREAM_END:g,Z_DEFAULT_COMPRESSION:b,Z_DEFAULT_STRATEGY:c,Z_DEFLATED:P}=p(13255);function O(L){this.options=i.assign({level:b,method:P,YL:16384,windowBits:15,memLevel:8,strategy:c},L||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.Cr="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;let p=J.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(p!==w)throw new Error(j[p]);if(r.header&&J.deflateSetHeader(this.strm,r.header),r.dictionary){let L;if(L="string"===typeof r.dictionary?n.string2buf(r.dictionary):"[object ArrayBuffer]"===G.call(r.dictionary)?new Uint8Array(r.dictionary):r.dictionary,p=J.deflateSetDictionary(this.strm,L),p!==w)throw new Error(j[p]);this._dict_set=!0}}function h(L,r){const p=new O(r);if(p.push(L,!0),p.err)throw p.Cr||j[p.err];return p.result}O.prototype.push=function(L,r){const p=this.strm,i=this.options.YL;let j,z;if(this.ended)return!1;for(z=r===~~r?r:!0===r?x:C,"string"===typeof L?p.input=n.string2buf(L):"[object ArrayBuffer]"===G.call(L)?p.input=new Uint8Array(L):p.input=L,p.next_in=0,p.avail_in=p.input.length;;)if(0===p.avail_out&&(p.output=new Uint8Array(i),p.next_out=0,p.avail_out=i),(z===t||z===E)&&p.avail_out<=6)this.onData(p.output.subarray(0,p.next_out)),p.avail_out=0;else{if(j=J.deflate(p,z),j===g)return p.next_out>0&&this.onData(p.output.subarray(0,p.next_out)),j=J.deflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===w;if(0!==p.avail_out){if(z>0&&p.next_out>0)this.onData(p.output.subarray(0,p.next_out)),p.avail_out=0;else if(0===p.avail_in)break}else this.onData(p.output)}return!0},O.prototype.onData=function(L){this.chunks.push(L)},O.prototype.onEnd=function(L){L===w&&(this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=L,this.Cr=this.strm.Cr},L.exports.Deflate=O,L.exports.deflate=h,L.exports.deflateRaw=function(L,r){return(r=r||{}).raw=!0,h(L,r)},L.exports.gzip=function(L,r){return(r=r||{}).gzip=!0,h(L,r)},L.exports.constants=p(13255)},13284:(L,r,p)=>{"use strict";const J=p(13289),i=p(13262),n=p(13268),j=p(13252),z=p(13277),G=p(13305),C=Object.prototype.toString,{Z_NO_FLUSH:t,Z_FINISH:E,Z_OK:x,Z_STREAM_END:w,Z_NEED_DICT:g,Z_STREAM_ERROR:b,Z_DATA_ERROR:c,Z_MEM_ERROR:P}=p(13255);function O(L){this.options=i.assign({YL:65536,windowBits:15,to:""},L||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,0===r.windowBits&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||L&&L.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&0===(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.Cr="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;let p=J.inflateInit2(this.strm,r.windowBits);if(p!==x)throw new Error(j[p]);if(this.header=new G,J.inflateGetHeader(this.strm,this.header),r.dictionary&&("string"===typeof r.dictionary?r.dictionary=n.string2buf(r.dictionary):"[object ArrayBuffer]"===C.call(r.dictionary)&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(p=J.inflateSetDictionary(this.strm,r.dictionary),p!==x)))throw new Error(j[p])}function h(L,r){const p=new O(r);if(p.push(L),p.err)throw p.Cr||j[p.err];return p.result}O.prototype.push=function(L,r){const p=this.strm,i=this.options.YL,j=this.options.dictionary;let z,G,O;if(this.ended)return!1;for(G=r===~~r?r:!0===r?E:t,"[object ArrayBuffer]"===C.call(L)?p.input=new Uint8Array(L):p.input=L,p.next_in=0,p.avail_in=p.input.length;;){for(0===p.avail_out&&(p.output=new Uint8Array(i),p.next_out=0,p.avail_out=i),z=J.inflate(p,G),z===g&&j&&(z=J.inflateSetDictionary(p,j),z===x?z=J.inflate(p,G):z===c&&(z=g));p.avail_in>0&&z===w&&p.state.wrap>0&&0!==L[p.next_in];)J.inflateReset(p),z=J.inflate(p,G);switch(z){case b:case c:case g:case P:return this.onEnd(z),this.ended=!0,!1}if(O=p.avail_out,p.next_out&&(0===p.avail_out||z===w))if("string"===this.options.to){let L=n.utf8border(p.output,p.next_out),r=p.next_out-L,J=n.buf2string(p.output,L);p.next_out=r,p.avail_out=i-r,r&&p.output.set(p.output.subarray(L,L+r),0),this.onData(J)}else this.onData(p.output.length===p.next_out?p.output:p.output.subarray(0,p.next_out));if(z!==x||0!==O){if(z===w)return z=J.inflateEnd(this.strm),this.onEnd(z),this.ended=!0,!0;if(0===p.avail_in)break}}return!0},O.prototype.onData=function(L){this.chunks.push(L)},O.prototype.onEnd=function(L){L===x&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=L,this.Cr=this.strm.Cr},L.exports.Inflate=O,L.exports.inflate=h,L.exports.inflateRaw=function(L,r){return(r=r||{}).raw=!0,h(L,r)},L.exports.ungzip=h,L.exports.constants=p(13255)},13262:L=>{"use strict";const r=(L,r)=>Object.prototype.hasOwnProperty.call(L,r);L.exports.assign=function(L){const p=Array.prototype.slice.call(arguments,1);for(;p.length;){const J=p.shift();if(J){if("object"!==typeof J)throw new TypeError(J+"must be non-object");for(const p in J)r(J,p)&&(L[p]=J[p])}}return L},L.exports.flattenChunks=L=>{let r=0;for(let J=0,i=L.length;J<i;J++)r+=L[J].length;const p=new Uint8Array(r);for(let J=0,i=0,n=L.length;J<n;J++){let r=L[J];p.set(r,i),i+=r.length}return p}},13268:L=>{"use strict";let r=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(J){r=!1}const p=new Uint8Array(256);for(let i=0;i<256;i++)p[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;p[254]=p[254]=1,L.exports.string2buf=L=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(L);let r,p,J,i,n,j=L.length,z=0;for(i=0;i<j;i++)p=L.charCodeAt(i),55296===(64512&p)&&i+1<j&&(J=L.charCodeAt(i+1),56320===(64512&J)&&(p=65536+(p-55296<<10)+(J-56320),i++)),z+=p<128?1:p<2048?2:p<65536?3:4;for(r=new Uint8Array(z),n=0,i=0;n<z;i++)p=L.charCodeAt(i),55296===(64512&p)&&i+1<j&&(J=L.charCodeAt(i+1),56320===(64512&J)&&(p=65536+(p-55296<<10)+(J-56320),i++)),p<128?r[n++]=p:p<2048?(r[n++]=192|p>>>6,r[n++]=128|63&p):p<65536?(r[n++]=224|p>>>12,r[n++]=128|p>>>6&63,r[n++]=128|63&p):(r[n++]=240|p>>>18,r[n++]=128|p>>>12&63,r[n++]=128|p>>>6&63,r[n++]=128|63&p);return r};L.exports.buf2string=(L,J)=>{const i=J||L.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(L.subarray(0,J));let n,j;const z=new Array(2*i);for(j=0,n=0;n<i;){let r=L[n++];if(r<128){z[j++]=r;continue}let J=p[r];if(J>4)z[j++]=65533,n+=J-1;else{for(r&=2===J?31:3===J?15:7;J>1&&n<i;)r=r<<6|63&L[n++],J--;J>1?z[j++]=65533:r<65536?z[j++]=r:(r-=65536,z[j++]=55296|r>>10&1023,z[j++]=56320|1023&r)}}return((L,p)=>{if(p<65534&&L.subarray&&r)return String.fromCharCode.apply(null,L.length===p?L:L.subarray(0,p));let J="";for(let r=0;r<p;r++)J+=String.fromCharCode(L[r]);return J})(z,j)},L.exports.utf8border=(L,r)=>{(r=r||L.length)>L.length&&(r=L.length);let J=r-1;for(;J>=0&&128===(192&L[J]);)J--;return J<0||0===J?r:J+p[L[J]]>r?J:r}},13241:L=>{"use strict";L.exports=(L,r,p,J)=>{let i=65535&L,n=L>>>16&65535,j=0;for(;0!==p;){j=p>2e3?2e3:p,p-=j;do{i=i+r[J++]|0,n=n+i|0}while(--j);i%=65521,n%=65521}return i|n<<16}},13255:L=>{"use strict";L.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13250:L=>{"use strict";const r=new Uint32Array((()=>{let L,r=[];for(var p=0;p<256;p++){L=p;for(var J=0;J<8;J++)L=1&L?3988292384^L>>>1:L>>>1;r[p]=L}return r})());L.exports=(L,p,J,i)=>{const n=r,j=i+J;L^=-1;for(let r=i;r<j;r++)L=L>>>8^n[255&(L^p[r])];return~L}},13230:(L,r,p)=>{"use strict";const{_tr_init:J,_tr_stored_block:i,_tr_flush_block:n,_tr_tally:j,_tr_align:z}=p(13239),G=p(13241),C=p(13250),t=p(13252),{Z_NO_FLUSH:E,Z_PARTIAL_FLUSH:x,Z_FULL_FLUSH:w,Z_FINISH:g,Z_BLOCK:b,Z_OK:c,Z_STREAM_END:P,Z_STREAM_ERROR:O,Z_DATA_ERROR:h,Z_BUF_ERROR:U,Z_DEFAULT_COMPRESSION:W,Z_FILTERED:B,Z_HUFFMAN_ONLY:F,Z_RLE:Q,Z_FIXED:e,Z_DEFAULT_STRATEGY:v,Z_UNKNOWN:y,Z_DEFLATED:A}=p(13255),u=258,a=262,q=103,Z=113,X=666,D=(L,r)=>(L.Cr=t[r],r),l=L=>(L<<1)-(L>4?9:0),T=L=>{let r=L.length;for(;--r>=0;)L[r]=0};let Y=(L,r,p)=>(r<<L.hash_shift^p)&L.hash_mask;const M=L=>{const r=L.state;let p=r.pending;p>L.avail_out&&(p=L.avail_out),0!==p&&(L.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+p),L.next_out),L.next_out+=p,r.pending_out+=p,L.total_out+=p,L.avail_out-=p,r.pending-=p,0===r.pending&&(r.pending_out=0))},f=(L,r)=>{n(L,L.block_start>=0?L.block_start:-1,L.strstart-L.block_start,r),L.block_start=L.strstart,M(L.strm)},d=(L,r)=>{L.pending_buf[L.pending++]=r},s=(L,r)=>{L.pending_buf[L.pending++]=r>>>8&255,L.pending_buf[L.pending++]=255&r},H=(L,r,p,J)=>{let i=L.avail_in;return i>J&&(i=J),0===i?0:(L.avail_in-=i,r.set(L.input.subarray(L.next_in,L.next_in+i),p),1===L.state.wrap?L.adler=G(L.adler,r,i,p):2===L.state.wrap&&(L.adler=C(L.adler,r,i,p)),L.next_in+=i,L.total_in+=i,i)},o=(L,r)=>{let p,J,i=L.max_chain_length,n=L.strstart,j=L.prev_length,z=L.nice_match;const G=L.strstart>L.w_size-a?L.strstart-(L.w_size-a):0,C=L.window,t=L.w_mask,E=L.prev,x=L.strstart+u;let w=C[n+j-1],g=C[n+j];L.prev_length>=L.good_match&&(i>>=2),z>L.lookahead&&(z=L.lookahead);do{if(p=r,C[p+j]===g&&C[p+j-1]===w&&C[p]===C[n]&&C[++p]===C[n+1]){n+=2,p++;do{}while(C[++n]===C[++p]&&C[++n]===C[++p]&&C[++n]===C[++p]&&C[++n]===C[++p]&&C[++n]===C[++p]&&C[++n]===C[++p]&&C[++n]===C[++p]&&C[++n]===C[++p]&&n<x);if(J=u-(x-n),n=x-u,J>j){if(L.match_start=r,j=J,J>=z)break;w=C[n+j-1],g=C[n+j]}}}while((r=E[r&t])>G&&0!==--i);return j<=L.lookahead?j:L.lookahead},k=L=>{const r=L.w_size;let p,J,i,n,j;do{if(n=L.window_size-L.lookahead-L.strstart,L.strstart>=r+(r-a)){L.window.set(L.window.subarray(r,r+r),0),L.match_start-=r,L.strstart-=r,L.block_start-=r,J=L.hash_size,p=J;do{i=L.head[--p],L.head[p]=i>=r?i-r:0}while(--J);J=r,p=J;do{i=L.prev[--p],L.prev[p]=i>=r?i-r:0}while(--J);n+=r}if(0===L.strm.avail_in)break;if(J=H(L.strm,L.window,L.strstart+L.lookahead,n),L.lookahead+=J,L.lookahead+L.insert>=3)for(j=L.strstart-L.insert,L.ins_h=L.window[j],L.ins_h=Y(L,L.ins_h,L.window[j+1]);L.insert&&(L.ins_h=Y(L,L.ins_h,L.window[j+3-1]),L.prev[j&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=j,j++,L.insert--,!(L.lookahead+L.insert<3)););}while(L.lookahead<a&&0!==L.strm.avail_in)},R=(L,r)=>{let p,J;for(;;){if(L.lookahead<a){if(k(L),L.lookahead<a&&r===E)return 1;if(0===L.lookahead)break}if(p=0,L.lookahead>=3&&(L.ins_h=Y(L,L.ins_h,L.window[L.strstart+3-1]),p=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),0!==p&&L.strstart-p<=L.w_size-a&&(L.match_length=o(L,p)),L.match_length>=3)if(J=j(L,L.strstart-L.match_start,L.match_length-3),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=3){L.match_length--;do{L.strstart++,L.ins_h=Y(L,L.ins_h,L.window[L.strstart+3-1]),p=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart}while(0!==--L.match_length);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=Y(L,L.ins_h,L.window[L.strstart+1]);else J=j(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(J&&(f(L,!1),0===L.strm.avail_out))return 1}return L.insert=L.strstart<2?L.strstart:2,r===g?(f(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(f(L,!1),0===L.strm.avail_out)?1:2},I=(L,r)=>{let p,J,i;for(;;){if(L.lookahead<a){if(k(L),L.lookahead<a&&r===E)return 1;if(0===L.lookahead)break}if(p=0,L.lookahead>=3&&(L.ins_h=Y(L,L.ins_h,L.window[L.strstart+3-1]),p=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=2,0!==p&&L.prev_length<L.max_lazy_match&&L.strstart-p<=L.w_size-a&&(L.match_length=o(L,p),L.match_length<=5&&(L.strategy===B||3===L.match_length&&L.strstart-L.match_start>4096)&&(L.match_length=2)),L.prev_length>=3&&L.match_length<=L.prev_length){i=L.strstart+L.lookahead-3,J=j(L,L.strstart-1-L.prev_match,L.prev_length-3),L.lookahead-=L.prev_length-1,L.prev_length-=2;do{++L.strstart<=i&&(L.ins_h=Y(L,L.ins_h,L.window[L.strstart+3-1]),p=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart)}while(0!==--L.prev_length);if(L.match_available=0,L.match_length=2,L.strstart++,J&&(f(L,!1),0===L.strm.avail_out))return 1}else if(L.match_available){if(J=j(L,0,L.window[L.strstart-1]),J&&f(L,!1),L.strstart++,L.lookahead--,0===L.strm.avail_out)return 1}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(J=j(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<2?L.strstart:2,r===g?(f(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(f(L,!1),0===L.strm.avail_out)?1:2};function N(L,r,p,J,i){this.good_length=L,this.max_lazy=r,this.nice_length=p,this.max_chain=J,this.func=i}const K=[new N(0,0,0,0,((L,r)=>{let p=65535;for(p>L.pending_buf_size-5&&(p=L.pending_buf_size-5);;){if(L.lookahead<=1){if(k(L),0===L.lookahead&&r===E)return 1;if(0===L.lookahead)break}L.strstart+=L.lookahead,L.lookahead=0;const J=L.block_start+p;if((0===L.strstart||L.strstart>=J)&&(L.lookahead=L.strstart-J,L.strstart=J,f(L,!1),0===L.strm.avail_out))return 1;if(L.strstart-L.block_start>=L.w_size-a&&(f(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,r===g?(f(L,!0),0===L.strm.avail_out?3:4):(L.strstart>L.block_start&&(f(L,!1),L.strm.avail_out),1)})),new N(4,4,8,4,R),new N(4,5,16,8,R),new N(4,6,32,32,R),new N(4,4,16,16,I),new N(8,16,32,32,I),new N(8,16,128,128,I),new N(8,32,128,256,I),new N(32,128,258,1024,I),new N(32,258,258,4096,I)];function mL(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),T(this.dyn_ltree),T(this.dyn_dtree),T(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),T(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),T(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const V=L=>{if(!L||!L.state)return D(L,O);L.total_in=L.total_out=0,L.data_type=y;const r=L.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap?42:Z,L.adler=2===r.wrap?0:1,r.last_flush=E,J(r),c},S=L=>{const r=V(L);var p;return r===c&&((p=L.state).window_size=2*p.w_size,T(p.head),p.max_lazy_match=K[p.level].max_lazy,p.good_match=K[p.level].good_length,p.nice_match=K[p.level].nice_length,p.max_chain_length=K[p.level].max_chain,p.strstart=0,p.block_start=0,p.lookahead=0,p.insert=0,p.match_length=p.prev_length=2,p.match_available=0,p.ins_h=0),r},LL=(L,r,p,J,i,n)=>{if(!L)return O;let j=1;if(r===W&&(r=6),J<0?(j=0,J=-J):J>15&&(j=2,J-=16),i<1||i>9||p!==A||J<8||J>15||r<0||r>9||n<0||n>e)return D(L,O);8===J&&(J=9);const z=new mL;return L.state=z,z.strm=L,z.wrap=j,z.gzhead=null,z.w_bits=J,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=i+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+3-1)/3),z.window=new Uint8Array(2*z.w_size),z.head=new Uint16Array(z.hash_size),z.prev=new Uint16Array(z.w_size),z.lit_bufsize=1<<i+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new Uint8Array(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=r,z.strategy=n,z.method=p,S(L)};L.exports.deflateInit=(L,r)=>LL(L,r,A,15,8,v),L.exports.deflateInit2=LL,L.exports.deflateReset=S,L.exports.deflateResetKeep=V,L.exports.deflateSetHeader=(L,r)=>L&&L.state?2!==L.state.wrap?O:(L.state.gzhead=r,c):O,L.exports.deflate=(L,r)=>{let p,J;if(!L||!L.state||r>b||r<0)return L?D(L,O):O;const n=L.state;if(!L.output||!L.input&&0!==L.avail_in||n.status===X&&r!==g)return D(L,0===L.avail_out?U:O);n.strm=L;const G=n.last_flush;if(n.last_flush=r,42===n.status)if(2===n.wrap)L.adler=0,d(n,31),d(n,139),d(n,8),n.gzhead?(d(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),d(n,255&n.gzhead.time),d(n,n.gzhead.time>>8&255),d(n,n.gzhead.time>>16&255),d(n,n.gzhead.time>>24&255),d(n,9===n.level?2:n.strategy>=F||n.level<2?4:0),d(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(d(n,255&n.gzhead.extra.length),d(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(L.adler=C(L.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(d(n,0),d(n,0),d(n,0),d(n,0),d(n,0),d(n,9===n.level?2:n.strategy>=F||n.level<2?4:0),d(n,3),n.status=Z);else{let r=A+(n.w_bits-8<<4)<<8,p=-1;p=n.strategy>=F||n.level<2?0:n.level<6?1:6===n.level?2:3,r|=p<<6,0!==n.strstart&&(r|=32),r+=31-r%31,n.status=Z,s(n,r),0!==n.strstart&&(s(n,L.adler>>>16),s(n,65535&L.adler)),L.adler=1}if(69===n.status)if(n.gzhead.extra){for(p=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>p&&(L.adler=C(L.adler,n.pending_buf,n.pending-p,p)),M(L),p=n.pending,n.pending!==n.pending_buf_size));)d(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>p&&(L.adler=C(L.adler,n.pending_buf,n.pending-p,p)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){p=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>p&&(L.adler=C(L.adler,n.pending_buf,n.pending-p,p)),M(L),p=n.pending,n.pending===n.pending_buf_size)){J=1;break}J=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,d(n,J)}while(0!==J);n.gzhead.hcrc&&n.pending>p&&(L.adler=C(L.adler,n.pending_buf,n.pending-p,p)),0===J&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){p=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>p&&(L.adler=C(L.adler,n.pending_buf,n.pending-p,p)),M(L),p=n.pending,n.pending===n.pending_buf_size)){J=1;break}J=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,d(n,J)}while(0!==J);n.gzhead.hcrc&&n.pending>p&&(L.adler=C(L.adler,n.pending_buf,n.pending-p,p)),0===J&&(n.status=q)}else n.status=q;if(n.status===q&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&M(L),n.pending+2<=n.pending_buf_size&&(d(n,255&L.adler),d(n,L.adler>>8&255),L.adler=0,n.status=Z)):n.status=Z),0!==n.pending){if(M(L),0===L.avail_out)return n.last_flush=-1,c}else if(0===L.avail_in&&l(r)<=l(G)&&r!==g)return D(L,U);if(n.status===X&&0!==L.avail_in)return D(L,U);if(0!==L.avail_in||0!==n.lookahead||r!==E&&n.status!==X){let p=n.strategy===F?((L,r)=>{let p;for(;;){if(0===L.lookahead&&(k(L),0===L.lookahead)){if(r===E)return 1;break}if(L.match_length=0,p=j(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,p&&(f(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,r===g?(f(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(f(L,!1),0===L.strm.avail_out)?1:2})(n,r):n.strategy===Q?((L,r)=>{let p,J,i,n;const z=L.window;for(;;){if(L.lookahead<=u){if(k(L),L.lookahead<=u&&r===E)return 1;if(0===L.lookahead)break}if(L.match_length=0,L.lookahead>=3&&L.strstart>0&&(i=L.strstart-1,J=z[i],J===z[++i]&&J===z[++i]&&J===z[++i])){n=L.strstart+u;do{}while(J===z[++i]&&J===z[++i]&&J===z[++i]&&J===z[++i]&&J===z[++i]&&J===z[++i]&&J===z[++i]&&J===z[++i]&&i<n);L.match_length=u-(n-i),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=3?(p=j(L,1,L.match_length-3),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(p=j(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),p&&(f(L,!1),0===L.strm.avail_out))return 1}return L.insert=0,r===g?(f(L,!0),0===L.strm.avail_out?3:4):L.last_lit&&(f(L,!1),0===L.strm.avail_out)?1:2})(n,r):K[n.level].func(n,r);if(3!==p&&4!==p||(n.status=X),1===p||3===p)return 0===L.avail_out&&(n.last_flush=-1),c;if(2===p&&(r===x?z(n):r!==b&&(i(n,0,0,!1),r===w&&(T(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),M(L),0===L.avail_out))return n.last_flush=-1,c}return r!==g?c:n.wrap<=0?P:(2===n.wrap?(d(n,255&L.adler),d(n,L.adler>>8&255),d(n,L.adler>>16&255),d(n,L.adler>>24&255),d(n,255&L.total_in),d(n,L.total_in>>8&255),d(n,L.total_in>>16&255),d(n,L.total_in>>24&255)):(s(n,L.adler>>>16),s(n,65535&L.adler)),M(L),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?c:P)},L.exports.deflateEnd=L=>{if(!L||!L.state)return O;const r=L.state.status;return 42!==r&&69!==r&&73!==r&&91!==r&&r!==q&&r!==Z&&r!==X?D(L,O):(L.state=null,r===Z?D(L,h):c)},L.exports.deflateSetDictionary=(L,r)=>{let p=r.length;if(!L||!L.state)return O;const J=L.state,i=J.wrap;if(2===i||1===i&&42!==J.status||J.lookahead)return O;if(1===i&&(L.adler=G(L.adler,r,p,0)),J.wrap=0,p>=J.w_size){0===i&&(T(J.head),J.strstart=0,J.block_start=0,J.insert=0);let L=new Uint8Array(J.w_size);L.set(r.subarray(p-J.w_size,p),0),r=L,p=J.w_size}const n=L.avail_in,j=L.next_in,z=L.input;for(L.avail_in=p,L.next_in=0,L.input=r,k(J);J.lookahead>=3;){let L=J.strstart,r=J.lookahead-2;do{J.ins_h=Y(J,J.ins_h,J.window[L+3-1]),J.prev[L&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=L,L++}while(--r);J.strstart=L,J.lookahead=2,k(J)}return J.strstart+=J.lookahead,J.block_start=J.strstart,J.insert=J.lookahead,J.lookahead=0,J.match_length=J.prev_length=2,J.match_available=0,L.next_in=j,L.input=z,L.avail_in=n,J.wrap=i,c},L.exports.deflateInfo="pako deflate (from Nodeca project)"},13305:L=>{"use strict";L.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13294:L=>{"use strict";L.exports=function(L,r){let p,J,i,n,j,z,G,C,t,E,x,w,g,b,c,P,O,h,U,W,B,F,Q,e;const v=L.state;p=L.next_in,Q=L.input,J=p+(L.avail_in-5),i=L.next_out,e=L.output,n=i-(r-L.avail_out),j=i+(L.avail_out-257),z=v.dmax,G=v.wsize,C=v.whave,t=v.wnext,E=v.window,x=v.hold,w=v.bits,g=v.lencode,b=v.distcode,c=(1<<v.lenbits)-1,P=(1<<v.distbits)-1;L:do{w<15&&(x+=Q[p++]<<w,w+=8,x+=Q[p++]<<w,w+=8),O=g[x&c];r:for(;;){if(h=O>>>24,x>>>=h,w-=h,h=O>>>16&255,0===h)e[i++]=65535&O;else{if(!(16&h)){if(0===(64&h)){O=g[(65535&O)+(x&(1<<h)-1)];continue r}if(32&h){v.mode=12;break L}L.Cr="invalid literal/length code",v.mode=30;break L}U=65535&O,h&=15,h&&(w<h&&(x+=Q[p++]<<w,w+=8),U+=x&(1<<h)-1,x>>>=h,w-=h),w<15&&(x+=Q[p++]<<w,w+=8,x+=Q[p++]<<w,w+=8),O=b[x&P];p:for(;;){if(h=O>>>24,x>>>=h,w-=h,h=O>>>16&255,!(16&h)){if(0===(64&h)){O=b[(65535&O)+(x&(1<<h)-1)];continue p}L.Cr="invalid distance code",v.mode=30;break L}if(W=65535&O,h&=15,w<h&&(x+=Q[p++]<<w,w+=8,w<h&&(x+=Q[p++]<<w,w+=8)),W+=x&(1<<h)-1,W>z){L.Cr="invalid distance too far back",v.mode=30;break L}if(x>>>=h,w-=h,h=i-n,W>h){if(h=W-h,h>C&&v.sane){L.Cr="invalid distance too far back",v.mode=30;break L}if(B=0,F=E,0===t){if(B+=G-h,h<U){U-=h;do{e[i++]=E[B++]}while(--h);B=i-W,F=e}}else if(t<h){if(B+=G+t-h,h-=t,h<U){U-=h;do{e[i++]=E[B++]}while(--h);if(B=0,t<U){h=t,U-=h;do{e[i++]=E[B++]}while(--h);B=i-W,F=e}}}else if(B+=t-h,h<U){U-=h;do{e[i++]=E[B++]}while(--h);B=i-W,F=e}for(;U>2;)e[i++]=F[B++],e[i++]=F[B++],e[i++]=F[B++],U-=3;U&&(e[i++]=F[B++],U>1&&(e[i++]=F[B++]))}else{B=i-W;do{e[i++]=e[B++],e[i++]=e[B++],e[i++]=e[B++],U-=3}while(U>2);U&&(e[i++]=e[B++],U>1&&(e[i++]=e[B++]))}break}}break}}while(p<J&&i<j);U=w>>3,p-=U,w-=U<<3,x&=(1<<w)-1,L.next_in=p,L.next_out=i,L.avail_in=p<J?J-p+5:5-(p-J),L.avail_out=i<j?j-i+257:257-(i-j),v.hold=x,v.bits=w}},13289:(L,r,p)=>{"use strict";const J=p(13241),i=p(13250),n=p(13294),j=p(13296),{Z_FINISH:z,Z_BLOCK:G,Z_TREES:C,Z_OK:t,Z_STREAM_END:E,Z_NEED_DICT:x,Z_STREAM_ERROR:w,Z_DATA_ERROR:g,Z_MEM_ERROR:b,Z_BUF_ERROR:c,Z_DEFLATED:P}=p(13255),O=12,h=30,U=L=>(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24);function W(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const B=L=>{if(!L||!L.state)return w;const r=L.state;return L.total_in=L.total_out=r.total=0,L.Cr="",r.wrap&&(L.adler=1&r.wrap),r.mode=1,r.last=0,r.havedict=0,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,t},F=L=>{if(!L||!L.state)return w;const r=L.state;return r.wsize=0,r.whave=0,r.wnext=0,B(L)},Q=(L,r)=>{let p;if(!L||!L.state)return w;const J=L.state;return r<0?(p=0,r=-r):(p=1+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?w:(null!==J.window&&J.wbits!==r&&(J.window=null),J.wrap=p,J.wbits=r,F(L))},e=(L,r)=>{if(!L)return w;const p=new W;L.state=p,p.window=null;const J=Q(L,r);return J!==t&&(L.state=null),J};let v,y,A=!0;const u=L=>{if(A){v=new Int32Array(512),y=new Int32Array(32);let r=0;for(;r<144;)L.lens[r++]=8;for(;r<256;)L.lens[r++]=9;for(;r<280;)L.lens[r++]=7;for(;r<288;)L.lens[r++]=8;for(j(1,L.lens,0,288,v,0,L.work,{bits:9}),r=0;r<32;)L.lens[r++]=5;j(2,L.lens,0,32,y,0,L.work,{bits:5}),A=!1}L.lencode=v,L.lenbits=9,L.distcode=y,L.distbits=5},a=(L,r,p,J)=>{let i;const n=L.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),J>=n.wsize?(n.window.set(r.subarray(p-n.wsize,p),0),n.wnext=0,n.whave=n.wsize):(i=n.wsize-n.wnext,i>J&&(i=J),n.window.set(r.subarray(p-J,p-J+i),n.wnext),(J-=i)?(n.window.set(r.subarray(p-J,p),0),n.wnext=J,n.whave=n.wsize):(n.wnext+=i,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=i))),0};L.exports.inflateReset=F,L.exports.inflateReset2=Q,L.exports.inflateResetKeep=B,L.exports.inflateInit=L=>e(L,15),L.exports.inflateInit2=e,L.exports.inflate=(L,r)=>{let p,W,B,F,Q,e,v,y,A,q,Z,X,D,l,T,Y,M,f,d,s,H,o,k=0;const R=new Uint8Array(4);let I,N;const K=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!L||!L.state||!L.output||!L.input&&0!==L.avail_in)return w;p=L.state,p.mode===O&&(p.mode=13),Q=L.next_out,B=L.output,v=L.avail_out,F=L.next_in,W=L.input,e=L.avail_in,y=p.hold,A=p.bits,q=e,Z=v,o=t;L:for(;;)switch(p.mode){case 1:if(0===p.wrap){p.mode=13;break}for(;A<16;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(2&p.wrap&&35615===y){p.check=0,R[0]=255&y,R[1]=y>>>8&255,p.check=i(p.check,R,2,0),y=0,A=0,p.mode=2;break}if(p.flags=0,p.head&&(p.head.done=!1),!(1&p.wrap)||(((255&y)<<8)+(y>>8))%31){L.Cr="incorrect header check",p.mode=h;break}if((15&y)!==P){L.Cr="unknown compression method",p.mode=h;break}if(y>>>=4,A-=4,H=8+(15&y),0===p.wbits)p.wbits=H;else if(H>p.wbits){L.Cr="invalid window size",p.mode=h;break}p.dmax=1<<p.wbits,L.adler=p.check=1,p.mode=512&y?10:O,y=0,A=0;break;case 2:for(;A<16;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(p.flags=y,(255&p.flags)!==P){L.Cr="unknown compression method",p.mode=h;break}if(57344&p.flags){L.Cr="unknown header flags set",p.mode=h;break}p.head&&(p.head.text=y>>8&1),512&p.flags&&(R[0]=255&y,R[1]=y>>>8&255,p.check=i(p.check,R,2,0)),y=0,A=0,p.mode=3;case 3:for(;A<32;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}p.head&&(p.head.time=y),512&p.flags&&(R[0]=255&y,R[1]=y>>>8&255,R[2]=y>>>16&255,R[3]=y>>>24&255,p.check=i(p.check,R,4,0)),y=0,A=0,p.mode=4;case 4:for(;A<16;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}p.head&&(p.head.xflags=255&y,p.head.os=y>>8),512&p.flags&&(R[0]=255&y,R[1]=y>>>8&255,p.check=i(p.check,R,2,0)),y=0,A=0,p.mode=5;case 5:if(1024&p.flags){for(;A<16;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}p.length=y,p.head&&(p.head.extra_len=y),512&p.flags&&(R[0]=255&y,R[1]=y>>>8&255,p.check=i(p.check,R,2,0)),y=0,A=0}else p.head&&(p.head.extra=null);p.mode=6;case 6:if(1024&p.flags&&(X=p.length,X>e&&(X=e),X&&(p.head&&(H=p.head.extra_len-p.length,p.head.extra||(p.head.extra=new Uint8Array(p.head.extra_len)),p.head.extra.set(W.subarray(F,F+X),H)),512&p.flags&&(p.check=i(p.check,W,X,F)),e-=X,F+=X,p.length-=X),p.length))break L;p.length=0,p.mode=7;case 7:if(2048&p.flags){if(0===e)break L;X=0;do{H=W[F+X++],p.head&&H&&p.length<65536&&(p.head.name+=String.fromCharCode(H))}while(H&&X<e);if(512&p.flags&&(p.check=i(p.check,W,X,F)),e-=X,F+=X,H)break L}else p.head&&(p.head.name=null);p.length=0,p.mode=8;case 8:if(4096&p.flags){if(0===e)break L;X=0;do{H=W[F+X++],p.head&&H&&p.length<65536&&(p.head.comment+=String.fromCharCode(H))}while(H&&X<e);if(512&p.flags&&(p.check=i(p.check,W,X,F)),e-=X,F+=X,H)break L}else p.head&&(p.head.comment=null);p.mode=9;case 9:if(512&p.flags){for(;A<16;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(y!==(65535&p.check)){L.Cr="header crc mismatch",p.mode=h;break}y=0,A=0}p.head&&(p.head.hcrc=p.flags>>9&1,p.head.done=!0),L.adler=p.check=0,p.mode=O;break;case 10:for(;A<32;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}L.adler=p.check=U(y),y=0,A=0,p.mode=11;case 11:if(0===p.havedict)return L.next_out=Q,L.avail_out=v,L.next_in=F,L.avail_in=e,p.hold=y,p.bits=A,x;L.adler=p.check=1,p.mode=O;case O:if(r===G||r===C)break L;case 13:if(p.last){y>>>=7&A,A-=7&A,p.mode=27;break}for(;A<3;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}switch(p.last=1&y,y>>>=1,A-=1,3&y){case 0:p.mode=14;break;case 1:if(u(p),p.mode=20,r===C){y>>>=2,A-=2;break L}break;case 2:p.mode=17;break;case 3:L.Cr="invalid block type",p.mode=h}y>>>=2,A-=2;break;case 14:for(y>>>=7&A,A-=7&A;A<32;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if((65535&y)!==(y>>>16^65535)){L.Cr="invalid stored block lengths",p.mode=h;break}if(p.length=65535&y,y=0,A=0,p.mode=15,r===C)break L;case 15:p.mode=16;case 16:if(X=p.length,X){if(X>e&&(X=e),X>v&&(X=v),0===X)break L;B.set(W.subarray(F,F+X),Q),e-=X,F+=X,v-=X,Q+=X,p.length-=X;break}p.mode=O;break;case 17:for(;A<14;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(p.nlen=257+(31&y),y>>>=5,A-=5,p.ndist=1+(31&y),y>>>=5,A-=5,p.ncode=4+(15&y),y>>>=4,A-=4,p.nlen>286||p.ndist>30){L.Cr="too many length or distance symbols",p.mode=h;break}p.have=0,p.mode=18;case 18:for(;p.have<p.ncode;){for(;A<3;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}p.lens[K[p.have++]]=7&y,y>>>=3,A-=3}for(;p.have<19;)p.lens[K[p.have++]]=0;if(p.lencode=p.lendyn,p.lenbits=7,I={bits:p.lenbits},o=j(0,p.lens,0,19,p.lencode,0,p.work,I),p.lenbits=I.bits,o){L.Cr="invalid code lengths set",p.mode=h;break}p.have=0,p.mode=19;case 19:for(;p.have<p.nlen+p.ndist;){for(;k=p.lencode[y&(1<<p.lenbits)-1],T=k>>>24,Y=k>>>16&255,M=65535&k,!(T<=A);){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(M<16)y>>>=T,A-=T,p.lens[p.have++]=M;else{if(16===M){for(N=T+2;A<N;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(y>>>=T,A-=T,0===p.have){L.Cr="invalid bit length repeat",p.mode=h;break}H=p.lens[p.have-1],X=3+(3&y),y>>>=2,A-=2}else if(17===M){for(N=T+3;A<N;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}y>>>=T,A-=T,H=0,X=3+(7&y),y>>>=3,A-=3}else{for(N=T+7;A<N;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}y>>>=T,A-=T,H=0,X=11+(127&y),y>>>=7,A-=7}if(p.have+X>p.nlen+p.ndist){L.Cr="invalid bit length repeat",p.mode=h;break}for(;X--;)p.lens[p.have++]=H}}if(p.mode===h)break;if(0===p.lens[256]){L.Cr="invalid code -- missing end-of-block",p.mode=h;break}if(p.lenbits=9,I={bits:p.lenbits},o=j(1,p.lens,0,p.nlen,p.lencode,0,p.work,I),p.lenbits=I.bits,o){L.Cr="invalid literal/lengths set",p.mode=h;break}if(p.distbits=6,p.distcode=p.distdyn,I={bits:p.distbits},o=j(2,p.lens,p.nlen,p.ndist,p.distcode,0,p.work,I),p.distbits=I.bits,o){L.Cr="invalid distances set",p.mode=h;break}if(p.mode=20,r===C)break L;case 20:p.mode=21;case 21:if(e>=6&&v>=258){L.next_out=Q,L.avail_out=v,L.next_in=F,L.avail_in=e,p.hold=y,p.bits=A,n(L,Z),Q=L.next_out,B=L.output,v=L.avail_out,F=L.next_in,W=L.input,e=L.avail_in,y=p.hold,A=p.bits,p.mode===O&&(p.back=-1);break}for(p.back=0;k=p.lencode[y&(1<<p.lenbits)-1],T=k>>>24,Y=k>>>16&255,M=65535&k,!(T<=A);){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(Y&&0===(240&Y)){for(f=T,d=Y,s=M;k=p.lencode[s+((y&(1<<f+d)-1)>>f)],T=k>>>24,Y=k>>>16&255,M=65535&k,!(f+T<=A);){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}y>>>=f,A-=f,p.back+=f}if(y>>>=T,A-=T,p.back+=T,p.length=M,0===Y){p.mode=26;break}if(32&Y){p.back=-1,p.mode=O;break}if(64&Y){L.Cr="invalid literal/length code",p.mode=h;break}p.extra=15&Y,p.mode=22;case 22:if(p.extra){for(N=p.extra;A<N;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}p.length+=y&(1<<p.extra)-1,y>>>=p.extra,A-=p.extra,p.back+=p.extra}p.was=p.length,p.mode=23;case 23:for(;k=p.distcode[y&(1<<p.distbits)-1],T=k>>>24,Y=k>>>16&255,M=65535&k,!(T<=A);){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(0===(240&Y)){for(f=T,d=Y,s=M;k=p.distcode[s+((y&(1<<f+d)-1)>>f)],T=k>>>24,Y=k>>>16&255,M=65535&k,!(f+T<=A);){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}y>>>=f,A-=f,p.back+=f}if(y>>>=T,A-=T,p.back+=T,64&Y){L.Cr="invalid distance code",p.mode=h;break}p.offset=M,p.extra=15&Y,p.mode=24;case 24:if(p.extra){for(N=p.extra;A<N;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}p.offset+=y&(1<<p.extra)-1,y>>>=p.extra,A-=p.extra,p.back+=p.extra}if(p.offset>p.dmax){L.Cr="invalid distance too far back",p.mode=h;break}p.mode=25;case 25:if(0===v)break L;if(X=Z-v,p.offset>X){if(X=p.offset-X,X>p.whave&&p.sane){L.Cr="invalid distance too far back",p.mode=h;break}X>p.wnext?(X-=p.wnext,D=p.wsize-X):D=p.wnext-X,X>p.length&&(X=p.length),l=p.window}else l=B,D=Q-p.offset,X=p.length;X>v&&(X=v),v-=X,p.length-=X;do{B[Q++]=l[D++]}while(--X);0===p.length&&(p.mode=21);break;case 26:if(0===v)break L;B[Q++]=p.length,v--,p.mode=21;break;case 27:if(p.wrap){for(;A<32;){if(0===e)break L;e--,y|=W[F++]<<A,A+=8}if(Z-=v,L.total_out+=Z,p.total+=Z,Z&&(L.adler=p.check=p.flags?i(p.check,B,Z,Q-Z):J(p.check,B,Z,Q-Z)),Z=v,(p.flags?y:U(y))!==p.check){L.Cr="incorrect data check",p.mode=h;break}y=0,A=0}p.mode=28;case 28:if(p.wrap&&p.flags){for(;A<32;){if(0===e)break L;e--,y+=W[F++]<<A,A+=8}if(y!==(4294967295&p.total)){L.Cr="incorrect length check",p.mode=h;break}y=0,A=0}p.mode=29;case 29:o=E;break L;case h:o=g;break L;case 31:return b;default:return w}return L.next_out=Q,L.avail_out=v,L.next_in=F,L.avail_in=e,p.hold=y,p.bits=A,(p.wsize||Z!==L.avail_out&&p.mode<h&&(p.mode<27||r!==z))&&a(L,L.output,L.next_out,Z-L.avail_out)?(p.mode=31,b):(q-=L.avail_in,Z-=L.avail_out,L.total_in+=q,L.total_out+=Z,p.total+=Z,p.wrap&&Z&&(L.adler=p.check=p.flags?i(p.check,B,Z,L.next_out-Z):J(p.check,B,Z,L.next_out-Z)),L.data_type=p.bits+(p.last?64:0)+(p.mode===O?128:0)+(20===p.mode||15===p.mode?256:0),(0===q&&0===Z||r===z)&&o===t&&(o=c),o)},L.exports.inflateEnd=L=>{if(!L||!L.state)return w;let r=L.state;return r.window&&(r.window=null),L.state=null,t},L.exports.inflateGetHeader=(L,r)=>{if(!L||!L.state)return w;const p=L.state;return 0===(2&p.wrap)?w:(p.head=r,r.done=!1,t)},L.exports.inflateSetDictionary=(L,r)=>{const p=r.length;let i,n,j;return L&&L.state?(i=L.state,0!==i.wrap&&11!==i.mode?w:11===i.mode&&(n=1,n=J(n,r,p,0),n!==i.check)?g:(j=a(L,r,p,p),j?(i.mode=31,b):(i.havedict=1,t))):w},L.exports.inflateInfo="pako inflate (from Nodeca project)"},13296:L=>{"use strict";const r=15,p=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),J=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),i=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),n=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);L.exports=(L,j,z,G,C,t,E,x)=>{const w=x.bits;let g,b,c,P,O,h,U=0,W=0,B=0,F=0,Q=0,e=0,v=0,y=0,A=0,u=0,a=null,q=0;const Z=new Uint16Array(16),X=new Uint16Array(16);let D,l,T,Y=null,M=0;for(U=0;U<=r;U++)Z[U]=0;for(W=0;W<G;W++)Z[j[z+W]]++;for(Q=w,F=r;F>=1&&0===Z[F];F--);if(Q>F&&(Q=F),0===F)return C[t++]=20971520,C[t++]=20971520,x.bits=1,0;for(B=1;B<F&&0===Z[B];B++);for(Q<B&&(Q=B),y=1,U=1;U<=r;U++)if(y<<=1,y-=Z[U],y<0)return-1;if(y>0&&(0===L||1!==F))return-1;for(X[1]=0,U=1;U<r;U++)X[U+1]=X[U]+Z[U];for(W=0;W<G;W++)0!==j[z+W]&&(E[X[j[z+W]]++]=W);if(0===L?(a=Y=E,h=19):1===L?(a=p,q-=257,Y=J,M-=257,h=256):(a=i,Y=n,h=-1),u=0,W=0,U=B,O=t,e=Q,v=0,c=-1,A=1<<Q,P=A-1,1===L&&A>852||2===L&&A>592)return 1;for(;;){D=U-v,E[W]<h?(l=0,T=E[W]):E[W]>h?(l=Y[M+E[W]],T=a[q+E[W]]):(l=96,T=0),g=1<<U-v,b=1<<e,B=b;do{b-=g,C[O+(u>>v)+b]=D<<24|l<<16|T}while(0!==b);for(g=1<<U-1;u&g;)g>>=1;if(0!==g?(u&=g-1,u+=g):u=0,W++,0===--Z[U]){if(U===F)break;U=j[z+E[W]]}if(U>Q&&(u&P)!==c){for(0===v&&(v=Q),O+=B,e=U-v,y=1<<e;e+v<F&&(y-=Z[e+v],!(y<=0));)e++,y<<=1;if(A+=1<<e,1===L&&A>852||2===L&&A>592)return 1;c=u&P,C[c]=Q<<24|e<<16|O-t}}return 0!==u&&(C[O+u]=U-v<<24|64<<16),x.bits=Q,0}},13252:L=>{"use strict";L.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13239:L=>{"use strict";function r(L){let r=L.length;for(;--r>=0;)L[r]=0}const p=256,J=286,i=30,n=15,j=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),z=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),G=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Array(576);r(t);const E=new Array(60);r(E);const x=new Array(512);r(x);const w=new Array(256);r(w);const g=new Array(29);r(g);const b=new Array(i);function c(L,r,p,J,i){this.static_tree=L,this.extra_bits=r,this.extra_base=p,this.elems=J,this.max_length=i,this.has_stree=L&&L.length}let P,O,h;function U(L,r){this.dyn_tree=L,this.max_code=0,this.stat_desc=r}r(b);const W=L=>L<256?x[L]:x[256+(L>>>7)],B=(L,r)=>{L.pending_buf[L.pending++]=255&r,L.pending_buf[L.pending++]=r>>>8&255},F=(L,r,p)=>{L.bi_valid>16-p?(L.bi_buf|=r<<L.bi_valid&65535,B(L,L.bi_buf),L.bi_buf=r>>16-L.bi_valid,L.bi_valid+=p-16):(L.bi_buf|=r<<L.bi_valid&65535,L.bi_valid+=p)},Q=(L,r,p)=>{F(L,p[2*r],p[2*r+1])},e=(L,r)=>{let p=0;do{p|=1&L,L>>>=1,p<<=1}while(--r>0);return p>>>1},v=(L,r,p)=>{const J=new Array(16);let i,j,z=0;for(i=1;i<=n;i++)J[i]=z=z+p[i-1]<<1;for(j=0;j<=r;j++){let r=L[2*j+1];0!==r&&(L[2*j]=e(J[r]++,r))}},y=L=>{let r;for(r=0;r<J;r++)L.dyn_ltree[2*r]=0;for(r=0;r<i;r++)L.dyn_dtree[2*r]=0;for(r=0;r<19;r++)L.bl_tree[2*r]=0;L.dyn_ltree[512]=1,L.opt_len=L.static_len=0,L.last_lit=L.matches=0},A=L=>{L.bi_valid>8?B(L,L.bi_buf):L.bi_valid>0&&(L.pending_buf[L.pending++]=L.bi_buf),L.bi_buf=0,L.bi_valid=0},u=(L,r,p,J)=>{const i=2*r,n=2*p;return L[i]<L[n]||L[i]===L[n]&&J[r]<=J[p]},a=(L,r,p)=>{const J=L.heap[p];let i=p<<1;for(;i<=L.heap_len&&(i<L.heap_len&&u(r,L.heap[i+1],L.heap[i],L.depth)&&i++,!u(r,J,L.heap[i],L.depth));)L.heap[p]=L.heap[i],p=i,i<<=1;L.heap[p]=J},q=(L,r,J)=>{let i,n,G,C,t=0;if(0!==L.last_lit)do{i=L.pending_buf[L.d_buf+2*t]<<8|L.pending_buf[L.d_buf+2*t+1],n=L.pending_buf[L.l_buf+t],t++,0===i?Q(L,n,r):(G=w[n],Q(L,G+p+1,r),C=j[G],0!==C&&(n-=g[G],F(L,n,C)),i--,G=W(i),Q(L,G,J),C=z[G],0!==C&&(i-=b[G],F(L,i,C)))}while(t<L.last_lit);Q(L,256,r)},Z=(L,r)=>{const p=r.dyn_tree,J=r.stat_desc.static_tree,i=r.stat_desc.has_stree,j=r.stat_desc.elems;let z,G,C,t=-1;for(L.heap_len=0,L.heap_max=573,z=0;z<j;z++)0!==p[2*z]?(L.heap[++L.heap_len]=t=z,L.depth[z]=0):p[2*z+1]=0;for(;L.heap_len<2;)C=L.heap[++L.heap_len]=t<2?++t:0,p[2*C]=1,L.depth[C]=0,L.opt_len--,i&&(L.static_len-=J[2*C+1]);for(r.max_code=t,z=L.heap_len>>1;z>=1;z--)a(L,p,z);C=j;do{z=L.heap[1],L.heap[1]=L.heap[L.heap_len--],a(L,p,1),G=L.heap[1],L.heap[--L.heap_max]=z,L.heap[--L.heap_max]=G,p[2*C]=p[2*z]+p[2*G],L.depth[C]=(L.depth[z]>=L.depth[G]?L.depth[z]:L.depth[G])+1,p[2*z+1]=p[2*G+1]=C,L.heap[1]=C++,a(L,p,1)}while(L.heap_len>=2);L.heap[--L.heap_max]=L.heap[1],((L,r)=>{const p=r.dyn_tree,J=r.max_code,i=r.stat_desc.static_tree,j=r.stat_desc.has_stree,z=r.stat_desc.extra_bits,G=r.stat_desc.extra_base,C=r.stat_desc.max_length;let t,E,x,w,g,b,c=0;for(w=0;w<=n;w++)L.bl_count[w]=0;for(p[2*L.heap[L.heap_max]+1]=0,t=L.heap_max+1;t<573;t++)E=L.heap[t],w=p[2*p[2*E+1]+1]+1,w>C&&(w=C,c++),p[2*E+1]=w,E>J||(L.bl_count[w]++,g=0,E>=G&&(g=z[E-G]),b=p[2*E],L.opt_len+=b*(w+g),j&&(L.static_len+=b*(i[2*E+1]+g)));if(0!==c){do{for(w=C-1;0===L.bl_count[w];)w--;L.bl_count[w]--,L.bl_count[w+1]+=2,L.bl_count[C]--,c-=2}while(c>0);for(w=C;0!==w;w--)for(E=L.bl_count[w];0!==E;)x=L.heap[--t],x>J||(p[2*x+1]!==w&&(L.opt_len+=(w-p[2*x+1])*p[2*x],p[2*x+1]=w),E--)}})(L,r),v(p,t,L.bl_count)},X=(L,r,p)=>{let J,i,n=-1,j=r[1],z=0,G=7,C=4;for(0===j&&(G=138,C=3),r[2*(p+1)+1]=65535,J=0;J<=p;J++)i=j,j=r[2*(J+1)+1],++z<G&&i===j||(z<C?L.bl_tree[2*i]+=z:0!==i?(i!==n&&L.bl_tree[2*i]++,L.bl_tree[32]++):z<=10?L.bl_tree[34]++:L.bl_tree[36]++,z=0,n=i,0===j?(G=138,C=3):i===j?(G=6,C=3):(G=7,C=4))},D=(L,r,p)=>{let J,i,n=-1,j=r[1],z=0,G=7,C=4;for(0===j&&(G=138,C=3),J=0;J<=p;J++)if(i=j,j=r[2*(J+1)+1],!(++z<G&&i===j)){if(z<C)do{Q(L,i,L.bl_tree)}while(0!==--z);else 0!==i?(i!==n&&(Q(L,i,L.bl_tree),z--),Q(L,16,L.bl_tree),F(L,z-3,2)):z<=10?(Q(L,17,L.bl_tree),F(L,z-3,3)):(Q(L,18,L.bl_tree),F(L,z-11,7));z=0,n=i,0===j?(G=138,C=3):i===j?(G=6,C=3):(G=7,C=4)}};let l=!1;const T=(L,r,p,J)=>{F(L,0+(J?1:0),3),((L,r,p,J)=>{A(L),J&&(B(L,p),B(L,~p)),L.pending_buf.set(L.window.subarray(r,r+p),L.pending),L.pending+=p})(L,r,p,!0)};L.exports._tr_init=L=>{l||((()=>{let L,r,p,C,U;const W=new Array(16);for(p=0,C=0;C<28;C++)for(g[C]=p,L=0;L<1<<j[C];L++)w[p++]=C;for(w[p-1]=C,U=0,C=0;C<16;C++)for(b[C]=U,L=0;L<1<<z[C];L++)x[U++]=C;for(U>>=7;C<i;C++)for(b[C]=U<<7,L=0;L<1<<z[C]-7;L++)x[256+U++]=C;for(r=0;r<=n;r++)W[r]=0;for(L=0;L<=143;)t[2*L+1]=8,L++,W[8]++;for(;L<=255;)t[2*L+1]=9,L++,W[9]++;for(;L<=279;)t[2*L+1]=7,L++,W[7]++;for(;L<=287;)t[2*L+1]=8,L++,W[8]++;for(v(t,287,W),L=0;L<i;L++)E[2*L+1]=5,E[2*L]=e(L,5);P=new c(t,j,257,J,n),O=new c(E,z,0,i,n),h=new c(new Array(0),G,0,19,7)})(),l=!0),L.l_desc=new U(L.dyn_ltree,P),L.d_desc=new U(L.dyn_dtree,O),L.bl_desc=new U(L.bl_tree,h),L.bi_buf=0,L.bi_valid=0,y(L)},L.exports._tr_stored_block=T,L.exports._tr_flush_block=(L,r,J,i)=>{let n,j,z=0;L.level>0?(2===L.strm.data_type&&(L.strm.data_type=(L=>{let r,J=4093624447;for(r=0;r<=31;r++,J>>>=1)if(1&J&&0!==L.dyn_ltree[2*r])return 0;if(0!==L.dyn_ltree[18]||0!==L.dyn_ltree[20]||0!==L.dyn_ltree[26])return 1;for(r=32;r<p;r++)if(0!==L.dyn_ltree[2*r])return 1;return 0})(L)),Z(L,L.l_desc),Z(L,L.d_desc),z=(L=>{let r;for(X(L,L.dyn_ltree,L.l_desc.max_code),X(L,L.dyn_dtree,L.d_desc.max_code),Z(L,L.bl_desc),r=18;r>=3&&0===L.bl_tree[2*C[r]+1];r--);return L.opt_len+=3*(r+1)+5+5+4,r})(L),n=L.opt_len+3+7>>>3,j=L.static_len+3+7>>>3,j<=n&&(n=j)):n=j=J+5,J+4<=n&&-1!==r?T(L,r,J,i):4===L.strategy||j===n?(F(L,2+(i?1:0),3),q(L,t,E)):(F(L,4+(i?1:0),3),((L,r,p,J)=>{let i;for(F(L,r-257,5),F(L,p-1,5),F(L,J-4,4),i=0;i<J;i++)F(L,L.bl_tree[2*C[i]+1],3);D(L,L.dyn_ltree,r-1),D(L,L.dyn_dtree,p-1)})(L,L.l_desc.max_code+1,L.d_desc.max_code+1,z+1),q(L,L.dyn_ltree,L.dyn_dtree)),y(L),i&&A(L)},L.exports._tr_tally=(L,r,J)=>(L.pending_buf[L.d_buf+2*L.last_lit]=r>>>8&255,L.pending_buf[L.d_buf+2*L.last_lit+1]=255&r,L.pending_buf[L.l_buf+L.last_lit]=255&J,L.last_lit++,0===r?L.dyn_ltree[2*J]++:(L.matches++,r--,L.dyn_ltree[2*(w[J]+p+1)]++,L.dyn_dtree[2*W(r)]++),L.last_lit===L.lit_bufsize-1),L.exports._tr_align=L=>{F(L,2,3),Q(L,256,t),(L=>{16===L.bi_valid?(B(L,L.bi_buf),L.bi_buf=0,L.bi_valid=0):L.bi_valid>=8&&(L.pending_buf[L.pending++]=255&L.bi_buf,L.bi_buf>>=8,L.bi_valid-=8)})(L)}},13277:L=>{"use strict";L.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Cr="",this.state=null,this.data_type=2,this.adler=0}},12916:L=>{function r(L,r,p){for(var J=L.length,i=-1/0,n=1/0,j=0;j<J;j++){var z=(p[0][j]-L[j])/r[j],G=(p[1][j]-L[j])/r[j];if(z>G){var C=z;z=G,G=C}if(G<i||z>n)return 1/0;z>i&&(i=z),G<n&&(n=G)}return i>n?1/0:i}L.exports=function(L,p,J,i){var n=r(p,J,i);if(n===1/0)L=null;else{L=L||[];for(var j=0;j<p.length;j++)L[j]=p[j]+J[j]*n}return L},L.exports.distance=r},14307:(L,r,p)=>{"use strict";p.d(r,{c:()=>j});var J=p(32);const i=J.useLayoutEffect;const n=function(L){var r=(0,J.useRef)(L);return i((function(){r.current=L})),r};var j=function(L){var r=n(L);(0,J.jr)((function(){var L=function(L){var p;if(null!=r.current&&(p=r.current(L)),L.defaultPrevented&&(L.returnValue=""),"string"===typeof p)return L.returnValue=p,p};return window.addEventListener("beforeunload",L),function(){window.removeEventListener("beforeunload",L)}}),[])}},14267:(L,r,p)=>{"use strict";var J=p(14271),i=Array.prototype.concat,n=Array.prototype.slice,j=L.exports=function(L){for(var r=[],p=0,j=L.length;p<j;p++){var z=L[p];J(z)?r=i.call(r,n.call(z)):r.push(z)}return r};j.wrap=function(L){return function(){return L(j(arguments))}}},14271:L=>{L.exports=function(L){return!(!L||"string"===typeof L)&&(L instanceof Array||Array.isArray(L)||L.length>=0&&(L.splice instanceof Function||Object.getOwnPropertyDescriptor(L,L.length-1)&&"String"!==L.constructor.name))}},13184:(L,r,p)=>{var J=p(13193);function i(L){for(var r,p,i=0,n=L.length,j=0;j<L.length;){for(r=L[j],p=0;j<n&&L[j]===r;)++j,++p;i+=J.log2(p)/7|0,i+=J.log2(r>>>0)/7|0,i+=2}return i}r.size=i,r.encode=function(L,r){r||(r=new Uint8Array(i(L)));for(var p,J,n=0,j=r.length,z=0;z<L.length;){for(p=L[z],J=0;z<L.length&&L[z]===p;)++z,++J;for(;n<j&&J>=128;)r[n++]=128+(127&J),J>>>=7;if(n>=j)throw new Error("RLE buffer overflow");for(r[n++]=J,p>>>=0;n<j&&p>=128;)r[n++]=128+(127&p),p>>>=7;if(n>=j)throw new Error("RLE buffer overflow");r[n++]=p}return r},r.decode=function(L,r){for(var p,J,i,n,j=r.length,z=L.length,G=0,C=0;C<z;){for(p=0,J=0;C<z&&L[C]>=128;)p+=(127&L[C++])<<J,J+=7;if(p+=L[C++]<<J,C>=z)throw new Error("RLE buffer underrun");if(G+p>j)throw new Error("Chunk buffer overflow");for(i=0,J=0;C<z&&L[C]>=128;)i+=(127&L[C++])<<J,J+=7;if(C>=z)throw new Error("RLE buffer underrun");for(i+=L[C++]<<J,n=0;n<p;++n)r[G++]=i}return r}},13193:(L,r)=>{"use strict";function p(L){var r=32;return(L&=-L)&&r--,65535&L&&(r-=16),16711935&L&&(r-=8),252645135&L&&(r-=4),858993459&L&&(r-=2),1431655765&L&&(r-=1),r}r.INT_BITS=32,r.INT_MAX=2147483647,r.INT_MIN=-1<<31,r.sign=function(L){return(L>0)-(L<0)},r.abs=function(L){var r=L>>31;return(L^r)-r},r.min=function(L,r){return r^(L^r)&-(L<r)},r.max=function(L,r){return L^(L^r)&-(L<r)},r.isPow2=function(L){return!(L&L-1)&&!!L},r.log2=function(L){var r,p;return r=(L>65535)<<4,r|=p=((L>>>=r)>255)<<3,r|=p=((L>>>=p)>15)<<2,(r|=p=((L>>>=p)>3)<<1)|(L>>>=p)>>1},r.log10=function(L){return L>=1e9?9:L>=1e8?8:L>=1e7?7:L>=1e6?6:L>=1e5?5:L>=1e4?4:L>=1e3?3:L>=100?2:L>=10?1:0},r.popCount=function(L){return 16843009*((L=(858993459&(L-=L>>>1&1431655765))+(L>>>2&858993459))+(L>>>4)&252645135)>>>24},r.countTrailingZeros=p,r.nextPow2=function(L){return L+=0===L,--L,L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)+1},r.prevPow2=function(L){return L|=L>>>1,L|=L>>>2,L|=L>>>4,L|=L>>>8,(L|=L>>>16)-(L>>>1)},r.parity=function(L){return L^=L>>>16,L^=L>>>8,L^=L>>>4,27030>>>(L&=15)&1};var J=new Array(256);!function(L){for(var r=0;r<256;++r){var p=r,J=r,i=7;for(p>>>=1;p;p>>>=1)J<<=1,J|=1&p,--i;L[r]=J<<i&255}}(J),r.reverse=function(L){return J[255&L]<<24|J[L>>>8&255]<<16|J[L>>>16&255]<<8|J[L>>>24&255]},r.interleave2=function(L,r){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L&=65535)|L<<8))|L<<4))|L<<2))|L<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r&=65535)|r<<8))|r<<4))|r<<2))|r<<1))<<1},r.deinterleave2=function(L,r){return(L=65535&((L=16711935&((L=252645135&((L=858993459&((L=L>>>r&1431655765)|L>>>1))|L>>>2))|L>>>4))|L>>>16))<<16>>16},r.interleave3=function(L,r,p){return L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2),(L|=(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<1)|(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<2},r.deinterleave3=function(L,r){return(L=1023&((L=4278190335&((L=251719695&((L=3272356035&((L=L>>>r&1227133513)|L>>>2))|L>>>4))|L>>>8))|L>>>16))<<22>>22},r.nextCombination=function(L){var r=L|L-1;return r+1|(~r&-~r)-1>>>p(L)+1}},13215:L=>{"use strict";L.exports=function(L,r,p,J){var i=self||window;try{try{var n;try{n=new i.Blob([L])}catch(C){(n=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(L),n=n.getBlob()}var j=i.URL||i.webkitURL,z=j.createObjectURL(n),G=new i[r](z,p);return j.revokeObjectURL(z),G}catch(C){return new i[r]("data:application/javascript,".concat(encodeURIComponent(L)),p)}}catch(C){if(!J)throw Error("Inline worker is not supported");return new i[r](J,p)}}},12908:(L,r,p)=>{"use strict";function J(L,r,p,J,i){var n={};return Object.keys(J).forEach((function(L){n[L]=J[L]})),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=p.slice().reverse().reduce((function(p,J){return J(L,r,p)||p}),n),i&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(i):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(L,r,n),n=null),n}p.d(r,{c:()=>J})},12905:(L,r,p)=>{"use strict";function J(L,r,p,J){p&&Object.defineProperty(L,r,{enumerable:p.enumerable,configurable:p.configurable,writable:p.writable,value:p.initializer?p.initializer.call(J):void 0})}p.d(r,{c:()=>J})},14297:(L,r,p)=>{"use strict";p.d(r,{c:()=>j,e:()=>E,i:()=>z,m:()=>n,n:()=>G,q:()=>i,r:()=>C,t:()=>t});var J=p(12319);class i{constructor(){this._easingMode=i.EASINGMODE_EASEIN}setEasingMode(L){const r=Math.min(Math.max(L,0),2);this._easingMode=r}getEasingMode(){return this._easingMode}easeInCore(L){throw new Error("You must implement this method")}ease(L){switch(this._easingMode){case i.EASINGMODE_EASEIN:return this.easeInCore(L);case i.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-L)}return L>=.5?.5*(1-this.easeInCore(2*(1-L)))+.5:.5*this.easeInCore(2*L)}}i.EASINGMODE_EASEIN=0,i.EASINGMODE_EASEOUT=1,i.EASINGMODE_EASEINOUT=2;class n extends i{easeInCore(L){return L=Math.max(0,Math.min(1,L)),1-Math.sqrt(1-L*L)}}class j extends i{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=L}easeInCore(L){const r=Math.max(0,this.amplitude);return Math.pow(L,3)-L*r*Math.sin(3.141592653589793*L)}}class z extends i{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=L,this.bounciness=r}easeInCore(L){const r=Math.max(0,this.bounces);let p=this.bounciness;p<=1&&(p=1.001);const J=Math.pow(p,r),i=1-p,n=(1-J)/i+.5*J,j=L*n,z=Math.log(-j*(1-p)+1)/Math.log(p),G=Math.floor(z),C=G+1,t=(1-Math.pow(p,G))/(i*n),E=.5*(t+(1-Math.pow(p,C))/(i*n)),x=L-E,w=E-t;return-Math.pow(1/p,r-G)/(w*w)*(x-w)*(x+w)}}class G extends i{easeInCore(L){return L*L*L}}class C extends i{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=L,this.springiness=r}easeInCore(L){let r;const p=Math.max(0,this.oscillations),J=Math.max(0,this.springiness);return r=0==J?L:(Math.exp(J*L)-1)/(Math.exp(J)-1),r*Math.sin((6.283185307179586*p+1.5707963267948966)*L)}}class t extends i{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=L}easeInCore(L){return this.exponent<=0?L:(Math.exp(this.exponent*L)-1)/(Math.exp(this.exponent)-1)}}class E extends i{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=L,this.y1=r,this.x2=p,this.y2=J}easeInCore(L){return J.c.Interpolate(L,this.x1,this.y1,this.x2,this.y2)}}},13777:(L,r,p)=>{"use strict";p.d(r,{e:()=>j});var J=p(12136),i=p(12149),n=p(12543);class j extends n.d{get _matrix(){return this._compose(),this.vx}set _matrix(L){(L.updateFlag!==this.vx.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.vx.G(L),this._markAsDirtyAndDecompose())}constructor(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(L,r.FL(),!1),this.name=L,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=r,this.vx=(null===i||void 0===i?void 0:i.clone())??J.Matrix.Identity(),this._restMatrix=n??this.vx.clone(),this._bindMatrix=j??this.vx.clone(),this._index=z,this._absoluteMatrix=new J.Matrix,this._absoluteBindMatrix=new J.Matrix,this._absoluteInverseBindMatrix=new J.Matrix,this._finalMatrix=new J.Matrix,r.bones.push(this),this.setParent(p,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(L){this.setParent(L)}setParent(L){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==L){if(this.parent){const L=this.parent.children.indexOf(this);-1!==L&&this.parent.children.splice(L,1)}this._parentNode=L,this.parent&&this.parent.children.push(this),r&&this._updateAbsoluteBindMatrices(),this.HC()}}getLocalMatrix(){return this._compose(),this.vx}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(L){this._restMatrix.G(L)}setRestPose(L){this.setRestMatrix(L)}getBindPose(){return this.getBindMatrix()}setBindMatrix(L){this.tz(L)}setBindPose(L){this.setBindMatrix(L)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const L=J.TmpVectors.cr[0],r=J.TmpVectors.Quaternion[0],p=J.TmpVectors.cr[1];this.getRestMatrix().decompose(L,r,p),this._linkedTransformNode.position.G(p),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??J.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.G(r),this._linkedTransformNode.Wz.G(L)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(L){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=L,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Iz}set position(L){this._decompose(),this.Iz.G(L),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(L){this.setRotation(L)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(L){this.setRotationQuaternion(L)}get Wz(){return this.getScale()}set Wz(L){this.setScale(L)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=J.cr.Zero(),this._localRotation=J.Quaternion.Zero(),this.Iz=J.cr.Zero()),this.vx.decompose(this._localScaling,this._localRotation,this.Iz))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,J.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Iz,this.vx)):this._needToCompose=!1)}tz(L){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.G(L),r&&this._updateAbsoluteBindMatrices(),p?this._matrix=L:this.HC()}_updateAbsoluteBindMatrices(L){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(L||(L=this._bindMatrix),this.parent?L.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.G(L),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),r)for(let p=0;p<this.children.length;p++)this.children[p]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}HC(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.HC(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.HC(),this._needToDecompose=!0}_updatePosition(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=this.getLocalMatrix();if(0==r)i?(n.addAtIndex(12,L.x),n.addAtIndex(13,L.y),n.addAtIndex(14,L.z)):n.setTranslationFromFloats(L.x,L.y,L.z);else{let r=null;p&&(r=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=j._TmpMats[0],G=j._TmpVecs[0];this.parent?p&&r?(z.G(this.parent.getAbsoluteMatrix()),z.multiplyToRef(r,z)):z.G(this.parent.getAbsoluteMatrix()):J.Matrix.IdentityToRef(z),i&&z.setTranslationFromFloats(0,0,0),z.invert(),J.cr.TransformCoordinatesToRef(L,z,G),i?(n.addAtIndex(12,G.x),n.addAtIndex(13,G.y),n.addAtIndex(14,G.z)):n.setTranslationFromFloats(G.x,G.y,G.z)}this._markAsDirtyAndDecompose()}translate(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;this._updatePosition(L,r,p,!0)}setPosition(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;this._updatePosition(L,r,p,!1)}setAbsolutePosition(L,r){this.setPosition(L,1,r)}scale(L,r,p){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=this.getLocalMatrix(),z=j._TmpMats[0];J.Matrix.ScalingToRef(L,r,p,z),z.multiplyToRef(n,n),z.invert();for(const J of this.children){const i=J.getLocalMatrix();i.multiplyToRef(z,i),i.multiplyAtIndex(12,L),i.multiplyAtIndex(13,r),i.multiplyAtIndex(14,p),J._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),i)for(const J of this.children)J.scale(L,r,p,i)}setScale(L){this._decompose(),this._localScaling.G(L),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(L){this._decompose(),L.G(this._localScaling)}setYawPitchRoll(L,r,p){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;if(0===i){const z=j._TmpQuat;return J.Quaternion.RotationYawPitchRollToRef(L,r,p,z),void this.setRotationQuaternion(z,i,n)}const z=j._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,n))return;const G=j._TmpMats[1];J.Matrix.RotationYawPitchRollToRef(L,r,p,G),z.multiplyToRef(G,G),this._rotateWithMatrix(G,i,n)}rotate(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const n=j._TmpMats[0];n.setTranslationFromFloats(0,0,0),J.Matrix.RotationAxisToRef(L,r,n),this._rotateWithMatrix(n,p,i)}setAxisAngle(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;if(0===p){const n=j._TmpQuat;return J.Quaternion.RotationAxisToRef(L,r,n),void this.setRotationQuaternion(n,p,i)}const n=j._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,i))return;const z=j._TmpMats[1];J.Matrix.RotationAxisToRef(L,r,z),n.multiplyToRef(z,z),this._rotateWithMatrix(z,p,i)}setRotation(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(L.y,L.x,L.z,r,p)}setRotationQuaternion(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;if(0===r)return this._decompose(),this._localRotation.G(L),void this._markAsDirtyAndCompose();const i=j._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,p))return;const n=j._TmpMats[1];J.Matrix.FromQuaternionToRef(L,n),i.multiplyToRef(n,n),this._rotateWithMatrix(n,r,p)}setRotationMatrix(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;if(0===r){const i=j._TmpQuat;return J.Quaternion.FromRotationMatrixToRef(L,i),void this.setRotationQuaternion(i,r,p)}const i=j._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,p))return;const n=j._TmpMats[1];n.G(L),i.multiplyToRef(L,n),this._rotateWithMatrix(n,r,p)}_rotateWithMatrix(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;const J=this.getLocalMatrix(),i=J.m[12],n=J.m[13],z=J.m[14],G=this.getParent(),C=j._TmpMats[3],t=j._TmpMats[4];G&&1==r?(p?(C.G(p.getWorldMatrix()),G.getAbsoluteMatrix().multiplyToRef(C,C)):C.G(G.getAbsoluteMatrix()),t.G(C),t.invert(),J.multiplyToRef(C,J),J.multiplyToRef(L,J),J.multiplyToRef(t,J)):1==r&&p?(C.G(p.getWorldMatrix()),t.G(C),t.invert(),J.multiplyToRef(C,J),J.multiplyToRef(L,J),J.multiplyToRef(t,J)):J.multiplyToRef(L,J),J.setTranslationFromFloats(i,n,z),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(L,r){const p=j._TmpMats[2];return L.G(this.getAbsoluteMatrix()),r?(L.multiplyToRef(r.getWorldMatrix(),L),J.Matrix.ScalingToRef(r.Wz.x,r.Wz.y,r.Wz.z,p)):J.Matrix.IdentityToRef(p),L.invert(),!isNaN(L.m[0])&&(p.multiplyAtIndex(0,this._scalingDeterminant),L.multiplyToRef(p,L),!0)}ip(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=J.cr.Zero();return this.getPositionToRef(L,r,p),p}getPositionToRef(){let L=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const L=this.getLocalMatrix();r.x=L.m[12],r.y=L.m[13],r.z=L.m[14]}else{let p=null;L&&(p=L.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let J=j._TmpMats[0];L&&p?(J.G(this.getAbsoluteMatrix()),J.multiplyToRef(p,J)):J=this.getAbsoluteMatrix(),r.x=J.m[12],r.y=J.m[13],r.z=J.m[14]}}getAbsolutePosition(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const r=J.cr.Zero();return this.getPositionToRef(1,L,r),r}getAbsolutePositionToRef(L,r){this.getPositionToRef(1,L,r)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.vx.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.G(this.vx);const L=this._skeleton.getPoseMatrix();L&&this._absoluteMatrix.multiplyToRef(L,this._absoluteMatrix)}const L=this.children,r=L.length;for(let p=0;p<r;p++)L[p].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}WG(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=J.cr.Zero();return this.getDirectionToRef(L,r,p),p}getDirectionToRef(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,i=null;r&&(i=r.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=j._TmpMats[0];n.G(this.getAbsoluteMatrix()),r&&i&&n.multiplyToRef(i,n),J.cr.TransformNormalToRef(L,n,p),p.normalize()}getRotation(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=J.cr.Zero();return this.getRotationToRef(L,r,p),p}getRotationToRef(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;const J=j._TmpQuat;this.getRotationQuaternionToRef(L,r,J),J.toEulerAnglesToRef(p)}getRotationQuaternion(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=J.Quaternion.Identity();return this.getRotationQuaternionToRef(L,r,p),p}getRotationQuaternionToRef(){let L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),r.G(this._localRotation);else{const p=j._TmpMats[0],J=this.getAbsoluteMatrix();L?J.multiplyToRef(L.getWorldMatrix(),p):p.G(J),p.multiplyAtIndex(0,this._scalingDeterminant),p.multiplyAtIndex(1,this._scalingDeterminant),p.multiplyAtIndex(2,this._scalingDeterminant),p.decompose(void 0,r,void 0)}}getRotationMatrix(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1?arguments[1]:void 0;const p=J.Matrix.Identity();return this.getRotationMatrixToRef(L,r,p),p}getRotationMatrixToRef(){let L=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(r);else{const p=j._TmpMats[0],J=this.getAbsoluteMatrix();L?J.multiplyToRef(L.getWorldMatrix(),p):p.G(J),p.multiplyAtIndex(0,this._scalingDeterminant),p.multiplyAtIndex(1,this._scalingDeterminant),p.multiplyAtIndex(2,this._scalingDeterminant),p.getRotationMatrixToRef(r)}}getAbsolutePositionFromLocal(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=J.cr.Zero();return this.getAbsolutePositionFromLocalToRef(L,r,p),p}getAbsolutePositionFromLocalToRef(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,i=null;r&&(i=r.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=j._TmpMats[0];n.G(this.getAbsoluteMatrix()),r&&i&&n.multiplyToRef(i,n),J.cr.TransformCoordinatesToRef(L,n,p)}getLocalPositionFromAbsolute(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=J.cr.Zero();return this.getLocalPositionFromAbsoluteToRef(L,r,p),p}getLocalPositionFromAbsoluteToRef(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,i=null;r&&(i=r.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=j._TmpMats[0];n.G(this.getAbsoluteMatrix()),r&&i&&n.multiplyToRef(i,n),n.invert(),J.cr.TransformCoordinatesToRef(L,n,p)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const L=this._skeleton.bones.indexOf(this);if(-1!==L&&this._skeleton.bones.splice(L,1),this._parentNode&&this._parentNode.children){const L=this._parentNode.children,r=L.indexOf(this);-1!==r&&L.splice(r,1)}super.dispose()}}j._TmpVecs=(0,i.e)(2,J.cr.Zero),j._TmpQuat=J.Quaternion.Identity(),j._TmpMats=(0,i.e)(5,J.Matrix.Identity)},14293:(L,r,p)=>{"use strict";p.d(r,{c:()=>Z});var J=p(12113),i=p(12122),n=p(11964),j=p(12136),z=p(12154),G=p(12543),C=p(12575),t=p(12398),E=p(11988),x=p(12140);class w{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(L){this._zoomStopsAnimation=L}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(L){this._idleRotationSpeed=L}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(L){this._idleRotationWaitTime=L}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(L){this._idleRotationSpinupTime=L}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(L){this._attachedCamera=L;const r=this._attachedCamera.FL();this._onPrePointerObservableObserver=r.onPrePointerObservable.add((L=>{L.type!==t.b.POINTERDOWN?L.type===t.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const L=E.d.Now;let r=0;null!=this._lastFrameTime&&(r=L-this._lastFrameTime),this._lastFrameTime=L,this._applyUserInteraction();const p=L-this._lastInteractionTime-this._idleRotationWaitTime,J=Math.max(Math.min(p/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*J,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(r/1e3))}))}detach(){if(!this._attachedCamera)return;const L=this._attachedCamera.FL();this._onPrePointerObservableObserver&&L.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(L){this._lastInteractionTime=L??E.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<x.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let L=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(L=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?L:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=E.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var g=p(14297),b=p(12642);class c{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(L){if(this._autoTransitionRange===L)return;this._autoTransitionRange=L;const r=this._attachedCamera;r&&(L?this._onMeshTargetChangedObserver=r.onMeshTargetChangedObservable.add((L=>{if(L&&(L.cz(!0),L.getBoundingInfo)){const r=L.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*r,this.upperRadiusTransitionRange=.05*r}})):this._onMeshTargetChangedObserver&&r.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(L){this._attachedCamera=L,this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(L){return!!this._attachedCamera&&(this._attachedCamera.radius===L&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(L){if(!this._attachedCamera)return;this._radiusBounceTransition||(c.EasingFunction.setEasingMode(c.EasingMode),this._radiusBounceTransition=b.c.CreateAnimation("radius",b.c.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const r=b.c.TransitionTo("radius",this._attachedCamera.radius+L,this._attachedCamera,this._attachedCamera.FL(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));r&&this._animatables.push(r)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}c.EasingFunction=new g.c(.3),c.EasingMode=g.q.EASINGMODE_EASEOUT;class P{constructor(){this.onTargetFramingAnimationEndObservable=new n.c,this._mode=P.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(L){this._mode=L}get mode(){return this._mode}set radiusScale(L){this._radiusScale=L}get radiusScale(){return this._radiusScale}set positionScale(L){this._positionScale=L}get positionScale(){return this._positionScale}set defaultElevation(L){this._defaultElevation=L}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(L){this._elevationReturnTime=L}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(L){this._elevationReturnWaitTime=L}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(L){this._zoomStopsAnimation=L}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(L){this._framingTime=L}get framingTime(){return this._framingTime}init(){}attach(L){this._attachedCamera=L;const r=this._attachedCamera.FL();P.EasingFunction.setEasingMode(P.EasingMode),this._onPrePointerObservableObserver=r.onPrePointerObservable.add((L=>{L.type!==t.b.POINTERDOWN?L.type===t.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=L.onMeshTargetChangedObservable.add((L=>{L&&L.getBoundingInfo&&this.zoomOnMesh(L,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=L.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const L=this._attachedCamera.FL();this._onPrePointerObservableObserver&&L.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L.cz(!0);const J=L.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(J.minimumWorld,J.maximumWorld,r,p)}zoomOnMeshHierarchy(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L.cz(!0);const J=L.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(J.min,J.max,r,p)}zoomOnMeshesHierarchy(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new j.cr(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new j.cr(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let n=0;n<L.length;n++){const r=L[n].getHierarchyBoundingVectors(!0);j.cr.CheckExtends(r.min,J,i),j.cr.CheckExtends(r.max,J,i)}this.zoomOnBoundingInfo(J,i,r,p)}zoomOnBoundingInfo(L,r){let p,J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const n=L.y,z=n+(r.y-n)*this._positionScale,G=r.Pr(L).scale(.5);if(!isFinite(z))return!1;if(J)p=new j.cr(0,z,0);else{const r=L.add(G);p=new j.cr(r.x,z,r.z)}this._vectorTransition||(this._vectorTransition=b.c.CreateAnimation("target",b.c.ANIMATIONTYPE_VECTOR3,60,P.EasingFunction)),this._betaIsAnimating=!0;let C=b.c.TransitionTo("target",p,this._attachedCamera,this._attachedCamera.FL(),60,this._vectorTransition,this._framingTime);C&&this._animatables.push(C);let t=0;if(this._mode===P.FitFrustumSidesMode){const p=this._calculateLowerRadiusFromModelBoundingSphere(L,r);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=G.length()+this._attachedCamera.nz),t=p}else this._mode===P.IgnoreBoundsSizeMode&&(t=this._calculateLowerRadiusFromModelBoundingSphere(L,r),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.nz));if(this.autoCorrectCameraLimitsAndSensibility){const p=r.Pr(L).length();this._attachedCamera.panningSensibility=5e3/p,this._attachedCamera.wheelPrecision=100/t}return this._radiusTransition||(this._radiusTransition=b.c.CreateAnimation("radius",b.c.ANIMATIONTYPE_FLOAT,60,P.EasingFunction)),C=b.c.TransitionTo("radius",t,this._attachedCamera,this._attachedCamera.FL(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),i&&i(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),C&&this._animatables.push(C),!0}_calculateLowerRadiusFromModelBoundingSphere(L,r){const p=this._attachedCamera;if(!p)return 0;let J=p._calculateLowerRadiusFromModelBoundingSphere(L,r,this._radiusScale);return p.lowerRadiusLimit&&this._mode===P.IgnoreBoundsSizeMode&&(J=J<p.lowerRadiusLimit?p.lowerRadiusLimit:J),p.upperRadiusLimit&&(J=J>p.upperRadiusLimit?p.upperRadiusLimit:J),J}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const L=E.d.Now-this._lastInteractionTime,r=.5*Math.PI-this._defaultElevation,p=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>p&&L>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=b.c.CreateAnimation("beta",b.c.ANIMATIONTYPE_FLOAT,60,P.EasingFunction));const L=b.c.TransitionTo("beta",r,this._attachedCamera,this._attachedCamera.FL(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));L&&this._animatables.push(L)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=E.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}P.EasingFunction=new g.t,P.EasingMode=g.q.EASINGMODE_EASEINOUT,P.IgnoreBoundsSizeMode=0,P.FitFrustumSidesMode=1;var O=p(12579),h=p(12609),U=p(13775),W=p(11957);class B{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(L){L=W.Tools.BackCompatCameraNoPreventDefault(arguments);const r=this.camera.getEngine(),p=r.getInputElement();let J=0,i=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{var j,z;const G=n.event,C="touch"===G.pointerType;if(n.type!==t.b.POINTERMOVE&&-1===this.buttons.indexOf(G.button))return;const E=G.target;if(this._altKey=G.altKey,this._ctrlKey=G.ctrlKey,this._metaKey=G.metaKey,this._shiftKey=G.shiftKey,this._buttonsPressed=G.buttons,r.isPointerLock){const L=G.movementX,r=G.movementY;this.onTouch(null,L,r),this._pointA=null,this._pointB=null}else{if(n.type!==t.b.POINTERDOWN&&n.type!==t.b.POINTERDOUBLETAP&&C&&(null===(j=this._pointA)||void 0===j?void 0:j.pointerId)!==G.pointerId&&(null===(z=this._pointB)||void 0===z?void 0:z.pointerId)!==G.pointerId)return;if(n.type!==t.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!C)if(n.type===t.b.POINTERDOUBLETAP)this.onDoubleTap(G.pointerType);else if(n.type!==t.b.POINTERUP||this._currentMousePointerIdDown!==G.pointerId&&!C){if(n.type===t.b.POINTERMOVE)if(L||G.preventDefault(),this._pointA&&null===this._pointB){const L=G.clientX-this._pointA.x,r=G.clientY-this._pointA.y;this._pointA.x=G.clientX,this._pointA.y=G.clientY,this.onTouch(this._pointA,L,r)}else if(this._pointA&&this._pointB){const L=this._pointA.pointerId===G.pointerId?this._pointA:this._pointB;L.x=G.clientX,L.y=G.clientY;const r=this._pointA.x-this._pointB.x,p=this._pointA.y-this._pointB.y,j=r*r+p*p,z={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:G.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,J,j,i,z),i=z,J=j}}else{try{null===E||void 0===E||E.releasePointerCapture(G.pointerId)}catch(x){}C||(this._pointB=null),r._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==G.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==G.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==J||i)&&(this.onMultiTouch(this._pointA,this._pointB,J,0,i,null),J=0,i=null),this._currentMousePointerIdDown=-1,this.onButtonUp(G),L||G.preventDefault()}else{try{null===E||void 0===E||E.setPointerCapture(G.pointerId)}catch(x){}if(null===this._pointA)this._pointA={x:G.clientX,y:G.clientY,pointerId:G.pointerId,type:G.pointerType};else{if(null!==this._pointB)return;this._pointB={x:G.clientX,y:G.clientY,pointerId:G.pointerId,type:G.pointerType}}-1!==this._currentMousePointerIdDown||C||(this._currentMousePointerIdDown=G.pointerId),this.onButtonDown(G),L||(G.preventDefault(),p&&p.focus())}}},this._observer=this.camera.FL()._inputManager._addCameraPointerObserver(this._pointerInput,t.b.POINTERDOWN|t.b.POINTERUP|t.b.POINTERMOVE|t.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,J=0,i=null,this.onLostFocus()},this._contextMenuBind=L=>this.onContextMenu(L),p&&p.addEventListener("contextmenu",this._contextMenuBind,!1);const n=this.camera.FL().getEngine().getHostWindow();n&&W.Tools.RegisterTopRootEvents(n,[{name:"blur",handler:this._onLostFocus}])}ZE(){if(this._onLostFocus){const L=this.camera.FL().getEngine().getHostWindow();L&&W.Tools.UnregisterTopRootEvents(L,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.FL()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const L=this.camera.FL().getEngine().getInputElement();L&&L.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(L){}onTouch(L,r,p){}onMultiTouch(L,r,p,J,i,n){}onContextMenu(L){L.preventDefault()}onButtonDown(L){}onButtonUp(L){}onLostFocus(){}}(0,J.e)([(0,i.E)()],B.prototype,"buttons",void 0);class F extends B{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(L,r){if(0!==this.panningSensibility&&L&&r){const p=r.x-L.x,J=r.y-L.y;this.camera.inertialPanningX+=-p/this.panningSensibility,this.camera.inertialPanningY+=J/this.panningSensibility}}_computePinchZoom(L,r){const p=this.camera.radius||F.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=p*Math.sqrt(L)/Math.sqrt(r):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(r-L)*p*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(r-L)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(L,r,p){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-r/this.panningSensibility,this.camera.inertialPanningY+=p/this.panningSensibility):(this.camera.inertialAlphaOffset-=r/this.angularSensibilityX,this.camera.inertialBetaOffset-=p/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(L,r,p,J,i,n){0===p&&null===i||0===J&&null===n||(this.multiTouchPanAndZoom?(this._computePinchZoom(p,J),this._computeMultiTouchPanning(i,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(J)-Math.sqrt(p))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(p,J),this._isPinching=!0):this._computeMultiTouchPanning(i,n)):this.multiTouchPanning?this._computeMultiTouchPanning(i,n):this.pinchZoom&&this._computePinchZoom(p,J))}onButtonDown(L){this._isPanClick=L.button===this.camera._panningMouseButton}onButtonUp(L){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}F.MinimumRadiusForPinch=.001,(0,J.e)([(0,i.E)()],F.prototype,"buttons",void 0),(0,J.e)([(0,i.E)()],F.prototype,"angularSensibilityX",void 0),(0,J.e)([(0,i.E)()],F.prototype,"angularSensibilityY",void 0),(0,J.e)([(0,i.E)()],F.prototype,"pinchPrecision",void 0),(0,J.e)([(0,i.E)()],F.prototype,"pinchDeltaPercentage",void 0),(0,J.e)([(0,i.E)()],F.prototype,"useNaturalPinchZoom",void 0),(0,J.e)([(0,i.E)()],F.prototype,"pinchZoom",void 0),(0,J.e)([(0,i.E)()],F.prototype,"panningSensibility",void 0),(0,J.e)([(0,i.E)()],F.prototype,"multiTouchPanning",void 0),(0,J.e)([(0,i.E)()],F.prototype,"multiTouchPanAndZoom",void 0),U.c.ArcRotateCameraPointersInput=F;var Q=p(12404);class e{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(L){L=W.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.FL(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((r=>{const p=r.event;if(!p.metaKey)if(r.type===Q.d.KEYDOWN){if(this._ctrlPressed=p.ctrlKey,this._altPressed=p.altKey,-1!==this.keysUp.indexOf(p.keyCode)||-1!==this.keysDown.indexOf(p.keyCode)||-1!==this.keysLeft.indexOf(p.keyCode)||-1!==this.keysRight.indexOf(p.keyCode)||-1!==this.keysReset.indexOf(p.keyCode)){-1===this._keys.indexOf(p.keyCode)&&this._keys.push(p.keyCode),p.preventDefault&&(L||p.preventDefault())}}else if(-1!==this.keysUp.indexOf(p.keyCode)||-1!==this.keysDown.indexOf(p.keyCode)||-1!==this.keysLeft.indexOf(p.keyCode)||-1!==this.keysRight.indexOf(p.keyCode)||-1!==this.keysReset.indexOf(p.keyCode)){const r=this._keys.indexOf(p.keyCode);r>=0&&this._keys.splice(r,1),p.preventDefault&&(L||p.preventDefault())}})))}ZE(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const L=this.camera;for(let r=0;r<this._keys.length;r++){const p=this._keys[r];-1!==this.keysLeft.indexOf(p)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningX-=1/this.panningSensibility:L.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(p)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?L.inertialRadiusOffset+=1/this.zoomingSensibility:L.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(p)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningX+=1/this.panningSensibility:L.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(p)?this._ctrlPressed&&this.camera._useCtrlForPanning?L.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?L.inertialRadiusOffset-=1/this.zoomingSensibility:L.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(p)&&L.useInputToRestoreState&&L.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,J.e)([(0,i.E)()],e.prototype,"keysUp",void 0),(0,J.e)([(0,i.E)()],e.prototype,"keysDown",void 0),(0,J.e)([(0,i.E)()],e.prototype,"keysLeft",void 0),(0,J.e)([(0,i.E)()],e.prototype,"keysRight",void 0),(0,J.e)([(0,i.E)()],e.prototype,"keysReset",void 0),(0,J.e)([(0,i.E)()],e.prototype,"panningSensibility",void 0),(0,J.e)([(0,i.E)()],e.prototype,"zoomingSensibility",void 0),(0,J.e)([(0,i.E)()],e.prototype,"useAltToZoom",void 0),(0,J.e)([(0,i.E)()],e.prototype,"angularSpeed",void 0),U.c.ArcRotateCameraKeyboardMoveInput=e;var v=p(12179),y=p(12410);class A{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new j.cr(0,0,0),this._globalOffset=new j.cr(0,0,0),this._inertialPanning=j.cr.Zero()}_computeDeltaFromMouseWheelLegacyEvent(L,r){let p=0;const J=.01*L*this.wheelDeltaPercentage*r;return p=L>0?J/(1+this.wheelDeltaPercentage):J*(1+this.wheelDeltaPercentage),p}attachControl(L){L=W.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=r=>{if(r.type!==t.b.POINTERWHEEL)return;const p=r.event;let J=0;const i=p.deltaMode===y.b.DOM_DELTA_LINE?40:1,n=-p.deltaY*i;if(this.customComputeDeltaFromMouseWheel)J=this.customComputeDeltaFromMouseWheel(n,this,p);else if(this.wheelDeltaPercentage){if(J=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius),J>0){let L=this.camera.radius,r=this.camera.inertialRadiusOffset+J;for(let p=0;p<20&&!(L<=r)&&!(Math.abs(r*this.camera.inertia)<.001);p++)L-=r,r*=this.camera.inertia;L=(0,z.Clamp)(L,0,Number.MAX_VALUE),J=this._computeDeltaFromMouseWheelLegacyEvent(n,L)}}else J=n/(40*this.wheelPrecision);J&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(J)):this.camera.inertialRadiusOffset+=J),p.preventDefault&&(L||p.preventDefault())},this._observer=this.camera.FL()._inputManager._addCameraPointerObserver(this._wheel,t.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Bz(0)}ZE(){this._observer&&(this.camera.FL()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const L=this.camera;0+L.inertialAlphaOffset+L.inertialBetaOffset+L.inertialRadiusOffset&&(this._updateHitPlane(),L.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(L.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const L=this.camera,r=L.target.Pr(L.position);this._hitPlane=v.c.FromPositionAndNormal(L.target,r)}_getPosition(){const L=this.camera,r=L.FL(),p=r.createPickingRay(r.pointerX,r.pointerY,j.Matrix.Identity(),L,!1);0===L.targetScreenOffset.x&&0===L.targetScreenOffset.y||(this._viewOffset.set(L.targetScreenOffset.x,L.targetScreenOffset.y,0),L.getViewMatrix().invertToRef(L._cameraTransformMatrix),this._globalOffset=j.cr.TransformNormal(this._viewOffset,L._cameraTransformMatrix),p.origin.addInPlace(this._globalOffset));let J=0;return this._hitPlane&&(J=p.intersectsPlane(this._hitPlane)??0),p.origin.addInPlace(p.direction.scaleInPlace(J))}_zoomToMouse(L){const r=this.camera,p=1-r.inertia;if(r.lowerRadiusLimit){const J=r.lowerRadiusLimit??0;r.radius-(r.inertialRadiusOffset+L)/p<J&&(L=(r.radius-J)*p-r.inertialRadiusOffset)}if(r.upperRadiusLimit){const J=r.upperRadiusLimit??0;r.radius-(r.inertialRadiusOffset+L)/p>J&&(L=(r.radius-J)*p-r.inertialRadiusOffset)}const J=L/p/r.radius,i=this._getPosition(),n=j.TmpVectors.cr[6];i.subtractToRef(r.target,n),n.scaleInPlace(J),n.scaleInPlace(p),this._inertialPanning.addInPlace(n),r.inertialRadiusOffset+=L}_zeroIfClose(L){Math.abs(L.x)<x.d&&(L.x=0),Math.abs(L.y)<x.d&&(L.y=0),Math.abs(L.z)<x.d&&(L.z=0)}}(0,J.e)([(0,i.E)()],A.prototype,"wheelPrecision",void 0),(0,J.e)([(0,i.E)()],A.prototype,"zoomToMouseLocation",void 0),(0,J.e)([(0,i.E)()],A.prototype,"wheelDeltaPercentage",void 0),U.c.ArcRotateCameraMouseWheelInput=A;class u extends U.f{constructor(L){super(L)}addMouseWheel(){return this.add(new A),this}addPointers(){return this.add(new F),this}addKeyboard(){return this.add(new e),this}}var a=p(12087);function q(L,r){return isNaN(L)?r:L}G.d.AddNodeConstructor("ArcRotateCamera",((L,r)=>()=>new Z(L,0,0,1,j.cr.Zero(),r)));class Z extends h.e{get target(){return this._target}set target(L){this.setTarget(L)}get targetHost(){return this._targetHost}set targetHost(L){L&&this.setTarget(L)}getTarget(){return this.target}get position(){return this._position}set position(L){this.setPosition(L)}set upVector(L){this._upToYMatrix||(this._yToUpMatrix=new j.Matrix,this._upToYMatrix=new j.Matrix,this._upVector=j.cr.Zero()),L.normalize(),this._upVector.G(L),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){j.Matrix.RotationAlignToRef(j.cr.UpReadOnly,this._upVector,this._yToUpMatrix),j.Matrix.RotationAlignToRef(this._upVector,j.cr.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const L=this.inputs.attached.pointers;return L?L.angularSensibilityX:0}set angularSensibilityX(L){const r=this.inputs.attached.pointers;r&&(r.angularSensibilityX=L)}get angularSensibilityY(){const L=this.inputs.attached.pointers;return L?L.angularSensibilityY:0}set angularSensibilityY(L){const r=this.inputs.attached.pointers;r&&(r.angularSensibilityY=L)}get pinchPrecision(){const L=this.inputs.attached.pointers;return L?L.pinchPrecision:0}set pinchPrecision(L){const r=this.inputs.attached.pointers;r&&(r.pinchPrecision=L)}get pinchDeltaPercentage(){const L=this.inputs.attached.pointers;return L?L.pinchDeltaPercentage:0}set pinchDeltaPercentage(L){const r=this.inputs.attached.pointers;r&&(r.pinchDeltaPercentage=L)}get useNaturalPinchZoom(){const L=this.inputs.attached.pointers;return!!L&&L.useNaturalPinchZoom}set useNaturalPinchZoom(L){const r=this.inputs.attached.pointers;r&&(r.useNaturalPinchZoom=L)}get panningSensibility(){const L=this.inputs.attached.pointers;return L?L.panningSensibility:0}set panningSensibility(L){const r=this.inputs.attached.pointers;r&&(r.panningSensibility=L)}get keysUp(){const L=this.inputs.attached.keyboard;return L?L.keysUp:[]}set keysUp(L){const r=this.inputs.attached.keyboard;r&&(r.keysUp=L)}get keysDown(){const L=this.inputs.attached.keyboard;return L?L.keysDown:[]}set keysDown(L){const r=this.inputs.attached.keyboard;r&&(r.keysDown=L)}get keysLeft(){const L=this.inputs.attached.keyboard;return L?L.keysLeft:[]}set keysLeft(L){const r=this.inputs.attached.keyboard;r&&(r.keysLeft=L)}get keysRight(){const L=this.inputs.attached.keyboard;return L?L.keysRight:[]}set keysRight(L){const r=this.inputs.attached.keyboard;r&&(r.keysRight=L)}get wheelPrecision(){const L=this.inputs.attached.mousewheel;return L?L.wheelPrecision:0}set wheelPrecision(L){const r=this.inputs.attached.mousewheel;r&&(r.wheelPrecision=L)}get zoomToMouseLocation(){const L=this.inputs.attached.mousewheel;return!!L&&L.zoomToMouseLocation}set zoomToMouseLocation(L){const r=this.inputs.attached.mousewheel;r&&(r.zoomToMouseLocation=L)}get wheelDeltaPercentage(){const L=this.inputs.attached.mousewheel;return L?L.wheelDeltaPercentage:0}set wheelDeltaPercentage(L){const r=this.inputs.attached.mousewheel;r&&(r.wheelDeltaPercentage=L)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(L){L!==this.useBouncingBehavior&&(L?(this._bouncingBehavior=new c,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(L){L!==this.useFramingBehavior&&(L?(this._framingBehavior=new P,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(L){L!==this.useAutoRotationBehavior&&(L?(this._autoRotationBehavior=new w,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(L,r,p,J,i,z){var G;let C=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(L,j.cr.Zero(),z,C),G=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=j.cr.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=j.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new j.Matrix,this.panningAxis=new j.cr(1,1,0),this._transformedDirection=new j.cr,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new n.c,this.checkCollisions=!1,this.collisionRadius=new j.cr(.5,.5,.5),this._previousPosition=j.cr.Zero(),this._collisionVelocity=j.cr.Zero(),this._newPosition=j.cr.Zero(),this._computationVector=j.cr.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new j.cr(NaN,NaN,NaN),this._goalTargetScreenOffset=new j.Vector2(NaN,NaN),this._onCollisionPositionChange=function(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;p?(G.setPosition(r),G.Bw&&G.Bw(p)):G._previousPosition.G(G._position);const J=Math.cos(G.alpha),i=Math.sin(G.alpha),n=Math.cos(G.beta);let j=Math.sin(G.beta);0===j&&(j=1e-4);const z=G._getTargetPosition();G._computationVector.Uz(G.radius*J*j,G.radius*n,G.radius*i*j),z.addToRef(G._computationVector,G._newPosition),G._position.G(G._newPosition);let C=G.upVector;G.allowUpsideDown&&G.beta<0&&(C=C.clone(),C=C.negate()),G._computeViewMatrix(G._position,z,C),G._viewMatrix.addAtIndex(12,G.targetScreenOffset.x),G._viewMatrix.addAtIndex(13,G.targetScreenOffset.y),G._collisionTriggered=!1},this._target=j.cr.Zero(),i&&this.setTarget(i),this.alpha=r,this.beta=p,this.radius=J,this.getViewMatrix(),this.inputs=new u(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new j.cr(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=j.Vector2.Zero()}_updateCache(L){L||super._updateCache(),this._cache._target.G(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.G(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const L=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?L.addToRef(this._targetBoundingCenter,this._target):this._target.G(L)}const L=this._getLockedTargetPosition();return L||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>x.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,n=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=n?this._currentInterpolationFactor=n:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=q(L,this._goalAlpha),this._goalBeta=q(r,this._goalBeta),this._goalRadius=q(p,this._goalRadius),this._goalTarget.set(q(J.x,this._goalTarget.x),q(J.y,this._goalTarget.y),q(J.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(q(i.x,this._goalTargetScreenOffset.x),q(i.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,z.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,z.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,z.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,z.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(L,r){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const i=arguments;r=W.Tools.BackCompatCameraNoPreventDefault(i),this._useCtrlForPanning=p,this._panningMouseButton=J,"boolean"===typeof i[0]&&(i.length>1&&(this._useCtrlForPanning=i[1]),i.length>2&&(this._panningMouseButton=i[2])),this.inputs.attachElement(r),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}ZE(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let L=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){L=!0;const r=this.invertRotation?-1:1,p=this._calculateHandednessMultiplier();let J=this.inertialAlphaOffset*p;this.beta<0&&(J*=-1),this.alpha+=J*r,this.beta+=this.inertialBetaOffset*r,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<x.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<x.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*x.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){L=!0;const r=new j.cr(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),r.multiplyInPlace(this.panningAxis),j.cr.TransformNormalToRef(r,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const L=this.upVector,r=j.cr.CrossToRef(this._transformedDirection,L,this._transformedDirection);j.cr.CrossToRef(L,r,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);j.cr.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.G(this._transformedDirection)}else{if(this.parent){const L=j.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(L),L.transposeToRef(L),j.cr.TransformCoordinatesToRef(this._transformedDirection,L,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*x.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*x.d&&(this.inertialPanningY=0)}if(L)this.stopInterpolation();else if(this._isInterpolating){let L=!1;const r=this._scene.getEngine().getDeltaTime()/1e3,p=1-Math.pow(2,-r/this._currentInterpolationFactor),J=q(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const r=j.TmpVectors.cr[0].set(q(this._goalTarget.x,this._target.x),q(this._goalTarget.y,this._target.y),q(this._goalTarget.z,this._target.z));j.cr.LerpToRef(this.target,r,p,this._target),10*j.cr.Distance(this.target,r)/J<x.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.G(r),this.setTarget(this.target,!1,!0,!0)):L=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const r=j.Quaternion.RotationAlphaBetaGammaToRef(q(this._goalAlpha,this.alpha),q(this._goalBeta,this.beta),0,j.TmpVectors.Quaternion[0]),J=j.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,j.TmpVectors.Quaternion[1]),i=j.Quaternion.SlerpToRef(J,r,p,j.TmpVectors.Quaternion[2]);i.normalize();const n=i.toAlphaBetaGammaToRef(j.TmpVectors.cr[0]);if(this.alpha=n.x,this.beta=n.y,i.isApprox(r,x.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const L=r.toAlphaBetaGammaToRef(j.TmpVectors.cr[0]);this.alpha=L.x,this.beta=L.y}else L=!0}if(isNaN(this._goalRadius)||(this.radius+=(J-this.radius)*p,Math.abs(J/this.radius-1)<x.d?(this._goalRadius=NaN,this.radius=J):L=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const r=j.TmpVectors.Vector2[0].set(q(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),q(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));j.Vector2.LerpToRef(this.targetScreenOffset,r,p,this.targetScreenOffset),j.Vector2.Distance(this.targetScreenOffset,r)<x.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.G(r)):L=!0}this._isInterpolating=L}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||j.cr.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const L=this.alpha;var r,p;this.alpha=function(L){let r=Math.PI/2;return 0===L.x&&0===L.z||(r=Math.acos(L.x/Math.sqrt(Math.pow(L.x,2)+Math.pow(L.z,2)))),L.z<0&&(r=2*Math.PI-r),r}(this._computationVector),this.beta=(r=this._computationVector.y,p=this.radius,Math.acos(r/p));const J=Math.round((L-this.alpha)/(2*Math.PI));this.alpha+=2*J*Math.PI,this._checkLimits()}setPosition(L){this._position.equals(L)||(this._position.G(L),this.rebuildAnglesAndRadius())}setTarget(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(J=this.overrideCloneAlphaBetaRadius??J,L.cz)r&&L.getBoundingInfo?this._targetBoundingCenter=L.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,L.cz(),this._targetHost=L,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const r=L,J=this._getTargetPosition();if(J&&!p&&J.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}J||this.rebuildAnglesAndRadius()}_getViewMatrix(){const L=Math.cos(this.alpha),r=Math.sin(this.alpha),p=Math.cos(this.beta);let J=Math.sin(this.beta);0===J&&(J=1e-4),0===this.radius&&(this.radius=1e-4);const i=this._getTargetPosition();if(this._computationVector.Uz(this.radius*L*J,this.radius*p,this.radius*r*J),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||j.cr.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),i.addToRef(this._computationVector,this._newPosition),this.FL().collisionsEnabled&&this.checkCollisions){const L=this.FL().collisionCoordinator;this._collider||(this._collider=L.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,L.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.G(this._newPosition);let L=this.upVector;this.allowUpsideDown&&J<0&&(L=L.negate()),this._computeViewMatrix(this._position,i,L),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.G(i),this._viewMatrix}zoomOn(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];L=L||this.FL().meshes;const p=C.c.MinMax(L);let J=this._calculateLowerRadiusFromModelBoundingSphere(p.min,p.max);if(J=Math.max(Math.min(J,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=J*this.zoomOnFactor,this.mode===O.b.ORTHOGRAPHIC_CAMERA){const L=this.FL().getEngine().getAspectRatio(this),r=J*this.zoomOnFactor/2;this.orthoLeft=-r*L,this.orthoRight=r*L,this.orthoBottom=-r,this.orthoTop=r}this.focusOn({min:p.min,max:p.max,distance:J},r)}focusOn(L){let r,p,J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===L.min){const J=L||this.FL().meshes;r=C.c.MinMax(J),p=j.cr.Distance(r.min,r.max)}else{r=L,p=L.distance}this._target=C.c.Center(r),J||(this.maxZ=2*p)}createRigCamera(L,r){let p=0;switch(this.cameraRigMode){case O.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.b.RIG_MODE_VR:p=this._cameraRigParams.stereoHalfAngle*(0===r?1:-1);break;case O.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:p=this._cameraRigParams.stereoHalfAngle*(0===r?-1:1)}const J=new Z(L,this.alpha+p,this.beta,this.radius,this._target,this.FL());return J._cameraRigParams={},J.isRigCamera=!0,J.rigParent=this,J.upVector=this.upVector,J.mode=this.mode,J.orthoLeft=this.orthoLeft,J.orthoRight=this.orthoRight,J.orthoBottom=this.orthoBottom,J.orthoTop=this.orthoTop,J}_updateRigCameras(){const L=this._rigCameras[0],r=this._rigCameras[1];switch(L.beta=r.beta=this.beta,this.cameraRigMode){case O.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.b.RIG_MODE_VR:L.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case O.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:L.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const J=j.cr.Distance(L,r),i=this.FL().getEngine().getAspectRatio(this),n=Math.tan(this.fov/2),z=n*i,G=.5*J*p,C=G*Math.sqrt(1+1/(z*z)),t=G*Math.sqrt(1+1/(n*n));return Math.max(C,t)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,J.e)([(0,i.E)()],Z.prototype,"alpha",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"beta",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"radius",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,J.e)([(0,i.D)("target")],Z.prototype,"_target",void 0),(0,J.e)([(0,i.s)("targetHost")],Z.prototype,"_targetHost",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"inertialAlphaOffset",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"inertialBetaOffset",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"inertialRadiusOffset",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"lowerAlphaLimit",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"upperAlphaLimit",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"lowerBetaLimit",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"upperBetaLimit",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"lowerRadiusLimit",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"upperRadiusLimit",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"lowerTargetYLimit",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"inertialPanningX",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"inertialPanningY",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"pinchToPanMaxDistance",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"panningDistanceLimit",void 0),(0,J.e)([(0,i.D)()],Z.prototype,"panningOriginTarget",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"panningInertia",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"zoomToMouseLocation",null),(0,J.e)([(0,i.E)()],Z.prototype,"zoomOnFactor",void 0),(0,J.e)([(0,i.A)()],Z.prototype,"targetScreenOffset",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"allowUpsideDown",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"useInputToRestoreState",void 0),(0,J.e)([(0,i.E)()],Z.prototype,"restoreStateInterpolationFactor",void 0),(0,a.e)("BABYLON.ArcRotateCamera",Z)},13775:(L,r,p)=>{"use strict";p.d(r,{c:()=>j,f:()=>z});var J=p(11975),i=p(12162),n=p(12579),j={};class z{constructor(L){this.attachedToElement=!1,this.attached={},this.camera=L,this.checkInputs=()=>{}}add(L){const r=L.getSimpleName();this.attached[r]?J.d.Warn("camera input of type "+r+" already exists on camera"):(this.attached[r]=L,L.camera=this.camera,L.checkInputs&&(this.checkInputs=this._addCheckInputs(L.checkInputs.bind(L))),this.attachedToElement&&L.attachControl(this.noPreventDefault))}remove(L){for(const r in this.attached){const p=this.attached[r];if(p===L)return p.ZE(),p.camera=null,delete this.attached[r],void this.rebuildInputCheck()}}removeByType(L){for(const r in this.attached){const p=this.attached[r];p.getClassName()===L&&(p.ZE(),p.camera=null,delete this.attached[r],this.rebuildInputCheck())}}_addCheckInputs(L){const r=this.checkInputs;return()=>{r(),L()}}attachInput(L){this.attachedToElement&&L.attachControl(this.noPreventDefault)}attachElement(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){L=!n.b.ForceAttachControlToAlwaysPreventDefault&&L,this.attachedToElement=!0,this.noPreventDefault=L;for(const r in this.attached)this.attached[r].attachControl(L)}}detachElement(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const r in this.attached)this.attached[r].ZE(),L&&(this.attached[r].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const L in this.attached){const r=this.attached[L];r.checkInputs&&(this.checkInputs=this._addCheckInputs(r.checkInputs.bind(r)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(L){const r={};for(const p in this.attached){const L=this.attached[p],J=i.c.Serialize(L);r[L.getClassName()]=J}L.inputsmgr=r}parse(L){const r=L.inputsmgr;if(r){this.clear();for(const L in r){const p=j[L];if(p){const J=r[L],n=i.c.Parse((()=>new p),J,null);this.add(n)}}}else for(const p in this.attached){const r=j[this.attached[p].getClassName()];if(r){const J=i.c.Parse((()=>new r),L,null);this.remove(this.attached[p]),this.add(J)}}}}},13766:(L,r,p)=>{"use strict";p.d(r,{d:()=>B});var J=p(12113),i=p(12122),n=p(12136),j=p(12609),z=p(13775),G=p(12404),C=p(11957);class t{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(L){L=C.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.FL(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((r=>{const p=r.event;if(!p.metaKey)if(r.type===G.d.KEYDOWN){if(-1!==this.keysUp.indexOf(p.keyCode)||-1!==this.keysDown.indexOf(p.keyCode)||-1!==this.keysLeft.indexOf(p.keyCode)||-1!==this.keysRight.indexOf(p.keyCode)||-1!==this.keysUpward.indexOf(p.keyCode)||-1!==this.keysDownward.indexOf(p.keyCode)||-1!==this.keysRotateLeft.indexOf(p.keyCode)||-1!==this.keysRotateRight.indexOf(p.keyCode)||-1!==this.keysRotateUp.indexOf(p.keyCode)||-1!==this.keysRotateDown.indexOf(p.keyCode)){-1===this._keys.indexOf(p.keyCode)&&this._keys.push(p.keyCode),L||p.preventDefault()}}else if(-1!==this.keysUp.indexOf(p.keyCode)||-1!==this.keysDown.indexOf(p.keyCode)||-1!==this.keysLeft.indexOf(p.keyCode)||-1!==this.keysRight.indexOf(p.keyCode)||-1!==this.keysUpward.indexOf(p.keyCode)||-1!==this.keysDownward.indexOf(p.keyCode)||-1!==this.keysRotateLeft.indexOf(p.keyCode)||-1!==this.keysRotateRight.indexOf(p.keyCode)||-1!==this.keysRotateUp.indexOf(p.keyCode)||-1!==this.keysRotateDown.indexOf(p.keyCode)){const r=this._keys.indexOf(p.keyCode);r>=0&&this._keys.splice(r,1),L||p.preventDefault()}})))}ZE(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const L=this.camera;for(let r=0;r<this._keys.length;r++){const p=this._keys[r],J=L._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(p)?L._localDirection.Uz(-J,0,0):-1!==this.keysUp.indexOf(p)?L._localDirection.Uz(0,0,J):-1!==this.keysRight.indexOf(p)?L._localDirection.Uz(J,0,0):-1!==this.keysDown.indexOf(p)?L._localDirection.Uz(0,0,-J):-1!==this.keysUpward.indexOf(p)?L._localDirection.Uz(0,J,0):-1!==this.keysDownward.indexOf(p)?L._localDirection.Uz(0,-J,0):-1!==this.keysRotateLeft.indexOf(p)?(L._localDirection.Uz(0,0,0),L.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(p)?(L._localDirection.Uz(0,0,0),L.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(p)?(L._localDirection.Uz(0,0,0),L.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(p)&&(L._localDirection.Uz(0,0,0),L.cameraRotation.x+=this._getLocalRotation()),L.FL().useRightHandedSystem&&(L._localDirection.z*=-1),L.getViewMatrix().invertToRef(L._cameraTransformMatrix),n.cr.TransformNormalToRef(L._localDirection,L._cameraTransformMatrix,L._transformedDirection),L.cameraDirection.addInPlace(L._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const L=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*L}}(0,J.e)([(0,i.E)()],t.prototype,"keysUp",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysUpward",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysDown",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysDownward",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysLeft",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysRight",void 0),(0,J.e)([(0,i.E)()],t.prototype,"rotationSpeed",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysRotateLeft",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysRotateRight",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysRotateUp",void 0),(0,J.e)([(0,i.E)()],t.prototype,"keysRotateDown",void 0),z.c.FreeCameraKeyboardMoveInput=t;var E=p(11964),x=p(12398);class w{constructor(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=L,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new E.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(L){L=C.Tools.BackCompatCameraNoPreventDefault(arguments);const r=this.camera.getEngine(),p=r.getInputElement();this._pointerInput||(this._pointerInput=J=>{const i=J.event,n="touch"===i.pointerType;if(!this.touchEnabled&&n)return;if(J.type!==x.b.POINTERMOVE&&-1===this.buttons.indexOf(i.button))return;const j=i.target;if(J.type===x.b.POINTERDOWN){if(n&&-1!==this._activePointerId||!n&&-1!==this._currentActiveButton)return;this._activePointerId=i.pointerId;try{null===j||void 0===j||j.setPointerCapture(i.pointerId)}catch(z){}-1===this._currentActiveButton&&(this._currentActiveButton=i.button),this._previousPosition={x:i.clientX,y:i.clientY},L||(i.preventDefault(),p&&p.focus()),r.isPointerLock&&this._onMouseMove&&this._onMouseMove(J.event)}else if(J.type===x.b.POINTERUP){if(n&&this._activePointerId!==i.pointerId||!n&&this._currentActiveButton!==i.button)return;try{null===j||void 0===j||j.releasePointerCapture(i.pointerId)}catch(z){}this._currentActiveButton=-1,this._previousPosition=null,L||i.preventDefault(),this._activePointerId=-1}else if(J.type===x.b.POINTERMOVE&&(this._activePointerId===i.pointerId||!n))if(r.isPointerLock&&this._onMouseMove)this._onMouseMove(J.event);else if(this._previousPosition){const r=this.camera._calculateHandednessMultiplier(),p=(i.clientX-this._previousPosition.x)*r,J=i.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=p/this.angularSensibility,this.camera.cameraRotation.x+=J/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:p,offsetY:J}),this._previousPosition={x:i.clientX,y:i.clientY},L||i.preventDefault()}}),this._onMouseMove=p=>{if(!r.isPointerLock)return;const J=this.camera._calculateHandednessMultiplier(),i=p.movementX*J;this.camera.cameraRotation.y+=i/this.angularSensibility;const n=p.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,L||p.preventDefault()},this._observer=this.camera.FL()._inputManager._addCameraPointerObserver(this._pointerInput,x.b.POINTERDOWN|x.b.POINTERUP|x.b.POINTERMOVE),p&&(this._contextMenuBind=L=>this.onContextMenu(L),p.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(L){L.preventDefault()}ZE(){if(this._observer){if(this.camera.FL()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const L=this.camera.getEngine().getInputElement();L&&L.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,J.e)([(0,i.E)()],w.prototype,"buttons",void 0),(0,J.e)([(0,i.E)()],w.prototype,"angularSensibility",void 0),z.c.FreeCameraMouseInput=w;var g,b=p(12410);class c{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new E.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(L){L=C.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=r=>{if(r.type!==x.b.POINTERWHEEL)return;const p=r.event,J=p.deltaMode===b.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*J*p.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*J*p.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*J*p.deltaZ/this._normalize,p.preventDefault&&(L||p.preventDefault())},this._observer=this.camera.FL()._inputManager._addCameraPointerObserver(this._wheel,x.b.POINTERWHEEL)}ZE(){this._observer&&(this.camera.FL()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,J.e)([(0,i.E)()],c.prototype,"wheelPrecisionX",void 0),(0,J.e)([(0,i.E)()],c.prototype,"wheelPrecisionY",void 0),(0,J.e)([(0,i.E)()],c.prototype,"wheelPrecisionZ",void 0),function(L){L[L.MoveRelative=0]="MoveRelative",L[L.RotateRelative=1]="RotateRelative",L[L.MoveScene=2]="MoveScene"}(g||(g={}));class P extends c{constructor(){super(...arguments),this._moveRelative=n.cr.Zero(),this._rotateRelative=n.cr.Zero(),this._moveScene=n.cr.Zero(),this._wheelXAction=g.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=g.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(L){null===L&&this._wheelXAction!==g.MoveRelative||(this._wheelXAction=g.MoveRelative,this._wheelXActionCoordinate=L)}get wheelXMoveRelative(){return this._wheelXAction!==g.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(L){null===L&&this._wheelYAction!==g.MoveRelative||(this._wheelYAction=g.MoveRelative,this._wheelYActionCoordinate=L)}get wheelYMoveRelative(){return this._wheelYAction!==g.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(L){null===L&&this._wheelZAction!==g.MoveRelative||(this._wheelZAction=g.MoveRelative,this._wheelZActionCoordinate=L)}get wheelZMoveRelative(){return this._wheelZAction!==g.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(L){null===L&&this._wheelXAction!==g.RotateRelative||(this._wheelXAction=g.RotateRelative,this._wheelXActionCoordinate=L)}get wheelXRotateRelative(){return this._wheelXAction!==g.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(L){null===L&&this._wheelYAction!==g.RotateRelative||(this._wheelYAction=g.RotateRelative,this._wheelYActionCoordinate=L)}get wheelYRotateRelative(){return this._wheelYAction!==g.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(L){null===L&&this._wheelZAction!==g.RotateRelative||(this._wheelZAction=g.RotateRelative,this._wheelZActionCoordinate=L)}get wheelZRotateRelative(){return this._wheelZAction!==g.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(L){null===L&&this._wheelXAction!==g.MoveScene||(this._wheelXAction=g.MoveScene,this._wheelXActionCoordinate=L)}get wheelXMoveScene(){return this._wheelXAction!==g.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(L){null===L&&this._wheelYAction!==g.MoveScene||(this._wheelYAction=g.MoveScene,this._wheelYActionCoordinate=L)}get wheelYMoveScene(){return this._wheelYAction!==g.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(L){null===L&&this._wheelZAction!==g.MoveScene||(this._wheelZAction=g.MoveScene,this._wheelZActionCoordinate=L)}get wheelZMoveScene(){return this._wheelZAction!==g.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Bz(0),this._rotateRelative.Bz(0),this._moveScene.Bz(0),this._updateCamera(),this.camera.FL().useRightHandedSystem&&(this._moveRelative.z*=-1);const L=n.Matrix.Zero();this.camera.getViewMatrix().invertToRef(L);const r=n.cr.Zero();n.cr.TransformNormalToRef(this._moveRelative,L,r),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(r),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(L,r,p){if(0===L)return;if(null===r||null===p)return;let J=null;switch(r){case g.MoveRelative:J=this._moveRelative;break;case g.RotateRelative:J=this._rotateRelative;break;case g.MoveScene:J=this._moveScene}switch(p){case 0:J.set(L,0,0);break;case 1:J.set(0,L,0);break;case 2:J.set(0,0,L)}}}(0,J.e)([(0,i.E)()],P.prototype,"wheelXMoveRelative",null),(0,J.e)([(0,i.E)()],P.prototype,"wheelYMoveRelative",null),(0,J.e)([(0,i.E)()],P.prototype,"wheelZMoveRelative",null),(0,J.e)([(0,i.E)()],P.prototype,"wheelXRotateRelative",null),(0,J.e)([(0,i.E)()],P.prototype,"wheelYRotateRelative",null),(0,J.e)([(0,i.E)()],P.prototype,"wheelZRotateRelative",null),(0,J.e)([(0,i.E)()],P.prototype,"wheelXMoveScene",null),(0,J.e)([(0,i.E)()],P.prototype,"wheelYMoveScene",null),(0,J.e)([(0,i.E)()],P.prototype,"wheelZMoveScene",null),z.c.FreeCameraMouseWheelInput=P;class O{constructor(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=L,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=C.Tools.IsSafari()}attachControl(L){L=C.Tools.BackCompatCameraNoPreventDefault(arguments);let r=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=p=>{const J=p.event,i="mouse"===J.pointerType||this._isSafari&&"undefined"===typeof J.pointerType;if(this.allowMouse||!i)if(p.type===x.b.POINTERDOWN){if(L||J.preventDefault(),this._pointerPressed.push(J.pointerId),1!==this._pointerPressed.length)return;r={x:J.clientX,y:J.clientY}}else if(p.type===x.b.POINTERUP){L||J.preventDefault();const p=this._pointerPressed.indexOf(J.pointerId);if(-1===p)return;if(this._pointerPressed.splice(p,1),0!=p)return;r=null,this._offsetX=null,this._offsetY=null}else if(p.type===x.b.POINTERMOVE){if(L||J.preventDefault(),!r)return;if(0!=this._pointerPressed.indexOf(J.pointerId))return;this._offsetX=J.clientX-r.x,this._offsetY=-(J.clientY-r.y)}}),this._observer=this.camera.FL()._inputManager._addCameraPointerObserver(this._pointerInput,x.b.POINTERDOWN|x.b.POINTERUP|x.b.POINTERMOVE),this._onLostFocus){const L=this.camera.getEngine().getInputElement();L&&L.addEventListener("blur",this._onLostFocus)}}ZE(){if(this._pointerInput){if(this._observer&&(this.camera.FL()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const L=this.camera.getEngine().getInputElement();L&&L.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const L=this.camera,r=L._calculateHandednessMultiplier();L.cameraRotation.y=r*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)L.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const r=L._computeLocalCameraSpeed(),p=new n.cr(0,0,0!==this.touchMoveSensibility?r*this._offsetY/this.touchMoveSensibility:0);n.Matrix.RotationYawPitchRollToRef(L.rotation.y,L.rotation.x,0,L._cameraRotationMatrix),L.cameraDirection.addInPlace(n.cr.TransformCoordinates(p,L._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,J.e)([(0,i.E)()],O.prototype,"touchAngularSensibility",void 0),(0,J.e)([(0,i.E)()],O.prototype,"touchMoveSensibility",void 0),z.c.FreeCameraTouchInput=O;class h extends z.f{constructor(L){super(L),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new t),this}addMouse(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new w(L),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new P,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new O),this}clear(){super.clear(),this._mouseInput=null}}var U=p(12087),W=p(12037);class B extends j.e{get angularSensibility(){const L=this.inputs.attached.mouse;return L?L.angularSensibility:0}set angularSensibility(L){const r=this.inputs.attached.mouse;r&&(r.angularSensibility=L)}get keysUp(){const L=this.inputs.attached.keyboard;return L?L.keysUp:[]}set keysUp(L){const r=this.inputs.attached.keyboard;r&&(r.keysUp=L)}get keysUpward(){const L=this.inputs.attached.keyboard;return L?L.keysUpward:[]}set keysUpward(L){const r=this.inputs.attached.keyboard;r&&(r.keysUpward=L)}get keysDown(){const L=this.inputs.attached.keyboard;return L?L.keysDown:[]}set keysDown(L){const r=this.inputs.attached.keyboard;r&&(r.keysDown=L)}get keysDownward(){const L=this.inputs.attached.keyboard;return L?L.keysDownward:[]}set keysDownward(L){const r=this.inputs.attached.keyboard;r&&(r.keysDownward=L)}get keysLeft(){const L=this.inputs.attached.keyboard;return L?L.keysLeft:[]}set keysLeft(L){const r=this.inputs.attached.keyboard;r&&(r.keysLeft=L)}get keysRight(){const L=this.inputs.attached.keyboard;return L?L.keysRight:[]}set keysRight(L){const r=this.inputs.attached.keyboard;r&&(r.keysRight=L)}get keysRotateLeft(){const L=this.inputs.attached.keyboard;return L?L.keysRotateLeft:[]}set keysRotateLeft(L){const r=this.inputs.attached.keyboard;r&&(r.keysRotateLeft=L)}get keysRotateRight(){const L=this.inputs.attached.keyboard;return L?L.keysRotateRight:[]}set keysRotateRight(L){const r=this.inputs.attached.keyboard;r&&(r.keysRotateRight=L)}get keysRotateUp(){const L=this.inputs.attached.keyboard;return L?L.keysRotateUp:[]}set keysRotateUp(L){const r=this.inputs.attached.keyboard;r&&(r.keysRotateUp=L)}get keysRotateDown(){const L=this.inputs.attached.keyboard;return L?L.keysRotateDown:[]}set keysRotateDown(L){const r=this.inputs.attached.keyboard;r&&(r.keysRotateDown=L)}constructor(L,r,p){var J;super(L,r,p,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),J=this,this.ellipsoid=new n.cr(.5,1,.5),this.ellipsoidOffset=new n.cr(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=n.cr.Zero(),this._diffPosition=n.cr.Zero(),this._newPosition=n.cr.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;J._newPosition.G(r),J._newPosition.subtractToRef(J._oldPosition,J._diffPosition),J._diffPosition.length()>W.e.CollisionsEpsilon&&(J.position.addToRef(J._diffPosition,J._deferredPositionUpdate),J._deferOnly?J._deferredUpdated=!0:J.position.G(J._deferredPositionUpdate),J.Bw&&p&&J.Bw(p))},this.inputs=new h(this),this.inputs.addKeyboard().addMouse()}attachControl(L,r){r=C.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(r)}ZE(){this.inputs.detachElement(),this.cameraDirection=new n.cr(0,0,0),this.cameraRotation=new n.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(L){this._collisionMask=isNaN(L)?-1:L}_collideWithWorld(L){let r;r=this.parent?n.cr.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,r.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const p=this.FL().collisionCoordinator;this._collider||(this._collider=p.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let J=L;this.applyGravity&&(J=L.add(this.FL().gravity)),p.getNewPosition(this._oldPosition,J,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=n.cr.Zero(),this._transformedDirection=n.cr.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(L){this._needMoveForGravity=L}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.FL().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ig"}}(0,J.e)([(0,i.D)()],B.prototype,"ellipsoid",void 0),(0,J.e)([(0,i.D)()],B.prototype,"ellipsoidOffset",void 0),(0,J.e)([(0,i.E)()],B.prototype,"checkCollisions",void 0),(0,J.e)([(0,i.E)()],B.prototype,"applyGravity",void 0),(0,U.e)("BABYLON.FreeCamera",B)},14347:(L,r,p)=>{"use strict";p.d(r,{b:()=>n});var J=p(12223),i=p(14356);class n{constructor(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=p,this.St=[],this._maxBlockCapacity=r||64,this._selectionContent=new J.e(1024),this._creationFunc=L}update(L,r,p){i.d._CreateBlocks(L,r,p,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}nt(L){for(let r=0;r<this.Pt.length;r++){this.Pt[r].addEntry(L)}}it(L){for(let r=0;r<this.Pt.length;r++){this.Pt[r].removeEntry(L)}}select(L,r){this._selectionContent.reset();for(let p=0;p<this.Pt.length;p++){this.Pt[p].select(L,this._selectionContent,r)}return r?this._selectionContent.concat(this.St):this._selectionContent.concatWithNoDuplicate(this.St),this._selectionContent}intersects(L,r,p){this._selectionContent.reset();for(let J=0;J<this.Pt.length;J++){this.Pt[J].intersects(L,r,this._selectionContent,p)}return p?this._selectionContent.concat(this.St):this._selectionContent.concatWithNoDuplicate(this.St),this._selectionContent}intersectsRay(L){this._selectionContent.reset();for(let r=0;r<this.Pt.length;r++){this.Pt[r].intersectsRay(L,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.St),this._selectionContent}}n.CreationFuncForMeshes=(L,r)=>{const p=L.getBoundingInfo();!L.isBlocked&&p.boundingBox.intersectsMinMax(r.iE,r.nE)&&r.entries.push(L)},n.CreationFuncForSubMeshes=(L,r)=>{L.getBoundingInfo().boundingBox.intersectsMinMax(r.iE,r.nE)&&r.entries.push(L)}},14356:(L,r,p)=>{"use strict";p.d(r,{d:()=>n});var J=p(12136),i=p(12474);class n{constructor(L,r,p,J,i,n){this.entries=[],this.jE=new Array,this._capacity=p,this._depth=J,this._maxDepth=i,this._creationFunc=n,this._minPoint=L,this._maxPoint=r,this.jE.push(L.clone()),this.jE.push(r.clone()),this.jE.push(L.clone()),this.jE[2].x=r.x,this.jE.push(L.clone()),this.jE[3].y=r.y,this.jE.push(L.clone()),this.jE[4].z=r.z,this.jE.push(r.clone()),this.jE[5].z=L.z,this.jE.push(r.clone()),this.jE[6].x=L.x,this.jE.push(r.clone()),this.jE[7].y=L.y}get Mr(){return this._capacity}get iE(){return this._minPoint}get nE(){return this._maxPoint}addEntry(L){if(this.Pt)for(let r=0;r<this.Pt.length;r++){this.Pt[r].addEntry(L)}else this._creationFunc(L,this),this.entries.length>this.Mr&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(L){if(this.Pt){for(let r=0;r<this.Pt.length;r++){this.Pt[r].removeEntry(L)}return}const r=this.entries.indexOf(L);r>-1&&this.entries.splice(r,1)}addEntries(L){for(let r=0;r<L.length;r++){const p=L[r];this.addEntry(p)}}select(L,r,p){if(i.e.IsInFrustum(this.jE,L)){if(this.Pt){for(let J=0;J<this.Pt.length;J++){this.Pt[J].select(L,r,p)}return}p?r.concat(this.entries):r.concatWithNoDuplicate(this.entries)}}intersects(L,r,p,J){if(i.e.IntersectsSphere(this._minPoint,this._maxPoint,L,r)){if(this.Pt){for(let i=0;i<this.Pt.length;i++){this.Pt[i].intersects(L,r,p,J)}return}J?p.concat(this.entries):p.concatWithNoDuplicate(this.entries)}}intersectsRay(L,r){if(L.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Pt){for(let p=0;p<this.Pt.length;p++){this.Pt[p].intersectsRay(L,r)}return}r.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){n._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(L,r,p,i,j,z,G,C){G.Pt=new Array;const t=new J.cr((r.x-L.x)/2,(r.y-L.y)/2,(r.z-L.z)/2);for(let J=0;J<2;J++)for(let r=0;r<2;r++)for(let E=0;E<2;E++){const x=L.add(t.multiplyByFloats(J,r,E)),w=L.add(t.multiplyByFloats(J+1,r+1,E+1)),g=new n(x,w,i,j+1,z,C);g.addEntries(p),G.Pt.push(g)}}}},14359:(L,r,p)=>{"use strict";p.d(r,{e:()=>t});var J=p(12355),i=p(12136),n=p(12547),j=p(13502),z=p(12389),G=p(14347),C=p(12009);J.b.prototype.createOrUpdateSelectionOctree=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,p=this._getComponent(z.b.NAME_OCTREE);p||(p=new t(this),this.dp(p)),this.mE||(this.mE=new G.b(G.b.CreationFuncForMeshes,L,r));const J=this.getWorldExtends();return this.mE.update(J.min,J.max,this.meshes),this.mE},Object.defineProperty(J.b.prototype,"selectionOctree",{get:function(){return this.mE},enumerable:!0,configurable:!0}),n.c.prototype.createOrUpdateSubmeshesOctree=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const p=this.FL();let J=p._getComponent(z.b.NAME_OCTREE);J||(J=new t(p),p.dp(J)),this._submeshesOctree||(this._submeshesOctree=new G.b(G.b.CreationFuncForSubMeshes,L,r)),this.cz(!0);const i=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(i.minimumWorld,i.maximumWorld,this.ln),this._submeshesOctree};class t{constructor(L){this.name=z.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new j.c(i.cr.Zero(),new i.cr(1,1,1)),(L=L||C.c.LastCreatedScene)&&(this.Or=L,this.Or.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Or.getActiveSubMeshCandidates=L=>this.getActiveSubMeshCandidates(L),this.Or.getCollidingSubMeshCandidates=(L,r)=>this.getCollidingSubMeshCandidates(L,r),this.Or.getIntersectingSubMeshCandidates=(L,r)=>this.getIntersectingSubMeshCandidates(L,r))}register(){this.Or.onMeshRemovedObservable.add((L=>{const r=this.Or.selectionOctree;if(void 0!==r&&null!==r){const p=r.St.indexOf(L);-1!==p&&r.St.splice(p,1)}})),this.Or.onMeshImportedObservable.add((L=>{const r=this.Or.selectionOctree;void 0!==r&&null!==r&&r.nt(L)}))}getActiveMeshCandidates(){var L;return(null===(L=this.Or.mE)||void 0===L?void 0:L.select(this.Or.frustumPlanes))||this.Or._getDefaultMeshCandidates()}getActiveSubMeshCandidates(L){if(L._submeshesOctree&&L.useOctreeForRenderingSelection){return L._submeshesOctree.select(this.Or.frustumPlanes)}return this.Or._getDefaultSubMeshCandidates(L)}getIntersectingSubMeshCandidates(L,r){if(L._submeshesOctree&&L.useOctreeForPicking){j.c.TransformToRef(r,L.getWorldMatrix(),this._tempRay);return L._submeshesOctree.intersectsRay(this._tempRay)}return this.Or._getDefaultSubMeshCandidates(L)}getCollidingSubMeshCandidates(L,r){if(L._submeshesOctree&&L.useOctreeForCollisions){const p=r._velocityWorldLength+Math.max(r._radius.x,r._radius.y,r._radius.z);return L._submeshesOctree.intersects(r._basePointWorld,p)}return this.Or._getDefaultSubMeshCandidates(L)}rebuild(){}dispose(){}}},13502:(L,r,p)=>{"use strict";p.d(r,{c:()=>w});var J=p(12355),i=p(12579),n=p(12140),j=p(12136),z=p(12149),G=p(12459),C=p(12386),t=p(12009),E=p(12414);const x={internalPickerForMesh:void 0};class w{constructor(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.d;this.origin=L,this.direction=r,this.length=p,this.epsilon=J}clone(){return new w(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=w._TmpVector3[0].Uz(L.x-p,L.y-p,L.z-p),i=w._TmpVector3[1].Uz(r.x+p,r.y+p,r.z+p);let n,j,z,G,C=0,t=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<J.x||this.origin.x>i.x)return!1}else if(n=1/this.direction.x,j=(J.x-this.origin.x)*n,z=(i.x-this.origin.x)*n,z===-1/0&&(z=1/0),j>z&&(G=j,j=z,z=G),C=Math.max(j,C),t=Math.min(z,t),C>t)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<J.y||this.origin.y>i.y)return!1}else if(n=1/this.direction.y,j=(J.y-this.origin.y)*n,z=(i.y-this.origin.y)*n,z===-1/0&&(z=1/0),j>z&&(G=j,j=z,z=G),C=Math.max(j,C),t=Math.min(z,t),C>t)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<J.z||this.origin.z>i.z)return!1}else if(n=1/this.direction.z,j=(J.z-this.origin.z)*n,z=(i.z-this.origin.z)*n,z===-1/0&&(z=1/0),j>z&&(G=j,j=z,z=G),C=Math.max(j,C),t=Math.min(z,t),C>t)return!1;return!0}intersectsBox(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(L.minimum,L.maximum,r)}intersectsSphere(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const p=L.center.x-this.origin.x,J=L.center.y-this.origin.y,i=L.center.z-this.origin.z,n=p*p+J*J+i*i,j=L.radius+r,z=j*j;if(n<=z)return!0;const G=p*this.direction.x+J*this.direction.y+i*this.direction.z;if(G<0)return!1;return n-G*G<=z}intersectsTriangle(L,r,p){const J=w._TmpVector3[0],i=w._TmpVector3[1],n=w._TmpVector3[2],z=w._TmpVector3[3],C=w._TmpVector3[4];r.subtractToRef(L,J),p.subtractToRef(L,i),j.cr.CrossToRef(this.direction,i,n);const t=j.cr.Dot(J,n);if(0===t)return null;const E=1/t;this.origin.subtractToRef(L,z);const x=j.cr.Dot(z,n)*E;if(x<-this.epsilon||x>1+this.epsilon)return null;j.cr.CrossToRef(z,J,C);const g=j.cr.Dot(this.direction,C)*E;if(g<-this.epsilon||x+g>1+this.epsilon)return null;const b=j.cr.Dot(i,C)*E;return b>this.length?null:new G.b(1-x-g,x,b)}intersectsPlane(L){let r;const p=j.cr.Dot(L.normal,this.direction);if(Math.abs(p)<9.99999997475243e-7)return null;{const J=j.cr.Dot(L.normal,this.origin);return r=(-L.d-J)/p,r<0?r<-9.99999997475243e-7?null:0:r}}intersectsAxis(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(L){case"y":{const L=(this.origin.y-r)/this.direction.y;return L>0?null:new j.cr(this.origin.x+this.direction.x*-L,r,this.origin.z+this.direction.z*-L)}case"x":{const L=(this.origin.x-r)/this.direction.x;return L>0?null:new j.cr(r,this.origin.y+this.direction.y*-L,this.origin.z+this.direction.z*-L)}case"z":{const L=(this.origin.z-r)/this.direction.z;return L>0?null:new j.cr(this.origin.x+this.direction.x*-L,this.origin.y+this.direction.y*-L,r)}default:return null}}intersectsMesh(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=j.TmpVectors.Matrix[0];return L.getWorldMatrix().invertToRef(z),this._tmpRay?w.TransformToRef(this,z,this._tmpRay):this._tmpRay=w.Transform(this,z),L.intersects(this._tmpRay,r,p,J,i,n)}intersectsMeshes(L,r,p){p?p.length=0:p=[];for(let J=0;J<L.length;J++){const i=this.intersectsMesh(L[J],r);i.hit&&p.push(i)}return p.sort(this._comparePickingInfo),p}_comparePickingInfo(L,r){return L.distance<r.distance?-1:L.distance>r.distance?1:0}intersectionSegment(L,r,p){const J=this.origin,i=j.TmpVectors.cr[0],n=j.TmpVectors.cr[1],z=j.TmpVectors.cr[2],G=j.TmpVectors.cr[3];r.subtractToRef(L,i),this.direction.scaleToRef(w._Rayl,z),J.addToRef(z,n),L.subtractToRef(J,G);const C=j.cr.Dot(i,i),t=j.cr.Dot(i,z),E=j.cr.Dot(z,z),x=j.cr.Dot(i,G),g=j.cr.Dot(z,G),b=C*E-t*t;let c,P,O=b,h=b;b<w._Smallnum?(c=0,O=1,P=g,h=E):(c=t*g-E*x,P=C*g-t*x,c<0?(c=0,P=g,h=E):c>O&&(c=O,P=g+t,h=E)),P<0?(P=0,-x<0?c=0:-x>C?c=O:(c=-x,O=C)):P>h&&(P=h,-x+t<0?c=0:-x+t>C?c=O:(c=-x+t,O=C));const U=Math.abs(c)<w._Smallnum?0:c/O,W=Math.abs(P)<w._Smallnum?0:P/h,B=j.TmpVectors.cr[4];z.scaleToRef(W,B);const F=j.TmpVectors.cr[5];i.scaleToRef(U,F),F.addInPlace(G);const Q=j.TmpVectors.cr[6];F.subtractToRef(B,Q);return W>0&&W<=this.length&&Q.lengthSquared()<p*p?F.length():-1}update(L,r,p,J,i,n,z){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){w._RayDistant||(w._RayDistant=w.Zero()),w._RayDistant.unprojectRayToRef(L,r,p,J,j.Matrix.IdentityReadOnly,n,z);const G=j.TmpVectors.Matrix[0];i.invertToRef(G),w.TransformToRef(w._RayDistant,G,this)}else this.unprojectRayToRef(L,r,p,J,i,n,z);return this}static Zero(){return new w(j.cr.Zero(),j.cr.Zero())}static CreateNew(L,r,p,J,i,n,j){return w.Zero().update(L,r,p,J,i,n,j)}static CreateNewFromTo(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Matrix.IdentityReadOnly;const J=new w(new j.cr(0,0,0),new j.cr(0,0,0));return w.CreateFromToToRef(L,r,J,p)}static CreateFromToToRef(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.Matrix.IdentityReadOnly;p.origin.G(L);const i=r.subtractToRef(L,p.direction),n=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);return p.length=n,p.direction.normalize(),w.TransformToRef(p,J,p)}static Transform(L,r){const p=new w(new j.cr(0,0,0),new j.cr(0,0,0));return w.TransformToRef(L,r,p),p}static TransformToRef(L,r,p){j.cr.TransformCoordinatesToRef(L.origin,r,p.origin),j.cr.TransformNormalToRef(L.direction,r,p.direction),p.length=L.length,p.epsilon=L.epsilon;const J=p.direction,i=J.length();if(0!==i&&1!==i){const L=1/i;J.x*=L,J.y*=L,J.z*=L,p.length*=i}return p}unprojectRayToRef(L,r,p,J,i,n,z){const G=j.TmpVectors.Matrix[0];i.multiplyToRef(n,G),G.multiplyToRef(z,G),G.invert();const C=t.c.LastCreatedEngine,E=j.TmpVectors.cr[0];E.x=L/p*2-1,E.y=-(r/J*2-1),E.z=null!==C&&void 0!==C&&C.o?1:null!==C&&void 0!==C&&C.isNDCHalfZRange?0:-1;const x=j.TmpVectors.cr[1].Uz(E.x,E.y,1-1e-8),w=j.TmpVectors.cr[2],g=j.TmpVectors.cr[3];j.cr._UnprojectFromInvertedMatrixToRef(E,G,w),j.cr._UnprojectFromInvertedMatrixToRef(x,G,g),this.origin.G(w),g.subtractToRef(w,this.direction),this.direction.normalize()}}function g(L,r,p,J,i){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const j=w.Zero();return b(L,r,p,J,j,i,n),j}function b(L,r,p,J,i,n){let z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const C=L.getEngine();if(!n&&!(n=L.activeCamera))return L;const t=n.viewport,E=C.getRenderHeight(),{x:x,y:w,width:g,height:b}=t.toGlobal(C.getRenderWidth(),E),c=1/C.getHardwareScalingLevel();return r=r*c-x,p=p*c-(E-w-b),i.update(r,p,g,b,J||j.Matrix.IdentityReadOnly,z?j.Matrix.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix(),G),L}function c(L,r,p,J,i){if(!C.d)return L;const n=L.getEngine();if(!i&&!(i=L.activeCamera))throw new Error("Active camera not set");const z=i.viewport,G=n.getRenderHeight(),{x:t,y:E,width:x,height:w}=z.toGlobal(n.getRenderWidth(),G),g=j.Matrix.Identity(),b=1/n.getHardwareScalingLevel();return r=r*b-t,p=p*b-(G-E-w),J.update(r,p,x,w,g,g,i.getProjectionMatrix()),L}function P(L,r,p,J,i,n,j,z){const G=r(J,p.enableDistantPicking),C=p.intersects(G,i,j,n,J,z);return C&&C.hit?!i&&null!=L&&C.distance>=L.distance?null:C:null}function O(L,r,p,J,i,n){let z=null;const G=!!(L.activeCameras&&L.activeCameras.length>1&&L.cameraToUseForPointers!==L.activeCamera),t=L.cameraToUseForPointers||L.activeCamera,E=x.internalPickerForMesh||P;for(let C=0;C<L.meshes.length;C++){const x=L.meshes[C];if(p){if(!p(x,-1))continue}else if(!x.isEnabled()||!x.isVisible||!x.MG)continue;const w=G&&x.isWorldMatrixCameraDependent(),g=x.cz(w,t);if(x.hasThinInstances&&x.hC){const L=E(z,r,x,g,!0,!0,n);if(L){if(i)return L;const G=j.TmpVectors.Matrix[1],C=x.thinInstanceGetWorldMatrices();for(let L=0;L<C.length;L++){if(p&&!p(x,L))continue;C[L].multiplyToRef(g,G);const j=E(z,r,x,G,J,i,n,!0);if(j&&(z=j,z.thinInstanceIndex=L,J))return z}}}else{const L=E(z,r,x,g,J,i,n);if(L&&(z=L,J))return z}}return z||new C.d}function h(L,r,p,J){if(!C.d)return null;const i=[],n=!!(L.activeCameras&&L.activeCameras.length>1&&L.cameraToUseForPointers!==L.activeCamera),z=L.cameraToUseForPointers||L.activeCamera,G=x.internalPickerForMesh||P;for(let C=0;C<L.meshes.length;C++){const t=L.meshes[C];if(p){if(!p(t,-1))continue}else if(!t.isEnabled()||!t.isVisible||!t.MG)continue;const E=n&&t.isWorldMatrixCameraDependent(),x=t.cz(E,z);if(t.hasThinInstances&&t.hC){if(G(null,r,t,x,!0,!0,J)){const L=j.TmpVectors.Matrix[1],n=t.thinInstanceGetWorldMatrices();for(let j=0;j<n.length;j++){if(p&&!p(t,j))continue;n[j].multiplyToRef(x,L);const z=G(null,r,t,L,!1,!1,J,!0);z&&(z.thinInstanceIndex=j,i.push(z))}}}else{const L=G(null,r,t,x,!1,!1,J);L&&i.push(L)}}return i}function U(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,J=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;J||(J=L.getWorldMatrix()),r.length=p,i?r.origin.G(i):r.origin.G(L.position);const n=j.TmpVectors.cr[2];n.set(0,0,L._scene.useRightHandedSystem?-1:1);const z=j.TmpVectors.cr[3];return j.cr.TransformNormalToRef(n,J,z),j.cr.NormalizeToRef(z,r.direction),r}var W,B;w._TmpVector3=(0,z.e)(6,j.cr.Zero),w._RayDistant=w.Zero(),w._Smallnum=1e-8,w._Rayl=1e9,W=J.b,(B=i.b)&&(B.prototype.getForwardRay=function(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,r=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;return U(this,new w(j.cr.Zero(),j.cr.Zero(),L),L,r,p)},B.prototype.getForwardRayToRef=function(L){return U(this,L,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),W&&(E.c._IsPickingAvailable=!0,W.prototype.createPickingRay=function(L,r,p,J){return g(this,L,r,p,J,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),J.b.prototype.createPickingRayToRef=function(L,r,p,J,i){return b(this,L,r,p,J,i,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},J.b.prototype.createPickingRayInCameraSpace=function(L,r,p){return function(L,r,p,J){const i=w.Zero();return c(L,r,p,i,J),i}(this,L,r,p)},J.b.prototype.createPickingRayInCameraSpaceToRef=function(L,r,p,J){return c(this,L,r,p,J)},J.b.prototype.pickWithBoundingInfo=function(L,r,p,J,i){return function(L,r,p,J,i,n){if(!C.d)return null;const z=O(L,(J=>(L._tempPickingRay||(L._tempPickingRay=w.Zero()),b(L,r,p,J,L._tempPickingRay,n||null),L._tempPickingRay)),J,i,!0);return z&&(z.ray=g(L,r,p,j.Matrix.Identity(),n||null)),z}(this,L,r,p,J,i)},J.b.prototype.Op=function(L,r,p,J,i,n){return function(L,r,p,J,i,n,z){const G=O(L,((J,i)=>(L._tempPickingRay||(L._tempPickingRay=w.Zero()),b(L,r,p,J,L._tempPickingRay,n||null,!1,i),L._tempPickingRay)),J,i,!1,z);return G&&(G.ray=g(L,r,p,j.Matrix.Identity(),n||null)),G}(this,L,r,p,J,i,n)},J.b.prototype.pickWithRay=function(L,r,p,J){return function(L,r,p,J,i){const n=O(L,(p=>(L._pickWithRayInverseMatrix||(L._pickWithRayInverseMatrix=j.Matrix.Identity()),p.invertToRef(L._pickWithRayInverseMatrix),L._cachedRayForTransform||(L._cachedRayForTransform=w.Zero()),w.TransformToRef(r,L._pickWithRayInverseMatrix,L._cachedRayForTransform),L._cachedRayForTransform)),p,J,!1,i);return n&&(n.ray=r),n}(this,L,r,p,J)},J.b.prototype.multiPick=function(L,r,p,J,i){return function(L,r,p,J,i,n){return h(L,(J=>g(L,r,p,J,i||null)),J,n)}(this,L,r,p,J,i)},J.b.prototype.multiPickWithRay=function(L,r,p){return function(L,r,p,J){return h(L,(p=>(L._pickWithRayInverseMatrix||(L._pickWithRayInverseMatrix=j.Matrix.Identity()),p.invertToRef(L._pickWithRayInverseMatrix),L._cachedRayForTransform||(L._cachedRayForTransform=w.Zero()),w.TransformToRef(r,L._pickWithRayInverseMatrix,L._cachedRayForTransform),L._cachedRayForTransform)),p,J)}(this,L,r,p)}},13826:(L,r,p)=>{"use strict";var J=p(12060),i=p(11975),n=p(12014),j=p(12091),z=p(12037),G=p(12077);z.e.prototype._partialLoadFile=function(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(L,(L=>{p[r]=L,p._internalCount++,6===p._internalCount&&J(p)}),void 0,void 0,!0,((L,r)=>{i&&L&&i(L.status+" "+L.statusText,r)}))},z.e.prototype._cascadeLoadFiles=function(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=[];i._internalCount=0;for(let n=0;n<6;n++)this._partialLoadFile(p[n],n,i,r,J)},z.e.prototype._cascadeLoadImgs=function(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5?arguments[5]:void 0;const j=[];j._internalCount=0;for(let z=0;z<6;z++)this._partialLoadImg(J[z],z,j,L,r,p,i,n)},z.e.prototype._partialLoadImg=function(L,r,p,J,i,z){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0;const t=(0,j.d)();(0,n.t)(L,(L=>{p[r]=L,p._internalCount++,J&&J.removePendingData(t),6===p._internalCount&&z&&z(i,p)}),((L,r)=>{J&&J.removePendingData(t),G&&G(L,r)}),J?J.offlineProvider:null,C),J&&J.addPendingData(t)},z.e.prototype.createCubeTextureBase=function(L,r,p,n){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,w=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,P=arguments.length>14&&void 0!==arguments[14]&&arguments[14],O=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const h=g||new J.b(this,7);h.isCube=!0,h.url=L,h.generateMipMaps=!n,h._lodGenerationScale=x,h._lodGenerationOffset=w,h._useSRGBBuffer=!!P&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),h!==g&&(h.label=L.substring(0,60)),this._doNotHandleContextLost||(h._extension=t,h._files=p,h._buffer=O);const U=L;this._transformTextureUrl&&!g&&(L=this._transformTextureUrl(L));const W=t??function(L){const r=L.split("?")[0],p=r.lastIndexOf(".");return p>-1?r.substring(p).toLowerCase():""}(L),B=(0,G.d)(W),F=(L,r)=>{h.dispose(),z?z(L,r):L&&i.d.Warn(L)},Q=(J,z)=>{L===U?J&&F(J.status+" "+J.statusText,z):(i.d.Warn(`Failed to load ${L}, falling back to the ${U}`),this.createCubeTextureBase(U,r,p,!!n,j,F,C,t,E,x,w,h,b,c,P,O))};if(B)B.then((J=>{const i=L=>{b&&b(h,L),J.loadCubeData(L,h,E,j,((L,r)=>{F(L,r)}))};O?i(O):p&&6===p.length?J.supportCascades?this._cascadeLoadFiles(r,(L=>i(L.map((L=>new Uint8Array(L))))),p,F):F("Textures type does not support cascades."):this._loadFile(L,(L=>i(new Uint8Array(L))),void 0,void 0,!0,Q)}));else{if(!p||0===p.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(r,h,((L,r)=>{c&&c(L,r)}),p,F)}return this._internalTexturesCache.push(h),h}},14367:(L,r,p)=>{"use strict";p(11975);var J=p(12253);p(12060),p(12210),p(12055),p(12289),p(12261);J.b},13864:(L,r,p)=>{"use strict";p.d(r,{b:()=>i});var J=p(12087);class i{constructor(L){this.value=this._toInt(L)}_toInt(L){return 0|L}add(L){return new i(this.value+L.value)}Pr(L){return new i(this.value-L.value)}multiply(L){return new i(Math.imul(this.value,L.value))}divide(L){return new i(this.value/L.value)}getClassName(){return i.ClassName}equals(L){return this.value===L.value}static FromValue(L){return new i(L)}toString(){return this.value.toString()}}i.ClassName="FlowGraphInteger",(0,J.e)("FlowGraphInteger",i)},13873:(L,r,p)=>{"use strict";p.d(r,{c:()=>i,d:()=>n});var J=p(12136);class i{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ai=L}get m(){return this.ai}transformVector(L){return this.transformVectorToRef(L,new J.Vector2)}transformVectorToRef(L,r){return r.x=L.x*this.ai[0]+L.y*this.ai[1],r.y=L.x*this.ai[2]+L.y*this.ai[3],r}mz(){return this.toArray()}toArray(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let r=0;r<4;r++)L[r]=this.ai[r];return L}hp(L){for(let r=0;r<4;r++)this.ai[r]=L[r];return this}multiplyToRef(L,r){const p=L.ai,J=this.ai,i=r.ai;return i[0]=p[0]*J[0]+p[1]*J[2],i[1]=p[0]*J[1]+p[1]*J[3],i[2]=p[2]*J[0]+p[3]*J[2],i[3]=p[2]*J[1]+p[3]*J[3],r}multiply(L){return this.multiplyToRef(L,new i)}divideToRef(L,r){const p=this.ai,J=L.ai,i=r.ai;return i[0]=p[0]/J[0],i[1]=p[1]/J[1],i[2]=p[2]/J[2],i[3]=p[3]/J[3],r}divide(L){return this.divideToRef(L,new i)}addToRef(L,r){const p=this.ai,J=L.m,i=r.m;return i[0]=p[0]+J[0],i[1]=p[1]+J[1],i[2]=p[2]+J[2],i[3]=p[3]+J[3],r}add(L){return this.addToRef(L,new i)}subtractToRef(L,r){const p=this.ai,J=L.m,i=r.m;return i[0]=p[0]-J[0],i[1]=p[1]-J[1],i[2]=p[2]-J[2],i[3]=p[3]-J[3],r}Pr(L){return this.subtractToRef(L,new i)}transpose(){const L=this.ai;return new i([L[0],L[2],L[1],L[3]])}determinant(){const L=this.ai;return L[0]*L[3]-L[1]*L[2]}inverse(){const L=this.determinant();if(0===L)throw new Error("Matrix is not invertible");const r=this.ai,p=1/L;return new i([r[3]*p,-r[1]*p,-r[2]*p,r[0]*p])}equals(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const p=this.ai,J=L.m;return 0===r?p[0]===J[0]&&p[1]===J[1]&&p[2]===J[2]&&p[3]===J[3]:Math.abs(p[0]-J[0])<r&&Math.abs(p[1]-J[1])<r&&Math.abs(p[2]-J[2])<r&&Math.abs(p[3]-J[3])<r}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ai.join(", ")})`}}class n{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ai=L}get m(){return this.ai}transformVector(L){return this.transformVectorToRef(L,new J.cr)}transformVectorToRef(L,r){const p=this.ai;return r.x=L.x*p[0]+L.y*p[1]+L.z*p[2],r.y=L.x*p[3]+L.y*p[4]+L.z*p[5],r.z=L.x*p[6]+L.y*p[7]+L.z*p[8],r}multiplyToRef(L,r){const p=L.ai,J=this.ai,i=r.m;return i[0]=p[0]*J[0]+p[1]*J[3]+p[2]*J[6],i[1]=p[0]*J[1]+p[1]*J[4]+p[2]*J[7],i[2]=p[0]*J[2]+p[1]*J[5]+p[2]*J[8],i[3]=p[3]*J[0]+p[4]*J[3]+p[5]*J[6],i[4]=p[3]*J[1]+p[4]*J[4]+p[5]*J[7],i[5]=p[3]*J[2]+p[4]*J[5]+p[5]*J[8],i[6]=p[6]*J[0]+p[7]*J[3]+p[8]*J[6],i[7]=p[6]*J[1]+p[7]*J[4]+p[8]*J[7],i[8]=p[6]*J[2]+p[7]*J[5]+p[8]*J[8],r}multiply(L){return this.multiplyToRef(L,new n)}divideToRef(L,r){const p=this.ai,J=L.m,i=r.m;return i[0]=p[0]/J[0],i[1]=p[1]/J[1],i[2]=p[2]/J[2],i[3]=p[3]/J[3],i[4]=p[4]/J[4],i[5]=p[5]/J[5],i[6]=p[6]/J[6],i[7]=p[7]/J[7],i[8]=p[8]/J[8],r}divide(L){return this.divideToRef(L,new n)}addToRef(L,r){const p=this.ai,J=L.m,i=r.m;return i[0]=p[0]+J[0],i[1]=p[1]+J[1],i[2]=p[2]+J[2],i[3]=p[3]+J[3],i[4]=p[4]+J[4],i[5]=p[5]+J[5],i[6]=p[6]+J[6],i[7]=p[7]+J[7],i[8]=p[8]+J[8],r}add(L){return this.addToRef(L,new n)}subtractToRef(L,r){const p=this.ai,J=L.m,i=r.m;return i[0]=p[0]-J[0],i[1]=p[1]-J[1],i[2]=p[2]-J[2],i[3]=p[3]-J[3],i[4]=p[4]-J[4],i[5]=p[5]-J[5],i[6]=p[6]-J[6],i[7]=p[7]-J[7],i[8]=p[8]-J[8],r}Pr(L){return this.subtractToRef(L,new n)}toArray(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let r=0;r<9;r++)L[r]=this.ai[r];return L}mz(){return this.toArray()}hp(L){for(let r=0;r<9;r++)this.ai[r]=L[r];return this}transpose(){const L=this.ai;return new n([L[0],L[3],L[6],L[1],L[4],L[7],L[2],L[5],L[8]])}determinant(){const L=this.ai;return L[0]*(L[4]*L[8]-L[5]*L[7])-L[1]*(L[3]*L[8]-L[5]*L[6])+L[2]*(L[3]*L[7]-L[4]*L[6])}inverse(){const L=this.determinant();if(0===L)throw new Error("Matrix is not invertible");const r=this.ai,p=1/L;return new n([(r[4]*r[8]-r[5]*r[7])*p,(r[2]*r[7]-r[1]*r[8])*p,(r[1]*r[5]-r[2]*r[4])*p,(r[5]*r[6]-r[3]*r[8])*p,(r[0]*r[8]-r[2]*r[6])*p,(r[2]*r[3]-r[0]*r[5])*p,(r[3]*r[7]-r[4]*r[6])*p,(r[1]*r[6]-r[0]*r[7])*p,(r[0]*r[4]-r[1]*r[3])*p])}equals(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const p=this.ai,J=L.m;return 0===r?p[0]===J[0]&&p[1]===J[1]&&p[2]===J[2]&&p[3]===J[3]&&p[4]===J[4]&&p[5]===J[5]&&p[6]===J[6]&&p[7]===J[7]&&p[8]===J[8]:Math.abs(p[0]-J[0])<r&&Math.abs(p[1]-J[1])<r&&Math.abs(p[2]-J[2])<r&&Math.abs(p[3]-J[3])<r&&Math.abs(p[4]-J[4])<r&&Math.abs(p[5]-J[5])<r&&Math.abs(p[6]-J[6])<r&&Math.abs(p[7]-J[7])<r&&Math.abs(p[8]-J[8])<r}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ai.join(", ")})`}}},13877:(L,r,p)=>{"use strict";var J;function i(L,r,p,J){switch(r){case"Animation":return J?L.animations.find((L=>L.uniqueId===p))??null:L.animations[p]??null;case"AnimationGroup":return J?L.animationGroups.find((L=>L.uniqueId===p))??null:L.animationGroups[p]??null;case"Mesh":return J?L.meshes.find((L=>L.uniqueId===p))??null:L.meshes[p]??null;case"Material":return J?L.materials.find((L=>L.uniqueId===p))??null:L.materials[p]??null;case"wt":return J?L.cameras.find((L=>L.uniqueId===p))??null:L.cameras[p]??null;case"Light":return J?L.lights.find((L=>L.uniqueId===p))??null:L.lights[p]??null;default:return null}}p.d(r,{e:()=>i}),function(L){L.Animation="Animation",L.AnimationGroup="AnimationGroup",L.Mesh="Mesh",L.Material="Material",L.wt="wt",L.Light="Light"}(J||(J={}))},13913:(L,r,p)=>{"use strict";p.d(r,{d:()=>i});var J=p(13922);class i extends J.e{constructor(L,r){if(super(L),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),r)for(const p of r)this._eventsSignalOutputs[p]=this._registerSignalOutput(p+"Event")}_executeOnTick(L){}_startPendingTasks(L){L._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(L),this._resetAfterCanceled(L)),this._preparePendingTasks(L),L._addPendingBlock(this),this.out._activateSignal(L),L._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(L){L._deleteExecutionVariable(this,"_initialized"),L._removePendingBlock(this)}}},13882:(L,r,p)=>{"use strict";p.d(r,{b:()=>C});var J=p(12091),i=p(12087),n=p(13886),j=p(11964),z=p(13858);class G extends n.d{constructor(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:J.defaultValue,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(L,r,p),this.richType=J,this._defaultValue=i,this._optional=n,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new j.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(L){this._isDisabled!==L&&(this._isDisabled=L,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(L,r){r._getConnectionValue(this)!==L&&(r._setConnectionValue(this,L),this.onValueChangedObservable.notifyObservers(L))}resetToDefaultValue(L){L._setConnectionValue(this,this._defaultValue)}connectTo(L){this._isDisabled||super.connectTo(L)}_getValueOrDefault(L){const r=L._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(r):r}getValue(L){if(1===this.connectionType){L._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(L);const r=this._getValueOrDefault(L);return this._lastValue=r,this.richType.typeTransformer?this.richType.typeTransformer(r):r}const r=this.isConnected()?this._connectedPoint[0].getValue(L):this._getValueOrDefault(L);return this._lastValue=r,this.richType.typeTransformer?this.richType.typeTransformer(r):r}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(L),L.richType={},this.richType.serialize(L.richType),L.optional=this._optional,(0,z.f)("defaultValue",this._defaultValue,L)}}(0,i.e)("FlowGraphDataConnection",G);class C{constructor(L){var r;this.config=L,this.uniqueId=(0,J.d)(),this.name=(null===(r=this.config)||void 0===r?void 0:r.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(L){}registerDataInput(L,r,p){const J=new G(L,0,this,r,p);return this.dataInputs.push(J),J}registerDataOutput(L,r,p){const J=new G(L,1,this,r,p);return this.dataOutputs.push(J),J}getDataInput(L){return this.dataInputs.find((r=>r.name===L))}getDataOutput(L){return this.dataOutputs.find((r=>r.name===L))}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.f;if(L.uniqueId=this.uniqueId,L.config={},this.config){const p=this.config,J=Object.keys(p);for(const i of J)r(i,p[i],L.config)}L.dataInputs=[],L.dataOutputs=[],L.className=this.getClassName();for(const p of this.dataInputs){const r={};p.serialize(r),L.dataInputs.push(r)}for(const p of this.dataOutputs){const r={};p.serialize(r),L.dataOutputs.push(r)}}deserialize(L){}_log(L,r,p){var J;null===(J=L.logger)||void 0===J||J.addLogItem({action:r,Wp:p,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13886:(L,r,p)=>{"use strict";p.d(r,{d:()=>n});var J,i=p(12091);!function(L){L[L.Input=0]="Input",L[L.Output=1]="Output"}(J||(J={}));class n{constructor(L,r,p){this._ownerBlock=p,this._connectedPoint=[],this.uniqueId=(0,i.d)(),this.connectedPointIds=[],this.name=L,this._connectionType=r}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(L){if(this._connectionType===L._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||L._isSingularConnection()&&L._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(L),L._connectedPoint.push(this)}disconnectFrom(L){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const p=this._connectedPoint.indexOf(L),J=L._connectedPoint.indexOf(this);-1!==p&&-1!==J&&(r&&this._connectedPoint.splice(p,1),L._connectedPoint.splice(J,1))}disconnectFromAll(){for(const L of this._connectedPoint)this.disconnectFrom(L,!1);this._connectedPoint.length=0}dispose(){for(const L of this._connectedPoint)this.disconnectFrom(L)}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};L.uniqueId=this.uniqueId,L.name=this.name,L._connectionType=this._connectionType,L.connectedPointIds=[],L.className=this.getClassName();for(const r of this._connectedPoint)L.connectedPointIds.push(r.uniqueId)}getClassName(){return"FGConnection"}deserialize(L){this.uniqueId=L.uniqueId,this.name=L.name,this._connectionType=L._connectionType,this.connectedPointIds=L.connectedPointIds}}},13849:(L,r,p)=>{"use strict";p.d(r,{b:()=>h});var J,i=p(11964),n=p(12113),j=p(12122),z=p(12091),G=p(13858),C=p(13877),t=p(11975);!function(L){L.ExecuteBlock="ExecuteBlock",L.ExecuteEvent="ExecuteEvent",L.TriggerConnection="TriggerConnection",L.ContextVariableSet="ContextVariableSet",L.GlobalVariableSet="GlobalVariableSet",L.GlobalVariableDelete="GlobalVariableDelete",L.GlobalVariableGet="GlobalVariableGet",L.AddConnection="AddConnection",L.GetConnectionValue="GetConnectionValue",L.SetConnectionValue="SetConnectionValue",L.ActivateSignal="ActivateSignal",L.ContextVariableGet="ContextVariableGet"}(J||(J={}));class E{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(L){if(L.time||(L.time=Date.now()),this.log.push(L),this.logToConsole){var r;const p=null===(r=L.Wp)||void 0===r?void 0:r.value;"object"===typeof p&&p.getClassName?t.d.Log(`[FGLog] ${L.className}:${L.uniqueId.split("-")[0]} ${L.action} - ${JSON.stringify(p.getClassName())}: ${p.toString()}`):t.d.Log(`[FGLog] ${L.className}:${L.uniqueId.split("-")[0]} ${L.action} - ${JSON.stringify(L.Wp)}`)}}getItemsOfType(L){return this.log.filter((r=>r.action===L))}}class x{get enableLogging(){return this._enableLogging}set enableLogging(L){this._enableLogging!==L&&(this._enableLogging=L,this._enableLogging?(this.logger=new E,this.logger.logToConsole=!0):this.logger=null)}constructor(L){this.uniqueId=(0,z.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new i.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=L,this.assetsContext=L.assetsContext??L.Or}hasVariable(L){return L in this._userVariables}setVariable(L,r){var p;this._userVariables[L]=r,null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Wp:{name:L,value:r}})}getAsset(L,r){return(0,C.e)(this.assetsContext,L,r)}getVariable(L){var r;return null===(r=this.logger)||void 0===r||r.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Wp:{name:L,value:this._userVariables[L]}}),this._userVariables[L]}get userVariables(){return this._userVariables}FL(){return this._configuration.Or}_getUniqueIdPrefixedName(L,r){return`${L.uniqueId}_${r}`}_getGlobalContextVariable(L,r){var p;return null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Wp:{name:L,defaultValue:r,possibleValue:this._globalContextVariables[L]}}),this._hasGlobalContextVariable(L)?this._globalContextVariables[L]:r}_setGlobalContextVariable(L,r){var p;null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Wp:{name:L,value:r}}),this._globalContextVariables[L]=r}_deleteGlobalContextVariable(L){var r;null===(r=this.logger)||void 0===r||r.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Wp:{name:L}}),delete this._globalContextVariables[L]}_hasGlobalContextVariable(L){return L in this._globalContextVariables}_setExecutionVariable(L,r,p){this._executionVariables[this._getUniqueIdPrefixedName(L,r)]=p}_getExecutionVariable(L,r,p){return this._hasExecutionVariable(L,r)?this._executionVariables[this._getUniqueIdPrefixedName(L,r)]:p}_deleteExecutionVariable(L,r){delete this._executionVariables[this._getUniqueIdPrefixedName(L,r)]}_hasExecutionVariable(L,r){return this._getUniqueIdPrefixedName(L,r)in this._executionVariables}_hasConnectionValue(L){return L.uniqueId in this._connectionValues}_setConnectionValue(L,r){var p;this._connectionValues[L.uniqueId]=r,null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Wp:{connectionPointId:L.uniqueId,value:r}})}_setConnectionValueByKey(L,r){this._connectionValues[L]=r}_getConnectionValue(L){var r;return null===(r=this.logger)||void 0===r||r.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Wp:{connectionPointId:L.uniqueId,value:this._connectionValues[L.uniqueId]}}),this._connectionValues[L.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(L){this._pendingBlocks.includes(L)||(this._pendingBlocks.push(L),this._pendingBlocks.sort(((L,r)=>L.priority-r.priority)))}_removePendingBlock(L){const r=this._pendingBlocks.indexOf(L);-1!==r&&this._pendingBlocks.splice(r,1)}_clearPendingBlocks(){for(const L of this._pendingBlocks)L._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(L){var r;this.onNodeExecutedObservable.notifyObservers(L),null===(r=this.logger)||void 0===r||r.addLogItem({time:Date.now(),className:L.getClassName(),uniqueId:L.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(L){this._setGlobalContextVariable("timeSinceStart",L.timeSinceStart),this._setGlobalContextVariable("deltaTime",L.deltaTime);for(const p of this._pendingBlocks){var r;null===(r=p._executeOnTick)||void 0===r||r.call(p,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.f;L.uniqueId=this.uniqueId,L._userVariables={};for(const J in this._userVariables)r(J,this._userVariables[J],L._userVariables);L._connectionValues={};for(const J in this._connectionValues)r(J,this._connectionValues[J],L._connectionValues);var p;this.assetsContext!==this.FL()&&(L._assetsContext={meshes:this.assetsContext.meshes.map((L=>L.id)),materials:this.assetsContext.materials.map((L=>L.id)),textures:this.assetsContext.textures.map((L=>L.name)),animations:this.assetsContext.animations.map((L=>L.name)),lights:this.assetsContext.lights.map((L=>L.id)),cameras:this.assetsContext.cameras.map((L=>L.id)),Mx:null===(p=this.assetsContext.Mx)||void 0===p?void 0:p.map((L=>L.name)),skeletons:this.assetsContext.skeletons.map((L=>L.id)),SE:this.assetsContext.SE.map((L=>L.name)),geometries:this.assetsContext.geometries.map((L=>L.id)),multiMaterials:this.assetsContext.multiMaterials.map((L=>L.id)),transformNodes:this.assetsContext.transformNodes.map((L=>L.id))})}getClassName(){return"FlowGraphContext"}}(0,n.e)([(0,j.E)()],x.prototype,"uniqueId",void 0);var w=p(13879),g=p(12398);class b{constructor(L){this.onEventTriggeredObservable=new i.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=L,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.ji.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const L=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Wp:{timeSinceStart:this._startingTime,deltaTime:L}}),this._startingTime+=L})),this._meshPickedObserver=this._scene.onPointerObservable.add((L=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Wp:L})}),g.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((L=>{const r=L.pointerId,p=L.mesh,J=this._pointerUnderMeshState[r];!J&&p?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Wp:{pointerId:r,mesh:p}}):J&&!p?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Wp:{pointerId:r,mesh:J}}):J&&p&&J!==p&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Wp:{pointerId:r,mesh:J,over:p}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Wp:{pointerId:r,mesh:p,out:J}})),this._pointerUnderMeshState[r]=p}),g.b.POINTERMOVE)}dispose(){var L,r,p,J,i;null===(L=this._sceneDisposeObserver)||void 0===L||L.remove(),null===(r=this._sceneReadyObserver)||void 0===r||r.remove(),null===(p=this._sceneOnBeforeRenderObserver)||void 0===p||p.remove(),null===(J=this._meshPickedObserver)||void 0===J||J.remove(),null===(i=this._meshUnderPointerObserver)||void 0===i||i.remove(),this.onEventTriggeredObservable.clear()}}var c,P=p(13895);!function(L){L[L.Stopped=0]="Stopped",L[L.Started=1]="Started"}(c||(c={}));class O{get state(){return this._state}set state(L){this._state=L,this.onStateChangedObservable.notifyObservers(L)}constructor(L){this.onStateChangedObservable=new i.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=L.Or,this._sceneEventCoordinator=new b(this._scene),this._coordinator=L.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((L=>{for(const r of this._executionContexts){const p=this._getContextualOrder(L.type,r);for(const J of p)if(!J._executeEvent(r,L.Wp))break}switch(L.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const r of this._executionContexts)r._notifyOnTick(L.Wp);break;case"SceneDispose":this.dispose()}}))}createContext(){const L=new x({Or:this._scene,coordinator:this._coordinator});return this._executionContexts.push(L),L}getContext(L){return this._executionContexts[L]}addEventBlock(L){if("PointerOver"!==L.type&&"PointerOut"!==L.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==L.type&&this._eventBlocks[L.type].push(L),1===this.state)for(const r of this._executionContexts)L._startPendingTasks(r);else this.onStateChangedObservable.addOnce((r=>{if(1===r)for(const p of this._executionContexts)L._startPendingTasks(p)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((L=>{1===L&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const L of this._executionContexts)for(const r in this._eventBlocks){const p=this._getContextualOrder(r,L);for(const r of p)r._startPendingTasks(L)}}_getContextualOrder(L,r){const p=this._eventBlocks[L].sort(((L,r)=>r.initPriority-L.initPriority));if("MeshPick"===L){const L=[];for(const J of p){const i=J.asset.getValue(r);let n=0;for(;n<p.length;n++){const L=p[n].asset.getValue(r);if(i&&L&&(0,P.o)(i,L))break}L.splice(n,0,J)}return L}return p}dispose(){var L;if(0!==this.state){this.state=0;for(const L of this._executionContexts)L._clearPendingBlocks();this._executionContexts.length=0;for(const L in this._eventBlocks)this._eventBlocks[L].length=0;null===(L=this._eventObserver)||void 0===L||L.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(L){const r=[],p=new Set;for(const J in this._eventBlocks)for(const L of this._eventBlocks[J])r.push(L),p.add(L.uniqueId);for(;r.length>0;){const J=r.pop();L(J);for(const L of J.dataInputs)for(const J of L._connectedPoint)p.has(J._ownerBlock.uniqueId)||(r.push(J._ownerBlock),p.add(J._ownerBlock.uniqueId));if(J instanceof w.b)for(const L of J.signalOutputs)for(const J of L._connectedPoint)p.has(J._ownerBlock.uniqueId)||(r.push(J._ownerBlock),p.add(J._ownerBlock.uniqueId))}}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;L.allBlocks=[],this.visitAllBlocks((r=>{const p={};r.serialize(p),L.allBlocks.push(p)})),L.executionContexts=[];for(const p of this._executionContexts){const J={};p.serialize(J,r),L.executionContexts.push(J)}}}class h{constructor(L){this.config=L,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Or.ji.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Or.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const L=this._executeOnNextFrame.slice(0);if(L.length)for(const r of L){this.notifyCustomEvent(r.id,r.data,!1);const L=this._executeOnNextFrame.findIndex((L=>L.uniqueId===r.uniqueId));-1!==L&&this._executeOnNextFrame.splice(L,1)}}));(h.SceneCoordinators.get(this.config.Or)??[]).push(this)}createGraph(){const L=new O({Or:this.config.Or,coordinator:this});return this._flowGraphs.push(L),L}removeGraph(L){const r=this._flowGraphs.indexOf(L);-1!==r&&(L.dispose(),this._flowGraphs.splice(r,1))}start(){for(const L of this._flowGraphs)L.start()}dispose(){var L,r;for(const i of this._flowGraphs)i.dispose();this._flowGraphs.length=0,null===(L=this._disposeObserver)||void 0===L||L.remove(),null===(r=this._onBeforeRenderObserver)||void 0===r||r.remove();const p=h.SceneCoordinators.get(this.config.Or)??[],J=p.indexOf(this);-1!==J&&p.splice(J,1)}serialize(L,r){L._flowGraphs=[];for(const p of this._flowGraphs){const J={};p.serialize(J,r),L._flowGraphs.push(J)}L.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(L){let r=this._customEventsMap.get(L);return r||(r=new i.c,this._customEventsMap.set(L,r)),r}notifyCustomEvent(L,r){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:L,data:r,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(L)){const r=this._eventExecutionCounter.get(L);if(this._eventExecutionCounter.set(L,r+1),r>=h.MaxEventTypeExecutionPerFrame)return void(r===h.MaxEventTypeExecutionPerFrame&&t.d.Warn(`FlowGraphCoordinator: Too many executions of event "${L}".`))}else this._eventExecutionCounter.set(L,1);const p=this._customEventsMap.get(L);p&&p.notifyObservers(r)}}h.MaxEventsPerType=30,h.MaxEventTypeExecutionPerFrame=30,h.SceneCoordinators=new Map},13904:(L,r,p)=>{"use strict";p.d(r,{b:()=>i});var J=p(13913);class i extends J.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(L){L._notifyExecuteNode(this),this.done._activateSignal(L)}}},13879:(L,r,p)=>{"use strict";p.d(r,{b:()=>z});var J=p(13882),i=p(13886),n=p(12087);class j extends i.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(L){super.connectTo(L),this._connectedPoint.sort(((L,r)=>r.priority-L.priority))}_activateSignal(L){var r;if(null===(r=L.logger)||void 0===r||r.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Wp:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)L._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(L,this),L._increaseExecutionId();else for(const p of this._connectedPoint)p._activateSignal(L)}}(0,n.e)("FlowGraphSignalConnection",j);class z extends J.b{constructor(L){super(L),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(L){const r=new j(L,0,this);return this.signalInputs.push(r),r}_registerSignalOutput(L){const r=new j(L,1,this);return this.signalOutputs.push(r),r}_unregisterSignalInput(L){const r=this.signalInputs.findIndex((r=>r.name===L));-1!==r&&(this.signalInputs[r].dispose(),this.signalInputs.splice(r,1))}_unregisterSignalOutput(L){const r=this.signalOutputs.findIndex((r=>r.name===L));-1!==r&&(this.signalOutputs[r].dispose(),this.signalOutputs.splice(r,1))}_reportError(L,r){this.error.Wp="string"===typeof r?new Error(r):r,this.error._activateSignal(L)}getSignalInput(L){return this.signalInputs.find((r=>r.name===L))}getSignalOutput(L){return this.signalOutputs.find((r=>r.name===L))}serialize(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(L),L.signalInputs=[],L.signalOutputs=[];for(const r of this.signalInputs){const p={};r.serialize(p),L.signalInputs.push(p)}for(const r of this.signalOutputs){const p={};r.serialize(p),L.signalOutputs.push(p)}}deserialize(L){for(let r=0;r<L.signalInputs.length;r++){const p=this.getSignalInput(L.signalInputs[r].name);if(!p)throw new Error("Could not find signal input with name "+L.signalInputs[r].name+" in block "+L.className);p.deserialize(L.signalInputs[r])}for(let r=0;r<L.signalOutputs.length;r++){const p=this.getSignalOutput(L.signalOutputs[r].name);if(!p)throw new Error("Could not find signal output with name "+L.signalOutputs[r].name+" in block "+L.className);p.deserialize(L.signalOutputs[r])}}getClassName(){return"FlowGraphExecutionBlock"}}},13922:(L,r,p)=>{"use strict";p.d(r,{e:()=>i});var J=p(13879);class i extends J.b{constructor(L){super(L),this.out=this._registerSignalOutput("out")}}},13868:(L,r,p)=>{"use strict";p.d(r,{A:()=>t,E:()=>w,G:()=>g,I:()=>b,K:()=>e,N:()=>v,R:()=>Q,U:()=>F,d:()=>C,h:()=>x,k:()=>B,n:()=>c,o:()=>P,s:()=>O,v:()=>E,w:()=>W});var J,i=p(12136),n=p(12170),j=p(13864),z=p(13873);!function(L){L.Any="any",L.String="string",L.Number="number",L.Boolean="boolean",L.Object="object",L.Integer="FlowGraphInteger",L.Vector2="Vector2",L.cr="cr",L.Vector4="Vector4",L.Quaternion="Quaternion",L.Matrix="Matrix",L.Matrix2D="Matrix2D",L.Matrix3D="Matrix3D",L.Wr="Wr",L.Fz="Fz"}(J||(J={}));class G{constructor(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=L,this.defaultValue=r,this.animationType=p}serialize(L){L.typeName=this.typeName,L.defaultValue=this.defaultValue}}const C=new G("any",void 0),t=new G("string",""),E=new G("number",0,0),x=new G("boolean",!1),w=new G("Vector2",i.Vector2.Zero(),5),g=new G("cr",i.cr.Zero(),1),b=new G("Vector4",i.Vector4.Zero()),c=new G("Matrix",i.Matrix.Identity(),3),P=new G("Matrix2D",new z.c),O=new G("Matrix3D",new z.d),h=new G("Wr",n.Wr.Black(),4),U=new G("Fz",new n.Fz(0,0,0,0),7),W=new G("Quaternion",i.Quaternion.Identity(),2);W.typeTransformer=L=>{if(L.getClassName){if("Vector4"===L.getClassName())return i.Quaternion.Br(L.mz());if("cr"===L.getClassName())return i.Quaternion.FromEulerVector(L);if("Matrix"===L.getClassName())return i.Quaternion.FromRotationMatrix(L)}return L};const B=new G("FlowGraphInteger",new j.b(0),0);function F(L){const r=L;switch(typeof L){case"string":return t;case"number":return E;case"boolean":return x;case"object":if(r.getClassName)switch(r.getClassName()){case"Vector2":return w;case"cr":return g;case"Vector4":return b;case"Matrix":return c;case"Wr":return h;case"Fz":return U;case"Quaternion":return W;case"FlowGraphInteger":return B;case"Matrix2D":return P;case"Matrix3D":return O}return C;default:return C}}function Q(L){switch(L){case"string":return t;case"number":return E;case"boolean":return x;case"Vector2":return w;case"cr":return g;case"Vector4":return b;case"Matrix":return c;case"Wr":return h;case"Fz":return U;case"Quaternion":return W;case"FlowGraphInteger":return B;case"Matrix2D":return P;case"Matrix3D":return O;default:return C}}function e(L){switch(L){case"number":default:return 0;case"Vector2":return 5;case"cr":return 1;case"Matrix":return 3;case"Wr":return 4;case"Fz":return 7;case"Quaternion":return 2}}function v(L){switch(L){case 0:return E;case 5:return w;case 1:return g;case 3:return c;case 4:return h;case 7:return U;case 2:return W;default:return C}}},13858:(L,r,p)=>{"use strict";p.d(r,{b:()=>t,f:()=>C,i:()=>E});var J=p(12170),i=p(12136),n=p(13864),j=p(13868),z=p(13873);function G(L){return"Vector2"===L||"cr"===L||"Vector4"===L||"Quaternion"===L||"Wr"===L||"Fz"===L}function C(L,r,p){var J;const i=(null===r||void 0===r||null===(J=r.getClassName)||void 0===J?void 0:J.call(r))??"";if(G(i)||function(L){return"Matrix"===L||"Matrix2D"===L||"Matrix3D"===L}(i))p[L]={value:r.mz(),className:i};else if("FlowGraphInteger"===i)p[L]={value:r.value,className:i};else if(i&&(r.id||r.name))p[L]={id:r.id,name:r.name,className:i};else{if("object"===typeof r)throw new Error(`Could not serialize value ${r}`);p[L]=r}}function t(L,r,p,C){const E=r[L];let x;const w=(null===E||void 0===E?void 0:E.type)??(null===E||void 0===E?void 0:E.className);if(function(L){return"Mesh"===L||"AbstractMesh"===L||"GroundMesh"===L||"InstanceMesh"===L||"LinesMesh"===L||"GoldbergMesh"===L||"GreasedLineMesh"===L||"TrailMesh"===L}(w)){let L=C.meshes.filter((L=>E.id?L.id===E.id:L.name===E.name));0===L.length&&(L=C.transformNodes.filter((L=>E.id?L.id===E.id:L.name===E.name))),x=E.uniqueId?L.find((L=>L.uniqueId===E.uniqueId)):L[0]}else if(G(w))x=function(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===L)return i.Vector2.Br(r);if("cr"===L)return p&&(r[2]*=-1),i.cr.Br(r);if("Vector4"===L)return i.Vector4.Br(r);if("Quaternion"===L)return p&&(r[2]*=-1,r[3]*=-1),i.Quaternion.Br(r);if("Wr"===L)return new J.Wr(r[0],r[1],r[2]);if("Fz"===L)return new J.Fz(r[0],r[1],r[2],r[3]);throw new Error(`Unknown vector class name ${L}`)}(w,E.value);else if(function(L){return"AnimationGroup"===L}(w)){const L=C.animationGroups.filter((L=>L.name===E.name));x=1===L.length?L[0]:L.find((L=>L.uniqueId===E.uniqueId))}else x="Matrix"===w?i.Matrix.Br(E.value):"Matrix2D"===w?new z.c(E.value):"Matrix3D"===w?new z.d(E.value):"FlowGraphInteger"===w?n.b.FromValue(E.value):"number"===w||"string"===w||"boolean"===w?E.value[0]:E&&void 0!==E.value?E.value:Array.isArray(E)?E.reduce(((L,r)=>r.eventData?(L[r.id]={type:(0,j.R)(r.type)},"undefined"!==typeof r.value&&(L[r.id].value=t("value",r,p,C)),L):L),{}):E;return x}function E(L){return"FlowGraphJsonPointerParserBlock"===L}},13895:(L,r,p)=>{"use strict";function J(L,r){return!(!L.parent||L.parent!==r&&!J(L.parent,r))}function i(L){if(L.getClassName)return L.getClassName()}function n(L,r){return L===r&&("Vector2"===L||"cr"===L||"Vector4"===L||"Quaternion"===L)}function j(L,r){return L===r&&("Matrix"===L||"Matrix2D"===L||"Matrix3D"===L)}function z(L,r){return"FlowGraphInteger"===L&&"FlowGraphInteger"===r}function G(L,r){const p="number"===typeof L||"number"===typeof(null===L||void 0===L?void 0:L.value);return p&&!r?!isNaN(C(L)):p}function C(L){return"number"===typeof L?L:L.value}p.d(r,{e:()=>z,h:()=>j,k:()=>n,n:()=>i,o:()=>J,p:()=>C,t:()=>G})},13212:(L,r,p)=>{"use strict";p.r(r),p.d(r,{SceneInstrumentation:()=>n});var J=p(11957),i=p(12328);class n{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(L){L!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=L,L?(this._onBeforeActiveMeshesEvaluationObserver=this.Or.onBeforeActiveMeshesEvaluationObservable.add((()=>{J.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Or.onAfterActiveMeshesEvaluationObservable.add((()=>{J.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Or.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Or.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(L){L!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=L,L?(this._onBeforeRenderTargetsRenderObserver=this.Or.onBeforeRenderTargetsRenderObservable.add((()=>{J.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Or.onAfterRenderTargetsRenderObservable.add((()=>{J.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Or.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Or.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(L){L!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=L,L?(this._onBeforeParticlesRenderingObserver=this.Or.onBeforeParticlesRenderingObservable.add((()=>{J.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Or.onAfterParticlesRenderingObservable.add((()=>{J.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Or.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Or.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(L){L!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=L,this.Or.spriteManagers&&(L?(this._onBeforeSpritesRenderingObserver=this.Or.onBeforeSpritesRenderingObservable.add((()=>{J.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Or.onAfterSpritesRenderingObservable.add((()=>{J.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Or.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Or.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(L){L!==this._capturePhysicsTime&&this.Or.onBeforePhysicsObservable&&(this._capturePhysicsTime=L,L?(this._onBeforePhysicsObserver=this.Or.onBeforePhysicsObservable.add((()=>{J.Tools.StartPerformanceCounter("ng"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Or.onAfterPhysicsObservable.add((()=>{J.Tools.EndPerformanceCounter("ng"),this._physicsTime.endMonitoring()}))):(this.Or.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Or.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(L){L!==this._captureAnimationsTime&&(this._captureAnimationsTime=L,L?this._onAfterAnimationsObserver=this.Or.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Or.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(L){this._captureFrameTime=L}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(L){this._captureInterFrameTime=L}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(L){L!==this._captureRenderTime&&(this._captureRenderTime=L,L?(this._onBeforeDrawPhaseObserver=this.Or.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),J.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Or.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),J.Tools.EndPerformanceCounter("Main render")}))):(this.Or.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Or.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(L){L!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=L,L?(this._onBeforeCameraRenderObserver=this.Or.onBeforeCameraRenderObservable.add((L=>{this._cameraRenderTime.beginMonitoring(),J.Tools.StartPerformanceCounter(`Rendering camera ${L.name}`)})),this._onAfterCameraRenderObserver=this.Or.onAfterCameraRenderObservable.add((L=>{this._cameraRenderTime.endMonitoring(!1),J.Tools.EndPerformanceCounter(`Rendering camera ${L.name}`)}))):(this.Or.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Or.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Or.getEngine()._drawCalls}constructor(L){this.Or=L,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new i.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new i.c,this._captureFrameTime=!1,this._frameTime=new i.c,this._captureRenderTime=!1,this._renderTime=new i.c,this._captureInterFrameTime=!1,this._interFrameTime=new i.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new i.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new i.c,this._capturePhysicsTime=!1,this._physicsTime=new i.c,this._captureAnimationsTime=!1,this._animationsTime=new i.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new i.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=L.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(J.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Or.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=L.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(J.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ni(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ni(),this._captureParticlesRenderTime&&this._particlesRenderTime.ni(),this._captureSpritesRenderTime&&this._spritesRenderTime.ni(),this._captureRenderTime&&this._renderTime.ni(),this._captureCameraRenderTime&&this._cameraRenderTime.ni()}))}dispose(){this._disposed||(this.Or.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Or.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Or.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Or.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Or.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Or.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Or.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Or.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Or.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Or.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Or.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Or.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Or.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Or.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Or.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Or.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Or.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Or=null,this._disposed=!0)}}},13840:(L,r,p)=>{"use strict";p.d(r,{e:()=>t});var J=p(12113),i=p(12122),n=p(12136),j=p(12543),z=p(12654),G=p(12721),C=p(12087);j.d.AddNodeConstructor("Light_Type_1",((L,r)=>()=>new t(L,n.cr.Zero(),r)));class t extends G.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(L){this._shadowFrustumSize=L,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(L){this._shadowOrthoScale=L,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(L){this._orthoLeft=L}get orthoRight(){return this._orthoRight}set orthoRight(L){this._orthoRight=L}get orthoTop(){return this._orthoTop}set orthoTop(L){this._orthoTop=L}get orthoBottom(){return this._orthoBottom}set orthoBottom(L){this._orthoBottom=L}constructor(L,r,p){super(L,p),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=r.scale(-1),this.direction=r}getClassName(){return"tg"}getTypeID(){return z.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(L,r,p){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(L):this._setDefaultAutoExtendShadowProjectionMatrix(L,r,p)}_setDefaultFixedFrustumShadowProjectionMatrix(L){const r=this.FL().activeCamera;r&&n.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:r.nz,void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,L,this.FL().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(L,r,p){const J=this.FL().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const L=n.cr.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let J=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let j=0;j<p.length;j++){const z=p[j];if(!z)continue;const G=z.getBoundingInfo().boundingBox;for(let p=0;p<G.vectorsWorld.length;p++)n.cr.TransformCoordinatesToRef(G.vectorsWorld[p],r,L),L.x<this._orthoLeft&&(this._orthoLeft=L.x),L.y<this._orthoBottom&&(this._orthoBottom=L.y),L.x>this._orthoRight&&(this._orthoRight=L.x),L.y>this._orthoTop&&(this._orthoTop=L.y),this.autoCalcShadowZBounds&&(L.z<J&&(J=L.z),L.z>i&&(i=L.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=J,this._shadowMaxZ=i)}const i=this._orthoRight-this._orthoLeft,j=this._orthoTop-this._orthoBottom,z=void 0!==this.shadowMinZ?this.shadowMinZ:(null===J||void 0===J?void 0:J.nz)||0,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===J||void 0===J?void 0:J.maxZ)||1e4,C=this.FL().getEngine().o;n.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-i*this.shadowOrthoScale,this._orthoRight+i*this.shadowOrthoScale,this._orthoBottom-j*this.shadowOrthoScale,this._orthoTop+j*this.shadowOrthoScale,C?G:z,C?z:G,L,this.FL().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(L,r){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,r),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,r),this)}transferToNodeMaterialEffect(L,r){return this.computeTransformedInformation()?(L.setFloat3(r,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(L.setFloat3(r,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(L){const r=this._scene.getEngine();return!r.o&&r.isNDCHalfZRange?0:1}getDepthMaxZ(L){const r=this._scene.getEngine();return r.o&&r.isNDCHalfZRange?0:1}prepareLightSpecificDefines(L,r){L["DIRLIGHT"+r]=!0}}(0,J.e)([(0,i.E)()],t.prototype,"shadowFrustumSize",null),(0,J.e)([(0,i.E)()],t.prototype,"shadowOrthoScale",null),(0,J.e)([(0,i.E)()],t.prototype,"autoUpdateExtends",void 0),(0,J.e)([(0,i.E)()],t.prototype,"autoCalcShadowZBounds",void 0),(0,J.e)([(0,i.E)("orthoLeft")],t.prototype,"_orthoLeft",void 0),(0,J.e)([(0,i.E)("orthoRight")],t.prototype,"_orthoRight",void 0),(0,J.e)([(0,i.E)("orthoTop")],t.prototype,"_orthoTop",void 0),(0,J.e)([(0,i.E)("orthoBottom")],t.prototype,"_orthoBottom",void 0),(0,C.e)("BABYLON.DirectionalLight",t)},14299:(L,r,p)=>{"use strict";p.d(r,{c:()=>t});var J=p(12113),i=p(12122),n=p(12136),j=p(12170),z=p(12543),G=p(12654),C=p(12087);z.d.AddNodeConstructor("Light_Type_3",((L,r)=>()=>new t(L,n.cr.Zero(),r)));class t extends G.e{constructor(L,r,p){super(L,p),this.groundColor=new j.Wr(0,0,0),this.direction=r||n.cr.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Eg"}setDirectionToTarget(L){return this.direction=n.cr.Normalize(L.Pr(n.cr.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(L,r){const p=n.cr.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",p.x,p.y,p.z,0,r),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.vz),r),this}transferToNodeMaterialEffect(L,r){const p=n.cr.Normalize(this.direction);return L.setFloat3(r,p.x,p.y,p.z),this}cz(){return this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),this._worldMatrix}getTypeID(){return G.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(L,r){L["HEMILIGHT"+r]=!0}}(0,J.e)([(0,i.h)()],t.prototype,"groundColor",void 0),(0,J.e)([(0,i.D)()],t.prototype,"direction",void 0),(0,C.e)("BABYLON.HemisphericLight",t)},13803:(L,r,p)=>{"use strict";p.d(r,{d:()=>E});var J=p(12113),i=p(12122),n=p(12136),j=p(12543),z=p(12654),G=p(12721),C=p(12111),t=p(12087);j.d.AddNodeConstructor("Light_Type_2",((L,r)=>()=>new E(L,n.cr.Zero(),n.cr.Zero(),0,0,r)));class E extends G.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(L){this._iesProfileTexture!==L&&(this._iesProfileTexture=L,this._iesProfileTexture&&E._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(L){this._angle=L,this._cosHalfAngle=Math.cos(.5*L),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(L){this._innerAngle=L,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(L){this._shadowAngleScale=L,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(L){this._projectionTextureLightNear=L,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(L){this._projectionTextureLightFar=L,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(L){this._projectionTextureUpDirection=L,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(L){this._projectionTexture!==L&&(this._projectionTexture=L,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(E._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):E._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(L){return void 0!==L.onGeneratedObservable}static _IsTexture(L){return void 0!==L.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(L){this._projectionTextureProjectionLightMatrix=L,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(L,r,p,J,i,j){super(L,j),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=n.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=n.cr.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=n.cr.Zero(),this._projectionTextureViewLightMatrix=n.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=n.Matrix.Zero(),this._projectionTextureScalingMatrix=n.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=r,this.direction=p,this.angle=J,this.exponent=i}getClassName(){return"SpotLight"}getTypeID(){return z.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(L){super._setDirection(L),this._projectionTextureViewLightDirty=!0}_setPosition(L){super._setPosition(L),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(L,r,p){const J=this.FL().activeCamera;if(!J)return;this._shadowAngleScale=this._shadowAngleScale||1;const i=this._shadowAngleScale*this._angle,j=void 0!==this.shadowMinZ?this.shadowMinZ:J.nz,z=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,G=this.FL().getEngine().o;n.Matrix.PerspectiveFovLHToRef(i,1,G?z:j,G?j:z,L,!0,this._scene.getEngine().isNDCHalfZRange,void 0,G)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),n.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const L=this.projectionTextureLightFar,r=this.projectionTextureLightNear,p=L/(L-r),J=-p*r,i=1/Math.tan(this._angle/2);n.Matrix.FromValuesToRef(i/1,0,0,0,0,i,0,0,0,0,p,1,0,0,J,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof C.c){const L=this._projectionTexture.uScale/2,r=this._projectionTexture.vScale/2;n.Matrix.FromValuesToRef(L,0,0,0,0,r,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(L,r){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),L.setMatrix("textureProjectionMatrix"+r,this._projectionTextureMatrix),L.setTexture("projectionLightTexture"+r,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&L.setTexture("iesLightTexture"+r,this._iesProfileTexture),this}transferToEffect(L,r){let p;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,r),p=n.cr.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,r),p=n.cr.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",p.x,p.y,p.z,this._cosHalfAngle,r),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,r),this}transferToNodeMaterialEffect(L,r){let p;return p=this.computeTransformedInformation()?n.cr.Normalize(this.transformedDirection):n.cr.Normalize(this.direction),this.FL().useRightHandedSystem?L.setFloat3(r,-p.x,-p.y,-p.z):L.setFloat3(r,p.x,p.y,p.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(L){const r=this._scene.getEngine(),p=void 0!==this.shadowMinZ?this.shadowMinZ:(null===L||void 0===L?void 0:L.nz)??0;return r.o&&r.isNDCHalfZRange?p:this._scene.getEngine().isNDCHalfZRange?0:p}getDepthMaxZ(L){const r=this._scene.getEngine(),p=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===L||void 0===L?void 0:L.maxZ)??1e4;return r.o&&r.isNDCHalfZRange?0:p}prepareLightSpecificDefines(L,r){L["SPOTLIGHT"+r]=!0,L["PROJECTEDLIGHTTEXTURE"+r]=!(!this.projectionTexture||!this.projectionTexture.isReady()),L["IESLIGHTTEXTURE"+r]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,J.e)([(0,i.E)()],E.prototype,"angle",null),(0,J.e)([(0,i.E)()],E.prototype,"innerAngle",null),(0,J.e)([(0,i.E)()],E.prototype,"shadowAngleScale",null),(0,J.e)([(0,i.E)()],E.prototype,"exponent",void 0),(0,J.e)([(0,i.E)()],E.prototype,"projectionTextureLightNear",null),(0,J.e)([(0,i.E)()],E.prototype,"projectionTextureLightFar",null),(0,J.e)([(0,i.E)()],E.prototype,"projectionTextureUpDirection",null),(0,J.e)([(0,i.y)("projectedLightTexture")],E.prototype,"_projectionTexture",void 0),(0,t.e)("BABYLON.SpotLight",E)},13489:(L,r,p)=>{"use strict";p.d(r,{e:()=>j,g:()=>n,h:()=>z});const J={},i={};function n(L,r){J[L]=r}function j(L,r){i[L]=r}function z(L){return i[L]?i[L]:null}},13394:(L,r,p)=>{"use strict";p.d(r,{d:()=>F,f:()=>D});var J,i=p(11957),n=p(11964),j=p(12355),z=p(12009),G=p(11975),C=p(12589),t=p(12014),E=p(12016),x=p(12091),w=p(12037),g=p(12004);!function(L){L[L.Clean=0]="Clean",L[L.Stop=1]="Stop",L[L.Sync=2]="Sync",L[L.NoSync=3]="NoSync"}(J||(J={}));const b=new n.c,c={};let P=!1;function O(){return c[".babylon"]}function h(L,r){const p=c[L];return p||(G.d.Warn("Unable to find a plugin to load "+L+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),r?O():void 0)}function U(L,r,p){let J="Unable to load from "+(L.rawData?"binary data":L.url);return r?J+=`: ${r}`:p&&(J+=`: ${p}`),J}async function W(L,r,p,J,i,n,j,z,G){var C;const E="data:"===(x=L.url).substring(0,5)?x.substring(5):null;var x;if(L.rawData&&!j)throw"When using ArrayBufferView to load data the file extension must be provided.";const P=E||j?"":function(L){const r=L.indexOf("?");-1!==r&&(L=L.substring(0,r));const p=L.lastIndexOf(".");return L.substring(p,L.length).toLowerCase()}(L.url);let U=j?h(j,!0):E?function(L){for(const r in c){const p=c[r].plugin;if(p.canDirectLoad&&p.canDirectLoad(L))return c[r]}return O()}(L.url):h(P,!1);if(!U&&P){if(L.url&&!L.url.startsWith("blob:")){const r=await async function(L,r){const p=r.method||"GET";return await new Promise(((J,i)=>{const n=new g.b;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const L={};if(r.responseHeaders)for(const p of r.responseHeaders)L[p]=n.getResponseHeader(p)||"";J({response:n.response,headerValues:L})}else i(`Unable to fetch data from ${L}. Error code: ${n.status}`)})),n.open(p,L),n.send()}))}(L.url,{method:"HEAD",responseHeaders:["Content-Type"]}),p=r.headerValues?r.headerValues["Content-Type"]:"";p&&(U=function(L){for(const r in c){const p=c[r];if(p.mimeType===L)return p}}(p))}U||(U=O())}if(!U)throw new Error(`No plugin or fallback for ${j??L.url}`);if(!1===(null===G||void 0===G||null===(C=G[U.plugin.name])||void 0===C?void 0:C.enabled))throw new Error(`The '${U.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(L.rawData&&!U.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(L=>{if(U.plugin.createPlugin){const r=U.plugin.createPlugin(G??{});return r instanceof Promise?(r.then(L).catch((L=>{i("Error instantiating plugin.",L)})),null):(L(r),r)}return L(U.plugin),U.plugin})((G=>{var C;if(!G)throw`The loader plugin corresponding to the '${j}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(b.notifyObservers(G),E&&(G.canDirectLoad&&G.canDirectLoad(L.url)||!(0,t.j)(L.url))){if(G.directLoad){const L=G.directLoad(r,E);L instanceof Promise?L.then((L=>{p(G,L)})).catch((L=>{i("Error in directLoad of _loadData: "+L,L)})):p(G,L)}else p(G,E);return}const x=U.isBinary,g=(L,J)=>{r.P?i("Scene has been disposed"):p(G,L,J)};let c=null,P=!1;null===(C=G.ji)||void 0===C||C.add((()=>{P=!0,c&&(c.abort(),c=null),n()}));const O=()=>{if(P)return;const p=(L,r)=>{i(null===L||void 0===L?void 0:L.statusText,r)};if(!G.loadFile&&L.rawData)throw"Plugin does not support loading ArrayBufferView.";c=G.loadFile?G.loadFile(r,L.rawData||L.file||L.url,L.rootUrl,g,J,x,p,z):r._loadFile(L.file||L.url,g,J,!0,x,p)},h=r.getEngine();let W=h.enableOfflineSupport;if(W){let p=!1;for(const J of r.disableOfflineSupportExceptionRules)if(J.test(L.url)){p=!0;break}W=!p}W&&w.e.OfflineProviderFactory?r.offlineProvider=w.e.OfflineProviderFactory(L.url,O,h.disableManifestCheck):O()}))}function B(L,r){let p,J,n=null,j=null;if(r)if(r.name)p=`file:${r.name}`,J=r.name,n=r;else if(ArrayBuffer.isView(r))p="",J=(0,x.d)(),j=r;else if(r.startsWith("data:"))p=r,J="";else if(L){const n=r;if("/"===n.substring(0,1))return i.Tools.Error("Wrong sceneFilename parameter"),null;p=L+n,J=n}else p=r,J=i.Tools.GetFilename(r),L=i.Tools.GetFolderPath(r);else p=L,J=i.Tools.GetFilename(L),L=i.Tools.GetFolderPath(L);return{url:p,rootUrl:L,name:J,file:n,rawData:j}}function F(L){if("string"===typeof L.extensions){const r=L.extensions;c[r.toLowerCase()]={plugin:L,isBinary:!1}}else{const r=L.extensions,p=Object.keys(r);for(const J of p)c[J.toLowerCase()]={plugin:L,isBinary:r[J].isBinary,mimeType:r[J].mimeType}}}async function Q(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.c.LastCreatedScene,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!J)return G.d.Error("No scene available to import mesh to"),null;const w=B(r,p);if(!w)return null;const g={};J.addPendingData(g);const b=()=>{J.removePendingData(g)},c=(L,r)=>{const p=U(w,L,r);j?j(J,p,new E.h(p,E.f.SceneLoaderError,r)):G.d.Error(p),b()},P=n?L=>{try{n(L)}catch(r){c("Error in onProgress callback: "+r,r)}}:void 0,O=(L,r,p,n,j,z,G,C)=>{if(J.importedMeshesFiles.push(w.url),i)try{i(L,r,p,n,j,z,G,C)}catch(t){c("Error in onSuccess callback: "+t,t)}J.removePendingData(g)};return await W(w,J,((r,p,i)=>{if(r.rewriteRootURL&&(w.rootUrl=r.rewriteRootURL(w.rootUrl,i)),r.importMesh){const i=[],n=[],j=[];if(!r.importMesh(L,J,p,w.rootUrl,i,n,j,c))return;J.loadingPluginName=r.name,O(i,n,j,[],[],[],[],[])}else{r.importMeshAsync(L,J,p,w.rootUrl,P,w.name).then((L=>{J.loadingPluginName=r.name,O(L.meshes,L.SE,L.skeletons,L.animationGroups,L.transformNodes,L.geometries,L.lights,L.spriteManagers)})).catch((L=>{c(L.message,L)}))}}),P,c,b,C,t,x)}async function e(L,r,p,J,i,n,j,z){return await new Promise(((G,C)=>{try{Q(L,r,p,J,((L,r,p,J,i,n,j,z)=>{G({meshes:L,SE:r,skeletons:p,animationGroups:J,transformNodes:i,geometries:n,lights:j,spriteManagers:z})}),i,((L,r,p)=>{C(p||new Error(r))}),n,j,z).catch(C)}catch(E){C(E)}}))}async function v(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedEngine,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};p?await A(L,r,new j.b(p),J,n,G,C,t,E):i.Tools.Error("No engine available")}async function y(L,r,p,J,i,n,j){return await new Promise(((z,G)=>{v(L,r,p,(L=>{z(L)}),J,((L,r,p)=>{G(p||new Error(r))}),i,n,j)}))}async function A(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!p)return G.d.Error("No scene available to append to"),null;const w=B(L,r);if(!w)return null;const g={};p.addPendingData(g);const b=()=>{p.removePendingData(g)};C.c.ShowLoadingScreen&&!P&&(P=!0,p.getEngine().displayLoadingUI(),p.executeWhenReady((()=>{p.getEngine().hideLoadingUI(),P=!1})));const c=(L,r)=>{const J=U(w,L,r);n?n(p,J,new E.h(J,E.f.SceneLoaderError,r)):G.d.Error(J),b()},O=i?L=>{try{i(L)}catch(r){c("Error in onProgress callback",r)}}:void 0,h=()=>{if(J)try{J(p)}catch(L){c("Error in onSuccess callback",L)}p.removePendingData(g)};return await W(w,p,((L,r)=>{if(L.load){if(!L.load(p,r,w.rootUrl,c))return;p.loadingPluginName=L.name,h()}else{L.loadAsync(p,r,w.rootUrl,O,w.name).then((()=>{p.loadingPluginName=L.name,h()})).catch((L=>{c(L.message,L)}))}}),O,c,b,j,t,x)}async function u(L,r,p,J,i,n,j){return await new Promise(((z,G)=>{try{A(L,r,p,(L=>{z(L)}),J,((L,r,p)=>{G(p||new Error(r))}),i,n,j).catch(G)}catch(E){G(E)}}))}async function a(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!p)return G.d.Error("No scene available to load asset container to"),null;const x=B(L,r);if(!x)return null;const w={};p.addPendingData(w);const g=()=>{p.removePendingData(w)},b=(L,r)=>{const J=U(x,L,r);n?n(p,J,new E.h(J,E.f.SceneLoaderError,r)):G.d.Error(J),g()},c=i?L=>{try{i(L)}catch(r){b("Error in onProgress callback",r)}}:void 0,P=L=>{if(J)try{J(L)}catch(r){b("Error in onSuccess callback",r)}p.removePendingData(w)};return await W(x,p,((L,r)=>{if(L.loadAssetContainer){const J=L.loadAssetContainer(p,r,x.rootUrl,b);if(!J)return;J.populateRootNodes(),p.loadingPluginName=L.name,P(J)}else if(L.loadAssetContainerAsync){L.loadAssetContainerAsync(p,r,x.rootUrl,c,x.name).then((r=>{r.populateRootNodes(),p.loadingPluginName=L.name,P(r)})).catch((L=>{b(L.message,L)}))}else b("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),c,b,g,j,C,t)}async function q(L,r,p,J,i,n,j){return await new Promise(((z,G)=>{try{a(L,r,p,(L=>{z(L)}),J,((L,r,p)=>{G(p||new Error(r))}),i,n,j).catch(G)}catch(E){G(E)}}))}async function Z(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!p)return void G.d.Error("No scene available to load animations to");if(J){for(const J of p.animatables)J.reset();p.stopAllAnimations();const L=p.animationGroups.slice();for(const p of L)p.dispose();const r=p.getNodes();for(const p of r)p.animations&&(p.animations=[])}else switch(i){case 0:const L=p.animationGroups.slice();for(const r of L)r.dispose();break;case 1:for(const r of p.animationGroups)r.stop();break;case 2:for(const r of p.animationGroups)r.reset(),r.restart();break;case 3:break;default:return void G.d.Error("Unknown animation group loading mode value '"+i+"'")}const g=p.animatables.length;await a(L,r,p,(L=>{L.mergeAnimationsTo(p,p.animatables.slice(g),n),L.dispose(),p.onAnimationFileImportedObservable.notifyObservers(p),j&&j(p)}),C,t,E,x,w)}async function X(L,r,p,J,i,n,j,z,G,C){return await new Promise(((t,x)=>{try{Z(L,r,p,J,i,n,(L=>{t(L)}),j,((L,r,p)=>{x(p||new Error(r))}),z,G,C).catch(x)}catch(E){x(E)}}))}class D{static get ForceFullSceneLoadingForIncremental(){return C.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(L){C.c.ForceFullSceneLoadingForIncremental=L}static get ShowLoadingScreen(){return C.c.ShowLoadingScreen}static set ShowLoadingScreen(L){C.c.ShowLoadingScreen=L}static get loggingLevel(){return C.c.loggingLevel}static set loggingLevel(L){C.c.loggingLevel=L}static get CleanBoneMatrixWeights(){return C.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(L){C.c.CleanBoneMatrixWeights=L}static GetDefaultPlugin(){return O()}static GetPluginForExtension(L){var r;return null===(r=h(L,!0))||void 0===r?void 0:r.plugin}static IsPluginForExtensionAvailable(L){return function(L){return!!c[L]}(L)}static RegisterPlugin(L){F(L)}static ImportMesh(L,r,p,J,i,n,j,G,C){Q(L,r,p,J,i,n,j,G,C).catch((L=>null===j||void 0===j?void 0:j(z.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async ImportMeshAsync(L,r,p,J,i,n,j){return await e(L,r,p,J,i,n,j)}static Load(L,r,p,J,i,n,j,G){v(L,r,p,J,i,n,j,G).catch((L=>null===n||void 0===n?void 0:n(z.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async LoadAsync(L,r,p,J,i,n){return await y(L,r,p,J,i,n)}static Append(L,r,p,J,i,n,j,G){A(L,r,p,J,i,n,j,G).catch((L=>null===n||void 0===n?void 0:n(p??z.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async AppendAsync(L,r,p,J,i,n){return await u(L,r,p,J,i,n)}static LoadAssetContainer(L,r,p,J,i,n,j,G){a(L,r,p,J,i,n,j,G).catch((L=>null===n||void 0===n?void 0:n(p??z.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async LoadAssetContainerAsync(L,r,p,J,i,n){return await q(L,r,p,J,i,n)}static ImportAnimations(L,r,p,J,i,n,j,G,C,t,E){Z(L,r,p,J,i,n,j,G,C,t,E).catch((L=>null===C||void 0===C?void 0:C(p??z.c.LastCreatedScene,null===L||void 0===L?void 0:L.message,L)))}static async ImportAnimationsAsync(L,r,p,J,i,n,j,z,G,C,t){return await X(L,r,p,J,i,n,z,C,t)}}D.NO_LOGGING=0,D.MINIMAL_LOGGING=1,D.SUMMARY_LOGGING=2,D.DETAILED_LOGGING=3,D.OnPluginActivatedObservable=b},13820:(L,r,p)=>{"use strict";p.d(r,{e:()=>x});var J=p(12113),i=p(12122),n=p(11957),j=p(12136),z=p(12156),G=p(12111),C=p(12087),t=p(11964),E=p(12162);p(13826);class x extends z.e{set boundingBoxSize(L){if(this._boundingBoxSize&&this._boundingBoxSize.equals(L))return;this._boundingBoxSize=L;const r=this.FL();r&&r.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(L){this._rotationY=L,this.setReflectionTextureMatrix(j.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(L,r,p){let J="";for(const i of L)J+=i;return new x(J,r,null,p,L)}static CreateFromPrefilteredData(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=r.useDelayedTextureLoading;r.useDelayedTextureLoading=!1;const n=new x(L,r,null,!1,null,null,null,void 0,!0,p,J);return r.useDelayedTextureLoading=i,n}constructor(L,r){var p;let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],w=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,P=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0;super(r),this.onLoadObservable=new t.c,this.boundingBoxPosition=j.cr.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new j.Matrix,this._buffer=null,this.name=L,this.url=L,this._noMipmap=i,this.pz=!1,this.isCube=!0,this._textureMatrix=j.Matrix.Identity(),this.coordinatesMode=G.c.CUBIC_MODE;let h=null,U=null;null===J||Array.isArray(J)?(this._noMipmap=i,this._format=E,this._createPolynomials=g,h=J,this._loaderOptions=P,this._useSRGBBuffer=O,this._lodScale=b,this._lodOffset=c):(h=J.extensions??null,this._noMipmap=J.noMipmap??!1,n=J.files??null,U=J.buffer??null,this._format=J.format??5,x=J.prefiltered??!1,w=J.forcedExtension??null,this._createPolynomials=J.createPolynomials??!1,this._lodScale=J.lodScale??.8,this._lodOffset=J.lodOffset??0,this._loaderOptions=J.loaderOptions,this._useSRGBBuffer=J.useSRGBBuffer,z=J.mL??null,C=J.onError??null),(L||n)&&this.updateURL(L,w,z,x,C,h,null===(p=this.FL())||void 0===p?void 0:p.useDelayedTextureLoading,n,U)}getClassName(){return"CubeTexture"}updateURL(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=L),this.url=L,r&&(this._forcedExtension=r);const C=L.lastIndexOf("."),t=r||(C>-1?L.substring(C).toLowerCase():""),E=0===t.indexOf(".dds"),x=0===t.indexOf(".env"),w=0===t.indexOf(".basis");if(x?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=J,J&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),z)this._files=z;else if(w||x||E||n||(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,n){for(let r=0;r<n.length;r++)this._files.push(L+n[r]);this._extensions=n}this._buffer=G,j?(this.delayLoadState=4,this._delayedOnLoad=p,this._delayedOnError=i):this._loadTexture(p,i)}delayLoad(L){4===this.delayLoadState&&(L&&(this._forcedExtension=L),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(L){var r,p;if(L.updateFlag===this._textureMatrix.updateFlag)return;L.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(p=this.FL())||void 0===p||p.markAllMaterialsAsDirty(1,(L=>-1!==L.getActiveTextures().indexOf(this))));if(this._textureMatrix=L,null===(r=this.FL())||void 0===r||!r.useRightHandedSystem)return;const J=j.TmpVectors.cr[0],i=j.TmpVectors.Quaternion[0],n=j.TmpVectors.cr[1];this._textureMatrix.decompose(J,i,n),i.z*=-1,i.w*=-1,j.Matrix.ComposeToRef(J,i,n,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var L;return null!==(L=this.FL())&&void 0!==L&&L.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=this.FL(),J=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const i=()=>{var r;(this.onLoadObservable.notifyObservers(this),J)&&(J.dispose(),null===(r=this.FL())||void 0===r||r.markAllMaterialsAsDirty(1));L&&L()},j=(L,p)=>{this._loadingError=!0,this._errorObject={message:L,exception:p},r&&r(L,p),G.c.OnTextureLoadErrorObservable.notifyObservers(this)};var z;this._texture?this._texture.isReady?n.Tools.SetImmediate((()=>i())):this._texture.onLoadedObservable.add((()=>i())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,p,this._lodScale,this._lodOffset,L,j,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,p,this._files,this._noMipmap,L,j,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(z=this._texture)||void 0===z||z.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(L,r,p){const J=E.c.Parse((()=>{let J=!1;return L.prefiltered&&(J=L.prefiltered),new x(p+(L.url??L.name),r,L.extensions,!1,L.files||null,null,null,void 0,J,L.forcedExtension)}),L,r);if(L.boundingBoxPosition&&(J.boundingBoxPosition=j.cr.Br(L.boundingBoxPosition)),L.boundingBoxSize&&(J.boundingBoxSize=j.cr.Br(L.boundingBoxSize)),L.animations)for(let i=0;i<L.animations.length;i++){const r=L.animations[i],p=(0,C.c)("BABYLON.Animation");p&&J.animations.push(p.Parse(r))}return J}clone(){let L=0;const r=E.c.Clone((()=>{const r=new x(this.url,this.FL()||this._getEngine(),this._extensions,this._noMipmap,this._files);return L=r.uniqueId,r}),this);return r.uniqueId=L,r}}(0,J.e)([(0,i.E)()],x.prototype,"url",void 0),(0,J.e)([(0,i.D)()],x.prototype,"boundingBoxPosition",void 0),(0,J.e)([(0,i.D)()],x.prototype,"boundingBoxSize",null),(0,J.e)([(0,i.E)("rotationY")],x.prototype,"rotationY",null),(0,J.e)([(0,i.E)("files")],x.prototype,"_files",void 0),(0,J.e)([(0,i.E)("forcedExtension")],x.prototype,"_forcedExtension",void 0),(0,J.e)([(0,i.E)("extensions")],x.prototype,"_extensions",void 0),(0,J.e)([(0,i.p)("textureMatrix")],x.prototype,"_textureMatrix",void 0),(0,J.e)([(0,i.p)("textureMatrixRefraction")],x.prototype,"_textureMatrixRefraction",void 0),G.c._CubeTextureParser=x.Parse,(0,C.e)("BABYLON.CubeTexture",x)},14309:(L,r,p)=>{"use strict";p.d(r,{b:()=>G});var J=p(11975),i=p(12111),n=p(12098),j=p(12257),z=p(12060);j.ThinEngine.prototype.createDynamicTexture=function(L,r,p,J){const i=new z.b(this,4);return i.baseWidth=L,i.baseHeight=r,p&&(L=this.needPOTTextures?(0,n.f)(L,this._caps.maxTextureSize):L,r=this.needPOTTextures?(0,n.f)(r,this._caps.maxTextureSize):r),i.width=L,i.height=r,i.isReady=!1,i.generateMipMaps=p,i.samplingMode=J,this.updateTextureSamplingMode(J,i),this._internalTexturesCache.push(i),i},j.ThinEngine.prototype.updateDynamicTexture=function(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!L)return;const j=this._gl,z=j.TEXTURE_2D,G=this._bindTextureDirectly(z,L,!0,n);this._unpackFlipY(void 0===p?L.invertY:p),J&&j.pixelStorei(j.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const C=this._getWebGLTextureType(L.type),t=this._getInternalFormat(i||L.format),E=this._getRGBABufferInternalSizedFormat(L.type,t);j.texImage2D(z,0,E,t,C,r),L.generateMipMaps&&j.generateMipmap(z),G||this._bindTextureDirectly(z,null),J&&j.pixelStorei(j.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),i&&(L.format=i),L._dynamicTextureSource=r,L._premulAlpha=J,L.invertY=p||!1,L.isReady=!0};class G extends i.c{constructor(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,z=arguments.length>6?arguments[6]:void 0;const G=!p||p._isScene;super(null,G?p:null===p||void 0===p?void 0:p.Or,G?!J:p,z,n,void 0,void 0,void 0,void 0,j),this.name=L,this.wrapU=i.c.CLAMP_ADDRESSMODE,this.wrapV=i.c.CLAMP_ADDRESSMODE,this._generateMipMaps=J;const C=this._getEngine();if(!C)return;if(r.getContext)this._canvas=r,this._ownCanvas=!1,this._texture=C.createDynamicTexture(this._canvas.width,this._canvas.height,J,n);else{this._canvas=C.createCanvas(1,1),this._ownCanvas=!0;const L=r;L.width||0===L.width?this._texture=C.createDynamicTexture(L.width,L.height,J,n):this._texture=C.createDynamicTexture(r,r,J,n)}const t=this.getSize();this._canvas.width!==t.width&&(this._canvas.width=t.width),this._canvas.height!==t.height&&(this._canvas.height=t.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(L){this._canvas.width=L.width,this._canvas.height=L.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(L.width,L.height,this._generateMipMaps,this.samplingMode)}scale(L){const r=this.getSize();r.width*=L,r.height*=L,this._recreate(r)}scaleTo(L,r){const p=this.getSize();p.width=L,p.height=r,this._recreate(p)}getContext(){return this._context}clear(L){const r=this.getSize();L&&(this._context.fillStyle=L),this._context.clearRect(0,0,r.width,r.height)}update(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===L||L,r,this._format||void 0,void 0,p)}drawText(L,r,p,J,i,n,j){let z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const G=this.getSize();if(n&&(this._context.fillStyle=n,this._context.fillRect(0,0,G.width,G.height)),this._context.font=J,null===r||void 0===r){const p=this._context.measureText(L);r=(G.width-p.width)/2}if(null===p||void 0===p){const L=parseInt(J.replace(/\D/g,""));p=G.height/2+L/3.65}this._context.fillStyle=i||"",this._context.fillText(L,r,p),z&&this.update(j)}dispose(){var L,r;(super.dispose(),this._ownCanvas)&&(null===(L=this._canvas)||void 0===L||null===(r=L.remove)||void 0===r||r.call(L));this._canvas=null,this._context=null}clone(){const L=this.FL();if(!L)return this;const r=this.getSize(),p=new G(this.name,r,L,this._generateMipMaps);return p.pz=this.pz,p.level=this.level,p.wrapU=this.wrapU,p.wrapV=this.wrapV,p}serialize(){const L=this.FL();L&&!L.isReady()&&J.d.Warn("The scene must be ready before serializing the dynamic texture");const r=super.serialize();return G._IsCanvasElement(this._canvas)&&(r.base64String=this._canvas.toDataURL()),r.invertY=this._invertY,r.samplingMode=this.samplingMode,r}static _IsCanvasElement(L){return void 0!==L.toDataURL}_rebuild(){this.update()}}},13716:(L,r,p)=>{"use strict";p.d(r,{c:()=>i});var J=p(12111);class i extends J.c{get depth(){return this._depth}constructor(L,r,p,i,n,j){let z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:J.c.TRILINEAR_SAMPLINGMODE,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,E=arguments.length>10?arguments[10]:void 0;super(null,j,!z,G),this.format=n,this._texture=j.getEngine().createRawTexture2DArray(L,r,p,i,n,z,G,C,null,t,E),this._depth=i,this.is2DArray=!0}update(L){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,L,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(L,r,p,J,n){return new i(L,r,p,J,5,n,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13510:(L,r,p)=>{"use strict";p.d(r,{e:()=>z,f:()=>G,h:()=>n,i:()=>j});var J=p(12154),i=p(12136);function n(L,r){return`{X: ${L.x.toFixed(r)} Y: ${L.y.toFixed(r)}}`}function j(L,r){return`{X: ${L._x.toFixed(r)} Y: ${L._y.toFixed(r)} Z: ${L._z.toFixed(r)}}`}function z(L,r){return 2*Math.acos((0,J.Clamp)(i.Quaternion.Dot(L,r)))}function G(L,r){const p=new i.Quaternion;return function(L,r,p){const n=i.cr.Cross(L,r),j=Math.acos((0,J.Clamp)(i.cr.Dot(L,r),-1,1));i.Quaternion.RotationAxisToRef(n,j,p)}(L,r,p),p}},13333:(L,r,p)=>{"use strict";p.d(r,{c:()=>C});var J=p(12136),i=p(12170),n=p(12575),j=p(12555),z=p(12185);p(13340);function G(L){let r=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const p=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[];let G=[];const C=L.width||L.size||1,t=L.height||L.size||1,E=L.depth||L.size||1,x=L.wrap||!1;let w=void 0===L.topBaseAt?1:L.topBaseAt,g=void 0===L.bottomBaseAt?0:L.bottomBaseAt;w=(w+4)%4,g=(g+4)%4;let b=[2,0,3,1][w],c=[2,0,1,3][g],P=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(x){r=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],P=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let L=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],p=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const J=[17,18,19,16],i=[22,23,20,21];for(;b>0;)L.unshift(L.pop()),J.unshift(J.pop()),b--;for(;c>0;)p.unshift(p.pop()),i.unshift(i.pop()),c--;L=L.flat(),p=p.flat(),P=P.concat(L).concat(p),r.push(J[0],J[2],J[3],J[0],J[1],J[2]),r.push(i[0],i[2],i[3],i[0],i[1],i[2])}const O=[C/2,t/2,E/2];G=P.reduce(((L,r,p)=>L.concat(r*O[p%3])),[]);const h=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE,U=L.faceUV||new Array(6),W=L.faceColors,B=[];for(let j=0;j<6;j++)void 0===U[j]&&(U[j]=new J.Vector4(0,0,1,1)),W&&void 0===W[j]&&(W[j]=new i.Fz(1,1,1,1));for(let J=0;J<6;J++)if(n.push(U[J].z,z.d?1-U[J].w:U[J].w),n.push(U[J].x,z.d?1-U[J].w:U[J].w),n.push(U[J].x,z.d?1-U[J].y:U[J].y),n.push(U[J].z,z.d?1-U[J].y:U[J].y),W)for(let L=0;L<4;L++)B.push(W[J].r,W[J].g,W[J].b,W[J].a);j.d._ComputeSides(h,G,r,p,n,L.frontUVs,L.backUVs);const F=new j.d;if(F.indices=r,F.eL=G,F.vL=p,F.AL=n,W){const L=h===j.d.DOUBLESIDE?B.concat(B):B;F.yL=L}return F}function C(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new n.c(L,p);r.sideOrientation=n.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return G(r).aL(J,r.updatable),J}j.d.CreateBox=G,n.c.CreateBox=function(L,r){return C(L,{size:r,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13494:(L,r,p)=>{"use strict";p.d(r,{c:()=>z});var J=p(12575),i=p(12555),n=p(12185);function j(L){const r=[],p=[],J=[],j=[],z=L.radius||.5,G=L.tessellation||64,C=L.arc&&(L.arc<=0||L.arc>1)?1:L.arc||1,t=0===L.sideOrientation?0:L.sideOrientation||i.d.DEFAULTSIDE;r.push(0,0,0),j.push(.5,.5);const E=2*Math.PI*C,x=1===C?E/G:E/(G-1);let w=0;for(let i=0;i<G;i++){const L=Math.cos(w),p=Math.sin(w),J=(L+1)/2,i=(1-p)/2;r.push(z*L,z*p,0),j.push(J,n.d?1-i:i),w+=x}1===C&&(r.push(r[3],r[4],r[5]),j.push(j[2],n.d?1-j[3]:j[3]));const g=r.length/3;for(let i=1;i<g-1;i++)p.push(i+1,0,i);i.d.ComputeNormals(r,p,J),i.d._ComputeSides(t,r,p,J,j,L.frontUVs,L.backUVs);const b=new i.d;return b.indices=p,b.eL=r,b.vL=J,b.AL=j,b}function z(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new J.c(L,p);r.sideOrientation=J.c._GetDefaultSideOrientation(r.sideOrientation),i._originalBuilderSideOrientation=r.sideOrientation;return j(r).aL(i,r.updatable),i}i.d.CreateDisc=j,J.c.CreateDisc=function(L,r,p){return z(L,{radius:r,tessellation:p,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13340:(L,r,p)=>{"use strict";p.d(r,{g:()=>c,e:()=>O,j:()=>P});var J=p(12136),i=p(12170),n=p(12575),j=p(12555),z=p(12208);n.c._GroundMeshParser=(L,r)=>G.Parse(L,r);class G extends n.c{constructor(L,r){super(L,r),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=L,this._subdivisionsY=L,this.subdivide(L);const p=this;p.createOrUpdateSubmeshesOctree&&p.createOrUpdateSubmeshesOctree(r)}getHeightAtCoordinates(L,r){const p=this.getWorldMatrix(),i=J.TmpVectors.Matrix[5];p.invertToRef(i);const n=J.TmpVectors.cr[8];if(J.cr.TransformCoordinatesFromFloatsToRef(L,0,r,i,n),L=n.x,r=n.z,L<this._minX||L>=this._maxX||r<=this._minZ||r>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const j=this._getFacetAt(L,r),z=-(j.x*L+j.z*r+j.w)/j.y;return J.cr.TransformCoordinatesFromFloatsToRef(0,z,0,p,n),n.y}getNormalAtCoordinates(L,r){const p=new J.cr(0,1,0);return this.getNormalAtCoordinatesToRef(L,r,p),p}getNormalAtCoordinatesToRef(L,r,p){const i=this.getWorldMatrix(),n=J.TmpVectors.Matrix[5];i.invertToRef(n);const j=J.TmpVectors.cr[8];if(J.cr.TransformCoordinatesFromFloatsToRef(L,0,r,n,j),L=j.x,r=j.z,L<this._minX||L>this._maxX||r<this._minZ||r>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const z=this._getFacetAt(L,r);return J.cr.TransformNormalFromFloatsToRef(z.x,z.y,z.z,i,p),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(L,r){const p=Math.floor((L+this._maxX)*this._subdivisionsX/this._width),J=Math.floor(-(r+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),i=this._heightQuads[J*this._subdivisionsX+p];let n;return n=r<i.slope.x*L+i.slope.y?i.facet1:i.facet2,n}_initHeightQuads(){const L=this._subdivisionsX,r=this._subdivisionsY;this._heightQuads=[];for(let p=0;p<r;p++)for(let r=0;r<L;r++){const i={slope:J.Vector2.Zero(),facet1:new J.Vector4(0,0,0,0),facet2:new J.Vector4(0,0,0,0)};this._heightQuads[p*L+r]=i}return this}_computeHeightQuads(){const L=this.getVerticesData(z.e.PositionKind);if(!L)return this;const r=J.TmpVectors.cr[3],p=J.TmpVectors.cr[2],i=J.TmpVectors.cr[1],n=J.TmpVectors.cr[0],j=J.TmpVectors.cr[4],G=J.TmpVectors.cr[5],C=J.TmpVectors.cr[6],t=J.TmpVectors.cr[7],E=J.TmpVectors.cr[8];let x=0,w=0,g=0,b=0,c=0,P=0,O=0;const h=this._subdivisionsX,U=this._subdivisionsY;for(let z=0;z<U;z++)for(let U=0;U<h;U++){x=3*U,w=z*(h+1)*3,g=(z+1)*(h+1)*3,r.x=L[w+x],r.y=L[w+x+1],r.z=L[w+x+2],p.x=L[w+x+3],p.y=L[w+x+4],p.z=L[w+x+5],i.x=L[g+x],i.y=L[g+x+1],i.z=L[g+x+2],n.x=L[g+x+3],n.y=L[g+x+4],n.z=L[g+x+5],b=(n.z-r.z)/(n.x-r.x),c=r.z-b*r.x,p.subtractToRef(r,j),i.subtractToRef(r,G),n.subtractToRef(r,C),J.cr.CrossToRef(C,G,t),J.cr.CrossToRef(j,C,E),t.normalize(),E.normalize(),P=-(t.x*r.x+t.y*r.y+t.z*r.z),O=-(E.x*p.x+E.y*p.y+E.z*p.z);const W=this._heightQuads[z*h+U];W.slope.Uz(b,c),W.facet1.Uz(t.x,t.y,t.z,P),W.facet2.Uz(E.x,E.y,E.z,O)}return this}serialize(L){super.serialize(L),L.subdivisionsX=this._subdivisionsX,L.subdivisionsY=this._subdivisionsY,L.minX=this._minX,L.maxX=this._maxX,L.nz=this._minZ,L.maxZ=this._maxZ,L.width=this._width,L.height=this._height}static Parse(L,r){const p=new G(L.name,r);return p._subdivisionsX=L.subdivisionsX||1,p._subdivisionsY=L.subdivisionsY||1,p._minX=L.minX,p._maxX=L.maxX,p._minZ=L.nz,p._maxZ=L.maxZ,p._width=L.width,p._height=L.height,p}}var C=p(11957),t=p(12009),E=p(12140),x=p(12185);function w(L){const r=[],p=[],i=[],n=[];let z,G;const C=L.width||L.size||1,t=L.height||L.size||1,E=0|(L.subdivisionsX||L.subdivisions||1),w=0|(L.subdivisionsY||L.subdivisions||1);for(z=0;z<=w;z++)for(G=0;G<=E;G++){const L=new J.cr(G*C/E-C/2,0,(w-z)*t/w-t/2),r=new J.cr(0,1,0);p.push(L.x,L.y,L.z),i.push(r.x,r.y,r.z),n.push(G/E,x.d?z/w:1-z/w)}for(z=0;z<w;z++)for(G=0;G<E;G++)r.push(G+1+(z+1)*(E+1)),r.push(G+1+z*(E+1)),r.push(G+z*(E+1)),r.push(G+(z+1)*(E+1)),r.push(G+1+(z+1)*(E+1)),r.push(G+z*(E+1));const g=new j.d;return g.indices=r,g.eL=p,g.vL=i,g.AL=n,g}function g(L){const r=void 0!==L.xmin&&null!==L.xmin?L.xmin:-1,p=void 0!==L.zmin&&null!==L.zmin?L.zmin:-1,i=void 0!==L.xmax&&null!==L.xmax?L.xmax:1,n=void 0!==L.zmax&&null!==L.zmax?L.zmax:1,z=L.subdivisions||{w:1,h:1},G=L.precision||{w:1,h:1},C=[],t=[],E=[],x=[];let w,g,b,c;z.h=z.h<1?1:z.h,z.w=z.w<1?1:z.w,G.w=G.w<1?1:G.w,G.h=G.h<1?1:G.h;const P=(i-r)/z.w,O=(n-p)/z.h;function h(L,r,p,i){const n=t.length/3,j=G.w+1;for(w=0;w<G.h;w++)for(g=0;g<G.w;g++){const L=[n+g+w*j,n+(g+1)+w*j,n+(g+1)+(w+1)*j,n+g+(w+1)*j];C.push(L[1]),C.push(L[2]),C.push(L[3]),C.push(L[0]),C.push(L[1]),C.push(L[3])}const z=J.cr.Zero(),b=new J.cr(0,1,0);for(w=0;w<=G.h;w++)for(z.z=w*(i-r)/G.h+r,g=0;g<=G.w;g++)z.x=g*(p-L)/G.w+L,z.y=0,t.push(z.x,z.y,z.z),E.push(b.x,b.y,b.z),x.push(g/G.w,w/G.h)}for(b=0;b<z.h;b++)for(c=0;c<z.w;c++)h(r+c*P,p+b*O,r+(c+1)*P,p+(b+1)*O);const U=new j.d;return U.indices=C,U.eL=t,U.vL=E,U.AL=x,U}function b(L){const r=[],p=[],n=[],z=[];let G,C;const t=L.colorFilter||new i.Wr(.3,.59,.11),x=L.alphaFilter||0;let w=!1;if(L.minHeight>L.maxHeight){w=!0;const r=L.maxHeight;L.maxHeight=L.minHeight,L.minHeight=r}for(G=0;G<=L.subdivisions;G++)for(C=0;C<=L.subdivisions;C++){const r=new J.cr(C*L.width/L.subdivisions-L.width/2,0,(L.subdivisions-G)*L.height/L.subdivisions-L.height/2),i=4*(((r.x+L.width/2)/L.width*(L.bufferWidth-1)|0)+((1-(r.z+L.height/2)/L.height)*(L.bufferHeight-1)|0)*L.bufferWidth);let j=L.buffer[i]/255,g=L.buffer[i+1]/255,b=L.buffer[i+2]/255;const c=L.buffer[i+3]/255;w&&(j=1-j,g=1-g,b=1-b);const P=j*t.r+g*t.g+b*t.b;r.y=c>=x?L.minHeight+(L.maxHeight-L.minHeight)*P:L.minHeight-E.d,L.heightBuffer&&(L.heightBuffer[G*(L.subdivisions+1)+C]=r.y),p.push(r.x,r.y,r.z),n.push(0,0,0),z.push(C/L.subdivisions,1-G/L.subdivisions)}for(G=0;G<L.subdivisions;G++)for(C=0;C<L.subdivisions;C++){const J=C+1+(G+1)*(L.subdivisions+1),i=C+1+G*(L.subdivisions+1),n=C+G*(L.subdivisions+1),j=C+(G+1)*(L.subdivisions+1),z=p[3*J+1]>=L.minHeight,t=p[3*i+1]>=L.minHeight,E=p[3*n+1]>=L.minHeight;z&&t&&E&&(r.push(J),r.push(i),r.push(n));p[3*j+1]>=L.minHeight&&z&&E&&(r.push(j),r.push(J),r.push(n))}j.d.ComputeNormals(p,r,n);const g=new j.d;return g.indices=r,g.eL=p,g.vL=n,g.AL=z,g}function c(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const p=new G(L,arguments.length>2?arguments[2]:void 0);p._setReady(!1),p._subdivisionsX=r.subdivisionsX||r.subdivisions||1,p._subdivisionsY=r.subdivisionsY||r.subdivisions||1,p._width=r.width||1,p._height=r.height||1,p._maxX=p._width/2,p._maxZ=p._height/2,p._minX=-p._maxX,p._minZ=-p._maxZ;return w(r).aL(p,r.updatable),p._setReady(!0),p}function P(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new n.c(L,p);return g(r).aL(J,r.updatable),J}function O(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=p.width||10,j=p.height||10,z=p.subdivisions||1,E=p.minHeight||0,x=p.maxHeight||1,w=p.colorFilter||new i.Wr(.3,.59,.11),g=p.alphaFilter||0,c=p.updatable,P=p.onReady;J=J||t.c.LastCreatedScene;const O=new G(L,J);let h;O._subdivisionsX=z,O._subdivisionsY=z,O._width=n,O._height=j,O._maxX=O._width/2,O._maxZ=O._height/2,O._minX=-O._maxX,O._minZ=-O._maxZ,O._setReady(!1),p.passHeightBufferInCallback&&(h=new Float32Array((z+1)*(z+1)));const U=(L,r,p)=>{b({width:n,height:j,subdivisions:z,minHeight:E,maxHeight:x,colorFilter:w,buffer:L,bufferWidth:r,bufferHeight:p,alphaFilter:g,heightBuffer:h}).aL(O,c),P&&P(O,h),O._setReady(!0)};if("string"===typeof r){const L=L=>{var r;const p=L.width,i=L.height;if(J.P)return;const n=null===(r=J)||void 0===r?void 0:r.getEngine().resizeImageBitmap(L,p,i);U(n,p,i)};C.Tools.LoadImage(r,L,p.onError?p.onError:()=>{},J.offlineProvider)}else U(r.data,r.width,r.height);return O}j.d.CreateGround=w,j.d.CreateTiledGround=g,j.d.CreateGroundFromHeightMap=b,n.c.CreateGround=(L,r,p,J,i,n)=>c(L,{width:r,height:p,subdivisions:J,updatable:n},i),n.c.CreateTiledGround=(L,r,p,J,i,n,j,z,G)=>P(L,{xmin:r,zmin:p,xmax:J,zmax:i,subdivisions:n,precision:j,updatable:G},z),n.c.CreateGroundFromHeightMap=(L,r,p,J,i,n,j,z,G,C,t)=>O(L,r,{width:p,height:J,subdivisions:i,minHeight:n,maxHeight:j,updatable:G,onReady:C,alphaFilter:t},z)},14037:(L,r,p)=>{"use strict";p.d(r,{e:()=>w,g:()=>E,j:()=>x});var J=p(12136),i=p(12575),n=p(12555),j=p(12656),z=p(12208),G=p(11975);function C(L){const r=[],p=[],J=L.lines,i=L.yL,j=[];let z=0;for(let n=0;n<J.length;n++){const L=J[n];for(let J=0;J<L.length;J++){const{x:G,y:C,z:t}=L[J];if(p.push(G,C,t),i){const L=i[n],{r:r,g:p,b:z,a:G}=L[J];j.push(r,p,z,G)}J>0&&(r.push(z-1),r.push(z)),z++}}const G=new n.d;return G.indices=r,G.eL=p,i&&(G.yL=j),G}function t(L){const r=L.dashSize||3,p=L.gapSize||1,i=L.dashNb||200,j=L.points,z=[],G=[],C=J.cr.Zero();let t=0,E=0,x=0,w=0,g=0,b=0,c=0;for(c=0;c<j.length-1;c++)j[c+1].subtractToRef(j[c],C),t+=C.length();for(x=t/i,w=r*x/(r+p),c=0;c<j.length-1;c++){j[c+1].subtractToRef(j[c],C),E=Math.floor(C.length()/x),C.normalize();for(let L=0;L<E;L++)g=x*L,z.push(j[c].x+g*C.x,j[c].y+g*C.y,j[c].z+g*C.z),z.push(j[c].x+(g+w)*C.x,j[c].y+(g+w)*C.y,j[c].z+(g+w)*C.z),G.push(b,b+1),b+=2}const P=new n.d;return P.eL=z,P.indices=G,P}function E(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=r.instance,i=r.lines,n=r.yL;if(J){const L=J.getVerticesData(z.e.PositionKind);let r,p;n&&(r=J.getVerticesData(z.e.ColorKind));let j=0,G=0;for(let J=0;J<i.length;J++){const z=i[J];for(let i=0;i<z.length;i++)L[j]=z[i].x,L[j+1]=z[i].y,L[j+2]=z[i].z,n&&r&&(p=n[J],r[G]=p[i].r,r[G+1]=p[i].g,r[G+2]=p[i].b,r[G+3]=p[i].a,G+=4),j+=3}return J.updateVerticesData(z.e.PositionKind,L,!1,!1),n&&r&&J.updateVerticesData(z.e.ColorKind,r,!1,!1),J.refreshBoundingInfo(),J}const G=!!n,t=new j.e(L,p,null,void 0,void 0,G,r.useVertexAlpha,r.material);return C(r).aL(t,r.updatable),t}function x(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=r.yL?[r.yL]:null;return E(L,{lines:[r.points],updatable:r.updatable,instance:r.instance,yL:J,useVertexAlpha:r.useVertexAlpha,material:r.material},p)}function w(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=r.points,z=r.instance,C=r.gapSize||1,E=r.dashSize||3;if(z){const L=L=>{const r=J.cr.Zero(),p=L.length/6;let i=0,j=0,G=0,C=0,t=0,E=0,x=0,w=0;for(x=0;x<n.length-1;x++)n[x+1].subtractToRef(n[x],r),i+=r.length();G=i/p;const g=z._creationDataStorage.dashSize;for(C=g*G/(g+z._creationDataStorage.gapSize),x=0;x<n.length-1;x++)for(n[x+1].subtractToRef(n[x],r),j=Math.floor(r.length()/G),r.normalize(),w=0;w<j&&E<L.length;)t=G*w,L[E]=n[x].x+t*r.x,L[E+1]=n[x].y+t*r.y,L[E+2]=n[x].z+t*r.z,L[E+3]=n[x].x+(t+C)*r.x,L[E+4]=n[x].y+(t+C)*r.y,L[E+5]=n[x].z+(t+C)*r.z,E+=6,w++;for(;E<L.length;)L[E]=n[x].x,L[E+1]=n[x].y,L[E+2]=n[x].z,E+=3};return(r.dashNb||r.dashSize||r.gapSize||r.useVertexAlpha||r.material)&&G.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),z.updateMeshPositions(L,!1),z}const x=new j.e(L,p,null,void 0,void 0,void 0,r.useVertexAlpha,r.material);return t(r).aL(x,r.updatable),x._creationDataStorage=new i.g,x._creationDataStorage.dashSize=E,x._creationDataStorage.gapSize=C,x}n.d.CreateLineSystem=C,n.d.CreateDashedLines=t,i.c.OC=function(L,r){return x(L,{points:r,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},i.c.CreateDashedLines=function(L,r,p,J,i){return w(L,{points:r,dashSize:p,gapSize:J,dashNb:i,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13400:(L,r,p)=>{"use strict";p.d(r,{e:()=>z,i:()=>G});var J=p(12575),i=p(12555),n=p(12185);function j(L){const r=[],p=[],J=[],j=[],z=void 0!==L.width?L.width:void 0!==L.size?L.size:1,G=void 0!==L.height?L.height:void 0!==L.size?L.size:1,C=0===L.sideOrientation?0:L.sideOrientation||i.d.DEFAULTSIDE,t=z/2,E=G/2;p.push(-t,-E,0),J.push(0,0,-1),j.push(0,n.d?1:0),p.push(t,-E,0),J.push(0,0,-1),j.push(1,n.d?1:0),p.push(t,E,0),J.push(0,0,-1),j.push(1,n.d?0:1),p.push(-t,E,0),J.push(0,0,-1),j.push(0,n.d?0:1),r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),i.d._ComputeSides(C,p,r,J,j,L.frontUVs,L.backUVs);const x=new i.d;return x.indices=r,x.eL=p,x.vL=J,x.AL=j,x}function z(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new J.c(L,p);r.sideOrientation=J.c._GetDefaultSideOrientation(r.sideOrientation),i._originalBuilderSideOrientation=r.sideOrientation;return j(r).aL(i,r.updatable),r.sourcePlane&&(i.translate(r.sourcePlane.normal,-r.sourcePlane.d),i.setDirection(r.sourcePlane.normal.scale(-1))),i}const G={WC:z};i.d.WC=j,J.c.WC=(L,r,p,J,i)=>z(L,{size:r,width:r,height:r,sideOrientation:i,updatable:J},p)},13482:(L,r,p)=>{"use strict";p.d(r,{d:()=>G});var J=p(12136),i=p(12575),n=p(12555),j=p(12185);function z(L){const r=0|(L.segments||32),p=L.diameterX||L.diameter||1,i=L.diameterY||L.diameter||1,z=L.diameterZ||L.diameter||1,G=L.arc&&(L.arc<=0||L.arc>1)?1:L.arc||1,C=L.slice&&L.slice<=0?1:L.slice||1,t=0===L.sideOrientation?0:L.sideOrientation||n.d.DEFAULTSIDE,E=!!L.dedupTopBottomIndices,x=new J.cr(p/2,i/2,z/2),w=2+r,g=2*w,b=[],c=[],P=[],O=[];for(let n=0;n<=w;n++){const L=n/w,r=L*Math.PI*C;for(let p=0;p<=g;p++){const i=p/g,n=i*Math.PI*2*G,z=J.Matrix.RotationZ(-r),C=J.Matrix.RotationY(n),t=J.cr.TransformCoordinates(J.cr.Up(),z),E=J.cr.TransformCoordinates(t,C),w=E.multiply(x),b=E.divide(x).normalize();c.push(w.x,w.y,w.z),P.push(b.x,b.y,b.z),O.push(i,j.d?1-L:L)}if(n>0){const L=c.length/3;for(let r=L-2*(g+1);r+g+2<L;r++)E?(n>1&&(b.push(r),b.push(r+1),b.push(r+g+1)),(n<w||C<1)&&(b.push(r+g+1),b.push(r+1),b.push(r+g+2))):(b.push(r),b.push(r+1),b.push(r+g+1),b.push(r+g+1),b.push(r+1),b.push(r+g+2))}}n.d._ComputeSides(t,c,b,P,O,L.frontUVs,L.backUVs);const h=new n.d;return h.indices=b,h.eL=c,h.vL=P,h.AL=O,h}function G(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new i.c(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return z(r).aL(J,r.updatable),J}n.d.CreateSphere=z,i.c.CreateSphere=(L,r,p,J,i,n)=>G(L,{segments:r,diameterX:p,diameterY:p,diameterZ:p,sideOrientation:n,updatable:i},J)},14324:(L,r,p)=>{"use strict";p.d(r,{e:()=>z});var J=p(12684),i=p(13832),n=p(12706),j=p(12555);class z{static get Configuration(){return{get decoder(){return i.e.DefaultConfiguration},set decoder(L){i.e.DefaultConfiguration=L}}}static set Configuration(L){i.e.DefaultConfiguration=L.decoder}static get DecoderAvailable(){return(0,J.e)(i.e.DefaultConfiguration)}static get Default(){return z._Default??(z._Default=new z),z._Default}static ResetDefault(L){z._Default&&(L||z._Default.dispose(),z._Default=null)}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.DefaultNumWorkers;const r="number"===typeof L?{...i.e.DefaultConfiguration,numWorkers:L}:{...i.e.DefaultConfiguration,...L};this._decoder=new i.e(r)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(L,r,p){return this._decoder.decodeMeshToMeshDataAsync(L,r,p)}async decodeMeshToGeometryAsync(L,r,p,J){return await this._decoder.decodeMeshToGeometryAsync(L,r,p,J)}async _decodeMeshToGeometryForGltfAsync(L,r,p,J,i,n){return await this._decoder._decodeMeshToGeometryForGltfAsync(L,r,p,J,i,n)}async decodeMeshAsync(L,r){const p=await this._decoder.decodeMeshToMeshDataAsync(L,r),J=new j.d;p.indices&&(J.indices=p.indices);for(const i of p.attributes){const L=n.e.GetFloatData(i.data,i.size,n.e.GetDataType(i.data),i.byteOffset,i.byteStride,i.normalized,p.totalVertices);J.set(L,i.kind)}return J}}z.DefaultNumWorkers=(0,J.d)(),z._Default=null},13832:(L,r,p)=>{"use strict";p.d(r,{e:()=>C});var J=p(12684),i=p(11957),n=p(12584),j=p(12706),z=p(11975),G=p(12697);class C extends J.b{static get DefaultAvailable(){return(0,J.e)(C.DefaultConfiguration)}static get Default(){return C._Default??(C._Default=new C),C._Default}static ResetDefault(L){C._Default&&(L||C._Default.dispose(),C._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(L,r){return{module:await(r||DracoDecoderModule)({wasmBinary:L})}}_getWorkerContent(){return`${G.d}(${G.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultConfiguration)}decodeMeshToMeshDataAsync(L,r,p){const J=L instanceof ArrayBuffer?new Int8Array(L):new Int8Array(L.buffer,L.byteOffset,L.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async L=>await new Promise(((i,n)=>{L.push(((L,j)=>{let G=null;const C=[],t=r=>{L.removeEventListener("error",t),L.removeEventListener("message",E),n(r),j()},E=r=>{const J=r.data;switch(J.id){case"indices":G=J.data;break;case"attribute":C.push({kind:J.kind,data:J.data,size:J.size,byteOffset:J.byteOffset,byteStride:J.byteStride,normalized:(n=J.kind,x=J.normalized,p&&void 0!==p[n]?(x!==p[n]&&z.d.Warn(`Normalized flag from Draco data (${x}) does not match normalized flag from glTF accessor (${p[n]}). Using flag from glTF accessor.`),p[n]):x)});break;case"decodeMeshDone":L.removeEventListener("error",t),L.removeEventListener("message",E),i({indices:G,attributes:C,totalVertices:J.totalVertices}),j()}var n,x};L.addEventListener("error",t),L.addEventListener("message",E);const x=J.slice();L.postMessage({id:"decodeMesh",dataView:x,attributes:r},[x.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((L=>{let p=null;const i=[],n=(0,G.d)(L.module,J,r,(L=>{p=L}),((L,r,p,J,n,j)=>{i.push({kind:L,data:r,size:p,byteOffset:J,byteStride:n,normalized:j})}));return{indices:p,attributes:i,totalVertices:n}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(L,r,p,J){const i=await this.decodeMeshToMeshDataAsync(p,J),z=new n.d(L,r);i.indices&&z.setIndices(i.indices);for(const n of i.attributes)z.setVerticesBuffer(new j.e(r.getEngine(),n.data,n.kind,!1,void 0,n.byteStride,void 0,n.byteOffset,n.size,void 0,n.normalized,!0),i.totalVertices);return z}async _decodeMeshToGeometryForGltfAsync(L,r,p,J,i,z){const G=await this.decodeMeshToMeshDataAsync(p,J,i),C=new n.d(L,r);z&&(C._boundingInfo=z,C.useBoundingInfoFromGeometry=!0),G.indices&&C.setIndices(G.indices);for(const n of G.attributes)C.setVerticesBuffer(new j.e(r.getEngine(),n.data,n.kind,!1,void 0,n.byteStride,void 0,n.byteOffset,n.size,void 0,n.normalized,!0),G.totalVertices);return C}}C.DefaultConfiguration={wasmUrl:`${i.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${i.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${i.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},C._Default=null},14033:(L,r,p)=>{"use strict";p.d(r,{e:()=>zL});var J=p(12136),i=p(12575),n=p(12208),j=p(12555),z=p(12185);function G(L){let r=L.pathArray;const p=L.closeArray||!1,J=L.closePath||!1,i=L.invertUV||!1,G=Math.floor(r[0].length/2);let C=L.offset||G;C=C>G?G:Math.floor(C);const t=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE,E=L.AL,x=L.yL,w=[],g=[],b=[],c=[],P=[],O=[],h=[],U=[];let W;const B=[],F=[];let Q,e,v;if(r.length<2){const L=[],p=[];for(e=0;e<r[0].length-C;e++)L.push(r[0][e]),p.push(r[0][e+C]);r=[L,p]}let y=0;const A=J?1:0,u=p?1:0;let a,q,Z,X,D,l;for(W=r[0].length,Q=0;Q<r.length+u;Q++){for(h[Q]=0,P[Q]=[0],a=Q===r.length?r[0]:r[Q],q=a.length,W=W<q?W:q,v=0;v<q;)w.push(a[v].x,a[v].y,a[v].z),v>0&&(Z=a[v].Pr(a[v-1]).length(),X=Z+h[Q],P[Q].push(X),h[Q]=X),v++;J&&(v--,w.push(a[0].x,a[0].y,a[0].z),Z=a[v].Pr(a[0]).length(),X=Z+h[Q],P[Q].push(X),h[Q]=X),B[Q]=q+A,F[Q]=y,y+=q+A}let T,Y,M=null,f=null;for(e=0;e<W+A;e++)for(U[e]=0,O[e]=[0],Q=0;Q<r.length-1+u;Q++)D=r[Q],l=Q===r.length-1?r[0]:r[Q+1],e===W?(M=D[0],f=l[0]):(M=D[e],f=l[e]),Z=f.Pr(M).length(),X=Z+U[e],O[e].push(X),U[e]=X;if(E)for(Q=0;Q<E.length;Q++)c.push(E[Q].x,z.d?1-E[Q].y:E[Q].y);else for(Q=0;Q<r.length+u;Q++)for(e=0;e<W+A;e++)T=0!=h[Q]?P[Q][e]/h[Q]:0,Y=0!=U[e]?O[e][Q]/U[e]:0,i?c.push(Y,T):c.push(T,z.d?1-Y:Y);Q=0;let d=0,s=B[Q]-1,H=B[Q+1]-1,o=s<H?s:H,k=F[1]-F[0];const R=B.length-1;for(;d<=o&&Q<R;)g.push(d,d+k,d+1),g.push(d+k+1,d+1,d+k),d+=1,d===o&&(Q++,k=F[Q+1]-F[Q],s=B[Q]-1,H=B[Q+1]-1,d=F[Q],o=s<H?s+d:H+d);if(j.d.ComputeNormals(w,g,b),J){let L=0,p=0;for(Q=0;Q<r.length;Q++){L=3*F[Q],p=Q+1<r.length?3*(F[Q+1]-1):b.length-3,b[L]=.5*(b[L]+b[p]),b[L+1]=.5*(b[L+1]+b[p+1]),b[L+2]=.5*(b[L+2]+b[p+2]);const J=Math.sqrt(b[L]*b[L]+b[L+1]*b[L+1]+b[L+2]*b[L+2]);b[L]/=J,b[L+1]/=J,b[L+2]/=J,b[p]=b[L],b[p+1]=b[L+1],b[p+2]=b[L+2]}}if(p){let L=3*F[0],p=3*F[r.length];for(e=0;e<W+A;e++){b[L]=.5*(b[L]+b[p]),b[L+1]=.5*(b[L+1]+b[p+1]),b[L+2]=.5*(b[L+2]+b[p+2]);const r=Math.sqrt(b[L]*b[L]+b[L+1]*b[L+1]+b[L+2]*b[L+2]);b[L]/=r,b[L+1]/=r,b[L+2]/=r,b[p]=b[L],b[p+1]=b[L+1],b[p+2]=b[L+2],L+=3,p+=3}}j.d._ComputeSides(t,w,g,b,c,L.frontUVs,L.backUVs);let I=null;if(x){I=new Float32Array(4*x.length);for(let L=0;L<x.length;L++)I[4*L]=x[L].r,I[4*L+1]=x[L].g,I[4*L+2]=x[L].b,I[4*L+3]=x[L].a}const N=new j.d,K=new Float32Array(w),mL=new Float32Array(b),V=new Float32Array(c);return N.indices=g,N.eL=K,N.vL=mL,N.AL=V,I&&N.set(I,n.e.ColorKind),J&&(N._idx=F),N}function C(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=r.pathArray,t=r.closeArray,E=r.closePath,x=i.c._GetDefaultSideOrientation(r.sideOrientation),w=r.instance,g=r.updatable;if(w){const L=J.TmpVectors.cr[0].Bz(Number.MAX_VALUE),p=J.TmpVectors.cr[1].Bz(-Number.MAX_VALUE),G=r=>{let J=C[0].length;const n=w;let j=0;const z=n._originalBuilderSideOrientation===i.c.DOUBLESIDE?2:1;for(let i=1;i<=z;++i)for(let z=0;z<C.length;++z){const i=C[z],G=i.length;J=J<G?J:G;for(let n=0;n<J;++n){const J=i[n];r[j]=J.x,r[j+1]=J.y,r[j+2]=J.z,L.minimizeInPlaceFromFloats(J.x,J.y,J.z),p.maximizeInPlaceFromFloats(J.x,J.y,J.z),j+=3}if(n._creationDataStorage&&n._creationDataStorage.closePath){const L=i[0];r[j]=L.x,r[j+1]=L.y,r[j+2]=L.z,j+=3}}},t=w.getVerticesData(n.e.PositionKind);if(G(t),w.hasBoundingInfo?w.getBoundingInfo().reConstruct(L,p,w._worldMatrix):w.buildBoundingInfo(L,p,w._worldMatrix),w.updateVerticesData(n.e.PositionKind,t,!1,!1),r.yL){const L=w.getVerticesData(n.e.ColorKind);for(let p=0,J=0;p<r.yL.length;p++,J+=4){const i=r.yL[p];L[J]=i.r,L[J+1]=i.g,L[J+2]=i.b,L[J+3]=i.a}w.updateVerticesData(n.e.ColorKind,L,!1,!1)}if(r.AL){const L=w.getVerticesData(n.e.UVKind);for(let p=0;p<r.AL.length;p++)L[2*p]=r.AL[p].x,L[2*p+1]=z.d?1-r.AL[p].y:r.AL[p].y;w.updateVerticesData(n.e.UVKind,L,!1,!1)}if(!w.areNormalsFrozen||w.isFacetDataEnabled){const L=w.Oz(),r=w.getVerticesData(n.e.NormalKind),p=w.isFacetDataEnabled?w.getFacetDataParameters():null;if(j.d.ComputeNormals(t,L,r,p),w._creationDataStorage&&w._creationDataStorage.closePath){let L=0,p=0;for(let J=0;J<C.length;J++)L=3*w._creationDataStorage.idx[J],p=J+1<C.length?3*(w._creationDataStorage.idx[J+1]-1):r.length-3,r[L]=.5*(r[L]+r[p]),r[L+1]=.5*(r[L+1]+r[p+1]),r[L+2]=.5*(r[L+2]+r[p+2]),r[p]=r[L],r[p+1]=r[L+1],r[p+2]=r[L+2]}w.areNormalsFrozen||w.updateVerticesData(n.e.NormalKind,r,!1,!1)}return w}{const J=new i.c(L,p);J._originalBuilderSideOrientation=x,J._creationDataStorage=new i.g;const n=G(r);return E&&(J._creationDataStorage.idx=n._idx),J._creationDataStorage.closePath=E,J._creationDataStorage.closeArray=t,n.aL(J,g),J}}j.d.CreateRibbon=G,i.c.CreateRibbon=function(L,r){return C(L,{pathArray:r,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var t=p(13494),E=p(13333),x=p(12170);function w(L){const r=L.pattern||i.c.NO_FLIP,p=L.tileWidth||L.tileSize||1,J=L.tileHeight||L.tileSize||1,n=L.alignHorizontal||0,z=L.alignVertical||0,G=L.width||L.size||1,C=Math.floor(G/p);let t=G-C*p;const E=L.height||L.size||1,x=Math.floor(E/J);let w=E-x*J;const g=p*C/2,b=J*x/2;let c=0,P=0,O=0,h=0,U=0,W=0;if(t>0||w>0){switch(O=-g,h=-b,U=g,W=b,n){case i.c.CENTER:t/=2,O-=t,U+=t;break;case i.c.LEFT:U+=t,c=-t/2;break;case i.c.RIGHT:O-=t,c=t/2}switch(z){case i.c.CENTER:w/=2,h-=w,W+=w;break;case i.c.BOTTOM:W+=w,P=-w/2;break;case i.c.TOP:h-=w,P=w/2}}const B=[],F=[],Q=[];Q[0]=[0,0,1,0,1,1,0,1],Q[1]=[0,0,1,0,1,1,0,1],r!==i.c.ROTATE_TILE&&r!==i.c.ROTATE_ROW||(Q[1]=[1,1,0,1,0,0,1,0]),r!==i.c.FLIP_TILE&&r!==i.c.FLIP_ROW||(Q[1]=[1,0,0,0,0,1,1,1]),r!==i.c.FLIP_N_ROTATE_TILE&&r!==i.c.FLIP_N_ROTATE_ROW||(Q[1]=[0,1,1,1,1,0,0,0]);let e=[];const v=[],y=[];let A=0;for(let j=0;j<x;j++)for(let L=0;L<C;L++)B.push(L*p-g+c,j*J-b+P,0),B.push((L+1)*p-g+c,j*J-b+P,0),B.push((L+1)*p-g+c,(j+1)*J-b+P,0),B.push(L*p-g+c,(j+1)*J-b+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),e=r===i.c.FLIP_TILE||r===i.c.ROTATE_TILE||r===i.c.FLIP_N_ROTATE_TILE?e.concat(Q[(L%2+j%2)%2]):r===i.c.FLIP_ROW||r===i.c.ROTATE_ROW||r===i.c.FLIP_N_ROTATE_ROW?e.concat(Q[j%2]):e.concat(Q[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),A+=4;if(t>0||w>0){const L=w>0&&(z===i.c.CENTER||z===i.c.TOP),j=w>0&&(z===i.c.CENTER||z===i.c.BOTTOM),G=t>0&&(n===i.c.CENTER||n===i.c.RIGHT),E=t>0&&(n===i.c.CENTER||n===i.c.LEFT);let Q,u,a,q,Z=[];if(L&&G&&(B.push(O+c,h+P,0),B.push(-g+c,h+P,0),B.push(-g+c,h+w+P,0),B.push(O+c,h+w+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,Q=1-t/p,u=1-w/J,a=1,q=1,Z=[Q,u,a,u,a,q,Q,q],r===i.c.ROTATE_ROW&&(Z=[1-Q,1-u,1-a,1-u,1-a,1-q,1-Q,1-q]),r===i.c.FLIP_ROW&&(Z=[1-Q,u,1-a,u,1-a,q,1-Q,q]),r===i.c.FLIP_N_ROTATE_ROW&&(Z=[Q,1-u,a,1-u,a,1-q,Q,1-q]),e=e.concat(Z),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&E&&(B.push(g+c,h+P,0),B.push(U+c,h+P,0),B.push(U+c,h+w+P,0),B.push(g+c,h+w+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,Q=0,u=1-w/J,a=t/p,q=1,Z=[Q,u,a,u,a,q,Q,q],(r===i.c.ROTATE_ROW||r===i.c.ROTATE_TILE&&C%2===0)&&(Z=[1-Q,1-u,1-a,1-u,1-a,1-q,1-Q,1-q]),(r===i.c.FLIP_ROW||r===i.c.FLIP_TILE&&C%2===0)&&(Z=[1-Q,u,1-a,u,1-a,q,1-Q,q]),(r===i.c.FLIP_N_ROTATE_ROW||r===i.c.FLIP_N_ROTATE_TILE&&C%2===0)&&(Z=[Q,1-u,a,1-u,a,1-q,Q,1-q]),e=e.concat(Z),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),j&&G&&(B.push(O+c,b+P,0),B.push(-g+c,b+P,0),B.push(-g+c,W+P,0),B.push(O+c,W+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,Q=1-t/p,u=0,a=1,q=w/J,Z=[Q,u,a,u,a,q,Q,q],(r===i.c.ROTATE_ROW&&x%2===1||r===i.c.ROTATE_TILE&&x%1===0)&&(Z=[1-Q,1-u,1-a,1-u,1-a,1-q,1-Q,1-q]),(r===i.c.FLIP_ROW&&x%2===1||r===i.c.FLIP_TILE&&x%2===0)&&(Z=[1-Q,u,1-a,u,1-a,q,1-Q,q]),(r===i.c.FLIP_N_ROTATE_ROW&&x%2===1||r===i.c.FLIP_N_ROTATE_TILE&&x%2===0)&&(Z=[Q,1-u,a,1-u,a,1-q,Q,1-q]),e=e.concat(Z),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),j&&E&&(B.push(g+c,b+P,0),B.push(U+c,b+P,0),B.push(U+c,W+P,0),B.push(g+c,W+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,Q=0,u=0,a=t/p,q=w/J,Z=[Q,u,a,u,a,q,Q,q],(r===i.c.ROTATE_ROW&&x%2===1||r===i.c.ROTATE_TILE&&(x+C)%2===1)&&(Z=[1-Q,1-u,1-a,1-u,1-a,1-q,1-Q,1-q]),(r===i.c.FLIP_ROW&&x%2===1||r===i.c.FLIP_TILE&&(x+C)%2===1)&&(Z=[1-Q,u,1-a,u,1-a,q,1-Q,q]),(r===i.c.FLIP_N_ROTATE_ROW&&x%2===1||r===i.c.FLIP_N_ROTATE_TILE&&(x+C)%2===1)&&(Z=[Q,1-u,a,1-u,a,1-q,Q,1-q]),e=e.concat(Z),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L){const L=[];Q=0,u=1-w/J,a=1,q=1,L[0]=[Q,u,a,u,a,q,Q,q],L[1]=[Q,u,a,u,a,q,Q,q],r!==i.c.ROTATE_TILE&&r!==i.c.ROTATE_ROW||(L[1]=[1-Q,1-u,1-a,1-u,1-a,1-q,1-Q,1-q]),r!==i.c.FLIP_TILE&&r!==i.c.FLIP_ROW||(L[1]=[1-Q,u,1-a,u,1-a,q,1-Q,q]),r!==i.c.FLIP_N_ROTATE_TILE&&r!==i.c.FLIP_N_ROTATE_ROW||(L[1]=[Q,1-u,a,1-u,a,1-q,Q,1-q]);for(let J=0;J<C;J++)B.push(J*p-g+c,h+P,0),B.push((J+1)*p-g+c,h+P,0),B.push((J+1)*p-g+c,h+w+P,0),B.push(J*p-g+c,h+w+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,e=r===i.c.FLIP_TILE||r===i.c.ROTATE_TILE||r===i.c.FLIP_N_ROTATE_TILE?e.concat(L[(J+1)%2]):r===i.c.FLIP_ROW||r===i.c.ROTATE_ROW||r===i.c.FLIP_N_ROTATE_ROW?e.concat(L[1]):e.concat(L[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(j){const L=[];Q=0,u=0,a=1,q=w/J,L[0]=[Q,u,a,u,a,q,Q,q],L[1]=[Q,u,a,u,a,q,Q,q],r!==i.c.ROTATE_TILE&&r!==i.c.ROTATE_ROW||(L[1]=[1-Q,1-u,1-a,1-u,1-a,1-q,1-Q,1-q]),r!==i.c.FLIP_TILE&&r!==i.c.FLIP_ROW||(L[1]=[1-Q,u,1-a,u,1-a,q,1-Q,q]),r!==i.c.FLIP_N_ROTATE_TILE&&r!==i.c.FLIP_N_ROTATE_ROW||(L[1]=[Q,1-u,a,1-u,a,1-q,Q,1-q]);for(let J=0;J<C;J++)B.push(J*p-g+c,W-w+P,0),B.push((J+1)*p-g+c,W-w+P,0),B.push((J+1)*p-g+c,W+P,0),B.push(J*p-g+c,W+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,e=r===i.c.FLIP_TILE||r===i.c.ROTATE_TILE||r===i.c.FLIP_N_ROTATE_TILE?e.concat(L[(J+x)%2]):r===i.c.FLIP_ROW||r===i.c.ROTATE_ROW||r===i.c.FLIP_N_ROTATE_ROW?e.concat(L[x%2]):e.concat(L[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const L=[];Q=1-t/p,u=0,a=1,q=1,L[0]=[Q,u,a,u,a,q,Q,q],L[1]=[Q,u,a,u,a,q,Q,q],r!==i.c.ROTATE_TILE&&r!==i.c.ROTATE_ROW||(L[1]=[1-Q,1-u,1-a,1-u,1-a,1-q,1-Q,1-q]),r!==i.c.FLIP_TILE&&r!==i.c.FLIP_ROW||(L[1]=[1-Q,u,1-a,u,1-a,q,1-Q,q]),r!==i.c.FLIP_N_ROTATE_TILE&&r!==i.c.FLIP_N_ROTATE_ROW||(L[1]=[Q,1-u,a,1-u,a,1-q,Q,1-q]);for(let p=0;p<x;p++)B.push(O+c,p*J-b+P,0),B.push(O+t+c,p*J-b+P,0),B.push(O+t+c,(p+1)*J-b+P,0),B.push(O+c,(p+1)*J-b+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,e=r===i.c.FLIP_TILE||r===i.c.ROTATE_TILE||r===i.c.FLIP_N_ROTATE_TILE?e.concat(L[(p+1)%2]):r===i.c.FLIP_ROW||r===i.c.ROTATE_ROW||r===i.c.FLIP_N_ROTATE_ROW?e.concat(L[p%2]):e.concat(L[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const L=[];Q=0,u=0,a=t/J,q=1,L[0]=[Q,u,a,u,a,q,Q,q],L[1]=[Q,u,a,u,a,q,Q,q],r!==i.c.ROTATE_TILE&&r!==i.c.ROTATE_ROW||(L[1]=[1-Q,1-u,1-a,1-u,1-a,1-q,1-Q,1-q]),r!==i.c.FLIP_TILE&&r!==i.c.FLIP_ROW||(L[1]=[1-Q,u,1-a,u,1-a,q,1-Q,q]),r!==i.c.FLIP_N_ROTATE_TILE&&r!==i.c.FLIP_N_ROTATE_ROW||(L[1]=[Q,1-u,a,1-u,a,1-q,Q,1-q]);for(let p=0;p<x;p++)B.push(U-t+c,p*J-b+P,0),B.push(U+c,p*J-b+P,0),B.push(U+c,(p+1)*J-b+P,0),B.push(U-t+c,(p+1)*J-b+P,0),y.push(A,A+1,A+3,A+1,A+2,A+3),A+=4,e=r===i.c.FLIP_TILE||r===i.c.ROTATE_TILE||r===i.c.FLIP_N_ROTATE_TILE?e.concat(L[(p+C)%2]):r===i.c.FLIP_ROW||r===i.c.ROTATE_ROW||r===i.c.FLIP_N_ROTATE_ROW?e.concat(L[p%2]):e.concat(L[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),F.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const u=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE;j.d._ComputeSides(u,B,y,F,e,L.frontUVs,L.backUVs);const a=new j.d;a.indices=y,a.eL=B,a.vL=F,a.AL=e;const q=u===j.d.DOUBLESIDE?v.concat(v):v;return a.yL=q,a}function g(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new i.c(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return w(r).aL(J,r.updatable),J}function b(L){const r=L.faceUV||new Array(6),p=L.faceColors,n=L.pattern||i.c.NO_FLIP,G=L.width||L.size||1,C=L.height||L.size||1,t=L.depth||L.size||1,E=L.tileWidth||L.tileSize||1,g=L.tileHeight||L.tileSize||1,b=L.alignHorizontal||0,c=L.alignVertical||0,P=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE;for(let i=0;i<6;i++)void 0===r[i]&&(r[i]=new J.Vector4(0,0,1,1)),p&&void 0===p[i]&&(p[i]=new x.Fz(1,1,1,1));const O=G/2,h=C/2,U=t/2,W=[];for(let J=0;J<2;J++)W[J]=w({pattern:n,tileWidth:E,tileHeight:g,width:G,height:C,alignVertical:c,alignHorizontal:b,sideOrientation:P});for(let J=2;J<4;J++)W[J]=w({pattern:n,tileWidth:E,tileHeight:g,width:t,height:C,alignVertical:c,alignHorizontal:b,sideOrientation:P});let B=c;c===i.c.BOTTOM?B=i.c.TOP:c===i.c.TOP&&(B=i.c.BOTTOM);for(let J=4;J<6;J++)W[J]=w({pattern:n,tileWidth:E,tileHeight:g,width:G,height:t,alignVertical:B,alignHorizontal:b,sideOrientation:P});let F=[],Q=[],e=[],v=[];const y=[],A=[],u=[],a=[];let q=0,Z=0;for(let i=0;i<6;i++){const L=W[i].eL.length;A[i]=[],u[i]=[];for(let r=0;r<L/3;r++)A[i].push(new J.cr(W[i].eL[3*r],W[i].eL[3*r+1],W[i].eL[3*r+2])),u[i].push(new J.cr(W[i].vL[3*r],W[i].vL[3*r+1],W[i].vL[3*r+2]));q=W[i].AL.length,a[i]=[];for(let p=0;p<q;p+=2)a[i][p]=r[i].x+(r[i].z-r[i].x)*W[i].AL[p],a[i][p+1]=r[i].y+(r[i].w-r[i].y)*W[i].AL[p+1],z.d&&(a[i][p+1]=1-a[i][p+1]);if(e=e.concat(a[i]),v=v.concat(W[i].indices.map((L=>L+Z))),Z+=A[i].length,p)for(let r=0;r<4;r++)y.push(p[i].r,p[i].g,p[i].b,p[i].a)}const X=new J.cr(0,0,U),D=J.Matrix.RotationY(Math.PI);F=A[0].map((L=>J.cr.TransformNormal(L,D).add(X))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[]),Q=u[0].map((L=>J.cr.TransformNormal(L,D))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[]),F=F.concat(A[1].map((L=>L.Pr(X))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[])),Q=Q.concat(u[1].map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[]));const l=new J.cr(O,0,0),T=J.Matrix.RotationY(-Math.PI/2);F=F.concat(A[2].map((L=>J.cr.TransformNormal(L,T).add(l))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[])),Q=Q.concat(u[2].map((L=>J.cr.TransformNormal(L,T))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[]));const Y=J.Matrix.RotationY(Math.PI/2);F=F.concat(A[3].map((L=>J.cr.TransformNormal(L,Y).Pr(l))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[])),Q=Q.concat(u[3].map((L=>J.cr.TransformNormal(L,Y))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[]));const M=new J.cr(0,h,0),f=J.Matrix.RotationX(Math.PI/2);F=F.concat(A[4].map((L=>J.cr.TransformNormal(L,f).add(M))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[])),Q=Q.concat(u[4].map((L=>J.cr.TransformNormal(L,f))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[]));const d=J.Matrix.RotationX(-Math.PI/2);F=F.concat(A[5].map((L=>J.cr.TransformNormal(L,d).Pr(M))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[])),Q=Q.concat(u[5].map((L=>J.cr.TransformNormal(L,d))).map((L=>[L.x,L.y,L.z])).reduce(((L,r)=>L.concat(r)),[])),j.d._ComputeSides(P,F,v,Q,e);const s=new j.d;if(s.indices=v,s.eL=F,s.vL=Q,s.AL=e,p){const L=P===j.d.DOUBLESIDE?y.concat(y):y;s.yL=L}return s}function c(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new i.c(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return b(r).aL(J,r.updatable),J}j.d.CreateTiledPlane=w;j.d.CreateTiledBox=b;var P=p(13482),O=p(12355),h=p(12311);function U(L){const r=L.height||2;let p=0===L.diameterTop?0:L.diameterTop||L.diameter||1,n=0===L.diameterBottom?0:L.diameterBottom||L.diameter||1;p=p||1e-5,n=n||1e-5;const G=0|(L.tessellation||24),C=0|(L.subdivisions||1),t=!!L.hasRings,E=!!L.enclose,w=0===L.cap?0:L.cap||i.c.CAP_ALL,g=L.arc&&(L.arc<=0||L.arc>1)?1:L.arc||1,b=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE,c=L.faceUV||new Array(3),P=L.faceColors,O=2+(1+(1!==g&&E?2:0))*(t?C:1);let U;for(U=0;U<O;U++)P&&void 0===P[U]&&(P[U]=new x.Fz(1,1,1,1));for(U=0;U<O;U++)c&&void 0===c[U]&&(c[U]=new J.Vector4(0,0,1,1));const W=[],B=[],F=[],Q=[],e=[],v=2*Math.PI*g/G;let y,A,u;const a=(n-p)/2/r,q=J.cr.Zero(),Z=J.cr.Zero(),X=J.cr.Zero(),D=J.cr.Zero(),l=J.cr.Zero(),T=h.b.Y;let Y,M,f,d=1,s=1,H=0,o=0;for(Y=0;Y<=C;Y++)for(A=Y/C,u=(A*(p-n)+n)/2,d=t&&0!==Y&&Y!==C?2:1,f=0;f<d;f++){for(t&&(s+=f),E&&(s+=2*f),M=0;M<=G;M++)y=M*v,q.x=Math.cos(-y)*u,q.y=-r/2+A*r,q.z=Math.sin(-y)*u,0===p&&Y===C?(Z.x=F[F.length-3*(G+1)],Z.y=F[F.length-3*(G+1)+1],Z.z=F[F.length-3*(G+1)+2]):(Z.x=q.x,Z.z=q.z,Z.y=Math.sqrt(Z.x*Z.x+Z.z*Z.z)*a,Z.normalize()),0===M&&(X.G(q),D.G(Z)),B.push(q.x,q.y,q.z),F.push(Z.x,Z.y,Z.z),o=t?H!==s?c[s].y:c[s].w:c[s].y+(c[s].w-c[s].y)*A,Q.push(c[s].x+(c[s].z-c[s].x)*M/G,z.d?1-o:o),P&&e.push(P[s].r,P[s].g,P[s].b,P[s].a);1!==g&&E&&(B.push(q.x,q.y,q.z),B.push(0,q.y,0),B.push(0,q.y,0),B.push(X.x,X.y,X.z),J.cr.CrossToRef(T,Z,l),l.normalize(),F.push(l.x,l.y,l.z,l.x,l.y,l.z),J.cr.CrossToRef(D,T,l),l.normalize(),F.push(l.x,l.y,l.z,l.x,l.y,l.z),o=t?H!==s?c[s+1].y:c[s+1].w:c[s+1].y+(c[s+1].w-c[s+1].y)*A,Q.push(c[s+1].x,z.d?1-o:o),Q.push(c[s+1].z,z.d?1-o:o),o=t?H!==s?c[s+2].y:c[s+2].w:c[s+2].y+(c[s+2].w-c[s+2].y)*A,Q.push(c[s+2].x,z.d?1-o:o),Q.push(c[s+2].z,z.d?1-o:o),P&&(e.push(P[s+1].r,P[s+1].g,P[s+1].b,P[s+1].a),e.push(P[s+1].r,P[s+1].g,P[s+1].b,P[s+1].a),e.push(P[s+2].r,P[s+2].g,P[s+2].b,P[s+2].a),e.push(P[s+2].r,P[s+2].g,P[s+2].b,P[s+2].a))),H!==s&&(H=s)}const k=1!==g&&E?G+4:G;for(Y=0,s=0;s<C;s++){let L=0,r=0,p=0,J=0;for(M=0;M<G;M++)L=Y*(k+1)+M,r=(Y+1)*(k+1)+M,p=Y*(k+1)+(M+1),J=(Y+1)*(k+1)+(M+1),W.push(L,r,p),W.push(J,p,r);1!==g&&E&&(W.push(L+2,r+2,p+2),W.push(J+2,p+2,r+2),W.push(L+4,r+4,p+4),W.push(J+4,p+4,r+4)),Y=t?Y+2:Y+1}const R=L=>{const i=L?p/2:n/2;if(0===i)return;let j,C,t;const E=L?c[O-1]:c[0];let x=null;P&&(x=L?P[O-1]:P[0]);const w=B.length/3,b=L?r/2:-r/2,h=new J.cr(0,b,0);B.push(h.x,h.y,h.z),F.push(0,L?1:-1,0);const U=E.y+.5*(E.w-E.y);Q.push(E.x+.5*(E.z-E.x),z.d?1-U:U),x&&e.push(x.r,x.g,x.b,x.a);const v=new J.Vector2(.5,.5);for(t=0;t<=G;t++){j=2*Math.PI*t*g/G;const r=Math.cos(-j),p=Math.sin(-j);C=new J.cr(r*i,b,p*i);const n=new J.Vector2(r*v.x+.5,p*v.y+.5);B.push(C.x,C.y,C.z),F.push(0,L?1:-1,0);const w=E.y+(E.w-E.y)*n.y;Q.push(E.x+(E.z-E.x)*n.x,z.d?1-w:w),x&&e.push(x.r,x.g,x.b,x.a)}for(t=0;t<G;t++)L?(W.push(w),W.push(w+(t+2)),W.push(w+(t+1))):(W.push(w),W.push(w+(t+1)),W.push(w+(t+2)))};w!==i.c.CAP_START&&w!==i.c.CAP_ALL||R(!1),w!==i.c.CAP_END&&w!==i.c.CAP_ALL||R(!0),j.d._ComputeSides(b,B,W,F,Q,L.frontUVs,L.backUVs);const I=new j.d;return I.indices=W,I.eL=B,I.vL=F,I.AL=Q,P&&(I.yL=e),I}function W(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const J=new i.c(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return U(r).aL(J,r.updatable),J}function B(L){const r=[],p=[],i=[],n=[],G=L.diameter||1,C=L.thickness||.5,t=0|(L.tessellation||16),E=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE,x=t+1;for(let j=0;j<=t;j++){const L=j/t,E=j*Math.PI*2/t-Math.PI/2,w=J.Matrix.Translation(G/2,0,0).multiply(J.Matrix.RotationY(E));for(let G=0;G<=t;G++){const E=1-G/t,g=G*Math.PI*2/t+Math.PI,b=Math.cos(g),c=Math.sin(g);let P=new J.cr(b,c,0),O=P.scale(C/2);const h=new J.Vector2(L,E);O=J.cr.TransformCoordinates(O,w),P=J.cr.TransformNormal(P,w),p.push(O.x,O.y,O.z),i.push(P.x,P.y,P.z),n.push(h.x,z.d?1-h.y:h.y);const U=(j+1)%x,W=(G+1)%x;r.push(j*x+G),r.push(j*x+W),r.push(U*x+G),r.push(j*x+W),r.push(U*x+W),r.push(U*x+G)}}j.d._ComputeSides(E,p,r,i,n,L.frontUVs,L.backUVs);const w=new j.d;return w.indices=r,w.eL=p,w.vL=i,w.AL=n,w}function F(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const J=new i.c(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return B(r).aL(J,r.updatable),J}j.d.CreateCylinder=U,i.c.CreateCylinder=(L,r,p,J,n,j,z,G,C)=>{void 0!==z&&z instanceof O.b||(void 0!==z&&(C=G||i.c.DEFAULTSIDE,G=z),z=j,j=1);return W(L,{height:r,diameterTop:p,diameterBottom:J,tessellation:n,subdivisions:j,sideOrientation:C,updatable:G},z)};function Q(L){const r=[],p=[],i=[],n=[],G=L.radius||2,C=L.tube||.5,t=L.radialSegments||32,E=L.tubularSegments||32,x=L.p||2,w=L.q||3,g=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE,b=L=>{const r=Math.cos(L),p=Math.sin(L),i=w/x*L,n=Math.cos(i),j=G*(2+n)*.5*r,z=G*(2+n)*p*.5,C=G*Math.sin(i)*.5;return new J.cr(j,z,C)};let c,P;for(c=0;c<=t;c++){const L=c%t/t*2*x*Math.PI,r=b(L),i=b(L+.01),j=i.Pr(r);let G=i.add(r);const w=J.cr.Cross(j,G);for(G=J.cr.Cross(w,j),w.normalize(),G.normalize(),P=0;P<E;P++){const L=P%E/E*2*Math.PI,J=-C*Math.cos(L),i=C*Math.sin(L);p.push(r.x+J*G.x+i*w.x),p.push(r.y+J*G.y+i*w.y),p.push(r.z+J*G.z+i*w.z),n.push(c/t),n.push(z.d?1-P/E:P/E)}}for(c=0;c<t;c++)for(P=0;P<E;P++){const L=(P+1)%E,p=c*E+P,J=(c+1)*E+P,i=(c+1)*E+L,n=c*E+L;r.push(n),r.push(J),r.push(p),r.push(n),r.push(i),r.push(J)}j.d.ComputeNormals(p,r,i),j.d._ComputeSides(g,p,r,i,n,L.frontUVs,L.backUVs);const O=new j.d;return O.indices=r,O.eL=p,O.vL=i,O.AL=n,O}function e(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const J=new i.c(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return Q(r).aL(J,r.updatable),J}j.d.CreateTorus=B,i.c.CreateTorus=(L,r,p,J,i,n,j)=>F(L,{diameter:r,thickness:p,tessellation:J,sideOrientation:j,updatable:n},i);j.d.CreateTorusKnot=Q,i.c.CreateTorusKnot=(L,r,p,J,i,n,j,z,G,C)=>e(L,{radius:r,tube:p,radialSegments:J,tubularSegments:i,p:n,q:j,sideOrientation:C,updatable:G},z);var v=p(14037),y=p(12669),A=p(12319);function u(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=r.path,n=r.shape,j=r.scale||1,z=r.rotation||0,G=0===r.cap?0:r.cap||i.c.NO_CAP,C=r.updatable,t=i.c._GetDefaultSideOrientation(r.sideOrientation),E=r.instance||null,x=r.invertUV||!1,w=r.closeShape||!1,g=r.closePath||!1,b=r.capFunction||null;return q(L,n,J,j,z,null,null,g,w,G,!1,p,!!C,t,E,x,r.frontUVs||null,r.backUVs||null,r.firstNormal||null,!!r.adjustFrame,b)}function a(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=r.path,n=r.shape,j=r.scaleFunction||(()=>1),z=r.rotationFunction||(()=>0),G=r.closePath||r.ribbonCloseArray||!1,C=r.closeShape||r.ribbonClosePath||!1,t=0===r.cap?0:r.cap||i.c.NO_CAP,E=r.updatable,x=r.firstNormal||null,w=r.adjustFrame||!1,g=i.c._GetDefaultSideOrientation(r.sideOrientation),b=r.instance,c=r.invertUV||!1,P=r.capFunction||null;return q(L,n,J,null,null,j,z,G,C,t,!0,p,!!E,g,b||null,c,r.frontUVs||null,r.backUVs||null,x,w,P||null)}function q(L,r,p,n,j,z,G,t,E,x,w,g,b,c,P,O,h,U,W,B,F){const Q=(L,r,p,n,j,z,G,C,t,E,x)=>{const w=p.getTangents(),g=p.getNormals(),b=p.getBinormals(),c=p.getDistances();if(x)for(let i=0;i<w.length;i++)if(0==w[i].x&&0==w[i].y&&0==w[i].z&&w[i].G(w[i-1]),0==g[i].x&&0==g[i].y&&0==g[i].z&&g[i].G(g[i-1]),0==b[i].x&&0==b[i].y&&0==b[i].z&&b[i].G(b[i-1]),i>0){let L=w[i-1];J.cr.Dot(L,w[i])<0&&w[i].scaleInPlace(-1),L=g[i-1],J.cr.Dot(L,g[i])<0&&g[i].scaleInPlace(-1),L=b[i-1],J.cr.Dot(L,b[i])<0&&b[i].scaleInPlace(-1)}let P=0;const O=E&&C?C:()=>null!==z?z:0,h=E&&G?G:()=>null!==j?j:1;let U=t===i.c.NO_CAP||t===i.c.CAP_END?0:2;const W=J.TmpVectors.Matrix[0];for(let i=0;i<r.length;i++){const p=[],j=O(i,c[i]),z=h(i,c[i]);J.Matrix.RotationAxisToRef(w[i],P,W);for(let n=0;n<L.length;n++){const j=w[i].scale(L[n].z).add(g[i].scale(L[n].x)).add(b[i].scale(L[n].y)),G=J.cr.Zero();J.cr.TransformCoordinatesToRef(j,W,G),G.scaleInPlace(z).addInPlace(r[i]),p[n]=G}n[U]=p,P+=j,U++}const B=F||(L=>{const r=Array(),p=J.cr.Zero();let i;for(i=0;i<L.length;i++)p.addInPlace(L[i]);for(p.scaleInPlace(1/L.length),i=0;i<L.length;i++)r.push(p);return r});switch(t){case i.c.NO_CAP:break;case i.c.CAP_START:n[0]=B(n[2]),n[1]=n[2];break;case i.c.CAP_END:n[U]=n[U-1],n[U+1]=B(n[U-1]);break;case i.c.CAP_ALL:n[0]=B(n[2]),n[1]=n[2],n[U]=n[U-1],n[U+1]=B(n[U-1])}return n};let e,v;if(P){const L=P._creationDataStorage;return e=W?L.path3D.update(p,W):L.path3D.update(p),v=Q(r,p,L.path3D,L.pathArray,n,j,z,G,L.cap,w,B),P=C("",{pathArray:v,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:P},g||void 0)}e=W?new A.h(p,W):new A.h(p);v=Q(r,p,e,new Array,n,j,z,G,x=x<0||x>3?0:x,w,B);const y=C(L,{pathArray:v,closeArray:t,closePath:E,updatable:b,sideOrientation:c,invertUV:O,frontUVs:h||void 0,backUVs:U||void 0},g);return y._creationDataStorage.pathArray=v,y._creationDataStorage.path3D=e,y._creationDataStorage.cap=x,y}function Z(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=r.arc?r.arc<=0||r.arc>1?1:r.arc:1,j=void 0===r.closed||r.closed,z=r.shape,G=r.radius||1,t=r.tessellation||64,E=r.clip||0,x=r.updatable,w=i.c._GetDefaultSideOrientation(r.sideOrientation),g=r.cap||i.c.NO_CAP,b=2*Math.PI,c=[],P=r.invertUV||!1;let O=0,h=0;const U=b/t*n;let W,B;for(O=0;O<=t-E;O++){for(B=[],g!=i.c.CAP_START&&g!=i.c.CAP_ALL||(B.push(new J.cr(0,z[0].y,0)),B.push(new J.cr(Math.cos(O*U)*z[0].x*G,z[0].y,Math.sin(O*U)*z[0].x*G))),h=0;h<z.length;h++)W=new J.cr(Math.cos(O*U)*z[h].x*G,z[h].y,Math.sin(O*U)*z[h].x*G),B.push(W);g!=i.c.CAP_END&&g!=i.c.CAP_ALL||(B.push(new J.cr(Math.cos(O*U)*z[z.length-1].x*G,z[z.length-1].y,Math.sin(O*U)*z[z.length-1].x*G)),B.push(new J.cr(0,z[z.length-1].y,0))),c.push(B)}return C(L,{pathArray:c,closeArray:j,sideOrientation:w,updatable:x,invertUV:P,frontUVs:r.frontUVs,backUVs:r.backUVs},p)}i.c.ExtrudeShape=function(L,r,p,J,n,j){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,t=arguments.length>9?arguments[9]:void 0;return u(L,{shape:r,path:p,scale:J,rotation:n,cap:0===j?0:j||i.c.NO_CAP,sideOrientation:C,instance:t,updatable:G},z)},i.c.ExtrudeShapeCustom=(L,r,p,J,n,j,z,G,C,t,E,x)=>a(L,{shape:r,path:p,scaleFunction:J,rotationFunction:n,ribbonCloseArray:j,ribbonClosePath:z,cap:0===G?0:G||i.c.NO_CAP,sideOrientation:E,instance:x,updatable:t},C);i.c.CreateLathe=(L,r,p,J,i,n,j)=>Z(L,{shape:r,radius:p,tessellation:J,sideOrientation:j,updatable:n},i);var X=p(13400),D=p(13340);function l(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=r.path;let j=r.instance,z=1;void 0!==r.radius?z=r.radius:j&&(z=j._creationDataStorage.radius);const G=r.tessellation||64,t=r.radiusFunction||null;let E=r.cap||i.c.NO_CAP;const x=r.invertUV||!1,w=r.updatable,g=i.c._GetDefaultSideOrientation(r.sideOrientation);r.arc=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1;const b=(L,r,p,n,j,z,G,C)=>{const t=r.getTangents(),E=r.getNormals(),x=r.getDistances(),w=2*Math.PI/j*C,g=z||(()=>n);let b,c,P,O;const h=J.TmpVectors.Matrix[0];let U=G===i.c.NO_CAP||G===i.c.CAP_END?0:2;for(let i=0;i<L.length;i++){c=g(i,x[i]),b=Array(),P=E[i];for(let r=0;r<j;r++)J.Matrix.RotationAxisToRef(t[i],w*r,h),O=b[r]?b[r]:J.cr.Zero(),J.cr.TransformCoordinatesToRef(P,h,O),O.scaleInPlace(c).addInPlace(L[i]),b[r]=O;p[U]=b,U++}const W=(r,p)=>{const J=Array();for(let i=0;i<r;i++)J.push(L[p]);return J};switch(G){case i.c.NO_CAP:break;case i.c.CAP_START:p[0]=W(j,0),p[1]=p[2].slice(0);break;case i.c.CAP_END:p[U]=p[U-1].slice(0),p[U+1]=W(j,L.length-1);break;case i.c.CAP_ALL:p[0]=W(j,0),p[1]=p[2].slice(0),p[U]=p[U-1].slice(0),p[U+1]=W(j,L.length-1)}return p};let c,P;if(j){const L=j._creationDataStorage,p=r.arc||L.arc;return c=L.path3D.update(n),P=b(n,c,L.pathArray,z,L.tessellation,t,L.cap,p),j=C("",{pathArray:P,instance:j}),L.path3D=c,L.pathArray=P,L.arc=p,L.radius=z,j}c=new A.h(n);E=E<0||E>3?0:E,P=b(n,c,new Array,z,G,t,E,r.arc);const O=C(L,{pathArray:P,closePath:!0,closeArray:!1,updatable:w,sideOrientation:g,invertUV:x,frontUVs:r.frontUVs,backUVs:r.backUVs},p);return O._creationDataStorage.pathArray=P,O._creationDataStorage.path3D=c,O._creationDataStorage.tessellation=G,O._creationDataStorage.cap=E,O._creationDataStorage.arc=r.arc,O._creationDataStorage.radius=z,O}function T(L){const r=[];r[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},r[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},r[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},r[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},r[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},r[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},r[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},r[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},r[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},r[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},r[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},r[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},r[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},r[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},r[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const p=L.type&&(L.type<0||L.type>=r.length)?0:L.type||0,i=L.size,n=L.sizeX||i||1,G=L.sizeY||i||1,C=L.sizeZ||i||1,t=L.custom||r[p],E=t.face.length,w=L.faceUV||new Array(E),g=L.faceColors,b=void 0===L.flat||L.flat,c=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE,P=[],O=[],h=[],U=[],W=[];let B=0,F=0;const Q=[];let e,v,y,A,u,a,q=0,Z=0;if(b)for(Z=0;Z<E;Z++)g&&void 0===g[Z]&&(g[Z]=new x.Fz(1,1,1,1)),w&&void 0===w[Z]&&(w[Z]=new J.Vector4(0,0,1,1));if(b)for(Z=0;Z<E;Z++){const L=t.face[Z].length;for(y=2*Math.PI/L,A=.5*Math.tan(y/2),u=.5,q=0;q<L;q++)P.push(t.vertex[t.face[Z][q]][0]*n,t.vertex[t.face[Z][q]][1]*G,t.vertex[t.face[Z][q]][2]*C),Q.push(B),B++,e=w[Z].x+(w[Z].z-w[Z].x)*(.5+A),v=w[Z].y+(w[Z].w-w[Z].y)*(u-.5),U.push(e,z.d?1-v:v),a=A*Math.cos(y)-u*Math.sin(y),u=A*Math.sin(y)+u*Math.cos(y),A=a,g&&W.push(g[Z].r,g[Z].g,g[Z].b,g[Z].a);for(q=0;q<L-2;q++)O.push(Q[0+F],Q[q+2+F],Q[q+1+F]);F+=L}else{for(q=0;q<t.vertex.length;q++)P.push(t.vertex[q][0]*n,t.vertex[q][1]*G,t.vertex[q][2]*C),U.push(0,z.d?1:0);for(Z=0;Z<E;Z++)for(q=0;q<t.face[Z].length-2;q++)O.push(t.face[Z][0],t.face[Z][q+2],t.face[Z][q+1])}j.d.ComputeNormals(P,O,h),j.d._ComputeSides(c,P,O,h,U,L.frontUVs,L.backUVs);const X=new j.d;return X.eL=P,X.indices=O,X.vL=h,X.AL=U,g&&b&&(X.yL=W),X}function Y(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new i.c(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return T(r).aL(J,r.updatable),J}i.c.CreateTube=(L,r,p,J,i,n,j,z,G,C)=>l(L,{path:r,radius:p,tessellation:J,radiusFunction:i,arc:1,cap:n,updatable:z,sideOrientation:G,instance:C},j);function M(L){const r=L.sideOrientation||j.d.DEFAULTSIDE,p=L.radius||1,i=void 0===L.flat||L.flat,n=0|(L.subdivisions||4),G=L.radiusX||p,C=L.radiusY||p,t=L.radiusZ||p,E=(1+Math.sqrt(5))/2,x=[-1,E,-0,1,E,0,-1,-E,0,1,-E,0,0,-1,-E,0,1,-E,0,-1,E,0,1,E,E,0,1,E,0,-1,-E,0,1,-E,0,-1],w=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],g=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],b=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],c=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],P=[],O=[],h=[],U=[];let W=0;const B=new Array(3),F=new Array(3);let Q;for(Q=0;Q<3;Q++)B[Q]=J.cr.Zero(),F[Q]=J.Vector2.Zero();for(let j=0;j<20;j++){for(Q=0;Q<3;Q++){const L=w[3*j+Q];B[Q].Uz(x[3*g[L]],x[3*g[L]+1],x[3*g[L]+2]),B[Q].normalize(),F[Q].Uz(.134765625*b[2*L]+.05859375+-.0390625*c[j],.2333984375*b[2*L+1]+.025390625+.01953125*c[j])}const L=(L,r,p,j)=>{const E=J.cr.Lerp(B[0],B[2],r/n),x=J.cr.Lerp(B[1],B[2],r/n),w=n===r?B[2]:J.cr.Lerp(E,x,L/(n-r));let g;if(w.normalize(),i){const L=J.cr.Lerp(B[0],B[2],j/n),r=J.cr.Lerp(B[1],B[2],j/n);g=J.cr.Lerp(L,r,p/(n-j))}else g=new J.cr(w.x,w.y,w.z);g.x/=G,g.y/=C,g.z/=t,g.normalize();const b=J.Vector2.Lerp(F[0],F[2],r/n),c=J.Vector2.Lerp(F[1],F[2],r/n),Q=n===r?F[2]:J.Vector2.Lerp(b,c,L/(n-r));O.push(w.x*G,w.y*C,w.z*t),h.push(g.x,g.y,g.z),U.push(Q.x,z.d?1-Q.y:Q.y),P.push(W),W++};for(let r=0;r<n;r++)for(let p=0;p+r<n;p++)L(p,r,p+1/3,r+1/3),L(p+1,r,p+1/3,r+1/3),L(p,r+1,p+1/3,r+1/3),p+r+1<n&&(L(p+1,r,p+2/3,r+2/3),L(p+1,r+1,p+2/3,r+2/3),L(p,r+1,p+2/3,r+2/3))}j.d._ComputeSides(r,O,P,h,U,L.frontUVs,L.backUVs);const e=new j.d;return e.indices=P,e.eL=O,e.vL=h,e.AL=U,e}function f(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new i.c(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),J._originalBuilderSideOrientation=r.sideOrientation;return M(r).aL(J,r.updatable),J}j.d.CreatePolyhedron=T,i.c.CreatePolyhedron=(L,r,p)=>Y(L,r,p);j.d.CreateIcoSphere=M,i.c.CreateIcoSphere=(L,r,p)=>f(L,r,p);var d=p(12154);const s=new J.cr(1,0,0),H=new J.cr(-1,0,0),o=new J.cr(0,1,0),k=new J.cr(0,-1,0),R=new J.cr(0,0,1),I=new J.cr(0,0,-1);class N{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.cr.Zero(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.cr.Up(),p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.Vector2.Zero(),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=L,this.normal=r,this.uv=p,this.vertexIdx=i,this.vertexIdxForBones=n,this.localPositionOverride=j,this.localNormalOverride=z,this.matrixIndicesOverride=G,this.matrixWeightsOverride=C}clone(){var L,r,p,J;return new N(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(L=this.localPositionOverride)||void 0===L?void 0:L.slice(),null===(r=this.localNormalOverride)||void 0===r?void 0:r.slice(),null===(p=this.matrixIndicesOverride)||void 0===p?void 0:p.slice(),null===(J=this.matrixWeightsOverride)||void 0===J?void 0:J.slice())}}function K(L,r,p){var G,C,t,E,x;const w=!!r.skeleton,g=!(null===(G=r.morphTargetManager)||void 0===G||!G.numTargets),b=p.localMode||w,c=r.Oz(),P=w||g?r.lz(!0,!0):r.getVerticesData(n.e.PositionKind),O=w||g?r.getNormalsData(!0,!0):r.getVerticesData(n.e.NormalKind),h=b?w?r.getVerticesData(n.e.PositionKind):P:null,U=b?w?r.getVerticesData(n.e.NormalKind):O:null,W=r.getVerticesData(n.e.UVKind),B=w?r.getVerticesData(n.e.MatricesIndicesKind):null,F=w?r.getVerticesData(n.e.MatricesWeightsKind):null,Q=w?r.getVerticesData(n.e.MatricesIndicesExtraKind):null,e=w?r.getVerticesData(n.e.MatricesWeightsExtraKind):null,v=p.position||J.cr.Zero();let y=p.normal||J.cr.Up();const A=p.size||J.cr.One(),u=p.angle||0;if(!y){const L=new J.cr(0,0,1),p=r.FL().activeCamera,i=J.cr.TransformCoordinates(L,p.getWorldMatrix());y=p.globalPosition.Pr(i)}const a=-Math.atan2(y.z,y.x)-Math.PI/2,q=Math.sqrt(y.x*y.x+y.z*y.z),Z=Math.atan2(y.y,q),X=new j.d;X.indices=[],X.eL=[],X.vL=[],X.AL=[],X.matricesIndices=w?[]:null,X.matricesWeights=w?[]:null,X.matricesIndicesExtra=Q?[]:null,X.matricesWeightsExtra=e?[]:null;let D=0;const l=(L,r)=>{const i=new N;if(!c||!P||!O)return i;const n=c[L];if(i.vertexIdx=3*n,i.vertexIdxForBones=4*n,i.position=new J.cr(P[3*n],P[3*n+1],P[3*n+2]),J.cr.TransformCoordinatesToRef(i.position,r,i.position),i.normal=new J.cr(O[3*n],O[3*n+1],O[3*n+2]),J.cr.TransformNormalToRef(i.normal,r,i.normal),p.captureUVS&&W){const L=W[2*n+1];i.uv=new J.Vector2(W[2*n],z.d?1-L:L)}return i},T=[0,0,0,0],Y=(L,r)=>{if(0===L.length)return L;const p=.5*Math.abs(J.cr.Dot(A,r)),i=(L,r,p,J)=>{for(let i=0;i<J;++i)if(L[p+i]===r)return p+i;return-1},n=(L,n)=>{const j=J.cr.GetClipFactor(L.position,n.position,r,p);let z=T,G=T;if(B&&F){const r=L.matrixIndicesOverride?0:L.vertexIdxForBones,p=L.matrixIndicesOverride??B,J=L.matrixWeightsOverride??F,C=n.matrixIndicesOverride?0:n.vertexIdxForBones,t=n.matrixIndicesOverride??B,E=n.matrixWeightsOverride??F;z=[0,0,0,0],G=[0,0,0,0];let x=0;for(let L=0;L<4;++L)if(J[r+L]>0){const n=i(t,p[r+L],C,4);z[x]=p[r+L],G[x]=(0,d.Lerp)(J[r+L],n>=0?E[n]:0,j),x++}for(let L=0;L<4&&x<4;++L){const J=t[C+L];-1===i(p,J,r,4)&&(z[x]=J,G[x]=(0,d.Lerp)(0,E[C+L],j),x++)}const w=G[0]+G[1]+G[2]+G[3];G[0]/=w,G[1]/=w,G[2]/=w,G[3]/=w}const C=L.localPositionOverride?L.localPositionOverride[0]:(null===h||void 0===h?void 0:h[L.vertexIdx])??0,t=L.localPositionOverride?L.localPositionOverride[1]:(null===h||void 0===h?void 0:h[L.vertexIdx+1])??0,E=L.localPositionOverride?L.localPositionOverride[2]:(null===h||void 0===h?void 0:h[L.vertexIdx+2])??0,x=n.localPositionOverride?n.localPositionOverride[0]:(null===h||void 0===h?void 0:h[n.vertexIdx])??0,w=n.localPositionOverride?n.localPositionOverride[1]:(null===h||void 0===h?void 0:h[n.vertexIdx+1])??0,g=n.localPositionOverride?n.localPositionOverride[2]:(null===h||void 0===h?void 0:h[n.vertexIdx+2])??0,b=L.localNormalOverride?L.localNormalOverride[0]:(null===U||void 0===U?void 0:U[L.vertexIdx])??0,c=L.localNormalOverride?L.localNormalOverride[1]:(null===U||void 0===U?void 0:U[L.vertexIdx+1])??0,P=L.localNormalOverride?L.localNormalOverride[2]:(null===U||void 0===U?void 0:U[L.vertexIdx+2])??0,O=b+((n.localNormalOverride?n.localNormalOverride[0]:(null===U||void 0===U?void 0:U[n.vertexIdx])??0)-b)*j,W=c+((n.localNormalOverride?n.localNormalOverride[1]:(null===U||void 0===U?void 0:U[n.vertexIdx+1])??0)-c)*j,Q=P+((n.localNormalOverride?n.localNormalOverride[2]:(null===U||void 0===U?void 0:U[n.vertexIdx+2])??0)-P)*j,e=Math.sqrt(O*O+W*W+Q*Q);return new N(J.cr.Lerp(L.position,n.position,j),J.cr.Lerp(L.normal,n.normal,j).normalize(),J.Vector2.Lerp(L.uv,n.uv,j),-1,-1,h?[C+(x-C)*j,t+(w-t)*j,E+(g-E)*j]:null,U?[O/e,W/e,Q/e]:null,z,G)};let j=null;L.length>3&&(j=[]);for(let z=0;z<L.length;z+=3){let i=0,G=null,C=null,t=null,E=null;const x=J.cr.Dot(L[z].position,r)-p>0,w=J.cr.Dot(L[z+1].position,r)-p>0,g=J.cr.Dot(L[z+2].position,r)-p>0;switch(i=(x?1:0)+(w?1:0)+(g?1:0),i){case 0:L.length>3?(j.push(L[z]),j.push(L[z+1]),j.push(L[z+2])):j=L;break;case 1:if(j=j??new Array,x&&(G=L[z+1],C=L[z+2],t=n(L[z],G),E=n(L[z],C)),w){G=L[z],C=L[z+2],t=n(L[z+1],G),E=n(L[z+1],C),j.push(t),j.push(C.clone()),j.push(G.clone()),j.push(C.clone()),j.push(t.clone()),j.push(E);break}g&&(G=L[z],C=L[z+1],t=n(L[z+2],G),E=n(L[z+2],C)),G&&C&&t&&E&&(j.push(G.clone()),j.push(C.clone()),j.push(t),j.push(E),j.push(t.clone()),j.push(C.clone()));break;case 2:j=j??new Array,x||(G=L[z].clone(),C=n(G,L[z+1]),t=n(G,L[z+2]),j.push(G),j.push(C),j.push(t)),w||(G=L[z+1].clone(),C=n(G,L[z+2]),t=n(G,L[z]),j.push(G),j.push(C),j.push(t)),g||(G=L[z+2].clone(),C=n(G,L[z]),t=n(G,L[z+1]),j.push(G),j.push(C),j.push(t))}}return j},M=r instanceof i.c?r:null,f=null===M||void 0===M?void 0:M._thinInstanceDataStorage.matrixData,K=(null===M||void 0===M?void 0:M.ez)||1,mL=J.TmpVectors.Matrix[0];mL.G(J.Matrix.IdentityReadOnly);for(let i=0;i<K;++i){if(null!==M&&void 0!==M&&M.hasThinInstances&&f){const L=16*i;mL.setRowFromFloats(0,f[L+0],f[L+1],f[L+2],f[L+3]),mL.setRowFromFloats(1,f[L+4],f[L+5],f[L+6],f[L+7]),mL.setRowFromFloats(2,f[L+8],f[L+9],f[L+10],f[L+11]),mL.setRowFromFloats(3,f[L+12],f[L+13],f[L+14],f[L+15])}const L=J.Matrix.RotationYawPitchRoll(a,Z,u).multiply(J.Matrix.Translation(v.x,v.y,v.z)),n=J.Matrix.Invert(L),j=r.getWorldMatrix(),G=mL.multiply(j).multiply(n),C=new Array(3);for(let r=0;r<c.length;r+=3){let L=C;if(L[0]=l(r,G),L[1]=l(r+1,G),L[2]=l(r+2,G),!(p.cullBackFaces&&-L[0].normal.z<=0&&-L[1].normal.z<=0&&-L[2].normal.z<=0)&&(L=Y(L,s),L&&(L=Y(L,H),L&&(L=Y(L,o),L&&(L=Y(L,k),L&&(L=Y(L,R),L&&(L=Y(L,I),L)))))))for(let r=0;r<L.length;r++){const J=L[r];if(X.indices.push(D),b?(J.localPositionOverride?(X.eL[3*D]=J.localPositionOverride[0],X.eL[3*D+1]=J.localPositionOverride[1],X.eL[3*D+2]=J.localPositionOverride[2]):h&&(X.eL[3*D]=h[J.vertexIdx],X.eL[3*D+1]=h[J.vertexIdx+1],X.eL[3*D+2]=h[J.vertexIdx+2]),J.localNormalOverride?(X.vL[3*D]=J.localNormalOverride[0],X.vL[3*D+1]=J.localNormalOverride[1],X.vL[3*D+2]=J.localNormalOverride[2]):U&&(X.vL[3*D]=U[J.vertexIdx],X.vL[3*D+1]=U[J.vertexIdx+1],X.vL[3*D+2]=U[J.vertexIdx+2])):(J.position.toArray(X.eL,3*D),J.normal.toArray(X.vL,3*D)),X.matricesIndices&&X.matricesWeights&&(J.matrixIndicesOverride?(X.matricesIndices[4*D]=J.matrixIndicesOverride[0],X.matricesIndices[4*D+1]=J.matrixIndicesOverride[1],X.matricesIndices[4*D+2]=J.matrixIndicesOverride[2],X.matricesIndices[4*D+3]=J.matrixIndicesOverride[3]):(B&&(X.matricesIndices[4*D]=B[J.vertexIdxForBones],X.matricesIndices[4*D+1]=B[J.vertexIdxForBones+1],X.matricesIndices[4*D+2]=B[J.vertexIdxForBones+2],X.matricesIndices[4*D+3]=B[J.vertexIdxForBones+3]),Q&&X.matricesIndicesExtra&&(X.matricesIndicesExtra[4*D]=Q[J.vertexIdxForBones],X.matricesIndicesExtra[4*D+1]=Q[J.vertexIdxForBones+1],X.matricesIndicesExtra[4*D+2]=Q[J.vertexIdxForBones+2],X.matricesIndicesExtra[4*D+3]=Q[J.vertexIdxForBones+3])),J.matrixWeightsOverride?(X.matricesWeights[4*D]=J.matrixWeightsOverride[0],X.matricesWeights[4*D+1]=J.matrixWeightsOverride[1],X.matricesWeights[4*D+2]=J.matrixWeightsOverride[2],X.matricesWeights[4*D+3]=J.matrixWeightsOverride[3]):(F&&(X.matricesWeights[4*D]=F[J.vertexIdxForBones],X.matricesWeights[4*D+1]=F[J.vertexIdxForBones+1],X.matricesWeights[4*D+2]=F[J.vertexIdxForBones+2],X.matricesWeights[4*D+3]=F[J.vertexIdxForBones+3]),e&&X.matricesWeightsExtra&&(X.matricesWeightsExtra[4*D]=e[J.vertexIdxForBones],X.matricesWeightsExtra[4*D+1]=e[J.vertexIdxForBones+1],X.matricesWeightsExtra[4*D+2]=e[J.vertexIdxForBones+2],X.matricesWeightsExtra[4*D+3]=e[J.vertexIdxForBones+3]))),p.captureUVS)J.uv.toArray(X.AL,2*D);else{X.AL.push(.5+J.position.x/A.x);const L=.5+J.position.y/A.y;X.AL.push(z.d?1-L:L)}D++}}}0===X.indices.length&&(X.indices=null),0===X.eL.length&&(X.eL=null),0===X.vL.length&&(X.vL=null),0===X.AL.length&&(X.AL=null),0===(null===(C=X.matricesIndices)||void 0===C?void 0:C.length)&&(X.matricesIndices=null),0===(null===(t=X.matricesWeights)||void 0===t?void 0:t.length)&&(X.matricesWeights=null),0===(null===(E=X.matricesIndicesExtra)||void 0===E?void 0:E.length)&&(X.matricesIndicesExtra=null),0===(null===(x=X.matricesWeightsExtra)||void 0===x?void 0:x.length)&&(X.matricesWeightsExtra=null);const V=new i.c(L,r.FL());return X.aL(V),b?(V.skeleton=r.skeleton,V.parent=r):(V.position=v.clone(),V.rotation=new J.cr(Z,a,u)),V.cz(!0),V.refreshBoundingInfo(!0,!0),V}function mL(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const r=0|Math.max(L.subdivisions?L.subdivisions:2,1),p=0|Math.max(L.tessellation?L.tessellation:16,3),i=Math.max(L.height?L.height:1,0),n=Math.max(L.radius?L.radius:.25,0),G=0|Math.max(L.capSubdivisions?L.capSubdivisions:6,1),C=p,t=r,E=Math.max(L.radiusTop?L.radiusTop:n,0),x=Math.max(L.radiusBottom?L.radiusBottom:n,0),w=i-(E+x),g=2*Math.PI,b=Math.max(L.topCapSubdivisions?L.topCapSubdivisions:G,1),c=Math.max(L.bottomCapSubdivisions?L.bottomCapSubdivisions:G,1),P=Math.acos((x-E)/i);let O=[];const h=[],U=[],W=[];let B=0;const F=[],Q=.5*w,e=.5*Math.PI;let v,y;const A=J.cr.Zero(),u=J.cr.Zero(),a=Math.cos(P),q=Math.sin(P),Z=new J.Vector2(E*q,Q+E*a).Pr(new J.Vector2(x*q,x*a-Q)).length(),X=E*P+Z+x*(e-P);let D=0;for(y=0;y<=b;y++){const L=[],r=e-P*(y/b);D+=E*P/b;const p=Math.cos(r),J=Math.sin(r),i=p*E;for(v=0;v<=C;v++){const r=v/C,n=r*g+0,j=Math.sin(n),G=Math.cos(n);u.x=i*j,u.y=Q+J*E,u.z=i*G,h.push(u.x,u.y,u.z),A.set(p*j,J,p*G),U.push(A.x,A.y,A.z),W.push(r,z.d?D/X:1-D/X),L.push(B),B++}F.push(L)}const l=i-E-x+a*E-a*x,T=q*(x-E)/l;for(y=1;y<=t;y++){const L=[];D+=Z/t;const r=q*(y*(x-E)/t+E);for(v=0;v<=C;v++){const p=v/C,J=p*g+0,i=Math.sin(J),n=Math.cos(J);u.x=r*i,u.y=Q+a*E-y*l/t,u.z=r*n,h.push(u.x,u.y,u.z),A.set(i,T,n).normalize(),U.push(A.x,A.y,A.z),W.push(p,z.d?D/X:1-D/X),L.push(B),B++}F.push(L)}for(y=1;y<=c;y++){const L=[],r=e-P-(Math.PI-P)*(y/c);D+=x*P/c;const p=Math.cos(r),J=Math.sin(r),i=p*x;for(v=0;v<=C;v++){const r=v/C,n=r*g+0,j=Math.sin(n),G=Math.cos(n);u.x=i*j,u.y=J*x-Q,u.z=i*G,h.push(u.x,u.y,u.z),A.set(p*j,J,p*G),U.push(A.x,A.y,A.z),W.push(r,z.d?D/X:1-D/X),L.push(B),B++}F.push(L)}for(v=0;v<C;v++)for(y=0;y<b+t+c;y++){const L=F[y][v],r=F[y+1][v],p=F[y+1][v+1],J=F[y][v+1];O.push(L),O.push(r),O.push(J),O.push(r),O.push(p),O.push(J)}if(O=O.reverse(),L.orientation&&!L.orientation.equals(J.cr.Up())){const r=new J.Matrix;L.orientation.clone().scale(.5*Math.PI).cross(J.cr.Up()).toQuaternion().toRotationMatrix(r);const p=J.cr.Zero();for(let L=0;L<h.length;L+=3)p.set(h[L],h[L+1],h[L+2]),J.cr.TransformCoordinatesToRef(p.clone(),r,p),h[L]=p.x,h[L+1]=p.y,h[L+2]=p.z}const Y=new j.d;return Y.eL=h,Y.vL=U,Y.AL=W,Y.indices=O,Y}function V(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:J.cr.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new i.c(L,p);return mL(r).aL(n,r.updatable),n}i.c.CreateDecal=(L,r,p,J,i,n)=>K(L,r,{position:p,normal:J,size:i,angle:n});i.c.CreateCapsule=(L,r,p)=>V(L,r,p),j.d.CreateCapsule=mL;var S=p(11975),LL=p(12140);class rL{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=L,this.y=r,L!==Math.floor(L)&&(L=Math.floor(L),S.d.Warn("x is not an integer, floor(x) used")),r!==Math.floor(r)&&(r=Math.floor(r),S.d.Warn("y is not an integer, floor(y) used"))}clone(){return new rL(this.x,this.y)}rotate60About(L){const r=this.x;return this.x=L.x+L.y-this.y,this.y=r+this.y-L.x,this}rotateNeg60About(L){const r=this.x;return this.x=r+this.y-L.y,this.y=L.x+L.y-r,this}rotate120(L,r){L!==Math.floor(L)&&(L=Math.floor(L),S.d.Warn("m not an integer only floor(m) used")),r!==Math.floor(r)&&(r=Math.floor(r),S.d.Warn("n not an integer only floor(n) used"));const p=this.x;return this.x=L-p-this.y,this.y=r+p,this}rotateNeg120(L,r){L!==Math.floor(L)&&(L=Math.floor(L),S.d.Warn("m is not an integer, floor(m) used")),r!==Math.floor(r)&&(r=Math.floor(r),S.d.Warn("n is not an integer,   floor(n) used"));const p=this.x;return this.x=this.y-r,this.y=L+r-p-this.y,this}toCartesianOrigin(L,r){const p=J.cr.Zero();return p.x=L.x+2*this.x*r+this.y*r,p.y=L.y+Math.sqrt(3)*this.y*r,p}static Zero(){return new rL(0,0)}}class pL{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new JL("icosahedron","Regular",[[0,LL.e,-1],[-LL.e,1,0],[-1,0,-LL.e],[1,0,-LL.e],[LL.e,1,0],[0,LL.e,1],[-1,0,LL.e],[-LL.e,-1,0],[0,-LL.e,-1],[LL.e,-1,0],[1,0,LL.e],[0,-LL.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let L=12;const r={},p=this.m,J=this.n;let i,n,j,z,G,C=p,t=1,E=0;0!==J&&(C=(0,d.HighestCommonFactor)(p,J)),t=p/C,E=J/C;const x=rL.Zero(),w=new rL(p,J),g=new rL(-J,p+J),b=rL.Zero(),c=rL.Zero(),P=rL.Zero();let O,h,U,W,B=[];const F=[],Q=this.vertByDist,e=(p,J,i,n)=>{O=p+"|"+i,h=J+"|"+n,O in r||h in r?O in r&&!(h in r)?r[h]=r[O]:h in r&&!(O in r)&&(r[O]=r[h]):(r[O]=L,r[h]=L,L++),Q[i][0]>2?F[r[O]]=[-Q[i][0],Q[i][1],r[O]]:F[r[O]]=[B[Q[i][0]],Q[i][1],r[O]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let v=0;v<20;v++){if(B=this.IDATA.face[v],j=B[2],z=B[1],G=B[0],U=x.x+"|"+x.y,O=v+"|"+U,O in r||(r[O]=j,F[j]=[B[Q[U][0]],Q[U][1]]),U=w.x+"|"+w.y,O=v+"|"+U,O in r||(r[O]=z,F[z]=[B[Q[U][0]],Q[U][1]]),U=g.x+"|"+g.y,O=v+"|"+U,O in r||(r[O]=G,F[G]=[B[Q[U][0]],Q[U][1]]),i=this.IDATA.edgematch[v][0],n=this.IDATA.edgematch[v][1],"B"===n)for(let L=1;L<C;L++)c.x=p-L*(t+E),c.y=J+L*t,P.x=-L*E,P.y=L*(t+E),U=c.x+"|"+c.y,W=P.x+"|"+P.y,e(v,i,U,W);if("O"===n)for(let L=1;L<C;L++)P.x=-L*E,P.y=L*(t+E),b.x=L*t,b.y=L*E,U=P.x+"|"+P.y,W=b.x+"|"+b.y,e(v,i,U,W);if(i=this.IDATA.edgematch[v][2],n=this.IDATA.edgematch[v][3],n&&"A"===n)for(let L=1;L<C;L++)b.x=L*t,b.y=L*E,c.x=p-(C-L)*(t+E),c.y=J+(C-L)*t,U=b.x+"|"+b.y,W=c.x+"|"+c.y,e(v,i,U,W);for(let p=0;p<this.vertices.length;p++)U=this.vertices[p].x+"|"+this.vertices[p].y,O=v+"|"+U,O in r||(r[O]=L++,Q[U][0]>2?F[r[O]]=[-Q[U][0],Q[U][1],r[O]]:F[r[O]]=[B[Q[U][0]],Q[U][1],r[O]])}this.closestTo=F,this.vecToidx=r}calcCoeffs(){const L=this.m,r=this.n,p=Math.sqrt(3)/3,J=L*L+r*r+L*r;this.coau=(L+r)/J,this.cobu=-r/J,this.coav=-p*(L-r)/J,this.cobv=p*(2*L+r)/J}createInnerFacets(){const L=this.m,r=this.n;for(let p=0;p<r+L+1;p++)for(let L=this.min[p];L<this.max[p]+1;L++)L<this.max[p]&&L<this.max[p+1]+1&&this.innerFacets.push(["|"+L+"|"+p,"|"+L+"|"+(p+1),"|"+(L+1)+"|"+p]),p>0&&L<this.max[p-1]&&L+1<this.max[p]+1&&this.innerFacets.push(["|"+L+"|"+p,"|"+(L+1)+"|"+p,"|"+(L+1)+"|"+(p-1)])}edgeVecsABOB(){const L=this.m,r=this.n,p=new rL(-r,L+r);for(let J=1;J<L+r;J++){const L=new rL(this.min[J],J),r=new rL(this.min[J-1],J-1),i=new rL(this.min[J+1],J+1),n=L.clone(),j=r.clone(),z=i.clone();n.rotate60About(p),j.rotate60About(p),z.rotate60About(p);const G=new rL(this.max[n.y],n.y),C=new rL(this.max[n.y-1],n.y-1),t=new rL(this.max[n.y-1]-1,n.y-1);n.x===G.x&&n.y===G.y||(n.x!==C.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,C,t]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,t,G])):n.y===z.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([L,r,C]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([L,C,i])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([L,r,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([L,C,G])))}}mapABOBtoOBOA(){const L=new rL(0,0);for(let r=0;r<this.isoVecsABOB.length;r++){const p=[];for(let J=0;J<3;J++)L.x=this.isoVecsABOB[r][J].x,L.y=this.isoVecsABOB[r][J].y,0===this.vertexTypes[r][J]&&L.rotateNeg120(this.m,this.n),p.push(L.clone());this.isoVecsOBOA.push(p)}}mapABOBtoBAOA(){const L=new rL(0,0);for(let r=0;r<this.isoVecsABOB.length;r++){const p=[];for(let J=0;J<3;J++)L.x=this.isoVecsABOB[r][J].x,L.y=this.isoVecsABOB[r][J].y,1===this.vertexTypes[r][J]&&L.rotate120(this.m,this.n),p.push(L.clone());this.isoVecsBAOA.push(p)}}MapToFace(L,r){const p=this.IDATA.face[L],i=p[2],n=p[1],j=p[0],z=J.cr.Br(this.IDATA.vertex[i]),G=J.cr.Br(this.IDATA.vertex[n]),C=J.cr.Br(this.IDATA.vertex[j]),t=G.Pr(z),E=C.Pr(z),x=t.scale(this.coau).add(E.scale(this.cobu)),w=t.scale(this.coav).add(E.scale(this.cobv)),g=[];let b,c=J.TmpVectors.cr[0];for(let J=0;J<this.cartesian.length;J++)c=x.scale(this.cartesian[J].x).add(w.scale(this.cartesian[J].y)).add(z),g[J]=[c.x,c.y,c.z],b=L+"|"+this.vertices[J].x+"|"+this.vertices[J].y,r.vertex[this.vecToidx[b]]=[c.x,c.y,c.z]}build(L,r){const p=[],J=rL.Zero(),i=new rL(L,r),n=new rL(-r,L+r);p.push(J,i,n);for(let U=r;U<L+1;U++)for(let r=0;r<L+1-U;r++)p.push(new rL(r,U));if(r>0){const J=(0,d.HighestCommonFactor)(L,r),i=L/J,n=r/J;for(let z=1;z<J;z++)p.push(new rL(z*i,z*n)),p.push(new rL(-z*n,z*(i+n))),p.push(new rL(L-z*(i+n),r+z*i));const j=L/r;for(let z=1;z<r;z++)for(let J=0;J<z*j;J++)p.push(new rL(J,z)),p.push(new rL(J,z).rotate120(L,r)),p.push(new rL(J,z).rotateNeg120(L,r))}p.sort(((L,r)=>L.x-r.x)),p.sort(((L,r)=>L.y-r.y));const j=new Array(L+r+1),z=new Array(L+r+1);for(let U=0;U<j.length;U++)j[U]=1/0,z[U]=-1/0;let G=0,C=0;const t=p.length;for(let U=0;U<t;U++)C=p[U].x,G=p[U].y,j[G]=Math.min(C,j[G]),z[G]=Math.max(C,z[G]);const E=(p,J)=>{const i=p.clone();return"A"===J&&i.rotateNeg120(L,r),"B"===J&&i.rotate120(L,r),i.x<0?i.y:i.x+i.y},x=[],w=[],g=[],b=[],c={},P=[];let O=-1,h=-1;for(let U=0;U<t;U++)x[U]=p[U].toCartesianOrigin(new rL(0,0),.5),w[U]=E(p[U],"O"),g[U]=E(p[U],"A"),b[U]=E(p[U],"B"),w[U]===g[U]&&g[U]===b[U]?(O=3,h=w[U]):w[U]===g[U]?(O=4,h=w[U]):g[U]===b[U]?(O=5,h=g[U]):b[U]===w[U]&&(O=6,h=w[U]),w[U]<g[U]&&w[U]<b[U]&&(O=2,h=w[U]),g[U]<w[U]&&g[U]<b[U]&&(O=1,h=g[U]),b[U]<g[U]&&b[U]<w[U]&&(O=0,h=b[U]),P.push([O,h,p[U].x,p[U].y]);P.sort(((L,r)=>L[2]-r[2])),P.sort(((L,r)=>L[3]-r[3])),P.sort(((L,r)=>L[1]-r[1])),P.sort(((L,r)=>L[0]-r[0]));for(let U=0;U<P.length;U++)c[P[U][2]+"|"+P[U][3]]=[P[U][0],P[U][1],U];return this.m=L,this.n=r,this.vertices=p,this.vertByDist=c,this.cartesian=x,this.min=j,this.max=z,this}}class JL{constructor(L,r,p,J){this.name=L,this.category=r,this.vertex=p,this.face=J}}class iL extends JL{innerToData(L,r){for(let p=0;p<r.innerFacets.length;p++)this.face.push(r.innerFacets[p].map((p=>r.vecToidx[L+p])))}mapABOBtoDATA(L,r){const p=r.IDATA.edgematch[L][0];for(let J=0;J<r.isoVecsABOB.length;J++){const i=[];for(let n=0;n<3;n++)0===r.vertexTypes[J][n]?i.push(L+"|"+r.isoVecsABOB[J][n].x+"|"+r.isoVecsABOB[J][n].y):i.push(p+"|"+r.isoVecsABOB[J][n].x+"|"+r.isoVecsABOB[J][n].y);this.face.push([r.vecToidx[i[0]],r.vecToidx[i[1]],r.vecToidx[i[2]]])}}mapOBOAtoDATA(L,r){const p=r.IDATA.edgematch[L][0];for(let J=0;J<r.isoVecsOBOA.length;J++){const i=[];for(let n=0;n<3;n++)1===r.vertexTypes[J][n]?i.push(L+"|"+r.isoVecsOBOA[J][n].x+"|"+r.isoVecsOBOA[J][n].y):i.push(p+"|"+r.isoVecsOBOA[J][n].x+"|"+r.isoVecsOBOA[J][n].y);this.face.push([r.vecToidx[i[0]],r.vecToidx[i[1]],r.vecToidx[i[2]]])}}mapBAOAtoDATA(L,r){const p=r.IDATA.edgematch[L][2];for(let J=0;J<r.isoVecsBAOA.length;J++){const i=[];for(let n=0;n<3;n++)1===r.vertexTypes[J][n]?i.push(L+"|"+r.isoVecsBAOA[J][n].x+"|"+r.isoVecsBAOA[J][n].y):i.push(p+"|"+r.isoVecsBAOA[J][n].x+"|"+r.isoVecsBAOA[J][n].y);this.face.push([r.vecToidx[i[0]],r.vecToidx[i[1]],r.vecToidx[i[2]]])}}orderData(L){const r=[];for(let n=0;n<13;n++)r[n]=[];const p=L.closestTo;for(let n=0;n<p.length;n++)p[n][0]>-1?p[n][1]>0&&r[p[n][0]].push([n,p[n][1]]):r[12].push([n,p[n][0]]);const J=[];for(let n=0;n<12;n++)J[n]=n;let i=12;for(let n=0;n<12;n++){r[n].sort(((L,r)=>L[1]-r[1]));for(let L=0;L<r[n].length;L++)J[r[n][L][0]]=i++}for(let n=0;n<r[12].length;n++)J[r[12][n][0]]=i++;for(let n=0;n<this.vertex.length;n++)this.vertex[n].push(J[n]);this.vertex.sort(((L,r)=>L[3]-r[3]));for(let n=0;n<this.vertex.length;n++)this.vertex[n].pop();for(let n=0;n<this.face.length;n++)for(let L=0;L<this.face[n].length;L++)this.face[n][L]=J[this.face[n][L]];this.sharedNodes=r[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(L,r){const p=[],J=[];let i=r.pop();J.push(i);let n=this.face[i].indexOf(L);n=(n+2)%3;let j=this.face[i][n];p.push(j);let z=0;for(;r.length>0;)i=r[z],this.face[i].indexOf(j)>-1?(n=(this.face[i].indexOf(j)+1)%3,j=this.face[i][n],p.push(j),J.push(i),r.splice(z,1),z=0):z++;return this.adjacentFaces.push(p),J}toGoldbergPolyhedronData(){const L=new JL("GeoDual","Goldberg",[],[]);L.name="GD dual";const r=this.vertex.length,p=new Array(r);for(let G=0;G<r;G++)p[G]=[];for(let G=0;G<this.face.length;G++)for(let L=0;L<3;L++)p[this.face[G][L]].push(G);let J=0,i=0,n=0,j=[],z=[];this.adjacentFaces=[];for(let G=0;G<p.length;G++){L.face[G]=this.setOrder(G,p[G].concat([]));for(const r of p[G]){J=0,i=0,n=0,j=this.face[r];for(let L=0;L<3;L++)z=this.vertex[j[L]],J+=z[0],i+=z[1],n+=z[2];L.vertex[r]=[J/3,i/3,n/3]}}return L}static BuildGeodesicData(L){const r=new iL("Geodesic-m-n","Geodesic",[[0,LL.e,-1],[-LL.e,1,0],[-1,0,-LL.e],[1,0,-LL.e],[LL.e,1,0],[0,LL.e,1],[-1,0,LL.e],[-LL.e,-1,0],[0,-LL.e,-1],[LL.e,-1,0],[1,0,LL.e],[0,-LL.e,1]],[]);L.setIndices(),L.calcCoeffs(),L.createInnerFacets(),L.edgeVecsABOB(),L.mapABOBtoOBOA(),L.mapABOBtoBAOA();for(let p=0;p<L.IDATA.face.length;p++)L.MapToFace(p,r),r.innerToData(p,L),"B"===L.IDATA.edgematch[p][1]&&r.mapABOBtoDATA(p,L),"O"===L.IDATA.edgematch[p][1]&&r.mapOBOAtoDATA(p,L),"A"===L.IDATA.edgematch[p][3]&&r.mapBAOAtoDATA(p,L);r.orderData(L);return r.vertex=r.vertex.map((function(L){const r=L[0],p=L[1],J=L[2],i=Math.sqrt(r*r+p*p+J*J);return L[0]*=1/i,L[1]*=1/i,L[2]*=1/i,L})),r}}i.c._GoldbergMeshParser=(L,r)=>nL.Parse(L,r);class nL extends i.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(L,r){return void 0===r?(L>this.goldbergData.nbUnsharedFaces-1&&(S.d.Warn("Maximum number of unshared faces used"),L=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+L):(L>11&&(S.d.Warn("Last pole used"),L=11),r>this.goldbergData.nbFacesAtPole-1&&(S.d.Warn("Maximum number of faces at a pole used"),r=this.goldbergData.nbFacesAtPole-1),12+L*this.goldbergData.nbFacesAtPole+r)}_changeGoldbergFaceColors(L){for(let p=0;p<L.length;p++){const r=L[p][0],J=L[p][1],i=L[p][2];for(let L=r;L<J+1;L++)this.goldbergData.faceColors[L]=i}const r=[];for(let p=0;p<12;p++)for(let L=0;L<5;L++)r.push(this.goldbergData.faceColors[p].r,this.goldbergData.faceColors[p].g,this.goldbergData.faceColors[p].b,this.goldbergData.faceColors[p].a);for(let p=12;p<this.goldbergData.faceColors.length;p++)for(let L=0;L<6;L++)r.push(this.goldbergData.faceColors[p].r,this.goldbergData.faceColors[p].g,this.goldbergData.faceColors[p].b,this.goldbergData.faceColors[p].a);return r}setGoldbergFaceColors(L){const r=this._changeGoldbergFaceColors(L);this.DL(n.e.ColorKind,r)}updateGoldbergFaceColors(L){const r=this._changeGoldbergFaceColors(L);this.updateVerticesData(n.e.ColorKind,r)}_changeGoldbergFaceUVs(L){const r=this.getVerticesData(n.e.UVKind);for(let p=0;p<L.length;p++){const J=L[p][0],i=L[p][1],n=L[p][2],j=L[p][3],z=L[p][4],G=[],C=[];let t,E;for(let L=0;L<5;L++)t=n.x+j*Math.cos(z+L*Math.PI/2.5),E=n.y+j*Math.sin(z+L*Math.PI/2.5),t<0&&(t=0),t>1&&(t=1),G.push(t,E);for(let L=0;L<6;L++)t=n.x+j*Math.cos(z+L*Math.PI/3),E=n.y+j*Math.sin(z+L*Math.PI/3),t<0&&(t=0),t>1&&(t=1),C.push(t,E);for(let L=J;L<Math.min(12,i+1);L++)for(let p=0;p<5;p++)r[10*L+2*p]=G[2*p],r[10*L+2*p+1]=G[2*p+1];for(let L=Math.max(12,J);L<i+1;L++)for(let p=0;p<6;p++)r[12*L-24+2*p]=C[2*p],r[12*L-23+2*p]=C[2*p+1]}return r}setGoldbergFaceUVs(L){const r=this._changeGoldbergFaceUVs(L);this.DL(n.e.UVKind,r)}updateGoldbergFaceUVs(L){const r=this._changeGoldbergFaceUVs(L);this.updateVerticesData(n.e.UVKind,r)}placeOnGoldbergFaceAt(L,r,p){const i=J.cr.RotationFromAxis(this.goldbergData.faceXaxis[r],this.goldbergData.faceYaxis[r],this.goldbergData.faceZaxis[r]);L.rotation=i,L.position=this.goldbergData.faceCenters[r].add(this.goldbergData.faceXaxis[r].scale(p.x)).add(this.goldbergData.faceYaxis[r].scale(p.y)).add(this.goldbergData.faceZaxis[r].scale(p.z))}serialize(L){super.serialize(L),L.type="GoldbergMesh";const r={};if(r.adjacentFaces=this.goldbergData.adjacentFaces,r.nbSharedFaces=this.goldbergData.nbSharedFaces,r.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,r.nbFaces=this.goldbergData.nbFaces,r.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){r.faceColors=[];for(const L of this.goldbergData.faceColors)r.faceColors.push(L.mz())}if(this.goldbergData.faceCenters){r.faceCenters=[];for(const L of this.goldbergData.faceCenters)r.faceCenters.push(L.mz())}if(this.goldbergData.faceZaxis){r.faceZaxis=[];for(const L of this.goldbergData.faceZaxis)r.faceZaxis.push(L.mz())}if(this.goldbergData.faceYaxis){r.faceYaxis=[];for(const L of this.goldbergData.faceYaxis)r.faceYaxis.push(L.mz())}if(this.goldbergData.faceXaxis){r.faceXaxis=[];for(const L of this.goldbergData.faceXaxis)r.faceXaxis.push(L.mz())}L.goldbergData=r}static Parse(L,r){const p=L.goldbergData;p.faceColors=p.faceColors.map((L=>x.Fz.Br(L))),p.faceCenters=p.faceCenters.map((L=>J.cr.Br(L))),p.faceZaxis=p.faceZaxis.map((L=>J.cr.Br(L))),p.faceXaxis=p.faceXaxis.map((L=>J.cr.Br(L))),p.faceYaxis=p.faceYaxis.map((L=>J.cr.Br(L)));const i=new nL(L.name,r);return i.goldbergData=p,i}}var jL=p(12662);const zL={CreateBox:E.c,CreateTiledBox:c,CreateSphere:P.d,CreateDisc:t.c,CreateIcoSphere:f,CreateRibbon:C,CreateCylinder:W,CreateTorus:F,CreateTorusKnot:e,CreateLineSystem:v.g,OC:v.j,CreateDashedLines:v.e,ExtrudeShape:u,ExtrudeShapeCustom:a,CreateLathe:Z,CreateTiledPlane:g,WC:X.e,CreateGround:D.g,CreateTiledGround:D.j,CreateGroundFromHeightMap:D.e,CreatePolygon:y.d,ExtrudePolygon:y.g,CreateTube:l,CreatePolyhedron:Y,CreateGeodesic:function(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=r.m||1;J!==Math.floor(J)&&(J=Math.floor(J),S.d.Warn("m not an integer only floor(m) used"));let i=r.n||0;if(i!==Math.floor(i)&&(i=Math.floor(i),S.d.Warn("n not an integer only floor(n) used")),i>J){const L=i;i=J,J=L,S.d.Warn("n > m therefore m and n swapped")}const n=new pL;return n.build(J,i),Y(L,{custom:iL.BuildGeodesicData(n),size:r.size,sizeX:r.sizeX,sizeY:r.sizeY,sizeZ:r.sizeZ,faceUV:r.faceUV,faceColors:r.faceColors,flat:r.flat,updatable:r.updatable,sideOrientation:r.sideOrientation,frontUVs:r.frontUVs,backUVs:r.backUVs},p)},CreateGoldberg:function(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=r.size,G=r.sizeX||n||1,C=r.sizeY||n||1,t=r.sizeZ||n||1;let E=r.m||1;E!==Math.floor(E)&&(E=Math.floor(E),S.d.Warn("m not an integer only floor(m) used"));let w=r.n||0;if(w!==Math.floor(w)&&(w=Math.floor(w),S.d.Warn("n not an integer only floor(n) used")),w>E){const L=w;w=E,E=L,S.d.Warn("n > m therefore m and n swapped")}const g=new pL;g.build(E,w);const b=iL.BuildGeodesicData(g),c=b.toGoldbergPolyhedronData(),P=new nL(L,p);r.sideOrientation=i.c._GetDefaultSideOrientation(r.sideOrientation),P._originalBuilderSideOrientation=r.sideOrientation;(function(L,r){const p=L.size,i=L.sizeX||p||1,n=L.sizeY||p||1,G=L.sizeZ||p||1,C=0===L.sideOrientation?0:L.sideOrientation||j.d.DEFAULTSIDE,t=[],E=[],x=[],w=[];let g=1/0,b=-1/0,c=1/0,P=-1/0;for(let J=0;J<r.vertex.length;J++)g=Math.min(g,r.vertex[J][0]*i),b=Math.max(b,r.vertex[J][0]*i),c=Math.min(c,r.vertex[J][1]*n),P=Math.max(P,r.vertex[J][1]*n);let O=0;for(let j=0;j<r.face.length;j++){const L=r.face[j],p=J.cr.Br(r.vertex[L[0]]),C=J.cr.Br(r.vertex[L[2]]),h=J.cr.Br(r.vertex[L[1]]),U=C.Pr(p),W=h.Pr(p),B=J.cr.Cross(W,U).normalize();for(let J=0;J<L.length;J++){x.push(B.x,B.y,B.z);const p=r.vertex[L[J]];t.push(p[0]*i,p[1]*n,p[2]*G);const j=(p[1]*n-c)/(P-c);w.push((p[0]*i-g)/(b-g),z.d?1-j:j)}for(let r=0;r<L.length-2;r++)E.push(O,O+r+2,O+r+1);O+=L.length}j.d._ComputeSides(C,t,E,x,w);const h=new j.d;return h.eL=t,h.indices=E,h.vL=x,h.AL=w,h})(r,c).aL(P,r.updatable),P.goldbergData.nbSharedFaces=b.sharedNodes,P.goldbergData.nbUnsharedFaces=b.poleNodes,P.goldbergData.adjacentFaces=b.adjacentFaces,P.goldbergData.nbFaces=P.goldbergData.nbSharedFaces+P.goldbergData.nbUnsharedFaces,P.goldbergData.nbFacesAtPole=(P.goldbergData.nbUnsharedFaces-12)/12;for(let i=0;i<b.vertex.length;i++)P.goldbergData.faceCenters.push(J.cr.Br(b.vertex[i])),P.goldbergData.faceCenters[i].x*=G,P.goldbergData.faceCenters[i].y*=C,P.goldbergData.faceCenters[i].z*=t,P.goldbergData.faceColors.push(new x.Fz(1,1,1,1));for(let i=0;i<c.face.length;i++){const L=c.face[i],r=J.cr.Br(c.vertex[L[0]]),p=J.cr.Br(c.vertex[L[2]]),n=J.cr.Br(c.vertex[L[1]]),j=p.Pr(r),z=n.Pr(r),G=J.cr.Cross(z,j).normalize(),C=J.cr.Cross(z,G).normalize();P.goldbergData.faceXaxis.push(z.normalize()),P.goldbergData.faceYaxis.push(G),P.goldbergData.faceZaxis.push(C)}return P},CreateDecal:K,CreateCapsule:V,CreateText:jL.e}},13414:(L,r,p)=>{"use strict";p.d(r,{e:()=>zr});var J=p(12136),i=p(12514);class n extends i.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var j=p(12170),z=(p(12285),p(12087));class G{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(L){this._targetStopDuration!==L&&(this._targetStopDuration=L)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(L){this._noiseTexture!==L&&(this._noiseTexture=L,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(L){this._animationSheetEnabled!==L&&(this._animationSheetEnabled=L)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(L){this._isAnimationSheetEnabled!=L&&(this._isAnimationSheetEnabled=L,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(L){this._useLogarithmicDepth=L&&this.FL().getEngine().getCaps().fragmentDepthSupported}FL(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(L){switch(L){case G.BLENDMODE_MULTIPLYADD:return;case G.BLENDMODE_ADD:L=1;break;case G.BLENDMODE_ONEONE:L=6;break;case G.BLENDMODE_STANDARD:L=2;break;case G.BLENDMODE_MULTIPLY:L=4;break;case G.BLENDMODE_SUBTRACT:L=3}this._engine.setAlphaMode(L)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:J.cr.Zero()}set direction1(L){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=L)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:J.cr.Zero()}set direction2(L){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=L)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:J.cr.Zero()}set minEmitBox(L){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=L)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:J.cr.Zero()}set maxEmitBox(L){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=L)}get billboardMode(){return this._billboardMode}set billboardMode(L){this._billboardMode!==L&&(this._billboardMode=L,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(L){this._isBillboardBased!==L&&(this._isBillboardBased=L,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(L){this._attachImageProcessingConfiguration(L)}_attachImageProcessingConfiguration(L){L!==this._imageProcessingConfiguration&&(!L&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=L)}_reset(){}_removeGradientAndTexture(L,r,p){if(!r)return this;let J=0;for(const i of r){if(i.gradient===L){r.splice(J,1);break}J++}return p&&p.dispose(),this}constructor(L){this.animations=[],this.renderingGroupId=0,this.Jr=J.cr.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new J.cr(10,10,10),this.onAnimationEnd=null,this.blendMode=G.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new J.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.bC=new J.cr(0,0,0),this._useLogarithmicDepth=!1,this.gravity=J.cr.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new j.Fz(1,1,1,1),this.color2=new j.Fz(1,1,1,1),this.colorDead=new j.Fz(0,0,0,1),this.textureMask=new j.Fz(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new n,this.id=L,this.name=L}createPointEmitter(L,r){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new J.cr(0,1,0),arguments.length>2&&void 0!==arguments[2]||new J.cr(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new J.cr(0,1,0),arguments.length>4&&void 0!==arguments[4]||new J.cr(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new J.cr(0,1,0),arguments.length>3&&void 0!==arguments[3]||new J.cr(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(L,r,p,J){throw new Error("Method not implemented.")}}G.BLENDMODE_ONEONE=0,G.BLENDMODE_STANDARD=1,G.BLENDMODE_ADD=2,G.BLENDMODE_MULTIPLY=3,G.BLENDMODE_MULTIPLYADD=4,G.BLENDMODE_SUBTRACT=-1,(0,z.e)("BABYLON.BaseParticleSystem",G);var C=p(12154),t=p(11979);class E{constructor(){this.direction1=new J.cr(0,1,0),this.direction2=new J.cr(0,1,0),this.minEmitBox=new J.cr(-.5,-.5,-.5),this.maxEmitBox=new J.cr(.5,.5,.5)}startDirectionFunction(L,r,p,i){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),j=(0,C.RandomRange)(this.direction1.y,this.direction2.y),z=(0,C.RandomRange)(this.direction1.z,this.direction2.z);if(i)return r.x=n,r.y=j,void(r.z=z);J.cr.TransformNormalFromFloatsToRef(n,j,z,L,r)}startPositionFunction(L,r,p,i){const n=(0,C.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),j=(0,C.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),z=(0,C.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(i)return r.x=n,r.y=j,void(r.z=z);J.cr.TransformCoordinatesFromFloatsToRef(n,j,z,L,r)}clone(){const L=new E;return t.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2),L.setVector3("minEmitBox",this.minEmitBox),L.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3),L.addUniform("minEmitBox",3),L.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.direction1=this.direction1.mz(),L.direction2=this.direction2.mz(),L.minEmitBox=this.minEmitBox.mz(),L.maxEmitBox=this.maxEmitBox.mz(),L}parse(L){J.cr.FromArrayToRef(L.direction1,0,this.direction1),J.cr.FromArrayToRef(L.direction2,0,this.direction2),J.cr.FromArrayToRef(L.minEmitBox,0,this.minEmitBox),J.cr.FromArrayToRef(L.maxEmitBox,0,this.maxEmitBox)}}class x{get radius(){return this._radius}set radius(L){this._radius=L,this._buildHeight()}get angle(){return this._angle}set angle(L){this._angle=L,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=p,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=r,this.radius=L}startDirectionFunction(L,r,p,i){i?J.TmpVectors.cr[0].G(p.Iz).normalize():p.position.subtractToRef(L.getTranslation(),J.TmpVectors.cr[0]).normalize();const n=(0,C.RandomRange)(0,this.directionRandomizer),j=(0,C.RandomRange)(0,this.directionRandomizer),z=(0,C.RandomRange)(0,this.directionRandomizer);r.x=J.TmpVectors.cr[0].x+n,r.y=J.TmpVectors.cr[0].y+j,r.z=J.TmpVectors.cr[0].z+z,r.normalize()}startPositionFunction(L,r,p,i){const n=(0,C.RandomRange)(0,2*Math.PI);let j;this.emitFromSpawnPointOnly?j=1e-4:(j=(0,C.RandomRange)(0,this.heightRange),j=1-j*j);let z=this._radius-(0,C.RandomRange)(0,this._radius*this.radiusRange);z*=j;const G=z*Math.sin(n),t=z*Math.cos(n),E=j*this._height;if(i)return r.x=G,r.y=E,void(r.z=t);J.cr.TransformCoordinatesFromFloatsToRef(G,E,t,L,r)}clone(){const L=new x(this._radius,this._angle,this.directionRandomizer);return t.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat2("radius",this._radius,this.radiusRange),L.setFloat("coneAngle",this._angle),L.setFloat2("height",this._height,this.heightRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",2),L.addUniform("coneAngle",1),L.addUniform("height",2),L.addUniform("directionRandomizer",1)}getEffectDefines(){let L="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(L+="\n#define CONEEMITTERSPAWNPOINT"),L}getClassName(){return"ConeParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this._radius,L.angle=this._angle,L.directionRandomizer=this.directionRandomizer,L.radiusRange=this.radiusRange,L.heightRange=this.heightRange,L.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,L}parse(L){this.radius=L.radius,this.angle=L.angle,this.directionRandomizer=L.directionRandomizer,this.radiusRange=void 0!==L.radiusRange?L.radiusRange:1,this.heightRange=void 0!==L.radiusRange?L.heightRange:1,this.emitFromSpawnPointOnly=void 0!==L.emitFromSpawnPointOnly&&L.emitFromSpawnPointOnly}}class w extends x{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.cr(0,1,0),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.cr(0,1,0);super(L,r),this.direction1=p,this.direction2=i}startDirectionFunction(L,r){const p=(0,C.RandomRange)(this.direction1.x,this.direction2.x),i=(0,C.RandomRange)(this.direction1.y,this.direction2.y),n=(0,C.RandomRange)(this.direction1.z,this.direction2.z);J.cr.TransformNormalFromFloatsToRef(p,i,n,L,r)}clone(){const L=new w(this.radius,this.angle,this.direction1,this.direction2);return t.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.mz(),L.direction2=this.direction2.mz(),L}parse(L){super.parse(L),this.direction1.G(L.direction1),this.direction2.G(L.direction2)}}class g{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=L,this.height=r,this.radiusRange=p,this.directionRandomizer=i,this._tempVector=J.cr.Zero()}startDirectionFunction(L,r,p,i,n){p.position.subtractToRef(L.getTranslation(),this._tempVector),this._tempVector.normalize(),J.cr.TransformNormalToRef(this._tempVector,n,this._tempVector);const j=(0,C.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let z=Math.atan2(this._tempVector.x,this._tempVector.z);z+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=j,this._tempVector.x=Math.sin(z),this._tempVector.z=Math.cos(z),this._tempVector.normalize(),i?r.G(this._tempVector):J.cr.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,L,r)}startPositionFunction(L,r,p,i){const n=(0,C.RandomRange)(-this.height/2,this.height/2),j=(0,C.RandomRange)(0,2*Math.PI),z=(0,C.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),G=Math.sqrt(z)*this.radius,t=G*Math.cos(j),E=G*Math.sin(j);i?r.Uz(t,n,E):J.cr.TransformCoordinatesFromFloatsToRef(t,n,E,L,r)}clone(){const L=new g(this.radius,this.directionRandomizer);return t.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("height",this.height),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("height",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.height=this.height,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.height=L.height,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class b extends g{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.cr(0,1,0),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.cr(0,1,0);super(L,r,p),this.direction1=i,this.direction2=n}startDirectionFunction(L,r,p,i){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),j=(0,C.RandomRange)(this.direction1.y,this.direction2.y),z=(0,C.RandomRange)(this.direction1.z,this.direction2.z);i?r.Uz(n,j,z):J.cr.TransformNormalFromFloatsToRef(n,j,z,L,r)}clone(){const L=new b(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return t.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("height",this.height),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("height",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.mz(),L.direction2=this.direction2.mz(),L}parse(L){super.parse(L),J.cr.FromArrayToRef(L.direction1,0,this.direction1),J.cr.FromArrayToRef(L.direction2,0,this.direction2)}}class c{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=L,this.radiusRange=r,this.directionRandomizer=p}startDirectionFunction(L,r,p,i){const n=p.position.Pr(L.getTranslation()).normalize(),j=(0,C.RandomRange)(0,this.directionRandomizer),z=(0,C.RandomRange)(0,this.directionRandomizer),G=(0,C.RandomRange)(0,this.directionRandomizer);n.x+=j,n.y+=z,n.z+=G,n.normalize(),i?r.G(n):J.cr.TransformNormalFromFloatsToRef(n.x,n.y,n.z,L,r)}startPositionFunction(L,r,p,i){const n=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),j=(0,C.RandomRange)(0,1),z=(0,C.RandomRange)(0,2*Math.PI),G=Math.acos(2*j-1),t=n*Math.cos(z)*Math.sin(G),E=n*Math.cos(G),x=n*Math.sin(z)*Math.sin(G);i?r.Uz(t,Math.abs(E),x):J.cr.TransformCoordinatesFromFloatsToRef(t,Math.abs(E),x,L,r)}clone(){const L=new c(this.radius,this.directionRandomizer);return t.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class P{constructor(){this.direction1=new J.cr(0,1,0),this.direction2=new J.cr(0,1,0)}startDirectionFunction(L,r,p,i){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),j=(0,C.RandomRange)(this.direction1.y,this.direction2.y),z=(0,C.RandomRange)(this.direction1.z,this.direction2.z);i?r.Uz(n,j,z):J.cr.TransformNormalFromFloatsToRef(n,j,z,L,r)}startPositionFunction(L,r,p,i){i?r.Uz(0,0,0):J.cr.TransformCoordinatesFromFloatsToRef(0,0,0,L,r)}clone(){const L=new P;return t.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.direction1=this.direction1.mz(),L.direction2=this.direction2.mz(),L}parse(L){J.cr.FromArrayToRef(L.direction1,0,this.direction1),J.cr.FromArrayToRef(L.direction2,0,this.direction2)}}class O{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=L,this.radiusRange=r,this.directionRandomizer=p}startDirectionFunction(L,r,p,i){const n=p.position.Pr(L.getTranslation()).normalize(),j=(0,C.RandomRange)(0,this.directionRandomizer),z=(0,C.RandomRange)(0,this.directionRandomizer),G=(0,C.RandomRange)(0,this.directionRandomizer);n.x+=j,n.y+=z,n.z+=G,n.normalize(),i?r.G(n):J.cr.TransformNormalFromFloatsToRef(n.x,n.y,n.z,L,r)}startPositionFunction(L,r,p,i){const n=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),j=(0,C.RandomRange)(0,1),z=(0,C.RandomRange)(0,2*Math.PI),G=Math.acos(2*j-1),t=n*Math.cos(z)*Math.sin(G),E=n*Math.cos(G),x=n*Math.sin(z)*Math.sin(G);i?r.Uz(t,E,x):J.cr.TransformCoordinatesFromFloatsToRef(t,E,x,L,r)}clone(){const L=new O(this.radius,this.directionRandomizer);return t.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.radius=this.radius,L.radiusRange=this.radiusRange,L.directionRandomizer=this.directionRandomizer,L}parse(L){this.radius=L.radius,this.radiusRange=L.radiusRange,this.directionRandomizer=L.directionRandomizer}}class h extends O{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.cr(0,1,0),p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.cr(0,1,0);super(L),this.direction1=r,this.direction2=p}startDirectionFunction(L,r){const p=(0,C.RandomRange)(this.direction1.x,this.direction2.x),i=(0,C.RandomRange)(this.direction1.y,this.direction2.y),n=(0,C.RandomRange)(this.direction1.z,this.direction2.z);J.cr.TransformNormalFromFloatsToRef(p,i,n,L,r)}clone(){const L=new h(this.radius,this.direction1,this.direction2);return t.b.DeepCopy(this,L),L}applyToShader(L){L.setFloat("radius",this.radius),L.setFloat("radiusRange",this.radiusRange),L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("radius",1),L.addUniform("radiusRange",1),L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const L=super.serialize();return L.direction1=this.direction1.mz(),L.direction2=this.direction2.mz(),L}parse(L){super.parse(L),this.direction1.G(L.direction1),this.direction2.G(L.direction2)}}class U{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(L,r,p,i){const n=J.TmpVectors.cr[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,p,n);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,p,n);const L=J.TmpVectors.cr[1];n.subtractToRef(p.position,L),L.scaleToRef(1/p.lifeTime,n)}else n.set(0,0,0);i?r.G(n):J.cr.TransformNormalToRef(n,L,r)}startPositionFunction(L,r,p,i){const n=J.TmpVectors.cr[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,p,n):n.set(0,0,0),i?r.G(n):J.cr.TransformCoordinatesToRef(n,L,r)}clone(){const L=new U;return t.b.DeepCopy(this,L),L}applyToShader(L){}buildUniformLayout(L){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const L={};return L.type=this.getClassName(),L.particlePositionGenerator=this.particlePositionGenerator,L.particleDestinationGenerator=this.particleDestinationGenerator,L}parse(L){L.particlePositionGenerator&&(this.particlePositionGenerator=L.particlePositionGenerator),L.particleDestinationGenerator&&(this.particleDestinationGenerator=L.particleDestinationGenerator)}}var W=p(12208);class B{get mesh(){return this._mesh}set mesh(L){this._mesh!==L&&(this._mesh=L,L?(this._indices=L.Oz(),this._positions=L.getVerticesData(W.e.PositionKind),this._normals=L.getVerticesData(W.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=J.cr.Zero(),this._mesh=null,this.direction1=new J.cr(0,1,0),this.direction2=new J.cr(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=L}startDirectionFunction(L,r,p,i){if(this.useMeshNormalsForDirection&&this._normals)return void J.cr.TransformNormalToRef(this._storedNormal,L,r);const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),j=(0,C.RandomRange)(this.direction1.y,this.direction2.y),z=(0,C.RandomRange)(this.direction1.z,this.direction2.z);i?r.Uz(n,j,z):J.cr.TransformNormalFromFloatsToRef(n,j,z,L,r)}startPositionFunction(L,r,p,i){if(!this._indices||!this._positions)return;const n=3*(Math.random()*(this._indices.length/3)|0),j=Math.random(),z=Math.random()*(1-j),G=1-j-z,C=this._indices[n],t=this._indices[n+1],E=this._indices[n+2],x=J.TmpVectors.cr[0],w=J.TmpVectors.cr[1],g=J.TmpVectors.cr[2],b=J.TmpVectors.cr[3];J.cr.FromArrayToRef(this._positions,3*C,x),J.cr.FromArrayToRef(this._positions,3*t,w),J.cr.FromArrayToRef(this._positions,3*E,g),b.x=j*x.x+z*w.x+G*g.x,b.y=j*x.y+z*w.y+G*g.y,b.z=j*x.z+z*w.z+G*g.z,i?r.Uz(b.x,b.y,b.z):J.cr.TransformCoordinatesFromFloatsToRef(b.x,b.y,b.z,L,r),this.useMeshNormalsForDirection&&this._normals&&(J.cr.FromArrayToRef(this._normals,3*C,x),J.cr.FromArrayToRef(this._normals,3*t,w),J.cr.FromArrayToRef(this._normals,3*E,g),this._storedNormal.x=j*x.x+z*w.x+G*g.x,this._storedNormal.y=j*x.y+z*w.y+G*g.y,this._storedNormal.z=j*x.z+z*w.z+G*g.z)}clone(){const L=new B(this.mesh);return t.b.DeepCopy(this,L),L}applyToShader(L){L.setVector3("direction1",this.direction1),L.setVector3("direction2",this.direction2)}buildUniformLayout(L){L.addUniform("direction1",3),L.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var L;const r={};return r.type=this.getClassName(),r.direction1=this.direction1.mz(),r.direction2=this.direction2.mz(),r.meshId=null===(L=this.mesh)||void 0===L?void 0:L.id,r.useMeshNormalsForDirection=this.useMeshNormalsForDirection,r}parse(L,r){J.cr.FromArrayToRef(L.direction1,0,this.direction1),J.cr.FromArrayToRef(L.direction2,0,this.direction2),L.meshId&&r&&(this.mesh=r.getLastMeshById(L.meshId)),this.useMeshNormalsForDirection=L.useMeshNormalsForDirection}}class F{_isUbo(L){return void 0!==L.addUniform}constructor(L){this._isUbo(L)?(this.setMatrix3x3=L.updateMatrix3x3.bind(L),this.setMatrix2x2=L.updateMatrix2x2.bind(L),this.setFloat=L.updateFloat.bind(L),this.setFloat2=L.updateFloat2.bind(L),this.setFloat3=L.updateFloat3.bind(L),this.setFloat4=L.updateFloat4.bind(L),this.setFloatArray=L.updateFloatArray.bind(L),this.setArray=L.updateArray.bind(L),this.setIntArray=L.updateIntArray.bind(L),this.setMatrix=L.tz.bind(L),this.setMatrices=L.updateMatrices.bind(L),this.setVector3=L.updateVector3.bind(L),this.setVector4=L.updateVector4.bind(L),this.setColor3=L.updateColor3.bind(L),this.setColor4=L.updateColor4.bind(L),this.setDirectColor4=L.updateDirectColor4.bind(L),this.setInt=L.updateInt.bind(L),this.setInt2=L.updateInt2.bind(L),this.setInt3=L.updateInt3.bind(L),this.setInt4=L.updateInt4.bind(L)):(this.setMatrix3x3=L.setMatrix3x3.bind(L),this.setMatrix2x2=L.setMatrix2x2.bind(L),this.setFloat=L.setFloat.bind(L),this.setFloat2=L.setFloat2.bind(L),this.setFloat3=L.setFloat3.bind(L),this.setFloat4=L.setFloat4.bind(L),this.setFloatArray=L.setFloatArray.bind(L),this.setArray=L.setArray.bind(L),this.setIntArray=L.setIntArray.bind(L),this.setMatrix=L.setMatrix.bind(L),this.setMatrices=L.setMatrices.bind(L),this.setVector3=L.setVector3.bind(L),this.setVector4=L.setVector4.bind(L),this.setColor3=L.setColor3.bind(L),this.setColor4=L.setColor4.bind(L),this.setDirectColor4=L.setDirectColor4.bind(L),this.setInt=L.setInt.bind(L),this.setInt2=L.setInt2.bind(L),this.setInt3=L.setInt3.bind(L),this.setInt4=L.setInt4.bind(L))}}var Q=p(12045);const e="gpuUpdateParticlesPixelShader",v="#version 300 es\nvoid main() {discard;}\n";Q.d.ShadersStore[e]||(Q.d.ShadersStore[e]=v);const y="gpuUpdateParticlesVertexShader",A="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";Q.d.ShadersStore[y]||(Q.d.ShadersStore[y]=A);(0,z.e)("BABYLON.WebGL2ParticleSystem",class{constructor(L,r){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=L,this._engine=r,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var L;return(null===(L=this._updateEffect)||void 0===L?void 0:L.isReady())??!1}createUpdateBuffer(L){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof U&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=L,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new F(this._updateEffect)}createVertexBuffers(L,r){this._updateVAO.push(this._createUpdateVAO(L)),this._renderVAO.push(this._engine.recordVertexArrayObject(r,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=r}createParticleBuffer(L){return L}bindDrawBuffers(L,r,p){p?this._engine.bindBuffers(this._renderVertexBuffers,p,r):this._engine.bindVertexArrayObject(this._renderVAO[L],null)}preUpdateParticleBuffer(){const L=this._engine;if(this._engine.enableEffect(this._updateEffect),!L.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(L,r,p){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[L],null);const J=this._engine;J.bindTransformFeedbackBuffer(r.getBuffer()),J.setRasterizerState(!1),J.beginTransformFeedback(!0),J.drawArraysType(3,0,p),J.endTransformFeedback(),J.setRasterizerState(!0),J.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let L=0;L<this._updateVAO.length;L++)this._engine.releaseVertexArrayObject(this._updateVAO[L]);this._updateVAO.length=0;for(let L=0;L<this._renderVAO.length;L++)this._engine.releaseVertexArrayObject(this._renderVAO[L]);this._renderVAO.length=0}_createUpdateVAO(L){const r={};r.position=L.createVertexBuffer("position",0,3);let p=3;r.age=L.createVertexBuffer("age",p,1),p+=1,r.size=L.createVertexBuffer("size",p,3),p+=3,r.life=L.createVertexBuffer("life",p,1),p+=1,r.seed=L.createVertexBuffer("seed",p,4),p+=4,r.direction=L.createVertexBuffer("direction",p,3),p+=3,this._parent.particleEmitterType instanceof U&&(r.initialPosition=L.createVertexBuffer("initialPosition",p,3),p+=3),this._parent._colorGradientsTexture||(r.color=L.createVertexBuffer("color",p,4),p+=4),this._parent._isBillboardBased||(r.initialDirection=L.createVertexBuffer("initialDirection",p,3),p+=3),this._parent.noiseTexture&&(r.noiseCoordinates1=L.createVertexBuffer("noiseCoordinates1",p,3),p+=3,r.noiseCoordinates2=L.createVertexBuffer("noiseCoordinates2",p,3),p+=3),this._parent._angularSpeedGradientsTexture?(r.angle=L.createVertexBuffer("angle",p,1),p+=1):(r.angle=L.createVertexBuffer("angle",p,2),p+=2),this._parent._isAnimationSheetEnabled&&(r.cellIndex=L.createVertexBuffer("cellIndex",p,1),p+=1,this._parent.spriteRandomStartCell&&(r.cellStartOffset=L.createVertexBuffer("cellStartOffset",p,1),p+=1));const J=this._engine.recordVertexArrayObject(r,null,this._updateEffect);return this._engine.bindArrayBuffer(null),J}});class u{constructor(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,J=arguments.length>3?arguments[3]:void 0;this._engine=L,this._label=J,this._engine._storageBuffers.push(this),this._create(r,p)}_create(L,r){this._bufferSize=L,this._creationFlags=r,this._buffer=this._engine.createStorageBuffer(L,r,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(L,r,p){this._buffer&&this._engine.updateStorageBuffer(this._buffer,L,r,p)}async read(L,r,p,J){return await this._engine.readFromStorageBuffer(this._buffer,L,r,p,J)}dispose(){const L=this._engine._storageBuffers,r=L.indexOf(this);-1!==r&&(L[r]=L[L.length-1],L.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var a=p(12113),q=p(12122),Z=p(12162),X=p(12111),D=p(12423),l=p(11975),T=p(12068),Y=p(12328);class M{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Y.c}_addDuration(L,r){L<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==L?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(r,!1),this._gpuTimeInFrameId=L):this.counter.addCount(r,!1))}}var f=p(12032);class d{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=L,this._engine=r,this.uniqueId=D.c.UniqueId,r.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new M),this._engine.getCaps().supportComputeShaders?J.bindingsMapping?(this._context=r.createComputeContext(),this._shaderPath=p,this._options={bindingsMapping:{},defines:[],...J}):l.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):l.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(L,r){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const J=this._bindings[L];this._bindings[L]={type:p?0:4,object:r,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!J||J.object!==r||J.type!==this._bindings[L].type)}setStorageTexture(L,r){const p=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!p||p.object!==r),this._bindings[L]={type:1,object:r,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}setExternalTexture(L,r){const p=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!p||p.object!==r),this._bindings[L]={type:6,object:r,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}setVideoTexture(L,r){return!!r.externalTexture&&(this.setExternalTexture(L,r.externalTexture),!0)}setUniformBuffer(L,r){const p=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!p||p.object!==r),this._bindings[L]={type:d._BufferIsDataBuffer(r)?7:2,object:r,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}setStorageBuffer(L,r){const p=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!p||p.object!==r),this._bindings[L]={type:d._BufferIsDataBuffer(r)?7:3,object:r,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}setTextureSampler(L,r){const p=this._bindings[L];this._contextIsDirty||(this._contextIsDirty=!p||!r.compareSampler(p.object)),this._bindings[L]={type:5,object:r,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}isReady(){let L=this._effect;for(const i in this._bindings){const L=this._bindings[i],r=L.type,p=L.object;switch(r){case 0:case 4:case 1:if(!p.isReady())return!1;break;case 6:if(!p.isReady())return!1;break}}const r=[],p=this._shaderPath;if(this._options.defines)for(let i=0;i<this._options.defines.length;i++)r.push(this._options.defines[i]);const J=r.join("\n");return this._cachedDefines!==J&&(this._cachedDefines=J,L=this._engine.createComputeEffect(p,{defines:J,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=L),!!L.isReady()}dispatch(L,r,p){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,L,r,p,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const p=d._BufferIsDataBuffer(L)?L:L.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,p,r,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const r in this._bindings){const p=this._bindings[r];if(!this._options.bindingsMapping[r])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+r+"'");switch(p.type){case 0:{const J=this._samplers[r],i=p.object;var L;if(!J||!i._texture||!J.compareSampler(i._texture))this._samplers[r]=(new T.d).setParameters(i.wrapU,i.wrapV,i.wrapR,i.anisotropicFilteringLevel,i._texture.samplingMode,null===(L=i._texture)||void 0===L?void 0:L._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const L=p.object;L.getBuffer()!==p.buffer&&(p.buffer=L.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((i=>{(0,f.g)((()=>this.dispatch(L,r,p)),i,void 0,J)}))}serialize(){const L=Z.c.Serialize(this);L.options=this._options,L.shaderPath=this._shaderPath,L.Cx={},L.textures={};for(const r in this._bindings){const p=this._bindings[r],J=p.object;switch(p.type){case 0:case 4:case 1:{const i=J.serialize();i&&(L.textures[r]=i,L.Cx[r]={type:p.type});break}}}return L}static Parse(L,r,p){const J=Z.c.Parse((()=>new d(L.name,r.getEngine(),L.shaderPath,L.options)),L,r,p);for(const i in L.textures){const n=L.Cx[i],j=X.c.Parse(L.textures[i],r,p);0===n.type?J.setTexture(i,j):4===n.type?J.setTexture(i,j,!1):J.setStorageTexture(i,j)}return J}static _BufferIsDataBuffer(L){return void 0!==L.underlyingResource}}(0,a.e)([(0,q.E)()],d.prototype,"name",void 0),(0,a.e)([(0,q.E)()],d.prototype,"fastMode",void 0),(0,z.e)("BABYLON.ComputeShader",d);var s=p(12384);const H="gpuUpdateParticlesComputeShader",o="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";Q.d.ShadersStoreWGSL[H]||(Q.d.ShadersStoreWGSL[H]=o);(0,z.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(L,r){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=L,this._engine=r}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var L;return(null===(L=this._updateComputeShader)||void 0===L?void 0:L.isReady())??!1}createUpdateBuffer(L){var r;const p={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(p.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(p.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(p.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(p.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(p.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(p.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(p.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new d("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:p,defines:L.split("\n")}),null===(r=this._simParamsComputeShader)||void 0===r||r.dispose(),this._simParamsComputeShader=new s.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new F(this._simParamsComputeShader)}createVertexBuffers(L,r){this._renderVertexBuffers.push(r)}createParticleBuffer(L){const r=new u(this._engine,4*L.length,11,"ComputeShaderParticleSystemBuffer");return r.update(L),this._bufferComputeShader.push(r),r.getBuffer()}bindDrawBuffers(L,r,p){this._engine.bindBuffers(this._renderVertexBuffers[L],p,r)}preUpdateParticleBuffer(){}updateParticleBuffer(L,r,p){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[L]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^L]),this._updateComputeShader.dispatch(Math.ceil(p/64))}releaseBuffers(){var L;for(let r=0;r<this._bufferComputeShader.length;++r)this._bufferComputeShader[r].dispose();this._bufferComputeShader.length=0,null===(L=this._simParamsComputeShader)||void 0===L||L.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class k{constructor(L,r,p){this.gradient=L,this.color1=r,this.color2=p}getColorToRef(L){this.color2?j.Fz.LerpToRef(this.color1,this.color2,Math.random(),L):L.G(this.color1)}}class R{constructor(L,r){this.gradient=L,this.color=r}}class I{constructor(L,r,p){this.gradient=L,this.factor1=r,this.factor2=p}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class N{static GetCurrentGradient(L,r,p){if(r[0].gradient>L)return void p(r[0],r[0],1);for(let i=0;i<r.length-1;i++){const J=r[i],n=r[i+1];if(L>=J.gradient&&L<=n.gradient){return void p(J,n,(L-J.gradient)/(n.gradient-J.gradient))}}const J=r.length-1;p(r[J],r[J],1)}}var K=p(11964),mL=p(12600),V=p(12009);class S{constructor(L){this.particleSystem=L,this.position=J.cr.Zero(),this.direction=J.cr.Zero(),this.color=new j.Fz(0,0,0,0),this.colorStep=new j.Fz(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new J.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new j.Fz(0,0,0,0),this._currentColor2=new j.Fz(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=S._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let L=this.age,r=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===r?(r=1,L=this._randomCellOffset):L+=this._randomCellOffset);const p=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let J;J=this._initialSpriteCellLoop?(0,C.Clamp)(L*r%this.lifeTime/this.lifeTime):(0,C.Clamp)(L*r/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+J*p|0}_inheritParticleInfoToSubEmitter(L){if(L.particleSystem.Jr.position){const r=L.particleSystem.Jr;if(r.position.G(this.position),L.inheritDirection){const L=J.TmpVectors.cr[0];this.direction.normalizeToRef(L),r.setDirection(L,0,Math.PI/2)}}else{L.particleSystem.Jr.G(this.position)}this.direction.scaleToRef(L.inheritedVelocityAmount/2,J.TmpVectors.cr[0]),L.particleSystem._inheritedVelocityOffset.G(J.TmpVectors.cr[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const L of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(L)}_reset(){this.age=0,this.id=S._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(L){L.position.G(this.position),this._initialDirection?L._initialDirection?L._initialDirection.G(this._initialDirection):L._initialDirection=this._initialDirection.clone():L._initialDirection=null,L.direction.G(this.direction),this.Iz&&(L.Iz?L.Iz.G(this.Iz):L.Iz=this.Iz.clone()),L.color.G(this.color),L.colorStep.G(this.colorStep),L.lifeTime=this.lifeTime,L.age=this.age,L._randomCellOffset=this._randomCellOffset,L.size=this.size,L.scale.G(this.scale),L.angle=this.angle,L.angularSpeed=this.angularSpeed,L.particleSystem=this.particleSystem,L.cellIndex=this.cellIndex,L.id=this.id,L._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(L._currentColorGradient=this._currentColorGradient,L._currentColor1.G(this._currentColor1),L._currentColor2.G(this._currentColor2)),this._currentSizeGradient&&(L._currentSizeGradient=this._currentSizeGradient,L._currentSize1=this._currentSize1,L._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(L._currentAngularSpeedGradient=this._currentAngularSpeedGradient,L._currentAngularSpeed1=this._currentAngularSpeed1,L._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(L._currentVelocityGradient=this._currentVelocityGradient,L._currentVelocity1=this._currentVelocity1,L._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(L._currentLimitVelocityGradient=this._currentLimitVelocityGradient,L._currentLimitVelocity1=this._currentLimitVelocity1,L._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(L._currentDragGradient=this._currentDragGradient,L._currentDrag1=this._currentDrag1,L._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(L._initialStartSpriteCellId=this._initialStartSpriteCellId,L._initialEndSpriteCellId=this._initialEndSpriteCellId,L._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(L.remapData&&this.remapData?L.remapData.G(this.remapData):L.remapData=new J.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(L._randomNoiseCoordinates1?(L._randomNoiseCoordinates1.G(this._randomNoiseCoordinates1),L._randomNoiseCoordinates2.G(this._randomNoiseCoordinates2)):(L._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),L._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}S._Count=0;var LL=p(12247),rL=(p(12278),p(12500)),pL=p(12493),JL=p(12376);function iL(L,r){const p=(0,C.RandomRange)(0,1);j.Fz.LerpToRef(r.color1,r.color2,p,L.color),r.colorDead.subtractToRef(L.color,r._colorDiff),r._colorDiff.scaleToRef(1/L.lifeTime,L.colorStep)}function nL(L,r){L._currentColorGradient=r._colorGradients[0],L._currentColorGradient.getColorToRef(L.color),L._currentColor1.G(L.color),r._colorGradients.length>1?r._colorGradients[1].getColorToRef(L._currentColor2):L._currentColor2.G(L.color)}function jL(L,r){const p=r._colorGradients;N.GetCurrentGradient(r._ratio,p,((r,p,J)=>{r!==L._currentColorGradient&&(L._currentColor1.G(L._currentColor2),p.getColorToRef(L._currentColor2),L._currentColorGradient=r),j.Fz.LerpToRef(L._currentColor1,L._currentColor2,J,L.color)}))}function zL(L,r){L.colorStep.scaleToRef(r._scaledUpdateSpeed,r._scaledColorStep),L.color.addInPlace(r._scaledColorStep),L.color.a<0&&(L.color.a=0)}function GL(L,r){N.GetCurrentGradient(r._ratio,r._angularSpeedGradients,((r,p,J)=>{r!==L._currentAngularSpeedGradient&&(L._currentAngularSpeed1=L._currentAngularSpeed2,L._currentAngularSpeed2=p.getFactor(),L._currentAngularSpeedGradient=r),L.angularSpeed=(0,C.Lerp)(L._currentAngularSpeed1,L._currentAngularSpeed2,J)}))}function CL(L,r){L.angle+=L.angularSpeed*r._scaledUpdateSpeed}function tL(L,r){r.particleEmitterType.startDirectionFunction(r._emitterWorldMatrix,L.direction,L,r.isLocal,r._emitterInverseWorldMatrix)}function EL(L,r){r.startDirectionFunction(r._emitterWorldMatrix,L.direction,L,r.isLocal)}function xL(L,r){L._currentVelocityGradient=r._velocityGradients[0],L._currentVelocity1=L._currentVelocityGradient.getFactor(),r._velocityGradients.length>1?L._currentVelocity2=r._velocityGradients[1].getFactor():L._currentVelocity2=L._currentVelocity1}function wL(L,r){L._currentLimitVelocityGradient=r._limitVelocityGradients[0],L._currentLimitVelocity1=L._currentLimitVelocityGradient.getFactor(),r._limitVelocityGradients.length>1?L._currentLimitVelocity2=r._limitVelocityGradients[1].getFactor():L._currentLimitVelocity2=L._currentLimitVelocity1}function gL(L,r){N.GetCurrentGradient(r._ratio,r._velocityGradients,((p,J,i)=>{p!==L._currentVelocityGradient&&(L._currentVelocity1=L._currentVelocity2,L._currentVelocity2=J.getFactor(),L._currentVelocityGradient=p),r._directionScale*=(0,C.Lerp)(L._currentVelocity1,L._currentVelocity2,i)}))}function bL(L,r){N.GetCurrentGradient(r._ratio,r._limitVelocityGradients,((p,J,i)=>{p!==L._currentLimitVelocityGradient&&(L._currentLimitVelocity1=L._currentLimitVelocity2,L._currentLimitVelocity2=J.getFactor(),L._currentLimitVelocityGradient=p);const n=(0,C.Lerp)(L._currentLimitVelocity1,L._currentLimitVelocity2,i);L.direction.length()>n&&L.direction.scaleInPlace(r.limitVelocityDamping)}))}function cL(L,r){L.direction.scaleToRef(r._directionScale,r._scaledDirection)}function PL(L,r){r.particleEmitterType.startPositionFunction(r._emitterWorldMatrix,L.position,L,r.isLocal)}function OL(L,r){r.startPositionFunction(r._emitterWorldMatrix,L.position,L,r.isLocal)}function hL(L,r){L.Iz?L.Iz.G(L.position):L.Iz=L.position.clone(),J.cr.TransformCoordinatesToRef(L.Iz,r._emitterWorldMatrix,L.position)}function UL(L,r){r.isLocal&&L.Iz?(L.Iz.addInPlace(r._scaledDirection),J.cr.TransformCoordinatesToRef(L.Iz,r._emitterWorldMatrix,L.position)):L.position.addInPlace(r._scaledDirection)}function WL(L,r){L._currentDragGradient=r._dragGradients[0],L._currentDrag1=L._currentDragGradient.getFactor(),r._dragGradients.length>1?L._currentDrag2=r._dragGradients[1].getFactor():L._currentDrag2=L._currentDrag1}function BL(L,r){N.GetCurrentGradient(r._ratio,r._dragGradients,((p,J,i)=>{p!==L._currentDragGradient&&(L._currentDrag1=L._currentDrag2,L._currentDrag2=J.getFactor(),L._currentDragGradient=p);const n=(0,C.Lerp)(L._currentDrag1,L._currentDrag2,i);r._scaledDirection.scaleInPlace(1-n)}))}function FL(L,r){L._randomNoiseCoordinates1?(L._randomNoiseCoordinates1.Uz(Math.random(),Math.random(),Math.random()),L._randomNoiseCoordinates2.Uz(Math.random(),Math.random(),Math.random())):(L._randomNoiseCoordinates1=new J.cr(Math.random(),Math.random(),Math.random()),L._randomNoiseCoordinates2=new J.cr(Math.random(),Math.random(),Math.random()))}function QL(L,r){const p=r._noiseTextureData,i=r._noiseTextureSize;if(p&&i&&L._randomNoiseCoordinates1){const n=r._fetchR(L._randomNoiseCoordinates1.x,L._randomNoiseCoordinates1.y,i.width,i.height,p),j=r._fetchR(L._randomNoiseCoordinates1.z,L._randomNoiseCoordinates2.x,i.width,i.height,p),z=r._fetchR(L._randomNoiseCoordinates2.y,L._randomNoiseCoordinates2.z,i.width,i.height,p),G=J.TmpVectors.cr[0],C=J.TmpVectors.cr[1];G.Uz((2*n-1)*r.noiseStrength.x,(2*j-1)*r.noiseStrength.y,(2*z-1)*r.noiseStrength.z),G.scaleToRef(r._tempScaledUpdateSpeed,C),L.direction.addInPlace(C)}}function eL(L,r){r.gravity.scaleToRef(r._tempScaledUpdateSpeed,r._scaledGravity),L.direction.addInPlace(r._scaledGravity)}function vL(L,r){L.size=(0,C.RandomRange)(r.minSize,r.maxSize),L.scale.Uz((0,C.RandomRange)(r.minScaleX,r.maxScaleX),(0,C.RandomRange)(r.minScaleY,r.maxScaleY))}function yL(L,r){L._currentSizeGradient=r._sizeGradients[0],L._currentSize1=L._currentSizeGradient.getFactor(),L.size=L._currentSize1,r._sizeGradients.length>1?L._currentSize2=r._sizeGradients[1].getFactor():L._currentSize2=L._currentSize1,L.scale.Uz((0,C.RandomRange)(r.minScaleX,r.maxScaleX),(0,C.RandomRange)(r.minScaleY,r.maxScaleY))}function AL(L,r){const p=r._actualFrame/r.targetStopDuration;N.GetCurrentGradient(p,r._startSizeGradients,((p,J,i)=>{p!==r._currentStartSizeGradient&&(r._currentStartSize1=r._currentStartSize2,r._currentStartSize2=J.getFactor(),r._currentStartSizeGradient=p);const n=(0,C.Lerp)(r._currentStartSize1,r._currentStartSize2,i);L.scale.scaleInPlace(n)}))}function uL(L,r){N.GetCurrentGradient(r._ratio,r._sizeGradients,((r,p,J)=>{r!==L._currentSizeGradient&&(L._currentSize1=L._currentSize2,L._currentSize2=p.getFactor(),L._currentSizeGradient=r),L.size=(0,C.Lerp)(L._currentSize1,L._currentSize2,J)}))}function aL(L,r){L.remapData=new J.Vector4(0,1,0,1)}function qL(L,r){r._colorRemapGradients&&r._colorRemapGradients.length>0&&N.GetCurrentGradient(r._ratio,r._colorRemapGradients,((r,p,J)=>{const i=(0,C.Lerp)(r.factor1,p.factor1,J),n=(0,C.Lerp)(r.factor2,p.factor2,J);L.remapData.x=i,L.remapData.y=n-i})),r._alphaRemapGradients&&r._alphaRemapGradients.length>0&&N.GetCurrentGradient(r._ratio,r._alphaRemapGradients,((r,p,J)=>{const i=(0,C.Lerp)(r.factor1,p.factor1,J),n=(0,C.Lerp)(r.factor2,p.factor2,J);L.remapData.z=i,L.remapData.w=n-i}))}function ZL(L,r){const p=(0,C.Clamp)(r._actualFrame/r.targetStopDuration);N.GetCurrentGradient(p,r._lifeTimeGradients,((r,J)=>{const i=r,n=J,j=i.getFactor(),z=n.getFactor(),G=(p-i.gradient)/(n.gradient-i.gradient);L.lifeTime=(0,C.Lerp)(j,z,G)})),r._emitPower=(0,C.RandomRange)(r.minEmitPower,r.maxEmitPower)}function XL(L,r){L.lifeTime=(0,C.RandomRange)(r.minLifeTime,r.maxLifeTime),r._emitPower=(0,C.RandomRange)(r.minEmitPower,r.maxEmitPower)}function DL(L,r){0===r._emitPower?(L._initialDirection?L._initialDirection.G(L.direction):L._initialDirection=L.direction.clone(),L.direction.set(0,0,0)):(L._initialDirection=null,L.direction.scaleInPlace(r._emitPower)),L.direction.addInPlace(r._inheritedVelocityOffset)}function lL(L,r){L.angularSpeed=(0,C.RandomRange)(r.minAngularSpeed,r.maxAngularSpeed),L.angle=(0,C.RandomRange)(r.minInitialRotation,r.maxInitialRotation)}function TL(L,r){L._currentAngularSpeedGradient=r._angularSpeedGradients[0],L.angularSpeed=L._currentAngularSpeedGradient.getFactor(),L._currentAngularSpeed1=L.angularSpeed,r._angularSpeedGradients.length>1?L._currentAngularSpeed2=r._angularSpeedGradients[1].getFactor():L._currentAngularSpeed2=L._currentAngularSpeed1,L.angle=(0,C.RandomRange)(r.minInitialRotation,r.maxInitialRotation)}function YL(L,r){L._initialStartSpriteCellId=r.startSpriteCellID,L._initialEndSpriteCellId=r.endSpriteCellID,L._initialSpriteCellLoop=r.spriteCellLoop}function ML(L,r){L.previousItem=r.previousItem,L.nextItem=r,r.previousItem&&(r.previousItem.nextItem=L),r.previousItem=L}function fL(L,r){L.previousItem=r,L.nextItem=r.nextItem,r.nextItem&&(r.nextItem.previousItem=L),r.nextItem=L}function dL(L,r){let p=r;for(;p.nextItem;)p=p.nextItem;L.previousItem=p,L.nextItem=p.nextItem,p.nextItem=L}function sL(L){L.previousItem&&(L.previousItem.nextItem=L.nextItem),L.nextItem&&(L.nextItem.previousItem=L.previousItem)}class HL extends G{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(L){this._startDirectionFunction!==L&&(this._startDirectionFunction=L,this._directionProcessing.process=L?EL:tL)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(L){this._startPositionFunction!==L&&(this._startPositionFunction=L,this._positionCreation.process=L?OL:PL)}set onDispose(L){this._onDisposeObserver&&this.ji.remove(this._onDisposeObserver),this._onDisposeObserver=this.ji.add(L)}get P(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(L){this._useRampGradients!==L&&(this._useRampGradients=L,this._resetEffect(),L?(this._rampCreation={process:aL,previousItem:null,nextItem:null},fL(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:qL,previousItem:null,nextItem:null},fL(this._remapGradientProcessing,this._gravityProcessing)):(sL(this._rampCreation),sL(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(L){this._isLocal!==L&&(this._isLocal=L,L?(this._isLocalCreation={process:hL,previousItem:null,nextItem:null},fL(this._isLocalCreation,this._positionCreation)):sL(this._isLocalCreation))}get particles(){return this.Jx}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(L){this._animationSheetEnabled!==L&&(this._animationSheetEnabled=L,L?(this._sheetCreation={process:YL,previousItem:null,nextItem:null},fL(this._sheetCreation,this._colorCreation)):sL(this._sheetCreation),this._reset())}getActiveCount(){return this.Jx.length}getClassName(){return"nx"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var L;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(L=this._customWrappers[r])||void 0===L?void 0:L.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[L]??this._customWrappers[0]}setCustomEffect(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[r]=new LL.d(this._engine),this._customWrappers[r].effect=L,this._customWrappers[r].drawContext&&(this._customWrappers[r].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new K.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(L){if(this.noiseTexture!==L){if(this._noiseTexture=L,!L)return sL(this._noiseCreation),void sL(this._noiseProcessing);this._noiseCreation={process:FL,previousItem:null,nextItem:null},fL(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:QL,previousItem:null,nextItem:null},fL(this._noiseProcessing,this._positionProcessing)}}constructor(L,r,p){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(L),this._emitterInverseWorldMatrix=J.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new J.cr,this.ji=new K.c,this.onStoppedObservable=new K.c,this.onStartedObservable=new K.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.Jx=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new j.Fz(0,0,0,0),this._colorDiff=new j.Fz(0,0,0,0),this._scaledDirection=J.cr.Zero(),this._scaledGravity=J.cr.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=L=>{},this.recycleParticle=L=>{const r=this.Jx.pop();r!==L&&r.copyTo(L),this._stockParticles.push(r)},this._createParticle=()=>{let L;return 0!==this._stockParticles.length?(L=this._stockParticles.pop(),L._reset()):L=new S(this),this._prepareParticle(L),L},this.paused=!1,this._shadersLoaded=!1,this._capacity=r,this._epsilon=z,p&&"Scene"!==p.getClassName()?(this._engine=p,this.defaultProjectionMatrix=J.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=p||V.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SE.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:XL,previousItem:null,nextItem:null},this._positionCreation={process:PL,previousItem:null,nextItem:null},fL(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:tL,previousItem:null,nextItem:null},fL(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:DL,previousItem:null,nextItem:null},fL(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:vL,previousItem:null,nextItem:null},fL(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:lL,previousItem:null,nextItem:null},fL(this._angleCreation,this._sizeCreation),this._colorCreation={process:iL,previousItem:null,nextItem:null},fL(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,G||(this._colorProcessing={process:zL,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:CL,previousItem:null,nextItem:null},fL(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:cL,previousItem:null,nextItem:null},fL(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:UL,previousItem:null,nextItem:null},fL(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:eL,previousItem:null,nextItem:null},fL(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=n,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new LL.d(this._engine)},this._customWrappers[0].effect=i,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new E,this.updateFunction=L=>{var r;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(r=this.noiseTexture.getContent())||void 0===r||r.then((L=>{this._noiseTextureData=L})));const p=L===this.Jx;for(let J=0;J<L.length;J++){const r=L[J];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const i=r.age;if(r.age+=this._tempScaledUpdateSpeed,r.age>r.lifeTime){const L=r.age-i,p=r.lifeTime-i;this._tempScaledUpdateSpeed=p*this._tempScaledUpdateSpeed/L,r.age=r.lifeTime}this._ratio=r.age/r.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let n=this._updateQueueStart;for(;n;)n.process(r,this),n=n.nextItem;if(this._isAnimationSheetEnabled&&!G&&r.updateCellIndex(),r._inheritParticleInfoToSubEmitters(),r.age>=r.lifeTime){if(this._emitFromParticle(r),r._attachedSubEmitters){for(const L of r._attachedSubEmitters)L.particleSystem.disposeOnStop=!0,L.particleSystem.stop();r._attachedSubEmitters=null}this.recycleParticle(r),p&&J--}else;}}}serialize(L){throw new Error("Method not implemented.")}clone(L,r){throw new Error("Method not implemented.")}_addFactorGradient(L,r,p,J){const i=new I(r,p,J);L.push(i),L.sort(((L,r)=>L.gradient<r.gradient?-1:L.gradient>r.gradient?1:0))}_removeFactorGradient(L,r){if(!L)return;let p=0;for(const J of L){if(J.gradient===r){L.splice(p,1);break}p++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=ZL:this._lifeTimeCreation.process=XL}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:AL,previousItem:null,nextItem:null},fL(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(sL(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(L){this.targetStopDuration!==L&&(this._targetStopDuration=L,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(L,r,p){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,L,r,p),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(L){return this._removeFactorGradient(this._lifeTimeGradients,L),this._syncLifeTimeCreation(),this}addSizeGradient(L,r,p){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=yL,this._sizeGradientProcessing={process:uL,previousItem:null,nextItem:null},ML(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,L,r,p),this}removeSizeGradient(L){var r;return this._removeFactorGradient(this._sizeGradients,L),0===(null===(r=this._sizeGradients)||void 0===r?void 0:r.length)&&(sL(this._sizeGradientProcessing),this._sizeCreation.process=vL),this}addColorRemapGradient(L,r,p){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,L,r,p),this}removeColorRemapGradient(L){return this._removeFactorGradient(this._colorRemapGradients,L),this}addAlphaRemapGradient(L,r,p){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,L,r,p),this}removeAlphaRemapGradient(L){return this._removeFactorGradient(this._alphaRemapGradients,L),this}addAngularSpeedGradient(L,r,p){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=TL,this._angularSpeedGradientProcessing={process:GL,previousItem:null,nextItem:null},ML(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,L,r,p),this}removeAngularSpeedGradient(L){var r;return this._removeFactorGradient(this._angularSpeedGradients,L),0===(null===(r=this._angularSpeedGradients)||void 0===r?void 0:r.length)&&(this._angleCreation.process=lL,sL(this._angularSpeedGradientProcessing)),this}addVelocityGradient(L,r,p){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:xL,previousItem:null,nextItem:null},fL(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:gL,previousItem:null,nextItem:null},ML(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,L,r,p),this}removeVelocityGradient(L){var r;return this._removeFactorGradient(this._velocityGradients,L),0===(null===(r=this._velocityGradients)||void 0===r?void 0:r.length)&&(sL(this._velocityCreation),sL(this._velocityGradientProcessing)),this}addLimitVelocityGradient(L,r,p){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:wL,previousItem:null,nextItem:null},fL(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:bL,previousItem:null,nextItem:null},fL(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,L,r,p),this}removeLimitVelocityGradient(L){var r;return this._removeFactorGradient(this._limitVelocityGradients,L),0===(null===(r=this._limitVelocityGradients)||void 0===r?void 0:r.length)&&(sL(this._limitVelocityCreation),sL(this._limitVelocityGradientProcessing)),this}addDragGradient(L,r,p){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:WL,previousItem:null,nextItem:null},ML(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:BL,previousItem:null,nextItem:null},ML(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,L,r,p),this}removeDragGradient(L){var r;return this._removeFactorGradient(this._dragGradients,L),0===(null===(r=this._dragGradients)||void 0===r?void 0:r.length)&&(sL(this._dragCreation),sL(this._dragGradientProcessing)),this}addEmitRateGradient(L,r,p){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,L,r,p),this}removeEmitRateGradient(L){return this._removeFactorGradient(this._emitRateGradients,L),this}addStartSizeGradient(L,r,p){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,L,r,p),this._syncStartSizeCreation(),this}removeStartSizeGradient(L){return this._removeFactorGradient(this._startSizeGradients,L),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const L=new Uint8Array(4*this._rawTextureWidth),r=j.TmpColors.Wr[0];for(let p=0;p<this._rawTextureWidth;p++){const J=p/this._rawTextureWidth;N.GetCurrentGradient(J,this._rampGradients,((J,i,n)=>{j.Wr.LerpToRef(J.color,i.color,n,r),L[4*p]=255*r.r,L[4*p+1]=255*r.g,L[4*p+2]=255*r.b,L[4*p+3]=255}))}this._rampGradientsTexture=mL.e.CreateRGBATexture(L,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((L,r)=>L.gradient<r.gradient?-1:L.gradient>r.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(L,r){this._rampGradients||(this._rampGradients=[]);const p=new R(L,r);return this._rampGradients.push(p),this._syncRampGradientTexture(),this}removeRampGradient(L){return this._removeGradientAndTexture(L,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(L,r,p){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=nL,this._colorProcessing.process=jL);const J=new k(L,r,p);return this._colorGradients.push(J),this._colorGradients.sort(((L,r)=>L.gradient<r.gradient?-1:L.gradient>r.gradient?1:0)),this}removeColorGradient(L){if(!this._colorGradients)return this;let r=0;for(const p of this._colorGradients){if(p.gradient===L){this._colorGradients.splice(r,1);break}r++}return 0===this._colorGradients.length&&(this._colorCreation.process=iL,this._colorProcessing.process=zL),this}resetDrawCache(){if(this._drawWrappers){for(const L of this._drawWrappers)if(L)for(const r of L)null===r||void 0===r||r.dispose();this._drawWrappers=[]}}_fetchR(L,r,p,J,i){return i[4*(((L=.5*Math.abs(L)+.5)*p%p|0)+((r=.5*Math.abs(r)+.5)*J%J|0)*p)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const L=this._engine,r=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*r),this._vertexBuffer=new W.b(L,this._vertexData,!0,r);let p=0;const J=this._vertexBuffer.createVertexBuffer(W.e.PositionKind,p,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[W.e.PositionKind]=J,p+=3;const i=this._vertexBuffer.createVertexBuffer(W.e.ColorKind,p,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[W.e.ColorKind]=i,p+=4;const n=this._vertexBuffer.createVertexBuffer("angle",p,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=n,p+=1;const j=this._vertexBuffer.createVertexBuffer("size",p,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=j,p+=2,this._isAnimationSheetEnabled){const L=this._vertexBuffer.createVertexBuffer("cellIndex",p,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=L,p+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const L=this._vertexBuffer.createVertexBuffer("direction",p,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=L,p+=3}if(this._useRampGradients){const L=this._vertexBuffer.createVertexBuffer("remapData",p,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=L,p+=4}let z;if(this._useInstancing){const r=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new W.b(L,r,!1,2),z=this._spriteBuffer.createVertexBuffer("offset",0,2)}else z=this._vertexBuffer.createVertexBuffer("offset",p,2,this._vertexBufferSize,this._useInstancing),p+=2;this._vertexBuffers.offset=z,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const L=[],r=[];let p=0;for(let J=0;J<this._capacity;J++)L.push(p),L.push(p+1),L.push(p+2),L.push(p),L.push(p+2),L.push(p+3),r.push(p,p+1,p+1,p+2,p+2,p+3,p+3,p,p,p+3),p+=4;this._indexBuffer=this._engine.createIndexBuffer(L),this._linesIndexBuffer=this._engine.createIndexBuffer(r)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(L)setTimeout((()=>{this.start(0)}),L);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var r;-1!==(null===(r=this.Jr)||void 0===r?void 0:r.getClassName().indexOf("Mesh"))&&this.Jr.cz(!0);const L=this.noiseTexture;if(L&&L.onGeneratedObservable)L.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let r=0;r<this.preWarmCycles;r++)this.animate(!0),L.render()}))}));else for(let r=0;r<this.preWarmCycles;r++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(L))}_postStop(L){}reset(){this._stockParticles.length=0,this.Jx.length=0}_appendParticleVertex(L,r,p,i){let n=L*this._vertexBufferSize;if(this._vertexData[n++]=r.position.x+this.bC.x,this._vertexData[n++]=r.position.y+this.bC.y,this._vertexData[n++]=r.position.z+this.bC.z,this._vertexData[n++]=r.color.r,this._vertexData[n++]=r.color.g,this._vertexData[n++]=r.color.b,this._vertexData[n++]=r.color.a,this._vertexData[n++]=r.angle,this._vertexData[n++]=r.scale.x*r.size,this._vertexData[n++]=r.scale.y*r.size,this._isAnimationSheetEnabled&&(this._vertexData[n++]=r.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[n++]=r.direction.x,this._vertexData[n++]=r.direction.y,this._vertexData[n++]=r.direction.z);else if(r._initialDirection){let L=r._initialDirection;this.isLocal&&(J.cr.TransformNormalToRef(L,this._emitterWorldMatrix,J.TmpVectors.cr[0]),L=J.TmpVectors.cr[0]),0===L.x&&0===L.z&&(L.x=.001),this._vertexData[n++]=L.x,this._vertexData[n++]=L.y,this._vertexData[n++]=L.z}else{let L=r.direction;this.isLocal&&(J.cr.TransformNormalToRef(L,this._emitterWorldMatrix,J.TmpVectors.cr[0]),L=J.TmpVectors.cr[0]),0===L.x&&0===L.z&&(L.x=.001),this._vertexData[n++]=L.x,this._vertexData[n++]=L.y,this._vertexData[n++]=L.z}this._useRampGradients&&r.remapData&&(this._vertexData[n++]=r.remapData.x,this._vertexData[n++]=r.remapData.y,this._vertexData[n++]=r.remapData.z,this._vertexData[n++]=r.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===p?p=this._epsilon:1===p&&(p=1-this._epsilon),0===i?i=this._epsilon:1===i&&(i=1-this._epsilon)),this._vertexData[n++]=p,this._vertexData[n++]=i)}_prepareParticle(L){}_createNewOnes(L){let r;for(let p=0;p<L&&this.Jx.length!==this._capacity;p++){r=this._createParticle(),this.Jx.push(r);let L=this._createQueueStart;for(;L;)L.process(r,this),L=L.nextItem;r._inheritParticleInfoToSubEmitters()}}_update(L){if(this._alive=this.Jx.length>0,this.Jr.position){const L=this.Jr;this._emitterWorldMatrix=L.getWorldMatrix()}else{const L=this.Jr;this._emitterWorldMatrix=J.Matrix.Translation(L.x,L.y,L.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Jx),this._createNewOnes(L)}static _GetAttributeNamesOrOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=[W.e.PositionKind,W.e.ColorKind,"angle","offset","size"];return L&&J.push("cellIndex"),r||J.push("direction"),p&&J.push("remapData"),J}static _GetEffectCreationOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,rL.e)(J),L&&J.push("particlesInfos"),r&&J.push("logarithmicDepthConstant"),p&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(L,r){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,rL.m)(this,this._scene,L),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&L.push("#define FOG")),this._isAnimationSheetEnabled&&L.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&L.push("#define LOGARITHMICDEPTH"),r===G.BLENDMODE_MULTIPLY&&L.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&L.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(L.push("#define BILLBOARD"),this.billboardMode){case 2:L.push("#define BILLBOARDY");break;case 8:case 9:L.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&L.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:L.push("#define BILLBOARDMODE_ALL")}p&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),L.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(L,r,p){r.push(...HL._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),L.push(...HL._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),p.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,JL.h)(L,this._imageProcessingConfigurationDefines),(0,JL.e)(p,this._imageProcessingConfigurationDefines))}_getWrapper(L){const r=this._getCustomDrawWrapper(L);if(null!==r&&void 0!==r&&r.effect)return r;const p=[];this.fillDefines(p,L);const J=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let i=this._drawWrappers[J];i||(i=this._drawWrappers[J]=[]);let n=i[L];n||(n=new LL.d(this._engine),n.drawContext&&(n.drawContext.useInstancing=this._useInstancing),i[L]=n);const j=p.join("\n");if(n.defines!==j){const L=[],r=[],p=[];this.fillUniformsAttributesAndSamplerNames(r,L,p),n.setEffect(this._engine.createEffect("particles",L,r,p,j,void 0,void 0,void 0,void 0,this._shaderLanguage),j)}return n}animate(){var L;let r,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!p&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(p?this.preWarmStepOffset:(null===(L=this._scene)||void 0===L?void 0:L.getAnimationRatio())||1),this.manualEmitCount>-1)r=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let L=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const r=this._actualFrame/this.targetStopDuration;N.GetCurrentGradient(r,this._emitRateGradients,((r,p,J)=>{r!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=p.getFactor(),this._currentEmitRateGradient=r),L=(0,C.Lerp)(this._currentEmitRate1,this._currentEmitRate2,J)}))}r=L*this._scaledUpdateSpeed|0,this._newPartsExcess+=L*this._scaledUpdateSpeed-r}if(this._newPartsExcess>1&&(r+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?r=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(r),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!p){let L=0;for(let r=0;r<this.Jx.length;r++){const p=this.Jx[r];this._appendParticleVertices(L,p),L+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Jx.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(L,r){this._appendParticleVertex(L++,r,0,0),this._useInstancing||(this._appendParticleVertex(L++,r,1,0),this._appendParticleVertex(L++,r,1,1),this._appendParticleVertex(L++,r,0,1))}rebuild(){var L;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(L=this._spriteBuffer)||void 0===L||L._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!HL.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(p.bind(p,13602)),Promise.resolve().then(p.bind(p,13541))])):await Promise.all([Promise.resolve().then(p.bind(p,13530)),Promise.resolve().then(p.bind(p,13519))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Jr||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==G.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(G.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(G.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(L){const r=this._getWrapper(L),p=r.effect,i=this._engine;i.enableEffect(r);const n=this.defaultViewMatrix??this._scene.getViewMatrix();if(p.setTexture("diffuseSampler",this.particleTexture),p.setMatrix("view",n),p.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const L=this.particleTexture.getBaseSize();p.setFloat3("particlesInfos",this.spriteCellWidth/L.width,this.spriteCellHeight/L.height,this.spriteCellWidth/L.width)}if(p.setVector2("translationPivot",this.translationPivot),p.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const L=this._scene.activeCamera;p.setVector3("eyePosition",L.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),p.setTexture("rampSampler",this._rampGradientsTexture));const j=p.defines;var z,G,C,t,E,x;(this._scene&&((0,rL.g)(p,this,this._scene),this.applyFog&&(0,pL.h)(this._scene,void 0,p)),j.indexOf("#define BILLBOARDMODE_ALL")>=0&&(n.invertToRef(J.TmpVectors.Matrix[0]),p.setMatrix("invView",J.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?i.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,p):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,p)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?i.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBuffer:this._indexBuffer,p):i.bindBuffers(this._vertexBuffers,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:null,p);(this.useLogarithmicDepth&&this._scene&&(0,pL.n)(j,p,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(p),this._setEngineBasedOnBlendMode(L),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(p),this._useInstancing)?null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?i.drawElementsType(6,0,10,this.Jx.length):i.drawArraysType(7,0,4,this.Jx.length):null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?i.drawElementsType(1,0,10*this.Jx.length):i.drawElementsType(0,0,6*this.Jx.length);return this.Jx.length}render(){if(!this.isReady()||!this.Jx.length)return 0;const L=this._engine;L.setState&&(L.setState(!1),this.forceDepthWrite&&L.setDepthWrite(!0));let r=0;return r=this.blendMode===G.BLENDMODE_MULTIPLYADD?this._render(G.BLENDMODE_MULTIPLY)+this._render(G.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),r}_onDispose(){}dispose(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),L&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),L&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(r,p),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const L=this._scene.SE.indexOf(this);L>-1&&this._scene.SE.splice(L,1),this._scene._activeParticleSystems.dispose()}this.ji.notifyObservers(this),this.ji.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}HL.ForceGLSL=!1;var oL,kL=p(11996);!function(L){L[L.ATTACHED=0]="ATTACHED",L[L.END=1]="END"}(oL||(oL={}));class RL{constructor(L){if(this.particleSystem=L,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!L.Jr||!L.Jr.dispose){const r=(0,z.c)("BABYLON.AbstractMesh");L.Jr=new r("SubemitterSystemEmitter",L.FL()),L._disposeEmitterOnDispose=!0}}clone(){let L=this.particleSystem.Jr;if(L){if(L instanceof J.cr)L=L.clone();else if(-1!==L.getClassName().indexOf("Mesh")){L=new((0,z.c)("BABYLON.Mesh"))("",L.FL()),L.isVisible=!1}}else L=new J.cr;const r=new RL(this.particleSystem.clone(this.particleSystem.name,L));return r.particleSystem.name+="Clone",r.type=this.type,r.inheritDirection=this.inheritDirection,r.inheritedVelocityAmount=this.inheritedVelocityAmount,r.particleSystem._disposeEmitterOnDispose=!0,r.particleSystem.disposeOnStop=!0,r}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r={};return r.type=this.type,r.inheritDirection=this.inheritDirection,r.inheritedVelocityAmount=this.inheritedVelocityAmount,r.particleSystem=this.particleSystem.serialize(L),r}static _ParseParticleSystem(L,r,p){throw(0,kL.d)("ParseParticle")}static Parse(L,r,p){const J=L.particleSystem,i=new RL(RL._ParseParticleSystem(J,r,p,!0));return i.type=L.type,i.inheritDirection=L.inheritDirection,i.inheritedVelocityAmount=L.inheritedVelocityAmount,i.particleSystem._isSubEmitter=!0,i}dispose(){this.particleSystem.dispose()}}var IL=p(12037);function NL(L,r){const p=new P;return p.direction1=L,p.direction2=r,p}function KL(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function mr(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function VL(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.cr(0,1,0),p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.cr(0,1,0);return new h(L,r,p)}function SL(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Lr(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.cr(0,1,0),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.cr(0,1,0);return new b(L,r,p,i,n)}function rr(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new x(L,r)}function pr(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.cr(0,1,0),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.cr(0,1,0);return new w(L,r,p,i)}const Jr=J.cr.Zero(),ir=J.cr.Zero(),nr=J.cr.Zero();class jr{constructor(){this.strength=0,this.position=J.cr.Zero()}_processParticle(L,r){this.position.subtractToRef(L.position,Jr);const p=Jr.lengthSquared()+1;Jr.normalize().scaleToRef(this.strength/p,ir),ir.scaleToRef(r._tempScaledUpdateSpeed,nr),L.direction.addInPlace(nr)}serialize(){return{position:this.position.mz(),strength:this.strength}}}class zr extends HL{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=L=>{if(!this._subEmitters||0===this._subEmitters.length)return;const r=Math.floor(Math.random()*this._subEmitters.length);for(const p of this._subEmitters[r])if(1===p.type){const r=p.clone();L._inheritParticleInfoToSubEmitter(r),r.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(r.particleSystem),r.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(L,r){const p=NL(L,r);return this.particleEmitterType=p,p}get flowMap(){return this._flowMap}set flowMap(L){this._flowMap!==L&&(this._flowMap=L,this._flowMapUpdate&&(sL(this._flowMapUpdate),this._flowMapUpdate=null),L&&(this._flowMapUpdate={process:L=>{var r;const p=null===(r=this.FL())||void 0===r?void 0:r.getTransformMatrix();this._flowMap._processParticle(L,this.flowMapStrength*this._tempScaledUpdateSpeed,p)},previousItem:null,nextItem:null},fL(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(L){this._attractors.push(L),1===this._attractors.length&&(this._attractorUpdate={process:L=>{for(const r of this._attractors)r._processParticle(L,this)},previousItem:null,nextItem:null},fL(this._attractorUpdate,this._directionProcessing))}removeAttractor(L){const r=this._attractors.indexOf(L);-1!==r&&this._attractors.splice(r,1),0===this._attractors.length&&sL(this._attractorUpdate)}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(L)}createHemisphericEmitter(){const L=KL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createSphereEmitter(){const L=mr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createDirectedSphereEmitter(){const L=VL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.cr(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.cr(0,1,0));return this.particleEmitterType=L,L}createCylinderEmitter(){const L=SL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=L,L}createDirectedCylinderEmitter(){const L=Lr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.cr(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.cr(0,1,0));return this.particleEmitterType=L,L}createConeEmitter(){const L=rr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=L,L}createDirectedConeEmitter(){const L=pr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.cr(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.cr(0,1,0));return this.particleEmitterType=L,L}createBoxEmitter(L,r,p,J){const i=new E;return this.particleEmitterType=i,this.direction1=L,this.direction2=r,this.minEmitBox=p,this.maxEmitBox=J,i}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const L of this.subEmitters)L instanceof zr?this._subEmitters.push([new RL(L)]):L instanceof RL?this._subEmitters.push([L]):L instanceof Array&&this._subEmitters.push(L)}_stopSubEmitters(){if(this.activeSubSystems){for(const L of this.activeSubSystems)L.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const L=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==L&&this._rootParticleSystem.activeSubSystems.splice(L,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(L){L&&this._stopSubEmitters()}_prepareParticle(L){if(this._subEmitters&&this._subEmitters.length>0){const r=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];L._attachedSubEmitters=[];for(const p of r)if(0===p.type){const r=p.clone();L._attachedSubEmitters.push(r),r.particleSystem.start()}}}_onDispose(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),L&&this.particles)for(const p of this.particles)if(p._attachedSubEmitters)for(let L=p._attachedSubEmitters.length-1;L>=0;L-=1)p._attachedSubEmitters[L].dispose();if(r&&this.activeSubSystems)for(let p=this.activeSubSystems.length-1;p>=0;p-=1)this.activeSubSystems[p].dispose();if(this._subEmitters&&this._subEmitters.length){for(let L=0;L<this._subEmitters.length;L++)for(const r of this._subEmitters[L])r.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Jr&&this.Jr.dispose&&this.Jr.dispose(!0)}static _Parse(L,r,p,i){let n;n=p instanceof IL.e?null:p;const G=(0,z.c)("BABYLON.Texture");if(G&&n&&(L.texture?r.particleTexture=G.Parse(L.texture,n,i):L.textureName&&(r.particleTexture=new G(i+L.textureName,n,!1,void 0===L.invertY||L.invertY),r.particleTexture.name=L.textureName)),L.emitterId||0===L.emitterId||void 0!==L.Jr?L.emitterId&&n?r.Jr=n.getLastMeshById(L.emitterId):r.Jr=J.cr.Br(L.Jr):r.Jr=J.cr.Zero(),r.isLocal=!!L.isLocal,void 0!==L.renderingGroupId&&(r.renderingGroupId=L.renderingGroupId),void 0!==L.isBillboardBased&&(r.isBillboardBased=L.isBillboardBased),void 0!==L.billboardMode&&(r.billboardMode=L.billboardMode),void 0!==L.useLogarithmicDepth&&(r.useLogarithmicDepth=L.useLogarithmicDepth),L.animations){for(let p=0;p<L.animations.length;p++){const J=L.animations[p],i=(0,z.c)("BABYLON.Animation");i&&r.animations.push(i.Parse(J))}r.beginAnimationOnStart=L.beginAnimationOnStart,r.beginAnimationFrom=L.beginAnimationFrom,r.beginAnimationTo=L.beginAnimationTo,r.beginAnimationLoop=L.beginAnimationLoop}if(L.autoAnimate&&n&&n.beginAnimation(r,L.autoAnimateFrom,L.autoAnimateTo,L.autoAnimateLoop,L.autoAnimateSpeed||1),r.startDelay=0|L.startDelay,r.minAngularSpeed=L.minAngularSpeed,r.maxAngularSpeed=L.maxAngularSpeed,r.minSize=L.minSize,r.maxSize=L.maxSize,L.minScaleX&&(r.minScaleX=L.minScaleX,r.maxScaleX=L.maxScaleX,r.minScaleY=L.minScaleY,r.maxScaleY=L.maxScaleY),void 0!==L.preWarmCycles&&(r.preWarmCycles=L.preWarmCycles,r.preWarmStepOffset=L.preWarmStepOffset),void 0!==L.minInitialRotation&&(r.minInitialRotation=L.minInitialRotation,r.maxInitialRotation=L.maxInitialRotation),r.minLifeTime=L.minLifeTime,r.maxLifeTime=L.maxLifeTime,r.minEmitPower=L.minEmitPower,r.maxEmitPower=L.maxEmitPower,r.emitRate=L.emitRate,r.gravity=J.cr.Br(L.gravity),L.noiseStrength&&(r.noiseStrength=J.cr.Br(L.noiseStrength)),r.color1=j.Fz.Br(L.color1),r.color2=j.Fz.Br(L.color2),r.colorDead=j.Fz.Br(L.colorDead),r.updateSpeed=L.updateSpeed,r.targetStopDuration=L.targetStopDuration,r.blendMode=L.blendMode,L.colorGradients)for(const J of L.colorGradients)r.addColorGradient(J.gradient,j.Fz.Br(J.color1),J.color2?j.Fz.Br(J.color2):void 0);if(L.rampGradients){for(const p of L.rampGradients)r.addRampGradient(p.gradient,j.Wr.Br(p.color));r.useRampGradients=L.useRampGradients}if(L.colorRemapGradients)for(const J of L.colorRemapGradients)r.addColorRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.alphaRemapGradients)for(const J of L.alphaRemapGradients)r.addAlphaRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.sizeGradients)for(const J of L.sizeGradients)r.addSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.angularSpeedGradients)for(const J of L.angularSpeedGradients)r.addAngularSpeedGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.velocityGradients)for(const J of L.velocityGradients)r.addVelocityGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.dragGradients)for(const J of L.dragGradients)r.addDragGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.emitRateGradients)for(const J of L.emitRateGradients)r.addEmitRateGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.startSizeGradients)for(const J of L.startSizeGradients)r.addStartSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.lifeTimeGradients)for(const J of L.lifeTimeGradients)r.addLifeTimeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(L.limitVelocityGradients){for(const p of L.limitVelocityGradients)r.addLimitVelocityGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);r.limitVelocityDamping=L.limitVelocityDamping}if(L.noiseTexture&&n){const p=(0,z.c)("BABYLON.ProceduralTexture");r.noiseTexture=p.Parse(L.noiseTexture,n,i)}let C;if(L.particleEmitterType){switch(L.particleEmitterType.type){case"SphereParticleEmitter":C=new O;break;case"SphereDirectedParticleEmitter":C=new h;break;case"ConeEmitter":case"ConeParticleEmitter":C=new x;break;case"ConeDirectedParticleEmitter":C=new w;break;case"CylinderParticleEmitter":C=new g;break;case"CylinderDirectedParticleEmitter":C=new b;break;case"HemisphericParticleEmitter":C=new c;break;case"PointParticleEmitter":C=new P;break;case"MeshParticleEmitter":C=new B;break;case"CustomParticleEmitter":C=new U;break;default:C=new E}C.parse(L.particleEmitterType,n)}else C=new E,C.parse(L,n);r.particleEmitterType=C,r.startSpriteCellID=L.startSpriteCellID,r.endSpriteCellID=L.endSpriteCellID,r.spriteCellLoop=L.spriteCellLoop??!0,r.spriteCellWidth=L.spriteCellWidth,r.spriteCellHeight=L.spriteCellHeight,r.spriteCellChangeSpeed=L.spriteCellChangeSpeed,r.spriteRandomStartCell=L.spriteRandomStartCell,r.disposeOnStop=L.disposeOnStop??!1,r.manualEmitCount=L.manualEmitCount??-1}static Parse(L,r,p){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0;const z=L.name;let G,C,t=null,E=null;if(r instanceof IL.e?G=r:(C=r,G=C.getEngine()),L.customShader&&G.createEffectForParticles){E=L.customShader;const r=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";t=G.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,r)}const x=new zr(z,n||L.Mr,r,t,L.isAnimationSheetEnabled);if(x.customShader=E,x._rootUrl=p,L.id&&(x.id=L.id),L.subEmitters){x.subEmitters=[];for(const J of L.subEmitters){const L=[];for(const i of J)L.push(RL.Parse(i,r,p));x.subEmitters.push(L)}}if(L.attractors)for(const j of L.attractors){const L=new jr;L.position=J.cr.Br(j.position),L.strength=j.strength,x.addAttractor(L)}return zr._Parse(L,x,r,p),L.textureMask&&(x.textureMask=j.Fz.Br(L.textureMask)),L.bC&&(x.bC=J.cr.Br(L.bC)),L.preventAutoStart&&(x.preventAutoStart=L.preventAutoStart),i||x.preventAutoStart||x.start(),x}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r={};if(zr._Serialize(r,this,L),r.textureMask=this.textureMask.mz(),r.customShader=this.customShader,r.preventAutoStart=this.preventAutoStart,r.bC=this.bC.mz(),this.subEmitters){r.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const p of this._subEmitters){const J=[];for(const r of p)J.push(r.serialize(L));r.subEmitters.push(J)}}if(this._attractors&&this._attractors.length){r.attractors=[];for(const L of this._attractors)r.attractors.push(L.serialize())}return r}static _Serialize(L,r,p){if(L.name=r.name,L.id=r.id,L.Mr=r.getCapacity(),L.disposeOnStop=r.disposeOnStop,L.manualEmitCount=r.manualEmitCount,r.Jr.position){const p=r.Jr;L.emitterId=p.id}else{const p=r.Jr;L.Jr=p.mz()}r.particleEmitterType&&(L.particleEmitterType=r.particleEmitterType.serialize()),r.particleTexture&&(p?L.texture=r.particleTexture.serialize():(L.textureName=r.particleTexture.name,L.invertY=!!r.particleTexture._invertY)),L.isLocal=r.isLocal,Z.c.AppendSerializedAnimations(r,L),L.beginAnimationOnStart=r.beginAnimationOnStart,L.beginAnimationFrom=r.beginAnimationFrom,L.beginAnimationTo=r.beginAnimationTo,L.beginAnimationLoop=r.beginAnimationLoop,L.startDelay=r.startDelay,L.renderingGroupId=r.renderingGroupId,L.isBillboardBased=r.isBillboardBased,L.billboardMode=r.billboardMode,L.minAngularSpeed=r.minAngularSpeed,L.maxAngularSpeed=r.maxAngularSpeed,L.minSize=r.minSize,L.maxSize=r.maxSize,L.minScaleX=r.minScaleX,L.maxScaleX=r.maxScaleX,L.minScaleY=r.minScaleY,L.maxScaleY=r.maxScaleY,L.minEmitPower=r.minEmitPower,L.maxEmitPower=r.maxEmitPower,L.minLifeTime=r.minLifeTime,L.maxLifeTime=r.maxLifeTime,L.emitRate=r.emitRate,L.gravity=r.gravity.mz(),L.noiseStrength=r.noiseStrength.mz(),L.color1=r.color1.mz(),L.color2=r.color2.mz(),L.colorDead=r.colorDead.mz(),L.updateSpeed=r.updateSpeed,L.targetStopDuration=r.targetStopDuration,L.blendMode=r.blendMode,L.preWarmCycles=r.preWarmCycles,L.preWarmStepOffset=r.preWarmStepOffset,L.minInitialRotation=r.minInitialRotation,L.maxInitialRotation=r.maxInitialRotation,L.startSpriteCellID=r.startSpriteCellID,L.spriteCellLoop=r.spriteCellLoop,L.endSpriteCellID=r.endSpriteCellID,L.spriteCellChangeSpeed=r.spriteCellChangeSpeed,L.spriteCellWidth=r.spriteCellWidth,L.spriteCellHeight=r.spriteCellHeight,L.spriteRandomStartCell=r.spriteRandomStartCell,L.isAnimationSheetEnabled=r.isAnimationSheetEnabled,L.useLogarithmicDepth=r.useLogarithmicDepth;const J=r.getColorGradients();if(J){L.colorGradients=[];for(const r of J){const p={gradient:r.gradient,color1:r.color1.mz()};r.color2?p.color2=r.color2.mz():p.color2=r.color1.mz(),L.colorGradients.push(p)}}const i=r.getRampGradients();if(i){L.rampGradients=[];for(const r of i){const p={gradient:r.gradient,color:r.color.mz()};L.rampGradients.push(p)}L.useRampGradients=r.useRampGradients}const n=r.getColorRemapGradients();if(n){L.colorRemapGradients=[];for(const r of n){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.colorRemapGradients.push(p)}}const j=r.getAlphaRemapGradients();if(j){L.alphaRemapGradients=[];for(const r of j){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.alphaRemapGradients.push(p)}}const z=r.getSizeGradients();if(z){L.sizeGradients=[];for(const r of z){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.sizeGradients.push(p)}}const G=r.getAngularSpeedGradients();if(G){L.angularSpeedGradients=[];for(const r of G){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.angularSpeedGradients.push(p)}}const C=r.getVelocityGradients();if(C){L.velocityGradients=[];for(const r of C){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.velocityGradients.push(p)}}const t=r.getDragGradients();if(t){L.dragGradients=[];for(const r of t){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.dragGradients.push(p)}}const E=r.getEmitRateGradients();if(E){L.emitRateGradients=[];for(const r of E){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.emitRateGradients.push(p)}}const x=r.getStartSizeGradients();if(x){L.startSizeGradients=[];for(const r of x){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.startSizeGradients.push(p)}}const w=r.getLifeTimeGradients();if(w){L.lifeTimeGradients=[];for(const r of w){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.lifeTimeGradients.push(p)}}const g=r.getLimitVelocityGradients();if(g){L.limitVelocityGradients=[];for(const r of g){const p={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?p.factor2=r.factor2:p.factor2=r.factor1,L.limitVelocityGradients.push(p)}L.limitVelocityDamping=r.limitVelocityDamping}r.noiseTexture&&(L.noiseTexture=r.noiseTexture.serialize())}clone(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J={...this._customWrappers};let i=null;const n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){i=this.customShader;const L=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"",r=n.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,L);J[0]?J[0].effect=r:this.setCustomEffect(r,0)}const j=this.serialize(p),z=zr.Parse(j,this._scene||this._engine,this._rootUrl);return z.name=L,z.customShader=i,z._customWrappers=J,void 0===r&&(r=this.Jr),this.noiseTexture&&(z.noiseTexture=this.noiseTexture.clone()),z.Jr=r,this.preventAutoStart||z.start(),z}}zr.BILLBOARDMODE_Y=2,zr.BILLBOARDMODE_ALL=7,zr.BILLBOARDMODE_STRETCHED=8,zr.BILLBOARDMODE_STRETCHED_LOCAL=9,RL._ParseParticleSystem=zr.Parse;var Gr=p(12363),Cr=p(12355),tr=p(12253);tr.b.prototype.createTransformFeedback=function(){const L=this._gl.createTransformFeedback();if(!L)throw new Error("Unable to create Transform Feedback");return L},tr.b.prototype.deleteTransformFeedback=function(L){this._gl.deleteTransformFeedback(L)},tr.b.prototype.bindTransformFeedback=function(L){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,L)},tr.b.prototype.beginTransformFeedback=function(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(L?this._gl.POINTS:this._gl.TRIANGLES)},tr.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},tr.b.prototype.setTranformFeedbackVaryings=function(L,r){this._gl.transformFeedbackVaryings(L,r,this._gl.INTERLEAVED_ATTRIBS)},tr.b.prototype.bindTransformFeedbackBuffer=function(L){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,L?L.underlyingResource:null)},tr.b.prototype.readTransformFeedbackBuffer=function(L){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,L)};const Er="clipPlaneFragmentDeclaration2",xr="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";Q.d.IncludesShadersStore[Er]||(Q.d.IncludesShadersStore[Er]=xr);p(13420),p(13423),p(13425),p(13430),p(13434),p(13439),p(13446),p(13452);const wr="gpuRenderParticlesPixelShader",gr="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";Q.d.ShadersStore[wr]||(Q.d.ShadersStore[wr]=gr);const br="clipPlaneVertexDeclaration2",cr="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";Q.d.IncludesShadersStore[br]||(Q.d.IncludesShadersStore[br]=cr);p(13455),p(13464),p(13471),p(13475);const Pr="gpuRenderParticlesVertexShader",Or="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";Q.d.ShadersStore[Pr]||(Q.d.ShadersStore[Pr]=Or);class hr extends G{static get IsSupported(){if(!V.c.LastCreatedEngine)return!1;const L=V.c.LastCreatedEngine.getCaps();return L.supportTransformFeedbacks||L.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(L){this._maxActiveParticleCount=Math.min(L,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(L){this.maxActiveParticleCount=L}createPointEmitter(L,r){const p=NL(L,r);return this.particleEmitterType=p,p}createHemisphericEmitter(){const L=KL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createSphereEmitter(){const L=mr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=L,L}createDirectedSphereEmitter(){const L=VL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.cr(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.cr(0,1,0));return this.particleEmitterType=L,L}createCylinderEmitter(){const L=SL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=L,L}createDirectedCylinderEmitter(){const L=Lr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.cr(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.cr(0,1,0));return this.particleEmitterType=L,L}createConeEmitter(){const L=rr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=L,L}createDirectedConeEmitter(){const L=pr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.cr(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.cr(0,1,0));return this.particleEmitterType=L,L}createBoxEmitter(L,r,p,J){const i=new E;return this.particleEmitterType=i,this.direction1=L,this.direction2=r,this.minEmitBox=p,this.maxEmitBox=J,i}get flowMap(){return this._flowMap}set flowMap(L){this._flowMap!==L&&(this._flowMap=L)}isReady(){if(!this.Jr||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==zr.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(zr.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(zr.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";L?setTimeout((()=>{this.start(0)}),L):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var L;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(L=this._customWrappers[r])||void 0===L?void 0:L.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[L]??this._customWrappers[0]}setCustomEffect(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[r]=new LL.d(this._engine),this._customWrappers[r].effect=L}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new K.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(L,r,p){return super._removeGradientAndTexture(L,r,p),this._releaseBuffers(),this}addColorGradient(L,r){this._colorGradients||(this._colorGradients=[]);const p=new k(L,r);return this._colorGradients.push(p),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(L&&this._colorGradients.sort(((L,r)=>L.gradient<r.gradient?-1:L.gradient>r.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(L){return this._removeGradientAndTexture(L,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const r in this._drawWrappers){var L;null===(L=this._drawWrappers[r].drawContext)||void 0===L||L.reset()}}_addFactorGradient(L,r,p){const J=new I(r,p);L.push(J),this._releaseBuffers()}addSizeGradient(L,r){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,L,r),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(L){return this._removeGradientAndTexture(L,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(L,r){if(!L)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&L.sort(((L,r)=>L.gradient<r.gradient?-1:L.gradient>r.gradient?1:0));const p=this;p[r]&&(p[r].dispose(),p[r]=null)}addAngularSpeedGradient(L,r){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,L,r),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(L){return this._removeGradientAndTexture(L,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(L,r){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,L,r),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(L){return this._removeGradientAndTexture(L,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(L,r){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,L,r),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(L){return this._removeGradientAndTexture(L,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(L,r){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,L,r),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(L){return this._removeGradientAndTexture(L,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(L){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(L,r,p){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(L),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.ji=new K.c,this.onStoppedObservable=new K.c,this.onStartedObservable=new K.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,p&&"Scene"!==p.getClassName()?(this._engine=p,this.defaultProjectionMatrix=J.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=p||V.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SE.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,z.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,z.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,z.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,z.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new LL.d(this._engine)},this._customWrappers[0].effect=i,this._drawWrappers={0:new LL.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(r=r??{}).randomTextureSize||delete r.randomTextureSize;const j={Mr:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...r},G=r;isFinite(G)&&(j.Mr=G),this._capacity=j.Mr,this._maxActiveParticleCount=j.Mr,this._currentActiveCount=0,this._isAnimationSheetEnabled=n,this.particleEmitterType=new E;const C=Math.min(this._engine.getCaps().maxTextureSize,j.randomTextureSize);let t=[];for(let J=0;J<C;++J)t.push(Math.random()),t.push(Math.random()),t.push(Math.random()),t.push(Math.random());this._randomTexture=new mL.e(new Float32Array(t),C,1,5,p,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,t=[];for(let J=0;J<C;++J)t.push(Math.random()),t.push(Math.random()),t.push(Math.random()),t.push(Math.random());this._randomTexture2=new mL.e(new Float32Array(t),C,1,5,p,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=C}_reset(){this._releaseBuffers()}_createVertexBuffers(L,r,p){const J={};J.position=r.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let i=3;J.age=r.createVertexBuffer("age",i,1,this._attributesStrideSize,!0),i+=1,J.size=r.createVertexBuffer("size",i,3,this._attributesStrideSize,!0),i+=3,J.life=r.createVertexBuffer("life",i,1,this._attributesStrideSize,!0),i+=1,i+=4,this.billboardMode===zr.BILLBOARDMODE_STRETCHED&&(J.direction=r.createVertexBuffer("direction",i,3,this._attributesStrideSize,!0)),i+=3,this._platform.alignDataInBuffer&&(i+=1),this.particleEmitterType instanceof U&&(i+=3,this._platform.alignDataInBuffer&&(i+=1)),this._colorGradientsTexture||(J.color=r.createVertexBuffer("color",i,4,this._attributesStrideSize,!0),i+=4),this._isBillboardBased||(J.initialDirection=r.createVertexBuffer("initialDirection",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1)),this.noiseTexture&&(J.noiseCoordinates1=r.createVertexBuffer("noiseCoordinates1",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1),J.noiseCoordinates2=r.createVertexBuffer("noiseCoordinates2",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1)),J.angle=r.createVertexBuffer("angle",i,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?i++:i+=2,this._isAnimationSheetEnabled&&(J.cellIndex=r.createVertexBuffer("cellIndex",i,1,this._attributesStrideSize,!0),i+=1,this.spriteRandomStartCell&&(J.cellStartOffset=r.createVertexBuffer("cellStartOffset",i,1,this._attributesStrideSize,!0),i+=1)),J.offset=p.createVertexBuffer("offset",0,2),J.uv=p.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(J),this._platform.createVertexBuffers(L,J),this.resetDrawCache()}_initialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!L)return;const r=this._engine,p=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof U&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const i=this.particleEmitterType instanceof U,n=J.TmpVectors.cr[0];let j=0;for(let J=0;J<this._capacity;J++)if(p.push(0),p.push(0),p.push(0),p.push(0),p.push(0),p.push(0),p.push(0),p.push(0),p.push(Math.random()),p.push(Math.random()),p.push(Math.random()),p.push(Math.random()),i?(this.particleEmitterType.particleDestinationGenerator(J,null,n),p.push(n.x),p.push(n.y),p.push(n.z)):(p.push(0),p.push(0),p.push(0)),this._platform.alignDataInBuffer&&p.push(0),j+=16,i&&(this.particleEmitterType.particlePositionGenerator(J,null,n),p.push(n.x),p.push(n.y),p.push(n.z),this._platform.alignDataInBuffer&&p.push(0),j+=4),this._colorGradientsTexture||(p.push(0),p.push(0),p.push(0),p.push(0),j+=4),this.isBillboardBased||(p.push(0),p.push(0),p.push(0),this._platform.alignDataInBuffer&&p.push(0),j+=4),this.noiseTexture&&(p.push(Math.random()),p.push(Math.random()),p.push(Math.random()),this._platform.alignDataInBuffer&&p.push(0),p.push(Math.random()),p.push(Math.random()),p.push(Math.random()),this._platform.alignDataInBuffer&&p.push(0),j+=8),p.push(0),j+=1,this._angularSpeedGradientsTexture||(p.push(0),j+=1),this._isAnimationSheetEnabled&&(p.push(0),j+=1,this.spriteRandomStartCell&&(p.push(0),j+=1)),this._platform.alignDataInBuffer){let L=3-(j+3&3);for(j+=L;L-- >0;)p.push(0)}const z=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),G=this._platform.createParticleBuffer(p),C=this._platform.createParticleBuffer(p);this._buffer0=new W.b(r,G,!1,this._attributesStrideSize),this._buffer1=new W.b(r,C,!1,this._attributesStrideSize),this._spriteBuffer=new W.b(r,z,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let L=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(L+="\n#define BILLBOARD"),this._colorGradientsTexture&&(L+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(L+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(L+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(L+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(L+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(L+="\n#define DRAGGRADIENTS"),this._flowMap&&(L+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(L+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(L+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(L+="\n#define NOISE"),this.isLocal&&(L+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===L||(this._cachedUpdateDefines=L,this._updateBuffer=this._platform.createUpdateBuffer(L)),this._platform.isUpdateBufferReady()}_getWrapper(L){const r=this._getCustomDrawWrapper(L);if(null!==r&&void 0!==r&&r.effect)return r;const p=[];this.fillDefines(p,L);let J=this._drawWrappers[L];J||(J=new LL.d(this._engine),J.drawContext&&(J.drawContext.useInstancing=!0),this._drawWrappers[L]=J);const i=p.join("\n");if(J.defines!==i){const L=[],r=[],p=[];this.fillUniformsAttributesAndSamplerNames(r,L,p),J.setEffect(this._engine.createEffect("gpuRenderParticles",L,r,p,i),i)}return J}static _GetAttributeNamesOrOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=[W.e.PositionKind,"age","life","size","angle"];return L||i.push(W.e.ColorKind),r&&i.push("cellIndex"),p||i.push("initialDirection"),J&&i.push("direction"),i.push("offset",W.e.UVKind),i}static _GetEffectCreationOptions(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["emitterWM","bC","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,rL.e)(J),L&&J.push("sheetInfos"),r&&J.push("logarithmicDepthConstant"),p&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,rL.m)(this,this._scene,L),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Cr.b.FOGMODE_NONE&&L.push("#define FOG")),r===zr.BLENDMODE_MULTIPLY&&L.push("#define BLENDMULTIPLYMODE"),this.isLocal&&L.push("#define LOCAL"),this.useLogarithmicDepth&&L.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(L.push("#define BILLBOARD"),this.billboardMode){case zr.BILLBOARDMODE_Y:L.push("#define BILLBOARDY");break;case zr.BILLBOARDMODE_STRETCHED:L.push("#define BILLBOARDSTRETCHED");break;case zr.BILLBOARDMODE_ALL:L.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&L.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&L.push("#define ANIMATESHEET"),p&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),L.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(L,r,p){r.push(...hr._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===zr.BILLBOARDMODE_STRETCHED)),L.push(...hr._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),p.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Gr.e.PrepareUniforms(L,this._imageProcessingConfigurationDefines),Gr.e.PrepareSamplers(p,this._imageProcessingConfigurationDefines))}animate(){var L;let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(r?this.preWarmStepOffset:(null===(L=this._scene)||void 0===L?void 0:L.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(L,r){const p=this[r];if(!L||!L.length||p)return;const J=new Float32Array(this._rawTextureWidth);for(let i=0;i<this._rawTextureWidth;i++){const r=i/this._rawTextureWidth;N.GetCurrentGradient(r,L,((L,r,p)=>{J[i]=(0,C.Lerp)(L.factor1,r.factor1,p)}))}this[r]=mL.e.CreateRTexture(J,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[r].name=r.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const L=new Uint8Array(4*this._rawTextureWidth),r=j.TmpColors.Fz[0];for(let p=0;p<this._rawTextureWidth;p++){const J=p/this._rawTextureWidth;N.GetCurrentGradient(J,this._colorGradients,((J,i,n)=>{j.Fz.LerpToRef(J.color1,i.color1,n,r),L[4*p]=255*r.r,L[4*p+1]=255*r.g,L[4*p+2]=255*r.b,L[4*p+3]=255*r.a}))}this._colorGradientsTexture=mL.e.CreateRGBATexture(L,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(L,r){var p,i,n,j;const z=this._getWrapper(L),G=z.effect;this._engine.enableEffect(z);const C=(null===(p=this._scene)||void 0===p?void 0:p.getViewMatrix())||J.Matrix.IdentityReadOnly;if(G.setMatrix("view",C),G.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),G.setTexture("diffuseSampler",this.particleTexture),G.setVector2("translationPivot",this.translationPivot),G.setVector3("bC",this.bC),this.isLocal&&G.setMatrix("emitterWM",r),this._colorGradientsTexture?G.setTexture("colorGradientSampler",this._colorGradientsTexture):G.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const L=this.particleTexture.getBaseSize();G.setFloat3("sheetInfos",this.spriteCellWidth/L.width,this.spriteCellHeight/L.height,L.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const L=this._scene.activeCamera;G.setVector3("eyePosition",L.globalPosition)}const t=G.defines;if(this._scene&&((0,rL.g)(G,this,this._scene),this.applyFog&&(0,pL.h)(this._scene,void 0,G)),t.indexOf("#define BILLBOARDMODE_ALL")>=0){const L=C.clone();L.invert(),G.setMatrix("invView",L)}return this.useLogarithmicDepth&&this._scene&&(0,pL.n)(t,G,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(G),this._setEngineBasedOnBlendMode(L),this._platform.bindDrawBuffers(this._targetIndex,G,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(G),null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(j=this._scene)&&void 0!==j&&j.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(L){if(!this.Jr||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!L)if(this.Jr.position){L=this.Jr.getWorldMatrix()}else{const r=this.Jr;L=J.TmpVectors.Matrix[0],J.Matrix.TranslationToRef(r.x,r.y,r.z,L)}const r=this._engine,p=r.getDepthWrite();if(r.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const L=this.FL();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",L.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",L),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const i=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=i,r.setDepthWrite(p)}render(){let L,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!r&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let L=0;L<this.preWarmCycles;L++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const L=0|this._accumulatedCount;this._accumulatedCount-=L,this._currentActiveCount+=L}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Jr.position){L=this.Jr.getWorldMatrix()}else{const r=this.Jr;L=J.TmpVectors.Matrix[0],J.Matrix.TranslationToRef(r.x,r.y,r.z,L)}const i=this._engine;this.updateInAnimate||this._update(L);let n=0;return r||p||(i.setState(!1),this.forceDepthWrite&&i.setDepthWrite(!0),n=this.blendMode===zr.BLENDMODE_MULTIPLYADD?this._render(zr.BLENDMODE_MULTIPLY,L)+this._render(zr.BLENDMODE_ADD,L):this._render(this.blendMode,L),this._engine.setAlphaMode(0)),n}rebuild(){const L=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(L,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,L()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const r in this._drawWrappers){this._drawWrappers[r].dispose()}if(this._drawWrappers={},this._scene){const L=this._scene.SE.indexOf(this);L>-1&&this._scene.SE.splice(L,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let r=0;r<this._renderVertexBuffers.length;++r){const L=this._renderVertexBuffers[r];for(const r in L)L[r].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),L&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),L&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.ji.notifyObservers(this),this.ji.clear()}clone(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J={...this._customWrappers};let i=null;const n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){i=this.customShader;const L=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"";J[0]=n.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,L,void 0,void 0,void 0,this)}const j=this.serialize(p),z=hr.Parse(j,this._scene||this._engine,this._rootUrl);return z.name=L,z.customShader=i,z._customWrappers=J,void 0===r&&(r=this.Jr),this.noiseTexture&&(z.noiseTexture=this.noiseTexture.clone()),z.Jr=r,z}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r={};return zr._Serialize(r,this,L),r.activeParticleCount=this.activeParticleCount,r.randomTextureSize=this._randomTextureSize,r.customShader=this.customShader,r}static Parse(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;const n=L.name;let j,z;r instanceof IL.e?j=r:(z=r,j=z.getEngine());const G=new hr(n,{Mr:i||L.Mr,randomTextureSize:L.randomTextureSize},r,null,L.isAnimationSheetEnabled);if(G._rootUrl=p,L.customShader&&j.createEffectForParticles){const r=L.customShader,p=r.shaderOptions.defines.length>0?r.shaderOptions.defines.join("\n"):"",J=j.createEffectForParticles(r.shaderPath.fragmentElement,r.shaderOptions.uniforms,r.shaderOptions.samplers,p,void 0,void 0,void 0,G);G.setCustomEffect(J,0),G.customShader=r}return L.id&&(G.id=L.id),L.activeParticleCount&&(G.activeParticleCount=L.activeParticleCount),zr._Parse(L,G,r,p),L.preventAutoStart&&(G.preventAutoStart=L.preventAutoStart),J||G.preventAutoStart||G.start(),G}}var Ur=p(11957),Wr=p(13482),Br=p(12506);class Fr{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(L){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const r of this.systems)r.Jr=L;this._emitterNode=L}setEmitterAsSphere(L,r,p){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:L,renderingGroupId:r};const J=(0,Wr.d)("emitterSphere",{diameter:L.diameter,segments:L.segments},p);J.renderingGroupId=r;const i=new Br.Ur("emitterSphereMaterial",p);i.emissiveColor=L.color,J.material=i;for(const n of this.systems)n.Jr=J;this._emitterNode=J}start(L){for(const r of this.systems)L&&(r.Jr=L),r.start()}dispose(){for(const L of this.systems)L.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r={systems:[]};for(const p of this.systems)r.systems.push(p.serialize(L));return this._emitterNode&&(r.Jr=this._emitterCreationOptions),r}static Parse(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;const i=new Fr,n=this.BaseAssetsUrl+"/textures/";r=r||V.c.LastCreatedScene;for(const j of L.systems)i.systems.push(p?hr.Parse(j,r,n,!0,J):zr.Parse(j,r,n,!0,J));if(L.Jr){const p=L.Jr.options;if("Sphere"===L.Jr.kind)i.setEmitterAsSphere({diameter:p.diameter,segments:p.segments,color:j.Wr.Br(p.color)},L.Jr.renderingGroupId,r)}return i}}Fr.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Qr=p(12004);class er{static CreateDefault(L){let r,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,J=arguments.length>2?arguments[2]:void 0;r=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new hr("default system",{Mr:p},J):new zr("default system",p,J),r.Jr=L;const i=Ur.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return r.particleTexture=new X.c(i,r.FL()),r.createConeEmitter(.1,Math.PI/4),r.color1=new j.Fz(1,1,1,1),r.color2=new j.Fz(1,1,1,1),r.colorDead=new j.Fz(1,1,1,0),r.minSize=.1,r.maxSize=.1,r.minEmitPower=2,r.maxEmitPower=2,r.updateSpeed=1/60,r.emitRate=30,r}static CreateAsync(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;r||(r=V.c.LastCreatedScene);const i={};return r.addPendingData(i),new Promise(((n,j)=>{if(p&&!hr.IsSupported)return r.removePendingData(i),j("Particle system with GPU is not supported.");Ur.Tools.LoadFile(`${er.BaseAssetsUrl}/systems/${L}.json`,(L=>{r.removePendingData(i);const j=JSON.parse(L.toString());return n(Fr.Parse(j,r,p,J))}),void 0,void 0,void 0,(()=>(r.removePendingData(i),j(`An error occurred with the creation of your particle system. Check if your type '${L}' exists.`))))}))}static ExportSet(L){const r=new Fr;for(const p of L)r.systems.push(p);return r}static ParseFromFileAsync(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n=arguments.length>5?arguments[5]:void 0;return new Promise(((j,z)=>{const G=new Qr.b;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const r=JSON.parse(G.responseText);let z;z=J?hr.Parse(r,p,i,!1,n):zr.Parse(r,p,i,!1,n),L&&(z.name=L),j(z)}else z("Unable to load the particle system")})),G.open("GET",r),G.send()}))}static ParseFromSnippetAsync(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;if("_BLANK"===L){const L=this.CreateDefault(null);return L.start(),Promise.resolve(L)}return new Promise(((n,j)=>{const z=new Qr.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const j=JSON.parse(JSON.parse(z.responseText).jsonPayload),G=JSON.parse(j.particleSystem);let C;C=p?hr.Parse(G,r,J,!1,i):zr.Parse(G,r,J,!1,i),C.snippetId=L,n(C)}else j("Unable to load the snippet "+L)})),z.open("GET",this.SnippetUrl+"/"+L.replace(/#/g,"/")),z.send()}))}}er.BaseAssetsUrl=Fr.BaseAssetsUrl,er.SnippetUrl="https://snippet.babylonjs.com",er.CreateFromSnippetAsync=er.ParseFromSnippetAsync;var vr=p(12575),yr=p(12389),Ar=p(13489);(0,Ar.g)(yr.b.NAME_PARTICLESYSTEM,((L,r,p,J)=>{const i=(0,Ar.h)(yr.b.NAME_PARTICLESYSTEM);if(i&&void 0!==L.SE&&null!==L.SE)for(let n=0,j=L.SE.length;n<j;n++){const j=L.SE[n];p.SE.push(i(j,r,J))}})),(0,Ar.e)(yr.b.NAME_PARTICLESYSTEM,((L,r,p)=>{if(L.activeParticleCount){return hr.Parse(L,r,p)}return zr.Parse(L,r,p)})),IL.e.prototype.createEffectForParticles=function(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,G=arguments.length>7?arguments[7]:void 0,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,t=arguments.length>9?arguments[9]:void 0,E=[],x=[];const w=[];return G?G.fillUniformsAttributesAndSamplerNames(x,E,w):(E=zr._GetAttributeNamesOrOptions(),x=zr._GetEffectCreationOptions()),-1===i.indexOf(" BILLBOARD")&&(i+="\n#define BILLBOARD\n"),null!==G&&void 0!==G&&G.isAnimationSheetEnabled&&-1===i.indexOf(" ANIMATESHEET")&&(i+="\n#define ANIMATESHEET\n"),-1===J.indexOf("diffuseSampler")&&J.push("diffuseSampler"),this.createEffect({vertex:t??(null===G||void 0===G?void 0:G.vertexShaderName)??"particles",fragmentElement:L},E,x.concat(r),w.concat(J),i,n,j,z,void 0,C,(async()=>{0===C?await Promise.resolve().then(p.bind(p,13530)):await Promise.resolve().then(p.bind(p,13602))}))},vr.c.prototype.getEmittedParticleSystems=function(){const L=[];for(let r=0;r<this.FL().SE.length;r++){const p=this.FL().SE[r];p.Jr===this&&L.push(p)}return L},vr.c.prototype.getHierarchyEmittedParticleSystems=function(){const L=[],r=this.getDescendants();r.push(this);for(let p=0;p<this.FL().SE.length;p++){const J=this.FL().SE[p],i=J.Jr;i.position&&-1!==r.indexOf(i)&&L.push(J)}return L};p(12468),p(12480),p(12547);p(12555),p(13494),p(12311),p(12450),p(12598);p(12302);var ur;p(13502),p(12156);!function(L){L[L.Color=2]="Color",L[L.UV=1]="UV",L[L.Random=0]="Random",L[L.Stated=3]="Stated"}(ur||(ur={}));var ar=p(12343);const qr=new J.cr(0,0,0),Zr=new J.cr(0,0,0),Xr=new J.cr(0,0,0);class Dr{constructor(L,r,p){this.width=L,this.height=r,this.data=p}processFlowable(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2?arguments[2]:void 0;if(!p)return;p instanceof J.Matrix?J.cr.TransformCoordinatesToRef(L.position,p,Xr):(Xr.x=p.x,Xr.y=p.y,Xr.z=p.z);const i=.5*Xr.x+.5,n=1-(.5*Xr.y+.5),j=Math.floor(i*this.width),z=Math.floor(n*this.height);if(j<0||j>=this.width||z<0||z>=this.height)return;const G=4*(z*this.width+j),C=this.data[G]/255*2-1,t=this.data[G+1]/255*2-1,E=this.data[G+2]/255*2-1,x=this.data[G+3]/255;qr.set(C,t,E),qr.scaleToRef(r*x,Zr),L.direction.addInPlace(Zr)}_processParticle(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2?arguments[2]:void 0;this.processFlowable(L,r,p)}static async FromUrlAsync(L){return await new Promise(((r,p)=>{const J=document.createElement("canvas"),i=J.getContext("2d");let n=null;const j=new Image;j.crossOrigin="anonymous",j.src=L,j.onerror=r=>{p(new Error(`Failed to load image: ${L} : ${r}`))},j.onload=()=>{J.width=j.width,J.height=j.height,i.drawImage(j,0,0),n=i.getImageData(0,0,J.width,J.height),r(new Dr(J.width,J.height,n.data))}}))}static async ExtractFromTextureAsync(L){return await new Promise(((r,p)=>{if(!L.isReady())return void L.onLoadObservable.addOnce((async()=>{try{const p=await this.ExtractFromTextureAsync(L);r(p)}catch(J){p(J)}}));const J=L.getSize();ar.l.GetTextureDataAsync(L,J.width,J.height).then((L=>{r(new Dr(J.width,J.height,new Uint8ClampedArray(L)))})).catch(p)}))}}var lr,Tr,Yr,Mr,fr,dr,sr,Hr,or;!function(L){L[L.Int=1]="Int",L[L.Float=2]="Float",L[L.Vector2=4]="Vector2",L[L.cr=8]="cr",L[L.Matrix=16]="Matrix",L[L.Particle=32]="Particle",L[L.Texture=64]="Texture",L[L.Fz=128]="Fz",L[L.FloatGradient=256]="FloatGradient",L[L.Vector2Gradient=512]="Vector2Gradient",L[L.Vector3Gradient=1024]="Vector3Gradient",L[L.Color4Gradient=2048]="Color4Gradient",L[L.System=4096]="System",L[L.AutoDetect=8192]="AutoDetect",L[L.BasedOnInput=16384]="BasedOnInput",L[L.Undefined=32768]="Undefined",L[L.All=65535]="All"}(lr||(lr={})),function(L){L[L.Compatible=0]="Compatible",L[L.TypeIncompatible=1]="TypeIncompatible",L[L.HierarchyIssue=2]="HierarchyIssue"}(Tr||(Tr={})),function(L){L[L.Input=0]="Input",L[L.Output=1]="Output"}(Yr||(Yr={}));class kr{get direction(){return this._direction}get type(){if(this._type===lr.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===lr.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(L){this._type=L}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((L=>L.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(L,r,p){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=lr.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new K.c,this.onDisconnectionObservable=new K.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=r,this.name=L,this._direction=p}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(L){var r;return this.isConnected?null!==(r=this._connectedPoint)&&void 0!==r&&r._storedFunction?this._connectedPoint._storedFunction(L):this._connectedPoint._storedValue:this.value}canConnectTo(L){return 0===this.checkCompatibilityState(L)}checkCompatibilityState(L){const r=this._ownerBlock,p=L.ownerBlock;if(this.type!==L.type&&L.innerType!==lr.AutoDetect)return L.acceptedConnectionPointTypes&&-1!==L.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(L.excludedConnectionPointTypes&&-1!==L.excludedConnectionPointTypes.indexOf(this.type))return 1;let J=p,i=r;return 0===this.direction&&(J=r,i=p),J.isAnAncestorOf(i)?2:0}connectTo(L){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(L))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${L.ownerBlock.name}".${L.name}`;return this._endpoints.push(L),L._connectedPoint=this,this.onConnectionObservable.notifyObservers(L),L.onConnectionObservable.notifyObservers(this),this}disconnectFrom(L){const r=this._endpoints.indexOf(L);return-1===r||(this._endpoints.splice(r,1),L._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(L),L.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(L){let r=1;for(;r<lr.All;)L&r||this.excludedConnectionPointTypes.push(r),r<<=1}serialize(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const r={};return r.name=this.name,r.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.mz?(r.valueType="BABYLON."+this.value.getClassName(),r.value=this.value.mz()):(r.valueType="number",r.value=this.value)),L&&this.connectedPoint&&(r.inputName=this.name,r.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,r.targetConnectionName=this.connectedPoint.name,r.isExposedOnFrame=!0,r.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(r.isExposedOnFrame=!0,r.exposedPortPosition=this.exposedPortPosition),r}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Rr{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(L){this._name=L}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(L){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new K.c,this.ji=new K.c,this.onInputChangedObservable=new K.c,this.visibleOnFrame=!1,this._name=L,this.uniqueId=D.c.UniqueId}_inputRename(L){return L}_outputRename(L){return L}isAnAncestorOf(L){for(const r of this._outputs)if(r.hasEndpoints)for(const p of r.endpoints){if(p.ownerBlock===L)return!0;if(p.ownerBlock.isAnAncestorOf(L))return!0}return!1}isAnAncestorOfType(L){if(this.getClassName()===L)return!0;for(const r of this._outputs)if(r.hasEndpoints)for(const p of r.endpoints)if(p.ownerBlock.isAnAncestorOfType(L))return!0;return!1}getInputByName(L){const r=this._inputs.filter((r=>r.name===L));return r.length?r[0]:null}_linkConnectionTypes(L,r){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[r]._acceptedConnectionPointType=this._inputs[L]:(this._inputs[L]._linkedConnectionSource=this._inputs[r],this._inputs[L]._isMainLinkSource=!0),this._inputs[r]._linkedConnectionSource=this._inputs[L]}registerInput(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;const j=new kr(L,this,0);return j.type=r,j.isOptional=p,j.defaultValue=J,j.value=J,j.valueMin=i,j.valueMax=n,this._inputs.push(j),this.onInputChangedObservable.notifyObservers(j),this}registerOutput(L,r,p){return(p=p??new kr(L,this,1)).type=r,this._outputs.push(p),this}_build(L){}_customBuildStep(L){}build(L){if(this._buildId===L.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((L=>L.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=L.buildId;for(const r of this._inputs){if(!r.connectedPoint){r.isOptional||L.notConnectedNonOptionalInputs.push(r);continue}const p=r.connectedPoint.ownerBlock;p&&p!==this&&!p.isSystem&&p.build(L)}return this._customBuildStep(L),L.verbose&&l.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(L),this.onBuildObservable.notifyObservers(this),!1}serialize(){const L={};L.customType="BABYLON."+this.getClassName(),L.id=this.uniqueId,L.name=this.name,L.visibleOnFrame=this.visibleOnFrame,L.inputs=[],L.outputs=[];for(const r of this.inputs)L.inputs.push(r.serialize());for(const r of this.outputs)L.outputs.push(r.serialize(!1));return L}_deserialize(L){this._name=L.name,this.comments=L.comments,this.visibleOnFrame=!!L.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(L)}_deserializePortDisplayNamesAndExposedOnFrame(L){const r=L.inputs,p=L.outputs;if(r)for(const J of r){const L=this.inputs.find((L=>L.name===J.name));if(!L)return;if(J.displayName&&(L.displayName=J.displayName),J.isExposedOnFrame&&(L.isExposedOnFrame=J.isExposedOnFrame,L.exposedPortPosition=J.exposedPortPosition),void 0!==J.value&&null!==J.value)if("number"===J.valueType)L.value=J.value;else{const r=(0,z.c)(J.valueType);r&&(L.value=r.Br(J.value))}}if(p)for(let J=0;J<p.length;J++){const L=p[J];L.displayName&&(this.outputs[J].displayName=L.displayName),L.isExposedOnFrame&&(this.outputs[J].isExposedOnFrame=L.isExposedOnFrame,this.outputs[J].exposedPortPosition=L.exposedPortPosition)}}clone(){const L=this.serialize(),r=(0,z.c)(L.customType);if(r){const p=new r;return p._deserialize(L),p}return null}dispose(){this.ji.notifyObservers(this),this.ji.clear();for(const L of this.inputs)L.dispose();for(const L of this.outputs)L.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Ir(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",J=arguments.length>3?arguments[3]:void 0;return(i,n)=>{let j=i._propStore;j||(j=[],i._propStore=j),j.push({propertyName:n,displayName:L,type:r,groupName:p,options:J??{},className:i.getClassName()})}}(0,a.e)([(0,q.E)("comment")],Rr.prototype,"comments",void 0),function(L){L[L.Boolean=0]="Boolean",L[L.Float=1]="Float",L[L.Int=2]="Int",L[L.Vector2=3]="Vector2",L[L.List=4]="List",L[L.Fz=5]="Fz",L[L.SamplingMode=6]="SamplingMode",L[L.TextureFormat=7]="TextureFormat",L[L.TextureType=8]="TextureType"}(Mr||(Mr={})),function(L){L[L.None=0]="None",L[L.Position=1]="Position",L[L.Direction=2]="Direction",L[L.Age=3]="Age",L[L.Lifetime=4]="Lifetime",L[L.Color=5]="Color",L[L.ScaledDirection=6]="ScaledDirection",L[L.Scale=7]="Scale",L[L.AgeGradient=8]="AgeGradient",L[L.Angle=9]="Angle",L[L.SpriteCellIndex=16]="SpriteCellIndex",L[L.SpriteCellStart=17]="SpriteCellStart",L[L.SpriteCellEnd=18]="SpriteCellEnd"}(fr||(fr={})),function(L){L[L.None=0]="None",L[L.Time=1]="Time",L[L.Delta=2]="Delta",L[L.Emitter=3]="Emitter"}(dr||(dr={}));class Nr{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let L="";for(const r of this.notConnectedNonOptionalInputs)L+=`input ${r.name} from block ${r.ownerBlock.name}[${r.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(L)throw"Build of Node Particle System Set failed:\n"+L}adapt(L,r){const p=L.getConnectedValue(this)||0;if(L.type===r)return p;switch(r){case lr.Vector2:return new J.Vector2(p,p);case lr.cr:return new J.cr(p,p,p);case lr.Fz:return new j.Fz(p,p,p,p)}return null}getContextualValue(L){if(!this.particleContext||!this.systemContext)return null;switch(L){case fr.Position:return this.particleContext.position;case fr.Direction:return this.particleContext.direction;case fr.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case fr.Color:return this.particleContext.color;case fr.Age:return this.particleContext.age;case fr.Lifetime:return this.particleContext.lifeTime;case fr.Angle:return this.particleContext.angle;case fr.Scale:return this.particleContext.scale;case fr.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case fr.SpriteCellEnd:return this.systemContext.endSpriteCellID;case fr.SpriteCellIndex:return this.particleContext.cellIndex;case fr.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Jr.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Jr.absolutePosition:this.systemContext.Jr:null}getSystemValue(L){if(!this.particleContext||!this.systemContext)return null;switch(L){case dr.Time:return this.systemContext._actualFrame;case dr.Delta:return this.systemContext._scaledUpdateSpeed;case dr.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Jr.absolutePosition}return this.systemContext.Jr}return null}}function Kr(L,r,p){const J=new Nr;J.Or=r;const i=L.createSystem(J);return i.canStart=()=>!0,i.Jr=p.clone(),i.disposeOnStop=!0,i.start(),i}class mp extends Rr{constructor(L){super(L),this.blendMode=G.BLENDMODE_ONEONE,this.Mr=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",lr.Particle),this.registerInput("texture",lr.Texture),this.registerInput("onStart",lr.System,!0),this.registerInput("onEnd",lr.System,!0),this.registerOutput("system",lr.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(L){L.Mr=this.Mr,L.buildId=this._buildId++,this.build(L);const r=this.particle.getConnectedValue(L);return r.particleTexture=this.texture.getConnectedValue(L),r.emitRate=this.emitRate,r.blendMode=this.blendMode,r.name=this.name,r._nodeGenerated=!0,r._targetStopDuration=this.targetStopDuration,r.startDelay=this.startDelay,this.system._storedValue=this,r.canStart=()=>!this.doNoStart,r.onStartedObservable.add((p=>{const J=this.onStart.getConnectedValue(L);J&&p.onStartedObservable.addOnce((()=>{L.systemContext=r;const p=Kr(J,L.Or,L.emitterPosition);this.ji.addOnce((()=>{p.dispose()}))}));const i=this.onEnd.getConnectedValue(L);i&&p.onStoppedObservable.addOnce((()=>{L.systemContext=r;const p=Kr(i,L.Or,L.emitterPosition);this.ji.addOnce((()=>{p.dispose()}))}))})),this.ji.addOnce((()=>{r.dispose()})),r}serialize(){const L=super.serialize();return L.Mr=this.Mr,L.emitRate=this.emitRate,L.blendMode=this.blendMode,L.doNoStart=this.doNoStart,L.targetStopDuration=this.targetStopDuration,L.startDelay=this.startDelay,L}_deserialize(L){super._deserialize(L),this.Mr=L.Mr,this.emitRate=L.emitRate,this.doNoStart=!!L.doNoStart,void 0!==L.blendMode&&(this.blendMode=L.blendMode),void 0!==L.targetStopDuration&&(this.targetStopDuration=L.targetStopDuration),void 0!==L.startDelay&&(this.startDelay=L.startDelay)}}(0,a.e)([Ir("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:G.BLENDMODE_ONEONE},{label:"Standard",value:G.BLENDMODE_STANDARD},{label:"Add",value:G.BLENDMODE_ADD},{label:"Multiply",value:G.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:G.BLENDMODE_MULTIPLYADD}]})],mp.prototype,"blendMode",void 0),(0,a.e)([Ir("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],mp.prototype,"Mr",void 0),(0,a.e)([Ir("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mp.prototype,"emitRate",void 0),(0,a.e)([Ir("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mp.prototype,"targetStopDuration",void 0),(0,a.e)([Ir("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mp.prototype,"startDelay",void 0),(0,a.e)([Ir("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],mp.prototype,"doNoStart",void 0),(0,z.e)("BABYLON.SystemBlock",mp);class Vr extends Rr{get type(){if(this._type===lr.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=lr.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=lr.Vector2,this._type;case"cr":return this._type=lr.cr,this._type;case"Fz":return this._type=lr.Fz,this._type;case"Matrix":return this._type=lr.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===fr.None&&this._systemSource!==dr.None}get systemSource(){return this._systemSource}set systemSource(L){if(this._systemSource=L,L!==dr.None){switch(this._contextualSource=fr.None,this._type=lr.Float,L){case dr.Time:case dr.Delta:this._type=lr.Float;break;case dr.Emitter:this._type=lr.cr}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==fr.None}get contextualValue(){return this._contextualSource}set contextualValue(L){if(this._contextualSource=L,L!==fr.None){switch(this._systemSource=dr.None,L){case fr.Scale:this._type=lr.Vector2;break;case fr.Position:case fr.Direction:case fr.ScaledDirection:this._type=lr.cr;break;case fr.Color:this._type=lr.Fz;break;case fr.Age:case fr.Lifetime:case fr.Angle:case fr.AgeGradient:this._type=lr.Float;break;case fr.SpriteCellEnd:case fr.SpriteCellStart:case fr.SpriteCellIndex:this._type=lr.Int}this.output&&(this.output.type=this._type)}}constructor(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lr.AutoDetect;super(L),this._type=lr.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new K.c,this._systemSource=dr.None,this._contextualSource=fr.None,this._type=r,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",r)}get value(){return this._storedValue}set value(L){this.type===lr.Float&&this.min!==this.max&&(L=Math.max(this.min,L),L=Math.min(this.max,L)),this._storedValue=L,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(L){this._valueCallback=L}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case lr.Int:case lr.Float:this.value=0;break;case lr.Vector2:this.value=J.Vector2.Zero();break;case lr.cr:this.value=J.cr.Zero();break;case lr.Fz:this.value=new j.Fz(1,1,1,1);break;case lr.Matrix:this.value=J.Matrix.Identity()}}_build(L){super._build(L),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=L=>L.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=L=>L.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const L=super.serialize();return L.type=this.type,L.contextualValue=this.contextualValue,L.systemSource=this.systemSource,L.min=this.min,L.max=this.max,L.groupInInspector=this.groupInInspector,L.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.mz?(L.valueType="BABYLON."+this._storedValue.getClassName(),L.value=this._storedValue.mz()):(L.valueType="number",L.value=this._storedValue)),L}_deserialize(L){if(super._deserialize(L),this._type=L.type,this.contextualValue=L.contextualValue,this.systemSource=L.systemSource||dr.None,this.min=L.min||0,this.max=L.max||0,this.groupInInspector=L.groupInInspector||"",void 0!==L.displayInInspector&&(this.displayInInspector=L.displayInInspector),L.valueType)if("number"===L.valueType)this._storedValue=L.value;else{const r=(0,z.c)(L.valueType);r&&(this._storedValue=r.Br(L.value))}}}(0,z.e)("BABYLON.ParticleInputBlock",Vr);class Sr extends Rr{get url(){return this._url}set url(L){this._url!==L&&(this._cachedData=null,this._url=L,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(L){this._textureDataUrl!==L&&(this._cachedData=null,this._textureDataUrl=L,this._url="",this._sourceTexture=null)}set sourceTexture(L){this._sourceTexture!==L&&(this._cachedData=null,this._sourceTexture=L,this._url="",this._textureDataUrl="")}constructor(L){super(L),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",lr.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const L=this.texture._storedValue;return await new Promise(((r,p)=>{if(!L.isReady())return void L.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),r(this._cachedData)}catch(L){p(L)}}));const J=L.getSize();ar.l.GetTextureDataAsync(L,J.width,J.height).then((p=>{this._cachedData={width:J.width,height:J.height,data:new Uint8ClampedArray(p)},L.dispose(),r(this._cachedData)})).catch(p)}))}_build(L){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new X.c(this._textureDataUrl,L.Or):this.texture._storedValue=new X.c(this._url,L.Or):this.texture._storedValue=null}serialize(){const L=super.serialize();return L.url=this.url,L.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(L.textureDataUrl=this.textureDataUrl),L}_deserialize(L){super._deserialize(L),this.url=L.url,this.serializedCachedData=!!L.serializedCachedData,L.textureDataUrl&&(this.textureDataUrl=L.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,z.e)("BABYLON.ParticleTextureSourceBlock",Sr);class Lp extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("position",lr.cr),this.registerOutput("output",lr.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(L){const r=this.particle.getConnectedValue(L);if(this.output._storedValue=r,!this.position.isConnected)return;const p={process:p=>{L.particleContext=p,L.systemContext=r,p.position.G(this.position.getConnectedValue(L))},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p}}(0,z.e)("BABYLON.UpdatePositionBlock",Lp),function(L){L[L.Add=0]="Add",L[L.Subtract=1]="Subtract",L[L.Multiply=2]="Multiply",L[L.Divide=3]="Divide",L[L.Max=4]="Max",L[L.Min=5]="Min"}(sr||(sr={}));class rp extends Rr{constructor(L){super(L),this.operation=sr.Add,this.registerInput("left",lr.AutoDetect),this.registerInput("right",lr.AutoDetect),this.registerOutput("output",lr.BasedOnInput),this.output._typeConnectionSource=this.left;const r=[lr.Matrix,lr.Particle,lr.Texture,lr.System,lr.FloatGradient,lr.Color4Gradient,lr.Vector2Gradient,lr.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...r),this.right.excludedConnectionPointTypes.push(...r),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(L){let r;const p=this.left,i=this.right;if(!p.isConnected||!i.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const n=p.type===lr.Float||p.type===lr.Int,z=i.type===lr.Float||i.type===lr.Int,G=n&&z;switch(this.operation){case sr.Add:r=G?L=>p.getConnectedValue(L)+i.getConnectedValue(L):n?L=>L.adapt(p,i.type).add(i.getConnectedValue(L)):L=>p.getConnectedValue(L).add(L.adapt(i,p.type));break;case sr.Subtract:r=G?L=>p.getConnectedValue(L)-i.getConnectedValue(L):n?L=>L.adapt(p,i.type).Pr(i.getConnectedValue(L)):L=>p.getConnectedValue(L).Pr(L.adapt(i,p.type));break;case sr.Multiply:r=G?L=>p.getConnectedValue(L)*i.getConnectedValue(L):n?L=>L.adapt(p,i.type).multiply(i.getConnectedValue(L)):L=>p.getConnectedValue(L).multiply(L.adapt(i,p.type));break;case sr.Divide:r=G?L=>p.getConnectedValue(L)/i.getConnectedValue(L):n?L=>L.adapt(p,i.type).divide(i.getConnectedValue(L)):L=>p.getConnectedValue(L).divide(L.adapt(i,p.type));break;case sr.Min:if(G)r=L=>Math.min(p.getConnectedValue(L),i.getConnectedValue(L));else{const[L,z]=n?[i,p]:[p,i];switch(L.type){case lr.Vector2:r=r=>J.Vector2.Minimize(L.getConnectedValue(r),r.adapt(z,L.type));break;case lr.cr:r=r=>J.cr.Minimize(L.getConnectedValue(r),r.adapt(z,L.type));break;case lr.Fz:r=r=>{const p=L.getConnectedValue(r),{r:J,g:i,b:n,a:G}=r.adapt(z,L.type);return new j.Fz(Math.min(p.r,J),Math.min(p.g,i),Math.min(p.b,n),Math.min(p.a,G))}}}break;case sr.Max:if(!G){const[L,z]=n?[i,p]:[p,i];switch(L.type){case lr.Vector2:r=r=>J.Vector2.Maximize(L.getConnectedValue(r),r.adapt(z,L.type));break;case lr.cr:r=r=>J.cr.Maximize(L.getConnectedValue(r),r.adapt(z,L.type));break;case lr.Fz:r=r=>{const p=L.getConnectedValue(r),{r:J,g:i,b:n,a:G}=r.adapt(z,L.type);return new j.Fz(Math.max(p.r,J),Math.min(p.g,i),Math.min(p.b,n),Math.min(p.a,G))}}break}r=L=>Math.max(p.getConnectedValue(L),i.getConnectedValue(L))}this.output._storedFunction=L=>p.type===lr.Int?0|r(L):r(L)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===lr.Int||this.left.type===lr.Float&&this.right.type!==lr.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[L,r]of[[this.left,this.right],[this.right,this.left]])L.acceptedConnectionPointTypes=[lr.Int,lr.Float],r.isConnected&&(L.acceptedConnectionPointTypes.push(r.type),r.type!==lr.Int&&r.type!==lr.Float||L.acceptedConnectionPointTypes.push(lr.Vector2,lr.cr,lr.Fz))}dispose(){super.dispose();for(const L of this._connectionObservers)L.remove();this._connectionObservers.length=0}serialize(){const L=super.serialize();return L.operation=this.operation,L}_deserialize(L){super._deserialize(L),this.operation=L.operation}}(0,a.e)([Ir("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:sr.Add},{label:"Subtract",value:sr.Subtract},{label:"Multiply",value:sr.Multiply},{label:"Divide",value:sr.Divide},{label:"Max",value:sr.Max},{label:"Min",value:sr.Min}]})],rp.prototype,"operation",void 0),(0,z.e)("BABYLON.ParticleMathBlock",rp);class pp extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("direction1",lr.cr,!0,new J.cr(0,1,0)),this.registerInput("direction2",lr.cr,!0,new J.cr(0,1,0)),this.registerInput("minEmitBox",lr.cr,!0,new J.cr(-.5,-.5,-.5)),this.registerInput("maxEmitBox",lr.cr,!0,new J.cr(.5,.5,.5)),this.registerOutput("output",lr.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(L){const r=this.particle.getConnectedValue(L);r._directionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.direction1.getConnectedValue(L),n=this.direction2.getConnectedValue(L),j=(0,C.RandomRange)(i.x,n.x),z=(0,C.RandomRange)(i.y,n.y),G=(0,C.RandomRange)(i.z,n.z);L.isEmitterTransformNode?J.cr.TransformNormalFromFloatsToRef(j,z,G,L.emitterWorldMatrix,p.direction):p.direction.Uz(j,z,G)},r._positionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.minEmitBox.getConnectedValue(L),n=this.maxEmitBox.getConnectedValue(L),j=(0,C.RandomRange)(i.x,n.x),z=(0,C.RandomRange)(i.y,n.y),G=(0,C.RandomRange)(i.z,n.z);L.isEmitterTransformNode?J.cr.TransformCoordinatesFromFloatsToRef(j,z,G,L.emitterWorldMatrix,p.position):(p.position.Uz(j,z,G),p.position.addInPlace(L.emitterPosition))},this.output._storedValue=r}}(0,z.e)("BABYLON.BoxShapeBlock",pp);class Jp extends Rr{constructor(L){super(L),this.registerInput("emitPower",lr.Float,!0,1),this.registerInput("lifeTime",lr.Float,!0,1),this.registerInput("color",lr.Fz,!0,new j.Fz(1,1,1,1)),this.registerInput("scale",lr.Vector2,!0,new J.Vector2(1,1)),this.registerInput("angle",lr.Float,!0,0),this.registerOutput("particle",lr.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(L){const r=new zr(this.name,L.Mr,L.Or,null,!1,void 0,!0);r.particleEmitterType=new P,r._lifeTimeCreation.process=(r,p)=>{L.particleContext=r,r.lifeTime=this.lifeTime.getConnectedValue(L),p._emitPower=this.emitPower.getConnectedValue(L)},r._colorCreation.process=r=>{L.particleContext=r,r.color.G(this.color.getConnectedValue(L))},r._sizeCreation.process=r=>{L.particleContext=r,r.size=1,r.scale.G(this.scale.getConnectedValue(L))},r._angleCreation.process=r=>{L.particleContext=r,r.angle=this.angle.getConnectedValue(L)},this.particle._storedValue=r}}(0,z.e)("BABYLON.CreateParticleBlock",Jp);class ip{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const L=[];for(const r of this.attachedBlocks)r.isInput&&L.push(r);return L}constructor(L){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new K.c,this.name=L}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(L){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(L)&&this.attachedBlocks.push(L);for(const p of L.inputs){const J=p.connectedPoint;if(J){const p=J.ownerBlock;p!==L&&this._initializeBlock(p,r)}}}async buildAsync(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((p=>{const J=new Fr;for(const L of this._systemBlocks)this._initializeBlock(L);for(const i of this.systemBlocks){const p=new Nr;p.buildId=this._buildId++,p.Or=L,p.verbose=r;const n=i.createSystem(p);p.emitErrors(),J.systems.push(n)}this.onBuildObservable.notifyObservers(this),p(J)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const L=new mp("Particle system"),r=new Lp("Update position");r.output.connectTo(L.particle);const p=new Vr("Position");p.contextualValue=fr.Position;const J=new Vr("Scaled direction");J.contextualValue=fr.ScaledDirection;const i=new rp("Add");i.operation=sr.Add,p.output.connectTo(i.left),J.output.connectTo(i.right),i.output.connectTo(r.position);const n=new Jp("Create particle"),j=new pp("Box shape");n.particle.connectTo(j.particle),j.output.connectTo(r.particle);const z=new Sr("Texture");z.texture.connectTo(L.texture),z.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(L)}removeBlock(L){const r=this.attachedBlocks.indexOf(L);if(r>-1&&this.attachedBlocks.splice(r,1),L.isSystem){const r=this._systemBlocks.indexOf(L);r>-1&&this._systemBlocks.splice(r,1)}}parseSerializedObject(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r||this.clear();const p={};for(const J of L.Pt){const L=(0,z.c)(J.customType);if(L){const r=new L;r._deserialize(J),p[J.id]=r,this.attachedBlocks.push(r),r.isSystem&&this._systemBlocks.push(r)}}for(const J of this.attachedBlocks)if(J.isTeleportOut){const L=J,r=L._tempEntryPointUniqueId;if(r){const J=p[r];J&&J.attachToEndpoint(L)}}for(let J=0;J<L.Pt.length;J++){const i=L.Pt[J],n=p[i.id];n&&(n.inputs.length&&i.inputs.some((L=>L.targetConnectionName))&&!r||this._restoreConnections(n,L,p))}if(L.locations||L.editorData&&L.editorData.locations){const J=L.locations||L.editorData.locations;for(const L of J)p[L.Fi]&&(L.Fi=p[L.Fi].uniqueId);r&&this.editorData&&this.editorData.locations&&J.concat(this.editorData.locations),L.locations?this.editorData={locations:J}:(this.editorData=L.editorData,this.editorData.locations=J);const i=[];for(const L in p)i[L]=p[L].uniqueId;this.editorData.map=i}this.comment=L.comment}_restoreConnections(L,r,p){for(const J of L.outputs)for(const i of r.Pt){const n=p[i.id];if(n)for(const j of i.inputs)if(p[j.targetBlockId]!==L||j.targetConnectionName!==J.name);else{const L=n.getInputByName(j.inputName);if(!L||L.isConnected)continue;J.connectTo(L,!0),this._restoreConnections(n,r,p)}}}serialize(L){const r=L?{}:Z.c.Serialize(this);r.editorData=JSON.parse(JSON.stringify(this.editorData));let p=[];L?p=L:r.customType="BABYLON.NodeParticleSystemSet",r.Pt=[];for(const J of p)r.Pt.push(J.serialize());if(!L)for(const J of this.attachedBlocks)-1===p.indexOf(J)&&r.Pt.push(J.serialize());return r}dispose(){for(const L of this.attachedBlocks)L.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(L){const r=new ip(L);return r.setToDefault(),r}static Parse(L){const r=Z.c.Parse((()=>new ip(L.name)),L,null);return r.parseSerializedObject(L),r}static ParseFromSnippetAsync(L,r){return"_BLANK"===L?Promise.resolve(ip.CreateDefault("blank")):new Promise(((p,J)=>{const i=new Qr.b;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){const j=JSON.parse(JSON.parse(i.responseText).jsonPayload),z=JSON.parse(j.nodeParticle);r||(r=Z.c.Parse((()=>new ip(L)),z,null)),r.parseSerializedObject(z),r.snippetId=L;try{p(r)}catch(n){J(n)}}else J("Unable to load the snippet "+L)})),i.open("GET",this.SnippetUrl+"/"+L.replace(/#/g,"/")),i.send()}))}}ip.EditorURL=`${Ur.Tools._DefaultCdnUrl}/v${IL.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,ip.SnippetUrl="https://snippet.babylonjs.com",(0,a.e)([(0,q.E)()],ip.prototype,"name",void 0),(0,a.e)([(0,q.E)("comment")],ip.prototype,"comment",void 0),function(L){L[L.None=0]="None",L[L.PerParticle=1]="PerParticle",L[L.PerSystem=2]="PerSystem"}(Hr||(Hr={}));class np extends Rr{constructor(L){super(L),this._currentLockId=-2,this.lockMode=Hr.PerParticle,this.registerInput("min",lr.AutoDetect,!0,0),this.registerInput("max",lr.AutoDetect,!0,1),this.registerOutput("output",lr.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lr.Float|lr.Int|lr.Vector2|lr.cr|lr.Fz),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lr.Float|lr.Int|lr.Vector2|lr.cr|lr.Fz),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=lr.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let L=null;switch(this._currentLockId=-2,this.min.type){case lr.AutoDetect:case lr.Int:case lr.Float:L=L=>{const r=this.min.getConnectedValue(L)||0,p=this.max.getConnectedValue(L)||1;return r+Math.random()*(p-r)};break;case lr.Vector2:L=L=>{const r=this.min.getConnectedValue(L)||J.Vector2.Zero(),p=this.max.getConnectedValue(L)||J.Vector2.One();return new J.Vector2(r.x+Math.random()*(p.x-r.x),r.y+Math.random()*(p.y-r.y))};break;case lr.cr:L=L=>{const r=this.min.getConnectedValue(L)||J.cr.Zero(),p=this.max.getConnectedValue(L)||J.cr.One();return new J.cr(r.x+Math.random()*(p.x-r.x),r.y+Math.random()*(p.y-r.y),r.z+Math.random()*(p.z-r.z))};break;case lr.Fz:L=L=>{const r=this.min.getConnectedValue(L)||new j.Fz(0,0,0,0),p=this.max.getConnectedValue(L)||new j.Fz(1,1,1,1);return new j.Fz(r.x+Math.random()*(p.x-r.x),r.y+Math.random()*(p.y-r.y),r.z+Math.random()*(p.z-r.z),r.w+Math.random()*(p.w-r.w))}}this.output._storedFunction=r=>{var p;let J=0;switch(this.lockMode){case Hr.PerParticle:J=(null===(p=r.particleContext)||void 0===p?void 0:p.id)||-1;break;case Hr.PerSystem:J=r.buildId||0}return this._currentLockId!==J&&(this.lockMode!==Hr.None&&(this._currentLockId=J),this.output._storedValue=L(r)),this.output._storedValue}}serialize(){const L=super.serialize();return L.lockMode=this.lockMode,L}_deserialize(L){super._deserialize(L),this.lockMode=L.lockMode}}(0,a.e)([Ir("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Hr.None},{label:"Per particle",value:Hr.PerParticle},{label:"Per system",value:Hr.PerSystem}]})],np.prototype,"lockMode",void 0),(0,z.e)("BABYLON.ParticleRandomBlock",np);class jp extends Rr{constructor(L){super(L),this._currentLockId=-2,this.lockMode=Hr.PerParticle,this.registerInput("min",lr.AutoDetect),this.registerInput("max",lr.AutoDetect),this.registerOutput("output",lr.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const r=[lr.Matrix,lr.Particle,lr.Texture,lr.System,lr.FloatGradient,lr.Color4Gradient,lr.Vector2Gradient,lr.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...r),this.max.excludedConnectionPointTypes.push(...r)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let L=null;switch(this._currentLockId=-2,this.min.type){case lr.Float:case lr.Int:L=L=>{const r=this.min.getConnectedValue(L),p=this.max.getConnectedValue(L);return Math.random()*(p-r)+r};break;case lr.Vector2:L=L=>{const r=this.min.getConnectedValue(L),p=this.max.getConnectedValue(L);return new J.Vector2(Math.random()*(p.x-r.x)+r.x,Math.random()*(p.y-r.y)+r.y)};break;case lr.cr:L=L=>{const r=this.min.getConnectedValue(L),p=this.max.getConnectedValue(L);return new J.cr(Math.random()*(p.x-r.x)+r.x,Math.random()*(p.y-r.y)+r.y,Math.random()*(p.z-r.z)+r.z)};break;case lr.Fz:L=L=>{const r=this.min.getConnectedValue(L),p=this.max.getConnectedValue(L);return new j.Fz(Math.random()*(p.r-r.r)+r.r,Math.random()*(p.g-r.g)+r.g,Math.random()*(p.b-r.b)+r.b,Math.random()*(p.a-r.a)+r.a)}}this.output._storedFunction=r=>{var p;let J=0;switch(this.lockMode){case Hr.PerParticle:J=(null===(p=r.particleContext)||void 0===p?void 0:p.id)||-1;break;case Hr.PerSystem:J=r.buildId||0}return this._currentLockId!==J&&(this.lockMode!==Hr.None&&(this._currentLockId=J),this.output._storedValue=L(r)),this.output._storedValue}}serialize(){const L=super.serialize();return L.lockMode=this.lockMode,L}_deserialize(L){super._deserialize(L),void 0!==L.lockMode&&(this.lockMode=L.lockMode)}}(0,a.e)([Ir("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Hr.None},{label:"Per particle",value:Hr.PerParticle},{label:"Per system",value:Hr.PerSystem}]})],jp.prototype,"lockMode",void 0),(0,z.e)("BABYLON.RandomRangeBlock",jp);(0,z.e)("BABYLON.ParticleLerpBlock",class extends Rr{constructor(L){super(L),this.registerInput("left",lr.AutoDetect),this.registerInput("right",lr.AutoDetect),this.registerInput("gradient",lr.Float,!0,0,0,1),this.registerOutput("output",lr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lr.Float|lr.Int|lr.Vector2|lr.cr|lr.Fz)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const L=(L,r,p)=>(1-L)*r+L*p;this.output._storedFunction=r=>{const p=this.left.getConnectedValue(r),i=this.right.getConnectedValue(r),n=this.gradient.getConnectedValue(r);switch(this.left.type){case lr.Int:case lr.Float:return L(n,p,i);case lr.Vector2:return new J.Vector2(L(n,p.x,i.x),L(n,p.y,i.y));case lr.cr:return new J.cr(L(n,p.x,i.x),L(n,p.y,i.y),L(n,p.z,i.z));case lr.Fz:return new j.Fz(L(n,p.r,i.r),L(n,p.g,i.g),L(n,p.b,i.b),L(n,p.a,i.a))}return 0}}});(0,z.e)("BABYLON.UpdateDirectionBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("direction",lr.cr),this.registerOutput("output",lr.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(L){const r=this.particle.getConnectedValue(L);if(this.output._storedValue=r,!this.direction.isConnected)return;const p={process:p=>{L.particleContext=p,L.systemContext=r,p.direction.G(this.direction.getConnectedValue(L))},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p}});(0,z.e)("BABYLON.UpdateColorBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("color",lr.Fz),this.registerOutput("output",lr.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(L){const r=this.particle.getConnectedValue(L);if(this.output._storedValue=r,!this.color.isConnected)return;const p={process:p=>{L.particleContext=p,L.systemContext=r,p.color.G(this.color.getConnectedValue(L))},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p}});(0,z.e)("BABYLON.UpdateScaleBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("scale",lr.Vector2),this.registerOutput("output",lr.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(L){const r=this.particle.getConnectedValue(L);if(this.output._storedValue=r,!this.scale.isConnected)return;const p={process:p=>{L.particleContext=p,L.systemContext=r,p.scale.G(this.scale.getConnectedValue(L))},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p}});(0,z.e)("BABYLON.UpdateAngleBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("angle",lr.Float),this.registerOutput("output",lr.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(L){const r=this.particle.getConnectedValue(L);if(this.output._storedValue=r,!this.angle.isConnected)return;const p={process:p=>{L.particleContext=p,L.systemContext=r,p.angle=this.angle.getConnectedValue(L)},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p}});(0,z.e)("BABYLON.BasicPositionUpdateBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerOutput("output",lr.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(L){const r=this.particle.getConnectedValue(L),p={process:p=>{L.particleContext=p,L.systemContext=r,p.direction.scaleToRef(r._directionScale,r._scaledDirection),p.position.addInPlace(r._scaledDirection)},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p,this.output._storedValue=r}});(0,z.e)("BABYLON.BasicSpriteUpdateBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerOutput("output",lr.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(L){const r=this.particle.getConnectedValue(L),p={process:p=>{L.particleContext=p,L.systemContext=r,p.updateCellIndex()},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p,this.output._storedValue=r}});(0,z.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("cellIndex",lr.Int),this.registerOutput("output",lr.Particle),this.cellIndex.acceptedConnectionPointTypes=[lr.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(L){const r=this.particle.getConnectedValue(L);if(this.output._storedValue=r,!this.cellIndex.isConnected)return;const p={process:p=>{L.particleContext=p,L.systemContext=r,p.cellIndex=Math.floor(this.cellIndex.getConnectedValue(L))},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p}});class zp extends Rr{constructor(L){super(L),this.strength=1,this.registerInput("particle",lr.Particle),this.registerInput("flowMap",lr.Texture),this.registerOutput("output",lr.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(L){var r;const p=this.particle.getConnectedValue(L),J=L.Or;let i;(null===(r=this.flowMap.connectedPoint)||void 0===r?void 0:r.ownerBlock).extractTextureContentAsync().then((L=>{L&&(i=new Dr(L.width,L.height,L.data))}));const n={process:L=>{const r=J.getTransformMatrix();i&&i._processParticle(L,this.strength*p._tempScaledUpdateSpeed,r)},previousItem:null,nextItem:null};p._updateQueueStart?dL(n,p._updateQueueStart):p._updateQueueStart=n,this.output._storedValue=p}serialize(){const L=super.serialize();return L.strength=this.strength,L}_deserialize(L){super._deserialize(L),this.strength=L.strength}}(0,a.e)([Ir("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zp.prototype,"strength",void 0),(0,z.e)("BABYLON.UpdateFlowMapBlock",zp);(0,z.e)("BABYLON.SphereShapeBlock",class extends Rr{constructor(L){super(L),this.registerInput("input",lr.Particle),this.registerInput("radius",lr.Float,!0,1),this.registerInput("radiusRange",lr.Float,!0,1,0,1),this.registerInput("directionRandomizer",lr.Float,!0,0,0,1),this.registerOutput("output",lr.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(L){const r=this.input.getConnectedValue(L);r._directionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.directionRandomizer.getConnectedValue(L),n=p.position.Pr(L.emitterPosition).normalize(),j=(0,C.RandomRange)(0,i),z=(0,C.RandomRange)(0,i),G=(0,C.RandomRange)(0,i);n.x+=j,n.y+=z,n.z+=G,n.normalize(),L.isEmitterTransformNode?J.cr.TransformNormalFromFloatsToRef(j,z,G,L.emitterWorldMatrix,p.direction):p.direction.Uz(j,z,G)},r._positionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.radius.getConnectedValue(L),n=this.radiusRange.getConnectedValue(L),j=i-(0,C.RandomRange)(0,i*n),z=(0,C.RandomRange)(0,1),G=(0,C.RandomRange)(0,2*Math.PI),t=Math.acos(2*z-1),E=j*Math.cos(G)*Math.sin(t),x=j*Math.cos(t),w=j*Math.sin(G)*Math.sin(t);L.isEmitterTransformNode?J.cr.TransformCoordinatesFromFloatsToRef(E,x,w,L.emitterWorldMatrix,p.position):(p.position.Uz(E,x,w),p.position.addInPlace(L.emitterPosition))},this.output._storedValue=r}});(0,z.e)("BABYLON.PointShapeBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("direction1",lr.cr,!0,new J.cr(0,1,0)),this.registerInput("direction2",lr.cr,!0,new J.cr(0,1,0)),this.registerOutput("output",lr.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){const r=this.particle.getConnectedValue(L);r._directionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.direction1.getConnectedValue(L),n=this.direction2.getConnectedValue(L),j=(0,C.RandomRange)(i.x,n.x),z=(0,C.RandomRange)(i.y,n.y),G=(0,C.RandomRange)(i.z,n.z);L.isEmitterTransformNode?J.cr.TransformNormalFromFloatsToRef(j,z,G,L.emitterWorldMatrix,p.direction):p.direction.Uz(j,z,G)},r._positionCreation.process=p=>{L.systemContext=r,L.isEmitterTransformNode?J.cr.TransformCoordinatesFromFloatsToRef(0,0,0,L.emitterWorldMatrix,p.position):p.position.G(L.emitterPosition)},this.output._storedValue=r}});(0,z.e)("BABYLON.CustomShapeBlock",class extends Rr{constructor(L){super(L),this.registerInput("particle",lr.Particle),this.registerInput("position",lr.cr,!0,new J.cr(0,0,0)),this.registerInput("direction",lr.cr,!0,new J.cr(0,1,0)),this.registerOutput("output",lr.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){const r=this.particle.getConnectedValue(L);r._directionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.direction.getConnectedValue(L);L.isEmitterTransformNode?J.cr.TransformNormalToRef(i,L.emitterWorldMatrix,p.direction):p.direction.G(i)},r._positionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.position.getConnectedValue(L);L.isEmitterTransformNode?J.cr.TransformCoordinatesToRef(i,L.emitterWorldMatrix,p.position):(p.position.G(i),p.position.addInPlace(L.emitterPosition))},this.output._storedValue=r}});(0,z.e)("BABYLON.CylinderShapeBlock",class extends Rr{constructor(L){super(L),this._tempVector=J.cr.Zero(),this.registerInput("particle",lr.Particle),this.registerInput("radius",lr.Float,!0,1),this.registerInput("height",lr.Float,!0,1,0),this.registerInput("radiusRange",lr.Float,!0,1,0,1),this.registerInput("directionRandomizer",lr.Float,!0,0,0,1),this.registerOutput("output",lr.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(L){const r=this.particle.getConnectedValue(L);r._directionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.directionRandomizer.getConnectedValue(L);p.position.subtractToRef(L.emitterPosition,this._tempVector),this._tempVector.normalize(),L.isEmitterTransformNode&&J.cr.TransformNormalToRef(this._tempVector,L.emitterInverseWorldMatrix,this._tempVector);const n=(0,C.RandomRange)(-i/2,i/2);let j=Math.atan2(this._tempVector.x,this._tempVector.z);j+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*i,this._tempVector.y=n,this._tempVector.x=Math.sin(j),this._tempVector.z=Math.cos(j),this._tempVector.normalize(),L.isEmitterTransformNode?J.cr.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,L.emitterWorldMatrix,p.direction):p.direction.G(this._tempVector)},r._positionCreation.process=p=>{L.particleContext=p,L.systemContext=r;const i=this.height.getConnectedValue(L),n=this.radiusRange.getConnectedValue(L),j=this.radius.getConnectedValue(L),z=(0,C.RandomRange)(-i/2,i/2),G=(0,C.RandomRange)(0,2*Math.PI),t=(0,C.RandomRange)((1-n)*(1-n),1),E=Math.sqrt(t)*j,x=E*Math.cos(G),w=E*Math.sin(G);L.isEmitterTransformNode?J.cr.TransformCoordinatesFromFloatsToRef(x,z,w,L.emitterWorldMatrix,p.position):(p.position.Uz(x,z,w),p.position.addInPlace(L.emitterPosition))},this.output._storedValue=r}});class Gp extends Rr{constructor(L){super(L),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",lr.Particle),this.registerOutput("output",lr.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);const r=this.particle.getConnectedValue(L);r._isAnimationSheetEnabled=!0,r.spriteCellWidth=this.width,r.spriteCellHeight=this.height,r.startSpriteCellID=this.start,r.endSpriteCellID=this.end,r.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=r}serialize(){const L=super.serialize();return L.width=this.width,L.height=this.height,L.start=this.start,L.end=this.end,L.randomStartCell=this.randomStartCell,L}_deserialize(L){super._deserialize(L),this.width=L.width,this.height=L.height,this.start=L.start,this.end=L.end,this.randomStartCell=L.randomStartCell}}(0,a.e)([Ir("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gp.prototype,"start",void 0),(0,a.e)([Ir("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gp.prototype,"end",void 0),(0,a.e)([Ir("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gp.prototype,"width",void 0),(0,a.e)([Ir("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gp.prototype,"height",void 0),(0,a.e)([Ir("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gp.prototype,"loop",void 0),(0,a.e)([Ir("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gp.prototype,"randomStartCell",void 0),(0,z.e)("BABYLON.SetupSpriteSheetBlock",Gp);class Cp extends Rr{constructor(L){super(L),this.reference=0,this.registerInput("value",lr.AutoDetect),this.registerOutput("output",lr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=L=>{switch(L){case lr.Float:return lr.FloatGradient;case lr.Vector2:return lr.Vector2Gradient;case lr.cr:return lr.Vector3Gradient;case lr.Fz:return lr.Color4Gradient}return L},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lr.Float|lr.Vector2|lr.cr|lr.Fz)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=L=>null}serialize(){const L=super.serialize();return L.reference=this.reference,L}_deserialize(L){super._deserialize(L),this.reference=L.reference}}(0,a.e)([Ir("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Cp.prototype,"reference",void 0),(0,z.e)("BABYLON.ParticleGradientValueBlock",Cp);(0,z.e)("BABYLON.ParticleGradientBlock",class extends Rr{constructor(L){super(L),this._entryCount=1,this.registerInput("gradient",lr.Float,!0,1,0,1),this.registerInput("value0",lr.AutoDetect),this.registerOutput("output",lr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=L=>{switch(L){case lr.FloatGradient:return lr.Float;case lr.Vector2Gradient:return lr.Vector2;case lr.Vector3Gradient:return lr.cr;case lr.Color4Gradient:return lr.Fz}return L},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lr.FloatGradient|lr.Vector2Gradient|lr.Vector3Gradient|lr.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(L){this._inputs[L].onConnectionObservable.add((()=>{this._entryCount>L||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),lr.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const L=[];for(let p=1;p<this._inputs.length;p++){var r;if(this._inputs[p].isConnected)L.push(null===(r=this._inputs[p].connectedPoint)||void 0===r?void 0:r.ownerBlock)}L.sort(((L,r)=>L.reference-r.reference)),this.output._storedFunction=r=>{const p=this.gradient.getConnectedValue(r);if(1===L.length)return L[0].value.getConnectedValue(r);let i=null;for(let n=L.length-1;n>=0;n--){const z=L[n];if(z.reference<=p){const L=z.value.getConnectedValue(r);if(i){const n=i.value.getConnectedValue(r),G=i.reference,t=z.reference,E=Math.max(0,Math.min(1,(p-t)/(G-t)));switch(this.output.type){case lr.Float:return(0,C.Lerp)(L,n,E);case lr.Vector2:return J.Vector2.Lerp(L,n,E);case lr.cr:return J.cr.Lerp(L,n,E);case lr.Fz:return j.Fz.Lerp(L,n,E)}}return L}i=z}return 0}}});(0,z.e)("BABYLON.ParticleConverterBlock",class extends Rr{constructor(L){super(L),this.registerInput("color ",lr.Fz,!0),this.registerInput("xyz ",lr.cr,!0),this.registerInput("xy ",lr.Vector2,!0),this.registerInput("zw ",lr.Vector2,!0),this.registerInput("x ",lr.Float,!0),this.registerInput("y ",lr.Float,!0),this.registerInput("z ",lr.Float,!0),this.registerInput("w ",lr.Float,!0),this.registerOutput("color",lr.Fz),this.registerOutput("xyz",lr.cr),this.registerOutput("xy",lr.Vector2),this.registerOutput("zw",lr.Vector2),this.registerOutput("x",lr.Float),this.registerOutput("y",lr.Float),this.registerOutput("z",lr.Float),this.registerOutput("w",lr.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(L){return"color "===L?"colorIn":"xyz "===L?"xyzIn":"xy "===L?"xyIn":"zw "===L?"zwIn":"x "===L?"xIn":"y "===L?"yIn":"z "===L?"zIn":"w "===L?"wIn":L}_outputRename(L){switch(L){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return L}}_build(L){super._build(L);const r=this.xIn,p=this.yIn,i=this.zIn,n=this.wIn,z=this.xyIn,G=this.zwIn,C=this.xyzIn,t=this.colorIn,E=this.colorOut,x=this.xyzOut,w=this.xyOut,g=this.zwOut,b=this.xOut,c=this.yOut,P=this.zOut,O=this.wOut,h=L=>{if(t.isConnected)return t.getConnectedValue(L);let J=0,E=0,x=0,w=0;if(r.isConnected&&(J=r.getConnectedValue(L)),p.isConnected&&(E=p.getConnectedValue(L)),i.isConnected&&(x=i.getConnectedValue(L)),n.isConnected&&(w=n.getConnectedValue(L)),z.isConnected){const r=z.getConnectedValue(L);r&&(J=r.x,E=r.y)}if(G.isConnected){const r=G.getConnectedValue(L);r&&(x=r.x,w=r.y)}if(C.isConnected){const r=C.getConnectedValue(L);r&&(J=r.x,E=r.y,x=r.z)}return new j.Fz(J,E,x,w)};E._storedFunction=L=>h(L),x._storedFunction=L=>{const r=h(L);return new J.cr(r.r,r.g,r.b)},w._storedFunction=L=>{const r=h(L);return new J.Vector2(r.r,r.g)},g._storedFunction=L=>{const r=h(L);return new J.Vector2(r.b,r.a)},b._storedFunction=L=>h(L).r,c._storedFunction=L=>h(L).g,P._storedFunction=L=>h(L).b,O._storedFunction=L=>h(L).a}}),function(L){L[L.Cos=0]="Cos",L[L.Sin=1]="Sin",L[L.Abs=2]="Abs",L[L.Exp=3]="Exp",L[L.Exp2=4]="Exp2",L[L.Round=5]="Round",L[L.Floor=6]="Floor",L[L.Ceiling=7]="Ceiling",L[L.Sqrt=8]="Sqrt",L[L.Log=9]="Log",L[L.Tan=10]="Tan",L[L.ArcTan=11]="ArcTan",L[L.ArcCos=12]="ArcCos",L[L.ArcSin=13]="ArcSin",L[L.Sign=14]="Sign",L[L.Negate=15]="Negate",L[L.OneMinus=16]="OneMinus",L[L.Reciprocal=17]="Reciprocal",L[L.ToDegrees=18]="ToDegrees",L[L.ToRadians=19]="ToRadians",L[L.Fract=20]="Fract"}(or||(or={}));class tp extends Rr{constructor(L){super(L),this.operation=or.Cos,this.registerInput("input",lr.AutoDetect),this.registerOutput("output",lr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lr.Float|lr.Int|lr.Vector2|lr.cr|lr.Fz)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);let r=null;switch(this.operation){case or.Cos:r=L=>Math.cos(L);break;case or.Sin:r=L=>Math.sin(L);break;case or.Abs:r=L=>Math.abs(L);break;case or.Exp:r=L=>Math.exp(L);break;case or.Exp2:r=L=>Math.pow(2,L);break;case or.Round:r=L=>Math.round(L);break;case or.Floor:r=L=>Math.floor(L);break;case or.Ceiling:r=L=>Math.ceil(L);break;case or.Sqrt:r=L=>Math.sqrt(L);break;case or.Log:r=L=>Math.log(L);break;case or.Tan:r=L=>Math.tan(L);break;case or.ArcTan:r=L=>Math.atan(L);break;case or.ArcCos:r=L=>Math.acos(L);break;case or.ArcSin:r=L=>Math.asin(L);break;case or.Sign:r=L=>Math.sign(L);break;case or.Negate:r=L=>-L;break;case or.OneMinus:r=L=>1-L;break;case or.Reciprocal:r=L=>1/L;break;case or.ToRadians:r=L=>L*Math.PI/180;break;case or.ToDegrees:r=L=>180*L/Math.PI;break;case or.Fract:r=L=>L>=0?L-Math.floor(L):L-Math.ceil(L)}if(!r)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case lr.Int:case lr.Float:this.output._storedFunction=L=>{const p=this.input.getConnectedValue(L);return r(p)};break;case lr.Vector2:this.output._storedFunction=L=>{const p=this.input.getConnectedValue(L);return new J.Vector2(r(p.x),r(p.y))};break;case lr.cr:this.output._storedFunction=L=>{const p=this.input.getConnectedValue(L);return new J.cr(r(p.x),r(p.y),r(p.z))};break;case lr.Fz:this.output._storedFunction=L=>{const p=this.input.getConnectedValue(L);return new j.Fz(r(p.r),r(p.g),r(p.b),r(p.a))}}return this}serialize(){const L=super.serialize();return L.operation=this.operation,L}_deserialize(L){super._deserialize(L),this.operation=L.operation}}(0,a.e)([Ir("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:or.Cos},{label:"Sin",value:or.Sin},{label:"Abs",value:or.Abs},{label:"Exp",value:or.Exp},{label:"Exp2",value:or.Exp2},{label:"Round",value:or.Round},{label:"Floor",value:or.Floor},{label:"Ceiling",value:or.Ceiling},{label:"Sqrt",value:or.Sqrt},{label:"Log",value:or.Log},{label:"Tan",value:or.Tan},{label:"ArcTan",value:or.ArcTan},{label:"ArcCos",value:or.ArcCos},{label:"ArcSin",value:or.ArcSin},{label:"Sign",value:or.Sign},{label:"Negate",value:or.Negate},{label:"OneMinus",value:or.OneMinus},{label:"Reciprocal",value:or.Reciprocal},{label:"ToDegrees",value:or.ToDegrees},{label:"ToRadians",value:or.ToRadians},{label:"Fract",value:or.Fract}]})],tp.prototype,"operation",void 0),(0,z.e)("BABYLON.ParticleTrigonometryBlock",tp);var Ep,xp=p(13510);class wp extends Rr{constructor(L){super(L),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",lr.AutoDetect),this.registerOutput("output",lr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(lr.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(lr.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(lr.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(lr.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(lr.System),this._inputs[0].excludedConnectionPointTypes.push(lr.Particle),this._inputs[0].excludedConnectionPointTypes.push(lr.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const r=L=>{const r=this.input.getConnectedValue(L);if(this.log.length>=this.stackSize)return r;if(null===r||void 0===r)return this.log.push(["null",""]),r;switch(this.input.type){case lr.Vector2:this.log.push([(0,xp.h)(r,4),r.toString()]);break;case lr.cr:this.log.push([(0,xp.i)(r,4),r.toString()]);break;case lr.Fz:this.log.push([`{R: ${r.r.toFixed(4)} G: ${r.g.toFixed(4)} B: ${r.b.toFixed(4)} A: ${r.a.toFixed(4)}}`,r.toString()]);break;default:this.log.push([r.toString(),r.toString()])}return r};this.output.isConnected?this.output._storedFunction=r:this.output._storedValue=r(L)}serialize(){const L=super.serialize();return L.stackSize=this.stackSize,L}_deserialize(L){super._deserialize(L),this.stackSize=L.stackSize}}(0,a.e)([Ir("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],wp.prototype,"stackSize",void 0),(0,z.e)("BABYLON.ParticleDebugBlock",wp);(0,z.e)("BABYLON.ParticleElbowBlock",class extends Rr{constructor(L){super(L),this.registerInput("input",lr.AutoDetect),this.registerOutput("output",lr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(L){super._build(L);const r=this._outputs[0],p=this._inputs[0];r._storedFunction=L=>p.getConnectedValue(L)}});(0,z.e)("BABYLON.ParticleTeleportInBlock",class extends Rr{get endpoints(){return this._endpoints}constructor(L){super(L),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",lr.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(L){if(this.getClassName()===L)return!0;for(const r of this.endpoints)if(r.isAnAncestorOfType(L))return!0;return!1}isAnAncestorOf(L){for(const r of this.endpoints){if(r===L)return!0;if(r.isAnAncestorOf(L))return!0}return!1}attachToEndpoint(L){L.detach(),this._endpoints.push(L),L._entryPoint=this,L._outputs[0]._typeConnectionSource=this._inputs[0],L._tempEntryPointUniqueId=null,L.name="> "+this.name}detachFromEndpoint(L){const r=this._endpoints.indexOf(L);-1!==r&&(this._endpoints.splice(r,1),L._outputs[0]._typeConnectionSource=null,L._entryPoint=null)}_build(){for(const L of this._endpoints)L.output._storedFunction=L=>this.input.getConnectedValue(L)}});(0,z.e)("BABYLON.ParticleTeleportOutBlock",class extends Rr{constructor(L){super(L),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",lr.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(L){this.entryPoint&&this.entryPoint.build(L)}clone(){const L=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(L),L}serialize(){var L;const r=super.serialize();return r.entryPoint=(null===(L=this.entryPoint)||void 0===L?void 0:L.uniqueId)??"",r}_deserialize(L){super._deserialize(L),this._tempEntryPointUniqueId=L.entryPoint}}),function(L){L[L.Equal=0]="Equal",L[L.NotEqual=1]="NotEqual",L[L.LessThan=2]="LessThan",L[L.GreaterThan=3]="GreaterThan",L[L.LessOrEqual=4]="LessOrEqual",L[L.GreaterOrEqual=5]="GreaterOrEqual",L[L.Xor=6]="Xor",L[L.Or=7]="Or",L[L.And=8]="And"}(Ep||(Ep={}));class gp extends Rr{constructor(L){super(L),this.test=Ep.Equal,this.epsilon=0,this.registerInput("left",lr.Float),this.registerInput("right",lr.Float,!0,0),this.registerInput("ifTrue",lr.AutoDetect,!0,1),this.registerInput("ifFalse",lr.AutoDetect,!0,0),this.registerOutput("output",lr.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=lr.Float,this._inputs[0].acceptedConnectionPointTypes.push(lr.Int),this._inputs[1].acceptedConnectionPointTypes.push(lr.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const L=L=>{const r=this.left.getConnectedValue(L),p=this.right.getConnectedValue(L);let J=!1;switch(this.test){case Ep.Equal:J=(0,C.WithinEpsilon)(r,p,this.epsilon);break;case Ep.NotEqual:J=!(0,C.WithinEpsilon)(r,p,this.epsilon);break;case Ep.LessThan:J=r<p+this.epsilon;break;case Ep.GreaterThan:J=r>p-this.epsilon;break;case Ep.LessOrEqual:J=r<=p+this.epsilon;break;case Ep.GreaterOrEqual:J=r>=p-this.epsilon;break;case Ep.Xor:J=!!r&&!p||!r&&!!p;break;case Ep.Or:J=!!r||!!p;break;case Ep.And:J=!!r&&!!p}return J};this.output._storedFunction=r=>L(r)?this.ifTrue.getConnectedValue(r):this.ifFalse.getConnectedValue(r)}serialize(){const L=super.serialize();return L.test=this.test,L.epsilon=this.epsilon,L}_deserialize(L){super._deserialize(L),this.test=L.test,void 0!==L.epsilon&&(this.epsilon=L.epsilon)}}(0,a.e)([Ir("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Ep.Equal},{label:"NotEqual",value:Ep.NotEqual},{label:"LessThan",value:Ep.LessThan},{label:"GreaterThan",value:Ep.GreaterThan},{label:"LessOrEqual",value:Ep.LessOrEqual},{label:"GreaterOrEqual",value:Ep.GreaterOrEqual},{label:"Xor",value:Ep.Xor},{label:"Or",value:Ep.Or},{label:"And",value:Ep.And}]})],gp.prototype,"test",void 0),(0,a.e)([Ir("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],gp.prototype,"epsilon",void 0),(0,z.e)("BABYLON.ParticleConditionBlock",gp);class bp extends Rr{constructor(L){super(L),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",lr.Particle),this.registerInput("condition",lr.Float,!0,0),this.registerInput("system",lr.System),this.registerOutput("output",lr.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(L){this._triggerCount=0;const r=this.input.getConnectedValue(L),p={process:p=>{if(L.particleContext=p,L.systemContext=r,0!==this.condition.getConnectedValue(L)&&(0===this.limit||this._triggerCount<this.limit)){const J=(new Date).getTime();if(this._previousOne&&J-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=J;const i=this.system.getConnectedValue(L);if(i){const J=Kr(i,L.Or,p.position);J.ji.addOnce((()=>{this._triggerCount--})),r.ji.addOnce((()=>{J.dispose()}))}}},previousItem:null,nextItem:null};r._updateQueueStart?dL(p,r._updateQueueStart):r._updateQueueStart=p,this.output._storedValue=r}serialize(){const L=super.serialize();return L.limit=this.limit,L.delay=this.delay,L}_deserialize(L){super._deserialize(L),void 0!==L.limit&&(this.limit=L.limit),void 0!==L.delay&&(this.delay=L.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,a.e)([Ir("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bp.prototype,"limit",void 0),(0,a.e)([Ir("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bp.prototype,"delay",void 0),(0,z.e)("BABYLON.ParticleTriggerBlock",bp);p(13519),p(13530),p(13541),p(13602)},13583:(L,r,p)=>{"use strict";var J=p(12045);const i="clipPlaneFragment",n="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13548:(L,r,p)=>{"use strict";var J=p(12045);const i="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13617:(L,r,p)=>{"use strict";var J=p(12045);const i="clipPlaneVertex",n="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13607:(L,r,p)=>{"use strict";var J=p(12045);const i="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13594:(L,r,p)=>{"use strict";var J=p(12045);const i="fogFragment",n="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13576:(L,r,p)=>{"use strict";var J=p(12045);const i="fogFragmentDeclaration",n="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13624:(L,r,p)=>{"use strict";var J=p(12045);const i="fogVertex",n="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13610:(L,r,p)=>{"use strict";var J=p(12045);const i="fogVertexDeclaration",n="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13566:(L,r,p)=>{"use strict";var J=p(12045);const i="helperFunctions",n="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13550:(L,r,p)=>{"use strict";var J=p(12045);const i="imageProcessingDeclaration",n="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13568:(L,r,p)=>{"use strict";var J=p(12045);const i="imageProcessingFunctions",n="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13557:(L,r,p)=>{"use strict";var J=p(12045);const i="logDepthDeclaration",n="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13585:(L,r,p)=>{"use strict";var J=p(12045);const i="logDepthFragment",n="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13628:(L,r,p)=>{"use strict";var J=p(12045);const i="logDepthVertex",n="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";J.d.IncludesShadersStoreWGSL[i]||(J.d.IncludesShadersStoreWGSL[i]=n)},13541:(L,r,p)=>{"use strict";p.r(r),p.d(r,{particlesPixelShaderWGSL:()=>j});var J=p(12045);p(13548),p(13550),p(13557),p(13566),p(13568),p(13576),p(13583),p(13585),p(13594);const i="particlesPixelShader",n="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.d.ShadersStoreWGSL[i]||(J.d.ShadersStoreWGSL[i]=n);const j={name:i,shader:n}},13602:(L,r,p)=>{"use strict";p.r(r),p.d(r,{particlesVertexShaderWGSL:()=>j});var J=p(12045);p(13607),p(13610),p(13557),p(13617),p(13624),p(13628);const i="particlesVertexShader",n="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.d.ShadersStoreWGSL[i]||(J.d.ShadersStoreWGSL[i]=n);const j={name:i,shader:n}},13439:(L,r,p)=>{"use strict";var J=p(12045);const i="clipPlaneFragment",n="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13521:(L,r,p)=>{"use strict";var J=p(12045);const i="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13464:(L,r,p)=>{"use strict";var J=p(12045);const i="clipPlaneVertex",n="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13536:(L,r,p)=>{"use strict";var J=p(12045);const i="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13452:(L,r,p)=>{"use strict";var J=p(12045);const i="fogFragment",n="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13434:(L,r,p)=>{"use strict";var J=p(12045);const i="fogFragmentDeclaration",n="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13471:(L,r,p)=>{"use strict";var J=p(12045);const i="fogVertex",n="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13455:(L,r,p)=>{"use strict";var J=p(12045);const i="fogVertexDeclaration",n="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13425:(L,r,p)=>{"use strict";var J=p(12045);const i="helperFunctions",n="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13420:(L,r,p)=>{"use strict";var J=p(12045);const i="imageProcessingDeclaration",n="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13430:(L,r,p)=>{"use strict";var J=p(12045);const i="imageProcessingFunctions",n="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13423:(L,r,p)=>{"use strict";var J=p(12045);const i="logDepthDeclaration",n="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13446:(L,r,p)=>{"use strict";var J=p(12045);const i="logDepthFragment",n="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13475:(L,r,p)=>{"use strict";var J=p(12045);const i="logDepthVertex",n="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";J.d.IncludesShadersStore[i]||(J.d.IncludesShadersStore[i]=n)},13519:(L,r,p)=>{"use strict";p.r(r),p.d(r,{particlesPixelShader:()=>j});var J=p(12045);p(13521),p(13420),p(13423),p(13425),p(13430),p(13434),p(13439),p(13446),p(13452);const i="particlesPixelShader",n="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.d.ShadersStore[i]||(J.d.ShadersStore[i]=n);const j={name:i,shader:n}},13530:(L,r,p)=>{"use strict";p.r(r),p.d(r,{particlesVertexShader:()=>j});var J=p(12045);p(13536),p(13455),p(13423),p(13464),p(13471),p(13475);const i="particlesVertexShader",n="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.d.ShadersStore[i]||(J.d.ShadersStore[i]=n);const j={name:i,shader:n}},13926:(L,r,p)=>{"use strict";p.r(r),p.d(r,{FlowGraphGLTFDataProvider:()=>n});var J=p(13882),i=p(13868);class n extends J.b{constructor(L){var r,p;super();const J=L.glTF,n=(null===(r=J.animations)||void 0===r?void 0:r.map((L=>L._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",i.d,n);const j=(null===(p=J.nodes)||void 0===p?void 0:p.map((L=>L._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",i.d,j)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13794:(L,r,p)=>{"use strict";p.d(r,{e:()=>c,h:()=>g,l:()=>w,o:()=>b});var J=p(12136),i=p(12605),n=p(12170),j=p(13803);const z=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class G{constructor(L,r){this._gltf=L,this._infoTree=r}convert(L){let r,p=this._gltf,J=this._infoTree;if(!L.startsWith("/"))throw new Error("Path must start with a /");const i=L.split("/");if(i.shift(),i[i.length-1].includes(".length")){const L=i[i.length-1].split(".");i.pop(),i.push(...L)}let n=!1;for(const G of i){const i="length"===G;if(i&&!J.__array__)throw new Error(`Path ${L} is invalid`);if(J.__ignoreObjectTree__&&(n=!0),J.__array__&&!i)J=J.__array__;else if(J=J[G],!J)throw new Error(`Path ${L} is invalid`);if(!n)if(void 0===p){if(!z.find((r=>r.regex.test(L))))throw new Error(`Path ${L} is invalid`)}else if(!i){var j;p=null===(j=p)||void 0===j?void 0:j[G]}(J.__target__||i)&&(r=p)}return{object:r,info:J}}}function C(L,r,p,J){const i=t(L,r);return J?i[p][J]:i[p]}function t(L,r,p){var J,n;return null===(J=L._data)||void 0===J||null===(n=J[(null===p||void 0===p?void 0:p.fillMode)??i.b.MATERIAL_TriangleFillMode])||void 0===n?void 0:n.babylonMaterial}function E(L,r){return{offset:{componentsCount:2,type:"Vector2",get:(p,i,n)=>{const j=C(p,n,L,r);return new J.Vector2(null===j||void 0===j?void 0:j.uOffset,null===j||void 0===j?void 0:j.vOffset)},getTarget:t,set:(p,J,i,n)=>{const j=C(J,n,L,r);j.uOffset=p.x,j.vOffset=p.y},getPropertyName:[()=>`${L}${r?"."+r:""}.uOffset`,()=>`${L}${r?"."+r:""}.vOffset`]},rotation:{type:"number",get:(p,J,i)=>{var n;return null===(n=C(p,i,L,r))||void 0===n?void 0:n.wAng},getTarget:t,set:(p,J,i,n)=>C(J,n,L,r).wAng=p,getPropertyName:[()=>`${L}${r?"."+r:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(p,i,n)=>{const j=C(p,n,L,r);return new J.Vector2(null===j||void 0===j?void 0:j.uScale,null===j||void 0===j?void 0:j.vScale)},getTarget:t,set:(p,J,i,n)=>{const j=C(J,n,L,r);j.uScale=p.x,j.vScale=p.y},getPropertyName:[()=>`${L}${r?"."+r:""}.uScale`,()=>`${L}${r?"."+r:""}.vScale`]}}}const x={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:L=>{var r,p;return new J.Vector2((null===(r=L._babylonCamera)||void 0===r?void 0:r.orthoLeft)??0,(null===(p=L._babylonCamera)||void 0===p?void 0:p.orthoRight)??0)},set:(L,r)=>{r._babylonCamera&&(r._babylonCamera.orthoLeft=L.x,r._babylonCamera.orthoRight=L.y)},getTarget:L=>L,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:L=>{var r,p;return new J.Vector2((null===(r=L._babylonCamera)||void 0===r?void 0:r.orthoBottom)??0,(null===(p=L._babylonCamera)||void 0===p?void 0:p.orthoTop)??0)},set:(L,r)=>{r._babylonCamera&&(r._babylonCamera.orthoBottom=L.x,r._babylonCamera.orthoTop=L.y)},getTarget:L=>L,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:L=>{var r;return null===(r=L._babylonCamera)||void 0===r?void 0:r.maxZ},set:(L,r)=>{r._babylonCamera&&(r._babylonCamera.maxZ=L)},getTarget:L=>L,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:L=>{var r;return null===(r=L._babylonCamera)||void 0===r?void 0:r.nz},set:(L,r)=>{r._babylonCamera&&(r._babylonCamera.nz=L)},getTarget:L=>L,getPropertyName:[()=>"nz"]}},perspective:{aspectRatio:{type:"number",get:L=>{var r;return null===(r=L._babylonCamera)||void 0===r?void 0:r.getEngine().getAspectRatio(L._babylonCamera)},getTarget:L=>L,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:L=>{var r;return null===(r=L._babylonCamera)||void 0===r?void 0:r.fov},set:(L,r)=>{r._babylonCamera&&(r._babylonCamera.fov=L)},getTarget:L=>L,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:L=>{var r;return null===(r=L._babylonCamera)||void 0===r?void 0:r.maxZ},set:(L,r)=>{r._babylonCamera&&(r._babylonCamera.maxZ=L)},getTarget:L=>L,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:L=>{var r;return null===(r=L._babylonCamera)||void 0===r?void 0:r.nz},set:(L,r)=>{r._babylonCamera&&(r._babylonCamera.nz=L)},getTarget:L=>L,getPropertyName:[()=>"nz"]}}}},nodes:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"cr",get:L=>{var r;return null===(r=L._babylonTransformNode)||void 0===r?void 0:r.position},set:(L,r)=>{var p;return null===(p=r._babylonTransformNode)||void 0===p?void 0:p.position.G(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:L=>{var r;return null===(r=L._babylonTransformNode)||void 0===r?void 0:r.rotationQuaternion},set:(L,r)=>{var p,J;return null===(p=r._babylonTransformNode)||void 0===p||null===(J=p.rotationQuaternion)||void 0===J?void 0:J.G(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"cr",get:L=>{var r;return null===(r=L._babylonTransformNode)||void 0===r?void 0:r.Wz},set:(L,r)=>{var p;return null===(p=r._babylonTransformNode)||void 0===p?void 0:p.Wz.G(L)},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"Wz"]},weights:{length:{type:"number",get:L=>L._numMorphTargets,getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(L,r)=>{var p,J;return void 0!==r?null===(p=L._primitiveBabylonMeshes)||void 0===p||null===(J=p[0].morphTargetManager)||void 0===J?void 0:J.getTarget(r).influence:void 0},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(L,r)=>[0],getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:L=>{var r,p,i;return J.Matrix.Compose(null===(r=L._babylonTransformNode)||void 0===r?void 0:r.Wz,null===(p=L._babylonTransformNode)||void 0===p?void 0:p.rotationQuaternion,null===(i=L._babylonTransformNode)||void 0===i?void 0:i.position)},getTarget:L=>L._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:L=>{var r,p,i,n;const j=J.Matrix.Identity();let z=L.parent;for(;z&&z.parent;)z=z.parent;const G=(null===(r=L._babylonTransformNode)||void 0===r?void 0:r.position._isDirty)||(null===(p=L._babylonTransformNode)||void 0===p||null===(i=p.rotationQuaternion)||void 0===i?void 0:i._isDirty)||(null===(n=L._babylonTransformNode)||void 0===n?void 0:n.Wz._isDirty);if(z){var C;const r=null===(C=z._babylonTransformNode)||void 0===C?void 0:C.cz(!0).invert();var t,E;if(r)null===(t=L._babylonTransformNode)||void 0===t||null===(E=t.cz(G))||void 0===E||E.multiplyToRef(r,j)}else L._babylonTransformNode&&j.G(L._babylonTransformNode.cz(G));return j},getTarget:L=>L._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:L=>{var r,p;return null===(r=L._babylonTransformNode)||void 0===r||null===(p=r.getChildren((L=>L instanceof j.d),!0)[0])||void 0===p?void 0:p.vz},getTarget:L=>{var r;return null===(r=L._babylonTransformNode)||void 0===r?void 0:r.getChildren((L=>L instanceof j.d),!0)[0]},set:(L,r)=>{if(r._babylonTransformNode){const p=r._babylonTransformNode.getChildren((L=>L instanceof j.d),!0)[0];p&&(p.vz=L)}}},color:{type:"Wr",get:L=>{var r,p;return null===(r=L._babylonTransformNode)||void 0===r||null===(p=r.getChildren((L=>L instanceof j.d),!0)[0])||void 0===p?void 0:p.yz},getTarget:L=>{var r;return null===(r=L._babylonTransformNode)||void 0===r?void 0:r.getChildren((L=>L instanceof j.d),!0)[0]},set:(L,r)=>{if(r._babylonTransformNode){const p=r._babylonTransformNode.getChildren((L=>L instanceof j.d),!0)[0];p&&(p.yz=L)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Wr",get:(L,r,p)=>t(L,r,p).emissiveColor,set:(L,r,p,J)=>t(r,p,J).emissiveColor.G(L),getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:E("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(L,r,p)=>{var J;return null===(J=C(L,p,"bumpTexture"))||void 0===J?void 0:J.level},set:(L,r,p,J)=>{const i=C(r,J,"bumpTexture");i&&(i.level=L)},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:E("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(L,r,p)=>t(L,r,p).ambientTextureStrength,set:(L,r,p,J)=>{const i=t(r,p,J);i&&(i.ambientTextureStrength=L)},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:E("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Fz",get:(L,r,p)=>{const J=t(L,r,p);return n.Fz.FromColor3(J.albedoColor,J.alpha)},set:(L,r,p,J)=>{const i=t(r,p,J);i.albedoColor.set(L.r,L.g,L.b),i.alpha=L.a},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:E("albedoTexture")}},metallicFactor:{type:"number",get:(L,r,p)=>t(L,r,p).metallic,set:(L,r,p,J)=>{const i=t(r,p,J);i&&(i.metallic=L)},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(L,r,p)=>t(L,r,p).roughness,set:(L,r,p,J)=>{const i=t(r,p,J);i&&(i.roughness=L)},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:E("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(L,r,p)=>t(L,r,p).anisotropy.vz,set:(L,r,p,J)=>{t(r,p,J).anisotropy.vz=L},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(L,r,p)=>t(L,r,p).anisotropy.angle,set:(L,r,p,J)=>{t(r,p,J).anisotropy.angle=L},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:E("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(L,r,p)=>t(L,r,p).clearCoat.vz,set:(L,r,p,J)=>{t(r,p,J).clearCoat.vz=L},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(L,r,p)=>t(L,r,p).clearCoat.roughness,set:(L,r,p,J)=>{t(r,p,J).clearCoat.roughness=L},getTarget:(L,r,p)=>t(L,r,p),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:E("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(L,r,p)=>{var J;return null===(J=t(L,r,p).clearCoat.bumpTexture)||void 0===J?void 0:J.level},getTarget:t,set:(L,r,p,J)=>t(r,p,J).clearCoat.bumpTexture.level=L},extensions:{KHR_texture_transform:E("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:E("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(L,r,p)=>t(L,r,p).subSurface.dispersion,getTarget:t,set:(L,r,p,J)=>t(r,p,J).subSurface.dispersion=L}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(L,r,p)=>t(L,r,p).emissiveIntensity,getTarget:t,set:(L,r,p,J)=>t(r,p,J).emissiveIntensity=L}},KHR_materials_ior:{ior:{type:"number",get:(L,r,p)=>t(L,r,p).indexOfRefraction,getTarget:t,set:(L,r,p,J)=>t(r,p,J).indexOfRefraction=L}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(L,r,p)=>t(L,r,p).iridescence.vz,getTarget:t,set:(L,r,p,J)=>t(r,p,J).iridescence.vz=L},iridescenceIor:{type:"number",get:(L,r,p)=>t(L,r,p).iridescence.indexOfRefraction,getTarget:t,set:(L,r,p,J)=>t(r,p,J).iridescence.indexOfRefraction=L},iridescenceTexture:{extensions:{KHR_texture_transform:E("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(L,r,p)=>t(L,r,p).iridescence.maximumThickness,getTarget:t,set:(L,r,p,J)=>t(r,p,J).iridescence.maximumThickness=L},iridescenceThicknessMinimum:{type:"number",get:(L,r,p)=>t(L,r,p).iridescence.minimumThickness,getTarget:t,set:(L,r,p,J)=>t(r,p,J).iridescence.minimumThickness=L},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:E("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Wr",get:(L,r,p)=>t(L,r,p).sheen.color,getTarget:t,set:(L,r,p,J)=>t(r,p,J).sheen.color.G(L)},sheenColorTexture:{extensions:{KHR_texture_transform:E("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(L,r,p)=>t(L,r,p).sheen.vz,getTarget:t,set:(L,r,p,J)=>t(r,p,J).sheen.vz=L},sheenRoughnessTexture:{extensions:{KHR_texture_transform:E("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(L,r,p)=>t(L,r,p).metallicF0Factor,getTarget:t,set:(L,r,p,J)=>t(r,p,J).metallicF0Factor=L,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Wr",get:(L,r,p)=>t(L,r,p).metallicReflectanceColor,getTarget:t,set:(L,r,p,J)=>t(r,p,J).metallicReflectanceColor.G(L),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:E("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:E("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(L,r,p)=>t(L,r,p).subSurface.refractionIntensity,getTarget:t,set:(L,r,p,J)=>t(r,p,J).subSurface.refractionIntensity=L,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:E("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(L,r,p)=>t(L,r,p).subSurface.translucencyIntensity,getTarget:t,set:(L,r,p,J)=>t(r,p,J).subSurface.translucencyIntensity=L},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:E("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Wr",get:(L,r,p)=>t(L,r,p).subSurface.translucencyColor,getTarget:t,set:(L,r,p,J)=>{var i;return L&&(null===(i=t(r,p,J).subSurface.translucencyColor)||void 0===i?void 0:i.G(L))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:E("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Wr",get:(L,r,p)=>t(L,r,p).subSurface.tintColor,getTarget:t,set:(L,r,p,J)=>t(r,p,J).subSurface.tintColor.G(L)},attenuationDistance:{type:"number",get:(L,r,p)=>t(L,r,p).subSurface.tintColorAtDistance,getTarget:t,set:(L,r,p,J)=>t(r,p,J).subSurface.tintColorAtDistance=L},thicknessFactor:{type:"number",get:(L,r,p)=>t(L,r,p).subSurface.maximumThickness,getTarget:t,set:(L,r,p,J)=>t(r,p,J).subSurface.maximumThickness=L},thicknessTexture:{extensions:{KHR_texture_transform:E("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonLight)),getPropertyName:[L=>"length"]},__array__:{__target__:!0,color:{type:"Wr",get:L=>{var r;return null===(r=L._babylonLight)||void 0===r?void 0:r.yz},set:(L,r)=>{var p;return null===(p=r._babylonLight)||void 0===p?void 0:p.yz.G(L)},getTarget:L=>L._babylonLight,getPropertyName:[L=>"diffuse"]},vz:{type:"number",get:L=>{var r;return null===(r=L._babylonLight)||void 0===r?void 0:r.vz},set:(L,r)=>r._babylonLight?r._babylonLight.vz=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"intensity"]},range:{type:"number",get:L=>{var r;return null===(r=L._babylonLight)||void 0===r?void 0:r.range},set:(L,r)=>r._babylonLight?r._babylonLight.range=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"range"]},spot:{innerConeAngle:{type:"number",get:L=>{var r;return null===(r=L._babylonLight)||void 0===r?void 0:r.innerAngle},set:(L,r)=>r._babylonLight?r._babylonLight.innerAngle=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"innerConeAngle"]},outerConeAngle:{type:"number",get:L=>{var r;return null===(r=L._babylonLight)||void 0===r?void 0:r.angle},set:(L,r)=>r._babylonLight?r._babylonLight.angle=L:void 0,getTarget:L=>L._babylonLight,getPropertyName:[L=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonLight)),getPropertyName:[L=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonTexture)),getPropertyName:[L=>"length"]},__array__:{__target__:!0,vz:{type:"number",get:L=>{var r;return null===(r=L._babylonTexture)||void 0===r?void 0:r.level},set:(L,r)=>{r._babylonTexture&&(r._babylonTexture.level=L)},getTarget:L=>L._babylonTexture},rotation:{type:"Quaternion",get:L=>{var r;return L._babylonTexture&&J.Quaternion.FromRotationMatrix(null===(r=L._babylonTexture)||void 0===r?void 0:r.getReflectionTextureMatrix())},set:(L,r)=>{var p;r._babylonTexture&&(null!==(p=r._babylonTexture.FL())&&void 0!==p&&p.useRightHandedSystem||(L=J.Quaternion.Inverse(L)),J.Matrix.FromQuaternionToRef(L,r._babylonTexture.getReflectionTextureMatrix()))},getTarget:L=>L._babylonTexture}}}}},animations:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>L._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:L=>L.length,getTarget:L=>L.map((L=>{var r;return null===(r=L.primitives[0]._instanceData)||void 0===r?void 0:r.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function w(L){return new G(L,x)}function g(L){const r=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let p=x;for(const J of r)J&&(p=p[J]);if(p&&p.type&&p.get)return p}function b(L,r){const p=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let J=x;for(const i of p)i&&(J=J[i]);J&&J.type&&J.get&&(J.interpolation=r)}function c(L,r){const p=L.split("/").map((L=>L.replace(/{}/g,"__array__")));let J=x;for(const i of p)if(i){if(!J[i]){if("?"===i){J.__ignoreObjectTree__=!0;continue}J[i]={},"__array__"===i&&(J[i].__target__=!0)}J=J[i]}Object.assign(J,r)}},13807:(L,r,p)=>{"use strict";p.r(r),p.d(r,{AnimationPropertyInfo:()=>C,TransformNodeAnimationPropertyInfo:()=>t,WeightAnimationPropertyInfo:()=>E,getQuaternion:()=>z,getVector3:()=>j,getWeights:()=>G});var J=p(12642),i=p(12136),n=p(13794);function j(L,r,p,J){return i.cr.Br(r,p).scaleInPlace(J)}function z(L,r,p,J){return i.Quaternion.Br(r,p).scaleInPlace(J)}function G(L,r,p,J){const i=new Array(L._numMorphTargets);for(let n=0;n<i.length;n++)i[n]=r[p++]*J;return i}class C{constructor(L,r,p,J){this.type=L,this.name=r,this.getValue=p,this.getStride=J}_buildAnimation(L,r,p){const i=new J.c(L,this.name,r,this.type);return i.setKeys(p),i}}class t extends C{buildAnimations(L,r,p,J){const i=[];return i.push({babylonAnimatable:L._babylonTransformNode,babylonAnimation:this._buildAnimation(r,p,J)}),i}}class E extends C{buildAnimations(L,r,p,i){const n=[];if(L._numMorphTargets)for(let j=0;j<L._numMorphTargets;j++){const z=new J.c(`${r}_${j}`,this.name,p,this.type);if(z.setKeys(i.map((L=>({frame:L.frame,inTangent:L.inTangent?L.inTangent[j]:void 0,value:L.value[j],outTangent:L.outTangent?L.outTangent[j]:void 0,interpolation:L.interpolation})))),L._primitiveBabylonMeshes)for(const r of L._primitiveBabylonMeshes)if(r.morphTargetManager){const L=r.morphTargetManager.getTarget(j),p=z.clone();L.animations.push(p),n.push({babylonAnimatable:L,babylonAnimation:p})}}return n}}(0,n.o)("/nodes/{}/translation",[new t(J.c.ANIMATIONTYPE_VECTOR3,"position",j,(()=>3))]),(0,n.o)("/nodes/{}/rotation",[new t(J.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",z,(()=>4))]),(0,n.o)("/nodes/{}/scale",[new t(J.c.ANIMATIONTYPE_VECTOR3,"Wz",j,(()=>3))]),(0,n.o)("/nodes/{}/weights",[new E(J.c.ANIMATIONTYPE_FLOAT,"influence",G,(L=>L._numMorphTargets))])},13758:(L,r,p)=>{"use strict";class J{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((L,r)=>{this._resolve=L,this._reject=r}))}}var i=p(12136),n=p(12170),j=p(11957),z=p(12579),G=p(13766),C=p(13777),t=p(11964),E=p(12600),x=p(12642),w=p(12645),g=p(12009),b=p(11975),c=p(11979);class P{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(L){this._useTextureToStoreBoneMatrices=L,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(L){this._animationPropertiesOverride=L}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(L,r,p){this.name=L,this.id=r,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=i.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new t.c,this.bones=[],this._scene=p||g.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const J=this._scene.getEngine().getCaps();this._canUseTextureForBones=J.textureFloat&&J.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((L=>!L.getParent()))}getTransformMatrices(L){if(this.needInitialSkinMatrix){if(!L)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return L._bonesTransformMatrices||this.prepare(!0),L._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(L){return this.needInitialSkinMatrix&&L._transformMatrixTexture?L._transformMatrixTexture:this._transformMatrixTexture}FL(){return this._scene}toString(L){let r=`Name: ${this.name}, nBones: ${this.bones.length}`;if(r+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,L){r+=", Ranges: {";let L=!0;for(const p in this._ranges)L&&(r+=", ",L=!1),r+=p;r+="}"}return r}getBoneIndexByName(L){for(let r=0,p=this.bones.length;r<p;r++)if(this.bones[r].name===L)return r;return-1}createAnimationRange(L,r,p){if(!this._ranges[L]){this._ranges[L]=new w.b(L,r,p);for(let J=0,i=this.bones.length;J<i;J++)this.bones[J].animations[0]&&this.bones[J].animations[0].createRange(L,r,p)}}deleteAnimationRange(L){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let p=0,J=this.bones.length;p<J;p++)this.bones[p].animations[0]&&this.bones[p].animations[0].deleteRange(L,r);this._ranges[L]=null}getAnimationRange(L){return this._ranges[L]||null}getAnimationRanges(){const L=[];let r;for(r in this._ranges)L.push(this._ranges[r]);return L}copyAnimationRange(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[r]||!L.getAnimationRange(r))return!1;let J=!0;const i=this._getHighestAnimationFrame()+1,n={},j=L.bones;let z,G;for(G=0,z=j.length;G<z;G++)n[j[G].name]=j[G];this.bones.length!==j.length&&(b.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${j.length}`),J=!1);const C=p&&this.dimensionsAtRest&&L.dimensionsAtRest?this.dimensionsAtRest.divide(L.dimensionsAtRest):null;for(G=0,z=this.bones.length;G<z;G++){const L=this.bones[G].name,j=n[L];j?J=J&&this.bones[G].copyAnimationRange(j,r,i,p,C):(b.d.Warn("copyAnimationRange: not same rig, missing source bone "+L),J=!1)}const t=L.getAnimationRange(r);return t&&(this._ranges[r]=new w.b(r,t.from+i,t.to+i)),J}returnToRest(){for(const L of this.bones)-1!==L._index&&L.returnToRest()}_getHighestAnimationFrame(){let L=0;for(let r=0,p=this.bones.length;r<p;r++)if(this.bones[r].animations[0]){const p=this.bones[r].animations[0].getHighestFrame();L<p&&(L=p)}return L}beginAnimation(L,r,p,J){const i=this.getAnimationRange(L);return i?this._scene.beginAnimation(this,i.from,i.to,r,p,J):null}static MakeAnimationAdditive(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;const J=L.getAnimationRange(p);if(!J)return null;const i=L._scene.getAllAnimatablesByTarget(L);let n=null;for(let z=0;z<i.length;z++){const L=i[z];if(L.fromFrame===(null===J||void 0===J?void 0:J.from)&&L.toFrame===(null===J||void 0===J?void 0:J.to)){n=L;break}}const j=L.getAnimatables();for(let z=0;z<j.length;z++){const L=j[z].animations;if(L)for(let J=0;J<L.length;J++)x.c.MakeAnimationAdditive(L[J],r,p)}return n&&(n.isAdditive=!0),L}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(L){this._meshesWithPoseMatrix.push(L)}_unregisterMeshWithPoseMatrix(L){const r=this._meshesWithPoseMatrix.indexOf(L);r>-1&&this._meshesWithPoseMatrix.splice(r,1)}_computeTransformMatrices(L,r){this.onBeforeComputeObservable.notifyObservers(this);for(let p=0;p<this.bones.length;p++){const J=this.bones[p];J._childUpdateId++;const i=J.getParent();if(i?J.getLocalMatrix().multiplyToRef(i.getFinalMatrix(),J.getFinalMatrix()):r?J.getLocalMatrix().multiplyToRef(r,J.getFinalMatrix()):J.getFinalMatrix().G(J.getLocalMatrix()),-1!==J._index){const r=null===J._index?p:J._index;J.getAbsoluteInverseBindMatrix().multiplyToArray(J.getFinalMatrix(),L,16*r)}}this._identity.copyToArray(L,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const L=this.FL().getRenderId();if(this._currentRenderId===L)return;this._currentRenderId=L}if(this._numBonesWithLinkedTransformNode>0)for(const L of this.bones)if(L._linkedTransformNode){const r=L._linkedTransformNode;L.position=r.position,r.rotationQuaternion?L.rotationQuaternion=r.rotationQuaternion:L.rotation=r.rotation,L.Wz=r.Wz}if(this.needInitialSkinMatrix)for(const L of this._meshesWithPoseMatrix){const r=L.getPoseMatrix();let p=this._isDirty;if(L._bonesTransformMatrices&&L._bonesTransformMatrices.length===16*(this.bones.length+1)||(L._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),p=!0),p){if(this._synchronizedWithMesh!==L){this._synchronizedWithMesh=L;for(const L of this.bones)if(!L.getParent()){L.getBindMatrix().multiplyToRef(r,i.TmpVectors.Matrix[1]),L._updateAbsoluteBindMatrices(i.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const r=4*(this.bones.length+1);L._transformMatrixTexture&&L._transformMatrixTexture.getSize().width===r||(L._transformMatrixTexture&&L._transformMatrixTexture.dispose(),L._transformMatrixTexture=E.e.CreateRGBATexture(L._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(L._bonesTransformMatrices,r),this.isUsingTextureForMatrices&&L._transformMatrixTexture&&L._transformMatrixTexture.update(L._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=E.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let L=0;L<this.bones.length;L++)this._animatables.push(this.bones[L])}return this._animatables}clone(L,r){const p=new P(L,r||L,this._scene);p.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let J=0;J<this.bones.length;J++){const L=this.bones[J];let r=null;const i=L.getParent();if(i){const L=this.bones.indexOf(i);r=p.bones[L]}const n=new C.e(L.name,p,r,L.getBindMatrix().clone(),L.getRestMatrix().clone());n._index=L._index,L._linkedTransformNode&&n.linkTransformNode(L._linkedTransformNode),c.b.DeepCopy(L.animations,n.animations)}if(this._ranges){p._ranges={};for(const L in this._ranges){const r=this._ranges[L];r&&(p._ranges[L]=r.clone())}}return this._isDirty=!0,p.prepare(!0),p}enableBlending(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const r of this.bones)for(const p of r.animations)p.enableBlending=!0,p.blendingSpeed=L}dispose(){if(this._meshesWithPoseMatrix.length=0,this.FL().stopAnimation(this),this.FL().removeSkeleton(this),this._parentContainer){const L=this._parentContainer.skeletons.indexOf(this);L>-1&&this._parentContainer.skeletons.splice(L,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const L={};L.name=this.name,L.id=this.id,this.dimensionsAtRest&&(L.dimensionsAtRest=this.dimensionsAtRest.mz()),L.bones=[],L.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let p=0;p<this.bones.length;p++){var r;const J=this.bones[p],i=J.getParent(),n={parentBoneIndex:i?this.bones.indexOf(i):-1,index:J.getIndex(),name:J.name,id:J.id,matrix:J.getBindMatrix().mz(),rest:J.getRestMatrix().mz(),linkedTransformNodeId:null===(r=J.getTransformNode())||void 0===r?void 0:r.id};L.bones.push(n),J.length&&(n.length=J.length),J.metadata&&(n.metadata=J.metadata),J.animations&&J.animations.length>0&&(n.animation=J.animations[0].serialize()),L.ranges=[];for(const r in this._ranges){const p=this._ranges[r];if(!p)continue;const J={};J.name=r,J.from=p.from,J.to=p.to,L.ranges.push(J)}}return L}static Parse(L,r){const p=new P(L.name,L.id,r);let J;for(L.dimensionsAtRest&&(p.dimensionsAtRest=i.cr.Br(L.dimensionsAtRest)),p.needInitialSkinMatrix=L.needInitialSkinMatrix,J=0;J<L.bones.length;J++){const r=L.bones[J],n=L.bones[J].index;let j=null;r.parentBoneIndex>-1&&(j=p.bones[r.parentBoneIndex]);const z=r.rest?i.Matrix.Br(r.rest):null,G=new C.e(r.name,p,j,i.Matrix.Br(r.matrix),z,null,n);void 0!==r.id&&null!==r.id&&(G.id=r.id),r.length&&(G.length=r.length),r.metadata&&(G.metadata=r.metadata),r.animation&&G.animations.push(x.c.Parse(r.animation)),void 0!==r.linkedTransformNodeId&&null!==r.linkedTransformNodeId&&(p._hasWaitingData=!0,G._waitingTransformNodeId=r.linkedTransformNodeId)}if(L.ranges)for(J=0;J<L.ranges.length;J++){const r=L.ranges[J];p.createAnimationRange(r.name,r.from,r.to)}return p}computeAbsoluteMatrices(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||L)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(L)}getPoseMatrix(){let L=null;return this._meshesWithPoseMatrix.length>0&&(L=this._meshesWithPoseMatrix[0].getPoseMatrix()),L}sortBones(){const L=[],r=new Array(this.bones.length);for(let p=0;p<this.bones.length;p++)this._sortBones(p,L,r);this.bones=L}_sortBones(L,r,p){if(p[L])return;p[L]=!0;const J=this.bones[L];if(!J)return;void 0===J._index&&(J._index=L);const i=J.getParent();i&&this._sortBones(this.bones.indexOf(i),r,p),r.push(J)}setCurrentPoseAsRest(){for(const L of this.bones)L.setCurrentPoseAsRest()}}var O=p(12446),h=p(12617),U=p(12111),W=p(12541),B=p(12208),F=p(12584),Q=p(12547),e=p(12575),v=p(12647),y=p(12223),A=p(13716);class u{set areUpdatesFrozen(L){L?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new y.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,L||(L=g.c.LastCreatedScene),this._scene=L,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const L=this._scene.getEngine().getCaps();this._canUseTextureForTargets=L.canUseGLVertexID&&L.textureFloat&&L.maxVertexTextureImageUnits>0&&L.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return u.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?u.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(L){this._numMaxInfluencers!==L&&(this._numMaxInfluencers=L,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(L){this._useTextureToStoreTargets!==L&&(this._useTextureToStoreTargets=L,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var L;return u.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(L=this._scene)&&void 0!==L&&L.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(L){return this._activeTargets.data[L]}getTarget(L){return this._targets[L]}getTargetByName(L){for(const r of this._targets)if(r.name===L)return r;return null}addTarget(L){this._targets.push(L),this._targetInfluenceChangedObservers.push(L.onInfluenceChanged.add((L=>{this.areUpdatesFrozen&&L&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(L)}))),this._targetDataLayoutChangedObservers.push(L._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(L){const r=this._targets.indexOf(L);r>=0&&(this._targets.splice(r,1),L.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(r,1)[0]),L._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(r,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(L)}_bind(L){L.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),L.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),L.setTexture("morphTargets",this._targetStoreTexture),L.setInt("morphTargetCount",this.numInfluencers)}clone(){const L=new u(this._scene);for(const r of this._targets)L.addTarget(r.clone());return L.enablePositionMorphing=this.enablePositionMorphing,L.enableNormalMorphing=this.enableNormalMorphing,L.enableTangentMorphing=this.enableTangentMorphing,L.enableUVMorphing=this.enableUVMorphing,L.enableUV2Morphing=this.enableUV2Morphing,L.enableColorMorphing=this.enableColorMorphing,L}serialize(){const L={};L.id=this.uniqueId,L.targets=[];for(const r of this._targets)L.targets.push(r.serialize());return L}_syncActiveTargets(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const r=!!this._targetStoreTexture,p=this.isUsingTextureForTargets;(this._mustSynchronize||r!==p)&&(this._mustSynchronize=!1,this.synchronize());let J=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let i=-1;for(const n of this._targets)if(i++,0!==n.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=u.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(n),this._morphTargetTextureIndices[J]=i,this._tempInfluences[J++]=n.influence}this._morphTargetTextureIndices.length!==J&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,J)),this._influences&&this._influences.length===J||(this._influences=new Float32Array(J));for(let n=0;n<J;n++)this._influences[n]=this._tempInfluences[n];if(L&&this._scene)for(const n of this._scene.meshes)n.morphTargetManager===this&&(p?n._markSubMeshesAsAttributesDirty():n._syncGeometryWithMorphTargetManager())}synchronize(){var L;if(!this._scene||this.areUpdatesFrozen)return;const r=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(L=this._targetStoreTexture)||void 0===L||L.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>r.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const p of this._targets){this._supportsPositions=this._supportsPositions&&p.hasPositions,this._supportsNormals=this._supportsNormals&&p.hasNormals,this._supportsTangents=this._supportsTangents&&p.hasTangents,this._supportsUVs=this._supportsUVs&&p.hasUVs,this._supportsUV2s=this._supportsUV2s&&p.hasUV2s,this._supportsColors=this._supportsColors&&p.hasColors;const L=p.vertexCount;if(0===this._vertexCount)this._vertexCount=L;else if(this._vertexCount!==L)return void b.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${p.name}": ${L}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const L=r.getCaps().maxTextureSize;this._textureWidth>L&&(this._textureHeight=Math.ceil(this._textureWidth/L),this._textureWidth=L);const p=this._targets.length,J=new Float32Array(p*this._textureWidth*this._textureHeight*4);let i=0;for(let r=0;r<p;r++){const L=this._targets[r],p=L.getPositions(),n=L.getNormals(),j=L.getUVs(),z=L.getTangents(),G=L.getUV2s(),C=L.getColors();i=r*this._textureWidth*this._textureHeight*4;for(let r=0;r<this._vertexCount;r++)this._supportsPositions&&p&&(J[i]=p[3*r],J[i+1]=p[3*r+1],J[i+2]=p[3*r+2],i+=4),this._supportsNormals&&n&&(J[i]=n[3*r],J[i+1]=n[3*r+1],J[i+2]=n[3*r+2],i+=4),this._supportsUVs&&j&&(J[i]=j[2*r],J[i+1]=j[2*r+1],i+=4),this._supportsTangents&&z&&(J[i]=z[3*r],J[i+1]=z[3*r+1],J[i+2]=z[3*r+2],i+=4),this._supportsUV2s&&G&&(J[i]=G[2*r],J[i+1]=G[2*r+1],i+=4),this._supportsColors&&C&&(J[i]=C[4*r],J[i+1]=C[4*r+1],J[i+2]=C[4*r+2],J[i+3]=C[4*r+3],i+=4)}this._targetStoreTexture=A.c.CreateRGBATexture(J,this._textureWidth,this._textureHeight,p,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const p of this._scene.meshes)p.morphTargetManager===this&&p._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const L=this._parentContainer.morphTargetManagers.indexOf(this);L>-1&&this._parentContainer.morphTargetManagers.splice(L,1),this._parentContainer=null}for(const L of this._targets)this._scene.stopAnimation(L)}}static Parse(L,r){const p=new u(r);for(const J of L.targets)p.addTarget(v.e.Parse(J,r));return p}}u.EnableTextureStorage=!0,u.MaxActiveMorphTargetsInVertexAttributeMode=8,u.ConstantTargetCountForTextureMode=0;var a=p(13779),q=p(12014),Z=p(12468);const X=new Map,D=X;function l(L,r,p){T(L)&&b.d.Warn(`Extension with the name '${L}' already exists`),X.set(L,{isGLTFExtension:r,factory:p})}function T(L){return X.delete(L)}var Y=p(13794),M=p(12714),f=p(12215);class d{static Get(L,r,p){if(!r||void 0==p||!r[p])throw new Error(`${L}: Failed to find index (${p})`);return r[p]}static TryGet(L,r){return L&&void 0!=r&&L[r]?L[r]:null}static Assign(L){if(L)for(let r=0;r<L.length;r++)L[r].index=r}}function s(L){if(L.min&&L.max){const r=L.min,p=L.max,J=i.TmpVectors.cr[0].Uz(r[0],r[1],r[2]),n=i.TmpVectors.cr[1].Uz(p[0],p[1],p[2]);if(L.normalized&&5126!==L.componentType){let r=1;switch(L.componentType){case 5120:r=127;break;case 5121:r=255;break;case 5122:r=32767;break;case 5123:r=65535}const p=1/r;J.scaleInPlace(p),n.scaleInPlace(p)}return new Z.d(J,n)}return null}class H{static RegisterExtension(L,r){l(L,!1,r)}static UnregisterExtension(L){return T(L)}get di(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(L){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=L}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((L=>L.dispose&&L.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(L,r,p,J,i,n){let j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=r,this._assetContainer=p,this._loadData(J);let n=null;if(L){const r={};if(this._gltf.nodes)for(const L of this._gltf.nodes)L.name&&(r[L.name]=L.index);n=(L instanceof Array?L:[L]).map((L=>{const p=r[L];if(void 0===p)throw new Error(`Failed to find node '${L}'`);return p}))}return await this._loadAsync(i,j,n,(()=>({meshes:this._getMeshes(),SE:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=L,this._loadData(r),await this._loadAsync(p,i,null,(()=>{}))}async _loadAsync(L,r,p,J){return await Promise.resolve().then((async()=>{this._rootUrl=L,this._uniqueRootUrl=!L.startsWith("file:")&&r?L:`${L}${Date.now()}/`,this._fileName=r,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const i=`${a.j[a.j.LOADING]} => ${a.j[a.j.READY]}`,n=`${a.j[a.j.LOADING]} => ${a.j[a.j.COMPLETE]}`;this._parent._startPerformanceCounter(i),this._parent._startPerformanceCounter(n),this._parent._setState(a.j.LOADING),this._extensionsOnLoading();const z=new Array;if(!this.parent.loadOnlyMaterials)if(p)z.push(this.loadSceneAsync("/nodes",{nodes:p,index:-1}));else if(void 0!=this._gltf.Or||this._gltf.scenes&&this._gltf.scenes[0]){const L=d.Get("/scene",this._gltf.scenes,this._gltf.Or||0);z.push(this.loadSceneAsync(`/scenes/${L.index}`,L))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let L=0;L<this._gltf.materials.length;++L){const r=this._gltf.materials[L],p="/materials/"+L,J=O.d.TriangleFillMode;z.push(this._loadMaterialAsync(p,r,null,J,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&z.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&z.push(this._compileShadowGeneratorsAsync());const G=Promise.all(z).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.kz(!0);for(const L of this._babylonScene.materials){const r=L;void 0!==r.maxSimultaneousLights&&(r.maxSimultaneousLights=Math.max(r.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(a.j.READY),this._skipStartAnimationStep||this._startAnimations(),J()}));return await G.then((L=>(this._parent._endPerformanceCounter(i),j.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(n),this._parent._setState(a.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(L=>{this._parent.onErrorObservable.notifyObservers(L),this._parent.onErrorObservable.clear(),this.dispose()}))})),L)))})).catch((L=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(L),this._parent.onErrorObservable.clear(),this.dispose()),L}))}_loadData(L){if(this._gltf=L.json,this._setupData(),L.bin){const r=this._gltf.buffers;if(r&&r[0]&&!r[0].uri){const p=r[0];(p.byteLength<L.bin.byteLength-3||p.byteLength>L.bin.byteLength)&&b.d.Warn(`Binary buffer length (${p.byteLength}) from JSON does not match chunk length (${L.bin.byteLength})`),this._bin=L.bin}else b.d.Warn("Unexpected BIN chunk")}}_setupData(){if(d.Assign(this._gltf.accessors),d.Assign(this._gltf.animations),d.Assign(this._gltf.buffers),d.Assign(this._gltf.bufferViews),d.Assign(this._gltf.cameras),d.Assign(this._gltf.images),d.Assign(this._gltf.materials),d.Assign(this._gltf.meshes),d.Assign(this._gltf.nodes),d.Assign(this._gltf.samplers),d.Assign(this._gltf.scenes),d.Assign(this._gltf.skins),d.Assign(this._gltf.textures),this._gltf.nodes){const L={};for(const p of this._gltf.nodes)if(p.children)for(const r of p.children)L[r]=p.index;const r=this._createRootNode();for(const p of this._gltf.nodes){const J=L[p.index];p.parent=void 0===J?r:this._gltf.nodes[J]}}}async _loadExtensionsAsync(){const L=[];if(D.forEach(((r,p)=>{var J;!1===(null===(J=this.parent.extensionOptions[p])||void 0===J?void 0:J.enabled)?r.isGLTFExtension&&this.isExtensionUsed(p)&&b.d.Warn(`Extension ${p} is used but has been explicitly disabled.`):r.isGLTFExtension&&!this.isExtensionUsed(p)||L.push((async()=>{const L=await r.factory(this);return L.name!==p&&b.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${L.name} !== ${p}`),this._parent.onExtensionLoadedObservable.notifyObservers(L),L})())})),this._extensions.push(...await Promise.all(L)),this._extensions.sort(((L,r)=>(L.order||Number.MAX_VALUE)-(r.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const p of this._gltf.extensionsRequired){if(!this._extensions.some((L=>L.name===p&&L.enabled))){var r;if(!1===(null===(r=this.parent.extensionOptions[p])||void 0===r?void 0:r.enabled))throw new Error(`Required extension ${p} is disabled`);throw new Error(`Required extension ${p} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new e.c("__root__",this._babylonScene);this._rootBabylonMesh=L,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.kz(!1);const r={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case a.h.AUTO:this._babylonScene.useRightHandedSystem||(r.rotation=[0,1,0,0],r.scale=[1,1,-1],H._LoadTransform(r,this._rootBabylonMesh));break;case a.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(L),r}loadSceneAsync(L,r){const p=this._extensionsLoadSceneAsync(L,r);if(p)return p;const J=new Array;if(this.logOpen(`${L} ${r.name||""}`),r.nodes)for(const i of r.nodes){const r=d.Get(`${L}/nodes/${i}`,this._gltf.nodes,i);J.push(this.loadNodeAsync(`/nodes/${r.index}`,r,(L=>{L.parent=this._rootBabylonMesh})))}for(const i of this._postSceneLoadActions)i();return J.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(J).then((()=>{}))}_forEachPrimitive(L,r){if(L._primitiveBabylonMeshes)for(const p of L._primitiveBabylonMeshes)r(p)}_getGeometries(){const L=[],r=this._gltf.nodes;if(r)for(const p of r)this._forEachPrimitive(p,(r=>{const p=r.Pz;p&&-1===L.indexOf(p)&&L.push(p)}));return L}_getMeshes(){const L=[];this._rootBabylonMesh instanceof Q.c&&L.push(this._rootBabylonMesh);const r=this._gltf.nodes;if(r)for(const p of r)this._forEachPrimitive(p,(r=>{L.push(r)}));return L}_getTransformNodes(){const L=[],r=this._gltf.nodes;if(r)for(const p of r)p._babylonTransformNode&&"Jg"===p._babylonTransformNode.getClassName()&&L.push(p._babylonTransformNode),p._babylonTransformNodeForSkin&&L.push(p._babylonTransformNodeForSkin);return L}_getSkeletons(){const L=[],r=this._gltf.skins;if(r)for(const p of r)p._data&&L.push(p._data.babylonSkeleton);return L}_getAnimationGroups(){const L=[],r=this._gltf.animations;if(r)for(const p of r)p._babylonAnimationGroup&&L.push(p._babylonAnimationGroup);return L}_startAnimations(){switch(this._parent.animationStartMode){case a.e.NONE:break;case a.e.FIRST:{const L=this._getAnimationGroups();0!==L.length&&L[0].start(!0);break}case a.e.ALL:{const L=this._getAnimationGroups();for(const r of L)r.start(!0);break}default:return void b.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadNodeAsync(L,r,p);if(J)return J;if(r._babylonTransformNode)throw new Error(`${L}: Invalid recursive node hierarchy`);const i=new Array;this.logOpen(`${L} ${r.name||""}`);const n=J=>{if(H.AddPointerMetadata(J,L),H._LoadTransform(r,J),void 0!=r.camera){const p=d.Get(`${L}/camera`,this._gltf.cameras,r.camera);i.push(this.loadCameraAsync(`/cameras/${p.index}`,p,(L=>{L.parent=J,this._babylonScene.useRightHandedSystem||(J.Wz.x=-1)})))}if(r.children)for(const p of r.children){const r=d.Get(`${L}/children/${p}`,this._gltf.nodes,p);i.push(this.loadNodeAsync(`/nodes/${r.index}`,r,(L=>{L.parent=J})))}p(J)},j=void 0!=r.mesh,z=this._parent.loadSkins&&void 0!=r.skin;if(!j||z){const L=r.name||`node${r.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new W.e(L,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==r.mesh?r._babylonTransformNode=p:r._babylonTransformNodeForSkin=p,n(p)}if(j)if(z){const p=d.Get(`${L}/mesh`,this._gltf.meshes,r.mesh);i.push(this._loadMeshAsync(`/meshes/${p.index}`,r,p,(p=>{const J=r._babylonTransformNodeForSkin;p.metadata=(0,M.d)(J.metadata,p.metadata||{});const n=d.Get(`${L}/skin`,this._gltf.skins,r.skin);i.push(this._loadSkinAsync(`/skins/${n.index}`,r,n,(L=>{this._forEachPrimitive(r,(r=>{r.skeleton=L})),this._postSceneLoadActions.push((()=>{if(void 0!=n.skeleton){const L=d.Get(`/skins/${n.index}/skeleton`,this._gltf.nodes,n.skeleton).parent;r.index===L.index?p.parent=J.parent:p.parent=L._babylonTransformNode}else p.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:J,skinnedNode:p})}))})))})))}else{const p=d.Get(`${L}/mesh`,this._gltf.meshes,r.mesh);i.push(this._loadMeshAsync(`/meshes/${p.index}`,r,p,n))}return this.logClose(),Promise.all(i).then((()=>(this._forEachPrimitive(r,(L=>{const r=L;!r.isAnInstance&&r.Pz&&r.Pz.useBoundingInfoFromGeometry?L.ZL():L.refreshBoundingInfo(!0,!0)})),r._babylonTransformNode)))}_loadMeshAsync(L,r,p,J){const i=p.primitives;if(!i||!i.length)throw new Error(`${L}: Primitives are missing`);void 0==i[0].index&&d.Assign(i);const n=new Array;this.logOpen(`${L} ${p.name||""}`);const j=r.name||`node${r.index}`;if(1===i.length){const J=p.primitives[0];n.push(this._loadMeshPrimitiveAsync(`${L}/primitives/${J.index}`,j,r,p,J,(L=>{r._babylonTransformNode=L,r._primitiveBabylonMeshes=[L]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,r._babylonTransformNode=new W.e(j,this._babylonScene),r._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r._primitiveBabylonMeshes=[];for(const J of i)n.push(this._loadMeshPrimitiveAsync(`${L}/primitives/${J.index}`,`${j}_primitive${J.index}`,r,p,J,(L=>{L.parent=r._babylonTransformNode,r._primitiveBabylonMeshes.push(L)})))}return J(r._babylonTransformNode),this.logClose(),Promise.all(n).then((()=>r._babylonTransformNode))}_loadMeshPrimitiveAsync(L,r,p,J,i,n){const j=this._extensionsLoadMeshPrimitiveAsync(L,r,p,J,i,n);if(j)return j;this.logOpen(`${L}`);const z=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==p.skin&&!J.primitives[0].targets;let G,C;if(z&&i._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,G=i._instanceData.babylonSourceMesh.createInstance(r),G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C=i._instanceData.promise;else{const n=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new e.c(r,this._babylonScene);j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j.sideOrientation=this._babylonScene.useRightHandedSystem?O.d.CounterClockWiseSideOrientation:O.d.ClockWiseSideOrientation,this._createMorphTargets(L,p,J,i,j),n.push(this._loadVertexDataAsync(L,i,j).then((async r=>await this._loadMorphTargetsAsync(L,i,j,r).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,r.aL(j),r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const t=H._GetDrawMode(L,i.mode);if(void 0==i.material){let L=this._defaultBabylonMaterialData[t];L||(L=this._createDefaultMaterial("__GLTFLoader._default",t),this._parent.onMaterialLoadedObservable.notifyObservers(L),this._defaultBabylonMaterialData[t]=L),j.material=L}else if(!this.parent.skipMaterials){const r=d.Get(`${L}/material`,this._gltf.materials,i.material);n.push(this._loadMaterialAsync(`/materials/${r.index}`,r,j,t,(L=>{j.material=L})))}C=Promise.all(n),z&&(i._instanceData={babylonSourceMesh:j,promise:C}),G=j}return H.AddPointerMetadata(G,L),this._parent.onMeshLoadedObservable.notifyObservers(G),n(G),this.logClose(),C.then((()=>G))}_loadVertexDataAsync(L,r,p){const J=this._extensionsLoadVertexDataAsync(L,r,p);if(J)return J;const i=r.attributes;if(!i)throw new Error(`${L}: Attributes are missing`);const n=new Array,j=new F.d(p.name,this._babylonScene);if(void 0==r.indices)p.isUnIndexed=!0;else{const p=d.Get(`${L}/indices`,this._gltf.accessors,r.indices);n.push(this._loadIndicesAccessorAsync(`/accessors/${p.index}`,p).then((L=>{j.setIndices(L)})))}const z=(r,J,z)=>{if(void 0==i[r])return;p._delayInfo=p._delayInfo||[],-1===p._delayInfo.indexOf(J)&&p._delayInfo.push(J);const G=d.Get(`${L}/attributes/${r}`,this._gltf.accessors,i[r]);n.push(this._loadVertexAccessorAsync(`/accessors/${G.index}`,G,J).then((L=>{if(L.getKind()===B.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!p.skeleton){const L=s(G);L&&(j._boundingInfo=L,j.useBoundingInfoFromGeometry=!0)}j.setVerticesBuffer(L,G.count)}))),J==B.e.MatricesIndicesExtraKind&&(p.numBoneInfluencers=8),z&&z(G)};return z("POSITION",B.e.PositionKind),z("NORMAL",B.e.NormalKind),z("TANGENT",B.e.TangentKind),z("TEXCOORD_0",B.e.UVKind),z("TEXCOORD_1",B.e.UV2Kind),z("TEXCOORD_2",B.e.UV3Kind),z("TEXCOORD_3",B.e.UV4Kind),z("TEXCOORD_4",B.e.UV5Kind),z("TEXCOORD_5",B.e.UV6Kind),z("JOINTS_0",B.e.MatricesIndicesKind),z("WEIGHTS_0",B.e.MatricesWeightsKind),z("JOINTS_1",B.e.MatricesIndicesExtraKind),z("WEIGHTS_1",B.e.MatricesWeightsExtraKind),z("COLOR_0",B.e.ColorKind,(L=>{"VEC4"===L.type&&(p.hasVertexAlpha=!0)})),Promise.all(n).then((()=>j))}_createMorphTargets(L,r,p,J,i){if(!J.targets||!this._parent.loadMorphTargets)return;if(void 0==r._numMorphTargets)r._numMorphTargets=J.targets.length;else if(J.targets.length!==r._numMorphTargets)throw new Error(`${L}: Primitives do not have the same number of targets`);const n=p.extras?p.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,i.morphTargetManager=new u(this._babylonScene),i.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.morphTargetManager.areUpdatesFrozen=!0;for(let j=0;j<J.targets.length;j++){const L=r.weights?r.weights[j]:p.weights?p.weights[j]:0,J=n?n[j]:`morphTarget${j}`;i.morphTargetManager.addTarget(new v.e(J,L,i.FL()))}}_loadMorphTargetsAsync(L,r,p,J){if(!r.targets||!this._parent.loadMorphTargets)return Promise.resolve();const i=new Array,n=p.morphTargetManager;for(let j=0;j<n.numTargets;j++){const p=n.getTarget(j);i.push(this._loadMorphTargetVertexDataAsync(`${L}/targets/${j}`,J,r.targets[j],p))}return Promise.all(i).then((()=>{n.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(L,r,p,J){const i=new Array,n=(J,n,j)=>{if(void 0==p[J])return;const z=r.getVertexBuffer(n);if(!z)return;const G=d.Get(`${L}/${J}`,this._gltf.accessors,p[J]);i.push(this._loadFloatAccessorAsync(`/accessors/${G.index}`,G).then((L=>{j(z,L)})))};return n("POSITION",B.e.PositionKind,((L,r)=>{const p=new Float32Array(r.length);L.forEach(r.length,((L,J)=>{p[J]=r[J]+L})),J.setPositions(p)})),n("NORMAL",B.e.NormalKind,((L,r)=>{const p=new Float32Array(r.length);L.forEach(p.length,((L,J)=>{p[J]=r[J]+L})),J.setNormals(p)})),n("TANGENT",B.e.TangentKind,((L,r)=>{const p=new Float32Array(r.length/3*4);let i=0;L.forEach(r.length/3*4,((L,J)=>{(J+1)%4!==0&&(p[i]=r[i]+L,i++)})),J.setTangents(p)})),n("TEXCOORD_0",B.e.UVKind,((L,r)=>{const p=new Float32Array(r.length);L.forEach(r.length,((L,J)=>{p[J]=r[J]+L})),J.setUVs(p)})),n("TEXCOORD_1",B.e.UV2Kind,((L,r)=>{const p=new Float32Array(r.length);L.forEach(r.length,((L,J)=>{p[J]=r[J]+L})),J.setUV2s(p)})),n("COLOR_0",B.e.ColorKind,((r,p)=>{let i=null;const n=r.getSize();if(3===n){i=new Float32Array(p.length/3*4),r.forEach(p.length,((L,r)=>{const J=Math.floor(r/3),n=r%3;i[4*J+n]=p[3*J+n]+L}));for(let L=0;L<p.length/3;++L)i[4*L+3]=1}else{if(4!==n)throw new Error(`${L}: Invalid number of components (${n}) for COLOR_0 attribute`);i=new Float32Array(p.length),r.forEach(p.length,((L,r)=>{i[r]=p[r]+L}))}J.setColors(i)})),await Promise.all(i).then((()=>{}))}static _LoadTransform(L,r){if(void 0!=L.skin)return;let p=i.cr.Zero(),J=i.Quaternion.Identity(),n=i.cr.One();if(L.matrix){i.Matrix.Br(L.matrix).decompose(n,J,p)}else L.translation&&(p=i.cr.Br(L.translation)),L.rotation&&(J=i.Quaternion.Br(L.rotation)),L.scale&&(n=i.cr.Br(L.scale));r.position=p,r.rotationQuaternion=J,r.Wz=n}_loadSkinAsync(L,r,p,J){if(!this._parent.loadSkins)return Promise.resolve();const i=this._extensionsLoadSkinAsync(L,r,p);if(i)return i;if(p._data)return J(p._data.babylonSkeleton),p._data.promise;const n=`skeleton${p.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new P(p.name||n,n,this._babylonScene);j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(L,p,j);const z=this._loadSkinInverseBindMatricesDataAsync(L,p).then((L=>{this._updateBoneMatrices(j,L)}));return p._data={babylonSkeleton:j,promise:z},J(j),z}_loadBones(L,r,p){if(void 0==r.skeleton||this._parent.alwaysComputeSkeletonRootNode){const p=this._findSkeletonRootNode(`${L}/joints`,r.joints);if(p)if(void 0===r.skeleton)r.skeleton=p.index;else{const J=(L,r)=>{for(;r.parent;r=r.parent)if(r.parent===L)return!0;return!1},i=d.Get(`${L}/skeleton`,this._gltf.nodes,r.skeleton);i===p||J(i,p)||(b.d.Warn(`${L}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),r.skeleton=p.index)}else b.d.Warn(`${L}: Failed to find common root`)}const J={};for(const i of r.joints){const n=d.Get(`${L}/joints/${i}`,this._gltf.nodes,i);this._loadBone(n,r,p,J)}}_findSkeletonRootNode(L,r){if(0===r.length)return null;const p={};for(const i of r){const r=[];let J=d.Get(`${L}/${i}`,this._gltf.nodes,i);for(;-1!==J.index;)r.unshift(J),J=J.parent;p[i]=r}let J=null;for(let i=0;;++i){let L=p[r[0]];if(i>=L.length)return J;const n=L[i];for(let j=1;j<r.length;++j)if(L=p[r[j]],i>=L.length||n!==L[i])return J;J=n}}_loadBone(L,r,p,J){L._isJoint=!0;let i=J[L.index];if(i)return i;let n=null;L.index!==r.skeleton&&(L.parent&&-1!==L.parent.index?n=this._loadBone(L.parent,r,p,J):void 0!==r.skeleton&&b.d.Warn(`/skins/${r.index}/skeleton: Skeleton node is not a common root`));const j=r.joints.indexOf(L.index);return i=new C.e(L.name||`joint${L.index}`,p,n,this._getNodeMatrix(L),null,null,j),J[L.index]=i,this._postSceneLoadActions.push((()=>{i.linkTransformNode(L._babylonTransformNode)})),i}_loadSkinInverseBindMatricesDataAsync(L,r){if(void 0==r.inverseBindMatrices)return Promise.resolve(null);const p=d.Get(`${L}/inverseBindMatrices`,this._gltf.accessors,r.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${p.index}`,p)}_updateBoneMatrices(L,r){for(const p of L.bones){const L=i.Matrix.Identity(),J=p._index;r&&-1!==J&&(i.Matrix.FromArrayToRef(r,16*J,L),L.invertToRef(L));const n=p.getParent();n&&L.multiplyToRef(n.getAbsoluteInverseBindMatrix(),L),p.tz(L,!1,!1),p._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(L){return L.matrix?i.Matrix.Br(L.matrix):i.Matrix.Compose(L.scale?i.cr.Br(L.scale):i.cr.One(),L.rotation?i.Quaternion.Br(L.rotation):i.Quaternion.Identity(),L.translation?i.cr.Br(L.translation):i.cr.Zero())}loadCameraAsync(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadCameraAsync(L,r,p);if(J)return J;const n=new Array;this.logOpen(`${L} ${r.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new G.d(r.name||`camera${r.index}`,i.cr.Zero(),this._babylonScene,!1);switch(j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r._babylonCamera=j,j.setTarget(new i.cr(0,0,-1)),r.type){case"perspective":{const p=r.perspective;if(!p)throw new Error(`${L}: Camera perspective properties are missing`);j.fov=p.yfov,j.nz=p.znear,j.maxZ=p.zfar||0;break}case"orthographic":if(!r.orthographic)throw new Error(`${L}: Camera orthographic properties are missing`);j.mode=z.b.ORTHOGRAPHIC_CAMERA,j.orthoLeft=-r.orthographic.xmag,j.orthoRight=r.orthographic.xmag,j.orthoBottom=-r.orthographic.ymag,j.orthoTop=r.orthographic.ymag,j.nz=r.orthographic.znear,j.maxZ=r.orthographic.zfar;break;default:throw new Error(`${L}: Invalid camera type (${r.type})`)}return H.AddPointerMetadata(j,L),this._parent.onCameraLoadedObservable.notifyObservers(j),p(j),this.logClose(),Promise.all(n).then((()=>j))}_loadAnimationsAsync(){const L=this._gltf.animations;if(!L)return Promise.resolve();const r=new Array;for(let p=0;p<L.length;p++){const J=L[p];r.push(this.loadAnimationAsync(`/animations/${J.index}`,J).then((L=>{0===L.targetedAnimations.length&&L.dispose()})))}return Promise.all(r).then((()=>{}))}loadAnimationAsync(L,r){const J=this._extensionsLoadAnimationAsync(L,r);return J||p.e(78).then(p.bind(p,15273)).then((p=>{let{AnimationGroup:J}=p;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new J(r.name||`animation${r.index}`,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r._babylonAnimationGroup=i;const n=new Array;d.Assign(r.channels),d.Assign(r.samplers);for(const j of r.channels)n.push(this._loadAnimationChannelAsync(`${L}/channels/${j.index}`,L,r,j,((L,r)=>{L.animations=L.animations||[],L.animations.push(r),i.addTargetedAnimation(r,L)})));return Promise.all(n).then((()=>(i.normalize(0),i)))}))}async _loadAnimationChannelAsync(L,r,J,i,n){const j=this._extensionsLoadAnimationChannelAsync(L,r,J,i,n);if(j)return await j;if(void 0==i.target.node)return await Promise.resolve();const z=d.Get(`${L}/target/node`,this._gltf.nodes,i.target.node),G=i.target.path,C="weights"===G;if(C&&!z._numMorphTargets||!C&&!z._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!C&&!z._isJoint)return await Promise.resolve();let t;switch(await Promise.resolve().then(p.bind(p,13807)),G){case"translation":var E;t=null===(E=(0,Y.h)("/nodes/{}/translation"))||void 0===E?void 0:E.interpolation;break;case"rotation":var x;t=null===(x=(0,Y.h)("/nodes/{}/rotation"))||void 0===x?void 0:x.interpolation;break;case"scale":var w;t=null===(w=(0,Y.h)("/nodes/{}/scale"))||void 0===w?void 0:w.interpolation;break;case"weights":var g;t=null===(g=(0,Y.h)("/nodes/{}/weights"))||void 0===g?void 0:g.interpolation;break;default:throw new Error(`${L}/target/path: Invalid value (${i.target.path})`)}if(!t)throw new Error(`${L}/target/path: Could not find interpolation properties for target path (${i.target.path})`);const b={object:z,info:t};return await this._loadAnimationChannelFromTargetInfoAsync(L,r,J,i,b,n)}_loadAnimationChannelFromTargetInfoAsync(L,r,p,J,i,n){const j=this.parent.targetFps,z=1/j,G=d.Get(`${L}/sampler`,p.samplers,J.sampler);return this._loadAnimationSamplerAsync(`${r}/samplers/${J.sampler}`,G).then((L=>{let r=0;const G=i.object,C=i.info;for(const i of C){const C=i.getStride(G),t=L.input,E=L.output,x=new Array(t.length);let w=0;switch(L.interpolation){case"STEP":for(let L=0;L<t.length;L++){const r=i.getValue(G,E,w,1);w+=C,x[L]={frame:t[L]*j,value:r,interpolation:1}}break;case"CUBICSPLINE":for(let L=0;L<t.length;L++){const r=i.getValue(G,E,w,z);w+=C;const p=i.getValue(G,E,w,1);w+=C;const J=i.getValue(G,E,w,z);w+=C,x[L]={frame:t[L]*j,inTangent:r,value:p,outTangent:J}}break;case"LINEAR":for(let L=0;L<t.length;L++){const r=i.getValue(G,E,w,1);w+=C,x[L]={frame:t[L]*j,value:r}}}if(w>0){const L=`${p.name||`animation${p.index}`}_channel${J.index}_${r}`,z=i.buildAnimations(G,L,j,x);for(const p of z)r++,n(p.babylonAnimatable,p.babylonAnimation)}}}))}_loadAnimationSamplerAsync(L,r){if(r._data)return r._data;const p=r.interpolation||"LINEAR";switch(p){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${L}/interpolation: Invalid value (${r.interpolation})`)}const J=d.Get(`${L}/input`,this._gltf.accessors,r.input),i=d.Get(`${L}/output`,this._gltf.accessors,r.output);return r._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${J.index}`,J),this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)]).then((L=>{let[r,J]=L;return{input:r,interpolation:p,output:J}})),r._data}loadBufferAsync(L,r,p,J){const i=this._extensionsLoadBufferAsync(L,r,p,J);if(i)return i;if(!r._data)if(r.uri)r._data=this.loadUriAsync(`${L}/uri`,r,r.uri);else{if(!this._bin)throw new Error(`${L}: Uri is missing or the binary glTF is missing its binary chunk`);r._data=this._bin.readAsync(0,r.byteLength)}return r._data.then((r=>{try{return new Uint8Array(r.buffer,r.byteOffset+p,J)}catch(i){throw new Error(`${L}: ${i.message}`)}}))}loadBufferViewAsync(L,r){const p=this._extensionsLoadBufferViewAsync(L,r);if(p)return p;if(r._data)return r._data;const J=d.Get(`${L}/buffer`,this._gltf.buffers,r.buffer);return r._data=this.loadBufferAsync(`/buffers/${J.index}`,J,r.byteOffset||0,r.byteLength),r._data}_loadAccessorAsync(L,r,p){if(r._data)return r._data;const J=H._GetNumComponents(L,r.type),i=J*B.e.GetTypeByteLength(r.componentType),n=J*r.count;if(void 0==r.bufferView)r._data=Promise.resolve(new p(n));else{const j=d.Get(`${L}/bufferView`,this._gltf.bufferViews,r.bufferView);r._data=this.loadBufferViewAsync(`/bufferViews/${j.index}`,j).then((z=>{if(5126!==r.componentType||r.normalized||j.byteStride&&j.byteStride!==i){const L=new p(n);return B.e.ForEach(z,r.byteOffset||0,j.byteStride||i,J,r.componentType,L.length,r.normalized||!1,((r,p)=>{L[p]=r})),L}return H._GetTypedArray(L,r.componentType,z,r.byteOffset,n)}))}if(r.sparse){const n=r.sparse;r._data=r._data.then((j=>{const z=j,G=d.Get(`${L}/sparse/indices/bufferView`,this._gltf.bufferViews,n.indices.bufferView),C=d.Get(`${L}/sparse/values/bufferView`,this._gltf.bufferViews,n.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${G.index}`,G),this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)]).then((j=>{let[G,C]=j;const t=H._GetTypedArray(`${L}/sparse/indices`,n.indices.componentType,G,n.indices.byteOffset,n.count),E=J*n.count;let x;if(5126!==r.componentType||r.normalized){const j=H._GetTypedArray(`${L}/sparse/values`,r.componentType,C,n.values.byteOffset,E);x=new p(E),B.e.ForEach(j,0,i,J,r.componentType,x.length,r.normalized||!1,((L,r)=>{x[r]=L}))}else x=H._GetTypedArray(`${L}/sparse/values`,r.componentType,C,n.values.byteOffset,E);let w=0;for(let L=0;L<t.length;L++){let r=t[L]*J;for(let L=0;L<J;L++)z[r++]=x[w++]}return z}))}))}return r._data}_loadFloatAccessorAsync(L,r){return this._loadAccessorAsync(L,r,Float32Array)}_loadIndicesAccessorAsync(L,r){if("SCALAR"!==r.type)throw new Error(`${L}/type: Invalid value ${r.type}`);if(5121!==r.componentType&&5123!==r.componentType&&5125!==r.componentType)throw new Error(`${L}/componentType: Invalid value ${r.componentType}`);if(r._data)return r._data;if(r.sparse){const p=H._GetTypedArrayConstructor(`${L}/componentType`,r.componentType);r._data=this._loadAccessorAsync(L,r,p)}else{const p=d.Get(`${L}/bufferView`,this._gltf.bufferViews,r.bufferView);r._data=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((p=>H._GetTypedArray(L,r.componentType,p,r.byteOffset,r.count)))}return r._data}_loadVertexBufferViewAsync(L){if(L._babylonBuffer)return L._babylonBuffer;const r=this._babylonScene.getEngine();return L._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((L=>new B.b(r,L,!1))),L._babylonBuffer}_loadVertexAccessorAsync(L,r,p){var J;if(null!==(J=r._babylonVertexBuffer)&&void 0!==J&&J[p])return r._babylonVertexBuffer[p];r._babylonVertexBuffer||(r._babylonVertexBuffer={});const i=this._babylonScene.getEngine();if(r.sparse||void 0==r.bufferView)r._babylonVertexBuffer[p]=this._loadFloatAccessorAsync(L,r).then((L=>new B.e(i,L,p,!1)));else{const J=d.Get(`${L}/bufferView`,this._gltf.bufferViews,r.bufferView);r._babylonVertexBuffer[p]=this._loadVertexBufferViewAsync(J).then((n=>{const j=H._GetNumComponents(L,r.type);return new B.e(i,n,p,!1,void 0,J.byteStride,void 0,r.byteOffset,j,r.componentType,r.normalized,!0,void 0,!0)}))}return r._babylonVertexBuffer[p]}_loadMaterialMetallicRoughnessPropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;return r&&(r.baseColorFactor?(p.albedoColor=n.Wr.Br(r.baseColorFactor),p.alpha=r.baseColorFactor[3]):p.albedoColor=n.Wr.White(),p.metallic=void 0==r.metallicFactor?1:r.metallicFactor,p.roughness=void 0==r.roughnessFactor?1:r.roughnessFactor,r.baseColorTexture&&J.push(this.loadTextureInfoAsync(`${L}/baseColorTexture`,r.baseColorTexture,(L=>{L.name=`${p.name} (Base Color)`,p.albedoTexture=L}))),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${L}/metallicRoughnessTexture`,r.metallicRoughnessTexture,(L=>{L.name=`${p.name} (Metallic Roughness)`,p.metallicTexture=L}))),p.useMetallnessFromMetallicTextureBlue=!0,p.useRoughnessFromMetallicTextureGreen=!0,p.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(J).then((()=>{}))}_loadMaterialAsync(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const n=this._extensionsLoadMaterialAsync(L,r,p,J,i);if(n)return n;r._data=r._data||{};let j=r._data[J];if(!j){this.logOpen(`${L} ${r.name||""}`);const p=this.createMaterial(L,r,J);j={babylonMaterial:p,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(L,r,p)},r._data[J]=j,H.AddPointerMetadata(p,L),this._parent.onMaterialLoadedObservable.notifyObservers(p),this.logClose()}return p&&(j.babylonMeshes.push(p),p.ji.addOnce((()=>{const L=j.babylonMeshes.indexOf(p);-1!==L&&j.babylonMeshes.splice(L,1)}))),i(j.babylonMaterial),j.promise.then((()=>j.babylonMaterial))}_createDefaultMaterial(L,r){this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new h.b(L,this._babylonScene);return p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.fillMode=r,p.enableSpecularAntiAliasing=!0,p.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,p.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,p.transparencyMode=h.b.PBRMATERIAL_OPAQUE,p.metallic=1,p.roughness=1,p}createMaterial(L,r,p){const J=this._extensionsCreateMaterial(L,r,p);if(J)return J;const i=r.name||`material${r.index}`;return this._createDefaultMaterial(i,p)}loadMaterialPropertiesAsync(L,r,p){const J=this._extensionsLoadMaterialPropertiesAsync(L,r,p);if(J)return J;const i=new Array;return i.push(this.loadMaterialBasePropertiesAsync(L,r,p)),r.pbrMetallicRoughness&&i.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${L}/pbrMetallicRoughness`,r.pbrMetallicRoughness,p)),this.loadMaterialAlphaProperties(L,r,p),Promise.all(i).then((()=>{}))}loadMaterialBasePropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;return p.emissiveColor=r.emissiveFactor?n.Wr.Br(r.emissiveFactor):new n.Wr(0,0,0),r.doubleSided&&(p.hz=!1,p.twoSidedLighting=!0),r.normalTexture&&(r.normalTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${L}/normalTexture`,r.normalTexture,(L=>{L.name=`${p.name} (Normal)`,p.bumpTexture=L}))),p.invertNormalMapX=!this._babylonScene.useRightHandedSystem,p.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=r.normalTexture.scale&&p.bumpTexture&&(p.bumpTexture.level=r.normalTexture.scale),p.forceIrradianceInFragment=!0),r.occlusionTexture&&(r.occlusionTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${L}/occlusionTexture`,r.occlusionTexture,(L=>{L.name=`${p.name} (Occlusion)`,p.ambientTexture=L}))),p.useAmbientInGrayScale=!0,void 0!=r.occlusionTexture.strength&&(p.ambientTextureStrength=r.occlusionTexture.strength)),r.emissiveTexture&&J.push(this.loadTextureInfoAsync(`${L}/emissiveTexture`,r.emissiveTexture,(L=>{L.name=`${p.name} (Emissive)`,p.emissiveTexture=L}))),Promise.all(J).then((()=>{}))}loadMaterialAlphaProperties(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);switch(r.alphaMode||"OPAQUE"){case"OPAQUE":p.transparencyMode=h.b.PBRMATERIAL_OPAQUE,p.alpha=1;break;case"MASK":p.transparencyMode=h.b.PBRMATERIAL_ALPHATEST,p.alphaCutOff=void 0==r.alphaCutoff?.5:r.alphaCutoff,p.albedoTexture&&(p.albedoTexture.pz=!0);break;case"BLEND":p.transparencyMode=h.b.PBRMATERIAL_ALPHABLEND,p.albedoTexture&&(p.albedoTexture.pz=!0,p.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${L}/alphaMode: Invalid value (${r.alphaMode})`)}}loadTextureInfoAsync(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureInfoAsync(L,r,p);if(J)return J;if(this.logOpen(`${L}`),r.texCoord>=6)throw new Error(`${L}/texCoord: Invalid value (${r.texCoord})`);const i=d.Get(`${L}/index`,this._gltf.textures,r.index);i._textureInfo=r;const n=this._loadTextureAsync(`/textures/${r.index}`,i,(J=>{J.coordinatesIndex=r.texCoord||0,H.AddPointerMetadata(J,L),this._parent.onTextureLoadedObservable.notifyObservers(J),p(J)}));return this.logClose(),n}_loadTextureAsync(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureAsync(L,r,p);if(J)return J;this.logOpen(`${L} ${r.name||""}`);const i=void 0==r.sampler?H.DefaultSampler:d.Get(`${L}/sampler`,this._gltf.samplers,r.sampler),n=d.Get(`${L}/source`,this._gltf.images,r.source),j=this._createTextureAsync(L,i,n,p,void 0,!r._textureInfo.nonColorData);return this.logClose(),j}_createTextureAsync(L,r,p){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},n=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0;const z=this._loadSampler(`/samplers/${r.index}`,r),G=new Array,C=new J;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t={noMipmap:z.noMipMaps,invertY:!1,samplingMode:z.samplingMode,mL:()=>{this._disposed||C.resolve()},onError:(r,p)=>{this._disposed||C.reject(new Error(`${L}: ${p&&p.message?p.message:r||"Failed to load texture"}`))},mimeType:p.mimeType??(0,q.i)(p.uri??""),loaderOptions:n,useSRGBBuffer:!!j&&this._parent.useSRGBBuffers},E=new U.c(null,this._babylonScene,t);return E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.push(C.promise),G.push(this.loadImageAsync(`/images/${p.index}`,p).then((L=>{const r=p.uri||`${this._fileName}#image${p.index}`,J=`data:${this._uniqueRootUrl}${r}`;E.updateURL(J,L);const i=E.getInternalTexture();i&&(i.label=p.name)}))),E.wrapU=z.wrapU,E.wrapV=z.wrapV,i(E),this._parent.useGltfTextureNames&&(E.name=p.name||p.uri||`image${p.index}`),Promise.all(G).then((()=>E))}_loadSampler(L,r){return r._data||(r._data={noMipMaps:9728===r.minFilter||9729===r.minFilter,samplingMode:H._GetTextureSamplingMode(L,r),wrapU:H._GetTextureWrapMode(`${L}/wrapS`,r.wrapS),wrapV:H._GetTextureWrapMode(`${L}/wrapT`,r.wrapT)}),r._data}loadImageAsync(L,r){if(!r._data){if(this.logOpen(`${L} ${r.name||""}`),r.uri)r._data=this.loadUriAsync(`${L}/uri`,r,r.uri);else{const p=d.Get(`${L}/bufferView`,this._gltf.bufferViews,r.bufferView);r._data=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p)}this.logClose()}return r._data}loadUriAsync(L,r,p){const J=this._extensionsLoadUriAsync(L,r,p);if(J)return J;if(!H._ValidateUri(p))throw new Error(`${L}: '${p}' is invalid`);if((0,q.j)(p)){const r=new Uint8Array((0,q.e)(p));return this.log(`${L}: Decoded ${p.substring(0,64)}... (${r.length} bytes)`),Promise.resolve(r)}return this.log(`${L}: Loading ${p}`),this._parent.preprocessUrlAsync(this._rootUrl+p).then((r=>new Promise(((J,i)=>{this._parent._loadFile(this._babylonScene,r,(r=>{this._disposed||(this.log(`${L}: Loaded ${p} (${r.byteLength} bytes)`),J(new Uint8Array(r)))}),!0,(r=>{i(new q.m(`${L}: Failed to load '${p}'${r?": "+r.status+" "+r.statusText:""}`,r))}))}))))}static AddPointerMetadata(L,r){L.metadata=L.metadata||{};const p=L._internalMetadata=L._internalMetadata||{},J=p.di=p.di||{};(J.pointers=J.pointers||[]).push(r)}static _GetTextureWrapMode(L,r){switch(r=void 0==r?10497:r){case 33071:return U.c.CLAMP_ADDRESSMODE;case 33648:return U.c.MIRROR_ADDRESSMODE;case 10497:return U.c.WRAP_ADDRESSMODE;default:return b.d.Warn(`${L}: Invalid value (${r})`),U.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(L,r){const p=void 0==r.magFilter?9729:r.magFilter,J=void 0==r.minFilter?9987:r.minFilter;if(9729===p)switch(J){case 9728:return U.c.LINEAR_NEAREST;case 9729:return U.c.LINEAR_LINEAR;case 9984:return U.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return U.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return U.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return U.c.LINEAR_LINEAR_MIPLINEAR;default:return b.d.Warn(`${L}/minFilter: Invalid value (${J})`),U.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==p&&b.d.Warn(`${L}/magFilter: Invalid value (${p})`),J){case 9728:return U.c.NEAREST_NEAREST;case 9729:return U.c.NEAREST_LINEAR;case 9984:return U.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return U.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return U.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return U.c.NEAREST_LINEAR_MIPLINEAR;default:return b.d.Warn(`${L}/minFilter: Invalid value (${J})`),U.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(L,r){try{return(0,f.s)(r)}catch(p){throw new Error(`${L}: ${p.message}`)}}static _GetTypedArray(L,r,p,J,i){const n=p.buffer;J=p.byteOffset+(J||0);const j=H._GetTypedArrayConstructor(`${L}/componentType`,r),z=B.e.GetTypeByteLength(r);return J%z!==0?(b.d.Warn(`${L}: Copying buffer as byte offset (${J}) is not a multiple of component type byte length (${z})`),new j(n.slice(J,J+i*z),0)):new j(n,J,i)}static _GetNumComponents(L,r){switch(r){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${L}: Invalid type (${r})`)}static _ValidateUri(L){return j.Tools.IsBase64(L)||-1===L.indexOf("..")}static _GetDrawMode(L,r){switch(void 0==r&&(r=4),r){case 0:return O.d.PointListDrawMode;case 1:return O.d.LineListDrawMode;case 2:return O.d.LineLoopDrawMode;case 3:return O.d.LineStripDrawMode;case 4:return O.d.TriangleFillMode;case 5:return O.d.TriangleStripDrawMode;case 6:return O.d.TriangleFanDrawMode}throw new Error(`${L}: Invalid mesh primitive mode (${r})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const L=new Array;if(this._gltf.materials)for(const r of this._gltf.materials)if(r._data)for(const p in r._data){const J=r._data[p];for(const r of J.babylonMeshes){r.cz(!0);const p=J.babylonMaterial;L.push(p.forceCompilationAsync(r)),L.push(p.forceCompilationAsync(r,{useInstances:!0})),this._parent.useClipPlane&&(L.push(p.forceCompilationAsync(r,{clipPlane:!0})),L.push(p.forceCompilationAsync(r,{clipPlane:!0,useInstances:!0})))}}return Promise.all(L).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const L=new Array,r=this._babylonScene.lights;for(const p of r){const r=p.getShadowGenerator();r&&L.push(r.forceCompilationAsync())}return Promise.all(L).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(L){for(const r of this._extensions)r.enabled&&L(r)}_applyExtensions(L,r,p){for(const J of this._extensions)if(J.enabled){const i=`${J.name}.${r}`,n=L;n._activeLoaderExtensionFunctions=n._activeLoaderExtensionFunctions||{};const j=n._activeLoaderExtensionFunctions;if(!j[i]){j[i]=!0;try{const L=p(J);if(L)return L}finally{delete j[i]}}}return null}_extensionsOnLoading(){this._forEachExtensions((L=>L.onLoading&&L.onLoading()))}_extensionsOnReady(){this._forEachExtensions((L=>L.onReady&&L.onReady()))}_extensionsLoadSceneAsync(L,r){return this._applyExtensions(r,"loadScene",(p=>p.loadSceneAsync&&p.loadSceneAsync(L,r)))}_extensionsLoadNodeAsync(L,r,p){return this._applyExtensions(r,"loadNode",(J=>J.loadNodeAsync&&J.loadNodeAsync(L,r,p)))}_extensionsLoadCameraAsync(L,r,p){return this._applyExtensions(r,"loadCamera",(J=>J.loadCameraAsync&&J.loadCameraAsync(L,r,p)))}_extensionsLoadVertexDataAsync(L,r,p){return this._applyExtensions(r,"loadVertexData",(J=>J._loadVertexDataAsync&&J._loadVertexDataAsync(L,r,p)))}_extensionsLoadMeshPrimitiveAsync(L,r,p,J,i,n){return this._applyExtensions(i,"loadMeshPrimitive",(j=>j._loadMeshPrimitiveAsync&&j._loadMeshPrimitiveAsync(L,r,p,J,i,n)))}_extensionsLoadMaterialAsync(L,r,p,J,i){return this._applyExtensions(r,"loadMaterial",(n=>n._loadMaterialAsync&&n._loadMaterialAsync(L,r,p,J,i)))}_extensionsCreateMaterial(L,r,p){return this._applyExtensions(r,"createMaterial",(J=>J.createMaterial&&J.createMaterial(L,r,p)))}_extensionsLoadMaterialPropertiesAsync(L,r,p){return this._applyExtensions(r,"loadMaterialProperties",(J=>J.loadMaterialPropertiesAsync&&J.loadMaterialPropertiesAsync(L,r,p)))}_extensionsLoadTextureInfoAsync(L,r,p){return this._applyExtensions(r,"loadTextureInfo",(J=>J.loadTextureInfoAsync&&J.loadTextureInfoAsync(L,r,p)))}_extensionsLoadTextureAsync(L,r,p){return this._applyExtensions(r,"loadTexture",(J=>J._loadTextureAsync&&J._loadTextureAsync(L,r,p)))}_extensionsLoadAnimationAsync(L,r){return this._applyExtensions(r,"loadAnimation",(p=>p.loadAnimationAsync&&p.loadAnimationAsync(L,r)))}_extensionsLoadAnimationChannelAsync(L,r,p,J,i){return this._applyExtensions(p,"loadAnimationChannel",(n=>n._loadAnimationChannelAsync&&n._loadAnimationChannelAsync(L,r,p,J,i)))}_extensionsLoadSkinAsync(L,r,p){return this._applyExtensions(p,"loadSkin",(J=>J._loadSkinAsync&&J._loadSkinAsync(L,r,p)))}_extensionsLoadUriAsync(L,r,p){return this._applyExtensions(r,"loadUri",(J=>J._loadUriAsync&&J._loadUriAsync(L,r,p)))}_extensionsLoadBufferViewAsync(L,r){return this._applyExtensions(r,"loadBufferView",(p=>p.loadBufferViewAsync&&p.loadBufferViewAsync(L,r)))}_extensionsLoadBufferAsync(L,r,p,J){return this._applyExtensions(r,"loadBuffer",(i=>i.loadBufferAsync&&i.loadBufferAsync(L,r,p,J)))}static LoadExtensionAsync(L,r,p,J){if(!r.extensions)return null;const i=r.extensions[p];return i?J(`${L}/extensions/${p}`,i):null}static LoadExtraAsync(L,r,p,J){if(!r.extras)return null;const i=r.extras[p];return i?J(`${L}/extras/${p}`,i):null}isExtensionUsed(L){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(L)}logOpen(L){this._parent._logOpen(L)}logClose(){this._parent._logClose()}log(L){this._parent._log(L)}startPerformanceCounter(L){this._parent._startPerformanceCounter(L)}endPerformanceCounter(L){this._parent._endPerformanceCounter(L)}}H.DefaultSampler={index:-1},a.c._CreateGLTF2Loader=L=>new H(L);var o=p(13807),k=p(12299),R=p(12162),I=p(13814),N=p(13820);class K extends N.e{constructor(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",L),this._texture=L.getEngine().createRawCubeTexture(r,p,J,i,n,j,z,G)}update(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,L,r,p,J,i)}updateRGBDAsync(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,I.g)(this._texture,L,r,p,J).then((()=>{}))}clone(){return R.c.Clone((()=>{const L=this.FL(),r=this._texture,p=new K(L,r._bufferViewArray,r.width,r.format,r.type,r.generateMipMaps,r.invertY,r.samplingMode,r._compression);return 13===r.source&&p.updateRGBDAsync(r._bufferViewArrayArray,r._sphericalPolynomial,r._lodGenerationScale,r._lodGenerationOffset),p}),this)}}const mL="EXT_lights_image_based";class V{constructor(L){this.name=mL,this._loader=L,this.enabled=this._loader.isExtensionUsed(mL)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.di.extensions;if(L&&L[this.name]){const r=L[this.name];this._lights=r.lights}}loadSceneAsync(L,r){return H.LoadExtensionAsync(L,r,this.name,(async(p,J)=>{this._loader._allMaterialsDirtyRequired=!0;const i=new Array;i.push(this._loader.loadSceneAsync(L,r)),this._loader.logOpen(`${p}`);const n=d.Get(`${p}/light`,this._lights,J.Up);return i.push(this._loadLightAsync(`/extensions/${this.name}/lights/${J.Up}`,n).then((L=>{this._loader.babylonScene.environmentTexture=L}))),this._loader.logClose(),await Promise.all(i).then((()=>{}))}))}_loadLightAsync(L,r){if(!r._loaded){const p=new Array;this._loader.logOpen(`${L}`);const J=new Array(r.specularImages.length);for(let i=0;i<r.specularImages.length;i++){const n=r.specularImages[i];J[i]=new Array(n.length);for(let r=0;r<n.length;r++){const j=`${L}/specularImages/${i}/${r}`;this._loader.logOpen(`${j}`);const z=n[r],G=d.Get(j,this._loader.di.images,z);p.push(this._loader.loadImageAsync(`/images/${z}`,G).then((L=>{J[i][r]=L}))),this._loader.logClose()}}this._loader.logClose(),r._loaded=Promise.all(p).then((async()=>{const p=new K(this._loader.babylonScene,null,r.specularImageSize);if(p.name=r.name||"environment",r._babylonTexture=p,void 0!=r.vz&&(p.level=r.vz),r.rotation){let L=i.Quaternion.Br(r.rotation);this._loader.babylonScene.useRightHandedSystem||(L=i.Quaternion.Inverse(L)),i.Matrix.FromQuaternionToRef(L,p.getReflectionTextureMatrix())}if(!r.irradianceCoefficients)throw new Error(`${L}: Irradiance coefficients are missing`);const n=k.d.Br(r.irradianceCoefficients);n.scaleInPlace(r.vz),n.convertIrradianceToLambertianRadiance();const j=k.h.FromHarmonics(n),z=(J.length-1)/Math.log2(r.specularImageSize);return await p.updateRGBDAsync(J,j,z)}))}return r._loaded.then((()=>r._babylonTexture))}}T(mL),l(mL,!0,(L=>new V(L)));p(12677);const S="EXT_mesh_gpu_instancing";class LL{constructor(L){this.name=S,this._loader=L,this.enabled=this._loader.isExtensionUsed(S)}dispose(){this._loader=null}loadNodeAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(L,J)=>{this._loader._disableInstancedMesh++;const n=this._loader.loadNodeAsync(`/nodes/${r.index}`,r,p);if(this._loader._disableInstancedMesh--,!r._primitiveBabylonMeshes)return await n;const j=new Array;let z=0;const G=r=>{if(void 0==J.attributes[r])return void j.push(Promise.resolve(null));const p=d.Get(`${L}/attributes/${r}`,this._loader.di.accessors,J.attributes[r]);if(j.push(this._loader._loadFloatAccessorAsync(`/accessors/${p.bufferView}`,p)),0===z)z=p.count;else if(z!==p.count)throw new Error(`${L}/attributes: Instance buffer accessors do not have the same count.`)};return G("TRANSLATION"),G("ROTATION"),G("SCALE"),await n.then((async L=>{const[p,J,n]=await Promise.all(j),G=new Float32Array(16*z);i.TmpVectors.cr[0].Uz(0,0,0),i.TmpVectors.Quaternion[0].Uz(0,0,0,1),i.TmpVectors.cr[1].Uz(1,1,1);for(let r=0;r<z;++r)p&&i.cr.FromArrayToRef(p,3*r,i.TmpVectors.cr[0]),J&&i.Quaternion.FromArrayToRef(J,4*r,i.TmpVectors.Quaternion[0]),n&&i.cr.FromArrayToRef(n,3*r,i.TmpVectors.cr[1]),i.Matrix.ComposeToRef(i.TmpVectors.cr[1],i.TmpVectors.Quaternion[0],i.TmpVectors.cr[0],i.TmpVectors.Matrix[0]),i.TmpVectors.Matrix[0].copyToArray(G,16*r);for(const i of r._primitiveBabylonMeshes)i.hE("matrix",G,16,!0);return L}))}))}}T(S),l(S,!0,(L=>new LL(L)));let rL=0,pL=null;class JL{static get Default(){return JL._Default||(JL._Default=new JL),JL._Default}constructor(){const L=JL.Configuration.decoder;this._decoderModulePromise=j.Tools.LoadBabylonScriptAsync(L.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(L,r,p,J,i){await this._decoderModulePromise,0===rL&&(MeshoptDecoder.useWorkers(1),rL=1);const n=await MeshoptDecoder.decodeGltfBufferAsync(r,p,L,J,i);return null!==pL&&clearTimeout(pL),pL=setTimeout((()=>{MeshoptDecoder.useWorkers(0),rL=0,pL=null}),1e3),n}}JL.Configuration={decoder:{url:`${j.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},JL._Default=null;const iL="EXT_meshopt_compression";class nL{constructor(L){this.name=iL,this.enabled=L.isExtensionUsed(iL),this._loader=L}dispose(){this._loader=null}loadBufferViewAsync(L,r){return H.LoadExtensionAsync(L,r,this.name,(async(p,J)=>{const i=r;if(i._meshOptData)return await i._meshOptData;const n=d.Get(`${L}/buffer`,this._loader.di.buffers,J.buffer);return i._meshOptData=this._loader.loadBufferAsync(`/buffers/${n.index}`,n,J.byteOffset||0,J.byteLength).then((async L=>await JL.Default.decodeGltfBufferAsync(L,J.count,J.byteStride,J.mode,J.filter))),await i._meshOptData}))}}T(iL),l(iL,!0,(L=>new nL(L)));const jL="EXT_texture_webp";class zL{constructor(L){this.name=jL,this._loader=L,this.enabled=L.isExtensionUsed(jL)}dispose(){this._loader=null}_loadTextureAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=void 0==r.sampler?H.DefaultSampler:d.Get(`${L}/sampler`,this._loader.di.samplers,r.sampler),j=d.Get(`${J}/source`,this._loader.di.images,i.source);return await this._loader._createTextureAsync(L,n,j,(L=>{p(L)}),void 0,!r._textureInfo.nonColorData)}))}}T(jL),l(jL,!0,(L=>new zL(L)));const GL="EXT_texture_avif";class CL{constructor(L){this.name=GL,this._loader=L,this.enabled=L.isExtensionUsed(GL)}dispose(){this._loader=null}_loadTextureAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=void 0==r.sampler?H.DefaultSampler:d.Get(`${L}/sampler`,this._loader.di.samplers,r.sampler),j=d.Get(`${J}/source`,this._loader.di.images,i.source);return await this._loader._createTextureAsync(L,n,j,(L=>{p(L)}),void 0,!r._textureInfo.nonColorData)}))}}T(GL),l(GL,!0,(L=>new CL(L)));var tL=p(13803),EL=p(12654);const xL="EXT_lights_ies";class wL{constructor(L){this.name=xL,this._loader=L,this.enabled=this._loader.isExtensionUsed(xL)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.di.extensions;if(L&&L[this.name]){const r=L[this.name];this._lights=r.lights,d.Assign(this._lights)}}loadNodeAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,j)=>{let z,G;this._loader._allMaterialsDirtyRequired=!0;const C=await this._loader.loadNodeAsync(L,r,(L=>{G=d.Get(J,this._lights,j.Up);const r=G.name||L.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,z=new tL.d(r,i.cr.Zero(),i.cr.Backward(),0,1,this._loader.babylonScene),z.angle=Math.PI/2,z.innerAngle=0,z._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,G._babylonLight=z,z.falloffType=EL.e.FALLOFF_GLTF,z.yz=j.color?n.Wr.Br(j.color):n.Wr.White(),z.vz=j.multiplier||1,z.range=Number.MAX_VALUE,z.parent=L,this._loader._babylonLights.push(z),H.AddPointerMetadata(z,J),p(L)}));let t;if(G.uri)t=await this._loader.loadUriAsync(L,G,G.uri);else{const r=d.Get(`${L}/bufferView`,this._loader.di.bufferViews,G.bufferView);t=await this._loader.loadBufferViewAsync(`/bufferViews/${r.index}`,r)}return z.iesProfileTexture=new U.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,t,!0,void 0,void 0,void 0,void 0,".ies"),C}))}}T(xL),l(xL,!0,(L=>new wL(L)));var gL=p(13832);const bL="KHR_draco_mesh_compression";class cL{constructor(L){this.name=bL,this.useNormalizedFlagFromAccessor=!0,this._loader=L,this.enabled=gL.e.DefaultAvailable&&this._loader.isExtensionUsed(bL)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{if(void 0!=r.mode&&4!==r.mode&&5!==r.mode)throw new Error(`${L}: Unsupported mode ${r.mode}`);const n={},j={},z=(L,J)=>{const z=i.attributes[L];if(void 0!=z&&(p._delayInfo=p._delayInfo||[],-1===p._delayInfo.indexOf(J)&&p._delayInfo.push(J),n[J]=z,this.useNormalizedFlagFromAccessor)){const p=d.TryGet(this._loader.di.accessors,r.attributes[L]);p&&(j[J]=p.normalized||!1)}};z("POSITION",B.e.PositionKind),z("NORMAL",B.e.NormalKind),z("TANGENT",B.e.TangentKind),z("TEXCOORD_0",B.e.UVKind),z("TEXCOORD_1",B.e.UV2Kind),z("TEXCOORD_2",B.e.UV3Kind),z("TEXCOORD_3",B.e.UV4Kind),z("TEXCOORD_4",B.e.UV5Kind),z("TEXCOORD_5",B.e.UV6Kind),z("JOINTS_0",B.e.MatricesIndicesKind),z("WEIGHTS_0",B.e.MatricesWeightsKind),z("COLOR_0",B.e.ColorKind);const G=d.Get(J,this._loader.di.bufferViews,i.bufferView);return G._dracoBabylonGeometry||(G._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((async J=>{const i=this.dracoDecoder||gL.e.Default,z=d.TryGet(this._loader.di.accessors,r.attributes.POSITION),G=this._loader.parent.alwaysComputeBoundingBox||p.skeleton||!z?null:s(z);return await i._decodeMeshToGeometryForGltfAsync(p.name,this._loader.babylonScene,J,n,j,G).catch((r=>{throw new Error(`${L}: ${r.message}`)}))}))),await G._dracoBabylonGeometry}))}}T(bL),l(bL,!0,(L=>new cL(L)));var PL=p(13840),OL=p(12113),hL=p(12122),UL=p(12543),WL=p(12721),BL=p(12087);UL.d.AddNodeConstructor("Light_Type_0",((L,r)=>()=>new FL(L,i.cr.Zero(),r)));class FL extends WL.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(L){this._shadowAngle=L,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(L){const r=this.needCube();if(this._direction=L,this.needCube()!==r&&this._shadowGenerators){const L=this._shadowGenerators.values();for(let r=L.next();!0!==r.done;r=L.next()){r.value.recreateShadowMap()}}}constructor(L,r,p){super(L,p),this._shadowAngle=Math.PI/2,this.position=r}getClassName(){return"PointLight"}getTypeID(){return EL.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(L){if(this.direction)return super.getShadowDirection(L);switch(L){case 0:return new i.cr(1,0,0);case 1:return new i.cr(-1,0,0);case 2:return new i.cr(0,-1,0);case 3:return new i.cr(0,1,0);case 4:return new i.cr(0,0,1);case 5:return new i.cr(0,0,-1)}return i.cr.Zero()}_setDefaultShadowProjectionMatrix(L,r,p){const J=this.FL().activeCamera;if(!J)return;const n=void 0!==this.shadowMinZ?this.shadowMinZ:J.nz,j=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,z=this.FL().getEngine().o;i.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,z?j:n,z?n:j,L,!0,this._scene.getEngine().isNDCHalfZRange,void 0,z)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(L,r){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,r):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,r),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,r),this}transferToNodeMaterialEffect(L,r){return this.computeTransformedInformation()?L.setFloat3(r,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):L.setFloat3(r,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(L,r){L["POINTLIGHT"+r]=!0}}(0,OL.e)([(0,hL.E)()],FL.prototype,"shadowAngle",null),(0,BL.e)("BABYLON.PointLight",FL);const QL="KHR_lights_punctual";class eL{constructor(L){this.name=QL,this._loader=L,this.enabled=this._loader.isExtensionUsed(QL)}dispose(){this._loader=null,delete this._lights}onLoading(){const L=this._loader.di.extensions;if(L&&L[this.name]){const r=L[this.name];this._lights=r.lights,d.Assign(this._lights)}}loadNodeAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,j)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(L,r,(L=>{let r;const z=d.Get(J,this._lights,j.Up),G=z.name||L.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,z.type){case"directional":{const L=new PL.e(G,i.cr.Backward(),this._loader.babylonScene);L.position.Bz(0),r=L;break}case"point":r=new FL(G,i.cr.Zero(),this._loader.babylonScene);break;case"spot":{const L=new tL.d(G,i.cr.Zero(),i.cr.Backward(),0,1,this._loader.babylonScene);L.angle=2*(z.spot&&z.spot.outerConeAngle||Math.PI/4),L.innerAngle=2*(z.spot&&z.spot.innerConeAngle||0),r=L;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${J}: Invalid light type (${z.type})`)}r._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,z._babylonLight=r,r.falloffType=EL.e.FALLOFF_GLTF,r.yz=z.color?n.Wr.Br(z.color):n.Wr.White(),r.vz=void 0==z.vz?1:z.vz,r.range=void 0==z.range?Number.MAX_VALUE:z.range,r.parent=L,this._loader._babylonLights.push(r),H.AddPointerMetadata(r,J),p(L)})))))}}T(QL),l(QL,!0,(L=>new eL(L)));const vL="KHR_materials_pbrSpecularGlossiness";class yL{constructor(L){this.name=vL,this.order=200,this._loader=L,this.enabled=this._loader.isExtensionUsed(vL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialBasePropertiesAsync(L,r,p)),n.push(this._loadSpecularGlossinessPropertiesAsync(J,i,p)),this._loader.loadMaterialAlphaProperties(L,r,p),await Promise.all(n).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;return p.metallic=null,p.roughness=null,r.diffuseFactor?(p.albedoColor=n.Wr.Br(r.diffuseFactor),p.alpha=r.diffuseFactor[3]):p.albedoColor=n.Wr.White(),p.reflectivityColor=r.specularFactor?n.Wr.Br(r.specularFactor):n.Wr.White(),p.microSurface=void 0==r.glossinessFactor?1:r.glossinessFactor,r.diffuseTexture&&J.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTexture`,r.diffuseTexture,(L=>{L.name=`${p.name} (Diffuse)`,p.albedoTexture=L}))),r.specularGlossinessTexture&&(J.push(this._loader.loadTextureInfoAsync(`${L}/specularGlossinessTexture`,r.specularGlossinessTexture,(L=>{L.name=`${p.name} (Specular Glossiness)`,p.reflectivityTexture=L,p.reflectivityTexture.pz=!0}))),p.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(J).then((()=>{}))}}T(vL),l(vL,!0,(L=>new yL(L)));const AL="KHR_materials_unlit";class uL{constructor(L){this.name=AL,this.order=210,this._loader=L,this.enabled=this._loader.isExtensionUsed(AL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async()=>await this._loadUnlitPropertiesAsync(L,r,p)))}_loadUnlitPropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;p.unlit=!0;const i=r.pbrMetallicRoughness;return i&&(i.baseColorFactor?(p.albedoColor=n.Wr.Br(i.baseColorFactor),p.alpha=i.baseColorFactor[3]):p.albedoColor=n.Wr.White(),i.baseColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${L}/baseColorTexture`,i.baseColorTexture,(L=>{L.name=`${p.name} (Base Color)`,p.albedoTexture=L})))),r.doubleSided&&(p.hz=!1,p.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(L,r,p),Promise.all(J).then((()=>{}))}}T(AL),l(AL,!0,(L=>new uL(L)));const aL="KHR_materials_clearcoat";class qL{constructor(L){this.name=aL,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(aL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadClearCoatPropertiesAsync(J,i,p)),await Promise.all(n)}))}_loadClearCoatPropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;return p.clearCoat.isEnabled=!0,p.clearCoat.useRoughnessFromMainTexture=!1,p.clearCoat.remapF0OnInterfaceChange=!1,void 0!=r.clearcoatFactor?p.clearCoat.vz=r.clearcoatFactor:p.clearCoat.vz=0,r.clearcoatTexture&&J.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatTexture`,r.clearcoatTexture,(L=>{L.name=`${p.name} (ClearCoat)`,p.clearCoat.texture=L}))),void 0!=r.clearcoatRoughnessFactor?p.clearCoat.roughness=r.clearcoatRoughnessFactor:p.clearCoat.roughness=0,r.clearcoatRoughnessTexture&&(r.clearcoatRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatRoughnessTexture`,r.clearcoatRoughnessTexture,(L=>{L.name=`${p.name} (ClearCoat Roughness)`,p.clearCoat.textureRoughness=L})))),r.clearcoatNormalTexture&&(r.clearcoatNormalTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${L}/clearcoatNormalTexture`,r.clearcoatNormalTexture,(L=>{L.name=`${p.name} (ClearCoat Normal)`,p.clearCoat.bumpTexture=L}))),p.invertNormalMapX=!p.FL().useRightHandedSystem,p.invertNormalMapY=p.FL().useRightHandedSystem,void 0!=r.clearcoatNormalTexture.scale&&(p.clearCoat.bumpTexture.level=r.clearcoatNormalTexture.scale)),Promise.all(J).then((()=>{}))}}T(aL),l(aL,!0,(L=>new qL(L)));const ZL="KHR_materials_iridescence";class XL{constructor(L){this.name=ZL,this.order=195,this._loader=L,this.enabled=this._loader.isExtensionUsed(ZL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadIridescencePropertiesAsync(J,i,p)),await Promise.all(n).then((()=>{}))}))}_loadIridescencePropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;return p.iridescence.isEnabled=!0,p.iridescence.vz=r.iridescenceFactor??0,p.iridescence.indexOfRefraction=r.iridescenceIor??r.iridescenceIOR??1.3,p.iridescence.minimumThickness=r.iridescenceThicknessMinimum??100,p.iridescence.maximumThickness=r.iridescenceThicknessMaximum??400,r.iridescenceTexture&&J.push(this._loader.loadTextureInfoAsync(`${L}/iridescenceTexture`,r.iridescenceTexture,(L=>{L.name=`${p.name} (Iridescence)`,p.iridescence.texture=L}))),r.iridescenceThicknessTexture&&J.push(this._loader.loadTextureInfoAsync(`${L}/iridescenceThicknessTexture`,r.iridescenceThicknessTexture,(L=>{L.name=`${p.name} (Iridescence Thickness)`,p.iridescence.thicknessTexture=L}))),Promise.all(J).then((()=>{}))}}T(ZL),l(ZL,!0,(L=>new XL(L)));const DL="KHR_materials_anisotropy";class lL{constructor(L){this.name=DL,this.order=195,this._loader=L,this.enabled=this._loader.isExtensionUsed(DL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadIridescencePropertiesAsync(J,i,p)),await Promise.all(n)}))}async _loadIridescencePropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;p.anisotropy.isEnabled=!0,p.anisotropy.vz=r.anisotropyStrength??0,p.anisotropy.angle=r.anisotropyRotation??0,r.anisotropyTexture&&(r.anisotropyTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${L}/anisotropyTexture`,r.anisotropyTexture,(L=>{L.name=`${p.name} (Anisotropy Intensity)`,p.anisotropy.texture=L})))),await Promise.all(J)}}T(DL),l(DL,!0,(L=>new lL(L)));const TL="KHR_materials_emissive_strength";class YL{constructor(L){this.name=TL,this.order=170,this._loader=L,this.enabled=this._loader.isExtensionUsed(TL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>await this._loader.loadMaterialPropertiesAsync(L,r,p).then((()=>{this._loadEmissiveProperties(J,i,p)}))))}_loadEmissiveProperties(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);void 0!==r.emissiveStrength&&(p.emissiveIntensity=r.emissiveStrength)}}T(TL),l(TL,!0,(L=>new YL(L)));const ML="KHR_materials_sheen";class fL{constructor(L){this.name=ML,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(ML)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadSheenPropertiesAsync(J,i,p)),await Promise.all(n).then((()=>{}))}))}_loadSheenPropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;return p.sheen.isEnabled=!0,p.sheen.vz=1,void 0!=r.sheenColorFactor?p.sheen.color=n.Wr.Br(r.sheenColorFactor):p.sheen.color=n.Wr.Black(),r.sheenColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${L}/sheenColorTexture`,r.sheenColorTexture,(L=>{L.name=`${p.name} (Sheen Color)`,p.sheen.texture=L}))),void 0!==r.sheenRoughnessFactor?p.sheen.roughness=r.sheenRoughnessFactor:p.sheen.roughness=0,r.sheenRoughnessTexture&&(r.sheenRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${L}/sheenRoughnessTexture`,r.sheenRoughnessTexture,(L=>{L.name=`${p.name} (Sheen Roughness)`,p.sheen.textureRoughness=L})))),p.sheen.albedoScaling=!0,p.sheen.useRoughnessFromMainTexture=!1,Promise.all(J).then((()=>{}))}}T(ML),l(ML,!0,(L=>new fL(L)));var dL=p(12605);const sL="KHR_materials_specular";class HL{constructor(L){this.name=sL,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(sL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;if(n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadSpecularPropertiesAsync(J,i,p)),i.extensions&&i.extensions.EXT_materials_specular_edge_color&&p instanceof h.b){i.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(p.brdf.dielectricSpecularModel=dL.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,p.brdf.conductorSpecularModel=dL.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(n).then((()=>{}))}))}_loadSpecularPropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;return void 0!==r.specularFactor&&(p.metallicF0Factor=r.specularFactor),void 0!==r.specularColorFactor&&(p.metallicReflectanceColor=n.Wr.Br(r.specularColorFactor)),r.specularTexture&&(r.specularTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${L}/specularTexture`,r.specularTexture,(L=>{L.name=`${p.name} (Specular)`,p.metallicReflectanceTexture=L,p.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),r.specularColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${L}/specularColorTexture`,r.specularColorTexture,(L=>{L.name=`${p.name} (Specular Color)`,p.reflectanceTexture=L}))),Promise.all(J).then((()=>{}))}}T(sL),l(sL,!0,(L=>new HL(L)));const oL="KHR_materials_ior";class kL{constructor(L){this.name=oL,this.order=180,this._loader=L,this.enabled=this._loader.isExtensionUsed(oL)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadIorPropertiesAsync(J,i,p)),await Promise.all(n).then((()=>{}))}))}_loadIorPropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);return void 0!==r.ior?p.indexOfRefraction=r.ior:p.indexOfRefraction=kL._DEFAULT_IOR,Promise.resolve()}}kL._DEFAULT_IOR=1.5,T(oL),l(oL,!0,(L=>new kL(L)));const RL="KHR_materials_variants";class IL{constructor(L){this.name=RL,this._loader=L,this.enabled=this._loader.isExtensionUsed(RL)}dispose(){this._loader=null}static GetAvailableVariants(L){const r=this._GetExtensionMetadata(L);return r?Object.keys(r.variants):[]}getAvailableVariants(L){return IL.GetAvailableVariants(L)}static SelectVariant(L,r){const p=this._GetExtensionMetadata(L);if(!p)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${RL} extension`);const J=L=>{const r=p.variants[L];if(r)for(const p of r)p.mesh.material=p.material};if(r instanceof Array)for(const i of r)J(i);else J(r);p.lastSelected=r}selectVariant(L,r){IL.SelectVariant(L,r)}static Reset(L){const r=this._GetExtensionMetadata(L);if(!r)throw new Error(`Cannot reset on a glTF mesh that does not have the ${RL} extension`);for(const p of r.original)p.mesh.material=p.material;r.lastSelected=null}reset(L){IL.Reset(L)}static GetLastSelectedVariant(L){const r=this._GetExtensionMetadata(L);if(!r)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${RL} extension`);return r.lastSelected}getLastSelectedVariant(L){return IL.GetLastSelectedVariant(L)}static _GetExtensionMetadata(L){var r,p;return(null===L||void 0===L||null===(r=L._internalMetadata)||void 0===r||null===(p=r.di)||void 0===p?void 0:p[RL])||null}onLoading(){const L=this._loader.di.extensions;if(L&&L[this.name]){const r=L[this.name];this._variants=r.variants}}onReady(){const L=this._loader.rootBabylonMesh;if(L){var r;const p=this._loader.parent.extensionOptions[RL];null!==p&&void 0!==p&&p.defaultVariant&&IL.SelectVariant(L,p.defaultVariant),null===p||void 0===p||null===(r=p.onLoaded)||void 0===r||r.call(p,{get variants(){return IL.GetAvailableVariants(L)},get selectedVariant(){const r=IL.GetLastSelectedVariant(L);return r?Array.isArray(r)?r[0]:r:IL.GetAvailableVariants(L)[0]},set selectedVariant(r){IL.SelectVariant(L,r)}})}}_loadMeshPrimitiveAsync(L,r,p,J,i,n){return H.LoadExtensionAsync(L,i,this.name,(async(j,z)=>{const G=new Array;return G.push(this._loader._loadMeshPrimitiveAsync(L,r,p,J,i,(r=>{if(n(r),r instanceof e.c){const p=H._GetDrawMode(L,i.mode),J=this._loader.rootBabylonMesh,n=J?J._internalMetadata=J._internalMetadata||{}:{},C=n.di=n.di||{},t=C[RL]=C[RL]||{lastSelected:null,original:[],variants:{}};t.original.push({mesh:r,material:r.material});for(let L=0;L<z.mappings.length;++L){const i=z.mappings[L],n=d.Get(`${j}/mappings/${L}/material`,this._loader.di.materials,i.material);G.push(this._loader._loadMaterialAsync(`#/materials/${i.material}`,n,r,p,(L=>{for(let p=0;p<i.variants.length;++p){const n=i.variants[p],j=d.Get(`/extensions/${RL}/variants/${n}`,this._variants,n);t.variants[j.name]=t.variants[j.name]||[],t.variants[j.name].push({mesh:r,material:L}),r.onClonedObservable.add((L=>{const p=L;let i=null,n=p;do{if(n=n.parent,!n)return;i=IL._GetExtensionMetadata(n)}while(null===i);if(J&&i===IL._GetExtensionMetadata(J)){n._internalMetadata={};for(const L in J._internalMetadata)n._internalMetadata[L]=J._internalMetadata[L];n._internalMetadata.di=[];for(const L in J._internalMetadata.di)n._internalMetadata.di[L]=J._internalMetadata.di[L];n._internalMetadata.di[RL]={lastSelected:null,original:[],variants:{}};for(const L of i.original)n._internalMetadata.di[RL].original.push({mesh:L.mesh,material:L.material});for(const L in i.variants)if(Object.prototype.hasOwnProperty.call(i.variants,L)){n._internalMetadata.di[RL].variants[L]=[];for(const r of i.variants[L])n._internalMetadata.di[RL].variants[L].push({mesh:r.mesh,material:r.material})}i=n._internalMetadata.di[RL]}for(const J of i.original)J.mesh===r&&(J.mesh=p);for(const J of i.variants[j.name])J.mesh===r&&(J.mesh=p)}))}})))}}}))),await Promise.all(G).then((L=>{let[r]=L;return r}))}))}}T(RL),l(RL,!0,(L=>new IL(L)));var NL=p(12190);class KL{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:dL.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(L,r){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...KL._GetDefaultOptions(),...L},this._scene=r,this._scene._transmissionHelper=this,this.onErrorObservable=new t.c,this._scene.ji.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(L){if(!Object.keys(L).filter((r=>this._options[r]!==L[r])).length)return;const r={...this._options,...L},p=this._options;this._options=r,r.renderSize===p.renderSize&&r.renderTargetTextureType===p.renderTargetTextureType&&r.generateMipmaps===p.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=r.samples,this._opaqueRenderTarget.lodGenerationScale=r.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=r.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(L){return!!L&&!!(L instanceof h.b&&L.subSurface.isRefractionEnabled)}_addMesh(L){this._materialObservers[L.uniqueId]=L.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),j.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(L.material)?(L.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(L)&&this._transparentMeshesCache.push(L)):-1===this._opaqueMeshesCache.indexOf(L)&&this._opaqueMeshesCache.push(L)}))}_removeMesh(L){L.onMaterialChangedObservable.remove(this._materialObservers[L.uniqueId]),delete this._materialObservers[L.uniqueId];let r=this._transparentMeshesCache.indexOf(L);-1!==r&&this._transparentMeshesCache.splice(r,1),r=this._opaqueMeshesCache.indexOf(L),-1!==r&&this._opaqueMeshesCache.splice(r,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(L){const r=this._transparentMeshesCache.indexOf(L),p=this._opaqueMeshesCache.indexOf(L);this._shouldRenderAsTransmission(L.material)?(L.material instanceof h.b&&(L.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==p?(this._opaqueMeshesCache.splice(p,1),this._transparentMeshesCache.push(L)):-1===r&&this._transparentMeshesCache.push(L)):-1!==r?(this._transparentMeshesCache.splice(r,1),this._opaqueMeshesCache.push(L)):-1===p&&this._opaqueMeshesCache.push(L)}_isRenderTargetValid(){var L;return null!==(null===(L=this._opaqueRenderTarget)||void 0===L?void 0:L.getInternalTexture())}_setupRenderTargets(){var L;let r;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new NL.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(L=this._options.clearColor)||void 0===L?void 0:L.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((L=>{r=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?L.clearColor.G(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(L.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=r}));for(const p of this._transparentMeshesCache)this._shouldRenderAsTransmission(p.material)&&(p.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const mr="KHR_materials_transmission";class VL{constructor(L){this.name=mr,this.order=175,this._loader=L,this.enabled=this._loader.isExtensionUsed(mr),this.enabled&&(L.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadTransparentPropertiesAsync(J,r,p,i)),await Promise.all(n).then((()=>{}))}))}_loadTransparentPropertiesAsync(L,r,p,J){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const i=p;if(i.subSurface.isRefractionEnabled=!0,i.subSurface.volumeIndexOfRefraction=1,i.subSurface.useAlbedoToTintRefraction=!0,void 0===J.transmissionFactor)return i.subSurface.refractionIntensity=0,i.subSurface.isRefractionEnabled=!1,Promise.resolve();{var n;i.subSurface.refractionIntensity=J.transmissionFactor;const L=i.FL();if(i.subSurface.refractionIntensity&&!L._transmissionHelper)new KL({},i.FL());else if(i.subSurface.refractionIntensity&&(null===(n=L._transmissionHelper)||void 0===n||!n._isRenderTargetValid())){var j;null===(j=L._transmissionHelper)||void 0===j||j._setupRenderTargets()}}return i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=0,J.transmissionTexture?(J.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${L}/transmissionTexture`,J.transmissionTexture,void 0).then((L=>{L.name=`${p.name} (Transmission)`,i.subSurface.refractionIntensityTexture=L,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}T(mr),l(mr,!0,(L=>new VL(L)));const SL="KHR_materials_diffuse_transmission";class Lr{constructor(L){this.name=SL,this.order=174,this._loader=L,this.enabled=this._loader.isExtensionUsed(SL),this.enabled&&(L.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadTranslucentPropertiesAsync(J,r,p,i)),await Promise.all(n).then((()=>{}))}))}_loadTranslucentPropertiesAsync(L,r,p,J){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const i=p;if(i.subSurface.isTranslucencyEnabled=!0,i.subSurface.volumeIndexOfRefraction=1,i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=0,i.subSurface.useAlbedoToTintTranslucency=!1,void 0===J.diffuseTransmissionFactor)return i.subSurface.translucencyIntensity=0,i.subSurface.isTranslucencyEnabled=!1,Promise.resolve();i.subSurface.translucencyIntensity=J.diffuseTransmissionFactor;const j=new Array;return i.subSurface.useGltfStyleTextures=!0,J.diffuseTransmissionTexture&&(J.diffuseTransmissionTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTransmissionTexture`,J.diffuseTransmissionTexture).then((L=>{L.name=`${p.name} (Diffuse Transmission)`,i.subSurface.translucencyIntensityTexture=L})))),void 0!==J.diffuseTransmissionColorFactor?i.subSurface.translucencyColor=n.Wr.Br(J.diffuseTransmissionColorFactor):i.subSurface.translucencyColor=n.Wr.White(),J.diffuseTransmissionColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${L}/diffuseTransmissionColorTexture`,J.diffuseTransmissionColorTexture).then((L=>{L.name=`${p.name} (Diffuse Transmission Color)`,i.subSurface.translucencyColorTexture=L}))),Promise.all(j).then((()=>{}))}}T(SL),l(SL,!0,(L=>new Lr(L)));const rr="KHR_materials_volume";class pr{constructor(L){this.name=rr,this.order=173,this._loader=L,this.enabled=this._loader.isExtensionUsed(rr),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadVolumePropertiesAsync(J,r,p,i)),await Promise.all(n).then((()=>{}))}))}_loadVolumePropertiesAsync(L,r,p,J){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);if(!p.subSurface.isRefractionEnabled&&!p.subSurface.isTranslucencyEnabled||!J.thicknessFactor)return Promise.resolve();p.subSurface.volumeIndexOfRefraction=p.indexOfRefraction;const i=void 0!==J.attenuationDistance?J.attenuationDistance:Number.MAX_VALUE;return p.subSurface.tintColorAtDistance=i,void 0!==J.attenuationColor&&3==J.attenuationColor.length&&p.subSurface.tintColor.Uz(J.attenuationColor[0],J.attenuationColor[1],J.attenuationColor[2]),p.subSurface.minimumThickness=0,p.subSurface.maximumThickness=J.thicknessFactor,p.subSurface.useThicknessAsDepth=!0,J.thicknessTexture?(J.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${L}/thicknessTexture`,J.thicknessTexture).then((L=>{L.name=`${p.name} (Thickness)`,p.subSurface.thicknessTexture=L,p.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}T(rr),l(rr,!0,(L=>new pr(L)));const Jr="KHR_materials_dispersion";class ir{constructor(L){this.name=Jr,this.order=174,this._loader=L,this.enabled=this._loader.isExtensionUsed(Jr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadDispersionPropertiesAsync(J,r,p,i)),await Promise.all(n).then((()=>{}))}))}_loadDispersionPropertiesAsync(L,r,p,J){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);return p.subSurface.isRefractionEnabled&&J.dispersion?(p.subSurface.isDispersionEnabled=!0,p.subSurface.dispersion=J.dispersion,Promise.resolve()):Promise.resolve()}}T(Jr),l(Jr,!0,(L=>new ir(L)));const nr="EXT_materials_diffuse_roughness";class jr{constructor(L){this.name=nr,this.order=190,this._loader=L,this.enabled=this._loader.isExtensionUsed(nr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(L,r,p)),n.push(this._loadDiffuseRoughnessPropertiesAsync(J,i,p)),await Promise.all(n).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(L,r,p){if(!(p instanceof h.b))throw new Error(`${L}: Material type not supported`);const J=new Array;return p.brdf.baseDiffuseModel=dL.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=r.diffuseRoughnessFactor?p.baseDiffuseRoughness=r.diffuseRoughnessFactor:p.baseDiffuseRoughness=0,r.diffuseRoughnessTexture&&J.push(this._loader.loadTextureInfoAsync(`${L}/diffuseRoughnessTexture`,r.diffuseRoughnessTexture,(L=>{L.name=`${p.name} (Diffuse Roughness)`,p.baseDiffuseRoughnessTexture=L}))),Promise.all(J).then((()=>{}))}}T(nr),l(nr,!0,(L=>new jr(L)));const zr="KHR_mesh_quantization";class Gr{constructor(L){this.name=zr,this.enabled=L.isExtensionUsed(zr)}dispose(){}}T(zr),l(zr,!0,(L=>new Gr(L)));const Cr="KHR_texture_basisu";class tr{constructor(L){this.name=Cr,this._loader=L,this.enabled=L.isExtensionUsed(Cr)}dispose(){this._loader=null}_loadTextureAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>{const n=void 0==r.sampler?H.DefaultSampler:d.Get(`${L}/sampler`,this._loader.di.samplers,r.sampler),j=d.Get(`${J}/source`,this._loader.di.images,i.source);return await this._loader._createTextureAsync(L,n,j,(L=>{p(L)}),r._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!r._textureInfo.nonColorData)}))}}T(Cr),l(Cr,!0,(L=>new tr(L)));const Er="KHR_texture_transform";class xr{constructor(L){this.name=Er,this._loader=L,this.enabled=this._loader.isExtensionUsed(Er)}dispose(){this._loader=null}loadTextureInfoAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(J,i)=>await this._loader.loadTextureInfoAsync(L,r,(L=>{if(!(L instanceof U.c))throw new Error(`${J}: Texture type not supported`);i.offset&&(L.uOffset=i.offset[0],L.vOffset=i.offset[1]),L.uRotationCenter=0,L.vRotationCenter=0,i.rotation&&(L.wAng=-i.rotation),i.scale&&(L.uScale=i.scale[0],L.vScale=i.scale[1]),void 0!=i.texCoord&&(L.coordinatesIndex=i.texCoord),p(L)}))))}}T(Er),l(Er,!0,(L=>new xr(L)));const wr="KHR_xmp_json_ld";class gr{constructor(L){this.name=wr,this.order=100,this._loader=L,this.enabled=this._loader.isExtensionUsed(wr)}dispose(){this._loader=null}onLoading(){var L,r,p;if(null===this._loader.rootBabylonMesh)return;const J=null===(L=this._loader.di.extensions)||void 0===L?void 0:L.KHR_xmp_json_ld,i=null===(r=this._loader.di.asset)||void 0===r||null===(p=r.extensions)||void 0===p?void 0:p.KHR_xmp_json_ld;if(J&&i){const L=+i.packet;J.packets&&L<J.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=J.packets[L])}}}function br(L,r,p,J){return n.Wr.Br(r,p).scale(J)}function cr(L,r,p,J){return r[p]*J}function Pr(L,r,p,J){return-r[p]*J}function Or(L,r,p,J){return r[p+1]*J}function hr(L,r,p,J){return r[p]*J*2}function Ur(L){return{scale:[new Br(x.c.ANIMATIONTYPE_FLOAT,`${L}.uScale`,cr,(()=>2)),new Br(x.c.ANIMATIONTYPE_FLOAT,`${L}.vScale`,Or,(()=>2))],offset:[new Br(x.c.ANIMATIONTYPE_FLOAT,`${L}.uOffset`,cr,(()=>2)),new Br(x.c.ANIMATIONTYPE_FLOAT,`${L}.vOffset`,Or,(()=>2))],rotation:[new Br(x.c.ANIMATIONTYPE_FLOAT,`${L}.wAng`,Pr,(()=>1))]}}T(wr),l(wr,!0,(L=>new gr(L)));class Wr extends o.AnimationPropertyInfo{buildAnimations(L,r,p,J){return[{babylonAnimatable:L._babylonCamera,babylonAnimation:this._buildAnimation(r,p,J)}]}}class Br extends o.AnimationPropertyInfo{buildAnimations(L,r,p,J){const i=[];for(const n in L._data)i.push({babylonAnimatable:L._data[n].babylonMaterial,babylonAnimation:this._buildAnimation(r,p,J)});return i}}class Fr extends o.AnimationPropertyInfo{buildAnimations(L,r,p,J){return[{babylonAnimatable:L._babylonLight,babylonAnimation:this._buildAnimation(r,p,J)}]}}(0,Y.o)("/cameras/{}/orthographic/xmag",[new Wr(x.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Pr,(()=>1)),new Wr(x.c.ANIMATIONTYPE_FLOAT,"orthoRight",Or,(()=>1))]),(0,Y.o)("/cameras/{}/orthographic/ymag",[new Wr(x.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Pr,(()=>1)),new Wr(x.c.ANIMATIONTYPE_FLOAT,"orthoTop",Or,(()=>1))]),(0,Y.o)("/cameras/{}/orthographic/zfar",[new Wr(x.c.ANIMATIONTYPE_FLOAT,"maxZ",cr,(()=>1))]),(0,Y.o)("/cameras/{}/orthographic/znear",[new Wr(x.c.ANIMATIONTYPE_FLOAT,"nz",cr,(()=>1))]),(0,Y.o)("/cameras/{}/perspective/yfov",[new Wr(x.c.ANIMATIONTYPE_FLOAT,"fov",cr,(()=>1))]),(0,Y.o)("/cameras/{}/perspective/zfar",[new Wr(x.c.ANIMATIONTYPE_FLOAT,"maxZ",cr,(()=>1))]),(0,Y.o)("/cameras/{}/perspective/znear",[new Wr(x.c.ANIMATIONTYPE_FLOAT,"nz",cr,(()=>1))]),(0,Y.o)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Br(x.c.ANIMATIONTYPE_COLOR3,"albedoColor",br,(()=>4)),new Br(x.c.ANIMATIONTYPE_FLOAT,"alpha",(function(L,r,p,J){return r[p+3]*J}),(()=>4))]),(0,Y.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"metallic",cr,(()=>1))]),(0,Y.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"roughness",cr,(()=>1))]);const Qr=Ur("albedoTexture");(0,Y.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Qr.scale),(0,Y.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Qr.offset),(0,Y.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Qr.rotation);const er=Ur("metallicTexture");(0,Y.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",er.scale),(0,Y.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",er.offset),(0,Y.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",er.rotation),(0,Y.o)("/materials/{}/emissiveFactor",[new Br(x.c.ANIMATIONTYPE_COLOR3,"emissiveColor",br,(()=>3))]);const vr=Ur("bumpTexture");(0,Y.o)("/materials/{}/normalTexture/scale",[new Br(x.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",cr,(()=>1))]),(0,Y.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",vr.scale),(0,Y.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",vr.offset),(0,Y.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",vr.rotation),(0,Y.o)("/materials/{}/occlusionTexture/strength",[new Br(x.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",cr,(()=>1))]);const yr=Ur("ambientTexture");(0,Y.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",yr.scale),(0,Y.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",yr.offset),(0,Y.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",yr.rotation);const Ar=Ur("emissiveTexture");(0,Y.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Ar.scale),(0,Y.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Ar.offset),(0,Y.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Ar.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Br(x.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Br(x.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",cr,(()=>1))]);const ur=Ur("anisotropy.texture");(0,Y.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",ur.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",ur.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",ur.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",cr,(()=>1))]);const ar=Ur("clearCoat.texture");(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",ar.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",ar.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",ar.rotation);const qr=Ur("clearCoat.bumpTexture");(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Br(x.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",qr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",qr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",qr.rotation);const Zr=Ur("clearCoat.textureRoughness");(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Zr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Zr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Zr.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Br(x.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_ior/ior",[new Br(x.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Br(x.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Br(x.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",cr,(()=>1))]);const Xr=Ur("iridescence.texture");(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Xr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Xr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Xr.rotation);const Dr=Ur("iridescence.thicknessTexture");(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Dr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Dr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Dr.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Br(x.c.ANIMATIONTYPE_COLOR3,"sheen.color",br,(()=>3))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",cr,(()=>1))]);const lr=Ur("sheen.texture");(0,Y.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",lr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",lr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",lr.rotation);const Tr=Ur("sheen.textureRoughness");(0,Y.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Tr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Tr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Tr.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Br(x.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",br,(()=>3))]);const Yr=Ur("metallicReflectanceTexture");(0,Y.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Yr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Yr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Yr.rotation);const Mr=Ur("reflectanceTexture");(0,Y.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Mr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Mr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Mr.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",cr,(()=>1))]);const fr=Ur("subSurface.refractionIntensityTexture");(0,Y.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",fr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",fr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",fr.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Br(x.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",br,(()=>3))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Br(x.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",cr,(()=>1))]),(0,Y.o)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",cr,(()=>1))]);const dr=Ur("subSurface.thicknessTexture");(0,Y.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",dr.scale),(0,Y.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",dr.offset),(0,Y.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",dr.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Br(x.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",cr,(()=>1))]);const sr=Ur("subSurface.translucencyIntensityTexture");(0,Y.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",sr.scale),(0,Y.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",sr.offset),(0,Y.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",sr.rotation),(0,Y.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Br(x.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",br,(()=>3))]);const Hr=Ur("subSurface.translucencyColorTexture");(0,Y.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Hr.scale),(0,Y.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Hr.offset),(0,Y.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Hr.rotation),(0,Y.o)("/extensions/KHR_lights_punctual/lights/{}/color",[new Fr(x.c.ANIMATIONTYPE_COLOR3,"diffuse",br,(()=>3))]),(0,Y.o)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Fr(x.c.ANIMATIONTYPE_FLOAT,"intensity",cr,(()=>1))]),(0,Y.o)("/extensions/KHR_lights_punctual/lights/{}/range",[new Fr(x.c.ANIMATIONTYPE_FLOAT,"range",cr,(()=>1))]),(0,Y.o)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Fr(x.c.ANIMATIONTYPE_FLOAT,"innerAngle",hr,(()=>1))]),(0,Y.o)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Fr(x.c.ANIMATIONTYPE_FLOAT,"angle",hr,(()=>1))]),(0,Y.o)("/nodes/{}/extensions/EXT_lights_ies/color",[new Fr(x.c.ANIMATIONTYPE_COLOR3,"diffuse",br,(()=>3))]),(0,Y.o)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Fr(x.c.ANIMATIONTYPE_FLOAT,"intensity",cr,(()=>1))]);const or="KHR_animation_pointer";class kr{constructor(L){this.name=or,this._loader=L,this._pathToObjectConverter=(0,Y.l)(this._loader.di)}get enabled(){return this._loader.isExtensionUsed(or)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(L,r,p,J,i){var n;const j=null===(n=J.target.extensions)||void 0===n?void 0:n.KHR_animation_pointer;if(!j||!this._pathToObjectConverter)return null;"pointer"!==J.target.path&&b.d.Warn(`${L}/target/path: Value (${J.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=J.target.node&&b.d.Warn(`${L}/target/node: Value (${J.target.node}) must not be present when using the ${this.name} extension`);const z=`${L}/extensions/${this.name}`,G=j.pointer;if(!G)throw new Error(`${z}: Pointer is missing`);try{const n=this._pathToObjectConverter.convert(G);if(!n.info.interpolation)throw new Error(`${z}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(L,r,p,J,{object:n.object,info:n.info.interpolation},i)}catch(C){return b.d.Warn(`${z}/pointer: Invalid pointer (${G}) skipped`),null}}}T(or),l(or,!0,(L=>new kr(L)));class Rr{constructor(L,r,p){this.frame=L,this.action=r,this.onlyOnce=p,this.isDone=!1}_clone(){return new Rr(this.frame,this.action,this.onlyOnce)}}var Ir=p(11996),Nr=p(12037),Kr=p(12032);class mp{get loop(){return this._loop}set loop(L){L!==this._loop&&(this._loop=L,this.updateOptions({loop:L}))}get currentTime(){var L;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.audioContext&&(this.isPlaying||this.isPaused)){const L=this.isPaused?0:Nr.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+L}return 0}get spatialSound(){return this._spatialSound}set spatialSound(L){if(L==this._spatialSound)return;const r=this.isPlaying;this.pause(),L?(this._spatialSound=L,this._updateSpatialParameters()):this._disableSpatialSound(),r&&this.play()}constructor(L,r,p){var J;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new t.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=i.cr.Zero(),this._localDirection=new i.cr(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=L,p=p||g.c.LastCreatedScene)if(this._scene=p,mp._SceneComponentInitialization(p),this._readyToPlayCallback=n,this._customAttenuationFunction=(L,r,p,J,i)=>r<p?L*(1-r/p):0,z&&(this.autoplay=z.autoplay||!1,this._loop=z.loop||!1,void 0!==z.volume&&(this._volume=z.volume),this._spatialSound=z.spatialSound??!1,this.maxDistance=z.maxDistance??100,this.useCustomAttenuation=z.useCustomAttenuation??!1,this.rolloffFactor=z.rolloffFactor||1,this.refDistance=z.refDistance||1,this.distanceModel=z.distanceModel||"linear",this._playbackRate=z.playbackRate||1,this._streaming=z.streaming??!1,this._length=z.length,this._offset=z.offset),null!==(J=Nr.e.audioEngine)&&void 0!==J&&J.canUseWebAudio&&Nr.e.audioEngine.audioContext){this._soundGain=Nr.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let L=!0;if(r)try{"string"===typeof r?(this._urlType="String",this._url=r):r instanceof ArrayBuffer?this._urlType="ArrayBuffer":r instanceof HTMLMediaElement?this._urlType="MediaElement":r instanceof MediaStream?this._urlType="MediaStream":r instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(r)&&(this._urlType="Array");let p=[],J=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Nr.e.audioEngine.audioContext.createMediaElementSource(r),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Nr.e.audioEngine.audioContext.createMediaStreamSource(r),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":r.byteLength>0&&(J=!0,this._soundLoaded(r));break;case"AudioBuffer":this._audioBufferLoaded(r);break;case"String":p.push(r);case"Array":0===p.length&&(p=r);for(let L=0;L<p.length;L++){const r=p[L];if(J=z&&z.skipCodecCheck||-1!==r.indexOf(".mp3",r.length-4)&&Nr.e.audioEngine.isMP3supported||-1!==r.indexOf(".ogg",r.length-4)&&Nr.e.audioEngine.isOGGsupported||-1!==r.indexOf(".wav",r.length-4)||-1!==r.indexOf(".m4a",r.length-4)||-1!==r.indexOf(".mp4",r.length-4)||-1!==r.indexOf("blob:"),J){this._streaming?(this._htmlAudioElement=new Audio(r),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,j.Tools.SetCorsBehavior(r,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(r,(L=>{this._soundLoaded(L)}),void 0,!0,!0,(L=>{L&&b.d.Error("XHR "+L.status+" error on: "+r+"."),b.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:L=!1}L?J||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):b.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(G){b.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Nr.e.audioEngine&&!Nr.e.audioEngine.WarnedWebAudioUnsupported&&(b.d.Error("Web Audio is not supported by your browser."),Nr.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var L;null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(L){var r;null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.audioContext&&(this._audioBuffer=L,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(L){var r;null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.audioContext&&Nr.e.audioEngine.audioContext.decodeAudioData(L,(L=>{this._audioBufferLoaded(L)}),(L=>{b.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+L)}))}setAudioBuffer(L){var r;null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&(this._audioBuffer=L,this._isReadyToPlay=!0)}updateOptions(L){L&&(this.loop=L.loop??this.loop,this.maxDistance=L.maxDistance??this.maxDistance,this.useCustomAttenuation=L.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=L.rolloffFactor??this.rolloffFactor,this.refDistance=L.refDistance??this.refDistance,this.distanceModel=L.distanceModel??this.distanceModel,this._playbackRate=L.playbackRate??this._playbackRate,this._length=L.length??void 0,this.spatialSound=L.spatialSound??this._spatialSound,this._setOffset(L.offset??void 0),this.setVolume(L.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var L;null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&Nr.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Nr.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var L;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(L=this._soundPanner)||void 0===L||L.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var L;null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(L){var r;null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(L),this._isOutputConnected=!0)}setDirectionalCone(L,r,p){r<L?b.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=L,this._coneOuterAngle=r,this._coneOuterGain=p,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(L){if(L!=this._coneInnerAngle){var r;if(this._coneOuterAngle<L)return void b.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=L,null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(L){if(L!=this._coneOuterAngle){var r;if(L<this._coneInnerAngle)return void b.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=L,null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(L){var r;L.equals(this._position)||(this._position.G(L),null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(L){var r;this._localDirection=L,null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const L=this._connectedTransformNode.getWorldMatrix(),r=i.cr.TransformNormal(this._localDirection,L);r.normalize(),this._soundPanner.orientationX.value=r.x,this._soundPanner.orientationY.value=r.y,this._soundPanner.orientationZ.value=r.z}updateDistanceFromListener(){var L;if(null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const L=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Pr(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,L,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(L){this._customAttenuationFunction=L}play(L,r,p){var J;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(J=Nr.e.audioEngine)&&void 0!==J&&J.audioContext)try{var i,n;this._clearTimeoutsAndObservers();let J=L?(null===(i=Nr.e.audioEngine)||void 0===i?void 0:i.audioContext.currentTime)+L:null===(n=Nr.e.audioEngine)||void 0===n?void 0:n.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Nr.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const L=()=>{var p;if(null!==(p=Nr.e.audioEngine)&&void 0!==p&&p.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=r??0;const p=this._htmlAudioElement.play();void 0!==p&&p.catch((()=>{var r,p;(null===(r=Nr.e.audioEngine)||void 0===r||r.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(p=Nr.e.audioEngine)||void 0===p?void 0:p.onAudioUnlockedObservable.addOnce((()=>{L()})))}))}else{var J;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(J=Nr.e.audioEngine)||void 0===J?void 0:J.onAudioUnlockedObservable.addOnce((()=>{L()}))}};L()}}else{var j;const i=()=>{var i;if(null!==(i=Nr.e.audioEngine)&&void 0!==i&&i.audioContext){var n;if(p=p||this._length,void 0!==r&&this._setOffset(r),this._soundSource){const L=this._soundSource;L.onended=()=>{L.disconnect()}}if(this._soundSource=null===(n=Nr.e.audioEngine)||void 0===n?void 0:n.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var j;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==r&&(this._soundSource.loopStart=r),void 0!==p&&(this._soundSource.loopEnd=(0|r)+p),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},J=L?(null===(j=Nr.e.audioEngine)||void 0===j?void 0:j.audioContext.currentTime)+L:Nr.e.audioEngine.audioContext.currentTime;const i=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(J,i,this.loop?void 0:p)}}};"suspended"===(null===(j=Nr.e.audioEngine)||void 0===j?void 0:j.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var L;"suspended"===(null===(L=Nr.e.audioEngine)||void 0===L?void 0:L.audioContext.state)?(Nr.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Nr.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{i()})))):i()}),500):i()}this._startTime=J,this.isPlaying=!0,this.isPaused=!1}catch(z){b.d.Error("Error while trying to play audio: "+this.name+", "+z.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(L){var r;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var p;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(p=this._streamingSource)||void 0===p||p.disconnect();this.isPlaying=!1}else if(null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.audioContext&&this._soundSource){const r=L?Nr.e.audioEngine.audioContext.currentTime+L:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(r)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var L;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var r;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(r=this._streamingSource)||void 0===r||r.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Nr.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(L,r){var p;null!==(p=Nr.e.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._soundGain&&(r&&Nr.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Nr.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Nr.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(L,Nr.e.audioEngine.audioContext.currentTime+r)):this._soundGain.gain.value=L),this._volume=L}setPlaybackRate(L){this._playbackRate=L,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(L){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=L,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=L=>this._onRegisterAfterWorldMatrixUpdate(L),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(L){var r;if(L.getBoundingInfo){const r=L.getBoundingInfo();this.setPosition(r.boundingSphere.centerWorld)}else this.setPosition(L.absolutePosition);null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const L=()=>{(0,Kr.g)((()=>this._isReadyToPlay),(()=>{p._audioBuffer=this.getAudioBuffer(),p._isReadyToPlay=!0,p.autoplay&&p.play(0,this._offset,this._length)}),void 0,300)},r={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},p=new mp(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,r);return this.useCustomAttenuation&&p.setAttenuationFunction(this._customAttenuationFunction),p.setPosition(this._position),p.setPlaybackRate(this._playbackRate),L(),p}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const L={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(L.connectedMeshId=this._connectedTransformNode.id),L.position=this._position.mz(),L.refDistance=this.refDistance,L.distanceModel=this.distanceModel,L.isDirectional=this._isDirectional,L.localDirectionToMesh=this._localDirection.mz(),L.coneInnerAngle=this._coneInnerAngle,L.coneOuterAngle=this._coneOuterAngle,L.coneOuterGain=this._coneOuterGain),L}static Parse(L,r,p,J){const n=L.name;let j;j=L.url?p+L.url:p+n;const z={autoplay:L.autoplay,loop:L.loop,volume:L.volume,spatialSound:L.spatialSound,maxDistance:L.maxDistance,rolloffFactor:L.rolloffFactor,refDistance:L.refDistance,distanceModel:L.distanceModel,playbackRate:L.playbackRate};let G;if(J){const L=()=>{(0,Kr.g)((()=>J._isReadyToPlay),(()=>{G._audioBuffer=J.getAudioBuffer(),G._isReadyToPlay=!0,G.autoplay&&G.play(0,G._offset,G._length)}),void 0,300)};G=new mp(n,new ArrayBuffer(0),r,null,z),L()}else G=new mp(n,j,r,(()=>{r.removePendingData(G)}),z),r.addPendingData(G);if(L.position){const r=i.cr.Br(L.position);G.setPosition(r)}if(L.isDirectional&&(G.setDirectionalCone(L.coneInnerAngle||360,L.coneOuterAngle||360,L.coneOuterGain||0),L.localDirectionToMesh)){const r=i.cr.Br(L.localDirectionToMesh);G.setLocalDirectionToMesh(r)}if(L.connectedMeshId){const p=r.getMeshById(L.connectedMeshId);p&&G.attachToMesh(p)}return L.metadata&&(G.metadata=L.metadata),G}_setOffset(L){this._offset!==L&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=L)}_clearTimeoutsAndObservers(){var L;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(L=Nr.e.audioEngine)||void 0===L||L.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}mp._SceneComponentInitialization=L=>{throw(0,Ir.d)("AudioSceneComponent")},(0,BL.e)("BABYLON.Sound",mp);class Vr{constructor(L,r,p){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],r.length!==p.length)throw new Error("Sounds length does not equal weights length");this.loop=L,this._weights=p;let J=0;for(const n of p)J+=n;const i=J>0?1/J:0;for(let n=0;n<this._weights.length;n++)this._weights[n]*=i;this._sounds=r;for(const n of this._sounds)n.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(L){if(L!==this._coneInnerAngle){if(this._coneOuterAngle<L)return void b.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=L;for(const r of this._sounds)r.directionalConeInnerAngle=L}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(L){if(L!==this._coneOuterAngle){if(L<this._coneInnerAngle)return void b.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=L;for(const r of this._sounds)r.directionalConeOuterAngle=L}}get volume(){return this._volume}set volume(L){if(L!==this._volume)for(const r of this._sounds)r.setVolume(L)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(L){if(!this.isPaused){this.stop();const L=Math.random();let r=0;for(let p=0;p<this._weights.length;p++)if(r+=this._weights[p],L<=r){this._currentIndex=p;break}}const r=this._sounds[this._currentIndex??0];r.isReady()?r.play(0,this.isPaused?void 0:L):r.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Sr{constructor(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(L=L||g.c.LastCreatedScene)&&(this._scene=L,this.soundCollection=[],this._options=r,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var L;null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.canUseWebAudio&&Nr.e.audioEngine.audioContext&&(this._outputAudioNode=Nr.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Nr.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Nr.e.audioEngine&&Nr.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(L){var r;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._outputAudioNode&&L.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==L.soundTrackId&&(-1===L.soundTrackId?this._scene.mainSoundTrack.removeSound(L):this._scene.soundTracks&&this._scene.soundTracks[L.soundTrackId].removeSound(L)),this.soundCollection.push(L),L.soundTrackId=this.id}removeSound(L){const r=this.soundCollection.indexOf(L);-1!==r&&this.soundCollection.splice(r,1)}setVolume(L){var r;null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=L)}switchPanningModelToHRTF(){var L;if(null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.canUseWebAudio)for(let r=0;r<this.soundCollection.length;r++)this.soundCollection[r].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var L;if(null!==(L=Nr.e.audioEngine)&&void 0!==L&&L.canUseWebAudio)for(let r=0;r<this.soundCollection.length;r++)this.soundCollection[r].switchPanningModelToEqualPower()}connectToAnalyser(L){var r;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=L,null!==(r=Nr.e.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Nr.e.audioEngine.masterGain))}}var Lp=p(12389),rp=p(12355),pp=p(11971);Nr.e.AudioEngineFactory=(L,r,p)=>new Jp(L,r,p);class Jp{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new t.c,this.onAudioLockedObservable=new t.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,pp.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const J=document.createElement("audio");this._hostElement=L,this._audioContext=r,this._audioDestination=p;try{J&&J.canPlayType&&(J.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||J.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(i){}try{J&&J.canPlayType&&J.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(i){}}lock(){this._triggerSuspendedState()}unlock(){var L,r;if("running"===(null===(L=this._audioContext)||void 0===L?void 0:L.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(r=this._audioContext)||void 0===r||r.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{b.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var L;null===(L=this._audioContext)||void 0===L||L.addEventListener("statechange",(()=>{var L;this.unlocked&&"running"!==(null===(L=this._audioContext)||void 0===L?void 0:L.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var L;return null!==(L=this._audioContext)&&void 0!==L&&L.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(L){this.canUseWebAudio=!1,b.d.Error("Web Audio: "+L.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(L){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const L=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",r=document.createElement("style");r.appendChild(document.createTextNode(L)),document.getElementsByTagName("head")[0].appendChild(r),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var L;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(L=this._audioContext)||void 0===L||L.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(L){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=L)}connectToAnalyser(L){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=L,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var ip=p(11988);(0,p(13489).g)(Lp.b.NAME_AUDIO,((L,r,p,J)=>{let i,n=[];if(p.Mx=p.Mx||[],void 0!==L.Mx&&null!==L.Mx)for(let z=0,G=L.Mx.length;z<G;z++){var j;const G=L.Mx[z];null!==(j=Nr.e.audioEngine)&&void 0!==j&&j.canUseWebAudio?(G.url||(G.url=G.name),n[G.url]?p.Mx.push(mp.Parse(G,r,J,n[G.url])):(i=mp.Parse(G,r,J),n[G.url]=i,p.Mx.push(i))):p.Mx.push(new mp(G.name,null,r))}n=[]})),Object.defineProperty(rp.b.prototype,"mainSoundTrack",{get:function(){let L=this._getComponent(Lp.b.NAME_AUDIO);return L||(L=new np(this),this.dp(L)),this._mainSoundTrack||(this._mainSoundTrack=new Sr(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),rp.b.prototype.getSoundByName=function(L){let r;for(r=0;r<this.mainSoundTrack.soundCollection.length;r++)if(this.mainSoundTrack.soundCollection[r].name===L)return this.mainSoundTrack.soundCollection[r];if(this.soundTracks)for(let p=0;p<this.soundTracks.length;p++)for(r=0;r<this.soundTracks[p].soundCollection.length;r++)if(this.soundTracks[p].soundCollection[r].name===L)return this.soundTracks[p].soundCollection[r];return null},Object.defineProperty(rp.b.prototype,"audioEnabled",{get:function(){let L=this._getComponent(Lp.b.NAME_AUDIO);return L||(L=new np(this),this.dp(L)),L.audioEnabled},set:function(L){let r=this._getComponent(Lp.b.NAME_AUDIO);r||(r=new np(this),this.dp(r)),L?r.enableAudio():r.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(rp.b.prototype,"headphone",{get:function(){let L=this._getComponent(Lp.b.NAME_AUDIO);return L||(L=new np(this),this.dp(L)),L.headphone},set:function(L){let r=this._getComponent(Lp.b.NAME_AUDIO);r||(r=new np(this),this.dp(r)),L?r.switchAudioModeForHeadphones():r.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(rp.b.prototype,"audioListenerPositionProvider",{get:function(){let L=this._getComponent(Lp.b.NAME_AUDIO);return L||(L=new np(this),this.dp(L)),L.audioListenerPositionProvider},set:function(L){let r=this._getComponent(Lp.b.NAME_AUDIO);if(r||(r=new np(this),this.dp(r)),L&&"function"!==typeof L)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");r.audioListenerPositionProvider=L},enumerable:!0,configurable:!0}),Object.defineProperty(rp.b.prototype,"audioListenerRotationProvider",{get:function(){let L=this._getComponent(Lp.b.NAME_AUDIO);return L||(L=new np(this),this.dp(L)),L.audioListenerRotationProvider},set:function(L){let r=this._getComponent(Lp.b.NAME_AUDIO);if(r||(r=new np(this),this.dp(r)),L&&"function"!==typeof L)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");r.audioListenerRotationProvider=L},enumerable:!0,configurable:!0}),Object.defineProperty(rp.b.prototype,"audioPositioningRefreshRate",{get:function(){let L=this._getComponent(Lp.b.NAME_AUDIO);return L||(L=new np(this),this.dp(L)),L.audioPositioningRefreshRate},set:function(L){let r=this._getComponent(Lp.b.NAME_AUDIO);r||(r=new np(this),this.dp(r)),r.audioPositioningRefreshRate=L},enumerable:!0,configurable:!0});class np{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(L){this.name=Lp.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new i.cr,this._cachedCameraPosition=new i.cr,this._lastCheck=0,this._invertMatrixTemp=new i.Matrix,this._cameraDirectionTemp=new i.cr,(L=L||g.c.LastCreatedScene)&&(this.Or=L,L.soundTracks=[],L.Mx=[])}register(){this.Or._afterRenderStage.registerStep(Lp.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(L){if(L.Mx=[],this.Or.soundTracks)for(let r=0;r<this.Or.soundTracks.length;r++){const p=this.Or.soundTracks[r];for(let r=0;r<p.soundCollection.length;r++)L.Mx.push(p.soundCollection[r].serialize())}}addFromContainer(L){if(L.Mx)for(const r of L.Mx)r.play(),r.autoplay=!0,this.Or.mainSoundTrack.addSound(r)}removeFromContainer(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(L.Mx)for(const p of L.Mx)p.stop(),p.autoplay=!1,this.Or.mainSoundTrack.removeSound(p),r&&p.dispose()}dispose(){const L=this.Or;if(L._mainSoundTrack&&L.mainSoundTrack.dispose(),L.soundTracks)for(let r=0;r<L.soundTracks.length;r++)L.soundTracks[r].dispose()}disableAudio(){const L=this.Or;let r;for(this._audioEnabled=!1,Nr.e.audioEngine&&Nr.e.audioEngine.audioContext&&Nr.e.audioEngine.audioContext.suspend(),r=0;r<L.mainSoundTrack.soundCollection.length;r++)L.mainSoundTrack.soundCollection[r].pause();if(L.soundTracks)for(r=0;r<L.soundTracks.length;r++)for(let p=0;p<L.soundTracks[r].soundCollection.length;p++)L.soundTracks[r].soundCollection[p].pause()}enableAudio(){const L=this.Or;let r;for(this._audioEnabled=!0,Nr.e.audioEngine&&Nr.e.audioEngine.audioContext&&Nr.e.audioEngine.audioContext.resume(),r=0;r<L.mainSoundTrack.soundCollection.length;r++)L.mainSoundTrack.soundCollection[r].isPaused&&L.mainSoundTrack.soundCollection[r].play();if(L.soundTracks)for(r=0;r<L.soundTracks.length;r++)for(let p=0;p<L.soundTracks[r].soundCollection.length;p++)L.soundTracks[r].soundCollection[p].isPaused&&L.soundTracks[r].soundCollection[p].play()}switchAudioModeForHeadphones(){const L=this.Or;if(this._headphone=!0,L.mainSoundTrack.switchPanningModelToHRTF(),L.soundTracks)for(let r=0;r<L.soundTracks.length;r++)L.soundTracks[r].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const L=this.Or;if(this._headphone=!1,L.mainSoundTrack.switchPanningModelToEqualPower(),L.soundTracks)for(let r=0;r<L.soundTracks.length;r++)L.soundTracks[r].switchPanningModelToEqualPower()}_afterRender(){const L=ip.d.Now;if(this._lastCheck&&L-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=L;const r=this.Or;if(!this._audioEnabled||!r._mainSoundTrack||!r.soundTracks||0===r._mainSoundTrack.soundCollection.length&&1===r.soundTracks.length)return;const p=Nr.e.audioEngine;if(p&&p.audioContext){let L,J=r.activeCamera;if(r.activeCameras&&r.activeCameras.length>0&&(J=r.activeCameras[0]),this.audioListenerPositionProvider){const L=this.audioListenerPositionProvider();p.audioContext.listener.setPosition(L.x||0,L.y||0,L.z||0)}else J?this._cachedCameraPosition.equals(J.globalPosition)||(this._cachedCameraPosition.G(J.globalPosition),p.audioContext.listener.setPosition(J.globalPosition.x,J.globalPosition.y,J.globalPosition.z)):p.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const L=this.audioListenerRotationProvider();p.audioContext.listener.setOrientation(L.x||0,L.y||0,L.z||0,0,1,0)}else J?(J.rigCameras&&J.rigCameras.length>0&&(J=J.rigCameras[0]),J.getViewMatrix().invertToRef(this._invertMatrixTemp),i.cr.TransformNormalToRef(np._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.G(this._cameraDirectionTemp),p.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):p.audioContext.listener.setOrientation(0,0,0,0,1,0);for(L=0;L<r.mainSoundTrack.soundCollection.length;L++){const p=r.mainSoundTrack.soundCollection[L];p.useCustomAttenuation&&p.updateDistanceFromListener()}if(r.soundTracks)for(L=0;L<r.soundTracks.length;L++)for(let p=0;p<r.soundTracks[L].soundCollection.length;p++){const J=r.soundTracks[L].soundCollection[p];J.useCustomAttenuation&&J.updateDistanceFromListener()}}}}np._CameraDirection=new i.cr(0,0,-1),mp._SceneComponentInitialization=L=>{let r=L._getComponent(Lp.b.NAME_AUDIO);r||(r=new np(L),L.dp(r))};const jp="MSFT_audio_emitter";class zp{constructor(L){this.name=jp,this._loader=L,this.enabled=this._loader.isExtensionUsed(jp)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const L=this._loader.di.extensions;if(L&&L[this.name]){const r=L[this.name];this._clips=r.clips,this._emitters=r.emitters,d.Assign(this._clips),d.Assign(this._emitters)}}loadSceneAsync(L,r){return H.LoadExtensionAsync(L,r,this.name,(async(p,J)=>{const i=new Array;i.push(this._loader.loadSceneAsync(L,r));for(const L of J.emitters){const r=d.Get(`${p}/emitters`,this._emitters,L);if(void 0!=r.refDistance||void 0!=r.maxDistance||void 0!=r.rolloffFactor||void 0!=r.distanceModel||void 0!=r.innerAngle||void 0!=r.outerAngle)throw new Error(`${p}: Direction or Distance properties are not allowed on emitters attached to a scene`);i.push(this._loadEmitterAsync(`${p}/emitters/${r.index}`,r))}await Promise.all(i)}))}loadNodeAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(L,J)=>{const n=new Array,z=await this._loader.loadNodeAsync(L,r,(r=>{for(const p of J.emitters){const J=d.Get(`${L}/emitters`,this._emitters,p);n.push(this._loadEmitterAsync(`${L}/emitters/${J.index}`,J).then((()=>{for(const L of J._babylonSounds)L.attachToMesh(r),void 0==J.innerAngle&&void 0==J.outerAngle||(L.setLocalDirectionToMesh(i.cr.Forward()),L.setDirectionalCone(2*j.Tools.ToDegrees(void 0==J.innerAngle?Math.PI:J.innerAngle),2*j.Tools.ToDegrees(void 0==J.outerAngle?Math.PI:J.outerAngle),0))})))}p(r)}));return await Promise.all(n),z}))}loadAnimationAsync(L,r){return H.LoadExtensionAsync(L,r,this.name,(async(p,J)=>{const i=await this._loader.loadAnimationAsync(L,r),n=new Array;d.Assign(J.events);for(const j of J.events)n.push(this._loadAnimationEventAsync(`${p}/events/${j.index}`,L,r,j,i));return await Promise.all(n),i}))}_loadClipAsync(L,r){if(r._objectURL)return r._objectURL;let p;if(r.uri)p=this._loader.loadUriAsync(L,r,r.uri);else{const J=d.Get(`${L}/bufferView`,this._loader.di.bufferViews,r.bufferView);p=this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J)}return r._objectURL=p.then((L=>URL.createObjectURL(new Blob([L],{type:r.mimeType})))),r._objectURL}_loadEmitterAsync(L,r){if(r._babylonSounds=r._babylonSounds||[],!r._babylonData){const L=new Array,p=r.name||`emitter${r.index}`,J={loop:!1,autoplay:!1,volume:void 0==r.volume?1:r.volume};for(let n=0;n<r.clips.length;n++){const i=`/extensions/${this.name}/clips`,j=d.Get(i,this._clips,r.clips[n].clip);L.push(this._loadClipAsync(`${i}/${r.clips[n].clip}`,j).then((L=>{const i=r._babylonSounds[n]=new mp(p,L,this._loader.babylonScene,null,J);i.refDistance=r.refDistance||1,i.maxDistance=r.maxDistance||256,i.rolloffFactor=r.rolloffFactor||1,i.distanceModel=r.distanceModel||"exponential"})))}const i=Promise.all(L).then((()=>{const L=r.clips.map((L=>L.weight||1)),p=new Vr(r.loop||!1,r._babylonSounds,L);r.innerAngle&&(p.directionalConeInnerAngle=2*j.Tools.ToDegrees(r.innerAngle)),r.outerAngle&&(p.directionalConeOuterAngle=2*j.Tools.ToDegrees(r.outerAngle)),r.volume&&(p.volume=r.volume),r._babylonData.sound=p}));r._babylonData={loaded:i}}return r._babylonData.loaded}_getEventAction(L,r,p,J,i){switch(p){case"play":return L=>{const p=(i||0)+(L-J);r.play(p)};case"stop":return()=>{r.stop()};case"pause":return()=>{r.pause()};default:throw new Error(`${L}: Unsupported action ${p}`)}}_loadAnimationEventAsync(L,r,p,J,i){if(0==i.targetedAnimations.length)return Promise.resolve();const n=i.targetedAnimations[0],j=J.Jr,z=d.Get(`/extensions/${this.name}/emitters`,this._emitters,j);return this._loadEmitterAsync(L,z).then((()=>{const r=z._babylonData.sound;if(r){const p=new Rr(J.time,this._getEventAction(L,r,J.action,J.time,J.startOffset));n.animation.addEvent(p),i.onAnimationGroupEndObservable.add((()=>{r.stop()})),i.onAnimationGroupPauseObservable.add((()=>{r.pause()}))}}))}}T(jp),l(jp,!0,(L=>new zp(L)));const Gp="MSFT_lod";class Cp{constructor(L){var r;this.name=Gp,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new t.c,this.onMaterialLODsLoadedObservable=new t.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=L,this.maxLODsToLoad=(null===(r=this._loader.parent.extensionOptions[Gp])||void 0===r?void 0:r.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Gp)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let L=0;L<this._nodePromiseLODs.length;L++){const r=Promise.all(this._nodePromiseLODs[L]).then((()=>{0!==L&&(this._loader.endPerformanceCounter(`Node LOD ${L}`),this._loader.log(`Loaded node LOD ${L}`)),this.onNodeLODsLoadedObservable.notifyObservers(L),L!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${L+1}`),this._loadBufferLOD(this._nodeBufferLODs,L+1),this._nodeSignalLODs[L]&&this._nodeSignalLODs[L].resolve())}));this._loader._completePromises.push(r)}for(let L=0;L<this._materialPromiseLODs.length;L++){const r=Promise.all(this._materialPromiseLODs[L]).then((()=>{0!==L&&(this._loader.endPerformanceCounter(`Material LOD ${L}`),this._loader.log(`Loaded material LOD ${L}`)),this.onMaterialLODsLoadedObservable.notifyObservers(L),L!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${L+1}`),this._loadBufferLOD(this._materialBufferLODs,L+1),this._materialSignalLODs[L]&&this._materialSignalLODs[L].resolve())}));this._loader._completePromises.push(r)}}loadSceneAsync(L,r){const p=this._loader.loadSceneAsync(L,r);return this._loadBufferLOD(this._bufferLODs,0),p}loadNodeAsync(L,r,p){return H.LoadExtensionAsync(L,r,this.name,(async(L,i)=>{let n;const j=this._getLODs(L,r,this._loader.di.nodes,i.ids);this._loader.logOpen(`${L}`);for(let r=0;r<j.length;r++){const L=j[r];0!==r&&(this._nodeIndexLOD=r,this._nodeSignalLODs[r]=this._nodeSignalLODs[r]||new J);const i=L=>{p(L),L.kz(!1)},z=this._loader.loadNodeAsync(`/nodes/${L.index}`,L,i).then((L=>{if(0!==r){const L=j[r-1];L._babylonTransformNode&&(this._disposeTransformNode(L._babylonTransformNode),delete L._babylonTransformNode)}return L.kz(!0),L}));this._nodePromiseLODs[r]=this._nodePromiseLODs[r]||[],0===r?n=z:(this._nodeIndexLOD=null,this._nodePromiseLODs[r].push(z))}return this._loader.logClose(),await n}))}_loadMaterialAsync(L,r,p,J,i){return this._nodeIndexLOD?null:H.LoadExtensionAsync(L,r,this.name,(async(L,n)=>{let j;const z=this._getLODs(L,r,this._loader.di.materials,n.ids);this._loader.logOpen(`${L}`);for(let r=0;r<z.length;r++){const L=z[r];0!==r&&(this._materialIndexLOD=r);const n=this._loader._loadMaterialAsync(`/materials/${L.index}`,L,p,J,(L=>{0===r&&i(L)})).then((L=>{if(0!==r){i(L);const p=z[r-1]._data;p[J]&&(this._disposeMaterials([p[J].babylonMaterial]),delete p[J])}return L}));this._materialPromiseLODs[r]=this._materialPromiseLODs[r]||[],0===r?j=n:(this._materialIndexLOD=null,this._materialPromiseLODs[r].push(n))}return this._loader.logClose(),await j}))}_loadUriAsync(L,r,p){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const i=this._nodeIndexLOD-1;return this._nodeSignalLODs[i]=this._nodeSignalLODs[i]||new J,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(L,r,p)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const i=this._materialIndexLOD-1;return this._materialSignalLODs[i]=this._materialSignalLODs[i]||new J,this._materialSignalLODs[i].promise.then((async()=>await this._loader.loadUriAsync(L,r,p)))}return null}loadBufferAsync(L,r,p,i){if(this._loader.parent.useRangeRequests&&!r.uri){if(!this._loader.bin)throw new Error(`${L}: Uri is missing or the binary glTF is missing its binary chunk`);const r=async(L,r)=>{const n=p,j=n+i-1;let z=L[r];return z?(z.start=Math.min(z.start,n),z.end=Math.max(z.end,j)):(z={start:n,end:j,loaded:new J},L[r]=z),await z.loaded.promise.then((L=>new Uint8Array(L.buffer,L.byteOffset+p-z.start,i)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?r(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?r(this._materialBufferLODs,this._materialIndexLOD):r(this._bufferLODs,0)}return null}_loadBufferLOD(L,r){const p=L[r];p&&(this._loader.log(`Loading buffer range [${p.start}-${p.end}]`),this._loader.bin.readAsync(p.start,p.end-p.start+1).then((L=>{p.loaded.resolve(L)}),(L=>{p.loaded.reject(L)})))}_getLODs(L,r,p,J){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const i=[];for(let n=J.length-1;n>=0;n--)if(i.push(d.Get(`${L}/ids/${J[n]}`,p,J[n])),i.length===this.maxLODsToLoad)return i;return i.push(r),i}_disposeTransformNode(L){const r=[],p=L.material;p&&r.push(p);for(const i of L.getChildMeshes())i.material&&r.push(i.material);L.dispose();const J=r.filter((L=>this._loader.babylonScene.meshes.every((r=>r.material!=L))));this._disposeMaterials(J)}_disposeMaterials(L){const r={};for(const p of L){for(const L of p.getActiveTextures())r[L.uniqueId]=L;p.dispose()}for(const p in r)for(const L of this._loader.babylonScene.materials)L.hasTexture(r[p])&&delete r[p];for(const p in r)r[p].dispose()}}T(Gp),l(Gp,!0,(L=>new Cp(L)));const tp="MSFT_minecraftMesh";class Ep{constructor(L){this.name=tp,this._loader=L,this.enabled=this._loader.isExtensionUsed(tp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtraAsync(L,r,this.name,(async(J,i)=>{if(i){if(!(p instanceof h.b))throw new Error(`${J}: Material type not supported`);const i=this._loader.loadMaterialPropertiesAsync(L,r,p);return p.needAlphaBlending()&&(p.forceDepthWrite=!0,p.separateCullingPass=!0),p.hz=p.forceDepthWrite,p.twoSidedLighting=!0,await i}}))}}T(tp),l(tp,!0,(L=>new Ep(L)));const xp="MSFT_sRGBFactors";class wp{constructor(L){this.name=xp,this._loader=L,this.enabled=this._loader.isExtensionUsed(xp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(L,r,p){return H.LoadExtraAsync(L,r,this.name,(async(J,i)=>{if(i){if(!(p instanceof h.b))throw new Error(`${J}: Material type not supported`);const i=this._loader.loadMaterialPropertiesAsync(L,r,p),n=p.FL().getEngine().useExactSrgbConversions;return p.albedoTexture||p.albedoColor.toLinearSpaceToRef(p.albedoColor,n),p.reflectivityTexture||p.reflectivityColor.toLinearSpaceToRef(p.reflectivityColor,n),await i}}))}}T(xp),l(xp,!0,(L=>new wp(L)));var gp=p(13849);const bp={};var cp=p(13904),Pp=p(13879),Op=p(13858),hp=p(13868);function Up(L,r){for(const p of L)for(const L of p.dataOutputs)if(L.uniqueId===r)return L;throw new Error("Could not find data out connection with unique id "+r)}function Wp(L,r){for(const p of L)if(p instanceof Pp.b)for(const L of p.signalInputs)if(L.uniqueId===r)return L;throw new Error("Could not find signal in connection with unique id "+r)}async function Bp(L,r){const J=await Promise.all(L.allBlocks.map((async L=>{const r=function(L){switch(L){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([p.e(78),p.e(79)]).then(p.bind(p,15278))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await p.e(80).then(p.bind(p,15280))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await p.e(81).then(p.bind(p,15284))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await p.e(82).then(p.bind(p,15288))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await p.e(83).then(p.bind(p,15297))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await p.e(84).then(p.bind(p,15306))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await p.e(85).then(p.bind(p,15314))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await p.e(86).then(p.bind(p,15320))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await p.e(87).then(p.bind(p,15325))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await p.e(90).then(p.bind(p,15359))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await p.e(90).then(p.bind(p,15359))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await p.e(90).then(p.bind(p,15359))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await p.e(90).then(p.bind(p,15359))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await p.e(95).then(p.bind(p,15367))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await p.e(96).then(p.bind(p,15376))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await p.e(97).then(p.bind(p,15381))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await p.e(98).then(p.bind(p,15383))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await p.e(99).then(p.bind(p,15391))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await p.e(100).then(p.bind(p,15400))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await p.e(101).then(p.bind(p,15403))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await p.e(102).then(p.bind(p,15405))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await p.e(103).then(p.bind(p,15410))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await p.e(104).then(p.bind(p,15414))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await p.e(105).then(p.bind(p,15419))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await p.e(106).then(p.bind(p,15423))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await p.e(107).then(p.bind(p,15427))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await p.e(108).then(p.bind(p,15436))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await p.e(109).then(p.bind(p,15442))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await p.e(110).then(p.bind(p,15444))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await p.e(111).then(p.bind(p,15448))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await p.e(112).then(p.bind(p,15456))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await p.e(113).then(p.bind(p,15460))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await p.e(92).then(p.bind(p,15466))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await p.e(114).then(p.bind(p,15474))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await p.e(115).then(p.bind(p,15483))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await p.e(116).then(p.bind(p,15487))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await p.e(93).then(p.bind(p,15490))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await p.e(88).then(p.bind(p,15328))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await p.e(94).then(p.bind(p,15495))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await p.e(94).then(p.bind(p,15495))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await p.e(94).then(p.bind(p,15495))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await p.e(94).then(p.bind(p,15495))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await p.e(94).then(p.bind(p,15495))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await p.e(94).then(p.bind(p,15495))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await p.e(94).then(p.bind(p,15495))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await p.e(94).then(p.bind(p,15495))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await p.e(89).then(p.bind(p,15354))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await p.e(90).then(p.bind(p,15359))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await p.e(90).then(p.bind(p,15359))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await p.e(91).then(p.bind(p,15498))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await p.e(91).then(p.bind(p,15498))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await p.e(91).then(p.bind(p,15498))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await p.e(91).then(p.bind(p,15498))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await p.e(91).then(p.bind(p,15498))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await p.e(91).then(p.bind(p,15498))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await p.e(117).then(p.bind(p,15503))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await p.e(118).then(p.bind(p,15506))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await p.e(119).then(p.bind(p,15515))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await p.e(120).then(p.bind(p,15522))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await p.e(121).then(p.bind(p,15526))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await p.e(122).then(p.bind(p,15533))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await p.e(123).then(p.bind(p,15535))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await p.e(124).then(p.bind(p,15543))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await p.e(125).then(p.bind(p,15548))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await p.e(126).then(p.bind(p,15553))).FlowGraphDataSwitchBlock;default:if(bp[L])return bp[L];throw new Error(`Unknown block name ${L}`)}}(L.className);return await r()})));return function(L,r,p){const J=r.coordinator.createGraph(),i=[],n=r.valueParseFunction??Op.b;for(let j=0;j<L.allBlocks.length;j++){const z=Qp(L.allBlocks[j],{Or:r.coordinator.config.Or,pathConverter:r.pathConverter,assetsContainer:r.coordinator.config.Or,valueParseFunction:n},p[j]);i.push(z),z instanceof cp.b&&J.addEventBlock(z)}for(const j of i){for(const L of j.dataInputs)for(const r of L.connectedPointIds){const p=Up(i,r);L.connectTo(p)}if(j instanceof Pp.b)for(const L of j.signalOutputs)for(const r of L.connectedPointIds){const p=Wp(i,r);L.connectTo(p)}}for(const j of L.executionContexts)Fp(j,{graph:J,valueParseFunction:n},L.rightHanded);return J}(L,r,J)}function Fp(L,r,p){const J=r.graph.createContext();L.enableLogging&&(J.enableLogging=!0),J.treatDataAsRightHanded=p||!1;const i=r.valueParseFunction??Op.b;J.uniqueId=L.uniqueId;const n=J.FL();if(L._assetsContext){var j,z,G,C,t,E,x,w,g,b;const r=L._assetsContext,p={meshes:null===(j=r.meshes)||void 0===j?void 0:j.map((L=>n.getMeshById(L))),lights:null===(z=r.lights)||void 0===z?void 0:z.map((L=>n.getLightByName(L))),cameras:null===(G=r.cameras)||void 0===G?void 0:G.map((L=>n.getCameraByName(L))),materials:null===(C=r.materials)||void 0===C?void 0:C.map((L=>n.getMaterialById(L))),textures:null===(t=r.textures)||void 0===t?void 0:t.map((L=>n.getTextureByName(L))),animations:null===(E=r.animations)||void 0===E?void 0:E.map((L=>n.animations.find((r=>r.name===L)))),skeletons:null===(x=r.skeletons)||void 0===x?void 0:x.map((L=>n.getSkeletonByName(L))),SE:null===(w=r.SE)||void 0===w?void 0:w.map((L=>n.getParticleSystemById(L))),animationGroups:null===(g=r.animationGroups)||void 0===g?void 0:g.map((L=>n.getAnimationGroupByName(L))),transformNodes:null===(b=r.transformNodes)||void 0===b?void 0:b.map((L=>n.getTransformNodeById(L))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Mx:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};J.assetsContext=p}for(const c in L._userVariables){const r=i(c,L._userVariables,J.assetsContext,n);J.userVariables[c]=r}for(const c in L._connectionValues){const r=i(c,L._connectionValues,J.assetsContext,n);J._setConnectionValueByKey(c,r)}return J}function Qp(L,r,p){const J={},i=r.valueParseFunction??Op.b;if(L.config)for(const j in L.config)J[j]=i(j,L.config,r.assetsContainer||r.Or,r.Or);if((0,Op.i)(L.className)){if(!r.pathConverter)throw new Error("Path converter is required for this block");J.pathConverter=r.pathConverter}const n=new p(J);n.uniqueId=L.uniqueId;for(let j=0;j<L.dataInputs.length;j++){const r=n.getDataInput(L.dataInputs[j].name);if(!r)throw new Error("Could not find data input with name "+L.dataInputs[j].name+" in block "+L.className);r.deserialize(L.dataInputs[j])}for(let j=0;j<L.dataOutputs.length;j++){const r=n.getDataOutput(L.dataOutputs[j].name);if(!r)throw new Error("Could not find data output with name "+L.dataOutputs[j].name+" in block "+L.className);r.deserialize(L.dataOutputs[j])}return n.metadata=L.metadata,n.deserialize&&n.deserialize(L),n}function ep(L){const[r,p]=L.split(":");return vp({op:r,extension:p})}function vp(L){var r;let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const J=L.extension?null===(r=Ap[L.extension])||void 0===r?void 0:r[L.op]:upL[L.op];if(!J&&(b.d.Warn(`No mapping found for operation ${L.op} and extension ${L.extension||"KHR_interactivity"}`),p)){const r={},p={flows:{}};if(L.inputValueSockets){r.values={};for(const p in L.inputValueSockets)r.values[p]={name:p}}return L.outputValueSockets&&(p.values={},Object.keys(L.outputValueSockets).forEach((L=>{p.values[L]={name:L}}))),{Pt:[],inputs:r,outputs:p}}return J}function yp(L,r,p){Ap[r]||(Ap[r]={}),Ap[r][L]=p}const Ap={BABYLON:{"flow/log":{Pt:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},upL={"event/onStart":{Pt:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Pt:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Pt:["FlowGraphSendCustomEventBlock"],extraProcessor(L,r,p,J,i){if("event/send"!==r.op||!L.configuration||1!==Object.keys(L.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const n=L.configuration.event.value[0];if("number"!==typeof n)throw new Error("Event id should be a number");const j=J.arrays.events[n],z=i[0];return z.config||(z.config={}),z.config.eventId=j.eventId,z.config.eventData=j.eventData,i}},"event/receive":{Pt:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(L,r){var p;if(!L.configuration)return b.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const J=L.configuration.event;if(!J)return b.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const i=J.value[0];if("number"!==typeof i)return b.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(p=r.events)||void 0===p?void 0:p[i])?{valid:!0}:(b.d.Error(`Event with id ${i} not found`),{valid:!1,error:`Event with id ${i} not found`})},extraProcessor(L,r,p,J,i){if("event/receive"!==r.op||!L.configuration||1!==Object.keys(L.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const n=L.configuration.event.value[0];if("number"!==typeof n)throw new Error("Event id should be a number");const j=J.arrays.events[n],z=i[0];return z.config||(z.config={}),z.config.eventId=j.eventId,z.config.eventData=j.eventData,i}},"math/e":ap("FlowGraphEBlock"),"math/pi":ap("FlowGraphPIBlock"),"math/inf":ap("FlowGraphInfBlock"),"math/nan":ap("FlowGraphNaNBlock"),"math/abs":ap("FlowGraphAbsBlock"),"math/sign":ap("FlowGraphSignBlock"),"math/trunc":ap("FlowGraphTruncBlock"),"math/floor":ap("FlowGraphFloorBlock"),"math/ceil":ap("FlowGraphCeilBlock"),"math/round":{Pt:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i){var n;return(n=i[0]).config||(n.config={}),i[0].config.roundHalfAwayFromZero=!0,i}},"math/fract":ap("FlowGraphFractBlock"),"math/neg":ap("FlowGraphNegationBlock"),"math/add":ap("FlowGraphAddBlock",["a","b"],!0),"math/sub":ap("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Pt:["FlowGraphMultiplyBlock"],extraProcessor(L,r,p,J,i){var n;(n=i[0]).config||(n.config={}),i[0].config.useMatrixPerComponent=!0,i[0].config.preventIntegerFloatArithmetic=!0;let j=-1;return Object.keys(L.values||{}).find((r=>{var p;return void 0!==(null===(p=L.values)||void 0===p?void 0:p[r].type)&&(j=L.values[r].type,!0)})),-1!==j&&(i[0].config.type=J.arrays.types[j].flowGraphType),i},validation:L=>L.values?qp(L):{valid:!0}},"math/div":ap("FlowGraphDivideBlock",["a","b"],!0),"math/rem":ap("FlowGraphModuloBlock",["a","b"]),"math/min":ap("FlowGraphMinBlock",["a","b"]),"math/max":ap("FlowGraphMaxBlock",["a","b"]),"math/clamp":ap("FlowGraphClampBlock",["a","b","c"]),"math/saturate":ap("FlowGraphSaturateBlock"),"math/mix":ap("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":ap("FlowGraphEqualityBlock",["a","b"]),"math/lt":ap("FlowGraphLessThanBlock",["a","b"]),"math/le":ap("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":ap("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":ap("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":ap("FlowGraphIsNaNBlock"),"math/isinf":ap("FlowGraphIsInfBlock"),"math/select":{Pt:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Pt:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":ap("FlowGraphSinBlock"),"math/cos":ap("FlowGraphCosBlock"),"math/tan":ap("FlowGraphTanBlock"),"math/asin":ap("FlowGraphASinBlock"),"math/acos":ap("FlowGraphACosBlock"),"math/atan":ap("FlowGraphATanBlock"),"math/atan2":ap("FlowGraphATan2Block",["a","b"]),"math/sinh":ap("FlowGraphSinhBlock"),"math/cosh":ap("FlowGraphCoshBlock"),"math/tanh":ap("FlowGraphTanhBlock"),"math/asinh":ap("FlowGraphASinhBlock"),"math/acosh":ap("FlowGraphACoshBlock"),"math/atanh":ap("FlowGraphATanhBlock"),"math/exp":ap("FlowGraphExponentialBlock"),"math/log":ap("FlowGraphLogBlock"),"math/log2":ap("FlowGraphLog2Block"),"math/log10":ap("FlowGraphLog10Block"),"math/sqrt":ap("FlowGraphSquareRootBlock"),"math/cbrt":ap("FlowGraphCubeRootBlock"),"math/pow":ap("FlowGraphPowerBlock",["a","b"]),"math/length":ap("FlowGraphLengthBlock"),"math/normalize":ap("FlowGraphNormalizeBlock"),"math/dot":ap("FlowGraphDotBlock",["a","b"]),"math/cross":ap("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":ap("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":ap("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Pt:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Pt:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Pt:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Pt:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Pt:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Pt:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Pt:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":ap("FlowGraphTransposeBlock"),"math/determinant":ap("FlowGraphDeterminantBlock"),"math/inverse":ap("FlowGraphInvertMatrixBlock"),"math/matmul":ap("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Pt:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Wz",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i,n){const j=i[0].dataInputs.find((L=>"rotationQuaternion"===L.name));if(!j)throw new Error("Rotation quaternion input not found");return n._connectionValues[j.uniqueId]&&(n._connectionValues[j.uniqueId].type="Quaternion"),i}},"math/matDecompose":{Pt:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Wz"}}}},"math/quatConjugate":ap("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Pt:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i){var n;return(n=i[0]).config||(n.config={}),i[0].config.type="Quaternion",i}},"math/quatAngleBetween":ap("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Pt:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":ap("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":ap("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Pt:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i){var n;return(n=i[0]).config||(n.config={}),i[0].config.inputIsColumnMajor=!0,i}},"math/extract2x2":{Pt:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Pt:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i){var n;return(n=i[0]).config||(n.config={}),i[0].config.inputIsColumnMajor=!0,i}},"math/extract3x3":{Pt:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Pt:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i){var n;return(n=i[0]).config||(n.config={}),i[0].config.inputIsColumnMajor=!0,i}},"math/extract4x4":{Pt:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Pt:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i,n){var j,z;(z=i[0]).config||(z.config={});const G=i[0].dataInputs[0];return i[0].config.valueType=(null===(j=n._connectionValues[G.uniqueId])||void 0===j?void 0:j.type)??"FlowGraphInteger",i}},"math/and":{Pt:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i,n){var j,z,G;(G=i[0]).config||(G.config={});const C=i[0].dataInputs[0],t=i[0].dataInputs[1];return i[0].config.valueType=(null===(j=n._connectionValues[C.uniqueId])||void 0===j?void 0:j.type)??(null===(z=n._connectionValues[t.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",i}},"math/or":{Pt:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i,n){var j,z,G;(G=i[0]).config||(G.config={});const C=i[0].dataInputs[0],t=i[0].dataInputs[1];return i[0].config.valueType=(null===(j=n._connectionValues[C.uniqueId])||void 0===j?void 0:j.type)??(null===(z=n._connectionValues[t.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",i}},"math/xor":{Pt:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(L,r,p,J,i,n){var j,z,G;(G=i[0]).config||(G.config={});const C=i[0].dataInputs[0],t=i[0].dataInputs[1];return i[0].config.valueType=(null===(j=n._connectionValues[C.uniqueId])||void 0===j?void 0:j.type)??(null===(z=n._connectionValues[t.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",i}},"math/asr":ap("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":ap("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":ap("FlowGraphLeadingZerosBlock"),"math/ctz":ap("FlowGraphTrailingZerosBlock"),"math/popcnt":ap("FlowGraphOneBitsCounterBlock"),"math/rad":ap("FlowGraphDegToRadBlock"),"math/deg":ap("FlowGraphRadToDegBlock"),"type/boolToInt":ap("FlowGraphBooleanToInt"),"type/boolToFloat":ap("FlowGraphBooleanToFloat"),"type/intToBool":ap("FlowGraphIntToBoolean"),"type/intToFloat":ap("FlowGraphIntToFloat"),"type/floatToInt":ap("FlowGraphFloatToInt"),"type/floatToBool":ap("FlowGraphFloatToBoolean"),"flow/sequence":{Pt:["FlowGraphSequenceBlock"],extraProcessor(L,r,p,J,i){const n=i[0];return n.config||(n.config={}),n.config.outputSignalCount=Object.keys(L.flows||[]).length,n.signalOutputs.forEach(((L,r)=>{L.name="out_"+r})),i}},"flow/branch":{Pt:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Pt:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(L){if(L.configuration&&L.configuration.cases){const r=L.configuration.cases.value;if(!r.every((L=>"number"===typeof L&&/^-?\d+$/.test(L.toString()))))return b.d.Warn("Switch cases should be integers. Using empty array instead."),L.configuration.cases.value=[],{valid:!0};const p=new Set(r);L.configuration.cases.value=Array.from(p)}return{valid:!0}},extraProcessor(L,r,p,J,i){if("flow/switch"!==r.op||!L.flows||0===Object.keys(L.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return i[0].signalOutputs.forEach((L=>{"default"!==L.name&&(L.name="out_"+L.name)})),i}},"flow/while":{Pt:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Pt:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(L,r,p,J,i){const n=i[0];return n.config||(n.config={}),n.config.incrementIndexWhenLoopDone=!0,i}},"flow/doN":{Pt:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Pt:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(L,r,p,J,i){if("flow/multiGate"!==r.op||!L.flows||0===Object.keys(L.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const n=i[0];return n.config||(n.config={}),n.config.outputSignalCount=Object.keys(L.flows).length,n.signalOutputs.forEach(((L,r)=>{L.name="out_"+r})),i}},"flow/waitAll":{Pt:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(L){var r,p;return"number"!==typeof(null===(r=L.configuration)||void 0===r||null===(p=r.inputFlows)||void 0===p?void 0:p.value[0])&&(L.configuration=L.configuration||{inputFlows:{value:[0]}},L.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Pt:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Pt:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Pt:["FlowGraphCancelDelayBlock"]},"variable/get":{Pt:["FlowGraphGetVariableBlock"],validation(L){var r,p;return null!==(r=L.configuration)&&void 0!==r&&null!==(p=r.variable)&&void 0!==p&&p.value?{valid:!0}:(b.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(L,r)=>[r.getVariableName(L[0])]}}},"variable/set":{Pt:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(L,r)=>[r.getVariableName(L[0])]}}},"variable/setMultiple":{Pt:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(L,r)=>[L[0].map((L=>r.getVariableName(L)))]}},extraProcessor:(L,r,p,J,i)=>(i[0].dataInputs.forEach((L=>{L.name=J.getVariableName(+L.name)})),i)},"variable/interpolate":{Pt:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(L,r)=>[r.getVariableName(L[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:L=>!0===L[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ap:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ap:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ap:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ap:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ap:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ap:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(L,r,p,J,i){var n,j,z;const G=i[0],C=null===(n=L.configuration)||void 0===n?void 0:n.variable.value[0];if("number"!==typeof C)throw b.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const t=J.arrays.staticVariables[C];"undefined"===typeof G.config.animationType.value&&(J.arrays.staticVariables,G.config.animationType.value=(0,hp.K)(t.type));const E=i[4];return E.config||(E.config={}),(j=E.config).variable||(j.variable={}),E.config.variable.value=J.getVariableName(C),(z=i[3]).config||(z.config={}),i}},"pointer/get":{Pt:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ap:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Ap:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,r,p,J,i)=>(i.forEach((L=>{"FlowGraphJsonPointerParserBlock"===L.className&&(L.config||(L.config={}),L.config.outputValue=!0)})),i)},"pointer/set":{Pt:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ap:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Ap:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,r,p,J,i)=>(i.forEach((L=>{"FlowGraphJsonPointerParserBlock"===L.className&&(L.config||(L.config={}),L.config.outputValue=!0)})),i)},"pointer/interpolate":{Pt:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Ap:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Ap:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ap:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ap:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ap:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ap:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ap:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ap:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(L,r,p,J,i)=>(i.forEach((r=>{"FlowGraphJsonPointerParserBlock"===r.className?(r.config||(r.config={}),r.config.outputValue=!0):"FlowGraphInterpolationBlock"===r.className&&(r.config||(r.config={}),Object.keys(L.values||[]).forEach((p=>{var i;const n=null===(i=L.values)||void 0===i?void 0:i[p];if("value"===p&&n){const L=n.type;void 0!==L&&(r.config.animationType=J.arrays.types[L].flowGraphType)}})))})),i)},"animation/start":{Pt:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ap:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(L,r)=>[L[0]*r._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(L,r)=>[L[0]*r._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,r,p,J,i,n,j){const z=i[i.length-1];return z.config||(z.config={}),z.config.glTF=j,i}},"animation/stop":{Pt:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ap:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,r,p,J,i,n,j){const z=i[i.length-1];return z.config||(z.config={}),z.config.glTF=j,i}},"animation/stopAt":{Pt:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Ap:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(L,r)=>[L[0]*r._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(L,r,p,J,i,n,j){const z=i[i.length-1];return z.config||(z.config={}),z.config.glTF=j,i}},"math/switch":{Pt:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(L){if(L.configuration&&L.configuration.cases){const r=L.configuration.cases.value;if(!r.every((L=>"number"===typeof L&&/^-?\d+$/.test(L.toString()))))return b.d.Warn("Switch cases should be integers. Using empty array instead."),L.configuration.cases.value=[],{valid:!0};const p=new Set(r);L.configuration.cases.value=Array.from(p)}return{valid:!0}},extraProcessor(L,r,p,J,i){const n=i[0];return n.dataInputs.forEach((L=>{"default"!==L.name&&"case"!==L.name&&(L.name="in_"+L.name)})),n.config||(n.config={}),n.config.treatCasesAsIntegers=!0,i}},"debug/log":{Pt:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function ap(L){let r=arguments.length>2?arguments[2]:void 0;return{Pt:[L],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((L,r)=>(L[r]={name:r},L)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(L,p,J,i,n){var j;if(r){(j=n[0]).config||(j.config={}),n[0].config.preventIntegerFloatArithmetic=!0;let r=-1;Object.keys(L.values||{}).find((p=>{var J;return void 0!==(null===(J=L.values)||void 0===J?void 0:J[p].type)&&(r=L.values[p].type,!0)})),-1!==r&&(n[0].config.type=i.arrays.types[r].flowGraphType)}return n},validation:L=>r?qp(L):{valid:!0}}}function qp(L){if(L.values){const r=Object.keys(L.values).map((r=>L.values[r].type)).filter((L=>void 0!==L));if(!r.every((L=>L===r[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}upL["math/compose"]=upL["math/matCompose"],upL["math/decompose"]=upL["math/matDecompose"];var Zp=p(12091);const Xp={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"cr",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Dp{constructor(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=L,this._gltf=r,this._animationTargetFps=p,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const L of this._interactivityGraph.types)this._types.push(Xp[L.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const L of this._interactivityGraph.declarations){const r=vp(L);if(!r)throw b.d.Error(["No mapping found for declaration",L]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:r,fullOperationName:L.extension?L.op+":"+L.extension:L.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const L of this._interactivityGraph.variables){const r=this._parseVariable(L);this._staticVariables.push(r)}}_parseVariable(L,r){const p=this._types[L.type];if(!p)throw b.d.Error(["No type found for variable",L]),new Error("Error parsing variables");if(L.value&&L.value.length!==p.length)throw b.d.Error(["Invalid value length for variable",L,p]),new Error("Error parsing variables");const J=L.value||[];if(!J.length)switch(p.flowGraphType){case"boolean":J.push(!1);break;case"FlowGraphInteger":J.push(0);break;case"number":J.push(NaN);break;case"Vector2":J.push(NaN,NaN);break;case"cr":J.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":J.fill(NaN,0,4);break;case"Matrix":J.fill(NaN,0,16);break;case"Matrix3D":J.fill(NaN,0,9)}return"number"===p.elementType&&"string"===typeof J[0]&&(J[0]=parseFloat(J[0])),{type:p.flowGraphType,value:r?r(J,this):J}}_parseEvents(){if(this._interactivityGraph.events)for(const L of this._interactivityGraph.events){const r={eventId:L.id||"internalEvent_"+this._internalEventsCounter++};L.values&&(r.eventData=Object.keys(L.values).map((r=>{var p;const J=null===(p=L.values)||void 0===p?void 0:p[r];if(!J)throw b.d.Error(["No value found for event key",r]),new Error("Error parsing events");const i=this._types[J.type];if(!i)throw b.d.Error(["No type found for event value",J]),new Error("Error parsing events");const n="undefined"!==typeof J.value?this._parseVariable(J):void 0;return{id:r,type:i.flowGraphType,eventData:!0,value:n}}))),this._events.push(r)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const r of this._interactivityGraph.nodes){if("number"!==typeof r.declaration)throw b.d.Error(["No declaration found for node",r]),new Error("Error parsing nodes");const p=this._mappings[r.declaration];if(!p)throw b.d.Error(["No mapping found for node",r]),new Error("Error parsing nodes");if(p.flowGraphMapping.validation){const J=p.flowGraphMapping.validation(r,this._interactivityGraph,this._gltf);var L;if(!J.valid)throw new Error(`Error validating interactivity node ${null===(L=this._interactivityGraph.declarations)||void 0===L?void 0:L[r.declaration].op} - ${J.error}`)}const J=[];for(const L of p.flowGraphMapping.Pt){const i=this._getEmptyBlock(L,p.fullOperationName);this._parseNodeConfiguration(r,i,p.flowGraphMapping,L),J.push(i)}this._nodes.push({Pt:J,fullOperationName:p.fullOperationName})}}_getEmptyBlock(L,r){return{uniqueId:(0,Zp.d)(),className:L,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:r,metadata:{}}}_parseNodeConfiguration(L,r,p,J){const i=r.config;if(L.configuration){const r=Object.keys(L.configuration);for(const z of r){var n,j;const r=null===(n=L.configuration)||void 0===n?void 0:n[z];if(!r)throw b.d.Error(["No value found for node configuration",z]),new Error("Error parsing node configuration");const G=null===(j=p.configuration)||void 0===j?void 0:j[z];if(G&&G.Ap?G.Ap===J:0===p.Pt.indexOf(J)){const L=(null===G||void 0===G?void 0:G.name)||z;r&&"undefined"!==typeof r.value||"undefined"===typeof(null===G||void 0===G?void 0:G.defaultValue)?r.value.length>=0?i[L]={value:1===r.value.length?r.value[0]:r.value}:b.d.Warn(["Invalid value for node configuration",r]):i[L]={value:G.defaultValue},G&&G.dataTransformer&&(i[L].value=G.dataTransformer([i[L].value],this)[0])}}}}_parseNodeConnections(L){for(let B=0;B<this._nodes.length;B++){var r;const F=null===(r=this._interactivityGraph.nodes)||void 0===r?void 0:r[B];if(!F)throw b.d.Error(["No node found for interactivity node",this._nodes[B]]),new Error("Error parsing node connections");const Q=this._nodes[B],e=this._mappings[F.declaration];if(!e)throw b.d.Error(["No mapping found for node",F]),new Error("Error parsing node connections");const v=F.flows||{},y=Object.keys(v).sort();for(const L of y){var p,J,i,n;const r=v[L],C=null===(p=e.flowGraphMapping.outputs)||void 0===p||null===(J=p.flows)||void 0===J?void 0:J[L],t=(null===C||void 0===C?void 0:C.name)||L,E=this._createNewSocketConnection(t,!0);(C&&C.Ap&&Q.Pt.find((L=>L.className===C.Ap))||Q.Pt[0]).signalOutputs.push(E);const x=r.node,w=this._nodes[x];if(!w)throw b.d.Error(["No node found for input node id",x]),new Error("Error parsing node connections");const g=ep(w.fullOperationName);if(!g)throw b.d.Error(["No mapping found for input node",w]),new Error("Error parsing node connections");let c=null===(i=g.inputs)||void 0===i||null===(n=i.flows)||void 0===n?void 0:n[r.socket||"in"],P=!1;if(!c)for(const L in null===(j=g.inputs)||void 0===j?void 0:j.flows){var j,z,G;if(L.startsWith("[")&&L.endsWith("]"))P=!0,c=null===(z=g.inputs)||void 0===z||null===(G=z.flows)||void 0===G?void 0:G[L]}const O=c?P?c.name.replace("$1",r.socket||""):c.name:r.socket||"in",h=c&&c.Ap&&w.Pt.find((L=>L.className===c.Ap))||w.Pt[0];let U=h.signalInputs.find((L=>L.name===O));U||(U=this._createNewSocketConnection(O),h.signalInputs.push(U)),U.connectedPointIds.push(E.uniqueId),E.connectedPointIds.push(U.uniqueId)}const A=F.values||{},u=Object.keys(A);for(const r of u){var C,t;const p=A[r];let J=null===(C=e.flowGraphMapping.inputs)||void 0===C||null===(t=C.values)||void 0===t?void 0:t[r],i=!1;if(!J)for(const L in null===(E=e.flowGraphMapping.inputs)||void 0===E?void 0:E.values){var E,x,w;if(L.startsWith("[")&&L.endsWith("]"))i=!0,J=null===(x=e.flowGraphMapping.inputs)||void 0===x||null===(w=x.values)||void 0===w?void 0:w[L]}const n=J?i?J.name.replace("$1",r):J.name:r,j=this._createNewSocketConnection(n);if((J&&J.Ap&&Q.Pt.find((L=>L.className===J.Ap))||Q.Pt[0]).dataInputs.push(j),void 0!==p.value){const r=this._parseVariable(p,J&&J.dataTransformer);L._connectionValues[j.uniqueId]=r}else{if("undefined"===typeof p.node)throw b.d.Error(["Invalid value for value connection",p]),new Error("Error parsing node connections");{var g,c,P;const L=p.node,r=p.socket||"value",J=this._nodes[L];if(!J)throw b.d.Error(["No node found for output socket reference",p]),new Error("Error parsing node connections");const i=ep(J.fullOperationName);if(!i)throw b.d.Error(["No mapping found for output socket reference",p]),new Error("Error parsing node connections");let n=null===(g=i.outputs)||void 0===g||null===(c=g.values)||void 0===c?void 0:c[r],z=!1;if(!n)for(const p in null===(O=i.outputs)||void 0===O?void 0:O.values){var O,h,U;if(p.startsWith("[")&&p.endsWith("]"))z=!0,n=null===(h=i.outputs)||void 0===h||null===(U=h.values)||void 0===U?void 0:U[p]}const G=n?z?n.name.replace("$1",r):null===(P=n)||void 0===P?void 0:P.name:r,C=n&&n.Ap&&J.Pt.find((L=>L.className===n.Ap))||J.Pt[0];let t=C.dataOutputs.find((L=>L.name===G));t||(t=this._createNewSocketConnection(G,!0),C.dataOutputs.push(t)),j.connectedPointIds.push(t.uniqueId),t.connectedPointIds.push(j.uniqueId)}}}if(e.flowGraphMapping.interBlockConnectors)for(const L of e.flowGraphMapping.interBlockConnectors){const r=L.input,p=L.output,J=L.isVariable;this._connectFlowGraphNodes(r,p,Q.Pt[L.inputBlockIndex],Q.Pt[L.outputBlockIndex],J)}if(e.flowGraphMapping.extraProcessor){var W;const r=null===(W=this._interactivityGraph.declarations)||void 0===W?void 0:W[F.declaration];if(!r)throw b.d.Error(["No declaration found for extra processor",F]),new Error("Error parsing node connections");Q.Pt=e.flowGraphMapping.extraProcessor(F,r,e.flowGraphMapping,this,Q.Pt,L,this._gltf)}}}_createNewSocketConnection(L,r){return{uniqueId:(0,Zp.d)(),name:L,_connectionType:r?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(L,r,p,J,i){const n=i?p.dataInputs:p.signalInputs,j=i?J.dataOutputs:J.signalOutputs,z=n.find((r=>r.name===L))||this._createNewSocketConnection(L),G=j.find((L=>L.name===r))||this._createNewSocketConnection(r,!0);n.find((r=>r.name===L))||n.push(z),j.find((L=>L.name===r))||j.push(G),z.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(z.uniqueId)}getVariableName(L){return"staticVariable_"+L}serializeToFlowGraph(){const L={uniqueId:(0,Zp.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(L);for(let r=0;r<this._staticVariables.length;r++){const p=this._staticVariables[r];L._userVariables[this.getVariableName(r)]=p}return{rightHanded:!0,allBlocks:this._nodes.reduce(((L,r)=>L.concat(r.Pt)),[]),executionContexts:[L]}}}const lp="KHR_interactivity";class Tp{constructor(L){this._loader=L,this.name=lp,this.enabled=this._loader.isExtensionUsed(lp),this._pathConverter=(0,Y.l)(this._loader.di),L._skipStartAnimationStep=!0;const r=L.babylonScene;r&&function(L){(0,Y.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!L.activeCamera)return new i.Quaternion(NaN,NaN,NaN,NaN);const r=i.Quaternion.FromRotationMatrix(L.activeCamera.getWorldMatrix()).normalize();return L.useRightHandedSystem||(r.w*=-1,r.x*=-1),r},type:"Quaternion",getTarget:()=>L.activeCamera}),(0,Y.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!L.activeCamera)return new i.cr(NaN,NaN,NaN);const r=L.activeCamera.getWorldMatrix().getTranslation();return L.useRightHandedSystem||(r.x*=-1),r},type:"cr",getTarget:()=>L.activeCamera}),(0,Y.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:L=>{var r;return(null===(r=L._babylonAnimationGroup)||void 0===r?void 0:r.isPlaying)??!1},type:"boolean",getTarget:L=>L._babylonAnimationGroup}),(0,Y.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:L=>{var r;return((null===(r=L._babylonAnimationGroup)||void 0===r?void 0:r.from)??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,Y.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:L=>{var r;return((null===(r=L._babylonAnimationGroup)||void 0===r?void 0:r.to)??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,Y.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:L=>{var r;return((null===(r=L._babylonAnimationGroup)||void 0===r?void 0:r.getCurrentFrame())??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup}),(0,Y.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:L=>{var r;return((null===(r=L._babylonAnimationGroup)||void 0===r?void 0:r.getCurrentFrame())??0)/60},type:"number",getTarget:L=>L._babylonAnimationGroup})}(r)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var L;if(!this._loader.babylonScene||!this._pathConverter)return;const r=this._loader.babylonScene,p=null===(L=this._loader.di.extensions)||void 0===L?void 0:L.KHR_interactivity;if(!p)return;const J=new gp.b({Or:r});J.dispatchEventsSynchronously=!1;const i=p.graphs.map((L=>new Dp(L,this._loader.di,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(i.map((async L=>await Bp(L,{coordinator:J,pathConverter:this._pathConverter})))),J.start()}}var Yp;Yp=async()=>(await Promise.resolve().then(p.bind(p,13926))).FlowGraphGLTFDataProvider,bp[`${lp}/${"FlowGraphGLTFDataProvider"}`]=Yp,T(lp),l(lp,!0,(L=>new Tp(L)));const Mp="KHR_node_visibility";(0,Y.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:L=>{const r=L._babylonTransformNode;return!r||void 0===r.isVisible||r.isVisible},set:(L,r)=>{var p,J;null===(p=r._primitiveBabylonMeshes)||void 0===p||p.forEach((L=>{L.inheritVisibility=!0})),r._babylonTransformNode&&(r._babylonTransformNode.isVisible=L),null===(J=r._primitiveBabylonMeshes)||void 0===J||J.forEach((r=>{r.isVisible=L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class fp{constructor(L){this.name=Mp,this._loader=L,this.enabled=L.isExtensionUsed(Mp)}async onReady(){var L;null===(L=this._loader.di.nodes)||void 0===L||L.forEach((L=>{var r,p,J,i;(null===(r=L._primitiveBabylonMeshes)||void 0===r||r.forEach((L=>{L.inheritVisibility=!0})),null!==(p=L.extensions)&&void 0!==p&&p.KHR_node_visibility)&&(!1===(null===(J=L.extensions)||void 0===J?void 0:J.KHR_node_visibility.visible)&&(L._babylonTransformNode&&(L._babylonTransformNode.isVisible=!1),null===(i=L._primitiveBabylonMeshes)||void 0===i||i.forEach((L=>{L.isVisible=!1}))))}))}dispose(){this._loader=null}}T(Mp),l(Mp,!0,(L=>new fp(L)));const dp="KHR_node_selectability";yp("event/onSelect",dp,{Pt:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ap:"FlowGraphGetVariableBlock",dataTransformer:L=>["pickedMesh_"+L[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Ap:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,r,p,J,i,n,j){var z,G,C,t,E,x;const w=i[i.length-1];w.config=w.config||{},w.config.glTF=j;const g=null===(z=L.configuration)||void 0===z||null===(G=z.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===g||"number"!==typeof g)throw new Error("nodeIndex not found in configuration");const b="pickedMesh_"+g;return i[1].config.variable=b,n._userVariables[b]={className:"Mesh",id:null===j||void 0===j||null===(C=j.nodes)||void 0===C||null===(t=C[g]._babylonTransformNode)||void 0===t?void 0:t.id,uniqueId:null===j||void 0===j||null===(E=j.nodes)||void 0===E||null===(x=E[g]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},i}}),(0,Y.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:L=>{const r=L._babylonTransformNode;return!r||void 0===r.MG||r.MG},set:(L,r)=>{var p;null===(p=r._primitiveBabylonMeshes)||void 0===p||p.forEach((r=>{r.MG=L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"MG"],type:"boolean"});class sp{constructor(L){this.name=dp,this._loader=L,this.enabled=L.isExtensionUsed(dp)}async onReady(){var L;null===(L=this._loader.di.nodes)||void 0===L||L.forEach((L=>{var r,p,J;null!==(r=L.extensions)&&void 0!==r&&r.KHR_node_selectability&&!1===(null===(p=L.extensions)||void 0===p?void 0:p.KHR_node_selectability.selectable)&&(null===(J=L._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((L=>{L.MG=!1})))}))}dispose(){this._loader=null}}T(dp),l(dp,!0,(L=>new sp(L)));const Hp="KHR_node_hoverability",op="targetMeshPointerOver_";yp("event/onHoverIn",Hp,{Pt:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ap:"FlowGraphGetVariableBlock",dataTransformer:L=>[op+L[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ap:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,r,p,J,i,n,j){var z,G,C,t,E,x;const w=i[i.length-1];w.config=w.config||{},w.config.glTF=j;const g=null===(z=L.configuration)||void 0===z||null===(G=z.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===g||"number"!==typeof g)throw new Error("nodeIndex not found in configuration");const b=op+g;return i[1].config.variable=b,n._userVariables[b]={className:"Mesh",id:null===j||void 0===j||null===(C=j.nodes)||void 0===C||null===(t=C[g]._babylonTransformNode)||void 0===t?void 0:t.id,uniqueId:null===j||void 0===j||null===(E=j.nodes)||void 0===E||null===(x=E[g]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},i}});const kp="targetMeshPointerOut_";yp("event/onHoverOut",Hp,{Pt:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ap:"FlowGraphGetVariableBlock",dataTransformer:L=>[kp+L[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ap:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(L,r,p,J,i,n,j){var z,G,C,t,E,x;const w=i[i.length-1];w.config=w.config||{},w.config.glTF=j;const g=null===(z=L.configuration)||void 0===z||null===(G=z.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===g||"number"!==typeof g)throw new Error("nodeIndex not found in configuration");const b=kp+g;return i[1].config.variable=b,n._userVariables[b]={className:"Mesh",id:null===j||void 0===j||null===(C=j.nodes)||void 0===C||null===(t=C[g]._babylonTransformNode)||void 0===t?void 0:t.id,uniqueId:null===j||void 0===j||null===(E=j.nodes)||void 0===E||null===(x=E[g]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},i}}),(0,Y.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:L=>{const r=L._babylonTransformNode;return!r||void 0===r.pointerOverDisableMeshTesting||r.pointerOverDisableMeshTesting},set:(L,r)=>{var p;null===(p=r._primitiveBabylonMeshes)||void 0===p||p.forEach((r=>{r.pointerOverDisableMeshTesting=!L}))},getTarget:L=>L._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Rp{constructor(L){this.name=Hp,this._loader=L,this.enabled=L.isExtensionUsed(Hp)}async onReady(){var L;null===(L=this._loader.di.nodes)||void 0===L||L.forEach((L=>{var r,p,J;null!==(r=L.extensions)&&void 0!==r&&r.KHR_node_hoverability&&!1===(null===(p=L.extensions)||void 0===p?void 0:p.KHR_node_hoverability.hoverable)&&(null===(J=L._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((L=>{L.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}T(Hp),l(Hp,!0,(L=>new Rp(L)));const Ip="ExtrasAsMetadata";class Np{_assignExtras(L,r){if(r.extras&&Object.keys(r.extras).length>0){const p=L.metadata=L.metadata||{};(p.di=p.di||{}).extras=r.extras}}constructor(L){this.name=Ip,this.enabled=!0,this._loader=L}dispose(){this._loader=null}loadNodeAsync(L,r,p){return this._loader.loadNodeAsync(L,r,(L=>{this._assignExtras(L,r),p(L)}))}loadCameraAsync(L,r,p){return this._loader.loadCameraAsync(L,r,(L=>{this._assignExtras(L,r),p(L)}))}createMaterial(L,r,p){const J=this._loader.createMaterial(L,r,p);return this._assignExtras(J,r),J}}T(Ip),l(Ip,!1,(L=>new Np(L)));p(13926)},13779:(L,r,p)=>{"use strict";p.d(r,{c:()=>q,e:()=>e,h:()=>Q,j:()=>v});var J=p(11964),i=p(11957),n=p(13394),j=p(12575),z=p(12541),G=p(12547),C=p(11975),t=p(12009),E=p(12567),x=p(12654),w=p(12579),g=p(12167);class b{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.SE=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Mx=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(L){this._environmentTexture=L}getNodes(){let L=[];L=L.concat(this.meshes),L=L.concat(this.lights),L=L.concat(this.cameras),L=L.concat(this.transformNodes);for(const r of this.skeletons)L=L.concat(r.bones);return L}}class c extends b{}class P{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const L=this.rootNodes;for(const J of L)J.dispose();L.length=0;const r=this.skeletons;for(const J of r)J.dispose();r.length=0;const p=this.animationGroups;for(const J of p)J.dispose();p.length=0}}class O extends b{constructor(L){super(),this._wasAddedToScene=!1,(L=L||t.c.LastCreatedScene)&&(this.Or=L,this.proceduralTextures=[],L.ji.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=L.getEngine().onContextRestoredObservable.add((()=>{for(const L of this.geometries)L._rebuild();for(const L of this.meshes)L._rebuild();for(const L of this.SE)L.rebuild();for(const L of this.textures)L._rebuild()})))}_topologicalSort(L){const r=new Map;for(const j of L)r.set(j.uniqueId,j);const p={dependsOn:new Map,dependedBy:new Map};for(const j of L){const L=j.uniqueId;p.dependsOn.set(L,new Set),p.dependedBy.set(L,new Set)}for(const j of L){const L=j.uniqueId,J=p.dependsOn.get(L);if(j instanceof E.c){const i=j.sourceMesh;r.has(i.uniqueId)&&(J.add(i.uniqueId),p.dependedBy.get(i.uniqueId).add(L))}const i=p.dependedBy.get(L);for(const n of j.getDescendants()){const J=n.uniqueId;if(r.has(J)){i.add(J);p.dependsOn.get(J).add(L)}}}const J=[],i=[];for(const j of L){const L=j.uniqueId;0===p.dependsOn.get(L).size&&(i.push(j),r.delete(L))}const n=i;for(;n.length>0;){const L=n.shift();J.push(L);const i=p.dependedBy.get(L.uniqueId);for(const J of Array.from(i.values())){const i=p.dependsOn.get(J);i.delete(L.uniqueId),0===i.size&&r.get(J)&&(n.push(r.get(J)),r.delete(J))}}return r.size>0&&(C.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),r.forEach((L=>{C.d.Error(L.name)}))),J}_addNodeAndDescendantsToList(L,r,p,J){if(p&&(!J||J(p))&&!r.has(p.uniqueId)){L.push(p),r.add(p.uniqueId);for(const i of p.getDescendants(!0))this._addNodeAndDescendantsToList(L,r,i,J)}}_isNodeInContainer(L){return L instanceof G.c&&-1!==this.meshes.indexOf(L)||(L instanceof z.e&&-1!==this.transformNodes.indexOf(L)||(L instanceof x.e&&-1!==this.lights.indexOf(L)||L instanceof w.b&&-1!==this.cameras.indexOf(L)))}_isValidHierarchy(){for(const L of this.meshes)if(L.parent&&!this._isNodeInContainer(L.parent))return C.d.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.transformNodes)if(L.parent&&!this._isNodeInContainer(L.parent))return C.d.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.lights)if(L.parent&&!this._isNodeInContainer(L.parent))return C.d.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;for(const L of this.cameras)if(L.parent&&!this._isNodeInContainer(L.parent))return C.d.Warn(`Node ${L.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(L){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||i.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const J={},n={},z=new P,G=[],C=[],t={doNotInstantiate:!0,...p},E=[],x=new Set;for(const i of this.transformNodes)null===i.parent&&this._addNodeAndDescendantsToList(E,x,i,t.predicate);for(const i of this.meshes)null===i.parent&&this._addNodeAndDescendantsToList(E,x,i,t.predicate);const w=this._topologicalSort(E),g=(p,i)=>{if(((r,p)=>{if(J[r.uniqueId]=p.uniqueId,n[p.uniqueId]=p,L&&(p.name=L(r.name)),p instanceof j.c){const L=p;if(L.morphTargetManager){const p=r.morphTargetManager;L.morphTargetManager=p.clone();for(let r=0;r<p.numTargets;r++){const i=p.getTarget(r),j=L.morphTargetManager.getTarget(r);J[i.uniqueId]=j.uniqueId,n[j.uniqueId]=j}}}})(p,i),p.parent){const L=J[p.parent.uniqueId],r=n[L];i.parent=r||p.parent}if(i.position&&p.position&&i.position.G(p.position),i.rotationQuaternion&&p.rotationQuaternion&&i.rotationQuaternion.G(p.rotationQuaternion),i.rotation&&p.rotation&&i.rotation.G(p.rotation),i.Wz&&p.Wz&&i.Wz.G(p.Wz),i.material){const j=i;if(j.material)if(r){const r=p.material;if(-1===C.indexOf(r)){let p=r.clone(L?L(r.name):"Clone of "+r.name);if(C.push(r),J[r.uniqueId]=p.uniqueId,n[p.uniqueId]=p,"MultiMaterial"===r.getClassName()){const i=r;for(const r of i.Qz)r&&(p=r.clone(L?L(r.name):"Clone of "+r.name),C.push(r),J[r.uniqueId]=p.uniqueId,n[p.uniqueId]=p);i.Qz=i.Qz.map((L=>L&&n[J[L.uniqueId]]))}}"InstancedMesh"!==j.getClassName()&&(j.material=n[J[r.uniqueId]])}else"MultiMaterial"===j.material.getClassName()?-1===this.Or.multiMaterials.indexOf(j.material)&&this.Or.addMultiMaterial(j.material):-1===this.Or.materials.indexOf(j.material)&&this.Or.addMaterial(j.material)}null===i.parent&&z.rootNodes.push(i)};for(const i of w)if("InstancedMesh"===i.getClassName()){const L=i,r=L.sourceMesh,p=J[r.uniqueId];g(L,("number"===typeof p?n[p]:r).createInstance(L.name))}else{let L=!0;"Jg"===i.getClassName()||"Node"===i.getClassName()||i.skeleton||!i.getTotalVertices||0===i.getTotalVertices()?L=!1:t.doNotInstantiate&&(L="function"===typeof t.doNotInstantiate?!t.doNotInstantiate(i):!t.doNotInstantiate);const r=L?i.createInstance(`instance of ${i.name}`):i.clone(`Clone of ${i.name}`,null,!0);if(!r)throw new Error(`Could not clone or instantiate node on Asset Container ${i.name}`);g(i,r)}for(const i of this.skeletons){if(t.predicate&&!t.predicate(i))continue;const r=i.clone(L?L(i.name):"Clone of "+i.name);for(const L of this.meshes)if(L.skeleton===i&&!L.isAnInstance){const p=n[J[L.uniqueId]];if(!p||p.isAnInstance)continue;if(p.skeleton=r,-1!==G.indexOf(r))continue;G.push(r);for(const L of r.bones)L._linkedTransformNode&&(L._linkedTransformNode=n[J[L._linkedTransformNode.uniqueId]])}z.skeletons.push(r)}for(const i of this.animationGroups){if(t.predicate&&!t.predicate(i))continue;const r=i.clone(L?L(i.name):"Clone of "+i.name,(L=>n[J[L.uniqueId]]||L));z.animationGroups.push(r)}return z}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||i.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Or.environmentTexture=this.environmentTexture);for(const L of this.Or._serializableComponents)L.addFromContainer(this);this.Or.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const r=[];for(const p of this.cameras)L&&!L(p)||(this.Or.addCamera(p),r.push(p));for(const p of this.lights)L&&!L(p)||(this.Or.addLight(p),r.push(p));for(const p of this.meshes)L&&!L(p)||(this.Or.nt(p),r.push(p));for(const p of this.skeletons)L&&!L(p)||this.Or.addSkeleton(p);for(const p of this.animations)L&&!L(p)||this.Or.addAnimation(p);for(const p of this.animationGroups)L&&!L(p)||this.Or.addAnimationGroup(p);for(const p of this.multiMaterials)L&&!L(p)||this.Or.addMultiMaterial(p);for(const p of this.materials)L&&!L(p)||this.Or.addMaterial(p);for(const p of this.morphTargetManagers)L&&!L(p)||this.Or.addMorphTargetManager(p);for(const p of this.geometries)L&&!L(p)||this.Or.addGeometry(p);for(const p of this.transformNodes)L&&!L(p)||(this.Or.addTransformNode(p),r.push(p));for(const p of this.actionManagers)L&&!L(p)||this.Or.addActionManager(p);for(const p of this.textures)L&&!L(p)||this.Or.addTexture(p);for(const p of this.reflectionProbes)L&&!L(p)||this.Or.addReflectionProbe(p);for(const p of r)p.parent&&-1===this.Or.getNodes().indexOf(p.parent)&&(p.setParent?p.setParent(null):p.parent=null)}removeAllFromScene(){this._isValidHierarchy()||i.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Or.environmentTexture&&(this.Or.environmentTexture=null);for(const L of this.Or._serializableComponents)L.removeFromContainer(this)}removeFromScene(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const r of this.cameras)L&&!L(r)||this.Or.removeCamera(r);for(const r of this.lights)L&&!L(r)||this.Or.removeLight(r);for(const r of this.meshes)L&&!L(r)||this.Or.it(r,!0);for(const r of this.skeletons)L&&!L(r)||this.Or.removeSkeleton(r);for(const r of this.animations)L&&!L(r)||this.Or.removeAnimation(r);for(const r of this.animationGroups)L&&!L(r)||this.Or.removeAnimationGroup(r);for(const r of this.multiMaterials)L&&!L(r)||this.Or.removeMultiMaterial(r);for(const r of this.materials)L&&!L(r)||this.Or.removeMaterial(r);for(const r of this.morphTargetManagers)L&&!L(r)||this.Or.removeMorphTargetManager(r);for(const r of this.geometries)L&&!L(r)||this.Or.removeGeometry(r);for(const r of this.transformNodes)L&&!L(r)||this.Or.removeTransformNode(r);for(const r of this.actionManagers)L&&!L(r)||this.Or.removeActionManager(r);for(const r of this.textures)L&&!L(r)||this.Or.removeTexture(r);for(const r of this.reflectionProbes)L&&!L(r)||this.Or.removeReflectionProbe(r)}dispose(){const L=this.cameras.slice(0);for(const w of L)w.dispose();this.cameras.length=0;const r=this.lights.slice(0);for(const w of r)w.dispose();this.lights.length=0;const p=this.meshes.slice(0);for(const w of p)w.dispose();this.meshes.length=0;const J=this.skeletons.slice(0);for(const w of J)w.dispose();this.skeletons.length=0;const i=this.animationGroups.slice(0);for(const w of i)w.dispose();this.animationGroups.length=0;const n=this.multiMaterials.slice(0);for(const w of n)w.dispose();this.multiMaterials.length=0;const j=this.materials.slice(0);for(const w of j)w.dispose();this.materials.length=0;const z=this.geometries.slice(0);for(const w of z)w.dispose();this.geometries.length=0;const G=this.transformNodes.slice(0);for(const w of G)w.dispose();this.transformNodes.length=0;const C=this.actionManagers.slice(0);for(const w of C)w.dispose();this.actionManagers.length=0;const t=this.textures.slice(0);for(const w of t)w.dispose();this.textures.length=0;const E=this.reflectionProbes.slice(0);for(const w of E)w.dispose();this.reflectionProbes.length=0;const x=this.morphTargetManagers.slice(0);for(const w of x)w.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const w of this.Or._serializableComponents)w.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Or.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(L,r,p){if(L&&r)for(const J of L){let L=!0;if(p)for(const r of p)if(J===r){L=!1;break}L&&(r.push(J),J._parentContainer=this)}}moveAllFromScene(L){this._wasAddedToScene=!1,void 0===L&&(L=new c);for(const r in this)Object.prototype.hasOwnProperty.call(this,r)&&(this[r]=this[r]||("_environmentTexture"===r?null:[]),this._moveAssets(this.Or[r],this[r],L[r]));this.environmentTexture=this.Or.environmentTexture,this.removeAllFromScene()}createRootMesh(){const L=new j.c("assetContainerRootMesh",this.Or);for(const r of this.meshes)r.parent||L.addChild(r);return this.meshes.unshift(L),L}mergeAnimationsTo(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.c.LastCreatedScene,r=arguments.length>1?arguments[1]:void 0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!L)return C.d.Error("No scene available to merge animations to"),[];const J=p||(r=>{let p=null;const J=r.animations.length?r.animations[0].targetProperty:"",i=r.name.split(".").join("").split("_primitive")[0];switch(J){case"position":case"rotationQuaternion":p=L.getTransformNodeByName(r.name)||L.getTransformNodeByName(i);break;case"influence":p=L.getMorphTargetByName(r.name)||L.getMorphTargetByName(i);break;default:p=L.getNodeByName(r.name)||L.getNodeByName(i)}return p}),i=this.getNodes();for(const z of i){const L=J(z);if(null!==L){for(const r of z.animations){const p=L.animations.filter((L=>L.targetProperty===r.targetProperty));for(const r of p){const p=L.animations.indexOf(r,0);p>-1&&L.animations.splice(p,1)}}L.animations=L.animations.concat(z.animations)}}const n=[],j=this.animationGroups.slice();for(const z of j){n.push(z.clone(z.name,J));for(const L of z.animatables)L.stop()}for(const z of r){const r=J(z.target);r&&(L.beginAnimation(r,z.fromFrame,z.toFrame,z.loopAnimation,z.speedRatio,z.onAnimationEnd?z.onAnimationEnd:void 0,void 0,!0,void 0,z.onAnimationLoop?z.onAnimationLoop:void 0),L.stopAnimation(z.target))}return n}populateRootNodes(){this.rootNodes.length=0;for(const L of this.meshes)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.transformNodes)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.lights)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L);for(const L of this.cameras)L.parent||-1!==this.rootNodes.indexOf(L)||this.rootNodes.push(L)}addAllAssetsToContainer(L){if(!L)return;const r=[],p=new Set;for(r.push(L);r.length>0;){const L=r.pop();if(L instanceof j.c?(L.Pz&&-1===this.geometries.indexOf(L.Pz)&&this.geometries.push(L.Pz),this.meshes.push(L)):L instanceof E.c?this.meshes.push(L):L instanceof z.e?this.transformNodes.push(L):L instanceof x.e?this.lights.push(L):L instanceof w.b&&this.cameras.push(L),L instanceof G.c){if(L.material&&-1===this.materials.indexOf(L.material)){this.materials.push(L.material);for(const r of L.material.getActiveTextures())-1===this.textures.indexOf(r)&&this.textures.push(r)}L.skeleton&&-1===this.skeletons.indexOf(L.skeleton)&&this.skeletons.push(L.skeleton),L.morphTargetManager&&-1===this.morphTargetManagers.indexOf(L.morphTargetManager)&&this.morphTargetManagers.push(L.morphTargetManager)}for(const J of L.getChildren())p.has(J)||r.push(J);p.add(L)}this.populateRootNodes()}_getByTags(L,r,p){if(void 0===r)return L;const J=[];for(const i in L){const n=L[i];g.b&&g.b.MatchesQuery(n,r)&&(!p||p(n))&&J.push(n)}return J}getMeshesByTags(L,r){return this._getByTags(this.meshes,L,r)}getCamerasByTags(L,r){return this._getByTags(this.cameras,L,r)}getLightsByTags(L,r){return this._getByTags(this.lights,L,r)}getMaterialsByTags(L,r){return this._getByTags(this.materials,L,r).concat(this._getByTags(this.multiMaterials,L,r))}getTransformNodesByTags(L,r){return this._getByTags(this.transformNodes,L,r)}}var h=p(12019);class U{constructor(L){this.byteOffset=0,this.buffer=L}async loadAsync(L){const r=await this.buffer.readAsync(this.byteOffset,L);this._dataView=new DataView(r.buffer,r.byteOffset,r.byteLength),this._dataByteOffset=0}readUint32(){const L=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,L}readUint8Array(L){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,L);return this._dataByteOffset+=L,this.byteOffset+=L,r}readString(L){return(0,h.i)(this.readUint8Array(L))}skipBytes(L){this._dataByteOffset+=L,this.byteOffset+=L}}var W=p(13788);const B="Z2xURg",F={name:"di",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:L=>-1!==L.indexOf("asset")&&-1!==L.indexOf("version")||L.startsWith("data:base64,"+B)||L.startsWith("data:;base64,"+B)||L.startsWith("data:application/octet-stream;base64,"+B)||L.startsWith("data:model/gltf-binary;base64,"+B)};var Q,e,v,y=p(12014),A=p(12016);function u(L,r,p){try{return Promise.resolve(new Uint8Array(L,r,p))}catch(J){return Promise.reject(J)}}!function(L){L[L.AUTO=0]="AUTO",L[L.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(Q||(Q={})),function(L){L[L.NONE=0]="NONE",L[L.FIRST=1]="FIRST",L[L.ALL=2]="ALL"}(e||(e={})),function(L){L[L.LOADING=0]="LOADING",L[L.READY=1]="READY",L[L.COMPLETE=2]="COMPLETE"}(v||(v={}));class a{constructor(){this.coordinateSystemMode=Q.AUTO,this.animationStartMode=e.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=L=>Promise.resolve(L),this.extensionOptions={}}G(L){L&&(this.onParsed=L.onParsed,this.coordinateSystemMode=L.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=L.animationStartMode??this.animationStartMode,this.loadNodeAnimations=L.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=L.loadSkins??this.loadSkins,this.loadMorphTargets=L.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=L.compileMaterials??this.compileMaterials,this.useClipPlane=L.useClipPlane??this.useClipPlane,this.compileShadowGenerators=L.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=L.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=L.useRangeRequests??this.useRangeRequests,this.createInstances=L.createInstances??this.createInstances,this.alwaysComputeBoundingBox=L.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=L.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=L.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=L.skipMaterials??this.skipMaterials,this.useSRGBBuffers=L.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=L.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=L.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=L.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=L.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=L.customRootNode,this.onMeshLoaded=L.onMeshLoaded,this.onSkinLoaded=L.onSkinLoaded,this.onTextureLoaded=L.onTextureLoaded,this.onMaterialLoaded=L.onMaterialLoaded,this.onCameraLoaded=L.onCameraLoaded,this.extensionOptions=L.extensionOptions??this.extensionOptions)}}class q extends a{constructor(L){super(),this.onParsedObservable=new J.c,this.onMeshLoadedObservable=new J.c,this.onSkinLoadedObservable=new J.c,this.onTextureLoadedObservable=new J.c,this.onMaterialLoadedObservable=new J.c,this.onCameraLoadedObservable=new J.c,this.onCompleteObservable=new J.c,this.onErrorObservable=new J.c,this.ji=new J.c,this.onExtensionLoadedObservable=new J.c,this.validate=!1,this.onValidatedObservable=new J.c,this._loader=null,this._state=null,this._requests=new Array,this.name=F.name,this.extensions=F.extensions,this.onLoaderStateChangedObservable=new J.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.G(L)}set onParsed(L){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),L&&(this._onParsedObserver=this.onParsedObservable.add(L))}set onMeshLoaded(L){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),L&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(L))}set onSkinLoaded(L){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),L&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((r=>L(r.node,r.skinnedNode))))}set onTextureLoaded(L){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),L&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(L))}set onMaterialLoaded(L){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),L&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(L))}set onCameraLoaded(L){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),L&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(L))}set onComplete(L){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(L)}set onError(L){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(L)}set onDispose(L){this._onDisposeObserver&&this.ji.remove(this._onDisposeObserver),this._onDisposeObserver=this.ji.add(L)}set onExtensionLoaded(L){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(L)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(L){this._loggingEnabled!==L&&(this._loggingEnabled=L,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(L){this._capturePerformanceCounters!==L&&(this._capturePerformanceCounters=L,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(L){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(L)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const L of this._requests)L.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=L=>Promise.resolve(L),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.ji.notifyObservers(void 0),this.ji.clear()}loadFile(L,r,p,n,j,z,G,t){if(ArrayBuffer.isView(r))return this._loadBinary(L,r,p,n,G,t),null;this._progressCallback=j;const E=r.name||i.Tools.GetFilename(r);if(z){if(this.useRangeRequests){this.validate&&C.d.Warn("glTF validation is not supported when range requests are enabled");const p={abort:()=>{},onCompleteObservable:new J.c},i={readAsync:(p,J)=>new Promise(((i,n)=>{this._loadFile(L,r,(L=>{i(new Uint8Array(L))}),!0,(L=>{n(L)}),(L=>{L.setRequestHeader("Range",`bytes=${p}-${p+J-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new U(i)).then((L=>{p.onCompleteObservable.notifyObservers(p),n(L)}),G?L=>G(void 0,L):void 0),p}return this._loadFile(L,r,(r=>{this._validate(L,new Uint8Array(r,0,r.byteLength),p,E),this._unpackBinaryAsync(new U({readAsync:(L,p)=>u(r,L,p),byteLength:r.byteLength})).then((L=>{n(L)}),G?L=>G(void 0,L):void 0)}),!0,G)}return this._loadFile(L,r,(r=>{try{this._validate(L,r,p,E),n({json:this._parseJson(r)})}catch{G&&G()}}),!1,G)}_loadBinary(L,r,p,J,i,n){this._validate(L,new Uint8Array(r.buffer,r.byteOffset,r.byteLength),p,n),this._unpackBinaryAsync(new U({readAsync:(L,p)=>function(L,r,p){try{if(r<0||r>=L.byteLength)throw new RangeError("Offset is out of range.");if(r+p>L.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(L.buffer,L.byteOffset+r,p))}catch(J){return Promise.reject(J)}}(r,L,p),byteLength:r.byteLength})).then((L=>{J(L)}),i?L=>i(void 0,L):void 0)}importMeshAsync(L,r,p,J,i,n){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${n||""}`),this._loader=this._getLoader(p),this._loader.importMeshAsync(L,r,null,p,J,i,n))))}loadAsync(L,r,p,J,i){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(r),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(r),this._loader.loadAsync(L,r,p,J,i))))}loadAssetContainerAsync(L,r,p,J,i){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(r),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(r);const n=new O(L),j=[];this.onMaterialLoadedObservable.add((L=>{j.push(L)}));const z=[];this.onTextureLoadedObservable.add((L=>{z.push(L)}));const G=[];this.onCameraLoadedObservable.add((L=>{G.push(L)}));const C=[];return this.onMeshLoadedObservable.add((L=>{L.morphTargetManager&&C.push(L.morphTargetManager)})),this._loader.importMeshAsync(null,L,n,r,p,J,i).then((L=>(Array.prototype.push.apply(n.geometries,L.geometries),Array.prototype.push.apply(n.meshes,L.meshes),Array.prototype.push.apply(n.SE,L.SE),Array.prototype.push.apply(n.skeletons,L.skeletons),Array.prototype.push.apply(n.animationGroups,L.animationGroups),Array.prototype.push.apply(n.materials,j),Array.prototype.push.apply(n.textures,z),Array.prototype.push.apply(n.lights,L.lights),Array.prototype.push.apply(n.transformNodes,L.transformNodes),Array.prototype.push.apply(n.cameras,G),Array.prototype.push.apply(n.morphTargetManagers,C),n)))}))}canDirectLoad(L){return F.canDirectLoad(L)}directLoad(L,r){if(r.startsWith("base64,"+B)||r.startsWith(";base64,"+B)||r.startsWith("application/octet-stream;base64,"+B)||r.startsWith("model/gltf-binary;base64,"+B)){const p=(0,y.e)(r);return this._validate(L,new Uint8Array(p,0,p.byteLength)),this._unpackBinaryAsync(new U({readAsync:(L,r)=>u(p,L,r),byteLength:p.byteLength}))}return this._validate(L,r),Promise.resolve({json:this._parseJson(r)})}createPlugin(L){return new q(L[F.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((L,r)=>{this.onCompleteObservable.addOnce((()=>{L()})),this.onErrorObservable.addOnce((L=>{r(L)}))}))}_setState(L){this._state!==L&&(this._state=L,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(v[this._state]))}_loadFile(L,r,p,J,i,n){const j=L._loadFile(r,p,(L=>{this._onProgress(L,j)}),!0,J,i,n);return j.onCompleteObservable.add((()=>{j._lengthComputable=!0,j._total=j._loaded})),this._requests.push(j),j}_onProgress(L,r){if(!this._progressCallback)return;r._lengthComputable=L.lengthComputable,r._loaded=L.loaded,r._total=L.total;let p=!0,J=0,i=0;for(const n of this._requests){if(void 0===n._lengthComputable||void 0===n._loaded||void 0===n._total)return;p=p&&n._lengthComputable,J+=n._loaded,i+=n._total}this._progressCallback({lengthComputable:p,loaded:J,total:p?i:0})}_validate(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),W.c.ValidateAsync(r,p,J,(r=>this.preprocessUrlAsync(p+r).then((r=>L._loadFileAsync(r,void 0,!0,!0).then((L=>new Uint8Array(L,0,L.byteLength))))))).then((L=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(L),this.onValidatedObservable.clear()}),(L=>{this._endPerformanceCounter("Validate JSON"),i.Tools.Warn(`Failed to validate: ${L.message}`),this.onValidatedObservable.clear()})))}_getLoader(L){const r=L.json.asset||{};this._log(`Asset version: ${r.version}`),r.minVersion&&this._log(`Asset minimum version: ${r.minVersion}`),r.generator&&this._log(`Asset generator: ${r.generator}`);const p=q._parseVersion(r.version);if(!p)throw new Error("Invalid version: "+r.version);if(void 0!==r.minVersion){const L=q._parseVersion(r.minVersion);if(!L)throw new Error("Invalid minimum version: "+r.minVersion);if(q._compareVersion(L,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+r.minVersion)}const J={1:q._CreateGLTF1Loader,2:q._CreateGLTF2Loader}[p.major];if(!J)throw new Error("Unsupported version: "+r.version);return J(this)}_parseJson(L){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${L.length}`);const r=JSON.parse(L);return this._endPerformanceCounter("Parse JSON"),r}_unpackBinaryAsync(L){return this._startPerformanceCounter("Unpack Binary"),L.loadAsync(20).then((()=>{const r=L.readUint32();if(1179937895!==r)throw new A.h("Unexpected magic: "+r,A.f.GLTFLoaderUnexpectedMagicError);const p=L.readUint32();this.loggingEnabled&&this._log(`Binary version: ${p}`);const J=L.readUint32();let i;switch(this.useRangeRequests||J===L.buffer.byteLength||C.d.Warn(`Length in header does not match actual data length: ${J} != ${L.buffer.byteLength}`),p){case 1:i=this._unpackBinaryV1Async(L,J);break;case 2:i=this._unpackBinaryV2Async(L,J);break;default:throw new Error("Unsupported version: "+p)}return this._endPerformanceCounter("Unpack Binary"),i}))}_unpackBinaryV1Async(L,r){const p=L.readUint32(),J=L.readUint32();if(0!==J)throw new Error(`Unexpected content format: ${J}`);const i=r-L.byteOffset,n={json:this._parseJson(L.readString(p)),bin:null};if(0!==i){const r=L.byteOffset;n.bin={readAsync:(p,J)=>L.buffer.readAsync(r+p,J),byteLength:i}}return Promise.resolve(n)}_unpackBinaryV2Async(L,r){const p=1313821514,J=5130562,i=L.readUint32();if(L.readUint32()!==p)throw new Error("First chunk format is not JSON");return L.byteOffset+i===r?L.loadAsync(i).then((()=>({json:this._parseJson(L.readString(i)),bin:null}))):L.loadAsync(i+8).then((()=>{const n={json:this._parseJson(L.readString(i)),bin:null},j=()=>{const i=L.readUint32();switch(L.readUint32()){case p:throw new Error("Unexpected JSON chunk");case J:{const r=L.byteOffset;n.bin={readAsync:(p,J)=>L.buffer.readAsync(r+p,J),byteLength:i},L.skipBytes(i);break}default:L.skipBytes(i)}return L.byteOffset!==r?L.loadAsync(8).then(j):Promise.resolve(n)};return j()}))}static _parseVersion(L){if("1.0"===L||"1.0.1"===L)return{major:1,minor:0};const r=(L+"").match(/^(\d+)\.(\d+)/);return r?{major:parseInt(r[1]),minor:parseInt(r[2])}:null}static _compareVersion(L,r){return L.major>r.major?1:L.major<r.major?-1:L.minor>r.minor?1:L.minor<r.minor?-1:0}_logOpen(L){this._log(L),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(L){const r=q._logSpaces.substring(0,2*this._logIndentLevel);C.d.Log(`${r}${L}`)}_logDisabled(L){}_startPerformanceCounterEnabled(L){i.Tools.StartPerformanceCounter(L)}_startPerformanceCounterDisabled(L){}_endPerformanceCounterEnabled(L){i.Tools.EndPerformanceCounter(L)}_endPerformanceCounterDisabled(L){}}q.IncrementalLoading=!0,q.HomogeneousCoordinates=!1,q._logSpaces="                                ",(0,n.d)(new q)},13788:(L,r,p)=>{"use strict";p.d(r,{c:()=>j});var J=p(11957);function i(L,r,p,J){const i={externalResourceFunction:J};return p&&(i.uri="file:"===r?p:r+p),ArrayBuffer.isView(L)?GLTFValidator.validateBytes(L,i):GLTFValidator.validateString(L,i)}function n(){const L=[];onmessage=r=>{const p=r.data;switch(p.id){case"init":importScripts(p.url);break;case"validate":i(p.data,p.rootUrl,p.fileName,(r=>new Promise(((p,J)=>{const i=L.length;L.push({resolve:p,reject:J}),postMessage({id:"getExternalResource",index:i,uri:r})})))).then((L=>{postMessage({id:"validate.resolve",value:L})}),(L=>{postMessage({id:"validate.reject",reason:L})}));break;case"getExternalResource.resolve":L[p.index].resolve(p.value);break;case"getExternalResource.reject":L[p.index].reject(p.reason)}}}class j{static ValidateAsync(L,r,p,j){return"function"===typeof Worker?new Promise(((z,G)=>{const C=`${i}(${n})()`,t=URL.createObjectURL(new Blob([C],{type:"application/javascript"})),E=new Worker(t),x=L=>{E.removeEventListener("error",x),E.removeEventListener("message",w),G(L)},w=L=>{const r=L.data;switch(r.id){case"getExternalResource":j(r.uri).then((L=>{E.postMessage({id:"getExternalResource.resolve",index:r.index,value:L},[L.buffer])}),(L=>{E.postMessage({id:"getExternalResource.reject",index:r.index,reason:L})}));break;case"validate.resolve":E.removeEventListener("error",x),E.removeEventListener("message",w),z(r.value),E.terminate();break;case"validate.reject":E.removeEventListener("error",x),E.removeEventListener("message",w),G(r.reason),E.terminate()}};if(E.addEventListener("error",x),E.addEventListener("message",w),E.postMessage({id:"init",url:J.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(L)){const J=L.slice();E.postMessage({id:"validate",data:J,rootUrl:r,fileName:p},[J.buffer])}else E.postMessage({id:"validate",data:L,rootUrl:r,fileName:p})})):(this._LoadScriptPromise||(this._LoadScriptPromise=J.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>i(L,r,p,j))))}}j.Configuration={url:`${J.Tools._DefaultCdnUrl}/gltf_validator.js`}},14316:(L,r,p)=>{"use strict";p.d(r,{e:()=>F});var J=p(12113),i=p(12122),n=p(12162),j=p(12136),z=p(12514),G=p(12438),C=p(12208),t=p(12355),E=p(12087),x=p(12045);p(13521),p(13423),p(13434),p(13425),p(13439),p(13446),p(13452);const w="imageProcessingCompatibility",g="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";x.d.IncludesShadersStore[w]||(x.d.IncludesShadersStore[w]=g);const b="skyPixelShader",c="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";x.d.ShadersStore[b]||(x.d.ShadersStore[b]=c);p(13536),p(13455),p(13464),p(13475),p(13471);const P="skyVertexShader",O="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";x.d.ShadersStore[P]||(x.d.ShadersStore[P]=O);var h=p(12434),U=p(12500),W=p(12493);class B extends z.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class F extends G.c{constructor(L,r){super(L,r),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new j.cr(0,100,0),this.useSunPosition=!1,this.cameraOffset=j.cr.Zero(),this.up=j.cr.Up(),this.dithering=!1,this._cameraPosition=j.cr.Zero(),this._skyOrientation=new j.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(L,r){const p=r._drawWrapper;if(this.isFrozen&&p.effect&&p._wasPreviouslyReady)return!0;r.materialDefines||(r.materialDefines=new B);const J=r.materialDefines,i=this.FL();if(this._isReadyForSubMesh(r))return!0;if((0,W.W)(L,i,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,J),(0,W.N)(L,J,!0,!1),J.IMAGEPROCESSINGPOSTPROCESS!==i.imageProcessingConfiguration.applyByPostProcess&&J.markAsMiscDirty(),J.DITHER!==this.dithering&&J.markAsMiscDirty(),J.isDirty){J.markAsProcessed(),i.resetCachedMaterial();const L=new h.e;J.FOG&&L.addFallback(1,"FOG"),J.IMAGEPROCESSINGPOSTPROCESS=i.imageProcessingConfiguration.applyByPostProcess,J.DITHER=this.dithering;const p=[C.e.PositionKind];J.VERTEXCOLOR&&p.push(C.e.ColorKind);const n="sky",j=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,U.e)(j);const z=J.toString();r.setEffect(i.getEngine().createEffect(n,p,j,[],z,L,this.onCompiled,this.onError),J,this._materialContext)}return!(!r.effect||!r.effect.isReady())&&(J._renderId=i.getRenderId(),p._wasPreviouslyReady=!0,!0)}bindForSubMesh(L,r,p){const J=this.FL(),i=p.materialDefines;if(!i)return;const n=p.effect;if(!n)return;this._activeEffect=n,this.bindOnlyWorldMatrix(L),this._activeEffect.setMatrix("viewProjection",J.getTransformMatrix()),this._mustRebind(J,n,p)&&((0,U.g)(n,this,J),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,W.n)(i,n,J)),J.fogEnabled&&r.applyFog&&J.fogMode!==t.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",J.getViewMatrix()),(0,W.h)(J,r,this._activeEffect);const z=J.activeCamera;if(z){const L=z.getWorldMatrix();this._cameraPosition.x=L.m[12],this._cameraPosition.y=L.m[13],this._cameraPosition.z=L.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const L=Math.PI*(this.inclination-.5),r=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(r)*Math.cos(L),this.sunPosition.y=this.distance*Math.sin(-L),this.sunPosition.z=this.distance*Math.sin(r)*Math.cos(L),j.Quaternion.FromUnitVectorsToRef(j.cr.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(r,this._activeEffect,p)}getAnimatables(){return[]}dispose(L){super.dispose(L)}clone(L){return n.c.Clone((()=>new F(L,this.FL())),this)}serialize(){const L=super.serialize();return L.customType="BABYLON.SkyMaterial",L}getClassName(){return"SkyMaterial"}static Parse(L,r,p){return n.c.Parse((()=>new F(L.name,r)),L,r,p)}}(0,J.e)([(0,i.E)()],F.prototype,"luminance",void 0),(0,J.e)([(0,i.E)()],F.prototype,"turbidity",void 0),(0,J.e)([(0,i.E)()],F.prototype,"rayleigh",void 0),(0,J.e)([(0,i.E)()],F.prototype,"mieCoefficient",void 0),(0,J.e)([(0,i.E)()],F.prototype,"mieDirectionalG",void 0),(0,J.e)([(0,i.E)()],F.prototype,"distance",void 0),(0,J.e)([(0,i.E)()],F.prototype,"inclination",void 0),(0,J.e)([(0,i.E)()],F.prototype,"azimuth",void 0),(0,J.e)([(0,i.D)()],F.prototype,"sunPosition",void 0),(0,J.e)([(0,i.E)()],F.prototype,"useSunPosition",void 0),(0,J.e)([(0,i.D)()],F.prototype,"cameraOffset",void 0),(0,J.e)([(0,i.D)()],F.prototype,"up",void 0),(0,J.e)([(0,i.E)()],F.prototype,"dithering",void 0),(0,E.e)("BABYLON.SkyMaterial",F)},12830:(L,r,p)=>{"use strict";function J(L,r){r.headers=L.headers||{},r.statusMessage=L.statusText,r.statusCode=L.status,r.data=L.response}function i(L,r,p){return new Promise((function(i,n){p=p||{};var j,z,G,C=new XMLHttpRequest,t=p.body,E=p.headers||{};for(j in p.timeout&&(C.timeout=p.timeout),C.ontimeout=C.onerror=function(L){L.timeout="timeout"==L.type,n(L)},C.open(L,r.href||r),C.onload=function(){for(G=C.getAllResponseHeaders().trim().split(/[\r\n]+/),J(C,C);z=G.shift();)z=z.split(": "),C.headers[z.shift().toLowerCase()]=z.join(": ");if((z=C.headers["content-type"])&&~z.indexOf("application/json"))try{C.data=JSON.parse(C.data,p.reviver)}catch(L){return J(C,L),n(L)}(C.status>=400?n:i)(C)},typeof FormData<"u"&&t instanceof FormData||t&&"object"==typeof t&&(E["content-type"]="application/json",t=JSON.stringify(t)),C.withCredentials=!!p.withCredentials,E)C.setRequestHeader(j,E[j]);C.send(t)}))}p.r(r),p.d(r,{del:()=>G,get:()=>n,patch:()=>z,post:()=>j,put:()=>C,send:()=>i});var n=i.bind(i,"GET"),j=i.bind(i,"POST"),z=i.bind(i,"PATCH"),G=i.bind(i,"DELETE"),C=i.bind(i,"PUT")},14438:(L,r,p)=>{"use strict";p.d(r,{d:()=>E});const J=.5*(Math.sqrt(3)-1),i=(3-Math.sqrt(3))/6,n=1/3,j=1/6,z=(Math.sqrt(5)-1)/4,G=(5-Math.sqrt(5))/20,C=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),t=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const E=class{constructor(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const r="function"==typeof L?L:function(L){let r=0,p=0,J=0,i=1;const n=function(){let L=4022871197;return function(r){r=r.toString();for(let p=0;p<r.length;p++){L+=r.charCodeAt(p);let J=.02519603282416938*L;L=J>>>0,J-=L,J*=L,L=J>>>0,J-=L,L+=4294967296*J}return 2.3283064365386963e-10*(L>>>0)}}();r=n(" "),p=n(" "),J=n(" "),r-=n(L),r<0&&(r+=1);p-=n(L),p<0&&(p+=1);J-=n(L),J<0&&(J+=1);return function(){const L=2091639*r+2.3283064365386963e-10*i;return r=p,p=J,J=L-(i=0|L)}}(L);this.p=function(L){const r=new Uint8Array(256);for(let p=0;p<256;p++)r[p]=p;for(let p=0;p<255;p++){const J=p+~~(L()*(256-p)),i=r[p];r[p]=r[J],r[J]=i}return r}(r),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let p=0;p<512;p++)this.perm[p]=this.p[255&p],this.permMod12[p]=this.perm[p]%12}noise2D(L,r){const p=this.permMod12,n=this.perm;let j=0,z=0,G=0;const t=(L+r)*J,E=Math.floor(L+t),x=Math.floor(r+t),w=(E+x)*i,g=L-(E-w),b=r-(x-w);let c,P;g>b?(c=1,P=0):(c=0,P=1);const O=g-c+i,h=b-P+i,U=g-1+2*i,W=b-1+2*i,B=255&E,F=255&x;let Q=.5-g*g-b*b;if(Q>=0){const L=3*p[B+n[F]];Q*=Q,j=Q*Q*(C[L]*g+C[L+1]*b)}let e=.5-O*O-h*h;if(e>=0){const L=3*p[B+c+n[F+P]];e*=e,z=e*e*(C[L]*O+C[L+1]*h)}let v=.5-U*U-W*W;if(v>=0){const L=3*p[B+1+n[F+1]];v*=v,G=v*v*(C[L]*U+C[L+1]*W)}return 70*(j+z+G)}noise3D(L,r,p){const J=this.permMod12,i=this.perm;let z,G,t,E;const x=(L+r+p)*n,w=Math.floor(L+x),g=Math.floor(r+x),b=Math.floor(p+x),c=(w+g+b)*j,P=L-(w-c),O=r-(g-c),h=p-(b-c);let U,W,B,F,Q,e;P>=O?O>=h?(U=1,W=0,B=0,F=1,Q=1,e=0):P>=h?(U=1,W=0,B=0,F=1,Q=0,e=1):(U=0,W=0,B=1,F=1,Q=0,e=1):O<h?(U=0,W=0,B=1,F=0,Q=1,e=1):P<h?(U=0,W=1,B=0,F=0,Q=1,e=1):(U=0,W=1,B=0,F=1,Q=1,e=0);const v=P-U+j,y=O-W+j,A=h-B+j,u=P-F+2*j,a=O-Q+2*j,q=h-e+2*j,Z=P-1+.5,X=O-1+.5,D=h-1+.5,l=255&w,T=255&g,Y=255&b;let M=.6-P*P-O*O-h*h;if(M<0)z=0;else{const L=3*J[l+i[T+i[Y]]];M*=M,z=M*M*(C[L]*P+C[L+1]*O+C[L+2]*h)}let f=.6-v*v-y*y-A*A;if(f<0)G=0;else{const L=3*J[l+U+i[T+W+i[Y+B]]];f*=f,G=f*f*(C[L]*v+C[L+1]*y+C[L+2]*A)}let d=.6-u*u-a*a-q*q;if(d<0)t=0;else{const L=3*J[l+F+i[T+Q+i[Y+e]]];d*=d,t=d*d*(C[L]*u+C[L+1]*a+C[L+2]*q)}let s=.6-Z*Z-X*X-D*D;if(s<0)E=0;else{const L=3*J[l+1+i[T+1+i[Y+1]]];s*=s,E=s*s*(C[L]*Z+C[L+1]*X+C[L+2]*D)}return 32*(z+G+t+E)}noise4D(L,r,p,J){const i=this.perm;let n,j,C,E,x;const w=(L+r+p+J)*z,g=Math.floor(L+w),b=Math.floor(r+w),c=Math.floor(p+w),P=Math.floor(J+w),O=(g+b+c+P)*G,h=L-(g-O),U=r-(b-O),W=p-(c-O),B=J-(P-O);let F=0,Q=0,e=0,v=0;h>U?F++:Q++,h>W?F++:e++,h>B?F++:v++,U>W?Q++:e++,U>B?Q++:v++,W>B?e++:v++;const y=F>=3?1:0,A=Q>=3?1:0,u=e>=3?1:0,a=v>=3?1:0,q=F>=2?1:0,Z=Q>=2?1:0,X=e>=2?1:0,D=v>=2?1:0,l=F>=1?1:0,T=Q>=1?1:0,Y=e>=1?1:0,M=v>=1?1:0,f=h-y+G,d=U-A+G,s=W-u+G,H=B-a+G,o=h-q+2*G,k=U-Z+2*G,R=W-X+2*G,I=B-D+2*G,N=h-l+3*G,K=U-T+3*G,mL=W-Y+3*G,V=B-M+3*G,S=h-1+4*G,LL=U-1+4*G,rL=W-1+4*G,pL=B-1+4*G,JL=255&g,iL=255&b,nL=255&c,jL=255&P;let zL=.6-h*h-U*U-W*W-B*B;if(zL<0)n=0;else{const L=i[JL+i[iL+i[nL+i[jL]]]]%32*4;zL*=zL,n=zL*zL*(t[L]*h+t[L+1]*U+t[L+2]*W+t[L+3]*B)}let GL=.6-f*f-d*d-s*s-H*H;if(GL<0)j=0;else{const L=i[JL+y+i[iL+A+i[nL+u+i[jL+a]]]]%32*4;GL*=GL,j=GL*GL*(t[L]*f+t[L+1]*d+t[L+2]*s+t[L+3]*H)}let CL=.6-o*o-k*k-R*R-I*I;if(CL<0)C=0;else{const L=i[JL+q+i[iL+Z+i[nL+X+i[jL+D]]]]%32*4;CL*=CL,C=CL*CL*(t[L]*o+t[L+1]*k+t[L+2]*R+t[L+3]*I)}let tL=.6-N*N-K*K-mL*mL-V*V;if(tL<0)E=0;else{const L=i[JL+l+i[iL+T+i[nL+Y+i[jL+M]]]]%32*4;tL*=tL,E=tL*tL*(t[L]*N+t[L+1]*K+t[L+2]*mL+t[L+3]*V)}let EL=.6-S*S-LL*LL-rL*rL-pL*pL;if(EL<0)x=0;else{const L=i[JL+1+i[iL+1+i[nL+1+i[jL+1]]]]%32*4;EL*=EL,x=EL*EL*(t[L]*S+t[L+1]*LL+t[L+2]*rL+t[L+3]*pL)}return 27*(n+j+C+E+x)}}}}]);