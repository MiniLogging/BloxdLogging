/*! For license information please see k7wfyk.32.aa876dbb.chunk.js.LICENSE.txt */
(self.zjjkhojdx1=self.zjjkhojdx1||[]).push([[32],{13191:(k,h,o)=>{"use strict";var x=o(13199),I=o(13206),q=o(13209);o.g.__TYPEDARRAY_POOL||(o.g.__TYPEDARRAY_POOL={UINT8:I([32,0]),UINT16:I([32,0]),UINT32:I([32,0]),INT8:I([32,0]),INT16:I([32,0]),INT32:I([32,0]),FLOAT:I([32,0]),DOUBLE:I([32,0]),DATA:I([32,0]),UINT8C:I([32,0]),BUFFER:I([32,0])});var Y="undefined"!==typeof Uint8ClampedArray,J=o.g.__TYPEDARRAY_POOL;J.UINT8C||(J.UINT8C=I([32,0])),J.BUFFER||(J.BUFFER=I([32,0]));var G=J.DATA,l=J.BUFFER;function A(k){if(k){var h=k.length||k.byteLength,o=x.log2(h);G[o].push(k)}}function K(k){k=x.nextPow2(k);var h=x.log2(k),o=G[h];return o.length>0?o.pop():new ArrayBuffer(k)}function a(k){return new Uint8Array(K(k),0,k)}function N(k){return new Uint16Array(K(2*k),0,k)}function X(k){return new Uint32Array(K(4*k),0,k)}function c(k){return new Int8Array(K(k),0,k)}function W(k){return new Int16Array(K(2*k),0,k)}function f(k){return new Int32Array(K(4*k),0,k)}function M(k){return new Float32Array(K(4*k),0,k)}function T(k){return new Float64Array(K(8*k),0,k)}function j(k){return Y?new Uint8ClampedArray(K(k),0,k):a(k)}function d(k){return new DataView(K(k),0,k)}h.free=function(k){if(q(k))l[x.log2(k.length)].push(k);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(k)&&(k=k.buffer),!k)return;var h=k.length||k.byteLength,o=0|x.log2(h);G[o].push(k)}},h.freeUint8=h.freeUint16=h.freeUint32=h.freeInt8=h.freeInt16=h.freeInt32=h.freeFloat32=h.freeFloat=h.freeFloat64=h.freeDouble=h.freeUint8Clamped=h.freeDataView=function(k){A(k.buffer)},h.freeArrayBuffer=A,h.freeBuffer=function(k){l[x.log2(k.length)].push(k)},h.malloc=function(k,h){if(void 0===h||"arraybuffer"===h)return K(k);switch(h){case"uint8":return a(k);case"uint16":return N(k);case"uint32":return X(k);case"int8":return c(k);case"int16":return W(k);case"int32":return f(k);case"float":case"float32":return M(k);case"double":case"float64":return T(k);case"uint8_clamped":return j(k);case"buffer":throw"Buffer not supported";case"data":case"dataview":return d(k);default:return null}return null},h.mallocArrayBuffer=K,h.mallocUint8=a,h.mallocUint16=N,h.mallocUint32=X,h.mallocInt8=c,h.mallocInt16=W,h.mallocInt32=f,h.mallocFloat32=h.mallocFloat=M,h.mallocFloat64=h.mallocDouble=T,h.mallocUint8Clamped=j,h.mallocDataView=d,h.clearCache=function(){for(var k=0;k<32;++k)J.UINT8[k].length=0,J.UINT16[k].length=0,J.UINT32[k].length=0,J.INT8[k].length=0,J.INT16[k].length=0,J.INT32[k].length=0,J.FLOAT[k].length=0,J.DOUBLE[k].length=0,J.UINT8C[k].length=0,G[k].length=0,l[k].length=0}},13292:(k,h,o)=>{k.exports=I;var x=o(12046);function I(k,h){if(!(this instanceof I))return new I(k,h);var o=x.create();x.add(o,k,h),this.base=x.min(x.create(),k,o),this.hA=x.clone(h),this.max=x.max(x.create(),k,o),this.mag=x.length(this.hA)}var q=I.prototype;q.width=function(){return this.hA[0]},q.height=function(){return this.hA[1]},q.depth=function(){return this.hA[2]},q.x0=function(){return this.base[0]},q.y0=function(){return this.base[1]},q.z0=function(){return this.base[2]},q.x1=function(){return this.max[0]},q.y1=function(){return this.max[1]},q.z1=function(){return this.max[2]},q.translate=function(k){return x.add(this.max,this.max,k),x.add(this.base,this.base,k),this},q.setPosition=function(k){return x.add(this.max,k,this.hA),x.i(this.base,k),this},q.expand=function(k){var h=x.create(),o=x.create();return x.max(h,k.max,this.max),x.min(o,k.base,this.base),x.ih(h,h,o),new I(o,h)},q.intersects=function(k){return!(k.base[0]>this.max[0])&&(!(k.base[1]>this.max[1])&&(!(k.base[2]>this.max[2])&&(!(k.max[0]<this.base[0])&&(!(k.max[1]<this.base[1])&&!(k.max[2]<this.base[2])))))},q.touches=function(k){var h=this.union(k);return null!==h&&(0==h.width()||0==h.height()||0==h.depth())},q.union=function(k){if(!this.intersects(k))return null;var h=Math.max(k.base[0],this.base[0]),o=Math.max(k.base[1],this.base[1]),x=Math.max(k.base[2],this.base[2]);return new I([h,o,x],[Math.min(k.max[0],this.max[0])-h,Math.min(k.max[1],this.max[1])-o,Math.min(k.max[2],this.max[2])-x])}},13199:(k,h)=>{"use strict";function o(k){var h=32;return(k&=-k)&&h--,65535&k&&(h-=16),16711935&k&&(h-=8),252645135&k&&(h-=4),858993459&k&&(h-=2),1431655765&k&&(h-=1),h}h.INT_BITS=32,h.INT_MAX=2147483647,h.INT_MIN=-1<<31,h.sign=function(k){return(k>0)-(k<0)},h.abs=function(k){var h=k>>31;return(k^h)-h},h.min=function(k,h){return h^(k^h)&-(k<h)},h.max=function(k,h){return k^(k^h)&-(k<h)},h.isPow2=function(k){return!(k&k-1)&&!!k},h.log2=function(k){var h,o;return h=(k>65535)<<4,h|=o=((k>>>=h)>255)<<3,h|=o=((k>>>=o)>15)<<2,(h|=o=((k>>>=o)>3)<<1)|(k>>>=o)>>1},h.log10=function(k){return k>=1e9?9:k>=1e8?8:k>=1e7?7:k>=1e6?6:k>=1e5?5:k>=1e4?4:k>=1e3?3:k>=100?2:k>=10?1:0},h.popCount=function(k){return 16843009*((k=(858993459&(k-=k>>>1&1431655765))+(k>>>2&858993459))+(k>>>4)&252645135)>>>24},h.countTrailingZeros=o,h.nextPow2=function(k){return k+=0===k,--k,k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,(k|=k>>>16)+1},h.prevPow2=function(k){return k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,(k|=k>>>16)-(k>>>1)},h.parity=function(k){return k^=k>>>16,k^=k>>>8,k^=k>>>4,27030>>>(k&=15)&1};var x=new Array(256);!function(k){for(var h=0;h<256;++h){var o=h,x=h,I=7;for(o>>>=1;o;o>>>=1)x<<=1,x|=1&o,--I;k[h]=x<<I&255}}(x),h.reverse=function(k){return x[255&k]<<24|x[k>>>8&255]<<16|x[k>>>16&255]<<8|x[k>>>24&255]},h.interleave2=function(k,h){return(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k&=65535)|k<<8))|k<<4))|k<<2))|k<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))<<1},h.deinterleave2=function(k,h){return(k=65535&((k=16711935&((k=252645135&((k=858993459&((k=k>>>h&1431655765)|k>>>1))|k>>>2))|k>>>4))|k>>>16))<<16>>16},h.interleave3=function(k,h,o){return k=1227133513&((k=3272356035&((k=251719695&((k=4278190335&((k&=1023)|k<<16))|k<<8))|k<<4))|k<<2),(k|=(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<1)|(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<2},h.deinterleave3=function(k,h){return(k=1023&((k=4278190335&((k=251719695&((k=3272356035&((k=k>>>h&1227133513)|k>>>2))|k>>>4))|k>>>8))|k>>>16))<<22>>22},h.nextCombination=function(k){var h=k|k-1;return h+1|(~h&-~h)-1>>>o(k)+1}},13184:(k,h,o)=>{"use strict";k.exports=function(k,h,o){switch(arguments.length){case 1:return x=[],l(I=k,I,A,!0),x;case 2:return"function"===typeof h?l(k,k,h,!0):function(k,h){return x=[],l(k,h,A,!1),x}(k,h);case 3:return l(k,h,o,!1);default:throw new Error("box-intersect: Invalid arguments")}var I};var x,I=o(13191),q=o(13213),Y=o(13225);function J(k,h){for(var o=0;o<k;++o)if(!(h[o]<=h[o+k]))return!0;return!1}function G(k,h,o,x){for(var I=0,q=0,Y=0,G=k.length;Y<G;++Y){var l=k[Y];if(!J(h,l)){for(var A=0;A<2*h;++A)o[I++]=l[A];x[q++]=Y}}return q}function l(k,h,o,x){var J=k.length,l=h.length;if(!(J<=0||l<=0)){var A=k[0].length>>>1;if(!(A<=0)){var K,a=I.mallocDouble(2*A*J),N=I.mallocInt32(J);if((J=G(k,A,a,N))>0){if(1===A&&x)q.init(J),K=q.sweepComplete(A,o,0,J,a,N,0,J,a,N);else{var X=I.mallocDouble(2*A*l),c=I.mallocInt32(l);(l=G(h,A,X,c))>0&&(q.init(J+l),K=1===A?q.sweepBipartite(A,o,0,J,a,N,0,l,X,c):Y(A,o,x,J,a,N,l,X,c),I.free(X),I.free(c))}I.free(a),I.free(N)}return K}}}function A(k,h){x.push([k,h])}},13232:(k,h)=>{"use strict";var o="d",x="ax",I="fp",q="es",Y="rs",J="re",G="rb",l="bs",A="be",K="bb",a=[o,x,"vv",Y,J,G,"ri",l,A,K,"bi"];function N(k){var h="bruteForce"+(k?"Full":"Partial"),x=[],Y=a.slice();k||Y.splice(3,0,I);var J=["function "+h+"("+Y.join()+"){"];function G(h,I){var Y=function(k,h,x){var I="bruteForce"+(k?"Red":"Blue")+(h?"Flip":"")+(x?"Full":""),Y=["function ",I,"(",a.join(),"){","var ",q,"=2*",o,";"],J="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",G="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(x?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return k?Y.push(J,"Q",":",G):Y.push(G,"Q",":",J),x?Y.push("if(y1<x0||x1<y0)continue;"):h?Y.push("if(y0<=x0||x1<y0)continue;"):Y.push("if(y0<x0||x1<y0)continue;"),Y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),h?Y.push("yi,xi"):Y.push("xi,yi"),Y.push(");if(rv!==void 0)return rv;}}}"),{name:I,code:Y.join("")}}(h,I,k);x.push(Y.code),J.push("return "+Y.name+"("+a.join()+");")}J.push("if(re-rs>be-bs){"),k?(G(!0,!1),J.push("}else{"),G(!1,!1)):(J.push("if(fp){"),G(!0,!0),J.push("}else{"),G(!0,!1),J.push("}}else{if(fp){"),G(!1,!0),J.push("}else{"),G(!1,!1),J.push("}")),J.push("}}return "+h);var l=x.join("")+J.join("");return new Function(l)()}h.partial=N(!1),h.full=N(!0)},13225:(k,h,o)=>{"use strict";k.exports=function(k,h,o,q,A,s,Z,w,D){!function(k,h){var o=8*I.log2(h+1)*(k+1)|0,q=I.nextPow2(j*o);b.length<q&&(x.free(b),b=x.mallocInt32(q));var Y=I.nextPow2(d*o);V.length<Y&&(x.free(V),V=x.mallocDouble(Y))}(k,q+Z);var U,Q=0,B=2*k;i(Q++,0,0,q,0,Z,o?16:0,-1/0,1/0),o||i(Q++,0,0,Z,0,q,1,-1/0,1/0);for(;Q>0;){var E=(Q-=1)*j,n=b[E],H=b[E+1],y=b[E+2],O=b[E+3],z=b[E+4],p=b[E+5],v=Q*d,m=V[v],L=V[v+1],P=1&p,r=!!(16&p),t=A,S=s,C=w,g=D;if(P&&(t=w,S=D,C=A,g=s),!(2&p&&H>=(y=W(k,n,H,y,t,S,L)))&&!(4&p&&(H=f(k,n,H,y,t,S,m))>=y)){var e=y-H,u=z-O;if(r){if(k*e*(e+u)<N){if(void 0!==(U=G.scanComplete(k,n,h,H,y,t,S,O,z,C,g)))return U;continue}}else{if(k*Math.min(e,u)<K){if(void 0!==(U=Y(k,n,h,P,H,y,t,S,O,z,C,g)))return U;continue}if(k*e*u<a){if(void 0!==(U=G.scanBipartite(k,n,h,P,H,y,t,S,O,z,C,g)))return U;continue}}var kk=X(k,n,H,y,t,S,m,L);if(H<kk)if(k*(kk-H)<K){if(void 0!==(U=J(k,n+1,h,H,kk,t,S,O,z,C,g)))return U}else if(n===k-2){if(void 0!==(U=P?G.sweepBipartite(k,h,O,z,C,g,H,kk,t,S):G.sweepBipartite(k,h,H,kk,t,S,O,z,C,g)))return U}else i(Q++,n+1,H,kk,O,z,P,-1/0,1/0),i(Q++,n+1,O,z,H,kk,1^P,-1/0,1/0);if(kk<y){var hk=l(k,n,O,z,C,g),ok=C[B*hk+n],xk=c(k,n,hk,z,C,g,ok);if(xk<z&&i(Q++,n,kk,y,xk,z,(4|P)+(r?16:0),ok,L),O<hk&&i(Q++,n,kk,y,O,hk,(2|P)+(r?16:0),m,ok),hk+1===xk){if(void 0!==(U=r?R(k,n,h,kk,y,t,S,hk,C,g[hk]):F(k,n,h,P,kk,y,t,S,hk,C,g[hk])))return U}else if(hk<xk){var Ik;if(r){if(kk<(Ik=M(k,n,kk,y,t,S,ok))){var qk=c(k,n,kk,Ik,t,S,ok);if(n===k-2){if(kk<qk&&void 0!==(U=G.sweepComplete(k,h,kk,qk,t,S,hk,xk,C,g)))return U;if(qk<Ik&&void 0!==(U=G.sweepBipartite(k,h,qk,Ik,t,S,hk,xk,C,g)))return U}else kk<qk&&i(Q++,n+1,kk,qk,hk,xk,16,-1/0,1/0),qk<Ik&&(i(Q++,n+1,qk,Ik,hk,xk,0,-1/0,1/0),i(Q++,n+1,hk,xk,qk,Ik,1,-1/0,1/0))}}else kk<(Ik=P?T(k,n,kk,y,t,S,ok):M(k,n,kk,y,t,S,ok))&&(n===k-2?U=P?G.sweepBipartite(k,h,hk,xk,C,g,kk,Ik,t,S):G.sweepBipartite(k,h,kk,Ik,t,S,hk,xk,C,g):(i(Q++,n+1,kk,Ik,hk,xk,P,-1/0,1/0),i(Q++,n+1,hk,xk,kk,Ik,1^P,-1/0,1/0)))}}}}};var x=o(13191),I=o(13199),q=o(13232),Y=q.partial,J=q.full,G=o(13213),l=o(13239),A=o(13247),K=128,a=1<<22,N=1<<22,X=A("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),c=A("lo===p0",["p0"]),W=A("lo<p0",["p0"]),f=A("hi<=p0",["p0"]),M=A("lo<=p0&&p0<=hi",["p0"]),T=A("lo<p0&&p0<=hi",["p0"]),j=6,d=2,b=x.mallocInt32(1024),V=x.mallocDouble(1024);function i(k,h,o,x,I,q,Y,J,G){var l=j*k;b[l]=h,b[l+1]=o,b[l+2]=x,b[l+3]=I,b[l+4]=q,b[l+5]=Y;var A=d*k;V[A]=J,V[A+1]=G}function F(k,h,o,x,I,q,Y,J,G,l,A){var K=2*k,a=G*K,N=l[a+h];k:for(var X=I,c=I*K;X<q;++X,c+=K){var W=Y[c+h],f=Y[c+h+k];if(!(N<W||f<N)&&(!x||N!==W)){for(var M,T=J[X],j=h+1;j<k;++j){W=Y[c+j],f=Y[c+j+k];var d=l[a+j],b=l[a+j+k];if(f<d||b<W)continue k}if(void 0!==(M=x?o(A,T):o(T,A)))return M}}}function R(k,h,o,x,I,q,Y,J,G,l){var A=2*k,K=J*A,a=G[K+h];k:for(var N=x,X=x*A;N<I;++N,X+=A){var c=Y[N];if(c!==l){var W=q[X+h],f=q[X+h+k];if(!(a<W||f<a)){for(var M=h+1;M<k;++M){W=q[X+M],f=q[X+M+k];var T=G[K+M],j=G[K+M+k];if(f<T||j<W)continue k}var d=o(c,l);if(void 0!==d)return d}}}}},13239:(k,h,o)=>{"use strict";k.exports=function(k,h,o,Y,J,G){if(Y<=o+1)return o;var l=o,A=Y,K=Y+o>>>1,a=2*k,N=K,X=J[a*K+h];for(;l<A;){if(A-l<I){q(k,h,l,A,J,G),X=J[a*K+h];break}var c=A-l,W=Math.random()*c+l|0,f=J[a*W+h],M=Math.random()*c+l|0,T=J[a*M+h],j=Math.random()*c+l|0,d=J[a*j+h];f<=T?d>=T?(N=M,X=T):f>=d?(N=W,X=f):(N=j,X=d):T>=d?(N=M,X=T):d>=f?(N=W,X=f):(N=j,X=d);for(var b=a*(A-1),V=a*N,i=0;i<a;++i,++b,++V){var F=J[b];J[b]=J[V],J[V]=F}var R=G[A-1];G[A-1]=G[N],G[N]=R;for(b=a*(A-1),V=a*(N=x(k,h,l,A-1,J,G,X)),i=0;i<a;++i,++b,++V){F=J[b];J[b]=J[V],J[V]=F}R=G[A-1];if(G[A-1]=G[N],G[N]=R,K<N){for(A=N-1;l<A&&J[a*(A-1)+h]===X;)A-=1;A+=1}else{if(!(N<K))break;for(l=N+1;l<A&&J[a*l+h]===X;)l+=1}}return x(k,h,o,K,J,G,J[a*K+h])};var x=o(13247)("lo<p0",["p0"]),I=8;function q(k,h,o,x,I,q){for(var Y=2*k,J=Y*(o+1)+h,G=o+1;G<x;++G,J+=Y)for(var l=I[J],A=G,K=Y*(G-1);A>o&&I[K+h]>l;--A,K-=Y){for(var a=K,N=K+Y,X=0;X<Y;++X,++a,++N){var c=I[a];I[a]=I[N],I[N]=c}var W=q[A];q[A]=q[A-1],q[A-1]=W}}},13247:k=>{"use strict";k.exports=function(k,o){var x="abcdef".split("").concat(o),I=[];k.indexOf("lo")>=0&&I.push("lo=e[k+n]");k.indexOf("hi")>=0&&I.push("hi=e[k+o]");return x.push(h.replace("_",I.join()).replace("$",k)),Function.apply(void 0,x)};var h="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13218:k=>{"use strict";k.exports=function(k,x){x<=4*h?o(0,x-1,k):l(0,x-1,k)};var h=32;function o(k,h,o){for(var x=2*(k+1),I=k+1;I<=h;++I){for(var q=o[x++],Y=o[x++],J=I,G=x-2;J-- >k;){var l=o[G-2],A=o[G-1];if(l<q)break;if(l===q&&A<Y)break;o[G]=l,o[G+1]=A,G-=2}o[G]=q,o[G+1]=Y}}function x(k,h,o){h*=2;var x=o[k*=2],I=o[k+1];o[k]=o[h],o[k+1]=o[h+1],o[h]=x,o[h+1]=I}function I(k,h,o){h*=2,o[k*=2]=o[h],o[k+1]=o[h+1]}function q(k,h,o,x){h*=2,o*=2;var I=x[k*=2],q=x[k+1];x[k]=x[h],x[k+1]=x[h+1],x[h]=x[o],x[h+1]=x[o+1],x[o]=I,x[o+1]=q}function Y(k,h,o,x,I){h*=2,I[k*=2]=I[h],I[h]=o,I[k+1]=I[h+1],I[h+1]=x}function J(k,h,o){h*=2;var x=o[k*=2],I=o[h];return!(x<I)&&(x!==I||o[k+1]>o[h+1])}function G(k,h,o,x){var I=x[k*=2];return I<h||I===h&&x[k+1]<o}function l(k,A,K){var a=(A-k+1)/6|0,N=k+a,X=A-a,c=k+A>>1,W=c-a,f=c+a,M=N,T=W,j=c,d=f,b=X,V=k+1,i=A-1,F=0;J(M,T,K)&&(F=M,M=T,T=F),J(d,b,K)&&(F=d,d=b,b=F),J(M,j,K)&&(F=M,M=j,j=F),J(T,j,K)&&(F=T,T=j,j=F),J(M,d,K)&&(F=M,M=d,d=F),J(j,d,K)&&(F=j,j=d,d=F),J(T,b,K)&&(F=T,T=b,b=F),J(T,j,K)&&(F=T,T=j,j=F),J(d,b,K)&&(F=d,d=b,b=F);for(var R=K[2*T],s=K[2*T+1],Z=K[2*d],w=K[2*d+1],D=2*M,U=2*j,Q=2*b,B=2*N,E=2*c,n=2*X,H=0;H<2;++H){var y=K[D+H],O=K[U+H],z=K[Q+H];K[B+H]=y,K[E+H]=O,K[n+H]=z}I(W,k,K),I(f,A,K);for(var p=V;p<=i;++p)if(G(p,R,s,K))p!==V&&x(p,V,K),++V;else if(!G(p,Z,w,K))for(;;){if(G(i,Z,w,K)){G(i,R,s,K)?(q(p,V,i,K),++V,--i):(x(p,i,K),--i);break}if(--i<p)break}Y(k,V-1,R,s,K),Y(A,i+1,Z,w,K),V-2-k<=h?o(k,V-2,K):l(k,V-2,K),A-(i+2)<=h?o(i+2,A,K):l(i+2,A,K),i-V<=h?o(V,i,K):l(V,i,K)}},13213:(k,h,o)=>{"use strict";k.exports={init:function(k){var h=I.nextPow2(k);G.length<h&&(x.free(G),G=x.mallocInt32(h));l.length<h&&(x.free(l),l=x.mallocInt32(h));A.length<h&&(x.free(A),A=x.mallocInt32(h));K.length<h&&(x.free(K),K=x.mallocInt32(h));a.length<h&&(x.free(a),a=x.mallocInt32(h));N.length<h&&(x.free(N),N=x.mallocInt32(h));var o=8*h;X.length<o&&(x.free(X),X=x.mallocDouble(o))},sweepBipartite:function(k,h,o,x,I,J,a,N,f,M){for(var T=0,j=2*k,d=k-1,b=j-1,V=o;V<x;++V){var i=J[V],F=j*V;X[T++]=I[F+d],X[T++]=-(i+1),X[T++]=I[F+b],X[T++]=i}for(V=a;V<N;++V){i=M[V]+Y;var R=j*V;X[T++]=f[R+d],X[T++]=-i,X[T++]=f[R+b],X[T++]=i}var s=T>>>1;q(X,s);var Z=0,w=0;for(V=0;V<s;++V){var D=0|X[2*V+1];if(D>=Y)c(A,K,w--,D=D-Y|0);else if(D>=0)c(G,l,Z--,D);else if(D<=-Y){D=-D-Y|0;for(var U=0;U<Z;++U){if(void 0!==(Q=h(G[U],D)))return Q}W(A,K,w++,D)}else{D=-D-1|0;for(U=0;U<w;++U){var Q;if(void 0!==(Q=h(D,A[U])))return Q}W(G,l,Z++,D)}}},sweepComplete:function(k,h,o,x,I,Y,J,f,M,T){for(var j=0,d=2*k,b=k-1,V=d-1,i=o;i<x;++i){var F=Y[i]+1<<1,R=d*i;X[j++]=I[R+b],X[j++]=-F,X[j++]=I[R+V],X[j++]=F}for(i=J;i<f;++i){F=T[i]+1<<1;var s=d*i;X[j++]=M[s+b],X[j++]=1|-F,X[j++]=M[s+V],X[j++]=1|F}var Z=j>>>1;q(X,Z);var w=0,D=0,U=0;for(i=0;i<Z;++i){var Q=0|X[2*i+1],B=1&Q;if(i<Z-1&&Q>>1===X[2*i+3]>>1&&(B=2,i+=1),Q<0){for(var E=-(Q>>1)-1,n=0;n<U;++n){if(void 0!==(H=h(a[n],E)))return H}if(0!==B)for(n=0;n<w;++n){if(void 0!==(H=h(G[n],E)))return H}if(1!==B)for(n=0;n<D;++n){var H;if(void 0!==(H=h(A[n],E)))return H}0===B?W(G,l,w++,E):1===B?W(A,K,D++,E):2===B&&W(a,N,U++,E)}else{E=(Q>>1)-1;0===B?c(G,l,w--,E):1===B?c(A,K,D--,E):2===B&&c(a,N,U--,E)}}},scanBipartite:function(k,h,o,x,I,J,A,K,a,N,f,M){var T=0,j=2*k,d=h,b=h+k,V=1,i=1;x?i=Y:V=Y;for(var F=I;F<J;++F){var R=F+V,s=j*F;X[T++]=A[s+d],X[T++]=-R,X[T++]=A[s+b],X[T++]=R}for(F=a;F<N;++F){R=F+i;var Z=j*F;X[T++]=f[Z+d],X[T++]=-R}var w=T>>>1;q(X,w);var D=0;for(F=0;F<w;++F){var U=0|X[2*F+1];if(U<0){var Q=!1;if((R=-U)>=Y?(Q=!x,R-=Y):(Q=!!x,R-=1),Q)W(G,l,D++,R);else{var B=M[R],E=j*R,n=f[E+h+1],H=f[E+h+1+k];k:for(var y=0;y<D;++y){var O=G[y],z=j*O;if(!(H<A[z+h+1]||A[z+h+1+k]<n)){for(var p=h+2;p<k;++p)if(f[E+p+k]<A[z+p]||A[z+p+k]<f[E+p])continue k;var v,m=K[O];if(void 0!==(v=x?o(B,m):o(m,B)))return v}}}}else c(G,l,D--,U-V)}},scanComplete:function(k,h,o,x,I,J,l,A,K,a,N){for(var c=0,W=2*k,f=h,M=h+k,T=x;T<I;++T){var j=T+Y,d=W*T;X[c++]=J[d+f],X[c++]=-j,X[c++]=J[d+M],X[c++]=j}for(T=A;T<K;++T){j=T+1;var b=W*T;X[c++]=a[b+f],X[c++]=-j}var V=c>>>1;q(X,V);var i=0;for(T=0;T<V;++T){var F=0|X[2*T+1];if(F<0){if((j=-F)>=Y)G[i++]=j-Y;else{var R=N[j-=1],s=W*j,Z=a[s+h+1],w=a[s+h+1+k];k:for(var D=0;D<i;++D){var U=G[D],Q=l[U];if(Q===R)break;var B=W*U;if(!(w<J[B+h+1]||J[B+h+1+k]<Z)){for(var E=h+2;E<k;++E)if(a[s+E+k]<J[B+E]||J[B+E+k]<a[s+E])continue k;var n=o(Q,R);if(void 0!==n)return n}}}}else{for(j=F-Y,D=i-1;D>=0;--D)if(G[D]===j){for(E=D+1;E<i;++E)G[E-1]=G[E];break}--i}}}};var x=o(13191),I=o(13199),q=o(13218),Y=1<<28,J=1024,G=x.mallocInt32(J),l=x.mallocInt32(J),A=x.mallocInt32(J),K=x.mallocInt32(J),a=x.mallocInt32(J),N=x.mallocInt32(J),X=x.mallocDouble(8192);function c(k,h,o,x){var I=h[x],q=k[o-1];k[I]=q,h[q]=I}function W(k,h,o,x){k[o]=x,h[x]=o}},13206:k=>{"use strict";function h(k,o,x){var I=0|k[x];if(I<=0)return[];var q,Y=new Array(I);if(x===k.length-1)for(q=0;q<I;++q)Y[q]=o;else for(q=0;q<I;++q)Y[q]=h(k,o,x+1);return Y}k.exports=function(k,o){switch("undefined"===typeof o&&(o=0),typeof k){case"number":if(k>0)return function(k,h){var o,x;for(o=new Array(k),x=0;x<k;++x)o[x]=h;return o}(0|k,o);break;case"object":if("number"===typeof k.length)return h(k,o,0)}return[]}},13167:(k,h,o)=>{k.exports=function(){var k=this;this.components={},this.comps=this.components;var h=this.components,o=1,I={},q=[],Y=[],J={timeout:!1,removals:[],multiComps:[]};function G(k,o){var x=h[o],q=I[o],Y=q.hash[k];Y&&(q.remove(k),x.Kh&&(x.multi?(Y.forEach((h=>{h&&x.Kh(k,h)})),Y.length=0):x.Kh(k,Y)),J.removals.push(q),l())}function l(){J.timeout||(J.timeout=!0,setTimeout(A,1))}function A(){J.timeout=!1,K()}function K(){J.multiComps.length&&function(k){for(var h=0;h<k.length;h++){var{entID:o,data:x}=k[h],I=x.hash[o];if(I){for(var q=0;q<I.length;q++)I[q]||(I.splice(q,1),q--);0===I.length&&(x.remove(o),J.removals.push(x))}}k.length=0}(J.multiComps),J.removals.length&&function(k){for(var h=0;h<k.length;h++){k[h].flush()}k.length=0}(J.removals)}this.cK=I,this._systems=q,this._renderSystems=Y,this.IA=function(h){var x=o++;return Array.isArray(h)&&h.forEach((h=>k.zG(x,h))),x},this.deleteEntity=function(h){return Object.keys(I).forEach((k=>{I[k].hash[h]&&G(h,k)})),k},this.TA=function(k){if(!k)throw new Error("Missing component definition");var o=k.name;if(!o)throw new Error("Component definition must have a name property.");if("string"!==typeof o)throw new Error("Component name must be a string.");if(""===o)throw new Error("Component name must be a non-empty string.");if(I[o])throw new Error(`Component ${o} already exists.`);var J={};return J.name=o,J.multi=!!k.multi,J.order=isNaN(k.order)?99:k.order,J.stateConstructor=k.stateConstructor||null,J.state=k.state||{},J.HJ=k.HJ||null,J.Kh=k.Kh||null,J.system=k.system||null,J.mJ=k.mJ||null,h[o]=J,I[o]=new x,I[o]._pendingMultiCleanup=!1,I[o]._multiCleanupIDs=J.multi?[]:null,J.system&&(q.push(o),q.sort(((k,o)=>h[k].order-h[o].order))),J.mJ&&(Y.push(o),Y.sort(((k,o)=>h[k].order-h[o].order))),o},this.overwriteComponent=function(k,o){var x=h[k];if(!x)throw new Error(`Unknown component: ${k}`);if(!o)throw new Error("Missing component definition");if(x.name!==o.name)throw new Error("Overwriting component must use the same name property.");var J={};J.name=k,J.multi=!!o.multi,J.order=isNaN(o.order)?99:o.order,J.state=o.state||{},J.HJ=o.HJ||null,J.Kh=o.Kh||null,J.system=o.system||null,J.mJ=o.mJ||null,h[k]=J,I[k]._pendingMultiCleanup=!1,I[k]._multiCleanupIDs=J.multi?[]:null;var G=q.indexOf(k);J.system&&G<0&&q.push(k),!J.system&&G>=0&&q.splice(G,1),q.sort(((k,o)=>h[k].order-h[o].order));var l=Y.indexOf(k);J.mJ&&l<0&&Y.push(k),!J.mJ&&l>=0&&Y.splice(l,1),Y.sort(((k,o)=>h[k].order-h[o].order));var A=J.state;return this.yl(k).forEach((k=>{for(var h in A)h in k||(k[h]=A[h]);J.HJ&&J.HJ(k.pJ,k)})),k},this.deleteComponent=function(o){var x=I[o];if(!x)throw new Error(`Unknown component: ${o}`);x.flush(),x.list.forEach((k=>{k&&G(k.pJ||k[0].pJ,o)}));var J=q.indexOf(o),l=Y.indexOf(o);return J>-1&&q.splice(J,1),l>-1&&Y.splice(l,1),I[o].dispose(),delete I[o],delete h[o],k},this.zG=function(k,o,x){var q,Y=h[o],J=I[o];if(!J)throw new Error(`Unknown component: ${o}.`);if(J.hash[k]&&!Y.multi)throw new Error(`Entity ${k} already has component: ${o}.`);if(Y.stateConstructor){if(!(q=new Y.stateConstructor).hasOwnProperty("pJ"))throw new Error(`Component ${Y.name} stateConstructor type does not have property __id`)}else q=Object.assign({},{pJ:k},Y.state,x);if(q.pJ=k,Y.multi){var G=J.hash[k];G||(G=[],J.add(k,G)),G.push(q)}else J.add(k,q);return Y.HJ&&Y.HJ(k,q),this},this.gG=function(k,h){var o=I[h];if(!o)throw new Error(`Unknown component: ${h}.`);return!!o.hash[k]},this.LG=function(h,o){if(!I[o])throw new Error(`Unknown component: ${o}.`);return G(h,o),k},this.getState=function(k,h){var o=I[h];if(!o)throw new Error(`Unknown component: ${h}.`);return o.hash[k]},this.yl=function(k){var h=I[k];if(!h)throw new Error(`Unknown component: ${k}.`);return K(),h.list},this.qN=function(k){if(!I[k])throw new Error(`Unknown component: ${k}.`);var h=I[k].hash;return k=>h[k]},this.GN=function(k){if(!I[k])throw new Error(`Unknown component: ${k}.`);var h=I[k].hash;return k=>!!h[k]},this.TJ=function(o){K();for(var x=0;x<q.length;x++){var Y=q[x],J=h[Y],G=I[Y];J.system(o,G.list),K()}return k},this.render=function(o){K();for(var x=0;x<Y.length;x++){var q=Y[x],J=h[q],G=I[q];J.mJ(o,G.list),K()}return k},this.removeMultiComponent=function(o,x,q){var Y=h[x],G=I[x];if(!G)throw new Error(`Unknown component: ${x}.`);if(!Y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(k,h,o,x){var I=o.hash[k];if(I){var q=I[x];q&&(I[x]=null,h.Kh&&h.Kh(k,q),J.multiComps.push({entID:k,data:o}),l())}}(o,Y,G,q),k}};var x=o(13171)},13171:k=>{function h(k,h){var o=k._map[h];if(delete k.hash[h],delete k._map[h],o===k.list.length-1)k.list.pop();else{var x=k.list.pop();if(k.list[o]=x,null===x||null===x[0]){var I=k.list.length;for(var q in k._map)if(k._map[q]===I)return void(k._map[q]=o)}else{var Y=x.pJ||x[0].pJ;k._map[Y]=o}}}k.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(k,h){if("number"===typeof this._map[k]){var o=this._map[k];this.hash[k]=h,this.list[o]=h}else this._map[k]=this.list.length,this.hash[k]=h,this.list.push(h)}remove(k){var h=this._map[k];this.hash[k]=null,this.list[h]=null,this._pendingRemovals.push(k)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var k=0;k<this._pendingRemovals.length;k++){var o=this._pendingRemovals[k];null===this.hash[o]&&h(this,o)}this._pendingRemovals.length=0}}},13133:k=>{"use strict";var h,o="object"===typeof Reflect?Reflect:null,x=function(k,h,o){return Function.prototype.apply.call(k,h,o)};h=o&&"function"===typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:function(k){return Object.getOwnPropertyNames(k)};var I=Number.isNaN||function(k){return k!==k};function q(){q.init.call(this)}k.exports=q,k.exports.once=function(k,h){return new Promise((function(o,x){function I(o){k.removeListener(h,q),x(o)}function q(){"function"===typeof k.removeListener&&k.removeListener("error",I),o([].slice.call(arguments))}c(k,h,q,{once:!0}),"error"!==h&&function(k,h,o){"function"===typeof k.on&&c(k,"error",h,o)}(k,I,{once:!0})}))},q.EventEmitter=q,q.prototype._events=void 0,q.prototype._eventsCount=0,q.prototype._maxListeners=void 0;var Y=10;function J(k){if("function"!==typeof k)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}function G(k){return void 0===k._maxListeners?q.defaultMaxListeners:k._maxListeners}function l(k,h,o,x){var I,q,Y,l;if(J(o),void 0===(q=k._events)?(q=k._events=Object.create(null),k._eventsCount=0):(void 0!==q.newListener&&(k.emit("newListener",h,o.listener?o.listener:o),q=k._events),Y=q[h]),void 0===Y)Y=q[h]=o,++k._eventsCount;else if("function"===typeof Y?Y=q[h]=x?[o,Y]:[Y,o]:x?Y.unshift(o):Y.push(o),(I=G(k))>0&&Y.length>I&&!Y.warned){Y.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+Y.length+" "+String(h)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.Ih=k,A.type=h,A.count=Y.length,l=A,console&&console.warn&&console.warn(l)}return k}function A(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function K(k,h,o){var x={fired:!1,wrapFn:void 0,target:k,type:h,listener:o},I=A.bind(x);return I.listener=o,x.wrapFn=I,I}function a(k,h,o){var x=k._events;if(void 0===x)return[];var I=x[h];return void 0===I?[]:"function"===typeof I?o?[I.listener||I]:[I]:o?function(k){for(var h=new Array(k.length),o=0;o<h.length;++o)h[o]=k[o].listener||k[o];return h}(I):X(I,I.length)}function N(k){var h=this._events;if(void 0!==h){var o=h[k];if("function"===typeof o)return 1;if(void 0!==o)return o.length}return 0}function X(k,h){for(var o=new Array(h),x=0;x<h;++x)o[x]=k[x];return o}function c(k,h,o,x){if("function"===typeof k.on)x.once?k.once(h,o):k.on(h,o);else{if("function"!==typeof k.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k);k.addEventListener(h,(function I(q){x.once&&k.removeEventListener(h,I),o(q)}))}}Object.defineProperty(q,"defaultMaxListeners",{enumerable:!0,get:function(){return Y},set:function(k){if("number"!==typeof k||k<0||I(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");Y=k}}),q.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},q.prototype.setMaxListeners=function(k){if("number"!==typeof k||k<0||I(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this},q.prototype.getMaxListeners=function(){return G(this)},q.prototype.emit=function(k){for(var h=[],o=1;o<arguments.length;o++)h.push(arguments[o]);var I="error"===k,q=this._events;if(void 0!==q)I=I&&void 0===q.error;else if(!I)return!1;if(I){var Y;if(h.length>0&&(Y=h[0]),Y instanceof Error)throw Y;var J=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw J.context=Y,J}var G=q[k];if(void 0===G)return!1;if("function"===typeof G)x(G,this,h);else{var l=G.length,A=X(G,l);for(o=0;o<l;++o)x(A[o],this,h)}return!0},q.prototype.addListener=function(k,h){return l(this,k,h,!1)},q.prototype.on=q.prototype.addListener,q.prototype.prependListener=function(k,h){return l(this,k,h,!0)},q.prototype.once=function(k,h){return J(h),this.on(k,K(this,k,h)),this},q.prototype.prependOnceListener=function(k,h){return J(h),this.prependListener(k,K(this,k,h)),this},q.prototype.removeListener=function(k,h){var o,x,I,q,Y;if(J(h),void 0===(x=this._events))return this;if(void 0===(o=x[k]))return this;if(o===h||o.listener===h)0===--this._eventsCount?this._events=Object.create(null):(delete x[k],x.removeListener&&this.emit("removeListener",k,o.listener||h));else if("function"!==typeof o){for(I=-1,q=o.length-1;q>=0;q--)if(o[q]===h||o[q].listener===h){Y=o[q].listener,I=q;break}if(I<0)return this;0===I?o.shift():function(k,h){for(;h+1<k.length;h++)k[h]=k[h+1];k.pop()}(o,I),1===o.length&&(x[k]=o[0]),void 0!==x.removeListener&&this.emit("removeListener",k,Y||h)}return this},q.prototype.off=q.prototype.removeListener,q.prototype.qh=function(k){var h,o,x;if(void 0===(o=this._events))return this;if(void 0===o.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==o[k]&&(0===--this._eventsCount?this._events=Object.create(null):delete o[k]),this;if(0===arguments.length){var I,q=Object.keys(o);for(x=0;x<q.length;++x)"removeListener"!==(I=q[x])&&this.qh(I);return this.qh("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(h=o[k]))this.removeListener(k,h);else if(void 0!==h)for(x=h.length-1;x>=0;x--)this.removeListener(k,h[x]);return this},q.prototype.listeners=function(k){return a(this,k,!0)},q.prototype.rawListeners=function(k){return a(this,k,!1)},q.listenerCount=function(k,h){return"function"===typeof k.listenerCount?k.listenerCount(h):N.call(k,h)},q.prototype.listenerCount=N,q.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]}},13427:k=>{"use strict";k.exports=function(k,h,o,x,I,q){var Y=+h[0],J=+h[1],G=+h[2],l=+o[0],A=+o[1],K=+o[2],a=Math.sqrt(l*l+A*A+K*K);if(0===a)throw new Error("Can't raycast along a zero vector");return function(k,h,o,x,I,q,Y,J,G,l){for(var A=0,K=Math.floor,a=0|K(h),N=0|K(o),X=0|K(x),c=I>0?1:-1,W=q>0?1:-1,f=Y>0?1:-1,M=Math.abs(1/I),T=Math.abs(1/q),j=Math.abs(1/Y),d=M<1/0?M*(c>0?a+1-h:h-a):1/0,b=T<1/0?T*(W>0?N+1-o:o-N):1/0,V=j<1/0?j*(f>0?X+1-x:x-X):1/0,i=-1;A<=J;){var F=k(a,N,X);if(F)return G&&(G[0]=h+A*I,G[1]=o+A*q,G[2]=x+A*Y),l&&(l[0]=l[1]=l[2]=0,0===i&&(l[0]=-c),1===i&&(l[1]=-W),2===i&&(l[2]=-f)),F;d<b?d<V?(a+=c,A=d,d+=M,i=0):(X+=f,A=V,V+=j,i=2):b<V?(N+=W,A=b,b+=T,i=1):(X+=f,A=V,V+=j,i=2)}return G&&(G[0]=h+A*I,G[1]=o+A*q,G[2]=x+A*Y),l&&(l[0]=l[1]=l[2]=0),0}(k,Y,J,G,l/=a,A/=a,K/=a,x="undefined"===typeof x?64:+x,I,q)}},13459:(k,h,o)=>{"use strict";o.d(h,{c:()=>q});var x=o(13133);function I(){this.qa=!1,this.stopPropagation=!1,this.Ya=!1,this.disabled=!1}class q{constructor(k,h){this.version="0.7.0";var o=Object.assign({},new I,h||{});this.element=k||document,this.qa=!!o.qa,this.stopPropagation=!!o.stopPropagation,this.Ya=!!o.Ya,this.disabled=!!o.disabled,this.filterEvents=(k,h)=>!0,this.down=new x.EventEmitter,this.up=new x.EventEmitter,this.state={},this.Ul={dx:0,dy:0,Sa:0,Dl:0,Ca:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?J(this):document.addEventListener("DOMContentLoaded",(k=>{J(this)}),{once:!0})}bind(k){for(var h=arguments.length,o=new Array(h>1?h-1:0),x=1;x<h;x++)o[x-1]=arguments[x];o.forEach((h=>{var o=this._keyBindmap[h]||[];o.includes(k)||(o.push(k),this._keyBindmap[h]=o)})),this.state[k]=!!this.state[k],this.pressCount[k]=this.pressCount[k]||0,this.releaseCount[k]=this.releaseCount[k]||0}unbind(k){for(var h in this._keyBindmap){var o=this._keyBindmap[h],x=o.indexOf(k);x>-1&&o.splice(x,1)}}getBindings(){var k={};for(var h in this._keyBindmap){this._keyBindmap[h].forEach((o=>{k[o]=k[o]||[],k[o].push(h)}))}return k}TJ(){Y(this.Ul),Y(this.pressCount),Y(this.releaseCount)}}function Y(k){for(var h in k)k[h]=0}function J(k){window.addEventListener("keydown",X.bind(null,k,!0),!1),window.addEventListener("keyup",X.bind(null,k,!1),!1);var h={passive:!0};k.element.addEventListener("touchstart",K.bind(void 0,k),{passive:!1}),k.element.addEventListener("touchend",N.bind(void 0,k),h),k.element.addEventListener("mousedown",c.bind(null,k,!0),h),window.document.addEventListener("mouseup",c.bind(null,k,!1),h),k.element.addEventListener("touchmove",W.bind(null,k),h),k.element.addEventListener("mousemove",W.bind(null,k),h),window.PointerEvent,k.element.addEventListener("wheel",f.bind(null,k),h),k.element.addEventListener("contextmenu",M.bind(null,k),!1),window.addEventListener("blur",T.bind(null,k),!1)}var G=0,l=0,A=null;function K(k,h){h.preventDefault(),a(h)}function a(k){let h=!1;for(let o=0;o<k.touches.length;++o)if(k.touches[o].identifier===A){h=!0;break}if(!h){const h=k.changedTouches[0];G=h.clientX,l=h.clientY,A=h.identifier}}function N(k,h){for(var o=h.changedTouches,x=0;x<o.length;++x)o[x].identifier===A&&(A=null)}function X(k,h,o){j(o.code,h,k,o)}function c(k,h,o){if("pointerId"in o)if(h){if(null!==k._touches.currID)return;k._touches.currID=o.pointerId}else{if(k._touches.currID!==o.pointerId)return;k._touches.currID=null}return j("Mouse"+("button"in o?o.button+1:1),h,k,o),!1}function W(k,h){var o=h.movementX||h.mozMovementX||0,x=h.movementY||h.mozMovementY||0;if(h.touches&&0===(o|x)){var I=function(k){a(k);for(let h=0;h<k.changedTouches.length;++h)if(k.changedTouches[h].identifier==A){const o=k.changedTouches[h],x=[o.clientX-G,o.clientY-l];return G=o.clientX,l=o.clientY,x}return console.error(`Did not find touch id ${A}`),[0,0]}(h);o=I[0],x=I[1]}k.Ul.dx+=o,k.Ul.dy+=x}function f(k,h){var o=1;switch(h.deltaMode){case 0:o=1;break;case 1:o=12;break;case 2:o=k.element.clientHeight||window.innerHeight}k.Ul.Sa+=(h.deltaX||0)*o,k.Ul.Dl+=(h.deltaY||0)*o,k.Ul.Ca+=(h.deltaZ||0)*o}function M(k,h){if(!k.Ya)return h.preventDefault(),!1}function T(k){for(var h in k._keyStates)k._keyStates[h]&&(/^Mouse\d/.test(h)||j(h,!1,k,{code:h,note:"nmqspmrs82",preventDefault:()=>{},stopPropagation:()=>{}}))}function j(k,h,o,x){var I=o._keyBindmap[k];I&&(d(o._keyStates[k],h)&&(o._keyStates[k]=h,I.forEach((k=>{(!o.filterEvents||o.filterEvents(x,k))&&function(k,h,o,x){var I=h?o.pressCount:o.releaseCount;I[k]=(I[k]||0)+1;var q=o._bindPressCount[k]||0;(q+=h?1:-1)<0&&(q=0);o._bindPressCount[k]=q;var Y=o.state[k];if(d(Y,q)){o.state[k]=q>0;var J=h?o.down:o.up;o.disabled||J.emit(k,x)}}(k,h,o,x)}))),"button"in x||(o.qa&&!x.defaultPrevented&&x.preventDefault(),o.stopPropagation&&x.stopPropagation()))}function d(k,h){return k?!h:h}},12118:k=>{k.exports=function(k,h,o){return k[0]=h[0]+o[0],k[1]=h[1]+o[1],k[2]=h[2]+o[2],k}},12066:(k,h,o)=>{k.exports=function(k,h){var o=x(k[0],k[1],k[2]),Y=x(h[0],h[1],h[2]);I(o,o),I(Y,Y);var J=q(o,Y);return J>1?0:Math.acos(J)};var x=o(12074),I=o(12077),q=o(12086)},12169:k=>{k.exports=function(k,h){return k[0]=Math.ceil(h[0]),k[1]=Math.ceil(h[1]),k[2]=Math.ceil(h[2]),k}},12062:k=>{k.exports=function(k){var h=new Float32Array(3);return h[0]=k[0],h[1]=k[1],h[2]=k[2],h}},12090:k=>{k.exports=function(k,h){return k[0]=h[0],k[1]=h[1],k[2]=h[2],k}},12053:k=>{k.exports=function(){var k=new Float32Array(3);return k[0]=0,k[1]=0,k[2]=0,k}},12248:k=>{k.exports=function(k,h,o){var x=h[0],I=h[1],q=h[2],Y=o[0],J=o[1],G=o[2];return k[0]=I*G-q*J,k[1]=q*Y-x*G,k[2]=x*J-I*Y,k}},12198:(k,h,o)=>{k.exports=o(12192)},12192:k=>{k.exports=function(k,h){var o=h[0]-k[0],x=h[1]-k[1],I=h[2]-k[2];return Math.sqrt(o*o+x*x+I*I)}},12146:(k,h,o)=>{k.exports=o(12139)},12139:k=>{k.exports=function(k,h,o){return k[0]=h[0]/o[0],k[1]=h[1]/o[1],k[2]=h[2]/o[2],k}},12086:k=>{k.exports=function(k,h){return k[0]*h[0]+k[1]*h[1]+k[2]*h[2]}},12048:k=>{k.exports=1e-6},12108:(k,h,o)=>{k.exports=function(k,h){var o=k[0],I=k[1],q=k[2],Y=h[0],J=h[1],G=h[2];return Math.abs(o-Y)<=x*Math.max(1,Math.abs(o),Math.abs(Y))&&Math.abs(I-J)<=x*Math.max(1,Math.abs(I),Math.abs(J))&&Math.abs(q-G)<=x*Math.max(1,Math.abs(q),Math.abs(G))};var x=o(12048)},12111:k=>{k.exports=function(k,h){return k[0]===h[0]&&k[1]===h[1]&&k[2]===h[2]}},12161:k=>{k.exports=function(k,h){return k[0]=Math.floor(h[0]),k[1]=Math.floor(h[1]),k[2]=Math.floor(h[2]),k}},12299:(k,h,o)=>{k.exports=function(k,h,o,I,q,Y){var J,G;h||(h=3);o||(o=0);G=I?Math.min(I*h+o,k.length):k.length;for(J=o;J<G;J+=h)x[0]=k[J],x[1]=k[J+1],x[2]=k[J+2],q(x,x,Y),k[J]=x[0],k[J+1]=x[1],k[J+2]=x[2];return k};var x=o(12053)()},12074:k=>{k.exports=function(k,h,o){var x=new Float32Array(3);return x[0]=k,x[1]=h,x[2]=o,x}},12046:(k,h,o)=>{k.exports={EPSILON:o(12048),create:o(12053),clone:o(12062),angle:o(12066),AJ:o(12074),i:o(12090),set:o(12099),equals:o(12108),exactEquals:o(12111),add:o(12118),ih:o(12121),sub:o(12126),multiply:o(12129),mul:o(12131),divide:o(12139),div:o(12146),min:o(12153),max:o(12157),floor:o(12161),ceil:o(12169),round:o(12178),scale:o(12186),KJ:o(12189),distance:o(12192),k:o(12198),squaredDistance:o(12205),sqrDist:o(12209),length:o(12214),len:o(12217),squaredLength:o(12224),aJ:o(12232),negate:o(12237),inverse:o(12245),normalize:o(12077),dot:o(12086),cross:o(12248),JJ:o(12255),random:o(12258),transformMat4:o(12267),transformMat3:o(12270),transformQuat:o(12279),NJ:o(12282),XJ:o(12285),cJ:o(12294),forEach:o(12299)}},12245:k=>{k.exports=function(k,h){return k[0]=1/h[0],k[1]=1/h[1],k[2]=1/h[2],k}},12217:(k,h,o)=>{k.exports=o(12214)},12214:k=>{k.exports=function(k){var h=k[0],o=k[1],x=k[2];return Math.sqrt(h*h+o*o+x*x)}},12255:k=>{k.exports=function(k,h,o,x){var I=h[0],q=h[1],Y=h[2];return k[0]=I+x*(o[0]-I),k[1]=q+x*(o[1]-q),k[2]=Y+x*(o[2]-Y),k}},12157:k=>{k.exports=function(k,h,o){return k[0]=Math.max(h[0],o[0]),k[1]=Math.max(h[1],o[1]),k[2]=Math.max(h[2],o[2]),k}},12153:k=>{k.exports=function(k,h,o){return k[0]=Math.min(h[0],o[0]),k[1]=Math.min(h[1],o[1]),k[2]=Math.min(h[2],o[2]),k}},12131:(k,h,o)=>{k.exports=o(12129)},12129:k=>{k.exports=function(k,h,o){return k[0]=h[0]*o[0],k[1]=h[1]*o[1],k[2]=h[2]*o[2],k}},12237:k=>{k.exports=function(k,h){return k[0]=-h[0],k[1]=-h[1],k[2]=-h[2],k}},12077:k=>{k.exports=function(k,h){var o=h[0],x=h[1],I=h[2],q=o*o+x*x+I*I;q>0&&(q=1/Math.sqrt(q),k[0]=h[0]*q,k[1]=h[1]*q,k[2]=h[2]*q);return k}},12258:k=>{k.exports=function(k,h){h=h||1;var o=2*Math.random()*Math.PI,x=2*Math.random()-1,I=Math.sqrt(1-x*x)*h;return k[0]=Math.cos(o)*I,k[1]=Math.sin(o)*I,k[2]=x*h,k}},12282:k=>{k.exports=function(k,h,o,x){var I=o[1],q=o[2],Y=h[1]-I,J=h[2]-q,G=Math.sin(x),l=Math.cos(x);return k[0]=h[0],k[1]=I+Y*l-J*G,k[2]=q+Y*G+J*l,k}},12285:k=>{k.exports=function(k,h,o,x){var I=o[0],q=o[2],Y=h[0]-I,J=h[2]-q,G=Math.sin(x),l=Math.cos(x);return k[0]=I+J*G+Y*l,k[1]=h[1],k[2]=q+J*l-Y*G,k}},12294:k=>{k.exports=function(k,h,o,x){var I=o[0],q=o[1],Y=h[0]-I,J=h[1]-q,G=Math.sin(x),l=Math.cos(x);return k[0]=I+Y*l-J*G,k[1]=q+Y*G+J*l,k[2]=h[2],k}},12178:k=>{k.exports=function(k,h){return k[0]=Math.round(h[0]),k[1]=Math.round(h[1]),k[2]=Math.round(h[2]),k}},12186:k=>{k.exports=function(k,h,o){return k[0]=h[0]*o,k[1]=h[1]*o,k[2]=h[2]*o,k}},12189:k=>{k.exports=function(k,h,o,x){return k[0]=h[0]+o[0]*x,k[1]=h[1]+o[1]*x,k[2]=h[2]+o[2]*x,k}},12099:k=>{k.exports=function(k,h,o,x){return k[0]=h,k[1]=o,k[2]=x,k}},12209:(k,h,o)=>{k.exports=o(12205)},12232:(k,h,o)=>{k.exports=o(12224)},12205:k=>{k.exports=function(k,h){var o=h[0]-k[0],x=h[1]-k[1],I=h[2]-k[2];return o*o+x*x+I*I}},12224:k=>{k.exports=function(k){var h=k[0],o=k[1],x=k[2];return h*h+o*o+x*x}},12126:(k,h,o)=>{k.exports=o(12121)},12121:k=>{k.exports=function(k,h,o){return k[0]=h[0]-o[0],k[1]=h[1]-o[1],k[2]=h[2]-o[2],k}},12270:k=>{k.exports=function(k,h,o){var x=h[0],I=h[1],q=h[2];return k[0]=x*o[0]+I*o[3]+q*o[6],k[1]=x*o[1]+I*o[4]+q*o[7],k[2]=x*o[2]+I*o[5]+q*o[8],k}},12267:k=>{k.exports=function(k,h,o){var x=h[0],I=h[1],q=h[2],Y=o[3]*x+o[7]*I+o[11]*q+o[15];return Y=Y||1,k[0]=(o[0]*x+o[4]*I+o[8]*q+o[12])/Y,k[1]=(o[1]*x+o[5]*I+o[9]*q+o[13])/Y,k[2]=(o[2]*x+o[6]*I+o[10]*q+o[14])/Y,k}},12279:k=>{k.exports=function(k,h,o){var x=h[0],I=h[1],q=h[2],Y=o[0],J=o[1],G=o[2],l=o[3],A=l*x+J*q-G*I,K=l*I+G*x-Y*q,a=l*q+Y*I-J*x,N=-Y*x-J*I-G*q;return k[0]=A*l+N*-Y+K*-G-a*-J,k[1]=K*l+N*-J+a*-Y-A*-G,k[2]=a*l+N*-G+A*-J-K*-Y,k}},13152:k=>{"use strict";k.exports=function(k){for(var h=new Array(k),o=0;o<k;++o)h[o]=o;return h}},13209:k=>{k.exports=function(k){return null!=k&&null!=k.constructor&&"function"===typeof k.constructor.isBuffer&&k.constructor.isBuffer(k)}},13431:(k,h,o)=>{"use strict";o.d(h,{b:()=>x});class x{constructor(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.zA=!1,this.pA=!1,this.yA=30,this.OA=0,this.CA=!1,this.fullscreen=!1,this.mA=function(k){},this.LA=function(){},this.tA=function(){},this.Xh=function(){},this.PA=function(k){},this.onFullscreenChanged=function(k){},l((()=>{!function(k,h){k._nowObject=performance||Date,k._lastTick=0,k._renderAccum=0,k._rt=0,k._frameCB=J.bind(null,k),requestAnimationFrame(k._frameCB),h>0&&(k._intervalCB=Y.bind(null,k),k._interval=setInterval(k._intervalCB,Math.max(h,1e3/k.yA/2)))}(this,h),function(k,h){if(!h)return;var o=!1,x=!1;document.addEventListener("pointerlockchange",(x=>{o=document.pointerLockElement===h,k.PA(o)})),document.addEventListener("fullscreenchange",(o=>{x=document.fullscreenElement===h,k.onFullscreenChanged(x)})),Object.defineProperty(k,"CA",{get:()=>o,set:k=>{k&&!o?G(h):o&&!k&&function(k){k.exitPointerLock&&k.exitPointerLock()}(document)}}),Object.defineProperty(k,"fullscreen",{get:()=>x,set:k=>{k&&!x?h.requestFullscreen():x&&!k&&document.exitFullscreen()}}),h.addEventListener("click",(I=>{k.zA&&!o&&G(h),k.pA&&!x&&h.requestFullscreen()}));var I=()=>k.Xh();if(window.ResizeObserver){new ResizeObserver(I).observe(h)}else window.addEventListener("resize",I)}(this,k),this.tA()}))}}var I=3,q=20;function Y(k){for(var h=1e3/k.yA,o=k._nowObject.now()+q,x=0;k._nowObject.now()>=k._lastTick+h&&k._nowObject.now()<o&&++x<=I;)k.mA(h),k._lastTick+=h;var Y=5*(h+5),J=k._nowObject.now();if(J-k._lastTick>Y)for(;J>=k._lastTick+h;)k._lastTick+=h}function J(k){requestAnimationFrame(k._frameCB),Y(k);var h=k._nowObject.now(),o=h-k._rt;if(k._rt=h,k.OA>0){k._renderAccum+=o;var x=1e3/k.OA;if(k._renderAccum<x)return;k._renderAccum=Math.min(k._renderAccum-x,x)}var I=1e3/k.yA,q=(h-k._lastTick)/I;k.LA(o,q,I)}function G(k){k.requestPointerLock&&k.requestPointerLock()}var l=k=>{if("loading"===document.readyState){var h=()=>{document.removeEventListener("readystatechange",h),k()};document.addEventListener("readystatechange",h)}else setTimeout(k,1)}},13148:(k,h,o)=>{var x=o(13152),I=o(13160),q="undefined"!==typeof Float64Array;function Y(k,h){return k[0]-h[0]}function J(){var k,h=this.stride,o=new Array(h.length);for(k=0;k<o.length;++k)o[k]=[Math.abs(h[k]),k];o.sort(Y);var x=new Array(o.length);for(k=0;k<x.length;++k)x[k]=o[k][1];return x}function G(k,h){var o=["View",h,"d",k].join("");h<0&&(o="View_Nil"+k);var I="generic"===k;if(-1===h){var q="function "+o+"(a){this.data=a;};var proto="+o+".prototype;proto.dtype='"+k+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+o+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+o+"(a){return new "+o+"(a);}";return new Function(q)()}if(0===h){q="function "+o+"(a,d) {this.data = a;this.offset = d};var proto="+o+".prototype;proto.dtype='"+k+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+o+"_copy() {return new "+o+"(this.data,this.offset)};proto.pick=function "+o+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+o+"_get(){return "+(I?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+o+"_set(v){return "+(I?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+o+"(a,b,c,d){return new "+o+"(a,d)}";return new Function("TrivialArray",q)(l[k][0])}q=["'use strict'"];var Y=x(h),G=Y.map((function(k){return"i"+k})),A="this.offset+"+Y.map((function(k){return"this.stride["+k+"]*i"+k})).join("+"),K=Y.map((function(k){return"b"+k})).join(","),a=Y.map((function(k){return"c"+k})).join(",");q.push("function "+o+"(a,"+K+","+a+",d){this.data=a","this.shape=["+K+"]","this.stride=["+a+"]","this.offset=d|0}","var proto="+o+".prototype","proto.dtype='"+k+"'","proto.dimension="+h),q.push("Object.defineProperty(proto,'size',{get:function "+o+"_size(){return "+Y.map((function(k){return"this.shape["+k+"]"})).join("*"),"}})"),1===h?q.push("proto.order=[0]"):(q.push("Object.defineProperty(proto,'order',{get:"),h<4?(q.push("function "+o+"_order(){"),2===h?q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===h&&q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):q.push("ORDER})")),q.push("proto.set=function "+o+"_set("+G.join(",")+",v){"),I?q.push("return this.data.set("+A+",v)}"):q.push("return this.data["+A+"]=v}"),q.push("proto.get=function "+o+"_get("+G.join(",")+"){"),I?q.push("return this.data.get("+A+")}"):q.push("return this.data["+A+"]}"),q.push("proto.index=function "+o+"_index(",G.join(),"){return "+A+"}"),q.push("proto.hi=function "+o+"_hi("+G.join(",")+"){return new "+o+"(this.data,"+Y.map((function(k){return["(typeof i",k,"!=='number'||i",k,"<0)?this.shape[",k,"]:i",k,"|0"].join("")})).join(",")+","+Y.map((function(k){return"this.stride["+k+"]"})).join(",")+",this.offset)}");var N=Y.map((function(k){return"a"+k+"=this.shape["+k+"]"})),X=Y.map((function(k){return"c"+k+"=this.stride["+k+"]"}));q.push("proto.lo=function "+o+"_lo("+G.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+X.join(","));for(var c=0;c<h;++c)q.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");q.push("return new "+o+"(this.data,"+Y.map((function(k){return"a"+k})).join(",")+","+Y.map((function(k){return"c"+k})).join(",")+",b)}"),q.push("proto.step=function "+o+"_step("+G.join(",")+"){var "+Y.map((function(k){return"a"+k+"=this.shape["+k+"]"})).join(",")+","+Y.map((function(k){return"b"+k+"=this.stride["+k+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(c=0;c<h;++c)q.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");q.push("return new "+o+"(this.data,"+Y.map((function(k){return"a"+k})).join(",")+","+Y.map((function(k){return"b"+k})).join(",")+",c)}");var W=new Array(h),f=new Array(h);for(c=0;c<h;++c)W[c]="a[i"+c+"]",f[c]="b[i"+c+"]";q.push("proto.transpose=function "+o+"_transpose("+G+"){"+G.map((function(k,h){return k+"=("+k+"===undefined?"+h+":"+k+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+o+"(this.data,"+W.join(",")+","+f.join(",")+",this.offset)}"),q.push("proto.pick=function "+o+"_pick("+G+"){var a=[],b=[],c=this.offset");for(c=0;c<h;++c)q.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),q.push("return function construct_"+o+"(data,shape,stride,offset){return new "+o+"(data,"+Y.map((function(k){return"shape["+k+"]"})).join(",")+","+Y.map((function(k){return"stride["+k+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",q.join("\n"))(l[k],J)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};k.exports=function(k,h,o,x){if(void 0===k)return(0,l.array[0])([]);"number"===typeof k&&(k=[k]),void 0===h&&(h=[k.length]);var Y=h.length;if(void 0===o){o=new Array(Y);for(var J=Y-1,A=1;J>=0;--J)o[J]=A,A*=h[J]}if(void 0===x){x=0;for(J=0;J<Y;++J)o[J]<0&&(x-=(h[J]-1)*o[J])}for(var K=function(k){if(I(k))return"buffer";if(q)switch(Object.prototype.toString.call(k)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(k)?"array":"generic"}(k),a=l[K];a.length<=Y+1;)a.push(G(K,a.length-1));return(0,a[Y+1])(k,h,o,x)}},13160:k=>{function h(k){return!!k.constructor&&"function"===typeof k.constructor.isBuffer&&k.constructor.isBuffer(k)}k.exports=function(k){return null!=k&&(h(k)||function(k){return"function"===typeof k.readFloatLE&&"function"===typeof k.slice&&h(k.slice(0,0))}(k)||!!k._isBuffer)}},13299:k=>{"use strict";var h=[],o=[],x=[],I=[],q=[],Y=[],J=[],G=[],l=[],A=[],K=[],a=[];k.exports=function(k,N,X,c,W,f){for(var M=J,T=l,j=A,d=a,b=0;b<3;b++)M[b]=+X[b],j[b]=+N.max[b],T[b]=+N.base[b];f||(f=1e-10);var V=function(k,J,l,A,a,N){var X=h,c=o,W=x,f=I,M=q,T=Y,j=G,d=Math.floor,b=0,V=0,i=0,F=0,R=0;if(s(),0===i)return 0;for(F=D();V<=i;){if(Z(F)&&w())return b;F=D()}for(b+=i,R=0;R<3;R++)A[R]+=l[R],a[R]+=l[R];return b;function s(){if(V=0,0!==(i=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])))for(var k=0;k<3;k++){var h=l[k]>=0;f[k]=h?1:-1;var o=h?a[k]:A[k];X[k]=h?A[k]:a[k],c[k]=U(o,f[k]),W[k]=Q(X[k],f[k]),j[k]=l[k]/i,M[k]=Math.abs(1/j[k]);var x=h?c[k]+1-o:o-c[k];T[k]=M[k]<1/0?M[k]*x:1/0}}function Z(h){for(var o=f[0],x=0===h?c[0]:W[0],I=c[0]+o,q=f[1],Y=1===h?c[1]:W[1],J=c[1]+q,G=f[2],l=2===h?c[2]:W[2],A=c[2]+G,K=x;K!=I;K+=o)for(var a=Y;a!=J;a+=q)for(var N=l;N!=A;N+=G)if(k(K,a,N))return!0;return!1}function w(){b+=V;var k=f[F],h=V/i,o=K;for(R=0;R<3;R++){var x=l[R]*h;A[R]+=x,a[R]+=x,o[R]=l[R]-x}if(k>0?a[F]=Math.round(a[F]):A[F]=Math.round(A[F]),J(b,F,k,o))return!0;for(R=0;R<3;R++)l[R]=o[R];return s(),0===i}function D(){var k=T[0]<T[1]?T[0]<T[2]?0:2:T[1]<T[2]?1:2,h=T[k]-V;for(V=T[k],c[k]+=f[k],T[k]+=M[k],R=0;R<3;R++)X[R]+=h*j[R],W[R]=Q(X[R],f[R]);return k}function U(k,h){return d(k-h*N)}function Q(k,h){return d(k+h*N)}}(k,c,M,T,j,f);if(!W){for(b=0;b<3;b++)d[b]=X[b]>0?j[b]-N.max[b]:T[b]-N.base[b];N.translate(d)}return V}},13462:(k,h,o)=>{"use strict";o.d(h,{b:()=>K});var x=o(13292),I=o(12046);class q{constructor(k,h,o,q,Y,J,G){this.Hl=new x(k.base,k.hA),this.EI=h,this.friction=o,this.restitution=q,this.kJ=Y,this.WN=J,this.hJ=!!G,this.kA=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.xX=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.al=I.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=I.create(),this._impulses=I.create(),this._sleepFrameCount=10}loadFromCopy(k){I.i(this.Hl.base,k.Hl.base),I.i(this.Hl.hA,k.Hl.hA),I.i(this.Hl.max,k.Hl.max),this.Hl.mag=k.Hl.mag,this.EI=k.EI,this.friction=k.friction,this.restitution=k.restitution,this.kJ=k.kJ,this.WN=k.WN,this.hJ=k.hJ,this.kA=k.kA,this.fluidDrag=k.fluidDrag,this.xX=k.xX,this.preventFallOffEdge=k.preventFallOffEdge,this.rolledBackLastTick=k.rolledBackLastTick,I.i(this.al,k.al),I.i(this.resting,k.resting),this.inFluid=k.inFluid,this._ratioInFluid=k._ratioInFluid,I.i(this._forces,k._forces),I.i(this._impulses,k._impulses),this._sleepFrameCount=k._sleepFrameCount}setPosition(k){Y(k),I.ih(k,k,this.Hl.base),this.Hl.translate(k),this.cl()}Wh(){return I.clone(this.Hl.base)}applyForce(k){Y(k),I.add(this._forces,this._forces,k),this.cl()}applyImpulse(k){Y(k),I.add(this._impulses,this._impulses,k),this.cl()}cl(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Y=k=>{};var J=o(13292),G=o(12046),l=o(13299);function A(){this.kA=.1,this.fluidDrag=.4,this.YJ=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function K(k,h,o){k=Object.assign(new A,k),this.gravity=k.gravity||[0,-10,0],this.kA=k.kA||.1,this.YJ=k.YJ||2,this.fluidDrag=k.fluidDrag||.4,this.minBounceImpulse=k.minBounceImpulse,this.bodies=[],this.ya=k.ya,this.testSolid=h,this.testFluid=o}K.prototype.VN=function(k,h,o,x,I,Y){k=k||new J([0,0,0],[1,1,1]),"undefined"==typeof h&&(h=1),"undefined"==typeof o&&(o=1),"undefined"==typeof x&&(x=0),"undefined"==typeof I&&(I=1);var G=new q(k,h,o,x,I,Y);return this.bodies.push(G),G},K.prototype.iN=function(k){var h=this.bodies.indexOf(k);h<0||(this.bodies.splice(h,1),k.Hl=k.WN=null)};var a=G.create(),N=G.create(),X=G.create(),c=G.create(),W=G.create(),f=G.create(),M=G.create(),T=new J([0,0,0],[1,1,1]),j=new q(T,1,1,0,1,(()=>{}),!1);function d(k,h,o){return h=o,h*=1-(1-k.ratioInFluid)**2}K.prototype.TJ=function(k){k/=1e3;var h=y(0,G.squaredLength(this.gravity));this.bodies.forEach((o=>function(k,h,o,x){G.i(W,h.resting),k.ya&&j.loadFromCopy(h);if(h.EI<=0)return G.set(h.al,0,0,0),G.set(h._forces,0,0,0),void G.set(h._impulses,0,0,0);var I=x||0===h.kJ;if(function(k,h,o,x){if(h._sleepFrameCount>0)return!1;if(x)return!0;var I=!1,q=.5*o*o*h.kJ;return G.scale(H,k.gravity,q),l(k.testSolid,h.Hl,H,(function(){return I=!0,!0}),!0),I}(k,h,o,I))return;h._sleepFrameCount--,function(k,h){var o=h.Hl,x=Math.floor(o.base[0]),I=Math.floor(o.base[2]),q=Math.floor(o.base[1]),Y=Math.floor(o.max[1]);if(!k.testFluid(x,q,I))return h.inFluid=!1,void(h.ratioInFluid=0);var J=1,l=q+1;for(;l<=Y&&k.testFluid(x,l,I);)J++,l++;var A=(q+J-o.base[1])/o.hA[1];A>1&&(A=1);var K=o.hA[0]*o.hA[1]*o.hA[2]*A,a=V;G.scale(a,k.gravity,-k.YJ*K*h.kJ),h.applyForce(a),h.inFluid=!0,h.ratioInFluid=A}(k,h),z(h._forces),z(h._impulses),z(h.al),z(h.resting),G.scale(a,h._forces,1/h.EI),G.KJ(a,a,k.gravity,h.kJ),G.scale(N,h._impulses,1/h.EI),G.KJ(N,N,a,o),G.add(h.al,h.al,N),h.friction&&(i(k,0,h,N,o),i(k,1,h,N,o),i(k,2,h,N,o));var q=h.fluidDrag>=0?h.fluidDrag:k.fluidDrag,Y=h.kA>=0?h.kA:k.kA,J=Y,A=Y;h.inFluid&&(J=d(h,J,h.fluidDragHoriz>=0?h.fluidDragHoriz:q),A=d(h,A,h.fluidDragVert>=0?h.fluidDragVert:q));J=Math.max(1-J*o/h.EI,0),A=Math.max(1-A*o/h.EI,0),G.set(b,J,A,J),G.multiply(h.al,h.al,b),G.scale(X,h.al,o),G.set(h._forces,0,0,0),G.set(h._impulses,0,0,0),h.hJ&&O(s,h.Hl);G.i(f,X),G.set(M,0,0,0),h.preventFallOffEdge&&function(k,h,o,x){if(!h.resting[1]||o[1]>0)return;var I=B;O(I,h.Hl);for(var q=0;q<3;q+=2){G.set(Q,0,0,0),Q[q]=o[q];var Y=!0;(Y=(Y=(Y=(Y=Y&&!n(k,I.base[0]+Q[0]+1e-5,I.base[1],I.base[2]+Q[2]+1e-5))&&!n(k,I.max[0]+Q[0]-1e-5,I.base[1],I.base[2]+Q[2]+1e-5))&&!n(k,I.base[0]+Q[0]+1e-5,I.base[1],I.max[2]+Q[2]-1e-5))&&!n(k,I.max[0]+Q[0]-1e-5,I.base[1],I.max[2]+Q[2]-1e-5))?(x[q]=o[q]>0?1:-1,o[q]=0):0===q&&(G.set(E,o[0],0,0),R(k,I,E,x,h.slideOnCollision))}}(k,h,X,M);R(k,h.Hl,X,h.resting,h.slideOnCollision),h.hJ&&function(k,h,o,x){if(h.resting[1]>=0&&!h.inFluid)return;var I=0!==h.resting[0],q=0!==h.resting[2];if(!I&&!q)return;var Y=Math.abs(x[0]/x[2]),J=4;if(!I&&Y>J)return;if(!q&&Y<1/J)return;G.add(w,o.base,x);var A=k.testSolid;l(A,o,x,(function(k,h,o,x){if(1!==h)return!0;x[h]=0}));var K=o.base[1],a=h.inFluid?1.951:1.001,N=Math.floor(K+a)-K;G.set(D,0,N,0);var X=!1;if(l(A,o,D,(function(k,h,o,x){return X=!0,!0})),X)return;G.ih(U,w,o.base),U[1]=0,R(k,o,U,Z,!0);var c=y(o.base[0],w[0]),W=y(o.base[2],w[2]);if(I&&!c&&(!W||!q))return;if(q&&(!c||!I)&&!W)return;var f=!0;if(f=f&&!n(k,o.base[0]+1e-5,o.base[1],o.base[2]+1e-5),f=f&&!n(k,o.max[0]-1e-5,o.base[1],o.base[2]+1e-5),f=f&&!n(k,o.base[0]+1e-5,o.base[1],o.max[2]-1e-5),f=f&&!n(k,o.max[0]-1e-5,o.base[1],o.max[2]-1e-5),f)return;O(h.Hl,o),h.resting[0]=Z[0],h.resting[2]=Z[2],h.xX&&h.xX()}(k,h,s,f);for(var K=0;K<3;++K)h.resting[K]=h.resting[K]||M[K],c[K]=0,h.resting[K]&&(W[K]||(c[K]=-h.al[K]),h.al[K]=0);var T=G.length(c);T>.001&&(G.scale(c,c,h.EI),h.WN&&h.WN(c),h.restitution>0&&T>k.minBounceImpulse&&(G.scale(c,c,h.restitution),h.applyImpulse(c)));var F=G.squaredLength(h.al);F>1e-5&&h.cl();k.ya&&k.ya(h)?(h.loadFromCopy(j),h.rolledBackLastTick=!0):h.rolledBackLastTick=!1}(this,o,k,h)))};var b=G.create([0,0,0]);var V=G.create();function i(k,h,o,x,I){var q=o.resting[h],Y=x[h];if(!o.alwaysApplyHorizFriction||1!==h){if(0===q)return;if(q*Y<=0)return}G.i(F,o.al),F[h]=0;var J=G.length(F);if(!y(J,0)){var l=Math.abs(o.friction*k.gravity[h]*I),A=J>l?(J-l)/J:0;o.al[(h+1)%3]*=A,o.al[(h+2)%3]*=A}}var F=G.create();function R(k,h,o,x,I){return G.set(x,0,0,0),l(k.testSolid,h,o,(function(k,h,o,q){x[h]=o,q[h]=0,I||(q[0]=0,q[1]=0,q[2]=0)}))}var s=new J([],[]),Z=G.create(),w=G.create(),D=G.create(),U=G.create();var Q=G.create(),B=new J([],[]),E=G.create();function n(k,h,o,x){return k.testSolid(Math.floor(h),Math.floor(o-1),Math.floor(x))}var H=G.create();function y(k,h){return Math.abs(k-h)<1e-5}function O(k,h){for(var o=0;o<3;o++)k.base[o]=h.base[o],k.max[o]=h.max[o],k.hA[o]=h.hA[o]}var z=function(k){}},11928:function(k,h){!function(k){"use strict";var h=function(k,o){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,h){k.__proto__=h}||function(k,h){for(var o in h)Object.prototype.hasOwnProperty.call(h,o)&&(k[o]=h[o])},h(k,o)};function o(k,o){if("function"!==typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function x(){this.constructor=k}h(k,o),k.prototype=null===o?Object.create(o):(x.prototype=o.prototype,new x)}function x(k,h,o,x){var I,q=arguments.length,Y=q<3?h:null===x?x=Object.getOwnPropertyDescriptor(h,o):x;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Y=Reflect.decorate(k,h,o,x);else for(var J=k.length-1;J>=0;J--)(I=k[J])&&(Y=(q<3?I(Y):q>3?I(h,o,Y):I(h,o))||Y);return q>3&&Y&&Object.defineProperty(h,o,Y),Y}function I(k,h,o){if(o||2===arguments.length)for(var x,I=0,q=h.length;I<q;I++)!x&&I in h||(x||(x=Array.prototype.slice.call(h,0,I)),x[I]=h[I]);return k.concat(x||Array.prototype.slice.call(h))}var q,Y=255,J=213;k.OPERATION=void 0,(q=k.OPERATION||(k.OPERATION={}))[q.ADD=128]="ADD",q[q.REPLACE=0]="REPLACE",q[q.DELETE=64]="DELETE",q[q.DELETE_AND_ADD=192]="DELETE_AND_ADD",q[q.TOUCH=1]="TOUCH",q[q.CLEAR=10]="CLEAR";var G=function(){function h(k,h,o){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=k,this.setParent(h,o)}return h.prototype.setParent=function(k,h,o){var x=this;if(this.indexes||(this.indexes=this.ref instanceof Uk?this.ref._definition.indexes:{}),this.parent=k,this.parentIndex=o,h)if(this.root=h,this.ref instanceof Uk){var I=this.ref._definition;for(var q in I.schema){var Y=this.ref[q];if(Y&&Y.$changes){var J=I.indexes[q];Y.$changes.setParent(this.ref,h,J)}}}else"object"===typeof this.ref&&this.ref.forEach((function(k,h){if(k instanceof Uk){var o=k.$changes,I=x.ref.$changes.indexes[h];o.setParent(x.ref,x.root,I)}}))},h.prototype.operation=function(k){this.changes.set(--this.currentCustomOperation,k)},h.prototype.change=function(h,o){void 0===o&&(o=k.OPERATION.ADD);var x="number"===typeof h?h:this.indexes[h];this.assertValidIndex(x,h);var I=this.changes.get(x);I&&I.op!==k.OPERATION.DELETE&&I.op!==k.OPERATION.TOUCH||this.changes.set(x,{op:I&&I.op===k.OPERATION.DELETE?k.OPERATION.DELETE_AND_ADD:o,index:x}),this.allChanges.add(x),this.changed=!0,this.touchParents()},h.prototype.touch=function(h){var o="number"===typeof h?h:this.indexes[h];this.assertValidIndex(o,h),this.changes.has(o)||this.changes.set(o,{op:k.OPERATION.TOUCH,index:o}),this.allChanges.add(o),this.touchParents()},h.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},h.prototype.getType=function(k){if(this.ref._definition)return(h=this.ref._definition).schema[h.fieldsByIndex[k]];var h,o=(h=this.parent._definition).schema[h.fieldsByIndex[this.parentIndex]];return Object.values(o)[0]},h.prototype.getChildrenFilter=function(){var k=this.parent._definition.childFilters;return k&&k[this.parentIndex]},h.prototype.getValue=function(k){return this.ref.getByIndex(k)},h.prototype.delete=function(h){var o="number"===typeof h?h:this.indexes[h];if(void 0!==o){var x=this.getValue(o);this.changes.set(o,{op:k.OPERATION.DELETE,index:o}),this.allChanges.delete(o),delete this.caches[o],x&&x.$changes&&(x.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(h," (").concat(o,")"))},h.prototype.discard=function(h,o){var x=this;void 0===h&&(h=!1),void 0===o&&(o=!1),this.ref instanceof Uk||this.changes.forEach((function(h){if(h.op===k.OPERATION.DELETE){var o=x.ref.getIndex(h.index);delete x.indexes[o]}})),this.changes.clear(),this.changed=h,o&&this.allChanges.clear(),this.currentCustomOperation=0},h.prototype.discardAll=function(){var k=this;this.changes.forEach((function(h){var o=k.getValue(h.index);o&&o.$changes&&o.$changes.discardAll()})),this.discard()},h.prototype.cache=function(k,h){this.caches[k]=h},h.prototype.clone=function(){return new h(this.ref,this.parent,this.root)},h.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},h.prototype.assertValidIndex=function(k,h){if(void 0===k)throw new Error('ChangeTree: missing index for field "'.concat(h,'"'))},h}();function l(k,h,o,x){return k[h]||(k[h]=[]),k[h].push(o),null===x||void 0===x||x.forEach((function(k,h){return o(k,h)})),function(){return K(k[h],k[h].indexOf(o))}}function A(h){var o=this,x="string"!==typeof this.$changes.getType();this.$items.forEach((function(I,q){h.push({refId:o.$changes.refId,op:k.OPERATION.DELETE,field:q,value:void 0,previousValue:I}),x&&o.$changes.root.removeRef(I.$changes.refId)}))}function K(k,h){if(-1===h||h>=k.length)return!1;for(var o=k.length-1,x=h;x<o;x++)k[x]=k[x+1];return k.length=o,!0}var a=function(k,h){var o=k.toString(),x=h.toString();return o<x?-1:o>x?1:0};function N(k){return k.$proxy=!0,k=new Proxy(k,{get:function(k,h){return"symbol"===typeof h||isNaN(h)?k[h]:k.at(h)},set:function(k,h,o){if("symbol"===typeof h||isNaN(h))k[h]=o;else{var x=Array.from(k.$items.keys()),I=parseInt(x[h]||h);void 0===o||null===o?k.deleteAt(I):k.setAt(I,o)}return!0},deleteProperty:function(k,h){return"number"===typeof h?k.deleteAt(h):delete k[h],!0}})}var X=function(){function h(){for(var k=[],h=0;h<arguments.length;h++)k[h]=arguments[h];this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,k)}return h.prototype.HJ=function(h,o){return void 0===o&&(o=!0),l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.ADD,h,o?this.$items:void 0)},h.prototype.Kh=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,h)},h.is=function(k){return Array.isArray(k)||void 0!==k.array},Object.defineProperty(h.prototype,"length",{get:function(){return this.$items.size},set:function(k){0===k?this.clear():this.splice(k,this.length-k)},enumerable:!1,configurable:!0}),h.prototype.push=function(){for(var k,h=this,o=[],x=0;x<arguments.length;x++)o[x]=arguments[x];return o.forEach((function(o){k=h.$refId++,h.setAt(k,o)})),k},h.prototype.pop=function(){var k=Array.from(this.$indexes.values()).pop();if(void 0!==k){this.$changes.delete(k),this.$indexes.delete(k);var h=this.$items.get(k);return this.$items.delete(k),h}},h.prototype.at=function(k){var h=Array.from(this.$items.keys())[k];return this.$items.get(h)},h.prototype.setAt=function(h,o){var x,I;if(void 0!==o&&null!==o){if(this.$items.get(h)!==o){void 0!==o.$changes&&o.$changes.setParent(this,this.$changes.root,h);var q=null!==(I=null===(x=this.$changes.indexes[h])||void 0===x?void 0:x.op)&&void 0!==I?I:k.OPERATION.ADD;this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,o),this.$changes.change(h,q)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},h.prototype.deleteAt=function(k){var h=Array.from(this.$items.keys())[k];return void 0!==h&&this.$deleteAt(h)},h.prototype.$deleteAt=function(k){return this.$changes.delete(k),this.$indexes.delete(k),this.$items.delete(k)},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&A.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:k.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.concat=function(){for(var k,o=[],x=0;x<arguments.length;x++)o[x]=arguments[x];return new(h.bind.apply(h,I([void 0],(k=Array.from(this.$items.values())).concat.apply(k,o),!1)))},h.prototype.join=function(k){return Array.from(this.$items.values()).join(k)},h.prototype.reverse=function(){var k=this,h=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(o,x){k.setAt(h[x],o)})),this},h.prototype.shift=function(){var k=Array.from(this.$items.keys()).shift();if(void 0!==k){var h=this.$items.get(k);return this.$deleteAt(k),h}},h.prototype.slice=function(k,o){var x=new h;return x.push.apply(x,Array.from(this.$items.values()).slice(k,o)),x},h.prototype.sort=function(k){var h=this;void 0===k&&(k=a);var o=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(k).forEach((function(k,x){h.setAt(o[x],k)})),this},h.prototype.splice=function(k,h){void 0===h&&(h=this.length-k);for(var o=Array.from(this.$items.keys()),x=[],I=k;I<k+h;I++)x.push(this.$items.get(o[I])),this.$deleteAt(o[I]);return x},h.prototype.unshift=function(){for(var k=this,h=[],o=0;o<arguments.length;o++)h[o]=arguments[o];var x=this.length,I=h.length,q=Array.from(this.$items.values());return h.forEach((function(h,o){k.setAt(o,h)})),q.forEach((function(h,o){k.setAt(I+o,h)})),x+I},h.prototype.indexOf=function(k,h){return Array.from(this.$items.values()).indexOf(k,h)},h.prototype.lastIndexOf=function(k,h){return void 0===h&&(h=this.length-1),Array.from(this.$items.values()).lastIndexOf(k,h)},h.prototype.every=function(k,h){return Array.from(this.$items.values()).every(k,h)},h.prototype.some=function(k,h){return Array.from(this.$items.values()).some(k,h)},h.prototype.forEach=function(k,h){Array.from(this.$items.values()).forEach(k,h)},h.prototype.map=function(k,h){return Array.from(this.$items.values()).map(k,h)},h.prototype.filter=function(k,h){return Array.from(this.$items.values()).filter(k,h)},h.prototype.reduce=function(k,h){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},h.prototype.reduceRight=function(k,h){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},h.prototype.find=function(k,h){return Array.from(this.$items.values()).find(k,h)},h.prototype.findIndex=function(k,h){return Array.from(this.$items.values()).findIndex(k,h)},h.prototype.fill=function(k,h,o){throw new Error("ArraySchema#fill() not implemented")},h.prototype.copyWithin=function(k,h,o){throw new Error("ArraySchema#copyWithin() not implemented")},h.prototype.toString=function(){return this.$items.toString()},h.prototype.toLocaleString=function(){return this.$items.toLocaleString()},h.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(h,Symbol.species,{get:function(){return h},enumerable:!1,configurable:!0}),h.prototype.entries=function(){return this.$items.entries()},h.prototype.keys=function(){return this.$items.keys()},h.prototype.values=function(){return this.$items.values()},h.prototype.includes=function(k,h){return Array.from(this.$items.values()).includes(k,h)},h.prototype.flatMap=function(k,h){throw new Error("ArraySchema#flatMap() is not supported.")},h.prototype.flat=function(k){throw new Error("ArraySchema#flat() is not supported.")},h.prototype.findLast=function(){var k=Array.from(this.$items.values());return k.findLast.apply(k,arguments)},h.prototype.findLastIndex=function(){var k=Array.from(this.$items.values());return k.findLastIndex.apply(k,arguments)},h.prototype.setIndex=function(k,h){this.$indexes.set(k,h)},h.prototype.getIndex=function(k){return this.$indexes.get(k)},h.prototype.getByIndex=function(k){return this.$items.get(this.$indexes.get(k))},h.prototype.deleteByIndex=function(k){var h=this.$indexes.get(k);this.$items.delete(h),this.$indexes.delete(k)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){return this.toArray().map((function(k){return"function"===typeof k.toJSON?k.toJSON():k}))},h.prototype.clone=function(k){return k?new(h.bind.apply(h,I([void 0],Array.from(this.$items.values()),!1))):new(h.bind.apply(h,I([void 0],this.map((function(k){return k.$changes?k.clone():k})),!1)))},h}();function c(k){return k.$proxy=!0,k=new Proxy(k,{get:function(k,h){return"symbol"!==typeof h&&"undefined"===typeof k[h]?k.get(h):k[h]},set:function(k,h,o){return"symbol"!==typeof h&&-1===h.indexOf("$")&&"HJ"!==h&&"Kh"!==h&&"onChange"!==h?k.set(h,o):k[h]=o,!0},deleteProperty:function(k,h){return k.delete(h),!0}})}var W=function(){function h(k){var o=this;if(this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,k)if(k instanceof Map||k instanceof h)k.forEach((function(k,h){return o.set(h,k)}));else for(var x in k)this.set(x,k[x])}return h.prototype.HJ=function(h,o){return void 0===o&&(o=!0),l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.ADD,h,o?this.$items:void 0)},h.prototype.Kh=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,h)},h.is=function(k){return void 0!==k.map},h.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(h.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(h,Symbol.species,{get:function(){return h},enumerable:!1,configurable:!0}),h.prototype.set=function(h,o){if(void 0===o||null===o)throw new Error("MapSchema#set('".concat(h,"', ").concat(o,"): trying to set ").concat(o," value on '").concat(h,"'."));h=h.toString();var x="undefined"!==typeof this.$changes.indexes[h],I=x?this.$changes.indexes[h]:this.$refId++,q=x?k.OPERATION.REPLACE:k.OPERATION.ADD,Y=void 0!==o.$changes;if(Y&&o.$changes.setParent(this,this.$changes.root,I),x){if(!Y&&this.$items.get(h)===o)return;Y&&this.$items.get(h)!==o&&(q=k.OPERATION.ADD)}else this.$changes.indexes[h]=I,this.$indexes.set(I,h);return this.$items.set(h,o),this.$changes.change(h,q),this},h.prototype.get=function(k){return this.$items.get(k)},h.prototype.delete=function(k){return this.$changes.delete(k),this.$items.delete(k)},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&A.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:k.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(k){return this.$items.has(k)},h.prototype.forEach=function(k){this.$items.forEach(k)},h.prototype.entries=function(){return this.$items.entries()},h.prototype.keys=function(){return this.$items.keys()},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(k,h){this.$indexes.set(k,h)},h.prototype.getIndex=function(k){return this.$indexes.get(k)},h.prototype.getByIndex=function(k){return this.$items.get(this.$indexes.get(k))},h.prototype.deleteByIndex=function(k){var h=this.$indexes.get(k);this.$items.delete(h),this.$indexes.delete(k)},h.prototype.toJSON=function(){var k={};return this.forEach((function(h,o){k[o]="function"===typeof h.toJSON?h.toJSON():h})),k},h.prototype.clone=function(k){var o;return k?o=Object.assign(new h,this):(o=new h,this.forEach((function(k,h){k.$changes?o.set(h,k.clone()):o.set(h,k)}))),o},h}(),f={};function M(k,h){f[k]=h}function T(k){return f[k]}var j=function(){function k(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return k.create=function(h){var o=new k;return o.schema=Object.assign({},h&&h.schema||{}),o.indexes=Object.assign({},h&&h.indexes||{}),o.fieldsByIndex=Object.assign({},h&&h.fieldsByIndex||{}),o.descriptors=Object.assign({},h&&h.descriptors||{}),o.deprecated=Object.assign({},h&&h.deprecated||{}),o},k.prototype.addField=function(k,h){var o=this.getNextFieldIndex();this.fieldsByIndex[o]=k,this.indexes[k]=o,this.schema[k]=Array.isArray(h)?{array:h[0]}:h},k.prototype.hasField=function(k){return void 0!==this.indexes[k]},k.prototype.addFilter=function(k,h){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[k]]=h,this.indexesWithFilters.push(this.indexes[k]),!0},k.prototype.addChildrenFilter=function(k,h){var o=this.indexes[k],x=this.schema[k];if(T(Object.keys(x)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[o]=h,!0;console.warn("@filterChildren: field '".concat(k,"' can't have children. Ignoring filter."))},k.prototype.getChildrenFilter=function(k){return this.childFilters&&this.childFilters[this.indexes[k]]},k.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},k}();function d(k){return k._context&&k._context.useFilters}var b=function(){function k(){this.types={},this.schemas=new Map,this.useFilters=!1}return k.prototype.has=function(k){return this.schemas.has(k)},k.prototype.get=function(k){return this.types[k]},k.prototype.add=function(k,h){void 0===h&&(h=this.schemas.size),k._definition=j.create(k._definition),k._typeid=h,this.types[h]=k,this.schemas.set(k,h)},k.create=function(h){return void 0===h&&(h={}),function(o){return h.context||(h.context=new k),i(o,h)}},k}(),V=new b;function i(k,h){return void 0===h&&(h={}),function(o,x){var q=h.context||V,Y=o.constructor;if(Y._context=q,!k)throw new Error("".concat(Y.name,': @type() reference provided for "').concat(x,"\" is undefined. Make sure you don't have any circular dependencies."));q.has(Y)||q.add(Y);var J=Y._definition;if(J.addField(x,k),J.descriptors[x]){if(J.deprecated[x])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(x,"' definition on '").concat(Y.name,"'.\nCheck @type() annotation"))}catch(f){var G=f.stack.split("\n")[4].trim();throw new Error("".concat(f.message," ").concat(G))}}var l=X.is(k),A=!l&&W.is(k);if("string"!==typeof k&&!Uk.is(k)){var K=Object.values(k)[0];"string"===typeof K||q.has(K)||q.add(K)}if(h.manual)J.descriptors[x]={enumerable:!0,configurable:!0,writable:!0};else{var a="_".concat(x);J.descriptors[a]={enumerable:!1,configurable:!1,writable:!0},J.descriptors[x]={get:function(){return this[a]},set:function(k){k!==this[a]&&(void 0!==k&&null!==k?(!l||k instanceof X||(k=new(X.bind.apply(X,I([void 0],k,!1)))),!A||k instanceof W||(k=new W(k)),void 0===k.$proxy&&(A?k=c(k):l&&(k=N(k))),this.$changes.change(x),k.$changes&&k.$changes.setParent(this,this.$changes.root,this._definition.indexes[x])):this[a]&&this.$changes.delete(x),this[a]=k)},enumerable:!0,configurable:!0}}}}function F(k){return function(h,o){var x=h.constructor;x._definition.addFilter(o,k)&&(x._context.useFilters=!0)}}function R(k){return function(h,o){var x=h.constructor;x._definition.addChildrenFilter(o,k)&&(x._context.useFilters=!0)}}function s(k){return void 0===k&&(k=!0),function(h,o){var x=h.constructor._definition;x.deprecated[o]=!0,k&&(x.descriptors[o]={get:function(){throw new Error("".concat(o," is deprecated."))},set:function(k){},enumerable:!1,configurable:!0})}}function Z(k,h,o){for(var x in void 0===o&&(o={}),o.context||(o.context=k._context||o.context||V),h)i(h[x],o)(k.prototype,x);return k}function w(k){for(var h=0,o=0,x=0,I=k.length;x<I;x++)(h=k.charCodeAt(x))<128?o+=1:h<2048?o+=2:h<55296||h>=57344?o+=3:(x++,o+=4);return o}function D(k,h,o){for(var x=0,I=0,q=o.length;I<q;I++)(x=o.charCodeAt(I))<128?k[h++]=x:x<2048?(k[h++]=192|x>>6,k[h++]=128|63&x):x<55296||x>=57344?(k[h++]=224|x>>12,k[h++]=128|x>>6&63,k[h++]=128|63&x):(I++,x=65536+((1023&x)<<10|1023&o.charCodeAt(I)),k[h++]=240|x>>18,k[h++]=128|x>>12&63,k[h++]=128|x>>6&63,k[h++]=128|63&x)}function U(k,h){k.push(255&h)}function Q(k,h){k.push(255&h)}function B(k,h){k.push(255&h),k.push(h>>8&255)}function E(k,h){k.push(255&h),k.push(h>>8&255)}function n(k,h){k.push(255&h),k.push(h>>8&255),k.push(h>>16&255),k.push(h>>24&255)}function H(k,h){var o=h>>24,x=h>>16,I=h>>8,q=h;k.push(255&q),k.push(255&I),k.push(255&x),k.push(255&o)}function y(k,h){var o=Math.floor(h/Math.pow(2,32));H(k,h>>>0),H(k,o)}function O(k,h){var o=h/Math.pow(2,32)|0;H(k,h>>>0),H(k,o)}function z(k,h){P(k,h)}function p(k,h){r(k,h)}var v=new Int32Array(2),m=new Float32Array(v.buffer),L=new Float64Array(v.buffer);function P(k,h){m[0]=h,n(k,v[0])}function r(k,h){L[0]=h,n(k,v[0]),n(k,v[1])}function t(k,h){return Q(k,h?1:0)}function S(k,h){h||(h="");var o=w(h),x=0;if(o<32)k.push(160|o),x=1;else if(o<256)k.push(217),Q(k,o),x=2;else if(o<65536)k.push(218),E(k,o),x=3;else{if(!(o<4294967296))throw new Error("String too long");k.push(219),H(k,o),x=5}return D(k,k.length,h),x+o}function C(k,h){return isNaN(h)?C(k,0):isFinite(h)?h!==(0|h)?(k.push(203),r(k,h),9):h>=0?h<128?(Q(k,h),1):h<256?(k.push(204),Q(k,h),2):h<65536?(k.push(205),E(k,h),3):h<4294967296?(k.push(206),H(k,h),5):(k.push(207),O(k,h),9):h>=-32?(k.push(224|h+32),1):h>=-128?(k.push(208),U(k,h),2):h>=-32768?(k.push(209),B(k,h),3):h>=-2147483648?(k.push(210),n(k,h),5):(k.push(211),y(k,h),9):C(k,h>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var g=Object.freeze({__proto__:null,utf8Write:D,int8:U,uint8:Q,int16:B,uint16:E,int32:n,uint32:H,int64:y,uint64:O,float32:z,float64:p,writeFloat32:P,writeFloat64:r,boolean:t,string:S,number:C});function e(k,h,o){for(var x="",I=0,q=h,Y=h+o;q<Y;q++){var J=k[q];0!==(128&J)?192!==(224&J)?224!==(240&J)?240!==(248&J)?console.error("Invalid byte "+J.toString(16)):(I=(7&J)<<18|(63&k[++q])<<12|(63&k[++q])<<6|63&k[++q])>=65536?(I-=65536,x+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):x+=String.fromCharCode(I):x+=String.fromCharCode((15&J)<<12|(63&k[++q])<<6|63&k[++q]):x+=String.fromCharCode((31&J)<<6|63&k[++q]):x+=String.fromCharCode(J)}return x}function u(k,h){return kk(k,h)<<24>>24}function kk(k,h){return k[h.offset++]}function hk(k,h){return ok(k,h)<<16>>16}function ok(k,h){return k[h.offset++]|k[h.offset++]<<8}function xk(k,h){return k[h.offset++]|k[h.offset++]<<8|k[h.offset++]<<16|k[h.offset++]<<24}function Ik(k,h){return xk(k,h)>>>0}function qk(k,h){return ak(k,h)}function Yk(k,h){return Nk(k,h)}function Jk(k,h){var o=Ik(k,h);return xk(k,h)*Math.pow(2,32)+o}function Gk(k,h){var o=Ik(k,h);return Ik(k,h)*Math.pow(2,32)+o}var lk=new Int32Array(2),Ak=new Float32Array(lk.buffer),Kk=new Float64Array(lk.buffer);function ak(k,h){return lk[0]=xk(k,h),Ak[0]}function Nk(k,h){return lk[0]=xk(k,h),lk[1]=xk(k,h),Kk[0]}function Xk(k,h){return kk(k,h)>0}function ck(k,h){var o,x=k[h.offset++];x<192?o=31&x:217===x?o=kk(k,h):218===x?o=ok(k,h):219===x&&(o=Ik(k,h));var I=e(k,h.offset,o);return h.offset+=o,I}function Wk(k,h){var o=k[h.offset];return o<192&&o>160||217===o||218===o||219===o}function fk(k,h){var o=k[h.offset++];return o<128?o:202===o?ak(k,h):203===o?Nk(k,h):204===o?kk(k,h):205===o?ok(k,h):206===o?Ik(k,h):207===o?Gk(k,h):208===o?u(k,h):209===o?hk(k,h):210===o?xk(k,h):211===o?Jk(k,h):o>223?-1*(255-o+1):void 0}function Mk(k,h){var o=k[h.offset];return o<128||o>=202&&o<=211}function Tk(k,h){return k[h.offset]<160}function jk(k,h){return k[h.offset-1]===Y&&(k[h.offset]<128||k[h.offset]>=202&&k[h.offset]<=211)}var dk=Object.freeze({__proto__:null,int8:u,uint8:kk,int16:hk,uint16:ok,int32:xk,uint32:Ik,float32:qk,float64:Yk,int64:Jk,uint64:Gk,readFloat32:ak,readFloat64:Nk,boolean:Xk,string:ck,stringCheck:Wk,number:fk,numberCheck:Mk,arrayCheck:Tk,switchStructureCheck:jk}),bk=function(){function h(k){var h=this;this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,k&&k.forEach((function(k){return h.add(k)}))}return h.prototype.HJ=function(h,o){return void 0===o&&(o=!0),l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.ADD,h,o?this.$items:void 0)},h.prototype.Kh=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,h)},h.is=function(k){return void 0!==k.collection},h.prototype.add=function(k){var h=this.$refId++;return void 0!==k.$changes&&k.$changes.setParent(this,this.$changes.root,h),this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,k),this.$changes.change(h),h},h.prototype.at=function(k){var h=Array.from(this.$items.keys())[k];return this.$items.get(h)},h.prototype.entries=function(){return this.$items.entries()},h.prototype.delete=function(k){for(var h,o,x=this.$items.entries();(o=x.next())&&!o.done;)if(k===o.value[1]){h=o.value[0];break}return void 0!==h&&(this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h))},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&A.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:k.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(k){return Array.from(this.$items.values()).some((function(h){return h===k}))},h.prototype.forEach=function(k){var h=this;this.$items.forEach((function(o,x,I){return k(o,x,h)}))},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(k,h){this.$indexes.set(k,h)},h.prototype.getIndex=function(k){return this.$indexes.get(k)},h.prototype.getByIndex=function(k){return this.$items.get(this.$indexes.get(k))},h.prototype.deleteByIndex=function(k){var h=this.$indexes.get(k);this.$items.delete(h),this.$indexes.delete(k)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){var k=[];return this.forEach((function(h,o){k.push("function"===typeof h.toJSON?h.toJSON():h)})),k},h.prototype.clone=function(k){var o;return k?o=Object.assign(new h,this):(o=new h,this.forEach((function(k){k.$changes?o.add(k.clone()):o.add(k)}))),o},h}(),Vk=function(){function h(k){var h=this;this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,k&&k.forEach((function(k){return h.add(k)}))}return h.prototype.HJ=function(h,o){return void 0===o&&(o=!0),l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.ADD,h,o?this.$items:void 0)},h.prototype.Kh=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,h)},h.is=function(k){return void 0!==k.set},h.prototype.add=function(h){var o,x;if(this.has(h))return!1;var I=this.$refId++;void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,I);var q=null!==(x=null===(o=this.$changes.indexes[I])||void 0===o?void 0:o.op)&&void 0!==x?x:k.OPERATION.ADD;return this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,h),this.$changes.change(I,q),I},h.prototype.entries=function(){return this.$items.entries()},h.prototype.delete=function(k){for(var h,o,x=this.$items.entries();(o=x.next())&&!o.done;)if(k===o.value[1]){h=o.value[0];break}return void 0!==h&&(this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h))},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&A.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:k.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(k){for(var h,o=this.$items.values(),x=!1;(h=o.next())&&!h.done;)if(k===h.value){x=!0;break}return x},h.prototype.forEach=function(k){var h=this;this.$items.forEach((function(o,x,I){return k(o,x,h)}))},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(k,h){this.$indexes.set(k,h)},h.prototype.getIndex=function(k){return this.$indexes.get(k)},h.prototype.getByIndex=function(k){return this.$items.get(this.$indexes.get(k))},h.prototype.deleteByIndex=function(k){var h=this.$indexes.get(k);this.$items.delete(h),this.$indexes.delete(k)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){var k=[];return this.forEach((function(h,o){k.push("function"===typeof h.toJSON?h.toJSON():h)})),k},h.prototype.clone=function(k){var o;return k?o=Object.assign(new h,this):(o=new h,this.forEach((function(k){k.$changes?o.add(k.clone()):o.add(k)}))),o},h}(),ik=function(){function k(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return k.prototype.addRefId=function(k){this.refIds.has(k)||(this.refIds.add(k),this.containerIndexes.set(k,new Set))},k.get=function(h){return void 0===h.$filterState&&(h.$filterState=new k),h.$filterState},k}(),Fk=function(){function k(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return k.prototype.getNextUniqueId=function(){return this.nextUniqueId++},k.prototype.addRef=function(k,h,o){void 0===o&&(o=!0),this.refs.set(k,h),o&&(this.refCounts[k]=(this.refCounts[k]||0)+1)},k.prototype.removeRef=function(k){this.refCounts[k]=this.refCounts[k]-1,this.deletedRefs.add(k)},k.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},k.prototype.garbageCollectDeletedRefs=function(){var k=this;this.deletedRefs.forEach((function(h){if(!(k.refCounts[h]>0)){var o=k.refs.get(h);if(o instanceof Uk)for(var x in o._definition.schema)"string"!==typeof o._definition.schema[x]&&o[x]&&o[x].$changes&&k.removeRef(o[x].$changes.refId);else{var I=o.$changes.parent._definition,q=I.schema[I.fieldsByIndex[o.$changes.parentIndex]];"function"===typeof Object.values(q)[0]&&Array.from(o.values()).forEach((function(h){return k.removeRef(h.$changes.refId)}))}k.refs.delete(h),delete k.refCounts[h]}})),this.deletedRefs.clear()},k}(),Rk=function(k){function h(){return null!==k&&k.apply(this,arguments)||this}return o(h,k),h}(Error);function sk(k,h,o,x){var I,q=!1;switch(h){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":I="number",isNaN(k)&&console.log('trying to encode "NaN" in '.concat(o.constructor.name,"#").concat(x));break;case"string":I="string",q=!0;break;case"boolean":return}if(typeof k!==I&&(!q||q&&null!==k)){var Y="'".concat(JSON.stringify(k),"'").concat(k&&k.constructor&&" (".concat(k.constructor.name,")")||"");throw new Rk("a '".concat(I,"' was expected, but ").concat(Y," was provided in ").concat(o.constructor.name,"#").concat(x))}}function Zk(k,h,o,x){if(!(k instanceof h))throw new Rk("a '".concat(h.name,"' was expected, but '").concat(k.constructor.name,"' was provided in ").concat(o.constructor.name,"#").concat(x))}function wk(k,h,o,x,I){sk(o,k,x,I);var q=g[k];if(!q)throw new Rk("a '".concat(k,"' was expected, but ").concat(o," was provided in ").concat(x.constructor.name,"#").concat(I));q(h,o)}function Dk(k,h,o){return dk[k](h,o)}var Uk=function(){function h(){for(var k=[],h=0;h<arguments.length;h++)k[h]=arguments[h];Object.defineProperties(this,{$changes:{value:new G(this,void 0,new Fk),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var o=this._definition.descriptors;o&&Object.defineProperties(this,o),k[0]&&this.assign(k[0])}return h.onError=function(k){console.error(k)},h.is=function(k){return k._definition&&void 0!==k._definition.schema},h.prototype.onChange=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.REPLACE,h)},h.prototype.Kh=function(h){return l(this.$callbacks||(this.$callbacks=[]),k.OPERATION.DELETE,h)},h.prototype.assign=function(k){return Object.assign(this,k),this},Object.defineProperty(h.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),h.prototype.setDirty=function(k,h){this.$changes.change(k,h)},h.prototype.listen=function(k,h,o){var x=this;return void 0===o&&(o=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[k]||(this.$callbacks[k]=[]),this.$callbacks[k].push(h),o&&void 0!==this[k]&&h(this[k],void 0),function(){return K(x.$callbacks[k],x.$callbacks[k].indexOf(h))}},h.prototype.decode=function(o,x,I){var q;void 0===x&&(x={offset:0}),void 0===I&&(I=this);var J=[],G=this.$changes.root,l=o.length,A=0;for(G.refs.set(A,this);x.offset<l;){var K=o[x.offset++];if(K!=Y){var a=I.$changes,N=void 0!==I._definition,c=N?K>>6<<6:K;if(c!==k.OPERATION.CLEAR){var f=N?K%(c||255):fk(o,x),M=N?I._definition.fieldsByIndex[f]:"",j=a.getType(f),d=void 0,b=void 0,V=void 0;if(N?b=I["_".concat(M)]:(b=I.getByIndex(f),(c&k.OPERATION.ADD)===k.OPERATION.ADD?(V=I instanceof W?ck(o,x):f,I.setIndex(f,V)):V=I.getIndex(f)),(c&k.OPERATION.DELETE)===k.OPERATION.DELETE&&(c!==k.OPERATION.DELETE_AND_ADD&&I.deleteByIndex(f),b&&b.$changes&&G.removeRef(b.$changes.refId),d=null),void 0!==M){if(c===k.OPERATION.DELETE);else if(h.is(j)){var i=fk(o,x);if(d=G.refs.get(i),c!==k.OPERATION.REPLACE){var F=this.getSchemaType(o,x,j);d||((d=this.createTypeInstance(F)).$changes.refId=i,b&&(d.$callbacks=b.$callbacks,b.$changes.refId&&i!==b.$changes.refId&&G.removeRef(b.$changes.refId))),G.addRef(i,d,d!==b)}}else if("string"===typeof j)d=Dk(j,o,x);else{var R=T(Object.keys(j)[0]),s=fk(o,x),Z=G.refs.has(s)?b||G.refs.get(s):new R.constructor;if((d=Z.clone(!0)).$changes.refId=s,b&&(d.$callbacks=b.$callbacks,b.$changes.refId&&s!==b.$changes.refId)){G.removeRef(b.$changes.refId);for(var w=b.entries(),D=void 0;(D=w.next())&&!D.done;){var U=(q=D.value)[0],Q=q[1];J.push({refId:s,op:k.OPERATION.DELETE,field:U,value:void 0,previousValue:Q})}}G.addRef(s,d,Z!==b)}if(null!==d&&void 0!==d)if(d.$changes&&d.$changes.setParent(a.ref,a.root,f),I instanceof h)I[M]=d;else if(I instanceof W)U=V,I.$items.set(U,d),I.$changes.allChanges.add(f);else if(I instanceof X)I.setAt(f,d);else if(I instanceof bk){var B=I.add(d);I.setIndex(f,B)}else I instanceof Vk&&!1!==(B=I.add(d))&&I.setIndex(f,B);b!==d&&J.push({refId:A,op:c,field:M,dynamicIndex:V,value:d,previousValue:b})}else{console.warn("@colyseus/schema: definition mismatch");for(var E={offset:x.offset};x.offset<l&&(!jk(o,x)||(E.offset=x.offset+1,!G.refs.has(fk(o,E))));)x.offset++}}else I.clear(J)}else{A=fk(o,x);var n=G.refs.get(A);if(!n)throw new Error('"refId" not found: '.concat(A));I=n}}return this._triggerChanges(J),G.garbageCollectDeletedRefs(),J},h.prototype.encode=function(o,x,I){void 0===o&&(o=!1),void 0===x&&(x=[]),void 0===I&&(I=!1);for(var q=this.$changes,J=new WeakSet,G=[q],l=1,A=0;A<l;A++){var K=G[A],a=K.ref,N=a instanceof h;K.ensureRefId(),J.add(K),K!==q&&(K.changed||o)&&(Q(x,Y),C(x,K.refId));for(var X=o?Array.from(K.allChanges):Array.from(K.changes.values()),c=0,f=X.length;c<f;c++){var M=o?{op:k.OPERATION.ADD,index:X[c]}:X[c],j=M.index,d=N?a._definition.fieldsByIndex&&a._definition.fieldsByIndex[j]:j,b=x.length;if(M.op!==k.OPERATION.TOUCH)if(N)Q(x,j|M.op);else{if(Q(x,M.op),M.op===k.OPERATION.CLEAR)continue;C(x,j)}if(N||(M.op&k.OPERATION.ADD)!=k.OPERATION.ADD||a instanceof W&&S(x,K.ref.$indexes.get(j)),M.op!==k.OPERATION.DELETE){var V=K.getType(j),i=K.getValue(j);if(i&&i.$changes&&!J.has(i.$changes)&&(G.push(i.$changes),i.$changes.ensureRefId(),l++),M.op!==k.OPERATION.TOUCH){if(h.is(V))Zk(i,V,a,d),C(x,i.$changes.refId),(M.op&k.OPERATION.ADD)===k.OPERATION.ADD&&this.tryEncodeTypeId(x,V,i.constructor);else if("string"===typeof V)wk(V,x,i,a,d);else{var F=T(Object.keys(V)[0]);Zk(a["_".concat(d)],F.constructor,a,d),C(x,i.$changes.refId)}I&&K.cache(j,x.slice(b))}}}o||I||K.discard()}return x},h.prototype.encodeAll=function(k){return this.encode(!0,[],k)},h.prototype.applyFilters=function(o,x){var I,q;void 0===x&&(x=!1);for(var J=this,G=new Set,l=ik.get(o),A=[this.$changes],K=1,a=[],N=function(N){var X=A[N];if(G.has(X.refId))return"continue";var c=X.ref,f=c instanceof h;Q(a,Y),C(a,X.refId);var M=l.refIds.has(X),T=x||!M;l.addRefId(X);var j=l.containerIndexes.get(X),d=T?Array.from(X.allChanges):Array.from(X.changes.values());!x&&f&&c._definition.indexesWithFilters&&c._definition.indexesWithFilters.forEach((function(h){!j.has(h)&&X.allChanges.has(h)&&(T?d.push(h):d.push({op:k.OPERATION.ADD,index:h}))}));for(var b=0,V=d.length;b<V;b++){var i=T?{op:k.OPERATION.ADD,index:d[b]}:d[b];if(i.op!==k.OPERATION.CLEAR){var F=i.index;if(i.op!==k.OPERATION.DELETE){var R=X.getValue(F),s=X.getType(F);if(f){if((Z=c._definition.filters&&c._definition.filters[F])&&!Z.call(c,o,R,J)){R&&R.$changes&&G.add(R.$changes.refId);continue}}else{var Z,w=X.parent;if((Z=X.getChildrenFilter())&&!Z.call(w,o,c.$indexes.get(F),R,J)){R&&R.$changes&&G.add(R.$changes.refId);continue}}if(R.$changes&&(A.push(R.$changes),K++),i.op!==k.OPERATION.TOUCH)if(i.op===k.OPERATION.ADD||f)a.push.apply(a,null!==(I=X.caches[F])&&void 0!==I?I:[]),j.add(F);else if(j.has(F))a.push.apply(a,null!==(q=X.caches[F])&&void 0!==q?q:[]);else{if(j.add(F),Q(a,k.OPERATION.ADD),C(a,F),c instanceof W){var D=X.ref.$indexes.get(F);S(a,D)}R.$changes?C(a,R.$changes.refId):g[s](a,R)}else R.$changes&&!f&&(Q(a,k.OPERATION.ADD),C(a,F),c instanceof W&&(D=X.ref.$indexes.get(F),S(a,D)),C(a,R.$changes.refId))}else f?Q(a,i.op|F):(Q(a,i.op),C(a,F))}else Q(a,i.op)}},X=0;X<K;X++)N(X);return a},h.prototype.clone=function(){var k,h=new this.constructor,o=this._definition.schema;for(var x in o)"object"===typeof this[x]&&"function"===typeof(null===(k=this[x])||void 0===k?void 0:k.clone)?h[x]=this[x].clone():h[x]=this[x];return h},h.prototype.toJSON=function(){var k=this._definition.schema,h=this._definition.deprecated,o={};for(var x in k)h[x]||null===this[x]||"undefined"===typeof this[x]||(o[x]="function"===typeof this[x].toJSON?this[x].toJSON():this["_".concat(x)]);return o},h.prototype.discardAllChanges=function(){this.$changes.discardAll()},h.prototype.getByIndex=function(k){return this[this._definition.fieldsByIndex[k]]},h.prototype.deleteByIndex=function(k){this[this._definition.fieldsByIndex[k]]=void 0},h.prototype.tryEncodeTypeId=function(k,h,o){h._typeid!==o._typeid&&(Q(k,J),C(k,o._typeid))},h.prototype.getSchemaType=function(k,h,o){var x;return k[h.offset]===J&&(h.offset++,x=this.constructor._context.get(fk(k,h))),x||o},h.prototype.createTypeInstance=function(k){var h=new k;return h.$changes.root=this.$changes.root,h},h.prototype._triggerChanges=function(o){for(var x,I,q,Y,J,G,l,A,K,a=new Set,N=this.$changes.root.refs,X=function(X){var c=o[X],W=c.refId,f=N.get(W),M=f.$callbacks;if((c.op&k.OPERATION.DELETE)===k.OPERATION.DELETE&&c.previousValue instanceof h&&(null===(I=null===(x=c.previousValue.$callbacks)||void 0===x?void 0:x[k.OPERATION.DELETE])||void 0===I||I.forEach((function(k){return k()}))),!M)return"continue";if(f instanceof h){if(!a.has(W))try{null===(q=null===M||void 0===M?void 0:M[k.OPERATION.REPLACE])||void 0===q||q.forEach((function(k){return k()}))}catch(T){h.onError(T)}try{M.hasOwnProperty(c.field)&&(null===(Y=M[c.field])||void 0===Y||Y.forEach((function(k){return k(c.value,c.previousValue)})))}catch(T){h.onError(T)}}else c.op===k.OPERATION.ADD&&void 0===c.previousValue?null===(J=M[k.OPERATION.ADD])||void 0===J||J.forEach((function(k){var h;return k(c.value,null!==(h=c.dynamicIndex)&&void 0!==h?h:c.field)})):c.op===k.OPERATION.DELETE?void 0!==c.previousValue&&(null===(G=M[k.OPERATION.DELETE])||void 0===G||G.forEach((function(k){var h;return k(c.previousValue,null!==(h=c.dynamicIndex)&&void 0!==h?h:c.field)}))):c.op===k.OPERATION.DELETE_AND_ADD&&(void 0!==c.previousValue&&(null===(l=M[k.OPERATION.DELETE])||void 0===l||l.forEach((function(k){var h;return k(c.previousValue,null!==(h=c.dynamicIndex)&&void 0!==h?h:c.field)}))),null===(A=M[k.OPERATION.ADD])||void 0===A||A.forEach((function(k){var h;return k(c.value,null!==(h=c.dynamicIndex)&&void 0!==h?h:c.field)}))),c.value!==c.previousValue&&(null===(K=M[k.OPERATION.REPLACE])||void 0===K||K.forEach((function(k){var h;return k(c.value,null!==(h=c.dynamicIndex)&&void 0!==h?h:c.field)})));a.add(W)},c=0;c<o.length;c++)X(c)},h._definition=j.create(),h}();function Qk(k){for(var h=[k.$changes],o=1,x={},I=x,q=function(k){var o=h[k];o.changes.forEach((function(k){var h=o.ref,x=k.index,q=h._definition?h._definition.fieldsByIndex[x]:h.$indexes.get(x);I[q]=o.getValue(x)}))},Y=0;Y<o;Y++)q(Y);return x}var Bk={context:new b},Ek=function(k){function h(){return null!==k&&k.apply(this,arguments)||this}return o(h,k),x([i("string",Bk)],h.prototype,"name",void 0),x([i("string",Bk)],h.prototype,"type",void 0),x([i("number",Bk)],h.prototype,"referencedType",void 0),h}(Uk),nk=function(k){function h(){var h=null!==k&&k.apply(this,arguments)||this;return h.fields=new X,h}return o(h,k),x([i("number",Bk)],h.prototype,"id",void 0),x([i([Ek],Bk)],h.prototype,"fields",void 0),h}(Uk),Hk=function(k){function h(){var h=null!==k&&k.apply(this,arguments)||this;return h.types=new X,h}return o(h,k),h.encode=function(k){var o=k.constructor,x=new h;x.rootType=o._typeid;var I=function(k,h){for(var o in h){var I=new Ek;I.name=o;var q=void 0;if("string"===typeof h[o])q=h[o];else{var Y=h[o],J=void 0;Uk.is(Y)?(q="ref",J=h[o]):"string"===typeof Y[q=Object.keys(Y)[0]]?q+=":"+Y[q]:J=Y[q],I.referencedType=J?J._typeid:-1}I.type=q,k.fields.push(I)}x.types.push(k)},q=o._context.types;for(var Y in q){var J=new nk;J.id=Number(Y),I(J,q[Y]._definition.schema)}return x.encodeAll()},h.decode=function(k,x){var I=new b,q=new h;q.decode(k,x);var Y=q.types.reduce((function(k,h){var x=function(k){function h(){return null!==k&&k.apply(this,arguments)||this}return o(h,k),h}(Uk),q=h.id;return k[q]=x,I.add(x,q),k}),{});q.types.forEach((function(k){var h=Y[k.id];k.fields.forEach((function(k){var o;if(void 0!==k.referencedType){var x=k.type,q=Y[k.referencedType];if(!q){var J=k.type.split(":");x=J[0],q=J[1]}"ref"===x?i(q,{context:I})(h.prototype,k.name):i(((o={})[x]=q,o),{context:I})(h.prototype,k.name)}else i(k.type,{context:I})(h.prototype,k.name)}))}));var J=Y[q.rootType],G=new J;for(var l in J._definition.schema){var A=J._definition.schema[l];"string"!==typeof A&&(G[l]="function"===typeof A?new A:new(T(Object.keys(A)[0]).constructor))}return G},x([i([nk],Bk)],h.prototype,"types",void 0),x([i("number",Bk)],h.prototype,"rootType",void 0),h}(Uk);M("map",{constructor:W}),M("array",{constructor:X}),M("set",{constructor:Vk}),M("collection",{constructor:bk}),k.ArraySchema=X,k.CollectionSchema=bk,k.Context=b,k.MapSchema=W,k.Reflection=Hk,k.ReflectionField=Ek,k.ReflectionType=nk,k.Schema=Uk,k.SchemaDefinition=j,k.SetSchema=Vk,k.decode=dk,k.defineTypes=Z,k.deprecated=s,k.dumpChanges=Qk,k.encode=g,k.filter=F,k.filterChildren=R,k.hasFilter=d,k.registerType=M,k.type=i,Object.defineProperty(k,"__esModule",{value:!0})}(h)},13340:k=>{"use strict";k.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13333:(k,h,o)=>{var x=o(13340),I=o(13345),q=Object.hasOwnProperty,Y=Object.create(null);for(var J in x)q.call(x,J)&&(Y[x[J]]=J);var G=k.exports={to:{},get:{}};function l(k,h,o){return Math.min(Math.max(h,k),o)}function A(k){var h=Math.round(k).toString(16).toUpperCase();return h.length<2?"0"+h:h}G.get=function(k){var h,o;switch(k.substring(0,3).toLowerCase()){case"hsl":h=G.get.hsl(k),o="hsl";break;case"hwb":h=G.get.hwb(k),o="hwb";break;default:h=G.get.rgb(k),o="rgb"}return h?{model:o,value:h}:null},G.get.rgb=function(k){if(!k)return null;var h,o,I,Y=[0,0,0,1];if(h=k.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(I=h[2],h=h[1],o=0;o<3;o++){var J=2*o;Y[o]=parseInt(h.slice(J,J+2),16)}I&&(Y[3]=parseInt(I,16)/255)}else if(h=k.match(/^#([a-f0-9]{3,4})$/i)){for(I=(h=h[1])[3],o=0;o<3;o++)Y[o]=parseInt(h[o]+h[o],16);I&&(Y[3]=parseInt(I+I,16)/255)}else if(h=k.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(o=0;o<3;o++)Y[o]=parseInt(h[o+1],0);h[4]&&(h[5]?Y[3]=.01*parseFloat(h[4]):Y[3]=parseFloat(h[4]))}else{if(!(h=k.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(h=k.match(/^(\w+)$/))?"transparent"===h[1]?[0,0,0,0]:q.call(x,h[1])?((Y=x[h[1]])[3]=1,Y):null:null;for(o=0;o<3;o++)Y[o]=Math.round(2.55*parseFloat(h[o+1]));h[4]&&(h[5]?Y[3]=.01*parseFloat(h[4]):Y[3]=parseFloat(h[4]))}for(o=0;o<3;o++)Y[o]=l(Y[o],0,255);return Y[3]=l(Y[3],0,1),Y},G.get.hsl=function(k){if(!k)return null;var h=k.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(h){var o=parseFloat(h[4]);return[(parseFloat(h[1])%360+360)%360,l(parseFloat(h[2]),0,100),l(parseFloat(h[3]),0,100),l(isNaN(o)?1:o,0,1)]}return null},G.get.hwb=function(k){if(!k)return null;var h=k.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(h){var o=parseFloat(h[4]);return[(parseFloat(h[1])%360+360)%360,l(parseFloat(h[2]),0,100),l(parseFloat(h[3]),0,100),l(isNaN(o)?1:o,0,1)]}return null},G.to.hex=function(){var k=I(arguments);return"#"+A(k[0])+A(k[1])+A(k[2])+(k[3]<1?A(Math.round(255*k[3])):"")},G.to.rgb=function(){var k=I(arguments);return k.length<4||1===k[3]?"rgb("+Math.round(k[0])+", "+Math.round(k[1])+", "+Math.round(k[2])+")":"rgba("+Math.round(k[0])+", "+Math.round(k[1])+", "+Math.round(k[2])+", "+k[3]+")"},G.to.rgb.percent=function(){var k=I(arguments),h=Math.round(k[0]/255*100),o=Math.round(k[1]/255*100),x=Math.round(k[2]/255*100);return k.length<4||1===k[3]?"rgb("+h+"%, "+o+"%, "+x+"%)":"rgba("+h+"%, "+o+"%, "+x+"%, "+k[3]+")"},G.to.hsl=function(){var k=I(arguments);return k.length<4||1===k[3]?"hsl("+k[0]+", "+k[1]+"%, "+k[2]+"%)":"hsla("+k[0]+", "+k[1]+"%, "+k[2]+"%, "+k[3]+")"},G.to.hwb=function(){var k=I(arguments),h="";return k.length>=4&&1!==k[3]&&(h=", "+k[3]),"hwb("+k[0]+", "+k[1]+"%, "+k[2]+"%"+h+")"},G.to.keyword=function(k){return Y[k.slice(0,3)]}},13326:(k,h,o)=>{const x=o(13333),I=o(13354),q=["keyword","gray","hex"],Y={};for(const N of Object.keys(I))Y[[...I[N].labels].sort().join("")]=N;const J={};function G(k,h){if(!(this instanceof G))return new G(k,h);if(h&&h in q&&(h=null),h&&!(h in I))throw new Error("Unknown model: "+h);let o,l;if(null==k)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(k instanceof G)this.model=k.model,this.color=[...k.color],this.valpha=k.valpha;else if("string"===typeof k){const h=x.get(k);if(null===h)throw new Error("Unable to parse color from string: "+k);this.model=h.model,l=I[this.model].channels,this.color=h.value.slice(0,l),this.valpha="number"===typeof h.value[l]?h.value[l]:1}else if(k.length>0){this.model=h||"rgb",l=I[this.model].channels;const o=Array.prototype.slice.call(k,0,l);this.color=a(o,l),this.valpha="number"===typeof k[l]?k[l]:1}else if("number"===typeof k)this.model="rgb",this.color=[k>>16&255,k>>8&255,255&k],this.valpha=1;else{this.valpha=1;const h=Object.keys(k);"alpha"in k&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"===typeof k.alpha?k.alpha:0);const x=h.sort().join("");if(!(x in Y))throw new Error("Unable to parse color from object: "+JSON.stringify(k));this.model=Y[x];const{labels:q}=I[this.model],J=[];for(o=0;o<q.length;o++)J.push(k[q[o]]);this.color=a(J)}if(J[this.model])for(l=I[this.model].channels,o=0;o<l;o++){const k=J[this.model][o];k&&(this.color[o]=k(this.color[o]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}G.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(k){let h=this.model in x.to?this:this.rgb();h=h.round("number"===typeof k?k:1);const o=1===h.valpha?h.color:[...h.color,this.valpha];return x.to[h.model](o)},percentString(k){const h=this.rgb().round("number"===typeof k?k:1),o=1===h.valpha?h.color:[...h.color,this.valpha];return x.to.rgb.percent(o)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const k={},{channels:h}=I[this.model],{labels:o}=I[this.model];for(let x=0;x<h;x++)k[o[x]]=this.color[x];return 1!==this.valpha&&(k.alpha=this.valpha),k},unitArray(){const k=this.rgb().color;return k[0]/=255,k[1]/=255,k[2]/=255,1!==this.valpha&&k.push(this.valpha),k},unitObject(){const k=this.rgb().object();return k.r/=255,k.g/=255,k.b/=255,1!==this.valpha&&(k.alpha=this.valpha),k},round(k){return k=Math.max(k||0,0),new G([...this.color.map(l(k)),this.valpha],this.model)},alpha(k){return void 0!==k?new G([...this.color,Math.max(0,Math.min(1,k))],this.model):this.valpha},red:A("rgb",0,K(255)),green:A("rgb",1,K(255)),blue:A("rgb",2,K(255)),hue:A(["hsl","hsv","hsl","hwb","hcg"],0,(k=>(k%360+360)%360)),saturationl:A("hsl",1,K(100)),lightness:A("hsl",2,K(100)),saturationv:A("hsv",1,K(100)),value:A("hsv",2,K(100)),chroma:A("hcg",1,K(100)),gray:A("hcg",2,K(100)),white:A("hwb",1,K(100)),wblack:A("hwb",2,K(100)),cyan:A("cmyk",0,K(100)),magenta:A("cmyk",1,K(100)),yellow:A("cmyk",2,K(100)),black:A("cmyk",3,K(100)),x:A("xyz",0,K(95.047)),y:A("xyz",1,K(100)),z:A("xyz",2,K(108.833)),l:A("lab",0,K(100)),a:A("lab",1),b:A("lab",2),keyword(k){return void 0!==k?new G(k):I[this.model].keyword(this.color)},hex(k){return void 0!==k?new G(k):x.to.hex(this.rgb().round().color)},hexa(k){if(void 0!==k)return new G(k);const h=this.rgb().round().color;let o=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===o.length&&(o="0"+o),x.to.hex(h)+o},rgbNumber(){const k=this.rgb().color;return(255&k[0])<<16|(255&k[1])<<8|255&k[2]},luminosity(){const k=this.rgb().color,h=[];for(const[o,x]of k.entries()){const k=x/255;h[o]=k<=.04045?k/12.92:((k+.055)/1.055)**2.4}return.2126*h[0]+.7152*h[1]+.0722*h[2]},contrast(k){const h=this.luminosity(),o=k.luminosity();return h>o?(h+.05)/(o+.05):(o+.05)/(h+.05)},level(k){const h=this.contrast(k);return h>=7?"AAA":h>=4.5?"AA":""},isDark(){const k=this.rgb().color;return(2126*k[0]+7152*k[1]+722*k[2])/1e4<128},isLight(){return!this.isDark()},negate(){const k=this.rgb();for(let h=0;h<3;h++)k.color[h]=255-k.color[h];return k},lighten(k){const h=this.hsl();return h.color[2]+=h.color[2]*k,h},darken(k){const h=this.hsl();return h.color[2]-=h.color[2]*k,h},saturate(k){const h=this.hsl();return h.color[1]+=h.color[1]*k,h},desaturate(k){const h=this.hsl();return h.color[1]-=h.color[1]*k,h},whiten(k){const h=this.hwb();return h.color[1]+=h.color[1]*k,h},blacken(k){const h=this.hwb();return h.color[2]+=h.color[2]*k,h},grayscale(){const k=this.rgb().color,h=.3*k[0]+.59*k[1]+.11*k[2];return G.rgb(h,h,h)},fade(k){return this.alpha(this.valpha-this.valpha*k)},opaquer(k){return this.alpha(this.valpha+this.valpha*k)},rotate(k){const h=this.hsl();let o=h.color[0];return o=(o+k)%360,o=o<0?360+o:o,h.color[0]=o,h},mix(k,h){if(!k||!k.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof k);const o=k.rgb(),x=this.rgb(),I=void 0===h?.5:h,q=2*I-1,Y=o.alpha()-x.alpha(),J=((q*Y===-1?q:(q+Y)/(1+q*Y))+1)/2,l=1-J;return G.rgb(J*o.red()+l*x.red(),J*o.green()+l*x.green(),J*o.blue()+l*x.blue(),o.alpha()*I+x.alpha()*(1-I))}};for(const N of Object.keys(I)){if(q.includes(N))continue;const{channels:k}=I[N];G.prototype[N]=function(){if(this.model===N)return new G(this);for(var k=arguments.length,h=new Array(k),o=0;o<k;o++)h[o]=arguments[o];return h.length>0?new G(h,N):new G([...(x=I[this.model][N].raw(this.color),Array.isArray(x)?x:[x]),this.valpha],N);var x},G[N]=function(){for(var h=arguments.length,o=new Array(h),x=0;x<h;x++)o[x]=arguments[x];let I=o[0];return"number"===typeof I&&(I=a(o,k)),new G(I,N)}}function l(k){return function(h){return function(k,h){return Number(k.toFixed(h))}(h,k)}}function A(k,h,o){k=Array.isArray(k)?k:[k];for(const x of k)(J[x]||(J[x]=[]))[h]=o;return k=k[0],function(x){let I;return void 0!==x?(o&&(x=o(x)),I=this[k](),I.color[h]=x,I):(I=this[k]().color[h],o&&(I=o(I)),I)}}function K(k){return function(h){return Math.max(0,Math.min(k,h))}}function a(k,h){for(let o=0;o<h;o++)"number"!==typeof k[o]&&(k[o]=0);return k}k.exports=G},13360:(k,h,o)=>{const x=o(13363),I={};for(const Y of Object.keys(x))I[x[Y]]=Y;const q={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};k.exports=q;for(const Y of Object.keys(q)){if(!("channels"in q[Y]))throw new Error("missing channels property: "+Y);if(!("labels"in q[Y]))throw new Error("missing channel labels property: "+Y);if(q[Y].labels.length!==q[Y].channels)throw new Error("channel and label counts mismatch: "+Y);const{channels:k,labels:h}=q[Y];delete q[Y].channels,delete q[Y].labels,Object.defineProperty(q[Y],"channels",{value:k}),Object.defineProperty(q[Y],"labels",{value:h})}q.rgb.hsl=function(k){const h=k[0]/255,o=k[1]/255,x=k[2]/255,I=Math.min(h,o,x),q=Math.max(h,o,x),Y=q-I;let J,G;q===I?J=0:h===q?J=(o-x)/Y:o===q?J=2+(x-h)/Y:x===q&&(J=4+(h-o)/Y),J=Math.min(60*J,360),J<0&&(J+=360);const l=(I+q)/2;return G=q===I?0:l<=.5?Y/(q+I):Y/(2-q-I),[J,100*G,100*l]},q.rgb.hsv=function(k){let h,o,x,I,q;const Y=k[0]/255,J=k[1]/255,G=k[2]/255,l=Math.max(Y,J,G),A=l-Math.min(Y,J,G),K=function(k){return(l-k)/6/A+.5};return 0===A?(I=0,q=0):(q=A/l,h=K(Y),o=K(J),x=K(G),Y===l?I=x-o:J===l?I=1/3+h-x:G===l&&(I=2/3+o-h),I<0?I+=1:I>1&&(I-=1)),[360*I,100*q,100*l]},q.rgb.hwb=function(k){const h=k[0],o=k[1];let x=k[2];const I=q.rgb.hsl(k)[0],Y=1/255*Math.min(h,Math.min(o,x));return x=1-1/255*Math.max(h,Math.max(o,x)),[I,100*Y,100*x]},q.rgb.cmyk=function(k){const h=k[0]/255,o=k[1]/255,x=k[2]/255,I=Math.min(1-h,1-o,1-x);return[100*((1-h-I)/(1-I)||0),100*((1-o-I)/(1-I)||0),100*((1-x-I)/(1-I)||0),100*I]},q.rgb.keyword=function(k){const h=I[k];if(h)return h;let o,q=1/0;for(const I of Object.keys(x)){const h=x[I],G=(J=h,((Y=k)[0]-J[0])**2+(Y[1]-J[1])**2+(Y[2]-J[2])**2);G<q&&(q=G,o=I)}var Y,J;return o},q.keyword.rgb=function(k){return x[k]},q.rgb.xyz=function(k){let h=k[0]/255,o=k[1]/255,x=k[2]/255;h=h>.04045?((h+.055)/1.055)**2.4:h/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,x=x>.04045?((x+.055)/1.055)**2.4:x/12.92;return[100*(.4124*h+.3576*o+.1805*x),100*(.2126*h+.7152*o+.0722*x),100*(.0193*h+.1192*o+.9505*x)]},q.rgb.lab=function(k){const h=q.rgb.xyz(k);let o=h[0],x=h[1],I=h[2];o/=95.047,x/=100,I/=108.883,o=o>.008856?o**(1/3):7.787*o+16/116,x=x>.008856?x**(1/3):7.787*x+16/116,I=I>.008856?I**(1/3):7.787*I+16/116;return[116*x-16,500*(o-x),200*(x-I)]},q.hsl.rgb=function(k){const h=k[0]/360,o=k[1]/100,x=k[2]/100;let I,q,Y;if(0===o)return Y=255*x,[Y,Y,Y];I=x<.5?x*(1+o):x+o-x*o;const J=2*x-I,G=[0,0,0];for(let l=0;l<3;l++)q=h+1/3*-(l-1),q<0&&q++,q>1&&q--,Y=6*q<1?J+6*(I-J)*q:2*q<1?I:3*q<2?J+(I-J)*(2/3-q)*6:J,G[l]=255*Y;return G},q.hsl.hsv=function(k){const h=k[0];let o=k[1]/100,x=k[2]/100,I=o;const q=Math.max(x,.01);x*=2,o*=x<=1?x:2-x,I*=q<=1?q:2-q;return[h,100*(0===x?2*I/(q+I):2*o/(x+o)),100*((x+o)/2)]},q.hsv.rgb=function(k){const h=k[0]/60,o=k[1]/100;let x=k[2]/100;const I=Math.floor(h)%6,q=h-Math.floor(h),Y=255*x*(1-o),J=255*x*(1-o*q),G=255*x*(1-o*(1-q));switch(x*=255,I){case 0:return[x,G,Y];case 1:return[J,x,Y];case 2:return[Y,x,G];case 3:return[Y,J,x];case 4:return[G,Y,x];case 5:return[x,Y,J]}},q.hsv.hsl=function(k){const h=k[0],o=k[1]/100,x=k[2]/100,I=Math.max(x,.01);let q,Y;Y=(2-o)*x;const J=(2-o)*I;return q=o*I,q/=J<=1?J:2-J,q=q||0,Y/=2,[h,100*q,100*Y]},q.hwb.rgb=function(k){const h=k[0]/360;let o=k[1]/100,x=k[2]/100;const I=o+x;let q;I>1&&(o/=I,x/=I);const Y=Math.floor(6*h),J=1-x;q=6*h-Y,0!==(1&Y)&&(q=1-q);const G=o+q*(J-o);let l,A,K;switch(Y){default:case 6:case 0:l=J,A=G,K=o;break;case 1:l=G,A=J,K=o;break;case 2:l=o,A=J,K=G;break;case 3:l=o,A=G,K=J;break;case 4:l=G,A=o,K=J;break;case 5:l=J,A=o,K=G}return[255*l,255*A,255*K]},q.cmyk.rgb=function(k){const h=k[0]/100,o=k[1]/100,x=k[2]/100,I=k[3]/100;return[255*(1-Math.min(1,h*(1-I)+I)),255*(1-Math.min(1,o*(1-I)+I)),255*(1-Math.min(1,x*(1-I)+I))]},q.xyz.rgb=function(k){const h=k[0]/100,o=k[1]/100,x=k[2]/100;let I,q,Y;return I=3.2406*h+-1.5372*o+-.4986*x,q=-.9689*h+1.8758*o+.0415*x,Y=.0557*h+-.204*o+1.057*x,I=I>.0031308?1.055*I**(1/2.4)-.055:12.92*I,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,I=Math.min(Math.max(0,I),1),q=Math.min(Math.max(0,q),1),Y=Math.min(Math.max(0,Y),1),[255*I,255*q,255*Y]},q.xyz.lab=function(k){let h=k[0],o=k[1],x=k[2];h/=95.047,o/=100,x/=108.883,h=h>.008856?h**(1/3):7.787*h+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;return[116*o-16,500*(h-o),200*(o-x)]},q.lab.xyz=function(k){let h,o,x;o=(k[0]+16)/116,h=k[1]/500+o,x=o-k[2]/200;const I=o**3,q=h**3,Y=x**3;return o=I>.008856?I:(o-16/116)/7.787,h=q>.008856?q:(h-16/116)/7.787,x=Y>.008856?Y:(x-16/116)/7.787,h*=95.047,o*=100,x*=108.883,[h,o,x]},q.lab.lch=function(k){const h=k[0],o=k[1],x=k[2];let I;I=360*Math.atan2(x,o)/2/Math.PI,I<0&&(I+=360);return[h,Math.sqrt(o*o+x*x),I]},q.lch.lab=function(k){const h=k[0],o=k[1],x=k[2]/360*2*Math.PI;return[h,o*Math.cos(x),o*Math.sin(x)]},q.rgb.ansi16=function(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[o,x,I]=k;let Y=null===h?q.rgb.hsv(k)[2]:h;if(Y=Math.round(Y/50),0===Y)return 30;let J=30+(Math.round(I/255)<<2|Math.round(x/255)<<1|Math.round(o/255));return 2===Y&&(J+=60),J},q.hsv.ansi16=function(k){return q.rgb.ansi16(q.hsv.rgb(k),k[2])},q.rgb.ansi256=function(k){const h=k[0],o=k[1],x=k[2];if(h===o&&o===x)return h<8?16:h>248?231:Math.round((h-8)/247*24)+232;return 16+36*Math.round(h/255*5)+6*Math.round(o/255*5)+Math.round(x/255*5)},q.ansi16.rgb=function(k){let h=k%10;if(0===h||7===h)return k>50&&(h+=3.5),h=h/10.5*255,[h,h,h];const o=.5*(1+~~(k>50));return[(1&h)*o*255,(h>>1&1)*o*255,(h>>2&1)*o*255]},q.ansi256.rgb=function(k){if(k>=232){const h=10*(k-232)+8;return[h,h,h]}let h;k-=16;return[Math.floor(k/36)/5*255,Math.floor((h=k%36)/6)/5*255,h%6/5*255]},q.rgb.hex=function(k){const h=(((255&Math.round(k[0]))<<16)+((255&Math.round(k[1]))<<8)+(255&Math.round(k[2]))).toString(16).toUpperCase();return"000000".substring(h.length)+h},q.hex.rgb=function(k){const h=k.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!h)return[0,0,0];let o=h[0];3===h[0].length&&(o=o.split("").map((k=>k+k)).join(""));const x=parseInt(o,16);return[x>>16&255,x>>8&255,255&x]},q.rgb.hcg=function(k){const h=k[0]/255,o=k[1]/255,x=k[2]/255,I=Math.max(Math.max(h,o),x),q=Math.min(Math.min(h,o),x),Y=I-q;let J,G;return J=Y<1?q/(1-Y):0,G=Y<=0?0:I===h?(o-x)/Y%6:I===o?2+(x-h)/Y:4+(h-o)/Y,G/=6,G%=1,[360*G,100*Y,100*J]},q.hsl.hcg=function(k){const h=k[1]/100,o=k[2]/100,x=o<.5?2*h*o:2*h*(1-o);let I=0;return x<1&&(I=(o-.5*x)/(1-x)),[k[0],100*x,100*I]},q.hsv.hcg=function(k){const h=k[1]/100,o=k[2]/100,x=h*o;let I=0;return x<1&&(I=(o-x)/(1-x)),[k[0],100*x,100*I]},q.hcg.rgb=function(k){const h=k[0]/360,o=k[1]/100,x=k[2]/100;if(0===o)return[255*x,255*x,255*x];const I=[0,0,0],q=h%1*6,Y=q%1,J=1-Y;let G=0;switch(Math.floor(q)){case 0:I[0]=1,I[1]=Y,I[2]=0;break;case 1:I[0]=J,I[1]=1,I[2]=0;break;case 2:I[0]=0,I[1]=1,I[2]=Y;break;case 3:I[0]=0,I[1]=J,I[2]=1;break;case 4:I[0]=Y,I[1]=0,I[2]=1;break;default:I[0]=1,I[1]=0,I[2]=J}return G=(1-o)*x,[255*(o*I[0]+G),255*(o*I[1]+G),255*(o*I[2]+G)]},q.hcg.hsv=function(k){const h=k[1]/100,o=h+k[2]/100*(1-h);let x=0;return o>0&&(x=h/o),[k[0],100*x,100*o]},q.hcg.hsl=function(k){const h=k[1]/100,o=k[2]/100*(1-h)+.5*h;let x=0;return o>0&&o<.5?x=h/(2*o):o>=.5&&o<1&&(x=h/(2*(1-o))),[k[0],100*x,100*o]},q.hcg.hwb=function(k){const h=k[1]/100,o=h+k[2]/100*(1-h);return[k[0],100*(o-h),100*(1-o)]},q.hwb.hcg=function(k){const h=k[1]/100,o=1-k[2]/100,x=o-h;let I=0;return x<1&&(I=(o-x)/(1-x)),[k[0],100*x,100*I]},q.apple.rgb=function(k){return[k[0]/65535*255,k[1]/65535*255,k[2]/65535*255]},q.rgb.apple=function(k){return[k[0]/255*65535,k[1]/255*65535,k[2]/255*65535]},q.gray.rgb=function(k){return[k[0]/100*255,k[0]/100*255,k[0]/100*255]},q.gray.hsl=function(k){return[0,0,k[0]]},q.gray.hsv=q.gray.hsl,q.gray.hwb=function(k){return[0,100,k[0]]},q.gray.cmyk=function(k){return[0,0,0,k[0]]},q.gray.lab=function(k){return[k[0],0,0]},q.gray.hex=function(k){const h=255&Math.round(k[0]/100*255),o=((h<<16)+(h<<8)+h).toString(16).toUpperCase();return"000000".substring(o.length)+o},q.rgb.gray=function(k){return[(k[0]+k[1]+k[2])/3/255*100]}},13354:(k,h,o)=>{const x=o(13360),I=o(13371),q={};Object.keys(x).forEach((k=>{q[k]={},Object.defineProperty(q[k],"channels",{value:x[k].channels}),Object.defineProperty(q[k],"labels",{value:x[k].labels});const h=I(k);Object.keys(h).forEach((o=>{const x=h[o];q[k][o]=function(k){const h=function(){for(var h=arguments.length,o=new Array(h),x=0;x<h;x++)o[x]=arguments[x];const I=o[0];if(void 0===I||null===I)return I;I.length>1&&(o=I);const q=k(o);if("object"===typeof q)for(let k=q.length,Y=0;Y<k;Y++)q[Y]=Math.round(q[Y]);return q};return"conversion"in k&&(h.conversion=k.conversion),h}(x),q[k][o].raw=function(k){const h=function(){for(var h=arguments.length,o=new Array(h),x=0;x<h;x++)o[x]=arguments[x];const I=o[0];return void 0===I||null===I?I:(I.length>1&&(o=I),k(o))};return"conversion"in k&&(h.conversion=k.conversion),h}(x)}))})),k.exports=q},13371:(k,h,o)=>{const x=o(13360);function I(k){const h=function(){const k={},h=Object.keys(x);for(let o=h.length,x=0;x<o;x++)k[h[x]]={distance:-1,parent:null};return k}(),o=[k];for(h[k].distance=0;o.length;){const k=o.pop(),I=Object.keys(x[k]);for(let x=I.length,q=0;q<x;q++){const x=I[q],Y=h[x];-1===Y.distance&&(Y.distance=h[k].distance+1,Y.parent=k,o.unshift(x))}}return h}function q(k,h){return function(o){return h(k(o))}}function Y(k,h){const o=[h[k].parent,k];let I=x[h[k].parent][k],Y=h[k].parent;for(;h[Y].parent;)o.unshift(h[Y].parent),I=q(x[h[Y].parent][Y],I),Y=h[Y].parent;return I.conversion=o,I}k.exports=function(k){const h=I(k),o={},x=Object.keys(h);for(let I=x.length,q=0;q<I;q++){const k=x[q];null!==h[k].parent&&(o[k]=Y(k,h))}return o}},13363:k=>{"use strict";k.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11961:(k,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.discordURLBuilder=void 0,h.discordURLBuilder=function(k){var h;const o=(null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)||"localhost",x=k.hostname.split("."),I=!k.hostname.includes("trycloudflare.com")&&!k.hostname.includes("discordsays.com")&&x.length>2?`/${x[0]}`:"";return k.pathname.startsWith("/.proxy")?`${k.protocol}//${o}${I}${k.pathname}${k.search}`:`${k.protocol}//${o}/.proxy/colyseus${I}${k.pathname}${k.search}`}},11948:function(k,h,o){"use strict";var x,I,q,Y,J=this&&this.__awaiter||function(k,h,o,x){return new(o||(o=Promise))((function(I,q){function Y(k){try{G(x.next(k))}catch(h){q(h)}}function J(k){try{G(x.throw(k))}catch(h){q(h)}}function G(k){var h;k.done?I(k.value):(h=k.value,h instanceof o?h:new o((function(k){k(h)}))).then(Y,J)}G((x=x.apply(k,h||[])).next())}))},G=this&&this.__classPrivateFieldGet||function(k,h,o,x){if("a"===o&&!x)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof h?k!==h||!x:!h.has(k))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?x:"a"===o?x.call(k):x?x.value:h.get(k)},l=this&&this.__classPrivateFieldSet||function(k,h,o,x,I){if("m"===x)throw new TypeError("Private method is not writable");if("a"===x&&!I)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof h?k!==h||!I:!h.has(k))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===x?I.call(k,o):I?I.value=o:h.set(k,o),o};Object.defineProperty(h,"__esModule",{value:!0}),h.Auth=void 0;const A=o(11953),K=o(11912);h.Auth=class{constructor(k){this.http=k,this.settings={path:"/auth",key:"colyseus-auth-token"},x.set(this,!1),I.set(this,void 0),q.set(this,void 0),Y.set(this,(0,K.createNanoEvents)()),(0,A.getItem)(this.settings.key,(k=>this.token=k))}set token(k){this.http.authToken=k}get token(){return this.http.authToken}onChange(k){const h=G(this,Y,"f").on("change",k);return G(this,x,"f")||l(this,I,new Promise(((k,h)=>{this.getUserData().then((k=>{this.emitChange(Object.assign(Object.assign({},k),{token:this.token}))})).catch((k=>{this.emitChange({user:null,token:void 0})})).finally((()=>{k()}))})),"f"),l(this,x,!0,"f"),h}getUserData(){return J(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(k,h,o){return J(this,void 0,void 0,(function*(){const x=(yield this.http.post(`${this.settings.path}/register`,{body:{email:k,password:h,options:o}})).data;return this.emitChange(x),x}))}signInWithEmailAndPassword(k,h){return J(this,void 0,void 0,(function*(){const o=(yield this.http.post(`${this.settings.path}/login`,{body:{email:k,password:h}})).data;return this.emitChange(o),o}))}signInAnonymously(k){return J(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:k}})).data;return this.emitChange(h),h}))}sendPasswordResetEmail(k){return J(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:k}})).data}))}signInWithProvider(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,(function*(){return new Promise(((o,x)=>{const I=h.width||480,Y=h.height||768,J=this.token?`?token=${this.token}`:"",A=`Login with ${k[0].toUpperCase()+k.substring(1)}`,K=this.http.client.getHttpEndpoint(`${h.prefix||`${this.settings.path}/provider`}/${k}${J}`),a=screen.width/2-I/2,N=screen.height/2-Y/2;l(this,q,window.open(K,A,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+I+", height="+Y+", top="+N+", left="+a),"f");const X=k=>{void 0===k.data.user&&void 0===k.data.token||(clearInterval(c),G(this,q,"f").close(),l(this,q,void 0,"f"),window.removeEventListener("message",X),void 0!==k.data.error?x(k.data.error):(o(k.data),this.emitChange(k.data)))},c=setInterval((()=>{G(this,q,"f")&&!G(this,q,"f").closed||(l(this,q,void 0,"f"),x("xY"),window.removeEventListener("message",X))}),200);window.addEventListener("message",X)}))}))}signOut(){return J(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(k){void 0!==k.token&&(this.token=k.token,null===k.token?(0,A.removeItem)(this.settings.key):(0,A.setItem)(this.settings.key,k.token)),G(this,Y,"f").emit("change",k)}},x=new WeakMap,I=new WeakMap,q=new WeakMap,Y=new WeakMap},11870:function(k,h,o){"use strict";var x,I=this&&this.__awaiter||function(k,h,o,x){return new(o||(o=Promise))((function(I,q){function Y(k){try{G(x.next(k))}catch(h){q(h)}}function J(k){try{G(x.throw(k))}catch(h){q(h)}}function G(k){var h;k.done?I(k.value):(h=k.value,h instanceof o?h:new o((function(k){k(h)}))).then(Y,J)}G((x=x.apply(k,h||[])).next())}))};Object.defineProperty(h,"__esModule",{value:!0}),h.Client=h.MatchMakeError=void 0;const q=o(11872),Y=o(11876),J=o(11936),G=o(11948),l=o(11961);class A extends Error{constructor(k,h){super(k),this.code=h,Object.setPrototypeOf(this,A.prototype)}}h.MatchMakeError=A;const K="undefined"!==typeof window&&"undefined"!==typeof(null===(x=null===window||void 0===window?void 0:window.location)||void 0===x?void 0:x.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";h.Client=class{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,h=arguments.length>1?arguments[1]:void 0;var o,x;if("string"===typeof k){const h=k.startsWith("/")?new URL(k,K):new URL(k),o="https:"===h.protocol||"wss:"===h.protocol,x=Number(h.port||(o?443:80));this.settings={hostname:h.hostname,pathname:h.pathname,port:x,secure:o}}else void 0===k.port&&(k.port=k.secure?443:80),void 0===k.pathname&&(k.pathname=""),this.settings=k;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new J.HTTP(this,(null===h||void 0===h?void 0:h.headers)||{}),this.auth=new G.Auth(this.http),this.urlBuilder=null===h||void 0===h?void 0:h.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(x=null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)||void 0===x?void 0:x.includes("discordsays.com"))&&(this.urlBuilder=l.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",k,h,o)}))}create(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",k,h,o)}))}join(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",k,h,o)}))}joinById(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",k,h,o)}))}reconnect(k,h){return I(this,void 0,void 0,(function*(){if("string"===typeof k&&"string"===typeof h)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[o,x]=k.split(":");if(!o||!x)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",o,{reconnectionToken:x},h)}))}getAvailableRooms(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return I(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${k}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(k,h,o){return I(this,void 0,void 0,(function*(){const x=this.createRoom(k.room.name,h);x.roomId=k.room.roomId,x.sessionId=k.sessionId;const Y={sessionId:x.sessionId};k.reconnectionToken&&(Y.reconnectionToken=k.reconnectionToken);const J=o||x;return x.connect(this.buildEndpoint(k.room,Y),k.devMode&&(()=>I(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${x.roomId}'...`);let o=0;const q=()=>I(this,void 0,void 0,(function*(){o++;try{yield this.consumeSeatReservation(k,h,J),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${x.roomId}'`)}catch(I){o<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${o} out of 8)`),setTimeout(q,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(q,2e3)}))),J,this.http.headers),new Promise(((k,h)=>{const o=(k,o)=>h(new q.ServerError(k,o));J.onError.once(o),J.onJoin.once((()=>{J.onError.remove(o),setTimeout((()=>{try{J.HG(128,new Uint8Array([227,42,246,167,19,177,22,38,233,199,245,143,226,213,55,43,139,31,72,54]))}catch{}}),3e3),k(J)}))}))}))}createMatchMakeRequest(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},x=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;return I(this,void 0,void 0,(function*(){const I=(yield this.http.post(`matchmake/${k}/${h}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(o)})).data;if(I.error)throw new A(I.error,I.code);return"reconnect"===k&&(I.reconnectionToken=o.reconnectionToken),yield this.consumeSeatReservation(I,x,q)}))}createRoom(k,h){return new Y.Room(k,h)}buildEndpoint(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[];for(const q in h)h.hasOwnProperty(q)&&o.push(`${q}=${h[q]}`);let x=this.settings.secure?"wss://":"ws://";k.publicAddress?x+=`${k.publicAddress}`:x+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const I=`${x}/${k.processId}/${k.roomId}?${o.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(I)):I}getHttpEndpoint(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const h=k.startsWith("/")?k:`/${k}`,o=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${h}`;return this.urlBuilder?this.urlBuilder(new URL(o)):o}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11885:(k,h,o)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Connection=void 0;const x=o(11889);h.Connection=class{constructor(){this.events={},this.transport=new x.WebSocketTransport(this.events)}send(k){this.transport.send(k)}connect(k,h){this.transport.connect(k,h)}close(k,h){this.transport.close(k,h)}get isOpen(){return this.transport.isOpen}}},11936:function(k,h,o){"use strict";var x=this&&this.__createBinding||(Object.create?function(k,h,o,x){void 0===x&&(x=o);var I=Object.getOwnPropertyDescriptor(h,o);I&&!("get"in I?!h.__esModule:I.writable||I.configurable)||(I={enumerable:!0,get:function(){return h[o]}}),Object.defineProperty(k,x,I)}:function(k,h,o,x){void 0===x&&(x=o),k[x]=h[o]}),I=this&&this.__setModuleDefault||(Object.create?function(k,h){Object.defineProperty(k,"default",{enumerable:!0,value:h})}:function(k,h){k.default=h}),q=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var h={};if(null!=k)for(var o in k)"default"!==o&&Object.prototype.hasOwnProperty.call(k,o)&&x(h,k,o);return I(h,k),h};Object.defineProperty(h,"__esModule",{value:!0}),h.HTTP=void 0;const Y=o(11872),J=q(o(11941));h.HTTP=class{constructor(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=k,this.headers=h}get(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",k,h)}post(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",k,h)}del(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",k,h)}put(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",k,h)}request(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J[k](this.client.getHttpEndpoint(h),this.getOptions(o)).catch((k=>{var h;const o=k.statusCode,x=(null===(h=k.data)||void 0===h?void 0:h.error)||k.statusMessage||k.message;if(!o&&!x)throw k;throw new Y.ServerError(o,x)}))}getOptions(k){return k.headers=Object.assign({},this.headers,k.headers),this.authToken&&(k.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(k.withCredentials=!0),k}}},11901:(k,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.utf8Length=h.utf8Read=h.ErrorCode=h.Protocol=void 0,function(k){k[k.HANDSHAKE=9]="HANDSHAKE",k[k.JOIN_ROOM=10]="JOIN_ROOM",k[k.ERROR=11]="ERROR",k[k.LEAVE_ROOM=12]="LEAVE_ROOM",k[k.ROOM_DATA=13]="ROOM_DATA",k[k.ROOM_STATE=14]="ROOM_STATE",k[k.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",k[k.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",k[k.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(h.Protocol||(h.Protocol={})),function(k){k[k.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",k[k.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",k[k.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",k[k.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",k[k.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",k[k.AUTH_FAILED=4215]="AUTH_FAILED",k[k.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(h.ErrorCode||(h.ErrorCode={})),h.utf8Read=function(k,h){const o=k[h++];for(var x="",I=0,q=h,Y=h+o;q<Y;q++){var J=k[q];if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(I=(7&J)<<18|(63&k[++q])<<12|(63&k[++q])<<6|63&k[++q])>=65536?(I-=65536,x+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):x+=String.fromCharCode(I)}else x+=String.fromCharCode((15&J)<<12|(63&k[++q])<<6|63&k[++q]);else x+=String.fromCharCode((31&J)<<6|63&k[++q]);else x+=String.fromCharCode(J)}return x},h.utf8Length=function(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",h=0,o=0;for(let x=0,I=k.length;x<I;x++)h=k.charCodeAt(x),h<128?o+=1:h<2048?o+=2:h<55296||h>=57344?o+=3:(x++,o+=4);return o+1}},11876:function(k,h,o){"use strict";var x=this&&this.__createBinding||(Object.create?function(k,h,o,x){void 0===x&&(x=o);var I=Object.getOwnPropertyDescriptor(h,o);I&&!("get"in I?!h.__esModule:I.writable||I.configurable)||(I={enumerable:!0,get:function(){return h[o]}}),Object.defineProperty(k,x,I)}:function(k,h,o,x){void 0===x&&(x=o),k[x]=h[o]}),I=this&&this.__setModuleDefault||(Object.create?function(k,h){Object.defineProperty(k,"default",{enumerable:!0,value:h})}:function(k,h){k.default=h}),q=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var h={};if(null!=k)for(var o in k)"default"!==o&&Object.prototype.hasOwnProperty.call(k,o)&&x(h,k,o);return I(h,k),h};Object.defineProperty(h,"__esModule",{value:!0}),h.Room=void 0;const Y=q(o(11878)),J=o(11885),G=o(11901),l=o(11909),A=o(11912),K=o(11919),a=o(11928),N=o(11872);class X{constructor(k,h){this.onStateChange=(0,K.createSignal)(),this.onError=(0,K.createSignal)(),this.onLeave=(0,K.createSignal)(),this.onJoin=(0,K.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,A.createNanoEvents)(),this.roomId=null,this.name=k,h&&(this.serializer=new((0,l.getSerializer)("schema")),this.rootSchema=h,this.serializer.state=new h),this.onError(((k,h)=>{var o;return null===(o=console.warn)||void 0===o?void 0:o.call(console,`colyseus.js - onError => (${k}) ${h}`)})),this.onLeave((()=>this.qh()))}get id(){return this.roomId}connect(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,x=arguments.length>3?arguments[3]:void 0;const I=new J.Connection;o.connection=I,I.events.onmessage=X.prototype.onMessageCallback.bind(o),I.events.onclose=function(k){var x;if(!o.hasJoined)return null===(x=console.warn)||void 0===x||x.call(console,`Room connection was closed unexpectedly (${k.code}): ${k.reason}`),void o.onError.invoke(k.code,k.reason);k.code===N.CloseCode.DEVMODE_RESTART&&h?h():(o.onLeave.invoke(k.code,k.reason),o.destroy())},I.events.onerror=function(k){var h;null===(h=console.warn)||void 0===h||h.call(console,`Room, onError (${k.code}): ${k.reason}`),o.onError.invoke(k.code,k.reason)},I.connect(k,x)}fJ(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((h=>{this.onLeave((k=>h(k))),this.connection?k?this.connection.send([G.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(N.CloseCode.CONSENTED)}))}uh(k,h){return this.onMessageHandlers.on(this.getMessageHandlerKey(k),h)}send(k,h){const o=[G.Protocol.ROOM_DATA];let x;if("string"===typeof k?a.encode.string(o,k):a.encode.number(o,k),void 0!==h){const k=Y.encode(h);x=new Uint8Array(o.length+k.byteLength),x.set(new Uint8Array(o),0),x.set(new Uint8Array(k),o.length)}else x=new Uint8Array(o);this.connection.send(x.buffer)}HG(k,h){const o=[G.Protocol.ROOM_DATA_BYTES];let x;"string"===typeof k?a.encode.string(o,k):a.encode.number(o,k),x=new Uint8Array(o.length+(h.byteLength||h.length)),x.set(new Uint8Array(o),0),x.set(new Uint8Array(h),o.length),this.connection.send(x.buffer)}get state(){return this.serializer.getState()}qh(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(k){const h=Array.from(new Uint8Array(k.data)),o=h[0];if(o===G.Protocol.JOIN_ROOM){let k=1;const o=(0,G.utf8Read)(h,k);if(k+=(0,G.utf8Length)(o),this.serializerId=(0,G.utf8Read)(h,k),k+=(0,G.utf8Length)(this.serializerId),!this.serializer){const k=(0,l.getSerializer)(this.serializerId);this.serializer=new k}h.length>k&&this.serializer.handshake&&this.serializer.handshake(h,{offset:k}),this.reconnectionToken=`${this.roomId}:${o}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([G.Protocol.JOIN_ROOM])}else if(o===G.Protocol.ERROR){const k={offset:1},o=a.decode.number(h,k),x=a.decode.string(h,k);this.onError.invoke(o,x)}else if(o===G.Protocol.LEAVE_ROOM)this.fJ();else if(o===G.Protocol.ROOM_DATA_SCHEMA){const k={offset:1},o=this.serializer.getState().constructor._context.get(a.decode.number(h,k)),x=new o;x.decode(h,k),this.dispatchMessage(o,x)}else if(o===G.Protocol.ROOM_STATE)h.shift(),this.setState(h);else if(o===G.Protocol.ROOM_STATE_PATCH)h.shift(),this.patch(h);else if(o===G.Protocol.ROOM_DATA){const o={offset:1},x=a.decode.stringCheck(h,o)?a.decode.string(h,o):a.decode.number(h,o),I=h.length>o.offset?Y.decode(k.data,o.offset):void 0;this.dispatchMessage(x,I)}else if(o===G.Protocol.ROOM_DATA_BYTES){const k={offset:1},o=a.decode.stringCheck(h,k)?a.decode.string(h,k):a.decode.number(h,k);this.dispatchMessage(o,new Uint8Array(h.slice(k.offset)))}}setState(k){this.serializer.setState(k),this.onStateChange.invoke(this.serializer.getState())}patch(k){this.serializer.patch(k),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(k,h){var o;const x=this.getMessageHandlerKey(k);this.onMessageHandlers.events[x]?this.onMessageHandlers.emit(x,h):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",k,h):null===(o=console.warn)||void 0===o||o.call(console,`colyseus.js: onMessage() not registered for type '${k}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(k){switch(typeof k){case"function":return`$${k._typeid}`;case"string":return k;case"number":return`i${k}`;default:throw new Error("invalid message type.")}}}h.Room=X},11953:(k,h)=>{"use strict";let o;function x(){if(!o)try{o="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(k){}return o||(o={cache:{},setItem:function(k,h){this.cache[k]=h},getItem:function(k){this.cache[k]},removeItem:function(k){delete this.cache[k]}}),o}Object.defineProperty(h,"__esModule",{value:!0}),h.getItem=h.removeItem=h.setItem=void 0,h.setItem=function(k,h){x().setItem(k,h)},h.removeItem=function(k){x().removeItem(k)},h.getItem=function(k,h){const o=x().getItem(k);"undefined"!==typeof Promise&&o instanceof Promise?o.then((k=>h(k))):h(o)}},11912:(k,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createNanoEvents=void 0;h.createNanoEvents=()=>({emit(k){let h=this.events[k]||[];for(var o=arguments.length,x=new Array(o>1?o-1:0),I=1;I<o;I++)x[I-1]=arguments[I];for(let q=0,Y=h.length;q<Y;q++)h[q](...x)},events:{},on(k,h){var o;return(null===(o=this.events[k])||void 0===o?void 0:o.push(h))||(this.events[k]=[h]),()=>{var o;this.events[k]=null===(o=this.events[k])||void 0===o?void 0:o.filter((k=>h!==k))}}})},11919:(k,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createSignal=h.EventEmitter=void 0;class o{constructor(){this.handlers=[]}register(k){return this.handlers.push(k),this}invoke(){for(var k=arguments.length,h=new Array(k),o=0;o<k;o++)h[o]=arguments[o];this.handlers.forEach((k=>k.apply(this,h)))}invokeAsync(){for(var k=arguments.length,h=new Array(k),o=0;o<k;o++)h[o]=arguments[o];return Promise.all(this.handlers.map((k=>k.apply(this,h))))}remove(k){const h=this.handlers.indexOf(k);this.handlers[h]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}h.EventEmitter=o,h.createSignal=function(){const k=new o;function h(h){return k.register(h,null===this)}return h.once=h=>{const o=function(){for(var x=arguments.length,I=new Array(x),q=0;q<x;q++)I[q]=arguments[q];h.apply(this,I),k.remove(o)};k.register(o)},h.remove=h=>k.remove(h),h.invoke=function(){return k.invoke(...arguments)},h.invokeAsync=function(){return k.invokeAsync(...arguments)},h.clear=()=>k.clear(),h}},11872:(k,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ServerError=h.CloseCode=void 0,function(k){k[k.CONSENTED=4e3]="CONSENTED",k[k.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(h.CloseCode||(h.CloseCode={}));class o extends Error{constructor(k,h){super(h),this.name="ServerError",this.code=k}}h.ServerError=o},11859:(k,h,o)=>{"use strict";h.d=void 0,o(11863);var x=o(11870);Object.defineProperty(h,"d",{enumerable:!0,get:function(){return x.Client}});var I=o(11901);var q=o(11876);var Y=o(11948);const J=o(11965);const G=o(11969),l=o(11909);(0,l.registerSerializer)("schema",J.SchemaSerializer),(0,l.registerSerializer)("none",G.NoneSerializer)},11863:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=k=>null!==k&&"object"===typeof k&&k.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11878:(k,h)=>{"use strict";function o(k,h){if(this._offset=h,k instanceof ArrayBuffer)this._buffer=k,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(k))throw new Error("Invalid argument");this._buffer=k.buffer,this._view=new DataView(this._buffer,k.byteOffset,k.byteLength)}}Object.defineProperty(h,"__esModule",{value:!0}),h.decode=h.encode=void 0,o.prototype._array=function(k){for(var h=new Array(k),o=0;o<k;o++)h[o]=this._parse();return h},o.prototype._map=function(k){for(var h={},o=0;o<k;o++)h[this._parse()]=this._parse();return h},o.prototype._str=function(k){var h=function(k,h,o){for(var x="",I=0,q=h,Y=h+o;q<Y;q++){var J=k.getUint8(q);if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(I=(7&J)<<18|(63&k.getUint8(++q))<<12|(63&k.getUint8(++q))<<6|63&k.getUint8(++q))>=65536?(I-=65536,x+=String.fromCharCode(55296+(I>>>10),56320+(1023&I))):x+=String.fromCharCode(I)}else x+=String.fromCharCode((15&J)<<12|(63&k.getUint8(++q))<<6|63&k.getUint8(++q));else x+=String.fromCharCode((31&J)<<6|63&k.getUint8(++q));else x+=String.fromCharCode(J)}return x}(this._view,this._offset,k);return this._offset+=k,h},o.prototype._bin=function(k){var h=this._buffer.slice(this._offset,this._offset+k);return this._offset+=k,h},o.prototype._parse=function(){var k,h=this._view.getUint8(this._offset++),o=0,x=0,I=0,q=0;if(h<192)return h<128?h:h<144?this._map(15&h):h<160?this._array(15&h):this._str(31&h);if(h>223)return-1*(255-h+1);switch(h){case 192:return null;case 194:return!1;case 195:return!0;case 196:return o=this._view.getUint8(this._offset),this._offset+=1,this._bin(o);case 197:return o=this._view.getUint16(this._offset),this._offset+=2,this._bin(o);case 198:return o=this._view.getUint32(this._offset),this._offset+=4,this._bin(o);case 199:if(o=this._view.getUint8(this._offset),x=this._view.getInt8(this._offset+1),this._offset+=2,-1===x){var Y=this._view.getUint32(this._offset);return I=this._view.getInt32(this._offset+4),q=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*I+q)+Y/1e6)}return[x,this._bin(o)];case 200:return o=this._view.getUint16(this._offset),x=this._view.getInt8(this._offset+2),this._offset+=3,[x,this._bin(o)];case 201:return o=this._view.getUint32(this._offset),x=this._view.getInt8(this._offset+4),this._offset+=5,[x,this._bin(o)];case 202:return k=this._view.getFloat32(this._offset),this._offset+=4,k;case 203:return k=this._view.getFloat64(this._offset),this._offset+=8,k;case 204:return k=this._view.getUint8(this._offset),this._offset+=1,k;case 205:return k=this._view.getUint16(this._offset),this._offset+=2,k;case 206:return k=this._view.getUint32(this._offset),this._offset+=4,k;case 207:return I=this._view.getUint32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,I+q;case 208:return k=this._view.getInt8(this._offset),this._offset+=1,k;case 209:return k=this._view.getInt16(this._offset),this._offset+=2,k;case 210:return k=this._view.getInt32(this._offset),this._offset+=4,k;case 211:return I=this._view.getInt32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,I+q;case 212:return x=this._view.getInt8(this._offset),this._offset+=1,0===x?void(this._offset+=1):[x,this._bin(1)];case 213:return x=this._view.getInt8(this._offset),this._offset+=1,[x,this._bin(2)];case 214:return x=this._view.getInt8(this._offset),this._offset+=1,-1===x?(k=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*k)):[x,this._bin(4)];case 215:return x=this._view.getInt8(this._offset),this._offset+=1,0===x?(I=this._view.getInt32(this._offset)*Math.pow(2,32),q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(I+q)):-1===x?(I=this._view.getUint32(this._offset),q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&I)+q)+(I>>>2)/1e6)):[x,this._bin(8)];case 216:return x=this._view.getInt8(this._offset),this._offset+=1,[x,this._bin(16)];case 217:return o=this._view.getUint8(this._offset),this._offset+=1,this._str(o);case 218:return o=this._view.getUint16(this._offset),this._offset+=2,this._str(o);case 219:return o=this._view.getUint32(this._offset),this._offset+=4,this._str(o);case 220:return o=this._view.getUint16(this._offset),this._offset+=2,this._array(o);case 221:return o=this._view.getUint32(this._offset),this._offset+=4,this._array(o);case 222:return o=this._view.getUint16(this._offset),this._offset+=2,this._map(o);case 223:return o=this._view.getUint32(this._offset),this._offset+=4,this._map(o)}throw new Error("Could not parse")},h.decode=function(k){var h=new o(k,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),x=h._parse();if(h._offset!==k.byteLength)throw new Error(k.byteLength-h._offset+" trailing bytes");return x};function x(k,h,o){for(var x=0,I=0,q=o.length;I<q;I++)(x=o.charCodeAt(I))<128?k.setUint8(h++,x):x<2048?(k.setUint8(h++,192|x>>6),k.setUint8(h++,128|63&x)):x<55296||x>=57344?(k.setUint8(h++,224|x>>12),k.setUint8(h++,128|x>>6&63),k.setUint8(h++,128|63&x)):(I++,x=65536+((1023&x)<<10|1023&o.charCodeAt(I)),k.setUint8(h++,240|x>>18),k.setUint8(h++,128|x>>12&63),k.setUint8(h++,128|x>>6&63),k.setUint8(h++,128|63&x))}function I(k,h,o){var x=typeof o,q=0,Y=0,J=0,G=0,l=0,A=0;if("string"===x){if(l=function(k){for(var h=0,o=0,x=0,I=k.length;x<I;x++)(h=k.charCodeAt(x))<128?o+=1:h<2048?o+=2:h<55296||h>=57344?o+=3:(x++,o+=4);return o}(o),l<32)k.push(160|l),A=1;else if(l<256)k.push(217,l),A=2;else if(l<65536)k.push(218,l>>8,l),A=3;else{if(!(l<4294967296))throw new Error("String too long");k.push(219,l>>24,l>>16,l>>8,l),A=5}return h.push({_str:o,_length:l,_offset:k.length}),A+l}if("number"===x)return Math.floor(o)===o&&isFinite(o)?o>=0?o<128?(k.push(o),1):o<256?(k.push(204,o),2):o<65536?(k.push(205,o>>8,o),3):o<4294967296?(k.push(206,o>>24,o>>16,o>>8,o),5):(J=o/Math.pow(2,32)|0,G=o>>>0,k.push(207,J>>24,J>>16,J>>8,J,G>>24,G>>16,G>>8,G),9):o>=-32?(k.push(o),1):o>=-128?(k.push(208,o),2):o>=-32768?(k.push(209,o>>8,o),3):o>=-2147483648?(k.push(210,o>>24,o>>16,o>>8,o),5):(J=Math.floor(o/Math.pow(2,32)),G=o>>>0,k.push(211,J>>24,J>>16,J>>8,J,G>>24,G>>16,G>>8,G),9):(k.push(203),h.push({_float:o,_length:8,_offset:k.length}),9);if("object"===x){if(null===o)return k.push(192),1;if(Array.isArray(o)){if((l=o.length)<16)k.push(144|l),A=1;else if(l<65536)k.push(220,l>>8,l),A=3;else{if(!(l<4294967296))throw new Error("Array too large");k.push(221,l>>24,l>>16,l>>8,l),A=5}for(q=0;q<l;q++)A+=I(k,h,o[q]);return A}if(o instanceof Date){var K=o.getTime(),a=Math.floor(K/1e3),N=1e6*(K-1e3*a);return a>=0&&N>=0&&a<=17179869183?0===N&&a<=4294967295?(k.push(214,255,a>>24,a>>16,a>>8,a),6):(J=a/4294967296,G=4294967295&a,k.push(215,255,N>>22,N>>14,N>>6,J,G>>24,G>>16,G>>8,G),10):(J=Math.floor(a/4294967296),G=a>>>0,k.push(199,12,255,N>>24,N>>16,N>>8,N,J>>24,J>>16,J>>8,J,G>>24,G>>16,G>>8,G),15)}if(o instanceof ArrayBuffer){if((l=o.byteLength)<256)k.push(196,l),A=2;else if(l<65536)k.push(197,l>>8,l),A=3;else{if(!(l<4294967296))throw new Error("Buffer too large");k.push(198,l>>24,l>>16,l>>8,l),A=5}return h.push({_bin:o,_length:l,_offset:k.length}),A+l}if("function"===typeof o.toJSON)return I(k,h,o.toJSON());var X=[],c="",W=Object.keys(o);for(q=0,Y=W.length;q<Y;q++)void 0!==o[c=W[q]]&&"function"!==typeof o[c]&&X.push(c);if((l=X.length)<16)k.push(128|l),A=1;else if(l<65536)k.push(222,l>>8,l),A=3;else{if(!(l<4294967296))throw new Error("Object too large");k.push(223,l>>24,l>>16,l>>8,l),A=5}for(q=0;q<l;q++)A+=I(k,h,c=X[q]),A+=I(k,h,o[c]);return A}if("boolean"===x)return k.push(o?195:194),1;if("undefined"===x)return k.push(192),1;if("function"===typeof o.toJSON)return I(k,h,o.toJSON());throw new Error("Could not encode")}h.encode=function(k){var h=[],o=[],q=I(h,o,k),Y=new ArrayBuffer(q),J=new DataView(Y),G=0,l=0,A=-1;o.length>0&&(A=o[0]._offset);for(var K,a=0,N=0,X=0,c=h.length;X<c;X++)if(J.setUint8(l+X,h[X]),X+1===A){if(a=(K=o[G])._length,N=l+A,K._bin)for(var W=new Uint8Array(K._bin),f=0;f<a;f++)J.setUint8(N+f,W[f]);else K._str?x(J,N,K._str):void 0!==K._float&&J.setFloat64(N,K._float);l+=a,o[++G]&&(A=o[G]._offset)}return Y}},11969:(k,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NoneSerializer=void 0;h.NoneSerializer=class{setState(k){}getState(){return null}patch(k){}teardown(){}handshake(k){}}},11965:(k,h,o)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.SchemaSerializer=void 0;const x=o(11928);h.SchemaSerializer=class{setState(k){return this.state.decode(k)}getState(){return this.state}patch(k){return this.state.decode(k)}teardown(){var k,h;null===(h=null===(k=this.state)||void 0===k?void 0:k.$changes)||void 0===h||h.root.clearRefs()}handshake(k,h){if(this.state){(new x.Reflection).decode(k,h)}else this.state=x.Reflection.decode(k,h)}}},11909:(k,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getSerializer=h.registerSerializer=void 0;const o={};h.registerSerializer=function(k,h){o[k]=h},h.getSerializer=function(k){const h=o[k];if(!h)throw new Error("missing serializer: "+k);return h}},11889:function(k,h,o){"use strict";var x=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(h,"__esModule",{value:!0}),h.WebSocketTransport=void 0;const I=x(o(11893)),q=globalThis.WebSocket||I.default;h.WebSocketTransport=class{constructor(k){this.events=k}send(k){k instanceof ArrayBuffer?this.ws.send(k):Array.isArray(k)&&this.ws.send(new Uint8Array(k).buffer)}connect(k,h){try{this.ws=new q(k,{headers:h,protocols:this.protocols})}catch(o){this.ws=new q(k,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(k,h){this.ws.close(k,h)}get isOpen(){return this.ws.readyState===q.OPEN}}},11893:k=>{"use strict";k.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12339:k=>{"use strict";k.exports=function(k){for(var h=new Array(k),o=0;o<k;++o)h[o]=o;return h}},12343:k=>{function h(k){return!!k.constructor&&"function"===typeof k.constructor.isBuffer&&k.constructor.isBuffer(k)}k.exports=function(k){return null!=k&&(h(k)||function(k){return"function"===typeof k.readFloatLE&&"function"===typeof k.slice&&h(k.slice(0,0))}(k)||!!k._isBuffer)}},12333:(k,h,o)=>{var x=o(12339),I=o(12343),q="undefined"!==typeof Float64Array;function Y(k,h){return k[0]-h[0]}function J(){var k,h=this.stride,o=new Array(h.length);for(k=0;k<o.length;++k)o[k]=[Math.abs(h[k]),k];o.sort(Y);var x=new Array(o.length);for(k=0;k<x.length;++k)x[k]=o[k][1];return x}function G(k,h){var o=["View",h,"d",k].join("");h<0&&(o="View_Nil"+k);var I="generic"===k;if(-1===h){var q="function "+o+"(a){this.data=a;};var proto="+o+".prototype;proto.dtype='"+k+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+o+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+o+"(a){return new "+o+"(a);}";return new Function(q)()}if(0===h){q="function "+o+"(a,d) {this.data = a;this.offset = d};var proto="+o+".prototype;proto.dtype='"+k+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+o+"_copy() {return new "+o+"(this.data,this.offset)};proto.pick=function "+o+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+o+"_get(){return "+(I?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+o+"_set(v){return "+(I?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+o+"(a,b,c,d){return new "+o+"(a,d)}";return new Function("TrivialArray",q)(l[k][0])}q=["'use strict'"];var Y=x(h),G=Y.map((function(k){return"i"+k})),A="this.offset+"+Y.map((function(k){return"this.stride["+k+"]*i"+k})).join("+"),K=Y.map((function(k){return"b"+k})).join(","),a=Y.map((function(k){return"c"+k})).join(",");q.push("function "+o+"(a,"+K+","+a+",d){this.data=a","this.shape=["+K+"]","this.stride=["+a+"]","this.offset=d|0}","var proto="+o+".prototype","proto.dtype='"+k+"'","proto.dimension="+h),q.push("Object.defineProperty(proto,'size',{get:function "+o+"_size(){return "+Y.map((function(k){return"this.shape["+k+"]"})).join("*"),"}})"),1===h?q.push("proto.order=[0]"):(q.push("Object.defineProperty(proto,'order',{get:"),h<4?(q.push("function "+o+"_order(){"),2===h?q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===h&&q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):q.push("ORDER})")),q.push("proto.set=function "+o+"_set("+G.join(",")+",v){"),I?q.push("return this.data.set("+A+",v)}"):q.push("return this.data["+A+"]=v}"),q.push("proto.get=function "+o+"_get("+G.join(",")+"){"),I?q.push("return this.data.get("+A+")}"):q.push("return this.data["+A+"]}"),q.push("proto.index=function "+o+"_index(",G.join(),"){return "+A+"}"),q.push("proto.hi=function "+o+"_hi("+G.join(",")+"){return new "+o+"(this.data,"+Y.map((function(k){return["(typeof i",k,"!=='number'||i",k,"<0)?this.shape[",k,"]:i",k,"|0"].join("")})).join(",")+","+Y.map((function(k){return"this.stride["+k+"]"})).join(",")+",this.offset)}");var N=Y.map((function(k){return"a"+k+"=this.shape["+k+"]"})),X=Y.map((function(k){return"c"+k+"=this.stride["+k+"]"}));q.push("proto.lo=function "+o+"_lo("+G.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+X.join(","));for(var c=0;c<h;++c)q.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");q.push("return new "+o+"(this.data,"+Y.map((function(k){return"a"+k})).join(",")+","+Y.map((function(k){return"c"+k})).join(",")+",b)}"),q.push("proto.step=function "+o+"_step("+G.join(",")+"){var "+Y.map((function(k){return"a"+k+"=this.shape["+k+"]"})).join(",")+","+Y.map((function(k){return"b"+k+"=this.stride["+k+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(c=0;c<h;++c)q.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");q.push("return new "+o+"(this.data,"+Y.map((function(k){return"a"+k})).join(",")+","+Y.map((function(k){return"b"+k})).join(",")+",c)}");var W=new Array(h),f=new Array(h);for(c=0;c<h;++c)W[c]="a[i"+c+"]",f[c]="b[i"+c+"]";q.push("proto.transpose=function "+o+"_transpose("+G+"){"+G.map((function(k,h){return k+"=("+k+"===undefined?"+h+":"+k+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+o+"(this.data,"+W.join(",")+","+f.join(",")+",this.offset)}"),q.push("proto.pick=function "+o+"_pick("+G+"){var a=[],b=[],c=this.offset");for(c=0;c<h;++c)q.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),q.push("return function construct_"+o+"(data,shape,stride,offset){return new "+o+"(data,"+Y.map((function(k){return"shape["+k+"]"})).join(",")+","+Y.map((function(k){return"stride["+k+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",q.join("\n"))(l[k],J)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};k.exports=function(k,h,o,x){if(void 0===k)return(0,l.array[0])([]);"number"===typeof k&&(k=[k]),void 0===h&&(h=[k.length]);var Y=h.length;if(void 0===o){o=new Array(Y);for(var J=Y-1,A=1;J>=0;--J)o[J]=A,A*=h[J]}if(void 0===x){x=0;for(J=0;J<Y;++J)o[J]<0&&(x-=(h[J]-1)*o[J])}for(var K=function(k){if(I(k))return"buffer";if(q)switch(Object.prototype.toString.call(k)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(k)?"array":"generic"}(k),a=l[K];a.length<=Y+1;)a.push(G(K,a.length-1));return(0,a[Y+1])(k,h,o,x)}},13309:k=>{var h;self,h=()=>(()=>{"use strict";var k={d:(h,o)=>{for(var x in o)k.o(o,x)&&!k.o(h,x)&&Object.defineProperty(h,x,{enumerable:!0,get:o[x]})},o:(k,h)=>Object.prototype.hasOwnProperty.call(k,h)},h={};k.d(h,{default:()=>Q});var o,x=function(k,h){var o=h.x-k.x,x=h.y-k.y;return Math.sqrt(o*o+x*x)},I=function(k){return k*(Math.PI/180)},q=new Map,Y=function(k){q.has(k)&&clearTimeout(q.get(k)),q.set(k,setTimeout(k,100))},J=function(k,h,o){for(var x,I=h.split(/[ ,]+/g),q=0;q<I.length;q+=1)x=I[q],k.addEventListener?k.addEventListener(x,o,!1):k.attachEvent&&k.attachEvent(x,o)},G=function(k,h,o){for(var x,I=h.split(/[ ,]+/g),q=0;q<I.length;q+=1)x=I[q],k.removeEventListener?k.removeEventListener(x,o):k.detachEvent&&k.detachEvent(x,o)},l=function(k){return k.preventDefault(),k.type.match(/^touch/)?k.changedTouches:k},A=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},K=function(k,h){h.top||h.right||h.bottom||h.left?(k.style.top=h.top,k.style.right=h.right,k.style.bottom=h.bottom,k.style.left=h.left):(k.style.left=h.x+"px",k.style.top=h.y+"px")},a=function(k,h,o){var x=N(k);for(var I in x)if(x.hasOwnProperty(I))if("string"==typeof h)x[I]=h+" "+o;else{for(var q="",Y=0,J=h.length;Y<J;Y+=1)q+=h[Y]+" "+o+", ";x[I]=q.slice(0,-2)}return x},N=function(k){var h={};return h[k]="",["webkit","Moz","o"].forEach((function(o){h[o+k.charAt(0).toUpperCase()+k.slice(1)]=""})),h},X=function(k,h){for(var o in h)h.hasOwnProperty(o)&&(k[o]=h[o]);return k},c=function(k,h){if(k.length)for(var o=0,x=k.length;o<x;o+=1)h(k[o]);else h(k)},W="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,f=window.matchMedia("(any-hover: none)").matches,M=!!("ontouchstart"in window),T=!!window.PointerEvent,j=!!window.MSPointerEvent,d={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},b={start:"mousedown",move:"mousemove",end:"mouseup"},V={};function i(){}W&&!f?o=d:T?o={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:j?o={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:M?(o=d,V=b):o=b,i.prototype.on=function(k,h){var o,x=this,I=k.split(/[ ,]+/g);x._handlers_=x._handlers_||{};for(var q=0;q<I.length;q+=1)o=I[q],x._handlers_[o]=x._handlers_[o]||[],x._handlers_[o].push(h);return x},i.prototype.off=function(k,h){var o=this;return o._handlers_=o._handlers_||{},void 0===k?o._handlers_={}:void 0===h?o._handlers_[k]=null:o._handlers_[k]&&o._handlers_[k].indexOf(h)>=0&&o._handlers_[k].splice(o._handlers_[k].indexOf(h),1),o},i.prototype.trigger=function(k,h){var o,x=this,I=k.split(/[ ,]+/g);x._handlers_=x._handlers_||{};for(var q=0;q<I.length;q+=1)o=I[q],x._handlers_[o]&&x._handlers_[o].length&&x._handlers_[o].forEach((function(k){k.call(x,{type:o,target:x},h)}))},i.prototype.config=function(k){var h=this;h.options=h.defaults||{},k&&(h.options=function(k,h){var o={};for(var x in k)k.hasOwnProperty(x)&&h.hasOwnProperty(x)?o[x]=h[x]:k.hasOwnProperty(x)&&(o[x]=k[x]);return o}(h.options,k))},i.prototype.bindEvt=function(k,h){var x=this;return x._domHandlers_=x._domHandlers_||{},x._domHandlers_[h]=function(){"function"==typeof x["on"+h]?x["on"+h].apply(x,arguments):console.warn('[WARNING] : Missing "on'+h+'" handler.')},J(k,o[h],x._domHandlers_[h]),V[h]&&J(k,V[h],x._domHandlers_[h]),x},i.prototype.unbindEvt=function(k,h){var x=this;return x._domHandlers_=x._domHandlers_||{},G(k,o[h],x._domHandlers_[h]),V[h]&&G(k,V[h],x._domHandlers_[h]),delete x._domHandlers_[h],this};const F=i;function R(k,h){return this.identifier=h.identifier,this.position=h.position,this.frontPosition=h.frontPosition,this.collection=k,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(h),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=R.id,R.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}R.prototype=new F,R.constructor=R,R.id=0,R.prototype.buildEl=function(k){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},R.prototype.stylize=function(){if(this.options.dataOnly)return this;var k=this.options.fadeTime+"ms",h=function(){var k=N("borderRadius");for(var h in k)k.hasOwnProperty(h)&&(k[h]="50%");return k}(),o=a("transition","opacity",k),x={};return x.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},x.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},x.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},X(x.el,o),"circle"===this.options.shape&&X(x.back,h),X(x.front,h),this.applyStyles(x),this},R.prototype.applyStyles=function(k){for(var h in this.ui)if(this.ui.hasOwnProperty(h))for(var o in k[h])this.ui[h].style[o]=k[h][o];return this},R.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},R.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},R.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},R.prototype.show=function(k){var h=this;return h.options.dataOnly||(clearTimeout(h.removeTimeout),clearTimeout(h.showTimeout),clearTimeout(h.restTimeout),h.addToDom(),h.restCallback(),setTimeout((function(){h.ui.el.style.opacity=1}),0),h.showTimeout=setTimeout((function(){h.trigger("shown",h.instance),"function"==typeof k&&k.call(this)}),h.options.fadeTime)),h},R.prototype.hide=function(k){var h=this;if(h.options.dataOnly)return h;if(h.ui.el.style.opacity=h.options.restOpacity,clearTimeout(h.removeTimeout),clearTimeout(h.showTimeout),clearTimeout(h.restTimeout),h.removeTimeout=setTimeout((function(){var o="dynamic"===h.options.mode?"none":"block";h.ui.el.style.display=o,"function"==typeof k&&k.call(h),h.trigger("hidden",h.instance)}),h.options.fadeTime),h.options.restJoystick){var o=h.options.restJoystick,x={};x.x=!0===o||!1!==o.x?0:h.instance.frontPosition.x,x.y=!0===o||!1!==o.y?0:h.instance.frontPosition.y,h.setPosition(k,x)}return h},R.prototype.setPosition=function(k,h){var o=this;o.frontPosition={x:h.x,y:h.y};var x=o.options.fadeTime+"ms",I={};I.front=a("transition",["transform"],x);var q={front:{}};q.front={transform:"translate("+o.frontPosition.x+"px,"+o.frontPosition.y+"px)"},o.applyStyles(I),o.applyStyles(q),o.restTimeout=setTimeout((function(){"function"==typeof k&&k.call(o),o.restCallback()}),o.options.fadeTime)},R.prototype.restCallback=function(){var k=this,h={};h.front=a("transition","none",""),k.applyStyles(h),k.trigger("rested",k.instance)},R.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},R.prototype.computeDirection=function(k){var h,o,x,I=k.angle.radian,q=Math.PI/4,Y=Math.PI/2;if(I>q&&I<3*q&&!k.lockX?h="up":I>-q&&I<=q&&!k.lockY?h="left":I>3*-q&&I<=-q&&!k.lockX?h="down":k.lockY||(h="right"),k.lockY||(o=I>-Y&&I<Y?"left":"right"),k.lockX||(x=I>0?"up":"down"),k.force>this.options.threshold){var J,G={};for(J in this.direction)this.direction.hasOwnProperty(J)&&(G[J]=this.direction[J]);var l={};for(J in this.direction={x:o,y:x,angle:h},k.direction=this.direction,G)G[J]===this.direction[J]&&(l[J]=!0);if(l.x&&l.y&&l.angle)return k;l.x&&l.y||this.trigger("plain",k),l.x||this.trigger("plain:"+o,k),l.y||this.trigger("plain:"+x,k),l.angle||this.trigger("dir dir:"+h,k)}else this.resetDirection();return k};const s=R;function Z(k,h){var o=this;o.nipples=[],o.idles=[],o.actives=[],o.ids=[],o.pressureIntervals={},o.manager=k,o.id=Z.id,Z.id+=1,o.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},o.config(h),"static"!==o.options.mode&&"semi"!==o.options.mode||(o.options.multitouch=!1),o.options.multitouch||(o.options.maxNumberOfNipples=1);var x=getComputedStyle(o.options.zone.parentElement);return x&&"flex"===x.display&&(o.parentIsFlex=!0),o.updateBox(),o.prepareNipples(),o.Ja(),o.begin(),o.nipples}Z.prototype=new F,Z.constructor=Z,Z.id=0,Z.prototype.prepareNipples=function(){var k=this,h=k.nipples;h.on=k.on.bind(k),h.off=k.off.bind(k),h.options=k.options,h.destroy=k.destroy.bind(k),h.ids=k.ids,h.id=k.id,h.processOnMove=k.processOnMove.bind(k),h.processOnEnd=k.processOnEnd.bind(k),h.get=function(k){if(void 0===k)return h[0];for(var o=0,x=h.length;o<x;o+=1)if(h[o].identifier===k)return h[o];return!1}},Z.prototype.Ja=function(){var k=this;k.bindEvt(k.options.zone,"start"),k.options.zone.style.touchAction="none",k.options.zone.style.msTouchAction="none"},Z.prototype.begin=function(){var k=this,h=k.options;if("static"===h.mode){var o=k.createNipple(h.position,k.manager.getIdentifier());o.add(),k.idles.push(o)}},Z.prototype.createNipple=function(k,h){var o=this,x=o.manager.scroll,I={},q=o.options,Y=o.parentIsFlex?x.x:x.x+o.box.left,J=o.parentIsFlex?x.y:x.y+o.box.top;if(k.x&&k.y)I={x:k.x-Y,y:k.y-J};else if(k.top||k.right||k.bottom||k.left){var G=document.createElement("DIV");G.style.display="hidden",G.style.top=k.top,G.style.right=k.right,G.style.bottom=k.bottom,G.style.left=k.left,G.style.position="absolute",q.zone.appendChild(G);var l=G.getBoundingClientRect();q.zone.removeChild(G),I=k,k={x:l.left+x.x,y:l.top+x.y}}var A=new s(o,{color:q.color,size:q.size,threshold:q.threshold,fadeTime:q.fadeTime,dataOnly:q.dataOnly,restJoystick:q.restJoystick,restOpacity:q.restOpacity,mode:q.mode,identifier:h,position:k,zone:q.zone,frontPosition:{x:0,y:0},shape:q.shape});return q.dataOnly||(K(A.ui.el,I),K(A.ui.front,A.frontPosition)),o.nipples.push(A),o.trigger("added "+A.identifier+":added",A),o.manager.trigger("added "+A.identifier+":added",A),o.bindNipple(A),A},Z.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Z.prototype.bindNipple=function(k){var h,o=this,x=function(k,x){h=k.type+" "+x.id+":"+k.type,o.trigger(h,x)};k.on("destroyed",o.onDestroyed.bind(o)),k.on("shown hidden rested dir plain",x),k.on("dir:up dir:right dir:down dir:left",x),k.on("plain:up plain:right plain:down plain:left",x)},Z.prototype.pressureFn=function(k,h,o){var x=this,I=0;clearInterval(x.pressureIntervals[o]),x.pressureIntervals[o]=setInterval(function(){var o=k.force||k.pressure||k.webkitForce||0;o!==I&&(h.trigger("pressure",o),x.trigger("pressure "+h.identifier+":pressure",o),I=o)}.bind(x),100)},Z.prototype.onstart=function(k){var h=this,o=h.options,x=k;return k=l(k),h.updateBox(),c(k,(function(I){h.actives.length<o.maxNumberOfNipples?h.processOnStart(I):x.type.match(/^touch/)&&(Object.keys(h.manager.ids).forEach((function(o){if(Object.values(x.touches).findIndex((function(k){return k.identifier===o}))<0){var I=[k[0]];I.identifier=o,h.processOnEnd(I)}})),h.actives.length<o.maxNumberOfNipples&&h.processOnStart(I))})),h.manager.bindDocument(),!1},Z.prototype.processOnStart=function(k){var h,o=this,I=o.options,q=o.manager.getIdentifier(k),Y=k.force||k.pressure||k.webkitForce||0,J={x:k.pageX,y:k.pageY},G=o.getOrCreate(q,J);G.identifier!==q&&o.manager.removeIdentifier(G.identifier),G.identifier=q;var l=function(h){h.trigger("start",h),o.trigger("start "+h.id+":start",h),h.show(),Y>0&&o.pressureFn(k,h,h.identifier),o.processOnMove(k)};if((h=o.idles.indexOf(G))>=0&&o.idles.splice(h,1),o.actives.push(G),o.ids.push(G.identifier),"semi"!==I.mode)l(G);else{if(!(x(J,G.position)<=I.catchDistance))return G.destroy(),void o.processOnStart(k);l(G)}return G},Z.prototype.getOrCreate=function(k,h){var o,x=this,I=x.options;return/(semi|static)/.test(I.mode)?(o=x.idles[0])?(x.idles.splice(0,1),o):"semi"===I.mode?x.createNipple(h,k):(console.warn("Coudln't find the needed nipple."),!1):o=x.createNipple(h,k)},Z.prototype.processOnMove=function(k){var h=this,o=h.options,q=h.manager.getIdentifier(k),Y=h.nipples.get(q),J=h.manager.scroll;if(function(k){return isNaN(k.buttons)?0!==k.pressure:0!==k.buttons}(k)){if(!Y)return console.error("Found zombie joystick with ID "+q),void h.manager.removeIdentifier(q);if(o.dynamicPage){var G=Y.el.getBoundingClientRect();Y.position={x:J.x+G.left,y:J.y+G.top}}Y.identifier=q;var l=Y.options.size/2,A={x:k.pageX,y:k.pageY};o.lockX&&(A.y=Y.position.y),o.lockY&&(A.x=Y.position.x);var K,a,N,X,c,W,f,M,T,j,d=x(A,Y.position),b=(K=A,N=(a=Y.position).x-K.x,X=a.y-K.y,function(k){return k*(180/Math.PI)}(Math.atan2(X,N))),V=I(b),i=d/l,F={distance:d,position:A};if("circle"===Y.options.shape?(c=Math.min(d,l),f=Y.position,M=c,j={x:0,y:0},T=I(T=b),j.x=f.x-M*Math.cos(T),j.y=f.y-M*Math.sin(T),W=j):(W=function(k,h,o){return{x:Math.min(Math.max(k.x,h.x-o),h.x+o),y:Math.min(Math.max(k.y,h.y-o),h.y+o)}}(A,Y.position,l),c=x(W,Y.position)),o.follow){if(d>l){var R=A.x-W.x,s=A.y-W.y;Y.position.x+=R,Y.position.y+=s,Y.el.style.top=Y.position.y-(h.box.top+J.y)+"px",Y.el.style.left=Y.position.x-(h.box.left+J.x)+"px",d=x(A,Y.position)}}else A=W,d=c;var Z=A.x-Y.position.x,w=A.y-Y.position.y;Y.frontPosition={x:Z,y:w},o.dataOnly||(Y.ui.front.style.transform="translate("+Z+"px,"+w+"px)");var D={identifier:Y.identifier,position:A,force:i,pressure:k.force||k.pressure||k.webkitForce||0,distance:d,angle:{radian:V,degree:b},vector:{x:Z/l,y:-w/l},raw:F,instance:Y,lockX:o.lockX,lockY:o.lockY};(D=Y.computeDirection(D)).angle={radian:I(180-b),degree:180-b},Y.trigger("move",D),h.trigger("move "+Y.id+":move",D)}else this.processOnEnd(k)},Z.prototype.processOnEnd=function(k){var h=this,o=h.options,x=h.manager.getIdentifier(k),I=h.nipples.get(x),q=h.manager.removeIdentifier(I.identifier);I&&(o.dataOnly||I.hide((function(){"dynamic"===o.mode&&(I.trigger("removed",I),h.trigger("removed "+I.id+":removed",I),h.manager.trigger("removed "+I.id+":removed",I),I.destroy())})),clearInterval(h.pressureIntervals[I.identifier]),I.resetDirection(),I.trigger("end",I),h.trigger("end "+I.id+":end",I),h.ids.indexOf(I.identifier)>=0&&h.ids.splice(h.ids.indexOf(I.identifier),1),h.actives.indexOf(I)>=0&&h.actives.splice(h.actives.indexOf(I),1),/(semi|static)/.test(o.mode)?h.idles.push(I):h.nipples.indexOf(I)>=0&&h.nipples.splice(h.nipples.indexOf(I),1),h.manager.unbindDocument(),/(semi|static)/.test(o.mode)&&(h.manager.ids[q.id]=q.identifier))},Z.prototype.onDestroyed=function(k,h){var o=this;o.nipples.indexOf(h)>=0&&o.nipples.splice(o.nipples.indexOf(h),1),o.actives.indexOf(h)>=0&&o.actives.splice(o.actives.indexOf(h),1),o.idles.indexOf(h)>=0&&o.idles.splice(o.idles.indexOf(h),1),o.ids.indexOf(h.identifier)>=0&&o.ids.splice(o.ids.indexOf(h.identifier),1),o.manager.removeIdentifier(h.identifier),o.manager.unbindDocument()},Z.prototype.destroy=function(){var k=this;for(var h in k.unbindEvt(k.options.zone,"start"),k.nipples.forEach((function(k){k.destroy()})),k.pressureIntervals)k.pressureIntervals.hasOwnProperty(h)&&clearInterval(k.pressureIntervals[h]);k.trigger("destroyed",k.nipples),k.manager.unbindDocument(),k.off()};const w=Z;function D(k){var h=this;h.ids={},h.index=0,h.collections=[],h.scroll=A(),h.config(k),h.prepareCollections();var o=function(){var k;h.collections.forEach((function(o){o.forEach((function(o){k=o.el.getBoundingClientRect(),o.position={x:h.scroll.x+k.left,y:h.scroll.y+k.top}}))}))};J(window,"resize",(function(){Y(o)}));var x=function(){h.scroll=A()};return J(window,"scroll",(function(){Y(x)})),h.collections}D.prototype=new F,D.constructor=D,D.prototype.prepareCollections=function(){var k=this;k.collections.create=k.create.bind(k),k.collections.on=k.on.bind(k),k.collections.off=k.off.bind(k),k.collections.destroy=k.destroy.bind(k),k.collections.get=function(h){var o;return k.collections.every((function(k){return!(o=k.get(h))})),o}},D.prototype.create=function(k){return this.createCollection(k)},D.prototype.createCollection=function(k){var h=this,o=new w(h,k);return h.bindCollection(o),h.collections.push(o),o},D.prototype.bindCollection=function(k){var h,o=this,x=function(k,x){h=k.type+" "+x.id+":"+k.type,o.trigger(h,x)};k.on("destroyed",o.onDestroyed.bind(o)),k.on("shown hidden rested dir plain",x),k.on("dir:up dir:right dir:down dir:left",x),k.on("plain:up plain:right plain:down plain:left",x)},D.prototype.bindDocument=function(){var k=this;k.binded||(k.bindEvt(document,"move").bindEvt(document,"end"),k.binded=!0)},D.prototype.unbindDocument=function(k){var h=this;Object.keys(h.ids).length&&!0!==k||(h.unbindEvt(document,"move").unbindEvt(document,"end"),h.binded=!1)},D.prototype.getIdentifier=function(k){var h;return k?void 0===(h=void 0===k.identifier?k.pointerId:k.identifier)&&(h=this.latest||0):h=this.index,void 0===this.ids[h]&&(this.ids[h]=this.index,this.index+=1),this.latest=h,this.ids[h]},D.prototype.removeIdentifier=function(k){var h={};for(var o in this.ids)if(this.ids[o]===k){h.id=o,h.identifier=this.ids[o],delete this.ids[o];break}return h},D.prototype.onmove=function(k){return this.onAny("move",k),!1},D.prototype.onend=function(k){return this.onAny("end",k),!1},D.prototype.oncancel=function(k){return this.onAny("end",k),!1},D.prototype.onAny=function(k,h){var o,x=this,I="processOn"+k.charAt(0).toUpperCase()+k.slice(1);h=l(h);var q=function(k,h,o){o.ids.indexOf(h)>=0&&(o[I](k),k._found_=!0)};return c(h,(function(k){o=x.getIdentifier(k),c(x.collections,q.bind(null,k,o)),k._found_||x.removeIdentifier(o)})),!1},D.prototype.destroy=function(){var k=this;k.unbindDocument(!0),k.ids={},k.index=0,k.collections.forEach((function(k){k.destroy()})),k.off()},D.prototype.onDestroyed=function(k,h){var o=this;if(o.collections.indexOf(h)<0)return!1;o.collections.splice(o.collections.indexOf(h),1)};var U=new D;const Q={create:function(k){return U.create(k)},factory:U};return h.default})(),k.exports=h()},12359:(k,h,o)=>{"use strict";const{Deflate:x,deflate:I,deflateRaw:q,gzip:Y}=o(12364),{Inflate:J,inflate:G,inflateRaw:l,ungzip:A}=o(12432),K=o(12405);k.exports.Deflate=x,k.exports.deflate=I,k.exports.deflateRaw=q,k.exports.gzip=Y,k.exports.Inflate=J,k.exports.inflate=G,k.exports.inflateRaw=l,k.exports.ungzip=A,k.exports.constants=K},12364:(k,h,o)=>{"use strict";const x=o(12372),I=o(12413),q=o(12418),Y=o(12402),J=o(12423),G=Object.prototype.toString,{Z_NO_FLUSH:l,Z_SYNC_FLUSH:A,Z_FULL_FLUSH:K,Z_FINISH:a,Z_OK:N,Z_STREAM_END:X,Z_DEFAULT_COMPRESSION:c,Z_DEFAULT_STRATEGY:W,Z_DEFLATED:f}=o(12405);function M(k){this.options=I.assign({level:c,method:f,Ok:16384,windowBits:15,memLevel:8,strategy:W},k||{});let h=this.options;h.raw&&h.windowBits>0?h.windowBits=-h.windowBits:h.gzip&&h.windowBits>0&&h.windowBits<16&&(h.windowBits+=16),this.err=0,this.ah="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let o=x.deflateInit2(this.strm,h.level,h.method,h.windowBits,h.memLevel,h.strategy);if(o!==N)throw new Error(Y[o]);if(h.header&&x.deflateSetHeader(this.strm,h.header),h.dictionary){let k;if(k="string"===typeof h.dictionary?q.string2buf(h.dictionary):"[object ArrayBuffer]"===G.call(h.dictionary)?new Uint8Array(h.dictionary):h.dictionary,o=x.deflateSetDictionary(this.strm,k),o!==N)throw new Error(Y[o]);this._dict_set=!0}}function T(k,h){const o=new M(h);if(o.push(k,!0),o.err)throw o.ah||Y[o.err];return o.result}M.prototype.push=function(k,h){const o=this.strm,I=this.options.Ok;let Y,J;if(this.ended)return!1;for(J=h===~~h?h:!0===h?a:l,"string"===typeof k?o.input=q.string2buf(k):"[object ArrayBuffer]"===G.call(k)?o.input=new Uint8Array(k):o.input=k,o.next_in=0,o.avail_in=o.input.length;;)if(0===o.avail_out&&(o.output=new Uint8Array(I),o.next_out=0,o.avail_out=I),(J===A||J===K)&&o.avail_out<=6)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else{if(Y=x.deflate(o,J),Y===X)return o.next_out>0&&this.onData(o.output.subarray(0,o.next_out)),Y=x.deflateEnd(this.strm),this.onEnd(Y),this.ended=!0,Y===N;if(0!==o.avail_out){if(J>0&&o.next_out>0)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else if(0===o.avail_in)break}else this.onData(o.output)}return!0},M.prototype.onData=function(k){this.chunks.push(k)},M.prototype.onEnd=function(k){k===N&&(this.result=I.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.ah=this.strm.ah},k.exports.Deflate=M,k.exports.deflate=T,k.exports.deflateRaw=function(k,h){return(h=h||{}).raw=!0,T(k,h)},k.exports.gzip=function(k,h){return(h=h||{}).gzip=!0,T(k,h)},k.exports.constants=o(12405)},12432:(k,h,o)=>{"use strict";const x=o(12437),I=o(12413),q=o(12418),Y=o(12402),J=o(12423),G=o(12456),l=Object.prototype.toString,{Z_NO_FLUSH:A,Z_FINISH:K,Z_OK:a,Z_STREAM_END:N,Z_NEED_DICT:X,Z_STREAM_ERROR:c,Z_DATA_ERROR:W,Z_MEM_ERROR:f}=o(12405);function M(k){this.options=I.assign({Ok:65536,windowBits:15,to:""},k||{});const h=this.options;h.raw&&h.windowBits>=0&&h.windowBits<16&&(h.windowBits=-h.windowBits,0===h.windowBits&&(h.windowBits=-15)),!(h.windowBits>=0&&h.windowBits<16)||k&&k.windowBits||(h.windowBits+=32),h.windowBits>15&&h.windowBits<48&&0===(15&h.windowBits)&&(h.windowBits|=15),this.err=0,this.ah="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let o=x.inflateInit2(this.strm,h.windowBits);if(o!==a)throw new Error(Y[o]);if(this.header=new G,x.inflateGetHeader(this.strm,this.header),h.dictionary&&("string"===typeof h.dictionary?h.dictionary=q.string2buf(h.dictionary):"[object ArrayBuffer]"===l.call(h.dictionary)&&(h.dictionary=new Uint8Array(h.dictionary)),h.raw&&(o=x.inflateSetDictionary(this.strm,h.dictionary),o!==a)))throw new Error(Y[o])}function T(k,h){const o=new M(h);if(o.push(k),o.err)throw o.ah||Y[o.err];return o.result}M.prototype.push=function(k,h){const o=this.strm,I=this.options.Ok,Y=this.options.dictionary;let J,G,M;if(this.ended)return!1;for(G=h===~~h?h:!0===h?K:A,"[object ArrayBuffer]"===l.call(k)?o.input=new Uint8Array(k):o.input=k,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(I),o.next_out=0,o.avail_out=I),J=x.inflate(o,G),J===X&&Y&&(J=x.inflateSetDictionary(o,Y),J===a?J=x.inflate(o,G):J===W&&(J=X));o.avail_in>0&&J===N&&o.state.wrap>0&&0!==k[o.next_in];)x.inflateReset(o),J=x.inflate(o,G);switch(J){case c:case W:case X:case f:return this.onEnd(J),this.ended=!0,!1}if(M=o.avail_out,o.next_out&&(0===o.avail_out||J===N))if("string"===this.options.to){let k=q.utf8border(o.output,o.next_out),h=o.next_out-k,x=q.buf2string(o.output,k);o.next_out=h,o.avail_out=I-h,h&&o.output.set(o.output.subarray(k,k+h),0),this.onData(x)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(J!==a||0!==M){if(J===N)return J=x.inflateEnd(this.strm),this.onEnd(J),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},M.prototype.onData=function(k){this.chunks.push(k)},M.prototype.onEnd=function(k){k===a&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=I.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.ah=this.strm.ah},k.exports.Inflate=M,k.exports.inflate=T,k.exports.inflateRaw=function(k,h){return(h=h||{}).raw=!0,T(k,h)},k.exports.ungzip=T,k.exports.constants=o(12405)},12413:k=>{"use strict";const h=(k,h)=>Object.prototype.hasOwnProperty.call(k,h);k.exports.assign=function(k){const o=Array.prototype.slice.call(arguments,1);for(;o.length;){const x=o.shift();if(x){if("object"!==typeof x)throw new TypeError(x+"must be non-object");for(const o in x)h(x,o)&&(k[o]=x[o])}}return k},k.exports.flattenChunks=k=>{let h=0;for(let x=0,I=k.length;x<I;x++)h+=k[x].length;const o=new Uint8Array(h);for(let x=0,I=0,q=k.length;x<q;x++){let h=k[x];o.set(h,I),I+=h.length}return o}},12418:k=>{"use strict";let h=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(x){h=!1}const o=new Uint8Array(256);for(let I=0;I<256;I++)o[I]=I>=252?6:I>=248?5:I>=240?4:I>=224?3:I>=192?2:1;o[254]=o[254]=1,k.exports.string2buf=k=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(k);let h,o,x,I,q,Y=k.length,J=0;for(I=0;I<Y;I++)o=k.charCodeAt(I),55296===(64512&o)&&I+1<Y&&(x=k.charCodeAt(I+1),56320===(64512&x)&&(o=65536+(o-55296<<10)+(x-56320),I++)),J+=o<128?1:o<2048?2:o<65536?3:4;for(h=new Uint8Array(J),q=0,I=0;q<J;I++)o=k.charCodeAt(I),55296===(64512&o)&&I+1<Y&&(x=k.charCodeAt(I+1),56320===(64512&x)&&(o=65536+(o-55296<<10)+(x-56320),I++)),o<128?h[q++]=o:o<2048?(h[q++]=192|o>>>6,h[q++]=128|63&o):o<65536?(h[q++]=224|o>>>12,h[q++]=128|o>>>6&63,h[q++]=128|63&o):(h[q++]=240|o>>>18,h[q++]=128|o>>>12&63,h[q++]=128|o>>>6&63,h[q++]=128|63&o);return h};k.exports.buf2string=(k,x)=>{const I=x||k.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(k.subarray(0,x));let q,Y;const J=new Array(2*I);for(Y=0,q=0;q<I;){let h=k[q++];if(h<128){J[Y++]=h;continue}let x=o[h];if(x>4)J[Y++]=65533,q+=x-1;else{for(h&=2===x?31:3===x?15:7;x>1&&q<I;)h=h<<6|63&k[q++],x--;x>1?J[Y++]=65533:h<65536?J[Y++]=h:(h-=65536,J[Y++]=55296|h>>10&1023,J[Y++]=56320|1023&h)}}return((k,o)=>{if(o<65534&&k.subarray&&h)return String.fromCharCode.apply(null,k.length===o?k:k.subarray(0,o));let x="";for(let h=0;h<o;h++)x+=String.fromCharCode(k[h]);return x})(J,Y)},k.exports.utf8border=(k,h)=>{(h=h||k.length)>k.length&&(h=k.length);let x=h-1;for(;x>=0&&128===(192&k[x]);)x--;return x<0||0===x?h:x+o[k[x]]>h?x:h}},12387:k=>{"use strict";k.exports=(k,h,o,x)=>{let I=65535&k,q=k>>>16&65535,Y=0;for(;0!==o;){Y=o>2e3?2e3:o,o-=Y;do{I=I+h[x++]|0,q=q+I|0}while(--Y);I%=65521,q%=65521}return I|q<<16}},12405:k=>{"use strict";k.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12396:k=>{"use strict";const h=new Uint32Array((()=>{let k,h=[];for(var o=0;o<256;o++){k=o;for(var x=0;x<8;x++)k=1&k?3988292384^k>>>1:k>>>1;h[o]=k}return h})());k.exports=(k,o,x,I)=>{const q=h,Y=I+x;k^=-1;for(let h=I;h<Y;h++)k=k>>>8^q[255&(k^o[h])];return~k}},12372:(k,h,o)=>{"use strict";const{_tr_init:x,_tr_stored_block:I,_tr_flush_block:q,_tr_tally:Y,_tr_align:J}=o(12379),G=o(12387),l=o(12396),A=o(12402),{Z_NO_FLUSH:K,Z_PARTIAL_FLUSH:a,Z_FULL_FLUSH:N,Z_FINISH:X,Z_BLOCK:c,Z_OK:W,Z_STREAM_END:f,Z_STREAM_ERROR:M,Z_DATA_ERROR:T,Z_BUF_ERROR:j,Z_DEFAULT_COMPRESSION:d,Z_FILTERED:b,Z_HUFFMAN_ONLY:V,Z_RLE:i,Z_FIXED:F,Z_DEFAULT_STRATEGY:R,Z_UNKNOWN:s,Z_DEFLATED:Z}=o(12405),w=258,D=262,U=103,Q=113,B=666,E=(k,h)=>(k.ah=A[h],h),n=k=>(k<<1)-(k>4?9:0),H=k=>{let h=k.length;for(;--h>=0;)k[h]=0};let y=(k,h,o)=>(h<<k.hash_shift^o)&k.hash_mask;const O=k=>{const h=k.state;let o=h.pending;o>k.avail_out&&(o=k.avail_out),0!==o&&(k.output.set(h.pending_buf.subarray(h.pending_out,h.pending_out+o),k.next_out),k.next_out+=o,h.pending_out+=o,k.total_out+=o,k.avail_out-=o,h.pending-=o,0===h.pending&&(h.pending_out=0))},z=(k,h)=>{q(k,k.block_start>=0?k.block_start:-1,k.strstart-k.block_start,h),k.block_start=k.strstart,O(k.strm)},p=(k,h)=>{k.pending_buf[k.pending++]=h},v=(k,h)=>{k.pending_buf[k.pending++]=h>>>8&255,k.pending_buf[k.pending++]=255&h},m=(k,h,o,x)=>{let I=k.avail_in;return I>x&&(I=x),0===I?0:(k.avail_in-=I,h.set(k.input.subarray(k.next_in,k.next_in+I),o),1===k.state.wrap?k.adler=G(k.adler,h,I,o):2===k.state.wrap&&(k.adler=l(k.adler,h,I,o)),k.next_in+=I,k.total_in+=I,I)},L=(k,h)=>{let o,x,I=k.max_chain_length,q=k.strstart,Y=k.prev_length,J=k.nice_match;const G=k.strstart>k.w_size-D?k.strstart-(k.w_size-D):0,l=k.window,A=k.w_mask,K=k.prev,a=k.strstart+w;let N=l[q+Y-1],X=l[q+Y];k.prev_length>=k.good_match&&(I>>=2),J>k.lookahead&&(J=k.lookahead);do{if(o=h,l[o+Y]===X&&l[o+Y-1]===N&&l[o]===l[q]&&l[++o]===l[q+1]){q+=2,o++;do{}while(l[++q]===l[++o]&&l[++q]===l[++o]&&l[++q]===l[++o]&&l[++q]===l[++o]&&l[++q]===l[++o]&&l[++q]===l[++o]&&l[++q]===l[++o]&&l[++q]===l[++o]&&q<a);if(x=w-(a-q),q=a-w,x>Y){if(k.match_start=h,Y=x,x>=J)break;N=l[q+Y-1],X=l[q+Y]}}}while((h=K[h&A])>G&&0!==--I);return Y<=k.lookahead?Y:k.lookahead},P=k=>{const h=k.w_size;let o,x,I,q,Y;do{if(q=k.window_size-k.lookahead-k.strstart,k.strstart>=h+(h-D)){k.window.set(k.window.subarray(h,h+h),0),k.match_start-=h,k.strstart-=h,k.block_start-=h,x=k.hash_size,o=x;do{I=k.head[--o],k.head[o]=I>=h?I-h:0}while(--x);x=h,o=x;do{I=k.prev[--o],k.prev[o]=I>=h?I-h:0}while(--x);q+=h}if(0===k.strm.avail_in)break;if(x=m(k.strm,k.window,k.strstart+k.lookahead,q),k.lookahead+=x,k.lookahead+k.insert>=3)for(Y=k.strstart-k.insert,k.ins_h=k.window[Y],k.ins_h=y(k,k.ins_h,k.window[Y+1]);k.insert&&(k.ins_h=y(k,k.ins_h,k.window[Y+3-1]),k.prev[Y&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=Y,Y++,k.insert--,!(k.lookahead+k.insert<3)););}while(k.lookahead<D&&0!==k.strm.avail_in)},r=(k,h)=>{let o,x;for(;;){if(k.lookahead<D){if(P(k),k.lookahead<D&&h===K)return 1;if(0===k.lookahead)break}if(o=0,k.lookahead>=3&&(k.ins_h=y(k,k.ins_h,k.window[k.strstart+3-1]),o=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),0!==o&&k.strstart-o<=k.w_size-D&&(k.match_length=L(k,o)),k.match_length>=3)if(x=Y(k,k.strstart-k.match_start,k.match_length-3),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=3){k.match_length--;do{k.strstart++,k.ins_h=y(k,k.ins_h,k.window[k.strstart+3-1]),o=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart}while(0!==--k.match_length);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=y(k,k.ins_h,k.window[k.strstart+1]);else x=Y(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(x&&(z(k,!1),0===k.strm.avail_out))return 1}return k.insert=k.strstart<2?k.strstart:2,h===X?(z(k,!0),0===k.strm.avail_out?3:4):k.last_lit&&(z(k,!1),0===k.strm.avail_out)?1:2},t=(k,h)=>{let o,x,I;for(;;){if(k.lookahead<D){if(P(k),k.lookahead<D&&h===K)return 1;if(0===k.lookahead)break}if(o=0,k.lookahead>=3&&(k.ins_h=y(k,k.ins_h,k.window[k.strstart+3-1]),o=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=2,0!==o&&k.prev_length<k.max_lazy_match&&k.strstart-o<=k.w_size-D&&(k.match_length=L(k,o),k.match_length<=5&&(k.strategy===b||3===k.match_length&&k.strstart-k.match_start>4096)&&(k.match_length=2)),k.prev_length>=3&&k.match_length<=k.prev_length){I=k.strstart+k.lookahead-3,x=Y(k,k.strstart-1-k.prev_match,k.prev_length-3),k.lookahead-=k.prev_length-1,k.prev_length-=2;do{++k.strstart<=I&&(k.ins_h=y(k,k.ins_h,k.window[k.strstart+3-1]),o=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart)}while(0!==--k.prev_length);if(k.match_available=0,k.match_length=2,k.strstart++,x&&(z(k,!1),0===k.strm.avail_out))return 1}else if(k.match_available){if(x=Y(k,0,k.window[k.strstart-1]),x&&z(k,!1),k.strstart++,k.lookahead--,0===k.strm.avail_out)return 1}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(x=Y(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<2?k.strstart:2,h===X?(z(k,!0),0===k.strm.avail_out?3:4):k.last_lit&&(z(k,!1),0===k.strm.avail_out)?1:2};function S(k,h,o,x,I){this.good_length=k,this.max_lazy=h,this.nice_length=o,this.max_chain=x,this.func=I}const C=[new S(0,0,0,0,((k,h)=>{let o=65535;for(o>k.pending_buf_size-5&&(o=k.pending_buf_size-5);;){if(k.lookahead<=1){if(P(k),0===k.lookahead&&h===K)return 1;if(0===k.lookahead)break}k.strstart+=k.lookahead,k.lookahead=0;const x=k.block_start+o;if((0===k.strstart||k.strstart>=x)&&(k.lookahead=k.strstart-x,k.strstart=x,z(k,!1),0===k.strm.avail_out))return 1;if(k.strstart-k.block_start>=k.w_size-D&&(z(k,!1),0===k.strm.avail_out))return 1}return k.insert=0,h===X?(z(k,!0),0===k.strm.avail_out?3:4):(k.strstart>k.block_start&&(z(k,!1),k.strm.avail_out),1)})),new S(4,4,8,4,r),new S(4,5,16,8,r),new S(4,6,32,32,r),new S(4,4,16,16,t),new S(8,16,32,32,t),new S(8,16,128,128,t),new S(8,32,128,256,t),new S(32,128,258,1024,t),new S(32,258,258,4096,t)];function g(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),H(this.dyn_ltree),H(this.dyn_dtree),H(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),H(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),H(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const e=k=>{if(!k||!k.state)return E(k,M);k.total_in=k.total_out=0,k.data_type=s;const h=k.state;return h.pending=0,h.pending_out=0,h.wrap<0&&(h.wrap=-h.wrap),h.status=h.wrap?42:Q,k.adler=2===h.wrap?0:1,h.last_flush=K,x(h),W},u=k=>{const h=e(k);var o;return h===W&&((o=k.state).window_size=2*o.w_size,H(o.head),o.max_lazy_match=C[o.level].max_lazy,o.good_match=C[o.level].good_length,o.nice_match=C[o.level].nice_length,o.max_chain_length=C[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=2,o.match_available=0,o.ins_h=0),h},kk=(k,h,o,x,I,q)=>{if(!k)return M;let Y=1;if(h===d&&(h=6),x<0?(Y=0,x=-x):x>15&&(Y=2,x-=16),I<1||I>9||o!==Z||x<8||x>15||h<0||h>9||q<0||q>F)return E(k,M);8===x&&(x=9);const J=new g;return k.state=J,J.strm=k,J.wrap=Y,J.gzhead=null,J.w_bits=x,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=I+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+3-1)/3),J.window=new Uint8Array(2*J.w_size),J.head=new Uint16Array(J.hash_size),J.prev=new Uint16Array(J.w_size),J.lit_bufsize=1<<I+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new Uint8Array(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=h,J.strategy=q,J.method=o,u(k)};k.exports.deflateInit=(k,h)=>kk(k,h,Z,15,8,R),k.exports.deflateInit2=kk,k.exports.deflateReset=u,k.exports.deflateResetKeep=e,k.exports.deflateSetHeader=(k,h)=>k&&k.state?2!==k.state.wrap?M:(k.state.gzhead=h,W):M,k.exports.deflate=(k,h)=>{let o,x;if(!k||!k.state||h>c||h<0)return k?E(k,M):M;const q=k.state;if(!k.output||!k.input&&0!==k.avail_in||q.status===B&&h!==X)return E(k,0===k.avail_out?j:M);q.strm=k;const G=q.last_flush;if(q.last_flush=h,42===q.status)if(2===q.wrap)k.adler=0,p(q,31),p(q,139),p(q,8),q.gzhead?(p(q,(q.gzhead.text?1:0)+(q.gzhead.hcrc?2:0)+(q.gzhead.extra?4:0)+(q.gzhead.name?8:0)+(q.gzhead.comment?16:0)),p(q,255&q.gzhead.time),p(q,q.gzhead.time>>8&255),p(q,q.gzhead.time>>16&255),p(q,q.gzhead.time>>24&255),p(q,9===q.level?2:q.strategy>=V||q.level<2?4:0),p(q,255&q.gzhead.os),q.gzhead.extra&&q.gzhead.extra.length&&(p(q,255&q.gzhead.extra.length),p(q,q.gzhead.extra.length>>8&255)),q.gzhead.hcrc&&(k.adler=l(k.adler,q.pending_buf,q.pending,0)),q.gzindex=0,q.status=69):(p(q,0),p(q,0),p(q,0),p(q,0),p(q,0),p(q,9===q.level?2:q.strategy>=V||q.level<2?4:0),p(q,3),q.status=Q);else{let h=Z+(q.w_bits-8<<4)<<8,o=-1;o=q.strategy>=V||q.level<2?0:q.level<6?1:6===q.level?2:3,h|=o<<6,0!==q.strstart&&(h|=32),h+=31-h%31,q.status=Q,v(q,h),0!==q.strstart&&(v(q,k.adler>>>16),v(q,65535&k.adler)),k.adler=1}if(69===q.status)if(q.gzhead.extra){for(o=q.pending;q.gzindex<(65535&q.gzhead.extra.length)&&(q.pending!==q.pending_buf_size||(q.gzhead.hcrc&&q.pending>o&&(k.adler=l(k.adler,q.pending_buf,q.pending-o,o)),O(k),o=q.pending,q.pending!==q.pending_buf_size));)p(q,255&q.gzhead.extra[q.gzindex]),q.gzindex++;q.gzhead.hcrc&&q.pending>o&&(k.adler=l(k.adler,q.pending_buf,q.pending-o,o)),q.gzindex===q.gzhead.extra.length&&(q.gzindex=0,q.status=73)}else q.status=73;if(73===q.status)if(q.gzhead.name){o=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>o&&(k.adler=l(k.adler,q.pending_buf,q.pending-o,o)),O(k),o=q.pending,q.pending===q.pending_buf_size)){x=1;break}x=q.gzindex<q.gzhead.name.length?255&q.gzhead.name.charCodeAt(q.gzindex++):0,p(q,x)}while(0!==x);q.gzhead.hcrc&&q.pending>o&&(k.adler=l(k.adler,q.pending_buf,q.pending-o,o)),0===x&&(q.gzindex=0,q.status=91)}else q.status=91;if(91===q.status)if(q.gzhead.comment){o=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>o&&(k.adler=l(k.adler,q.pending_buf,q.pending-o,o)),O(k),o=q.pending,q.pending===q.pending_buf_size)){x=1;break}x=q.gzindex<q.gzhead.comment.length?255&q.gzhead.comment.charCodeAt(q.gzindex++):0,p(q,x)}while(0!==x);q.gzhead.hcrc&&q.pending>o&&(k.adler=l(k.adler,q.pending_buf,q.pending-o,o)),0===x&&(q.status=U)}else q.status=U;if(q.status===U&&(q.gzhead.hcrc?(q.pending+2>q.pending_buf_size&&O(k),q.pending+2<=q.pending_buf_size&&(p(q,255&k.adler),p(q,k.adler>>8&255),k.adler=0,q.status=Q)):q.status=Q),0!==q.pending){if(O(k),0===k.avail_out)return q.last_flush=-1,W}else if(0===k.avail_in&&n(h)<=n(G)&&h!==X)return E(k,j);if(q.status===B&&0!==k.avail_in)return E(k,j);if(0!==k.avail_in||0!==q.lookahead||h!==K&&q.status!==B){let o=q.strategy===V?((k,h)=>{let o;for(;;){if(0===k.lookahead&&(P(k),0===k.lookahead)){if(h===K)return 1;break}if(k.match_length=0,o=Y(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++,o&&(z(k,!1),0===k.strm.avail_out))return 1}return k.insert=0,h===X?(z(k,!0),0===k.strm.avail_out?3:4):k.last_lit&&(z(k,!1),0===k.strm.avail_out)?1:2})(q,h):q.strategy===i?((k,h)=>{let o,x,I,q;const J=k.window;for(;;){if(k.lookahead<=w){if(P(k),k.lookahead<=w&&h===K)return 1;if(0===k.lookahead)break}if(k.match_length=0,k.lookahead>=3&&k.strstart>0&&(I=k.strstart-1,x=J[I],x===J[++I]&&x===J[++I]&&x===J[++I])){q=k.strstart+w;do{}while(x===J[++I]&&x===J[++I]&&x===J[++I]&&x===J[++I]&&x===J[++I]&&x===J[++I]&&x===J[++I]&&x===J[++I]&&I<q);k.match_length=w-(q-I),k.match_length>k.lookahead&&(k.match_length=k.lookahead)}if(k.match_length>=3?(o=Y(k,1,k.match_length-3),k.lookahead-=k.match_length,k.strstart+=k.match_length,k.match_length=0):(o=Y(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++),o&&(z(k,!1),0===k.strm.avail_out))return 1}return k.insert=0,h===X?(z(k,!0),0===k.strm.avail_out?3:4):k.last_lit&&(z(k,!1),0===k.strm.avail_out)?1:2})(q,h):C[q.level].func(q,h);if(3!==o&&4!==o||(q.status=B),1===o||3===o)return 0===k.avail_out&&(q.last_flush=-1),W;if(2===o&&(h===a?J(q):h!==c&&(I(q,0,0,!1),h===N&&(H(q.head),0===q.lookahead&&(q.strstart=0,q.block_start=0,q.insert=0))),O(k),0===k.avail_out))return q.last_flush=-1,W}return h!==X?W:q.wrap<=0?f:(2===q.wrap?(p(q,255&k.adler),p(q,k.adler>>8&255),p(q,k.adler>>16&255),p(q,k.adler>>24&255),p(q,255&k.total_in),p(q,k.total_in>>8&255),p(q,k.total_in>>16&255),p(q,k.total_in>>24&255)):(v(q,k.adler>>>16),v(q,65535&k.adler)),O(k),q.wrap>0&&(q.wrap=-q.wrap),0!==q.pending?W:f)},k.exports.deflateEnd=k=>{if(!k||!k.state)return M;const h=k.state.status;return 42!==h&&69!==h&&73!==h&&91!==h&&h!==U&&h!==Q&&h!==B?E(k,M):(k.state=null,h===Q?E(k,T):W)},k.exports.deflateSetDictionary=(k,h)=>{let o=h.length;if(!k||!k.state)return M;const x=k.state,I=x.wrap;if(2===I||1===I&&42!==x.status||x.lookahead)return M;if(1===I&&(k.adler=G(k.adler,h,o,0)),x.wrap=0,o>=x.w_size){0===I&&(H(x.head),x.strstart=0,x.block_start=0,x.insert=0);let k=new Uint8Array(x.w_size);k.set(h.subarray(o-x.w_size,o),0),h=k,o=x.w_size}const q=k.avail_in,Y=k.next_in,J=k.input;for(k.avail_in=o,k.next_in=0,k.input=h,P(x);x.lookahead>=3;){let k=x.strstart,h=x.lookahead-2;do{x.ins_h=y(x,x.ins_h,x.window[k+3-1]),x.prev[k&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=k,k++}while(--h);x.strstart=k,x.lookahead=2,P(x)}return x.strstart+=x.lookahead,x.block_start=x.strstart,x.insert=x.lookahead,x.lookahead=0,x.match_length=x.prev_length=2,x.match_available=0,k.next_in=Y,k.input=J,k.avail_in=q,x.wrap=I,W},k.exports.deflateInfo="pako deflate (from Nodeca project)"},12456:k=>{"use strict";k.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12445:k=>{"use strict";k.exports=function(k,h){let o,x,I,q,Y,J,G,l,A,K,a,N,X,c,W,f,M,T,j,d,b,V,i,F;const R=k.state;o=k.next_in,i=k.input,x=o+(k.avail_in-5),I=k.next_out,F=k.output,q=I-(h-k.avail_out),Y=I+(k.avail_out-257),J=R.dmax,G=R.wsize,l=R.whave,A=R.wnext,K=R.window,a=R.hold,N=R.bits,X=R.lencode,c=R.distcode,W=(1<<R.lenbits)-1,f=(1<<R.distbits)-1;k:do{N<15&&(a+=i[o++]<<N,N+=8,a+=i[o++]<<N,N+=8),M=X[a&W];h:for(;;){if(T=M>>>24,a>>>=T,N-=T,T=M>>>16&255,0===T)F[I++]=65535&M;else{if(!(16&T)){if(0===(64&T)){M=X[(65535&M)+(a&(1<<T)-1)];continue h}if(32&T){R.mode=12;break k}k.ah="invalid literal/length code",R.mode=30;break k}j=65535&M,T&=15,T&&(N<T&&(a+=i[o++]<<N,N+=8),j+=a&(1<<T)-1,a>>>=T,N-=T),N<15&&(a+=i[o++]<<N,N+=8,a+=i[o++]<<N,N+=8),M=c[a&f];o:for(;;){if(T=M>>>24,a>>>=T,N-=T,T=M>>>16&255,!(16&T)){if(0===(64&T)){M=c[(65535&M)+(a&(1<<T)-1)];continue o}k.ah="invalid distance code",R.mode=30;break k}if(d=65535&M,T&=15,N<T&&(a+=i[o++]<<N,N+=8,N<T&&(a+=i[o++]<<N,N+=8)),d+=a&(1<<T)-1,d>J){k.ah="invalid distance too far back",R.mode=30;break k}if(a>>>=T,N-=T,T=I-q,d>T){if(T=d-T,T>l&&R.sane){k.ah="invalid distance too far back",R.mode=30;break k}if(b=0,V=K,0===A){if(b+=G-T,T<j){j-=T;do{F[I++]=K[b++]}while(--T);b=I-d,V=F}}else if(A<T){if(b+=G+A-T,T-=A,T<j){j-=T;do{F[I++]=K[b++]}while(--T);if(b=0,A<j){T=A,j-=T;do{F[I++]=K[b++]}while(--T);b=I-d,V=F}}}else if(b+=A-T,T<j){j-=T;do{F[I++]=K[b++]}while(--T);b=I-d,V=F}for(;j>2;)F[I++]=V[b++],F[I++]=V[b++],F[I++]=V[b++],j-=3;j&&(F[I++]=V[b++],j>1&&(F[I++]=V[b++]))}else{b=I-d;do{F[I++]=F[b++],F[I++]=F[b++],F[I++]=F[b++],j-=3}while(j>2);j&&(F[I++]=F[b++],j>1&&(F[I++]=F[b++]))}break}}break}}while(o<x&&I<Y);j=N>>3,o-=j,N-=j<<3,a&=(1<<N)-1,k.next_in=o,k.next_out=I,k.avail_in=o<x?x-o+5:5-(o-x),k.avail_out=I<Y?Y-I+257:257-(I-Y),R.hold=a,R.bits=N}},12437:(k,h,o)=>{"use strict";const x=o(12387),I=o(12396),q=o(12445),Y=o(12454),{Z_FINISH:J,Z_BLOCK:G,Z_TREES:l,Z_OK:A,Z_STREAM_END:K,Z_NEED_DICT:a,Z_STREAM_ERROR:N,Z_DATA_ERROR:X,Z_MEM_ERROR:c,Z_BUF_ERROR:W,Z_DEFLATED:f}=o(12405),M=12,T=30,j=k=>(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24);function d(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const b=k=>{if(!k||!k.state)return N;const h=k.state;return k.total_in=k.total_out=h.total=0,k.ah="",h.wrap&&(k.adler=1&h.wrap),h.mode=1,h.last=0,h.havedict=0,h.dmax=32768,h.head=null,h.hold=0,h.bits=0,h.lencode=h.lendyn=new Int32Array(852),h.distcode=h.distdyn=new Int32Array(592),h.sane=1,h.back=-1,A},V=k=>{if(!k||!k.state)return N;const h=k.state;return h.wsize=0,h.whave=0,h.wnext=0,b(k)},i=(k,h)=>{let o;if(!k||!k.state)return N;const x=k.state;return h<0?(o=0,h=-h):(o=1+(h>>4),h<48&&(h&=15)),h&&(h<8||h>15)?N:(null!==x.window&&x.wbits!==h&&(x.window=null),x.wrap=o,x.wbits=h,V(k))},F=(k,h)=>{if(!k)return N;const o=new d;k.state=o,o.window=null;const x=i(k,h);return x!==A&&(k.state=null),x};let R,s,Z=!0;const w=k=>{if(Z){R=new Int32Array(512),s=new Int32Array(32);let h=0;for(;h<144;)k.lens[h++]=8;for(;h<256;)k.lens[h++]=9;for(;h<280;)k.lens[h++]=7;for(;h<288;)k.lens[h++]=8;for(Y(1,k.lens,0,288,R,0,k.work,{bits:9}),h=0;h<32;)k.lens[h++]=5;Y(2,k.lens,0,32,s,0,k.work,{bits:5}),Z=!1}k.lencode=R,k.lenbits=9,k.distcode=s,k.distbits=5},D=(k,h,o,x)=>{let I;const q=k.state;return null===q.window&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new Uint8Array(q.wsize)),x>=q.wsize?(q.window.set(h.subarray(o-q.wsize,o),0),q.wnext=0,q.whave=q.wsize):(I=q.wsize-q.wnext,I>x&&(I=x),q.window.set(h.subarray(o-x,o-x+I),q.wnext),(x-=I)?(q.window.set(h.subarray(o-x,o),0),q.wnext=x,q.whave=q.wsize):(q.wnext+=I,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=I))),0};k.exports.inflateReset=V,k.exports.inflateReset2=i,k.exports.inflateResetKeep=b,k.exports.inflateInit=k=>F(k,15),k.exports.inflateInit2=F,k.exports.inflate=(k,h)=>{let o,d,b,V,i,F,R,s,Z,U,Q,B,E,n,H,y,O,z,p,v,m,L,P=0;const r=new Uint8Array(4);let t,S;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!k||!k.state||!k.output||!k.input&&0!==k.avail_in)return N;o=k.state,o.mode===M&&(o.mode=13),i=k.next_out,b=k.output,R=k.avail_out,V=k.next_in,d=k.input,F=k.avail_in,s=o.hold,Z=o.bits,U=F,Q=R,L=A;k:for(;;)switch(o.mode){case 1:if(0===o.wrap){o.mode=13;break}for(;Z<16;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(2&o.wrap&&35615===s){o.check=0,r[0]=255&s,r[1]=s>>>8&255,o.check=I(o.check,r,2,0),s=0,Z=0,o.mode=2;break}if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&s)<<8)+(s>>8))%31){k.ah="incorrect header check",o.mode=T;break}if((15&s)!==f){k.ah="unknown compression method",o.mode=T;break}if(s>>>=4,Z-=4,m=8+(15&s),0===o.wbits)o.wbits=m;else if(m>o.wbits){k.ah="invalid window size",o.mode=T;break}o.dmax=1<<o.wbits,k.adler=o.check=1,o.mode=512&s?10:M,s=0,Z=0;break;case 2:for(;Z<16;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(o.flags=s,(255&o.flags)!==f){k.ah="unknown compression method",o.mode=T;break}if(57344&o.flags){k.ah="unknown header flags set",o.mode=T;break}o.head&&(o.head.text=s>>8&1),512&o.flags&&(r[0]=255&s,r[1]=s>>>8&255,o.check=I(o.check,r,2,0)),s=0,Z=0,o.mode=3;case 3:for(;Z<32;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}o.head&&(o.head.time=s),512&o.flags&&(r[0]=255&s,r[1]=s>>>8&255,r[2]=s>>>16&255,r[3]=s>>>24&255,o.check=I(o.check,r,4,0)),s=0,Z=0,o.mode=4;case 4:for(;Z<16;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}o.head&&(o.head.xflags=255&s,o.head.os=s>>8),512&o.flags&&(r[0]=255&s,r[1]=s>>>8&255,o.check=I(o.check,r,2,0)),s=0,Z=0,o.mode=5;case 5:if(1024&o.flags){for(;Z<16;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}o.length=s,o.head&&(o.head.extra_len=s),512&o.flags&&(r[0]=255&s,r[1]=s>>>8&255,o.check=I(o.check,r,2,0)),s=0,Z=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&(B=o.length,B>F&&(B=F),B&&(o.head&&(m=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(d.subarray(V,V+B),m)),512&o.flags&&(o.check=I(o.check,d,B,V)),F-=B,V+=B,o.length-=B),o.length))break k;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(0===F)break k;B=0;do{m=d[V+B++],o.head&&m&&o.length<65536&&(o.head.name+=String.fromCharCode(m))}while(m&&B<F);if(512&o.flags&&(o.check=I(o.check,d,B,V)),F-=B,V+=B,m)break k}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(0===F)break k;B=0;do{m=d[V+B++],o.head&&m&&o.length<65536&&(o.head.comment+=String.fromCharCode(m))}while(m&&B<F);if(512&o.flags&&(o.check=I(o.check,d,B,V)),F-=B,V+=B,m)break k}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;Z<16;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(s!==(65535&o.check)){k.ah="header crc mismatch",o.mode=T;break}s=0,Z=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),k.adler=o.check=0,o.mode=M;break;case 10:for(;Z<32;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}k.adler=o.check=j(s),s=0,Z=0,o.mode=11;case 11:if(0===o.havedict)return k.next_out=i,k.avail_out=R,k.next_in=V,k.avail_in=F,o.hold=s,o.bits=Z,a;k.adler=o.check=1,o.mode=M;case M:if(h===G||h===l)break k;case 13:if(o.last){s>>>=7&Z,Z-=7&Z,o.mode=27;break}for(;Z<3;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}switch(o.last=1&s,s>>>=1,Z-=1,3&s){case 0:o.mode=14;break;case 1:if(w(o),o.mode=20,h===l){s>>>=2,Z-=2;break k}break;case 2:o.mode=17;break;case 3:k.ah="invalid block type",o.mode=T}s>>>=2,Z-=2;break;case 14:for(s>>>=7&Z,Z-=7&Z;Z<32;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if((65535&s)!==(s>>>16^65535)){k.ah="invalid stored block lengths",o.mode=T;break}if(o.length=65535&s,s=0,Z=0,o.mode=15,h===l)break k;case 15:o.mode=16;case 16:if(B=o.length,B){if(B>F&&(B=F),B>R&&(B=R),0===B)break k;b.set(d.subarray(V,V+B),i),F-=B,V+=B,R-=B,i+=B,o.length-=B;break}o.mode=M;break;case 17:for(;Z<14;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(o.nlen=257+(31&s),s>>>=5,Z-=5,o.ndist=1+(31&s),s>>>=5,Z-=5,o.ncode=4+(15&s),s>>>=4,Z-=4,o.nlen>286||o.ndist>30){k.ah="too many length or distance symbols",o.mode=T;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;Z<3;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}o.lens[C[o.have++]]=7&s,s>>>=3,Z-=3}for(;o.have<19;)o.lens[C[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,t={bits:o.lenbits},L=Y(0,o.lens,0,19,o.lencode,0,o.work,t),o.lenbits=t.bits,L){k.ah="invalid code lengths set",o.mode=T;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;P=o.lencode[s&(1<<o.lenbits)-1],H=P>>>24,y=P>>>16&255,O=65535&P,!(H<=Z);){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(O<16)s>>>=H,Z-=H,o.lens[o.have++]=O;else{if(16===O){for(S=H+2;Z<S;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(s>>>=H,Z-=H,0===o.have){k.ah="invalid bit length repeat",o.mode=T;break}m=o.lens[o.have-1],B=3+(3&s),s>>>=2,Z-=2}else if(17===O){for(S=H+3;Z<S;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}s>>>=H,Z-=H,m=0,B=3+(7&s),s>>>=3,Z-=3}else{for(S=H+7;Z<S;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}s>>>=H,Z-=H,m=0,B=11+(127&s),s>>>=7,Z-=7}if(o.have+B>o.nlen+o.ndist){k.ah="invalid bit length repeat",o.mode=T;break}for(;B--;)o.lens[o.have++]=m}}if(o.mode===T)break;if(0===o.lens[256]){k.ah="invalid code -- missing end-of-block",o.mode=T;break}if(o.lenbits=9,t={bits:o.lenbits},L=Y(1,o.lens,0,o.nlen,o.lencode,0,o.work,t),o.lenbits=t.bits,L){k.ah="invalid literal/lengths set",o.mode=T;break}if(o.distbits=6,o.distcode=o.distdyn,t={bits:o.distbits},L=Y(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,t),o.distbits=t.bits,L){k.ah="invalid distances set",o.mode=T;break}if(o.mode=20,h===l)break k;case 20:o.mode=21;case 21:if(F>=6&&R>=258){k.next_out=i,k.avail_out=R,k.next_in=V,k.avail_in=F,o.hold=s,o.bits=Z,q(k,Q),i=k.next_out,b=k.output,R=k.avail_out,V=k.next_in,d=k.input,F=k.avail_in,s=o.hold,Z=o.bits,o.mode===M&&(o.back=-1);break}for(o.back=0;P=o.lencode[s&(1<<o.lenbits)-1],H=P>>>24,y=P>>>16&255,O=65535&P,!(H<=Z);){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(y&&0===(240&y)){for(z=H,p=y,v=O;P=o.lencode[v+((s&(1<<z+p)-1)>>z)],H=P>>>24,y=P>>>16&255,O=65535&P,!(z+H<=Z);){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}s>>>=z,Z-=z,o.back+=z}if(s>>>=H,Z-=H,o.back+=H,o.length=O,0===y){o.mode=26;break}if(32&y){o.back=-1,o.mode=M;break}if(64&y){k.ah="invalid literal/length code",o.mode=T;break}o.extra=15&y,o.mode=22;case 22:if(o.extra){for(S=o.extra;Z<S;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}o.length+=s&(1<<o.extra)-1,s>>>=o.extra,Z-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;P=o.distcode[s&(1<<o.distbits)-1],H=P>>>24,y=P>>>16&255,O=65535&P,!(H<=Z);){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(0===(240&y)){for(z=H,p=y,v=O;P=o.distcode[v+((s&(1<<z+p)-1)>>z)],H=P>>>24,y=P>>>16&255,O=65535&P,!(z+H<=Z);){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}s>>>=z,Z-=z,o.back+=z}if(s>>>=H,Z-=H,o.back+=H,64&y){k.ah="invalid distance code",o.mode=T;break}o.offset=O,o.extra=15&y,o.mode=24;case 24:if(o.extra){for(S=o.extra;Z<S;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}o.offset+=s&(1<<o.extra)-1,s>>>=o.extra,Z-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){k.ah="invalid distance too far back",o.mode=T;break}o.mode=25;case 25:if(0===R)break k;if(B=Q-R,o.offset>B){if(B=o.offset-B,B>o.whave&&o.sane){k.ah="invalid distance too far back",o.mode=T;break}B>o.wnext?(B-=o.wnext,E=o.wsize-B):E=o.wnext-B,B>o.length&&(B=o.length),n=o.window}else n=b,E=i-o.offset,B=o.length;B>R&&(B=R),R-=B,o.length-=B;do{b[i++]=n[E++]}while(--B);0===o.length&&(o.mode=21);break;case 26:if(0===R)break k;b[i++]=o.length,R--,o.mode=21;break;case 27:if(o.wrap){for(;Z<32;){if(0===F)break k;F--,s|=d[V++]<<Z,Z+=8}if(Q-=R,k.total_out+=Q,o.total+=Q,Q&&(k.adler=o.check=o.flags?I(o.check,b,Q,i-Q):x(o.check,b,Q,i-Q)),Q=R,(o.flags?s:j(s))!==o.check){k.ah="incorrect data check",o.mode=T;break}s=0,Z=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;Z<32;){if(0===F)break k;F--,s+=d[V++]<<Z,Z+=8}if(s!==(4294967295&o.total)){k.ah="incorrect length check",o.mode=T;break}s=0,Z=0}o.mode=29;case 29:L=K;break k;case T:L=X;break k;case 31:return c;default:return N}return k.next_out=i,k.avail_out=R,k.next_in=V,k.avail_in=F,o.hold=s,o.bits=Z,(o.wsize||Q!==k.avail_out&&o.mode<T&&(o.mode<27||h!==J))&&D(k,k.output,k.next_out,Q-k.avail_out)?(o.mode=31,c):(U-=k.avail_in,Q-=k.avail_out,k.total_in+=U,k.total_out+=Q,o.total+=Q,o.wrap&&Q&&(k.adler=o.check=o.flags?I(o.check,b,Q,k.next_out-Q):x(o.check,b,Q,k.next_out-Q)),k.data_type=o.bits+(o.last?64:0)+(o.mode===M?128:0)+(20===o.mode||15===o.mode?256:0),(0===U&&0===Q||h===J)&&L===A&&(L=W),L)},k.exports.inflateEnd=k=>{if(!k||!k.state)return N;let h=k.state;return h.window&&(h.window=null),k.state=null,A},k.exports.inflateGetHeader=(k,h)=>{if(!k||!k.state)return N;const o=k.state;return 0===(2&o.wrap)?N:(o.head=h,h.done=!1,A)},k.exports.inflateSetDictionary=(k,h)=>{const o=h.length;let I,q,Y;return k&&k.state?(I=k.state,0!==I.wrap&&11!==I.mode?N:11===I.mode&&(q=1,q=x(q,h,o,0),q!==I.check)?X:(Y=D(k,h,o,o),Y?(I.mode=31,c):(I.havedict=1,A))):N},k.exports.inflateInfo="pako inflate (from Nodeca project)"},12454:k=>{"use strict";const h=15,o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),x=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),I=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),q=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);k.exports=(k,Y,J,G,l,A,K,a)=>{const N=a.bits;let X,c,W,f,M,T,j=0,d=0,b=0,V=0,i=0,F=0,R=0,s=0,Z=0,w=0,D=null,U=0;const Q=new Uint16Array(16),B=new Uint16Array(16);let E,n,H,y=null,O=0;for(j=0;j<=h;j++)Q[j]=0;for(d=0;d<G;d++)Q[Y[J+d]]++;for(i=N,V=h;V>=1&&0===Q[V];V--);if(i>V&&(i=V),0===V)return l[A++]=20971520,l[A++]=20971520,a.bits=1,0;for(b=1;b<V&&0===Q[b];b++);for(i<b&&(i=b),s=1,j=1;j<=h;j++)if(s<<=1,s-=Q[j],s<0)return-1;if(s>0&&(0===k||1!==V))return-1;for(B[1]=0,j=1;j<h;j++)B[j+1]=B[j]+Q[j];for(d=0;d<G;d++)0!==Y[J+d]&&(K[B[Y[J+d]]++]=d);if(0===k?(D=y=K,T=19):1===k?(D=o,U-=257,y=x,O-=257,T=256):(D=I,y=q,T=-1),w=0,d=0,j=b,M=A,F=i,R=0,W=-1,Z=1<<i,f=Z-1,1===k&&Z>852||2===k&&Z>592)return 1;for(;;){E=j-R,K[d]<T?(n=0,H=K[d]):K[d]>T?(n=y[O+K[d]],H=D[U+K[d]]):(n=96,H=0),X=1<<j-R,c=1<<F,b=c;do{c-=X,l[M+(w>>R)+c]=E<<24|n<<16|H}while(0!==c);for(X=1<<j-1;w&X;)X>>=1;if(0!==X?(w&=X-1,w+=X):w=0,d++,0===--Q[j]){if(j===V)break;j=Y[J+K[d]]}if(j>i&&(w&f)!==W){for(0===R&&(R=i),M+=b,F=j-R,s=1<<F;F+R<V&&(s-=Q[F+R],!(s<=0));)F++,s<<=1;if(Z+=1<<F,1===k&&Z>852||2===k&&Z>592)return 1;W=w&f,l[W]=i<<24|F<<16|M-A}}return 0!==w&&(l[M+w]=j-R<<24|64<<16),a.bits=i,0}},12402:k=>{"use strict";k.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12379:k=>{"use strict";function h(k){let h=k.length;for(;--h>=0;)k[h]=0}const o=256,x=286,I=30,q=15,Y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),J=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),G=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),A=new Array(576);h(A);const K=new Array(60);h(K);const a=new Array(512);h(a);const N=new Array(256);h(N);const X=new Array(29);h(X);const c=new Array(I);function W(k,h,o,x,I){this.static_tree=k,this.extra_bits=h,this.extra_base=o,this.elems=x,this.max_length=I,this.has_stree=k&&k.length}let f,M,T;function j(k,h){this.dyn_tree=k,this.max_code=0,this.stat_desc=h}h(c);const d=k=>k<256?a[k]:a[256+(k>>>7)],b=(k,h)=>{k.pending_buf[k.pending++]=255&h,k.pending_buf[k.pending++]=h>>>8&255},V=(k,h,o)=>{k.bi_valid>16-o?(k.bi_buf|=h<<k.bi_valid&65535,b(k,k.bi_buf),k.bi_buf=h>>16-k.bi_valid,k.bi_valid+=o-16):(k.bi_buf|=h<<k.bi_valid&65535,k.bi_valid+=o)},i=(k,h,o)=>{V(k,o[2*h],o[2*h+1])},F=(k,h)=>{let o=0;do{o|=1&k,k>>>=1,o<<=1}while(--h>0);return o>>>1},R=(k,h,o)=>{const x=new Array(16);let I,Y,J=0;for(I=1;I<=q;I++)x[I]=J=J+o[I-1]<<1;for(Y=0;Y<=h;Y++){let h=k[2*Y+1];0!==h&&(k[2*Y]=F(x[h]++,h))}},s=k=>{let h;for(h=0;h<x;h++)k.dyn_ltree[2*h]=0;for(h=0;h<I;h++)k.dyn_dtree[2*h]=0;for(h=0;h<19;h++)k.bl_tree[2*h]=0;k.dyn_ltree[512]=1,k.opt_len=k.static_len=0,k.last_lit=k.matches=0},Z=k=>{k.bi_valid>8?b(k,k.bi_buf):k.bi_valid>0&&(k.pending_buf[k.pending++]=k.bi_buf),k.bi_buf=0,k.bi_valid=0},w=(k,h,o,x)=>{const I=2*h,q=2*o;return k[I]<k[q]||k[I]===k[q]&&x[h]<=x[o]},D=(k,h,o)=>{const x=k.heap[o];let I=o<<1;for(;I<=k.heap_len&&(I<k.heap_len&&w(h,k.heap[I+1],k.heap[I],k.depth)&&I++,!w(h,x,k.heap[I],k.depth));)k.heap[o]=k.heap[I],o=I,I<<=1;k.heap[o]=x},U=(k,h,x)=>{let I,q,G,l,A=0;if(0!==k.last_lit)do{I=k.pending_buf[k.d_buf+2*A]<<8|k.pending_buf[k.d_buf+2*A+1],q=k.pending_buf[k.l_buf+A],A++,0===I?i(k,q,h):(G=N[q],i(k,G+o+1,h),l=Y[G],0!==l&&(q-=X[G],V(k,q,l)),I--,G=d(I),i(k,G,x),l=J[G],0!==l&&(I-=c[G],V(k,I,l)))}while(A<k.last_lit);i(k,256,h)},Q=(k,h)=>{const o=h.dyn_tree,x=h.stat_desc.static_tree,I=h.stat_desc.has_stree,Y=h.stat_desc.elems;let J,G,l,A=-1;for(k.heap_len=0,k.heap_max=573,J=0;J<Y;J++)0!==o[2*J]?(k.heap[++k.heap_len]=A=J,k.depth[J]=0):o[2*J+1]=0;for(;k.heap_len<2;)l=k.heap[++k.heap_len]=A<2?++A:0,o[2*l]=1,k.depth[l]=0,k.opt_len--,I&&(k.static_len-=x[2*l+1]);for(h.max_code=A,J=k.heap_len>>1;J>=1;J--)D(k,o,J);l=Y;do{J=k.heap[1],k.heap[1]=k.heap[k.heap_len--],D(k,o,1),G=k.heap[1],k.heap[--k.heap_max]=J,k.heap[--k.heap_max]=G,o[2*l]=o[2*J]+o[2*G],k.depth[l]=(k.depth[J]>=k.depth[G]?k.depth[J]:k.depth[G])+1,o[2*J+1]=o[2*G+1]=l,k.heap[1]=l++,D(k,o,1)}while(k.heap_len>=2);k.heap[--k.heap_max]=k.heap[1],((k,h)=>{const o=h.dyn_tree,x=h.max_code,I=h.stat_desc.static_tree,Y=h.stat_desc.has_stree,J=h.stat_desc.extra_bits,G=h.stat_desc.extra_base,l=h.stat_desc.max_length;let A,K,a,N,X,c,W=0;for(N=0;N<=q;N++)k.bl_count[N]=0;for(o[2*k.heap[k.heap_max]+1]=0,A=k.heap_max+1;A<573;A++)K=k.heap[A],N=o[2*o[2*K+1]+1]+1,N>l&&(N=l,W++),o[2*K+1]=N,K>x||(k.bl_count[N]++,X=0,K>=G&&(X=J[K-G]),c=o[2*K],k.opt_len+=c*(N+X),Y&&(k.static_len+=c*(I[2*K+1]+X)));if(0!==W){do{for(N=l-1;0===k.bl_count[N];)N--;k.bl_count[N]--,k.bl_count[N+1]+=2,k.bl_count[l]--,W-=2}while(W>0);for(N=l;0!==N;N--)for(K=k.bl_count[N];0!==K;)a=k.heap[--A],a>x||(o[2*a+1]!==N&&(k.opt_len+=(N-o[2*a+1])*o[2*a],o[2*a+1]=N),K--)}})(k,h),R(o,A,k.bl_count)},B=(k,h,o)=>{let x,I,q=-1,Y=h[1],J=0,G=7,l=4;for(0===Y&&(G=138,l=3),h[2*(o+1)+1]=65535,x=0;x<=o;x++)I=Y,Y=h[2*(x+1)+1],++J<G&&I===Y||(J<l?k.bl_tree[2*I]+=J:0!==I?(I!==q&&k.bl_tree[2*I]++,k.bl_tree[32]++):J<=10?k.bl_tree[34]++:k.bl_tree[36]++,J=0,q=I,0===Y?(G=138,l=3):I===Y?(G=6,l=3):(G=7,l=4))},E=(k,h,o)=>{let x,I,q=-1,Y=h[1],J=0,G=7,l=4;for(0===Y&&(G=138,l=3),x=0;x<=o;x++)if(I=Y,Y=h[2*(x+1)+1],!(++J<G&&I===Y)){if(J<l)do{i(k,I,k.bl_tree)}while(0!==--J);else 0!==I?(I!==q&&(i(k,I,k.bl_tree),J--),i(k,16,k.bl_tree),V(k,J-3,2)):J<=10?(i(k,17,k.bl_tree),V(k,J-3,3)):(i(k,18,k.bl_tree),V(k,J-11,7));J=0,q=I,0===Y?(G=138,l=3):I===Y?(G=6,l=3):(G=7,l=4)}};let n=!1;const H=(k,h,o,x)=>{V(k,0+(x?1:0),3),((k,h,o,x)=>{Z(k),x&&(b(k,o),b(k,~o)),k.pending_buf.set(k.window.subarray(h,h+o),k.pending),k.pending+=o})(k,h,o,!0)};k.exports._tr_init=k=>{n||((()=>{let k,h,o,l,j;const d=new Array(16);for(o=0,l=0;l<28;l++)for(X[l]=o,k=0;k<1<<Y[l];k++)N[o++]=l;for(N[o-1]=l,j=0,l=0;l<16;l++)for(c[l]=j,k=0;k<1<<J[l];k++)a[j++]=l;for(j>>=7;l<I;l++)for(c[l]=j<<7,k=0;k<1<<J[l]-7;k++)a[256+j++]=l;for(h=0;h<=q;h++)d[h]=0;for(k=0;k<=143;)A[2*k+1]=8,k++,d[8]++;for(;k<=255;)A[2*k+1]=9,k++,d[9]++;for(;k<=279;)A[2*k+1]=7,k++,d[7]++;for(;k<=287;)A[2*k+1]=8,k++,d[8]++;for(R(A,287,d),k=0;k<I;k++)K[2*k+1]=5,K[2*k]=F(k,5);f=new W(A,Y,257,x,q),M=new W(K,J,0,I,q),T=new W(new Array(0),G,0,19,7)})(),n=!0),k.l_desc=new j(k.dyn_ltree,f),k.d_desc=new j(k.dyn_dtree,M),k.bl_desc=new j(k.bl_tree,T),k.bi_buf=0,k.bi_valid=0,s(k)},k.exports._tr_stored_block=H,k.exports._tr_flush_block=(k,h,x,I)=>{let q,Y,J=0;k.level>0?(2===k.strm.data_type&&(k.strm.data_type=(k=>{let h,x=4093624447;for(h=0;h<=31;h++,x>>>=1)if(1&x&&0!==k.dyn_ltree[2*h])return 0;if(0!==k.dyn_ltree[18]||0!==k.dyn_ltree[20]||0!==k.dyn_ltree[26])return 1;for(h=32;h<o;h++)if(0!==k.dyn_ltree[2*h])return 1;return 0})(k)),Q(k,k.l_desc),Q(k,k.d_desc),J=(k=>{let h;for(B(k,k.dyn_ltree,k.l_desc.max_code),B(k,k.dyn_dtree,k.d_desc.max_code),Q(k,k.bl_desc),h=18;h>=3&&0===k.bl_tree[2*l[h]+1];h--);return k.opt_len+=3*(h+1)+5+5+4,h})(k),q=k.opt_len+3+7>>>3,Y=k.static_len+3+7>>>3,Y<=q&&(q=Y)):q=Y=x+5,x+4<=q&&-1!==h?H(k,h,x,I):4===k.strategy||Y===q?(V(k,2+(I?1:0),3),U(k,A,K)):(V(k,4+(I?1:0),3),((k,h,o,x)=>{let I;for(V(k,h-257,5),V(k,o-1,5),V(k,x-4,4),I=0;I<x;I++)V(k,k.bl_tree[2*l[I]+1],3);E(k,k.dyn_ltree,h-1),E(k,k.dyn_dtree,o-1)})(k,k.l_desc.max_code+1,k.d_desc.max_code+1,J+1),U(k,k.dyn_ltree,k.dyn_dtree)),s(k),I&&Z(k)},k.exports._tr_tally=(k,h,x)=>(k.pending_buf[k.d_buf+2*k.last_lit]=h>>>8&255,k.pending_buf[k.d_buf+2*k.last_lit+1]=255&h,k.pending_buf[k.l_buf+k.last_lit]=255&x,k.last_lit++,0===h?k.dyn_ltree[2*x]++:(k.matches++,h--,k.dyn_ltree[2*(N[x]+o+1)]++,k.dyn_dtree[2*d(h)]++),k.last_lit===k.lit_bufsize-1),k.exports._tr_align=k=>{V(k,2,3),i(k,256,A),(k=>{16===k.bi_valid?(b(k,k.bi_buf),k.bi_buf=0,k.bi_valid=0):k.bi_valid>=8&&(k.pending_buf[k.pending++]=255&k.bi_buf,k.bi_buf>>=8,k.bi_valid-=8)})(k)}},12423:k=>{"use strict";k.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.ah="",this.state=null,this.data_type=2,this.adler=0}},12040:k=>{function h(k,h,o){for(var x=k.length,I=-1/0,q=1/0,Y=0;Y<x;Y++){var J=(o[0][Y]-k[Y])/h[Y],G=(o[1][Y]-k[Y])/h[Y];if(J>G){var l=J;J=G,G=l}if(G<I||J>q)return 1/0;J>I&&(I=J),G<q&&(q=G)}return I>q?1/0:I}k.exports=function(k,o,x,I){var q=h(o,x,I);if(q===1/0)k=null;else{k=k||[];for(var Y=0;Y<o.length;Y++)k[Y]=o[Y]+x[Y]*q}return k},k.exports.distance=h},13396:(k,h,o)=>{"use strict";o.d(h,{b:()=>Y});var x=o(26);const I=x.useLayoutEffect;const q=function(k){var h=(0,x.useRef)(k);return I((function(){h.current=k})),h};var Y=function(k){var h=q(k);(0,x.Jh)((function(){var k=function(k){var o;if(null!=h.current&&(o=h.current(k)),k.defaultPrevented&&(k.returnValue=""),"string"===typeof o)return k.returnValue=o,o};return window.addEventListener("beforeunload",k),function(){window.removeEventListener("beforeunload",k)}}),[])}},13345:(k,h,o)=>{"use strict";var x=o(13349),I=Array.prototype.concat,q=Array.prototype.slice,Y=k.exports=function(k){for(var h=[],o=0,Y=k.length;o<Y;o++){var J=k[o];x(J)?h=I.call(h,q.call(J)):h.push(J)}return h};Y.wrap=function(k){return function(){return k(Y(arguments))}}},13349:k=>{k.exports=function(k){return!(!k||"string"===typeof k)&&(k instanceof Array||Array.isArray(k)||k.length>=0&&(k.splice instanceof Function||Object.getOwnPropertyDescriptor(k,k.length-1)&&"String"!==k.constructor.name))}},12319:(k,h,o)=>{var x=o(12327);function I(k){for(var h,o,I=0,q=k.length,Y=0;Y<k.length;){for(h=k[Y],o=0;Y<q&&k[Y]===h;)++Y,++o;I+=x.log2(o)/7|0,I+=x.log2(h>>>0)/7|0,I+=2}return I}h.size=I,h.encode=function(k,h){h||(h=new Uint8Array(I(k)));for(var o,x,q=0,Y=h.length,J=0;J<k.length;){for(o=k[J],x=0;J<k.length&&k[J]===o;)++J,++x;for(;q<Y&&x>=128;)h[q++]=128+(127&x),x>>>=7;if(q>=Y)throw new Error("RLE buffer overflow");for(h[q++]=x,o>>>=0;q<Y&&o>=128;)h[q++]=128+(127&o),o>>>=7;if(q>=Y)throw new Error("RLE buffer overflow");h[q++]=o}return h},h.decode=function(k,h){for(var o,x,I,q,Y=h.length,J=k.length,G=0,l=0;l<J;){for(o=0,x=0;l<J&&k[l]>=128;)o+=(127&k[l++])<<x,x+=7;if(o+=k[l++]<<x,l>=J)throw new Error("RLE buffer underrun");if(G+o>Y)throw new Error("Chunk buffer overflow");for(I=0,x=0;l<J&&k[l]>=128;)I+=(127&k[l++])<<x,x+=7;if(l>=J)throw new Error("RLE buffer underrun");for(I+=k[l++]<<x,q=0;q<o;++q)h[G++]=I}return h}},12327:(k,h)=>{"use strict";function o(k){var h=32;return(k&=-k)&&h--,65535&k&&(h-=16),16711935&k&&(h-=8),252645135&k&&(h-=4),858993459&k&&(h-=2),1431655765&k&&(h-=1),h}h.INT_BITS=32,h.INT_MAX=2147483647,h.INT_MIN=-1<<31,h.sign=function(k){return(k>0)-(k<0)},h.abs=function(k){var h=k>>31;return(k^h)-h},h.min=function(k,h){return h^(k^h)&-(k<h)},h.max=function(k,h){return k^(k^h)&-(k<h)},h.isPow2=function(k){return!(k&k-1)&&!!k},h.log2=function(k){var h,o;return h=(k>65535)<<4,h|=o=((k>>>=h)>255)<<3,h|=o=((k>>>=o)>15)<<2,(h|=o=((k>>>=o)>3)<<1)|(k>>>=o)>>1},h.log10=function(k){return k>=1e9?9:k>=1e8?8:k>=1e7?7:k>=1e6?6:k>=1e5?5:k>=1e4?4:k>=1e3?3:k>=100?2:k>=10?1:0},h.popCount=function(k){return 16843009*((k=(858993459&(k-=k>>>1&1431655765))+(k>>>2&858993459))+(k>>>4)&252645135)>>>24},h.countTrailingZeros=o,h.nextPow2=function(k){return k+=0===k,--k,k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,(k|=k>>>16)+1},h.prevPow2=function(k){return k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,(k|=k>>>16)-(k>>>1)},h.parity=function(k){return k^=k>>>16,k^=k>>>8,k^=k>>>4,27030>>>(k&=15)&1};var x=new Array(256);!function(k){for(var h=0;h<256;++h){var o=h,x=h,I=7;for(o>>>=1;o;o>>>=1)x<<=1,x|=1&o,--I;k[h]=x<<I&255}}(x),h.reverse=function(k){return x[255&k]<<24|x[k>>>8&255]<<16|x[k>>>16&255]<<8|x[k>>>24&255]},h.interleave2=function(k,h){return(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k&=65535)|k<<8))|k<<4))|k<<2))|k<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))<<1},h.deinterleave2=function(k,h){return(k=65535&((k=16711935&((k=252645135&((k=858993459&((k=k>>>h&1431655765)|k>>>1))|k>>>2))|k>>>4))|k>>>16))<<16>>16},h.interleave3=function(k,h,o){return k=1227133513&((k=3272356035&((k=251719695&((k=4278190335&((k&=1023)|k<<16))|k<<8))|k<<4))|k<<2),(k|=(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<1)|(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<2},h.deinterleave3=function(k,h){return(k=1023&((k=4278190335&((k=251719695&((k=3272356035&((k=k>>>h&1227133513)|k>>>2))|k>>>4))|k>>>8))|k>>>16))<<22>>22},h.nextCombination=function(k){var h=k|k-1;return h+1|(~h&-~h)-1>>>o(k)+1}},12355:k=>{"use strict";k.exports=function(k,h,o,x){var I=self||window;try{try{var q;try{q=new I.Blob([k])}catch(l){(q=new(I.BlobBuilder||I.WebKitBlobBuilder||I.MozBlobBuilder||I.MSBlobBuilder)).append(k),q=q.getBlob()}var Y=I.URL||I.webkitURL,J=Y.createObjectURL(q),G=new I[h](J,o);return Y.revokeObjectURL(J),G}catch(l){return new I[h]("data:application/javascript,".concat(encodeURIComponent(k)),o)}}catch(l){if(!x)throw Error("Inline worker is not supported");return new I[h](x,o)}}},12030:(k,h,o)=>{"use strict";function x(k,h,o,x,I){var q={};return Object.keys(x).forEach((function(k){q[k]=x[k]})),q.enumerable=!!q.enumerable,q.configurable=!!q.configurable,("value"in q||q.initializer)&&(q.writable=!0),q=o.slice().reverse().reduce((function(o,x){return x(k,h,o)||o}),q),I&&void 0!==q.initializer&&(q.value=q.initializer?q.initializer.call(I):void 0,q.initializer=void 0),void 0===q.initializer&&(Object.defineProperty(k,h,q),q=null),q}o.d(h,{c:()=>x})},12025:(k,h,o)=>{"use strict";function x(k,h,o,x){o&&Object.defineProperty(k,h,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(x):void 0})}o.d(h,{d:()=>x})},13384:(k,h,o)=>{"use strict";o.d(h,{e:()=>Y,i:()=>K,l:()=>J,m:()=>q,q:()=>G,s:()=>I,u:()=>l,v:()=>A});var x=o(11448);class I{constructor(){this._easingMode=I.EASINGMODE_EASEIN}setEasingMode(k){const h=Math.min(Math.max(k,0),2);this._easingMode=h}getEasingMode(){return this._easingMode}easeInCore(k){throw new Error("You must implement this method")}ease(k){switch(this._easingMode){case I.EASINGMODE_EASEIN:return this.easeInCore(k);case I.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-k)}return k>=.5?.5*(1-this.easeInCore(2*(1-k)))+.5:.5*this.easeInCore(2*k)}}I.EASINGMODE_EASEIN=0,I.EASINGMODE_EASEOUT=1,I.EASINGMODE_EASEINOUT=2;class q extends I{easeInCore(k){return k=Math.max(0,Math.min(1,k)),1-Math.sqrt(1-k*k)}}class Y extends I{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=k}easeInCore(k){const h=Math.max(0,this.amplitude);return Math.pow(k,3)-k*h*Math.sin(3.141592653589793*k)}}class J extends I{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=k,this.bounciness=h}easeInCore(k){const h=Math.max(0,this.bounces);let o=this.bounciness;o<=1&&(o=1.001);const x=Math.pow(o,h),I=1-o,q=(1-x)/I+.5*x,Y=k*q,J=Math.log(-Y*(1-o)+1)/Math.log(o),G=Math.floor(J),l=G+1,A=(1-Math.pow(o,G))/(I*q),K=.5*(A+(1-Math.pow(o,l))/(I*q)),a=k-K,N=K-A;return-Math.pow(1/o,h-G)/(N*N)*(a-N)*(a+N)}}class G extends I{easeInCore(k){return k*k*k}}class l extends I{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=k,this.springiness=h}easeInCore(k){let h;const o=Math.max(0,this.oscillations),x=Math.max(0,this.springiness);return h=0==x?k:(Math.exp(x*k)-1)/(Math.exp(x)-1),h*Math.sin((6.283185307179586*o+1.5707963267948966)*k)}}class A extends I{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=k}easeInCore(k){return this.exponent<=0?k:(Math.exp(this.exponent*k)-1)/(Math.exp(this.exponent)-1)}}class K extends I{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=k,this.y1=h,this.x2=o,this.y2=x}easeInCore(k){return x.d.Interpolate(k,this.x1,this.y1,this.x2,this.y2)}}},12867:(k,h,o)=>{"use strict";o.d(h,{d:()=>Y});var x=o(11239),I=o(11256),q=o(11656);class Y extends q.c{get _matrix(){return this._compose(),this.ba}set _matrix(k){(k.updateFlag!==this.ba.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.ba.Y(k),this._markAsDirtyAndDecompose())}constructor(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(k,h.ik(),!1),this.name=k,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=h,this.ba=(null===I||void 0===I?void 0:I.clone())??x.Matrix.Identity(),this._restMatrix=q??this.ba.clone(),this._bindMatrix=Y??this.ba.clone(),this._index=J,this._absoluteMatrix=new x.Matrix,this._absoluteBindMatrix=new x.Matrix,this._absoluteInverseBindMatrix=new x.Matrix,this._finalMatrix=new x.Matrix,h.bones.push(this),this.setParent(o,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(k){this.setParent(k)}setParent(k){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==k){if(this.parent){const k=this.parent.children.indexOf(this);-1!==k&&this.parent.children.splice(k,1)}this._parentNode=k,this.parent&&this.parent.children.push(this),h&&this._updateAbsoluteBindMatrices(),this.Pl()}}getLocalMatrix(){return this._compose(),this.ba}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(k){this._restMatrix.Y(k)}setRestPose(k){this.setRestMatrix(k)}getBindPose(){return this.getBindMatrix()}setBindMatrix(k){this.qq(k)}setBindPose(k){this.setBindMatrix(k)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const k=x.TmpVectors.Vh[0],h=x.TmpVectors.Quaternion[0],o=x.TmpVectors.Vh[1];this.getRestMatrix().decompose(k,h,o),this._linkedTransformNode.position.Y(o),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??x.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.Y(h),this._linkedTransformNode.iJ.Y(k)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(k){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=k,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.CJ}set position(k){this._decompose(),this.CJ.Y(k),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(k){this.setRotation(k)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(k){this.setRotationQuaternion(k)}get iJ(){return this.getScale()}set iJ(k){this.setScale(k)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=x.Vh.Zero(),this._localRotation=x.Quaternion.Zero(),this.CJ=x.Vh.Zero()),this.ba.decompose(this._localScaling,this._localRotation,this.CJ))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,x.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.CJ,this.ba)):this._needToCompose=!1)}qq(k){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.Y(k),h&&this._updateAbsoluteBindMatrices(),o?this._matrix=k:this.Pl()}_updateAbsoluteBindMatrices(k){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(k||(k=this._bindMatrix),this.parent?k.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.Y(k),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),h)for(let o=0;o<this.children.length;o++)this.children[o]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Pl(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Pl(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Pl(),this._needToDecompose=!0}_updatePosition(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=this.getLocalMatrix();if(0==h)I?(q.addAtIndex(12,k.x),q.addAtIndex(13,k.y),q.addAtIndex(14,k.z)):q.setTranslationFromFloats(k.x,k.y,k.z);else{let h=null;o&&(h=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=Y._TmpMats[0],G=Y._TmpVecs[0];this.parent?o&&h?(J.Y(this.parent.getAbsoluteMatrix()),J.multiplyToRef(h,J)):J.Y(this.parent.getAbsoluteMatrix()):x.Matrix.IdentityToRef(J),I&&J.setTranslationFromFloats(0,0,0),J.invert(),x.Vh.TransformCoordinatesToRef(k,J,G),I?(q.addAtIndex(12,G.x),q.addAtIndex(13,G.y),q.addAtIndex(14,G.z)):q.setTranslationFromFloats(G.x,G.y,G.z)}this._markAsDirtyAndDecompose()}translate(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this._updatePosition(k,h,o,!0)}setPosition(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this._updatePosition(k,h,o,!1)}setAbsolutePosition(k,h){this.setPosition(k,1,h)}scale(k,h,o){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const q=this.getLocalMatrix(),J=Y._TmpMats[0];x.Matrix.ScalingToRef(k,h,o,J),J.multiplyToRef(q,q),J.invert();for(const x of this.children){const I=x.getLocalMatrix();I.multiplyToRef(J,I),I.multiplyAtIndex(12,k),I.multiplyAtIndex(13,h),I.multiplyAtIndex(14,o),x._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),I)for(const x of this.children)x.scale(k,h,o,I)}setScale(k){this._decompose(),this._localScaling.Y(k),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(k){this._decompose(),k.Y(this._localScaling)}setYawPitchRoll(k,h,o){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4?arguments[4]:void 0;if(0===I){const J=Y._TmpQuat;return x.Quaternion.RotationYawPitchRollToRef(k,h,o,J),void this.setRotationQuaternion(J,I,q)}const J=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,q))return;const G=Y._TmpMats[1];x.Matrix.RotationYawPitchRollToRef(k,h,o,G),J.multiplyToRef(G,G),this._rotateWithMatrix(G,I,q)}rotate(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,I=arguments.length>3?arguments[3]:void 0;const q=Y._TmpMats[0];q.setTranslationFromFloats(0,0,0),x.Matrix.RotationAxisToRef(k,h,q),this._rotateWithMatrix(q,o,I)}setAxisAngle(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,I=arguments.length>3?arguments[3]:void 0;if(0===o){const q=Y._TmpQuat;return x.Quaternion.RotationAxisToRef(k,h,q),void this.setRotationQuaternion(q,o,I)}const q=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,I))return;const J=Y._TmpMats[1];x.Matrix.RotationAxisToRef(k,h,J),q.multiplyToRef(J,J),this._rotateWithMatrix(J,o,I)}setRotation(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(k.y,k.x,k.z,h,o)}setRotationQuaternion(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(0===h)return this._decompose(),this._localRotation.Y(k),void this._markAsDirtyAndCompose();const I=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,o))return;const q=Y._TmpMats[1];x.Matrix.FromQuaternionToRef(k,q),I.multiplyToRef(q,q),this._rotateWithMatrix(q,h,o)}setRotationMatrix(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(0===h){const I=Y._TmpQuat;return x.Quaternion.FromRotationMatrixToRef(k,I),void this.setRotationQuaternion(I,h,o)}const I=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,o))return;const q=Y._TmpMats[1];q.Y(k),I.multiplyToRef(k,q),this._rotateWithMatrix(q,h,o)}_rotateWithMatrix(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const x=this.getLocalMatrix(),I=x.m[12],q=x.m[13],J=x.m[14],G=this.getParent(),l=Y._TmpMats[3],A=Y._TmpMats[4];G&&1==h?(o?(l.Y(o.getWorldMatrix()),G.getAbsoluteMatrix().multiplyToRef(l,l)):l.Y(G.getAbsoluteMatrix()),A.Y(l),A.invert(),x.multiplyToRef(l,x),x.multiplyToRef(k,x),x.multiplyToRef(A,x)):1==h&&o?(l.Y(o.getWorldMatrix()),A.Y(l),A.invert(),x.multiplyToRef(l,x),x.multiplyToRef(k,x),x.multiplyToRef(A,x)):x.multiplyToRef(k,x),x.setTranslationFromFloats(I,q,J),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(k,h){const o=Y._TmpMats[2];return k.Y(this.getAbsoluteMatrix()),h?(k.multiplyToRef(h.getWorldMatrix(),k),x.Matrix.ScalingToRef(h.iJ.x,h.iJ.y,h.iJ.z,o)):x.Matrix.IdentityToRef(o),k.invert(),!isNaN(k.m[0])&&(o.multiplyAtIndex(0,this._scalingDeterminant),k.multiplyToRef(o,k),!0)}Wh(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=x.Vh.Zero();return this.getPositionToRef(k,h,o),o}getPositionToRef(){let k=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const k=this.getLocalMatrix();h.x=k.m[12],h.y=k.m[13],h.z=k.m[14]}else{let o=null;k&&(o=k.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let x=Y._TmpMats[0];k&&o?(x.Y(this.getAbsoluteMatrix()),x.multiplyToRef(o,x)):x=this.getAbsoluteMatrix(),h.x=x.m[12],h.y=x.m[13],h.z=x.m[14]}}getAbsolutePosition(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const h=x.Vh.Zero();return this.getPositionToRef(1,k,h),h}getAbsolutePositionToRef(k,h){this.getPositionToRef(1,k,h)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.ba.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.Y(this.ba);const k=this._skeleton.getPoseMatrix();k&&this._absoluteMatrix.multiplyToRef(k,this._absoluteMatrix)}const k=this.children,h=k.length;for(let o=0;o<h;o++)k[o].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}VG(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=x.Vh.Zero();return this.getDirectionToRef(k,h,o),o}getDirectionToRef(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,I=null;h&&(I=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=Y._TmpMats[0];q.Y(this.getAbsoluteMatrix()),h&&I&&q.multiplyToRef(I,q),x.Vh.TransformNormalToRef(k,q,o),o.normalize()}getRotation(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=x.Vh.Zero();return this.getRotationToRef(k,h,o),o}getRotationToRef(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;const x=Y._TmpQuat;this.getRotationQuaternionToRef(k,h,x),x.toEulerAnglesToRef(o)}getRotationQuaternion(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=x.Quaternion.Identity();return this.getRotationQuaternionToRef(k,h,o),o}getRotationQuaternionToRef(){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),h.Y(this._localRotation);else{const o=Y._TmpMats[0],x=this.getAbsoluteMatrix();k?x.multiplyToRef(k.getWorldMatrix(),o):o.Y(x),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.decompose(void 0,h,void 0)}}getRotationMatrix(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1?arguments[1]:void 0;const o=x.Matrix.Identity();return this.getRotationMatrixToRef(k,h,o),o}getRotationMatrixToRef(){let k=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(h);else{const o=Y._TmpMats[0],x=this.getAbsoluteMatrix();k?x.multiplyToRef(k.getWorldMatrix(),o):o.Y(x),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.getRotationMatrixToRef(h)}}getAbsolutePositionFromLocal(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=x.Vh.Zero();return this.getAbsolutePositionFromLocalToRef(k,h,o),o}getAbsolutePositionFromLocalToRef(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,I=null;h&&(I=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=Y._TmpMats[0];q.Y(this.getAbsoluteMatrix()),h&&I&&q.multiplyToRef(I,q),x.Vh.TransformCoordinatesToRef(k,q,o)}getLocalPositionFromAbsolute(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=x.Vh.Zero();return this.getLocalPositionFromAbsoluteToRef(k,h,o),o}getLocalPositionFromAbsoluteToRef(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,I=null;h&&(I=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const q=Y._TmpMats[0];q.Y(this.getAbsoluteMatrix()),h&&I&&q.multiplyToRef(I,q),q.invert(),x.Vh.TransformCoordinatesToRef(k,q,o)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const k=this._skeleton.bones.indexOf(this);if(-1!==k&&this._skeleton.bones.splice(k,1),this._parentNode&&this._parentNode.children){const k=this._parentNode.children,h=k.indexOf(this);-1!==h&&k.splice(h,1)}super.dispose()}}Y._TmpVecs=(0,I.d)(2,x.Vh.Zero),Y._TmpQuat=x.Quaternion.Identity(),Y._TmpMats=(0,I.d)(5,x.Matrix.Identity)},13380:(k,h,o)=>{"use strict";o.d(h,{d:()=>Q});var x=o(11227),I=o(11233),q=o(11082),Y=o(11239),J=o(11260),G=o(11656),l=o(11696),A=o(11510),K=o(11106),a=o(11248);class N{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(k){this._zoomStopsAnimation=k}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(k){this._idleRotationSpeed=k}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(k){this._idleRotationWaitTime=k}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(k){this._idleRotationSpinupTime=k}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(k){this._attachedCamera=k;const h=this._attachedCamera.ik();this._onPrePointerObservableObserver=h.onPrePointerObservable.add((k=>{k.type!==A.b.POINTERDOWN?k.type===A.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=k.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const k=K.d.Now;let h=0;null!=this._lastFrameTime&&(h=k-this._lastFrameTime),this._lastFrameTime=k,this._applyUserInteraction();const o=k-this._lastInteractionTime-this._idleRotationWaitTime,x=Math.max(Math.min(o/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*x,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(h/1e3))}))}detach(){if(!this._attachedCamera)return;const k=this._attachedCamera.ik();this._onPrePointerObservableObserver&&k.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(k){this._lastInteractionTime=k??K.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<a.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let k=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(k=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?k:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=K.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var X=o(13384),c=o(11783);class W{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(k){if(this._autoTransitionRange===k)return;this._autoTransitionRange=k;const h=this._attachedCamera;h&&(k?this._onMeshTargetChangedObserver=h.onMeshTargetChangedObservable.add((k=>{if(k&&(k.eq(!0),k.getBoundingInfo)){const h=k.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*h,this.upperRadiusTransitionRange=.05*h}})):this._onMeshTargetChangedObserver&&h.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(k){this._attachedCamera=k,this._onAfterCheckInputsObserver=k.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(k){return!!this._attachedCamera&&(this._attachedCamera.radius===k&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(k){if(!this._attachedCamera)return;this._radiusBounceTransition||(W.EasingFunction.setEasingMode(W.EasingMode),this._radiusBounceTransition=c.c.CreateAnimation("radius",c.c.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const h=c.c.TransitionTo("radius",this._attachedCamera.radius+k,this._attachedCamera,this._attachedCamera.ik(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));h&&this._animatables.push(h)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}W.EasingFunction=new X.e(.3),W.EasingMode=X.s.EASINGMODE_EASEOUT;class f{constructor(){this.onTargetFramingAnimationEndObservable=new q.d,this._mode=f.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(k){this._mode=k}get mode(){return this._mode}set radiusScale(k){this._radiusScale=k}get radiusScale(){return this._radiusScale}set positionScale(k){this._positionScale=k}get positionScale(){return this._positionScale}set defaultElevation(k){this._defaultElevation=k}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(k){this._elevationReturnTime=k}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(k){this._elevationReturnWaitTime=k}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(k){this._zoomStopsAnimation=k}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(k){this._framingTime=k}get framingTime(){return this._framingTime}init(){}attach(k){this._attachedCamera=k;const h=this._attachedCamera.ik();f.EasingFunction.setEasingMode(f.EasingMode),this._onPrePointerObservableObserver=h.onPrePointerObservable.add((k=>{k.type!==A.b.POINTERDOWN?k.type===A.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=k.onMeshTargetChangedObservable.add((k=>{k&&k.getBoundingInfo&&this.zoomOnMesh(k,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=k.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const k=this._attachedCamera.ik();this._onPrePointerObservableObserver&&k.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;k.eq(!0);const x=k.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(x.minimumWorld,x.maximumWorld,h,o)}zoomOnMeshHierarchy(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;k.eq(!0);const x=k.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(x.min,x.max,h,o)}zoomOnMeshesHierarchy(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new Y.Vh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),I=new Y.Vh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let q=0;q<k.length;q++){const h=k[q].getHierarchyBoundingVectors(!0);Y.Vh.CheckExtends(h.min,x,I),Y.Vh.CheckExtends(h.max,x,I)}this.zoomOnBoundingInfo(x,I,h,o)}zoomOnBoundingInfo(k,h){let o,x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const q=k.y,J=q+(h.y-q)*this._positionScale,G=h.ih(k).scale(.5);if(!isFinite(J))return!1;if(x)o=new Y.Vh(0,J,0);else{const h=k.add(G);o=new Y.Vh(h.x,J,h.z)}this._vectorTransition||(this._vectorTransition=c.c.CreateAnimation("target",c.c.ANIMATIONTYPE_VECTOR3,60,f.EasingFunction)),this._betaIsAnimating=!0;let l=c.c.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.ik(),60,this._vectorTransition,this._framingTime);l&&this._animatables.push(l);let A=0;if(this._mode===f.FitFrustumSidesMode){const o=this._calculateLowerRadiusFromModelBoundingSphere(k,h);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=G.length()+this._attachedCamera.nx),A=o}else this._mode===f.IgnoreBoundsSizeMode&&(A=this._calculateLowerRadiusFromModelBoundingSphere(k,h),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.nx));if(this.autoCorrectCameraLimitsAndSensibility){const o=h.ih(k).length();this._attachedCamera.panningSensibility=5e3/o,this._attachedCamera.wheelPrecision=100/A}return this._radiusTransition||(this._radiusTransition=c.c.CreateAnimation("radius",c.c.ANIMATIONTYPE_FLOAT,60,f.EasingFunction)),l=c.c.TransitionTo("radius",A,this._attachedCamera,this._attachedCamera.ik(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),I&&I(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),l&&this._animatables.push(l),!0}_calculateLowerRadiusFromModelBoundingSphere(k,h){const o=this._attachedCamera;if(!o)return 0;let x=o._calculateLowerRadiusFromModelBoundingSphere(k,h,this._radiusScale);return o.lowerRadiusLimit&&this._mode===f.IgnoreBoundsSizeMode&&(x=x<o.lowerRadiusLimit?o.lowerRadiusLimit:x),o.upperRadiusLimit&&(x=x>o.upperRadiusLimit?o.upperRadiusLimit:x),x}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const k=K.d.Now-this._lastInteractionTime,h=.5*Math.PI-this._defaultElevation,o=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>o&&k>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=c.c.CreateAnimation("beta",c.c.ANIMATIONTYPE_FLOAT,60,f.EasingFunction));const k=c.c.TransitionTo("beta",h,this._attachedCamera,this._attachedCamera.ik(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));k&&this._animatables.push(k)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=K.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}f.EasingFunction=new X.v,f.EasingMode=X.s.EASINGMODE_EASEINOUT,f.IgnoreBoundsSizeMode=0,f.FitFrustumSidesMode=1;var M=o(11699),T=o(11741),j=o(12863),d=o(11078);class b{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(k){k=d.Tools.BackCompatCameraNoPreventDefault(arguments);const h=this.camera.getEngine(),o=h.getInputElement();let x=0,I=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=q=>{var Y,J;const G=q.event,l="touch"===G.pointerType;if(q.type!==A.b.POINTERMOVE&&-1===this.buttons.indexOf(G.button))return;const K=G.target;if(this._altKey=G.altKey,this._ctrlKey=G.ctrlKey,this._metaKey=G.metaKey,this._shiftKey=G.shiftKey,this._buttonsPressed=G.buttons,h.isPointerLock){const k=G.movementX,h=G.movementY;this.onTouch(null,k,h),this._pointA=null,this._pointB=null}else{if(q.type!==A.b.POINTERDOWN&&q.type!==A.b.POINTERDOUBLETAP&&l&&(null===(Y=this._pointA)||void 0===Y?void 0:Y.pointerId)!==G.pointerId&&(null===(J=this._pointB)||void 0===J?void 0:J.pointerId)!==G.pointerId)return;if(q.type!==A.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!l)if(q.type===A.b.POINTERDOUBLETAP)this.onDoubleTap(G.pointerType);else if(q.type!==A.b.POINTERUP||this._currentMousePointerIdDown!==G.pointerId&&!l){if(q.type===A.b.POINTERMOVE)if(k||G.preventDefault(),this._pointA&&null===this._pointB){const k=G.clientX-this._pointA.x,h=G.clientY-this._pointA.y;this._pointA.x=G.clientX,this._pointA.y=G.clientY,this.onTouch(this._pointA,k,h)}else if(this._pointA&&this._pointB){const k=this._pointA.pointerId===G.pointerId?this._pointA:this._pointB;k.x=G.clientX,k.y=G.clientY;const h=this._pointA.x-this._pointB.x,o=this._pointA.y-this._pointB.y,Y=h*h+o*o,J={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:G.pointerId,type:q.type};this.onMultiTouch(this._pointA,this._pointB,x,Y,I,J),I=J,x=Y}}else{try{null===K||void 0===K||K.releasePointerCapture(G.pointerId)}catch(a){}l||(this._pointB=null),h._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==G.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==G.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==x||I)&&(this.onMultiTouch(this._pointA,this._pointB,x,0,I,null),x=0,I=null),this._currentMousePointerIdDown=-1,this.onButtonUp(G),k||G.preventDefault()}else{try{null===K||void 0===K||K.setPointerCapture(G.pointerId)}catch(a){}if(null===this._pointA)this._pointA={x:G.clientX,y:G.clientY,pointerId:G.pointerId,type:G.pointerType};else{if(null!==this._pointB)return;this._pointB={x:G.clientX,y:G.clientY,pointerId:G.pointerId,type:G.pointerType}}-1!==this._currentMousePointerIdDown||l||(this._currentMousePointerIdDown=G.pointerId),this.onButtonDown(G),k||(G.preventDefault(),o&&o.focus())}}},this._observer=this.camera.ik()._inputManager._addCameraPointerObserver(this._pointerInput,A.b.POINTERDOWN|A.b.POINTERUP|A.b.POINTERMOVE|A.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,x=0,I=null,this.onLostFocus()},this._contextMenuBind=k=>this.onContextMenu(k),o&&o.addEventListener("contextmenu",this._contextMenuBind,!1);const q=this.camera.ik().getEngine().getHostWindow();q&&d.Tools.RegisterTopRootEvents(q,[{name:"blur",handler:this._onLostFocus}])}QK(){if(this._onLostFocus){const k=this.camera.ik().getEngine().getHostWindow();k&&d.Tools.UnregisterTopRootEvents(k,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.ik()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const k=this.camera.ik().getEngine().getInputElement();k&&k.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(k){}onTouch(k,h,o){}onMultiTouch(k,h,o,x,I,q){}onContextMenu(k){k.preventDefault()}onButtonDown(k){}onButtonUp(k){}onLostFocus(){}}(0,x.d)([(0,I.E)()],b.prototype,"buttons",void 0);class V extends b{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(k,h){if(0!==this.panningSensibility&&k&&h){const o=h.x-k.x,x=h.y-k.y;this.camera.inertialPanningX+=-o/this.panningSensibility,this.camera.inertialPanningY+=x/this.panningSensibility}}_computePinchZoom(k,h){const o=this.camera.radius||V.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=o*Math.sqrt(k)/Math.sqrt(h):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(h-k)*o*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(h-k)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(k,h,o){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility):(this.camera.inertialAlphaOffset-=h/this.angularSensibilityX,this.camera.inertialBetaOffset-=o/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(k,h,o,x,I,q){0===o&&null===I||0===x&&null===q||(this.multiTouchPanAndZoom?(this._computePinchZoom(o,x),this._computeMultiTouchPanning(I,q)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(x)-Math.sqrt(o))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(o,x),this._isPinching=!0):this._computeMultiTouchPanning(I,q)):this.multiTouchPanning?this._computeMultiTouchPanning(I,q):this.pinchZoom&&this._computePinchZoom(o,x))}onButtonDown(k){this._isPanClick=k.button===this.camera._panningMouseButton}onButtonUp(k){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}V.MinimumRadiusForPinch=.001,(0,x.d)([(0,I.E)()],V.prototype,"buttons",void 0),(0,x.d)([(0,I.E)()],V.prototype,"angularSensibilityX",void 0),(0,x.d)([(0,I.E)()],V.prototype,"angularSensibilityY",void 0),(0,x.d)([(0,I.E)()],V.prototype,"pinchPrecision",void 0),(0,x.d)([(0,I.E)()],V.prototype,"pinchDeltaPercentage",void 0),(0,x.d)([(0,I.E)()],V.prototype,"useNaturalPinchZoom",void 0),(0,x.d)([(0,I.E)()],V.prototype,"pinchZoom",void 0),(0,x.d)([(0,I.E)()],V.prototype,"panningSensibility",void 0),(0,x.d)([(0,I.E)()],V.prototype,"multiTouchPanning",void 0),(0,x.d)([(0,I.E)()],V.prototype,"multiTouchPanAndZoom",void 0),j.c.ArcRotateCameraPointersInput=V;var i=o(11515);class F{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(k){k=d.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ik(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((h=>{const o=h.event;if(!o.metaKey)if(h.type===i.c.KEYDOWN){if(this._ctrlPressed=o.ctrlKey,this._altPressed=o.altKey,-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysReset.indexOf(o.keyCode)){-1===this._keys.indexOf(o.keyCode)&&this._keys.push(o.keyCode),o.preventDefault&&(k||o.preventDefault())}}else if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysReset.indexOf(o.keyCode)){const h=this._keys.indexOf(o.keyCode);h>=0&&this._keys.splice(h,1),o.preventDefault&&(k||o.preventDefault())}})))}QK(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const k=this.camera;for(let h=0;h<this._keys.length;h++){const o=this._keys[h];-1!==this.keysLeft.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?k.inertialPanningX-=1/this.panningSensibility:k.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?k.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?k.inertialRadiusOffset+=1/this.zoomingSensibility:k.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?k.inertialPanningX+=1/this.panningSensibility:k.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?k.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?k.inertialRadiusOffset-=1/this.zoomingSensibility:k.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(o)&&k.useInputToRestoreState&&k.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,x.d)([(0,I.E)()],F.prototype,"keysUp",void 0),(0,x.d)([(0,I.E)()],F.prototype,"keysDown",void 0),(0,x.d)([(0,I.E)()],F.prototype,"keysLeft",void 0),(0,x.d)([(0,I.E)()],F.prototype,"keysRight",void 0),(0,x.d)([(0,I.E)()],F.prototype,"keysReset",void 0),(0,x.d)([(0,I.E)()],F.prototype,"panningSensibility",void 0),(0,x.d)([(0,I.E)()],F.prototype,"zoomingSensibility",void 0),(0,x.d)([(0,I.E)()],F.prototype,"useAltToZoom",void 0),(0,x.d)([(0,I.E)()],F.prototype,"angularSpeed",void 0),j.c.ArcRotateCameraKeyboardMoveInput=F;var R=o(11288),s=o(11519);class Z{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Y.Vh(0,0,0),this._globalOffset=new Y.Vh(0,0,0),this._inertialPanning=Y.Vh.Zero()}_computeDeltaFromMouseWheelLegacyEvent(k,h){let o=0;const x=.01*k*this.wheelDeltaPercentage*h;return o=k>0?x/(1+this.wheelDeltaPercentage):x*(1+this.wheelDeltaPercentage),o}attachControl(k){k=d.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=h=>{if(h.type!==A.b.POINTERWHEEL)return;const o=h.event;let x=0;const I=o.deltaMode===s.d.DOM_DELTA_LINE?40:1,q=-o.deltaY*I;if(this.customComputeDeltaFromMouseWheel)x=this.customComputeDeltaFromMouseWheel(q,this,o);else if(this.wheelDeltaPercentage){if(x=this._computeDeltaFromMouseWheelLegacyEvent(q,this.camera.radius),x>0){let k=this.camera.radius,h=this.camera.inertialRadiusOffset+x;for(let o=0;o<20&&!(k<=h)&&!(Math.abs(h*this.camera.inertia)<.001);o++)k-=h,h*=this.camera.inertia;k=(0,J.Clamp)(k,0,Number.MAX_VALUE),x=this._computeDeltaFromMouseWheelLegacyEvent(q,k)}}else x=q/(40*this.wheelPrecision);x&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(x)):this.camera.inertialRadiusOffset+=x),o.preventDefault&&(k||o.preventDefault())},this._observer=this.camera.ik()._inputManager._addCameraPointerObserver(this._wheel,A.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.FJ(0)}QK(){this._observer&&(this.camera.ik()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const k=this.camera;0+k.inertialAlphaOffset+k.inertialBetaOffset+k.inertialRadiusOffset&&(this._updateHitPlane(),k.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(k.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const k=this.camera,h=k.target.ih(k.position);this._hitPlane=R.b.FromPositionAndNormal(k.target,h)}_getPosition(){const k=this.camera,h=k.ik(),o=h.createPickingRay(h.pointerX,h.pointerY,Y.Matrix.Identity(),k,!1);0===k.targetScreenOffset.x&&0===k.targetScreenOffset.y||(this._viewOffset.set(k.targetScreenOffset.x,k.targetScreenOffset.y,0),k.getViewMatrix().invertToRef(k._cameraTransformMatrix),this._globalOffset=Y.Vh.TransformNormal(this._viewOffset,k._cameraTransformMatrix),o.origin.addInPlace(this._globalOffset));let x=0;return this._hitPlane&&(x=o.intersectsPlane(this._hitPlane)??0),o.origin.addInPlace(o.direction.scaleInPlace(x))}_zoomToMouse(k){const h=this.camera,o=1-h.inertia;if(h.lowerRadiusLimit){const x=h.lowerRadiusLimit??0;h.radius-(h.inertialRadiusOffset+k)/o<x&&(k=(h.radius-x)*o-h.inertialRadiusOffset)}if(h.upperRadiusLimit){const x=h.upperRadiusLimit??0;h.radius-(h.inertialRadiusOffset+k)/o>x&&(k=(h.radius-x)*o-h.inertialRadiusOffset)}const x=k/o/h.radius,I=this._getPosition(),q=Y.TmpVectors.Vh[6];I.subtractToRef(h.target,q),q.scaleInPlace(x),q.scaleInPlace(o),this._inertialPanning.addInPlace(q),h.inertialRadiusOffset+=k}_zeroIfClose(k){Math.abs(k.x)<a.d&&(k.x=0),Math.abs(k.y)<a.d&&(k.y=0),Math.abs(k.z)<a.d&&(k.z=0)}}(0,x.d)([(0,I.E)()],Z.prototype,"wheelPrecision",void 0),(0,x.d)([(0,I.E)()],Z.prototype,"zoomToMouseLocation",void 0),(0,x.d)([(0,I.E)()],Z.prototype,"wheelDeltaPercentage",void 0),j.c.ArcRotateCameraMouseWheelInput=Z;class w extends j.g{constructor(k){super(k)}addMouseWheel(){return this.add(new Z),this}addPointers(){return this.add(new V),this}addKeyboard(){return this.add(new F),this}}var D=o(11199);function U(k,h){return isNaN(k)?h:k}G.c.AddNodeConstructor("ArcRotateCamera",((k,h)=>()=>new Q(k,0,0,1,Y.Vh.Zero(),h)));class Q extends T.e{get target(){return this._target}set target(k){this.setTarget(k)}get targetHost(){return this._targetHost}set targetHost(k){k&&this.setTarget(k)}getTarget(){return this.target}get position(){return this._position}set position(k){this.setPosition(k)}set upVector(k){this._upToYMatrix||(this._yToUpMatrix=new Y.Matrix,this._upToYMatrix=new Y.Matrix,this._upVector=Y.Vh.Zero()),k.normalize(),this._upVector.Y(k),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Y.Matrix.RotationAlignToRef(Y.Vh.UpReadOnly,this._upVector,this._yToUpMatrix),Y.Matrix.RotationAlignToRef(this._upVector,Y.Vh.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const k=this.inputs.attached.pointers;return k?k.angularSensibilityX:0}set angularSensibilityX(k){const h=this.inputs.attached.pointers;h&&(h.angularSensibilityX=k)}get angularSensibilityY(){const k=this.inputs.attached.pointers;return k?k.angularSensibilityY:0}set angularSensibilityY(k){const h=this.inputs.attached.pointers;h&&(h.angularSensibilityY=k)}get pinchPrecision(){const k=this.inputs.attached.pointers;return k?k.pinchPrecision:0}set pinchPrecision(k){const h=this.inputs.attached.pointers;h&&(h.pinchPrecision=k)}get pinchDeltaPercentage(){const k=this.inputs.attached.pointers;return k?k.pinchDeltaPercentage:0}set pinchDeltaPercentage(k){const h=this.inputs.attached.pointers;h&&(h.pinchDeltaPercentage=k)}get useNaturalPinchZoom(){const k=this.inputs.attached.pointers;return!!k&&k.useNaturalPinchZoom}set useNaturalPinchZoom(k){const h=this.inputs.attached.pointers;h&&(h.useNaturalPinchZoom=k)}get panningSensibility(){const k=this.inputs.attached.pointers;return k?k.panningSensibility:0}set panningSensibility(k){const h=this.inputs.attached.pointers;h&&(h.panningSensibility=k)}get keysUp(){const k=this.inputs.attached.keyboard;return k?k.keysUp:[]}set keysUp(k){const h=this.inputs.attached.keyboard;h&&(h.keysUp=k)}get keysDown(){const k=this.inputs.attached.keyboard;return k?k.keysDown:[]}set keysDown(k){const h=this.inputs.attached.keyboard;h&&(h.keysDown=k)}get keysLeft(){const k=this.inputs.attached.keyboard;return k?k.keysLeft:[]}set keysLeft(k){const h=this.inputs.attached.keyboard;h&&(h.keysLeft=k)}get keysRight(){const k=this.inputs.attached.keyboard;return k?k.keysRight:[]}set keysRight(k){const h=this.inputs.attached.keyboard;h&&(h.keysRight=k)}get wheelPrecision(){const k=this.inputs.attached.mousewheel;return k?k.wheelPrecision:0}set wheelPrecision(k){const h=this.inputs.attached.mousewheel;h&&(h.wheelPrecision=k)}get zoomToMouseLocation(){const k=this.inputs.attached.mousewheel;return!!k&&k.zoomToMouseLocation}set zoomToMouseLocation(k){const h=this.inputs.attached.mousewheel;h&&(h.zoomToMouseLocation=k)}get wheelDeltaPercentage(){const k=this.inputs.attached.mousewheel;return k?k.wheelDeltaPercentage:0}set wheelDeltaPercentage(k){const h=this.inputs.attached.mousewheel;h&&(h.wheelDeltaPercentage=k)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(k){k!==this.useBouncingBehavior&&(k?(this._bouncingBehavior=new W,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(k){k!==this.useFramingBehavior&&(k?(this._framingBehavior=new f,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(k){k!==this.useAutoRotationBehavior&&(k?(this._autoRotationBehavior=new N,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(k,h,o,x,I,J){var G;let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(k,Y.Vh.Zero(),J,l),G=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Y.Vh.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Y.Matrix,this.panningAxis=new Y.Vh(1,1,0),this._transformedDirection=new Y.Vh,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new q.d,this.checkCollisions=!1,this.collisionRadius=new Y.Vh(.5,.5,.5),this._previousPosition=Y.Vh.Zero(),this._collisionVelocity=Y.Vh.Zero(),this._newPosition=Y.Vh.Zero(),this._computationVector=Y.Vh.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Y.Vh(NaN,NaN,NaN),this._goalTargetScreenOffset=new Y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o?(G.setPosition(h),G.WN&&G.WN(o)):G._previousPosition.Y(G._position);const x=Math.cos(G.alpha),I=Math.sin(G.alpha),q=Math.cos(G.beta);let Y=Math.sin(G.beta);0===Y&&(Y=1e-4);const J=G._getTargetPosition();G._computationVector.VJ(G.radius*x*Y,G.radius*q,G.radius*I*Y),J.addToRef(G._computationVector,G._newPosition),G._position.Y(G._newPosition);let l=G.upVector;G.allowUpsideDown&&G.beta<0&&(l=l.clone(),l=l.negate()),G._computeViewMatrix(G._position,J,l),G._viewMatrix.addAtIndex(12,G.targetScreenOffset.x),G._viewMatrix.addAtIndex(13,G.targetScreenOffset.y),G._collisionTriggered=!1},this._target=Y.Vh.Zero(),I&&this.setTarget(I),this.alpha=h,this.beta=o,this.radius=x,this.getViewMatrix(),this.inputs=new w(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Y.Vh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Y.Vector2.Zero()}_updateCache(k){k||super._updateCache(),this._cache._target.Y(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.Y(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const k=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?k.addToRef(this._targetBoundingCenter,this._target):this._target.Y(k)}const k=this._getLockedTargetPosition();return k||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>a.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,q=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=q?this._currentInterpolationFactor=q:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=U(k,this._goalAlpha),this._goalBeta=U(h,this._goalBeta),this._goalRadius=U(o,this._goalRadius),this._goalTarget.set(U(x.x,this._goalTarget.x),U(x.y,this._goalTarget.y),U(x.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(U(I.x,this._goalTargetScreenOffset.x),U(I.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,J.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,J.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,J.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,J.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(k,h){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const I=arguments;h=d.Tools.BackCompatCameraNoPreventDefault(I),this._useCtrlForPanning=o,this._panningMouseButton=x,"boolean"===typeof I[0]&&(I.length>1&&(this._useCtrlForPanning=I[1]),I.length>2&&(this._panningMouseButton=I[2])),this.inputs.attachElement(h),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}QK(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let k=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){k=!0;const h=this.invertRotation?-1:1,o=this._calculateHandednessMultiplier();let x=this.inertialAlphaOffset*o;this.beta<0&&(x*=-1),this.alpha+=x*h,this.beta+=this.inertialBetaOffset*h,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<a.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<a.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*a.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){k=!0;const h=new Y.Vh(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),h.multiplyInPlace(this.panningAxis),Y.Vh.TransformNormalToRef(h,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const k=this.upVector,h=Y.Vh.CrossToRef(this._transformedDirection,k,this._transformedDirection);Y.Vh.CrossToRef(k,h,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Y.Vh.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.Y(this._transformedDirection)}else{if(this.parent){const k=Y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(k),k.transposeToRef(k),Y.Vh.TransformCoordinatesToRef(this._transformedDirection,k,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*a.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*a.d&&(this.inertialPanningY=0)}if(k)this.stopInterpolation();else if(this._isInterpolating){let k=!1;const h=this._scene.getEngine().getDeltaTime()/1e3,o=1-Math.pow(2,-h/this._currentInterpolationFactor),x=U(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const h=Y.TmpVectors.Vh[0].set(U(this._goalTarget.x,this._target.x),U(this._goalTarget.y,this._target.y),U(this._goalTarget.z,this._target.z));Y.Vh.LerpToRef(this.target,h,o,this._target),10*Y.Vh.Distance(this.target,h)/x<a.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.Y(h),this.setTarget(this.target,!1,!0,!0)):k=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const h=Y.Quaternion.RotationAlphaBetaGammaToRef(U(this._goalAlpha,this.alpha),U(this._goalBeta,this.beta),0,Y.TmpVectors.Quaternion[0]),x=Y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Y.TmpVectors.Quaternion[1]),I=Y.Quaternion.SlerpToRef(x,h,o,Y.TmpVectors.Quaternion[2]);I.normalize();const q=I.toAlphaBetaGammaToRef(Y.TmpVectors.Vh[0]);if(this.alpha=q.x,this.beta=q.y,I.isApprox(h,a.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const k=h.toAlphaBetaGammaToRef(Y.TmpVectors.Vh[0]);this.alpha=k.x,this.beta=k.y}else k=!0}if(isNaN(this._goalRadius)||(this.radius+=(x-this.radius)*o,Math.abs(x/this.radius-1)<a.d?(this._goalRadius=NaN,this.radius=x):k=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const h=Y.TmpVectors.Vector2[0].set(U(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),U(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Y.Vector2.LerpToRef(this.targetScreenOffset,h,o,this.targetScreenOffset),Y.Vector2.Distance(this.targetScreenOffset,h)<a.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.Y(h)):k=!0}this._isInterpolating=k}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.Vh.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const k=this.alpha;var h,o;this.alpha=function(k){let h=Math.PI/2;return 0===k.x&&0===k.z||(h=Math.acos(k.x/Math.sqrt(Math.pow(k.x,2)+Math.pow(k.z,2)))),k.z<0&&(h=2*Math.PI-h),h}(this._computationVector),this.beta=(h=this._computationVector.y,o=this.radius,Math.acos(h/o));const x=Math.round((k-this.alpha)/(2*Math.PI));this.alpha+=2*x*Math.PI,this._checkLimits()}setPosition(k){this._position.equals(k)||(this._position.Y(k),this.rebuildAnglesAndRadius())}setTarget(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(x=this.overrideCloneAlphaBetaRadius??x,k.eq)h&&k.getBoundingInfo?this._targetBoundingCenter=k.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,k.eq(),this._targetHost=k,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const h=k,x=this._getTargetPosition();if(x&&!o&&x.equals(h))return;this._targetHost=null,this._target=h,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}x||this.rebuildAnglesAndRadius()}_getViewMatrix(){const k=Math.cos(this.alpha),h=Math.sin(this.alpha),o=Math.cos(this.beta);let x=Math.sin(this.beta);0===x&&(x=1e-4),0===this.radius&&(this.radius=1e-4);const I=this._getTargetPosition();if(this._computationVector.VJ(this.radius*k*x,this.radius*o,this.radius*h*x),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.Vh.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),I.addToRef(this._computationVector,this._newPosition),this.ik().collisionsEnabled&&this.checkCollisions){const k=this.ik().collisionCoordinator;this._collider||(this._collider=k.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,k.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.Y(this._newPosition);let k=this.upVector;this.allowUpsideDown&&x<0&&(k=k.negate()),this._computeViewMatrix(this._position,I,k),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.Y(I),this._viewMatrix}zoomOn(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k=k||this.ik().meshes;const o=l.e.MinMax(k);let x=this._calculateLowerRadiusFromModelBoundingSphere(o.min,o.max);if(x=Math.max(Math.min(x,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=x*this.zoomOnFactor,this.mode===M.d.ORTHOGRAPHIC_CAMERA){const k=this.ik().getEngine().getAspectRatio(this),h=x*this.zoomOnFactor/2;this.orthoLeft=-h*k,this.orthoRight=h*k,this.orthoBottom=-h,this.orthoTop=h}this.focusOn({min:o.min,max:o.max,distance:x},h)}focusOn(k){let h,o,x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===k.min){const x=k||this.ik().meshes;h=l.e.MinMax(x),o=Y.Vh.Distance(h.min,h.max)}else{h=k,o=k.distance}this._target=l.e.Center(h),x||(this.maxZ=2*o)}createRigCamera(k,h){let o=0;switch(this.cameraRigMode){case M.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case M.d.RIG_MODE_VR:o=this._cameraRigParams.stereoHalfAngle*(0===h?1:-1);break;case M.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:o=this._cameraRigParams.stereoHalfAngle*(0===h?-1:1)}const x=new Q(k,this.alpha+o,this.beta,this.radius,this._target,this.ik());return x._cameraRigParams={},x.isRigCamera=!0,x.rigParent=this,x.upVector=this.upVector,x.mode=this.mode,x.orthoLeft=this.orthoLeft,x.orthoRight=this.orthoRight,x.orthoBottom=this.orthoBottom,x.orthoTop=this.orthoTop,x}_updateRigCameras(){const k=this._rigCameras[0],h=this._rigCameras[1];switch(k.beta=h.beta=this.beta,this.cameraRigMode){case M.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case M.d.RIG_MODE_VR:k.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,h.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case M.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:k.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,h.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const x=Y.Vh.Distance(k,h),I=this.ik().getEngine().getAspectRatio(this),q=Math.tan(this.fov/2),J=q*I,G=.5*x*o,l=G*Math.sqrt(1+1/(J*J)),A=G*Math.sqrt(1+1/(q*q));return Math.max(l,A)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,x.d)([(0,I.E)()],Q.prototype,"alpha",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"beta",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"radius",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,x.d)([(0,I.D)("target")],Q.prototype,"_target",void 0),(0,x.d)([(0,I.v)("targetHost")],Q.prototype,"_targetHost",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"inertialAlphaOffset",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"inertialBetaOffset",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"inertialRadiusOffset",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"lowerAlphaLimit",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"upperAlphaLimit",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"lowerBetaLimit",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"upperBetaLimit",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"lowerRadiusLimit",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"upperRadiusLimit",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"lowerTargetYLimit",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"inertialPanningX",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"inertialPanningY",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"pinchToPanMaxDistance",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"panningDistanceLimit",void 0),(0,x.d)([(0,I.D)()],Q.prototype,"panningOriginTarget",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"panningInertia",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"zoomToMouseLocation",null),(0,x.d)([(0,I.E)()],Q.prototype,"zoomOnFactor",void 0),(0,x.d)([(0,I.A)()],Q.prototype,"targetScreenOffset",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"allowUpsideDown",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"useInputToRestoreState",void 0),(0,x.d)([(0,I.E)()],Q.prototype,"restoreStateInterpolationFactor",void 0),(0,D.g)("BABYLON.ArcRotateCamera",Q)},12863:(k,h,o)=>{"use strict";o.d(h,{c:()=>Y,g:()=>J});var x=o(11098),I=o(11271),q=o(11699),Y={};class J{constructor(k){this.attachedToElement=!1,this.attached={},this.camera=k,this.checkInputs=()=>{}}add(k){const h=k.getSimpleName();this.attached[h]?x.c.Warn("camera input of type "+h+" already exists on camera"):(this.attached[h]=k,k.camera=this.camera,k.checkInputs&&(this.checkInputs=this._addCheckInputs(k.checkInputs.bind(k))),this.attachedToElement&&k.attachControl(this.noPreventDefault))}remove(k){for(const h in this.attached){const o=this.attached[h];if(o===k)return o.QK(),o.camera=null,delete this.attached[h],void this.rebuildInputCheck()}}removeByType(k){for(const h in this.attached){const o=this.attached[h];o.getClassName()===k&&(o.QK(),o.camera=null,delete this.attached[h],this.rebuildInputCheck())}}_addCheckInputs(k){const h=this.checkInputs;return()=>{h(),k()}}attachInput(k){this.attachedToElement&&k.attachControl(this.noPreventDefault)}attachElement(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){k=!q.d.ForceAttachControlToAlwaysPreventDefault&&k,this.attachedToElement=!0,this.noPreventDefault=k;for(const h in this.attached)this.attached[h].attachControl(k)}}detachElement(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const h in this.attached)this.attached[h].QK(),k&&(this.attached[h].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const k in this.attached){const h=this.attached[k];h.checkInputs&&(this.checkInputs=this._addCheckInputs(h.checkInputs.bind(h)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(k){const h={};for(const o in this.attached){const k=this.attached[o],x=I.c.Serialize(k);h[k.getClassName()]=x}k.inputsmgr=h}parse(k){const h=k.inputsmgr;if(h){this.clear();for(const k in h){const o=Y[k];if(o){const x=h[k],q=I.c.Parse((()=>new o),x,null);this.add(q)}}}else for(const o in this.attached){const h=Y[this.attached[o].getClassName()];if(h){const x=I.c.Parse((()=>new h),k,null);this.remove(this.attached[o]),this.add(x)}}}}},12860:(k,h,o)=>{"use strict";o.d(h,{b:()=>b});var x=o(11227),I=o(11233),q=o(11239),Y=o(11741),J=o(12863),G=o(11515),l=o(11078);class A{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(k){k=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ik(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((h=>{const o=h.event;if(!o.metaKey)if(h.type===G.c.KEYDOWN){if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysUpward.indexOf(o.keyCode)||-1!==this.keysDownward.indexOf(o.keyCode)||-1!==this.keysRotateLeft.indexOf(o.keyCode)||-1!==this.keysRotateRight.indexOf(o.keyCode)||-1!==this.keysRotateUp.indexOf(o.keyCode)||-1!==this.keysRotateDown.indexOf(o.keyCode)){-1===this._keys.indexOf(o.keyCode)&&this._keys.push(o.keyCode),k||o.preventDefault()}}else if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysUpward.indexOf(o.keyCode)||-1!==this.keysDownward.indexOf(o.keyCode)||-1!==this.keysRotateLeft.indexOf(o.keyCode)||-1!==this.keysRotateRight.indexOf(o.keyCode)||-1!==this.keysRotateUp.indexOf(o.keyCode)||-1!==this.keysRotateDown.indexOf(o.keyCode)){const h=this._keys.indexOf(o.keyCode);h>=0&&this._keys.splice(h,1),k||o.preventDefault()}})))}QK(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const k=this.camera;for(let h=0;h<this._keys.length;h++){const o=this._keys[h],x=k._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(o)?k._localDirection.VJ(-x,0,0):-1!==this.keysUp.indexOf(o)?k._localDirection.VJ(0,0,x):-1!==this.keysRight.indexOf(o)?k._localDirection.VJ(x,0,0):-1!==this.keysDown.indexOf(o)?k._localDirection.VJ(0,0,-x):-1!==this.keysUpward.indexOf(o)?k._localDirection.VJ(0,x,0):-1!==this.keysDownward.indexOf(o)?k._localDirection.VJ(0,-x,0):-1!==this.keysRotateLeft.indexOf(o)?(k._localDirection.VJ(0,0,0),k.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(o)?(k._localDirection.VJ(0,0,0),k.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(o)?(k._localDirection.VJ(0,0,0),k.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(o)&&(k._localDirection.VJ(0,0,0),k.cameraRotation.x+=this._getLocalRotation()),k.ik().useRightHandedSystem&&(k._localDirection.z*=-1),k.getViewMatrix().invertToRef(k._cameraTransformMatrix),q.Vh.TransformNormalToRef(k._localDirection,k._cameraTransformMatrix,k._transformedDirection),k.cameraDirection.addInPlace(k._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const k=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*k}}(0,x.d)([(0,I.E)()],A.prototype,"keysUp",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysUpward",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysDown",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysDownward",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysLeft",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysRight",void 0),(0,x.d)([(0,I.E)()],A.prototype,"rotationSpeed",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysRotateLeft",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysRotateRight",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysRotateUp",void 0),(0,x.d)([(0,I.E)()],A.prototype,"keysRotateDown",void 0),J.c.FreeCameraKeyboardMoveInput=A;var K=o(11082),a=o(11510);class N{constructor(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=k,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new K.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(k){k=l.Tools.BackCompatCameraNoPreventDefault(arguments);const h=this.camera.getEngine(),o=h.getInputElement();this._pointerInput||(this._pointerInput=x=>{const I=x.event,q="touch"===I.pointerType;if(!this.touchEnabled&&q)return;if(x.type!==a.b.POINTERMOVE&&-1===this.buttons.indexOf(I.button))return;const Y=I.target;if(x.type===a.b.POINTERDOWN){if(q&&-1!==this._activePointerId||!q&&-1!==this._currentActiveButton)return;this._activePointerId=I.pointerId;try{null===Y||void 0===Y||Y.setPointerCapture(I.pointerId)}catch(J){}-1===this._currentActiveButton&&(this._currentActiveButton=I.button),this._previousPosition={x:I.clientX,y:I.clientY},k||(I.preventDefault(),o&&o.focus()),h.isPointerLock&&this._onMouseMove&&this._onMouseMove(x.event)}else if(x.type===a.b.POINTERUP){if(q&&this._activePointerId!==I.pointerId||!q&&this._currentActiveButton!==I.button)return;try{null===Y||void 0===Y||Y.releasePointerCapture(I.pointerId)}catch(J){}this._currentActiveButton=-1,this._previousPosition=null,k||I.preventDefault(),this._activePointerId=-1}else if(x.type===a.b.POINTERMOVE&&(this._activePointerId===I.pointerId||!q))if(h.isPointerLock&&this._onMouseMove)this._onMouseMove(x.event);else if(this._previousPosition){const h=this.camera._calculateHandednessMultiplier(),o=(I.clientX-this._previousPosition.x)*h,x=I.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=o/this.angularSensibility,this.camera.cameraRotation.x+=x/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:o,offsetY:x}),this._previousPosition={x:I.clientX,y:I.clientY},k||I.preventDefault()}}),this._onMouseMove=o=>{if(!h.isPointerLock)return;const x=this.camera._calculateHandednessMultiplier(),I=o.movementX*x;this.camera.cameraRotation.y+=I/this.angularSensibility;const q=o.movementY;this.camera.cameraRotation.x+=q/this.angularSensibility,this._previousPosition=null,k||o.preventDefault()},this._observer=this.camera.ik()._inputManager._addCameraPointerObserver(this._pointerInput,a.b.POINTERDOWN|a.b.POINTERUP|a.b.POINTERMOVE),o&&(this._contextMenuBind=k=>this.onContextMenu(k),o.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(k){k.preventDefault()}QK(){if(this._observer){if(this.camera.ik()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const k=this.camera.getEngine().getInputElement();k&&k.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,x.d)([(0,I.E)()],N.prototype,"buttons",void 0),(0,x.d)([(0,I.E)()],N.prototype,"angularSensibility",void 0),J.c.FreeCameraMouseInput=N;var X,c=o(11519);class W{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new K.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(k){k=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=h=>{if(h.type!==a.b.POINTERWHEEL)return;const o=h.event,x=o.deltaMode===c.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*x*o.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*x*o.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*x*o.deltaZ/this._normalize,o.preventDefault&&(k||o.preventDefault())},this._observer=this.camera.ik()._inputManager._addCameraPointerObserver(this._wheel,a.b.POINTERWHEEL)}QK(){this._observer&&(this.camera.ik()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,x.d)([(0,I.E)()],W.prototype,"wheelPrecisionX",void 0),(0,x.d)([(0,I.E)()],W.prototype,"wheelPrecisionY",void 0),(0,x.d)([(0,I.E)()],W.prototype,"wheelPrecisionZ",void 0),function(k){k[k.MoveRelative=0]="MoveRelative",k[k.RotateRelative=1]="RotateRelative",k[k.MoveScene=2]="MoveScene"}(X||(X={}));class f extends W{constructor(){super(...arguments),this._moveRelative=q.Vh.Zero(),this._rotateRelative=q.Vh.Zero(),this._moveScene=q.Vh.Zero(),this._wheelXAction=X.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=X.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(k){null===k&&this._wheelXAction!==X.MoveRelative||(this._wheelXAction=X.MoveRelative,this._wheelXActionCoordinate=k)}get wheelXMoveRelative(){return this._wheelXAction!==X.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(k){null===k&&this._wheelYAction!==X.MoveRelative||(this._wheelYAction=X.MoveRelative,this._wheelYActionCoordinate=k)}get wheelYMoveRelative(){return this._wheelYAction!==X.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(k){null===k&&this._wheelZAction!==X.MoveRelative||(this._wheelZAction=X.MoveRelative,this._wheelZActionCoordinate=k)}get wheelZMoveRelative(){return this._wheelZAction!==X.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(k){null===k&&this._wheelXAction!==X.RotateRelative||(this._wheelXAction=X.RotateRelative,this._wheelXActionCoordinate=k)}get wheelXRotateRelative(){return this._wheelXAction!==X.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(k){null===k&&this._wheelYAction!==X.RotateRelative||(this._wheelYAction=X.RotateRelative,this._wheelYActionCoordinate=k)}get wheelYRotateRelative(){return this._wheelYAction!==X.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(k){null===k&&this._wheelZAction!==X.RotateRelative||(this._wheelZAction=X.RotateRelative,this._wheelZActionCoordinate=k)}get wheelZRotateRelative(){return this._wheelZAction!==X.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(k){null===k&&this._wheelXAction!==X.MoveScene||(this._wheelXAction=X.MoveScene,this._wheelXActionCoordinate=k)}get wheelXMoveScene(){return this._wheelXAction!==X.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(k){null===k&&this._wheelYAction!==X.MoveScene||(this._wheelYAction=X.MoveScene,this._wheelYActionCoordinate=k)}get wheelYMoveScene(){return this._wheelYAction!==X.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(k){null===k&&this._wheelZAction!==X.MoveScene||(this._wheelZAction=X.MoveScene,this._wheelZActionCoordinate=k)}get wheelZMoveScene(){return this._wheelZAction!==X.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.FJ(0),this._rotateRelative.FJ(0),this._moveScene.FJ(0),this._updateCamera(),this.camera.ik().useRightHandedSystem&&(this._moveRelative.z*=-1);const k=q.Matrix.Zero();this.camera.getViewMatrix().invertToRef(k);const h=q.Vh.Zero();q.Vh.TransformNormalToRef(this._moveRelative,k,h),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(h),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(k,h,o){if(0===k)return;if(null===h||null===o)return;let x=null;switch(h){case X.MoveRelative:x=this._moveRelative;break;case X.RotateRelative:x=this._rotateRelative;break;case X.MoveScene:x=this._moveScene}switch(o){case 0:x.set(k,0,0);break;case 1:x.set(0,k,0);break;case 2:x.set(0,0,k)}}}(0,x.d)([(0,I.E)()],f.prototype,"wheelXMoveRelative",null),(0,x.d)([(0,I.E)()],f.prototype,"wheelYMoveRelative",null),(0,x.d)([(0,I.E)()],f.prototype,"wheelZMoveRelative",null),(0,x.d)([(0,I.E)()],f.prototype,"wheelXRotateRelative",null),(0,x.d)([(0,I.E)()],f.prototype,"wheelYRotateRelative",null),(0,x.d)([(0,I.E)()],f.prototype,"wheelZRotateRelative",null),(0,x.d)([(0,I.E)()],f.prototype,"wheelXMoveScene",null),(0,x.d)([(0,I.E)()],f.prototype,"wheelYMoveScene",null),(0,x.d)([(0,I.E)()],f.prototype,"wheelZMoveScene",null),J.c.FreeCameraMouseWheelInput=f;class M{constructor(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=k,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=l.Tools.IsSafari()}attachControl(k){k=l.Tools.BackCompatCameraNoPreventDefault(arguments);let h=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=o=>{const x=o.event,I="mouse"===x.pointerType||this._isSafari&&"undefined"===typeof x.pointerType;if(this.allowMouse||!I)if(o.type===a.b.POINTERDOWN){if(k||x.preventDefault(),this._pointerPressed.push(x.pointerId),1!==this._pointerPressed.length)return;h={x:x.clientX,y:x.clientY}}else if(o.type===a.b.POINTERUP){k||x.preventDefault();const o=this._pointerPressed.indexOf(x.pointerId);if(-1===o)return;if(this._pointerPressed.splice(o,1),0!=o)return;h=null,this._offsetX=null,this._offsetY=null}else if(o.type===a.b.POINTERMOVE){if(k||x.preventDefault(),!h)return;if(0!=this._pointerPressed.indexOf(x.pointerId))return;this._offsetX=x.clientX-h.x,this._offsetY=-(x.clientY-h.y)}}),this._observer=this.camera.ik()._inputManager._addCameraPointerObserver(this._pointerInput,a.b.POINTERDOWN|a.b.POINTERUP|a.b.POINTERMOVE),this._onLostFocus){const k=this.camera.getEngine().getInputElement();k&&k.addEventListener("blur",this._onLostFocus)}}QK(){if(this._pointerInput){if(this._observer&&(this.camera.ik()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const k=this.camera.getEngine().getInputElement();k&&k.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const k=this.camera,h=k._calculateHandednessMultiplier();k.cameraRotation.y=h*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)k.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const h=k._computeLocalCameraSpeed(),o=new q.Vh(0,0,0!==this.touchMoveSensibility?h*this._offsetY/this.touchMoveSensibility:0);q.Matrix.RotationYawPitchRollToRef(k.rotation.y,k.rotation.x,0,k._cameraRotationMatrix),k.cameraDirection.addInPlace(q.Vh.TransformCoordinates(o,k._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,x.d)([(0,I.E)()],M.prototype,"touchAngularSensibility",void 0),(0,x.d)([(0,I.E)()],M.prototype,"touchMoveSensibility",void 0),J.c.FreeCameraTouchInput=M;class T extends J.g{constructor(k){super(k),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new A),this}addMouse(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new N(k),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new f,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new M),this}clear(){super.clear(),this._mouseInput=null}}var j=o(11199),d=o(11151);class b extends Y.e{get angularSensibility(){const k=this.inputs.attached.mouse;return k?k.angularSensibility:0}set angularSensibility(k){const h=this.inputs.attached.mouse;h&&(h.angularSensibility=k)}get keysUp(){const k=this.inputs.attached.keyboard;return k?k.keysUp:[]}set keysUp(k){const h=this.inputs.attached.keyboard;h&&(h.keysUp=k)}get keysUpward(){const k=this.inputs.attached.keyboard;return k?k.keysUpward:[]}set keysUpward(k){const h=this.inputs.attached.keyboard;h&&(h.keysUpward=k)}get keysDown(){const k=this.inputs.attached.keyboard;return k?k.keysDown:[]}set keysDown(k){const h=this.inputs.attached.keyboard;h&&(h.keysDown=k)}get keysDownward(){const k=this.inputs.attached.keyboard;return k?k.keysDownward:[]}set keysDownward(k){const h=this.inputs.attached.keyboard;h&&(h.keysDownward=k)}get keysLeft(){const k=this.inputs.attached.keyboard;return k?k.keysLeft:[]}set keysLeft(k){const h=this.inputs.attached.keyboard;h&&(h.keysLeft=k)}get keysRight(){const k=this.inputs.attached.keyboard;return k?k.keysRight:[]}set keysRight(k){const h=this.inputs.attached.keyboard;h&&(h.keysRight=k)}get keysRotateLeft(){const k=this.inputs.attached.keyboard;return k?k.keysRotateLeft:[]}set keysRotateLeft(k){const h=this.inputs.attached.keyboard;h&&(h.keysRotateLeft=k)}get keysRotateRight(){const k=this.inputs.attached.keyboard;return k?k.keysRotateRight:[]}set keysRotateRight(k){const h=this.inputs.attached.keyboard;h&&(h.keysRotateRight=k)}get keysRotateUp(){const k=this.inputs.attached.keyboard;return k?k.keysRotateUp:[]}set keysRotateUp(k){const h=this.inputs.attached.keyboard;h&&(h.keysRotateUp=k)}get keysRotateDown(){const k=this.inputs.attached.keyboard;return k?k.keysRotateDown:[]}set keysRotateDown(k){const h=this.inputs.attached.keyboard;h&&(h.keysRotateDown=k)}constructor(k,h,o){var x;super(k,h,o,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),x=this,this.ellipsoid=new q.Vh(.5,1,.5),this.ellipsoidOffset=new q.Vh(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=q.Vh.Zero(),this._diffPosition=q.Vh.Zero(),this._newPosition=q.Vh.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;x._newPosition.Y(h),x._newPosition.subtractToRef(x._oldPosition,x._diffPosition),x._diffPosition.length()>d.e.CollisionsEpsilon&&(x.position.addToRef(x._diffPosition,x._deferredPositionUpdate),x._deferOnly?x._deferredUpdated=!0:x.position.Y(x._deferredPositionUpdate),x.WN&&o&&x.WN(o))},this.inputs=new T(this),this.inputs.addKeyboard().addMouse()}attachControl(k,h){h=l.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(h)}QK(){this.inputs.detachElement(),this.cameraDirection=new q.Vh(0,0,0),this.cameraRotation=new q.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(k){this._collisionMask=isNaN(k)?-1:k}_collideWithWorld(k){let h;h=this.parent?q.Vh.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,h.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const o=this.ik().collisionCoordinator;this._collider||(this._collider=o.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let x=k;this.applyGravity&&(x=k.add(this.ik().gravity)),o.getNewPosition(this._oldPosition,x,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=q.Vh.Zero(),this._transformedDirection=q.Vh.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(k){this._needMoveForGravity=k}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.ik().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"rX"}}(0,x.d)([(0,I.D)()],b.prototype,"ellipsoid",void 0),(0,x.d)([(0,I.D)()],b.prototype,"ellipsoidOffset",void 0),(0,x.d)([(0,I.E)()],b.prototype,"checkCollisions",void 0),(0,x.d)([(0,I.E)()],b.prototype,"applyGravity",void 0),(0,j.g)("BABYLON.FreeCamera",b)},13438:(k,h,o)=>{"use strict";o.d(h,{b:()=>q});var x=o(11330),I=o(13445);class q{constructor(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=o,this.uA=[],this._maxBlockCapacity=h||64,this._selectionContent=new x.c(1024),this._creationFunc=k}update(k,h,o){I.e._CreateBlocks(k,h,o,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}YA(k){for(let h=0;h<this.MA.length;h++){this.MA[h].addEntry(k)}}qA(k){for(let h=0;h<this.MA.length;h++){this.MA[h].removeEntry(k)}}select(k,h){this._selectionContent.reset();for(let o=0;o<this.MA.length;o++){this.MA[o].select(k,this._selectionContent,h)}return h?this._selectionContent.concat(this.uA):this._selectionContent.concatWithNoDuplicate(this.uA),this._selectionContent}intersects(k,h,o){this._selectionContent.reset();for(let x=0;x<this.MA.length;x++){this.MA[x].intersects(k,h,this._selectionContent,o)}return o?this._selectionContent.concat(this.uA):this._selectionContent.concatWithNoDuplicate(this.uA),this._selectionContent}intersectsRay(k){this._selectionContent.reset();for(let h=0;h<this.MA.length;h++){this.MA[h].intersectsRay(k,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.uA),this._selectionContent}}q.CreationFuncForMeshes=(k,h)=>{const o=k.getBoundingInfo();!k.isBlocked&&o.boundingBox.intersectsMinMax(h.IK,h.qK)&&h.entries.push(k)},q.CreationFuncForSubMeshes=(k,h)=>{k.getBoundingInfo().boundingBox.intersectsMinMax(h.IK,h.qK)&&h.entries.push(k)}},13445:(k,h,o)=>{"use strict";o.d(h,{e:()=>q});var x=o(11239),I=o(11569);class q{constructor(k,h,o,x,I,q){this.entries=[],this.YK=new Array,this._capacity=o,this._depth=x,this._maxDepth=I,this._creationFunc=q,this._minPoint=k,this._maxPoint=h,this.YK.push(k.clone()),this.YK.push(h.clone()),this.YK.push(k.clone()),this.YK[2].x=h.x,this.YK.push(k.clone()),this.YK[3].y=h.y,this.YK.push(k.clone()),this.YK[4].z=h.z,this.YK.push(h.clone()),this.YK[5].z=k.z,this.YK.push(h.clone()),this.YK[6].x=k.x,this.YK.push(h.clone()),this.YK[7].y=k.y}get oo(){return this._capacity}get IK(){return this._minPoint}get qK(){return this._maxPoint}addEntry(k){if(this.MA)for(let h=0;h<this.MA.length;h++){this.MA[h].addEntry(k)}else this._creationFunc(k,this),this.entries.length>this.oo&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(k){if(this.MA){for(let h=0;h<this.MA.length;h++){this.MA[h].removeEntry(k)}return}const h=this.entries.indexOf(k);h>-1&&this.entries.splice(h,1)}addEntries(k){for(let h=0;h<k.length;h++){const o=k[h];this.addEntry(o)}}select(k,h,o){if(I.b.IsInFrustum(this.YK,k)){if(this.MA){for(let x=0;x<this.MA.length;x++){this.MA[x].select(k,h,o)}return}o?h.concat(this.entries):h.concatWithNoDuplicate(this.entries)}}intersects(k,h,o,x){if(I.b.IntersectsSphere(this._minPoint,this._maxPoint,k,h)){if(this.MA){for(let I=0;I<this.MA.length;I++){this.MA[I].intersects(k,h,o,x)}return}x?o.concat(this.entries):o.concatWithNoDuplicate(this.entries)}}intersectsRay(k,h){if(k.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.MA){for(let o=0;o<this.MA.length;o++){this.MA[o].intersectsRay(k,h)}return}h.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){q._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(k,h,o,I,Y,J,G,l){G.MA=new Array;const A=new x.Vh((h.x-k.x)/2,(h.y-k.y)/2,(h.z-k.z)/2);for(let x=0;x<2;x++)for(let h=0;h<2;h++)for(let K=0;K<2;K++){const a=k.add(A.multiplyByFloats(x,h,K)),N=k.add(A.multiplyByFloats(x+1,h+1,K+1)),X=new q(a,N,I,Y+1,J,l);X.addEntries(o),G.MA.push(X)}}}},13448:(k,h,o)=>{"use strict";o.d(h,{b:()=>A});var x=o(11472),I=o(11239),q=o(11663),Y=o(12635),J=o(11505),G=o(13438),l=o(11120);x.e.prototype.createOrUpdateSelectionOctree=function(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=this._getComponent(J.e.NAME_OCTREE);o||(o=new A(this),this.o(o)),this.gA||(this.gA=new G.b(G.b.CreationFuncForMeshes,k,h));const x=this.getWorldExtends();return this.gA.update(x.min,x.max,this.meshes),this.gA},Object.defineProperty(x.e.prototype,"selectionOctree",{get:function(){return this.gA},enumerable:!0,configurable:!0}),q.d.prototype.createOrUpdateSubmeshesOctree=function(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const o=this.ik();let x=o._getComponent(J.e.NAME_OCTREE);x||(x=new A(o),o.o(x)),this._submeshesOctree||(this._submeshesOctree=new G.b(G.b.CreationFuncForSubMeshes,k,h)),this.eq(!0);const I=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(I.minimumWorld,I.maximumWorld,this.Oh),this._submeshesOctree};class A{constructor(k){this.name=J.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Y.c(I.Vh.Zero(),new I.Vh(1,1,1)),(k=k||l.b.LastCreatedScene)&&(this.Fh=k,this.Fh.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Fh.getActiveSubMeshCandidates=k=>this.getActiveSubMeshCandidates(k),this.Fh.getCollidingSubMeshCandidates=(k,h)=>this.getCollidingSubMeshCandidates(k,h),this.Fh.getIntersectingSubMeshCandidates=(k,h)=>this.getIntersectingSubMeshCandidates(k,h))}register(){this.Fh.onMeshRemovedObservable.add((k=>{const h=this.Fh.selectionOctree;if(void 0!==h&&null!==h){const o=h.uA.indexOf(k);-1!==o&&h.uA.splice(o,1)}})),this.Fh.onMeshImportedObservable.add((k=>{const h=this.Fh.selectionOctree;void 0!==h&&null!==h&&h.YA(k)}))}getActiveMeshCandidates(){var k;return(null===(k=this.Fh.gA)||void 0===k?void 0:k.select(this.Fh.frustumPlanes))||this.Fh._getDefaultMeshCandidates()}getActiveSubMeshCandidates(k){if(k._submeshesOctree&&k.useOctreeForRenderingSelection){return k._submeshesOctree.select(this.Fh.frustumPlanes)}return this.Fh._getDefaultSubMeshCandidates(k)}getIntersectingSubMeshCandidates(k,h){if(k._submeshesOctree&&k.useOctreeForPicking){Y.c.TransformToRef(h,k.getWorldMatrix(),this._tempRay);return k._submeshesOctree.intersectsRay(this._tempRay)}return this.Fh._getDefaultSubMeshCandidates(k)}getCollidingSubMeshCandidates(k,h){if(k._submeshesOctree&&k.useOctreeForCollisions){const o=h._velocityWorldLength+Math.max(h._radius.x,h._radius.y,h._radius.z);return k._submeshesOctree.intersects(h._basePointWorld,o)}return this.Fh._getDefaultSubMeshCandidates(k)}rebuild(){}dispose(){}}},12635:(k,h,o)=>{"use strict";o.d(h,{c:()=>N});var x=o(11472),I=o(11699),q=o(11248),Y=o(11239),J=o(11256),G=o(11558),l=o(11502),A=o(11120),K=o(11523);const a={internalPickerForMesh:void 0};class N{constructor(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.d;this.origin=k,this.direction=h,this.length=o,this.epsilon=x}clone(){return new N(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const x=N._TmpVector3[0].VJ(k.x-o,k.y-o,k.z-o),I=N._TmpVector3[1].VJ(h.x+o,h.y+o,h.z+o);let q,Y,J,G,l=0,A=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<x.x||this.origin.x>I.x)return!1}else if(q=1/this.direction.x,Y=(x.x-this.origin.x)*q,J=(I.x-this.origin.x)*q,J===-1/0&&(J=1/0),Y>J&&(G=Y,Y=J,J=G),l=Math.max(Y,l),A=Math.min(J,A),l>A)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<x.y||this.origin.y>I.y)return!1}else if(q=1/this.direction.y,Y=(x.y-this.origin.y)*q,J=(I.y-this.origin.y)*q,J===-1/0&&(J=1/0),Y>J&&(G=Y,Y=J,J=G),l=Math.max(Y,l),A=Math.min(J,A),l>A)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<x.z||this.origin.z>I.z)return!1}else if(q=1/this.direction.z,Y=(x.z-this.origin.z)*q,J=(I.z-this.origin.z)*q,J===-1/0&&(J=1/0),Y>J&&(G=Y,Y=J,J=G),l=Math.max(Y,l),A=Math.min(J,A),l>A)return!1;return!0}intersectsBox(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(k.minimum,k.maximum,h)}intersectsSphere(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=k.center.x-this.origin.x,x=k.center.y-this.origin.y,I=k.center.z-this.origin.z,q=o*o+x*x+I*I,Y=k.radius+h,J=Y*Y;if(q<=J)return!0;const G=o*this.direction.x+x*this.direction.y+I*this.direction.z;if(G<0)return!1;return q-G*G<=J}intersectsTriangle(k,h,o){const x=N._TmpVector3[0],I=N._TmpVector3[1],q=N._TmpVector3[2],J=N._TmpVector3[3],l=N._TmpVector3[4];h.subtractToRef(k,x),o.subtractToRef(k,I),Y.Vh.CrossToRef(this.direction,I,q);const A=Y.Vh.Dot(x,q);if(0===A)return null;const K=1/A;this.origin.subtractToRef(k,J);const a=Y.Vh.Dot(J,q)*K;if(a<-this.epsilon||a>1+this.epsilon)return null;Y.Vh.CrossToRef(J,x,l);const X=Y.Vh.Dot(this.direction,l)*K;if(X<-this.epsilon||a+X>1+this.epsilon)return null;const c=Y.Vh.Dot(I,l)*K;return c>this.length?null:new G.e(1-a-X,a,c)}intersectsPlane(k){let h;const o=Y.Vh.Dot(k.normal,this.direction);if(Math.abs(o)<9.99999997475243e-7)return null;{const x=Y.Vh.Dot(k.normal,this.origin);return h=(-k.d-x)/o,h<0?h<-9.99999997475243e-7?null:0:h}}intersectsAxis(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(k){case"y":{const k=(this.origin.y-h)/this.direction.y;return k>0?null:new Y.Vh(this.origin.x+this.direction.x*-k,h,this.origin.z+this.direction.z*-k)}case"x":{const k=(this.origin.x-h)/this.direction.x;return k>0?null:new Y.Vh(h,this.origin.y+this.direction.y*-k,this.origin.z+this.direction.z*-k)}case"z":{const k=(this.origin.z-h)/this.direction.z;return k>0?null:new Y.Vh(this.origin.x+this.direction.x*-k,this.origin.y+this.direction.y*-k,h)}default:return null}}intersectsMesh(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const J=Y.TmpVectors.Matrix[0];return k.getWorldMatrix().invertToRef(J),this._tmpRay?N.TransformToRef(this,J,this._tmpRay):this._tmpRay=N.Transform(this,J),k.intersects(this._tmpRay,h,o,x,I,q)}intersectsMeshes(k,h,o){o?o.length=0:o=[];for(let x=0;x<k.length;x++){const I=this.intersectsMesh(k[x],h);I.hit&&o.push(I)}return o.sort(this._comparePickingInfo),o}_comparePickingInfo(k,h){return k.distance<h.distance?-1:k.distance>h.distance?1:0}intersectionSegment(k,h,o){const x=this.origin,I=Y.TmpVectors.Vh[0],q=Y.TmpVectors.Vh[1],J=Y.TmpVectors.Vh[2],G=Y.TmpVectors.Vh[3];h.subtractToRef(k,I),this.direction.scaleToRef(N._Rayl,J),x.addToRef(J,q),k.subtractToRef(x,G);const l=Y.Vh.Dot(I,I),A=Y.Vh.Dot(I,J),K=Y.Vh.Dot(J,J),a=Y.Vh.Dot(I,G),X=Y.Vh.Dot(J,G),c=l*K-A*A;let W,f,M=c,T=c;c<N._Smallnum?(W=0,M=1,f=X,T=K):(W=A*X-K*a,f=l*X-A*a,W<0?(W=0,f=X,T=K):W>M&&(W=M,f=X+A,T=K)),f<0?(f=0,-a<0?W=0:-a>l?W=M:(W=-a,M=l)):f>T&&(f=T,-a+A<0?W=0:-a+A>l?W=M:(W=-a+A,M=l));const j=Math.abs(W)<N._Smallnum?0:W/M,d=Math.abs(f)<N._Smallnum?0:f/T,b=Y.TmpVectors.Vh[4];J.scaleToRef(d,b);const V=Y.TmpVectors.Vh[5];I.scaleToRef(j,V),V.addInPlace(G);const i=Y.TmpVectors.Vh[6];V.subtractToRef(b,i);return d>0&&d<=this.length&&i.lengthSquared()<o*o?V.length():-1}update(k,h,o,x,I,q,J){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){N._RayDistant||(N._RayDistant=N.Zero()),N._RayDistant.unprojectRayToRef(k,h,o,x,Y.Matrix.IdentityReadOnly,q,J);const G=Y.TmpVectors.Matrix[0];I.invertToRef(G),N.TransformToRef(N._RayDistant,G,this)}else this.unprojectRayToRef(k,h,o,x,I,q,J);return this}static Zero(){return new N(Y.Vh.Zero(),Y.Vh.Zero())}static CreateNew(k,h,o,x,I,q,Y){return N.Zero().update(k,h,o,x,I,q,Y)}static CreateNewFromTo(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.Matrix.IdentityReadOnly;const x=new N(new Y.Vh(0,0,0),new Y.Vh(0,0,0));return N.CreateFromToToRef(k,h,x,o)}static CreateFromToToRef(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.Matrix.IdentityReadOnly;o.origin.Y(k);const I=h.subtractToRef(k,o.direction),q=Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z);return o.length=q,o.direction.normalize(),N.TransformToRef(o,x,o)}static Transform(k,h){const o=new N(new Y.Vh(0,0,0),new Y.Vh(0,0,0));return N.TransformToRef(k,h,o),o}static TransformToRef(k,h,o){Y.Vh.TransformCoordinatesToRef(k.origin,h,o.origin),Y.Vh.TransformNormalToRef(k.direction,h,o.direction),o.length=k.length,o.epsilon=k.epsilon;const x=o.direction,I=x.length();if(0!==I&&1!==I){const k=1/I;x.x*=k,x.y*=k,x.z*=k,o.length*=I}return o}unprojectRayToRef(k,h,o,x,I,q,J){const G=Y.TmpVectors.Matrix[0];I.multiplyToRef(q,G),G.multiplyToRef(J,G),G.invert();const l=A.b.LastCreatedEngine,K=Y.TmpVectors.Vh[0];K.x=k/o*2-1,K.y=-(h/x*2-1),K.z=null!==l&&void 0!==l&&l.useReverseDepthBuffer?1:null!==l&&void 0!==l&&l.isNDCHalfZRange?0:-1;const a=Y.TmpVectors.Vh[1].VJ(K.x,K.y,1-1e-8),N=Y.TmpVectors.Vh[2],X=Y.TmpVectors.Vh[3];Y.Vh._UnprojectFromInvertedMatrixToRef(K,G,N),Y.Vh._UnprojectFromInvertedMatrixToRef(a,G,X),this.origin.Y(N),X.subtractToRef(N,this.direction),this.direction.normalize()}}function X(k,h,o,x,I){let q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=N.Zero();return c(k,h,o,x,Y,I,q),Y}function c(k,h,o,x,I,q){let J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=k.getEngine();if(!q&&!(q=k.activeCamera))return k;const A=q.viewport,K=l.getRenderHeight(),{x:a,y:N,width:X,height:c}=A.toGlobal(l.getRenderWidth(),K),W=1/l.getHardwareScalingLevel();return h=h*W-a,o=o*W-(K-N-c),I.update(h,o,X,c,x||Y.Matrix.IdentityReadOnly,J?Y.Matrix.IdentityReadOnly:q.getViewMatrix(),q.getProjectionMatrix(),G),k}function W(k,h,o,x,I){if(!l.b)return k;const q=k.getEngine();if(!I&&!(I=k.activeCamera))throw new Error("Active camera not set");const J=I.viewport,G=q.getRenderHeight(),{x:A,y:K,width:a,height:N}=J.toGlobal(q.getRenderWidth(),G),X=Y.Matrix.Identity(),c=1/q.getHardwareScalingLevel();return h=h*c-A,o=o*c-(G-K-N),x.update(h,o,a,N,X,X,I.getProjectionMatrix()),k}function f(k,h,o,x,I,q,Y,J){const G=h(x,o.enableDistantPicking),l=o.intersects(G,I,Y,q,x,J);return l&&l.hit?!I&&null!=k&&l.distance>=k.distance?null:l:null}function M(k,h,o,x,I,q){let J=null;const G=!!(k.activeCameras&&k.activeCameras.length>1&&k.cameraToUseForPointers!==k.activeCamera),A=k.cameraToUseForPointers||k.activeCamera,K=a.internalPickerForMesh||f;for(let l=0;l<k.meshes.length;l++){const a=k.meshes[l];if(o){if(!o(a,-1))continue}else if(!a.isEnabled()||!a.isVisible||!a.vG)continue;const N=G&&a.isWorldMatrixCameraDependent(),X=a.eq(N,A);if(a.hasThinInstances&&a.dl){const k=K(J,h,a,X,!0,!0,q);if(k){if(I)return k;const G=Y.TmpVectors.Matrix[1],l=a.thinInstanceGetWorldMatrices();for(let k=0;k<l.length;k++){if(o&&!o(a,k))continue;l[k].multiplyToRef(X,G);const Y=K(J,h,a,G,x,I,q,!0);if(Y&&(J=Y,J.thinInstanceIndex=k,x))return J}}}else{const k=K(J,h,a,X,x,I,q);if(k&&(J=k,x))return J}}return J||new l.b}function T(k,h,o,x){if(!l.b)return null;const I=[],q=!!(k.activeCameras&&k.activeCameras.length>1&&k.cameraToUseForPointers!==k.activeCamera),J=k.cameraToUseForPointers||k.activeCamera,G=a.internalPickerForMesh||f;for(let l=0;l<k.meshes.length;l++){const A=k.meshes[l];if(o){if(!o(A,-1))continue}else if(!A.isEnabled()||!A.isVisible||!A.vG)continue;const K=q&&A.isWorldMatrixCameraDependent(),a=A.eq(K,J);if(A.hasThinInstances&&A.dl){if(G(null,h,A,a,!0,!0,x)){const k=Y.TmpVectors.Matrix[1],q=A.thinInstanceGetWorldMatrices();for(let Y=0;Y<q.length;Y++){if(o&&!o(A,Y))continue;q[Y].multiplyToRef(a,k);const J=G(null,h,A,k,!1,!1,x,!0);J&&(J.thinInstanceIndex=Y,I.push(J))}}}else{const k=G(null,h,A,a,!1,!1,x);k&&I.push(k)}}return I}function j(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,x=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;x||(x=k.getWorldMatrix()),h.length=o,I?h.origin.Y(I):h.origin.Y(k.position);const q=Y.TmpVectors.Vh[2];q.set(0,0,k._scene.useRightHandedSystem?-1:1);const J=Y.TmpVectors.Vh[3];return Y.Vh.TransformNormalToRef(q,x,J),Y.Vh.NormalizeToRef(J,h.direction),h}var d,b;N._TmpVector3=(0,J.d)(6,Y.Vh.Zero),N._RayDistant=N.Zero(),N._Smallnum=1e-8,N._Rayl=1e9,d=x.e,(b=I.d)&&(b.prototype.getForwardRay=function(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,h=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;return j(this,new N(Y.Vh.Zero(),Y.Vh.Zero(),k),k,h,o)},b.prototype.getForwardRayToRef=function(k){return j(this,k,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),d&&(K.c._IsPickingAvailable=!0,d.prototype.createPickingRay=function(k,h,o,x){return X(this,k,h,o,x,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),x.e.prototype.createPickingRayToRef=function(k,h,o,x,I){return c(this,k,h,o,x,I,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},x.e.prototype.createPickingRayInCameraSpace=function(k,h,o){return function(k,h,o,x){const I=N.Zero();return W(k,h,o,I,x),I}(this,k,h,o)},x.e.prototype.createPickingRayInCameraSpaceToRef=function(k,h,o,x){return W(this,k,h,o,x)},x.e.prototype.pickWithBoundingInfo=function(k,h,o,x,I){return function(k,h,o,x,I,q){if(!l.b)return null;const J=M(k,(x=>(k._tempPickingRay||(k._tempPickingRay=N.Zero()),c(k,h,o,x,k._tempPickingRay,q||null),k._tempPickingRay)),x,I,!0);return J&&(J.ray=X(k,h,o,Y.Matrix.Identity(),q||null)),J}(this,k,h,o,x,I)},x.e.prototype.Uo=function(k,h,o,x,I,q){return function(k,h,o,x,I,q,J){const G=M(k,((x,I)=>(k._tempPickingRay||(k._tempPickingRay=N.Zero()),c(k,h,o,x,k._tempPickingRay,q||null,!1,I),k._tempPickingRay)),x,I,!1,J);return G&&(G.ray=X(k,h,o,Y.Matrix.Identity(),q||null)),G}(this,k,h,o,x,I,q)},x.e.prototype.pickWithRay=function(k,h,o,x){return function(k,h,o,x,I){const q=M(k,(o=>(k._pickWithRayInverseMatrix||(k._pickWithRayInverseMatrix=Y.Matrix.Identity()),o.invertToRef(k._pickWithRayInverseMatrix),k._cachedRayForTransform||(k._cachedRayForTransform=N.Zero()),N.TransformToRef(h,k._pickWithRayInverseMatrix,k._cachedRayForTransform),k._cachedRayForTransform)),o,x,!1,I);return q&&(q.ray=h),q}(this,k,h,o,x)},x.e.prototype.multiPick=function(k,h,o,x,I){return function(k,h,o,x,I,q){return T(k,(x=>X(k,h,o,x,I||null)),x,q)}(this,k,h,o,x,I)},x.e.prototype.multiPickWithRay=function(k,h,o){return function(k,h,o,x){return T(k,(o=>(k._pickWithRayInverseMatrix||(k._pickWithRayInverseMatrix=Y.Matrix.Identity()),o.invertToRef(k._pickWithRayInverseMatrix),k._cachedRayForTransform||(k._cachedRayForTransform=N.Zero()),N.TransformToRef(h,k._pickWithRayInverseMatrix,k._cachedRayForTransform),k._cachedRayForTransform)),o,x)}(this,k,h,o)}},12907:(k,h,o)=>{"use strict";var x=o(11180),I=o(11098),q=o(11127),Y=o(11208),J=o(11151),G=o(11191);J.e.prototype._partialLoadFile=function(k,h,o,x){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(k,(k=>{o[h]=k,o._internalCount++,6===o._internalCount&&x(o)}),void 0,void 0,!0,((k,h)=>{I&&k&&I(k.status+" "+k.statusText,h)}))},J.e.prototype._cascadeLoadFiles=function(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const I=[];I._internalCount=0;for(let q=0;q<6;q++)this._partialLoadFile(o[q],q,I,h,x)},J.e.prototype._cascadeLoadImgs=function(k,h,o,x){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5?arguments[5]:void 0;const Y=[];Y._internalCount=0;for(let J=0;J<6;J++)this._partialLoadImg(x[J],J,Y,k,h,o,I,q)},J.e.prototype._partialLoadImg=function(k,h,o,x,I,J){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0;const A=(0,Y.b)();(0,q.s)(k,(k=>{o[h]=k,o._internalCount++,x&&x.removePendingData(A),6===o._internalCount&&J&&J(I,o)}),((k,h)=>{x&&x.removePendingData(A),G&&G(k,h)}),x?x.offlineProvider:null,l),x&&x.addPendingData(A)},J.e.prototype.createCubeTextureBase=function(k,h,o,q){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,W=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,f=arguments.length>14&&void 0!==arguments[14]&&arguments[14],M=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const T=X||new x.c(this,7);T.isCube=!0,T.url=k,T.generateMipMaps=!q,T._lodGenerationScale=a,T._lodGenerationOffset=N,T._useSRGBBuffer=!!f&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!q),T!==X&&(T.label=k.substring(0,60)),this._doNotHandleContextLost||(T._extension=A,T._files=o,T._buffer=M);const j=k;this._transformTextureUrl&&!X&&(k=this._transformTextureUrl(k));const d=A??function(k){const h=k.split("?")[0],o=h.lastIndexOf(".");return o>-1?h.substring(o).toLowerCase():""}(k),b=(0,G.d)(d),V=(k,h)=>{T.dispose(),J?J(k,h):k&&I.c.Warn(k)},i=(x,J)=>{k===j?x&&V(x.status+" "+x.statusText,J):(I.c.Warn(`Failed to load ${k}, falling back to the ${j}`),this.createCubeTextureBase(j,h,o,!!q,Y,V,l,A,K,a,N,T,c,W,f,M))};if(b)b.then((x=>{const I=k=>{c&&c(T,k),x.loadCubeData(k,T,K,Y,((k,h)=>{V(k,h)}))};M?I(M):o&&6===o.length?x.supportCascades?this._cascadeLoadFiles(h,(k=>I(k.map((k=>new Uint8Array(k))))),o,V):V("Textures type does not support cascades."):this._loadFile(k,(k=>I(new Uint8Array(k))),void 0,void 0,!0,i)}));else{if(!o||0===o.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(h,T,((k,h)=>{W&&W(k,h)}),o,V)}return this._internalTexturesCache.push(T),T}},13455:(k,h,o)=>{"use strict";o(11098);var x=o(11369);o(11180),o(11314),o(11173),o(11415),o(11376);x.c},12928:(k,h,o)=>{"use strict";o.d(h,{c:()=>I});var x=o(11199);class I{constructor(k){this.value=this._toInt(k)}_toInt(k){return 0|k}add(k){return new I(this.value+k.value)}ih(k){return new I(this.value-k.value)}multiply(k){return new I(Math.imul(this.value,k.value))}divide(k){return new I(this.value/k.value)}getClassName(){return I.ClassName}equals(k){return this.value===k.value}static FromValue(k){return new I(k)}toString(){return this.value.toString()}}I.ClassName="FlowGraphInteger",(0,x.g)("FlowGraphInteger",I)},12940:(k,h,o)=>{"use strict";o.d(h,{d:()=>I,f:()=>q});var x=o(11239);class I{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.wh=k}get m(){return this.wh}transformVector(k){return this.transformVectorToRef(k,new x.Vector2)}transformVectorToRef(k,h){return h.x=k.x*this.wh[0]+k.y*this.wh[1],h.y=k.x*this.wh[2]+k.y*this.wh[3],h}rh(){return this.toArray()}toArray(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let h=0;h<4;h++)k[h]=this.wh[h];return k}Qo(k){for(let h=0;h<4;h++)this.wh[h]=k[h];return this}multiplyToRef(k,h){const o=k.wh,x=this.wh,I=h.wh;return I[0]=o[0]*x[0]+o[1]*x[2],I[1]=o[0]*x[1]+o[1]*x[3],I[2]=o[2]*x[0]+o[3]*x[2],I[3]=o[2]*x[1]+o[3]*x[3],h}multiply(k){return this.multiplyToRef(k,new I)}divideToRef(k,h){const o=this.wh,x=k.wh,I=h.wh;return I[0]=o[0]/x[0],I[1]=o[1]/x[1],I[2]=o[2]/x[2],I[3]=o[3]/x[3],h}divide(k){return this.divideToRef(k,new I)}addToRef(k,h){const o=this.wh,x=k.m,I=h.m;return I[0]=o[0]+x[0],I[1]=o[1]+x[1],I[2]=o[2]+x[2],I[3]=o[3]+x[3],h}add(k){return this.addToRef(k,new I)}subtractToRef(k,h){const o=this.wh,x=k.m,I=h.m;return I[0]=o[0]-x[0],I[1]=o[1]-x[1],I[2]=o[2]-x[2],I[3]=o[3]-x[3],h}ih(k){return this.subtractToRef(k,new I)}transpose(){const k=this.wh;return new I([k[0],k[2],k[1],k[3]])}determinant(){const k=this.wh;return k[0]*k[3]-k[1]*k[2]}inverse(){const k=this.determinant();if(0===k)throw new Error("Matrix is not invertible");const h=this.wh,o=1/k;return new I([h[3]*o,-h[1]*o,-h[2]*o,h[0]*o])}equals(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.wh,x=k.m;return 0===h?o[0]===x[0]&&o[1]===x[1]&&o[2]===x[2]&&o[3]===x[3]:Math.abs(o[0]-x[0])<h&&Math.abs(o[1]-x[1])<h&&Math.abs(o[2]-x[2])<h&&Math.abs(o[3]-x[3])<h}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.wh.join(", ")})`}}class q{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.wh=k}get m(){return this.wh}transformVector(k){return this.transformVectorToRef(k,new x.Vh)}transformVectorToRef(k,h){const o=this.wh;return h.x=k.x*o[0]+k.y*o[1]+k.z*o[2],h.y=k.x*o[3]+k.y*o[4]+k.z*o[5],h.z=k.x*o[6]+k.y*o[7]+k.z*o[8],h}multiplyToRef(k,h){const o=k.wh,x=this.wh,I=h.m;return I[0]=o[0]*x[0]+o[1]*x[3]+o[2]*x[6],I[1]=o[0]*x[1]+o[1]*x[4]+o[2]*x[7],I[2]=o[0]*x[2]+o[1]*x[5]+o[2]*x[8],I[3]=o[3]*x[0]+o[4]*x[3]+o[5]*x[6],I[4]=o[3]*x[1]+o[4]*x[4]+o[5]*x[7],I[5]=o[3]*x[2]+o[4]*x[5]+o[5]*x[8],I[6]=o[6]*x[0]+o[7]*x[3]+o[8]*x[6],I[7]=o[6]*x[1]+o[7]*x[4]+o[8]*x[7],I[8]=o[6]*x[2]+o[7]*x[5]+o[8]*x[8],h}multiply(k){return this.multiplyToRef(k,new q)}divideToRef(k,h){const o=this.wh,x=k.m,I=h.m;return I[0]=o[0]/x[0],I[1]=o[1]/x[1],I[2]=o[2]/x[2],I[3]=o[3]/x[3],I[4]=o[4]/x[4],I[5]=o[5]/x[5],I[6]=o[6]/x[6],I[7]=o[7]/x[7],I[8]=o[8]/x[8],h}divide(k){return this.divideToRef(k,new q)}addToRef(k,h){const o=this.wh,x=k.m,I=h.m;return I[0]=o[0]+x[0],I[1]=o[1]+x[1],I[2]=o[2]+x[2],I[3]=o[3]+x[3],I[4]=o[4]+x[4],I[5]=o[5]+x[5],I[6]=o[6]+x[6],I[7]=o[7]+x[7],I[8]=o[8]+x[8],h}add(k){return this.addToRef(k,new q)}subtractToRef(k,h){const o=this.wh,x=k.m,I=h.m;return I[0]=o[0]-x[0],I[1]=o[1]-x[1],I[2]=o[2]-x[2],I[3]=o[3]-x[3],I[4]=o[4]-x[4],I[5]=o[5]-x[5],I[6]=o[6]-x[6],I[7]=o[7]-x[7],I[8]=o[8]-x[8],h}ih(k){return this.subtractToRef(k,new q)}toArray(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let h=0;h<9;h++)k[h]=this.wh[h];return k}rh(){return this.toArray()}Qo(k){for(let h=0;h<9;h++)this.wh[h]=k[h];return this}transpose(){const k=this.wh;return new q([k[0],k[3],k[6],k[1],k[4],k[7],k[2],k[5],k[8]])}determinant(){const k=this.wh;return k[0]*(k[4]*k[8]-k[5]*k[7])-k[1]*(k[3]*k[8]-k[5]*k[6])+k[2]*(k[3]*k[7]-k[4]*k[6])}inverse(){const k=this.determinant();if(0===k)throw new Error("Matrix is not invertible");const h=this.wh,o=1/k;return new q([(h[4]*h[8]-h[5]*h[7])*o,(h[2]*h[7]-h[1]*h[8])*o,(h[1]*h[5]-h[2]*h[4])*o,(h[5]*h[6]-h[3]*h[8])*o,(h[0]*h[8]-h[2]*h[6])*o,(h[2]*h[3]-h[0]*h[5])*o,(h[3]*h[7]-h[4]*h[6])*o,(h[1]*h[6]-h[0]*h[7])*o,(h[0]*h[4]-h[1]*h[3])*o])}equals(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.wh,x=k.m;return 0===h?o[0]===x[0]&&o[1]===x[1]&&o[2]===x[2]&&o[3]===x[3]&&o[4]===x[4]&&o[5]===x[5]&&o[6]===x[6]&&o[7]===x[7]&&o[8]===x[8]:Math.abs(o[0]-x[0])<h&&Math.abs(o[1]-x[1])<h&&Math.abs(o[2]-x[2])<h&&Math.abs(o[3]-x[3])<h&&Math.abs(o[4]-x[4])<h&&Math.abs(o[5]-x[5])<h&&Math.abs(o[6]-x[6])<h&&Math.abs(o[7]-x[7])<h&&Math.abs(o[8]-x[8])<h}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.wh.join(", ")})`}}},12947:(k,h,o)=>{"use strict";var x;function I(k,h,o,x){switch(h){case"Animation":return x?k.animations.find((k=>k.uniqueId===o))??null:k.animations[o]??null;case"AnimationGroup":return x?k.animationGroups.find((k=>k.uniqueId===o))??null:k.animationGroups[o]??null;case"Mesh":return x?k.meshes.find((k=>k.uniqueId===o))??null:k.meshes[o]??null;case"Material":return x?k.materials.find((k=>k.uniqueId===o))??null:k.materials[o]??null;case"XA":return x?k.cameras.find((k=>k.uniqueId===o))??null:k.cameras[o]??null;case"Light":return x?k.lights.find((k=>k.uniqueId===o))??null:k.lights[o]??null;default:return null}}o.d(h,{b:()=>I}),function(k){k.Animation="Animation",k.AnimationGroup="AnimationGroup",k.Mesh="Mesh",k.Material="Material",k.XA="XA",k.Light="Light"}(x||(x={}))},12983:(k,h,o)=>{"use strict";o.d(h,{e:()=>I});var x=o(12986);class I extends x.e{constructor(k,h){if(super(k),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),h)for(const o of h)this._eventsSignalOutputs[o]=this._registerSignalOutput(o+"Event")}_executeOnTick(k){}_startPendingTasks(k){k._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(k),this._resetAfterCanceled(k)),this._preparePendingTasks(k),k._addPendingBlock(this),this.out._activateSignal(k),k._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(k){k._deleteExecutionVariable(this,"_initialized"),k._removePendingBlock(this)}}},12961:(k,h,o)=>{"use strict";o.d(h,{b:()=>l});var x=o(11208),I=o(11199),q=o(12965),Y=o(11082),J=o(12926);class G extends q.c{constructor(k,h,o,x){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:x.defaultValue,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(k,h,o),this.richType=x,this._defaultValue=I,this._optional=q,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Y.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(k){this._isDisabled!==k&&(this._isDisabled=k,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(k,h){h._getConnectionValue(this)!==k&&(h._setConnectionValue(this,k),this.onValueChangedObservable.notifyObservers(k))}resetToDefaultValue(k){k._setConnectionValue(this,this._defaultValue)}connectTo(k){this._isDisabled||super.connectTo(k)}_getValueOrDefault(k){const h=k._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(h):h}getValue(k){if(1===this.connectionType){k._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(k);const h=this._getValueOrDefault(k);return this._lastValue=h,this.richType.typeTransformer?this.richType.typeTransformer(h):h}const h=this.isConnected()?this._connectedPoint[0].getValue(k):this._getValueOrDefault(k);return this._lastValue=h,this.richType.typeTransformer?this.richType.typeTransformer(h):h}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(k),k.richType={},this.richType.serialize(k.richType),k.optional=this._optional,(0,J.e)("defaultValue",this._defaultValue,k)}}(0,I.g)("FlowGraphDataConnection",G);class l{constructor(k){var h;this.config=k,this.uniqueId=(0,x.b)(),this.name=(null===(h=this.config)||void 0===h?void 0:h.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(k){}registerDataInput(k,h,o){const x=new G(k,0,this,h,o);return this.dataInputs.push(x),x}registerDataOutput(k,h,o){const x=new G(k,1,this,h,o);return this.dataOutputs.push(x),x}getDataInput(k){return this.dataInputs.find((h=>h.name===k))}getDataOutput(k){return this.dataOutputs.find((h=>h.name===k))}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.e;if(k.uniqueId=this.uniqueId,k.config={},this.config){const o=this.config,x=Object.keys(o);for(const I of x)h(I,o[I],k.config)}k.dataInputs=[],k.dataOutputs=[],k.className=this.getClassName();for(const o of this.dataInputs){const h={};o.serialize(h),k.dataInputs.push(h)}for(const o of this.dataOutputs){const h={};o.serialize(h),k.dataOutputs.push(h)}}deserialize(k){}_log(k,h,o){var x;null===(x=k.logger)||void 0===x||x.addLogItem({action:h,Bo:o,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12965:(k,h,o)=>{"use strict";o.d(h,{c:()=>q});var x,I=o(11208);!function(k){k[k.Input=0]="Input",k[k.Output=1]="Output"}(x||(x={}));class q{constructor(k,h,o){this._ownerBlock=o,this._connectedPoint=[],this.uniqueId=(0,I.b)(),this.connectedPointIds=[],this.name=k,this._connectionType=h}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(k){if(this._connectionType===k._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||k._isSingularConnection()&&k._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(k),k._connectedPoint.push(this)}disconnectFrom(k){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=this._connectedPoint.indexOf(k),x=k._connectedPoint.indexOf(this);-1!==o&&-1!==x&&(h&&this._connectedPoint.splice(o,1),k._connectedPoint.splice(x,1))}disconnectFromAll(){for(const k of this._connectedPoint)this.disconnectFrom(k,!1);this._connectedPoint.length=0}dispose(){for(const k of this._connectedPoint)this.disconnectFrom(k)}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};k.uniqueId=this.uniqueId,k.name=this.name,k._connectionType=this._connectionType,k.connectedPointIds=[],k.className=this.getClassName();for(const h of this._connectedPoint)k.connectedPointIds.push(h.uniqueId)}getClassName(){return"FGConnection"}deserialize(k){this.uniqueId=k.uniqueId,this.name=k.name,this._connectionType=k._connectionType,this.connectedPointIds=k.connectedPointIds}}},12921:(k,h,o)=>{"use strict";o.d(h,{b:()=>T});var x,I=o(11082),q=o(11227),Y=o(11233),J=o(11208),G=o(12926),l=o(12947),A=o(11098);!function(k){k.ExecuteBlock="ExecuteBlock",k.ExecuteEvent="ExecuteEvent",k.TriggerConnection="TriggerConnection",k.ContextVariableSet="ContextVariableSet",k.GlobalVariableSet="GlobalVariableSet",k.GlobalVariableDelete="GlobalVariableDelete",k.GlobalVariableGet="GlobalVariableGet",k.AddConnection="AddConnection",k.GetConnectionValue="GetConnectionValue",k.SetConnectionValue="SetConnectionValue",k.ActivateSignal="ActivateSignal",k.ContextVariableGet="ContextVariableGet"}(x||(x={}));class K{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(k){if(k.time||(k.time=Date.now()),this.log.push(k),this.logToConsole){var h;const o=null===(h=k.Bo)||void 0===h?void 0:h.value;"object"===typeof o&&o.getClassName?A.c.Log(`[FGLog] ${k.className}:${k.uniqueId.split("-")[0]} ${k.action} - ${JSON.stringify(o.getClassName())}: ${o.toString()}`):A.c.Log(`[FGLog] ${k.className}:${k.uniqueId.split("-")[0]} ${k.action} - ${JSON.stringify(k.Bo)}`)}}getItemsOfType(k){return this.log.filter((h=>h.action===k))}}class a{get enableLogging(){return this._enableLogging}set enableLogging(k){this._enableLogging!==k&&(this._enableLogging=k,this._enableLogging?(this.logger=new K,this.logger.logToConsole=!0):this.logger=null)}constructor(k){this.uniqueId=(0,J.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new I.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=k,this.assetsContext=k.assetsContext??k.Fh}hasVariable(k){return k in this._userVariables}setVariable(k,h){var o;this._userVariables[k]=h,null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Bo:{name:k,value:h}})}getAsset(k,h){return(0,l.b)(this.assetsContext,k,h)}getVariable(k){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Bo:{name:k,value:this._userVariables[k]}}),this._userVariables[k]}get userVariables(){return this._userVariables}ik(){return this._configuration.Fh}_getUniqueIdPrefixedName(k,h){return`${k.uniqueId}_${h}`}_getGlobalContextVariable(k,h){var o;return null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Bo:{name:k,defaultValue:h,possibleValue:this._globalContextVariables[k]}}),this._hasGlobalContextVariable(k)?this._globalContextVariables[k]:h}_setGlobalContextVariable(k,h){var o;null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Bo:{name:k,value:h}}),this._globalContextVariables[k]=h}_deleteGlobalContextVariable(k){var h;null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Bo:{name:k}}),delete this._globalContextVariables[k]}_hasGlobalContextVariable(k){return k in this._globalContextVariables}_setExecutionVariable(k,h,o){this._executionVariables[this._getUniqueIdPrefixedName(k,h)]=o}_getExecutionVariable(k,h,o){return this._hasExecutionVariable(k,h)?this._executionVariables[this._getUniqueIdPrefixedName(k,h)]:o}_deleteExecutionVariable(k,h){delete this._executionVariables[this._getUniqueIdPrefixedName(k,h)]}_hasExecutionVariable(k,h){return this._getUniqueIdPrefixedName(k,h)in this._executionVariables}_hasConnectionValue(k){return k.uniqueId in this._connectionValues}_setConnectionValue(k,h){var o;this._connectionValues[k.uniqueId]=h,null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Bo:{connectionPointId:k.uniqueId,value:h}})}_setConnectionValueByKey(k,h){this._connectionValues[k]=h}_getConnectionValue(k){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Bo:{connectionPointId:k.uniqueId,value:this._connectionValues[k.uniqueId]}}),this._connectionValues[k.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(k){this._pendingBlocks.includes(k)||(this._pendingBlocks.push(k),this._pendingBlocks.sort(((k,h)=>k.priority-h.priority)))}_removePendingBlock(k){const h=this._pendingBlocks.indexOf(k);-1!==h&&this._pendingBlocks.splice(h,1)}_clearPendingBlocks(){for(const k of this._pendingBlocks)k._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(k){var h;this.onNodeExecutedObservable.notifyObservers(k),null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:k.getClassName(),uniqueId:k.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(k){this._setGlobalContextVariable("timeSinceStart",k.timeSinceStart),this._setGlobalContextVariable("deltaTime",k.deltaTime);for(const o of this._pendingBlocks){var h;null===(h=o._executeOnTick)||void 0===h||h.call(o,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.e;k.uniqueId=this.uniqueId,k._userVariables={};for(const x in this._userVariables)h(x,this._userVariables[x],k._userVariables);k._connectionValues={};for(const x in this._connectionValues)h(x,this._connectionValues[x],k._connectionValues);var o;this.assetsContext!==this.ik()&&(k._assetsContext={meshes:this.assetsContext.meshes.map((k=>k.id)),materials:this.assetsContext.materials.map((k=>k.id)),textures:this.assetsContext.textures.map((k=>k.name)),animations:this.assetsContext.animations.map((k=>k.name)),lights:this.assetsContext.lights.map((k=>k.id)),cameras:this.assetsContext.cameras.map((k=>k.id)),Ba:null===(o=this.assetsContext.Ba)||void 0===o?void 0:o.map((k=>k.name)),skeletons:this.assetsContext.skeletons.map((k=>k.id)),ka:this.assetsContext.ka.map((k=>k.name)),geometries:this.assetsContext.geometries.map((k=>k.id)),multiMaterials:this.assetsContext.multiMaterials.map((k=>k.id)),transformNodes:this.assetsContext.transformNodes.map((k=>k.id))})}getClassName(){return"FlowGraphContext"}}(0,q.d)([(0,Y.E)()],a.prototype,"uniqueId",void 0);var N=o(12954),X=o(11510);class c{constructor(k){this.onEventTriggeredObservable=new I.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=k,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.sh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const k=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Bo:{timeSinceStart:this._startingTime,deltaTime:k}}),this._startingTime+=k})),this._meshPickedObserver=this._scene.onPointerObservable.add((k=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Bo:k})}),X.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((k=>{const h=k.pointerId,o=k.mesh,x=this._pointerUnderMeshState[h];!x&&o?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Bo:{pointerId:h,mesh:o}}):x&&!o?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Bo:{pointerId:h,mesh:x}}):x&&o&&x!==o&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Bo:{pointerId:h,mesh:x,over:o}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Bo:{pointerId:h,mesh:o,out:x}})),this._pointerUnderMeshState[h]=o}),X.b.POINTERMOVE)}dispose(){var k,h,o,x,I;null===(k=this._sceneDisposeObserver)||void 0===k||k.remove(),null===(h=this._sceneReadyObserver)||void 0===h||h.remove(),null===(o=this._sceneOnBeforeRenderObserver)||void 0===o||o.remove(),null===(x=this._meshPickedObserver)||void 0===x||x.remove(),null===(I=this._meshUnderPointerObserver)||void 0===I||I.remove(),this.onEventTriggeredObservable.clear()}}var W,f=o(12972);!function(k){k[k.Stopped=0]="Stopped",k[k.Started=1]="Started"}(W||(W={}));class M{get state(){return this._state}set state(k){this._state=k,this.onStateChangedObservable.notifyObservers(k)}constructor(k){this.onStateChangedObservable=new I.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=k.Fh,this._sceneEventCoordinator=new c(this._scene),this._coordinator=k.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((k=>{for(const h of this._executionContexts){const o=this._getContextualOrder(k.type,h);for(const x of o)if(!x._executeEvent(h,k.Bo))break}switch(k.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const h of this._executionContexts)h._notifyOnTick(k.Bo);break;case"SceneDispose":this.dispose()}}))}createContext(){const k=new a({Fh:this._scene,coordinator:this._coordinator});return this._executionContexts.push(k),k}getContext(k){return this._executionContexts[k]}addEventBlock(k){if("PointerOver"!==k.type&&"PointerOut"!==k.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==k.type&&this._eventBlocks[k.type].push(k),1===this.state)for(const h of this._executionContexts)k._startPendingTasks(h);else this.onStateChangedObservable.addOnce((h=>{if(1===h)for(const o of this._executionContexts)k._startPendingTasks(o)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((k=>{1===k&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const k of this._executionContexts)for(const h in this._eventBlocks){const o=this._getContextualOrder(h,k);for(const h of o)h._startPendingTasks(k)}}_getContextualOrder(k,h){const o=this._eventBlocks[k].sort(((k,h)=>h.initPriority-k.initPriority));if("MeshPick"===k){const k=[];for(const x of o){const I=x.asset.getValue(h);let q=0;for(;q<o.length;q++){const k=o[q].asset.getValue(h);if(I&&k&&(0,f.o)(I,k))break}k.splice(q,0,x)}return k}return o}dispose(){var k;if(0!==this.state){this.state=0;for(const k of this._executionContexts)k._clearPendingBlocks();this._executionContexts.length=0;for(const k in this._eventBlocks)this._eventBlocks[k].length=0;null===(k=this._eventObserver)||void 0===k||k.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(k){const h=[],o=new Set;for(const x in this._eventBlocks)for(const k of this._eventBlocks[x])h.push(k),o.add(k.uniqueId);for(;h.length>0;){const x=h.pop();k(x);for(const k of x.dataInputs)for(const x of k._connectedPoint)o.has(x._ownerBlock.uniqueId)||(h.push(x._ownerBlock),o.add(x._ownerBlock.uniqueId));if(x instanceof N.c)for(const k of x.signalOutputs)for(const x of k._connectedPoint)o.has(x._ownerBlock.uniqueId)||(h.push(x._ownerBlock),o.add(x._ownerBlock.uniqueId))}}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1?arguments[1]:void 0;k.allBlocks=[],this.visitAllBlocks((h=>{const o={};h.serialize(o),k.allBlocks.push(o)})),k.executionContexts=[];for(const o of this._executionContexts){const x={};o.serialize(x,h),k.executionContexts.push(x)}}}class T{constructor(k){this.config=k,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Fh.sh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Fh.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const k=this._executeOnNextFrame.slice(0);if(k.length)for(const h of k){this.notifyCustomEvent(h.id,h.data,!1);const k=this._executeOnNextFrame.findIndex((k=>k.uniqueId===h.uniqueId));-1!==k&&this._executeOnNextFrame.splice(k,1)}}));(T.SceneCoordinators.get(this.config.Fh)??[]).push(this)}createGraph(){const k=new M({Fh:this.config.Fh,coordinator:this});return this._flowGraphs.push(k),k}removeGraph(k){const h=this._flowGraphs.indexOf(k);-1!==h&&(k.dispose(),this._flowGraphs.splice(h,1))}start(){for(const k of this._flowGraphs)k.start()}dispose(){var k,h;for(const I of this._flowGraphs)I.dispose();this._flowGraphs.length=0,null===(k=this._disposeObserver)||void 0===k||k.remove(),null===(h=this._onBeforeRenderObserver)||void 0===h||h.remove();const o=T.SceneCoordinators.get(this.config.Fh)??[],x=o.indexOf(this);-1!==x&&o.splice(x,1)}serialize(k,h){k._flowGraphs=[];for(const o of this._flowGraphs){const x={};o.serialize(x,h),k._flowGraphs.push(x)}k.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(k){let h=this._customEventsMap.get(k);return h||(h=new I.d,this._customEventsMap.set(k,h)),h}notifyCustomEvent(k,h){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:k,data:h,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(k)){const h=this._eventExecutionCounter.get(k);if(this._eventExecutionCounter.set(k,h+1),h>=T.MaxEventTypeExecutionPerFrame)return void(h===T.MaxEventTypeExecutionPerFrame&&A.c.Warn(`FlowGraphCoordinator: Too many executions of event "${k}".`))}else this._eventExecutionCounter.set(k,1);const o=this._customEventsMap.get(k);o&&o.notifyObservers(h)}}T.MaxEventsPerType=30,T.MaxEventTypeExecutionPerFrame=30,T.SceneCoordinators=new Map},12981:(k,h,o)=>{"use strict";o.d(h,{e:()=>I});var x=o(12983);class I extends x.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(k){k._notifyExecuteNode(this),this.done._activateSignal(k)}}},12954:(k,h,o)=>{"use strict";o.d(h,{c:()=>J});var x=o(12961),I=o(12965),q=o(11199);class Y extends I.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(k){super.connectTo(k),this._connectedPoint.sort(((k,h)=>h.priority-k.priority))}_activateSignal(k){var h;if(null===(h=k.logger)||void 0===h||h.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Bo:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)k._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(k,this),k._increaseExecutionId();else for(const o of this._connectedPoint)o._activateSignal(k)}}(0,q.g)("FlowGraphSignalConnection",Y);class J extends x.b{constructor(k){super(k),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(k){const h=new Y(k,0,this);return this.signalInputs.push(h),h}_registerSignalOutput(k){const h=new Y(k,1,this);return this.signalOutputs.push(h),h}_unregisterSignalInput(k){const h=this.signalInputs.findIndex((h=>h.name===k));-1!==h&&(this.signalInputs[h].dispose(),this.signalInputs.splice(h,1))}_unregisterSignalOutput(k){const h=this.signalOutputs.findIndex((h=>h.name===k));-1!==h&&(this.signalOutputs[h].dispose(),this.signalOutputs.splice(h,1))}_reportError(k,h){this.error.Bo="string"===typeof h?new Error(h):h,this.error._activateSignal(k)}getSignalInput(k){return this.signalInputs.find((h=>h.name===k))}getSignalOutput(k){return this.signalOutputs.find((h=>h.name===k))}serialize(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(k),k.signalInputs=[],k.signalOutputs=[];for(const h of this.signalInputs){const o={};h.serialize(o),k.signalInputs.push(o)}for(const h of this.signalOutputs){const o={};h.serialize(o),k.signalOutputs.push(o)}}deserialize(k){for(let h=0;h<k.signalInputs.length;h++){const o=this.getSignalInput(k.signalInputs[h].name);if(!o)throw new Error("Could not find signal input with name "+k.signalInputs[h].name+" in block "+k.className);o.deserialize(k.signalInputs[h])}for(let h=0;h<k.signalOutputs.length;h++){const o=this.getSignalOutput(k.signalOutputs[h].name);if(!o)throw new Error("Could not find signal output with name "+k.signalOutputs[h].name+" in block "+k.className);o.deserialize(k.signalOutputs[h])}}getClassName(){return"FlowGraphExecutionBlock"}}},12986:(k,h,o)=>{"use strict";o.d(h,{e:()=>I});var x=o(12954);class I extends x.c{constructor(k){super(k),this.out=this._registerSignalOutput("out")}}},12936:(k,h,o)=>{"use strict";o.d(h,{D:()=>i,E:()=>V,d:()=>l,h:()=>a,j:()=>b,k:()=>W,l:()=>f,n:()=>M,o:()=>K,q:()=>d,t:()=>A,u:()=>N,w:()=>X,x:()=>c,y:()=>F,z:()=>R});var x,I=o(11239),q=o(11281),Y=o(12928),J=o(12940);!function(k){k.Any="any",k.String="string",k.Number="number",k.Boolean="boolean",k.Object="object",k.Integer="FlowGraphInteger",k.Vector2="Vector2",k.Vh="Vh",k.Vector4="Vector4",k.Quaternion="Quaternion",k.Matrix="Matrix",k.Matrix2D="Matrix2D",k.Matrix3D="Matrix3D",k.Zh="Zh",k.RJ="RJ"}(x||(x={}));class G{constructor(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=k,this.defaultValue=h,this.animationType=o}serialize(k){k.typeName=this.typeName,k.defaultValue=this.defaultValue}}const l=new G("any",void 0),A=new G("string",""),K=new G("number",0,0),a=new G("boolean",!1),N=new G("Vector2",I.Vector2.Zero(),5),X=new G("Vh",I.Vh.Zero(),1),c=new G("Vector4",I.Vector4.Zero()),W=new G("Matrix",I.Matrix.Identity(),3),f=new G("Matrix2D",new J.d),M=new G("Matrix3D",new J.f),T=new G("Zh",q.Zh.Black(),4),j=new G("RJ",new q.RJ(0,0,0,0),7),d=new G("Quaternion",I.Quaternion.Identity(),2);d.typeTransformer=k=>{if(k.getClassName){if("Vector4"===k.getClassName())return I.Quaternion.Uh(k.rh());if("Vh"===k.getClassName())return I.Quaternion.FromEulerVector(k);if("Matrix"===k.getClassName())return I.Quaternion.FromRotationMatrix(k)}return k};const b=new G("FlowGraphInteger",new Y.c(0),0);function V(k){const h=k;switch(typeof k){case"string":return A;case"number":return K;case"boolean":return a;case"object":if(h.getClassName)switch(h.getClassName()){case"Vector2":return N;case"Vh":return X;case"Vector4":return c;case"Matrix":return W;case"Zh":return T;case"RJ":return j;case"Quaternion":return d;case"FlowGraphInteger":return b;case"Matrix2D":return f;case"Matrix3D":return M}return l;default:return l}}function i(k){switch(k){case"string":return A;case"number":return K;case"boolean":return a;case"Vector2":return N;case"Vh":return X;case"Vector4":return c;case"Matrix":return W;case"Zh":return T;case"RJ":return j;case"Quaternion":return d;case"FlowGraphInteger":return b;case"Matrix2D":return f;case"Matrix3D":return M;default:return l}}function F(k){switch(k){case"number":default:return 0;case"Vector2":return 5;case"Vh":return 1;case"Matrix":return 3;case"Zh":return 4;case"RJ":return 7;case"Quaternion":return 2}}function R(k){switch(k){case 0:return K;case 5:return N;case 1:return X;case 3:return W;case 4:return T;case 7:return j;case 2:return d;default:return l}}},12926:(k,h,o)=>{"use strict";o.d(h,{c:()=>A,e:()=>l,f:()=>K});var x=o(11281),I=o(11239),q=o(12928),Y=o(12936),J=o(12940);function G(k){return"Vector2"===k||"Vh"===k||"Vector4"===k||"Quaternion"===k||"Zh"===k||"RJ"===k}function l(k,h,o){var x;const I=(null===h||void 0===h||null===(x=h.getClassName)||void 0===x?void 0:x.call(h))??"";if(G(I)||function(k){return"Matrix"===k||"Matrix2D"===k||"Matrix3D"===k}(I))o[k]={value:h.rh(),className:I};else if("FlowGraphInteger"===I)o[k]={value:h.value,className:I};else if(I&&(h.id||h.name))o[k]={id:h.id,name:h.name,className:I};else{if("object"===typeof h)throw new Error(`Could not serialize value ${h}`);o[k]=h}}function A(k,h,o,l){const K=h[k];let a;const N=(null===K||void 0===K?void 0:K.type)??(null===K||void 0===K?void 0:K.className);if(function(k){return"Mesh"===k||"AbstractMesh"===k||"GroundMesh"===k||"InstanceMesh"===k||"LinesMesh"===k||"GoldbergMesh"===k||"GreasedLineMesh"===k||"TrailMesh"===k}(N)){let k=l.meshes.filter((k=>K.id?k.id===K.id:k.name===K.name));0===k.length&&(k=l.transformNodes.filter((k=>K.id?k.id===K.id:k.name===K.name))),a=K.uniqueId?k.find((k=>k.uniqueId===K.uniqueId)):k[0]}else if(G(N))a=function(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===k)return I.Vector2.Uh(h);if("Vh"===k)return o&&(h[2]*=-1),I.Vh.Uh(h);if("Vector4"===k)return I.Vector4.Uh(h);if("Quaternion"===k)return o&&(h[2]*=-1,h[3]*=-1),I.Quaternion.Uh(h);if("Zh"===k)return new x.Zh(h[0],h[1],h[2]);if("RJ"===k)return new x.RJ(h[0],h[1],h[2],h[3]);throw new Error(`Unknown vector class name ${k}`)}(N,K.value);else if(function(k){return"AnimationGroup"===k}(N)){const k=l.animationGroups.filter((k=>k.name===K.name));a=1===k.length?k[0]:k.find((k=>k.uniqueId===K.uniqueId))}else a="Matrix"===N?I.Matrix.Uh(K.value):"Matrix2D"===N?new J.d(K.value):"Matrix3D"===N?new J.f(K.value):"FlowGraphInteger"===N?q.c.FromValue(K.value):"number"===N||"string"===N||"boolean"===N?K.value[0]:K&&void 0!==K.value?K.value:Array.isArray(K)?K.reduce(((k,h)=>h.eventData?(k[h.id]={type:(0,Y.D)(h.type)},"undefined"!==typeof h.value&&(k[h.id].value=A("value",h,o,l)),k):k),{}):K;return a}function K(k){return"FlowGraphJsonPointerParserBlock"===k}},12972:(k,h,o)=>{"use strict";function x(k,h){return!(!k.parent||k.parent!==h&&!x(k.parent,h))}function I(k){if(k.getClassName)return k.getClassName()}function q(k,h){return k===h&&("Vector2"===k||"Vh"===k||"Vector4"===k||"Quaternion"===k)}function Y(k,h){return k===h&&("Matrix"===k||"Matrix2D"===k||"Matrix3D"===k)}function J(k,h){return"FlowGraphInteger"===k&&"FlowGraphInteger"===h}function G(k,h){const o="number"===typeof k||"number"===typeof(null===k||void 0===k?void 0:k.value);return o&&!h?!isNaN(l(k)):o}function l(k){return"number"===typeof k?k:k.value}o.d(h,{c:()=>J,g:()=>Y,k:()=>q,m:()=>I,o:()=>x,s:()=>l,v:()=>G})},12346:(k,h,o)=>{"use strict";o.r(h),o.d(h,{SceneInstrumentation:()=>q});var x=o(11078),I=o(11451);class q{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(k){k!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=k,k?(this._onBeforeActiveMeshesEvaluationObserver=this.Fh.onBeforeActiveMeshesEvaluationObservable.add((()=>{x.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Fh.onAfterActiveMeshesEvaluationObservable.add((()=>{x.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Fh.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Fh.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(k){k!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=k,k?(this._onBeforeRenderTargetsRenderObserver=this.Fh.onBeforeRenderTargetsRenderObservable.add((()=>{x.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Fh.onAfterRenderTargetsRenderObservable.add((()=>{x.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Fh.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Fh.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(k){k!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=k,k?(this._onBeforeParticlesRenderingObserver=this.Fh.onBeforeParticlesRenderingObservable.add((()=>{x.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Fh.onAfterParticlesRenderingObservable.add((()=>{x.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Fh.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Fh.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(k){k!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=k,this.Fh.spriteManagers&&(k?(this._onBeforeSpritesRenderingObserver=this.Fh.onBeforeSpritesRenderingObservable.add((()=>{x.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Fh.onAfterSpritesRenderingObservable.add((()=>{x.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Fh.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Fh.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(k){k!==this._capturePhysicsTime&&this.Fh.onBeforePhysicsObservable&&(this._capturePhysicsTime=k,k?(this._onBeforePhysicsObserver=this.Fh.onBeforePhysicsObservable.add((()=>{x.Tools.StartPerformanceCounter("tX"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Fh.onAfterPhysicsObservable.add((()=>{x.Tools.EndPerformanceCounter("tX"),this._physicsTime.endMonitoring()}))):(this.Fh.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Fh.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(k){k!==this._captureAnimationsTime&&(this._captureAnimationsTime=k,k?this._onAfterAnimationsObserver=this.Fh.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Fh.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(k){this._captureFrameTime=k}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(k){this._captureInterFrameTime=k}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(k){k!==this._captureRenderTime&&(this._captureRenderTime=k,k?(this._onBeforeDrawPhaseObserver=this.Fh.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),x.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Fh.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),x.Tools.EndPerformanceCounter("Main render")}))):(this.Fh.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Fh.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(k){k!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=k,k?(this._onBeforeCameraRenderObserver=this.Fh.onBeforeCameraRenderObservable.add((k=>{this._cameraRenderTime.beginMonitoring(),x.Tools.StartPerformanceCounter(`Rendering camera ${k.name}`)})),this._onAfterCameraRenderObserver=this.Fh.onAfterCameraRenderObservable.add((k=>{this._cameraRenderTime.endMonitoring(!1),x.Tools.EndPerformanceCounter(`Rendering camera ${k.name}`)}))):(this.Fh.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Fh.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Fh.getEngine()._drawCalls}constructor(k){this.Fh=k,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new I.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new I.c,this._captureFrameTime=!1,this._frameTime=new I.c,this._captureRenderTime=!1,this._renderTime=new I.c,this._captureInterFrameTime=!1,this._interFrameTime=new I.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new I.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new I.c,this._capturePhysicsTime=!1,this._physicsTime=new I.c,this._captureAnimationsTime=!1,this._animationsTime=new I.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new I.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=k.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(x.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Fh.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=k.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(x.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.dh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.dh(),this._captureParticlesRenderTime&&this._particlesRenderTime.dh(),this._captureSpritesRenderTime&&this._spritesRenderTime.dh(),this._captureRenderTime&&this._renderTime.dh(),this._captureCameraRenderTime&&this._cameraRenderTime.dh()}))}dispose(){this._disposed||(this.Fh.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Fh.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Fh.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Fh.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Fh.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Fh.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Fh.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Fh.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Fh.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Fh.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Fh.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Fh.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Fh.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Fh.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Fh.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Fh.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Fh.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Fh=null,this._disposed=!0)}}},12915:(k,h,o)=>{"use strict";o.d(h,{e:()=>A});var x=o(11227),I=o(11233),q=o(11239),Y=o(11656),J=o(11799),G=o(11853),l=o(11199);Y.c.AddNodeConstructor("Light_Type_1",((k,h)=>()=>new A(k,q.Vh.Zero(),h)));class A extends G.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(k){this._shadowFrustumSize=k,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(k){this._shadowOrthoScale=k,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(k){this._orthoLeft=k}get orthoRight(){return this._orthoRight}set orthoRight(k){this._orthoRight=k}get orthoTop(){return this._orthoTop}set orthoTop(k){this._orthoTop=k}get orthoBottom(){return this._orthoBottom}set orthoBottom(k){this._orthoBottom=k}constructor(k,h,o){super(k,o),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=h.scale(-1),this.direction=h}getClassName(){return"SX"}getTypeID(){return J.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(k,h,o){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(k):this._setDefaultAutoExtendShadowProjectionMatrix(k,h,o)}_setDefaultFixedFrustumShadowProjectionMatrix(k){const h=this.ik().activeCamera;h&&q.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:h.nx,void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,k,this.ik().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(k,h,o){const x=this.ik().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const k=q.Vh.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let x=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let Y=0;Y<o.length;Y++){const J=o[Y];if(!J)continue;const G=J.getBoundingInfo().boundingBox;for(let o=0;o<G.vectorsWorld.length;o++)q.Vh.TransformCoordinatesToRef(G.vectorsWorld[o],h,k),k.x<this._orthoLeft&&(this._orthoLeft=k.x),k.y<this._orthoBottom&&(this._orthoBottom=k.y),k.x>this._orthoRight&&(this._orthoRight=k.x),k.y>this._orthoTop&&(this._orthoTop=k.y),this.autoCalcShadowZBounds&&(k.z<x&&(x=k.z),k.z>I&&(I=k.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=x,this._shadowMaxZ=I)}const I=this._orthoRight-this._orthoLeft,Y=this._orthoTop-this._orthoBottom,J=void 0!==this.shadowMinZ?this.shadowMinZ:(null===x||void 0===x?void 0:x.nx)||0,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===x||void 0===x?void 0:x.maxZ)||1e4,l=this.ik().getEngine().useReverseDepthBuffer;q.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-I*this.shadowOrthoScale,this._orthoRight+I*this.shadowOrthoScale,this._orthoBottom-Y*this.shadowOrthoScale,this._orthoTop+Y*this.shadowOrthoScale,l?G:J,l?J:G,k,this.ik().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(k,h){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,h),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,h),this)}transferToNodeMaterialEffect(k,h){return this.computeTransformedInformation()?(k.setFloat3(h,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(k.setFloat3(h,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(k){const h=this._scene.getEngine();return!h.useReverseDepthBuffer&&h.isNDCHalfZRange?0:1}getDepthMaxZ(k){const h=this._scene.getEngine();return h.useReverseDepthBuffer&&h.isNDCHalfZRange?0:1}prepareLightSpecificDefines(k,h){k["DIRLIGHT"+h]=!0}}(0,x.d)([(0,I.E)()],A.prototype,"shadowFrustumSize",null),(0,x.d)([(0,I.E)()],A.prototype,"shadowOrthoScale",null),(0,x.d)([(0,I.E)()],A.prototype,"autoUpdateExtends",void 0),(0,x.d)([(0,I.E)()],A.prototype,"autoCalcShadowZBounds",void 0),(0,x.d)([(0,I.E)("orthoLeft")],A.prototype,"_orthoLeft",void 0),(0,x.d)([(0,I.E)("orthoRight")],A.prototype,"_orthoRight",void 0),(0,x.d)([(0,I.E)("orthoTop")],A.prototype,"_orthoTop",void 0),(0,x.d)([(0,I.E)("orthoBottom")],A.prototype,"_orthoBottom",void 0),(0,l.g)("BABYLON.DirectionalLight",A)},13387:(k,h,o)=>{"use strict";o.d(h,{e:()=>A});var x=o(11227),I=o(11233),q=o(11239),Y=o(11281),J=o(11656),G=o(11799),l=o(11199);J.c.AddNodeConstructor("Light_Type_3",((k,h)=>()=>new A(k,q.Vh.Zero(),h)));class A extends G.d{constructor(k,h,o){super(k,o),this.groundColor=new Y.Zh(0,0,0),this.direction=h||q.Vh.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"CX"}setDirectionToTarget(k){return this.direction=q.Vh.Normalize(k.ih(q.Vh.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(k,h){const o=q.Vh.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",o.x,o.y,o.z,0,h),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.wJ),h),this}transferToNodeMaterialEffect(k,h){const o=q.Vh.Normalize(this.direction);return k.setFloat3(h,o.x,o.y,o.z),this}eq(){return this._worldMatrix||(this._worldMatrix=q.Matrix.Identity()),this._worldMatrix}getTypeID(){return G.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(k,h){k["HEMILIGHT"+h]=!0}}(0,x.d)([(0,I.i)()],A.prototype,"groundColor",void 0),(0,x.d)([(0,I.D)()],A.prototype,"direction",void 0),(0,l.g)("BABYLON.HemisphericLight",A)},12889:(k,h,o)=>{"use strict";o.d(h,{b:()=>K});var x=o(11227),I=o(11233),q=o(11239),Y=o(11656),J=o(11799),G=o(11853),l=o(11223),A=o(11199);Y.c.AddNodeConstructor("Light_Type_2",((k,h)=>()=>new K(k,q.Vh.Zero(),q.Vh.Zero(),0,0,h)));class K extends G.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(k){this._iesProfileTexture!==k&&(this._iesProfileTexture=k,this._iesProfileTexture&&K._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(k){this._angle=k,this._cosHalfAngle=Math.cos(.5*k),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(k){this._innerAngle=k,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(k){this._shadowAngleScale=k,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(k){this._projectionTextureLightNear=k,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(k){this._projectionTextureLightFar=k,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(k){this._projectionTextureUpDirection=k,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(k){this._projectionTexture!==k&&(this._projectionTexture=k,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(K._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):K._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(k){return void 0!==k.onGeneratedObservable}static _IsTexture(k){return void 0!==k.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(k){this._projectionTextureProjectionLightMatrix=k,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(k,h,o,x,I,Y){super(k,Y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=q.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=q.Vh.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=q.Vh.Zero(),this._projectionTextureViewLightMatrix=q.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=q.Matrix.Zero(),this._projectionTextureScalingMatrix=q.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=h,this.direction=o,this.angle=x,this.exponent=I}getClassName(){return"SpotLight"}getTypeID(){return J.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(k){super._setDirection(k),this._projectionTextureViewLightDirty=!0}_setPosition(k){super._setPosition(k),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(k,h,o){const x=this.ik().activeCamera;if(!x)return;this._shadowAngleScale=this._shadowAngleScale||1;const I=this._shadowAngleScale*this._angle,Y=void 0!==this.shadowMinZ?this.shadowMinZ:x.nx,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,G=this.ik().getEngine().useReverseDepthBuffer;q.Matrix.PerspectiveFovLHToRef(I,1,G?J:Y,G?Y:J,k,!0,this._scene.getEngine().isNDCHalfZRange,void 0,G)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),q.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const k=this.projectionTextureLightFar,h=this.projectionTextureLightNear,o=k/(k-h),x=-o*h,I=1/Math.tan(this._angle/2);q.Matrix.FromValuesToRef(I/1,0,0,0,0,I,0,0,0,0,o,1,0,0,x,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof l.b){const k=this._projectionTexture.uScale/2,h=this._projectionTexture.vScale/2;q.Matrix.FromValuesToRef(k,0,0,0,0,h,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(k,h){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),k.setMatrix("textureProjectionMatrix"+h,this._projectionTextureMatrix),k.setTexture("projectionLightTexture"+h,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&k.setTexture("iesLightTexture"+h,this._iesProfileTexture),this}transferToEffect(k,h){let o;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,h),o=q.Vh.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,h),o=q.Vh.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",o.x,o.y,o.z,this._cosHalfAngle,h),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,h),this}transferToNodeMaterialEffect(k,h){let o;return o=this.computeTransformedInformation()?q.Vh.Normalize(this.transformedDirection):q.Vh.Normalize(this.direction),this.ik().useRightHandedSystem?k.setFloat3(h,-o.x,-o.y,-o.z):k.setFloat3(h,o.x,o.y,o.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(k){const h=this._scene.getEngine(),o=void 0!==this.shadowMinZ?this.shadowMinZ:(null===k||void 0===k?void 0:k.nx)??0;return h.useReverseDepthBuffer&&h.isNDCHalfZRange?o:this._scene.getEngine().isNDCHalfZRange?0:o}getDepthMaxZ(k){const h=this._scene.getEngine(),o=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===k||void 0===k?void 0:k.maxZ)??1e4;return h.useReverseDepthBuffer&&h.isNDCHalfZRange?0:o}prepareLightSpecificDefines(k,h){k["SPOTLIGHT"+h]=!0,k["PROJECTEDLIGHTTEXTURE"+h]=!(!this.projectionTexture||!this.projectionTexture.isReady()),k["IESLIGHTTEXTURE"+h]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,x.d)([(0,I.E)()],K.prototype,"angle",null),(0,x.d)([(0,I.E)()],K.prototype,"innerAngle",null),(0,x.d)([(0,I.E)()],K.prototype,"shadowAngleScale",null),(0,x.d)([(0,I.E)()],K.prototype,"exponent",void 0),(0,x.d)([(0,I.E)()],K.prototype,"projectionTextureLightNear",null),(0,x.d)([(0,I.E)()],K.prototype,"projectionTextureLightFar",null),(0,x.d)([(0,I.E)()],K.prototype,"projectionTextureUpDirection",null),(0,x.d)([(0,I.z)("projectedLightTexture")],K.prototype,"_projectionTexture",void 0),(0,A.g)("BABYLON.SpotLight",K)},12625:(k,h,o)=>{"use strict";o.d(h,{e:()=>Y,f:()=>q,g:()=>J});const x={},I={};function q(k,h){x[k]=h}function Y(k,h){I[k]=h}function J(k){return I[k]?I[k]:null}},12533:(k,h,o)=>{"use strict";o.d(h,{c:()=>V,g:()=>E});var x,I=o(11078),q=o(11082),Y=o(11472),J=o(11120),G=o(11098),l=o(11710),A=o(11127),K=o(11129),a=o(11208),N=o(11151),X=o(11112);!function(k){k[k.Clean=0]="Clean",k[k.Stop=1]="Stop",k[k.Sync=2]="Sync",k[k.NoSync=3]="NoSync"}(x||(x={}));const c=new q.d,W={};let f=!1;function M(){return W[".babylon"]}function T(k,h){const o=W[k];return o||(G.c.Warn("Unable to find a plugin to load "+k+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),h?M():void 0)}function j(k,h,o){let x="Unable to load from "+(k.rawData?"binary data":k.url);return h?x+=`: ${h}`:o&&(x+=`: ${o}`),x}async function d(k,h,o,x,I,q,Y,J,G){var l;const K="data:"===(a=k.url).substring(0,5)?a.substring(5):null;var a;if(k.rawData&&!Y)throw"When using ArrayBufferView to load data the file extension must be provided.";const f=K||Y?"":function(k){const h=k.indexOf("?");-1!==h&&(k=k.substring(0,h));const o=k.lastIndexOf(".");return k.substring(o,k.length).toLowerCase()}(k.url);let j=Y?T(Y,!0):K?function(k){for(const h in W){const o=W[h].plugin;if(o.canDirectLoad&&o.canDirectLoad(k))return W[h]}return M()}(k.url):T(f,!1);if(!j&&f){if(k.url&&!k.url.startsWith("blob:")){const h=await async function(k,h){const o=h.method||"GET";return await new Promise(((x,I)=>{const q=new X.e;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const k={};if(h.responseHeaders)for(const o of h.responseHeaders)k[o]=q.getResponseHeader(o)||"";x({response:q.response,headerValues:k})}else I(`Unable to fetch data from ${k}. Error code: ${q.status}`)})),q.open(o,k),q.send()}))}(k.url,{method:"HEAD",responseHeaders:["Content-Type"]}),o=h.headerValues?h.headerValues["Content-Type"]:"";o&&(j=function(k){for(const h in W){const o=W[h];if(o.mimeType===k)return o}}(o))}j||(j=M())}if(!j)throw new Error(`No plugin or fallback for ${Y??k.url}`);if(!1===(null===G||void 0===G||null===(l=G[j.plugin.name])||void 0===l?void 0:l.enabled))throw new Error(`The '${j.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(k.rawData&&!j.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(k=>{if(j.plugin.createPlugin){const h=j.plugin.createPlugin(G??{});return h instanceof Promise?(h.then(k).catch((k=>{I("Error instantiating plugin.",k)})),null):(k(h),h)}return k(j.plugin),j.plugin})((G=>{var l;if(!G)throw`The loader plugin corresponding to the '${Y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(c.notifyObservers(G),K&&(G.canDirectLoad&&G.canDirectLoad(k.url)||!(0,A.j)(k.url))){if(G.directLoad){const k=G.directLoad(h,K);k instanceof Promise?k.then((k=>{o(G,k)})).catch((k=>{I("Error in directLoad of _loadData: "+k,k)})):o(G,k)}else o(G,K);return}const a=j.isBinary,X=(k,x)=>{h.l?I("Scene has been disposed"):o(G,k,x)};let W=null,f=!1;null===(l=G.sh)||void 0===l||l.add((()=>{f=!0,W&&(W.abort(),W=null),q()}));const M=()=>{if(f)return;const o=(k,h)=>{I(null===k||void 0===k?void 0:k.statusText,h)};if(!G.loadFile&&k.rawData)throw"Plugin does not support loading ArrayBufferView.";W=G.loadFile?G.loadFile(h,k.rawData||k.file||k.url,k.rootUrl,X,x,a,o,J):h._loadFile(k.file||k.url,X,x,!0,a,o)},T=h.getEngine();let d=T.enableOfflineSupport;if(d){let o=!1;for(const x of h.disableOfflineSupportExceptionRules)if(x.test(k.url)){o=!0;break}d=!o}d&&N.e.OfflineProviderFactory?h.offlineProvider=N.e.OfflineProviderFactory(k.url,M,T.disableManifestCheck):M()}))}function b(k,h){let o,x,q=null,Y=null;if(h)if(h.name)o=`file:${h.name}`,x=h.name,q=h;else if(ArrayBuffer.isView(h))o="",x=(0,a.b)(),Y=h;else if(h.startsWith("data:"))o=h,x="";else if(k){const q=h;if("/"===q.substring(0,1))return I.Tools.Error("Wrong sceneFilename parameter"),null;o=k+q,x=q}else o=h,x=I.Tools.GetFilename(h),k=I.Tools.GetFolderPath(h);else o=k,x=I.Tools.GetFilename(k),k=I.Tools.GetFolderPath(k);return{url:o,rootUrl:k,name:x,file:q,rawData:Y}}function V(k){if("string"===typeof k.extensions){const h=k.extensions;W[h.toLowerCase()]={plugin:k,isBinary:!1}}else{const h=k.extensions,o=Object.keys(h);for(const x of o)W[x.toLowerCase()]={plugin:k,isBinary:h[x].isBinary,mimeType:h[x].mimeType}}}async function i(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.b.LastCreatedScene,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!x)return G.c.Error("No scene available to import mesh to"),null;const N=b(h,o);if(!N)return null;const X={};x.addPendingData(X);const c=()=>{x.removePendingData(X)},W=(k,h)=>{const o=j(N,k,h);Y?Y(x,o,new K.h(o,K.g.SceneLoaderError,h)):G.c.Error(o),c()},f=q?k=>{try{q(k)}catch(h){W("Error in onProgress callback: "+h,h)}}:void 0,M=(k,h,o,q,Y,J,G,l)=>{if(x.importedMeshesFiles.push(N.url),I)try{I(k,h,o,q,Y,J,G,l)}catch(A){W("Error in onSuccess callback: "+A,A)}x.removePendingData(X)};return await d(N,x,((h,o,I)=>{if(h.rewriteRootURL&&(N.rootUrl=h.rewriteRootURL(N.rootUrl,I)),h.importMesh){const I=[],q=[],Y=[];if(!h.importMesh(k,x,o,N.rootUrl,I,q,Y,W))return;x.loadingPluginName=h.name,M(I,q,Y,[],[],[],[],[])}else{h.importMeshAsync(k,x,o,N.rootUrl,f,N.name).then((k=>{x.loadingPluginName=h.name,M(k.meshes,k.ka,k.skeletons,k.animationGroups,k.transformNodes,k.geometries,k.lights,k.spriteManagers)})).catch((k=>{W(k.message,k)}))}}),f,W,c,l,A,a)}async function F(k,h,o,x,I,q,Y,J){return await new Promise(((G,l)=>{try{i(k,h,o,x,((k,h,o,x,I,q,Y,J)=>{G({meshes:k,ka:h,skeletons:o,animationGroups:x,transformNodes:I,geometries:q,lights:Y,spriteManagers:J})}),I,((k,h,o)=>{l(o||new Error(h))}),q,Y,J).catch(l)}catch(K){l(K)}}))}async function R(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.b.LastCreatedEngine,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};o?await Z(k,h,new Y.e(o),x,q,G,l,A,K):I.Tools.Error("No engine available")}async function s(k,h,o,x,I,q,Y){return await new Promise(((J,G)=>{R(k,h,o,(k=>{J(k)}),x,((k,h,o)=>{G(o||new Error(h))}),I,q,Y)}))}async function Z(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.b.LastCreatedScene,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!o)return G.c.Error("No scene available to append to"),null;const N=b(k,h);if(!N)return null;const X={};o.addPendingData(X);const c=()=>{o.removePendingData(X)};l.b.ShowLoadingScreen&&!f&&(f=!0,o.getEngine().displayLoadingUI(),o.executeWhenReady((()=>{o.getEngine().hideLoadingUI(),f=!1})));const W=(k,h)=>{const x=j(N,k,h);q?q(o,x,new K.h(x,K.g.SceneLoaderError,h)):G.c.Error(x),c()},M=I?k=>{try{I(k)}catch(h){W("Error in onProgress callback",h)}}:void 0,T=()=>{if(x)try{x(o)}catch(k){W("Error in onSuccess callback",k)}o.removePendingData(X)};return await d(N,o,((k,h)=>{if(k.load){if(!k.load(o,h,N.rootUrl,W))return;o.loadingPluginName=k.name,T()}else{k.loadAsync(o,h,N.rootUrl,M,N.name).then((()=>{o.loadingPluginName=k.name,T()})).catch((k=>{W(k.message,k)}))}}),M,W,c,Y,A,a)}async function w(k,h,o,x,I,q,Y){return await new Promise(((J,G)=>{try{Z(k,h,o,(k=>{J(k)}),x,((k,h,o)=>{G(o||new Error(h))}),I,q,Y).catch(G)}catch(K){G(K)}}))}async function D(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.b.LastCreatedScene,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!o)return G.c.Error("No scene available to load asset container to"),null;const a=b(k,h);if(!a)return null;const N={};o.addPendingData(N);const X=()=>{o.removePendingData(N)},c=(k,h)=>{const x=j(a,k,h);q?q(o,x,new K.h(x,K.g.SceneLoaderError,h)):G.c.Error(x),X()},W=I?k=>{try{I(k)}catch(h){c("Error in onProgress callback",h)}}:void 0,f=k=>{if(x)try{x(k)}catch(h){c("Error in onSuccess callback",h)}o.removePendingData(N)};return await d(a,o,((k,h)=>{if(k.loadAssetContainer){const x=k.loadAssetContainer(o,h,a.rootUrl,c);if(!x)return;x.populateRootNodes(),o.loadingPluginName=k.name,f(x)}else if(k.loadAssetContainerAsync){k.loadAssetContainerAsync(o,h,a.rootUrl,W,a.name).then((h=>{h.populateRootNodes(),o.loadingPluginName=k.name,f(h)})).catch((k=>{c(k.message,k)}))}else c("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),W,c,X,Y,l,A)}async function U(k,h,o,x,I,q,Y){return await new Promise(((J,G)=>{try{D(k,h,o,(k=>{J(k)}),x,((k,h,o)=>{G(o||new Error(h))}),I,q,Y).catch(G)}catch(K){G(K)}}))}async function Q(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.b.LastCreatedScene,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!o)return void G.c.Error("No scene available to load animations to");if(x){for(const x of o.animatables)x.reset();o.stopAllAnimations();const k=o.animationGroups.slice();for(const o of k)o.dispose();const h=o.getNodes();for(const o of h)o.animations&&(o.animations=[])}else switch(I){case 0:const k=o.animationGroups.slice();for(const h of k)h.dispose();break;case 1:for(const h of o.animationGroups)h.stop();break;case 2:for(const h of o.animationGroups)h.reset(),h.restart();break;case 3:break;default:return void G.c.Error("Unknown animation group loading mode value '"+I+"'")}const X=o.animatables.length;await D(k,h,o,(k=>{k.mergeAnimationsTo(o,o.animatables.slice(X),q),k.dispose(),o.onAnimationFileImportedObservable.notifyObservers(o),Y&&Y(o)}),l,A,K,a,N)}async function B(k,h,o,x,I,q,Y,J,G,l){return await new Promise(((A,a)=>{try{Q(k,h,o,x,I,q,(k=>{A(k)}),Y,((k,h,o)=>{a(o||new Error(h))}),J,G,l).catch(a)}catch(K){a(K)}}))}class E{static get ForceFullSceneLoadingForIncremental(){return l.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(k){l.b.ForceFullSceneLoadingForIncremental=k}static get ShowLoadingScreen(){return l.b.ShowLoadingScreen}static set ShowLoadingScreen(k){l.b.ShowLoadingScreen=k}static get loggingLevel(){return l.b.loggingLevel}static set loggingLevel(k){l.b.loggingLevel=k}static get CleanBoneMatrixWeights(){return l.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(k){l.b.CleanBoneMatrixWeights=k}static GetDefaultPlugin(){return M()}static GetPluginForExtension(k){var h;return null===(h=T(k,!0))||void 0===h?void 0:h.plugin}static IsPluginForExtensionAvailable(k){return function(k){return!!W[k]}(k)}static RegisterPlugin(k){V(k)}static ImportMesh(k,h,o,x,I,q,Y,G,l){i(k,h,o,x,I,q,Y,G,l).catch((k=>null===Y||void 0===Y?void 0:Y(J.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async ImportMeshAsync(k,h,o,x,I,q,Y){return await F(k,h,o,x,I,q,Y)}static Load(k,h,o,x,I,q,Y,G){R(k,h,o,x,I,q,Y,G).catch((k=>null===q||void 0===q?void 0:q(J.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async LoadAsync(k,h,o,x,I,q){return await s(k,h,o,x,I,q)}static Append(k,h,o,x,I,q,Y,G){Z(k,h,o,x,I,q,Y,G).catch((k=>null===q||void 0===q?void 0:q(o??J.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async AppendAsync(k,h,o,x,I,q){return await w(k,h,o,x,I,q)}static LoadAssetContainer(k,h,o,x,I,q,Y,G){D(k,h,o,x,I,q,Y,G).catch((k=>null===q||void 0===q?void 0:q(o??J.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async LoadAssetContainerAsync(k,h,o,x,I,q){return await U(k,h,o,x,I,q)}static ImportAnimations(k,h,o,x,I,q,Y,G,l,A,K){Q(k,h,o,x,I,q,Y,G,l,A,K).catch((k=>null===l||void 0===l?void 0:l(o??J.b.LastCreatedScene,null===k||void 0===k?void 0:k.message,k)))}static async ImportAnimationsAsync(k,h,o,x,I,q,Y,J,G,l,A){return await B(k,h,o,x,I,q,J,l,A)}}E.NO_LOGGING=0,E.MINIMAL_LOGGING=1,E.SUMMARY_LOGGING=2,E.DETAILED_LOGGING=3,E.OnPluginActivatedObservable=c},12903:(k,h,o)=>{"use strict";o.d(h,{d:()=>a});var x=o(11227),I=o(11233),q=o(11078),Y=o(11239),J=o(11266),G=o(11223),l=o(11199),A=o(11082),K=o(11271);o(12907);class a extends J.c{set boundingBoxSize(k){if(this._boundingBoxSize&&this._boundingBoxSize.equals(k))return;this._boundingBoxSize=k;const h=this.ik();h&&h.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(k){this._rotationY=k,this.setReflectionTextureMatrix(Y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(k,h,o){let x="";for(const I of k)x+=I;return new a(x,h,null,o,k)}static CreateFromPrefilteredData(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const I=h.useDelayedTextureLoading;h.useDelayedTextureLoading=!1;const q=new a(k,h,null,!1,null,null,null,void 0,!0,o,x);return h.useDelayedTextureLoading=I,q}constructor(k,h){var o;let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,a=arguments.length>8&&void 0!==arguments[8]&&arguments[8],N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,W=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13?arguments[13]:void 0,M=arguments.length>14?arguments[14]:void 0;super(h),this.onLoadObservable=new A.d,this.boundingBoxPosition=Y.Vh.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Y.Matrix,this._buffer=null,this.name=k,this.url=k,this._noMipmap=I,this.Sh=!1,this.isCube=!0,this._textureMatrix=Y.Matrix.Identity(),this.coordinatesMode=G.b.CUBIC_MODE;let T=null,j=null;null===x||Array.isArray(x)?(this._noMipmap=I,this._format=K,this._createPolynomials=X,T=x,this._loaderOptions=f,this._useSRGBBuffer=M,this._lodScale=c,this._lodOffset=W):(T=x.extensions??null,this._noMipmap=x.noMipmap??!1,q=x.files??null,j=x.buffer??null,this._format=x.format??5,a=x.prefiltered??!1,N=x.forcedExtension??null,this._createPolynomials=x.createPolynomials??!1,this._lodScale=x.lodScale??.8,this._lodOffset=x.lodOffset??0,this._loaderOptions=x.loaderOptions,this._useSRGBBuffer=x.useSRGBBuffer,J=x.S??null,l=x.onError??null),(k||q)&&this.updateURL(k,N,J,a,l,T,null===(o=this.ik())||void 0===o?void 0:o.useDelayedTextureLoading,q,j)}getClassName(){return"CubeTexture"}updateURL(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=k),this.url=k,h&&(this._forcedExtension=h);const l=k.lastIndexOf("."),A=h||(l>-1?k.substring(l).toLowerCase():""),K=0===A.indexOf(".dds"),a=0===A.indexOf(".env"),N=0===A.indexOf(".basis");if(a?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=x,x&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),J)this._files=J;else if(N||a||K||q||(q=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,q){for(let h=0;h<q.length;h++)this._files.push(k+q[h]);this._extensions=q}this._buffer=G,Y?(this.delayLoadState=4,this._delayedOnLoad=o,this._delayedOnError=I):this._loadTexture(o,I)}delayLoad(k){4===this.delayLoadState&&(k&&(this._forcedExtension=k),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(k){var h,o;if(k.updateFlag===this._textureMatrix.updateFlag)return;k.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(o=this.ik())||void 0===o||o.markAllMaterialsAsDirty(1,(k=>-1!==k.getActiveTextures().indexOf(this))));if(this._textureMatrix=k,null===(h=this.ik())||void 0===h||!h.useRightHandedSystem)return;const x=Y.TmpVectors.Vh[0],I=Y.TmpVectors.Quaternion[0],q=Y.TmpVectors.Vh[1];this._textureMatrix.decompose(x,I,q),I.z*=-1,I.w*=-1,Y.Matrix.ComposeToRef(x,I,q,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var k;return null!==(k=this.ik())&&void 0!==k&&k.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this.ik(),x=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const I=()=>{var h;(this.onLoadObservable.notifyObservers(this),x)&&(x.dispose(),null===(h=this.ik())||void 0===h||h.markAllMaterialsAsDirty(1));k&&k()},Y=(k,o)=>{this._loadingError=!0,this._errorObject={message:k,exception:o},h&&h(k,o),G.b.OnTextureLoadErrorObservable.notifyObservers(this)};var J;this._texture?this._texture.isReady?q.Tools.SetImmediate((()=>I())):this._texture.onLoadedObservable.add((()=>I())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,o,this._lodScale,this._lodOffset,k,Y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,o,this._files,this._noMipmap,k,Y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(J=this._texture)||void 0===J||J.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(k,h,o){const x=K.c.Parse((()=>{let x=!1;return k.prefiltered&&(x=k.prefiltered),new a(o+(k.url??k.name),h,k.extensions,!1,k.files||null,null,null,void 0,x,k.forcedExtension)}),k,h);if(k.boundingBoxPosition&&(x.boundingBoxPosition=Y.Vh.Uh(k.boundingBoxPosition)),k.boundingBoxSize&&(x.boundingBoxSize=Y.Vh.Uh(k.boundingBoxSize)),k.animations)for(let I=0;I<k.animations.length;I++){const h=k.animations[I],o=(0,l.e)("BABYLON.Animation");o&&x.animations.push(o.Parse(h))}return x}clone(){let k=0;const h=K.c.Clone((()=>{const h=new a(this.url,this.ik()||this._getEngine(),this._extensions,this._noMipmap,this._files);return k=h.uniqueId,h}),this);return h.uniqueId=k,h}}(0,x.d)([(0,I.E)()],a.prototype,"url",void 0),(0,x.d)([(0,I.D)()],a.prototype,"boundingBoxPosition",void 0),(0,x.d)([(0,I.D)()],a.prototype,"boundingBoxSize",null),(0,x.d)([(0,I.E)("rotationY")],a.prototype,"rotationY",null),(0,x.d)([(0,I.E)("files")],a.prototype,"_files",void 0),(0,x.d)([(0,I.E)("forcedExtension")],a.prototype,"_forcedExtension",void 0),(0,x.d)([(0,I.E)("extensions")],a.prototype,"_extensions",void 0),(0,x.d)([(0,I.s)("textureMatrix")],a.prototype,"_textureMatrix",void 0),(0,x.d)([(0,I.s)("textureMatrixRefraction")],a.prototype,"_textureMatrixRefraction",void 0),G.b._CubeTextureParser=a.Parse,(0,l.g)("BABYLON.CubeTexture",a)},13403:(k,h,o)=>{"use strict";o.d(h,{d:()=>G});var x=o(11098),I=o(11223),q=o(11213),Y=o(11372),J=o(11180);Y.ThinEngine.prototype.createDynamicTexture=function(k,h,o,x){const I=new J.c(this,4);return I.baseWidth=k,I.baseHeight=h,o&&(k=this.needPOTTextures?(0,q.e)(k,this._caps.maxTextureSize):k,h=this.needPOTTextures?(0,q.e)(h,this._caps.maxTextureSize):h),I.width=k,I.height=h,I.isReady=!1,I.generateMipMaps=o,I.samplingMode=x,this.updateTextureSamplingMode(x,I),this._internalTexturesCache.push(I),I},Y.ThinEngine.prototype.updateDynamicTexture=function(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!k)return;const Y=this._gl,J=Y.TEXTURE_2D,G=this._bindTextureDirectly(J,k,!0,q);this._unpackFlipY(void 0===o?k.invertY:o),x&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const l=this._getWebGLTextureType(k.type),A=this._getInternalFormat(I||k.format),K=this._getRGBABufferInternalSizedFormat(k.type,A);Y.texImage2D(J,0,K,A,l,h),k.generateMipMaps&&Y.generateMipmap(J),G||this._bindTextureDirectly(J,null),x&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),I&&(k.format=I),k._dynamicTextureSource=h,k._premulAlpha=x,k.invertY=o||!1,k.isReady=!0};class G extends I.b{constructor(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,J=arguments.length>6?arguments[6]:void 0;const G=!o||o._isScene;super(null,G?o:null===o||void 0===o?void 0:o.Fh,G?!x:o,J,q,void 0,void 0,void 0,void 0,Y),this.name=k,this.wrapU=I.b.CLAMP_ADDRESSMODE,this.wrapV=I.b.CLAMP_ADDRESSMODE,this._generateMipMaps=x;const l=this._getEngine();if(!l)return;if(h.getContext)this._canvas=h,this._ownCanvas=!1,this._texture=l.createDynamicTexture(this._canvas.width,this._canvas.height,x,q);else{this._canvas=l.createCanvas(1,1),this._ownCanvas=!0;const k=h;k.width||0===k.width?this._texture=l.createDynamicTexture(k.width,k.height,x,q):this._texture=l.createDynamicTexture(h,h,x,q)}const A=this.getSize();this._canvas.width!==A.width&&(this._canvas.width=A.width),this._canvas.height!==A.height&&(this._canvas.height=A.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(k){this._canvas.width=k.width,this._canvas.height=k.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(k.width,k.height,this._generateMipMaps,this.samplingMode)}scale(k){const h=this.getSize();h.width*=k,h.height*=k,this._recreate(h)}scaleTo(k,h){const o=this.getSize();o.width=k,o.height=h,this._recreate(o)}getContext(){return this._context}clear(k){const h=this.getSize();k&&(this._context.fillStyle=k),this._context.clearRect(0,0,h.width,h.height)}update(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===k||k,h,this._format||void 0,void 0,o)}drawText(k,h,o,x,I,q,Y){let J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const G=this.getSize();if(q&&(this._context.fillStyle=q,this._context.fillRect(0,0,G.width,G.height)),this._context.font=x,null===h||void 0===h){const o=this._context.measureText(k);h=(G.width-o.width)/2}if(null===o||void 0===o){const k=parseInt(x.replace(/\D/g,""));o=G.height/2+k/3.65}this._context.fillStyle=I||"",this._context.fillText(k,h,o),J&&this.update(Y)}dispose(){var k,h;(super.dispose(),this._ownCanvas)&&(null===(k=this._canvas)||void 0===k||null===(h=k.remove)||void 0===h||h.call(k));this._canvas=null,this._context=null}clone(){const k=this.ik();if(!k)return this;const h=this.getSize(),o=new G(this.name,h,k,this._generateMipMaps);return o.Sh=this.Sh,o.level=this.level,o.wrapU=this.wrapU,o.wrapV=this.wrapV,o}serialize(){const k=this.ik();k&&!k.isReady()&&x.c.Warn("The scene must be ready before serializing the dynamic texture");const h=super.serialize();return G._IsCanvasElement(this._canvas)&&(h.base64String=this._canvas.toDataURL()),h.invertY=this._invertY,h.samplingMode=this.samplingMode,h}static _IsCanvasElement(k){return void 0!==k.toDataURL}_rebuild(){this.update()}}},12822:(k,h,o)=>{"use strict";o.d(h,{e:()=>I});var x=o(11223);class I extends x.b{get depth(){return this._depth}constructor(k,h,o,I,q,Y){let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:x.b.TRILINEAR_SAMPLINGMODE,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,K=arguments.length>10?arguments[10]:void 0;super(null,Y,!J,G),this.format=q,this._texture=Y.getEngine().createRawTexture2DArray(k,h,o,I,q,J,G,l,null,A,K),this._depth=I,this.is2DArray=!0}update(k){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,k,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(k,h,o,x,q){return new I(k,h,o,x,5,q,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12642:(k,h,o)=>{"use strict";o.d(h,{e:()=>J,i:()=>G,j:()=>q,l:()=>Y});var x=o(11260),I=o(11239);function q(k,h){return`{X: ${k.x.toFixed(h)} Y: ${k.y.toFixed(h)}}`}function Y(k,h){return`{X: ${k._x.toFixed(h)} Y: ${k._y.toFixed(h)} Z: ${k._z.toFixed(h)}}`}function J(k,h){return 2*Math.acos((0,x.Clamp)(I.Quaternion.Dot(k,h)))}function G(k,h){const o=new I.Quaternion;return function(k,h,o){const q=I.Vh.Cross(k,h),Y=Math.acos((0,x.Clamp)(I.Vh.Dot(k,h),-1,1));I.Quaternion.RotationAxisToRef(q,Y,o)}(k,h,o),o}},12486:(k,h,o)=>{"use strict";o.d(h,{e:()=>l});var x=o(11239),I=o(11281),q=o(11696),Y=o(11672),J=o(11292);o(12493);function G(k){let h=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const o=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],q=[];let G=[];const l=k.width||k.size||1,A=k.height||k.size||1,K=k.depth||k.size||1,a=k.wrap||!1;let N=void 0===k.topBaseAt?1:k.topBaseAt,X=void 0===k.bottomBaseAt?0:k.bottomBaseAt;N=(N+4)%4,X=(X+4)%4;let c=[2,0,3,1][N],W=[2,0,1,3][X],f=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(a){h=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],f=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let k=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],o=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const x=[17,18,19,16],I=[22,23,20,21];for(;c>0;)k.unshift(k.pop()),x.unshift(x.pop()),c--;for(;W>0;)o.unshift(o.pop()),I.unshift(I.pop()),W--;k=k.flat(),o=o.flat(),f=f.concat(k).concat(o),h.push(x[0],x[2],x[3],x[0],x[1],x[2]),h.push(I[0],I[2],I[3],I[0],I[1],I[2])}const M=[l/2,A/2,K/2];G=f.reduce(((k,h,o)=>k.concat(h*M[o%3])),[]);const T=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE,j=k.faceUV||new Array(6),d=k.faceColors,b=[];for(let Y=0;Y<6;Y++)void 0===j[Y]&&(j[Y]=new x.Vector4(0,0,1,1)),d&&void 0===d[Y]&&(d[Y]=new I.RJ(1,1,1,1));for(let x=0;x<6;x++)if(q.push(j[x].z,J.c?1-j[x].w:j[x].w),q.push(j[x].x,J.c?1-j[x].w:j[x].w),q.push(j[x].x,J.c?1-j[x].y:j[x].y),q.push(j[x].z,J.c?1-j[x].y:j[x].y),d)for(let k=0;k<4;k++)b.push(d[x].r,d[x].g,d[x].b,d[x].a);Y.e._ComputeSides(T,G,h,o,q,k.frontUVs,k.backUVs);const V=new Y.e;if(V.indices=h,V.Rk=G,V.sk=o,V.wk=q,d){const k=T===Y.e.DOUBLESIDE?b.concat(b):b;V.Zk=k}return V}function l(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new q.e(k,o);h.sideOrientation=q.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return G(h).Uk(x,h.updatable),x}Y.e.CreateBox=G,q.e.CreateBox=function(k,h){return l(k,{size:h,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12631:(k,h,o)=>{"use strict";o.d(h,{e:()=>J});var x=o(11696),I=o(11672),q=o(11292);function Y(k){const h=[],o=[],x=[],Y=[],J=k.radius||.5,G=k.tessellation||64,l=k.arc&&(k.arc<=0||k.arc>1)?1:k.arc||1,A=0===k.sideOrientation?0:k.sideOrientation||I.e.DEFAULTSIDE;h.push(0,0,0),Y.push(.5,.5);const K=2*Math.PI*l,a=1===l?K/G:K/(G-1);let N=0;for(let I=0;I<G;I++){const k=Math.cos(N),o=Math.sin(N),x=(k+1)/2,I=(1-o)/2;h.push(J*k,J*o,0),Y.push(x,q.c?1-I:I),N+=a}1===l&&(h.push(h[3],h[4],h[5]),Y.push(Y[2],q.c?1-Y[3]:Y[3]));const X=h.length/3;for(let I=1;I<X-1;I++)o.push(I+1,0,I);I.e.ComputeNormals(h,o,x),I.e._ComputeSides(A,h,o,x,Y,k.frontUVs,k.backUVs);const c=new I.e;return c.indices=o,c.Rk=h,c.sk=x,c.wk=Y,c}function J(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new x.e(k,o);h.sideOrientation=x.e._GetDefaultSideOrientation(h.sideOrientation),I._originalBuilderSideOrientation=h.sideOrientation;return Y(h).Uk(I,h.updatable),I}I.e.CreateDisc=Y,x.e.CreateDisc=function(k,h,o){return J(k,{radius:h,tessellation:o,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12493:(k,h,o)=>{"use strict";o.d(h,{h:()=>W,e:()=>M,j:()=>f});var x=o(11239),I=o(11281),q=o(11696),Y=o(11672),J=o(11308);q.e._GroundMeshParser=(k,h)=>G.Parse(k,h);class G extends q.e{constructor(k,h){super(k,h),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=k,this._subdivisionsY=k,this.subdivide(k);const o=this;o.createOrUpdateSubmeshesOctree&&o.createOrUpdateSubmeshesOctree(h)}getHeightAtCoordinates(k,h){const o=this.getWorldMatrix(),I=x.TmpVectors.Matrix[5];o.invertToRef(I);const q=x.TmpVectors.Vh[8];if(x.Vh.TransformCoordinatesFromFloatsToRef(k,0,h,I,q),k=q.x,h=q.z,k<this._minX||k>=this._maxX||h<=this._minZ||h>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(k,h),J=-(Y.x*k+Y.z*h+Y.w)/Y.y;return x.Vh.TransformCoordinatesFromFloatsToRef(0,J,0,o,q),q.y}getNormalAtCoordinates(k,h){const o=new x.Vh(0,1,0);return this.getNormalAtCoordinatesToRef(k,h,o),o}getNormalAtCoordinatesToRef(k,h,o){const I=this.getWorldMatrix(),q=x.TmpVectors.Matrix[5];I.invertToRef(q);const Y=x.TmpVectors.Vh[8];if(x.Vh.TransformCoordinatesFromFloatsToRef(k,0,h,q,Y),k=Y.x,h=Y.z,k<this._minX||k>this._maxX||h<this._minZ||h>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const J=this._getFacetAt(k,h);return x.Vh.TransformNormalFromFloatsToRef(J.x,J.y,J.z,I,o),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(k,h){const o=Math.floor((k+this._maxX)*this._subdivisionsX/this._width),x=Math.floor(-(h+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),I=this._heightQuads[x*this._subdivisionsX+o];let q;return q=h<I.slope.x*k+I.slope.y?I.facet1:I.facet2,q}_initHeightQuads(){const k=this._subdivisionsX,h=this._subdivisionsY;this._heightQuads=[];for(let o=0;o<h;o++)for(let h=0;h<k;h++){const I={slope:x.Vector2.Zero(),facet1:new x.Vector4(0,0,0,0),facet2:new x.Vector4(0,0,0,0)};this._heightQuads[o*k+h]=I}return this}_computeHeightQuads(){const k=this.getVerticesData(J.g.PositionKind);if(!k)return this;const h=x.TmpVectors.Vh[3],o=x.TmpVectors.Vh[2],I=x.TmpVectors.Vh[1],q=x.TmpVectors.Vh[0],Y=x.TmpVectors.Vh[4],G=x.TmpVectors.Vh[5],l=x.TmpVectors.Vh[6],A=x.TmpVectors.Vh[7],K=x.TmpVectors.Vh[8];let a=0,N=0,X=0,c=0,W=0,f=0,M=0;const T=this._subdivisionsX,j=this._subdivisionsY;for(let J=0;J<j;J++)for(let j=0;j<T;j++){a=3*j,N=J*(T+1)*3,X=(J+1)*(T+1)*3,h.x=k[N+a],h.y=k[N+a+1],h.z=k[N+a+2],o.x=k[N+a+3],o.y=k[N+a+4],o.z=k[N+a+5],I.x=k[X+a],I.y=k[X+a+1],I.z=k[X+a+2],q.x=k[X+a+3],q.y=k[X+a+4],q.z=k[X+a+5],c=(q.z-h.z)/(q.x-h.x),W=h.z-c*h.x,o.subtractToRef(h,Y),I.subtractToRef(h,G),q.subtractToRef(h,l),x.Vh.CrossToRef(l,G,A),x.Vh.CrossToRef(Y,l,K),A.normalize(),K.normalize(),f=-(A.x*h.x+A.y*h.y+A.z*h.z),M=-(K.x*o.x+K.y*o.y+K.z*o.z);const d=this._heightQuads[J*T+j];d.slope.VJ(c,W),d.facet1.VJ(A.x,A.y,A.z,f),d.facet2.VJ(K.x,K.y,K.z,M)}return this}serialize(k){super.serialize(k),k.subdivisionsX=this._subdivisionsX,k.subdivisionsY=this._subdivisionsY,k.minX=this._minX,k.maxX=this._maxX,k.nx=this._minZ,k.maxZ=this._maxZ,k.width=this._width,k.height=this._height}static Parse(k,h){const o=new G(k.name,h);return o._subdivisionsX=k.subdivisionsX||1,o._subdivisionsY=k.subdivisionsY||1,o._minX=k.minX,o._maxX=k.maxX,o._minZ=k.nx,o._maxZ=k.maxZ,o._width=k.width,o._height=k.height,o}}var l=o(11078),A=o(11120),K=o(11248),a=o(11292);function N(k){const h=[],o=[],I=[],q=[];let J,G;const l=k.width||k.size||1,A=k.height||k.size||1,K=0|(k.subdivisionsX||k.subdivisions||1),N=0|(k.subdivisionsY||k.subdivisions||1);for(J=0;J<=N;J++)for(G=0;G<=K;G++){const k=new x.Vh(G*l/K-l/2,0,(N-J)*A/N-A/2),h=new x.Vh(0,1,0);o.push(k.x,k.y,k.z),I.push(h.x,h.y,h.z),q.push(G/K,a.c?J/N:1-J/N)}for(J=0;J<N;J++)for(G=0;G<K;G++)h.push(G+1+(J+1)*(K+1)),h.push(G+1+J*(K+1)),h.push(G+J*(K+1)),h.push(G+(J+1)*(K+1)),h.push(G+1+(J+1)*(K+1)),h.push(G+J*(K+1));const X=new Y.e;return X.indices=h,X.Rk=o,X.sk=I,X.wk=q,X}function X(k){const h=void 0!==k.xmin&&null!==k.xmin?k.xmin:-1,o=void 0!==k.zmin&&null!==k.zmin?k.zmin:-1,I=void 0!==k.xmax&&null!==k.xmax?k.xmax:1,q=void 0!==k.zmax&&null!==k.zmax?k.zmax:1,J=k.subdivisions||{w:1,h:1},G=k.precision||{w:1,h:1},l=[],A=[],K=[],a=[];let N,X,c,W;J.h=J.h<1?1:J.h,J.w=J.w<1?1:J.w,G.w=G.w<1?1:G.w,G.h=G.h<1?1:G.h;const f=(I-h)/J.w,M=(q-o)/J.h;function T(k,h,o,I){const q=A.length/3,Y=G.w+1;for(N=0;N<G.h;N++)for(X=0;X<G.w;X++){const k=[q+X+N*Y,q+(X+1)+N*Y,q+(X+1)+(N+1)*Y,q+X+(N+1)*Y];l.push(k[1]),l.push(k[2]),l.push(k[3]),l.push(k[0]),l.push(k[1]),l.push(k[3])}const J=x.Vh.Zero(),c=new x.Vh(0,1,0);for(N=0;N<=G.h;N++)for(J.z=N*(I-h)/G.h+h,X=0;X<=G.w;X++)J.x=X*(o-k)/G.w+k,J.y=0,A.push(J.x,J.y,J.z),K.push(c.x,c.y,c.z),a.push(X/G.w,N/G.h)}for(c=0;c<J.h;c++)for(W=0;W<J.w;W++)T(h+W*f,o+c*M,h+(W+1)*f,o+(c+1)*M);const j=new Y.e;return j.indices=l,j.Rk=A,j.sk=K,j.wk=a,j}function c(k){const h=[],o=[],q=[],J=[];let G,l;const A=k.colorFilter||new I.Zh(.3,.59,.11),a=k.alphaFilter||0;let N=!1;if(k.minHeight>k.maxHeight){N=!0;const h=k.maxHeight;k.maxHeight=k.minHeight,k.minHeight=h}for(G=0;G<=k.subdivisions;G++)for(l=0;l<=k.subdivisions;l++){const h=new x.Vh(l*k.width/k.subdivisions-k.width/2,0,(k.subdivisions-G)*k.height/k.subdivisions-k.height/2),I=4*(((h.x+k.width/2)/k.width*(k.bufferWidth-1)|0)+((1-(h.z+k.height/2)/k.height)*(k.bufferHeight-1)|0)*k.bufferWidth);let Y=k.buffer[I]/255,X=k.buffer[I+1]/255,c=k.buffer[I+2]/255;const W=k.buffer[I+3]/255;N&&(Y=1-Y,X=1-X,c=1-c);const f=Y*A.r+X*A.g+c*A.b;h.y=W>=a?k.minHeight+(k.maxHeight-k.minHeight)*f:k.minHeight-K.d,k.heightBuffer&&(k.heightBuffer[G*(k.subdivisions+1)+l]=h.y),o.push(h.x,h.y,h.z),q.push(0,0,0),J.push(l/k.subdivisions,1-G/k.subdivisions)}for(G=0;G<k.subdivisions;G++)for(l=0;l<k.subdivisions;l++){const x=l+1+(G+1)*(k.subdivisions+1),I=l+1+G*(k.subdivisions+1),q=l+G*(k.subdivisions+1),Y=l+(G+1)*(k.subdivisions+1),J=o[3*x+1]>=k.minHeight,A=o[3*I+1]>=k.minHeight,K=o[3*q+1]>=k.minHeight;J&&A&&K&&(h.push(x),h.push(I),h.push(q));o[3*Y+1]>=k.minHeight&&J&&K&&(h.push(Y),h.push(x),h.push(q))}Y.e.ComputeNormals(o,h,q);const X=new Y.e;return X.indices=h,X.Rk=o,X.sk=q,X.wk=J,X}function W(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=new G(k,arguments.length>2?arguments[2]:void 0);o._setReady(!1),o._subdivisionsX=h.subdivisionsX||h.subdivisions||1,o._subdivisionsY=h.subdivisionsY||h.subdivisions||1,o._width=h.width||1,o._height=h.height||1,o._maxX=o._width/2,o._maxZ=o._height/2,o._minX=-o._maxX,o._minZ=-o._maxZ;return N(h).Uk(o,h.updatable),o._setReady(!0),o}function f(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new q.e(k,o);return X(h).Uk(x,h.updatable),x}function M(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const q=o.width||10,Y=o.height||10,J=o.subdivisions||1,K=o.minHeight||0,a=o.maxHeight||1,N=o.colorFilter||new I.Zh(.3,.59,.11),X=o.alphaFilter||0,W=o.updatable,f=o.onReady;x=x||A.b.LastCreatedScene;const M=new G(k,x);let T;M._subdivisionsX=J,M._subdivisionsY=J,M._width=q,M._height=Y,M._maxX=M._width/2,M._maxZ=M._height/2,M._minX=-M._maxX,M._minZ=-M._maxZ,M._setReady(!1),o.passHeightBufferInCallback&&(T=new Float32Array((J+1)*(J+1)));const j=(k,h,o)=>{c({width:q,height:Y,subdivisions:J,minHeight:K,maxHeight:a,colorFilter:N,buffer:k,bufferWidth:h,bufferHeight:o,alphaFilter:X,heightBuffer:T}).Uk(M,W),f&&f(M,T),M._setReady(!0)};if("string"===typeof h){const k=k=>{var h;const o=k.width,I=k.height;if(x.l)return;const q=null===(h=x)||void 0===h?void 0:h.getEngine().resizeImageBitmap(k,o,I);j(q,o,I)};l.Tools.LoadImage(h,k,o.onError?o.onError:()=>{},x.offlineProvider)}else j(h.data,h.width,h.height);return M}Y.e.CreateGround=N,Y.e.CreateTiledGround=X,Y.e.CreateGroundFromHeightMap=c,q.e.CreateGround=(k,h,o,x,I,q)=>W(k,{width:h,height:o,subdivisions:x,updatable:q},I),q.e.CreateTiledGround=(k,h,o,x,I,q,Y,J,G)=>f(k,{xmin:h,zmin:o,xmax:x,zmax:I,subdivisions:q,precision:Y,updatable:G},J),q.e.CreateGroundFromHeightMap=(k,h,o,x,I,q,Y,J,G,l,A)=>M(k,h,{width:o,height:x,subdivisions:I,minHeight:q,maxHeight:Y,updatable:G,onReady:l,alphaFilter:A},J)},13104:(k,h,o)=>{"use strict";o.d(h,{d:()=>N,h:()=>K,j:()=>a});var x=o(11239),I=o(11696),q=o(11672),Y=o(11805),J=o(11308),G=o(11098);function l(k){const h=[],o=[],x=k.lines,I=k.Zk,Y=[];let J=0;for(let q=0;q<x.length;q++){const k=x[q];for(let x=0;x<k.length;x++){const{x:G,y:l,z:A}=k[x];if(o.push(G,l,A),I){const k=I[q],{r:h,g:o,b:J,a:G}=k[x];Y.push(h,o,J,G)}x>0&&(h.push(J-1),h.push(J)),J++}}const G=new q.e;return G.indices=h,G.Rk=o,I&&(G.Zk=Y),G}function A(k){const h=k.dashSize||3,o=k.gapSize||1,I=k.dashNb||200,Y=k.points,J=[],G=[],l=x.Vh.Zero();let A=0,K=0,a=0,N=0,X=0,c=0,W=0;for(W=0;W<Y.length-1;W++)Y[W+1].subtractToRef(Y[W],l),A+=l.length();for(a=A/I,N=h*a/(h+o),W=0;W<Y.length-1;W++){Y[W+1].subtractToRef(Y[W],l),K=Math.floor(l.length()/a),l.normalize();for(let k=0;k<K;k++)X=a*k,J.push(Y[W].x+X*l.x,Y[W].y+X*l.y,Y[W].z+X*l.z),J.push(Y[W].x+(X+N)*l.x,Y[W].y+(X+N)*l.y,Y[W].z+(X+N)*l.z),G.push(c,c+1),c+=2}const f=new q.e;return f.Rk=J,f.indices=G,f}function K(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=h.instance,I=h.lines,q=h.Zk;if(x){const k=x.getVerticesData(J.g.PositionKind);let h,o;q&&(h=x.getVerticesData(J.g.ColorKind));let Y=0,G=0;for(let x=0;x<I.length;x++){const J=I[x];for(let I=0;I<J.length;I++)k[Y]=J[I].x,k[Y+1]=J[I].y,k[Y+2]=J[I].z,q&&h&&(o=q[x],h[G]=o[I].r,h[G+1]=o[I].g,h[G+2]=o[I].b,h[G+3]=o[I].a,G+=4),Y+=3}return x.updateVerticesData(J.g.PositionKind,k,!1,!1),q&&h&&x.updateVerticesData(J.g.ColorKind,h,!1,!1),x.refreshBoundingInfo(),x}const G=!!q,A=new Y.b(k,o,null,void 0,void 0,G,h.useVertexAlpha,h.material);return l(h).Uk(A,h.updatable),A}function a(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=h.Zk?[h.Zk]:null;return K(k,{lines:[h.points],updatable:h.updatable,instance:h.instance,Zk:x,useVertexAlpha:h.useVertexAlpha,material:h.material},o)}function N(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=h.points,J=h.instance,l=h.gapSize||1,K=h.dashSize||3;if(J){const k=k=>{const h=x.Vh.Zero(),o=k.length/6;let I=0,Y=0,G=0,l=0,A=0,K=0,a=0,N=0;for(a=0;a<q.length-1;a++)q[a+1].subtractToRef(q[a],h),I+=h.length();G=I/o;const X=J._creationDataStorage.dashSize;for(l=X*G/(X+J._creationDataStorage.gapSize),a=0;a<q.length-1;a++)for(q[a+1].subtractToRef(q[a],h),Y=Math.floor(h.length()/G),h.normalize(),N=0;N<Y&&K<k.length;)A=G*N,k[K]=q[a].x+A*h.x,k[K+1]=q[a].y+A*h.y,k[K+2]=q[a].z+A*h.z,k[K+3]=q[a].x+(A+l)*h.x,k[K+4]=q[a].y+(A+l)*h.y,k[K+5]=q[a].z+(A+l)*h.z,K+=6,N++;for(;K<k.length;)k[K]=q[a].x,k[K+1]=q[a].y,k[K+2]=q[a].z,K+=3};return(h.dashNb||h.dashSize||h.gapSize||h.useVertexAlpha||h.material)&&G.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),J.updateMeshPositions(k,!1),J}const a=new Y.b(k,o,null,void 0,void 0,void 0,h.useVertexAlpha,h.material);return A(h).Uk(a,h.updatable),a._creationDataStorage=new I.h,a._creationDataStorage.dashSize=K,a._creationDataStorage.gapSize=l,a}q.e.CreateLineSystem=l,q.e.CreateDashedLines=A,I.e.jl=function(k,h){return a(k,{points:h,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},I.e.CreateDashedLines=function(k,h,o,x,I){return N(k,{points:h,dashSize:o,gapSize:x,dashNb:I,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12541:(k,h,o)=>{"use strict";o.d(h,{c:()=>J,d:()=>G});var x=o(11696),I=o(11672),q=o(11292);function Y(k){const h=[],o=[],x=[],Y=[],J=void 0!==k.width?k.width:void 0!==k.size?k.size:1,G=void 0!==k.height?k.height:void 0!==k.size?k.size:1,l=0===k.sideOrientation?0:k.sideOrientation||I.e.DEFAULTSIDE,A=J/2,K=G/2;o.push(-A,-K,0),x.push(0,0,-1),Y.push(0,q.c?1:0),o.push(A,-K,0),x.push(0,0,-1),Y.push(1,q.c?1:0),o.push(A,K,0),x.push(0,0,-1),Y.push(1,q.c?0:1),o.push(-A,K,0),x.push(0,0,-1),Y.push(0,q.c?0:1),h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),I.e._ComputeSides(l,o,h,x,Y,k.frontUVs,k.backUVs);const a=new I.e;return a.indices=h,a.Rk=o,a.sk=x,a.wk=Y,a}function J(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new x.e(k,o);h.sideOrientation=x.e._GetDefaultSideOrientation(h.sideOrientation),I._originalBuilderSideOrientation=h.sideOrientation;return Y(h).Uk(I,h.updatable),h.sourcePlane&&(I.translate(h.sourcePlane.normal,-h.sourcePlane.d),I.setDirection(h.sourcePlane.normal.scale(-1))),I}const G={Vl:J};I.e.Vl=Y,x.e.Vl=(k,h,o,x,I)=>J(k,{size:h,width:h,height:h,sideOrientation:I,updatable:x},o)},12622:(k,h,o)=>{"use strict";o.d(h,{d:()=>G});var x=o(11239),I=o(11696),q=o(11672),Y=o(11292);function J(k){const h=0|(k.segments||32),o=k.diameterX||k.diameter||1,I=k.diameterY||k.diameter||1,J=k.diameterZ||k.diameter||1,G=k.arc&&(k.arc<=0||k.arc>1)?1:k.arc||1,l=k.slice&&k.slice<=0?1:k.slice||1,A=0===k.sideOrientation?0:k.sideOrientation||q.e.DEFAULTSIDE,K=!!k.dedupTopBottomIndices,a=new x.Vh(o/2,I/2,J/2),N=2+h,X=2*N,c=[],W=[],f=[],M=[];for(let q=0;q<=N;q++){const k=q/N,h=k*Math.PI*l;for(let o=0;o<=X;o++){const I=o/X,q=I*Math.PI*2*G,J=x.Matrix.RotationZ(-h),l=x.Matrix.RotationY(q),A=x.Vh.TransformCoordinates(x.Vh.Up(),J),K=x.Vh.TransformCoordinates(A,l),N=K.multiply(a),c=K.divide(a).normalize();W.push(N.x,N.y,N.z),f.push(c.x,c.y,c.z),M.push(I,Y.c?1-k:k)}if(q>0){const k=W.length/3;for(let h=k-2*(X+1);h+X+2<k;h++)K?(q>1&&(c.push(h),c.push(h+1),c.push(h+X+1)),(q<N||l<1)&&(c.push(h+X+1),c.push(h+1),c.push(h+X+2))):(c.push(h),c.push(h+1),c.push(h+X+1),c.push(h+X+1),c.push(h+1),c.push(h+X+2))}}q.e._ComputeSides(A,W,c,f,M,k.frontUVs,k.backUVs);const T=new q.e;return T.indices=c,T.Rk=W,T.sk=f,T.wk=M,T}function G(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new I.e(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return J(h).Uk(x,h.updatable),x}q.e.CreateSphere=J,I.e.CreateSphere=(k,h,o,x,I,q)=>G(k,{segments:h,diameterX:o,diameterY:o,diameterZ:o,sideOrientation:q,updatable:I},x)},13414:(k,h,o)=>{"use strict";o.d(h,{b:()=>J});var x=o(11823),I=o(12912),q=o(11841),Y=o(11672);class J{static get Configuration(){return{get decoder(){return I.e.DefaultConfiguration},set decoder(k){I.e.DefaultConfiguration=k}}}static set Configuration(k){I.e.DefaultConfiguration=k.decoder}static get DecoderAvailable(){return(0,x.h)(I.e.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(k){J._Default&&(k||J._Default.dispose(),J._Default=null)}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultNumWorkers;const h="number"===typeof k?{...I.e.DefaultConfiguration,numWorkers:k}:{...I.e.DefaultConfiguration,...k};this._decoder=new I.e(h)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(k,h,o){return this._decoder.decodeMeshToMeshDataAsync(k,h,o)}async decodeMeshToGeometryAsync(k,h,o,x){return await this._decoder.decodeMeshToGeometryAsync(k,h,o,x)}async _decodeMeshToGeometryForGltfAsync(k,h,o,x,I,q){return await this._decoder._decodeMeshToGeometryForGltfAsync(k,h,o,x,I,q)}async decodeMeshAsync(k,h){const o=await this._decoder.decodeMeshToMeshDataAsync(k,h),x=new Y.e;o.indices&&(x.indices=o.indices);for(const I of o.attributes){const k=q.e.GetFloatData(I.data,I.size,q.e.GetDataType(I.data),I.byteOffset,I.byteStride,I.normalized,o.totalVertices);x.set(k,I.kind)}return x}}J.DefaultNumWorkers=(0,x.g)(),J._Default=null},12912:(k,h,o)=>{"use strict";o.d(h,{e:()=>l});var x=o(11823),I=o(11078),q=o(11703),Y=o(11841),J=o(11098),G=o(11839);class l extends x.e{static get DefaultAvailable(){return(0,x.h)(l.DefaultConfiguration)}static get Default(){return l._Default??(l._Default=new l),l._Default}static ResetDefault(k){l._Default&&(k||l._Default.dispose(),l._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(k,h){return{module:await(h||DracoDecoderModule)({wasmBinary:k})}}_getWorkerContent(){return`${G.e}(${G.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.DefaultConfiguration)}decodeMeshToMeshDataAsync(k,h,o){const x=k instanceof ArrayBuffer?new Int8Array(k):new Int8Array(k.buffer,k.byteOffset,k.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async k=>await new Promise(((I,q)=>{k.push(((k,Y)=>{let G=null;const l=[],A=h=>{k.removeEventListener("error",A),k.removeEventListener("message",K),q(h),Y()},K=h=>{const x=h.data;switch(x.id){case"indices":G=x.data;break;case"attribute":l.push({kind:x.kind,data:x.data,size:x.size,byteOffset:x.byteOffset,byteStride:x.byteStride,normalized:(q=x.kind,a=x.normalized,o&&void 0!==o[q]?(a!==o[q]&&J.c.Warn(`Normalized flag from Draco data (${a}) does not match normalized flag from glTF accessor (${o[q]}). Using flag from glTF accessor.`),o[q]):a)});break;case"decodeMeshDone":k.removeEventListener("error",A),k.removeEventListener("message",K),I({indices:G,attributes:l,totalVertices:x.totalVertices}),Y()}var q,a};k.addEventListener("error",A),k.addEventListener("message",K);const a=x.slice();k.postMessage({id:"decodeMesh",dataView:a,attributes:h},[a.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((k=>{let o=null;const I=[],q=(0,G.e)(k.module,x,h,(k=>{o=k}),((k,h,o,x,q,Y)=>{I.push({kind:k,data:h,size:o,byteOffset:x,byteStride:q,normalized:Y})}));return{indices:o,attributes:I,totalVertices:q}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(k,h,o,x){const I=await this.decodeMeshToMeshDataAsync(o,x),J=new q.b(k,h);I.indices&&J.setIndices(I.indices);for(const q of I.attributes)J.setVerticesBuffer(new Y.e(h.getEngine(),q.data,q.kind,!1,void 0,q.byteStride,void 0,q.byteOffset,q.size,void 0,q.normalized,!0),I.totalVertices);return J}async _decodeMeshToGeometryForGltfAsync(k,h,o,x,I,J){const G=await this.decodeMeshToMeshDataAsync(o,x,I),l=new q.b(k,h);J&&(l._boundingInfo=J,l.useBoundingInfoFromGeometry=!0),G.indices&&l.setIndices(G.indices);for(const q of G.attributes)l.setVerticesBuffer(new Y.e(h.getEngine(),q.data,q.kind,!1,void 0,q.byteStride,void 0,q.byteOffset,q.size,void 0,q.normalized,!0),G.totalVertices);return l}}l.DefaultConfiguration={wasmUrl:`${I.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${I.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${I.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},l._Default=null},13096:(k,h,o)=>{"use strict";o.d(h,{d:()=>Jk});var x=o(11239),I=o(11696),q=o(11308),Y=o(11672),J=o(11292);function G(k){let h=k.pathArray;const o=k.closeArray||!1,x=k.closePath||!1,I=k.invertUV||!1,G=Math.floor(h[0].length/2);let l=k.offset||G;l=l>G?G:Math.floor(l);const A=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE,K=k.wk,a=k.Zk,N=[],X=[],c=[],W=[],f=[],M=[],T=[],j=[];let d;const b=[],V=[];let i,F,R;if(h.length<2){const k=[],o=[];for(F=0;F<h[0].length-l;F++)k.push(h[0][F]),o.push(h[0][F+l]);h=[k,o]}let s=0;const Z=x?1:0,w=o?1:0;let D,U,Q,B,E,n;for(d=h[0].length,i=0;i<h.length+w;i++){for(T[i]=0,f[i]=[0],D=i===h.length?h[0]:h[i],U=D.length,d=d<U?d:U,R=0;R<U;)N.push(D[R].x,D[R].y,D[R].z),R>0&&(Q=D[R].ih(D[R-1]).length(),B=Q+T[i],f[i].push(B),T[i]=B),R++;x&&(R--,N.push(D[0].x,D[0].y,D[0].z),Q=D[R].ih(D[0]).length(),B=Q+T[i],f[i].push(B),T[i]=B),b[i]=U+Z,V[i]=s,s+=U+Z}let H,y,O=null,z=null;for(F=0;F<d+Z;F++)for(j[F]=0,M[F]=[0],i=0;i<h.length-1+w;i++)E=h[i],n=i===h.length-1?h[0]:h[i+1],F===d?(O=E[0],z=n[0]):(O=E[F],z=n[F]),Q=z.ih(O).length(),B=Q+j[F],M[F].push(B),j[F]=B;if(K)for(i=0;i<K.length;i++)W.push(K[i].x,J.c?1-K[i].y:K[i].y);else for(i=0;i<h.length+w;i++)for(F=0;F<d+Z;F++)H=0!=T[i]?f[i][F]/T[i]:0,y=0!=j[F]?M[F][i]/j[F]:0,I?W.push(y,H):W.push(H,J.c?1-y:y);i=0;let p=0,v=b[i]-1,m=b[i+1]-1,L=v<m?v:m,P=V[1]-V[0];const r=b.length-1;for(;p<=L&&i<r;)X.push(p,p+P,p+1),X.push(p+P+1,p+1,p+P),p+=1,p===L&&(i++,P=V[i+1]-V[i],v=b[i]-1,m=b[i+1]-1,p=V[i],L=v<m?v+p:m+p);if(Y.e.ComputeNormals(N,X,c),x){let k=0,o=0;for(i=0;i<h.length;i++){k=3*V[i],o=i+1<h.length?3*(V[i+1]-1):c.length-3,c[k]=.5*(c[k]+c[o]),c[k+1]=.5*(c[k+1]+c[o+1]),c[k+2]=.5*(c[k+2]+c[o+2]);const x=Math.sqrt(c[k]*c[k]+c[k+1]*c[k+1]+c[k+2]*c[k+2]);c[k]/=x,c[k+1]/=x,c[k+2]/=x,c[o]=c[k],c[o+1]=c[k+1],c[o+2]=c[k+2]}}if(o){let k=3*V[0],o=3*V[h.length];for(F=0;F<d+Z;F++){c[k]=.5*(c[k]+c[o]),c[k+1]=.5*(c[k+1]+c[o+1]),c[k+2]=.5*(c[k+2]+c[o+2]);const h=Math.sqrt(c[k]*c[k]+c[k+1]*c[k+1]+c[k+2]*c[k+2]);c[k]/=h,c[k+1]/=h,c[k+2]/=h,c[o]=c[k],c[o+1]=c[k+1],c[o+2]=c[k+2],k+=3,o+=3}}Y.e._ComputeSides(A,N,X,c,W,k.frontUVs,k.backUVs);let t=null;if(a){t=new Float32Array(4*a.length);for(let k=0;k<a.length;k++)t[4*k]=a[k].r,t[4*k+1]=a[k].g,t[4*k+2]=a[k].b,t[4*k+3]=a[k].a}const S=new Y.e,C=new Float32Array(N),g=new Float32Array(c),e=new Float32Array(W);return S.indices=X,S.Rk=C,S.sk=g,S.wk=e,t&&S.set(t,q.g.ColorKind),x&&(S._idx=V),S}function l(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=h.pathArray,A=h.closeArray,K=h.closePath,a=I.e._GetDefaultSideOrientation(h.sideOrientation),N=h.instance,X=h.updatable;if(N){const k=x.TmpVectors.Vh[0].FJ(Number.MAX_VALUE),o=x.TmpVectors.Vh[1].FJ(-Number.MAX_VALUE),G=h=>{let x=l[0].length;const q=N;let Y=0;const J=q._originalBuilderSideOrientation===I.e.DOUBLESIDE?2:1;for(let I=1;I<=J;++I)for(let J=0;J<l.length;++J){const I=l[J],G=I.length;x=x<G?x:G;for(let q=0;q<x;++q){const x=I[q];h[Y]=x.x,h[Y+1]=x.y,h[Y+2]=x.z,k.minimizeInPlaceFromFloats(x.x,x.y,x.z),o.maximizeInPlaceFromFloats(x.x,x.y,x.z),Y+=3}if(q._creationDataStorage&&q._creationDataStorage.closePath){const k=I[0];h[Y]=k.x,h[Y+1]=k.y,h[Y+2]=k.z,Y+=3}}},A=N.getVerticesData(q.g.PositionKind);if(G(A),N.hasBoundingInfo?N.getBoundingInfo().reConstruct(k,o,N._worldMatrix):N.buildBoundingInfo(k,o,N._worldMatrix),N.updateVerticesData(q.g.PositionKind,A,!1,!1),h.Zk){const k=N.getVerticesData(q.g.ColorKind);for(let o=0,x=0;o<h.Zk.length;o++,x+=4){const I=h.Zk[o];k[x]=I.r,k[x+1]=I.g,k[x+2]=I.b,k[x+3]=I.a}N.updateVerticesData(q.g.ColorKind,k,!1,!1)}if(h.wk){const k=N.getVerticesData(q.g.UVKind);for(let o=0;o<h.wk.length;o++)k[2*o]=h.wk[o].x,k[2*o+1]=J.c?1-h.wk[o].y:h.wk[o].y;N.updateVerticesData(q.g.UVKind,k,!1,!1)}if(!N.areNormalsFrozen||N.isFacetDataEnabled){const k=N.dJ(),h=N.getVerticesData(q.g.NormalKind),o=N.isFacetDataEnabled?N.getFacetDataParameters():null;if(Y.e.ComputeNormals(A,k,h,o),N._creationDataStorage&&N._creationDataStorage.closePath){let k=0,o=0;for(let x=0;x<l.length;x++)k=3*N._creationDataStorage.idx[x],o=x+1<l.length?3*(N._creationDataStorage.idx[x+1]-1):h.length-3,h[k]=.5*(h[k]+h[o]),h[k+1]=.5*(h[k+1]+h[o+1]),h[k+2]=.5*(h[k+2]+h[o+2]),h[o]=h[k],h[o+1]=h[k+1],h[o+2]=h[k+2]}N.areNormalsFrozen||N.updateVerticesData(q.g.NormalKind,h,!1,!1)}return N}{const x=new I.e(k,o);x._originalBuilderSideOrientation=a,x._creationDataStorage=new I.h;const q=G(h);return K&&(x._creationDataStorage.idx=q._idx),x._creationDataStorage.closePath=K,x._creationDataStorage.closeArray=A,q.Uk(x,X),x}}Y.e.CreateRibbon=G,I.e.CreateRibbon=function(k,h){return l(k,{pathArray:h,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var A=o(12631),K=o(12486),a=o(11281);function N(k){const h=k.pattern||I.e.NO_FLIP,o=k.tileWidth||k.tileSize||1,x=k.tileHeight||k.tileSize||1,q=k.alignHorizontal||0,J=k.alignVertical||0,G=k.width||k.size||1,l=Math.floor(G/o);let A=G-l*o;const K=k.height||k.size||1,a=Math.floor(K/x);let N=K-a*x;const X=o*l/2,c=x*a/2;let W=0,f=0,M=0,T=0,j=0,d=0;if(A>0||N>0){switch(M=-X,T=-c,j=X,d=c,q){case I.e.CENTER:A/=2,M-=A,j+=A;break;case I.e.LEFT:j+=A,W=-A/2;break;case I.e.RIGHT:M-=A,W=A/2}switch(J){case I.e.CENTER:N/=2,T-=N,d+=N;break;case I.e.BOTTOM:d+=N,f=-N/2;break;case I.e.TOP:T-=N,f=N/2}}const b=[],V=[],i=[];i[0]=[0,0,1,0,1,1,0,1],i[1]=[0,0,1,0,1,1,0,1],h!==I.e.ROTATE_TILE&&h!==I.e.ROTATE_ROW||(i[1]=[1,1,0,1,0,0,1,0]),h!==I.e.FLIP_TILE&&h!==I.e.FLIP_ROW||(i[1]=[1,0,0,0,0,1,1,1]),h!==I.e.FLIP_N_ROTATE_TILE&&h!==I.e.FLIP_N_ROTATE_ROW||(i[1]=[0,1,1,1,1,0,0,0]);let F=[];const R=[],s=[];let Z=0;for(let Y=0;Y<a;Y++)for(let k=0;k<l;k++)b.push(k*o-X+W,Y*x-c+f,0),b.push((k+1)*o-X+W,Y*x-c+f,0),b.push((k+1)*o-X+W,(Y+1)*x-c+f,0),b.push(k*o-X+W,(Y+1)*x-c+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),F=h===I.e.FLIP_TILE||h===I.e.ROTATE_TILE||h===I.e.FLIP_N_ROTATE_TILE?F.concat(i[(k%2+Y%2)%2]):h===I.e.FLIP_ROW||h===I.e.ROTATE_ROW||h===I.e.FLIP_N_ROTATE_ROW?F.concat(i[Y%2]):F.concat(i[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Z+=4;if(A>0||N>0){const k=N>0&&(J===I.e.CENTER||J===I.e.TOP),Y=N>0&&(J===I.e.CENTER||J===I.e.BOTTOM),G=A>0&&(q===I.e.CENTER||q===I.e.RIGHT),K=A>0&&(q===I.e.CENTER||q===I.e.LEFT);let i,w,D,U,Q=[];if(k&&G&&(b.push(M+W,T+f,0),b.push(-X+W,T+f,0),b.push(-X+W,T+N+f,0),b.push(M+W,T+N+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,i=1-A/o,w=1-N/x,D=1,U=1,Q=[i,w,D,w,D,U,i,U],h===I.e.ROTATE_ROW&&(Q=[1-i,1-w,1-D,1-w,1-D,1-U,1-i,1-U]),h===I.e.FLIP_ROW&&(Q=[1-i,w,1-D,w,1-D,U,1-i,U]),h===I.e.FLIP_N_ROTATE_ROW&&(Q=[i,1-w,D,1-w,D,1-U,i,1-U]),F=F.concat(Q),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k&&K&&(b.push(X+W,T+f,0),b.push(j+W,T+f,0),b.push(j+W,T+N+f,0),b.push(X+W,T+N+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,i=0,w=1-N/x,D=A/o,U=1,Q=[i,w,D,w,D,U,i,U],(h===I.e.ROTATE_ROW||h===I.e.ROTATE_TILE&&l%2===0)&&(Q=[1-i,1-w,1-D,1-w,1-D,1-U,1-i,1-U]),(h===I.e.FLIP_ROW||h===I.e.FLIP_TILE&&l%2===0)&&(Q=[1-i,w,1-D,w,1-D,U,1-i,U]),(h===I.e.FLIP_N_ROTATE_ROW||h===I.e.FLIP_N_ROTATE_TILE&&l%2===0)&&(Q=[i,1-w,D,1-w,D,1-U,i,1-U]),F=F.concat(Q),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&G&&(b.push(M+W,c+f,0),b.push(-X+W,c+f,0),b.push(-X+W,d+f,0),b.push(M+W,d+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,i=1-A/o,w=0,D=1,U=N/x,Q=[i,w,D,w,D,U,i,U],(h===I.e.ROTATE_ROW&&a%2===1||h===I.e.ROTATE_TILE&&a%1===0)&&(Q=[1-i,1-w,1-D,1-w,1-D,1-U,1-i,1-U]),(h===I.e.FLIP_ROW&&a%2===1||h===I.e.FLIP_TILE&&a%2===0)&&(Q=[1-i,w,1-D,w,1-D,U,1-i,U]),(h===I.e.FLIP_N_ROTATE_ROW&&a%2===1||h===I.e.FLIP_N_ROTATE_TILE&&a%2===0)&&(Q=[i,1-w,D,1-w,D,1-U,i,1-U]),F=F.concat(Q),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&K&&(b.push(X+W,c+f,0),b.push(j+W,c+f,0),b.push(j+W,d+f,0),b.push(X+W,d+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,i=0,w=0,D=A/o,U=N/x,Q=[i,w,D,w,D,U,i,U],(h===I.e.ROTATE_ROW&&a%2===1||h===I.e.ROTATE_TILE&&(a+l)%2===1)&&(Q=[1-i,1-w,1-D,1-w,1-D,1-U,1-i,1-U]),(h===I.e.FLIP_ROW&&a%2===1||h===I.e.FLIP_TILE&&(a+l)%2===1)&&(Q=[1-i,w,1-D,w,1-D,U,1-i,U]),(h===I.e.FLIP_N_ROTATE_ROW&&a%2===1||h===I.e.FLIP_N_ROTATE_TILE&&(a+l)%2===1)&&(Q=[i,1-w,D,1-w,D,1-U,i,1-U]),F=F.concat(Q),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k){const k=[];i=0,w=1-N/x,D=1,U=1,k[0]=[i,w,D,w,D,U,i,U],k[1]=[i,w,D,w,D,U,i,U],h!==I.e.ROTATE_TILE&&h!==I.e.ROTATE_ROW||(k[1]=[1-i,1-w,1-D,1-w,1-D,1-U,1-i,1-U]),h!==I.e.FLIP_TILE&&h!==I.e.FLIP_ROW||(k[1]=[1-i,w,1-D,w,1-D,U,1-i,U]),h!==I.e.FLIP_N_ROTATE_TILE&&h!==I.e.FLIP_N_ROTATE_ROW||(k[1]=[i,1-w,D,1-w,D,1-U,i,1-U]);for(let x=0;x<l;x++)b.push(x*o-X+W,T+f,0),b.push((x+1)*o-X+W,T+f,0),b.push((x+1)*o-X+W,T+N+f,0),b.push(x*o-X+W,T+N+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,F=h===I.e.FLIP_TILE||h===I.e.ROTATE_TILE||h===I.e.FLIP_N_ROTATE_TILE?F.concat(k[(x+1)%2]):h===I.e.FLIP_ROW||h===I.e.ROTATE_ROW||h===I.e.FLIP_N_ROTATE_ROW?F.concat(k[1]):F.concat(k[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const k=[];i=0,w=0,D=1,U=N/x,k[0]=[i,w,D,w,D,U,i,U],k[1]=[i,w,D,w,D,U,i,U],h!==I.e.ROTATE_TILE&&h!==I.e.ROTATE_ROW||(k[1]=[1-i,1-w,1-D,1-w,1-D,1-U,1-i,1-U]),h!==I.e.FLIP_TILE&&h!==I.e.FLIP_ROW||(k[1]=[1-i,w,1-D,w,1-D,U,1-i,U]),h!==I.e.FLIP_N_ROTATE_TILE&&h!==I.e.FLIP_N_ROTATE_ROW||(k[1]=[i,1-w,D,1-w,D,1-U,i,1-U]);for(let x=0;x<l;x++)b.push(x*o-X+W,d-N+f,0),b.push((x+1)*o-X+W,d-N+f,0),b.push((x+1)*o-X+W,d+f,0),b.push(x*o-X+W,d+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,F=h===I.e.FLIP_TILE||h===I.e.ROTATE_TILE||h===I.e.FLIP_N_ROTATE_TILE?F.concat(k[(x+a)%2]):h===I.e.FLIP_ROW||h===I.e.ROTATE_ROW||h===I.e.FLIP_N_ROTATE_ROW?F.concat(k[a%2]):F.concat(k[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const k=[];i=1-A/o,w=0,D=1,U=1,k[0]=[i,w,D,w,D,U,i,U],k[1]=[i,w,D,w,D,U,i,U],h!==I.e.ROTATE_TILE&&h!==I.e.ROTATE_ROW||(k[1]=[1-i,1-w,1-D,1-w,1-D,1-U,1-i,1-U]),h!==I.e.FLIP_TILE&&h!==I.e.FLIP_ROW||(k[1]=[1-i,w,1-D,w,1-D,U,1-i,U]),h!==I.e.FLIP_N_ROTATE_TILE&&h!==I.e.FLIP_N_ROTATE_ROW||(k[1]=[i,1-w,D,1-w,D,1-U,i,1-U]);for(let o=0;o<a;o++)b.push(M+W,o*x-c+f,0),b.push(M+A+W,o*x-c+f,0),b.push(M+A+W,(o+1)*x-c+f,0),b.push(M+W,(o+1)*x-c+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,F=h===I.e.FLIP_TILE||h===I.e.ROTATE_TILE||h===I.e.FLIP_N_ROTATE_TILE?F.concat(k[(o+1)%2]):h===I.e.FLIP_ROW||h===I.e.ROTATE_ROW||h===I.e.FLIP_N_ROTATE_ROW?F.concat(k[o%2]):F.concat(k[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(K){const k=[];i=0,w=0,D=A/x,U=1,k[0]=[i,w,D,w,D,U,i,U],k[1]=[i,w,D,w,D,U,i,U],h!==I.e.ROTATE_TILE&&h!==I.e.ROTATE_ROW||(k[1]=[1-i,1-w,1-D,1-w,1-D,1-U,1-i,1-U]),h!==I.e.FLIP_TILE&&h!==I.e.FLIP_ROW||(k[1]=[1-i,w,1-D,w,1-D,U,1-i,U]),h!==I.e.FLIP_N_ROTATE_TILE&&h!==I.e.FLIP_N_ROTATE_ROW||(k[1]=[i,1-w,D,1-w,D,1-U,i,1-U]);for(let o=0;o<a;o++)b.push(j-A+W,o*x-c+f,0),b.push(j+W,o*x-c+f,0),b.push(j+W,(o+1)*x-c+f,0),b.push(j-A+W,(o+1)*x-c+f,0),s.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,F=h===I.e.FLIP_TILE||h===I.e.ROTATE_TILE||h===I.e.FLIP_N_ROTATE_TILE?F.concat(k[(o+l)%2]):h===I.e.FLIP_ROW||h===I.e.ROTATE_ROW||h===I.e.FLIP_N_ROTATE_ROW?F.concat(k[o%2]):F.concat(k[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),V.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const w=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE;Y.e._ComputeSides(w,b,s,V,F,k.frontUVs,k.backUVs);const D=new Y.e;D.indices=s,D.Rk=b,D.sk=V,D.wk=F;const U=w===Y.e.DOUBLESIDE?R.concat(R):R;return D.Zk=U,D}function X(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new I.e(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return N(h).Uk(x,h.updatable),x}function c(k){const h=k.faceUV||new Array(6),o=k.faceColors,q=k.pattern||I.e.NO_FLIP,G=k.width||k.size||1,l=k.height||k.size||1,A=k.depth||k.size||1,K=k.tileWidth||k.tileSize||1,X=k.tileHeight||k.tileSize||1,c=k.alignHorizontal||0,W=k.alignVertical||0,f=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE;for(let I=0;I<6;I++)void 0===h[I]&&(h[I]=new x.Vector4(0,0,1,1)),o&&void 0===o[I]&&(o[I]=new a.RJ(1,1,1,1));const M=G/2,T=l/2,j=A/2,d=[];for(let x=0;x<2;x++)d[x]=N({pattern:q,tileWidth:K,tileHeight:X,width:G,height:l,alignVertical:W,alignHorizontal:c,sideOrientation:f});for(let x=2;x<4;x++)d[x]=N({pattern:q,tileWidth:K,tileHeight:X,width:A,height:l,alignVertical:W,alignHorizontal:c,sideOrientation:f});let b=W;W===I.e.BOTTOM?b=I.e.TOP:W===I.e.TOP&&(b=I.e.BOTTOM);for(let x=4;x<6;x++)d[x]=N({pattern:q,tileWidth:K,tileHeight:X,width:G,height:A,alignVertical:b,alignHorizontal:c,sideOrientation:f});let V=[],i=[],F=[],R=[];const s=[],Z=[],w=[],D=[];let U=0,Q=0;for(let I=0;I<6;I++){const k=d[I].Rk.length;Z[I]=[],w[I]=[];for(let h=0;h<k/3;h++)Z[I].push(new x.Vh(d[I].Rk[3*h],d[I].Rk[3*h+1],d[I].Rk[3*h+2])),w[I].push(new x.Vh(d[I].sk[3*h],d[I].sk[3*h+1],d[I].sk[3*h+2]));U=d[I].wk.length,D[I]=[];for(let o=0;o<U;o+=2)D[I][o]=h[I].x+(h[I].z-h[I].x)*d[I].wk[o],D[I][o+1]=h[I].y+(h[I].w-h[I].y)*d[I].wk[o+1],J.c&&(D[I][o+1]=1-D[I][o+1]);if(F=F.concat(D[I]),R=R.concat(d[I].indices.map((k=>k+Q))),Q+=Z[I].length,o)for(let h=0;h<4;h++)s.push(o[I].r,o[I].g,o[I].b,o[I].a)}const B=new x.Vh(0,0,j),E=x.Matrix.RotationY(Math.PI);V=Z[0].map((k=>x.Vh.TransformNormal(k,E).add(B))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[]),i=w[0].map((k=>x.Vh.TransformNormal(k,E))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[]),V=V.concat(Z[1].map((k=>k.ih(B))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[])),i=i.concat(w[1].map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[]));const n=new x.Vh(M,0,0),H=x.Matrix.RotationY(-Math.PI/2);V=V.concat(Z[2].map((k=>x.Vh.TransformNormal(k,H).add(n))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[])),i=i.concat(w[2].map((k=>x.Vh.TransformNormal(k,H))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[]));const y=x.Matrix.RotationY(Math.PI/2);V=V.concat(Z[3].map((k=>x.Vh.TransformNormal(k,y).ih(n))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[])),i=i.concat(w[3].map((k=>x.Vh.TransformNormal(k,y))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[]));const O=new x.Vh(0,T,0),z=x.Matrix.RotationX(Math.PI/2);V=V.concat(Z[4].map((k=>x.Vh.TransformNormal(k,z).add(O))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[])),i=i.concat(w[4].map((k=>x.Vh.TransformNormal(k,z))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[]));const p=x.Matrix.RotationX(-Math.PI/2);V=V.concat(Z[5].map((k=>x.Vh.TransformNormal(k,p).ih(O))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[])),i=i.concat(w[5].map((k=>x.Vh.TransformNormal(k,p))).map((k=>[k.x,k.y,k.z])).reduce(((k,h)=>k.concat(h)),[])),Y.e._ComputeSides(f,V,R,i,F);const v=new Y.e;if(v.indices=R,v.Rk=V,v.sk=i,v.wk=F,o){const k=f===Y.e.DOUBLESIDE?s.concat(s):s;v.Zk=k}return v}function W(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new I.e(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return c(h).Uk(x,h.updatable),x}Y.e.CreateTiledPlane=N;Y.e.CreateTiledBox=c;var f=o(12622),M=o(11472),T=o(11438);function j(k){const h=k.height||2;let o=0===k.diameterTop?0:k.diameterTop||k.diameter||1,q=0===k.diameterBottom?0:k.diameterBottom||k.diameter||1;o=o||1e-5,q=q||1e-5;const G=0|(k.tessellation||24),l=0|(k.subdivisions||1),A=!!k.hasRings,K=!!k.enclose,N=0===k.cap?0:k.cap||I.e.CAP_ALL,X=k.arc&&(k.arc<=0||k.arc>1)?1:k.arc||1,c=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE,W=k.faceUV||new Array(3),f=k.faceColors,M=2+(1+(1!==X&&K?2:0))*(A?l:1);let j;for(j=0;j<M;j++)f&&void 0===f[j]&&(f[j]=new a.RJ(1,1,1,1));for(j=0;j<M;j++)W&&void 0===W[j]&&(W[j]=new x.Vector4(0,0,1,1));const d=[],b=[],V=[],i=[],F=[],R=2*Math.PI*X/G;let s,Z,w;const D=(q-o)/2/h,U=x.Vh.Zero(),Q=x.Vh.Zero(),B=x.Vh.Zero(),E=x.Vh.Zero(),n=x.Vh.Zero(),H=T.e.Y;let y,O,z,p=1,v=1,m=0,L=0;for(y=0;y<=l;y++)for(Z=y/l,w=(Z*(o-q)+q)/2,p=A&&0!==y&&y!==l?2:1,z=0;z<p;z++){for(A&&(v+=z),K&&(v+=2*z),O=0;O<=G;O++)s=O*R,U.x=Math.cos(-s)*w,U.y=-h/2+Z*h,U.z=Math.sin(-s)*w,0===o&&y===l?(Q.x=V[V.length-3*(G+1)],Q.y=V[V.length-3*(G+1)+1],Q.z=V[V.length-3*(G+1)+2]):(Q.x=U.x,Q.z=U.z,Q.y=Math.sqrt(Q.x*Q.x+Q.z*Q.z)*D,Q.normalize()),0===O&&(B.Y(U),E.Y(Q)),b.push(U.x,U.y,U.z),V.push(Q.x,Q.y,Q.z),L=A?m!==v?W[v].y:W[v].w:W[v].y+(W[v].w-W[v].y)*Z,i.push(W[v].x+(W[v].z-W[v].x)*O/G,J.c?1-L:L),f&&F.push(f[v].r,f[v].g,f[v].b,f[v].a);1!==X&&K&&(b.push(U.x,U.y,U.z),b.push(0,U.y,0),b.push(0,U.y,0),b.push(B.x,B.y,B.z),x.Vh.CrossToRef(H,Q,n),n.normalize(),V.push(n.x,n.y,n.z,n.x,n.y,n.z),x.Vh.CrossToRef(E,H,n),n.normalize(),V.push(n.x,n.y,n.z,n.x,n.y,n.z),L=A?m!==v?W[v+1].y:W[v+1].w:W[v+1].y+(W[v+1].w-W[v+1].y)*Z,i.push(W[v+1].x,J.c?1-L:L),i.push(W[v+1].z,J.c?1-L:L),L=A?m!==v?W[v+2].y:W[v+2].w:W[v+2].y+(W[v+2].w-W[v+2].y)*Z,i.push(W[v+2].x,J.c?1-L:L),i.push(W[v+2].z,J.c?1-L:L),f&&(F.push(f[v+1].r,f[v+1].g,f[v+1].b,f[v+1].a),F.push(f[v+1].r,f[v+1].g,f[v+1].b,f[v+1].a),F.push(f[v+2].r,f[v+2].g,f[v+2].b,f[v+2].a),F.push(f[v+2].r,f[v+2].g,f[v+2].b,f[v+2].a))),m!==v&&(m=v)}const P=1!==X&&K?G+4:G;for(y=0,v=0;v<l;v++){let k=0,h=0,o=0,x=0;for(O=0;O<G;O++)k=y*(P+1)+O,h=(y+1)*(P+1)+O,o=y*(P+1)+(O+1),x=(y+1)*(P+1)+(O+1),d.push(k,h,o),d.push(x,o,h);1!==X&&K&&(d.push(k+2,h+2,o+2),d.push(x+2,o+2,h+2),d.push(k+4,h+4,o+4),d.push(x+4,o+4,h+4)),y=A?y+2:y+1}const r=k=>{const I=k?o/2:q/2;if(0===I)return;let Y,l,A;const K=k?W[M-1]:W[0];let a=null;f&&(a=k?f[M-1]:f[0]);const N=b.length/3,c=k?h/2:-h/2,T=new x.Vh(0,c,0);b.push(T.x,T.y,T.z),V.push(0,k?1:-1,0);const j=K.y+.5*(K.w-K.y);i.push(K.x+.5*(K.z-K.x),J.c?1-j:j),a&&F.push(a.r,a.g,a.b,a.a);const R=new x.Vector2(.5,.5);for(A=0;A<=G;A++){Y=2*Math.PI*A*X/G;const h=Math.cos(-Y),o=Math.sin(-Y);l=new x.Vh(h*I,c,o*I);const q=new x.Vector2(h*R.x+.5,o*R.y+.5);b.push(l.x,l.y,l.z),V.push(0,k?1:-1,0);const N=K.y+(K.w-K.y)*q.y;i.push(K.x+(K.z-K.x)*q.x,J.c?1-N:N),a&&F.push(a.r,a.g,a.b,a.a)}for(A=0;A<G;A++)k?(d.push(N),d.push(N+(A+2)),d.push(N+(A+1))):(d.push(N),d.push(N+(A+1)),d.push(N+(A+2)))};N!==I.e.CAP_START&&N!==I.e.CAP_ALL||r(!1),N!==I.e.CAP_END&&N!==I.e.CAP_ALL||r(!0),Y.e._ComputeSides(c,b,d,V,i,k.frontUVs,k.backUVs);const t=new Y.e;return t.indices=d,t.Rk=b,t.sk=V,t.wk=i,f&&(t.Zk=F),t}function d(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const x=new I.e(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return j(h).Uk(x,h.updatable),x}function b(k){const h=[],o=[],I=[],q=[],G=k.diameter||1,l=k.thickness||.5,A=0|(k.tessellation||16),K=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE,a=A+1;for(let Y=0;Y<=A;Y++){const k=Y/A,K=Y*Math.PI*2/A-Math.PI/2,N=x.Matrix.Translation(G/2,0,0).multiply(x.Matrix.RotationY(K));for(let G=0;G<=A;G++){const K=1-G/A,X=G*Math.PI*2/A+Math.PI,c=Math.cos(X),W=Math.sin(X);let f=new x.Vh(c,W,0),M=f.scale(l/2);const T=new x.Vector2(k,K);M=x.Vh.TransformCoordinates(M,N),f=x.Vh.TransformNormal(f,N),o.push(M.x,M.y,M.z),I.push(f.x,f.y,f.z),q.push(T.x,J.c?1-T.y:T.y);const j=(Y+1)%a,d=(G+1)%a;h.push(Y*a+G),h.push(Y*a+d),h.push(j*a+G),h.push(Y*a+d),h.push(j*a+d),h.push(j*a+G)}}Y.e._ComputeSides(K,o,h,I,q,k.frontUVs,k.backUVs);const N=new Y.e;return N.indices=h,N.Rk=o,N.sk=I,N.wk=q,N}function V(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const x=new I.e(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return b(h).Uk(x,h.updatable),x}Y.e.CreateCylinder=j,I.e.CreateCylinder=(k,h,o,x,q,Y,J,G,l)=>{void 0!==J&&J instanceof M.e||(void 0!==J&&(l=G||I.e.DEFAULTSIDE,G=J),J=Y,Y=1);return d(k,{height:h,diameterTop:o,diameterBottom:x,tessellation:q,subdivisions:Y,sideOrientation:l,updatable:G},J)};function i(k){const h=[],o=[],I=[],q=[],G=k.radius||2,l=k.tube||.5,A=k.radialSegments||32,K=k.tubularSegments||32,a=k.p||2,N=k.q||3,X=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE,c=k=>{const h=Math.cos(k),o=Math.sin(k),I=N/a*k,q=Math.cos(I),Y=G*(2+q)*.5*h,J=G*(2+q)*o*.5,l=G*Math.sin(I)*.5;return new x.Vh(Y,J,l)};let W,f;for(W=0;W<=A;W++){const k=W%A/A*2*a*Math.PI,h=c(k),I=c(k+.01),Y=I.ih(h);let G=I.add(h);const N=x.Vh.Cross(Y,G);for(G=x.Vh.Cross(N,Y),N.normalize(),G.normalize(),f=0;f<K;f++){const k=f%K/K*2*Math.PI,x=-l*Math.cos(k),I=l*Math.sin(k);o.push(h.x+x*G.x+I*N.x),o.push(h.y+x*G.y+I*N.y),o.push(h.z+x*G.z+I*N.z),q.push(W/A),q.push(J.c?1-f/K:f/K)}}for(W=0;W<A;W++)for(f=0;f<K;f++){const k=(f+1)%K,o=W*K+f,x=(W+1)*K+f,I=(W+1)*K+k,q=W*K+k;h.push(q),h.push(x),h.push(o),h.push(q),h.push(I),h.push(x)}Y.e.ComputeNormals(o,h,I),Y.e._ComputeSides(X,o,h,I,q,k.frontUVs,k.backUVs);const M=new Y.e;return M.indices=h,M.Rk=o,M.sk=I,M.wk=q,M}function F(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const x=new I.e(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return i(h).Uk(x,h.updatable),x}Y.e.CreateTorus=b,I.e.CreateTorus=(k,h,o,x,I,q,Y)=>V(k,{diameter:h,thickness:o,tessellation:x,sideOrientation:Y,updatable:q},I);Y.e.CreateTorusKnot=i,I.e.CreateTorusKnot=(k,h,o,x,I,q,Y,J,G,l)=>F(k,{radius:h,tube:o,radialSegments:x,tubularSegments:I,p:q,q:Y,sideOrientation:l,updatable:G},J);var R=o(13104),s=o(11814),Z=o(11448);function w(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=h.path,q=h.shape,Y=h.scale||1,J=h.rotation||0,G=0===h.cap?0:h.cap||I.e.NO_CAP,l=h.updatable,A=I.e._GetDefaultSideOrientation(h.sideOrientation),K=h.instance||null,a=h.invertUV||!1,N=h.closeShape||!1,X=h.closePath||!1,c=h.capFunction||null;return U(k,q,x,Y,J,null,null,X,N,G,!1,o,!!l,A,K,a,h.frontUVs||null,h.backUVs||null,h.firstNormal||null,!!h.adjustFrame,c)}function D(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=h.path,q=h.shape,Y=h.scaleFunction||(()=>1),J=h.rotationFunction||(()=>0),G=h.closePath||h.ribbonCloseArray||!1,l=h.closeShape||h.ribbonClosePath||!1,A=0===h.cap?0:h.cap||I.e.NO_CAP,K=h.updatable,a=h.firstNormal||null,N=h.adjustFrame||!1,X=I.e._GetDefaultSideOrientation(h.sideOrientation),c=h.instance,W=h.invertUV||!1,f=h.capFunction||null;return U(k,q,x,null,null,Y,J,G,l,A,!0,o,!!K,X,c||null,W,h.frontUVs||null,h.backUVs||null,a,N,f||null)}function U(k,h,o,q,Y,J,G,A,K,a,N,X,c,W,f,M,T,j,d,b,V){const i=(k,h,o,q,Y,J,G,l,A,K,a)=>{const N=o.getTangents(),X=o.getNormals(),c=o.getBinormals(),W=o.getDistances();if(a)for(let I=0;I<N.length;I++)if(0==N[I].x&&0==N[I].y&&0==N[I].z&&N[I].Y(N[I-1]),0==X[I].x&&0==X[I].y&&0==X[I].z&&X[I].Y(X[I-1]),0==c[I].x&&0==c[I].y&&0==c[I].z&&c[I].Y(c[I-1]),I>0){let k=N[I-1];x.Vh.Dot(k,N[I])<0&&N[I].scaleInPlace(-1),k=X[I-1],x.Vh.Dot(k,X[I])<0&&X[I].scaleInPlace(-1),k=c[I-1],x.Vh.Dot(k,c[I])<0&&c[I].scaleInPlace(-1)}let f=0;const M=K&&l?l:()=>null!==J?J:0,T=K&&G?G:()=>null!==Y?Y:1;let j=A===I.e.NO_CAP||A===I.e.CAP_END?0:2;const d=x.TmpVectors.Matrix[0];for(let I=0;I<h.length;I++){const o=[],Y=M(I,W[I]),J=T(I,W[I]);x.Matrix.RotationAxisToRef(N[I],f,d);for(let q=0;q<k.length;q++){const Y=N[I].scale(k[q].z).add(X[I].scale(k[q].x)).add(c[I].scale(k[q].y)),G=x.Vh.Zero();x.Vh.TransformCoordinatesToRef(Y,d,G),G.scaleInPlace(J).addInPlace(h[I]),o[q]=G}q[j]=o,f+=Y,j++}const b=V||(k=>{const h=Array(),o=x.Vh.Zero();let I;for(I=0;I<k.length;I++)o.addInPlace(k[I]);for(o.scaleInPlace(1/k.length),I=0;I<k.length;I++)h.push(o);return h});switch(A){case I.e.NO_CAP:break;case I.e.CAP_START:q[0]=b(q[2]),q[1]=q[2];break;case I.e.CAP_END:q[j]=q[j-1],q[j+1]=b(q[j-1]);break;case I.e.CAP_ALL:q[0]=b(q[2]),q[1]=q[2],q[j]=q[j-1],q[j+1]=b(q[j-1])}return q};let F,R;if(f){const k=f._creationDataStorage;return F=d?k.path3D.update(o,d):k.path3D.update(o),R=i(h,o,k.path3D,k.pathArray,q,Y,J,G,k.cap,N,b),f=l("",{pathArray:R,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:f},X||void 0)}F=d?new Z.o(o,d):new Z.o(o);R=i(h,o,F,new Array,q,Y,J,G,a=a<0||a>3?0:a,N,b);const s=l(k,{pathArray:R,closeArray:A,closePath:K,updatable:c,sideOrientation:W,invertUV:M,frontUVs:T||void 0,backUVs:j||void 0},X);return s._creationDataStorage.pathArray=R,s._creationDataStorage.path3D=F,s._creationDataStorage.cap=a,s}function Q(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=h.arc?h.arc<=0||h.arc>1?1:h.arc:1,Y=void 0===h.closed||h.closed,J=h.shape,G=h.radius||1,A=h.tessellation||64,K=h.clip||0,a=h.updatable,N=I.e._GetDefaultSideOrientation(h.sideOrientation),X=h.cap||I.e.NO_CAP,c=2*Math.PI,W=[],f=h.invertUV||!1;let M=0,T=0;const j=c/A*q;let d,b;for(M=0;M<=A-K;M++){for(b=[],X!=I.e.CAP_START&&X!=I.e.CAP_ALL||(b.push(new x.Vh(0,J[0].y,0)),b.push(new x.Vh(Math.cos(M*j)*J[0].x*G,J[0].y,Math.sin(M*j)*J[0].x*G))),T=0;T<J.length;T++)d=new x.Vh(Math.cos(M*j)*J[T].x*G,J[T].y,Math.sin(M*j)*J[T].x*G),b.push(d);X!=I.e.CAP_END&&X!=I.e.CAP_ALL||(b.push(new x.Vh(Math.cos(M*j)*J[J.length-1].x*G,J[J.length-1].y,Math.sin(M*j)*J[J.length-1].x*G)),b.push(new x.Vh(0,J[J.length-1].y,0))),W.push(b)}return l(k,{pathArray:W,closeArray:Y,sideOrientation:N,updatable:a,invertUV:f,frontUVs:h.frontUVs,backUVs:h.backUVs},o)}I.e.ExtrudeShape=function(k,h,o,x,q,Y){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,A=arguments.length>9?arguments[9]:void 0;return w(k,{shape:h,path:o,scale:x,rotation:q,cap:0===Y?0:Y||I.e.NO_CAP,sideOrientation:l,instance:A,updatable:G},J)},I.e.ExtrudeShapeCustom=(k,h,o,x,q,Y,J,G,l,A,K,a)=>D(k,{shape:h,path:o,scaleFunction:x,rotationFunction:q,ribbonCloseArray:Y,ribbonClosePath:J,cap:0===G?0:G||I.e.NO_CAP,sideOrientation:K,instance:a,updatable:A},l);I.e.CreateLathe=(k,h,o,x,I,q,Y)=>Q(k,{shape:h,radius:o,tessellation:x,sideOrientation:Y,updatable:q},I);var B=o(12541),E=o(12493);function n(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=h.path;let Y=h.instance,J=1;void 0!==h.radius?J=h.radius:Y&&(J=Y._creationDataStorage.radius);const G=h.tessellation||64,A=h.radiusFunction||null;let K=h.cap||I.e.NO_CAP;const a=h.invertUV||!1,N=h.updatable,X=I.e._GetDefaultSideOrientation(h.sideOrientation);h.arc=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1;const c=(k,h,o,q,Y,J,G,l)=>{const A=h.getTangents(),K=h.getNormals(),a=h.getDistances(),N=2*Math.PI/Y*l,X=J||(()=>q);let c,W,f,M;const T=x.TmpVectors.Matrix[0];let j=G===I.e.NO_CAP||G===I.e.CAP_END?0:2;for(let I=0;I<k.length;I++){W=X(I,a[I]),c=Array(),f=K[I];for(let h=0;h<Y;h++)x.Matrix.RotationAxisToRef(A[I],N*h,T),M=c[h]?c[h]:x.Vh.Zero(),x.Vh.TransformCoordinatesToRef(f,T,M),M.scaleInPlace(W).addInPlace(k[I]),c[h]=M;o[j]=c,j++}const d=(h,o)=>{const x=Array();for(let I=0;I<h;I++)x.push(k[o]);return x};switch(G){case I.e.NO_CAP:break;case I.e.CAP_START:o[0]=d(Y,0),o[1]=o[2].slice(0);break;case I.e.CAP_END:o[j]=o[j-1].slice(0),o[j+1]=d(Y,k.length-1);break;case I.e.CAP_ALL:o[0]=d(Y,0),o[1]=o[2].slice(0),o[j]=o[j-1].slice(0),o[j+1]=d(Y,k.length-1)}return o};let W,f;if(Y){const k=Y._creationDataStorage,o=h.arc||k.arc;return W=k.path3D.update(q),f=c(q,W,k.pathArray,J,k.tessellation,A,k.cap,o),Y=l("",{pathArray:f,instance:Y}),k.path3D=W,k.pathArray=f,k.arc=o,k.radius=J,Y}W=new Z.o(q);K=K<0||K>3?0:K,f=c(q,W,new Array,J,G,A,K,h.arc);const M=l(k,{pathArray:f,closePath:!0,closeArray:!1,updatable:N,sideOrientation:X,invertUV:a,frontUVs:h.frontUVs,backUVs:h.backUVs},o);return M._creationDataStorage.pathArray=f,M._creationDataStorage.path3D=W,M._creationDataStorage.tessellation=G,M._creationDataStorage.cap=K,M._creationDataStorage.arc=h.arc,M._creationDataStorage.radius=J,M}function H(k){const h=[];h[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},h[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},h[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},h[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},h[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},h[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},h[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},h[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},h[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},h[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},h[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},h[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},h[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},h[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},h[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const o=k.type&&(k.type<0||k.type>=h.length)?0:k.type||0,I=k.size,q=k.sizeX||I||1,G=k.sizeY||I||1,l=k.sizeZ||I||1,A=k.custom||h[o],K=A.face.length,N=k.faceUV||new Array(K),X=k.faceColors,c=void 0===k.flat||k.flat,W=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE,f=[],M=[],T=[],j=[],d=[];let b=0,V=0;const i=[];let F,R,s,Z,w,D,U=0,Q=0;if(c)for(Q=0;Q<K;Q++)X&&void 0===X[Q]&&(X[Q]=new a.RJ(1,1,1,1)),N&&void 0===N[Q]&&(N[Q]=new x.Vector4(0,0,1,1));if(c)for(Q=0;Q<K;Q++){const k=A.face[Q].length;for(s=2*Math.PI/k,Z=.5*Math.tan(s/2),w=.5,U=0;U<k;U++)f.push(A.vertex[A.face[Q][U]][0]*q,A.vertex[A.face[Q][U]][1]*G,A.vertex[A.face[Q][U]][2]*l),i.push(b),b++,F=N[Q].x+(N[Q].z-N[Q].x)*(.5+Z),R=N[Q].y+(N[Q].w-N[Q].y)*(w-.5),j.push(F,J.c?1-R:R),D=Z*Math.cos(s)-w*Math.sin(s),w=Z*Math.sin(s)+w*Math.cos(s),Z=D,X&&d.push(X[Q].r,X[Q].g,X[Q].b,X[Q].a);for(U=0;U<k-2;U++)M.push(i[0+V],i[U+2+V],i[U+1+V]);V+=k}else{for(U=0;U<A.vertex.length;U++)f.push(A.vertex[U][0]*q,A.vertex[U][1]*G,A.vertex[U][2]*l),j.push(0,J.c?1:0);for(Q=0;Q<K;Q++)for(U=0;U<A.face[Q].length-2;U++)M.push(A.face[Q][0],A.face[Q][U+2],A.face[Q][U+1])}Y.e.ComputeNormals(f,M,T),Y.e._ComputeSides(W,f,M,T,j,k.frontUVs,k.backUVs);const B=new Y.e;return B.Rk=f,B.indices=M,B.sk=T,B.wk=j,X&&c&&(B.Zk=d),B}function y(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new I.e(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return H(h).Uk(x,h.updatable),x}I.e.CreateTube=(k,h,o,x,I,q,Y,J,G,l)=>n(k,{path:h,radius:o,tessellation:x,radiusFunction:I,arc:1,cap:q,updatable:J,sideOrientation:G,instance:l},Y);function O(k){const h=k.sideOrientation||Y.e.DEFAULTSIDE,o=k.radius||1,I=void 0===k.flat||k.flat,q=0|(k.subdivisions||4),G=k.radiusX||o,l=k.radiusY||o,A=k.radiusZ||o,K=(1+Math.sqrt(5))/2,a=[-1,K,-0,1,K,0,-1,-K,0,1,-K,0,0,-1,-K,0,1,-K,0,-1,K,0,1,K,K,0,1,K,0,-1,-K,0,1,-K,0,-1],N=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],X=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],c=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],W=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],f=[],M=[],T=[],j=[];let d=0;const b=new Array(3),V=new Array(3);let i;for(i=0;i<3;i++)b[i]=x.Vh.Zero(),V[i]=x.Vector2.Zero();for(let Y=0;Y<20;Y++){for(i=0;i<3;i++){const k=N[3*Y+i];b[i].VJ(a[3*X[k]],a[3*X[k]+1],a[3*X[k]+2]),b[i].normalize(),V[i].VJ(.134765625*c[2*k]+.05859375+-.0390625*W[Y],.2333984375*c[2*k+1]+.025390625+.01953125*W[Y])}const k=(k,h,o,Y)=>{const K=x.Vh.Lerp(b[0],b[2],h/q),a=x.Vh.Lerp(b[1],b[2],h/q),N=q===h?b[2]:x.Vh.Lerp(K,a,k/(q-h));let X;if(N.normalize(),I){const k=x.Vh.Lerp(b[0],b[2],Y/q),h=x.Vh.Lerp(b[1],b[2],Y/q);X=x.Vh.Lerp(k,h,o/(q-Y))}else X=new x.Vh(N.x,N.y,N.z);X.x/=G,X.y/=l,X.z/=A,X.normalize();const c=x.Vector2.Lerp(V[0],V[2],h/q),W=x.Vector2.Lerp(V[1],V[2],h/q),i=q===h?V[2]:x.Vector2.Lerp(c,W,k/(q-h));M.push(N.x*G,N.y*l,N.z*A),T.push(X.x,X.y,X.z),j.push(i.x,J.c?1-i.y:i.y),f.push(d),d++};for(let h=0;h<q;h++)for(let o=0;o+h<q;o++)k(o,h,o+1/3,h+1/3),k(o+1,h,o+1/3,h+1/3),k(o,h+1,o+1/3,h+1/3),o+h+1<q&&(k(o+1,h,o+2/3,h+2/3),k(o+1,h+1,o+2/3,h+2/3),k(o,h+1,o+2/3,h+2/3))}Y.e._ComputeSides(h,M,f,T,j,k.frontUVs,k.backUVs);const F=new Y.e;return F.indices=f,F.Rk=M,F.sk=T,F.wk=j,F}function z(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new I.e(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),x._originalBuilderSideOrientation=h.sideOrientation;return O(h).Uk(x,h.updatable),x}Y.e.CreatePolyhedron=H,I.e.CreatePolyhedron=(k,h,o)=>y(k,h,o);Y.e.CreateIcoSphere=O,I.e.CreateIcoSphere=(k,h,o)=>z(k,h,o);var p=o(11260);const v=new x.Vh(1,0,0),m=new x.Vh(-1,0,0),L=new x.Vh(0,1,0),P=new x.Vh(0,-1,0),r=new x.Vh(0,0,1),t=new x.Vh(0,0,-1);class S{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.Vh.Zero(),h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.Vh.Up(),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.Vector2.Zero(),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=k,this.normal=h,this.uv=o,this.vertexIdx=I,this.vertexIdxForBones=q,this.localPositionOverride=Y,this.localNormalOverride=J,this.matrixIndicesOverride=G,this.matrixWeightsOverride=l}clone(){var k,h,o,x;return new S(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(k=this.localPositionOverride)||void 0===k?void 0:k.slice(),null===(h=this.localNormalOverride)||void 0===h?void 0:h.slice(),null===(o=this.matrixIndicesOverride)||void 0===o?void 0:o.slice(),null===(x=this.matrixWeightsOverride)||void 0===x?void 0:x.slice())}}function C(k,h,o){var G,l,A,K,a;const N=!!h.skeleton,X=!(null===(G=h.morphTargetManager)||void 0===G||!G.numTargets),c=o.localMode||N,W=h.dJ(),f=N||X?h.OJ(!0,!0):h.getVerticesData(q.g.PositionKind),M=N||X?h.getNormalsData(!0,!0):h.getVerticesData(q.g.NormalKind),T=c?N?h.getVerticesData(q.g.PositionKind):f:null,j=c?N?h.getVerticesData(q.g.NormalKind):M:null,d=h.getVerticesData(q.g.UVKind),b=N?h.getVerticesData(q.g.MatricesIndicesKind):null,V=N?h.getVerticesData(q.g.MatricesWeightsKind):null,i=N?h.getVerticesData(q.g.MatricesIndicesExtraKind):null,F=N?h.getVerticesData(q.g.MatricesWeightsExtraKind):null,R=o.position||x.Vh.Zero();let s=o.normal||x.Vh.Up();const Z=o.size||x.Vh.One(),w=o.angle||0;if(!s){const k=new x.Vh(0,0,1),o=h.ik().activeCamera,I=x.Vh.TransformCoordinates(k,o.getWorldMatrix());s=o.globalPosition.ih(I)}const D=-Math.atan2(s.z,s.x)-Math.PI/2,U=Math.sqrt(s.x*s.x+s.z*s.z),Q=Math.atan2(s.y,U),B=new Y.e;B.indices=[],B.Rk=[],B.sk=[],B.wk=[],B.matricesIndices=N?[]:null,B.matricesWeights=N?[]:null,B.matricesIndicesExtra=i?[]:null,B.matricesWeightsExtra=F?[]:null;let E=0;const n=(k,h)=>{const I=new S;if(!W||!f||!M)return I;const q=W[k];if(I.vertexIdx=3*q,I.vertexIdxForBones=4*q,I.position=new x.Vh(f[3*q],f[3*q+1],f[3*q+2]),x.Vh.TransformCoordinatesToRef(I.position,h,I.position),I.normal=new x.Vh(M[3*q],M[3*q+1],M[3*q+2]),x.Vh.TransformNormalToRef(I.normal,h,I.normal),o.captureUVS&&d){const k=d[2*q+1];I.uv=new x.Vector2(d[2*q],J.c?1-k:k)}return I},H=[0,0,0,0],y=(k,h)=>{if(0===k.length)return k;const o=.5*Math.abs(x.Vh.Dot(Z,h)),I=(k,h,o,x)=>{for(let I=0;I<x;++I)if(k[o+I]===h)return o+I;return-1},q=(k,q)=>{const Y=x.Vh.GetClipFactor(k.position,q.position,h,o);let J=H,G=H;if(b&&V){const h=k.matrixIndicesOverride?0:k.vertexIdxForBones,o=k.matrixIndicesOverride??b,x=k.matrixWeightsOverride??V,l=q.matrixIndicesOverride?0:q.vertexIdxForBones,A=q.matrixIndicesOverride??b,K=q.matrixWeightsOverride??V;J=[0,0,0,0],G=[0,0,0,0];let a=0;for(let k=0;k<4;++k)if(x[h+k]>0){const q=I(A,o[h+k],l,4);J[a]=o[h+k],G[a]=(0,p.Lerp)(x[h+k],q>=0?K[q]:0,Y),a++}for(let k=0;k<4&&a<4;++k){const x=A[l+k];-1===I(o,x,h,4)&&(J[a]=x,G[a]=(0,p.Lerp)(0,K[l+k],Y),a++)}const N=G[0]+G[1]+G[2]+G[3];G[0]/=N,G[1]/=N,G[2]/=N,G[3]/=N}const l=k.localPositionOverride?k.localPositionOverride[0]:(null===T||void 0===T?void 0:T[k.vertexIdx])??0,A=k.localPositionOverride?k.localPositionOverride[1]:(null===T||void 0===T?void 0:T[k.vertexIdx+1])??0,K=k.localPositionOverride?k.localPositionOverride[2]:(null===T||void 0===T?void 0:T[k.vertexIdx+2])??0,a=q.localPositionOverride?q.localPositionOverride[0]:(null===T||void 0===T?void 0:T[q.vertexIdx])??0,N=q.localPositionOverride?q.localPositionOverride[1]:(null===T||void 0===T?void 0:T[q.vertexIdx+1])??0,X=q.localPositionOverride?q.localPositionOverride[2]:(null===T||void 0===T?void 0:T[q.vertexIdx+2])??0,c=k.localNormalOverride?k.localNormalOverride[0]:(null===j||void 0===j?void 0:j[k.vertexIdx])??0,W=k.localNormalOverride?k.localNormalOverride[1]:(null===j||void 0===j?void 0:j[k.vertexIdx+1])??0,f=k.localNormalOverride?k.localNormalOverride[2]:(null===j||void 0===j?void 0:j[k.vertexIdx+2])??0,M=c+((q.localNormalOverride?q.localNormalOverride[0]:(null===j||void 0===j?void 0:j[q.vertexIdx])??0)-c)*Y,d=W+((q.localNormalOverride?q.localNormalOverride[1]:(null===j||void 0===j?void 0:j[q.vertexIdx+1])??0)-W)*Y,i=f+((q.localNormalOverride?q.localNormalOverride[2]:(null===j||void 0===j?void 0:j[q.vertexIdx+2])??0)-f)*Y,F=Math.sqrt(M*M+d*d+i*i);return new S(x.Vh.Lerp(k.position,q.position,Y),x.Vh.Lerp(k.normal,q.normal,Y).normalize(),x.Vector2.Lerp(k.uv,q.uv,Y),-1,-1,T?[l+(a-l)*Y,A+(N-A)*Y,K+(X-K)*Y]:null,j?[M/F,d/F,i/F]:null,J,G)};let Y=null;k.length>3&&(Y=[]);for(let J=0;J<k.length;J+=3){let I=0,G=null,l=null,A=null,K=null;const a=x.Vh.Dot(k[J].position,h)-o>0,N=x.Vh.Dot(k[J+1].position,h)-o>0,X=x.Vh.Dot(k[J+2].position,h)-o>0;switch(I=(a?1:0)+(N?1:0)+(X?1:0),I){case 0:k.length>3?(Y.push(k[J]),Y.push(k[J+1]),Y.push(k[J+2])):Y=k;break;case 1:if(Y=Y??new Array,a&&(G=k[J+1],l=k[J+2],A=q(k[J],G),K=q(k[J],l)),N){G=k[J],l=k[J+2],A=q(k[J+1],G),K=q(k[J+1],l),Y.push(A),Y.push(l.clone()),Y.push(G.clone()),Y.push(l.clone()),Y.push(A.clone()),Y.push(K);break}X&&(G=k[J],l=k[J+1],A=q(k[J+2],G),K=q(k[J+2],l)),G&&l&&A&&K&&(Y.push(G.clone()),Y.push(l.clone()),Y.push(A),Y.push(K),Y.push(A.clone()),Y.push(l.clone()));break;case 2:Y=Y??new Array,a||(G=k[J].clone(),l=q(G,k[J+1]),A=q(G,k[J+2]),Y.push(G),Y.push(l),Y.push(A)),N||(G=k[J+1].clone(),l=q(G,k[J+2]),A=q(G,k[J]),Y.push(G),Y.push(l),Y.push(A)),X||(G=k[J+2].clone(),l=q(G,k[J]),A=q(G,k[J+1]),Y.push(G),Y.push(l),Y.push(A))}}return Y},O=h instanceof I.e?h:null,z=null===O||void 0===O?void 0:O._thinInstanceDataStorage.matrixData,C=(null===O||void 0===O?void 0:O.ZJ)||1,g=x.TmpVectors.Matrix[0];g.Y(x.Matrix.IdentityReadOnly);for(let I=0;I<C;++I){if(null!==O&&void 0!==O&&O.hasThinInstances&&z){const k=16*I;g.setRowFromFloats(0,z[k+0],z[k+1],z[k+2],z[k+3]),g.setRowFromFloats(1,z[k+4],z[k+5],z[k+6],z[k+7]),g.setRowFromFloats(2,z[k+8],z[k+9],z[k+10],z[k+11]),g.setRowFromFloats(3,z[k+12],z[k+13],z[k+14],z[k+15])}const k=x.Matrix.RotationYawPitchRoll(D,Q,w).multiply(x.Matrix.Translation(R.x,R.y,R.z)),q=x.Matrix.Invert(k),Y=h.getWorldMatrix(),G=g.multiply(Y).multiply(q),l=new Array(3);for(let h=0;h<W.length;h+=3){let k=l;if(k[0]=n(h,G),k[1]=n(h+1,G),k[2]=n(h+2,G),!(o.cullBackFaces&&-k[0].normal.z<=0&&-k[1].normal.z<=0&&-k[2].normal.z<=0)&&(k=y(k,v),k&&(k=y(k,m),k&&(k=y(k,L),k&&(k=y(k,P),k&&(k=y(k,r),k&&(k=y(k,t),k)))))))for(let h=0;h<k.length;h++){const x=k[h];if(B.indices.push(E),c?(x.localPositionOverride?(B.Rk[3*E]=x.localPositionOverride[0],B.Rk[3*E+1]=x.localPositionOverride[1],B.Rk[3*E+2]=x.localPositionOverride[2]):T&&(B.Rk[3*E]=T[x.vertexIdx],B.Rk[3*E+1]=T[x.vertexIdx+1],B.Rk[3*E+2]=T[x.vertexIdx+2]),x.localNormalOverride?(B.sk[3*E]=x.localNormalOverride[0],B.sk[3*E+1]=x.localNormalOverride[1],B.sk[3*E+2]=x.localNormalOverride[2]):j&&(B.sk[3*E]=j[x.vertexIdx],B.sk[3*E+1]=j[x.vertexIdx+1],B.sk[3*E+2]=j[x.vertexIdx+2])):(x.position.toArray(B.Rk,3*E),x.normal.toArray(B.sk,3*E)),B.matricesIndices&&B.matricesWeights&&(x.matrixIndicesOverride?(B.matricesIndices[4*E]=x.matrixIndicesOverride[0],B.matricesIndices[4*E+1]=x.matrixIndicesOverride[1],B.matricesIndices[4*E+2]=x.matrixIndicesOverride[2],B.matricesIndices[4*E+3]=x.matrixIndicesOverride[3]):(b&&(B.matricesIndices[4*E]=b[x.vertexIdxForBones],B.matricesIndices[4*E+1]=b[x.vertexIdxForBones+1],B.matricesIndices[4*E+2]=b[x.vertexIdxForBones+2],B.matricesIndices[4*E+3]=b[x.vertexIdxForBones+3]),i&&B.matricesIndicesExtra&&(B.matricesIndicesExtra[4*E]=i[x.vertexIdxForBones],B.matricesIndicesExtra[4*E+1]=i[x.vertexIdxForBones+1],B.matricesIndicesExtra[4*E+2]=i[x.vertexIdxForBones+2],B.matricesIndicesExtra[4*E+3]=i[x.vertexIdxForBones+3])),x.matrixWeightsOverride?(B.matricesWeights[4*E]=x.matrixWeightsOverride[0],B.matricesWeights[4*E+1]=x.matrixWeightsOverride[1],B.matricesWeights[4*E+2]=x.matrixWeightsOverride[2],B.matricesWeights[4*E+3]=x.matrixWeightsOverride[3]):(V&&(B.matricesWeights[4*E]=V[x.vertexIdxForBones],B.matricesWeights[4*E+1]=V[x.vertexIdxForBones+1],B.matricesWeights[4*E+2]=V[x.vertexIdxForBones+2],B.matricesWeights[4*E+3]=V[x.vertexIdxForBones+3]),F&&B.matricesWeightsExtra&&(B.matricesWeightsExtra[4*E]=F[x.vertexIdxForBones],B.matricesWeightsExtra[4*E+1]=F[x.vertexIdxForBones+1],B.matricesWeightsExtra[4*E+2]=F[x.vertexIdxForBones+2],B.matricesWeightsExtra[4*E+3]=F[x.vertexIdxForBones+3]))),o.captureUVS)x.uv.toArray(B.wk,2*E);else{B.wk.push(.5+x.position.x/Z.x);const k=.5+x.position.y/Z.y;B.wk.push(J.c?1-k:k)}E++}}}0===B.indices.length&&(B.indices=null),0===B.Rk.length&&(B.Rk=null),0===B.sk.length&&(B.sk=null),0===B.wk.length&&(B.wk=null),0===(null===(l=B.matricesIndices)||void 0===l?void 0:l.length)&&(B.matricesIndices=null),0===(null===(A=B.matricesWeights)||void 0===A?void 0:A.length)&&(B.matricesWeights=null),0===(null===(K=B.matricesIndicesExtra)||void 0===K?void 0:K.length)&&(B.matricesIndicesExtra=null),0===(null===(a=B.matricesWeightsExtra)||void 0===a?void 0:a.length)&&(B.matricesWeightsExtra=null);const e=new I.e(k,h.ik());return B.Uk(e),c?(e.skeleton=h.skeleton,e.parent=h):(e.position=R.clone(),e.rotation=new x.Vh(Q,D,w)),e.eq(!0),e.refreshBoundingInfo(!0,!0),e}function g(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const h=0|Math.max(k.subdivisions?k.subdivisions:2,1),o=0|Math.max(k.tessellation?k.tessellation:16,3),I=Math.max(k.height?k.height:1,0),q=Math.max(k.radius?k.radius:.25,0),G=0|Math.max(k.capSubdivisions?k.capSubdivisions:6,1),l=o,A=h,K=Math.max(k.radiusTop?k.radiusTop:q,0),a=Math.max(k.radiusBottom?k.radiusBottom:q,0),N=I-(K+a),X=2*Math.PI,c=Math.max(k.topCapSubdivisions?k.topCapSubdivisions:G,1),W=Math.max(k.bottomCapSubdivisions?k.bottomCapSubdivisions:G,1),f=Math.acos((a-K)/I);let M=[];const T=[],j=[],d=[];let b=0;const V=[],i=.5*N,F=.5*Math.PI;let R,s;const Z=x.Vh.Zero(),w=x.Vh.Zero(),D=Math.cos(f),U=Math.sin(f),Q=new x.Vector2(K*U,i+K*D).ih(new x.Vector2(a*U,a*D-i)).length(),B=K*f+Q+a*(F-f);let E=0;for(s=0;s<=c;s++){const k=[],h=F-f*(s/c);E+=K*f/c;const o=Math.cos(h),x=Math.sin(h),I=o*K;for(R=0;R<=l;R++){const h=R/l,q=h*X+0,Y=Math.sin(q),G=Math.cos(q);w.x=I*Y,w.y=i+x*K,w.z=I*G,T.push(w.x,w.y,w.z),Z.set(o*Y,x,o*G),j.push(Z.x,Z.y,Z.z),d.push(h,J.c?E/B:1-E/B),k.push(b),b++}V.push(k)}const n=I-K-a+D*K-D*a,H=U*(a-K)/n;for(s=1;s<=A;s++){const k=[];E+=Q/A;const h=U*(s*(a-K)/A+K);for(R=0;R<=l;R++){const o=R/l,x=o*X+0,I=Math.sin(x),q=Math.cos(x);w.x=h*I,w.y=i+D*K-s*n/A,w.z=h*q,T.push(w.x,w.y,w.z),Z.set(I,H,q).normalize(),j.push(Z.x,Z.y,Z.z),d.push(o,J.c?E/B:1-E/B),k.push(b),b++}V.push(k)}for(s=1;s<=W;s++){const k=[],h=F-f-(Math.PI-f)*(s/W);E+=a*f/W;const o=Math.cos(h),x=Math.sin(h),I=o*a;for(R=0;R<=l;R++){const h=R/l,q=h*X+0,Y=Math.sin(q),G=Math.cos(q);w.x=I*Y,w.y=x*a-i,w.z=I*G,T.push(w.x,w.y,w.z),Z.set(o*Y,x,o*G),j.push(Z.x,Z.y,Z.z),d.push(h,J.c?E/B:1-E/B),k.push(b),b++}V.push(k)}for(R=0;R<l;R++)for(s=0;s<c+A+W;s++){const k=V[s][R],h=V[s+1][R],o=V[s+1][R+1],x=V[s][R+1];M.push(k),M.push(h),M.push(x),M.push(h),M.push(o),M.push(x)}if(M=M.reverse(),k.orientation&&!k.orientation.equals(x.Vh.Up())){const h=new x.Matrix;k.orientation.clone().scale(.5*Math.PI).cross(x.Vh.Up()).toQuaternion().toRotationMatrix(h);const o=x.Vh.Zero();for(let k=0;k<T.length;k+=3)o.set(T[k],T[k+1],T[k+2]),x.Vh.TransformCoordinatesToRef(o.clone(),h,o),T[k]=o.x,T[k+1]=o.y,T[k+2]=o.z}const y=new Y.e;return y.Rk=T,y.sk=j,y.wk=d,y.indices=M,y}function e(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:x.Vh.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new I.e(k,o);return g(h).Uk(q,h.updatable),q}I.e.CreateDecal=(k,h,o,x,I,q)=>C(k,h,{position:o,normal:x,size:I,angle:q});I.e.CreateCapsule=(k,h,o)=>e(k,h,o),Y.e.CreateCapsule=g;var u=o(11098),kk=o(11248);class hk{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=k,this.y=h,k!==Math.floor(k)&&(k=Math.floor(k),u.c.Warn("x is not an integer, floor(x) used")),h!==Math.floor(h)&&(h=Math.floor(h),u.c.Warn("y is not an integer, floor(y) used"))}clone(){return new hk(this.x,this.y)}rotate60About(k){const h=this.x;return this.x=k.x+k.y-this.y,this.y=h+this.y-k.x,this}rotateNeg60About(k){const h=this.x;return this.x=h+this.y-k.y,this.y=k.x+k.y-h,this}rotate120(k,h){k!==Math.floor(k)&&(k=Math.floor(k),u.c.Warn("m not an integer only floor(m) used")),h!==Math.floor(h)&&(h=Math.floor(h),u.c.Warn("n not an integer only floor(n) used"));const o=this.x;return this.x=k-o-this.y,this.y=h+o,this}rotateNeg120(k,h){k!==Math.floor(k)&&(k=Math.floor(k),u.c.Warn("m is not an integer, floor(m) used")),h!==Math.floor(h)&&(h=Math.floor(h),u.c.Warn("n is not an integer,   floor(n) used"));const o=this.x;return this.x=this.y-h,this.y=k+h-o-this.y,this}toCartesianOrigin(k,h){const o=x.Vh.Zero();return o.x=k.x+2*this.x*h+this.y*h,o.y=k.y+Math.sqrt(3)*this.y*h,o}static Zero(){return new hk(0,0)}}class ok{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new xk("icosahedron","Regular",[[0,kk.f,-1],[-kk.f,1,0],[-1,0,-kk.f],[1,0,-kk.f],[kk.f,1,0],[0,kk.f,1],[-1,0,kk.f],[-kk.f,-1,0],[0,-kk.f,-1],[kk.f,-1,0],[1,0,kk.f],[0,-kk.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let k=12;const h={},o=this.m,x=this.n;let I,q,Y,J,G,l=o,A=1,K=0;0!==x&&(l=(0,p.HighestCommonFactor)(o,x)),A=o/l,K=x/l;const a=hk.Zero(),N=new hk(o,x),X=new hk(-x,o+x),c=hk.Zero(),W=hk.Zero(),f=hk.Zero();let M,T,j,d,b=[];const V=[],i=this.vertByDist,F=(o,x,I,q)=>{M=o+"|"+I,T=x+"|"+q,M in h||T in h?M in h&&!(T in h)?h[T]=h[M]:T in h&&!(M in h)&&(h[M]=h[T]):(h[M]=k,h[T]=k,k++),i[I][0]>2?V[h[M]]=[-i[I][0],i[I][1],h[M]]:V[h[M]]=[b[i[I][0]],i[I][1],h[M]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let R=0;R<20;R++){if(b=this.IDATA.face[R],Y=b[2],J=b[1],G=b[0],j=a.x+"|"+a.y,M=R+"|"+j,M in h||(h[M]=Y,V[Y]=[b[i[j][0]],i[j][1]]),j=N.x+"|"+N.y,M=R+"|"+j,M in h||(h[M]=J,V[J]=[b[i[j][0]],i[j][1]]),j=X.x+"|"+X.y,M=R+"|"+j,M in h||(h[M]=G,V[G]=[b[i[j][0]],i[j][1]]),I=this.IDATA.edgematch[R][0],q=this.IDATA.edgematch[R][1],"B"===q)for(let k=1;k<l;k++)W.x=o-k*(A+K),W.y=x+k*A,f.x=-k*K,f.y=k*(A+K),j=W.x+"|"+W.y,d=f.x+"|"+f.y,F(R,I,j,d);if("O"===q)for(let k=1;k<l;k++)f.x=-k*K,f.y=k*(A+K),c.x=k*A,c.y=k*K,j=f.x+"|"+f.y,d=c.x+"|"+c.y,F(R,I,j,d);if(I=this.IDATA.edgematch[R][2],q=this.IDATA.edgematch[R][3],q&&"A"===q)for(let k=1;k<l;k++)c.x=k*A,c.y=k*K,W.x=o-(l-k)*(A+K),W.y=x+(l-k)*A,j=c.x+"|"+c.y,d=W.x+"|"+W.y,F(R,I,j,d);for(let o=0;o<this.vertices.length;o++)j=this.vertices[o].x+"|"+this.vertices[o].y,M=R+"|"+j,M in h||(h[M]=k++,i[j][0]>2?V[h[M]]=[-i[j][0],i[j][1],h[M]]:V[h[M]]=[b[i[j][0]],i[j][1],h[M]])}this.closestTo=V,this.vecToidx=h}calcCoeffs(){const k=this.m,h=this.n,o=Math.sqrt(3)/3,x=k*k+h*h+k*h;this.coau=(k+h)/x,this.cobu=-h/x,this.coav=-o*(k-h)/x,this.cobv=o*(2*k+h)/x}createInnerFacets(){const k=this.m,h=this.n;for(let o=0;o<h+k+1;o++)for(let k=this.min[o];k<this.max[o]+1;k++)k<this.max[o]&&k<this.max[o+1]+1&&this.innerFacets.push(["|"+k+"|"+o,"|"+k+"|"+(o+1),"|"+(k+1)+"|"+o]),o>0&&k<this.max[o-1]&&k+1<this.max[o]+1&&this.innerFacets.push(["|"+k+"|"+o,"|"+(k+1)+"|"+o,"|"+(k+1)+"|"+(o-1)])}edgeVecsABOB(){const k=this.m,h=this.n,o=new hk(-h,k+h);for(let x=1;x<k+h;x++){const k=new hk(this.min[x],x),h=new hk(this.min[x-1],x-1),I=new hk(this.min[x+1],x+1),q=k.clone(),Y=h.clone(),J=I.clone();q.rotate60About(o),Y.rotate60About(o),J.rotate60About(o);const G=new hk(this.max[q.y],q.y),l=new hk(this.max[q.y-1],q.y-1),A=new hk(this.max[q.y-1]-1,q.y-1);q.x===G.x&&q.y===G.y||(q.x!==l.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([k,l,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([k,A,G])):q.y===J.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([k,h,l]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([k,l,I])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([k,h,l]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([k,l,G])))}}mapABOBtoOBOA(){const k=new hk(0,0);for(let h=0;h<this.isoVecsABOB.length;h++){const o=[];for(let x=0;x<3;x++)k.x=this.isoVecsABOB[h][x].x,k.y=this.isoVecsABOB[h][x].y,0===this.vertexTypes[h][x]&&k.rotateNeg120(this.m,this.n),o.push(k.clone());this.isoVecsOBOA.push(o)}}mapABOBtoBAOA(){const k=new hk(0,0);for(let h=0;h<this.isoVecsABOB.length;h++){const o=[];for(let x=0;x<3;x++)k.x=this.isoVecsABOB[h][x].x,k.y=this.isoVecsABOB[h][x].y,1===this.vertexTypes[h][x]&&k.rotate120(this.m,this.n),o.push(k.clone());this.isoVecsBAOA.push(o)}}MapToFace(k,h){const o=this.IDATA.face[k],I=o[2],q=o[1],Y=o[0],J=x.Vh.Uh(this.IDATA.vertex[I]),G=x.Vh.Uh(this.IDATA.vertex[q]),l=x.Vh.Uh(this.IDATA.vertex[Y]),A=G.ih(J),K=l.ih(J),a=A.scale(this.coau).add(K.scale(this.cobu)),N=A.scale(this.coav).add(K.scale(this.cobv)),X=[];let c,W=x.TmpVectors.Vh[0];for(let x=0;x<this.cartesian.length;x++)W=a.scale(this.cartesian[x].x).add(N.scale(this.cartesian[x].y)).add(J),X[x]=[W.x,W.y,W.z],c=k+"|"+this.vertices[x].x+"|"+this.vertices[x].y,h.vertex[this.vecToidx[c]]=[W.x,W.y,W.z]}build(k,h){const o=[],x=hk.Zero(),I=new hk(k,h),q=new hk(-h,k+h);o.push(x,I,q);for(let j=h;j<k+1;j++)for(let h=0;h<k+1-j;h++)o.push(new hk(h,j));if(h>0){const x=(0,p.HighestCommonFactor)(k,h),I=k/x,q=h/x;for(let J=1;J<x;J++)o.push(new hk(J*I,J*q)),o.push(new hk(-J*q,J*(I+q))),o.push(new hk(k-J*(I+q),h+J*I));const Y=k/h;for(let J=1;J<h;J++)for(let x=0;x<J*Y;x++)o.push(new hk(x,J)),o.push(new hk(x,J).rotate120(k,h)),o.push(new hk(x,J).rotateNeg120(k,h))}o.sort(((k,h)=>k.x-h.x)),o.sort(((k,h)=>k.y-h.y));const Y=new Array(k+h+1),J=new Array(k+h+1);for(let j=0;j<Y.length;j++)Y[j]=1/0,J[j]=-1/0;let G=0,l=0;const A=o.length;for(let j=0;j<A;j++)l=o[j].x,G=o[j].y,Y[G]=Math.min(l,Y[G]),J[G]=Math.max(l,J[G]);const K=(o,x)=>{const I=o.clone();return"A"===x&&I.rotateNeg120(k,h),"B"===x&&I.rotate120(k,h),I.x<0?I.y:I.x+I.y},a=[],N=[],X=[],c=[],W={},f=[];let M=-1,T=-1;for(let j=0;j<A;j++)a[j]=o[j].toCartesianOrigin(new hk(0,0),.5),N[j]=K(o[j],"O"),X[j]=K(o[j],"A"),c[j]=K(o[j],"B"),N[j]===X[j]&&X[j]===c[j]?(M=3,T=N[j]):N[j]===X[j]?(M=4,T=N[j]):X[j]===c[j]?(M=5,T=X[j]):c[j]===N[j]&&(M=6,T=N[j]),N[j]<X[j]&&N[j]<c[j]&&(M=2,T=N[j]),X[j]<N[j]&&X[j]<c[j]&&(M=1,T=X[j]),c[j]<X[j]&&c[j]<N[j]&&(M=0,T=c[j]),f.push([M,T,o[j].x,o[j].y]);f.sort(((k,h)=>k[2]-h[2])),f.sort(((k,h)=>k[3]-h[3])),f.sort(((k,h)=>k[1]-h[1])),f.sort(((k,h)=>k[0]-h[0]));for(let j=0;j<f.length;j++)W[f[j][2]+"|"+f[j][3]]=[f[j][0],f[j][1],j];return this.m=k,this.n=h,this.vertices=o,this.vertByDist=W,this.cartesian=a,this.min=Y,this.max=J,this}}class xk{constructor(k,h,o,x){this.name=k,this.category=h,this.vertex=o,this.face=x}}class Ik extends xk{innerToData(k,h){for(let o=0;o<h.innerFacets.length;o++)this.face.push(h.innerFacets[o].map((o=>h.vecToidx[k+o])))}mapABOBtoDATA(k,h){const o=h.IDATA.edgematch[k][0];for(let x=0;x<h.isoVecsABOB.length;x++){const I=[];for(let q=0;q<3;q++)0===h.vertexTypes[x][q]?I.push(k+"|"+h.isoVecsABOB[x][q].x+"|"+h.isoVecsABOB[x][q].y):I.push(o+"|"+h.isoVecsABOB[x][q].x+"|"+h.isoVecsABOB[x][q].y);this.face.push([h.vecToidx[I[0]],h.vecToidx[I[1]],h.vecToidx[I[2]]])}}mapOBOAtoDATA(k,h){const o=h.IDATA.edgematch[k][0];for(let x=0;x<h.isoVecsOBOA.length;x++){const I=[];for(let q=0;q<3;q++)1===h.vertexTypes[x][q]?I.push(k+"|"+h.isoVecsOBOA[x][q].x+"|"+h.isoVecsOBOA[x][q].y):I.push(o+"|"+h.isoVecsOBOA[x][q].x+"|"+h.isoVecsOBOA[x][q].y);this.face.push([h.vecToidx[I[0]],h.vecToidx[I[1]],h.vecToidx[I[2]]])}}mapBAOAtoDATA(k,h){const o=h.IDATA.edgematch[k][2];for(let x=0;x<h.isoVecsBAOA.length;x++){const I=[];for(let q=0;q<3;q++)1===h.vertexTypes[x][q]?I.push(k+"|"+h.isoVecsBAOA[x][q].x+"|"+h.isoVecsBAOA[x][q].y):I.push(o+"|"+h.isoVecsBAOA[x][q].x+"|"+h.isoVecsBAOA[x][q].y);this.face.push([h.vecToidx[I[0]],h.vecToidx[I[1]],h.vecToidx[I[2]]])}}orderData(k){const h=[];for(let q=0;q<13;q++)h[q]=[];const o=k.closestTo;for(let q=0;q<o.length;q++)o[q][0]>-1?o[q][1]>0&&h[o[q][0]].push([q,o[q][1]]):h[12].push([q,o[q][0]]);const x=[];for(let q=0;q<12;q++)x[q]=q;let I=12;for(let q=0;q<12;q++){h[q].sort(((k,h)=>k[1]-h[1]));for(let k=0;k<h[q].length;k++)x[h[q][k][0]]=I++}for(let q=0;q<h[12].length;q++)x[h[12][q][0]]=I++;for(let q=0;q<this.vertex.length;q++)this.vertex[q].push(x[q]);this.vertex.sort(((k,h)=>k[3]-h[3]));for(let q=0;q<this.vertex.length;q++)this.vertex[q].pop();for(let q=0;q<this.face.length;q++)for(let k=0;k<this.face[q].length;k++)this.face[q][k]=x[this.face[q][k]];this.sharedNodes=h[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(k,h){const o=[],x=[];let I=h.pop();x.push(I);let q=this.face[I].indexOf(k);q=(q+2)%3;let Y=this.face[I][q];o.push(Y);let J=0;for(;h.length>0;)I=h[J],this.face[I].indexOf(Y)>-1?(q=(this.face[I].indexOf(Y)+1)%3,Y=this.face[I][q],o.push(Y),x.push(I),h.splice(J,1),J=0):J++;return this.adjacentFaces.push(o),x}toGoldbergPolyhedronData(){const k=new xk("GeoDual","Goldberg",[],[]);k.name="GD dual";const h=this.vertex.length,o=new Array(h);for(let G=0;G<h;G++)o[G]=[];for(let G=0;G<this.face.length;G++)for(let k=0;k<3;k++)o[this.face[G][k]].push(G);let x=0,I=0,q=0,Y=[],J=[];this.adjacentFaces=[];for(let G=0;G<o.length;G++){k.face[G]=this.setOrder(G,o[G].concat([]));for(const h of o[G]){x=0,I=0,q=0,Y=this.face[h];for(let k=0;k<3;k++)J=this.vertex[Y[k]],x+=J[0],I+=J[1],q+=J[2];k.vertex[h]=[x/3,I/3,q/3]}}return k}static BuildGeodesicData(k){const h=new Ik("Geodesic-m-n","Geodesic",[[0,kk.f,-1],[-kk.f,1,0],[-1,0,-kk.f],[1,0,-kk.f],[kk.f,1,0],[0,kk.f,1],[-1,0,kk.f],[-kk.f,-1,0],[0,-kk.f,-1],[kk.f,-1,0],[1,0,kk.f],[0,-kk.f,1]],[]);k.setIndices(),k.calcCoeffs(),k.createInnerFacets(),k.edgeVecsABOB(),k.mapABOBtoOBOA(),k.mapABOBtoBAOA();for(let o=0;o<k.IDATA.face.length;o++)k.MapToFace(o,h),h.innerToData(o,k),"B"===k.IDATA.edgematch[o][1]&&h.mapABOBtoDATA(o,k),"O"===k.IDATA.edgematch[o][1]&&h.mapOBOAtoDATA(o,k),"A"===k.IDATA.edgematch[o][3]&&h.mapBAOAtoDATA(o,k);h.orderData(k);return h.vertex=h.vertex.map((function(k){const h=k[0],o=k[1],x=k[2],I=Math.sqrt(h*h+o*o+x*x);return k[0]*=1/I,k[1]*=1/I,k[2]*=1/I,k})),h}}I.e._GoldbergMeshParser=(k,h)=>qk.Parse(k,h);class qk extends I.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(k,h){return void 0===h?(k>this.goldbergData.nbUnsharedFaces-1&&(u.c.Warn("Maximum number of unshared faces used"),k=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+k):(k>11&&(u.c.Warn("Last pole used"),k=11),h>this.goldbergData.nbFacesAtPole-1&&(u.c.Warn("Maximum number of faces at a pole used"),h=this.goldbergData.nbFacesAtPole-1),12+k*this.goldbergData.nbFacesAtPole+h)}_changeGoldbergFaceColors(k){for(let o=0;o<k.length;o++){const h=k[o][0],x=k[o][1],I=k[o][2];for(let k=h;k<x+1;k++)this.goldbergData.faceColors[k]=I}const h=[];for(let o=0;o<12;o++)for(let k=0;k<5;k++)h.push(this.goldbergData.faceColors[o].r,this.goldbergData.faceColors[o].g,this.goldbergData.faceColors[o].b,this.goldbergData.faceColors[o].a);for(let o=12;o<this.goldbergData.faceColors.length;o++)for(let k=0;k<6;k++)h.push(this.goldbergData.faceColors[o].r,this.goldbergData.faceColors[o].g,this.goldbergData.faceColors[o].b,this.goldbergData.faceColors[o].a);return h}setGoldbergFaceColors(k){const h=this._changeGoldbergFaceColors(k);this.nk(q.g.ColorKind,h)}updateGoldbergFaceColors(k){const h=this._changeGoldbergFaceColors(k);this.updateVerticesData(q.g.ColorKind,h)}_changeGoldbergFaceUVs(k){const h=this.getVerticesData(q.g.UVKind);for(let o=0;o<k.length;o++){const x=k[o][0],I=k[o][1],q=k[o][2],Y=k[o][3],J=k[o][4],G=[],l=[];let A,K;for(let k=0;k<5;k++)A=q.x+Y*Math.cos(J+k*Math.PI/2.5),K=q.y+Y*Math.sin(J+k*Math.PI/2.5),A<0&&(A=0),A>1&&(A=1),G.push(A,K);for(let k=0;k<6;k++)A=q.x+Y*Math.cos(J+k*Math.PI/3),K=q.y+Y*Math.sin(J+k*Math.PI/3),A<0&&(A=0),A>1&&(A=1),l.push(A,K);for(let k=x;k<Math.min(12,I+1);k++)for(let o=0;o<5;o++)h[10*k+2*o]=G[2*o],h[10*k+2*o+1]=G[2*o+1];for(let k=Math.max(12,x);k<I+1;k++)for(let o=0;o<6;o++)h[12*k-24+2*o]=l[2*o],h[12*k-23+2*o]=l[2*o+1]}return h}setGoldbergFaceUVs(k){const h=this._changeGoldbergFaceUVs(k);this.nk(q.g.UVKind,h)}updateGoldbergFaceUVs(k){const h=this._changeGoldbergFaceUVs(k);this.updateVerticesData(q.g.UVKind,h)}placeOnGoldbergFaceAt(k,h,o){const I=x.Vh.RotationFromAxis(this.goldbergData.faceXaxis[h],this.goldbergData.faceYaxis[h],this.goldbergData.faceZaxis[h]);k.rotation=I,k.position=this.goldbergData.faceCenters[h].add(this.goldbergData.faceXaxis[h].scale(o.x)).add(this.goldbergData.faceYaxis[h].scale(o.y)).add(this.goldbergData.faceZaxis[h].scale(o.z))}serialize(k){super.serialize(k),k.type="GoldbergMesh";const h={};if(h.adjacentFaces=this.goldbergData.adjacentFaces,h.nbSharedFaces=this.goldbergData.nbSharedFaces,h.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,h.nbFaces=this.goldbergData.nbFaces,h.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){h.faceColors=[];for(const k of this.goldbergData.faceColors)h.faceColors.push(k.rh())}if(this.goldbergData.faceCenters){h.faceCenters=[];for(const k of this.goldbergData.faceCenters)h.faceCenters.push(k.rh())}if(this.goldbergData.faceZaxis){h.faceZaxis=[];for(const k of this.goldbergData.faceZaxis)h.faceZaxis.push(k.rh())}if(this.goldbergData.faceYaxis){h.faceYaxis=[];for(const k of this.goldbergData.faceYaxis)h.faceYaxis.push(k.rh())}if(this.goldbergData.faceXaxis){h.faceXaxis=[];for(const k of this.goldbergData.faceXaxis)h.faceXaxis.push(k.rh())}k.goldbergData=h}static Parse(k,h){const o=k.goldbergData;o.faceColors=o.faceColors.map((k=>a.RJ.Uh(k))),o.faceCenters=o.faceCenters.map((k=>x.Vh.Uh(k))),o.faceZaxis=o.faceZaxis.map((k=>x.Vh.Uh(k))),o.faceXaxis=o.faceXaxis.map((k=>x.Vh.Uh(k))),o.faceYaxis=o.faceYaxis.map((k=>x.Vh.Uh(k)));const I=new qk(k.name,h);return I.goldbergData=o,I}}var Yk=o(11812);const Jk={CreateBox:K.e,CreateTiledBox:W,CreateSphere:f.d,CreateDisc:A.e,CreateIcoSphere:z,CreateRibbon:l,CreateCylinder:d,CreateTorus:V,CreateTorusKnot:F,CreateLineSystem:R.h,jl:R.j,CreateDashedLines:R.d,ExtrudeShape:w,ExtrudeShapeCustom:D,CreateLathe:Q,CreateTiledPlane:X,Vl:B.c,CreateGround:E.h,CreateTiledGround:E.j,CreateGroundFromHeightMap:E.e,CreatePolygon:s.e,ExtrudePolygon:s.g,CreateTube:n,CreatePolyhedron:y,CreateGeodesic:function(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=h.m||1;x!==Math.floor(x)&&(x=Math.floor(x),u.c.Warn("m not an integer only floor(m) used"));let I=h.n||0;if(I!==Math.floor(I)&&(I=Math.floor(I),u.c.Warn("n not an integer only floor(n) used")),I>x){const k=I;I=x,x=k,u.c.Warn("n > m therefore m and n swapped")}const q=new ok;return q.build(x,I),y(k,{custom:Ik.BuildGeodesicData(q),size:h.size,sizeX:h.sizeX,sizeY:h.sizeY,sizeZ:h.sizeZ,faceUV:h.faceUV,faceColors:h.faceColors,flat:h.flat,updatable:h.updatable,sideOrientation:h.sideOrientation,frontUVs:h.frontUVs,backUVs:h.backUVs},o)},CreateGoldberg:function(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=h.size,G=h.sizeX||q||1,l=h.sizeY||q||1,A=h.sizeZ||q||1;let K=h.m||1;K!==Math.floor(K)&&(K=Math.floor(K),u.c.Warn("m not an integer only floor(m) used"));let N=h.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),u.c.Warn("n not an integer only floor(n) used")),N>K){const k=N;N=K,K=k,u.c.Warn("n > m therefore m and n swapped")}const X=new ok;X.build(K,N);const c=Ik.BuildGeodesicData(X),W=c.toGoldbergPolyhedronData(),f=new qk(k,o);h.sideOrientation=I.e._GetDefaultSideOrientation(h.sideOrientation),f._originalBuilderSideOrientation=h.sideOrientation;(function(k,h){const o=k.size,I=k.sizeX||o||1,q=k.sizeY||o||1,G=k.sizeZ||o||1,l=0===k.sideOrientation?0:k.sideOrientation||Y.e.DEFAULTSIDE,A=[],K=[],a=[],N=[];let X=1/0,c=-1/0,W=1/0,f=-1/0;for(let x=0;x<h.vertex.length;x++)X=Math.min(X,h.vertex[x][0]*I),c=Math.max(c,h.vertex[x][0]*I),W=Math.min(W,h.vertex[x][1]*q),f=Math.max(f,h.vertex[x][1]*q);let M=0;for(let Y=0;Y<h.face.length;Y++){const k=h.face[Y],o=x.Vh.Uh(h.vertex[k[0]]),l=x.Vh.Uh(h.vertex[k[2]]),T=x.Vh.Uh(h.vertex[k[1]]),j=l.ih(o),d=T.ih(o),b=x.Vh.Cross(d,j).normalize();for(let x=0;x<k.length;x++){a.push(b.x,b.y,b.z);const o=h.vertex[k[x]];A.push(o[0]*I,o[1]*q,o[2]*G);const Y=(o[1]*q-W)/(f-W);N.push((o[0]*I-X)/(c-X),J.c?1-Y:Y)}for(let h=0;h<k.length-2;h++)K.push(M,M+h+2,M+h+1);M+=k.length}Y.e._ComputeSides(l,A,K,a,N);const T=new Y.e;return T.Rk=A,T.indices=K,T.sk=a,T.wk=N,T})(h,W).Uk(f,h.updatable),f.goldbergData.nbSharedFaces=c.sharedNodes,f.goldbergData.nbUnsharedFaces=c.poleNodes,f.goldbergData.adjacentFaces=c.adjacentFaces,f.goldbergData.nbFaces=f.goldbergData.nbSharedFaces+f.goldbergData.nbUnsharedFaces,f.goldbergData.nbFacesAtPole=(f.goldbergData.nbUnsharedFaces-12)/12;for(let I=0;I<c.vertex.length;I++)f.goldbergData.faceCenters.push(x.Vh.Uh(c.vertex[I])),f.goldbergData.faceCenters[I].x*=G,f.goldbergData.faceCenters[I].y*=l,f.goldbergData.faceCenters[I].z*=A,f.goldbergData.faceColors.push(new a.RJ(1,1,1,1));for(let I=0;I<W.face.length;I++){const k=W.face[I],h=x.Vh.Uh(W.vertex[k[0]]),o=x.Vh.Uh(W.vertex[k[2]]),q=x.Vh.Uh(W.vertex[k[1]]),Y=o.ih(h),J=q.ih(h),G=x.Vh.Cross(J,Y).normalize(),l=x.Vh.Cross(J,G).normalize();f.goldbergData.faceXaxis.push(J.normalize()),f.goldbergData.faceYaxis.push(G),f.goldbergData.faceZaxis.push(l)}return f},CreateDecal:C,CreateCapsule:e,CreateText:Yk.g}},12558:(k,h,o)=>{"use strict";o.d(h,{d:()=>Jh});var x=o(11239),I=o(11617);class q extends I.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Y=o(11281),J=(o(11404),o(11199));class G{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(k){this._targetStopDuration!==k&&(this._targetStopDuration=k)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(k){this._noiseTexture!==k&&(this._noiseTexture=k,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(k){this._animationSheetEnabled!==k&&(this._animationSheetEnabled=k)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(k){this._isAnimationSheetEnabled!=k&&(this._isAnimationSheetEnabled=k,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(k){this._useLogarithmicDepth=k&&this.ik().getEngine().getCaps().fragmentDepthSupported}ik(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(k){switch(k){case G.BLENDMODE_MULTIPLYADD:return;case G.BLENDMODE_ADD:k=1;break;case G.BLENDMODE_ONEONE:k=6;break;case G.BLENDMODE_STANDARD:k=2;break;case G.BLENDMODE_MULTIPLY:k=4;break;case G.BLENDMODE_SUBTRACT:k=3}this._engine.setAlphaMode(k)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:x.Vh.Zero()}set direction1(k){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=k)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:x.Vh.Zero()}set direction2(k){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=k)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:x.Vh.Zero()}set minEmitBox(k){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=k)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:x.Vh.Zero()}set maxEmitBox(k){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=k)}get billboardMode(){return this._billboardMode}set billboardMode(k){this._billboardMode!==k&&(this._billboardMode=k,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(k){this._isBillboardBased!==k&&(this._isBillboardBased=k,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(k){this._attachImageProcessingConfiguration(k)}_attachImageProcessingConfiguration(k){k!==this._imageProcessingConfiguration&&(!k&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=k)}_reset(){}_removeGradientAndTexture(k,h,o){if(!h)return this;let x=0;for(const I of h){if(I.gradient===k){h.splice(x,1);break}x++}return o&&o.dispose(),this}constructor(k){this.animations=[],this.renderingGroupId=0,this.Ih=x.Vh.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new x.Vh(10,10,10),this.onAnimationEnd=null,this.blendMode=G.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new x.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.fl=new x.Vh(0,0,0),this._useLogarithmicDepth=!1,this.gravity=x.Vh.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Y.RJ(1,1,1,1),this.color2=new Y.RJ(1,1,1,1),this.colorDead=new Y.RJ(0,0,0,1),this.textureMask=new Y.RJ(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new q,this.id=k,this.name=k}createPointEmitter(k,h){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new x.Vh(0,1,0),arguments.length>2&&void 0!==arguments[2]||new x.Vh(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new x.Vh(0,1,0),arguments.length>4&&void 0!==arguments[4]||new x.Vh(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new x.Vh(0,1,0),arguments.length>3&&void 0!==arguments[3]||new x.Vh(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(k,h,o,x){throw new Error("Method not implemented.")}}G.BLENDMODE_ONEONE=0,G.BLENDMODE_STANDARD=1,G.BLENDMODE_ADD=2,G.BLENDMODE_MULTIPLY=3,G.BLENDMODE_MULTIPLYADD=4,G.BLENDMODE_SUBTRACT=-1,(0,J.g)("BABYLON.BaseParticleSystem",G);var l=o(11260),A=o(11103);class K{constructor(){this.direction1=new x.Vh(0,1,0),this.direction2=new x.Vh(0,1,0),this.minEmitBox=new x.Vh(-.5,-.5,-.5),this.maxEmitBox=new x.Vh(.5,.5,.5)}startDirectionFunction(k,h,o,I){const q=(0,l.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),J=(0,l.RandomRange)(this.direction1.z,this.direction2.z);if(I)return h.x=q,h.y=Y,void(h.z=J);x.Vh.TransformNormalFromFloatsToRef(q,Y,J,k,h)}startPositionFunction(k,h,o,I){const q=(0,l.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Y=(0,l.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),J=(0,l.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(I)return h.x=q,h.y=Y,void(h.z=J);x.Vh.TransformCoordinatesFromFloatsToRef(q,Y,J,k,h)}clone(){const k=new K;return A.d.DeepCopy(this,k),k}applyToShader(k){k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2),k.setVector3("minEmitBox",this.minEmitBox),k.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(k){k.addUniform("direction1",3),k.addUniform("direction2",3),k.addUniform("minEmitBox",3),k.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.direction1=this.direction1.rh(),k.direction2=this.direction2.rh(),k.minEmitBox=this.minEmitBox.rh(),k.maxEmitBox=this.maxEmitBox.rh(),k}parse(k){x.Vh.FromArrayToRef(k.direction1,0,this.direction1),x.Vh.FromArrayToRef(k.direction2,0,this.direction2),x.Vh.FromArrayToRef(k.minEmitBox,0,this.minEmitBox),x.Vh.FromArrayToRef(k.maxEmitBox,0,this.maxEmitBox)}}class a{get radius(){return this._radius}set radius(k){this._radius=k,this._buildHeight()}get angle(){return this._angle}set angle(k){this._angle=k,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=o,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=h,this.radius=k}startDirectionFunction(k,h,o,I){I?x.TmpVectors.Vh[0].Y(o.CJ).normalize():o.position.subtractToRef(k.getTranslation(),x.TmpVectors.Vh[0]).normalize();const q=(0,l.RandomRange)(0,this.directionRandomizer),Y=(0,l.RandomRange)(0,this.directionRandomizer),J=(0,l.RandomRange)(0,this.directionRandomizer);h.x=x.TmpVectors.Vh[0].x+q,h.y=x.TmpVectors.Vh[0].y+Y,h.z=x.TmpVectors.Vh[0].z+J,h.normalize()}startPositionFunction(k,h,o,I){const q=(0,l.RandomRange)(0,2*Math.PI);let Y;this.emitFromSpawnPointOnly?Y=1e-4:(Y=(0,l.RandomRange)(0,this.heightRange),Y=1-Y*Y);let J=this._radius-(0,l.RandomRange)(0,this._radius*this.radiusRange);J*=Y;const G=J*Math.sin(q),A=J*Math.cos(q),K=Y*this._height;if(I)return h.x=G,h.y=K,void(h.z=A);x.Vh.TransformCoordinatesFromFloatsToRef(G,K,A,k,h)}clone(){const k=new a(this._radius,this._angle,this.directionRandomizer);return A.d.DeepCopy(this,k),k}applyToShader(k){k.setFloat2("radius",this._radius,this.radiusRange),k.setFloat("coneAngle",this._angle),k.setFloat2("height",this._height,this.heightRange),k.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(k){k.addUniform("radius",2),k.addUniform("coneAngle",1),k.addUniform("height",2),k.addUniform("directionRandomizer",1)}getEffectDefines(){let k="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(k+="\n#define CONEEMITTERSPAWNPOINT"),k}getClassName(){return"ConeParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.radius=this._radius,k.angle=this._angle,k.directionRandomizer=this.directionRandomizer,k.radiusRange=this.radiusRange,k.heightRange=this.heightRange,k.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,k}parse(k){this.radius=k.radius,this.angle=k.angle,this.directionRandomizer=k.directionRandomizer,this.radiusRange=void 0!==k.radiusRange?k.radiusRange:1,this.heightRange=void 0!==k.radiusRange?k.heightRange:1,this.emitFromSpawnPointOnly=void 0!==k.emitFromSpawnPointOnly&&k.emitFromSpawnPointOnly}}class N extends a{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.Vh(0,1,0),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.Vh(0,1,0);super(k,h),this.direction1=o,this.direction2=I}startDirectionFunction(k,h){const o=(0,l.RandomRange)(this.direction1.x,this.direction2.x),I=(0,l.RandomRange)(this.direction1.y,this.direction2.y),q=(0,l.RandomRange)(this.direction1.z,this.direction2.z);x.Vh.TransformNormalFromFloatsToRef(o,I,q,k,h)}clone(){const k=new N(this.radius,this.angle,this.direction1,this.direction2);return A.d.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("radiusRange",this.radiusRange),k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("radiusRange",1),k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const k=super.serialize();return k.direction1=this.direction1.rh(),k.direction2=this.direction2.rh(),k}parse(k){super.parse(k),this.direction1.Y(k.direction1),this.direction2.Y(k.direction2)}}class X{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=k,this.height=h,this.radiusRange=o,this.directionRandomizer=I,this._tempVector=x.Vh.Zero()}startDirectionFunction(k,h,o,I,q){o.position.subtractToRef(k.getTranslation(),this._tempVector),this._tempVector.normalize(),x.Vh.TransformNormalToRef(this._tempVector,q,this._tempVector);const Y=(0,l.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let J=Math.atan2(this._tempVector.x,this._tempVector.z);J+=(0,l.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Y,this._tempVector.x=Math.sin(J),this._tempVector.z=Math.cos(J),this._tempVector.normalize(),I?h.Y(this._tempVector):x.Vh.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,k,h)}startPositionFunction(k,h,o,I){const q=(0,l.RandomRange)(-this.height/2,this.height/2),Y=(0,l.RandomRange)(0,2*Math.PI),J=(0,l.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),G=Math.sqrt(J)*this.radius,A=G*Math.cos(Y),K=G*Math.sin(Y);I?h.VJ(A,q,K):x.Vh.TransformCoordinatesFromFloatsToRef(A,q,K,k,h)}clone(){const k=new X(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("height",this.height),k.setFloat("radiusRange",this.radiusRange),k.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("height",1),k.addUniform("radiusRange",1),k.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.radius=this.radius,k.height=this.height,k.radiusRange=this.radiusRange,k.directionRandomizer=this.directionRandomizer,k}parse(k){this.radius=k.radius,this.height=k.height,this.radiusRange=k.radiusRange,this.directionRandomizer=k.directionRandomizer}}class c extends X{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.Vh(0,1,0),q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.Vh(0,1,0);super(k,h,o),this.direction1=I,this.direction2=q}startDirectionFunction(k,h,o,I){const q=(0,l.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),J=(0,l.RandomRange)(this.direction1.z,this.direction2.z);I?h.VJ(q,Y,J):x.Vh.TransformNormalFromFloatsToRef(q,Y,J,k,h)}clone(){const k=new c(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return A.d.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("height",this.height),k.setFloat("radiusRange",this.radiusRange),k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("height",1),k.addUniform("radiusRange",1),k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const k=super.serialize();return k.direction1=this.direction1.rh(),k.direction2=this.direction2.rh(),k}parse(k){super.parse(k),x.Vh.FromArrayToRef(k.direction1,0,this.direction1),x.Vh.FromArrayToRef(k.direction2,0,this.direction2)}}class W{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=k,this.radiusRange=h,this.directionRandomizer=o}startDirectionFunction(k,h,o,I){const q=o.position.ih(k.getTranslation()).normalize(),Y=(0,l.RandomRange)(0,this.directionRandomizer),J=(0,l.RandomRange)(0,this.directionRandomizer),G=(0,l.RandomRange)(0,this.directionRandomizer);q.x+=Y,q.y+=J,q.z+=G,q.normalize(),I?h.Y(q):x.Vh.TransformNormalFromFloatsToRef(q.x,q.y,q.z,k,h)}startPositionFunction(k,h,o,I){const q=this.radius-(0,l.RandomRange)(0,this.radius*this.radiusRange),Y=(0,l.RandomRange)(0,1),J=(0,l.RandomRange)(0,2*Math.PI),G=Math.acos(2*Y-1),A=q*Math.cos(J)*Math.sin(G),K=q*Math.cos(G),a=q*Math.sin(J)*Math.sin(G);I?h.VJ(A,Math.abs(K),a):x.Vh.TransformCoordinatesFromFloatsToRef(A,Math.abs(K),a,k,h)}clone(){const k=new W(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("radiusRange",this.radiusRange),k.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("radiusRange",1),k.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.radius=this.radius,k.radiusRange=this.radiusRange,k.directionRandomizer=this.directionRandomizer,k}parse(k){this.radius=k.radius,this.radiusRange=k.radiusRange,this.directionRandomizer=k.directionRandomizer}}class f{constructor(){this.direction1=new x.Vh(0,1,0),this.direction2=new x.Vh(0,1,0)}startDirectionFunction(k,h,o,I){const q=(0,l.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),J=(0,l.RandomRange)(this.direction1.z,this.direction2.z);I?h.VJ(q,Y,J):x.Vh.TransformNormalFromFloatsToRef(q,Y,J,k,h)}startPositionFunction(k,h,o,I){I?h.VJ(0,0,0):x.Vh.TransformCoordinatesFromFloatsToRef(0,0,0,k,h)}clone(){const k=new f;return A.d.DeepCopy(this,k),k}applyToShader(k){k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.direction1=this.direction1.rh(),k.direction2=this.direction2.rh(),k}parse(k){x.Vh.FromArrayToRef(k.direction1,0,this.direction1),x.Vh.FromArrayToRef(k.direction2,0,this.direction2)}}class M{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=k,this.radiusRange=h,this.directionRandomizer=o}startDirectionFunction(k,h,o,I){const q=o.position.ih(k.getTranslation()).normalize(),Y=(0,l.RandomRange)(0,this.directionRandomizer),J=(0,l.RandomRange)(0,this.directionRandomizer),G=(0,l.RandomRange)(0,this.directionRandomizer);q.x+=Y,q.y+=J,q.z+=G,q.normalize(),I?h.Y(q):x.Vh.TransformNormalFromFloatsToRef(q.x,q.y,q.z,k,h)}startPositionFunction(k,h,o,I){const q=this.radius-(0,l.RandomRange)(0,this.radius*this.radiusRange),Y=(0,l.RandomRange)(0,1),J=(0,l.RandomRange)(0,2*Math.PI),G=Math.acos(2*Y-1),A=q*Math.cos(J)*Math.sin(G),K=q*Math.cos(G),a=q*Math.sin(J)*Math.sin(G);I?h.VJ(A,K,a):x.Vh.TransformCoordinatesFromFloatsToRef(A,K,a,k,h)}clone(){const k=new M(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("radiusRange",this.radiusRange),k.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("radiusRange",1),k.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.radius=this.radius,k.radiusRange=this.radiusRange,k.directionRandomizer=this.directionRandomizer,k}parse(k){this.radius=k.radius,this.radiusRange=k.radiusRange,this.directionRandomizer=k.directionRandomizer}}class T extends M{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.Vh(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.Vh(0,1,0);super(k),this.direction1=h,this.direction2=o}startDirectionFunction(k,h){const o=(0,l.RandomRange)(this.direction1.x,this.direction2.x),I=(0,l.RandomRange)(this.direction1.y,this.direction2.y),q=(0,l.RandomRange)(this.direction1.z,this.direction2.z);x.Vh.TransformNormalFromFloatsToRef(o,I,q,k,h)}clone(){const k=new T(this.radius,this.direction1,this.direction2);return A.d.DeepCopy(this,k),k}applyToShader(k){k.setFloat("radius",this.radius),k.setFloat("radiusRange",this.radiusRange),k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("radius",1),k.addUniform("radiusRange",1),k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const k=super.serialize();return k.direction1=this.direction1.rh(),k.direction2=this.direction2.rh(),k}parse(k){super.parse(k),this.direction1.Y(k.direction1),this.direction2.Y(k.direction2)}}class j{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(k,h,o,I){const q=x.TmpVectors.Vh[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,o,q);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,o,q);const k=x.TmpVectors.Vh[1];q.subtractToRef(o.position,k),k.scaleToRef(1/o.lifeTime,q)}else q.set(0,0,0);I?h.Y(q):x.Vh.TransformNormalToRef(q,k,h)}startPositionFunction(k,h,o,I){const q=x.TmpVectors.Vh[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,o,q):q.set(0,0,0),I?h.Y(q):x.Vh.TransformCoordinatesToRef(q,k,h)}clone(){const k=new j;return A.d.DeepCopy(this,k),k}applyToShader(k){}buildUniformLayout(k){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const k={};return k.type=this.getClassName(),k.particlePositionGenerator=this.particlePositionGenerator,k.particleDestinationGenerator=this.particleDestinationGenerator,k}parse(k){k.particlePositionGenerator&&(this.particlePositionGenerator=k.particlePositionGenerator),k.particleDestinationGenerator&&(this.particleDestinationGenerator=k.particleDestinationGenerator)}}var d=o(11308);class b{get mesh(){return this._mesh}set mesh(k){this._mesh!==k&&(this._mesh=k,k?(this._indices=k.dJ(),this._positions=k.getVerticesData(d.g.PositionKind),this._normals=k.getVerticesData(d.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=x.Vh.Zero(),this._mesh=null,this.direction1=new x.Vh(0,1,0),this.direction2=new x.Vh(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=k}startDirectionFunction(k,h,o,I){if(this.useMeshNormalsForDirection&&this._normals)return void x.Vh.TransformNormalToRef(this._storedNormal,k,h);const q=(0,l.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),J=(0,l.RandomRange)(this.direction1.z,this.direction2.z);I?h.VJ(q,Y,J):x.Vh.TransformNormalFromFloatsToRef(q,Y,J,k,h)}startPositionFunction(k,h,o,I){if(!this._indices||!this._positions)return;const q=3*(Math.random()*(this._indices.length/3)|0),Y=Math.random(),J=Math.random()*(1-Y),G=1-Y-J,l=this._indices[q],A=this._indices[q+1],K=this._indices[q+2],a=x.TmpVectors.Vh[0],N=x.TmpVectors.Vh[1],X=x.TmpVectors.Vh[2],c=x.TmpVectors.Vh[3];x.Vh.FromArrayToRef(this._positions,3*l,a),x.Vh.FromArrayToRef(this._positions,3*A,N),x.Vh.FromArrayToRef(this._positions,3*K,X),c.x=Y*a.x+J*N.x+G*X.x,c.y=Y*a.y+J*N.y+G*X.y,c.z=Y*a.z+J*N.z+G*X.z,I?h.VJ(c.x,c.y,c.z):x.Vh.TransformCoordinatesFromFloatsToRef(c.x,c.y,c.z,k,h),this.useMeshNormalsForDirection&&this._normals&&(x.Vh.FromArrayToRef(this._normals,3*l,a),x.Vh.FromArrayToRef(this._normals,3*A,N),x.Vh.FromArrayToRef(this._normals,3*K,X),this._storedNormal.x=Y*a.x+J*N.x+G*X.x,this._storedNormal.y=Y*a.y+J*N.y+G*X.y,this._storedNormal.z=Y*a.z+J*N.z+G*X.z)}clone(){const k=new b(this.mesh);return A.d.DeepCopy(this,k),k}applyToShader(k){k.setVector3("direction1",this.direction1),k.setVector3("direction2",this.direction2)}buildUniformLayout(k){k.addUniform("direction1",3),k.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var k;const h={};return h.type=this.getClassName(),h.direction1=this.direction1.rh(),h.direction2=this.direction2.rh(),h.meshId=null===(k=this.mesh)||void 0===k?void 0:k.id,h.useMeshNormalsForDirection=this.useMeshNormalsForDirection,h}parse(k,h){x.Vh.FromArrayToRef(k.direction1,0,this.direction1),x.Vh.FromArrayToRef(k.direction2,0,this.direction2),k.meshId&&h&&(this.mesh=h.getLastMeshById(k.meshId)),this.useMeshNormalsForDirection=k.useMeshNormalsForDirection}}class V{_isUbo(k){return void 0!==k.addUniform}constructor(k){this._isUbo(k)?(this.setMatrix3x3=k.updateMatrix3x3.bind(k),this.setMatrix2x2=k.updateMatrix2x2.bind(k),this.setFloat=k.updateFloat.bind(k),this.setFloat2=k.updateFloat2.bind(k),this.setFloat3=k.updateFloat3.bind(k),this.setFloat4=k.updateFloat4.bind(k),this.setFloatArray=k.updateFloatArray.bind(k),this.setArray=k.updateArray.bind(k),this.setIntArray=k.updateIntArray.bind(k),this.setMatrix=k.qq.bind(k),this.setMatrices=k.updateMatrices.bind(k),this.setVector3=k.updateVector3.bind(k),this.setVector4=k.updateVector4.bind(k),this.setColor3=k.updateColor3.bind(k),this.setColor4=k.updateColor4.bind(k),this.setDirectColor4=k.updateDirectColor4.bind(k),this.setInt=k.updateInt.bind(k),this.setInt2=k.updateInt2.bind(k),this.setInt3=k.updateInt3.bind(k),this.setInt4=k.updateInt4.bind(k)):(this.setMatrix3x3=k.setMatrix3x3.bind(k),this.setMatrix2x2=k.setMatrix2x2.bind(k),this.setFloat=k.setFloat.bind(k),this.setFloat2=k.setFloat2.bind(k),this.setFloat3=k.setFloat3.bind(k),this.setFloat4=k.setFloat4.bind(k),this.setFloatArray=k.setFloatArray.bind(k),this.setArray=k.setArray.bind(k),this.setIntArray=k.setIntArray.bind(k),this.setMatrix=k.setMatrix.bind(k),this.setMatrices=k.setMatrices.bind(k),this.setVector3=k.setVector3.bind(k),this.setVector4=k.setVector4.bind(k),this.setColor3=k.setColor3.bind(k),this.setColor4=k.setColor4.bind(k),this.setDirectColor4=k.setDirectColor4.bind(k),this.setInt=k.setInt.bind(k),this.setInt2=k.setInt2.bind(k),this.setInt3=k.setInt3.bind(k),this.setInt4=k.setInt4.bind(k))}}var i=o(11160);const F="gpuUpdateParticlesPixelShader",R="#version 300 es\nvoid main() {discard;}\n";i.b.ShadersStore[F]||(i.b.ShadersStore[F]=R);const s="gpuUpdateParticlesVertexShader",Z="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";i.b.ShadersStore[s]||(i.b.ShadersStore[s]=Z);(0,J.g)("BABYLON.WebGL2ParticleSystem",class{constructor(k,h){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=k,this._engine=h,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var k;return(null===(k=this._updateEffect)||void 0===k?void 0:k.isReady())??!1}createUpdateBuffer(k){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof j&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=k,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new V(this._updateEffect)}createVertexBuffers(k,h){this._updateVAO.push(this._createUpdateVAO(k)),this._renderVAO.push(this._engine.recordVertexArrayObject(h,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=h}createParticleBuffer(k){return k}bindDrawBuffers(k,h,o){o?this._engine.bindBuffers(this._renderVertexBuffers,o,h):this._engine.bindVertexArrayObject(this._renderVAO[k],null)}preUpdateParticleBuffer(){const k=this._engine;if(this._engine.enableEffect(this._updateEffect),!k.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(k,h,o){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[k],null);const x=this._engine;x.bindTransformFeedbackBuffer(h.getBuffer()),x.setRasterizerState(!1),x.beginTransformFeedback(!0),x.drawArraysType(3,0,o),x.endTransformFeedback(),x.setRasterizerState(!0),x.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let k=0;k<this._updateVAO.length;k++)this._engine.releaseVertexArrayObject(this._updateVAO[k]);this._updateVAO.length=0;for(let k=0;k<this._renderVAO.length;k++)this._engine.releaseVertexArrayObject(this._renderVAO[k]);this._renderVAO.length=0}_createUpdateVAO(k){const h={};h.position=k.createVertexBuffer("position",0,3);let o=3;h.age=k.createVertexBuffer("age",o,1),o+=1,h.size=k.createVertexBuffer("size",o,3),o+=3,h.life=k.createVertexBuffer("life",o,1),o+=1,h.seed=k.createVertexBuffer("seed",o,4),o+=4,h.direction=k.createVertexBuffer("direction",o,3),o+=3,this._parent.particleEmitterType instanceof j&&(h.initialPosition=k.createVertexBuffer("initialPosition",o,3),o+=3),this._parent._colorGradientsTexture||(h.color=k.createVertexBuffer("color",o,4),o+=4),this._parent._isBillboardBased||(h.initialDirection=k.createVertexBuffer("initialDirection",o,3),o+=3),this._parent.noiseTexture&&(h.noiseCoordinates1=k.createVertexBuffer("noiseCoordinates1",o,3),o+=3,h.noiseCoordinates2=k.createVertexBuffer("noiseCoordinates2",o,3),o+=3),this._parent._angularSpeedGradientsTexture?(h.angle=k.createVertexBuffer("angle",o,1),o+=1):(h.angle=k.createVertexBuffer("angle",o,2),o+=2),this._parent._isAnimationSheetEnabled&&(h.cellIndex=k.createVertexBuffer("cellIndex",o,1),o+=1,this._parent.spriteRandomStartCell&&(h.cellStartOffset=k.createVertexBuffer("cellStartOffset",o,1),o+=1));const x=this._engine.recordVertexArrayObject(h,null,this._updateEffect);return this._engine.bindArrayBuffer(null),x}});class w{constructor(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,x=arguments.length>3?arguments[3]:void 0;this._engine=k,this._label=x,this._engine._storageBuffers.push(this),this._create(h,o)}_create(k,h){this._bufferSize=k,this._creationFlags=h,this._buffer=this._engine.createStorageBuffer(k,h,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(k,h,o){this._buffer&&this._engine.updateStorageBuffer(this._buffer,k,h,o)}async read(k,h,o,x){return await this._engine.readFromStorageBuffer(this._buffer,k,h,o,x)}dispose(){const k=this._engine._storageBuffers,h=k.indexOf(this);-1!==h&&(k[h]=k[k.length-1],k.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var D=o(11227),U=o(11233),Q=o(11271),B=o(11223),E=o(11526),n=o(11098),H=o(11183),y=o(11451);class O{constructor(){this._gpuTimeInFrameId=-1,this.counter=new y.c}_addDuration(k,h){k<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==k?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(h,!1),this._gpuTimeInFrameId=k):this.counter.addCount(h,!1))}}var z=o(11145);class p{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=k,this._engine=h,this.uniqueId=E.c.UniqueId,h.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new O),this._engine.getCaps().supportComputeShaders?x.bindingsMapping?(this._context=h.createComputeContext(),this._shaderPath=o,this._options={bindingsMapping:{},defines:[],...x}):n.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):n.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(k,h){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const x=this._bindings[k];this._bindings[k]={type:o?0:4,object:h,indexInGroupEntries:null===x||void 0===x?void 0:x.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!x||x.object!==h||x.type!==this._bindings[k].type)}setStorageTexture(k,h){const o=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==h),this._bindings[k]={type:1,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setExternalTexture(k,h){const o=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==h),this._bindings[k]={type:6,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setVideoTexture(k,h){return!!h.externalTexture&&(this.setExternalTexture(k,h.externalTexture),!0)}setUniformBuffer(k,h){const o=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==h),this._bindings[k]={type:p._BufferIsDataBuffer(h)?7:2,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setStorageBuffer(k,h){const o=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==h),this._bindings[k]={type:p._BufferIsDataBuffer(h)?7:3,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setTextureSampler(k,h){const o=this._bindings[k];this._contextIsDirty||(this._contextIsDirty=!o||!h.compareSampler(o.object)),this._bindings[k]={type:5,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}isReady(){let k=this._effect;for(const I in this._bindings){const k=this._bindings[I],h=k.type,o=k.object;switch(h){case 0:case 4:case 1:if(!o.isReady())return!1;break;case 6:if(!o.isReady())return!1;break}}const h=[],o=this._shaderPath;if(this._options.defines)for(let I=0;I<this._options.defines.length;I++)h.push(this._options.defines[I]);const x=h.join("\n");return this._cachedDefines!==x&&(this._cachedDefines=x,k=this._engine.createComputeEffect(o,{defines:x,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=k),!!k.isReady()}dispatch(k,h,o){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,k,h,o,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const o=p._BufferIsDataBuffer(k)?k:k.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,o,h,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const h in this._bindings){const o=this._bindings[h];if(!this._options.bindingsMapping[h])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+h+"'");switch(o.type){case 0:{const x=this._samplers[h],I=o.object;var k;if(!x||!I._texture||!x.compareSampler(I._texture))this._samplers[h]=(new H.c).setParameters(I.wrapU,I.wrapV,I.wrapR,I.anisotropicFilteringLevel,I._texture.samplingMode,null===(k=I._texture)||void 0===k?void 0:k._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const k=o.object;k.getBuffer()!==o.buffer&&(o.buffer=k.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((I=>{(0,z.e)((()=>this.dispatch(k,h,o)),I,void 0,x)}))}serialize(){const k=Q.c.Serialize(this);k.options=this._options,k.shaderPath=this._shaderPath,k.Ja={},k.textures={};for(const h in this._bindings){const o=this._bindings[h],x=o.object;switch(o.type){case 0:case 4:case 1:{const I=x.serialize();I&&(k.textures[h]=I,k.Ja[h]={type:o.type});break}}}return k}static Parse(k,h,o){const x=Q.c.Parse((()=>new p(k.name,h.getEngine(),k.shaderPath,k.options)),k,h,o);for(const I in k.textures){const q=k.Ja[I],Y=B.b.Parse(k.textures[I],h,o);0===q.type?x.setTexture(I,Y):4===q.type?x.setTexture(I,Y,!1):x.setStorageTexture(I,Y)}return x}static _BufferIsDataBuffer(k){return void 0!==k.underlyingResource}}(0,D.d)([(0,U.E)()],p.prototype,"name",void 0),(0,D.d)([(0,U.E)()],p.prototype,"fastMode",void 0),(0,J.g)("BABYLON.ComputeShader",p);var v=o(11499);const m="gpuUpdateParticlesComputeShader",L="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";i.b.ShadersStoreWGSL[m]||(i.b.ShadersStoreWGSL[m]=L);(0,J.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(k,h){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=k,this._engine=h}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var k;return(null===(k=this._updateComputeShader)||void 0===k?void 0:k.isReady())??!1}createUpdateBuffer(k){var h;const o={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(o.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(o.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(o.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(o.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(o.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(o.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(o.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new p("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:o,defines:k.split("\n")}),null===(h=this._simParamsComputeShader)||void 0===h||h.dispose(),this._simParamsComputeShader=new v.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new V(this._simParamsComputeShader)}createVertexBuffers(k,h){this._renderVertexBuffers.push(h)}createParticleBuffer(k){const h=new w(this._engine,4*k.length,11,"ComputeShaderParticleSystemBuffer");return h.update(k),this._bufferComputeShader.push(h),h.getBuffer()}bindDrawBuffers(k,h,o){this._engine.bindBuffers(this._renderVertexBuffers[k],o,h)}preUpdateParticleBuffer(){}updateParticleBuffer(k,h,o){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[k]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^k]),this._updateComputeShader.dispatch(Math.ceil(o/64))}releaseBuffers(){var k;for(let h=0;h<this._bufferComputeShader.length;++h)this._bufferComputeShader[h].dispose();this._bufferComputeShader.length=0,null===(k=this._simParamsComputeShader)||void 0===k||k.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class P{constructor(k,h,o){this.gradient=k,this.color1=h,this.color2=o}getColorToRef(k){this.color2?Y.RJ.LerpToRef(this.color1,this.color2,Math.random(),k):k.Y(this.color1)}}class r{constructor(k,h){this.gradient=k,this.color=h}}class t{constructor(k,h,o){this.gradient=k,this.factor1=h,this.factor2=o}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class S{static GetCurrentGradient(k,h,o){if(h[0].gradient>k)return void o(h[0],h[0],1);for(let I=0;I<h.length-1;I++){const x=h[I],q=h[I+1];if(k>=x.gradient&&k<=q.gradient){return void o(x,q,(k-x.gradient)/(q.gradient-x.gradient))}}const x=h.length-1;o(h[x],h[x],1)}}var C=o(11082),g=o(11727),e=o(11120);class u{constructor(k){this.particleSystem=k,this.position=x.Vh.Zero(),this.direction=x.Vh.Zero(),this.color=new Y.RJ(0,0,0,0),this.colorStep=new Y.RJ(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new x.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Y.RJ(0,0,0,0),this._currentColor2=new Y.RJ(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=u._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let k=this.age,h=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===h?(h=1,k=this._randomCellOffset):k+=this._randomCellOffset);const o=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let x;x=this._initialSpriteCellLoop?(0,l.Clamp)(k*h%this.lifeTime/this.lifeTime):(0,l.Clamp)(k*h/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+x*o|0}_inheritParticleInfoToSubEmitter(k){if(k.particleSystem.Ih.position){const h=k.particleSystem.Ih;if(h.position.Y(this.position),k.inheritDirection){const k=x.TmpVectors.Vh[0];this.direction.normalizeToRef(k),h.setDirection(k,0,Math.PI/2)}}else{k.particleSystem.Ih.Y(this.position)}this.direction.scaleToRef(k.inheritedVelocityAmount/2,x.TmpVectors.Vh[0]),k.particleSystem._inheritedVelocityOffset.Y(x.TmpVectors.Vh[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const k of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(k)}_reset(){this.age=0,this.id=u._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(k){k.position.Y(this.position),this._initialDirection?k._initialDirection?k._initialDirection.Y(this._initialDirection):k._initialDirection=this._initialDirection.clone():k._initialDirection=null,k.direction.Y(this.direction),this.CJ&&(k.CJ?k.CJ.Y(this.CJ):k.CJ=this.CJ.clone()),k.color.Y(this.color),k.colorStep.Y(this.colorStep),k.lifeTime=this.lifeTime,k.age=this.age,k._randomCellOffset=this._randomCellOffset,k.size=this.size,k.scale.Y(this.scale),k.angle=this.angle,k.angularSpeed=this.angularSpeed,k.particleSystem=this.particleSystem,k.cellIndex=this.cellIndex,k.id=this.id,k._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(k._currentColorGradient=this._currentColorGradient,k._currentColor1.Y(this._currentColor1),k._currentColor2.Y(this._currentColor2)),this._currentSizeGradient&&(k._currentSizeGradient=this._currentSizeGradient,k._currentSize1=this._currentSize1,k._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(k._currentAngularSpeedGradient=this._currentAngularSpeedGradient,k._currentAngularSpeed1=this._currentAngularSpeed1,k._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(k._currentVelocityGradient=this._currentVelocityGradient,k._currentVelocity1=this._currentVelocity1,k._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(k._currentLimitVelocityGradient=this._currentLimitVelocityGradient,k._currentLimitVelocity1=this._currentLimitVelocity1,k._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(k._currentDragGradient=this._currentDragGradient,k._currentDrag1=this._currentDrag1,k._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(k._initialStartSpriteCellId=this._initialStartSpriteCellId,k._initialEndSpriteCellId=this._initialEndSpriteCellId,k._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(k.remapData&&this.remapData?k.remapData.Y(this.remapData):k.remapData=new x.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(k._randomNoiseCoordinates1?(k._randomNoiseCoordinates1.Y(this._randomNoiseCoordinates1),k._randomNoiseCoordinates2.Y(this._randomNoiseCoordinates2)):(k._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),k._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}u._Count=0;var kk=o(11356),hk=(o(11398),o(11602)),ok=o(11593),xk=o(11490);function Ik(k,h){const o=(0,l.RandomRange)(0,1);Y.RJ.LerpToRef(h.color1,h.color2,o,k.color),h.colorDead.subtractToRef(k.color,h._colorDiff),h._colorDiff.scaleToRef(1/k.lifeTime,k.colorStep)}function qk(k,h){k._currentColorGradient=h._colorGradients[0],k._currentColorGradient.getColorToRef(k.color),k._currentColor1.Y(k.color),h._colorGradients.length>1?h._colorGradients[1].getColorToRef(k._currentColor2):k._currentColor2.Y(k.color)}function Yk(k,h){const o=h._colorGradients;S.GetCurrentGradient(h._ratio,o,((h,o,x)=>{h!==k._currentColorGradient&&(k._currentColor1.Y(k._currentColor2),o.getColorToRef(k._currentColor2),k._currentColorGradient=h),Y.RJ.LerpToRef(k._currentColor1,k._currentColor2,x,k.color)}))}function Jk(k,h){k.colorStep.scaleToRef(h._scaledUpdateSpeed,h._scaledColorStep),k.color.addInPlace(h._scaledColorStep),k.color.a<0&&(k.color.a=0)}function Gk(k,h){S.GetCurrentGradient(h._ratio,h._angularSpeedGradients,((h,o,x)=>{h!==k._currentAngularSpeedGradient&&(k._currentAngularSpeed1=k._currentAngularSpeed2,k._currentAngularSpeed2=o.getFactor(),k._currentAngularSpeedGradient=h),k.angularSpeed=(0,l.Lerp)(k._currentAngularSpeed1,k._currentAngularSpeed2,x)}))}function lk(k,h){k.angle+=k.angularSpeed*h._scaledUpdateSpeed}function Ak(k,h){h.particleEmitterType.startDirectionFunction(h._emitterWorldMatrix,k.direction,k,h.isLocal,h._emitterInverseWorldMatrix)}function Kk(k,h){h.startDirectionFunction(h._emitterWorldMatrix,k.direction,k,h.isLocal)}function ak(k,h){k._currentVelocityGradient=h._velocityGradients[0],k._currentVelocity1=k._currentVelocityGradient.getFactor(),h._velocityGradients.length>1?k._currentVelocity2=h._velocityGradients[1].getFactor():k._currentVelocity2=k._currentVelocity1}function Nk(k,h){k._currentLimitVelocityGradient=h._limitVelocityGradients[0],k._currentLimitVelocity1=k._currentLimitVelocityGradient.getFactor(),h._limitVelocityGradients.length>1?k._currentLimitVelocity2=h._limitVelocityGradients[1].getFactor():k._currentLimitVelocity2=k._currentLimitVelocity1}function Xk(k,h){S.GetCurrentGradient(h._ratio,h._velocityGradients,((o,x,I)=>{o!==k._currentVelocityGradient&&(k._currentVelocity1=k._currentVelocity2,k._currentVelocity2=x.getFactor(),k._currentVelocityGradient=o),h._directionScale*=(0,l.Lerp)(k._currentVelocity1,k._currentVelocity2,I)}))}function ck(k,h){S.GetCurrentGradient(h._ratio,h._limitVelocityGradients,((o,x,I)=>{o!==k._currentLimitVelocityGradient&&(k._currentLimitVelocity1=k._currentLimitVelocity2,k._currentLimitVelocity2=x.getFactor(),k._currentLimitVelocityGradient=o);const q=(0,l.Lerp)(k._currentLimitVelocity1,k._currentLimitVelocity2,I);k.direction.length()>q&&k.direction.scaleInPlace(h.limitVelocityDamping)}))}function Wk(k,h){k.direction.scaleToRef(h._directionScale,h._scaledDirection)}function fk(k,h){h.particleEmitterType.startPositionFunction(h._emitterWorldMatrix,k.position,k,h.isLocal)}function Mk(k,h){h.startPositionFunction(h._emitterWorldMatrix,k.position,k,h.isLocal)}function Tk(k,h){k.CJ?k.CJ.Y(k.position):k.CJ=k.position.clone(),x.Vh.TransformCoordinatesToRef(k.CJ,h._emitterWorldMatrix,k.position)}function jk(k,h){h.isLocal&&k.CJ?(k.CJ.addInPlace(h._scaledDirection),x.Vh.TransformCoordinatesToRef(k.CJ,h._emitterWorldMatrix,k.position)):k.position.addInPlace(h._scaledDirection)}function dk(k,h){k._currentDragGradient=h._dragGradients[0],k._currentDrag1=k._currentDragGradient.getFactor(),h._dragGradients.length>1?k._currentDrag2=h._dragGradients[1].getFactor():k._currentDrag2=k._currentDrag1}function bk(k,h){S.GetCurrentGradient(h._ratio,h._dragGradients,((o,x,I)=>{o!==k._currentDragGradient&&(k._currentDrag1=k._currentDrag2,k._currentDrag2=x.getFactor(),k._currentDragGradient=o);const q=(0,l.Lerp)(k._currentDrag1,k._currentDrag2,I);h._scaledDirection.scaleInPlace(1-q)}))}function Vk(k,h){k._randomNoiseCoordinates1?(k._randomNoiseCoordinates1.VJ(Math.random(),Math.random(),Math.random()),k._randomNoiseCoordinates2.VJ(Math.random(),Math.random(),Math.random())):(k._randomNoiseCoordinates1=new x.Vh(Math.random(),Math.random(),Math.random()),k._randomNoiseCoordinates2=new x.Vh(Math.random(),Math.random(),Math.random()))}function ik(k,h){const o=h._noiseTextureData,I=h._noiseTextureSize;if(o&&I&&k._randomNoiseCoordinates1){const q=h._fetchR(k._randomNoiseCoordinates1.x,k._randomNoiseCoordinates1.y,I.width,I.height,o),Y=h._fetchR(k._randomNoiseCoordinates1.z,k._randomNoiseCoordinates2.x,I.width,I.height,o),J=h._fetchR(k._randomNoiseCoordinates2.y,k._randomNoiseCoordinates2.z,I.width,I.height,o),G=x.TmpVectors.Vh[0],l=x.TmpVectors.Vh[1];G.VJ((2*q-1)*h.noiseStrength.x,(2*Y-1)*h.noiseStrength.y,(2*J-1)*h.noiseStrength.z),G.scaleToRef(h._tempScaledUpdateSpeed,l),k.direction.addInPlace(l)}}function Fk(k,h){h.gravity.scaleToRef(h._tempScaledUpdateSpeed,h._scaledGravity),k.direction.addInPlace(h._scaledGravity)}function Rk(k,h){k.size=(0,l.RandomRange)(h.minSize,h.maxSize),k.scale.VJ((0,l.RandomRange)(h.minScaleX,h.maxScaleX),(0,l.RandomRange)(h.minScaleY,h.maxScaleY))}function sk(k,h){k._currentSizeGradient=h._sizeGradients[0],k._currentSize1=k._currentSizeGradient.getFactor(),k.size=k._currentSize1,h._sizeGradients.length>1?k._currentSize2=h._sizeGradients[1].getFactor():k._currentSize2=k._currentSize1,k.scale.VJ((0,l.RandomRange)(h.minScaleX,h.maxScaleX),(0,l.RandomRange)(h.minScaleY,h.maxScaleY))}function Zk(k,h){const o=h._actualFrame/h.targetStopDuration;S.GetCurrentGradient(o,h._startSizeGradients,((o,x,I)=>{o!==h._currentStartSizeGradient&&(h._currentStartSize1=h._currentStartSize2,h._currentStartSize2=x.getFactor(),h._currentStartSizeGradient=o);const q=(0,l.Lerp)(h._currentStartSize1,h._currentStartSize2,I);k.scale.scaleInPlace(q)}))}function wk(k,h){S.GetCurrentGradient(h._ratio,h._sizeGradients,((h,o,x)=>{h!==k._currentSizeGradient&&(k._currentSize1=k._currentSize2,k._currentSize2=o.getFactor(),k._currentSizeGradient=h),k.size=(0,l.Lerp)(k._currentSize1,k._currentSize2,x)}))}function Dk(k,h){k.remapData=new x.Vector4(0,1,0,1)}function Uk(k,h){h._colorRemapGradients&&h._colorRemapGradients.length>0&&S.GetCurrentGradient(h._ratio,h._colorRemapGradients,((h,o,x)=>{const I=(0,l.Lerp)(h.factor1,o.factor1,x),q=(0,l.Lerp)(h.factor2,o.factor2,x);k.remapData.x=I,k.remapData.y=q-I})),h._alphaRemapGradients&&h._alphaRemapGradients.length>0&&S.GetCurrentGradient(h._ratio,h._alphaRemapGradients,((h,o,x)=>{const I=(0,l.Lerp)(h.factor1,o.factor1,x),q=(0,l.Lerp)(h.factor2,o.factor2,x);k.remapData.z=I,k.remapData.w=q-I}))}function Qk(k,h){const o=(0,l.Clamp)(h._actualFrame/h.targetStopDuration);S.GetCurrentGradient(o,h._lifeTimeGradients,((h,x)=>{const I=h,q=x,Y=I.getFactor(),J=q.getFactor(),G=(o-I.gradient)/(q.gradient-I.gradient);k.lifeTime=(0,l.Lerp)(Y,J,G)})),h._emitPower=(0,l.RandomRange)(h.minEmitPower,h.maxEmitPower)}function Bk(k,h){k.lifeTime=(0,l.RandomRange)(h.minLifeTime,h.maxLifeTime),h._emitPower=(0,l.RandomRange)(h.minEmitPower,h.maxEmitPower)}function Ek(k,h){0===h._emitPower?(k._initialDirection?k._initialDirection.Y(k.direction):k._initialDirection=k.direction.clone(),k.direction.set(0,0,0)):(k._initialDirection=null,k.direction.scaleInPlace(h._emitPower)),k.direction.addInPlace(h._inheritedVelocityOffset)}function nk(k,h){k.angularSpeed=(0,l.RandomRange)(h.minAngularSpeed,h.maxAngularSpeed),k.angle=(0,l.RandomRange)(h.minInitialRotation,h.maxInitialRotation)}function Hk(k,h){k._currentAngularSpeedGradient=h._angularSpeedGradients[0],k.angularSpeed=k._currentAngularSpeedGradient.getFactor(),k._currentAngularSpeed1=k.angularSpeed,h._angularSpeedGradients.length>1?k._currentAngularSpeed2=h._angularSpeedGradients[1].getFactor():k._currentAngularSpeed2=k._currentAngularSpeed1,k.angle=(0,l.RandomRange)(h.minInitialRotation,h.maxInitialRotation)}function yk(k,h){k._initialStartSpriteCellId=h.startSpriteCellID,k._initialEndSpriteCellId=h.endSpriteCellID,k._initialSpriteCellLoop=h.spriteCellLoop}function Ok(k,h){k.previousItem=h.previousItem,k.nextItem=h,h.previousItem&&(h.previousItem.nextItem=k),h.previousItem=k}function zk(k,h){k.previousItem=h,k.nextItem=h.nextItem,h.nextItem&&(h.nextItem.previousItem=k),h.nextItem=k}function pk(k,h){let o=h;for(;o.nextItem;)o=o.nextItem;k.previousItem=o,k.nextItem=o.nextItem,o.nextItem=k}function vk(k){k.previousItem&&(k.previousItem.nextItem=k.nextItem),k.nextItem&&(k.nextItem.previousItem=k.previousItem)}class mk extends G{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(k){this._startDirectionFunction!==k&&(this._startDirectionFunction=k,this._directionProcessing.process=k?Kk:Ak)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(k){this._startPositionFunction!==k&&(this._startPositionFunction=k,this._positionCreation.process=k?Mk:fk)}set onDispose(k){this._onDisposeObserver&&this.sh.remove(this._onDisposeObserver),this._onDisposeObserver=this.sh.add(k)}get l(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(k){this._useRampGradients!==k&&(this._useRampGradients=k,this._resetEffect(),k?(this._rampCreation={process:Dk,previousItem:null,nextItem:null},zk(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Uk,previousItem:null,nextItem:null},zk(this._remapGradientProcessing,this._gravityProcessing)):(vk(this._rampCreation),vk(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(k){this._isLocal!==k&&(this._isLocal=k,k?(this._isLocalCreation={process:Tk,previousItem:null,nextItem:null},zk(this._isLocalCreation,this._positionCreation)):vk(this._isLocalCreation))}get particles(){return this.oa}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(k){this._animationSheetEnabled!==k&&(this._animationSheetEnabled=k,k?(this._sheetCreation={process:yk,previousItem:null,nextItem:null},zk(this._sheetCreation,this._colorCreation)):vk(this._sheetCreation),this._reset())}getActiveCount(){return this.oa.length}getClassName(){return"rl"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var k;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(k=this._customWrappers[h])||void 0===k?void 0:k.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[k]??this._customWrappers[0]}setCustomEffect(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[h]=new kk.e(this._engine),this._customWrappers[h].effect=k,this._customWrappers[h].drawContext&&(this._customWrappers[h].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(k){if(this.noiseTexture!==k){if(this._noiseTexture=k,!k)return vk(this._noiseCreation),void vk(this._noiseProcessing);this._noiseCreation={process:Vk,previousItem:null,nextItem:null},zk(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ik,previousItem:null,nextItem:null},zk(this._noiseProcessing,this._positionProcessing)}}constructor(k,h,o){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(k),this._emitterInverseWorldMatrix=x.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new x.Vh,this.sh=new C.d,this.onStoppedObservable=new C.d,this.onStartedObservable=new C.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.oa=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Y.RJ(0,0,0,0),this._colorDiff=new Y.RJ(0,0,0,0),this._scaledDirection=x.Vh.Zero(),this._scaledGravity=x.Vh.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=k=>{},this.recycleParticle=k=>{const h=this.oa.pop();h!==k&&h.copyTo(k),this._stockParticles.push(h)},this._createParticle=()=>{let k;return 0!==this._stockParticles.length?(k=this._stockParticles.pop(),k._reset()):k=new u(this),this._prepareParticle(k),k},this.paused=!1,this._shadersLoaded=!1,this._capacity=h,this._epsilon=J,o&&"Scene"!==o.getClassName()?(this._engine=o,this.defaultProjectionMatrix=x.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=o||e.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ka.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Bk,previousItem:null,nextItem:null},this._positionCreation={process:fk,previousItem:null,nextItem:null},zk(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Ak,previousItem:null,nextItem:null},zk(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Ek,previousItem:null,nextItem:null},zk(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Rk,previousItem:null,nextItem:null},zk(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:nk,previousItem:null,nextItem:null},zk(this._angleCreation,this._sizeCreation),this._colorCreation={process:Ik,previousItem:null,nextItem:null},zk(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,G||(this._colorProcessing={process:Jk,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:lk,previousItem:null,nextItem:null},zk(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Wk,previousItem:null,nextItem:null},zk(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:jk,previousItem:null,nextItem:null},zk(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Fk,previousItem:null,nextItem:null},zk(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=q,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new kk.e(this._engine)},this._customWrappers[0].effect=I,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new K,this.updateFunction=k=>{var h;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(h=this.noiseTexture.getContent())||void 0===h||h.then((k=>{this._noiseTextureData=k})));const o=k===this.oa;for(let x=0;x<k.length;x++){const h=k[x];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const I=h.age;if(h.age+=this._tempScaledUpdateSpeed,h.age>h.lifeTime){const k=h.age-I,o=h.lifeTime-I;this._tempScaledUpdateSpeed=o*this._tempScaledUpdateSpeed/k,h.age=h.lifeTime}this._ratio=h.age/h.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let q=this._updateQueueStart;for(;q;)q.process(h,this),q=q.nextItem;if(this._isAnimationSheetEnabled&&!G&&h.updateCellIndex(),h._inheritParticleInfoToSubEmitters(),h.age>=h.lifeTime){if(this._emitFromParticle(h),h._attachedSubEmitters){for(const k of h._attachedSubEmitters)k.particleSystem.disposeOnStop=!0,k.particleSystem.stop();h._attachedSubEmitters=null}this.recycleParticle(h),o&&x--}else;}}}serialize(k){throw new Error("Method not implemented.")}clone(k,h){throw new Error("Method not implemented.")}_addFactorGradient(k,h,o,x){const I=new t(h,o,x);k.push(I),k.sort(((k,h)=>k.gradient<h.gradient?-1:k.gradient>h.gradient?1:0))}_removeFactorGradient(k,h){if(!k)return;let o=0;for(const x of k){if(x.gradient===h){k.splice(o,1);break}o++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Qk:this._lifeTimeCreation.process=Bk}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Zk,previousItem:null,nextItem:null},zk(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(vk(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(k){this.targetStopDuration!==k&&(this._targetStopDuration=k,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(k,h,o){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,k,h,o),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(k){return this._removeFactorGradient(this._lifeTimeGradients,k),this._syncLifeTimeCreation(),this}addSizeGradient(k,h,o){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=sk,this._sizeGradientProcessing={process:wk,previousItem:null,nextItem:null},Ok(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,k,h,o),this}removeSizeGradient(k){var h;return this._removeFactorGradient(this._sizeGradients,k),0===(null===(h=this._sizeGradients)||void 0===h?void 0:h.length)&&(vk(this._sizeGradientProcessing),this._sizeCreation.process=Rk),this}addColorRemapGradient(k,h,o){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,k,h,o),this}removeColorRemapGradient(k){return this._removeFactorGradient(this._colorRemapGradients,k),this}addAlphaRemapGradient(k,h,o){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,k,h,o),this}removeAlphaRemapGradient(k){return this._removeFactorGradient(this._alphaRemapGradients,k),this}addAngularSpeedGradient(k,h,o){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Hk,this._angularSpeedGradientProcessing={process:Gk,previousItem:null,nextItem:null},Ok(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,k,h,o),this}removeAngularSpeedGradient(k){var h;return this._removeFactorGradient(this._angularSpeedGradients,k),0===(null===(h=this._angularSpeedGradients)||void 0===h?void 0:h.length)&&(this._angleCreation.process=nk,vk(this._angularSpeedGradientProcessing)),this}addVelocityGradient(k,h,o){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:ak,previousItem:null,nextItem:null},zk(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Xk,previousItem:null,nextItem:null},Ok(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,k,h,o),this}removeVelocityGradient(k){var h;return this._removeFactorGradient(this._velocityGradients,k),0===(null===(h=this._velocityGradients)||void 0===h?void 0:h.length)&&(vk(this._velocityCreation),vk(this._velocityGradientProcessing)),this}addLimitVelocityGradient(k,h,o){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Nk,previousItem:null,nextItem:null},zk(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:ck,previousItem:null,nextItem:null},zk(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,k,h,o),this}removeLimitVelocityGradient(k){var h;return this._removeFactorGradient(this._limitVelocityGradients,k),0===(null===(h=this._limitVelocityGradients)||void 0===h?void 0:h.length)&&(vk(this._limitVelocityCreation),vk(this._limitVelocityGradientProcessing)),this}addDragGradient(k,h,o){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:dk,previousItem:null,nextItem:null},Ok(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:bk,previousItem:null,nextItem:null},Ok(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,k,h,o),this}removeDragGradient(k){var h;return this._removeFactorGradient(this._dragGradients,k),0===(null===(h=this._dragGradients)||void 0===h?void 0:h.length)&&(vk(this._dragCreation),vk(this._dragGradientProcessing)),this}addEmitRateGradient(k,h,o){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,k,h,o),this}removeEmitRateGradient(k){return this._removeFactorGradient(this._emitRateGradients,k),this}addStartSizeGradient(k,h,o){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,k,h,o),this._syncStartSizeCreation(),this}removeStartSizeGradient(k){return this._removeFactorGradient(this._startSizeGradients,k),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const k=new Uint8Array(4*this._rawTextureWidth),h=Y.TmpColors.Zh[0];for(let o=0;o<this._rawTextureWidth;o++){const x=o/this._rawTextureWidth;S.GetCurrentGradient(x,this._rampGradients,((x,I,q)=>{Y.Zh.LerpToRef(x.color,I.color,q,h),k[4*o]=255*h.r,k[4*o+1]=255*h.g,k[4*o+2]=255*h.b,k[4*o+3]=255}))}this._rampGradientsTexture=g.c.CreateRGBATexture(k,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((k,h)=>k.gradient<h.gradient?-1:k.gradient>h.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(k,h){this._rampGradients||(this._rampGradients=[]);const o=new r(k,h);return this._rampGradients.push(o),this._syncRampGradientTexture(),this}removeRampGradient(k){return this._removeGradientAndTexture(k,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(k,h,o){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=qk,this._colorProcessing.process=Yk);const x=new P(k,h,o);return this._colorGradients.push(x),this._colorGradients.sort(((k,h)=>k.gradient<h.gradient?-1:k.gradient>h.gradient?1:0)),this}removeColorGradient(k){if(!this._colorGradients)return this;let h=0;for(const o of this._colorGradients){if(o.gradient===k){this._colorGradients.splice(h,1);break}h++}return 0===this._colorGradients.length&&(this._colorCreation.process=Ik,this._colorProcessing.process=Jk),this}resetDrawCache(){if(this._drawWrappers){for(const k of this._drawWrappers)if(k)for(const h of k)null===h||void 0===h||h.dispose();this._drawWrappers=[]}}_fetchR(k,h,o,x,I){return I[4*(((k=.5*Math.abs(k)+.5)*o%o|0)+((h=.5*Math.abs(h)+.5)*x%x|0)*o)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const k=this._engine,h=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*h),this._vertexBuffer=new d.d(k,this._vertexData,!0,h);let o=0;const x=this._vertexBuffer.createVertexBuffer(d.g.PositionKind,o,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[d.g.PositionKind]=x,o+=3;const I=this._vertexBuffer.createVertexBuffer(d.g.ColorKind,o,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[d.g.ColorKind]=I,o+=4;const q=this._vertexBuffer.createVertexBuffer("angle",o,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=q,o+=1;const Y=this._vertexBuffer.createVertexBuffer("size",o,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Y,o+=2,this._isAnimationSheetEnabled){const k=this._vertexBuffer.createVertexBuffer("cellIndex",o,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=k,o+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const k=this._vertexBuffer.createVertexBuffer("direction",o,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=k,o+=3}if(this._useRampGradients){const k=this._vertexBuffer.createVertexBuffer("remapData",o,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=k,o+=4}let J;if(this._useInstancing){const h=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new d.d(k,h,!1,2),J=this._spriteBuffer.createVertexBuffer("offset",0,2)}else J=this._vertexBuffer.createVertexBuffer("offset",o,2,this._vertexBufferSize,this._useInstancing),o+=2;this._vertexBuffers.offset=J,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const k=[],h=[];let o=0;for(let x=0;x<this._capacity;x++)k.push(o),k.push(o+1),k.push(o+2),k.push(o),k.push(o+2),k.push(o+3),h.push(o,o+1,o+1,o+2,o+2,o+3,o+3,o,o,o+3),o+=4;this._indexBuffer=this._engine.createIndexBuffer(k),this._linesIndexBuffer=this._engine.createIndexBuffer(h)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(k)setTimeout((()=>{this.start(0)}),k);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var h;-1!==(null===(h=this.Ih)||void 0===h?void 0:h.getClassName().indexOf("Mesh"))&&this.Ih.eq(!0);const k=this.noiseTexture;if(k&&k.onGeneratedObservable)k.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let h=0;h<this.preWarmCycles;h++)this.animate(!0),k.render()}))}));else for(let h=0;h<this.preWarmCycles;h++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(k))}_postStop(k){}reset(){this._stockParticles.length=0,this.oa.length=0}_appendParticleVertex(k,h,o,I){let q=k*this._vertexBufferSize;if(this._vertexData[q++]=h.position.x+this.fl.x,this._vertexData[q++]=h.position.y+this.fl.y,this._vertexData[q++]=h.position.z+this.fl.z,this._vertexData[q++]=h.color.r,this._vertexData[q++]=h.color.g,this._vertexData[q++]=h.color.b,this._vertexData[q++]=h.color.a,this._vertexData[q++]=h.angle,this._vertexData[q++]=h.scale.x*h.size,this._vertexData[q++]=h.scale.y*h.size,this._isAnimationSheetEnabled&&(this._vertexData[q++]=h.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[q++]=h.direction.x,this._vertexData[q++]=h.direction.y,this._vertexData[q++]=h.direction.z);else if(h._initialDirection){let k=h._initialDirection;this.isLocal&&(x.Vh.TransformNormalToRef(k,this._emitterWorldMatrix,x.TmpVectors.Vh[0]),k=x.TmpVectors.Vh[0]),0===k.x&&0===k.z&&(k.x=.001),this._vertexData[q++]=k.x,this._vertexData[q++]=k.y,this._vertexData[q++]=k.z}else{let k=h.direction;this.isLocal&&(x.Vh.TransformNormalToRef(k,this._emitterWorldMatrix,x.TmpVectors.Vh[0]),k=x.TmpVectors.Vh[0]),0===k.x&&0===k.z&&(k.x=.001),this._vertexData[q++]=k.x,this._vertexData[q++]=k.y,this._vertexData[q++]=k.z}this._useRampGradients&&h.remapData&&(this._vertexData[q++]=h.remapData.x,this._vertexData[q++]=h.remapData.y,this._vertexData[q++]=h.remapData.z,this._vertexData[q++]=h.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===o?o=this._epsilon:1===o&&(o=1-this._epsilon),0===I?I=this._epsilon:1===I&&(I=1-this._epsilon)),this._vertexData[q++]=o,this._vertexData[q++]=I)}_prepareParticle(k){}_createNewOnes(k){let h;for(let o=0;o<k&&this.oa.length!==this._capacity;o++){h=this._createParticle(),this.oa.push(h);let k=this._createQueueStart;for(;k;)k.process(h,this),k=k.nextItem;h._inheritParticleInfoToSubEmitters()}}_update(k){if(this._alive=this.oa.length>0,this.Ih.position){const k=this.Ih;this._emitterWorldMatrix=k.getWorldMatrix()}else{const k=this.Ih;this._emitterWorldMatrix=x.Matrix.Translation(k.x,k.y,k.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.oa),this._createNewOnes(k)}static _GetAttributeNamesOrOptions(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=[d.g.PositionKind,d.g.ColorKind,"angle","offset","size"];return k&&x.push("cellIndex"),h||x.push("direction"),o&&x.push("remapData"),x}static _GetEffectCreationOptions(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,hk.c)(x),k&&x.push("particlesInfos"),h&&x.push("logarithmicDepthConstant"),o&&(x.push("vFogInfos"),x.push("vFogColor")),x}fillDefines(k,h){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,hk.n)(this,this._scene,k),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&k.push("#define FOG")),this._isAnimationSheetEnabled&&k.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&k.push("#define LOGARITHMICDEPTH"),h===G.BLENDMODE_MULTIPLY&&k.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&k.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(k.push("#define BILLBOARD"),this.billboardMode){case 2:k.push("#define BILLBOARDY");break;case 8:case 9:k.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&k.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:k.push("#define BILLBOARDMODE_ALL")}o&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),k.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(k,h,o){h.push(...mk._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),k.push(...mk._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),o.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,xk.g)(k,this._imageProcessingConfigurationDefines),(0,xk.c)(o,this._imageProcessingConfigurationDefines))}_getWrapper(k){const h=this._getCustomDrawWrapper(k);if(null!==h&&void 0!==h&&h.effect)return h;const o=[];this.fillDefines(o,k);const x=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let I=this._drawWrappers[x];I||(I=this._drawWrappers[x]=[]);let q=I[k];q||(q=new kk.e(this._engine),q.drawContext&&(q.drawContext.useInstancing=this._useInstancing),I[k]=q);const Y=o.join("\n");if(q.defines!==Y){const k=[],h=[],o=[];this.fillUniformsAttributesAndSamplerNames(h,k,o),q.setEffect(this._engine.createEffect("particles",k,h,o,Y,void 0,void 0,void 0,void 0,this._shaderLanguage),Y)}return q}animate(){var k;let h,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!o&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(o?this.preWarmStepOffset:(null===(k=this._scene)||void 0===k?void 0:k.getAnimationRatio())||1),this.manualEmitCount>-1)h=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let k=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const h=this._actualFrame/this.targetStopDuration;S.GetCurrentGradient(h,this._emitRateGradients,((h,o,x)=>{h!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=o.getFactor(),this._currentEmitRateGradient=h),k=(0,l.Lerp)(this._currentEmitRate1,this._currentEmitRate2,x)}))}h=k*this._scaledUpdateSpeed|0,this._newPartsExcess+=k*this._scaledUpdateSpeed-h}if(this._newPartsExcess>1&&(h+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?h=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(h),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!o){let k=0;for(let h=0;h<this.oa.length;h++){const o=this.oa[h];this._appendParticleVertices(k,o),k+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.oa.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(k,h){this._appendParticleVertex(k++,h,0,0),this._useInstancing||(this._appendParticleVertex(k++,h,1,0),this._appendParticleVertex(k++,h,1,1),this._appendParticleVertex(k++,h,0,1))}rebuild(){var k;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(k=this._spriteBuffer)||void 0===k||k._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!mk.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(o.bind(o,12736)),Promise.resolve().then(o.bind(o,12680))])):await Promise.all([Promise.resolve().then(o.bind(o,12668)),Promise.resolve().then(o.bind(o,12651))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Ih||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==G.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(G.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(G.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(k){const h=this._getWrapper(k),o=h.effect,I=this._engine;I.enableEffect(h);const q=this.defaultViewMatrix??this._scene.getViewMatrix();if(o.setTexture("diffuseSampler",this.particleTexture),o.setMatrix("view",q),o.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const k=this.particleTexture.getBaseSize();o.setFloat3("particlesInfos",this.spriteCellWidth/k.width,this.spriteCellHeight/k.height,this.spriteCellWidth/k.width)}if(o.setVector2("translationPivot",this.translationPivot),o.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const k=this._scene.activeCamera;o.setVector3("eyePosition",k.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),o.setTexture("rampSampler",this._rampGradientsTexture));const Y=o.defines;var J,G,l,A,K,a;(this._scene&&((0,hk.g)(o,this,this._scene),this.applyFog&&(0,ok.f)(this._scene,void 0,o)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(q.invertToRef(x.TmpVectors.Matrix[0]),o.setMatrix("invView",x.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?I.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,o):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,o)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?I.bindBuffers(this._vertexBuffers,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBuffer:this._indexBuffer,o):I.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null,o);(this.useLogarithmicDepth&&this._scene&&(0,ok.j)(Y,o,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),this._setEngineBasedOnBlendMode(k),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),this._useInstancing)?null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?I.drawElementsType(6,0,10,this.oa.length):I.drawArraysType(7,0,4,this.oa.length):null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?I.drawElementsType(1,0,10*this.oa.length):I.drawElementsType(0,0,6*this.oa.length);return this.oa.length}render(){if(!this.isReady()||!this.oa.length)return 0;const k=this._engine;k.setState&&(k.setState(!1),this.forceDepthWrite&&k.setDepthWrite(!0));let h=0;return h=this.blendMode===G.BLENDMODE_MULTIPLYADD?this._render(G.BLENDMODE_MULTIPLY)+this._render(G.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),h}_onDispose(){}dispose(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),k&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),k&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(h,o),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const k=this._scene.ka.indexOf(this);k>-1&&this._scene.ka.splice(k,1),this._scene._activeParticleSystems.dispose()}this.sh.notifyObservers(this),this.sh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}mk.ForceGLSL=!1;var Lk,Pk=o(11108);!function(k){k[k.ATTACHED=0]="ATTACHED",k[k.END=1]="END"}(Lk||(Lk={}));class rk{constructor(k){if(this.particleSystem=k,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!k.Ih||!k.Ih.dispose){const h=(0,J.e)("BABYLON.AbstractMesh");k.Ih=new h("SubemitterSystemEmitter",k.ik()),k._disposeEmitterOnDispose=!0}}clone(){let k=this.particleSystem.Ih;if(k){if(k instanceof x.Vh)k=k.clone();else if(-1!==k.getClassName().indexOf("Mesh")){k=new((0,J.e)("BABYLON.Mesh"))("",k.ik()),k.isVisible=!1}}else k=new x.Vh;const h=new rk(this.particleSystem.clone(this.particleSystem.name,k));return h.particleSystem.name+="Clone",h.type=this.type,h.inheritDirection=this.inheritDirection,h.inheritedVelocityAmount=this.inheritedVelocityAmount,h.particleSystem._disposeEmitterOnDispose=!0,h.particleSystem.disposeOnStop=!0,h}serialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};return h.type=this.type,h.inheritDirection=this.inheritDirection,h.inheritedVelocityAmount=this.inheritedVelocityAmount,h.particleSystem=this.particleSystem.serialize(k),h}static _ParseParticleSystem(k,h,o){throw(0,Pk.e)("ParseParticle")}static Parse(k,h,o){const x=k.particleSystem,I=new rk(rk._ParseParticleSystem(x,h,o,!0));return I.type=k.type,I.inheritDirection=k.inheritDirection,I.inheritedVelocityAmount=k.inheritedVelocityAmount,I.particleSystem._isSubEmitter=!0,I}dispose(){this.particleSystem.dispose()}}var tk=o(11151);function Sk(k,h){const o=new f;return o.direction1=k,o.direction2=h,o}function Ck(){return new W(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function gk(){return new M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ek(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.Vh(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.Vh(0,1,0);return new T(k,h,o)}function uk(){return new X(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function kh(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.Vh(0,1,0),q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.Vh(0,1,0);return new c(k,h,o,I,q)}function hh(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new a(k,h)}function oh(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.Vh(0,1,0),I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.Vh(0,1,0);return new N(k,h,o,I)}const xh=x.Vh.Zero(),Ih=x.Vh.Zero(),qh=x.Vh.Zero();class Yh{constructor(){this.strength=0,this.position=x.Vh.Zero()}_processParticle(k,h){this.position.subtractToRef(k.position,xh);const o=xh.lengthSquared()+1;xh.normalize().scaleToRef(this.strength/o,Ih),Ih.scaleToRef(h._tempScaledUpdateSpeed,qh),k.direction.addInPlace(qh)}serialize(){return{position:this.position.rh(),strength:this.strength}}}class Jh extends mk{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=k=>{if(!this._subEmitters||0===this._subEmitters.length)return;const h=Math.floor(Math.random()*this._subEmitters.length);for(const o of this._subEmitters[h])if(1===o.type){const h=o.clone();k._inheritParticleInfoToSubEmitter(h),h.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(h.particleSystem),h.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(k,h){const o=Sk(k,h);return this.particleEmitterType=o,o}get flowMap(){return this._flowMap}set flowMap(k){this._flowMap!==k&&(this._flowMap=k,this._flowMapUpdate&&(vk(this._flowMapUpdate),this._flowMapUpdate=null),k&&(this._flowMapUpdate={process:k=>{var h;const o=null===(h=this.ik())||void 0===h?void 0:h.getTransformMatrix();this._flowMap._processParticle(k,this.flowMapStrength*this._tempScaledUpdateSpeed,o)},previousItem:null,nextItem:null},zk(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(k){this._attractors.push(k),1===this._attractors.length&&(this._attractorUpdate={process:k=>{for(const h of this._attractors)h._processParticle(k,this)},previousItem:null,nextItem:null},zk(this._attractorUpdate,this._directionProcessing))}removeAttractor(k){const h=this._attractors.indexOf(k);-1!==h&&this._attractors.splice(h,1),0===this._attractors.length&&vk(this._attractorUpdate)}start(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(k)}createHemisphericEmitter(){const k=Ck(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=k,k}createSphereEmitter(){const k=gk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=k,k}createDirectedSphereEmitter(){const k=ek(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.Vh(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.Vh(0,1,0));return this.particleEmitterType=k,k}createCylinderEmitter(){const k=uk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=k,k}createDirectedCylinderEmitter(){const k=kh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.Vh(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.Vh(0,1,0));return this.particleEmitterType=k,k}createConeEmitter(){const k=hh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=k,k}createDirectedConeEmitter(){const k=oh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.Vh(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.Vh(0,1,0));return this.particleEmitterType=k,k}createBoxEmitter(k,h,o,x){const I=new K;return this.particleEmitterType=I,this.direction1=k,this.direction2=h,this.minEmitBox=o,this.maxEmitBox=x,I}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const k of this.subEmitters)k instanceof Jh?this._subEmitters.push([new rk(k)]):k instanceof rk?this._subEmitters.push([k]):k instanceof Array&&this._subEmitters.push(k)}_stopSubEmitters(){if(this.activeSubSystems){for(const k of this.activeSubSystems)k.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const k=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==k&&this._rootParticleSystem.activeSubSystems.splice(k,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(k){k&&this._stopSubEmitters()}_prepareParticle(k){if(this._subEmitters&&this._subEmitters.length>0){const h=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];k._attachedSubEmitters=[];for(const o of h)if(0===o.type){const h=o.clone();k._attachedSubEmitters.push(h),h.particleSystem.start()}}}_onDispose(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),k&&this.particles)for(const o of this.particles)if(o._attachedSubEmitters)for(let k=o._attachedSubEmitters.length-1;k>=0;k-=1)o._attachedSubEmitters[k].dispose();if(h&&this.activeSubSystems)for(let o=this.activeSubSystems.length-1;o>=0;o-=1)this.activeSubSystems[o].dispose();if(this._subEmitters&&this._subEmitters.length){for(let k=0;k<this._subEmitters.length;k++)for(const h of this._subEmitters[k])h.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Ih&&this.Ih.dispose&&this.Ih.dispose(!0)}static _Parse(k,h,o,I){let q;q=o instanceof tk.e?null:o;const G=(0,J.e)("BABYLON.Texture");if(G&&q&&(k.texture?h.particleTexture=G.Parse(k.texture,q,I):k.textureName&&(h.particleTexture=new G(I+k.textureName,q,!1,void 0===k.invertY||k.invertY),h.particleTexture.name=k.textureName)),k.emitterId||0===k.emitterId||void 0!==k.Ih?k.emitterId&&q?h.Ih=q.getLastMeshById(k.emitterId):h.Ih=x.Vh.Uh(k.Ih):h.Ih=x.Vh.Zero(),h.isLocal=!!k.isLocal,void 0!==k.renderingGroupId&&(h.renderingGroupId=k.renderingGroupId),void 0!==k.isBillboardBased&&(h.isBillboardBased=k.isBillboardBased),void 0!==k.billboardMode&&(h.billboardMode=k.billboardMode),void 0!==k.useLogarithmicDepth&&(h.useLogarithmicDepth=k.useLogarithmicDepth),k.animations){for(let o=0;o<k.animations.length;o++){const x=k.animations[o],I=(0,J.e)("BABYLON.Animation");I&&h.animations.push(I.Parse(x))}h.beginAnimationOnStart=k.beginAnimationOnStart,h.beginAnimationFrom=k.beginAnimationFrom,h.beginAnimationTo=k.beginAnimationTo,h.beginAnimationLoop=k.beginAnimationLoop}if(k.autoAnimate&&q&&q.beginAnimation(h,k.autoAnimateFrom,k.autoAnimateTo,k.autoAnimateLoop,k.autoAnimateSpeed||1),h.startDelay=0|k.startDelay,h.minAngularSpeed=k.minAngularSpeed,h.maxAngularSpeed=k.maxAngularSpeed,h.minSize=k.minSize,h.maxSize=k.maxSize,k.minScaleX&&(h.minScaleX=k.minScaleX,h.maxScaleX=k.maxScaleX,h.minScaleY=k.minScaleY,h.maxScaleY=k.maxScaleY),void 0!==k.preWarmCycles&&(h.preWarmCycles=k.preWarmCycles,h.preWarmStepOffset=k.preWarmStepOffset),void 0!==k.minInitialRotation&&(h.minInitialRotation=k.minInitialRotation,h.maxInitialRotation=k.maxInitialRotation),h.minLifeTime=k.minLifeTime,h.maxLifeTime=k.maxLifeTime,h.minEmitPower=k.minEmitPower,h.maxEmitPower=k.maxEmitPower,h.emitRate=k.emitRate,h.gravity=x.Vh.Uh(k.gravity),k.noiseStrength&&(h.noiseStrength=x.Vh.Uh(k.noiseStrength)),h.color1=Y.RJ.Uh(k.color1),h.color2=Y.RJ.Uh(k.color2),h.colorDead=Y.RJ.Uh(k.colorDead),h.updateSpeed=k.updateSpeed,h.targetStopDuration=k.targetStopDuration,h.blendMode=k.blendMode,k.colorGradients)for(const x of k.colorGradients)h.addColorGradient(x.gradient,Y.RJ.Uh(x.color1),x.color2?Y.RJ.Uh(x.color2):void 0);if(k.rampGradients){for(const o of k.rampGradients)h.addRampGradient(o.gradient,Y.Zh.Uh(o.color));h.useRampGradients=k.useRampGradients}if(k.colorRemapGradients)for(const x of k.colorRemapGradients)h.addColorRemapGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.alphaRemapGradients)for(const x of k.alphaRemapGradients)h.addAlphaRemapGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.sizeGradients)for(const x of k.sizeGradients)h.addSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.angularSpeedGradients)for(const x of k.angularSpeedGradients)h.addAngularSpeedGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.velocityGradients)for(const x of k.velocityGradients)h.addVelocityGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.dragGradients)for(const x of k.dragGradients)h.addDragGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.emitRateGradients)for(const x of k.emitRateGradients)h.addEmitRateGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.startSizeGradients)for(const x of k.startSizeGradients)h.addStartSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.lifeTimeGradients)for(const x of k.lifeTimeGradients)h.addLifeTimeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(k.limitVelocityGradients){for(const o of k.limitVelocityGradients)h.addLimitVelocityGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);h.limitVelocityDamping=k.limitVelocityDamping}if(k.noiseTexture&&q){const o=(0,J.e)("BABYLON.ProceduralTexture");h.noiseTexture=o.Parse(k.noiseTexture,q,I)}let l;if(k.particleEmitterType){switch(k.particleEmitterType.type){case"SphereParticleEmitter":l=new M;break;case"SphereDirectedParticleEmitter":l=new T;break;case"ConeEmitter":case"ConeParticleEmitter":l=new a;break;case"ConeDirectedParticleEmitter":l=new N;break;case"CylinderParticleEmitter":l=new X;break;case"CylinderDirectedParticleEmitter":l=new c;break;case"HemisphericParticleEmitter":l=new W;break;case"PointParticleEmitter":l=new f;break;case"MeshParticleEmitter":l=new b;break;case"CustomParticleEmitter":l=new j;break;default:l=new K}l.parse(k.particleEmitterType,q)}else l=new K,l.parse(k,q);h.particleEmitterType=l,h.startSpriteCellID=k.startSpriteCellID,h.endSpriteCellID=k.endSpriteCellID,h.spriteCellLoop=k.spriteCellLoop??!0,h.spriteCellWidth=k.spriteCellWidth,h.spriteCellHeight=k.spriteCellHeight,h.spriteCellChangeSpeed=k.spriteCellChangeSpeed,h.spriteRandomStartCell=k.spriteRandomStartCell,h.disposeOnStop=k.disposeOnStop??!1,h.manualEmitCount=k.manualEmitCount??-1}static Parse(k,h,o){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0;const J=k.name;let G,l,A=null,K=null;if(h instanceof tk.e?G=h:(l=h,G=l.getEngine()),k.customShader&&G.createEffectForParticles){K=k.customShader;const h=K.shaderOptions.defines.length>0?K.shaderOptions.defines.join("\n"):"";A=G.createEffectForParticles(K.shaderPath.fragmentElement,K.shaderOptions.uniforms,K.shaderOptions.samplers,h)}const a=new Jh(J,q||k.oo,h,A,k.isAnimationSheetEnabled);if(a.customShader=K,a._rootUrl=o,k.id&&(a.id=k.id),k.subEmitters){a.subEmitters=[];for(const x of k.subEmitters){const k=[];for(const I of x)k.push(rk.Parse(I,h,o));a.subEmitters.push(k)}}if(k.attractors)for(const Y of k.attractors){const k=new Yh;k.position=x.Vh.Uh(Y.position),k.strength=Y.strength,a.addAttractor(k)}return Jh._Parse(k,a,h,o),k.textureMask&&(a.textureMask=Y.RJ.Uh(k.textureMask)),k.fl&&(a.fl=x.Vh.Uh(k.fl)),k.preventAutoStart&&(a.preventAutoStart=k.preventAutoStart),I||a.preventAutoStart||a.start(),a}serialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};if(Jh._Serialize(h,this,k),h.textureMask=this.textureMask.rh(),h.customShader=this.customShader,h.preventAutoStart=this.preventAutoStart,h.fl=this.fl.rh(),this.subEmitters){h.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const o of this._subEmitters){const x=[];for(const h of o)x.push(h.serialize(k));h.subEmitters.push(x)}}if(this._attractors&&this._attractors.length){h.attractors=[];for(const k of this._attractors)h.attractors.push(k.serialize())}return h}static _Serialize(k,h,o){if(k.name=h.name,k.id=h.id,k.oo=h.getCapacity(),k.disposeOnStop=h.disposeOnStop,k.manualEmitCount=h.manualEmitCount,h.Ih.position){const o=h.Ih;k.emitterId=o.id}else{const o=h.Ih;k.Ih=o.rh()}h.particleEmitterType&&(k.particleEmitterType=h.particleEmitterType.serialize()),h.particleTexture&&(o?k.texture=h.particleTexture.serialize():(k.textureName=h.particleTexture.name,k.invertY=!!h.particleTexture._invertY)),k.isLocal=h.isLocal,Q.c.AppendSerializedAnimations(h,k),k.beginAnimationOnStart=h.beginAnimationOnStart,k.beginAnimationFrom=h.beginAnimationFrom,k.beginAnimationTo=h.beginAnimationTo,k.beginAnimationLoop=h.beginAnimationLoop,k.startDelay=h.startDelay,k.renderingGroupId=h.renderingGroupId,k.isBillboardBased=h.isBillboardBased,k.billboardMode=h.billboardMode,k.minAngularSpeed=h.minAngularSpeed,k.maxAngularSpeed=h.maxAngularSpeed,k.minSize=h.minSize,k.maxSize=h.maxSize,k.minScaleX=h.minScaleX,k.maxScaleX=h.maxScaleX,k.minScaleY=h.minScaleY,k.maxScaleY=h.maxScaleY,k.minEmitPower=h.minEmitPower,k.maxEmitPower=h.maxEmitPower,k.minLifeTime=h.minLifeTime,k.maxLifeTime=h.maxLifeTime,k.emitRate=h.emitRate,k.gravity=h.gravity.rh(),k.noiseStrength=h.noiseStrength.rh(),k.color1=h.color1.rh(),k.color2=h.color2.rh(),k.colorDead=h.colorDead.rh(),k.updateSpeed=h.updateSpeed,k.targetStopDuration=h.targetStopDuration,k.blendMode=h.blendMode,k.preWarmCycles=h.preWarmCycles,k.preWarmStepOffset=h.preWarmStepOffset,k.minInitialRotation=h.minInitialRotation,k.maxInitialRotation=h.maxInitialRotation,k.startSpriteCellID=h.startSpriteCellID,k.spriteCellLoop=h.spriteCellLoop,k.endSpriteCellID=h.endSpriteCellID,k.spriteCellChangeSpeed=h.spriteCellChangeSpeed,k.spriteCellWidth=h.spriteCellWidth,k.spriteCellHeight=h.spriteCellHeight,k.spriteRandomStartCell=h.spriteRandomStartCell,k.isAnimationSheetEnabled=h.isAnimationSheetEnabled,k.useLogarithmicDepth=h.useLogarithmicDepth;const x=h.getColorGradients();if(x){k.colorGradients=[];for(const h of x){const o={gradient:h.gradient,color1:h.color1.rh()};h.color2?o.color2=h.color2.rh():o.color2=h.color1.rh(),k.colorGradients.push(o)}}const I=h.getRampGradients();if(I){k.rampGradients=[];for(const h of I){const o={gradient:h.gradient,color:h.color.rh()};k.rampGradients.push(o)}k.useRampGradients=h.useRampGradients}const q=h.getColorRemapGradients();if(q){k.colorRemapGradients=[];for(const h of q){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.colorRemapGradients.push(o)}}const Y=h.getAlphaRemapGradients();if(Y){k.alphaRemapGradients=[];for(const h of Y){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.alphaRemapGradients.push(o)}}const J=h.getSizeGradients();if(J){k.sizeGradients=[];for(const h of J){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.sizeGradients.push(o)}}const G=h.getAngularSpeedGradients();if(G){k.angularSpeedGradients=[];for(const h of G){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.angularSpeedGradients.push(o)}}const l=h.getVelocityGradients();if(l){k.velocityGradients=[];for(const h of l){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.velocityGradients.push(o)}}const A=h.getDragGradients();if(A){k.dragGradients=[];for(const h of A){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.dragGradients.push(o)}}const K=h.getEmitRateGradients();if(K){k.emitRateGradients=[];for(const h of K){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.emitRateGradients.push(o)}}const a=h.getStartSizeGradients();if(a){k.startSizeGradients=[];for(const h of a){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.startSizeGradients.push(o)}}const N=h.getLifeTimeGradients();if(N){k.lifeTimeGradients=[];for(const h of N){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.lifeTimeGradients.push(o)}}const X=h.getLimitVelocityGradients();if(X){k.limitVelocityGradients=[];for(const h of X){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,k.limitVelocityGradients.push(o)}k.limitVelocityDamping=h.limitVelocityDamping}h.noiseTexture&&(k.noiseTexture=h.noiseTexture.serialize())}clone(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x={...this._customWrappers};let I=null;const q=this._engine;if(q.createEffectForParticles&&null!=this.customShader){I=this.customShader;const k=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"",h=q.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,k);x[0]?x[0].effect=h:this.setCustomEffect(h,0)}const Y=this.serialize(o),J=Jh.Parse(Y,this._scene||this._engine,this._rootUrl);return J.name=k,J.customShader=I,J._customWrappers=x,void 0===h&&(h=this.Ih),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.Ih=h,this.preventAutoStart||J.start(),J}}Jh.BILLBOARDMODE_Y=2,Jh.BILLBOARDMODE_ALL=7,Jh.BILLBOARDMODE_STRETCHED=8,Jh.BILLBOARDMODE_STRETCHED_LOCAL=9,rk._ParseParticleSystem=Jh.Parse;var Gh=o(11479),lh=o(11472),Ah=o(11369);Ah.c.prototype.createTransformFeedback=function(){const k=this._gl.createTransformFeedback();if(!k)throw new Error("Unable to create Transform Feedback");return k},Ah.c.prototype.deleteTransformFeedback=function(k){this._gl.deleteTransformFeedback(k)},Ah.c.prototype.bindTransformFeedback=function(k){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,k)},Ah.c.prototype.beginTransformFeedback=function(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(k?this._gl.POINTS:this._gl.TRIANGLES)},Ah.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Ah.c.prototype.setTranformFeedbackVaryings=function(k,h){this._gl.transformFeedbackVaryings(k,h,this._gl.INTERLEAVED_ATTRIBS)},Ah.c.prototype.bindTransformFeedbackBuffer=function(k){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,k?k.underlyingResource:null)},Ah.c.prototype.readTransformFeedbackBuffer=function(k){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,k)};const Kh="clipPlaneFragmentDeclaration2",ah="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";i.b.IncludesShadersStore[Kh]||(i.b.IncludesShadersStore[Kh]=ah);o(12566),o(12571),o(12575),o(12580),o(12583),o(12587),o(12591),o(12598);const Nh="gpuRenderParticlesPixelShader",Xh="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";i.b.ShadersStore[Nh]||(i.b.ShadersStore[Nh]=Xh);const ch="clipPlaneVertexDeclaration2",Wh="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";i.b.IncludesShadersStore[ch]||(i.b.IncludesShadersStore[ch]=Wh);o(12602),o(12611),o(12614),o(12619);const fh="gpuRenderParticlesVertexShader",Mh="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";i.b.ShadersStore[fh]||(i.b.ShadersStore[fh]=Mh);class Th extends G{static get IsSupported(){if(!e.b.LastCreatedEngine)return!1;const k=e.b.LastCreatedEngine.getCaps();return k.supportTransformFeedbacks||k.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(k){this._maxActiveParticleCount=Math.min(k,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(k){this.maxActiveParticleCount=k}createPointEmitter(k,h){const o=Sk(k,h);return this.particleEmitterType=o,o}createHemisphericEmitter(){const k=Ck(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=k,k}createSphereEmitter(){const k=gk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=k,k}createDirectedSphereEmitter(){const k=ek(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x.Vh(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.Vh(0,1,0));return this.particleEmitterType=k,k}createCylinderEmitter(){const k=uk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=k,k}createDirectedCylinderEmitter(){const k=kh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.Vh(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x.Vh(0,1,0));return this.particleEmitterType=k,k}createConeEmitter(){const k=hh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=k,k}createDirectedConeEmitter(){const k=oh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new x.Vh(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x.Vh(0,1,0));return this.particleEmitterType=k,k}createBoxEmitter(k,h,o,x){const I=new K;return this.particleEmitterType=I,this.direction1=k,this.direction2=h,this.minEmitBox=o,this.maxEmitBox=x,I}get flowMap(){return this._flowMap}set flowMap(k){this._flowMap!==k&&(this._flowMap=k)}isReady(){if(!this.Ih||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Jh.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Jh.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Jh.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";k?setTimeout((()=>{this.start(0)}),k):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var k;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(k=this._customWrappers[h])||void 0===k?void 0:k.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[k]??this._customWrappers[0]}setCustomEffect(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[h]=new kk.e(this._engine),this._customWrappers[h].effect=k}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(k,h,o){return super._removeGradientAndTexture(k,h,o),this._releaseBuffers(),this}addColorGradient(k,h){this._colorGradients||(this._colorGradients=[]);const o=new P(k,h);return this._colorGradients.push(o),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(k&&this._colorGradients.sort(((k,h)=>k.gradient<h.gradient?-1:k.gradient>h.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(k){return this._removeGradientAndTexture(k,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const h in this._drawWrappers){var k;null===(k=this._drawWrappers[h].drawContext)||void 0===k||k.reset()}}_addFactorGradient(k,h,o){const x=new t(h,o);k.push(x),this._releaseBuffers()}addSizeGradient(k,h){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,k,h),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(k){return this._removeGradientAndTexture(k,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(k,h){if(!k)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&k.sort(((k,h)=>k.gradient<h.gradient?-1:k.gradient>h.gradient?1:0));const o=this;o[h]&&(o[h].dispose(),o[h]=null)}addAngularSpeedGradient(k,h){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,k,h),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(k){return this._removeGradientAndTexture(k,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(k,h){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,k,h),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(k){return this._removeGradientAndTexture(k,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(k,h){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,k,h),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(k){return this._removeGradientAndTexture(k,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(k,h){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,k,h),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(k){return this._removeGradientAndTexture(k,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(k){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(k,h,o){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(k),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.sh=new C.d,this.onStoppedObservable=new C.d,this.onStartedObservable=new C.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,o&&"Scene"!==o.getClassName()?(this._engine=o,this.defaultProjectionMatrix=x.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=o||e.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ka.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,J.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,J.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new kk.e(this._engine)},this._customWrappers[0].effect=I,this._drawWrappers={0:new kk.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(h=h??{}).randomTextureSize||delete h.randomTextureSize;const Y={oo:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...h},G=h;isFinite(G)&&(Y.oo=G),this._capacity=Y.oo,this._maxActiveParticleCount=Y.oo,this._currentActiveCount=0,this._isAnimationSheetEnabled=q,this.particleEmitterType=new K;const l=Math.min(this._engine.getCaps().maxTextureSize,Y.randomTextureSize);let A=[];for(let x=0;x<l;++x)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture=new g.c(new Float32Array(A),l,1,5,o,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,A=[];for(let x=0;x<l;++x)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture2=new g.c(new Float32Array(A),l,1,5,o,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=l}_reset(){this._releaseBuffers()}_createVertexBuffers(k,h,o){const x={};x.position=h.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let I=3;x.age=h.createVertexBuffer("age",I,1,this._attributesStrideSize,!0),I+=1,x.size=h.createVertexBuffer("size",I,3,this._attributesStrideSize,!0),I+=3,x.life=h.createVertexBuffer("life",I,1,this._attributesStrideSize,!0),I+=1,I+=4,this.billboardMode===Jh.BILLBOARDMODE_STRETCHED&&(x.direction=h.createVertexBuffer("direction",I,3,this._attributesStrideSize,!0)),I+=3,this._platform.alignDataInBuffer&&(I+=1),this.particleEmitterType instanceof j&&(I+=3,this._platform.alignDataInBuffer&&(I+=1)),this._colorGradientsTexture||(x.color=h.createVertexBuffer("color",I,4,this._attributesStrideSize,!0),I+=4),this._isBillboardBased||(x.initialDirection=h.createVertexBuffer("initialDirection",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1)),this.noiseTexture&&(x.noiseCoordinates1=h.createVertexBuffer("noiseCoordinates1",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1),x.noiseCoordinates2=h.createVertexBuffer("noiseCoordinates2",I,3,this._attributesStrideSize,!0),I+=3,this._platform.alignDataInBuffer&&(I+=1)),x.angle=h.createVertexBuffer("angle",I,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?I++:I+=2,this._isAnimationSheetEnabled&&(x.cellIndex=h.createVertexBuffer("cellIndex",I,1,this._attributesStrideSize,!0),I+=1,this.spriteRandomStartCell&&(x.cellStartOffset=h.createVertexBuffer("cellStartOffset",I,1,this._attributesStrideSize,!0),I+=1)),x.offset=o.createVertexBuffer("offset",0,2),x.uv=o.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(x),this._platform.createVertexBuffers(k,x),this.resetDrawCache()}_initialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!k)return;const h=this._engine,o=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof j&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const I=this.particleEmitterType instanceof j,q=x.TmpVectors.Vh[0];let Y=0;for(let x=0;x<this._capacity;x++)if(o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),I?(this.particleEmitterType.particleDestinationGenerator(x,null,q),o.push(q.x),o.push(q.y),o.push(q.z)):(o.push(0),o.push(0),o.push(0)),this._platform.alignDataInBuffer&&o.push(0),Y+=16,I&&(this.particleEmitterType.particlePositionGenerator(x,null,q),o.push(q.x),o.push(q.y),o.push(q.z),this._platform.alignDataInBuffer&&o.push(0),Y+=4),this._colorGradientsTexture||(o.push(0),o.push(0),o.push(0),o.push(0),Y+=4),this.isBillboardBased||(o.push(0),o.push(0),o.push(0),this._platform.alignDataInBuffer&&o.push(0),Y+=4),this.noiseTexture&&(o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),this._platform.alignDataInBuffer&&o.push(0),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),this._platform.alignDataInBuffer&&o.push(0),Y+=8),o.push(0),Y+=1,this._angularSpeedGradientsTexture||(o.push(0),Y+=1),this._isAnimationSheetEnabled&&(o.push(0),Y+=1,this.spriteRandomStartCell&&(o.push(0),Y+=1)),this._platform.alignDataInBuffer){let k=3-(Y+3&3);for(Y+=k;k-- >0;)o.push(0)}const J=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),G=this._platform.createParticleBuffer(o),l=this._platform.createParticleBuffer(o);this._buffer0=new d.d(h,G,!1,this._attributesStrideSize),this._buffer1=new d.d(h,l,!1,this._attributesStrideSize),this._spriteBuffer=new d.d(h,J,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let k=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(k+="\n#define BILLBOARD"),this._colorGradientsTexture&&(k+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(k+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(k+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(k+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(k+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(k+="\n#define DRAGGRADIENTS"),this._flowMap&&(k+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(k+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(k+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(k+="\n#define NOISE"),this.isLocal&&(k+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===k||(this._cachedUpdateDefines=k,this._updateBuffer=this._platform.createUpdateBuffer(k)),this._platform.isUpdateBufferReady()}_getWrapper(k){const h=this._getCustomDrawWrapper(k);if(null!==h&&void 0!==h&&h.effect)return h;const o=[];this.fillDefines(o,k);let x=this._drawWrappers[k];x||(x=new kk.e(this._engine),x.drawContext&&(x.drawContext.useInstancing=!0),this._drawWrappers[k]=x);const I=o.join("\n");if(x.defines!==I){const k=[],h=[],o=[];this.fillUniformsAttributesAndSamplerNames(h,k,o),x.setEffect(this._engine.createEffect("gpuRenderParticles",k,h,o,I),I)}return x}static _GetAttributeNamesOrOptions(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=[d.g.PositionKind,"age","life","size","angle"];return k||I.push(d.g.ColorKind),h&&I.push("cellIndex"),o||I.push("initialDirection"),x&&I.push("direction"),I.push("offset",d.g.UVKind),I}static _GetEffectCreationOptions(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=["emitterWM","fl","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,hk.c)(x),k&&x.push("sheetInfos"),h&&x.push("logarithmicDepthConstant"),o&&(x.push("vFogInfos"),x.push("vFogColor")),x}fillDefines(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,hk.n)(this,this._scene,k),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==lh.e.FOGMODE_NONE&&k.push("#define FOG")),h===Jh.BLENDMODE_MULTIPLY&&k.push("#define BLENDMULTIPLYMODE"),this.isLocal&&k.push("#define LOCAL"),this.useLogarithmicDepth&&k.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(k.push("#define BILLBOARD"),this.billboardMode){case Jh.BILLBOARDMODE_Y:k.push("#define BILLBOARDY");break;case Jh.BILLBOARDMODE_STRETCHED:k.push("#define BILLBOARDSTRETCHED");break;case Jh.BILLBOARDMODE_ALL:k.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&k.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&k.push("#define ANIMATESHEET"),o&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),k.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(k,h,o){h.push(...Th._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Jh.BILLBOARDMODE_STRETCHED)),k.push(...Th._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),o.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Gh.c.PrepareUniforms(k,this._imageProcessingConfigurationDefines),Gh.c.PrepareSamplers(o,this._imageProcessingConfigurationDefines))}animate(){var k;let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(h?this.preWarmStepOffset:(null===(k=this._scene)||void 0===k?void 0:k.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(k,h){const o=this[h];if(!k||!k.length||o)return;const x=new Float32Array(this._rawTextureWidth);for(let I=0;I<this._rawTextureWidth;I++){const h=I/this._rawTextureWidth;S.GetCurrentGradient(h,k,((k,h,o)=>{x[I]=(0,l.Lerp)(k.factor1,h.factor1,o)}))}this[h]=g.c.CreateRTexture(x,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[h].name=h.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const k=new Uint8Array(4*this._rawTextureWidth),h=Y.TmpColors.RJ[0];for(let o=0;o<this._rawTextureWidth;o++){const x=o/this._rawTextureWidth;S.GetCurrentGradient(x,this._colorGradients,((x,I,q)=>{Y.RJ.LerpToRef(x.color1,I.color1,q,h),k[4*o]=255*h.r,k[4*o+1]=255*h.g,k[4*o+2]=255*h.b,k[4*o+3]=255*h.a}))}this._colorGradientsTexture=g.c.CreateRGBATexture(k,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(k,h){var o,I,q,Y;const J=this._getWrapper(k),G=J.effect;this._engine.enableEffect(J);const l=(null===(o=this._scene)||void 0===o?void 0:o.getViewMatrix())||x.Matrix.IdentityReadOnly;if(G.setMatrix("view",l),G.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),G.setTexture("diffuseSampler",this.particleTexture),G.setVector2("translationPivot",this.translationPivot),G.setVector3("fl",this.fl),this.isLocal&&G.setMatrix("emitterWM",h),this._colorGradientsTexture?G.setTexture("colorGradientSampler",this._colorGradientsTexture):G.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const k=this.particleTexture.getBaseSize();G.setFloat3("sheetInfos",this.spriteCellWidth/k.width,this.spriteCellHeight/k.height,k.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const k=this._scene.activeCamera;G.setVector3("eyePosition",k.globalPosition)}const A=G.defines;if(this._scene&&((0,hk.g)(G,this,this._scene),this.applyFog&&(0,ok.f)(this._scene,void 0,G)),A.indexOf("#define BILLBOARDMODE_ALL")>=0){const k=l.clone();k.invert(),G.setMatrix("invView",k)}return this.useLogarithmicDepth&&this._scene&&(0,ok.j)(A,G,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(G),this._setEngineBasedOnBlendMode(k),this._platform.bindDrawBuffers(this._targetIndex,G,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(G),null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(k){if(!this.Ih||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!k)if(this.Ih.position){k=this.Ih.getWorldMatrix()}else{const h=this.Ih;k=x.TmpVectors.Matrix[0],x.Matrix.TranslationToRef(h.x,h.y,h.z,k)}const h=this._engine,o=h.getDepthWrite();if(h.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const k=this.ik();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",k.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",k),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const I=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=I,h.setDepthWrite(o)}render(){let k,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!h&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let k=0;k<this.preWarmCycles;k++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const k=0|this._accumulatedCount;this._accumulatedCount-=k,this._currentActiveCount+=k}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Ih.position){k=this.Ih.getWorldMatrix()}else{const h=this.Ih;k=x.TmpVectors.Matrix[0],x.Matrix.TranslationToRef(h.x,h.y,h.z,k)}const I=this._engine;this.updateInAnimate||this._update(k);let q=0;return h||o||(I.setState(!1),this.forceDepthWrite&&I.setDepthWrite(!0),q=this.blendMode===Jh.BLENDMODE_MULTIPLYADD?this._render(Jh.BLENDMODE_MULTIPLY,k)+this._render(Jh.BLENDMODE_ADD,k):this._render(this.blendMode,k),this._engine.setAlphaMode(0)),q}rebuild(){const k=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(k,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,k()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const h in this._drawWrappers){this._drawWrappers[h].dispose()}if(this._drawWrappers={},this._scene){const k=this._scene.ka.indexOf(this);k>-1&&this._scene.ka.splice(k,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let h=0;h<this._renderVertexBuffers.length;++h){const k=this._renderVertexBuffers[h];for(const h in k)k[h].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),k&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),k&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.sh.notifyObservers(this),this.sh.clear()}clone(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x={...this._customWrappers};let I=null;const q=this._engine;if(q.createEffectForParticles&&null!=this.customShader){I=this.customShader;const k=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"";x[0]=q.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,k,void 0,void 0,void 0,this)}const Y=this.serialize(o),J=Th.Parse(Y,this._scene||this._engine,this._rootUrl);return J.name=k,J.customShader=I,J._customWrappers=x,void 0===h&&(h=this.Ih),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.Ih=h,J}serialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};return Jh._Serialize(h,this,k),h.activeParticleCount=this.activeParticleCount,h.randomTextureSize=this._randomTextureSize,h.customShader=this.customShader,h}static Parse(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0;const q=k.name;let Y,J;h instanceof tk.e?Y=h:(J=h,Y=J.getEngine());const G=new Th(q,{oo:I||k.oo,randomTextureSize:k.randomTextureSize},h,null,k.isAnimationSheetEnabled);if(G._rootUrl=o,k.customShader&&Y.createEffectForParticles){const h=k.customShader,o=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"",x=Y.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,o,void 0,void 0,void 0,G);G.setCustomEffect(x,0),G.customShader=h}return k.id&&(G.id=k.id),k.activeParticleCount&&(G.activeParticleCount=k.activeParticleCount),Jh._Parse(k,G,h,o),k.preventAutoStart&&(G.preventAutoStart=k.preventAutoStart),x||G.preventAutoStart||G.start(),G}}var jh=o(11078),dh=o(12622),bh=o(11610);class Vh{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(k){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const h of this.systems)h.Ih=k;this._emitterNode=k}setEmitterAsSphere(k,h,o){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:k,renderingGroupId:h};const x=(0,dh.d)("emitterSphere",{diameter:k.diameter,segments:k.segments},o);x.renderingGroupId=h;const I=new bh.Rh("emitterSphereMaterial",o);I.emissiveColor=k.color,x.material=I;for(const q of this.systems)q.Ih=x;this._emitterNode=x}start(k){for(const h of this.systems)k&&(h.Ih=k),h.start()}dispose(){for(const k of this.systems)k.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={systems:[]};for(const o of this.systems)h.systems.push(o.serialize(k));return this._emitterNode&&(h.Ih=this._emitterCreationOptions),h}static Parse(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;const I=new Vh,q=this.BaseAssetsUrl+"/textures/";h=h||e.b.LastCreatedScene;for(const Y of k.systems)I.systems.push(o?Th.Parse(Y,h,q,!0,x):Jh.Parse(Y,h,q,!0,x));if(k.Ih){const o=k.Ih.options;if("Sphere"===k.Ih.kind)I.setEmitterAsSphere({diameter:o.diameter,segments:o.segments,color:Y.Zh.Uh(o.color)},k.Ih.renderingGroupId,h)}return I}}Vh.BaseAssetsUrl="https://assets.babylonjs.com/particles";var ih=o(11112);class Fh{static CreateDefault(k){let h,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,x=arguments.length>2?arguments[2]:void 0;h=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Th("default system",{oo:o},x):new Jh("default system",o,x),h.Ih=k;const I=jh.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return h.particleTexture=new B.b(I,h.ik()),h.createConeEmitter(.1,Math.PI/4),h.color1=new Y.RJ(1,1,1,1),h.color2=new Y.RJ(1,1,1,1),h.colorDead=new Y.RJ(1,1,1,0),h.minSize=.1,h.maxSize=.1,h.minEmitPower=2,h.maxEmitPower=2,h.updateSpeed=1/60,h.emitRate=30,h}static CreateAsync(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;h||(h=e.b.LastCreatedScene);const I={};return h.addPendingData(I),new Promise(((q,Y)=>{if(o&&!Th.IsSupported)return h.removePendingData(I),Y("Particle system with GPU is not supported.");jh.Tools.LoadFile(`${Fh.BaseAssetsUrl}/systems/${k}.json`,(k=>{h.removePendingData(I);const Y=JSON.parse(k.toString());return q(Vh.Parse(Y,h,o,x))}),void 0,void 0,void 0,(()=>(h.removePendingData(I),Y(`An error occurred with the creation of your particle system. Check if your type '${k}' exists.`))))}))}static ExportSet(k){const h=new Vh;for(const o of k)h.systems.push(o);return h}static ParseFromFileAsync(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",q=arguments.length>5?arguments[5]:void 0;return new Promise(((Y,J)=>{const G=new ih.e;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const h=JSON.parse(G.responseText);let J;J=x?Th.Parse(h,o,I,!1,q):Jh.Parse(h,o,I,!1,q),k&&(J.name=k),Y(J)}else J("Unable to load the particle system")})),G.open("GET",h),G.send()}))}static ParseFromSnippetAsync(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",I=arguments.length>4?arguments[4]:void 0;if("_BLANK"===k){const k=this.CreateDefault(null);return k.start(),Promise.resolve(k)}return new Promise(((q,Y)=>{const J=new ih.e;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const Y=JSON.parse(JSON.parse(J.responseText).jsonPayload),G=JSON.parse(Y.particleSystem);let l;l=o?Th.Parse(G,h,x,!1,I):Jh.Parse(G,h,x,!1,I),l.snippetId=k,q(l)}else Y("Unable to load the snippet "+k)})),J.open("GET",this.SnippetUrl+"/"+k.replace(/#/g,"/")),J.send()}))}}Fh.BaseAssetsUrl=Vh.BaseAssetsUrl,Fh.SnippetUrl="https://snippet.babylonjs.com",Fh.CreateFromSnippetAsync=Fh.ParseFromSnippetAsync;var Rh=o(11696),sh=o(11505),Zh=o(12625);(0,Zh.f)(sh.e.NAME_PARTICLESYSTEM,((k,h,o,x)=>{const I=(0,Zh.g)(sh.e.NAME_PARTICLESYSTEM);if(I&&void 0!==k.ka&&null!==k.ka)for(let q=0,Y=k.ka.length;q<Y;q++){const Y=k.ka[q];o.ka.push(I(Y,h,x))}})),(0,Zh.e)(sh.e.NAME_PARTICLESYSTEM,((k,h,o)=>{if(k.activeParticleCount){return Th.Parse(k,h,o)}return Jh.Parse(k,h,o)})),tk.e.prototype.createEffectForParticles=function(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",q=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,G=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>9?arguments[9]:void 0,K=[],a=[];const N=[];return G?G.fillUniformsAttributesAndSamplerNames(a,K,N):(K=Jh._GetAttributeNamesOrOptions(),a=Jh._GetEffectCreationOptions()),-1===I.indexOf(" BILLBOARD")&&(I+="\n#define BILLBOARD\n"),null!==G&&void 0!==G&&G.isAnimationSheetEnabled&&-1===I.indexOf(" ANIMATESHEET")&&(I+="\n#define ANIMATESHEET\n"),-1===x.indexOf("diffuseSampler")&&x.push("diffuseSampler"),this.createEffect({vertex:A??(null===G||void 0===G?void 0:G.vertexShaderName)??"particles",fragmentElement:k},K,a.concat(h),N.concat(x),I,q,Y,J,void 0,l,(async()=>{0===l?await Promise.resolve().then(o.bind(o,12668)):await Promise.resolve().then(o.bind(o,12736))}))},Rh.e.prototype.getEmittedParticleSystems=function(){const k=[];for(let h=0;h<this.ik().ka.length;h++){const o=this.ik().ka[h];o.Ih===this&&k.push(o)}return k},Rh.e.prototype.getHierarchyEmittedParticleSystems=function(){const k=[],h=this.getDescendants();h.push(this);for(let o=0;o<this.ik().ka.length;o++){const x=this.ik().ka[o],I=x.Ih;I.position&&-1!==h.indexOf(I)&&k.push(x)}return k};o(11565),o(11576),o(11663);o(11672),o(12631),o(11438),o(11554),o(11718);o(11431);var wh;o(12635),o(11266);!function(k){k[k.Color=2]="Color",k[k.UV=1]="UV",k[k.Random=0]="Random",k[k.Stated=3]="Stated"}(wh||(wh={}));var Dh=o(11461);const Uh=new x.Vh(0,0,0),Qh=new x.Vh(0,0,0),Bh=new x.Vh(0,0,0);class Eh{constructor(k,h,o){this.width=k,this.height=h,this.data=o}processFlowable(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;if(!o)return;o instanceof x.Matrix?x.Vh.TransformCoordinatesToRef(k.position,o,Bh):(Bh.x=o.x,Bh.y=o.y,Bh.z=o.z);const I=.5*Bh.x+.5,q=1-(.5*Bh.y+.5),Y=Math.floor(I*this.width),J=Math.floor(q*this.height);if(Y<0||Y>=this.width||J<0||J>=this.height)return;const G=4*(J*this.width+Y),l=this.data[G]/255*2-1,A=this.data[G+1]/255*2-1,K=this.data[G+2]/255*2-1,a=this.data[G+3]/255;Uh.set(l,A,K),Uh.scaleToRef(h*a,Qh),k.direction.addInPlace(Qh)}_processParticle(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;this.processFlowable(k,h,o)}static async FromUrlAsync(k){return await new Promise(((h,o)=>{const x=document.createElement("canvas"),I=x.getContext("2d");let q=null;const Y=new Image;Y.crossOrigin="anonymous",Y.src=k,Y.onerror=h=>{o(new Error(`Failed to load image: ${k} : ${h}`))},Y.onload=()=>{x.width=Y.width,x.height=Y.height,I.drawImage(Y,0,0),q=I.getImageData(0,0,x.width,x.height),h(new Eh(x.width,x.height,q.data))}}))}static async ExtractFromTextureAsync(k){return await new Promise(((h,o)=>{if(!k.isReady())return void k.onLoadObservable.addOnce((async()=>{try{const o=await this.ExtractFromTextureAsync(k);h(o)}catch(x){o(x)}}));const x=k.getSize();Dh.k.GetTextureDataAsync(k,x.width,x.height).then((k=>{h(new Eh(x.width,x.height,new Uint8ClampedArray(k)))})).catch(o)}))}}var nh,Hh,yh,Oh,zh,ph,vh,mh,Lh;!function(k){k[k.Int=1]="Int",k[k.Float=2]="Float",k[k.Vector2=4]="Vector2",k[k.Vh=8]="Vh",k[k.Matrix=16]="Matrix",k[k.Particle=32]="Particle",k[k.Texture=64]="Texture",k[k.RJ=128]="RJ",k[k.FloatGradient=256]="FloatGradient",k[k.Vector2Gradient=512]="Vector2Gradient",k[k.Vector3Gradient=1024]="Vector3Gradient",k[k.Color4Gradient=2048]="Color4Gradient",k[k.System=4096]="System",k[k.AutoDetect=8192]="AutoDetect",k[k.BasedOnInput=16384]="BasedOnInput",k[k.Undefined=32768]="Undefined",k[k.All=65535]="All"}(nh||(nh={})),function(k){k[k.Compatible=0]="Compatible",k[k.TypeIncompatible=1]="TypeIncompatible",k[k.HierarchyIssue=2]="HierarchyIssue"}(Hh||(Hh={})),function(k){k[k.Input=0]="Input",k[k.Output=1]="Output"}(yh||(yh={}));class Ph{get direction(){return this._direction}get type(){if(this._type===nh.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===nh.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(k){this._type=k}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((k=>k.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(k,h,o){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=nh.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new C.d,this.onDisconnectionObservable=new C.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=h,this.name=k,this._direction=o}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(k){var h;return this.isConnected?null!==(h=this._connectedPoint)&&void 0!==h&&h._storedFunction?this._connectedPoint._storedFunction(k):this._connectedPoint._storedValue:this.value}canConnectTo(k){return 0===this.checkCompatibilityState(k)}checkCompatibilityState(k){const h=this._ownerBlock,o=k.ownerBlock;if(this.type!==k.type&&k.innerType!==nh.AutoDetect)return k.acceptedConnectionPointTypes&&-1!==k.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(k.excludedConnectionPointTypes&&-1!==k.excludedConnectionPointTypes.indexOf(this.type))return 1;let x=o,I=h;return 0===this.direction&&(x=h,I=o),x.isAnAncestorOf(I)?2:0}connectTo(k){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(k))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${k.ownerBlock.name}".${k.name}`;return this._endpoints.push(k),k._connectedPoint=this,this.onConnectionObservable.notifyObservers(k),k.onConnectionObservable.notifyObservers(this),this}disconnectFrom(k){const h=this._endpoints.indexOf(k);return-1===h||(this._endpoints.splice(h,1),k._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(k),k.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(k){let h=1;for(;h<nh.All;)k&h||this.excludedConnectionPointTypes.push(h),h<<=1}serialize(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const h={};return h.name=this.name,h.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.rh?(h.valueType="BABYLON."+this.value.getClassName(),h.value=this.value.rh()):(h.valueType="number",h.value=this.value)),k&&this.connectedPoint&&(h.inputName=this.name,h.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,h.targetConnectionName=this.connectedPoint.name,h.isExposedOnFrame=!0,h.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(h.isExposedOnFrame=!0,h.exposedPortPosition=this.exposedPortPosition),h}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class rh{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(k){this._name=k}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(k){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new C.d,this.sh=new C.d,this.onInputChangedObservable=new C.d,this.visibleOnFrame=!1,this._name=k,this.uniqueId=E.c.UniqueId}_inputRename(k){return k}_outputRename(k){return k}isAnAncestorOf(k){for(const h of this._outputs)if(h.hasEndpoints)for(const o of h.endpoints){if(o.ownerBlock===k)return!0;if(o.ownerBlock.isAnAncestorOf(k))return!0}return!1}isAnAncestorOfType(k){if(this.getClassName()===k)return!0;for(const h of this._outputs)if(h.hasEndpoints)for(const o of h.endpoints)if(o.ownerBlock.isAnAncestorOfType(k))return!0;return!1}getInputByName(k){const h=this._inputs.filter((h=>h.name===k));return h.length?h[0]:null}_linkConnectionTypes(k,h){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[h]._acceptedConnectionPointType=this._inputs[k]:(this._inputs[k]._linkedConnectionSource=this._inputs[h],this._inputs[k]._isMainLinkSource=!0),this._inputs[h]._linkedConnectionSource=this._inputs[k]}registerInput(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0;const Y=new Ph(k,this,0);return Y.type=h,Y.isOptional=o,Y.defaultValue=x,Y.value=x,Y.valueMin=I,Y.valueMax=q,this._inputs.push(Y),this.onInputChangedObservable.notifyObservers(Y),this}registerOutput(k,h,o){return(o=o??new Ph(k,this,1)).type=h,this._outputs.push(o),this}_build(k){}_customBuildStep(k){}build(k){if(this._buildId===k.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((k=>k.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=k.buildId;for(const h of this._inputs){if(!h.connectedPoint){h.isOptional||k.notConnectedNonOptionalInputs.push(h);continue}const o=h.connectedPoint.ownerBlock;o&&o!==this&&!o.isSystem&&o.build(k)}return this._customBuildStep(k),k.verbose&&n.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(k),this.onBuildObservable.notifyObservers(this),!1}serialize(){const k={};k.customType="BABYLON."+this.getClassName(),k.id=this.uniqueId,k.name=this.name,k.visibleOnFrame=this.visibleOnFrame,k.inputs=[],k.outputs=[];for(const h of this.inputs)k.inputs.push(h.serialize());for(const h of this.outputs)k.outputs.push(h.serialize(!1));return k}_deserialize(k){this._name=k.name,this.comments=k.comments,this.visibleOnFrame=!!k.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(k)}_deserializePortDisplayNamesAndExposedOnFrame(k){const h=k.inputs,o=k.outputs;if(h)for(const x of h){const k=this.inputs.find((k=>k.name===x.name));if(!k)return;if(x.displayName&&(k.displayName=x.displayName),x.isExposedOnFrame&&(k.isExposedOnFrame=x.isExposedOnFrame,k.exposedPortPosition=x.exposedPortPosition),void 0!==x.value&&null!==x.value)if("number"===x.valueType)k.value=x.value;else{const h=(0,J.e)(x.valueType);h&&(k.value=h.Uh(x.value))}}if(o)for(let x=0;x<o.length;x++){const k=o[x];k.displayName&&(this.outputs[x].displayName=k.displayName),k.isExposedOnFrame&&(this.outputs[x].isExposedOnFrame=k.isExposedOnFrame,this.outputs[x].exposedPortPosition=k.exposedPortPosition)}}clone(){const k=this.serialize(),h=(0,J.e)(k.customType);if(h){const o=new h;return o._deserialize(k),o}return null}dispose(){this.sh.notifyObservers(this),this.sh.clear();for(const k of this.inputs)k.dispose();for(const k of this.outputs)k.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function th(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",x=arguments.length>3?arguments[3]:void 0;return(I,q)=>{let Y=I._propStore;Y||(Y=[],I._propStore=Y),Y.push({propertyName:q,displayName:k,type:h,groupName:o,options:x??{},className:I.getClassName()})}}(0,D.d)([(0,U.E)("comment")],rh.prototype,"comments",void 0),function(k){k[k.Boolean=0]="Boolean",k[k.Float=1]="Float",k[k.Int=2]="Int",k[k.Vector2=3]="Vector2",k[k.List=4]="List",k[k.RJ=5]="RJ",k[k.SamplingMode=6]="SamplingMode",k[k.TextureFormat=7]="TextureFormat",k[k.TextureType=8]="TextureType"}(Oh||(Oh={})),function(k){k[k.None=0]="None",k[k.Position=1]="Position",k[k.Direction=2]="Direction",k[k.Age=3]="Age",k[k.Lifetime=4]="Lifetime",k[k.Color=5]="Color",k[k.ScaledDirection=6]="ScaledDirection",k[k.Scale=7]="Scale",k[k.AgeGradient=8]="AgeGradient",k[k.Angle=9]="Angle",k[k.SpriteCellIndex=16]="SpriteCellIndex",k[k.SpriteCellStart=17]="SpriteCellStart",k[k.SpriteCellEnd=18]="SpriteCellEnd"}(zh||(zh={})),function(k){k[k.None=0]="None",k[k.Time=1]="Time",k[k.Delta=2]="Delta",k[k.Emitter=3]="Emitter"}(ph||(ph={}));class Sh{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let k="";for(const h of this.notConnectedNonOptionalInputs)k+=`input ${h.name} from block ${h.ownerBlock.name}[${h.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(k)throw"Build of Node Particle System Set failed:\n"+k}adapt(k,h){const o=k.getConnectedValue(this)||0;if(k.type===h)return o;switch(h){case nh.Vector2:return new x.Vector2(o,o);case nh.Vh:return new x.Vh(o,o,o);case nh.RJ:return new Y.RJ(o,o,o,o)}return null}getContextualValue(k){if(!this.particleContext||!this.systemContext)return null;switch(k){case zh.Position:return this.particleContext.position;case zh.Direction:return this.particleContext.direction;case zh.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case zh.Color:return this.particleContext.color;case zh.Age:return this.particleContext.age;case zh.Lifetime:return this.particleContext.lifeTime;case zh.Angle:return this.particleContext.angle;case zh.Scale:return this.particleContext.scale;case zh.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case zh.SpriteCellEnd:return this.systemContext.endSpriteCellID;case zh.SpriteCellIndex:return this.particleContext.cellIndex;case zh.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Ih.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Ih.absolutePosition:this.systemContext.Ih:null}getSystemValue(k){if(!this.particleContext||!this.systemContext)return null;switch(k){case ph.Time:return this.systemContext._actualFrame;case ph.Delta:return this.systemContext._scaledUpdateSpeed;case ph.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Ih.absolutePosition}return this.systemContext.Ih}return null}}function Ch(k,h,o){const x=new Sh;x.Fh=h;const I=k.createSystem(x);return I.canStart=()=>!0,I.Ih=o.clone(),I.disposeOnStop=!0,I.start(),I}class gh extends rh{constructor(k){super(k),this.blendMode=G.BLENDMODE_ONEONE,this.oo=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",nh.Particle),this.registerInput("texture",nh.Texture),this.registerInput("onStart",nh.System,!0),this.registerInput("onEnd",nh.System,!0),this.registerOutput("system",nh.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(k){k.oo=this.oo,k.buildId=this._buildId++,this.build(k);const h=this.particle.getConnectedValue(k);return h.particleTexture=this.texture.getConnectedValue(k),h.emitRate=this.emitRate,h.blendMode=this.blendMode,h.name=this.name,h._nodeGenerated=!0,h._targetStopDuration=this.targetStopDuration,h.startDelay=this.startDelay,this.system._storedValue=this,h.canStart=()=>!this.doNoStart,h.onStartedObservable.add((o=>{const x=this.onStart.getConnectedValue(k);x&&o.onStartedObservable.addOnce((()=>{k.systemContext=h;const o=Ch(x,k.Fh,k.emitterPosition);this.sh.addOnce((()=>{o.dispose()}))}));const I=this.onEnd.getConnectedValue(k);I&&o.onStoppedObservable.addOnce((()=>{k.systemContext=h;const o=Ch(I,k.Fh,k.emitterPosition);this.sh.addOnce((()=>{o.dispose()}))}))})),this.sh.addOnce((()=>{h.dispose()})),h}serialize(){const k=super.serialize();return k.oo=this.oo,k.emitRate=this.emitRate,k.blendMode=this.blendMode,k.doNoStart=this.doNoStart,k.targetStopDuration=this.targetStopDuration,k.startDelay=this.startDelay,k}_deserialize(k){super._deserialize(k),this.oo=k.oo,this.emitRate=k.emitRate,this.doNoStart=!!k.doNoStart,void 0!==k.blendMode&&(this.blendMode=k.blendMode),void 0!==k.targetStopDuration&&(this.targetStopDuration=k.targetStopDuration),void 0!==k.startDelay&&(this.startDelay=k.startDelay)}}(0,D.d)([th("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:G.BLENDMODE_ONEONE},{label:"Standard",value:G.BLENDMODE_STANDARD},{label:"Add",value:G.BLENDMODE_ADD},{label:"Multiply",value:G.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:G.BLENDMODE_MULTIPLYADD}]})],gh.prototype,"blendMode",void 0),(0,D.d)([th("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],gh.prototype,"oo",void 0),(0,D.d)([th("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gh.prototype,"emitRate",void 0),(0,D.d)([th("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gh.prototype,"targetStopDuration",void 0),(0,D.d)([th("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gh.prototype,"startDelay",void 0),(0,D.d)([th("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],gh.prototype,"doNoStart",void 0),(0,J.g)("BABYLON.SystemBlock",gh);class eh extends rh{get type(){if(this._type===nh.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=nh.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=nh.Vector2,this._type;case"Vh":return this._type=nh.Vh,this._type;case"RJ":return this._type=nh.RJ,this._type;case"Matrix":return this._type=nh.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===zh.None&&this._systemSource!==ph.None}get systemSource(){return this._systemSource}set systemSource(k){if(this._systemSource=k,k!==ph.None){switch(this._contextualSource=zh.None,this._type=nh.Float,k){case ph.Time:case ph.Delta:this._type=nh.Float;break;case ph.Emitter:this._type=nh.Vh}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==zh.None}get contextualValue(){return this._contextualSource}set contextualValue(k){if(this._contextualSource=k,k!==zh.None){switch(this._systemSource=ph.None,k){case zh.Scale:this._type=nh.Vector2;break;case zh.Position:case zh.Direction:case zh.ScaledDirection:this._type=nh.Vh;break;case zh.Color:this._type=nh.RJ;break;case zh.Age:case zh.Lifetime:case zh.Angle:case zh.AgeGradient:this._type=nh.Float;break;case zh.SpriteCellEnd:case zh.SpriteCellStart:case zh.SpriteCellIndex:this._type=nh.Int}this.output&&(this.output.type=this._type)}}constructor(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nh.AutoDetect;super(k),this._type=nh.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new C.d,this._systemSource=ph.None,this._contextualSource=zh.None,this._type=h,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",h)}get value(){return this._storedValue}set value(k){this.type===nh.Float&&this.min!==this.max&&(k=Math.max(this.min,k),k=Math.min(this.max,k)),this._storedValue=k,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(k){this._valueCallback=k}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case nh.Int:case nh.Float:this.value=0;break;case nh.Vector2:this.value=x.Vector2.Zero();break;case nh.Vh:this.value=x.Vh.Zero();break;case nh.RJ:this.value=new Y.RJ(1,1,1,1);break;case nh.Matrix:this.value=x.Matrix.Identity()}}_build(k){super._build(k),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=k=>k.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=k=>k.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const k=super.serialize();return k.type=this.type,k.contextualValue=this.contextualValue,k.systemSource=this.systemSource,k.min=this.min,k.max=this.max,k.groupInInspector=this.groupInInspector,k.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.rh?(k.valueType="BABYLON."+this._storedValue.getClassName(),k.value=this._storedValue.rh()):(k.valueType="number",k.value=this._storedValue)),k}_deserialize(k){if(super._deserialize(k),this._type=k.type,this.contextualValue=k.contextualValue,this.systemSource=k.systemSource||ph.None,this.min=k.min||0,this.max=k.max||0,this.groupInInspector=k.groupInInspector||"",void 0!==k.displayInInspector&&(this.displayInInspector=k.displayInInspector),k.valueType)if("number"===k.valueType)this._storedValue=k.value;else{const h=(0,J.e)(k.valueType);h&&(this._storedValue=h.Uh(k.value))}}}(0,J.g)("BABYLON.ParticleInputBlock",eh);class uh extends rh{get url(){return this._url}set url(k){this._url!==k&&(this._cachedData=null,this._url=k,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(k){this._textureDataUrl!==k&&(this._cachedData=null,this._textureDataUrl=k,this._url="",this._sourceTexture=null)}set sourceTexture(k){this._sourceTexture!==k&&(this._cachedData=null,this._sourceTexture=k,this._url="",this._textureDataUrl="")}constructor(k){super(k),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",nh.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const k=this.texture._storedValue;return await new Promise(((h,o)=>{if(!k.isReady())return void k.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),h(this._cachedData)}catch(k){o(k)}}));const x=k.getSize();Dh.k.GetTextureDataAsync(k,x.width,x.height).then((o=>{this._cachedData={width:x.width,height:x.height,data:new Uint8ClampedArray(o)},k.dispose(),h(this._cachedData)})).catch(o)}))}_build(k){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new B.b(this._textureDataUrl,k.Fh):this.texture._storedValue=new B.b(this._url,k.Fh):this.texture._storedValue=null}serialize(){const k=super.serialize();return k.url=this.url,k.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(k.textureDataUrl=this.textureDataUrl),k}_deserialize(k){super._deserialize(k),this.url=k.url,this.serializedCachedData=!!k.serializedCachedData,k.textureDataUrl&&(this.textureDataUrl=k.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,J.g)("BABYLON.ParticleTextureSourceBlock",uh);class ko extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("position",nh.Vh),this.registerOutput("output",nh.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(k){const h=this.particle.getConnectedValue(k);if(this.output._storedValue=h,!this.position.isConnected)return;const o={process:o=>{k.particleContext=o,k.systemContext=h,o.position.Y(this.position.getConnectedValue(k))},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o}}(0,J.g)("BABYLON.UpdatePositionBlock",ko),function(k){k[k.Add=0]="Add",k[k.Subtract=1]="Subtract",k[k.Multiply=2]="Multiply",k[k.Divide=3]="Divide",k[k.Max=4]="Max",k[k.Min=5]="Min"}(vh||(vh={}));class ho extends rh{constructor(k){super(k),this.operation=vh.Add,this.registerInput("left",nh.AutoDetect),this.registerInput("right",nh.AutoDetect),this.registerOutput("output",nh.BasedOnInput),this.output._typeConnectionSource=this.left;const h=[nh.Matrix,nh.Particle,nh.Texture,nh.System,nh.FloatGradient,nh.Color4Gradient,nh.Vector2Gradient,nh.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...h),this.right.excludedConnectionPointTypes.push(...h),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(k){let h;const o=this.left,I=this.right;if(!o.isConnected||!I.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const q=o.type===nh.Float||o.type===nh.Int,J=I.type===nh.Float||I.type===nh.Int,G=q&&J;switch(this.operation){case vh.Add:h=G?k=>o.getConnectedValue(k)+I.getConnectedValue(k):q?k=>k.adapt(o,I.type).add(I.getConnectedValue(k)):k=>o.getConnectedValue(k).add(k.adapt(I,o.type));break;case vh.Subtract:h=G?k=>o.getConnectedValue(k)-I.getConnectedValue(k):q?k=>k.adapt(o,I.type).ih(I.getConnectedValue(k)):k=>o.getConnectedValue(k).ih(k.adapt(I,o.type));break;case vh.Multiply:h=G?k=>o.getConnectedValue(k)*I.getConnectedValue(k):q?k=>k.adapt(o,I.type).multiply(I.getConnectedValue(k)):k=>o.getConnectedValue(k).multiply(k.adapt(I,o.type));break;case vh.Divide:h=G?k=>o.getConnectedValue(k)/I.getConnectedValue(k):q?k=>k.adapt(o,I.type).divide(I.getConnectedValue(k)):k=>o.getConnectedValue(k).divide(k.adapt(I,o.type));break;case vh.Min:if(G)h=k=>Math.min(o.getConnectedValue(k),I.getConnectedValue(k));else{const[k,J]=q?[I,o]:[o,I];switch(k.type){case nh.Vector2:h=h=>x.Vector2.Minimize(k.getConnectedValue(h),h.adapt(J,k.type));break;case nh.Vh:h=h=>x.Vh.Minimize(k.getConnectedValue(h),h.adapt(J,k.type));break;case nh.RJ:h=h=>{const o=k.getConnectedValue(h),{r:x,g:I,b:q,a:G}=h.adapt(J,k.type);return new Y.RJ(Math.min(o.r,x),Math.min(o.g,I),Math.min(o.b,q),Math.min(o.a,G))}}}break;case vh.Max:if(!G){const[k,J]=q?[I,o]:[o,I];switch(k.type){case nh.Vector2:h=h=>x.Vector2.Maximize(k.getConnectedValue(h),h.adapt(J,k.type));break;case nh.Vh:h=h=>x.Vh.Maximize(k.getConnectedValue(h),h.adapt(J,k.type));break;case nh.RJ:h=h=>{const o=k.getConnectedValue(h),{r:x,g:I,b:q,a:G}=h.adapt(J,k.type);return new Y.RJ(Math.max(o.r,x),Math.min(o.g,I),Math.min(o.b,q),Math.min(o.a,G))}}break}h=k=>Math.max(o.getConnectedValue(k),I.getConnectedValue(k))}this.output._storedFunction=k=>o.type===nh.Int?0|h(k):h(k)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===nh.Int||this.left.type===nh.Float&&this.right.type!==nh.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[k,h]of[[this.left,this.right],[this.right,this.left]])k.acceptedConnectionPointTypes=[nh.Int,nh.Float],h.isConnected&&(k.acceptedConnectionPointTypes.push(h.type),h.type!==nh.Int&&h.type!==nh.Float||k.acceptedConnectionPointTypes.push(nh.Vector2,nh.Vh,nh.RJ))}dispose(){super.dispose();for(const k of this._connectionObservers)k.remove();this._connectionObservers.length=0}serialize(){const k=super.serialize();return k.operation=this.operation,k}_deserialize(k){super._deserialize(k),this.operation=k.operation}}(0,D.d)([th("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:vh.Add},{label:"Subtract",value:vh.Subtract},{label:"Multiply",value:vh.Multiply},{label:"Divide",value:vh.Divide},{label:"Max",value:vh.Max},{label:"Min",value:vh.Min}]})],ho.prototype,"operation",void 0),(0,J.g)("BABYLON.ParticleMathBlock",ho);class oo extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("direction1",nh.Vh,!0,new x.Vh(0,1,0)),this.registerInput("direction2",nh.Vh,!0,new x.Vh(0,1,0)),this.registerInput("minEmitBox",nh.Vh,!0,new x.Vh(-.5,-.5,-.5)),this.registerInput("maxEmitBox",nh.Vh,!0,new x.Vh(.5,.5,.5)),this.registerOutput("output",nh.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(k){const h=this.particle.getConnectedValue(k);h._directionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.direction1.getConnectedValue(k),q=this.direction2.getConnectedValue(k),Y=(0,l.RandomRange)(I.x,q.x),J=(0,l.RandomRange)(I.y,q.y),G=(0,l.RandomRange)(I.z,q.z);k.isEmitterTransformNode?x.Vh.TransformNormalFromFloatsToRef(Y,J,G,k.emitterWorldMatrix,o.direction):o.direction.VJ(Y,J,G)},h._positionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.minEmitBox.getConnectedValue(k),q=this.maxEmitBox.getConnectedValue(k),Y=(0,l.RandomRange)(I.x,q.x),J=(0,l.RandomRange)(I.y,q.y),G=(0,l.RandomRange)(I.z,q.z);k.isEmitterTransformNode?x.Vh.TransformCoordinatesFromFloatsToRef(Y,J,G,k.emitterWorldMatrix,o.position):(o.position.VJ(Y,J,G),o.position.addInPlace(k.emitterPosition))},this.output._storedValue=h}}(0,J.g)("BABYLON.BoxShapeBlock",oo);class xo extends rh{constructor(k){super(k),this.registerInput("emitPower",nh.Float,!0,1),this.registerInput("lifeTime",nh.Float,!0,1),this.registerInput("color",nh.RJ,!0,new Y.RJ(1,1,1,1)),this.registerInput("scale",nh.Vector2,!0,new x.Vector2(1,1)),this.registerInput("angle",nh.Float,!0,0),this.registerOutput("particle",nh.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(k){const h=new Jh(this.name,k.oo,k.Fh,null,!1,void 0,!0);h.particleEmitterType=new f,h._lifeTimeCreation.process=(h,o)=>{k.particleContext=h,h.lifeTime=this.lifeTime.getConnectedValue(k),o._emitPower=this.emitPower.getConnectedValue(k)},h._colorCreation.process=h=>{k.particleContext=h,h.color.Y(this.color.getConnectedValue(k))},h._sizeCreation.process=h=>{k.particleContext=h,h.size=1,h.scale.Y(this.scale.getConnectedValue(k))},h._angleCreation.process=h=>{k.particleContext=h,h.angle=this.angle.getConnectedValue(k)},this.particle._storedValue=h}}(0,J.g)("BABYLON.CreateParticleBlock",xo);class Io{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const k=[];for(const h of this.attachedBlocks)h.isInput&&k.push(h);return k}constructor(k){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new C.d,this.name=k}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(k){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(k)&&this.attachedBlocks.push(k);for(const o of k.inputs){const x=o.connectedPoint;if(x){const o=x.ownerBlock;o!==k&&this._initializeBlock(o,h)}}}async buildAsync(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((o=>{const x=new Vh;for(const k of this._systemBlocks)this._initializeBlock(k);for(const I of this.systemBlocks){const o=new Sh;o.buildId=this._buildId++,o.Fh=k,o.verbose=h;const q=I.createSystem(o);o.emitErrors(),x.systems.push(q)}this.onBuildObservable.notifyObservers(this),o(x)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const k=new gh("Particle system"),h=new ko("Update position");h.output.connectTo(k.particle);const o=new eh("Position");o.contextualValue=zh.Position;const x=new eh("Scaled direction");x.contextualValue=zh.ScaledDirection;const I=new ho("Add");I.operation=vh.Add,o.output.connectTo(I.left),x.output.connectTo(I.right),I.output.connectTo(h.position);const q=new xo("Create particle"),Y=new oo("Box shape");q.particle.connectTo(Y.particle),Y.output.connectTo(h.particle);const J=new uh("Texture");J.texture.connectTo(k.texture),J.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(k)}removeBlock(k){const h=this.attachedBlocks.indexOf(k);if(h>-1&&this.attachedBlocks.splice(h,1),k.isSystem){const h=this._systemBlocks.indexOf(k);h>-1&&this._systemBlocks.splice(h,1)}}parseSerializedObject(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h||this.clear();const o={};for(const x of k.MA){const k=(0,J.e)(x.customType);if(k){const h=new k;h._deserialize(x),o[x.id]=h,this.attachedBlocks.push(h),h.isSystem&&this._systemBlocks.push(h)}}for(const x of this.attachedBlocks)if(x.isTeleportOut){const k=x,h=k._tempEntryPointUniqueId;if(h){const x=o[h];x&&x.attachToEndpoint(k)}}for(let x=0;x<k.MA.length;x++){const I=k.MA[x],q=o[I.id];q&&(q.inputs.length&&I.inputs.some((k=>k.targetConnectionName))&&!h||this._restoreConnections(q,k,o))}if(k.locations||k.editorData&&k.editorData.locations){const x=k.locations||k.editorData.locations;for(const k of x)o[k.Zx]&&(k.Zx=o[k.Zx].uniqueId);h&&this.editorData&&this.editorData.locations&&x.concat(this.editorData.locations),k.locations?this.editorData={locations:x}:(this.editorData=k.editorData,this.editorData.locations=x);const I=[];for(const k in o)I[k]=o[k].uniqueId;this.editorData.map=I}this.comment=k.comment}_restoreConnections(k,h,o){for(const x of k.outputs)for(const I of h.MA){const q=o[I.id];if(q)for(const Y of I.inputs)if(o[Y.targetBlockId]!==k||Y.targetConnectionName!==x.name);else{const k=q.getInputByName(Y.inputName);if(!k||k.isConnected)continue;x.connectTo(k,!0),this._restoreConnections(q,h,o)}}}serialize(k){const h=k?{}:Q.c.Serialize(this);h.editorData=JSON.parse(JSON.stringify(this.editorData));let o=[];k?o=k:h.customType="BABYLON.NodeParticleSystemSet",h.MA=[];for(const x of o)h.MA.push(x.serialize());if(!k)for(const x of this.attachedBlocks)-1===o.indexOf(x)&&h.MA.push(x.serialize());return h}dispose(){for(const k of this.attachedBlocks)k.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(k){const h=new Io(k);return h.setToDefault(),h}static Parse(k){const h=Q.c.Parse((()=>new Io(k.name)),k,null);return h.parseSerializedObject(k),h}static ParseFromSnippetAsync(k,h){return"_BLANK"===k?Promise.resolve(Io.CreateDefault("blank")):new Promise(((o,x)=>{const I=new ih.e;I.addEventListener("readystatechange",(()=>{if(4==I.readyState)if(200==I.status){const Y=JSON.parse(JSON.parse(I.responseText).jsonPayload),J=JSON.parse(Y.nodeParticle);h||(h=Q.c.Parse((()=>new Io(k)),J,null)),h.parseSerializedObject(J),h.snippetId=k;try{o(h)}catch(q){x(q)}}else x("Unable to load the snippet "+k)})),I.open("GET",this.SnippetUrl+"/"+k.replace(/#/g,"/")),I.send()}))}}Io.EditorURL=`${jh.Tools._DefaultCdnUrl}/v${tk.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Io.SnippetUrl="https://snippet.babylonjs.com",(0,D.d)([(0,U.E)()],Io.prototype,"name",void 0),(0,D.d)([(0,U.E)("comment")],Io.prototype,"comment",void 0),function(k){k[k.None=0]="None",k[k.PerParticle=1]="PerParticle",k[k.PerSystem=2]="PerSystem"}(mh||(mh={}));class qo extends rh{constructor(k){super(k),this._currentLockId=-2,this.lockMode=mh.PerParticle,this.registerInput("min",nh.AutoDetect,!0,0),this.registerInput("max",nh.AutoDetect,!0,1),this.registerOutput("output",nh.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(nh.Float|nh.Int|nh.Vector2|nh.Vh|nh.RJ),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(nh.Float|nh.Int|nh.Vector2|nh.Vh|nh.RJ),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=nh.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let k=null;switch(this._currentLockId=-2,this.min.type){case nh.AutoDetect:case nh.Int:case nh.Float:k=k=>{const h=this.min.getConnectedValue(k)||0,o=this.max.getConnectedValue(k)||1;return h+Math.random()*(o-h)};break;case nh.Vector2:k=k=>{const h=this.min.getConnectedValue(k)||x.Vector2.Zero(),o=this.max.getConnectedValue(k)||x.Vector2.One();return new x.Vector2(h.x+Math.random()*(o.x-h.x),h.y+Math.random()*(o.y-h.y))};break;case nh.Vh:k=k=>{const h=this.min.getConnectedValue(k)||x.Vh.Zero(),o=this.max.getConnectedValue(k)||x.Vh.One();return new x.Vh(h.x+Math.random()*(o.x-h.x),h.y+Math.random()*(o.y-h.y),h.z+Math.random()*(o.z-h.z))};break;case nh.RJ:k=k=>{const h=this.min.getConnectedValue(k)||new Y.RJ(0,0,0,0),o=this.max.getConnectedValue(k)||new Y.RJ(1,1,1,1);return new Y.RJ(h.x+Math.random()*(o.x-h.x),h.y+Math.random()*(o.y-h.y),h.z+Math.random()*(o.z-h.z),h.w+Math.random()*(o.w-h.w))}}this.output._storedFunction=h=>{var o;let x=0;switch(this.lockMode){case mh.PerParticle:x=(null===(o=h.particleContext)||void 0===o?void 0:o.id)||-1;break;case mh.PerSystem:x=h.buildId||0}return this._currentLockId!==x&&(this.lockMode!==mh.None&&(this._currentLockId=x),this.output._storedValue=k(h)),this.output._storedValue}}serialize(){const k=super.serialize();return k.lockMode=this.lockMode,k}_deserialize(k){super._deserialize(k),this.lockMode=k.lockMode}}(0,D.d)([th("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:mh.None},{label:"Per particle",value:mh.PerParticle},{label:"Per system",value:mh.PerSystem}]})],qo.prototype,"lockMode",void 0),(0,J.g)("BABYLON.ParticleRandomBlock",qo);class Yo extends rh{constructor(k){super(k),this._currentLockId=-2,this.lockMode=mh.PerParticle,this.registerInput("min",nh.AutoDetect),this.registerInput("max",nh.AutoDetect),this.registerOutput("output",nh.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const h=[nh.Matrix,nh.Particle,nh.Texture,nh.System,nh.FloatGradient,nh.Color4Gradient,nh.Vector2Gradient,nh.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...h),this.max.excludedConnectionPointTypes.push(...h)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let k=null;switch(this._currentLockId=-2,this.min.type){case nh.Float:case nh.Int:k=k=>{const h=this.min.getConnectedValue(k),o=this.max.getConnectedValue(k);return Math.random()*(o-h)+h};break;case nh.Vector2:k=k=>{const h=this.min.getConnectedValue(k),o=this.max.getConnectedValue(k);return new x.Vector2(Math.random()*(o.x-h.x)+h.x,Math.random()*(o.y-h.y)+h.y)};break;case nh.Vh:k=k=>{const h=this.min.getConnectedValue(k),o=this.max.getConnectedValue(k);return new x.Vh(Math.random()*(o.x-h.x)+h.x,Math.random()*(o.y-h.y)+h.y,Math.random()*(o.z-h.z)+h.z)};break;case nh.RJ:k=k=>{const h=this.min.getConnectedValue(k),o=this.max.getConnectedValue(k);return new Y.RJ(Math.random()*(o.r-h.r)+h.r,Math.random()*(o.g-h.g)+h.g,Math.random()*(o.b-h.b)+h.b,Math.random()*(o.a-h.a)+h.a)}}this.output._storedFunction=h=>{var o;let x=0;switch(this.lockMode){case mh.PerParticle:x=(null===(o=h.particleContext)||void 0===o?void 0:o.id)||-1;break;case mh.PerSystem:x=h.buildId||0}return this._currentLockId!==x&&(this.lockMode!==mh.None&&(this._currentLockId=x),this.output._storedValue=k(h)),this.output._storedValue}}serialize(){const k=super.serialize();return k.lockMode=this.lockMode,k}_deserialize(k){super._deserialize(k),void 0!==k.lockMode&&(this.lockMode=k.lockMode)}}(0,D.d)([th("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:mh.None},{label:"Per particle",value:mh.PerParticle},{label:"Per system",value:mh.PerSystem}]})],Yo.prototype,"lockMode",void 0),(0,J.g)("BABYLON.RandomRangeBlock",Yo);(0,J.g)("BABYLON.ParticleLerpBlock",class extends rh{constructor(k){super(k),this.registerInput("left",nh.AutoDetect),this.registerInput("right",nh.AutoDetect),this.registerInput("gradient",nh.Float,!0,0,0,1),this.registerOutput("output",nh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(nh.Float|nh.Int|nh.Vector2|nh.Vh|nh.RJ)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const k=(k,h,o)=>(1-k)*h+k*o;this.output._storedFunction=h=>{const o=this.left.getConnectedValue(h),I=this.right.getConnectedValue(h),q=this.gradient.getConnectedValue(h);switch(this.left.type){case nh.Int:case nh.Float:return k(q,o,I);case nh.Vector2:return new x.Vector2(k(q,o.x,I.x),k(q,o.y,I.y));case nh.Vh:return new x.Vh(k(q,o.x,I.x),k(q,o.y,I.y),k(q,o.z,I.z));case nh.RJ:return new Y.RJ(k(q,o.r,I.r),k(q,o.g,I.g),k(q,o.b,I.b),k(q,o.a,I.a))}return 0}}});(0,J.g)("BABYLON.UpdateDirectionBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("direction",nh.Vh),this.registerOutput("output",nh.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(k){const h=this.particle.getConnectedValue(k);if(this.output._storedValue=h,!this.direction.isConnected)return;const o={process:o=>{k.particleContext=o,k.systemContext=h,o.direction.Y(this.direction.getConnectedValue(k))},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o}});(0,J.g)("BABYLON.UpdateColorBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("color",nh.RJ),this.registerOutput("output",nh.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(k){const h=this.particle.getConnectedValue(k);if(this.output._storedValue=h,!this.color.isConnected)return;const o={process:o=>{k.particleContext=o,k.systemContext=h,o.color.Y(this.color.getConnectedValue(k))},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o}});(0,J.g)("BABYLON.UpdateScaleBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("scale",nh.Vector2),this.registerOutput("output",nh.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(k){const h=this.particle.getConnectedValue(k);if(this.output._storedValue=h,!this.scale.isConnected)return;const o={process:o=>{k.particleContext=o,k.systemContext=h,o.scale.Y(this.scale.getConnectedValue(k))},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o}});(0,J.g)("BABYLON.UpdateAngleBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("angle",nh.Float),this.registerOutput("output",nh.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(k){const h=this.particle.getConnectedValue(k);if(this.output._storedValue=h,!this.angle.isConnected)return;const o={process:o=>{k.particleContext=o,k.systemContext=h,o.angle=this.angle.getConnectedValue(k)},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o}});(0,J.g)("BABYLON.BasicPositionUpdateBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerOutput("output",nh.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(k){const h=this.particle.getConnectedValue(k),o={process:o=>{k.particleContext=o,k.systemContext=h,o.direction.scaleToRef(h._directionScale,h._scaledDirection),o.position.addInPlace(h._scaledDirection)},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o,this.output._storedValue=h}});(0,J.g)("BABYLON.BasicSpriteUpdateBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerOutput("output",nh.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(k){const h=this.particle.getConnectedValue(k),o={process:o=>{k.particleContext=o,k.systemContext=h,o.updateCellIndex()},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o,this.output._storedValue=h}});(0,J.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("cellIndex",nh.Int),this.registerOutput("output",nh.Particle),this.cellIndex.acceptedConnectionPointTypes=[nh.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(k){const h=this.particle.getConnectedValue(k);if(this.output._storedValue=h,!this.cellIndex.isConnected)return;const o={process:o=>{k.particleContext=o,k.systemContext=h,o.cellIndex=Math.floor(this.cellIndex.getConnectedValue(k))},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o}});class Jo extends rh{constructor(k){super(k),this.strength=1,this.registerInput("particle",nh.Particle),this.registerInput("flowMap",nh.Texture),this.registerOutput("output",nh.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(k){var h;const o=this.particle.getConnectedValue(k),x=k.Fh;let I;(null===(h=this.flowMap.connectedPoint)||void 0===h?void 0:h.ownerBlock).extractTextureContentAsync().then((k=>{k&&(I=new Eh(k.width,k.height,k.data))}));const q={process:k=>{const h=x.getTransformMatrix();I&&I._processParticle(k,this.strength*o._tempScaledUpdateSpeed,h)},previousItem:null,nextItem:null};o._updateQueueStart?pk(q,o._updateQueueStart):o._updateQueueStart=q,this.output._storedValue=o}serialize(){const k=super.serialize();return k.strength=this.strength,k}_deserialize(k){super._deserialize(k),this.strength=k.strength}}(0,D.d)([th("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Jo.prototype,"strength",void 0),(0,J.g)("BABYLON.UpdateFlowMapBlock",Jo);(0,J.g)("BABYLON.SphereShapeBlock",class extends rh{constructor(k){super(k),this.registerInput("input",nh.Particle),this.registerInput("radius",nh.Float,!0,1),this.registerInput("radiusRange",nh.Float,!0,1,0,1),this.registerInput("directionRandomizer",nh.Float,!0,0,0,1),this.registerOutput("output",nh.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(k){const h=this.input.getConnectedValue(k);h._directionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.directionRandomizer.getConnectedValue(k),q=o.position.ih(k.emitterPosition).normalize(),Y=(0,l.RandomRange)(0,I),J=(0,l.RandomRange)(0,I),G=(0,l.RandomRange)(0,I);q.x+=Y,q.y+=J,q.z+=G,q.normalize(),k.isEmitterTransformNode?x.Vh.TransformNormalFromFloatsToRef(Y,J,G,k.emitterWorldMatrix,o.direction):o.direction.VJ(Y,J,G)},h._positionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.radius.getConnectedValue(k),q=this.radiusRange.getConnectedValue(k),Y=I-(0,l.RandomRange)(0,I*q),J=(0,l.RandomRange)(0,1),G=(0,l.RandomRange)(0,2*Math.PI),A=Math.acos(2*J-1),K=Y*Math.cos(G)*Math.sin(A),a=Y*Math.cos(A),N=Y*Math.sin(G)*Math.sin(A);k.isEmitterTransformNode?x.Vh.TransformCoordinatesFromFloatsToRef(K,a,N,k.emitterWorldMatrix,o.position):(o.position.VJ(K,a,N),o.position.addInPlace(k.emitterPosition))},this.output._storedValue=h}});(0,J.g)("BABYLON.PointShapeBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("direction1",nh.Vh,!0,new x.Vh(0,1,0)),this.registerInput("direction2",nh.Vh,!0,new x.Vh(0,1,0)),this.registerOutput("output",nh.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(k){const h=this.particle.getConnectedValue(k);h._directionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.direction1.getConnectedValue(k),q=this.direction2.getConnectedValue(k),Y=(0,l.RandomRange)(I.x,q.x),J=(0,l.RandomRange)(I.y,q.y),G=(0,l.RandomRange)(I.z,q.z);k.isEmitterTransformNode?x.Vh.TransformNormalFromFloatsToRef(Y,J,G,k.emitterWorldMatrix,o.direction):o.direction.VJ(Y,J,G)},h._positionCreation.process=o=>{k.systemContext=h,k.isEmitterTransformNode?x.Vh.TransformCoordinatesFromFloatsToRef(0,0,0,k.emitterWorldMatrix,o.position):o.position.Y(k.emitterPosition)},this.output._storedValue=h}});(0,J.g)("BABYLON.CustomShapeBlock",class extends rh{constructor(k){super(k),this.registerInput("particle",nh.Particle),this.registerInput("position",nh.Vh,!0,new x.Vh(0,0,0)),this.registerInput("direction",nh.Vh,!0,new x.Vh(0,1,0)),this.registerOutput("output",nh.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(k){const h=this.particle.getConnectedValue(k);h._directionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.direction.getConnectedValue(k);k.isEmitterTransformNode?x.Vh.TransformNormalToRef(I,k.emitterWorldMatrix,o.direction):o.direction.Y(I)},h._positionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.position.getConnectedValue(k);k.isEmitterTransformNode?x.Vh.TransformCoordinatesToRef(I,k.emitterWorldMatrix,o.position):(o.position.Y(I),o.position.addInPlace(k.emitterPosition))},this.output._storedValue=h}});(0,J.g)("BABYLON.CylinderShapeBlock",class extends rh{constructor(k){super(k),this._tempVector=x.Vh.Zero(),this.registerInput("particle",nh.Particle),this.registerInput("radius",nh.Float,!0,1),this.registerInput("height",nh.Float,!0,1,0),this.registerInput("radiusRange",nh.Float,!0,1,0,1),this.registerInput("directionRandomizer",nh.Float,!0,0,0,1),this.registerOutput("output",nh.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(k){const h=this.particle.getConnectedValue(k);h._directionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.directionRandomizer.getConnectedValue(k);o.position.subtractToRef(k.emitterPosition,this._tempVector),this._tempVector.normalize(),k.isEmitterTransformNode&&x.Vh.TransformNormalToRef(this._tempVector,k.emitterInverseWorldMatrix,this._tempVector);const q=(0,l.RandomRange)(-I/2,I/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,l.RandomRange)(-Math.PI/2,Math.PI/2)*I,this._tempVector.y=q,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),k.isEmitterTransformNode?x.Vh.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,k.emitterWorldMatrix,o.direction):o.direction.Y(this._tempVector)},h._positionCreation.process=o=>{k.particleContext=o,k.systemContext=h;const I=this.height.getConnectedValue(k),q=this.radiusRange.getConnectedValue(k),Y=this.radius.getConnectedValue(k),J=(0,l.RandomRange)(-I/2,I/2),G=(0,l.RandomRange)(0,2*Math.PI),A=(0,l.RandomRange)((1-q)*(1-q),1),K=Math.sqrt(A)*Y,a=K*Math.cos(G),N=K*Math.sin(G);k.isEmitterTransformNode?x.Vh.TransformCoordinatesFromFloatsToRef(a,J,N,k.emitterWorldMatrix,o.position):(o.position.VJ(a,J,N),o.position.addInPlace(k.emitterPosition))},this.output._storedValue=h}});class Go extends rh{constructor(k){super(k),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",nh.Particle),this.registerOutput("output",nh.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(k){super._build(k);const h=this.particle.getConnectedValue(k);h._isAnimationSheetEnabled=!0,h.spriteCellWidth=this.width,h.spriteCellHeight=this.height,h.startSpriteCellID=this.start,h.endSpriteCellID=this.end,h.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=h}serialize(){const k=super.serialize();return k.width=this.width,k.height=this.height,k.start=this.start,k.end=this.end,k.randomStartCell=this.randomStartCell,k}_deserialize(k){super._deserialize(k),this.width=k.width,this.height=k.height,this.start=k.start,this.end=k.end,this.randomStartCell=k.randomStartCell}}(0,D.d)([th("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Go.prototype,"start",void 0),(0,D.d)([th("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Go.prototype,"end",void 0),(0,D.d)([th("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Go.prototype,"width",void 0),(0,D.d)([th("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Go.prototype,"height",void 0),(0,D.d)([th("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Go.prototype,"loop",void 0),(0,D.d)([th("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Go.prototype,"randomStartCell",void 0),(0,J.g)("BABYLON.SetupSpriteSheetBlock",Go);class lo extends rh{constructor(k){super(k),this.reference=0,this.registerInput("value",nh.AutoDetect),this.registerOutput("output",nh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=k=>{switch(k){case nh.Float:return nh.FloatGradient;case nh.Vector2:return nh.Vector2Gradient;case nh.Vh:return nh.Vector3Gradient;case nh.RJ:return nh.Color4Gradient}return k},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(nh.Float|nh.Vector2|nh.Vh|nh.RJ)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=k=>null}serialize(){const k=super.serialize();return k.reference=this.reference,k}_deserialize(k){super._deserialize(k),this.reference=k.reference}}(0,D.d)([th("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],lo.prototype,"reference",void 0),(0,J.g)("BABYLON.ParticleGradientValueBlock",lo);(0,J.g)("BABYLON.ParticleGradientBlock",class extends rh{constructor(k){super(k),this._entryCount=1,this.registerInput("gradient",nh.Float,!0,1,0,1),this.registerInput("value0",nh.AutoDetect),this.registerOutput("output",nh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=k=>{switch(k){case nh.FloatGradient:return nh.Float;case nh.Vector2Gradient:return nh.Vector2;case nh.Vector3Gradient:return nh.Vh;case nh.Color4Gradient:return nh.RJ}return k},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(nh.FloatGradient|nh.Vector2Gradient|nh.Vector3Gradient|nh.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(k){this._inputs[k].onConnectionObservable.add((()=>{this._entryCount>k||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),nh.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const k=[];for(let o=1;o<this._inputs.length;o++){var h;if(this._inputs[o].isConnected)k.push(null===(h=this._inputs[o].connectedPoint)||void 0===h?void 0:h.ownerBlock)}k.sort(((k,h)=>k.reference-h.reference)),this.output._storedFunction=h=>{const o=this.gradient.getConnectedValue(h);if(1===k.length)return k[0].value.getConnectedValue(h);let I=null;for(let q=k.length-1;q>=0;q--){const J=k[q];if(J.reference<=o){const k=J.value.getConnectedValue(h);if(I){const q=I.value.getConnectedValue(h),G=I.reference,A=J.reference,K=Math.max(0,Math.min(1,(o-A)/(G-A)));switch(this.output.type){case nh.Float:return(0,l.Lerp)(k,q,K);case nh.Vector2:return x.Vector2.Lerp(k,q,K);case nh.Vh:return x.Vh.Lerp(k,q,K);case nh.RJ:return Y.RJ.Lerp(k,q,K)}}return k}I=J}return 0}}});(0,J.g)("BABYLON.ParticleConverterBlock",class extends rh{constructor(k){super(k),this.registerInput("color ",nh.RJ,!0),this.registerInput("xyz ",nh.Vh,!0),this.registerInput("xy ",nh.Vector2,!0),this.registerInput("zw ",nh.Vector2,!0),this.registerInput("x ",nh.Float,!0),this.registerInput("y ",nh.Float,!0),this.registerInput("z ",nh.Float,!0),this.registerInput("w ",nh.Float,!0),this.registerOutput("color",nh.RJ),this.registerOutput("xyz",nh.Vh),this.registerOutput("xy",nh.Vector2),this.registerOutput("zw",nh.Vector2),this.registerOutput("x",nh.Float),this.registerOutput("y",nh.Float),this.registerOutput("z",nh.Float),this.registerOutput("w",nh.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(k){return"color "===k?"colorIn":"xyz "===k?"xyzIn":"xy "===k?"xyIn":"zw "===k?"zwIn":"x "===k?"xIn":"y "===k?"yIn":"z "===k?"zIn":"w "===k?"wIn":k}_outputRename(k){switch(k){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return k}}_build(k){super._build(k);const h=this.xIn,o=this.yIn,I=this.zIn,q=this.wIn,J=this.xyIn,G=this.zwIn,l=this.xyzIn,A=this.colorIn,K=this.colorOut,a=this.xyzOut,N=this.xyOut,X=this.zwOut,c=this.xOut,W=this.yOut,f=this.zOut,M=this.wOut,T=k=>{if(A.isConnected)return A.getConnectedValue(k);let x=0,K=0,a=0,N=0;if(h.isConnected&&(x=h.getConnectedValue(k)),o.isConnected&&(K=o.getConnectedValue(k)),I.isConnected&&(a=I.getConnectedValue(k)),q.isConnected&&(N=q.getConnectedValue(k)),J.isConnected){const h=J.getConnectedValue(k);h&&(x=h.x,K=h.y)}if(G.isConnected){const h=G.getConnectedValue(k);h&&(a=h.x,N=h.y)}if(l.isConnected){const h=l.getConnectedValue(k);h&&(x=h.x,K=h.y,a=h.z)}return new Y.RJ(x,K,a,N)};K._storedFunction=k=>T(k),a._storedFunction=k=>{const h=T(k);return new x.Vh(h.r,h.g,h.b)},N._storedFunction=k=>{const h=T(k);return new x.Vector2(h.r,h.g)},X._storedFunction=k=>{const h=T(k);return new x.Vector2(h.b,h.a)},c._storedFunction=k=>T(k).r,W._storedFunction=k=>T(k).g,f._storedFunction=k=>T(k).b,M._storedFunction=k=>T(k).a}}),function(k){k[k.Cos=0]="Cos",k[k.Sin=1]="Sin",k[k.Abs=2]="Abs",k[k.Exp=3]="Exp",k[k.Exp2=4]="Exp2",k[k.Round=5]="Round",k[k.Floor=6]="Floor",k[k.Ceiling=7]="Ceiling",k[k.Sqrt=8]="Sqrt",k[k.Log=9]="Log",k[k.Tan=10]="Tan",k[k.ArcTan=11]="ArcTan",k[k.ArcCos=12]="ArcCos",k[k.ArcSin=13]="ArcSin",k[k.Sign=14]="Sign",k[k.Negate=15]="Negate",k[k.OneMinus=16]="OneMinus",k[k.Reciprocal=17]="Reciprocal",k[k.ToDegrees=18]="ToDegrees",k[k.ToRadians=19]="ToRadians",k[k.Fract=20]="Fract"}(Lh||(Lh={}));class Ao extends rh{constructor(k){super(k),this.operation=Lh.Cos,this.registerInput("input",nh.AutoDetect),this.registerOutput("output",nh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(nh.Float|nh.Int|nh.Vector2|nh.Vh|nh.RJ)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(k){super._build(k);let h=null;switch(this.operation){case Lh.Cos:h=k=>Math.cos(k);break;case Lh.Sin:h=k=>Math.sin(k);break;case Lh.Abs:h=k=>Math.abs(k);break;case Lh.Exp:h=k=>Math.exp(k);break;case Lh.Exp2:h=k=>Math.pow(2,k);break;case Lh.Round:h=k=>Math.round(k);break;case Lh.Floor:h=k=>Math.floor(k);break;case Lh.Ceiling:h=k=>Math.ceil(k);break;case Lh.Sqrt:h=k=>Math.sqrt(k);break;case Lh.Log:h=k=>Math.log(k);break;case Lh.Tan:h=k=>Math.tan(k);break;case Lh.ArcTan:h=k=>Math.atan(k);break;case Lh.ArcCos:h=k=>Math.acos(k);break;case Lh.ArcSin:h=k=>Math.asin(k);break;case Lh.Sign:h=k=>Math.sign(k);break;case Lh.Negate:h=k=>-k;break;case Lh.OneMinus:h=k=>1-k;break;case Lh.Reciprocal:h=k=>1/k;break;case Lh.ToRadians:h=k=>k*Math.PI/180;break;case Lh.ToDegrees:h=k=>180*k/Math.PI;break;case Lh.Fract:h=k=>k>=0?k-Math.floor(k):k-Math.ceil(k)}if(!h)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case nh.Int:case nh.Float:this.output._storedFunction=k=>{const o=this.input.getConnectedValue(k);return h(o)};break;case nh.Vector2:this.output._storedFunction=k=>{const o=this.input.getConnectedValue(k);return new x.Vector2(h(o.x),h(o.y))};break;case nh.Vh:this.output._storedFunction=k=>{const o=this.input.getConnectedValue(k);return new x.Vh(h(o.x),h(o.y),h(o.z))};break;case nh.RJ:this.output._storedFunction=k=>{const o=this.input.getConnectedValue(k);return new Y.RJ(h(o.r),h(o.g),h(o.b),h(o.a))}}return this}serialize(){const k=super.serialize();return k.operation=this.operation,k}_deserialize(k){super._deserialize(k),this.operation=k.operation}}(0,D.d)([th("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Lh.Cos},{label:"Sin",value:Lh.Sin},{label:"Abs",value:Lh.Abs},{label:"Exp",value:Lh.Exp},{label:"Exp2",value:Lh.Exp2},{label:"Round",value:Lh.Round},{label:"Floor",value:Lh.Floor},{label:"Ceiling",value:Lh.Ceiling},{label:"Sqrt",value:Lh.Sqrt},{label:"Log",value:Lh.Log},{label:"Tan",value:Lh.Tan},{label:"ArcTan",value:Lh.ArcTan},{label:"ArcCos",value:Lh.ArcCos},{label:"ArcSin",value:Lh.ArcSin},{label:"Sign",value:Lh.Sign},{label:"Negate",value:Lh.Negate},{label:"OneMinus",value:Lh.OneMinus},{label:"Reciprocal",value:Lh.Reciprocal},{label:"ToDegrees",value:Lh.ToDegrees},{label:"ToRadians",value:Lh.ToRadians},{label:"Fract",value:Lh.Fract}]})],Ao.prototype,"operation",void 0),(0,J.g)("BABYLON.ParticleTrigonometryBlock",Ao);var Ko,ao=o(12642);class No extends rh{constructor(k){super(k),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",nh.AutoDetect),this.registerOutput("output",nh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(nh.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(nh.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(nh.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(nh.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(nh.System),this._inputs[0].excludedConnectionPointTypes.push(nh.Particle),this._inputs[0].excludedConnectionPointTypes.push(nh.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(k){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const h=k=>{const h=this.input.getConnectedValue(k);if(this.log.length>=this.stackSize)return h;if(null===h||void 0===h)return this.log.push(["null",""]),h;switch(this.input.type){case nh.Vector2:this.log.push([(0,ao.j)(h,4),h.toString()]);break;case nh.Vh:this.log.push([(0,ao.l)(h,4),h.toString()]);break;case nh.RJ:this.log.push([`{R: ${h.r.toFixed(4)} G: ${h.g.toFixed(4)} B: ${h.b.toFixed(4)} A: ${h.a.toFixed(4)}}`,h.toString()]);break;default:this.log.push([h.toString(),h.toString()])}return h};this.output.isConnected?this.output._storedFunction=h:this.output._storedValue=h(k)}serialize(){const k=super.serialize();return k.stackSize=this.stackSize,k}_deserialize(k){super._deserialize(k),this.stackSize=k.stackSize}}(0,D.d)([th("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],No.prototype,"stackSize",void 0),(0,J.g)("BABYLON.ParticleDebugBlock",No);(0,J.g)("BABYLON.ParticleElbowBlock",class extends rh{constructor(k){super(k),this.registerInput("input",nh.AutoDetect),this.registerOutput("output",nh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(k){super._build(k);const h=this._outputs[0],o=this._inputs[0];h._storedFunction=k=>o.getConnectedValue(k)}});(0,J.g)("BABYLON.ParticleTeleportInBlock",class extends rh{get endpoints(){return this._endpoints}constructor(k){super(k),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",nh.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(k){if(this.getClassName()===k)return!0;for(const h of this.endpoints)if(h.isAnAncestorOfType(k))return!0;return!1}isAnAncestorOf(k){for(const h of this.endpoints){if(h===k)return!0;if(h.isAnAncestorOf(k))return!0}return!1}attachToEndpoint(k){k.detach(),this._endpoints.push(k),k._entryPoint=this,k._outputs[0]._typeConnectionSource=this._inputs[0],k._tempEntryPointUniqueId=null,k.name="> "+this.name}detachFromEndpoint(k){const h=this._endpoints.indexOf(k);-1!==h&&(this._endpoints.splice(h,1),k._outputs[0]._typeConnectionSource=null,k._entryPoint=null)}_build(){for(const k of this._endpoints)k.output._storedFunction=k=>this.input.getConnectedValue(k)}});(0,J.g)("BABYLON.ParticleTeleportOutBlock",class extends rh{constructor(k){super(k),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",nh.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(k){this.entryPoint&&this.entryPoint.build(k)}clone(){const k=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(k),k}serialize(){var k;const h=super.serialize();return h.entryPoint=(null===(k=this.entryPoint)||void 0===k?void 0:k.uniqueId)??"",h}_deserialize(k){super._deserialize(k),this._tempEntryPointUniqueId=k.entryPoint}}),function(k){k[k.Equal=0]="Equal",k[k.NotEqual=1]="NotEqual",k[k.LessThan=2]="LessThan",k[k.GreaterThan=3]="GreaterThan",k[k.LessOrEqual=4]="LessOrEqual",k[k.GreaterOrEqual=5]="GreaterOrEqual",k[k.Xor=6]="Xor",k[k.Or=7]="Or",k[k.And=8]="And"}(Ko||(Ko={}));class Xo extends rh{constructor(k){super(k),this.test=Ko.Equal,this.epsilon=0,this.registerInput("left",nh.Float),this.registerInput("right",nh.Float,!0,0),this.registerInput("ifTrue",nh.AutoDetect,!0,1),this.registerInput("ifFalse",nh.AutoDetect,!0,0),this.registerOutput("output",nh.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=nh.Float,this._inputs[0].acceptedConnectionPointTypes.push(nh.Int),this._inputs[1].acceptedConnectionPointTypes.push(nh.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const k=k=>{const h=this.left.getConnectedValue(k),o=this.right.getConnectedValue(k);let x=!1;switch(this.test){case Ko.Equal:x=(0,l.WithinEpsilon)(h,o,this.epsilon);break;case Ko.NotEqual:x=!(0,l.WithinEpsilon)(h,o,this.epsilon);break;case Ko.LessThan:x=h<o+this.epsilon;break;case Ko.GreaterThan:x=h>o-this.epsilon;break;case Ko.LessOrEqual:x=h<=o+this.epsilon;break;case Ko.GreaterOrEqual:x=h>=o-this.epsilon;break;case Ko.Xor:x=!!h&&!o||!h&&!!o;break;case Ko.Or:x=!!h||!!o;break;case Ko.And:x=!!h&&!!o}return x};this.output._storedFunction=h=>k(h)?this.ifTrue.getConnectedValue(h):this.ifFalse.getConnectedValue(h)}serialize(){const k=super.serialize();return k.test=this.test,k.epsilon=this.epsilon,k}_deserialize(k){super._deserialize(k),this.test=k.test,void 0!==k.epsilon&&(this.epsilon=k.epsilon)}}(0,D.d)([th("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Ko.Equal},{label:"NotEqual",value:Ko.NotEqual},{label:"LessThan",value:Ko.LessThan},{label:"GreaterThan",value:Ko.GreaterThan},{label:"LessOrEqual",value:Ko.LessOrEqual},{label:"GreaterOrEqual",value:Ko.GreaterOrEqual},{label:"Xor",value:Ko.Xor},{label:"Or",value:Ko.Or},{label:"And",value:Ko.And}]})],Xo.prototype,"test",void 0),(0,D.d)([th("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Xo.prototype,"epsilon",void 0),(0,J.g)("BABYLON.ParticleConditionBlock",Xo);class co extends rh{constructor(k){super(k),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",nh.Particle),this.registerInput("condition",nh.Float,!0,0),this.registerInput("system",nh.System),this.registerOutput("output",nh.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(k){this._triggerCount=0;const h=this.input.getConnectedValue(k),o={process:o=>{if(k.particleContext=o,k.systemContext=h,0!==this.condition.getConnectedValue(k)&&(0===this.limit||this._triggerCount<this.limit)){const x=(new Date).getTime();if(this._previousOne&&x-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=x;const I=this.system.getConnectedValue(k);if(I){const x=Ch(I,k.Fh,o.position);x.sh.addOnce((()=>{this._triggerCount--})),h.sh.addOnce((()=>{x.dispose()}))}}},previousItem:null,nextItem:null};h._updateQueueStart?pk(o,h._updateQueueStart):h._updateQueueStart=o,this.output._storedValue=h}serialize(){const k=super.serialize();return k.limit=this.limit,k.delay=this.delay,k}_deserialize(k){super._deserialize(k),void 0!==k.limit&&(this.limit=k.limit),void 0!==k.delay&&(this.delay=k.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,D.d)([th("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],co.prototype,"limit",void 0),(0,D.d)([th("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],co.prototype,"delay",void 0),(0,J.g)("BABYLON.ParticleTriggerBlock",co);o(12651),o(12668),o(12680),o(12736)},12718:(k,h,o)=>{"use strict";var x=o(11160);const I="clipPlaneFragment",q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12687:(k,h,o)=>{"use strict";var x=o(11160);const I="clipPlaneFragmentDeclaration",q="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12754:(k,h,o)=>{"use strict";var x=o(11160);const I="clipPlaneVertex",q="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12742:(k,h,o)=>{"use strict";var x=o(11160);const I="clipPlaneVertexDeclaration",q="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12734:(k,h,o)=>{"use strict";var x=o(11160);const I="fogFragment",q="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12716:(k,h,o)=>{"use strict";var x=o(11160);const I="fogFragmentDeclaration",q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12758:(k,h,o)=>{"use strict";var x=o(11160);const I="fogVertex",q="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12751:(k,h,o)=>{"use strict";var x=o(11160);const I="fogVertexDeclaration",q="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12705:(k,h,o)=>{"use strict";var x=o(11160);const I="helperFunctions",q="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12694:(k,h,o)=>{"use strict";var x=o(11160);const I="imageProcessingDeclaration",q="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12709:(k,h,o)=>{"use strict";var x=o(11160);const I="imageProcessingFunctions",q="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12700:(k,h,o)=>{"use strict";var x=o(11160);const I="logDepthDeclaration",q="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12726:(k,h,o)=>{"use strict";var x=o(11160);const I="logDepthFragment",q="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12760:(k,h,o)=>{"use strict";var x=o(11160);const I="logDepthVertex",q="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";x.b.IncludesShadersStoreWGSL[I]||(x.b.IncludesShadersStoreWGSL[I]=q)},12680:(k,h,o)=>{"use strict";o.r(h),o.d(h,{particlesPixelShaderWGSL:()=>Y});var x=o(11160);o(12687),o(12694),o(12700),o(12705),o(12709),o(12716),o(12718),o(12726),o(12734);const I="particlesPixelShader",q="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";x.b.ShadersStoreWGSL[I]||(x.b.ShadersStoreWGSL[I]=q);const Y={name:I,shader:q}},12736:(k,h,o)=>{"use strict";o.r(h),o.d(h,{particlesVertexShaderWGSL:()=>Y});var x=o(11160);o(12742),o(12751),o(12700),o(12754),o(12758),o(12760);const I="particlesVertexShader",q="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";x.b.ShadersStoreWGSL[I]||(x.b.ShadersStoreWGSL[I]=q);const Y={name:I,shader:q}},12587:(k,h,o)=>{"use strict";var x=o(11160);const I="clipPlaneFragment",q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12660:(k,h,o)=>{"use strict";var x=o(11160);const I="clipPlaneFragmentDeclaration",q="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12611:(k,h,o)=>{"use strict";var x=o(11160);const I="clipPlaneVertex",q="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12676:(k,h,o)=>{"use strict";var x=o(11160);const I="clipPlaneVertexDeclaration",q="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12598:(k,h,o)=>{"use strict";var x=o(11160);const I="fogFragment",q="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12583:(k,h,o)=>{"use strict";var x=o(11160);const I="fogFragmentDeclaration",q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12614:(k,h,o)=>{"use strict";var x=o(11160);const I="fogVertex",q="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12602:(k,h,o)=>{"use strict";var x=o(11160);const I="fogVertexDeclaration",q="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12575:(k,h,o)=>{"use strict";var x=o(11160);const I="helperFunctions",q="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12566:(k,h,o)=>{"use strict";var x=o(11160);const I="imageProcessingDeclaration",q="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12580:(k,h,o)=>{"use strict";var x=o(11160);const I="imageProcessingFunctions",q="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12571:(k,h,o)=>{"use strict";var x=o(11160);const I="logDepthDeclaration",q="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12591:(k,h,o)=>{"use strict";var x=o(11160);const I="logDepthFragment",q="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12619:(k,h,o)=>{"use strict";var x=o(11160);const I="logDepthVertex",q="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";x.b.IncludesShadersStore[I]||(x.b.IncludesShadersStore[I]=q)},12651:(k,h,o)=>{"use strict";o.r(h),o.d(h,{particlesPixelShader:()=>Y});var x=o(11160);o(12660),o(12566),o(12571),o(12575),o(12580),o(12583),o(12587),o(12591),o(12598);const I="particlesPixelShader",q="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";x.b.ShadersStore[I]||(x.b.ShadersStore[I]=q);const Y={name:I,shader:q}},12668:(k,h,o)=>{"use strict";o.r(h),o.d(h,{particlesVertexShader:()=>Y});var x=o(11160);o(12676),o(12602),o(12571),o(12611),o(12614),o(12619);const I="particlesVertexShader",q="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";x.b.ShadersStore[I]||(x.b.ShadersStore[I]=q);const Y={name:I,shader:q}},12990:(k,h,o)=>{"use strict";o.r(h),o.d(h,{FlowGraphGLTFDataProvider:()=>q});var x=o(12961),I=o(12936);class q extends x.b{constructor(k){var h,o;super();const x=k.glTF,q=(null===(h=x.animations)||void 0===h?void 0:h.map((k=>k._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",I.d,q);const Y=(null===(o=x.nodes)||void 0===o?void 0:o.map((k=>k._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",I.d,Y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12887:(k,h,o)=>{"use strict";o.d(h,{e:()=>W,h:()=>X,k:()=>N,n:()=>c});var x=o(11239),I=o(11733),q=o(11281),Y=o(12889);const J=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class G{constructor(k,h){this._gltf=k,this._infoTree=h}convert(k){let h,o=this._gltf,x=this._infoTree;if(!k.startsWith("/"))throw new Error("Path must start with a /");const I=k.split("/");if(I.shift(),I[I.length-1].includes(".length")){const k=I[I.length-1].split(".");I.pop(),I.push(...k)}let q=!1;for(const G of I){const I="length"===G;if(I&&!x.__array__)throw new Error(`Path ${k} is invalid`);if(x.__ignoreObjectTree__&&(q=!0),x.__array__&&!I)x=x.__array__;else if(x=x[G],!x)throw new Error(`Path ${k} is invalid`);if(!q)if(void 0===o){if(!J.find((h=>h.regex.test(k))))throw new Error(`Path ${k} is invalid`)}else if(!I){var Y;o=null===(Y=o)||void 0===Y?void 0:Y[G]}(x.__target__||I)&&(h=o)}return{object:h,info:x}}}function l(k,h,o,x){const I=A(k,h);return x?I[o][x]:I[o]}function A(k,h,o){var x,q;return null===(x=k._data)||void 0===x||null===(q=x[(null===o||void 0===o?void 0:o.fillMode)??I.e.MATERIAL_TriangleFillMode])||void 0===q?void 0:q.babylonMaterial}function K(k,h){return{offset:{componentsCount:2,type:"Vector2",get:(o,I,q)=>{const Y=l(o,q,k,h);return new x.Vector2(null===Y||void 0===Y?void 0:Y.uOffset,null===Y||void 0===Y?void 0:Y.vOffset)},getTarget:A,set:(o,x,I,q)=>{const Y=l(x,q,k,h);Y.uOffset=o.x,Y.vOffset=o.y},getPropertyName:[()=>`${k}${h?"."+h:""}.uOffset`,()=>`${k}${h?"."+h:""}.vOffset`]},rotation:{type:"number",get:(o,x,I)=>{var q;return null===(q=l(o,I,k,h))||void 0===q?void 0:q.wAng},getTarget:A,set:(o,x,I,q)=>l(x,q,k,h).wAng=o,getPropertyName:[()=>`${k}${h?"."+h:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(o,I,q)=>{const Y=l(o,q,k,h);return new x.Vector2(null===Y||void 0===Y?void 0:Y.uScale,null===Y||void 0===Y?void 0:Y.vScale)},getTarget:A,set:(o,x,I,q)=>{const Y=l(x,q,k,h);Y.uScale=o.x,Y.vScale=o.y},getPropertyName:[()=>`${k}${h?"."+h:""}.uScale`,()=>`${k}${h?"."+h:""}.vScale`]}}}const a={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:k=>{var h,o;return new x.Vector2((null===(h=k._babylonCamera)||void 0===h?void 0:h.orthoLeft)??0,(null===(o=k._babylonCamera)||void 0===o?void 0:o.orthoRight)??0)},set:(k,h)=>{h._babylonCamera&&(h._babylonCamera.orthoLeft=k.x,h._babylonCamera.orthoRight=k.y)},getTarget:k=>k,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:k=>{var h,o;return new x.Vector2((null===(h=k._babylonCamera)||void 0===h?void 0:h.orthoBottom)??0,(null===(o=k._babylonCamera)||void 0===o?void 0:o.orthoTop)??0)},set:(k,h)=>{h._babylonCamera&&(h._babylonCamera.orthoBottom=k.x,h._babylonCamera.orthoTop=k.y)},getTarget:k=>k,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:k=>{var h;return null===(h=k._babylonCamera)||void 0===h?void 0:h.maxZ},set:(k,h)=>{h._babylonCamera&&(h._babylonCamera.maxZ=k)},getTarget:k=>k,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:k=>{var h;return null===(h=k._babylonCamera)||void 0===h?void 0:h.nx},set:(k,h)=>{h._babylonCamera&&(h._babylonCamera.nx=k)},getTarget:k=>k,getPropertyName:[()=>"nx"]}},perspective:{aspectRatio:{type:"number",get:k=>{var h;return null===(h=k._babylonCamera)||void 0===h?void 0:h.getEngine().getAspectRatio(k._babylonCamera)},getTarget:k=>k,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:k=>{var h;return null===(h=k._babylonCamera)||void 0===h?void 0:h.fov},set:(k,h)=>{h._babylonCamera&&(h._babylonCamera.fov=k)},getTarget:k=>k,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:k=>{var h;return null===(h=k._babylonCamera)||void 0===h?void 0:h.maxZ},set:(k,h)=>{h._babylonCamera&&(h._babylonCamera.maxZ=k)},getTarget:k=>k,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:k=>{var h;return null===(h=k._babylonCamera)||void 0===h?void 0:h.nx},set:(k,h)=>{h._babylonCamera&&(h._babylonCamera.nx=k)},getTarget:k=>k,getPropertyName:[()=>"nx"]}}}},nodes:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Vh",get:k=>{var h;return null===(h=k._babylonTransformNode)||void 0===h?void 0:h.position},set:(k,h)=>{var o;return null===(o=h._babylonTransformNode)||void 0===o?void 0:o.position.Y(k)},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:k=>{var h;return null===(h=k._babylonTransformNode)||void 0===h?void 0:h.rotationQuaternion},set:(k,h)=>{var o,x;return null===(o=h._babylonTransformNode)||void 0===o||null===(x=o.rotationQuaternion)||void 0===x?void 0:x.Y(k)},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Vh",get:k=>{var h;return null===(h=k._babylonTransformNode)||void 0===h?void 0:h.iJ},set:(k,h)=>{var o;return null===(o=h._babylonTransformNode)||void 0===o?void 0:o.iJ.Y(k)},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"iJ"]},weights:{length:{type:"number",get:k=>k._numMorphTargets,getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(k,h)=>{var o,x;return void 0!==h?null===(o=k._primitiveBabylonMeshes)||void 0===o||null===(x=o[0].morphTargetManager)||void 0===x?void 0:x.getTarget(h).influence:void 0},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(k,h)=>[0],getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:k=>{var h,o,I;return x.Matrix.Compose(null===(h=k._babylonTransformNode)||void 0===h?void 0:h.iJ,null===(o=k._babylonTransformNode)||void 0===o?void 0:o.rotationQuaternion,null===(I=k._babylonTransformNode)||void 0===I?void 0:I.position)},getTarget:k=>k._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:k=>{var h,o,I,q;const Y=x.Matrix.Identity();let J=k.parent;for(;J&&J.parent;)J=J.parent;const G=(null===(h=k._babylonTransformNode)||void 0===h?void 0:h.position._isDirty)||(null===(o=k._babylonTransformNode)||void 0===o||null===(I=o.rotationQuaternion)||void 0===I?void 0:I._isDirty)||(null===(q=k._babylonTransformNode)||void 0===q?void 0:q.iJ._isDirty);if(J){var l;const h=null===(l=J._babylonTransformNode)||void 0===l?void 0:l.eq(!0).invert();var A,K;if(h)null===(A=k._babylonTransformNode)||void 0===A||null===(K=A.eq(G))||void 0===K||K.multiplyToRef(h,Y)}else k._babylonTransformNode&&Y.Y(k._babylonTransformNode.eq(G));return Y},getTarget:k=>k._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:k=>{var h,o;return null===(h=k._babylonTransformNode)||void 0===h||null===(o=h.getChildren((k=>k instanceof Y.b),!0)[0])||void 0===o?void 0:o.wJ},getTarget:k=>{var h;return null===(h=k._babylonTransformNode)||void 0===h?void 0:h.getChildren((k=>k instanceof Y.b),!0)[0]},set:(k,h)=>{if(h._babylonTransformNode){const o=h._babylonTransformNode.getChildren((k=>k instanceof Y.b),!0)[0];o&&(o.wJ=k)}}},color:{type:"Zh",get:k=>{var h,o;return null===(h=k._babylonTransformNode)||void 0===h||null===(o=h.getChildren((k=>k instanceof Y.b),!0)[0])||void 0===o?void 0:o.DJ},getTarget:k=>{var h;return null===(h=k._babylonTransformNode)||void 0===h?void 0:h.getChildren((k=>k instanceof Y.b),!0)[0]},set:(k,h)=>{if(h._babylonTransformNode){const o=h._babylonTransformNode.getChildren((k=>k instanceof Y.b),!0)[0];o&&(o.DJ=k)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Zh",get:(k,h,o)=>A(k,h,o).emissiveColor,set:(k,h,o,x)=>A(h,o,x).emissiveColor.Y(k),getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:K("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(k,h,o)=>{var x;return null===(x=l(k,o,"bumpTexture"))||void 0===x?void 0:x.level},set:(k,h,o,x)=>{const I=l(h,x,"bumpTexture");I&&(I.level=k)},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:K("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(k,h,o)=>A(k,h,o).ambientTextureStrength,set:(k,h,o,x)=>{const I=A(h,o,x);I&&(I.ambientTextureStrength=k)},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:K("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"RJ",get:(k,h,o)=>{const x=A(k,h,o);return q.RJ.FromColor3(x.albedoColor,x.alpha)},set:(k,h,o,x)=>{const I=A(h,o,x);I.albedoColor.set(k.r,k.g,k.b),I.alpha=k.a},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:K("albedoTexture")}},metallicFactor:{type:"number",get:(k,h,o)=>A(k,h,o).metallic,set:(k,h,o,x)=>{const I=A(h,o,x);I&&(I.metallic=k)},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(k,h,o)=>A(k,h,o).roughness,set:(k,h,o,x)=>{const I=A(h,o,x);I&&(I.roughness=k)},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:K("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(k,h,o)=>A(k,h,o).anisotropy.wJ,set:(k,h,o,x)=>{A(h,o,x).anisotropy.wJ=k},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(k,h,o)=>A(k,h,o).anisotropy.angle,set:(k,h,o,x)=>{A(h,o,x).anisotropy.angle=k},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:K("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(k,h,o)=>A(k,h,o).clearCoat.wJ,set:(k,h,o,x)=>{A(h,o,x).clearCoat.wJ=k},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(k,h,o)=>A(k,h,o).clearCoat.roughness,set:(k,h,o,x)=>{A(h,o,x).clearCoat.roughness=k},getTarget:(k,h,o)=>A(k,h,o),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:K("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(k,h,o)=>{var x;return null===(x=A(k,h,o).clearCoat.bumpTexture)||void 0===x?void 0:x.level},getTarget:A,set:(k,h,o,x)=>A(h,o,x).clearCoat.bumpTexture.level=k},extensions:{KHR_texture_transform:K("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:K("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(k,h,o)=>A(k,h,o).subSurface.dispersion,getTarget:A,set:(k,h,o,x)=>A(h,o,x).subSurface.dispersion=k}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(k,h,o)=>A(k,h,o).emissiveIntensity,getTarget:A,set:(k,h,o,x)=>A(h,o,x).emissiveIntensity=k}},KHR_materials_ior:{ior:{type:"number",get:(k,h,o)=>A(k,h,o).indexOfRefraction,getTarget:A,set:(k,h,o,x)=>A(h,o,x).indexOfRefraction=k}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(k,h,o)=>A(k,h,o).iridescence.wJ,getTarget:A,set:(k,h,o,x)=>A(h,o,x).iridescence.wJ=k},iridescenceIor:{type:"number",get:(k,h,o)=>A(k,h,o).iridescence.indexOfRefraction,getTarget:A,set:(k,h,o,x)=>A(h,o,x).iridescence.indexOfRefraction=k},iridescenceTexture:{extensions:{KHR_texture_transform:K("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(k,h,o)=>A(k,h,o).iridescence.maximumThickness,getTarget:A,set:(k,h,o,x)=>A(h,o,x).iridescence.maximumThickness=k},iridescenceThicknessMinimum:{type:"number",get:(k,h,o)=>A(k,h,o).iridescence.minimumThickness,getTarget:A,set:(k,h,o,x)=>A(h,o,x).iridescence.minimumThickness=k},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:K("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Zh",get:(k,h,o)=>A(k,h,o).sheen.color,getTarget:A,set:(k,h,o,x)=>A(h,o,x).sheen.color.Y(k)},sheenColorTexture:{extensions:{KHR_texture_transform:K("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(k,h,o)=>A(k,h,o).sheen.wJ,getTarget:A,set:(k,h,o,x)=>A(h,o,x).sheen.wJ=k},sheenRoughnessTexture:{extensions:{KHR_texture_transform:K("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(k,h,o)=>A(k,h,o).metallicF0Factor,getTarget:A,set:(k,h,o,x)=>A(h,o,x).metallicF0Factor=k,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Zh",get:(k,h,o)=>A(k,h,o).metallicReflectanceColor,getTarget:A,set:(k,h,o,x)=>A(h,o,x).metallicReflectanceColor.Y(k),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:K("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:K("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(k,h,o)=>A(k,h,o).subSurface.refractionIntensity,getTarget:A,set:(k,h,o,x)=>A(h,o,x).subSurface.refractionIntensity=k,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:K("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(k,h,o)=>A(k,h,o).subSurface.translucencyIntensity,getTarget:A,set:(k,h,o,x)=>A(h,o,x).subSurface.translucencyIntensity=k},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:K("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Zh",get:(k,h,o)=>A(k,h,o).subSurface.translucencyColor,getTarget:A,set:(k,h,o,x)=>{var I;return k&&(null===(I=A(h,o,x).subSurface.translucencyColor)||void 0===I?void 0:I.Y(k))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:K("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Zh",get:(k,h,o)=>A(k,h,o).subSurface.tintColor,getTarget:A,set:(k,h,o,x)=>A(h,o,x).subSurface.tintColor.Y(k)},attenuationDistance:{type:"number",get:(k,h,o)=>A(k,h,o).subSurface.tintColorAtDistance,getTarget:A,set:(k,h,o,x)=>A(h,o,x).subSurface.tintColorAtDistance=k},thicknessFactor:{type:"number",get:(k,h,o)=>A(k,h,o).subSurface.maximumThickness,getTarget:A,set:(k,h,o,x)=>A(h,o,x).subSurface.maximumThickness=k},thicknessTexture:{extensions:{KHR_texture_transform:K("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonLight)),getPropertyName:[k=>"length"]},__array__:{__target__:!0,color:{type:"Zh",get:k=>{var h;return null===(h=k._babylonLight)||void 0===h?void 0:h.DJ},set:(k,h)=>{var o;return null===(o=h._babylonLight)||void 0===o?void 0:o.DJ.Y(k)},getTarget:k=>k._babylonLight,getPropertyName:[k=>"diffuse"]},wJ:{type:"number",get:k=>{var h;return null===(h=k._babylonLight)||void 0===h?void 0:h.wJ},set:(k,h)=>h._babylonLight?h._babylonLight.wJ=k:void 0,getTarget:k=>k._babylonLight,getPropertyName:[k=>"intensity"]},range:{type:"number",get:k=>{var h;return null===(h=k._babylonLight)||void 0===h?void 0:h.range},set:(k,h)=>h._babylonLight?h._babylonLight.range=k:void 0,getTarget:k=>k._babylonLight,getPropertyName:[k=>"range"]},spot:{innerConeAngle:{type:"number",get:k=>{var h;return null===(h=k._babylonLight)||void 0===h?void 0:h.innerAngle},set:(k,h)=>h._babylonLight?h._babylonLight.innerAngle=k:void 0,getTarget:k=>k._babylonLight,getPropertyName:[k=>"innerConeAngle"]},outerConeAngle:{type:"number",get:k=>{var h;return null===(h=k._babylonLight)||void 0===h?void 0:h.angle},set:(k,h)=>h._babylonLight?h._babylonLight.angle=k:void 0,getTarget:k=>k._babylonLight,getPropertyName:[k=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonLight)),getPropertyName:[k=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonTexture)),getPropertyName:[k=>"length"]},__array__:{__target__:!0,wJ:{type:"number",get:k=>{var h;return null===(h=k._babylonTexture)||void 0===h?void 0:h.level},set:(k,h)=>{h._babylonTexture&&(h._babylonTexture.level=k)},getTarget:k=>k._babylonTexture},rotation:{type:"Quaternion",get:k=>{var h;return k._babylonTexture&&x.Quaternion.FromRotationMatrix(null===(h=k._babylonTexture)||void 0===h?void 0:h.getReflectionTextureMatrix())},set:(k,h)=>{var o;h._babylonTexture&&(null!==(o=h._babylonTexture.ik())&&void 0!==o&&o.useRightHandedSystem||(k=x.Quaternion.Inverse(k)),x.Matrix.FromQuaternionToRef(k,h._babylonTexture.getReflectionTextureMatrix()))},getTarget:k=>k._babylonTexture}}}}},animations:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>k._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:k=>k.length,getTarget:k=>k.map((k=>{var h;return null===(h=k.primitives[0]._instanceData)||void 0===h?void 0:h.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function N(k){return new G(k,a)}function X(k){const h=k.split("/").map((k=>k.replace(/{}/g,"__array__")));let o=a;for(const x of h)x&&(o=o[x]);if(o&&o.type&&o.get)return o}function c(k,h){const o=k.split("/").map((k=>k.replace(/{}/g,"__array__")));let x=a;for(const I of o)I&&(x=x[I]);x&&x.type&&x.get&&(x.interpolation=h)}function W(k,h){const o=k.split("/").map((k=>k.replace(/{}/g,"__array__")));let x=a;for(const I of o)if(I){if(!x[I]){if("?"===I){x.__ignoreObjectTree__=!0;continue}x[I]={},"__array__"===I&&(x[I].__target__=!0)}x=x[I]}Object.assign(x,h)}},12893:(k,h,o)=>{"use strict";o.r(h),o.d(h,{AnimationPropertyInfo:()=>l,TransformNodeAnimationPropertyInfo:()=>A,WeightAnimationPropertyInfo:()=>K,getQuaternion:()=>J,getVector3:()=>Y,getWeights:()=>G});var x=o(11783),I=o(11239),q=o(12887);function Y(k,h,o,x){return I.Vh.Uh(h,o).scaleInPlace(x)}function J(k,h,o,x){return I.Quaternion.Uh(h,o).scaleInPlace(x)}function G(k,h,o,x){const I=new Array(k._numMorphTargets);for(let q=0;q<I.length;q++)I[q]=h[o++]*x;return I}class l{constructor(k,h,o,x){this.type=k,this.name=h,this.getValue=o,this.getStride=x}_buildAnimation(k,h,o){const I=new x.c(k,this.name,h,this.type);return I.setKeys(o),I}}class A extends l{buildAnimations(k,h,o,x){const I=[];return I.push({babylonAnimatable:k._babylonTransformNode,babylonAnimation:this._buildAnimation(h,o,x)}),I}}class K extends l{buildAnimations(k,h,o,I){const q=[];if(k._numMorphTargets)for(let Y=0;Y<k._numMorphTargets;Y++){const J=new x.c(`${h}_${Y}`,this.name,o,this.type);if(J.setKeys(I.map((k=>({frame:k.frame,inTangent:k.inTangent?k.inTangent[Y]:void 0,value:k.value[Y],outTangent:k.outTangent?k.outTangent[Y]:void 0,interpolation:k.interpolation})))),k._primitiveBabylonMeshes)for(const h of k._primitiveBabylonMeshes)if(h.morphTargetManager){const k=h.morphTargetManager.getTarget(Y),o=J.clone();k.animations.push(o),q.push({babylonAnimatable:k,babylonAnimation:o})}}return q}}(0,q.n)("/nodes/{}/translation",[new A(x.c.ANIMATIONTYPE_VECTOR3,"position",Y,(()=>3))]),(0,q.n)("/nodes/{}/rotation",[new A(x.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",J,(()=>4))]),(0,q.n)("/nodes/{}/scale",[new A(x.c.ANIMATIONTYPE_VECTOR3,"iJ",Y,(()=>3))]),(0,q.n)("/nodes/{}/weights",[new K(x.c.ANIMATIONTYPE_FLOAT,"influence",G,(k=>k._numMorphTargets))])},12856:(k,h,o)=>{"use strict";class x{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((k,h)=>{this._resolve=k,this._reject=h}))}}var I=o(11239),q=o(11281),Y=o(11078),J=o(11699),G=o(12860),l=o(12867),A=o(11082),K=o(11727),a=o(11783),N=o(11786),X=o(11120),c=o(11098),W=o(11103);class f{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(k){this._useTextureToStoreBoneMatrices=k,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(k){this._animationPropertiesOverride=k}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(k,h,o){this.name=k,this.id=h,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=I.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new A.d,this.bones=[],this._scene=o||X.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const x=this._scene.getEngine().getCaps();this._canUseTextureForBones=x.textureFloat&&x.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((k=>!k.getParent()))}getTransformMatrices(k){if(this.needInitialSkinMatrix){if(!k)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return k._bonesTransformMatrices||this.prepare(!0),k._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(k){return this.needInitialSkinMatrix&&k._transformMatrixTexture?k._transformMatrixTexture:this._transformMatrixTexture}ik(){return this._scene}toString(k){let h=`Name: ${this.name}, nBones: ${this.bones.length}`;if(h+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,k){h+=", Ranges: {";let k=!0;for(const o in this._ranges)k&&(h+=", ",k=!1),h+=o;h+="}"}return h}getBoneIndexByName(k){for(let h=0,o=this.bones.length;h<o;h++)if(this.bones[h].name===k)return h;return-1}createAnimationRange(k,h,o){if(!this._ranges[k]){this._ranges[k]=new N.b(k,h,o);for(let x=0,I=this.bones.length;x<I;x++)this.bones[x].animations[0]&&this.bones[x].animations[0].createRange(k,h,o)}}deleteAnimationRange(k){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let o=0,x=this.bones.length;o<x;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].deleteRange(k,h);this._ranges[k]=null}getAnimationRange(k){return this._ranges[k]||null}getAnimationRanges(){const k=[];let h;for(h in this._ranges)k.push(this._ranges[h]);return k}copyAnimationRange(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[h]||!k.getAnimationRange(h))return!1;let x=!0;const I=this._getHighestAnimationFrame()+1,q={},Y=k.bones;let J,G;for(G=0,J=Y.length;G<J;G++)q[Y[G].name]=Y[G];this.bones.length!==Y.length&&(c.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Y.length}`),x=!1);const l=o&&this.dimensionsAtRest&&k.dimensionsAtRest?this.dimensionsAtRest.divide(k.dimensionsAtRest):null;for(G=0,J=this.bones.length;G<J;G++){const k=this.bones[G].name,Y=q[k];Y?x=x&&this.bones[G].copyAnimationRange(Y,h,I,o,l):(c.c.Warn("copyAnimationRange: not same rig, missing source bone "+k),x=!1)}const A=k.getAnimationRange(h);return A&&(this._ranges[h]=new N.b(h,A.from+I,A.to+I)),x}returnToRest(){for(const k of this.bones)-1!==k._index&&k.returnToRest()}_getHighestAnimationFrame(){let k=0;for(let h=0,o=this.bones.length;h<o;h++)if(this.bones[h].animations[0]){const o=this.bones[h].animations[0].getHighestFrame();k<o&&(k=o)}return k}beginAnimation(k,h,o,x){const I=this.getAnimationRange(k);return I?this._scene.beginAnimation(this,I.from,I.to,h,o,x):null}static MakeAnimationAdditive(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const x=k.getAnimationRange(o);if(!x)return null;const I=k._scene.getAllAnimatablesByTarget(k);let q=null;for(let J=0;J<I.length;J++){const k=I[J];if(k.fromFrame===(null===x||void 0===x?void 0:x.from)&&k.toFrame===(null===x||void 0===x?void 0:x.to)){q=k;break}}const Y=k.getAnimatables();for(let J=0;J<Y.length;J++){const k=Y[J].animations;if(k)for(let x=0;x<k.length;x++)a.c.MakeAnimationAdditive(k[x],h,o)}return q&&(q.isAdditive=!0),k}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(k){this._meshesWithPoseMatrix.push(k)}_unregisterMeshWithPoseMatrix(k){const h=this._meshesWithPoseMatrix.indexOf(k);h>-1&&this._meshesWithPoseMatrix.splice(h,1)}_computeTransformMatrices(k,h){this.onBeforeComputeObservable.notifyObservers(this);for(let o=0;o<this.bones.length;o++){const x=this.bones[o];x._childUpdateId++;const I=x.getParent();if(I?x.getLocalMatrix().multiplyToRef(I.getFinalMatrix(),x.getFinalMatrix()):h?x.getLocalMatrix().multiplyToRef(h,x.getFinalMatrix()):x.getFinalMatrix().Y(x.getLocalMatrix()),-1!==x._index){const h=null===x._index?o:x._index;x.getAbsoluteInverseBindMatrix().multiplyToArray(x.getFinalMatrix(),k,16*h)}}this._identity.copyToArray(k,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const k=this.ik().getRenderId();if(this._currentRenderId===k)return;this._currentRenderId=k}if(this._numBonesWithLinkedTransformNode>0)for(const k of this.bones)if(k._linkedTransformNode){const h=k._linkedTransformNode;k.position=h.position,h.rotationQuaternion?k.rotationQuaternion=h.rotationQuaternion:k.rotation=h.rotation,k.iJ=h.iJ}if(this.needInitialSkinMatrix)for(const k of this._meshesWithPoseMatrix){const h=k.getPoseMatrix();let o=this._isDirty;if(k._bonesTransformMatrices&&k._bonesTransformMatrices.length===16*(this.bones.length+1)||(k._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),o=!0),o){if(this._synchronizedWithMesh!==k){this._synchronizedWithMesh=k;for(const k of this.bones)if(!k.getParent()){k.getBindMatrix().multiplyToRef(h,I.TmpVectors.Matrix[1]),k._updateAbsoluteBindMatrices(I.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const h=4*(this.bones.length+1);k._transformMatrixTexture&&k._transformMatrixTexture.getSize().width===h||(k._transformMatrixTexture&&k._transformMatrixTexture.dispose(),k._transformMatrixTexture=K.c.CreateRGBATexture(k._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(k._bonesTransformMatrices,h),this.isUsingTextureForMatrices&&k._transformMatrixTexture&&k._transformMatrixTexture.update(k._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=K.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let k=0;k<this.bones.length;k++)this._animatables.push(this.bones[k])}return this._animatables}clone(k,h){const o=new f(k,h||k,this._scene);o.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let x=0;x<this.bones.length;x++){const k=this.bones[x];let h=null;const I=k.getParent();if(I){const k=this.bones.indexOf(I);h=o.bones[k]}const q=new l.d(k.name,o,h,k.getBindMatrix().clone(),k.getRestMatrix().clone());q._index=k._index,k._linkedTransformNode&&q.linkTransformNode(k._linkedTransformNode),W.d.DeepCopy(k.animations,q.animations)}if(this._ranges){o._ranges={};for(const k in this._ranges){const h=this._ranges[k];h&&(o._ranges[k]=h.clone())}}return this._isDirty=!0,o.prepare(!0),o}enableBlending(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const h of this.bones)for(const o of h.animations)o.enableBlending=!0,o.blendingSpeed=k}dispose(){if(this._meshesWithPoseMatrix.length=0,this.ik().stopAnimation(this),this.ik().removeSkeleton(this),this._parentContainer){const k=this._parentContainer.skeletons.indexOf(this);k>-1&&this._parentContainer.skeletons.splice(k,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const k={};k.name=this.name,k.id=this.id,this.dimensionsAtRest&&(k.dimensionsAtRest=this.dimensionsAtRest.rh()),k.bones=[],k.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let o=0;o<this.bones.length;o++){var h;const x=this.bones[o],I=x.getParent(),q={parentBoneIndex:I?this.bones.indexOf(I):-1,index:x.getIndex(),name:x.name,id:x.id,matrix:x.getBindMatrix().rh(),rest:x.getRestMatrix().rh(),linkedTransformNodeId:null===(h=x.getTransformNode())||void 0===h?void 0:h.id};k.bones.push(q),x.length&&(q.length=x.length),x.metadata&&(q.metadata=x.metadata),x.animations&&x.animations.length>0&&(q.animation=x.animations[0].serialize()),k.ranges=[];for(const h in this._ranges){const o=this._ranges[h];if(!o)continue;const x={};x.name=h,x.from=o.from,x.to=o.to,k.ranges.push(x)}}return k}static Parse(k,h){const o=new f(k.name,k.id,h);let x;for(k.dimensionsAtRest&&(o.dimensionsAtRest=I.Vh.Uh(k.dimensionsAtRest)),o.needInitialSkinMatrix=k.needInitialSkinMatrix,x=0;x<k.bones.length;x++){const h=k.bones[x],q=k.bones[x].index;let Y=null;h.parentBoneIndex>-1&&(Y=o.bones[h.parentBoneIndex]);const J=h.rest?I.Matrix.Uh(h.rest):null,G=new l.d(h.name,o,Y,I.Matrix.Uh(h.matrix),J,null,q);void 0!==h.id&&null!==h.id&&(G.id=h.id),h.length&&(G.length=h.length),h.metadata&&(G.metadata=h.metadata),h.animation&&G.animations.push(a.c.Parse(h.animation)),void 0!==h.linkedTransformNodeId&&null!==h.linkedTransformNodeId&&(o._hasWaitingData=!0,G._waitingTransformNodeId=h.linkedTransformNodeId)}if(k.ranges)for(x=0;x<k.ranges.length;x++){const h=k.ranges[x];o.createAnimationRange(h.name,h.from,h.to)}return o}computeAbsoluteMatrices(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||k)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(k)}getPoseMatrix(){let k=null;return this._meshesWithPoseMatrix.length>0&&(k=this._meshesWithPoseMatrix[0].getPoseMatrix()),k}sortBones(){const k=[],h=new Array(this.bones.length);for(let o=0;o<this.bones.length;o++)this._sortBones(o,k,h);this.bones=k}_sortBones(k,h,o){if(o[k])return;o[k]=!0;const x=this.bones[k];if(!x)return;void 0===x._index&&(x._index=k);const I=x.getParent();I&&this._sortBones(this.bones.indexOf(I),h,o),h.push(x)}setCurrentPoseAsRest(){for(const k of this.bones)k.setCurrentPoseAsRest()}}var M=o(11551),T=o(11749),j=o(11223),d=o(11648),b=o(11308),V=o(11703),i=o(11663),F=o(11696),R=o(11792),s=o(11330),Z=o(12822);class w{set areUpdatesFrozen(k){k?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new s.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,k||(k=X.b.LastCreatedScene),this._scene=k,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const k=this._scene.getEngine().getCaps();this._canUseTextureForTargets=k.canUseGLVertexID&&k.textureFloat&&k.maxVertexTextureImageUnits>0&&k.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return w.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?w.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(k){this._numMaxInfluencers!==k&&(this._numMaxInfluencers=k,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(k){this._useTextureToStoreTargets!==k&&(this._useTextureToStoreTargets=k,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var k;return w.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(k=this._scene)&&void 0!==k&&k.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(k){return this._activeTargets.data[k]}getTarget(k){return this._targets[k]}getTargetByName(k){for(const h of this._targets)if(h.name===k)return h;return null}addTarget(k){this._targets.push(k),this._targetInfluenceChangedObservers.push(k.onInfluenceChanged.add((k=>{this.areUpdatesFrozen&&k&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(k)}))),this._targetDataLayoutChangedObservers.push(k._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(k){const h=this._targets.indexOf(k);h>=0&&(this._targets.splice(h,1),k.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(h,1)[0]),k._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(h,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(k)}_bind(k){k.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),k.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),k.setTexture("morphTargets",this._targetStoreTexture),k.setInt("morphTargetCount",this.numInfluencers)}clone(){const k=new w(this._scene);for(const h of this._targets)k.addTarget(h.clone());return k.enablePositionMorphing=this.enablePositionMorphing,k.enableNormalMorphing=this.enableNormalMorphing,k.enableTangentMorphing=this.enableTangentMorphing,k.enableUVMorphing=this.enableUVMorphing,k.enableUV2Morphing=this.enableUV2Morphing,k.enableColorMorphing=this.enableColorMorphing,k}serialize(){const k={};k.id=this.uniqueId,k.targets=[];for(const h of this._targets)k.targets.push(h.serialize());return k}_syncActiveTargets(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const h=!!this._targetStoreTexture,o=this.isUsingTextureForTargets;(this._mustSynchronize||h!==o)&&(this._mustSynchronize=!1,this.synchronize());let x=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let I=-1;for(const q of this._targets)if(I++,0!==q.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=w.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(q),this._morphTargetTextureIndices[x]=I,this._tempInfluences[x++]=q.influence}this._morphTargetTextureIndices.length!==x&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,x)),this._influences&&this._influences.length===x||(this._influences=new Float32Array(x));for(let q=0;q<x;q++)this._influences[q]=this._tempInfluences[q];if(k&&this._scene)for(const q of this._scene.meshes)q.morphTargetManager===this&&(o?q._markSubMeshesAsAttributesDirty():q._syncGeometryWithMorphTargetManager())}synchronize(){var k;if(!this._scene||this.areUpdatesFrozen)return;const h=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(k=this._targetStoreTexture)||void 0===k||k.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>h.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const o of this._targets){this._supportsPositions=this._supportsPositions&&o.hasPositions,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents,this._supportsUVs=this._supportsUVs&&o.hasUVs,this._supportsUV2s=this._supportsUV2s&&o.hasUV2s,this._supportsColors=this._supportsColors&&o.hasColors;const k=o.vertexCount;if(0===this._vertexCount)this._vertexCount=k;else if(this._vertexCount!==k)return void c.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${o.name}": ${k}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const k=h.getCaps().maxTextureSize;this._textureWidth>k&&(this._textureHeight=Math.ceil(this._textureWidth/k),this._textureWidth=k);const o=this._targets.length,x=new Float32Array(o*this._textureWidth*this._textureHeight*4);let I=0;for(let h=0;h<o;h++){const k=this._targets[h],o=k.getPositions(),q=k.getNormals(),Y=k.getUVs(),J=k.getTangents(),G=k.getUV2s(),l=k.getColors();I=h*this._textureWidth*this._textureHeight*4;for(let h=0;h<this._vertexCount;h++)this._supportsPositions&&o&&(x[I]=o[3*h],x[I+1]=o[3*h+1],x[I+2]=o[3*h+2],I+=4),this._supportsNormals&&q&&(x[I]=q[3*h],x[I+1]=q[3*h+1],x[I+2]=q[3*h+2],I+=4),this._supportsUVs&&Y&&(x[I]=Y[2*h],x[I+1]=Y[2*h+1],I+=4),this._supportsTangents&&J&&(x[I]=J[3*h],x[I+1]=J[3*h+1],x[I+2]=J[3*h+2],I+=4),this._supportsUV2s&&G&&(x[I]=G[2*h],x[I+1]=G[2*h+1],I+=4),this._supportsColors&&l&&(x[I]=l[4*h],x[I+1]=l[4*h+1],x[I+2]=l[4*h+2],x[I+3]=l[4*h+3],I+=4)}this._targetStoreTexture=Z.e.CreateRGBATexture(x,this._textureWidth,this._textureHeight,o,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const o of this._scene.meshes)o.morphTargetManager===this&&o._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const k=this._parentContainer.morphTargetManagers.indexOf(this);k>-1&&this._parentContainer.morphTargetManagers.splice(k,1),this._parentContainer=null}for(const k of this._targets)this._scene.stopAnimation(k)}}static Parse(k,h){const o=new w(h);for(const x of k.targets)o.addTarget(R.e.Parse(x,h));return o}}w.EnableTextureStorage=!0,w.MaxActiveMorphTargetsInVertexAttributeMode=8,w.ConstantTargetCountForTextureMode=0;var D=o(12872),U=o(11127),Q=o(11565);const B=new Map,E=B;function n(k,h,o){H(k)&&c.c.Warn(`Extension with the name '${k}' already exists`),B.set(k,{isGLTFExtension:h,factory:o})}function H(k){return B.delete(k)}var y=o(12887),O=o(11845),z=o(11323);class p{static Get(k,h,o){if(!h||void 0==o||!h[o])throw new Error(`${k}: Failed to find index (${o})`);return h[o]}static TryGet(k,h){return k&&void 0!=h&&k[h]?k[h]:null}static Assign(k){if(k)for(let h=0;h<k.length;h++)k[h].index=h}}function v(k){if(k.min&&k.max){const h=k.min,o=k.max,x=I.TmpVectors.Vh[0].VJ(h[0],h[1],h[2]),q=I.TmpVectors.Vh[1].VJ(o[0],o[1],o[2]);if(k.normalized&&5126!==k.componentType){let h=1;switch(k.componentType){case 5120:h=127;break;case 5121:h=255;break;case 5122:h=32767;break;case 5123:h=65535}const o=1/h;x.scaleInPlace(o),q.scaleInPlace(o)}return new Q.c(x,q)}return null}class m{static RegisterExtension(k,h){n(k,!1,h)}static UnregisterExtension(k){return H(k)}get Bh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(k){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=k}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((k=>k.dispose&&k.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(k,h,o,x,I,q){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=h,this._assetContainer=o,this._loadData(x);let q=null;if(k){const h={};if(this._gltf.nodes)for(const k of this._gltf.nodes)k.name&&(h[k.name]=k.index);q=(k instanceof Array?k:[k]).map((k=>{const o=h[k];if(void 0===o)throw new Error(`Failed to find node '${k}'`);return o}))}return await this._loadAsync(I,Y,q,(()=>({meshes:this._getMeshes(),ka:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(k,h,o,x){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=k,this._loadData(h),await this._loadAsync(o,I,null,(()=>{}))}async _loadAsync(k,h,o,x){return await Promise.resolve().then((async()=>{this._rootUrl=k,this._uniqueRootUrl=!k.startsWith("file:")&&h?k:`${k}${Date.now()}/`,this._fileName=h,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const I=`${D.m[D.m.LOADING]} => ${D.m[D.m.READY]}`,q=`${D.m[D.m.LOADING]} => ${D.m[D.m.COMPLETE]}`;this._parent._startPerformanceCounter(I),this._parent._startPerformanceCounter(q),this._parent._setState(D.m.LOADING),this._extensionsOnLoading();const J=new Array;if(!this.parent.loadOnlyMaterials)if(o)J.push(this.loadSceneAsync("/nodes",{nodes:o,index:-1}));else if(void 0!=this._gltf.Fh||this._gltf.scenes&&this._gltf.scenes[0]){const k=p.Get("/scene",this._gltf.scenes,this._gltf.Fh||0);J.push(this.loadSceneAsync(`/scenes/${k.index}`,k))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let k=0;k<this._gltf.materials.length;++k){const h=this._gltf.materials[k],o="/materials/"+k,x=M.e.TriangleFillMode;J.push(this._loadMaterialAsync(o,h,null,x,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&J.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&J.push(this._compileShadowGeneratorsAsync());const G=Promise.all(J).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.tJ(!0);for(const k of this._babylonScene.materials){const h=k;void 0!==h.maxSimultaneousLights&&(h.maxSimultaneousLights=Math.max(h.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(D.m.READY),this._skipStartAnimationStep||this._startAnimations(),x()}));return await G.then((k=>(this._parent._endPerformanceCounter(I),Y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(q),this._parent._setState(D.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(k=>{this._parent.onErrorObservable.notifyObservers(k),this._parent.onErrorObservable.clear(),this.dispose()}))})),k)))})).catch((k=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(k),this._parent.onErrorObservable.clear(),this.dispose()),k}))}_loadData(k){if(this._gltf=k.json,this._setupData(),k.bin){const h=this._gltf.buffers;if(h&&h[0]&&!h[0].uri){const o=h[0];(o.byteLength<k.bin.byteLength-3||o.byteLength>k.bin.byteLength)&&c.c.Warn(`Binary buffer length (${o.byteLength}) from JSON does not match chunk length (${k.bin.byteLength})`),this._bin=k.bin}else c.c.Warn("Unexpected BIN chunk")}}_setupData(){if(p.Assign(this._gltf.accessors),p.Assign(this._gltf.animations),p.Assign(this._gltf.buffers),p.Assign(this._gltf.bufferViews),p.Assign(this._gltf.cameras),p.Assign(this._gltf.images),p.Assign(this._gltf.materials),p.Assign(this._gltf.meshes),p.Assign(this._gltf.nodes),p.Assign(this._gltf.samplers),p.Assign(this._gltf.scenes),p.Assign(this._gltf.skins),p.Assign(this._gltf.textures),this._gltf.nodes){const k={};for(const o of this._gltf.nodes)if(o.children)for(const h of o.children)k[h]=o.index;const h=this._createRootNode();for(const o of this._gltf.nodes){const x=k[o.index];o.parent=void 0===x?h:this._gltf.nodes[x]}}}async _loadExtensionsAsync(){const k=[];if(E.forEach(((h,o)=>{var x;!1===(null===(x=this.parent.extensionOptions[o])||void 0===x?void 0:x.enabled)?h.isGLTFExtension&&this.isExtensionUsed(o)&&c.c.Warn(`Extension ${o} is used but has been explicitly disabled.`):h.isGLTFExtension&&!this.isExtensionUsed(o)||k.push((async()=>{const k=await h.factory(this);return k.name!==o&&c.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${k.name} !== ${o}`),this._parent.onExtensionLoadedObservable.notifyObservers(k),k})())})),this._extensions.push(...await Promise.all(k)),this._extensions.sort(((k,h)=>(k.order||Number.MAX_VALUE)-(h.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const o of this._gltf.extensionsRequired){if(!this._extensions.some((k=>k.name===o&&k.enabled))){var h;if(!1===(null===(h=this.parent.extensionOptions[o])||void 0===h?void 0:h.enabled))throw new Error(`Required extension ${o} is disabled`);throw new Error(`Required extension ${o} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new F.e("__root__",this._babylonScene);this._rootBabylonMesh=k,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.tJ(!1);const h={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case D.i.AUTO:this._babylonScene.useRightHandedSystem||(h.rotation=[0,1,0,0],h.scale=[1,1,-1],m._LoadTransform(h,this._rootBabylonMesh));break;case D.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(k),h}loadSceneAsync(k,h){const o=this._extensionsLoadSceneAsync(k,h);if(o)return o;const x=new Array;if(this.logOpen(`${k} ${h.name||""}`),h.nodes)for(const I of h.nodes){const h=p.Get(`${k}/nodes/${I}`,this._gltf.nodes,I);x.push(this.loadNodeAsync(`/nodes/${h.index}`,h,(k=>{k.parent=this._rootBabylonMesh})))}for(const I of this._postSceneLoadActions)I();return x.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(x).then((()=>{}))}_forEachPrimitive(k,h){if(k._primitiveBabylonMeshes)for(const o of k._primitiveBabylonMeshes)h(o)}_getGeometries(){const k=[],h=this._gltf.nodes;if(h)for(const o of h)this._forEachPrimitive(o,(h=>{const o=h.jJ;o&&-1===k.indexOf(o)&&k.push(o)}));return k}_getMeshes(){const k=[];this._rootBabylonMesh instanceof i.d&&k.push(this._rootBabylonMesh);const h=this._gltf.nodes;if(h)for(const o of h)this._forEachPrimitive(o,(h=>{k.push(h)}));return k}_getTransformNodes(){const k=[],h=this._gltf.nodes;if(h)for(const o of h)o._babylonTransformNode&&"dX"===o._babylonTransformNode.getClassName()&&k.push(o._babylonTransformNode),o._babylonTransformNodeForSkin&&k.push(o._babylonTransformNodeForSkin);return k}_getSkeletons(){const k=[],h=this._gltf.skins;if(h)for(const o of h)o._data&&k.push(o._data.babylonSkeleton);return k}_getAnimationGroups(){const k=[],h=this._gltf.animations;if(h)for(const o of h)o._babylonAnimationGroup&&k.push(o._babylonAnimationGroup);return k}_startAnimations(){switch(this._parent.animationStartMode){case D.h.NONE:break;case D.h.FIRST:{const k=this._getAnimationGroups();0!==k.length&&k[0].start(!0);break}case D.h.ALL:{const k=this._getAnimationGroups();for(const h of k)h.start(!0);break}default:return void c.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadNodeAsync(k,h,o);if(x)return x;if(h._babylonTransformNode)throw new Error(`${k}: Invalid recursive node hierarchy`);const I=new Array;this.logOpen(`${k} ${h.name||""}`);const q=x=>{if(m.AddPointerMetadata(x,k),m._LoadTransform(h,x),void 0!=h.camera){const o=p.Get(`${k}/camera`,this._gltf.cameras,h.camera);I.push(this.loadCameraAsync(`/cameras/${o.index}`,o,(k=>{k.parent=x,this._babylonScene.useRightHandedSystem||(x.iJ.x=-1)})))}if(h.children)for(const o of h.children){const h=p.Get(`${k}/children/${o}`,this._gltf.nodes,o);I.push(this.loadNodeAsync(`/nodes/${h.index}`,h,(k=>{k.parent=x})))}o(x)},Y=void 0!=h.mesh,J=this._parent.loadSkins&&void 0!=h.skin;if(!Y||J){const k=h.name||`node${h.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new d.e(k,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==h.mesh?h._babylonTransformNode=o:h._babylonTransformNodeForSkin=o,q(o)}if(Y)if(J){const o=p.Get(`${k}/mesh`,this._gltf.meshes,h.mesh);I.push(this._loadMeshAsync(`/meshes/${o.index}`,h,o,(o=>{const x=h._babylonTransformNodeForSkin;o.metadata=(0,O.d)(x.metadata,o.metadata||{});const q=p.Get(`${k}/skin`,this._gltf.skins,h.skin);I.push(this._loadSkinAsync(`/skins/${q.index}`,h,q,(k=>{this._forEachPrimitive(h,(h=>{h.skeleton=k})),this._postSceneLoadActions.push((()=>{if(void 0!=q.skeleton){const k=p.Get(`/skins/${q.index}/skeleton`,this._gltf.nodes,q.skeleton).parent;h.index===k.index?o.parent=x.parent:o.parent=k._babylonTransformNode}else o.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:x,skinnedNode:o})}))})))})))}else{const o=p.Get(`${k}/mesh`,this._gltf.meshes,h.mesh);I.push(this._loadMeshAsync(`/meshes/${o.index}`,h,o,q))}return this.logClose(),Promise.all(I).then((()=>(this._forEachPrimitive(h,(k=>{const h=k;!h.isAnInstance&&h.jJ&&h.jJ.useBoundingInfoFromGeometry?k.Bk():k.refreshBoundingInfo(!0,!0)})),h._babylonTransformNode)))}_loadMeshAsync(k,h,o,x){const I=o.primitives;if(!I||!I.length)throw new Error(`${k}: Primitives are missing`);void 0==I[0].index&&p.Assign(I);const q=new Array;this.logOpen(`${k} ${o.name||""}`);const Y=h.name||`node${h.index}`;if(1===I.length){const x=o.primitives[0];q.push(this._loadMeshPrimitiveAsync(`${k}/primitives/${x.index}`,Y,h,o,x,(k=>{h._babylonTransformNode=k,h._primitiveBabylonMeshes=[k]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,h._babylonTransformNode=new d.e(Y,this._babylonScene),h._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._primitiveBabylonMeshes=[];for(const x of I)q.push(this._loadMeshPrimitiveAsync(`${k}/primitives/${x.index}`,`${Y}_primitive${x.index}`,h,o,x,(k=>{k.parent=h._babylonTransformNode,h._primitiveBabylonMeshes.push(k)})))}return x(h._babylonTransformNode),this.logClose(),Promise.all(q).then((()=>h._babylonTransformNode))}_loadMeshPrimitiveAsync(k,h,o,x,I,q){const Y=this._extensionsLoadMeshPrimitiveAsync(k,h,o,x,I,q);if(Y)return Y;this.logOpen(`${k}`);const J=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==o.skin&&!x.primitives[0].targets;let G,l;if(J&&I._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,G=I._instanceData.babylonSourceMesh.createInstance(h),G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l=I._instanceData.promise;else{const q=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new F.e(h,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.sideOrientation=this._babylonScene.useRightHandedSystem?M.e.CounterClockWiseSideOrientation:M.e.ClockWiseSideOrientation,this._createMorphTargets(k,o,x,I,Y),q.push(this._loadVertexDataAsync(k,I,Y).then((async h=>await this._loadMorphTargetsAsync(k,I,Y,h).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,h.Uk(Y),h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const A=m._GetDrawMode(k,I.mode);if(void 0==I.material){let k=this._defaultBabylonMaterialData[A];k||(k=this._createDefaultMaterial("__GLTFLoader._default",A),this._parent.onMaterialLoadedObservable.notifyObservers(k),this._defaultBabylonMaterialData[A]=k),Y.material=k}else if(!this.parent.skipMaterials){const h=p.Get(`${k}/material`,this._gltf.materials,I.material);q.push(this._loadMaterialAsync(`/materials/${h.index}`,h,Y,A,(k=>{Y.material=k})))}l=Promise.all(q),J&&(I._instanceData={babylonSourceMesh:Y,promise:l}),G=Y}return m.AddPointerMetadata(G,k),this._parent.onMeshLoadedObservable.notifyObservers(G),q(G),this.logClose(),l.then((()=>G))}_loadVertexDataAsync(k,h,o){const x=this._extensionsLoadVertexDataAsync(k,h,o);if(x)return x;const I=h.attributes;if(!I)throw new Error(`${k}: Attributes are missing`);const q=new Array,Y=new V.b(o.name,this._babylonScene);if(void 0==h.indices)o.isUnIndexed=!0;else{const o=p.Get(`${k}/indices`,this._gltf.accessors,h.indices);q.push(this._loadIndicesAccessorAsync(`/accessors/${o.index}`,o).then((k=>{Y.setIndices(k)})))}const J=(h,x,J)=>{if(void 0==I[h])return;o._delayInfo=o._delayInfo||[],-1===o._delayInfo.indexOf(x)&&o._delayInfo.push(x);const G=p.Get(`${k}/attributes/${h}`,this._gltf.accessors,I[h]);q.push(this._loadVertexAccessorAsync(`/accessors/${G.index}`,G,x).then((k=>{if(k.getKind()===b.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!o.skeleton){const k=v(G);k&&(Y._boundingInfo=k,Y.useBoundingInfoFromGeometry=!0)}Y.setVerticesBuffer(k,G.count)}))),x==b.g.MatricesIndicesExtraKind&&(o.numBoneInfluencers=8),J&&J(G)};return J("POSITION",b.g.PositionKind),J("NORMAL",b.g.NormalKind),J("TANGENT",b.g.TangentKind),J("TEXCOORD_0",b.g.UVKind),J("TEXCOORD_1",b.g.UV2Kind),J("TEXCOORD_2",b.g.UV3Kind),J("TEXCOORD_3",b.g.UV4Kind),J("TEXCOORD_4",b.g.UV5Kind),J("TEXCOORD_5",b.g.UV6Kind),J("JOINTS_0",b.g.MatricesIndicesKind),J("WEIGHTS_0",b.g.MatricesWeightsKind),J("JOINTS_1",b.g.MatricesIndicesExtraKind),J("WEIGHTS_1",b.g.MatricesWeightsExtraKind),J("COLOR_0",b.g.ColorKind,(k=>{"VEC4"===k.type&&(o.hasVertexAlpha=!0)})),Promise.all(q).then((()=>Y))}_createMorphTargets(k,h,o,x,I){if(!x.targets||!this._parent.loadMorphTargets)return;if(void 0==h._numMorphTargets)h._numMorphTargets=x.targets.length;else if(x.targets.length!==h._numMorphTargets)throw new Error(`${k}: Primitives do not have the same number of targets`);const q=o.extras?o.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,I.morphTargetManager=new w(this._babylonScene),I.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I.morphTargetManager.areUpdatesFrozen=!0;for(let Y=0;Y<x.targets.length;Y++){const k=h.weights?h.weights[Y]:o.weights?o.weights[Y]:0,x=q?q[Y]:`morphTarget${Y}`;I.morphTargetManager.addTarget(new R.e(x,k,I.ik()))}}_loadMorphTargetsAsync(k,h,o,x){if(!h.targets||!this._parent.loadMorphTargets)return Promise.resolve();const I=new Array,q=o.morphTargetManager;for(let Y=0;Y<q.numTargets;Y++){const o=q.getTarget(Y);I.push(this._loadMorphTargetVertexDataAsync(`${k}/targets/${Y}`,x,h.targets[Y],o))}return Promise.all(I).then((()=>{q.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(k,h,o,x){const I=new Array,q=(x,q,Y)=>{if(void 0==o[x])return;const J=h.getVertexBuffer(q);if(!J)return;const G=p.Get(`${k}/${x}`,this._gltf.accessors,o[x]);I.push(this._loadFloatAccessorAsync(`/accessors/${G.index}`,G).then((k=>{Y(J,k)})))};return q("POSITION",b.g.PositionKind,((k,h)=>{const o=new Float32Array(h.length);k.forEach(h.length,((k,x)=>{o[x]=h[x]+k})),x.setPositions(o)})),q("NORMAL",b.g.NormalKind,((k,h)=>{const o=new Float32Array(h.length);k.forEach(o.length,((k,x)=>{o[x]=h[x]+k})),x.setNormals(o)})),q("TANGENT",b.g.TangentKind,((k,h)=>{const o=new Float32Array(h.length/3*4);let I=0;k.forEach(h.length/3*4,((k,x)=>{(x+1)%4!==0&&(o[I]=h[I]+k,I++)})),x.setTangents(o)})),q("TEXCOORD_0",b.g.UVKind,((k,h)=>{const o=new Float32Array(h.length);k.forEach(h.length,((k,x)=>{o[x]=h[x]+k})),x.setUVs(o)})),q("TEXCOORD_1",b.g.UV2Kind,((k,h)=>{const o=new Float32Array(h.length);k.forEach(h.length,((k,x)=>{o[x]=h[x]+k})),x.setUV2s(o)})),q("COLOR_0",b.g.ColorKind,((h,o)=>{let I=null;const q=h.getSize();if(3===q){I=new Float32Array(o.length/3*4),h.forEach(o.length,((k,h)=>{const x=Math.floor(h/3),q=h%3;I[4*x+q]=o[3*x+q]+k}));for(let k=0;k<o.length/3;++k)I[4*k+3]=1}else{if(4!==q)throw new Error(`${k}: Invalid number of components (${q}) for COLOR_0 attribute`);I=new Float32Array(o.length),h.forEach(o.length,((k,h)=>{I[h]=o[h]+k}))}x.setColors(I)})),await Promise.all(I).then((()=>{}))}static _LoadTransform(k,h){if(void 0!=k.skin)return;let o=I.Vh.Zero(),x=I.Quaternion.Identity(),q=I.Vh.One();if(k.matrix){I.Matrix.Uh(k.matrix).decompose(q,x,o)}else k.translation&&(o=I.Vh.Uh(k.translation)),k.rotation&&(x=I.Quaternion.Uh(k.rotation)),k.scale&&(q=I.Vh.Uh(k.scale));h.position=o,h.rotationQuaternion=x,h.iJ=q}_loadSkinAsync(k,h,o,x){if(!this._parent.loadSkins)return Promise.resolve();const I=this._extensionsLoadSkinAsync(k,h,o);if(I)return I;if(o._data)return x(o._data.babylonSkeleton),o._data.promise;const q=`skeleton${o.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new f(o.name||q,q,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(k,o,Y);const J=this._loadSkinInverseBindMatricesDataAsync(k,o).then((k=>{this._updateBoneMatrices(Y,k)}));return o._data={babylonSkeleton:Y,promise:J},x(Y),J}_loadBones(k,h,o){if(void 0==h.skeleton||this._parent.alwaysComputeSkeletonRootNode){const o=this._findSkeletonRootNode(`${k}/joints`,h.joints);if(o)if(void 0===h.skeleton)h.skeleton=o.index;else{const x=(k,h)=>{for(;h.parent;h=h.parent)if(h.parent===k)return!0;return!1},I=p.Get(`${k}/skeleton`,this._gltf.nodes,h.skeleton);I===o||x(I,o)||(c.c.Warn(`${k}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),h.skeleton=o.index)}else c.c.Warn(`${k}: Failed to find common root`)}const x={};for(const I of h.joints){const q=p.Get(`${k}/joints/${I}`,this._gltf.nodes,I);this._loadBone(q,h,o,x)}}_findSkeletonRootNode(k,h){if(0===h.length)return null;const o={};for(const I of h){const h=[];let x=p.Get(`${k}/${I}`,this._gltf.nodes,I);for(;-1!==x.index;)h.unshift(x),x=x.parent;o[I]=h}let x=null;for(let I=0;;++I){let k=o[h[0]];if(I>=k.length)return x;const q=k[I];for(let Y=1;Y<h.length;++Y)if(k=o[h[Y]],I>=k.length||q!==k[I])return x;x=q}}_loadBone(k,h,o,x){k._isJoint=!0;let I=x[k.index];if(I)return I;let q=null;k.index!==h.skeleton&&(k.parent&&-1!==k.parent.index?q=this._loadBone(k.parent,h,o,x):void 0!==h.skeleton&&c.c.Warn(`/skins/${h.index}/skeleton: Skeleton node is not a common root`));const Y=h.joints.indexOf(k.index);return I=new l.d(k.name||`joint${k.index}`,o,q,this._getNodeMatrix(k),null,null,Y),x[k.index]=I,this._postSceneLoadActions.push((()=>{I.linkTransformNode(k._babylonTransformNode)})),I}_loadSkinInverseBindMatricesDataAsync(k,h){if(void 0==h.inverseBindMatrices)return Promise.resolve(null);const o=p.Get(`${k}/inverseBindMatrices`,this._gltf.accessors,h.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${o.index}`,o)}_updateBoneMatrices(k,h){for(const o of k.bones){const k=I.Matrix.Identity(),x=o._index;h&&-1!==x&&(I.Matrix.FromArrayToRef(h,16*x,k),k.invertToRef(k));const q=o.getParent();q&&k.multiplyToRef(q.getAbsoluteInverseBindMatrix(),k),o.qq(k,!1,!1),o._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(k){return k.matrix?I.Matrix.Uh(k.matrix):I.Matrix.Compose(k.scale?I.Vh.Uh(k.scale):I.Vh.One(),k.rotation?I.Quaternion.Uh(k.rotation):I.Quaternion.Identity(),k.translation?I.Vh.Uh(k.translation):I.Vh.Zero())}loadCameraAsync(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadCameraAsync(k,h,o);if(x)return x;const q=new Array;this.logOpen(`${k} ${h.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new G.b(h.name||`camera${h.index}`,I.Vh.Zero(),this._babylonScene,!1);switch(Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._babylonCamera=Y,Y.setTarget(new I.Vh(0,0,-1)),h.type){case"perspective":{const o=h.perspective;if(!o)throw new Error(`${k}: Camera perspective properties are missing`);Y.fov=o.yfov,Y.nx=o.znear,Y.maxZ=o.zfar||0;break}case"orthographic":if(!h.orthographic)throw new Error(`${k}: Camera orthographic properties are missing`);Y.mode=J.d.ORTHOGRAPHIC_CAMERA,Y.orthoLeft=-h.orthographic.xmag,Y.orthoRight=h.orthographic.xmag,Y.orthoBottom=-h.orthographic.ymag,Y.orthoTop=h.orthographic.ymag,Y.nx=h.orthographic.znear,Y.maxZ=h.orthographic.zfar;break;default:throw new Error(`${k}: Invalid camera type (${h.type})`)}return m.AddPointerMetadata(Y,k),this._parent.onCameraLoadedObservable.notifyObservers(Y),o(Y),this.logClose(),Promise.all(q).then((()=>Y))}_loadAnimationsAsync(){const k=this._gltf.animations;if(!k)return Promise.resolve();const h=new Array;for(let o=0;o<k.length;o++){const x=k[o];h.push(this.loadAnimationAsync(`/animations/${x.index}`,x).then((k=>{0===k.targetedAnimations.length&&k.dispose()})))}return Promise.all(h).then((()=>{}))}loadAnimationAsync(k,h){const x=this._extensionsLoadAnimationAsync(k,h);return x||o.e(78).then(o.bind(o,14354)).then((o=>{let{AnimationGroup:x}=o;this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new x(h.name||`animation${h.index}`,this._babylonScene);I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._babylonAnimationGroup=I;const q=new Array;p.Assign(h.channels),p.Assign(h.samplers);for(const Y of h.channels)q.push(this._loadAnimationChannelAsync(`${k}/channels/${Y.index}`,k,h,Y,((k,h)=>{k.animations=k.animations||[],k.animations.push(h),I.addTargetedAnimation(h,k)})));return Promise.all(q).then((()=>(I.normalize(0),I)))}))}async _loadAnimationChannelAsync(k,h,x,I,q){const Y=this._extensionsLoadAnimationChannelAsync(k,h,x,I,q);if(Y)return await Y;if(void 0==I.target.node)return await Promise.resolve();const J=p.Get(`${k}/target/node`,this._gltf.nodes,I.target.node),G=I.target.path,l="weights"===G;if(l&&!J._numMorphTargets||!l&&!J._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!l&&!J._isJoint)return await Promise.resolve();let A;switch(await Promise.resolve().then(o.bind(o,12893)),G){case"translation":var K;A=null===(K=(0,y.h)("/nodes/{}/translation"))||void 0===K?void 0:K.interpolation;break;case"rotation":var a;A=null===(a=(0,y.h)("/nodes/{}/rotation"))||void 0===a?void 0:a.interpolation;break;case"scale":var N;A=null===(N=(0,y.h)("/nodes/{}/scale"))||void 0===N?void 0:N.interpolation;break;case"weights":var X;A=null===(X=(0,y.h)("/nodes/{}/weights"))||void 0===X?void 0:X.interpolation;break;default:throw new Error(`${k}/target/path: Invalid value (${I.target.path})`)}if(!A)throw new Error(`${k}/target/path: Could not find interpolation properties for target path (${I.target.path})`);const c={object:J,info:A};return await this._loadAnimationChannelFromTargetInfoAsync(k,h,x,I,c,q)}_loadAnimationChannelFromTargetInfoAsync(k,h,o,x,I,q){const Y=this.parent.targetFps,J=1/Y,G=p.Get(`${k}/sampler`,o.samplers,x.sampler);return this._loadAnimationSamplerAsync(`${h}/samplers/${x.sampler}`,G).then((k=>{let h=0;const G=I.object,l=I.info;for(const I of l){const l=I.getStride(G),A=k.input,K=k.output,a=new Array(A.length);let N=0;switch(k.interpolation){case"STEP":for(let k=0;k<A.length;k++){const h=I.getValue(G,K,N,1);N+=l,a[k]={frame:A[k]*Y,value:h,interpolation:1}}break;case"CUBICSPLINE":for(let k=0;k<A.length;k++){const h=I.getValue(G,K,N,J);N+=l;const o=I.getValue(G,K,N,1);N+=l;const x=I.getValue(G,K,N,J);N+=l,a[k]={frame:A[k]*Y,inTangent:h,value:o,outTangent:x}}break;case"LINEAR":for(let k=0;k<A.length;k++){const h=I.getValue(G,K,N,1);N+=l,a[k]={frame:A[k]*Y,value:h}}}if(N>0){const k=`${o.name||`animation${o.index}`}_channel${x.index}_${h}`,J=I.buildAnimations(G,k,Y,a);for(const o of J)h++,q(o.babylonAnimatable,o.babylonAnimation)}}}))}_loadAnimationSamplerAsync(k,h){if(h._data)return h._data;const o=h.interpolation||"LINEAR";switch(o){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${k}/interpolation: Invalid value (${h.interpolation})`)}const x=p.Get(`${k}/input`,this._gltf.accessors,h.input),I=p.Get(`${k}/output`,this._gltf.accessors,h.output);return h._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${x.index}`,x),this._loadFloatAccessorAsync(`/accessors/${I.index}`,I)]).then((k=>{let[h,x]=k;return{input:h,interpolation:o,output:x}})),h._data}loadBufferAsync(k,h,o,x){const I=this._extensionsLoadBufferAsync(k,h,o,x);if(I)return I;if(!h._data)if(h.uri)h._data=this.loadUriAsync(`${k}/uri`,h,h.uri);else{if(!this._bin)throw new Error(`${k}: Uri is missing or the binary glTF is missing its binary chunk`);h._data=this._bin.readAsync(0,h.byteLength)}return h._data.then((h=>{try{return new Uint8Array(h.buffer,h.byteOffset+o,x)}catch(I){throw new Error(`${k}: ${I.message}`)}}))}loadBufferViewAsync(k,h){const o=this._extensionsLoadBufferViewAsync(k,h);if(o)return o;if(h._data)return h._data;const x=p.Get(`${k}/buffer`,this._gltf.buffers,h.buffer);return h._data=this.loadBufferAsync(`/buffers/${x.index}`,x,h.byteOffset||0,h.byteLength),h._data}_loadAccessorAsync(k,h,o){if(h._data)return h._data;const x=m._GetNumComponents(k,h.type),I=x*b.g.GetTypeByteLength(h.componentType),q=x*h.count;if(void 0==h.bufferView)h._data=Promise.resolve(new o(q));else{const Y=p.Get(`${k}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((J=>{if(5126!==h.componentType||h.normalized||Y.byteStride&&Y.byteStride!==I){const k=new o(q);return b.g.ForEach(J,h.byteOffset||0,Y.byteStride||I,x,h.componentType,k.length,h.normalized||!1,((h,o)=>{k[o]=h})),k}return m._GetTypedArray(k,h.componentType,J,h.byteOffset,q)}))}if(h.sparse){const q=h.sparse;h._data=h._data.then((Y=>{const J=Y,G=p.Get(`${k}/sparse/indices/bufferView`,this._gltf.bufferViews,q.indices.bufferView),l=p.Get(`${k}/sparse/values/bufferView`,this._gltf.bufferViews,q.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${G.index}`,G),this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)]).then((Y=>{let[G,l]=Y;const A=m._GetTypedArray(`${k}/sparse/indices`,q.indices.componentType,G,q.indices.byteOffset,q.count),K=x*q.count;let a;if(5126!==h.componentType||h.normalized){const Y=m._GetTypedArray(`${k}/sparse/values`,h.componentType,l,q.values.byteOffset,K);a=new o(K),b.g.ForEach(Y,0,I,x,h.componentType,a.length,h.normalized||!1,((k,h)=>{a[h]=k}))}else a=m._GetTypedArray(`${k}/sparse/values`,h.componentType,l,q.values.byteOffset,K);let N=0;for(let k=0;k<A.length;k++){let h=A[k]*x;for(let k=0;k<x;k++)J[h++]=a[N++]}return J}))}))}return h._data}_loadFloatAccessorAsync(k,h){return this._loadAccessorAsync(k,h,Float32Array)}_loadIndicesAccessorAsync(k,h){if("SCALAR"!==h.type)throw new Error(`${k}/type: Invalid value ${h.type}`);if(5121!==h.componentType&&5123!==h.componentType&&5125!==h.componentType)throw new Error(`${k}/componentType: Invalid value ${h.componentType}`);if(h._data)return h._data;if(h.sparse){const o=m._GetTypedArrayConstructor(`${k}/componentType`,h.componentType);h._data=this._loadAccessorAsync(k,h,o)}else{const o=p.Get(`${k}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((o=>m._GetTypedArray(k,h.componentType,o,h.byteOffset,h.count)))}return h._data}_loadVertexBufferViewAsync(k){if(k._babylonBuffer)return k._babylonBuffer;const h=this._babylonScene.getEngine();return k._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${k.index}`,k).then((k=>new b.d(h,k,!1))),k._babylonBuffer}_loadVertexAccessorAsync(k,h,o){var x;if(null!==(x=h._babylonVertexBuffer)&&void 0!==x&&x[o])return h._babylonVertexBuffer[o];h._babylonVertexBuffer||(h._babylonVertexBuffer={});const I=this._babylonScene.getEngine();if(h.sparse||void 0==h.bufferView)h._babylonVertexBuffer[o]=this._loadFloatAccessorAsync(k,h).then((k=>new b.g(I,k,o,!1)));else{const x=p.Get(`${k}/bufferView`,this._gltf.bufferViews,h.bufferView);h._babylonVertexBuffer[o]=this._loadVertexBufferViewAsync(x).then((q=>{const Y=m._GetNumComponents(k,h.type);return new b.g(I,q,o,!1,void 0,x.byteStride,void 0,h.byteOffset,Y,h.componentType,h.normalized,!0,void 0,!0)}))}return h._babylonVertexBuffer[o]}_loadMaterialMetallicRoughnessPropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;return h&&(h.baseColorFactor?(o.albedoColor=q.Zh.Uh(h.baseColorFactor),o.alpha=h.baseColorFactor[3]):o.albedoColor=q.Zh.White(),o.metallic=void 0==h.metallicFactor?1:h.metallicFactor,o.roughness=void 0==h.roughnessFactor?1:h.roughnessFactor,h.baseColorTexture&&x.push(this.loadTextureInfoAsync(`${k}/baseColorTexture`,h.baseColorTexture,(k=>{k.name=`${o.name} (Base Color)`,o.albedoTexture=k}))),h.metallicRoughnessTexture&&(h.metallicRoughnessTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${k}/metallicRoughnessTexture`,h.metallicRoughnessTexture,(k=>{k.name=`${o.name} (Metallic Roughness)`,o.metallicTexture=k}))),o.useMetallnessFromMetallicTextureBlue=!0,o.useRoughnessFromMetallicTextureGreen=!0,o.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(x).then((()=>{}))}_loadMaterialAsync(k,h,o,x){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const q=this._extensionsLoadMaterialAsync(k,h,o,x,I);if(q)return q;h._data=h._data||{};let Y=h._data[x];if(!Y){this.logOpen(`${k} ${h.name||""}`);const o=this.createMaterial(k,h,x);Y={babylonMaterial:o,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(k,h,o)},h._data[x]=Y,m.AddPointerMetadata(o,k),this._parent.onMaterialLoadedObservable.notifyObservers(o),this.logClose()}return o&&(Y.babylonMeshes.push(o),o.sh.addOnce((()=>{const k=Y.babylonMeshes.indexOf(o);-1!==k&&Y.babylonMeshes.splice(k,1)}))),I(Y.babylonMaterial),Y.promise.then((()=>Y.babylonMaterial))}_createDefaultMaterial(k,h){this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new T.d(k,this._babylonScene);return o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.fillMode=h,o.enableSpecularAntiAliasing=!0,o.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,o.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,o.transparencyMode=T.d.PBRMATERIAL_OPAQUE,o.metallic=1,o.roughness=1,o}createMaterial(k,h,o){const x=this._extensionsCreateMaterial(k,h,o);if(x)return x;const I=h.name||`material${h.index}`;return this._createDefaultMaterial(I,o)}loadMaterialPropertiesAsync(k,h,o){const x=this._extensionsLoadMaterialPropertiesAsync(k,h,o);if(x)return x;const I=new Array;return I.push(this.loadMaterialBasePropertiesAsync(k,h,o)),h.pbrMetallicRoughness&&I.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${k}/pbrMetallicRoughness`,h.pbrMetallicRoughness,o)),this.loadMaterialAlphaProperties(k,h,o),Promise.all(I).then((()=>{}))}loadMaterialBasePropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;return o.emissiveColor=h.emissiveFactor?q.Zh.Uh(h.emissiveFactor):new q.Zh(0,0,0),h.doubleSided&&(o.bJ=!1,o.twoSidedLighting=!0),h.normalTexture&&(h.normalTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${k}/normalTexture`,h.normalTexture,(k=>{k.name=`${o.name} (Normal)`,o.bumpTexture=k}))),o.invertNormalMapX=!this._babylonScene.useRightHandedSystem,o.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=h.normalTexture.scale&&o.bumpTexture&&(o.bumpTexture.level=h.normalTexture.scale),o.forceIrradianceInFragment=!0),h.occlusionTexture&&(h.occlusionTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(`${k}/occlusionTexture`,h.occlusionTexture,(k=>{k.name=`${o.name} (Occlusion)`,o.ambientTexture=k}))),o.useAmbientInGrayScale=!0,void 0!=h.occlusionTexture.strength&&(o.ambientTextureStrength=h.occlusionTexture.strength)),h.emissiveTexture&&x.push(this.loadTextureInfoAsync(`${k}/emissiveTexture`,h.emissiveTexture,(k=>{k.name=`${o.name} (Emissive)`,o.emissiveTexture=k}))),Promise.all(x).then((()=>{}))}loadMaterialAlphaProperties(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);switch(h.alphaMode||"OPAQUE"){case"OPAQUE":o.transparencyMode=T.d.PBRMATERIAL_OPAQUE,o.alpha=1;break;case"MASK":o.transparencyMode=T.d.PBRMATERIAL_ALPHATEST,o.alphaCutOff=void 0==h.alphaCutoff?.5:h.alphaCutoff,o.albedoTexture&&(o.albedoTexture.Sh=!0);break;case"BLEND":o.transparencyMode=T.d.PBRMATERIAL_ALPHABLEND,o.albedoTexture&&(o.albedoTexture.Sh=!0,o.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${k}/alphaMode: Invalid value (${h.alphaMode})`)}}loadTextureInfoAsync(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadTextureInfoAsync(k,h,o);if(x)return x;if(this.logOpen(`${k}`),h.texCoord>=6)throw new Error(`${k}/texCoord: Invalid value (${h.texCoord})`);const I=p.Get(`${k}/index`,this._gltf.textures,h.index);I._textureInfo=h;const q=this._loadTextureAsync(`/textures/${h.index}`,I,(x=>{x.coordinatesIndex=h.texCoord||0,m.AddPointerMetadata(x,k),this._parent.onTextureLoadedObservable.notifyObservers(x),o(x)}));return this.logClose(),q}_loadTextureAsync(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const x=this._extensionsLoadTextureAsync(k,h,o);if(x)return x;this.logOpen(`${k} ${h.name||""}`);const I=void 0==h.sampler?m.DefaultSampler:p.Get(`${k}/sampler`,this._gltf.samplers,h.sampler),q=p.Get(`${k}/source`,this._gltf.images,h.source),Y=this._createTextureAsync(k,I,q,o,void 0,!h._textureInfo.nonColorData);return this.logClose(),Y}_createTextureAsync(k,h,o){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},q=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const J=this._loadSampler(`/samplers/${h.index}`,h),G=new Array,l=new x;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A={noMipmap:J.noMipMaps,invertY:!1,samplingMode:J.samplingMode,S:()=>{this._disposed||l.resolve()},onError:(h,o)=>{this._disposed||l.reject(new Error(`${k}: ${o&&o.message?o.message:h||"Failed to load texture"}`))},mimeType:o.mimeType??(0,U.g)(o.uri??""),loaderOptions:q,useSRGBBuffer:!!Y&&this._parent.useSRGBBuffers},K=new j.b(null,this._babylonScene,A);return K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.push(l.promise),G.push(this.loadImageAsync(`/images/${o.index}`,o).then((k=>{const h=o.uri||`${this._fileName}#image${o.index}`,x=`data:${this._uniqueRootUrl}${h}`;K.updateURL(x,k);const I=K.getInternalTexture();I&&(I.label=o.name)}))),K.wrapU=J.wrapU,K.wrapV=J.wrapV,I(K),this._parent.useGltfTextureNames&&(K.name=o.name||o.uri||`image${o.index}`),Promise.all(G).then((()=>K))}_loadSampler(k,h){return h._data||(h._data={noMipMaps:9728===h.minFilter||9729===h.minFilter,samplingMode:m._GetTextureSamplingMode(k,h),wrapU:m._GetTextureWrapMode(`${k}/wrapS`,h.wrapS),wrapV:m._GetTextureWrapMode(`${k}/wrapT`,h.wrapT)}),h._data}loadImageAsync(k,h){if(!h._data){if(this.logOpen(`${k} ${h.name||""}`),h.uri)h._data=this.loadUriAsync(`${k}/uri`,h,h.uri);else{const o=p.Get(`${k}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}this.logClose()}return h._data}loadUriAsync(k,h,o){const x=this._extensionsLoadUriAsync(k,h,o);if(x)return x;if(!m._ValidateUri(o))throw new Error(`${k}: '${o}' is invalid`);if((0,U.j)(o)){const h=new Uint8Array((0,U.c)(o));return this.log(`${k}: Decoded ${o.substring(0,64)}... (${h.length} bytes)`),Promise.resolve(h)}return this.log(`${k}: Loading ${o}`),this._parent.preprocessUrlAsync(this._rootUrl+o).then((h=>new Promise(((x,I)=>{this._parent._loadFile(this._babylonScene,h,(h=>{this._disposed||(this.log(`${k}: Loaded ${o} (${h.byteLength} bytes)`),x(new Uint8Array(h)))}),!0,(h=>{I(new U.k(`${k}: Failed to load '${o}'${h?": "+h.status+" "+h.statusText:""}`,h))}))}))))}static AddPointerMetadata(k,h){k.metadata=k.metadata||{};const o=k._internalMetadata=k._internalMetadata||{},x=o.Bh=o.Bh||{};(x.pointers=x.pointers||[]).push(h)}static _GetTextureWrapMode(k,h){switch(h=void 0==h?10497:h){case 33071:return j.b.CLAMP_ADDRESSMODE;case 33648:return j.b.MIRROR_ADDRESSMODE;case 10497:return j.b.WRAP_ADDRESSMODE;default:return c.c.Warn(`${k}: Invalid value (${h})`),j.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(k,h){const o=void 0==h.magFilter?9729:h.magFilter,x=void 0==h.minFilter?9987:h.minFilter;if(9729===o)switch(x){case 9728:return j.b.LINEAR_NEAREST;case 9729:return j.b.LINEAR_LINEAR;case 9984:return j.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return j.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return j.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return j.b.LINEAR_LINEAR_MIPLINEAR;default:return c.c.Warn(`${k}/minFilter: Invalid value (${x})`),j.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==o&&c.c.Warn(`${k}/magFilter: Invalid value (${o})`),x){case 9728:return j.b.NEAREST_NEAREST;case 9729:return j.b.NEAREST_LINEAR;case 9984:return j.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return j.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return j.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return j.b.NEAREST_LINEAR_MIPLINEAR;default:return c.c.Warn(`${k}/minFilter: Invalid value (${x})`),j.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(k,h){try{return(0,z.k)(h)}catch(o){throw new Error(`${k}: ${o.message}`)}}static _GetTypedArray(k,h,o,x,I){const q=o.buffer;x=o.byteOffset+(x||0);const Y=m._GetTypedArrayConstructor(`${k}/componentType`,h),J=b.g.GetTypeByteLength(h);return x%J!==0?(c.c.Warn(`${k}: Copying buffer as byte offset (${x}) is not a multiple of component type byte length (${J})`),new Y(q.slice(x,x+I*J),0)):new Y(q,x,I)}static _GetNumComponents(k,h){switch(h){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${k}: Invalid type (${h})`)}static _ValidateUri(k){return Y.Tools.IsBase64(k)||-1===k.indexOf("..")}static _GetDrawMode(k,h){switch(void 0==h&&(h=4),h){case 0:return M.e.PointListDrawMode;case 1:return M.e.LineListDrawMode;case 2:return M.e.LineLoopDrawMode;case 3:return M.e.LineStripDrawMode;case 4:return M.e.TriangleFillMode;case 5:return M.e.TriangleStripDrawMode;case 6:return M.e.TriangleFanDrawMode}throw new Error(`${k}: Invalid mesh primitive mode (${h})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const k=new Array;if(this._gltf.materials)for(const h of this._gltf.materials)if(h._data)for(const o in h._data){const x=h._data[o];for(const h of x.babylonMeshes){h.eq(!0);const o=x.babylonMaterial;k.push(o.forceCompilationAsync(h)),k.push(o.forceCompilationAsync(h,{useInstances:!0})),this._parent.useClipPlane&&(k.push(o.forceCompilationAsync(h,{clipPlane:!0})),k.push(o.forceCompilationAsync(h,{clipPlane:!0,useInstances:!0})))}}return Promise.all(k).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const k=new Array,h=this._babylonScene.lights;for(const o of h){const h=o.getShadowGenerator();h&&k.push(h.forceCompilationAsync())}return Promise.all(k).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(k){for(const h of this._extensions)h.enabled&&k(h)}_applyExtensions(k,h,o){for(const x of this._extensions)if(x.enabled){const I=`${x.name}.${h}`,q=k;q._activeLoaderExtensionFunctions=q._activeLoaderExtensionFunctions||{};const Y=q._activeLoaderExtensionFunctions;if(!Y[I]){Y[I]=!0;try{const k=o(x);if(k)return k}finally{delete Y[I]}}}return null}_extensionsOnLoading(){this._forEachExtensions((k=>k.onLoading&&k.onLoading()))}_extensionsOnReady(){this._forEachExtensions((k=>k.onReady&&k.onReady()))}_extensionsLoadSceneAsync(k,h){return this._applyExtensions(h,"loadScene",(o=>o.loadSceneAsync&&o.loadSceneAsync(k,h)))}_extensionsLoadNodeAsync(k,h,o){return this._applyExtensions(h,"loadNode",(x=>x.loadNodeAsync&&x.loadNodeAsync(k,h,o)))}_extensionsLoadCameraAsync(k,h,o){return this._applyExtensions(h,"loadCamera",(x=>x.loadCameraAsync&&x.loadCameraAsync(k,h,o)))}_extensionsLoadVertexDataAsync(k,h,o){return this._applyExtensions(h,"loadVertexData",(x=>x._loadVertexDataAsync&&x._loadVertexDataAsync(k,h,o)))}_extensionsLoadMeshPrimitiveAsync(k,h,o,x,I,q){return this._applyExtensions(I,"loadMeshPrimitive",(Y=>Y._loadMeshPrimitiveAsync&&Y._loadMeshPrimitiveAsync(k,h,o,x,I,q)))}_extensionsLoadMaterialAsync(k,h,o,x,I){return this._applyExtensions(h,"loadMaterial",(q=>q._loadMaterialAsync&&q._loadMaterialAsync(k,h,o,x,I)))}_extensionsCreateMaterial(k,h,o){return this._applyExtensions(h,"createMaterial",(x=>x.createMaterial&&x.createMaterial(k,h,o)))}_extensionsLoadMaterialPropertiesAsync(k,h,o){return this._applyExtensions(h,"loadMaterialProperties",(x=>x.loadMaterialPropertiesAsync&&x.loadMaterialPropertiesAsync(k,h,o)))}_extensionsLoadTextureInfoAsync(k,h,o){return this._applyExtensions(h,"loadTextureInfo",(x=>x.loadTextureInfoAsync&&x.loadTextureInfoAsync(k,h,o)))}_extensionsLoadTextureAsync(k,h,o){return this._applyExtensions(h,"loadTexture",(x=>x._loadTextureAsync&&x._loadTextureAsync(k,h,o)))}_extensionsLoadAnimationAsync(k,h){return this._applyExtensions(h,"loadAnimation",(o=>o.loadAnimationAsync&&o.loadAnimationAsync(k,h)))}_extensionsLoadAnimationChannelAsync(k,h,o,x,I){return this._applyExtensions(o,"loadAnimationChannel",(q=>q._loadAnimationChannelAsync&&q._loadAnimationChannelAsync(k,h,o,x,I)))}_extensionsLoadSkinAsync(k,h,o){return this._applyExtensions(o,"loadSkin",(x=>x._loadSkinAsync&&x._loadSkinAsync(k,h,o)))}_extensionsLoadUriAsync(k,h,o){return this._applyExtensions(h,"loadUri",(x=>x._loadUriAsync&&x._loadUriAsync(k,h,o)))}_extensionsLoadBufferViewAsync(k,h){return this._applyExtensions(h,"loadBufferView",(o=>o.loadBufferViewAsync&&o.loadBufferViewAsync(k,h)))}_extensionsLoadBufferAsync(k,h,o,x){return this._applyExtensions(h,"loadBuffer",(I=>I.loadBufferAsync&&I.loadBufferAsync(k,h,o,x)))}static LoadExtensionAsync(k,h,o,x){if(!h.extensions)return null;const I=h.extensions[o];return I?x(`${k}/extensions/${o}`,I):null}static LoadExtraAsync(k,h,o,x){if(!h.extras)return null;const I=h.extras[o];return I?x(`${k}/extras/${o}`,I):null}isExtensionUsed(k){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(k)}logOpen(k){this._parent._logOpen(k)}logClose(){this._parent._logClose()}log(k){this._parent._log(k)}startPerformanceCounter(k){this._parent._startPerformanceCounter(k)}endPerformanceCounter(k){this._parent._endPerformanceCounter(k)}}m.DefaultSampler={index:-1},D.e._CreateGLTF2Loader=k=>new m(k);var L=o(12893),P=o(11428),r=o(11271),t=o(12900),S=o(12903);class C extends S.d{constructor(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",k),this._texture=k.getEngine().createRawCubeTexture(h,o,x,I,q,Y,J,G)}update(k,h,o,x){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,k,h,o,x,I)}updateRGBDAsync(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,t.l)(this._texture,k,h,o,x).then((()=>{}))}clone(){return r.c.Clone((()=>{const k=this.ik(),h=this._texture,o=new C(k,h._bufferViewArray,h.width,h.format,h.type,h.generateMipMaps,h.invertY,h.samplingMode,h._compression);return 13===h.source&&o.updateRGBDAsync(h._bufferViewArrayArray,h._sphericalPolynomial,h._lodGenerationScale,h._lodGenerationOffset),o}),this)}}const g="EXT_lights_image_based";class e{constructor(k){this.name=g,this._loader=k,this.enabled=this._loader.isExtensionUsed(g)}dispose(){this._loader=null,delete this._lights}onLoading(){const k=this._loader.Bh.extensions;if(k&&k[this.name]){const h=k[this.name];this._lights=h.lights}}loadSceneAsync(k,h){return m.LoadExtensionAsync(k,h,this.name,(async(o,x)=>{this._loader._allMaterialsDirtyRequired=!0;const I=new Array;I.push(this._loader.loadSceneAsync(k,h)),this._loader.logOpen(`${o}`);const q=p.Get(`${o}/light`,this._lights,x.Th);return I.push(this._loadLightAsync(`/extensions/${this.name}/lights/${x.Th}`,q).then((k=>{this._loader.babylonScene.environmentTexture=k}))),this._loader.logClose(),await Promise.all(I).then((()=>{}))}))}_loadLightAsync(k,h){if(!h._loaded){const o=new Array;this._loader.logOpen(`${k}`);const x=new Array(h.specularImages.length);for(let I=0;I<h.specularImages.length;I++){const q=h.specularImages[I];x[I]=new Array(q.length);for(let h=0;h<q.length;h++){const Y=`${k}/specularImages/${I}/${h}`;this._loader.logOpen(`${Y}`);const J=q[h],G=p.Get(Y,this._loader.Bh.images,J);o.push(this._loader.loadImageAsync(`/images/${J}`,G).then((k=>{x[I][h]=k}))),this._loader.logClose()}}this._loader.logClose(),h._loaded=Promise.all(o).then((async()=>{const o=new C(this._loader.babylonScene,null,h.specularImageSize);if(o.name=h.name||"environment",h._babylonTexture=o,void 0!=h.wJ&&(o.level=h.wJ),h.rotation){let k=I.Quaternion.Uh(h.rotation);this._loader.babylonScene.useRightHandedSystem||(k=I.Quaternion.Inverse(k)),I.Matrix.FromQuaternionToRef(k,o.getReflectionTextureMatrix())}if(!h.irradianceCoefficients)throw new Error(`${k}: Irradiance coefficients are missing`);const q=P.b.Uh(h.irradianceCoefficients);q.scaleInPlace(h.wJ),q.convertIrradianceToLambertianRadiance();const Y=P.e.FromHarmonics(q),J=(x.length-1)/Math.log2(h.specularImageSize);return await o.updateRGBDAsync(x,Y,J)}))}return h._loaded.then((()=>h._babylonTexture))}}H(g),n(g,!0,(k=>new e(k)));o(11821);const u="EXT_mesh_gpu_instancing";class kk{constructor(k){this.name=u,this._loader=k,this.enabled=this._loader.isExtensionUsed(u)}dispose(){this._loader=null}loadNodeAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(k,x)=>{this._loader._disableInstancedMesh++;const q=this._loader.loadNodeAsync(`/nodes/${h.index}`,h,o);if(this._loader._disableInstancedMesh--,!h._primitiveBabylonMeshes)return await q;const Y=new Array;let J=0;const G=h=>{if(void 0==x.attributes[h])return void Y.push(Promise.resolve(null));const o=p.Get(`${k}/attributes/${h}`,this._loader.Bh.accessors,x.attributes[h]);if(Y.push(this._loader._loadFloatAccessorAsync(`/accessors/${o.bufferView}`,o)),0===J)J=o.count;else if(J!==o.count)throw new Error(`${k}/attributes: Instance buffer accessors do not have the same count.`)};return G("TRANSLATION"),G("ROTATION"),G("SCALE"),await q.then((async k=>{const[o,x,q]=await Promise.all(Y),G=new Float32Array(16*J);I.TmpVectors.Vh[0].VJ(0,0,0),I.TmpVectors.Quaternion[0].VJ(0,0,0,1),I.TmpVectors.Vh[1].VJ(1,1,1);for(let h=0;h<J;++h)o&&I.Vh.FromArrayToRef(o,3*h,I.TmpVectors.Vh[0]),x&&I.Quaternion.FromArrayToRef(x,4*h,I.TmpVectors.Quaternion[0]),q&&I.Vh.FromArrayToRef(q,3*h,I.TmpVectors.Vh[1]),I.Matrix.ComposeToRef(I.TmpVectors.Vh[1],I.TmpVectors.Quaternion[0],I.TmpVectors.Vh[0],I.TmpVectors.Matrix[0]),I.TmpVectors.Matrix[0].copyToArray(G,16*h);for(const I of h._primitiveBabylonMeshes)I.TK("matrix",G,16,!0);return k}))}))}}H(u),n(u,!0,(k=>new kk(k)));let hk=0,ok=null;class xk{static get Default(){return xk._Default||(xk._Default=new xk),xk._Default}constructor(){const k=xk.Configuration.decoder;this._decoderModulePromise=Y.Tools.LoadBabylonScriptAsync(k.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(k,h,o,x,I){await this._decoderModulePromise,0===hk&&(MeshoptDecoder.useWorkers(1),hk=1);const q=await MeshoptDecoder.decodeGltfBufferAsync(h,o,k,x,I);return null!==ok&&clearTimeout(ok),ok=setTimeout((()=>{MeshoptDecoder.useWorkers(0),hk=0,ok=null}),1e3),q}}xk.Configuration={decoder:{url:`${Y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},xk._Default=null;const Ik="EXT_meshopt_compression";class qk{constructor(k){this.name=Ik,this.enabled=k.isExtensionUsed(Ik),this._loader=k}dispose(){this._loader=null}loadBufferViewAsync(k,h){return m.LoadExtensionAsync(k,h,this.name,(async(o,x)=>{const I=h;if(I._meshOptData)return await I._meshOptData;const q=p.Get(`${k}/buffer`,this._loader.Bh.buffers,x.buffer);return I._meshOptData=this._loader.loadBufferAsync(`/buffers/${q.index}`,q,x.byteOffset||0,x.byteLength).then((async k=>await xk.Default.decodeGltfBufferAsync(k,x.count,x.byteStride,x.mode,x.filter))),await I._meshOptData}))}}H(Ik),n(Ik,!0,(k=>new qk(k)));const Yk="EXT_texture_webp";class Jk{constructor(k){this.name=Yk,this._loader=k,this.enabled=k.isExtensionUsed(Yk)}dispose(){this._loader=null}_loadTextureAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=void 0==h.sampler?m.DefaultSampler:p.Get(`${k}/sampler`,this._loader.Bh.samplers,h.sampler),Y=p.Get(`${x}/source`,this._loader.Bh.images,I.source);return await this._loader._createTextureAsync(k,q,Y,(k=>{o(k)}),void 0,!h._textureInfo.nonColorData)}))}}H(Yk),n(Yk,!0,(k=>new Jk(k)));const Gk="EXT_texture_avif";class lk{constructor(k){this.name=Gk,this._loader=k,this.enabled=k.isExtensionUsed(Gk)}dispose(){this._loader=null}_loadTextureAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=void 0==h.sampler?m.DefaultSampler:p.Get(`${k}/sampler`,this._loader.Bh.samplers,h.sampler),Y=p.Get(`${x}/source`,this._loader.Bh.images,I.source);return await this._loader._createTextureAsync(k,q,Y,(k=>{o(k)}),void 0,!h._textureInfo.nonColorData)}))}}H(Gk),n(Gk,!0,(k=>new lk(k)));var Ak=o(12889),Kk=o(11799);const ak="EXT_lights_ies";class Nk{constructor(k){this.name=ak,this._loader=k,this.enabled=this._loader.isExtensionUsed(ak)}dispose(){this._loader=null,delete this._lights}onLoading(){const k=this._loader.Bh.extensions;if(k&&k[this.name]){const h=k[this.name];this._lights=h.lights,p.Assign(this._lights)}}loadNodeAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,Y)=>{let J,G;this._loader._allMaterialsDirtyRequired=!0;const l=await this._loader.loadNodeAsync(k,h,(k=>{G=p.Get(x,this._lights,Y.Th);const h=G.name||k.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J=new Ak.b(h,I.Vh.Zero(),I.Vh.Backward(),0,1,this._loader.babylonScene),J.angle=Math.PI/2,J.innerAngle=0,J._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,G._babylonLight=J,J.falloffType=Kk.d.FALLOFF_GLTF,J.DJ=Y.color?q.Zh.Uh(Y.color):q.Zh.White(),J.wJ=Y.multiplier||1,J.range=Number.MAX_VALUE,J.parent=k,this._loader._babylonLights.push(J),m.AddPointerMetadata(J,x),o(k)}));let A;if(G.uri)A=await this._loader.loadUriAsync(k,G,G.uri);else{const h=p.Get(`${k}/bufferView`,this._loader.Bh.bufferViews,G.bufferView);A=await this._loader.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}return J.iesProfileTexture=new j.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,A,!0,void 0,void 0,void 0,void 0,".ies"),l}))}}H(ak),n(ak,!0,(k=>new Nk(k)));var Xk=o(12912);const ck="KHR_draco_mesh_compression";class Wk{constructor(k){this.name=ck,this.useNormalizedFlagFromAccessor=!0,this._loader=k,this.enabled=Xk.e.DefaultAvailable&&this._loader.isExtensionUsed(ck)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{if(void 0!=h.mode&&4!==h.mode&&5!==h.mode)throw new Error(`${k}: Unsupported mode ${h.mode}`);const q={},Y={},J=(k,x)=>{const J=I.attributes[k];if(void 0!=J&&(o._delayInfo=o._delayInfo||[],-1===o._delayInfo.indexOf(x)&&o._delayInfo.push(x),q[x]=J,this.useNormalizedFlagFromAccessor)){const o=p.TryGet(this._loader.Bh.accessors,h.attributes[k]);o&&(Y[x]=o.normalized||!1)}};J("POSITION",b.g.PositionKind),J("NORMAL",b.g.NormalKind),J("TANGENT",b.g.TangentKind),J("TEXCOORD_0",b.g.UVKind),J("TEXCOORD_1",b.g.UV2Kind),J("TEXCOORD_2",b.g.UV3Kind),J("TEXCOORD_3",b.g.UV4Kind),J("TEXCOORD_4",b.g.UV5Kind),J("TEXCOORD_5",b.g.UV6Kind),J("JOINTS_0",b.g.MatricesIndicesKind),J("WEIGHTS_0",b.g.MatricesWeightsKind),J("COLOR_0",b.g.ColorKind);const G=p.Get(x,this._loader.Bh.bufferViews,I.bufferView);return G._dracoBabylonGeometry||(G._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((async x=>{const I=this.dracoDecoder||Xk.e.Default,J=p.TryGet(this._loader.Bh.accessors,h.attributes.POSITION),G=this._loader.parent.alwaysComputeBoundingBox||o.skeleton||!J?null:v(J);return await I._decodeMeshToGeometryForGltfAsync(o.name,this._loader.babylonScene,x,q,Y,G).catch((h=>{throw new Error(`${k}: ${h.message}`)}))}))),await G._dracoBabylonGeometry}))}}H(ck),n(ck,!0,(k=>new Wk(k)));var fk=o(12915),Mk=o(11227),Tk=o(11233),jk=o(11656),dk=o(11853),bk=o(11199);jk.c.AddNodeConstructor("Light_Type_0",((k,h)=>()=>new Vk(k,I.Vh.Zero(),h)));class Vk extends dk.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(k){this._shadowAngle=k,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(k){const h=this.needCube();if(this._direction=k,this.needCube()!==h&&this._shadowGenerators){const k=this._shadowGenerators.values();for(let h=k.next();!0!==h.done;h=k.next()){h.value.recreateShadowMap()}}}constructor(k,h,o){super(k,o),this._shadowAngle=Math.PI/2,this.position=h}getClassName(){return"PointLight"}getTypeID(){return Kk.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(k){if(this.direction)return super.getShadowDirection(k);switch(k){case 0:return new I.Vh(1,0,0);case 1:return new I.Vh(-1,0,0);case 2:return new I.Vh(0,-1,0);case 3:return new I.Vh(0,1,0);case 4:return new I.Vh(0,0,1);case 5:return new I.Vh(0,0,-1)}return I.Vh.Zero()}_setDefaultShadowProjectionMatrix(k,h,o){const x=this.ik().activeCamera;if(!x)return;const q=void 0!==this.shadowMinZ?this.shadowMinZ:x.nx,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,J=this.ik().getEngine().useReverseDepthBuffer;I.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,J?Y:q,J?q:Y,k,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(k,h){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,h):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,h),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,h),this}transferToNodeMaterialEffect(k,h){return this.computeTransformedInformation()?k.setFloat3(h,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):k.setFloat3(h,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(k,h){k["POINTLIGHT"+h]=!0}}(0,Mk.d)([(0,Tk.E)()],Vk.prototype,"shadowAngle",null),(0,bk.g)("BABYLON.PointLight",Vk);const ik="KHR_lights_punctual";class Fk{constructor(k){this.name=ik,this._loader=k,this.enabled=this._loader.isExtensionUsed(ik)}dispose(){this._loader=null,delete this._lights}onLoading(){const k=this._loader.Bh.extensions;if(k&&k[this.name]){const h=k[this.name];this._lights=h.lights,p.Assign(this._lights)}}loadNodeAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,Y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(k,h,(k=>{let h;const J=p.Get(x,this._lights,Y.Th),G=J.name||k.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J.type){case"directional":{const k=new fk.e(G,I.Vh.Backward(),this._loader.babylonScene);k.position.FJ(0),h=k;break}case"point":h=new Vk(G,I.Vh.Zero(),this._loader.babylonScene);break;case"spot":{const k=new Ak.b(G,I.Vh.Zero(),I.Vh.Backward(),0,1,this._loader.babylonScene);k.angle=2*(J.spot&&J.spot.outerConeAngle||Math.PI/4),k.innerAngle=2*(J.spot&&J.spot.innerConeAngle||0),h=k;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${x}: Invalid light type (${J.type})`)}h._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,J._babylonLight=h,h.falloffType=Kk.d.FALLOFF_GLTF,h.DJ=J.color?q.Zh.Uh(J.color):q.Zh.White(),h.wJ=void 0==J.wJ?1:J.wJ,h.range=void 0==J.range?Number.MAX_VALUE:J.range,h.parent=k,this._loader._babylonLights.push(h),m.AddPointerMetadata(h,x),o(k)})))))}}H(ik),n(ik,!0,(k=>new Fk(k)));const Rk="KHR_materials_pbrSpecularGlossiness";class sk{constructor(k){this.name=Rk,this.order=200,this._loader=k,this.enabled=this._loader.isExtensionUsed(Rk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialBasePropertiesAsync(k,h,o)),q.push(this._loadSpecularGlossinessPropertiesAsync(x,I,o)),this._loader.loadMaterialAlphaProperties(k,h,o),await Promise.all(q).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;return o.metallic=null,o.roughness=null,h.diffuseFactor?(o.albedoColor=q.Zh.Uh(h.diffuseFactor),o.alpha=h.diffuseFactor[3]):o.albedoColor=q.Zh.White(),o.reflectivityColor=h.specularFactor?q.Zh.Uh(h.specularFactor):q.Zh.White(),o.microSurface=void 0==h.glossinessFactor?1:h.glossinessFactor,h.diffuseTexture&&x.push(this._loader.loadTextureInfoAsync(`${k}/diffuseTexture`,h.diffuseTexture,(k=>{k.name=`${o.name} (Diffuse)`,o.albedoTexture=k}))),h.specularGlossinessTexture&&(x.push(this._loader.loadTextureInfoAsync(`${k}/specularGlossinessTexture`,h.specularGlossinessTexture,(k=>{k.name=`${o.name} (Specular Glossiness)`,o.reflectivityTexture=k,o.reflectivityTexture.Sh=!0}))),o.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(x).then((()=>{}))}}H(Rk),n(Rk,!0,(k=>new sk(k)));const Zk="KHR_materials_unlit";class wk{constructor(k){this.name=Zk,this.order=210,this._loader=k,this.enabled=this._loader.isExtensionUsed(Zk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async()=>await this._loadUnlitPropertiesAsync(k,h,o)))}_loadUnlitPropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;o.unlit=!0;const I=h.pbrMetallicRoughness;return I&&(I.baseColorFactor?(o.albedoColor=q.Zh.Uh(I.baseColorFactor),o.alpha=I.baseColorFactor[3]):o.albedoColor=q.Zh.White(),I.baseColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${k}/baseColorTexture`,I.baseColorTexture,(k=>{k.name=`${o.name} (Base Color)`,o.albedoTexture=k})))),h.doubleSided&&(o.bJ=!1,o.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(k,h,o),Promise.all(x).then((()=>{}))}}H(Zk),n(Zk,!0,(k=>new wk(k)));const Dk="KHR_materials_clearcoat";class Uk{constructor(k){this.name=Dk,this.order=190,this._loader=k,this.enabled=this._loader.isExtensionUsed(Dk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadClearCoatPropertiesAsync(x,I,o)),await Promise.all(q)}))}_loadClearCoatPropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;return o.clearCoat.isEnabled=!0,o.clearCoat.useRoughnessFromMainTexture=!1,o.clearCoat.remapF0OnInterfaceChange=!1,void 0!=h.clearcoatFactor?o.clearCoat.wJ=h.clearcoatFactor:o.clearCoat.wJ=0,h.clearcoatTexture&&x.push(this._loader.loadTextureInfoAsync(`${k}/clearcoatTexture`,h.clearcoatTexture,(k=>{k.name=`${o.name} (ClearCoat)`,o.clearCoat.texture=k}))),void 0!=h.clearcoatRoughnessFactor?o.clearCoat.roughness=h.clearcoatRoughnessFactor:o.clearCoat.roughness=0,h.clearcoatRoughnessTexture&&(h.clearcoatRoughnessTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${k}/clearcoatRoughnessTexture`,h.clearcoatRoughnessTexture,(k=>{k.name=`${o.name} (ClearCoat Roughness)`,o.clearCoat.textureRoughness=k})))),h.clearcoatNormalTexture&&(h.clearcoatNormalTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${k}/clearcoatNormalTexture`,h.clearcoatNormalTexture,(k=>{k.name=`${o.name} (ClearCoat Normal)`,o.clearCoat.bumpTexture=k}))),o.invertNormalMapX=!o.ik().useRightHandedSystem,o.invertNormalMapY=o.ik().useRightHandedSystem,void 0!=h.clearcoatNormalTexture.scale&&(o.clearCoat.bumpTexture.level=h.clearcoatNormalTexture.scale)),Promise.all(x).then((()=>{}))}}H(Dk),n(Dk,!0,(k=>new Uk(k)));const Qk="KHR_materials_iridescence";class Bk{constructor(k){this.name=Qk,this.order=195,this._loader=k,this.enabled=this._loader.isExtensionUsed(Qk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadIridescencePropertiesAsync(x,I,o)),await Promise.all(q).then((()=>{}))}))}_loadIridescencePropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;return o.iridescence.isEnabled=!0,o.iridescence.wJ=h.iridescenceFactor??0,o.iridescence.indexOfRefraction=h.iridescenceIor??h.iridescenceIOR??1.3,o.iridescence.minimumThickness=h.iridescenceThicknessMinimum??100,o.iridescence.maximumThickness=h.iridescenceThicknessMaximum??400,h.iridescenceTexture&&x.push(this._loader.loadTextureInfoAsync(`${k}/iridescenceTexture`,h.iridescenceTexture,(k=>{k.name=`${o.name} (Iridescence)`,o.iridescence.texture=k}))),h.iridescenceThicknessTexture&&x.push(this._loader.loadTextureInfoAsync(`${k}/iridescenceThicknessTexture`,h.iridescenceThicknessTexture,(k=>{k.name=`${o.name} (Iridescence Thickness)`,o.iridescence.thicknessTexture=k}))),Promise.all(x).then((()=>{}))}}H(Qk),n(Qk,!0,(k=>new Bk(k)));const Ek="KHR_materials_anisotropy";class nk{constructor(k){this.name=Ek,this.order=195,this._loader=k,this.enabled=this._loader.isExtensionUsed(Ek)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadIridescencePropertiesAsync(x,I,o)),await Promise.all(q)}))}async _loadIridescencePropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;o.anisotropy.isEnabled=!0,o.anisotropy.wJ=h.anisotropyStrength??0,o.anisotropy.angle=h.anisotropyRotation??0,h.anisotropyTexture&&(h.anisotropyTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${k}/anisotropyTexture`,h.anisotropyTexture,(k=>{k.name=`${o.name} (Anisotropy Intensity)`,o.anisotropy.texture=k})))),await Promise.all(x)}}H(Ek),n(Ek,!0,(k=>new nk(k)));const Hk="KHR_materials_emissive_strength";class yk{constructor(k){this.name=Hk,this.order=170,this._loader=k,this.enabled=this._loader.isExtensionUsed(Hk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>await this._loader.loadMaterialPropertiesAsync(k,h,o).then((()=>{this._loadEmissiveProperties(x,I,o)}))))}_loadEmissiveProperties(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);void 0!==h.emissiveStrength&&(o.emissiveIntensity=h.emissiveStrength)}}H(Hk),n(Hk,!0,(k=>new yk(k)));const Ok="KHR_materials_sheen";class zk{constructor(k){this.name=Ok,this.order=190,this._loader=k,this.enabled=this._loader.isExtensionUsed(Ok)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadSheenPropertiesAsync(x,I,o)),await Promise.all(q).then((()=>{}))}))}_loadSheenPropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;return o.sheen.isEnabled=!0,o.sheen.wJ=1,void 0!=h.sheenColorFactor?o.sheen.color=q.Zh.Uh(h.sheenColorFactor):o.sheen.color=q.Zh.Black(),h.sheenColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${k}/sheenColorTexture`,h.sheenColorTexture,(k=>{k.name=`${o.name} (Sheen Color)`,o.sheen.texture=k}))),void 0!==h.sheenRoughnessFactor?o.sheen.roughness=h.sheenRoughnessFactor:o.sheen.roughness=0,h.sheenRoughnessTexture&&(h.sheenRoughnessTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${k}/sheenRoughnessTexture`,h.sheenRoughnessTexture,(k=>{k.name=`${o.name} (Sheen Roughness)`,o.sheen.textureRoughness=k})))),o.sheen.albedoScaling=!0,o.sheen.useRoughnessFromMainTexture=!1,Promise.all(x).then((()=>{}))}}H(Ok),n(Ok,!0,(k=>new zk(k)));var pk=o(11733);const vk="KHR_materials_specular";class mk{constructor(k){this.name=vk,this.order=190,this._loader=k,this.enabled=this._loader.isExtensionUsed(vk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;if(q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadSpecularPropertiesAsync(x,I,o)),I.extensions&&I.extensions.EXT_materials_specular_edge_color&&o instanceof T.d){I.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(o.brdf.dielectricSpecularModel=pk.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,o.brdf.conductorSpecularModel=pk.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(q).then((()=>{}))}))}_loadSpecularPropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;return void 0!==h.specularFactor&&(o.metallicF0Factor=h.specularFactor),void 0!==h.specularColorFactor&&(o.metallicReflectanceColor=q.Zh.Uh(h.specularColorFactor)),h.specularTexture&&(h.specularTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${k}/specularTexture`,h.specularTexture,(k=>{k.name=`${o.name} (Specular)`,o.metallicReflectanceTexture=k,o.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),h.specularColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${k}/specularColorTexture`,h.specularColorTexture,(k=>{k.name=`${o.name} (Specular Color)`,o.reflectanceTexture=k}))),Promise.all(x).then((()=>{}))}}H(vk),n(vk,!0,(k=>new mk(k)));const Lk="KHR_materials_ior";class Pk{constructor(k){this.name=Lk,this.order=180,this._loader=k,this.enabled=this._loader.isExtensionUsed(Lk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadIorPropertiesAsync(x,I,o)),await Promise.all(q).then((()=>{}))}))}_loadIorPropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);return void 0!==h.ior?o.indexOfRefraction=h.ior:o.indexOfRefraction=Pk._DEFAULT_IOR,Promise.resolve()}}Pk._DEFAULT_IOR=1.5,H(Lk),n(Lk,!0,(k=>new Pk(k)));const rk="KHR_materials_variants";class tk{constructor(k){this.name=rk,this._loader=k,this.enabled=this._loader.isExtensionUsed(rk)}dispose(){this._loader=null}static GetAvailableVariants(k){const h=this._GetExtensionMetadata(k);return h?Object.keys(h.variants):[]}getAvailableVariants(k){return tk.GetAvailableVariants(k)}static SelectVariant(k,h){const o=this._GetExtensionMetadata(k);if(!o)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${rk} extension`);const x=k=>{const h=o.variants[k];if(h)for(const o of h)o.mesh.material=o.material};if(h instanceof Array)for(const I of h)x(I);else x(h);o.lastSelected=h}selectVariant(k,h){tk.SelectVariant(k,h)}static Reset(k){const h=this._GetExtensionMetadata(k);if(!h)throw new Error(`Cannot reset on a glTF mesh that does not have the ${rk} extension`);for(const o of h.original)o.mesh.material=o.material;h.lastSelected=null}reset(k){tk.Reset(k)}static GetLastSelectedVariant(k){const h=this._GetExtensionMetadata(k);if(!h)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${rk} extension`);return h.lastSelected}getLastSelectedVariant(k){return tk.GetLastSelectedVariant(k)}static _GetExtensionMetadata(k){var h,o;return(null===k||void 0===k||null===(h=k._internalMetadata)||void 0===h||null===(o=h.Bh)||void 0===o?void 0:o[rk])||null}onLoading(){const k=this._loader.Bh.extensions;if(k&&k[this.name]){const h=k[this.name];this._variants=h.variants}}onReady(){const k=this._loader.rootBabylonMesh;if(k){var h;const o=this._loader.parent.extensionOptions[rk];null!==o&&void 0!==o&&o.defaultVariant&&tk.SelectVariant(k,o.defaultVariant),null===o||void 0===o||null===(h=o.onLoaded)||void 0===h||h.call(o,{get variants(){return tk.GetAvailableVariants(k)},get selectedVariant(){const h=tk.GetLastSelectedVariant(k);return h?Array.isArray(h)?h[0]:h:tk.GetAvailableVariants(k)[0]},set selectedVariant(h){tk.SelectVariant(k,h)}})}}_loadMeshPrimitiveAsync(k,h,o,x,I,q){return m.LoadExtensionAsync(k,I,this.name,(async(Y,J)=>{const G=new Array;return G.push(this._loader._loadMeshPrimitiveAsync(k,h,o,x,I,(h=>{if(q(h),h instanceof F.e){const o=m._GetDrawMode(k,I.mode),x=this._loader.rootBabylonMesh,q=x?x._internalMetadata=x._internalMetadata||{}:{},l=q.Bh=q.Bh||{},A=l[rk]=l[rk]||{lastSelected:null,original:[],variants:{}};A.original.push({mesh:h,material:h.material});for(let k=0;k<J.mappings.length;++k){const I=J.mappings[k],q=p.Get(`${Y}/mappings/${k}/material`,this._loader.Bh.materials,I.material);G.push(this._loader._loadMaterialAsync(`#/materials/${I.material}`,q,h,o,(k=>{for(let o=0;o<I.variants.length;++o){const q=I.variants[o],Y=p.Get(`/extensions/${rk}/variants/${q}`,this._variants,q);A.variants[Y.name]=A.variants[Y.name]||[],A.variants[Y.name].push({mesh:h,material:k}),h.onClonedObservable.add((k=>{const o=k;let I=null,q=o;do{if(q=q.parent,!q)return;I=tk._GetExtensionMetadata(q)}while(null===I);if(x&&I===tk._GetExtensionMetadata(x)){q._internalMetadata={};for(const k in x._internalMetadata)q._internalMetadata[k]=x._internalMetadata[k];q._internalMetadata.Bh=[];for(const k in x._internalMetadata.Bh)q._internalMetadata.Bh[k]=x._internalMetadata.Bh[k];q._internalMetadata.Bh[rk]={lastSelected:null,original:[],variants:{}};for(const k of I.original)q._internalMetadata.Bh[rk].original.push({mesh:k.mesh,material:k.material});for(const k in I.variants)if(Object.prototype.hasOwnProperty.call(I.variants,k)){q._internalMetadata.Bh[rk].variants[k]=[];for(const h of I.variants[k])q._internalMetadata.Bh[rk].variants[k].push({mesh:h.mesh,material:h.material})}I=q._internalMetadata.Bh[rk]}for(const x of I.original)x.mesh===h&&(x.mesh=o);for(const x of I.variants[Y.name])x.mesh===h&&(x.mesh=o)}))}})))}}}))),await Promise.all(G).then((k=>{let[h]=k;return h}))}))}}H(rk),n(rk,!0,(k=>new tk(k)));var Sk=o(11299);class Ck{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:pk.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(k,h){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ck._GetDefaultOptions(),...k},this._scene=h,this._scene._transmissionHelper=this,this.onErrorObservable=new A.d,this._scene.sh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(k){if(!Object.keys(k).filter((h=>this._options[h]!==k[h])).length)return;const h={...this._options,...k},o=this._options;this._options=h,h.renderSize===o.renderSize&&h.renderTargetTextureType===o.renderTargetTextureType&&h.generateMipmaps===o.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=h.samples,this._opaqueRenderTarget.lodGenerationScale=h.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=h.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(k){return!!k&&!!(k instanceof T.d&&k.subSurface.isRefractionEnabled)}_addMesh(k){this._materialObservers[k.uniqueId]=k.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(k.material)?(k.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(k)&&this._transparentMeshesCache.push(k)):-1===this._opaqueMeshesCache.indexOf(k)&&this._opaqueMeshesCache.push(k)}))}_removeMesh(k){k.onMaterialChangedObservable.remove(this._materialObservers[k.uniqueId]),delete this._materialObservers[k.uniqueId];let h=this._transparentMeshesCache.indexOf(k);-1!==h&&this._transparentMeshesCache.splice(h,1),h=this._opaqueMeshesCache.indexOf(k),-1!==h&&this._opaqueMeshesCache.splice(h,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(k){const h=this._transparentMeshesCache.indexOf(k),o=this._opaqueMeshesCache.indexOf(k);this._shouldRenderAsTransmission(k.material)?(k.material instanceof T.d&&(k.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==o?(this._opaqueMeshesCache.splice(o,1),this._transparentMeshesCache.push(k)):-1===h&&this._transparentMeshesCache.push(k)):-1!==h?(this._transparentMeshesCache.splice(h,1),this._opaqueMeshesCache.push(k)):-1===o&&this._opaqueMeshesCache.push(k)}_isRenderTargetValid(){var k;return null!==(null===(k=this._opaqueRenderTarget)||void 0===k?void 0:k.getInternalTexture())}_setupRenderTargets(){var k;let h;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Sk.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(k=this._options.clearColor)||void 0===k?void 0:k.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((k=>{h=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?k.clearColor.Y(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(k.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=h}));for(const o of this._transparentMeshesCache)this._shouldRenderAsTransmission(o.material)&&(o.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const gk="KHR_materials_transmission";class ek{constructor(k){this.name=gk,this.order=175,this._loader=k,this.enabled=this._loader.isExtensionUsed(gk),this.enabled&&(k.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadTransparentPropertiesAsync(x,h,o,I)),await Promise.all(q).then((()=>{}))}))}_loadTransparentPropertiesAsync(k,h,o,x){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const I=o;if(I.subSurface.isRefractionEnabled=!0,I.subSurface.volumeIndexOfRefraction=1,I.subSurface.useAlbedoToTintRefraction=!0,void 0===x.transmissionFactor)return I.subSurface.refractionIntensity=0,I.subSurface.isRefractionEnabled=!1,Promise.resolve();{var q;I.subSurface.refractionIntensity=x.transmissionFactor;const k=I.ik();if(I.subSurface.refractionIntensity&&!k._transmissionHelper)new Ck({},I.ik());else if(I.subSurface.refractionIntensity&&(null===(q=k._transmissionHelper)||void 0===q||!q._isRenderTargetValid())){var Y;null===(Y=k._transmissionHelper)||void 0===Y||Y._setupRenderTargets()}}return I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=0,x.transmissionTexture?(x.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${k}/transmissionTexture`,x.transmissionTexture,void 0).then((k=>{k.name=`${o.name} (Transmission)`,I.subSurface.refractionIntensityTexture=k,I.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}H(gk),n(gk,!0,(k=>new ek(k)));const uk="KHR_materials_diffuse_transmission";class kh{constructor(k){this.name=uk,this.order=174,this._loader=k,this.enabled=this._loader.isExtensionUsed(uk),this.enabled&&(k.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadTranslucentPropertiesAsync(x,h,o,I)),await Promise.all(q).then((()=>{}))}))}_loadTranslucentPropertiesAsync(k,h,o,x){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const I=o;if(I.subSurface.isTranslucencyEnabled=!0,I.subSurface.volumeIndexOfRefraction=1,I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=0,I.subSurface.useAlbedoToTintTranslucency=!1,void 0===x.diffuseTransmissionFactor)return I.subSurface.translucencyIntensity=0,I.subSurface.isTranslucencyEnabled=!1,Promise.resolve();I.subSurface.translucencyIntensity=x.diffuseTransmissionFactor;const Y=new Array;return I.subSurface.useGltfStyleTextures=!0,x.diffuseTransmissionTexture&&(x.diffuseTransmissionTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${k}/diffuseTransmissionTexture`,x.diffuseTransmissionTexture).then((k=>{k.name=`${o.name} (Diffuse Transmission)`,I.subSurface.translucencyIntensityTexture=k})))),void 0!==x.diffuseTransmissionColorFactor?I.subSurface.translucencyColor=q.Zh.Uh(x.diffuseTransmissionColorFactor):I.subSurface.translucencyColor=q.Zh.White(),x.diffuseTransmissionColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${k}/diffuseTransmissionColorTexture`,x.diffuseTransmissionColorTexture).then((k=>{k.name=`${o.name} (Diffuse Transmission Color)`,I.subSurface.translucencyColorTexture=k}))),Promise.all(Y).then((()=>{}))}}H(uk),n(uk,!0,(k=>new kh(k)));const hh="KHR_materials_volume";class oh{constructor(k){this.name=hh,this.order=173,this._loader=k,this.enabled=this._loader.isExtensionUsed(hh),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadVolumePropertiesAsync(x,h,o,I)),await Promise.all(q).then((()=>{}))}))}_loadVolumePropertiesAsync(k,h,o,x){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);if(!o.subSurface.isRefractionEnabled&&!o.subSurface.isTranslucencyEnabled||!x.thicknessFactor)return Promise.resolve();o.subSurface.volumeIndexOfRefraction=o.indexOfRefraction;const I=void 0!==x.attenuationDistance?x.attenuationDistance:Number.MAX_VALUE;return o.subSurface.tintColorAtDistance=I,void 0!==x.attenuationColor&&3==x.attenuationColor.length&&o.subSurface.tintColor.VJ(x.attenuationColor[0],x.attenuationColor[1],x.attenuationColor[2]),o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=x.thicknessFactor,o.subSurface.useThicknessAsDepth=!0,x.thicknessTexture?(x.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${k}/thicknessTexture`,x.thicknessTexture).then((k=>{k.name=`${o.name} (Thickness)`,o.subSurface.thicknessTexture=k,o.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}H(hh),n(hh,!0,(k=>new oh(k)));const xh="KHR_materials_dispersion";class Ih{constructor(k){this.name=xh,this.order=174,this._loader=k,this.enabled=this._loader.isExtensionUsed(xh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadDispersionPropertiesAsync(x,h,o,I)),await Promise.all(q).then((()=>{}))}))}_loadDispersionPropertiesAsync(k,h,o,x){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);return o.subSurface.isRefractionEnabled&&x.dispersion?(o.subSurface.isDispersionEnabled=!0,o.subSurface.dispersion=x.dispersion,Promise.resolve()):Promise.resolve()}}H(xh),n(xh,!0,(k=>new Ih(k)));const qh="EXT_materials_diffuse_roughness";class Yh{constructor(k){this.name=qh,this.order=190,this._loader=k,this.enabled=this._loader.isExtensionUsed(qh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=new Array;return q.push(this._loader.loadMaterialPropertiesAsync(k,h,o)),q.push(this._loadDiffuseRoughnessPropertiesAsync(x,I,o)),await Promise.all(q).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(k,h,o){if(!(o instanceof T.d))throw new Error(`${k}: Material type not supported`);const x=new Array;return o.brdf.baseDiffuseModel=pk.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=h.diffuseRoughnessFactor?o.baseDiffuseRoughness=h.diffuseRoughnessFactor:o.baseDiffuseRoughness=0,h.diffuseRoughnessTexture&&x.push(this._loader.loadTextureInfoAsync(`${k}/diffuseRoughnessTexture`,h.diffuseRoughnessTexture,(k=>{k.name=`${o.name} (Diffuse Roughness)`,o.baseDiffuseRoughnessTexture=k}))),Promise.all(x).then((()=>{}))}}H(qh),n(qh,!0,(k=>new Yh(k)));const Jh="KHR_mesh_quantization";class Gh{constructor(k){this.name=Jh,this.enabled=k.isExtensionUsed(Jh)}dispose(){}}H(Jh),n(Jh,!0,(k=>new Gh(k)));const lh="KHR_texture_basisu";class Ah{constructor(k){this.name=lh,this._loader=k,this.enabled=k.isExtensionUsed(lh)}dispose(){this._loader=null}_loadTextureAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>{const q=void 0==h.sampler?m.DefaultSampler:p.Get(`${k}/sampler`,this._loader.Bh.samplers,h.sampler),Y=p.Get(`${x}/source`,this._loader.Bh.images,I.source);return await this._loader._createTextureAsync(k,q,Y,(k=>{o(k)}),h._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!h._textureInfo.nonColorData)}))}}H(lh),n(lh,!0,(k=>new Ah(k)));const Kh="KHR_texture_transform";class ah{constructor(k){this.name=Kh,this._loader=k,this.enabled=this._loader.isExtensionUsed(Kh)}dispose(){this._loader=null}loadTextureInfoAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(x,I)=>await this._loader.loadTextureInfoAsync(k,h,(k=>{if(!(k instanceof j.b))throw new Error(`${x}: Texture type not supported`);I.offset&&(k.uOffset=I.offset[0],k.vOffset=I.offset[1]),k.uRotationCenter=0,k.vRotationCenter=0,I.rotation&&(k.wAng=-I.rotation),I.scale&&(k.uScale=I.scale[0],k.vScale=I.scale[1]),void 0!=I.texCoord&&(k.coordinatesIndex=I.texCoord),o(k)}))))}}H(Kh),n(Kh,!0,(k=>new ah(k)));const Nh="KHR_xmp_json_ld";class Xh{constructor(k){this.name=Nh,this.order=100,this._loader=k,this.enabled=this._loader.isExtensionUsed(Nh)}dispose(){this._loader=null}onLoading(){var k,h,o;if(null===this._loader.rootBabylonMesh)return;const x=null===(k=this._loader.Bh.extensions)||void 0===k?void 0:k.KHR_xmp_json_ld,I=null===(h=this._loader.Bh.asset)||void 0===h||null===(o=h.extensions)||void 0===o?void 0:o.KHR_xmp_json_ld;if(x&&I){const k=+I.packet;x.packets&&k<x.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=x.packets[k])}}}function ch(k,h,o,x){return q.Zh.Uh(h,o).scale(x)}function Wh(k,h,o,x){return h[o]*x}function fh(k,h,o,x){return-h[o]*x}function Mh(k,h,o,x){return h[o+1]*x}function Th(k,h,o,x){return h[o]*x*2}function jh(k){return{scale:[new bh(a.c.ANIMATIONTYPE_FLOAT,`${k}.uScale`,Wh,(()=>2)),new bh(a.c.ANIMATIONTYPE_FLOAT,`${k}.vScale`,Mh,(()=>2))],offset:[new bh(a.c.ANIMATIONTYPE_FLOAT,`${k}.uOffset`,Wh,(()=>2)),new bh(a.c.ANIMATIONTYPE_FLOAT,`${k}.vOffset`,Mh,(()=>2))],rotation:[new bh(a.c.ANIMATIONTYPE_FLOAT,`${k}.wAng`,fh,(()=>1))]}}H(Nh),n(Nh,!0,(k=>new Xh(k)));class dh extends L.AnimationPropertyInfo{buildAnimations(k,h,o,x){return[{babylonAnimatable:k._babylonCamera,babylonAnimation:this._buildAnimation(h,o,x)}]}}class bh extends L.AnimationPropertyInfo{buildAnimations(k,h,o,x){const I=[];for(const q in k._data)I.push({babylonAnimatable:k._data[q].babylonMaterial,babylonAnimation:this._buildAnimation(h,o,x)});return I}}class Vh extends L.AnimationPropertyInfo{buildAnimations(k,h,o,x){return[{babylonAnimatable:k._babylonLight,babylonAnimation:this._buildAnimation(h,o,x)}]}}(0,y.n)("/cameras/{}/orthographic/xmag",[new dh(a.c.ANIMATIONTYPE_FLOAT,"orthoLeft",fh,(()=>1)),new dh(a.c.ANIMATIONTYPE_FLOAT,"orthoRight",Mh,(()=>1))]),(0,y.n)("/cameras/{}/orthographic/ymag",[new dh(a.c.ANIMATIONTYPE_FLOAT,"orthoBottom",fh,(()=>1)),new dh(a.c.ANIMATIONTYPE_FLOAT,"orthoTop",Mh,(()=>1))]),(0,y.n)("/cameras/{}/orthographic/zfar",[new dh(a.c.ANIMATIONTYPE_FLOAT,"maxZ",Wh,(()=>1))]),(0,y.n)("/cameras/{}/orthographic/znear",[new dh(a.c.ANIMATIONTYPE_FLOAT,"nx",Wh,(()=>1))]),(0,y.n)("/cameras/{}/perspective/yfov",[new dh(a.c.ANIMATIONTYPE_FLOAT,"fov",Wh,(()=>1))]),(0,y.n)("/cameras/{}/perspective/zfar",[new dh(a.c.ANIMATIONTYPE_FLOAT,"maxZ",Wh,(()=>1))]),(0,y.n)("/cameras/{}/perspective/znear",[new dh(a.c.ANIMATIONTYPE_FLOAT,"nx",Wh,(()=>1))]),(0,y.n)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new bh(a.c.ANIMATIONTYPE_COLOR3,"albedoColor",ch,(()=>4)),new bh(a.c.ANIMATIONTYPE_FLOAT,"alpha",(function(k,h,o,x){return h[o+3]*x}),(()=>4))]),(0,y.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"metallic",Wh,(()=>1))]),(0,y.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"roughness",Wh,(()=>1))]);const ih=jh("albedoTexture");(0,y.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",ih.scale),(0,y.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",ih.offset),(0,y.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",ih.rotation);const Fh=jh("metallicTexture");(0,y.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Fh.scale),(0,y.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Fh.offset),(0,y.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Fh.rotation),(0,y.n)("/materials/{}/emissiveFactor",[new bh(a.c.ANIMATIONTYPE_COLOR3,"emissiveColor",ch,(()=>3))]);const Rh=jh("bumpTexture");(0,y.n)("/materials/{}/normalTexture/scale",[new bh(a.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Wh,(()=>1))]),(0,y.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Rh.scale),(0,y.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Rh.offset),(0,y.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Rh.rotation),(0,y.n)("/materials/{}/occlusionTexture/strength",[new bh(a.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Wh,(()=>1))]);const sh=jh("ambientTexture");(0,y.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",sh.scale),(0,y.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",sh.offset),(0,y.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",sh.rotation);const Zh=jh("emissiveTexture");(0,y.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Zh.scale),(0,y.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Zh.offset),(0,y.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Zh.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new bh(a.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new bh(a.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Wh,(()=>1))]);const wh=jh("anisotropy.texture");(0,y.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",wh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",wh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",wh.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Wh,(()=>1))]);const Dh=jh("clearCoat.texture");(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Dh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Dh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Dh.rotation);const Uh=jh("clearCoat.bumpTexture");(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new bh(a.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Uh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Uh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Uh.rotation);const Qh=jh("clearCoat.textureRoughness");(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Qh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Qh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Qh.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new bh(a.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_ior/ior",[new bh(a.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new bh(a.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new bh(a.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Wh,(()=>1))]);const Bh=jh("iridescence.texture");(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Bh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Bh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Bh.rotation);const Eh=jh("iridescence.thicknessTexture");(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Eh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Eh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Eh.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new bh(a.c.ANIMATIONTYPE_COLOR3,"sheen.color",ch,(()=>3))]),(0,y.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",Wh,(()=>1))]);const nh=jh("sheen.texture");(0,y.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",nh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",nh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",nh.rotation);const Hh=jh("sheen.textureRoughness");(0,y.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Hh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Hh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Hh.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new bh(a.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",ch,(()=>3))]);const yh=jh("metallicReflectanceTexture");(0,y.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",yh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",yh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",yh.rotation);const Oh=jh("reflectanceTexture");(0,y.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Oh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Oh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Oh.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Wh,(()=>1))]);const zh=jh("subSurface.refractionIntensityTexture");(0,y.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",zh.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",zh.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",zh.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new bh(a.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",ch,(()=>3))]),(0,y.n)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new bh(a.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Wh,(()=>1))]),(0,y.n)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Wh,(()=>1))]);const ph=jh("subSurface.thicknessTexture");(0,y.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",ph.scale),(0,y.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",ph.offset),(0,y.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",ph.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new bh(a.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Wh,(()=>1))]);const vh=jh("subSurface.translucencyIntensityTexture");(0,y.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",vh.scale),(0,y.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",vh.offset),(0,y.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",vh.rotation),(0,y.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new bh(a.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",ch,(()=>3))]);const mh=jh("subSurface.translucencyColorTexture");(0,y.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",mh.scale),(0,y.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",mh.offset),(0,y.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",mh.rotation),(0,y.n)("/extensions/KHR_lights_punctual/lights/{}/color",[new Vh(a.c.ANIMATIONTYPE_COLOR3,"diffuse",ch,(()=>3))]),(0,y.n)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Vh(a.c.ANIMATIONTYPE_FLOAT,"intensity",Wh,(()=>1))]),(0,y.n)("/extensions/KHR_lights_punctual/lights/{}/range",[new Vh(a.c.ANIMATIONTYPE_FLOAT,"range",Wh,(()=>1))]),(0,y.n)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Vh(a.c.ANIMATIONTYPE_FLOAT,"innerAngle",Th,(()=>1))]),(0,y.n)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Vh(a.c.ANIMATIONTYPE_FLOAT,"angle",Th,(()=>1))]),(0,y.n)("/nodes/{}/extensions/EXT_lights_ies/color",[new Vh(a.c.ANIMATIONTYPE_COLOR3,"diffuse",ch,(()=>3))]),(0,y.n)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Vh(a.c.ANIMATIONTYPE_FLOAT,"intensity",Wh,(()=>1))]);const Lh="KHR_animation_pointer";class Ph{constructor(k){this.name=Lh,this._loader=k,this._pathToObjectConverter=(0,y.k)(this._loader.Bh)}get enabled(){return this._loader.isExtensionUsed(Lh)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(k,h,o,x,I){var q;const Y=null===(q=x.target.extensions)||void 0===q?void 0:q.KHR_animation_pointer;if(!Y||!this._pathToObjectConverter)return null;"pointer"!==x.target.path&&c.c.Warn(`${k}/target/path: Value (${x.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=x.target.node&&c.c.Warn(`${k}/target/node: Value (${x.target.node}) must not be present when using the ${this.name} extension`);const J=`${k}/extensions/${this.name}`,G=Y.pointer;if(!G)throw new Error(`${J}: Pointer is missing`);try{const q=this._pathToObjectConverter.convert(G);if(!q.info.interpolation)throw new Error(`${J}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(k,h,o,x,{object:q.object,info:q.info.interpolation},I)}catch(l){return c.c.Warn(`${J}/pointer: Invalid pointer (${G}) skipped`),null}}}H(Lh),n(Lh,!0,(k=>new Ph(k)));class rh{constructor(k,h,o){this.frame=k,this.action=h,this.onlyOnce=o,this.isDone=!1}_clone(){return new rh(this.frame,this.action,this.onlyOnce)}}var th=o(11108),Sh=o(11151),Ch=o(11145);class gh{get loop(){return this._loop}set loop(k){k!==this._loop&&(this._loop=k,this.updateOptions({loop:k}))}get currentTime(){var k;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.audioContext&&(this.isPlaying||this.isPaused)){const k=this.isPaused?0:Sh.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+k}return 0}get spatialSound(){return this._spatialSound}set spatialSound(k){if(k==this._spatialSound)return;const h=this.isPlaying;this.pause(),k?(this._spatialSound=k,this._updateSpatialParameters()):this._disableSpatialSound(),h&&this.play()}constructor(k,h,o){var x;let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new A.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=I.Vh.Zero(),this._localDirection=new I.Vh(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=k,o=o||X.b.LastCreatedScene)if(this._scene=o,gh._SceneComponentInitialization(o),this._readyToPlayCallback=q,this._customAttenuationFunction=(k,h,o,x,I)=>h<o?k*(1-h/o):0,J&&(this.autoplay=J.autoplay||!1,this._loop=J.loop||!1,void 0!==J.volume&&(this._volume=J.volume),this._spatialSound=J.spatialSound??!1,this.maxDistance=J.maxDistance??100,this.useCustomAttenuation=J.useCustomAttenuation??!1,this.rolloffFactor=J.rolloffFactor||1,this.refDistance=J.refDistance||1,this.distanceModel=J.distanceModel||"linear",this._playbackRate=J.playbackRate||1,this._streaming=J.streaming??!1,this._length=J.length,this._offset=J.offset),null!==(x=Sh.e.audioEngine)&&void 0!==x&&x.canUseWebAudio&&Sh.e.audioEngine.audioContext){this._soundGain=Sh.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let k=!0;if(h)try{"string"===typeof h?(this._urlType="String",this._url=h):h instanceof ArrayBuffer?this._urlType="ArrayBuffer":h instanceof HTMLMediaElement?this._urlType="MediaElement":h instanceof MediaStream?this._urlType="MediaStream":h instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(h)&&(this._urlType="Array");let o=[],x=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Sh.e.audioEngine.audioContext.createMediaElementSource(h),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Sh.e.audioEngine.audioContext.createMediaStreamSource(h),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":h.byteLength>0&&(x=!0,this._soundLoaded(h));break;case"AudioBuffer":this._audioBufferLoaded(h);break;case"String":o.push(h);case"Array":0===o.length&&(o=h);for(let k=0;k<o.length;k++){const h=o[k];if(x=J&&J.skipCodecCheck||-1!==h.indexOf(".mp3",h.length-4)&&Sh.e.audioEngine.isMP3supported||-1!==h.indexOf(".ogg",h.length-4)&&Sh.e.audioEngine.isOGGsupported||-1!==h.indexOf(".wav",h.length-4)||-1!==h.indexOf(".m4a",h.length-4)||-1!==h.indexOf(".mp4",h.length-4)||-1!==h.indexOf("blob:"),x){this._streaming?(this._htmlAudioElement=new Audio(h),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Y.Tools.SetCorsBehavior(h,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(h,(k=>{this._soundLoaded(k)}),void 0,!0,!0,(k=>{k&&c.c.Error("XHR "+k.status+" error on: "+h+"."),c.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:k=!1}k?x||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):c.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(G){c.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Sh.e.audioEngine&&!Sh.e.audioEngine.WarnedWebAudioUnsupported&&(c.c.Error("Web Audio is not supported by your browser."),Sh.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var k;null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(k){var h;null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.audioContext&&(this._audioBuffer=k,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(k){var h;null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.audioContext&&Sh.e.audioEngine.audioContext.decodeAudioData(k,(k=>{this._audioBufferLoaded(k)}),(k=>{c.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+k)}))}setAudioBuffer(k){var h;null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&(this._audioBuffer=k,this._isReadyToPlay=!0)}updateOptions(k){k&&(this.loop=k.loop??this.loop,this.maxDistance=k.maxDistance??this.maxDistance,this.useCustomAttenuation=k.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=k.rolloffFactor??this.rolloffFactor,this.refDistance=k.refDistance??this.refDistance,this.distanceModel=k.distanceModel??this.distanceModel,this._playbackRate=k.playbackRate??this._playbackRate,this._length=k.length??void 0,this.spatialSound=k.spatialSound??this._spatialSound,this._setOffset(k.offset??void 0),this.setVolume(k.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var k;null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&Sh.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Sh.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var k;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(k=this._soundPanner)||void 0===k||k.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var k;null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(k){var h;null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(k),this._isOutputConnected=!0)}setDirectionalCone(k,h,o){h<k?c.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=k,this._coneOuterAngle=h,this._coneOuterGain=o,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(k){if(k!=this._coneInnerAngle){var h;if(this._coneOuterAngle<k)return void c.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=k,null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(k){if(k!=this._coneOuterAngle){var h;if(k<this._coneInnerAngle)return void c.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=k,null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(k){var h;k.equals(this._position)||(this._position.Y(k),null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(k){var h;this._localDirection=k,null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const k=this._connectedTransformNode.getWorldMatrix(),h=I.Vh.TransformNormal(this._localDirection,k);h.normalize(),this._soundPanner.orientationX.value=h.x,this._soundPanner.orientationY.value=h.y,this._soundPanner.orientationZ.value=h.z}updateDistanceFromListener(){var k;if(null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const k=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.ih(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,k,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(k){this._customAttenuationFunction=k}play(k,h,o){var x;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(x=Sh.e.audioEngine)&&void 0!==x&&x.audioContext)try{var I,q;this._clearTimeoutsAndObservers();let x=k?(null===(I=Sh.e.audioEngine)||void 0===I?void 0:I.audioContext.currentTime)+k:null===(q=Sh.e.audioEngine)||void 0===q?void 0:q.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Sh.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const k=()=>{var o;if(null!==(o=Sh.e.audioEngine)&&void 0!==o&&o.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=h??0;const o=this._htmlAudioElement.play();void 0!==o&&o.catch((()=>{var h,o;(null===(h=Sh.e.audioEngine)||void 0===h||h.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(o=Sh.e.audioEngine)||void 0===o?void 0:o.onAudioUnlockedObservable.addOnce((()=>{k()})))}))}else{var x;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(x=Sh.e.audioEngine)||void 0===x?void 0:x.onAudioUnlockedObservable.addOnce((()=>{k()}))}};k()}}else{var Y;const I=()=>{var I;if(null!==(I=Sh.e.audioEngine)&&void 0!==I&&I.audioContext){var q;if(o=o||this._length,void 0!==h&&this._setOffset(h),this._soundSource){const k=this._soundSource;k.onended=()=>{k.disconnect()}}if(this._soundSource=null===(q=Sh.e.audioEngine)||void 0===q?void 0:q.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==h&&(this._soundSource.loopStart=h),void 0!==o&&(this._soundSource.loopEnd=(0|h)+o),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},x=k?(null===(Y=Sh.e.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime)+k:Sh.e.audioEngine.audioContext.currentTime;const I=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(x,I,this.loop?void 0:o)}}};"suspended"===(null===(Y=Sh.e.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var k;"suspended"===(null===(k=Sh.e.audioEngine)||void 0===k?void 0:k.audioContext.state)?(Sh.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Sh.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{I()})))):I()}),500):I()}this._startTime=x,this.isPlaying=!0,this.isPaused=!1}catch(J){c.c.Error("Error while trying to play audio: "+this.name+", "+J.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(k){var h;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var o;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(o=this._streamingSource)||void 0===o||o.disconnect();this.isPlaying=!1}else if(null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.audioContext&&this._soundSource){const h=k?Sh.e.audioEngine.audioContext.currentTime+k:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(h)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var k;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var h;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(h=this._streamingSource)||void 0===h||h.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Sh.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(k,h){var o;null!==(o=Sh.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._soundGain&&(h&&Sh.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Sh.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Sh.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(k,Sh.e.audioEngine.audioContext.currentTime+h)):this._soundGain.gain.value=k),this._volume=k}setPlaybackRate(k){this._playbackRate=k,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(k){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=k,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=k=>this._onRegisterAfterWorldMatrixUpdate(k),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(k){var h;if(k.getBoundingInfo){const h=k.getBoundingInfo();this.setPosition(h.boundingSphere.centerWorld)}else this.setPosition(k.absolutePosition);null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const k=()=>{(0,Ch.e)((()=>this._isReadyToPlay),(()=>{o._audioBuffer=this.getAudioBuffer(),o._isReadyToPlay=!0,o.autoplay&&o.play(0,this._offset,this._length)}),void 0,300)},h={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},o=new gh(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,h);return this.useCustomAttenuation&&o.setAttenuationFunction(this._customAttenuationFunction),o.setPosition(this._position),o.setPlaybackRate(this._playbackRate),k(),o}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const k={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(k.connectedMeshId=this._connectedTransformNode.id),k.position=this._position.rh(),k.refDistance=this.refDistance,k.distanceModel=this.distanceModel,k.isDirectional=this._isDirectional,k.localDirectionToMesh=this._localDirection.rh(),k.coneInnerAngle=this._coneInnerAngle,k.coneOuterAngle=this._coneOuterAngle,k.coneOuterGain=this._coneOuterGain),k}static Parse(k,h,o,x){const q=k.name;let Y;Y=k.url?o+k.url:o+q;const J={autoplay:k.autoplay,loop:k.loop,volume:k.volume,spatialSound:k.spatialSound,maxDistance:k.maxDistance,rolloffFactor:k.rolloffFactor,refDistance:k.refDistance,distanceModel:k.distanceModel,playbackRate:k.playbackRate};let G;if(x){const k=()=>{(0,Ch.e)((()=>x._isReadyToPlay),(()=>{G._audioBuffer=x.getAudioBuffer(),G._isReadyToPlay=!0,G.autoplay&&G.play(0,G._offset,G._length)}),void 0,300)};G=new gh(q,new ArrayBuffer(0),h,null,J),k()}else G=new gh(q,Y,h,(()=>{h.removePendingData(G)}),J),h.addPendingData(G);if(k.position){const h=I.Vh.Uh(k.position);G.setPosition(h)}if(k.isDirectional&&(G.setDirectionalCone(k.coneInnerAngle||360,k.coneOuterAngle||360,k.coneOuterGain||0),k.localDirectionToMesh)){const h=I.Vh.Uh(k.localDirectionToMesh);G.setLocalDirectionToMesh(h)}if(k.connectedMeshId){const o=h.getMeshById(k.connectedMeshId);o&&G.attachToMesh(o)}return k.metadata&&(G.metadata=k.metadata),G}_setOffset(k){this._offset!==k&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=k)}_clearTimeoutsAndObservers(){var k;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(k=Sh.e.audioEngine)||void 0===k||k.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}gh._SceneComponentInitialization=k=>{throw(0,th.e)("AudioSceneComponent")},(0,bk.g)("BABYLON.Sound",gh);class eh{constructor(k,h,o){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],h.length!==o.length)throw new Error("Sounds length does not equal weights length");this.loop=k,this._weights=o;let x=0;for(const q of o)x+=q;const I=x>0?1/x:0;for(let q=0;q<this._weights.length;q++)this._weights[q]*=I;this._sounds=h;for(const q of this._sounds)q.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(k){if(k!==this._coneInnerAngle){if(this._coneOuterAngle<k)return void c.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=k;for(const h of this._sounds)h.directionalConeInnerAngle=k}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(k){if(k!==this._coneOuterAngle){if(k<this._coneInnerAngle)return void c.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=k;for(const h of this._sounds)h.directionalConeOuterAngle=k}}get volume(){return this._volume}set volume(k){if(k!==this._volume)for(const h of this._sounds)h.setVolume(k)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(k){if(!this.isPaused){this.stop();const k=Math.random();let h=0;for(let o=0;o<this._weights.length;o++)if(h+=this._weights[o],k<=h){this._currentIndex=o;break}}const h=this._sounds[this._currentIndex??0];h.isReady()?h.play(0,this.isPaused?void 0:k):h.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class uh{constructor(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(k=k||X.b.LastCreatedScene)&&(this._scene=k,this.soundCollection=[],this._options=h,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var k;null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.canUseWebAudio&&Sh.e.audioEngine.audioContext&&(this._outputAudioNode=Sh.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Sh.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Sh.e.audioEngine&&Sh.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(k){var h;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&k.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==k.soundTrackId&&(-1===k.soundTrackId?this._scene.mainSoundTrack.removeSound(k):this._scene.soundTracks&&this._scene.soundTracks[k.soundTrackId].removeSound(k)),this.soundCollection.push(k),k.soundTrackId=this.id}removeSound(k){const h=this.soundCollection.indexOf(k);-1!==h&&this.soundCollection.splice(h,1)}setVolume(k){var h;null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=k)}switchPanningModelToHRTF(){var k;if(null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.canUseWebAudio)for(let h=0;h<this.soundCollection.length;h++)this.soundCollection[h].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var k;if(null!==(k=Sh.e.audioEngine)&&void 0!==k&&k.canUseWebAudio)for(let h=0;h<this.soundCollection.length;h++)this.soundCollection[h].switchPanningModelToEqualPower()}connectToAnalyser(k){var h;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=k,null!==(h=Sh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Sh.e.audioEngine.masterGain))}}var ko=o(11505),ho=o(11472),oo=o(11090);Sh.e.AudioEngineFactory=(k,h,o)=>new xo(k,h,o);class xo{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new A.d,this.onAudioLockedObservable=new A.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,oo.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const x=document.createElement("audio");this._hostElement=k,this._audioContext=h,this._audioDestination=o;try{x&&x.canPlayType&&(x.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||x.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(I){}try{x&&x.canPlayType&&x.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(I){}}lock(){this._triggerSuspendedState()}unlock(){var k,h;if("running"===(null===(k=this._audioContext)||void 0===k?void 0:k.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(h=this._audioContext)||void 0===h||h.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{c.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var k;null===(k=this._audioContext)||void 0===k||k.addEventListener("statechange",(()=>{var k;this.unlocked&&"running"!==(null===(k=this._audioContext)||void 0===k?void 0:k.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var k;return null!==(k=this._audioContext)&&void 0!==k&&k.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(k){this.canUseWebAudio=!1,c.c.Error("Web Audio: "+k.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(k){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const k=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",h=document.createElement("style");h.appendChild(document.createTextNode(k)),document.getElementsByTagName("head")[0].appendChild(h),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var k;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(k=this._audioContext)||void 0===k||k.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(k){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=k)}connectToAnalyser(k){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=k,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Io=o(11106);(0,o(12625).f)(ko.e.NAME_AUDIO,((k,h,o,x)=>{let I,q=[];if(o.Ba=o.Ba||[],void 0!==k.Ba&&null!==k.Ba)for(let J=0,G=k.Ba.length;J<G;J++){var Y;const G=k.Ba[J];null!==(Y=Sh.e.audioEngine)&&void 0!==Y&&Y.canUseWebAudio?(G.url||(G.url=G.name),q[G.url]?o.Ba.push(gh.Parse(G,h,x,q[G.url])):(I=gh.Parse(G,h,x),q[G.url]=I,o.Ba.push(I))):o.Ba.push(new gh(G.name,null,h))}q=[]})),Object.defineProperty(ho.e.prototype,"mainSoundTrack",{get:function(){let k=this._getComponent(ko.e.NAME_AUDIO);return k||(k=new qo(this),this.o(k)),this._mainSoundTrack||(this._mainSoundTrack=new uh(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ho.e.prototype.getSoundByName=function(k){let h;for(h=0;h<this.mainSoundTrack.soundCollection.length;h++)if(this.mainSoundTrack.soundCollection[h].name===k)return this.mainSoundTrack.soundCollection[h];if(this.soundTracks)for(let o=0;o<this.soundTracks.length;o++)for(h=0;h<this.soundTracks[o].soundCollection.length;h++)if(this.soundTracks[o].soundCollection[h].name===k)return this.soundTracks[o].soundCollection[h];return null},Object.defineProperty(ho.e.prototype,"audioEnabled",{get:function(){let k=this._getComponent(ko.e.NAME_AUDIO);return k||(k=new qo(this),this.o(k)),k.audioEnabled},set:function(k){let h=this._getComponent(ko.e.NAME_AUDIO);h||(h=new qo(this),this.o(h)),k?h.enableAudio():h.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ho.e.prototype,"headphone",{get:function(){let k=this._getComponent(ko.e.NAME_AUDIO);return k||(k=new qo(this),this.o(k)),k.headphone},set:function(k){let h=this._getComponent(ko.e.NAME_AUDIO);h||(h=new qo(this),this.o(h)),k?h.switchAudioModeForHeadphones():h.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ho.e.prototype,"audioListenerPositionProvider",{get:function(){let k=this._getComponent(ko.e.NAME_AUDIO);return k||(k=new qo(this),this.o(k)),k.audioListenerPositionProvider},set:function(k){let h=this._getComponent(ko.e.NAME_AUDIO);if(h||(h=new qo(this),this.o(h)),k&&"function"!==typeof k)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");h.audioListenerPositionProvider=k},enumerable:!0,configurable:!0}),Object.defineProperty(ho.e.prototype,"audioListenerRotationProvider",{get:function(){let k=this._getComponent(ko.e.NAME_AUDIO);return k||(k=new qo(this),this.o(k)),k.audioListenerRotationProvider},set:function(k){let h=this._getComponent(ko.e.NAME_AUDIO);if(h||(h=new qo(this),this.o(h)),k&&"function"!==typeof k)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");h.audioListenerRotationProvider=k},enumerable:!0,configurable:!0}),Object.defineProperty(ho.e.prototype,"audioPositioningRefreshRate",{get:function(){let k=this._getComponent(ko.e.NAME_AUDIO);return k||(k=new qo(this),this.o(k)),k.audioPositioningRefreshRate},set:function(k){let h=this._getComponent(ko.e.NAME_AUDIO);h||(h=new qo(this),this.o(h)),h.audioPositioningRefreshRate=k},enumerable:!0,configurable:!0});class qo{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(k){this.name=ko.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new I.Vh,this._cachedCameraPosition=new I.Vh,this._lastCheck=0,this._invertMatrixTemp=new I.Matrix,this._cameraDirectionTemp=new I.Vh,(k=k||X.b.LastCreatedScene)&&(this.Fh=k,k.soundTracks=[],k.Ba=[])}register(){this.Fh._afterRenderStage.registerStep(ko.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(k){if(k.Ba=[],this.Fh.soundTracks)for(let h=0;h<this.Fh.soundTracks.length;h++){const o=this.Fh.soundTracks[h];for(let h=0;h<o.soundCollection.length;h++)k.Ba.push(o.soundCollection[h].serialize())}}addFromContainer(k){if(k.Ba)for(const h of k.Ba)h.play(),h.autoplay=!0,this.Fh.mainSoundTrack.addSound(h)}removeFromContainer(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(k.Ba)for(const o of k.Ba)o.stop(),o.autoplay=!1,this.Fh.mainSoundTrack.removeSound(o),h&&o.dispose()}dispose(){const k=this.Fh;if(k._mainSoundTrack&&k.mainSoundTrack.dispose(),k.soundTracks)for(let h=0;h<k.soundTracks.length;h++)k.soundTracks[h].dispose()}disableAudio(){const k=this.Fh;let h;for(this._audioEnabled=!1,Sh.e.audioEngine&&Sh.e.audioEngine.audioContext&&Sh.e.audioEngine.audioContext.suspend(),h=0;h<k.mainSoundTrack.soundCollection.length;h++)k.mainSoundTrack.soundCollection[h].pause();if(k.soundTracks)for(h=0;h<k.soundTracks.length;h++)for(let o=0;o<k.soundTracks[h].soundCollection.length;o++)k.soundTracks[h].soundCollection[o].pause()}enableAudio(){const k=this.Fh;let h;for(this._audioEnabled=!0,Sh.e.audioEngine&&Sh.e.audioEngine.audioContext&&Sh.e.audioEngine.audioContext.resume(),h=0;h<k.mainSoundTrack.soundCollection.length;h++)k.mainSoundTrack.soundCollection[h].isPaused&&k.mainSoundTrack.soundCollection[h].play();if(k.soundTracks)for(h=0;h<k.soundTracks.length;h++)for(let o=0;o<k.soundTracks[h].soundCollection.length;o++)k.soundTracks[h].soundCollection[o].isPaused&&k.soundTracks[h].soundCollection[o].play()}switchAudioModeForHeadphones(){const k=this.Fh;if(this._headphone=!0,k.mainSoundTrack.switchPanningModelToHRTF(),k.soundTracks)for(let h=0;h<k.soundTracks.length;h++)k.soundTracks[h].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const k=this.Fh;if(this._headphone=!1,k.mainSoundTrack.switchPanningModelToEqualPower(),k.soundTracks)for(let h=0;h<k.soundTracks.length;h++)k.soundTracks[h].switchPanningModelToEqualPower()}_afterRender(){const k=Io.d.Now;if(this._lastCheck&&k-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=k;const h=this.Fh;if(!this._audioEnabled||!h._mainSoundTrack||!h.soundTracks||0===h._mainSoundTrack.soundCollection.length&&1===h.soundTracks.length)return;const o=Sh.e.audioEngine;if(o&&o.audioContext){let k,x=h.activeCamera;if(h.activeCameras&&h.activeCameras.length>0&&(x=h.activeCameras[0]),this.audioListenerPositionProvider){const k=this.audioListenerPositionProvider();o.audioContext.listener.setPosition(k.x||0,k.y||0,k.z||0)}else x?this._cachedCameraPosition.equals(x.globalPosition)||(this._cachedCameraPosition.Y(x.globalPosition),o.audioContext.listener.setPosition(x.globalPosition.x,x.globalPosition.y,x.globalPosition.z)):o.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const k=this.audioListenerRotationProvider();o.audioContext.listener.setOrientation(k.x||0,k.y||0,k.z||0,0,1,0)}else x?(x.rigCameras&&x.rigCameras.length>0&&(x=x.rigCameras[0]),x.getViewMatrix().invertToRef(this._invertMatrixTemp),I.Vh.TransformNormalToRef(qo._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.Y(this._cameraDirectionTemp),o.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):o.audioContext.listener.setOrientation(0,0,0,0,1,0);for(k=0;k<h.mainSoundTrack.soundCollection.length;k++){const o=h.mainSoundTrack.soundCollection[k];o.useCustomAttenuation&&o.updateDistanceFromListener()}if(h.soundTracks)for(k=0;k<h.soundTracks.length;k++)for(let o=0;o<h.soundTracks[k].soundCollection.length;o++){const x=h.soundTracks[k].soundCollection[o];x.useCustomAttenuation&&x.updateDistanceFromListener()}}}}qo._CameraDirection=new I.Vh(0,0,-1),gh._SceneComponentInitialization=k=>{let h=k._getComponent(ko.e.NAME_AUDIO);h||(h=new qo(k),k.o(h))};const Yo="MSFT_audio_emitter";class Jo{constructor(k){this.name=Yo,this._loader=k,this.enabled=this._loader.isExtensionUsed(Yo)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const k=this._loader.Bh.extensions;if(k&&k[this.name]){const h=k[this.name];this._clips=h.clips,this._emitters=h.emitters,p.Assign(this._clips),p.Assign(this._emitters)}}loadSceneAsync(k,h){return m.LoadExtensionAsync(k,h,this.name,(async(o,x)=>{const I=new Array;I.push(this._loader.loadSceneAsync(k,h));for(const k of x.emitters){const h=p.Get(`${o}/emitters`,this._emitters,k);if(void 0!=h.refDistance||void 0!=h.maxDistance||void 0!=h.rolloffFactor||void 0!=h.distanceModel||void 0!=h.innerAngle||void 0!=h.outerAngle)throw new Error(`${o}: Direction or Distance properties are not allowed on emitters attached to a scene`);I.push(this._loadEmitterAsync(`${o}/emitters/${h.index}`,h))}await Promise.all(I)}))}loadNodeAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(k,x)=>{const q=new Array,J=await this._loader.loadNodeAsync(k,h,(h=>{for(const o of x.emitters){const x=p.Get(`${k}/emitters`,this._emitters,o);q.push(this._loadEmitterAsync(`${k}/emitters/${x.index}`,x).then((()=>{for(const k of x._babylonSounds)k.attachToMesh(h),void 0==x.innerAngle&&void 0==x.outerAngle||(k.setLocalDirectionToMesh(I.Vh.Forward()),k.setDirectionalCone(2*Y.Tools.ToDegrees(void 0==x.innerAngle?Math.PI:x.innerAngle),2*Y.Tools.ToDegrees(void 0==x.outerAngle?Math.PI:x.outerAngle),0))})))}o(h)}));return await Promise.all(q),J}))}loadAnimationAsync(k,h){return m.LoadExtensionAsync(k,h,this.name,(async(o,x)=>{const I=await this._loader.loadAnimationAsync(k,h),q=new Array;p.Assign(x.events);for(const Y of x.events)q.push(this._loadAnimationEventAsync(`${o}/events/${Y.index}`,k,h,Y,I));return await Promise.all(q),I}))}_loadClipAsync(k,h){if(h._objectURL)return h._objectURL;let o;if(h.uri)o=this._loader.loadUriAsync(k,h,h.uri);else{const x=p.Get(`${k}/bufferView`,this._loader.Bh.bufferViews,h.bufferView);o=this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}return h._objectURL=o.then((k=>URL.createObjectURL(new Blob([k],{type:h.mimeType})))),h._objectURL}_loadEmitterAsync(k,h){if(h._babylonSounds=h._babylonSounds||[],!h._babylonData){const k=new Array,o=h.name||`emitter${h.index}`,x={loop:!1,autoplay:!1,volume:void 0==h.volume?1:h.volume};for(let q=0;q<h.clips.length;q++){const I=`/extensions/${this.name}/clips`,Y=p.Get(I,this._clips,h.clips[q].clip);k.push(this._loadClipAsync(`${I}/${h.clips[q].clip}`,Y).then((k=>{const I=h._babylonSounds[q]=new gh(o,k,this._loader.babylonScene,null,x);I.refDistance=h.refDistance||1,I.maxDistance=h.maxDistance||256,I.rolloffFactor=h.rolloffFactor||1,I.distanceModel=h.distanceModel||"exponential"})))}const I=Promise.all(k).then((()=>{const k=h.clips.map((k=>k.weight||1)),o=new eh(h.loop||!1,h._babylonSounds,k);h.innerAngle&&(o.directionalConeInnerAngle=2*Y.Tools.ToDegrees(h.innerAngle)),h.outerAngle&&(o.directionalConeOuterAngle=2*Y.Tools.ToDegrees(h.outerAngle)),h.volume&&(o.volume=h.volume),h._babylonData.sound=o}));h._babylonData={loaded:I}}return h._babylonData.loaded}_getEventAction(k,h,o,x,I){switch(o){case"play":return k=>{const o=(I||0)+(k-x);h.play(o)};case"stop":return()=>{h.stop()};case"pause":return()=>{h.pause()};default:throw new Error(`${k}: Unsupported action ${o}`)}}_loadAnimationEventAsync(k,h,o,x,I){if(0==I.targetedAnimations.length)return Promise.resolve();const q=I.targetedAnimations[0],Y=x.Ih,J=p.Get(`/extensions/${this.name}/emitters`,this._emitters,Y);return this._loadEmitterAsync(k,J).then((()=>{const h=J._babylonData.sound;if(h){const o=new rh(x.time,this._getEventAction(k,h,x.action,x.time,x.startOffset));q.animation.addEvent(o),I.onAnimationGroupEndObservable.add((()=>{h.stop()})),I.onAnimationGroupPauseObservable.add((()=>{h.pause()}))}}))}}H(Yo),n(Yo,!0,(k=>new Jo(k)));const Go="MSFT_lod";class lo{constructor(k){var h;this.name=Go,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new A.d,this.onMaterialLODsLoadedObservable=new A.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=k,this.maxLODsToLoad=(null===(h=this._loader.parent.extensionOptions[Go])||void 0===h?void 0:h.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Go)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let k=0;k<this._nodePromiseLODs.length;k++){const h=Promise.all(this._nodePromiseLODs[k]).then((()=>{0!==k&&(this._loader.endPerformanceCounter(`Node LOD ${k}`),this._loader.log(`Loaded node LOD ${k}`)),this.onNodeLODsLoadedObservable.notifyObservers(k),k!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${k+1}`),this._loadBufferLOD(this._nodeBufferLODs,k+1),this._nodeSignalLODs[k]&&this._nodeSignalLODs[k].resolve())}));this._loader._completePromises.push(h)}for(let k=0;k<this._materialPromiseLODs.length;k++){const h=Promise.all(this._materialPromiseLODs[k]).then((()=>{0!==k&&(this._loader.endPerformanceCounter(`Material LOD ${k}`),this._loader.log(`Loaded material LOD ${k}`)),this.onMaterialLODsLoadedObservable.notifyObservers(k),k!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${k+1}`),this._loadBufferLOD(this._materialBufferLODs,k+1),this._materialSignalLODs[k]&&this._materialSignalLODs[k].resolve())}));this._loader._completePromises.push(h)}}loadSceneAsync(k,h){const o=this._loader.loadSceneAsync(k,h);return this._loadBufferLOD(this._bufferLODs,0),o}loadNodeAsync(k,h,o){return m.LoadExtensionAsync(k,h,this.name,(async(k,I)=>{let q;const Y=this._getLODs(k,h,this._loader.Bh.nodes,I.ids);this._loader.logOpen(`${k}`);for(let h=0;h<Y.length;h++){const k=Y[h];0!==h&&(this._nodeIndexLOD=h,this._nodeSignalLODs[h]=this._nodeSignalLODs[h]||new x);const I=k=>{o(k),k.tJ(!1)},J=this._loader.loadNodeAsync(`/nodes/${k.index}`,k,I).then((k=>{if(0!==h){const k=Y[h-1];k._babylonTransformNode&&(this._disposeTransformNode(k._babylonTransformNode),delete k._babylonTransformNode)}return k.tJ(!0),k}));this._nodePromiseLODs[h]=this._nodePromiseLODs[h]||[],0===h?q=J:(this._nodeIndexLOD=null,this._nodePromiseLODs[h].push(J))}return this._loader.logClose(),await q}))}_loadMaterialAsync(k,h,o,x,I){return this._nodeIndexLOD?null:m.LoadExtensionAsync(k,h,this.name,(async(k,q)=>{let Y;const J=this._getLODs(k,h,this._loader.Bh.materials,q.ids);this._loader.logOpen(`${k}`);for(let h=0;h<J.length;h++){const k=J[h];0!==h&&(this._materialIndexLOD=h);const q=this._loader._loadMaterialAsync(`/materials/${k.index}`,k,o,x,(k=>{0===h&&I(k)})).then((k=>{if(0!==h){I(k);const o=J[h-1]._data;o[x]&&(this._disposeMaterials([o[x].babylonMaterial]),delete o[x])}return k}));this._materialPromiseLODs[h]=this._materialPromiseLODs[h]||[],0===h?Y=q:(this._materialIndexLOD=null,this._materialPromiseLODs[h].push(q))}return this._loader.logClose(),await Y}))}_loadUriAsync(k,h,o){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const I=this._nodeIndexLOD-1;return this._nodeSignalLODs[I]=this._nodeSignalLODs[I]||new x,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(k,h,o)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const I=this._materialIndexLOD-1;return this._materialSignalLODs[I]=this._materialSignalLODs[I]||new x,this._materialSignalLODs[I].promise.then((async()=>await this._loader.loadUriAsync(k,h,o)))}return null}loadBufferAsync(k,h,o,I){if(this._loader.parent.useRangeRequests&&!h.uri){if(!this._loader.bin)throw new Error(`${k}: Uri is missing or the binary glTF is missing its binary chunk`);const h=async(k,h)=>{const q=o,Y=q+I-1;let J=k[h];return J?(J.start=Math.min(J.start,q),J.end=Math.max(J.end,Y)):(J={start:q,end:Y,loaded:new x},k[h]=J),await J.loaded.promise.then((k=>new Uint8Array(k.buffer,k.byteOffset+o-J.start,I)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?h(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?h(this._materialBufferLODs,this._materialIndexLOD):h(this._bufferLODs,0)}return null}_loadBufferLOD(k,h){const o=k[h];o&&(this._loader.log(`Loading buffer range [${o.start}-${o.end}]`),this._loader.bin.readAsync(o.start,o.end-o.start+1).then((k=>{o.loaded.resolve(k)}),(k=>{o.loaded.reject(k)})))}_getLODs(k,h,o,x){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const I=[];for(let q=x.length-1;q>=0;q--)if(I.push(p.Get(`${k}/ids/${x[q]}`,o,x[q])),I.length===this.maxLODsToLoad)return I;return I.push(h),I}_disposeTransformNode(k){const h=[],o=k.material;o&&h.push(o);for(const I of k.getChildMeshes())I.material&&h.push(I.material);k.dispose();const x=h.filter((k=>this._loader.babylonScene.meshes.every((h=>h.material!=k))));this._disposeMaterials(x)}_disposeMaterials(k){const h={};for(const o of k){for(const k of o.getActiveTextures())h[k.uniqueId]=k;o.dispose()}for(const o in h)for(const k of this._loader.babylonScene.materials)k.hasTexture(h[o])&&delete h[o];for(const o in h)h[o].dispose()}}H(Go),n(Go,!0,(k=>new lo(k)));const Ao="MSFT_minecraftMesh";class Ko{constructor(k){this.name=Ao,this._loader=k,this.enabled=this._loader.isExtensionUsed(Ao)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtraAsync(k,h,this.name,(async(x,I)=>{if(I){if(!(o instanceof T.d))throw new Error(`${x}: Material type not supported`);const I=this._loader.loadMaterialPropertiesAsync(k,h,o);return o.needAlphaBlending()&&(o.forceDepthWrite=!0,o.separateCullingPass=!0),o.bJ=o.forceDepthWrite,o.twoSidedLighting=!0,await I}}))}}H(Ao),n(Ao,!0,(k=>new Ko(k)));const ao="MSFT_sRGBFactors";class No{constructor(k){this.name=ao,this._loader=k,this.enabled=this._loader.isExtensionUsed(ao)}dispose(){this._loader=null}loadMaterialPropertiesAsync(k,h,o){return m.LoadExtraAsync(k,h,this.name,(async(x,I)=>{if(I){if(!(o instanceof T.d))throw new Error(`${x}: Material type not supported`);const I=this._loader.loadMaterialPropertiesAsync(k,h,o),q=o.ik().getEngine().useExactSrgbConversions;return o.albedoTexture||o.albedoColor.toLinearSpaceToRef(o.albedoColor,q),o.reflectivityTexture||o.reflectivityColor.toLinearSpaceToRef(o.reflectivityColor,q),await I}}))}}H(ao),n(ao,!0,(k=>new No(k)));var Xo=o(12921);const co={};var Wo=o(12981),fo=o(12954),Mo=o(12926),To=o(12936);function jo(k,h){for(const o of k)for(const k of o.dataOutputs)if(k.uniqueId===h)return k;throw new Error("Could not find data out connection with unique id "+h)}function bo(k,h){for(const o of k)if(o instanceof fo.c)for(const k of o.signalInputs)if(k.uniqueId===h)return k;throw new Error("Could not find signal in connection with unique id "+h)}async function Vo(k,h){const x=await Promise.all(k.allBlocks.map((async k=>{const h=function(k){switch(k){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([o.e(78),o.e(79)]).then(o.bind(o,14360))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await o.e(80).then(o.bind(o,14368))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await o.e(81).then(o.bind(o,14376))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await o.e(82).then(o.bind(o,14378))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await o.e(83).then(o.bind(o,14380))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await o.e(84).then(o.bind(o,14385))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await o.e(85).then(o.bind(o,14387))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await o.e(86).then(o.bind(o,14391))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await o.e(87).then(o.bind(o,14395))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await o.e(90).then(o.bind(o,14417))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await o.e(90).then(o.bind(o,14417))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await o.e(90).then(o.bind(o,14417))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await o.e(90).then(o.bind(o,14417))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await o.e(95).then(o.bind(o,14425))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await o.e(96).then(o.bind(o,14429))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await o.e(97).then(o.bind(o,14436))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await o.e(98).then(o.bind(o,14443))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await o.e(99).then(o.bind(o,14447))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await o.e(100).then(o.bind(o,14456))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await o.e(101).then(o.bind(o,14459))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await o.e(102).then(o.bind(o,14465))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await o.e(103).then(o.bind(o,14471))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await o.e(104).then(o.bind(o,14474))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await o.e(105).then(o.bind(o,14482))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await o.e(106).then(o.bind(o,14488))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await o.e(107).then(o.bind(o,14491))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await o.e(108).then(o.bind(o,14500))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await o.e(109).then(o.bind(o,14506))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await o.e(110).then(o.bind(o,14508))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await o.e(111).then(o.bind(o,14512))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await o.e(112).then(o.bind(o,14518))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await o.e(113).then(o.bind(o,14522))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await o.e(92).then(o.bind(o,14528))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await o.e(114).then(o.bind(o,14536))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await o.e(115).then(o.bind(o,14542))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await o.e(116).then(o.bind(o,14550))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await o.e(93).then(o.bind(o,14559))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await o.e(88).then(o.bind(o,14403))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await o.e(94).then(o.bind(o,14561))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await o.e(94).then(o.bind(o,14561))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await o.e(94).then(o.bind(o,14561))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await o.e(94).then(o.bind(o,14561))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await o.e(94).then(o.bind(o,14561))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await o.e(94).then(o.bind(o,14561))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await o.e(94).then(o.bind(o,14561))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await o.e(94).then(o.bind(o,14561))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await o.e(89).then(o.bind(o,14415))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await o.e(90).then(o.bind(o,14417))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await o.e(90).then(o.bind(o,14417))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await o.e(91).then(o.bind(o,14569))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await o.e(91).then(o.bind(o,14569))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await o.e(91).then(o.bind(o,14569))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await o.e(91).then(o.bind(o,14569))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await o.e(91).then(o.bind(o,14569))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await o.e(91).then(o.bind(o,14569))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await o.e(117).then(o.bind(o,14578))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await o.e(118).then(o.bind(o,14586))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await o.e(119).then(o.bind(o,14591))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await o.e(120).then(o.bind(o,14593))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await o.e(121).then(o.bind(o,14598))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await o.e(122).then(o.bind(o,14600))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await o.e(123).then(o.bind(o,14603))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await o.e(124).then(o.bind(o,14605))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await o.e(125).then(o.bind(o,14608))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await o.e(126).then(o.bind(o,14617))).FlowGraphDataSwitchBlock;default:if(co[k])return co[k];throw new Error(`Unknown block name ${k}`)}}(k.className);return await h()})));return function(k,h,o){const x=h.coordinator.createGraph(),I=[],q=h.valueParseFunction??Mo.c;for(let Y=0;Y<k.allBlocks.length;Y++){const J=Fo(k.allBlocks[Y],{Fh:h.coordinator.config.Fh,pathConverter:h.pathConverter,assetsContainer:h.coordinator.config.Fh,valueParseFunction:q},o[Y]);I.push(J),J instanceof Wo.e&&x.addEventBlock(J)}for(const Y of I){for(const k of Y.dataInputs)for(const h of k.connectedPointIds){const o=jo(I,h);k.connectTo(o)}if(Y instanceof fo.c)for(const k of Y.signalOutputs)for(const h of k.connectedPointIds){const o=bo(I,h);k.connectTo(o)}}for(const Y of k.executionContexts)io(Y,{graph:x,valueParseFunction:q},k.rightHanded);return x}(k,h,x)}function io(k,h,o){const x=h.graph.createContext();k.enableLogging&&(x.enableLogging=!0),x.treatDataAsRightHanded=o||!1;const I=h.valueParseFunction??Mo.c;x.uniqueId=k.uniqueId;const q=x.ik();if(k._assetsContext){var Y,J,G,l,A,K,a,N,X,c;const h=k._assetsContext,o={meshes:null===(Y=h.meshes)||void 0===Y?void 0:Y.map((k=>q.getMeshById(k))),lights:null===(J=h.lights)||void 0===J?void 0:J.map((k=>q.getLightByName(k))),cameras:null===(G=h.cameras)||void 0===G?void 0:G.map((k=>q.getCameraByName(k))),materials:null===(l=h.materials)||void 0===l?void 0:l.map((k=>q.getMaterialById(k))),textures:null===(A=h.textures)||void 0===A?void 0:A.map((k=>q.getTextureByName(k))),animations:null===(K=h.animations)||void 0===K?void 0:K.map((k=>q.animations.find((h=>h.name===k)))),skeletons:null===(a=h.skeletons)||void 0===a?void 0:a.map((k=>q.getSkeletonByName(k))),ka:null===(N=h.ka)||void 0===N?void 0:N.map((k=>q.getParticleSystemById(k))),animationGroups:null===(X=h.animationGroups)||void 0===X?void 0:X.map((k=>q.getAnimationGroupByName(k))),transformNodes:null===(c=h.transformNodes)||void 0===c?void 0:c.map((k=>q.getTransformNodeById(k))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Ba:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};x.assetsContext=o}for(const W in k._userVariables){const h=I(W,k._userVariables,x.assetsContext,q);x.userVariables[W]=h}for(const W in k._connectionValues){const h=I(W,k._connectionValues,x.assetsContext,q);x._setConnectionValueByKey(W,h)}return x}function Fo(k,h,o){const x={},I=h.valueParseFunction??Mo.c;if(k.config)for(const Y in k.config)x[Y]=I(Y,k.config,h.assetsContainer||h.Fh,h.Fh);if((0,Mo.f)(k.className)){if(!h.pathConverter)throw new Error("Path converter is required for this block");x.pathConverter=h.pathConverter}const q=new o(x);q.uniqueId=k.uniqueId;for(let Y=0;Y<k.dataInputs.length;Y++){const h=q.getDataInput(k.dataInputs[Y].name);if(!h)throw new Error("Could not find data input with name "+k.dataInputs[Y].name+" in block "+k.className);h.deserialize(k.dataInputs[Y])}for(let Y=0;Y<k.dataOutputs.length;Y++){const h=q.getDataOutput(k.dataOutputs[Y].name);if(!h)throw new Error("Could not find data output with name "+k.dataOutputs[Y].name+" in block "+k.className);h.deserialize(k.dataOutputs[Y])}return q.metadata=k.metadata,q.deserialize&&q.deserialize(k),q}function Ro(k){const[h,o]=k.split(":");return so({op:h,extension:o})}function so(k){var h;let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const x=k.extension?null===(h=wo[k.extension])||void 0===h?void 0:h[k.op]:Do[k.op];if(!x&&(c.c.Warn(`No mapping found for operation ${k.op} and extension ${k.extension||"KHR_interactivity"}`),o)){const h={},o={flows:{}};if(k.inputValueSockets){h.values={};for(const o in k.inputValueSockets)h.values[o]={name:o}}return k.outputValueSockets&&(o.values={},Object.keys(k.outputValueSockets).forEach((k=>{o.values[k]={name:k}}))),{MA:[],inputs:h,outputs:o}}return x}function Zo(k,h,o){wo[h]||(wo[h]={}),wo[h][k]=o}const wo={BABYLON:{"flow/log":{MA:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Do={"event/onStart":{MA:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{MA:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{MA:["FlowGraphSendCustomEventBlock"],extraProcessor(k,h,o,x,I){if("event/send"!==h.op||!k.configuration||1!==Object.keys(k.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const q=k.configuration.event.value[0];if("number"!==typeof q)throw new Error("Event id should be a number");const Y=x.arrays.events[q],J=I[0];return J.config||(J.config={}),J.config.eventId=Y.eventId,J.config.eventData=Y.eventData,I}},"event/receive":{MA:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(k,h){var o;if(!k.configuration)return c.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const x=k.configuration.event;if(!x)return c.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const I=x.value[0];if("number"!==typeof I)return c.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(o=h.events)||void 0===o?void 0:o[I])?{valid:!0}:(c.c.Error(`Event with id ${I} not found`),{valid:!1,error:`Event with id ${I} not found`})},extraProcessor(k,h,o,x,I){if("event/receive"!==h.op||!k.configuration||1!==Object.keys(k.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const q=k.configuration.event.value[0];if("number"!==typeof q)throw new Error("Event id should be a number");const Y=x.arrays.events[q],J=I[0];return J.config||(J.config={}),J.config.eventId=Y.eventId,J.config.eventData=Y.eventData,I}},"math/e":Uo("FlowGraphEBlock"),"math/pi":Uo("FlowGraphPIBlock"),"math/inf":Uo("FlowGraphInfBlock"),"math/nan":Uo("FlowGraphNaNBlock"),"math/abs":Uo("FlowGraphAbsBlock"),"math/sign":Uo("FlowGraphSignBlock"),"math/trunc":Uo("FlowGraphTruncBlock"),"math/floor":Uo("FlowGraphFloorBlock"),"math/ceil":Uo("FlowGraphCeilBlock"),"math/round":{MA:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I){var q;return(q=I[0]).config||(q.config={}),I[0].config.roundHalfAwayFromZero=!0,I}},"math/fract":Uo("FlowGraphFractBlock"),"math/neg":Uo("FlowGraphNegationBlock"),"math/add":Uo("FlowGraphAddBlock",["a","b"],!0),"math/sub":Uo("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{MA:["FlowGraphMultiplyBlock"],extraProcessor(k,h,o,x,I){var q;(q=I[0]).config||(q.config={}),I[0].config.useMatrixPerComponent=!0,I[0].config.preventIntegerFloatArithmetic=!0;let Y=-1;return Object.keys(k.values||{}).find((h=>{var o;return void 0!==(null===(o=k.values)||void 0===o?void 0:o[h].type)&&(Y=k.values[h].type,!0)})),-1!==Y&&(I[0].config.type=x.arrays.types[Y].flowGraphType),I},validation:k=>k.values?Qo(k):{valid:!0}},"math/div":Uo("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Uo("FlowGraphModuloBlock",["a","b"]),"math/min":Uo("FlowGraphMinBlock",["a","b"]),"math/max":Uo("FlowGraphMaxBlock",["a","b"]),"math/clamp":Uo("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Uo("FlowGraphSaturateBlock"),"math/mix":Uo("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Uo("FlowGraphEqualityBlock",["a","b"]),"math/lt":Uo("FlowGraphLessThanBlock",["a","b"]),"math/le":Uo("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Uo("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Uo("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Uo("FlowGraphIsNaNBlock"),"math/isinf":Uo("FlowGraphIsInfBlock"),"math/select":{MA:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{MA:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Uo("FlowGraphSinBlock"),"math/cos":Uo("FlowGraphCosBlock"),"math/tan":Uo("FlowGraphTanBlock"),"math/asin":Uo("FlowGraphASinBlock"),"math/acos":Uo("FlowGraphACosBlock"),"math/atan":Uo("FlowGraphATanBlock"),"math/atan2":Uo("FlowGraphATan2Block",["a","b"]),"math/sinh":Uo("FlowGraphSinhBlock"),"math/cosh":Uo("FlowGraphCoshBlock"),"math/tanh":Uo("FlowGraphTanhBlock"),"math/asinh":Uo("FlowGraphASinhBlock"),"math/acosh":Uo("FlowGraphACoshBlock"),"math/atanh":Uo("FlowGraphATanhBlock"),"math/exp":Uo("FlowGraphExponentialBlock"),"math/log":Uo("FlowGraphLogBlock"),"math/log2":Uo("FlowGraphLog2Block"),"math/log10":Uo("FlowGraphLog10Block"),"math/sqrt":Uo("FlowGraphSquareRootBlock"),"math/cbrt":Uo("FlowGraphCubeRootBlock"),"math/pow":Uo("FlowGraphPowerBlock",["a","b"]),"math/length":Uo("FlowGraphLengthBlock"),"math/normalize":Uo("FlowGraphNormalizeBlock"),"math/dot":Uo("FlowGraphDotBlock",["a","b"]),"math/cross":Uo("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Uo("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Uo("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{MA:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{MA:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{MA:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{MA:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{MA:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{MA:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{MA:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Uo("FlowGraphTransposeBlock"),"math/determinant":Uo("FlowGraphDeterminantBlock"),"math/inverse":Uo("FlowGraphInvertMatrixBlock"),"math/matmul":Uo("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{MA:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"iJ",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I,q){const Y=I[0].dataInputs.find((k=>"rotationQuaternion"===k.name));if(!Y)throw new Error("Rotation quaternion input not found");return q._connectionValues[Y.uniqueId]&&(q._connectionValues[Y.uniqueId].type="Quaternion"),I}},"math/matDecompose":{MA:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"iJ"}}}},"math/quatConjugate":Uo("FlowGraphConjugateBlock",["a"]),"math/quatMul":{MA:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I){var q;return(q=I[0]).config||(q.config={}),I[0].config.type="Quaternion",I}},"math/quatAngleBetween":Uo("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{MA:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Uo("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Uo("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{MA:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I){var q;return(q=I[0]).config||(q.config={}),I[0].config.inputIsColumnMajor=!0,I}},"math/extract2x2":{MA:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{MA:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I){var q;return(q=I[0]).config||(q.config={}),I[0].config.inputIsColumnMajor=!0,I}},"math/extract3x3":{MA:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{MA:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I){var q;return(q=I[0]).config||(q.config={}),I[0].config.inputIsColumnMajor=!0,I}},"math/extract4x4":{MA:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{MA:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I,q){var Y,J;(J=I[0]).config||(J.config={});const G=I[0].dataInputs[0];return I[0].config.valueType=(null===(Y=q._connectionValues[G.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",I}},"math/and":{MA:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I,q){var Y,J,G;(G=I[0]).config||(G.config={});const l=I[0].dataInputs[0],A=I[0].dataInputs[1];return I[0].config.valueType=(null===(Y=q._connectionValues[l.uniqueId])||void 0===Y?void 0:Y.type)??(null===(J=q._connectionValues[A.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",I}},"math/or":{MA:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I,q){var Y,J,G;(G=I[0]).config||(G.config={});const l=I[0].dataInputs[0],A=I[0].dataInputs[1];return I[0].config.valueType=(null===(Y=q._connectionValues[l.uniqueId])||void 0===Y?void 0:Y.type)??(null===(J=q._connectionValues[A.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",I}},"math/xor":{MA:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(k,h,o,x,I,q){var Y,J,G;(G=I[0]).config||(G.config={});const l=I[0].dataInputs[0],A=I[0].dataInputs[1];return I[0].config.valueType=(null===(Y=q._connectionValues[l.uniqueId])||void 0===Y?void 0:Y.type)??(null===(J=q._connectionValues[A.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",I}},"math/asr":Uo("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Uo("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Uo("FlowGraphLeadingZerosBlock"),"math/ctz":Uo("FlowGraphTrailingZerosBlock"),"math/popcnt":Uo("FlowGraphOneBitsCounterBlock"),"math/rad":Uo("FlowGraphDegToRadBlock"),"math/deg":Uo("FlowGraphRadToDegBlock"),"type/boolToInt":Uo("FlowGraphBooleanToInt"),"type/boolToFloat":Uo("FlowGraphBooleanToFloat"),"type/intToBool":Uo("FlowGraphIntToBoolean"),"type/intToFloat":Uo("FlowGraphIntToFloat"),"type/floatToInt":Uo("FlowGraphFloatToInt"),"type/floatToBool":Uo("FlowGraphFloatToBoolean"),"flow/sequence":{MA:["FlowGraphSequenceBlock"],extraProcessor(k,h,o,x,I){const q=I[0];return q.config||(q.config={}),q.config.outputSignalCount=Object.keys(k.flows||[]).length,q.signalOutputs.forEach(((k,h)=>{k.name="out_"+h})),I}},"flow/branch":{MA:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{MA:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(k){if(k.configuration&&k.configuration.cases){const h=k.configuration.cases.value;if(!h.every((k=>"number"===typeof k&&/^-?\d+$/.test(k.toString()))))return c.c.Warn("Switch cases should be integers. Using empty array instead."),k.configuration.cases.value=[],{valid:!0};const o=new Set(h);k.configuration.cases.value=Array.from(o)}return{valid:!0}},extraProcessor(k,h,o,x,I){if("flow/switch"!==h.op||!k.flows||0===Object.keys(k.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return I[0].signalOutputs.forEach((k=>{"default"!==k.name&&(k.name="out_"+k.name)})),I}},"flow/while":{MA:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{MA:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(k,h,o,x,I){const q=I[0];return q.config||(q.config={}),q.config.incrementIndexWhenLoopDone=!0,I}},"flow/doN":{MA:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{MA:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(k,h,o,x,I){if("flow/multiGate"!==h.op||!k.flows||0===Object.keys(k.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const q=I[0];return q.config||(q.config={}),q.config.outputSignalCount=Object.keys(k.flows).length,q.signalOutputs.forEach(((k,h)=>{k.name="out_"+h})),I}},"flow/waitAll":{MA:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(k){var h,o;return"number"!==typeof(null===(h=k.configuration)||void 0===h||null===(o=h.inputFlows)||void 0===o?void 0:o.value[0])&&(k.configuration=k.configuration||{inputFlows:{value:[0]}},k.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{MA:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{MA:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{MA:["FlowGraphCancelDelayBlock"]},"variable/get":{MA:["FlowGraphGetVariableBlock"],validation(k){var h,o;return null!==(h=k.configuration)&&void 0!==h&&null!==(o=h.variable)&&void 0!==o&&o.value?{valid:!0}:(c.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(k,h)=>[h.getVariableName(k[0])]}}},"variable/set":{MA:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(k,h)=>[h.getVariableName(k[0])]}}},"variable/setMultiple":{MA:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(k,h)=>[k[0].map((k=>h.getVariableName(k)))]}},extraProcessor:(k,h,o,x,I)=>(I[0].dataInputs.forEach((k=>{k.name=x.getVariableName(+k.name)})),I)},"variable/interpolate":{MA:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(k,h)=>[h.getVariableName(k[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:k=>!0===k[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Oo:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Oo:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Oo:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Oo:"FlowGraphPlayAnimationBlock"},out:{name:"out",Oo:"FlowGraphPlayAnimationBlock"},done:{name:"done",Oo:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(k,h,o,x,I){var q,Y,J;const G=I[0],l=null===(q=k.configuration)||void 0===q?void 0:q.variable.value[0];if("number"!==typeof l)throw c.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const A=x.arrays.staticVariables[l];"undefined"===typeof G.config.animationType.value&&(x.arrays.staticVariables,G.config.animationType.value=(0,To.y)(A.type));const K=I[4];return K.config||(K.config={}),(Y=K.config).variable||(Y.variable={}),K.config.variable.value=x.getVariableName(l),(J=I[3]).config||(J.config={}),I}},"pointer/get":{MA:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Oo:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Oo:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(k,h,o,x,I)=>(I.forEach((k=>{"FlowGraphJsonPointerParserBlock"===k.className&&(k.config||(k.config={}),k.config.outputValue=!0)})),I)},"pointer/set":{MA:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Oo:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Oo:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(k,h,o,x,I)=>(I.forEach((k=>{"FlowGraphJsonPointerParserBlock"===k.className&&(k.config||(k.config={}),k.config.outputValue=!0)})),I)},"pointer/interpolate":{MA:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Oo:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Oo:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Oo:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Oo:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Oo:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Oo:"FlowGraphPlayAnimationBlock"},out:{name:"out",Oo:"FlowGraphPlayAnimationBlock"},done:{name:"done",Oo:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(k,h,o,x,I)=>(I.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className?(h.config||(h.config={}),h.config.outputValue=!0):"FlowGraphInterpolationBlock"===h.className&&(h.config||(h.config={}),Object.keys(k.values||[]).forEach((o=>{var I;const q=null===(I=k.values)||void 0===I?void 0:I[o];if("value"===o&&q){const k=q.type;void 0!==k&&(h.config.animationType=x.arrays.types[k].flowGraphType)}})))})),I)},"animation/start":{MA:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Oo:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(k,h)=>[k[0]*h._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(k,h)=>[k[0]*h._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(k,h,o,x,I,q,Y){const J=I[I.length-1];return J.config||(J.config={}),J.config.glTF=Y,I}},"animation/stop":{MA:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Oo:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(k,h,o,x,I,q,Y){const J=I[I.length-1];return J.config||(J.config={}),J.config.glTF=Y,I}},"animation/stopAt":{MA:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Oo:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(k,h)=>[k[0]*h._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(k,h,o,x,I,q,Y){const J=I[I.length-1];return J.config||(J.config={}),J.config.glTF=Y,I}},"math/switch":{MA:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(k){if(k.configuration&&k.configuration.cases){const h=k.configuration.cases.value;if(!h.every((k=>"number"===typeof k&&/^-?\d+$/.test(k.toString()))))return c.c.Warn("Switch cases should be integers. Using empty array instead."),k.configuration.cases.value=[],{valid:!0};const o=new Set(h);k.configuration.cases.value=Array.from(o)}return{valid:!0}},extraProcessor(k,h,o,x,I){const q=I[0];return q.dataInputs.forEach((k=>{"default"!==k.name&&"case"!==k.name&&(k.name="in_"+k.name)})),q.config||(q.config={}),q.config.treatCasesAsIntegers=!0,I}},"debug/log":{MA:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Uo(k){let h=arguments.length>2?arguments[2]:void 0;return{MA:[k],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((k,h)=>(k[h]={name:h},k)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(k,o,x,I,q){var Y;if(h){(Y=q[0]).config||(Y.config={}),q[0].config.preventIntegerFloatArithmetic=!0;let h=-1;Object.keys(k.values||{}).find((o=>{var x;return void 0!==(null===(x=k.values)||void 0===x?void 0:x[o].type)&&(h=k.values[o].type,!0)})),-1!==h&&(q[0].config.type=I.arrays.types[h].flowGraphType)}return q},validation:k=>h?Qo(k):{valid:!0}}}function Qo(k){if(k.values){const h=Object.keys(k.values).map((h=>k.values[h].type)).filter((k=>void 0!==k));if(!h.every((k=>k===h[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Do["math/compose"]=Do["math/matCompose"],Do["math/decompose"]=Do["math/matDecompose"];var Bo=o(11208);const Eo={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Vh",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class no{constructor(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=k,this._gltf=h,this._animationTargetFps=o,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const k of this._interactivityGraph.types)this._types.push(Eo[k.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const k of this._interactivityGraph.declarations){const h=so(k);if(!h)throw c.c.Error(["No mapping found for declaration",k]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:h,fullOperationName:k.extension?k.op+":"+k.extension:k.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const k of this._interactivityGraph.variables){const h=this._parseVariable(k);this._staticVariables.push(h)}}_parseVariable(k,h){const o=this._types[k.type];if(!o)throw c.c.Error(["No type found for variable",k]),new Error("Error parsing variables");if(k.value&&k.value.length!==o.length)throw c.c.Error(["Invalid value length for variable",k,o]),new Error("Error parsing variables");const x=k.value||[];if(!x.length)switch(o.flowGraphType){case"boolean":x.push(!1);break;case"FlowGraphInteger":x.push(0);break;case"number":x.push(NaN);break;case"Vector2":x.push(NaN,NaN);break;case"Vh":x.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":x.fill(NaN,0,4);break;case"Matrix":x.fill(NaN,0,16);break;case"Matrix3D":x.fill(NaN,0,9)}return"number"===o.elementType&&"string"===typeof x[0]&&(x[0]=parseFloat(x[0])),{type:o.flowGraphType,value:h?h(x,this):x}}_parseEvents(){if(this._interactivityGraph.events)for(const k of this._interactivityGraph.events){const h={eventId:k.id||"internalEvent_"+this._internalEventsCounter++};k.values&&(h.eventData=Object.keys(k.values).map((h=>{var o;const x=null===(o=k.values)||void 0===o?void 0:o[h];if(!x)throw c.c.Error(["No value found for event key",h]),new Error("Error parsing events");const I=this._types[x.type];if(!I)throw c.c.Error(["No type found for event value",x]),new Error("Error parsing events");const q="undefined"!==typeof x.value?this._parseVariable(x):void 0;return{id:h,type:I.flowGraphType,eventData:!0,value:q}}))),this._events.push(h)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const h of this._interactivityGraph.nodes){if("number"!==typeof h.declaration)throw c.c.Error(["No declaration found for node",h]),new Error("Error parsing nodes");const o=this._mappings[h.declaration];if(!o)throw c.c.Error(["No mapping found for node",h]),new Error("Error parsing nodes");if(o.flowGraphMapping.validation){const x=o.flowGraphMapping.validation(h,this._interactivityGraph,this._gltf);var k;if(!x.valid)throw new Error(`Error validating interactivity node ${null===(k=this._interactivityGraph.declarations)||void 0===k?void 0:k[h.declaration].op} - ${x.error}`)}const x=[];for(const k of o.flowGraphMapping.MA){const I=this._getEmptyBlock(k,o.fullOperationName);this._parseNodeConfiguration(h,I,o.flowGraphMapping,k),x.push(I)}this._nodes.push({MA:x,fullOperationName:o.fullOperationName})}}_getEmptyBlock(k,h){return{uniqueId:(0,Bo.b)(),className:k,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:h,metadata:{}}}_parseNodeConfiguration(k,h,o,x){const I=h.config;if(k.configuration){const h=Object.keys(k.configuration);for(const J of h){var q,Y;const h=null===(q=k.configuration)||void 0===q?void 0:q[J];if(!h)throw c.c.Error(["No value found for node configuration",J]),new Error("Error parsing node configuration");const G=null===(Y=o.configuration)||void 0===Y?void 0:Y[J];if(G&&G.Oo?G.Oo===x:0===o.MA.indexOf(x)){const k=(null===G||void 0===G?void 0:G.name)||J;h&&"undefined"!==typeof h.value||"undefined"===typeof(null===G||void 0===G?void 0:G.defaultValue)?h.value.length>=0?I[k]={value:1===h.value.length?h.value[0]:h.value}:c.c.Warn(["Invalid value for node configuration",h]):I[k]={value:G.defaultValue},G&&G.dataTransformer&&(I[k].value=G.dataTransformer([I[k].value],this)[0])}}}}_parseNodeConnections(k){for(let b=0;b<this._nodes.length;b++){var h;const V=null===(h=this._interactivityGraph.nodes)||void 0===h?void 0:h[b];if(!V)throw c.c.Error(["No node found for interactivity node",this._nodes[b]]),new Error("Error parsing node connections");const i=this._nodes[b],F=this._mappings[V.declaration];if(!F)throw c.c.Error(["No mapping found for node",V]),new Error("Error parsing node connections");const R=V.flows||{},s=Object.keys(R).sort();for(const k of s){var o,x,I,q;const h=R[k],l=null===(o=F.flowGraphMapping.outputs)||void 0===o||null===(x=o.flows)||void 0===x?void 0:x[k],A=(null===l||void 0===l?void 0:l.name)||k,K=this._createNewSocketConnection(A,!0);(l&&l.Oo&&i.MA.find((k=>k.className===l.Oo))||i.MA[0]).signalOutputs.push(K);const a=h.node,N=this._nodes[a];if(!N)throw c.c.Error(["No node found for input node id",a]),new Error("Error parsing node connections");const X=Ro(N.fullOperationName);if(!X)throw c.c.Error(["No mapping found for input node",N]),new Error("Error parsing node connections");let W=null===(I=X.inputs)||void 0===I||null===(q=I.flows)||void 0===q?void 0:q[h.socket||"in"],f=!1;if(!W)for(const k in null===(Y=X.inputs)||void 0===Y?void 0:Y.flows){var Y,J,G;if(k.startsWith("[")&&k.endsWith("]"))f=!0,W=null===(J=X.inputs)||void 0===J||null===(G=J.flows)||void 0===G?void 0:G[k]}const M=W?f?W.name.replace("$1",h.socket||""):W.name:h.socket||"in",T=W&&W.Oo&&N.MA.find((k=>k.className===W.Oo))||N.MA[0];let j=T.signalInputs.find((k=>k.name===M));j||(j=this._createNewSocketConnection(M),T.signalInputs.push(j)),j.connectedPointIds.push(K.uniqueId),K.connectedPointIds.push(j.uniqueId)}const Z=V.values||{},w=Object.keys(Z);for(const h of w){var l,A;const o=Z[h];let x=null===(l=F.flowGraphMapping.inputs)||void 0===l||null===(A=l.values)||void 0===A?void 0:A[h],I=!1;if(!x)for(const k in null===(K=F.flowGraphMapping.inputs)||void 0===K?void 0:K.values){var K,a,N;if(k.startsWith("[")&&k.endsWith("]"))I=!0,x=null===(a=F.flowGraphMapping.inputs)||void 0===a||null===(N=a.values)||void 0===N?void 0:N[k]}const q=x?I?x.name.replace("$1",h):x.name:h,Y=this._createNewSocketConnection(q);if((x&&x.Oo&&i.MA.find((k=>k.className===x.Oo))||i.MA[0]).dataInputs.push(Y),void 0!==o.value){const h=this._parseVariable(o,x&&x.dataTransformer);k._connectionValues[Y.uniqueId]=h}else{if("undefined"===typeof o.node)throw c.c.Error(["Invalid value for value connection",o]),new Error("Error parsing node connections");{var X,W,f;const k=o.node,h=o.socket||"value",x=this._nodes[k];if(!x)throw c.c.Error(["No node found for output socket reference",o]),new Error("Error parsing node connections");const I=Ro(x.fullOperationName);if(!I)throw c.c.Error(["No mapping found for output socket reference",o]),new Error("Error parsing node connections");let q=null===(X=I.outputs)||void 0===X||null===(W=X.values)||void 0===W?void 0:W[h],J=!1;if(!q)for(const o in null===(M=I.outputs)||void 0===M?void 0:M.values){var M,T,j;if(o.startsWith("[")&&o.endsWith("]"))J=!0,q=null===(T=I.outputs)||void 0===T||null===(j=T.values)||void 0===j?void 0:j[o]}const G=q?J?q.name.replace("$1",h):null===(f=q)||void 0===f?void 0:f.name:h,l=q&&q.Oo&&x.MA.find((k=>k.className===q.Oo))||x.MA[0];let A=l.dataOutputs.find((k=>k.name===G));A||(A=this._createNewSocketConnection(G,!0),l.dataOutputs.push(A)),Y.connectedPointIds.push(A.uniqueId),A.connectedPointIds.push(Y.uniqueId)}}}if(F.flowGraphMapping.interBlockConnectors)for(const k of F.flowGraphMapping.interBlockConnectors){const h=k.input,o=k.output,x=k.isVariable;this._connectFlowGraphNodes(h,o,i.MA[k.inputBlockIndex],i.MA[k.outputBlockIndex],x)}if(F.flowGraphMapping.extraProcessor){var d;const h=null===(d=this._interactivityGraph.declarations)||void 0===d?void 0:d[V.declaration];if(!h)throw c.c.Error(["No declaration found for extra processor",V]),new Error("Error parsing node connections");i.MA=F.flowGraphMapping.extraProcessor(V,h,F.flowGraphMapping,this,i.MA,k,this._gltf)}}}_createNewSocketConnection(k,h){return{uniqueId:(0,Bo.b)(),name:k,_connectionType:h?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(k,h,o,x,I){const q=I?o.dataInputs:o.signalInputs,Y=I?x.dataOutputs:x.signalOutputs,J=q.find((h=>h.name===k))||this._createNewSocketConnection(k),G=Y.find((k=>k.name===h))||this._createNewSocketConnection(h,!0);q.find((h=>h.name===k))||q.push(J),Y.find((k=>k.name===h))||Y.push(G),J.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(J.uniqueId)}getVariableName(k){return"staticVariable_"+k}serializeToFlowGraph(){const k={uniqueId:(0,Bo.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(k);for(let h=0;h<this._staticVariables.length;h++){const o=this._staticVariables[h];k._userVariables[this.getVariableName(h)]=o}return{rightHanded:!0,allBlocks:this._nodes.reduce(((k,h)=>k.concat(h.MA)),[]),executionContexts:[k]}}}const Ho="KHR_interactivity";class yo{constructor(k){this._loader=k,this.name=Ho,this.enabled=this._loader.isExtensionUsed(Ho),this._pathConverter=(0,y.k)(this._loader.Bh),k._skipStartAnimationStep=!0;const h=k.babylonScene;h&&function(k){(0,y.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!k.activeCamera)return new I.Quaternion(NaN,NaN,NaN,NaN);const h=I.Quaternion.FromRotationMatrix(k.activeCamera.getWorldMatrix()).normalize();return k.useRightHandedSystem||(h.w*=-1,h.x*=-1),h},type:"Quaternion",getTarget:()=>k.activeCamera}),(0,y.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!k.activeCamera)return new I.Vh(NaN,NaN,NaN);const h=k.activeCamera.getWorldMatrix().getTranslation();return k.useRightHandedSystem||(h.x*=-1),h},type:"Vh",getTarget:()=>k.activeCamera}),(0,y.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:k=>{var h;return(null===(h=k._babylonAnimationGroup)||void 0===h?void 0:h.isPlaying)??!1},type:"boolean",getTarget:k=>k._babylonAnimationGroup}),(0,y.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:k=>{var h;return((null===(h=k._babylonAnimationGroup)||void 0===h?void 0:h.from)??0)/60},type:"number",getTarget:k=>k._babylonAnimationGroup}),(0,y.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:k=>{var h;return((null===(h=k._babylonAnimationGroup)||void 0===h?void 0:h.to)??0)/60},type:"number",getTarget:k=>k._babylonAnimationGroup}),(0,y.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:k=>{var h;return((null===(h=k._babylonAnimationGroup)||void 0===h?void 0:h.getCurrentFrame())??0)/60},type:"number",getTarget:k=>k._babylonAnimationGroup}),(0,y.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:k=>{var h;return((null===(h=k._babylonAnimationGroup)||void 0===h?void 0:h.getCurrentFrame())??0)/60},type:"number",getTarget:k=>k._babylonAnimationGroup})}(h)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var k;if(!this._loader.babylonScene||!this._pathConverter)return;const h=this._loader.babylonScene,o=null===(k=this._loader.Bh.extensions)||void 0===k?void 0:k.KHR_interactivity;if(!o)return;const x=new Xo.b({Fh:h});x.dispatchEventsSynchronously=!1;const I=o.graphs.map((k=>new no(k,this._loader.Bh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(I.map((async k=>await Vo(k,{coordinator:x,pathConverter:this._pathConverter})))),x.start()}}var Oo;Oo=async()=>(await Promise.resolve().then(o.bind(o,12990))).FlowGraphGLTFDataProvider,co[`${Ho}/${"FlowGraphGLTFDataProvider"}`]=Oo,H(Ho),n(Ho,!0,(k=>new yo(k)));const zo="KHR_node_visibility";(0,y.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:k=>{const h=k._babylonTransformNode;return!h||void 0===h.isVisible||h.isVisible},set:(k,h)=>{var o,x;null===(o=h._primitiveBabylonMeshes)||void 0===o||o.forEach((k=>{k.inheritVisibility=!0})),h._babylonTransformNode&&(h._babylonTransformNode.isVisible=k),null===(x=h._primitiveBabylonMeshes)||void 0===x||x.forEach((h=>{h.isVisible=k}))},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class po{constructor(k){this.name=zo,this._loader=k,this.enabled=k.isExtensionUsed(zo)}async onReady(){var k;null===(k=this._loader.Bh.nodes)||void 0===k||k.forEach((k=>{var h,o,x,I;(null===(h=k._primitiveBabylonMeshes)||void 0===h||h.forEach((k=>{k.inheritVisibility=!0})),null!==(o=k.extensions)&&void 0!==o&&o.KHR_node_visibility)&&(!1===(null===(x=k.extensions)||void 0===x?void 0:x.KHR_node_visibility.visible)&&(k._babylonTransformNode&&(k._babylonTransformNode.isVisible=!1),null===(I=k._primitiveBabylonMeshes)||void 0===I||I.forEach((k=>{k.isVisible=!1}))))}))}dispose(){this._loader=null}}H(zo),n(zo,!0,(k=>new po(k)));const vo="KHR_node_selectability";Zo("event/onSelect",vo,{MA:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Oo:"FlowGraphGetVariableBlock",dataTransformer:k=>["pickedMesh_"+k[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Oo:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(k,h,o,x,I,q,Y){var J,G,l,A,K,a;const N=I[I.length-1];N.config=N.config||{},N.config.glTF=Y;const X=null===(J=k.configuration)||void 0===J||null===(G=J.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===X||"number"!==typeof X)throw new Error("nodeIndex not found in configuration");const c="pickedMesh_"+X;return I[1].config.variable=c,q._userVariables[c]={className:"Mesh",id:null===Y||void 0===Y||null===(l=Y.nodes)||void 0===l||null===(A=l[X]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===Y||void 0===Y||null===(K=Y.nodes)||void 0===K||null===(a=K[X]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},I}}),(0,y.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:k=>{const h=k._babylonTransformNode;return!h||void 0===h.vG||h.vG},set:(k,h)=>{var o;null===(o=h._primitiveBabylonMeshes)||void 0===o||o.forEach((h=>{h.vG=k}))},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"vG"],type:"boolean"});class mo{constructor(k){this.name=vo,this._loader=k,this.enabled=k.isExtensionUsed(vo)}async onReady(){var k;null===(k=this._loader.Bh.nodes)||void 0===k||k.forEach((k=>{var h,o,x;null!==(h=k.extensions)&&void 0!==h&&h.KHR_node_selectability&&!1===(null===(o=k.extensions)||void 0===o?void 0:o.KHR_node_selectability.selectable)&&(null===(x=k._babylonTransformNode)||void 0===x||x.getChildMeshes().forEach((k=>{k.vG=!1})))}))}dispose(){this._loader=null}}H(vo),n(vo,!0,(k=>new mo(k)));const Lo="KHR_node_hoverability",Po="targetMeshPointerOver_";Zo("event/onHoverIn",Lo,{MA:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Oo:"FlowGraphGetVariableBlock",dataTransformer:k=>[Po+k[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Oo:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(k,h,o,x,I,q,Y){var J,G,l,A,K,a;const N=I[I.length-1];N.config=N.config||{},N.config.glTF=Y;const X=null===(J=k.configuration)||void 0===J||null===(G=J.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===X||"number"!==typeof X)throw new Error("nodeIndex not found in configuration");const c=Po+X;return I[1].config.variable=c,q._userVariables[c]={className:"Mesh",id:null===Y||void 0===Y||null===(l=Y.nodes)||void 0===l||null===(A=l[X]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===Y||void 0===Y||null===(K=Y.nodes)||void 0===K||null===(a=K[X]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},I}});const ro="targetMeshPointerOut_";Zo("event/onHoverOut",Lo,{MA:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Oo:"FlowGraphGetVariableBlock",dataTransformer:k=>[ro+k[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Oo:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(k,h,o,x,I,q,Y){var J,G,l,A,K,a;const N=I[I.length-1];N.config=N.config||{},N.config.glTF=Y;const X=null===(J=k.configuration)||void 0===J||null===(G=J.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===X||"number"!==typeof X)throw new Error("nodeIndex not found in configuration");const c=ro+X;return I[1].config.variable=c,q._userVariables[c]={className:"Mesh",id:null===Y||void 0===Y||null===(l=Y.nodes)||void 0===l||null===(A=l[X]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===Y||void 0===Y||null===(K=Y.nodes)||void 0===K||null===(a=K[X]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},I}}),(0,y.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:k=>{const h=k._babylonTransformNode;return!h||void 0===h.pointerOverDisableMeshTesting||h.pointerOverDisableMeshTesting},set:(k,h)=>{var o;null===(o=h._primitiveBabylonMeshes)||void 0===o||o.forEach((h=>{h.pointerOverDisableMeshTesting=!k}))},getTarget:k=>k._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class to{constructor(k){this.name=Lo,this._loader=k,this.enabled=k.isExtensionUsed(Lo)}async onReady(){var k;null===(k=this._loader.Bh.nodes)||void 0===k||k.forEach((k=>{var h,o,x;null!==(h=k.extensions)&&void 0!==h&&h.KHR_node_hoverability&&!1===(null===(o=k.extensions)||void 0===o?void 0:o.KHR_node_hoverability.hoverable)&&(null===(x=k._babylonTransformNode)||void 0===x||x.getChildMeshes().forEach((k=>{k.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}H(Lo),n(Lo,!0,(k=>new to(k)));const So="ExtrasAsMetadata";class Co{_assignExtras(k,h){if(h.extras&&Object.keys(h.extras).length>0){const o=k.metadata=k.metadata||{};(o.Bh=o.Bh||{}).extras=h.extras}}constructor(k){this.name=So,this.enabled=!0,this._loader=k}dispose(){this._loader=null}loadNodeAsync(k,h,o){return this._loader.loadNodeAsync(k,h,(k=>{this._assignExtras(k,h),o(k)}))}loadCameraAsync(k,h,o){return this._loader.loadCameraAsync(k,h,(k=>{this._assignExtras(k,h),o(k)}))}createMaterial(k,h,o){const x=this._loader.createMaterial(k,h,o);return this._assignExtras(x,h),x}}H(So),n(So,!1,(k=>new Co(k)));o(12990)},12872:(k,h,o)=>{"use strict";o.d(h,{e:()=>U,h:()=>F,i:()=>i,m:()=>R});var x=o(11082),I=o(11078),q=o(12533),Y=o(11696),J=o(11648),G=o(11663),l=o(11098),A=o(11120),K=o(11688),a=o(11799),N=o(11699),X=o(11277);class c{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ka=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Ba=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(k){this._environmentTexture=k}getNodes(){let k=[];k=k.concat(this.meshes),k=k.concat(this.lights),k=k.concat(this.cameras),k=k.concat(this.transformNodes);for(const h of this.skeletons)k=k.concat(h.bones);return k}}class W extends c{}class f{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const k=this.rootNodes;for(const x of k)x.dispose();k.length=0;const h=this.skeletons;for(const x of h)x.dispose();h.length=0;const o=this.animationGroups;for(const x of o)x.dispose();o.length=0}}class M extends c{constructor(k){super(),this._wasAddedToScene=!1,(k=k||A.b.LastCreatedScene)&&(this.Fh=k,this.proceduralTextures=[],k.sh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=k.getEngine().onContextRestoredObservable.add((()=>{for(const k of this.geometries)k._rebuild();for(const k of this.meshes)k._rebuild();for(const k of this.ka)k.rebuild();for(const k of this.textures)k._rebuild()})))}_topologicalSort(k){const h=new Map;for(const Y of k)h.set(Y.uniqueId,Y);const o={dependsOn:new Map,dependedBy:new Map};for(const Y of k){const k=Y.uniqueId;o.dependsOn.set(k,new Set),o.dependedBy.set(k,new Set)}for(const Y of k){const k=Y.uniqueId,x=o.dependsOn.get(k);if(Y instanceof K.c){const I=Y.sourceMesh;h.has(I.uniqueId)&&(x.add(I.uniqueId),o.dependedBy.get(I.uniqueId).add(k))}const I=o.dependedBy.get(k);for(const q of Y.getDescendants()){const x=q.uniqueId;if(h.has(x)){I.add(x);o.dependsOn.get(x).add(k)}}}const x=[],I=[];for(const Y of k){const k=Y.uniqueId;0===o.dependsOn.get(k).size&&(I.push(Y),h.delete(k))}const q=I;for(;q.length>0;){const k=q.shift();x.push(k);const I=o.dependedBy.get(k.uniqueId);for(const x of Array.from(I.values())){const I=o.dependsOn.get(x);I.delete(k.uniqueId),0===I.size&&h.get(x)&&(q.push(h.get(x)),h.delete(x))}}return h.size>0&&(l.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),h.forEach((k=>{l.c.Error(k.name)}))),x}_addNodeAndDescendantsToList(k,h,o,x){if(o&&(!x||x(o))&&!h.has(o.uniqueId)){k.push(o),h.add(o.uniqueId);for(const I of o.getDescendants(!0))this._addNodeAndDescendantsToList(k,h,I,x)}}_isNodeInContainer(k){return k instanceof G.d&&-1!==this.meshes.indexOf(k)||(k instanceof J.e&&-1!==this.transformNodes.indexOf(k)||(k instanceof a.d&&-1!==this.lights.indexOf(k)||k instanceof N.d&&-1!==this.cameras.indexOf(k)))}_isValidHierarchy(){for(const k of this.meshes)if(k.parent&&!this._isNodeInContainer(k.parent))return l.c.Warn(`Node ${k.name} has a parent that is not in the container.`),!1;for(const k of this.transformNodes)if(k.parent&&!this._isNodeInContainer(k.parent))return l.c.Warn(`Node ${k.name} has a parent that is not in the container.`),!1;for(const k of this.lights)if(k.parent&&!this._isNodeInContainer(k.parent))return l.c.Warn(`Node ${k.name} has a parent that is not in the container.`),!1;for(const k of this.cameras)if(k.parent&&!this._isNodeInContainer(k.parent))return l.c.Warn(`Node ${k.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||I.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const x={},q={},J=new f,G=[],l=[],A={doNotInstantiate:!0,...o},K=[],a=new Set;for(const I of this.transformNodes)null===I.parent&&this._addNodeAndDescendantsToList(K,a,I,A.predicate);for(const I of this.meshes)null===I.parent&&this._addNodeAndDescendantsToList(K,a,I,A.predicate);const N=this._topologicalSort(K),X=(o,I)=>{if(((h,o)=>{if(x[h.uniqueId]=o.uniqueId,q[o.uniqueId]=o,k&&(o.name=k(h.name)),o instanceof Y.e){const k=o;if(k.morphTargetManager){const o=h.morphTargetManager;k.morphTargetManager=o.clone();for(let h=0;h<o.numTargets;h++){const I=o.getTarget(h),Y=k.morphTargetManager.getTarget(h);x[I.uniqueId]=Y.uniqueId,q[Y.uniqueId]=Y}}}})(o,I),o.parent){const k=x[o.parent.uniqueId],h=q[k];I.parent=h||o.parent}if(I.position&&o.position&&I.position.Y(o.position),I.rotationQuaternion&&o.rotationQuaternion&&I.rotationQuaternion.Y(o.rotationQuaternion),I.rotation&&o.rotation&&I.rotation.Y(o.rotation),I.iJ&&o.iJ&&I.iJ.Y(o.iJ),I.material){const Y=I;if(Y.material)if(h){const h=o.material;if(-1===l.indexOf(h)){let o=h.clone(k?k(h.name):"Clone of "+h.name);if(l.push(h),x[h.uniqueId]=o.uniqueId,q[o.uniqueId]=o,"MultiMaterial"===h.getClassName()){const I=h;for(const h of I.sJ)h&&(o=h.clone(k?k(h.name):"Clone of "+h.name),l.push(h),x[h.uniqueId]=o.uniqueId,q[o.uniqueId]=o);I.sJ=I.sJ.map((k=>k&&q[x[k.uniqueId]]))}}"InstancedMesh"!==Y.getClassName()&&(Y.material=q[x[h.uniqueId]])}else"MultiMaterial"===Y.material.getClassName()?-1===this.Fh.multiMaterials.indexOf(Y.material)&&this.Fh.addMultiMaterial(Y.material):-1===this.Fh.materials.indexOf(Y.material)&&this.Fh.addMaterial(Y.material)}null===I.parent&&J.rootNodes.push(I)};for(const I of N)if("InstancedMesh"===I.getClassName()){const k=I,h=k.sourceMesh,o=x[h.uniqueId];X(k,("number"===typeof o?q[o]:h).createInstance(k.name))}else{let k=!0;"dX"===I.getClassName()||"Node"===I.getClassName()||I.skeleton||!I.getTotalVertices||0===I.getTotalVertices()?k=!1:A.doNotInstantiate&&(k="function"===typeof A.doNotInstantiate?!A.doNotInstantiate(I):!A.doNotInstantiate);const h=k?I.createInstance(`instance of ${I.name}`):I.clone(`Clone of ${I.name}`,null,!0);if(!h)throw new Error(`Could not clone or instantiate node on Asset Container ${I.name}`);X(I,h)}for(const I of this.skeletons){if(A.predicate&&!A.predicate(I))continue;const h=I.clone(k?k(I.name):"Clone of "+I.name);for(const k of this.meshes)if(k.skeleton===I&&!k.isAnInstance){const o=q[x[k.uniqueId]];if(!o||o.isAnInstance)continue;if(o.skeleton=h,-1!==G.indexOf(h))continue;G.push(h);for(const k of h.bones)k._linkedTransformNode&&(k._linkedTransformNode=q[x[k._linkedTransformNode.uniqueId]])}J.skeletons.push(h)}for(const I of this.animationGroups){if(A.predicate&&!A.predicate(I))continue;const h=I.clone(k?k(I.name):"Clone of "+I.name,(k=>q[x[k.uniqueId]]||k));J.animationGroups.push(h)}return J}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||I.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Fh.environmentTexture=this.environmentTexture);for(const k of this.Fh._serializableComponents)k.addFromContainer(this);this.Fh.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const h=[];for(const o of this.cameras)k&&!k(o)||(this.Fh.addCamera(o),h.push(o));for(const o of this.lights)k&&!k(o)||(this.Fh.addLight(o),h.push(o));for(const o of this.meshes)k&&!k(o)||(this.Fh.YA(o),h.push(o));for(const o of this.skeletons)k&&!k(o)||this.Fh.addSkeleton(o);for(const o of this.animations)k&&!k(o)||this.Fh.addAnimation(o);for(const o of this.animationGroups)k&&!k(o)||this.Fh.addAnimationGroup(o);for(const o of this.multiMaterials)k&&!k(o)||this.Fh.addMultiMaterial(o);for(const o of this.materials)k&&!k(o)||this.Fh.addMaterial(o);for(const o of this.morphTargetManagers)k&&!k(o)||this.Fh.addMorphTargetManager(o);for(const o of this.geometries)k&&!k(o)||this.Fh.addGeometry(o);for(const o of this.transformNodes)k&&!k(o)||(this.Fh.addTransformNode(o),h.push(o));for(const o of this.actionManagers)k&&!k(o)||this.Fh.addActionManager(o);for(const o of this.textures)k&&!k(o)||this.Fh.addTexture(o);for(const o of this.reflectionProbes)k&&!k(o)||this.Fh.addReflectionProbe(o);for(const o of h)o.parent&&-1===this.Fh.getNodes().indexOf(o.parent)&&(o.setParent?o.setParent(null):o.parent=null)}removeAllFromScene(){this._isValidHierarchy()||I.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Fh.environmentTexture&&(this.Fh.environmentTexture=null);for(const k of this.Fh._serializableComponents)k.removeFromContainer(this)}removeFromScene(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const h of this.cameras)k&&!k(h)||this.Fh.removeCamera(h);for(const h of this.lights)k&&!k(h)||this.Fh.removeLight(h);for(const h of this.meshes)k&&!k(h)||this.Fh.qA(h,!0);for(const h of this.skeletons)k&&!k(h)||this.Fh.removeSkeleton(h);for(const h of this.animations)k&&!k(h)||this.Fh.removeAnimation(h);for(const h of this.animationGroups)k&&!k(h)||this.Fh.removeAnimationGroup(h);for(const h of this.multiMaterials)k&&!k(h)||this.Fh.removeMultiMaterial(h);for(const h of this.materials)k&&!k(h)||this.Fh.removeMaterial(h);for(const h of this.morphTargetManagers)k&&!k(h)||this.Fh.removeMorphTargetManager(h);for(const h of this.geometries)k&&!k(h)||this.Fh.removeGeometry(h);for(const h of this.transformNodes)k&&!k(h)||this.Fh.removeTransformNode(h);for(const h of this.actionManagers)k&&!k(h)||this.Fh.removeActionManager(h);for(const h of this.textures)k&&!k(h)||this.Fh.removeTexture(h);for(const h of this.reflectionProbes)k&&!k(h)||this.Fh.removeReflectionProbe(h)}dispose(){const k=this.cameras.slice(0);for(const N of k)N.dispose();this.cameras.length=0;const h=this.lights.slice(0);for(const N of h)N.dispose();this.lights.length=0;const o=this.meshes.slice(0);for(const N of o)N.dispose();this.meshes.length=0;const x=this.skeletons.slice(0);for(const N of x)N.dispose();this.skeletons.length=0;const I=this.animationGroups.slice(0);for(const N of I)N.dispose();this.animationGroups.length=0;const q=this.multiMaterials.slice(0);for(const N of q)N.dispose();this.multiMaterials.length=0;const Y=this.materials.slice(0);for(const N of Y)N.dispose();this.materials.length=0;const J=this.geometries.slice(0);for(const N of J)N.dispose();this.geometries.length=0;const G=this.transformNodes.slice(0);for(const N of G)N.dispose();this.transformNodes.length=0;const l=this.actionManagers.slice(0);for(const N of l)N.dispose();this.actionManagers.length=0;const A=this.textures.slice(0);for(const N of A)N.dispose();this.textures.length=0;const K=this.reflectionProbes.slice(0);for(const N of K)N.dispose();this.reflectionProbes.length=0;const a=this.morphTargetManagers.slice(0);for(const N of a)N.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const N of this.Fh._serializableComponents)N.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Fh.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(k,h,o){if(k&&h)for(const x of k){let k=!0;if(o)for(const h of o)if(x===h){k=!1;break}k&&(h.push(x),x._parentContainer=this)}}moveAllFromScene(k){this._wasAddedToScene=!1,void 0===k&&(k=new W);for(const h in this)Object.prototype.hasOwnProperty.call(this,h)&&(this[h]=this[h]||("_environmentTexture"===h?null:[]),this._moveAssets(this.Fh[h],this[h],k[h]));this.environmentTexture=this.Fh.environmentTexture,this.removeAllFromScene()}createRootMesh(){const k=new Y.e("assetContainerRootMesh",this.Fh);for(const h of this.meshes)h.parent||k.addChild(h);return this.meshes.unshift(k),k}mergeAnimationsTo(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.b.LastCreatedScene,h=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!k)return l.c.Error("No scene available to merge animations to"),[];const x=o||(h=>{let o=null;const x=h.animations.length?h.animations[0].targetProperty:"",I=h.name.split(".").join("").split("_primitive")[0];switch(x){case"position":case"rotationQuaternion":o=k.getTransformNodeByName(h.name)||k.getTransformNodeByName(I);break;case"influence":o=k.getMorphTargetByName(h.name)||k.getMorphTargetByName(I);break;default:o=k.getNodeByName(h.name)||k.getNodeByName(I)}return o}),I=this.getNodes();for(const J of I){const k=x(J);if(null!==k){for(const h of J.animations){const o=k.animations.filter((k=>k.targetProperty===h.targetProperty));for(const h of o){const o=k.animations.indexOf(h,0);o>-1&&k.animations.splice(o,1)}}k.animations=k.animations.concat(J.animations)}}const q=[],Y=this.animationGroups.slice();for(const J of Y){q.push(J.clone(J.name,x));for(const k of J.animatables)k.stop()}for(const J of h){const h=x(J.target);h&&(k.beginAnimation(h,J.fromFrame,J.toFrame,J.loopAnimation,J.speedRatio,J.onAnimationEnd?J.onAnimationEnd:void 0,void 0,!0,void 0,J.onAnimationLoop?J.onAnimationLoop:void 0),k.stopAnimation(J.target))}return q}populateRootNodes(){this.rootNodes.length=0;for(const k of this.meshes)k.parent||-1!==this.rootNodes.indexOf(k)||this.rootNodes.push(k);for(const k of this.transformNodes)k.parent||-1!==this.rootNodes.indexOf(k)||this.rootNodes.push(k);for(const k of this.lights)k.parent||-1!==this.rootNodes.indexOf(k)||this.rootNodes.push(k);for(const k of this.cameras)k.parent||-1!==this.rootNodes.indexOf(k)||this.rootNodes.push(k)}addAllAssetsToContainer(k){if(!k)return;const h=[],o=new Set;for(h.push(k);h.length>0;){const k=h.pop();if(k instanceof Y.e?(k.jJ&&-1===this.geometries.indexOf(k.jJ)&&this.geometries.push(k.jJ),this.meshes.push(k)):k instanceof K.c?this.meshes.push(k):k instanceof J.e?this.transformNodes.push(k):k instanceof a.d?this.lights.push(k):k instanceof N.d&&this.cameras.push(k),k instanceof G.d){if(k.material&&-1===this.materials.indexOf(k.material)){this.materials.push(k.material);for(const h of k.material.getActiveTextures())-1===this.textures.indexOf(h)&&this.textures.push(h)}k.skeleton&&-1===this.skeletons.indexOf(k.skeleton)&&this.skeletons.push(k.skeleton),k.morphTargetManager&&-1===this.morphTargetManagers.indexOf(k.morphTargetManager)&&this.morphTargetManagers.push(k.morphTargetManager)}for(const x of k.getChildren())o.has(x)||h.push(x);o.add(k)}this.populateRootNodes()}_getByTags(k,h,o){if(void 0===h)return k;const x=[];for(const I in k){const q=k[I];X.d&&X.d.MatchesQuery(q,h)&&(!o||o(q))&&x.push(q)}return x}getMeshesByTags(k,h){return this._getByTags(this.meshes,k,h)}getCamerasByTags(k,h){return this._getByTags(this.cameras,k,h)}getLightsByTags(k,h){return this._getByTags(this.lights,k,h)}getMaterialsByTags(k,h){return this._getByTags(this.materials,k,h).concat(this._getByTags(this.multiMaterials,k,h))}getTransformNodesByTags(k,h){return this._getByTags(this.transformNodes,k,h)}}var T=o(11134);class j{constructor(k){this.byteOffset=0,this.buffer=k}async loadAsync(k){const h=await this.buffer.readAsync(this.byteOffset,k);this._dataView=new DataView(h.buffer,h.byteOffset,h.byteLength),this._dataByteOffset=0}readUint32(){const k=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,k}readUint8Array(k){const h=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,k);return this._dataByteOffset+=k,this.byteOffset+=k,h}readString(k){return(0,T.j)(this.readUint8Array(k))}skipBytes(k){this._dataByteOffset+=k,this.byteOffset+=k}}var d=o(12879);const b="Z2xURg",V={name:"Bh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:k=>-1!==k.indexOf("asset")&&-1!==k.indexOf("version")||k.startsWith("data:base64,"+b)||k.startsWith("data:;base64,"+b)||k.startsWith("data:application/octet-stream;base64,"+b)||k.startsWith("data:model/gltf-binary;base64,"+b)};var i,F,R,s=o(11127),Z=o(11129);function w(k,h,o){try{return Promise.resolve(new Uint8Array(k,h,o))}catch(x){return Promise.reject(x)}}!function(k){k[k.AUTO=0]="AUTO",k[k.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(i||(i={})),function(k){k[k.NONE=0]="NONE",k[k.FIRST=1]="FIRST",k[k.ALL=2]="ALL"}(F||(F={})),function(k){k[k.LOADING=0]="LOADING",k[k.READY=1]="READY",k[k.COMPLETE=2]="COMPLETE"}(R||(R={}));class D{constructor(){this.coordinateSystemMode=i.AUTO,this.animationStartMode=F.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=k=>Promise.resolve(k),this.extensionOptions={}}Y(k){k&&(this.onParsed=k.onParsed,this.coordinateSystemMode=k.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=k.animationStartMode??this.animationStartMode,this.loadNodeAnimations=k.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=k.loadSkins??this.loadSkins,this.loadMorphTargets=k.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=k.compileMaterials??this.compileMaterials,this.useClipPlane=k.useClipPlane??this.useClipPlane,this.compileShadowGenerators=k.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=k.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=k.useRangeRequests??this.useRangeRequests,this.createInstances=k.createInstances??this.createInstances,this.alwaysComputeBoundingBox=k.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=k.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=k.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=k.skipMaterials??this.skipMaterials,this.useSRGBBuffers=k.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=k.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=k.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=k.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=k.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=k.customRootNode,this.onMeshLoaded=k.onMeshLoaded,this.onSkinLoaded=k.onSkinLoaded,this.onTextureLoaded=k.onTextureLoaded,this.onMaterialLoaded=k.onMaterialLoaded,this.onCameraLoaded=k.onCameraLoaded,this.extensionOptions=k.extensionOptions??this.extensionOptions)}}class U extends D{constructor(k){super(),this.onParsedObservable=new x.d,this.onMeshLoadedObservable=new x.d,this.onSkinLoadedObservable=new x.d,this.onTextureLoadedObservable=new x.d,this.onMaterialLoadedObservable=new x.d,this.onCameraLoadedObservable=new x.d,this.onCompleteObservable=new x.d,this.onErrorObservable=new x.d,this.sh=new x.d,this.onExtensionLoadedObservable=new x.d,this.validate=!1,this.onValidatedObservable=new x.d,this._loader=null,this._state=null,this._requests=new Array,this.name=V.name,this.extensions=V.extensions,this.onLoaderStateChangedObservable=new x.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.Y(k)}set onParsed(k){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),k&&(this._onParsedObserver=this.onParsedObservable.add(k))}set onMeshLoaded(k){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),k&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(k))}set onSkinLoaded(k){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),k&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((h=>k(h.node,h.skinnedNode))))}set onTextureLoaded(k){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),k&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(k))}set onMaterialLoaded(k){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),k&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(k))}set onCameraLoaded(k){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),k&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(k))}set onComplete(k){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(k)}set onError(k){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(k)}set onDispose(k){this._onDisposeObserver&&this.sh.remove(this._onDisposeObserver),this._onDisposeObserver=this.sh.add(k)}set onExtensionLoaded(k){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(k)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(k){this._loggingEnabled!==k&&(this._loggingEnabled=k,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(k){this._capturePerformanceCounters!==k&&(this._capturePerformanceCounters=k,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(k){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(k)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const k of this._requests)k.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=k=>Promise.resolve(k),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.sh.notifyObservers(void 0),this.sh.clear()}loadFile(k,h,o,q,Y,J,G,A){if(ArrayBuffer.isView(h))return this._loadBinary(k,h,o,q,G,A),null;this._progressCallback=Y;const K=h.name||I.Tools.GetFilename(h);if(J){if(this.useRangeRequests){this.validate&&l.c.Warn("glTF validation is not supported when range requests are enabled");const o={abort:()=>{},onCompleteObservable:new x.d},I={readAsync:(o,x)=>new Promise(((I,q)=>{this._loadFile(k,h,(k=>{I(new Uint8Array(k))}),!0,(k=>{q(k)}),(k=>{k.setRequestHeader("Range",`bytes=${o}-${o+x-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new j(I)).then((k=>{o.onCompleteObservable.notifyObservers(o),q(k)}),G?k=>G(void 0,k):void 0),o}return this._loadFile(k,h,(h=>{this._validate(k,new Uint8Array(h,0,h.byteLength),o,K),this._unpackBinaryAsync(new j({readAsync:(k,o)=>w(h,k,o),byteLength:h.byteLength})).then((k=>{q(k)}),G?k=>G(void 0,k):void 0)}),!0,G)}return this._loadFile(k,h,(h=>{try{this._validate(k,h,o,K),q({json:this._parseJson(h)})}catch{G&&G()}}),!1,G)}_loadBinary(k,h,o,x,I,q){this._validate(k,new Uint8Array(h.buffer,h.byteOffset,h.byteLength),o,q),this._unpackBinaryAsync(new j({readAsync:(k,o)=>function(k,h,o){try{if(h<0||h>=k.byteLength)throw new RangeError("Offset is out of range.");if(h+o>k.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(k.buffer,k.byteOffset+h,o))}catch(x){return Promise.reject(x)}}(h,k,o),byteLength:h.byteLength})).then((k=>{x(k)}),I?k=>I(void 0,k):void 0)}importMeshAsync(k,h,o,x,I,q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(o),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(o),this._loader.importMeshAsync(k,h,null,o,x,I,q))))}loadAsync(k,h,o,x,I){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${I||""}`),this._loader=this._getLoader(h),this._loader.loadAsync(k,h,o,x,I))))}loadAssetContainerAsync(k,h,o,x,I){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${I||""}`),this._loader=this._getLoader(h);const q=new M(k),Y=[];this.onMaterialLoadedObservable.add((k=>{Y.push(k)}));const J=[];this.onTextureLoadedObservable.add((k=>{J.push(k)}));const G=[];this.onCameraLoadedObservable.add((k=>{G.push(k)}));const l=[];return this.onMeshLoadedObservable.add((k=>{k.morphTargetManager&&l.push(k.morphTargetManager)})),this._loader.importMeshAsync(null,k,q,h,o,x,I).then((k=>(Array.prototype.push.apply(q.geometries,k.geometries),Array.prototype.push.apply(q.meshes,k.meshes),Array.prototype.push.apply(q.ka,k.ka),Array.prototype.push.apply(q.skeletons,k.skeletons),Array.prototype.push.apply(q.animationGroups,k.animationGroups),Array.prototype.push.apply(q.materials,Y),Array.prototype.push.apply(q.textures,J),Array.prototype.push.apply(q.lights,k.lights),Array.prototype.push.apply(q.transformNodes,k.transformNodes),Array.prototype.push.apply(q.cameras,G),Array.prototype.push.apply(q.morphTargetManagers,l),q)))}))}canDirectLoad(k){return V.canDirectLoad(k)}directLoad(k,h){if(h.startsWith("base64,"+b)||h.startsWith(";base64,"+b)||h.startsWith("application/octet-stream;base64,"+b)||h.startsWith("model/gltf-binary;base64,"+b)){const o=(0,s.c)(h);return this._validate(k,new Uint8Array(o,0,o.byteLength)),this._unpackBinaryAsync(new j({readAsync:(k,h)=>w(o,k,h),byteLength:o.byteLength}))}return this._validate(k,h),Promise.resolve({json:this._parseJson(h)})}createPlugin(k){return new U(k[V.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((k,h)=>{this.onCompleteObservable.addOnce((()=>{k()})),this.onErrorObservable.addOnce((k=>{h(k)}))}))}_setState(k){this._state!==k&&(this._state=k,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(R[this._state]))}_loadFile(k,h,o,x,I,q){const Y=k._loadFile(h,o,(k=>{this._onProgress(k,Y)}),!0,x,I,q);return Y.onCompleteObservable.add((()=>{Y._lengthComputable=!0,Y._total=Y._loaded})),this._requests.push(Y),Y}_onProgress(k,h){if(!this._progressCallback)return;h._lengthComputable=k.lengthComputable,h._loaded=k.loaded,h._total=k.total;let o=!0,x=0,I=0;for(const q of this._requests){if(void 0===q._lengthComputable||void 0===q._loaded||void 0===q._total)return;o=o&&q._lengthComputable,x+=q._loaded,I+=q._total}this._progressCallback({lengthComputable:o,loaded:x,total:o?I:0})}_validate(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),d.d.ValidateAsync(h,o,x,(h=>this.preprocessUrlAsync(o+h).then((h=>k._loadFileAsync(h,void 0,!0,!0).then((k=>new Uint8Array(k,0,k.byteLength))))))).then((k=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(k),this.onValidatedObservable.clear()}),(k=>{this._endPerformanceCounter("Validate JSON"),I.Tools.Warn(`Failed to validate: ${k.message}`),this.onValidatedObservable.clear()})))}_getLoader(k){const h=k.json.asset||{};this._log(`Asset version: ${h.version}`),h.minVersion&&this._log(`Asset minimum version: ${h.minVersion}`),h.generator&&this._log(`Asset generator: ${h.generator}`);const o=U._parseVersion(h.version);if(!o)throw new Error("Invalid version: "+h.version);if(void 0!==h.minVersion){const k=U._parseVersion(h.minVersion);if(!k)throw new Error("Invalid minimum version: "+h.minVersion);if(U._compareVersion(k,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+h.minVersion)}const x={1:U._CreateGLTF1Loader,2:U._CreateGLTF2Loader}[o.major];if(!x)throw new Error("Unsupported version: "+h.version);return x(this)}_parseJson(k){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${k.length}`);const h=JSON.parse(k);return this._endPerformanceCounter("Parse JSON"),h}_unpackBinaryAsync(k){return this._startPerformanceCounter("Unpack Binary"),k.loadAsync(20).then((()=>{const h=k.readUint32();if(1179937895!==h)throw new Z.h("Unexpected magic: "+h,Z.g.GLTFLoaderUnexpectedMagicError);const o=k.readUint32();this.loggingEnabled&&this._log(`Binary version: ${o}`);const x=k.readUint32();let I;switch(this.useRangeRequests||x===k.buffer.byteLength||l.c.Warn(`Length in header does not match actual data length: ${x} != ${k.buffer.byteLength}`),o){case 1:I=this._unpackBinaryV1Async(k,x);break;case 2:I=this._unpackBinaryV2Async(k,x);break;default:throw new Error("Unsupported version: "+o)}return this._endPerformanceCounter("Unpack Binary"),I}))}_unpackBinaryV1Async(k,h){const o=k.readUint32(),x=k.readUint32();if(0!==x)throw new Error(`Unexpected content format: ${x}`);const I=h-k.byteOffset,q={json:this._parseJson(k.readString(o)),bin:null};if(0!==I){const h=k.byteOffset;q.bin={readAsync:(o,x)=>k.buffer.readAsync(h+o,x),byteLength:I}}return Promise.resolve(q)}_unpackBinaryV2Async(k,h){const o=1313821514,x=5130562,I=k.readUint32();if(k.readUint32()!==o)throw new Error("First chunk format is not JSON");return k.byteOffset+I===h?k.loadAsync(I).then((()=>({json:this._parseJson(k.readString(I)),bin:null}))):k.loadAsync(I+8).then((()=>{const q={json:this._parseJson(k.readString(I)),bin:null},Y=()=>{const I=k.readUint32();switch(k.readUint32()){case o:throw new Error("Unexpected JSON chunk");case x:{const h=k.byteOffset;q.bin={readAsync:(o,x)=>k.buffer.readAsync(h+o,x),byteLength:I},k.skipBytes(I);break}default:k.skipBytes(I)}return k.byteOffset!==h?k.loadAsync(8).then(Y):Promise.resolve(q)};return Y()}))}static _parseVersion(k){if("1.0"===k||"1.0.1"===k)return{major:1,minor:0};const h=(k+"").match(/^(\d+)\.(\d+)/);return h?{major:parseInt(h[1]),minor:parseInt(h[2])}:null}static _compareVersion(k,h){return k.major>h.major?1:k.major<h.major?-1:k.minor>h.minor?1:k.minor<h.minor?-1:0}_logOpen(k){this._log(k),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(k){const h=U._logSpaces.substring(0,2*this._logIndentLevel);l.c.Log(`${h}${k}`)}_logDisabled(k){}_startPerformanceCounterEnabled(k){I.Tools.StartPerformanceCounter(k)}_startPerformanceCounterDisabled(k){}_endPerformanceCounterEnabled(k){I.Tools.EndPerformanceCounter(k)}_endPerformanceCounterDisabled(k){}}U.IncrementalLoading=!0,U.HomogeneousCoordinates=!1,U._logSpaces="                                ",(0,q.c)(new U)},12879:(k,h,o)=>{"use strict";o.d(h,{d:()=>Y});var x=o(11078);function I(k,h,o,x){const I={externalResourceFunction:x};return o&&(I.uri="file:"===h?o:h+o),ArrayBuffer.isView(k)?GLTFValidator.validateBytes(k,I):GLTFValidator.validateString(k,I)}function q(){const k=[];onmessage=h=>{const o=h.data;switch(o.id){case"init":importScripts(o.url);break;case"validate":I(o.data,o.rootUrl,o.fileName,(h=>new Promise(((o,x)=>{const I=k.length;k.push({resolve:o,reject:x}),postMessage({id:"getExternalResource",index:I,uri:h})})))).then((k=>{postMessage({id:"validate.resolve",value:k})}),(k=>{postMessage({id:"validate.reject",reason:k})}));break;case"getExternalResource.resolve":k[o.index].resolve(o.value);break;case"getExternalResource.reject":k[o.index].reject(o.reason)}}}class Y{static ValidateAsync(k,h,o,Y){return"function"===typeof Worker?new Promise(((J,G)=>{const l=`${I}(${q})()`,A=URL.createObjectURL(new Blob([l],{type:"application/javascript"})),K=new Worker(A),a=k=>{K.removeEventListener("error",a),K.removeEventListener("message",N),G(k)},N=k=>{const h=k.data;switch(h.id){case"getExternalResource":Y(h.uri).then((k=>{K.postMessage({id:"getExternalResource.resolve",index:h.index,value:k},[k.buffer])}),(k=>{K.postMessage({id:"getExternalResource.reject",index:h.index,reason:k})}));break;case"validate.resolve":K.removeEventListener("error",a),K.removeEventListener("message",N),J(h.value),K.terminate();break;case"validate.reject":K.removeEventListener("error",a),K.removeEventListener("message",N),G(h.reason),K.terminate()}};if(K.addEventListener("error",a),K.addEventListener("message",N),K.postMessage({id:"init",url:x.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(k)){const x=k.slice();K.postMessage({id:"validate",data:x,rootUrl:h,fileName:o},[x.buffer])}else K.postMessage({id:"validate",data:k,rootUrl:h,fileName:o})})):(this._LoadScriptPromise||(this._LoadScriptPromise=x.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>I(k,h,o,Y))))}}Y.Configuration={url:`${x.Tools._DefaultCdnUrl}/gltf_validator.js`}},13411:(k,h,o)=>{"use strict";o.d(h,{e:()=>V});var x=o(11227),I=o(11233),q=o(11271),Y=o(11239),J=o(11617),G=o(11544),l=o(11308),A=o(11472),K=o(11199),a=o(11160);o(12660),o(12571),o(12583),o(12575),o(12587),o(12591),o(12598);const N="imageProcessingCompatibility",X="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";a.b.IncludesShadersStore[N]||(a.b.IncludesShadersStore[N]=X);const c="skyPixelShader",W="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";a.b.ShadersStore[c]||(a.b.ShadersStore[c]=W);o(12676),o(12602),o(12611),o(12619),o(12614);const f="skyVertexShader",M="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";a.b.ShadersStore[f]||(a.b.ShadersStore[f]=M);var T=o(11537),j=o(11602),d=o(11593);class b extends J.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class V extends G.d{constructor(k,h){super(k,h),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Y.Vh(0,100,0),this.useSunPosition=!1,this.cameraOffset=Y.Vh.Zero(),this.up=Y.Vh.Up(),this.dithering=!1,this._cameraPosition=Y.Vh.Zero(),this._skyOrientation=new Y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(k,h){const o=h._drawWrapper;if(this.isFrozen&&o.effect&&o._wasPreviouslyReady)return!0;h.materialDefines||(h.materialDefines=new b);const x=h.materialDefines,I=this.ik();if(this._isReadyForSubMesh(h))return!0;if((0,d.P)(k,I,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,x),(0,d.H)(k,x,!0,!1),x.IMAGEPROCESSINGPOSTPROCESS!==I.imageProcessingConfiguration.applyByPostProcess&&x.markAsMiscDirty(),x.DITHER!==this.dithering&&x.markAsMiscDirty(),x.isDirty){x.markAsProcessed(),I.resetCachedMaterial();const k=new T.b;x.FOG&&k.addFallback(1,"FOG"),x.IMAGEPROCESSINGPOSTPROCESS=I.imageProcessingConfiguration.applyByPostProcess,x.DITHER=this.dithering;const o=[l.g.PositionKind];x.VERTEXCOLOR&&o.push(l.g.ColorKind);const q="sky",Y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,j.c)(Y);const J=x.toString();h.setEffect(I.getEngine().createEffect(q,o,Y,[],J,k,this.onCompiled,this.onError),x,this._materialContext)}return!(!h.effect||!h.effect.isReady())&&(x._renderId=I.getRenderId(),o._wasPreviouslyReady=!0,!0)}bindForSubMesh(k,h,o){const x=this.ik(),I=o.materialDefines;if(!I)return;const q=o.effect;if(!q)return;this._activeEffect=q,this.bindOnlyWorldMatrix(k),this._activeEffect.setMatrix("viewProjection",x.getTransformMatrix()),this._mustRebind(x,q,o)&&((0,j.g)(q,this,x),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,d.j)(I,q,x)),x.fogEnabled&&h.applyFog&&x.fogMode!==A.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",x.getViewMatrix()),(0,d.f)(x,h,this._activeEffect);const J=x.activeCamera;if(J){const k=J.getWorldMatrix();this._cameraPosition.x=k.m[12],this._cameraPosition.y=k.m[13],this._cameraPosition.z=k.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const k=Math.PI*(this.inclination-.5),h=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(h)*Math.cos(k),this.sunPosition.y=this.distance*Math.sin(-k),this.sunPosition.z=this.distance*Math.sin(h)*Math.cos(k),Y.Quaternion.FromUnitVectorsToRef(Y.Vh.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(h,this._activeEffect,o)}getAnimatables(){return[]}dispose(k){super.dispose(k)}clone(k){return q.c.Clone((()=>new V(k,this.ik())),this)}serialize(){const k=super.serialize();return k.customType="BABYLON.SkyMaterial",k}getClassName(){return"SkyMaterial"}static Parse(k,h,o){return q.c.Parse((()=>new V(k.name,h)),k,h,o)}}(0,x.d)([(0,I.E)()],V.prototype,"luminance",void 0),(0,x.d)([(0,I.E)()],V.prototype,"turbidity",void 0),(0,x.d)([(0,I.E)()],V.prototype,"rayleigh",void 0),(0,x.d)([(0,I.E)()],V.prototype,"mieCoefficient",void 0),(0,x.d)([(0,I.E)()],V.prototype,"mieDirectionalG",void 0),(0,x.d)([(0,I.E)()],V.prototype,"distance",void 0),(0,x.d)([(0,I.E)()],V.prototype,"inclination",void 0),(0,x.d)([(0,I.E)()],V.prototype,"azimuth",void 0),(0,x.d)([(0,I.D)()],V.prototype,"sunPosition",void 0),(0,x.d)([(0,I.E)()],V.prototype,"useSunPosition",void 0),(0,x.d)([(0,I.D)()],V.prototype,"cameraOffset",void 0),(0,x.d)([(0,I.D)()],V.prototype,"up",void 0),(0,x.d)([(0,I.E)()],V.prototype,"dithering",void 0),(0,K.g)("BABYLON.SkyMaterial",V)},11941:(k,h,o)=>{"use strict";function x(k,h){h.headers=k.headers||{},h.statusMessage=k.statusText,h.statusCode=k.status,h.data=k.response}function I(k,h,o){return new Promise((function(I,q){o=o||{};var Y,J,G,l=new XMLHttpRequest,A=o.body,K=o.headers||{};for(Y in o.timeout&&(l.timeout=o.timeout),l.ontimeout=l.onerror=function(k){k.timeout="timeout"==k.type,q(k)},l.open(k,h.href||h),l.onload=function(){for(G=l.getAllResponseHeaders().trim().split(/[\r\n]+/),x(l,l);J=G.shift();)J=J.split(": "),l.headers[J.shift().toLowerCase()]=J.join(": ");if((J=l.headers["content-type"])&&~J.indexOf("application/json"))try{l.data=JSON.parse(l.data,o.reviver)}catch(k){return x(l,k),q(k)}(l.status>=400?q:I)(l)},typeof FormData<"u"&&A instanceof FormData||A&&"object"==typeof A&&(K["content-type"]="application/json",A=JSON.stringify(A)),l.withCredentials=!!o.withCredentials,K)l.setRequestHeader(Y,K[Y]);l.send(A)}))}o.r(h),o.d(h,{del:()=>G,get:()=>q,patch:()=>J,post:()=>Y,put:()=>l,send:()=>I});var q=I.bind(I,"GET"),Y=I.bind(I,"POST"),J=I.bind(I,"PATCH"),G=I.bind(I,"DELETE"),l=I.bind(I,"PUT")},13509:(k,h,o)=>{"use strict";o.d(h,{d:()=>K});const x=.5*(Math.sqrt(3)-1),I=(3-Math.sqrt(3))/6,q=1/3,Y=1/6,J=(Math.sqrt(5)-1)/4,G=(5-Math.sqrt(5))/20,l=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),A=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const K=class{constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const h="function"==typeof k?k:function(k){let h=0,o=0,x=0,I=1;const q=function(){let k=4022871197;return function(h){h=h.toString();for(let o=0;o<h.length;o++){k+=h.charCodeAt(o);let x=.02519603282416938*k;k=x>>>0,x-=k,x*=k,k=x>>>0,x-=k,k+=4294967296*x}return 2.3283064365386963e-10*(k>>>0)}}();h=q(" "),o=q(" "),x=q(" "),h-=q(k),h<0&&(h+=1);o-=q(k),o<0&&(o+=1);x-=q(k),x<0&&(x+=1);return function(){const k=2091639*h+2.3283064365386963e-10*I;return h=o,o=x,x=k-(I=0|k)}}(k);this.p=function(k){const h=new Uint8Array(256);for(let o=0;o<256;o++)h[o]=o;for(let o=0;o<255;o++){const x=o+~~(k()*(256-o)),I=h[o];h[o]=h[x],h[x]=I}return h}(h),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let o=0;o<512;o++)this.perm[o]=this.p[255&o],this.permMod12[o]=this.perm[o]%12}noise2D(k,h){const o=this.permMod12,q=this.perm;let Y=0,J=0,G=0;const A=(k+h)*x,K=Math.floor(k+A),a=Math.floor(h+A),N=(K+a)*I,X=k-(K-N),c=h-(a-N);let W,f;X>c?(W=1,f=0):(W=0,f=1);const M=X-W+I,T=c-f+I,j=X-1+2*I,d=c-1+2*I,b=255&K,V=255&a;let i=.5-X*X-c*c;if(i>=0){const k=3*o[b+q[V]];i*=i,Y=i*i*(l[k]*X+l[k+1]*c)}let F=.5-M*M-T*T;if(F>=0){const k=3*o[b+W+q[V+f]];F*=F,J=F*F*(l[k]*M+l[k+1]*T)}let R=.5-j*j-d*d;if(R>=0){const k=3*o[b+1+q[V+1]];R*=R,G=R*R*(l[k]*j+l[k+1]*d)}return 70*(Y+J+G)}noise3D(k,h,o){const x=this.permMod12,I=this.perm;let J,G,A,K;const a=(k+h+o)*q,N=Math.floor(k+a),X=Math.floor(h+a),c=Math.floor(o+a),W=(N+X+c)*Y,f=k-(N-W),M=h-(X-W),T=o-(c-W);let j,d,b,V,i,F;f>=M?M>=T?(j=1,d=0,b=0,V=1,i=1,F=0):f>=T?(j=1,d=0,b=0,V=1,i=0,F=1):(j=0,d=0,b=1,V=1,i=0,F=1):M<T?(j=0,d=0,b=1,V=0,i=1,F=1):f<T?(j=0,d=1,b=0,V=0,i=1,F=1):(j=0,d=1,b=0,V=1,i=1,F=0);const R=f-j+Y,s=M-d+Y,Z=T-b+Y,w=f-V+2*Y,D=M-i+2*Y,U=T-F+2*Y,Q=f-1+.5,B=M-1+.5,E=T-1+.5,n=255&N,H=255&X,y=255&c;let O=.6-f*f-M*M-T*T;if(O<0)J=0;else{const k=3*x[n+I[H+I[y]]];O*=O,J=O*O*(l[k]*f+l[k+1]*M+l[k+2]*T)}let z=.6-R*R-s*s-Z*Z;if(z<0)G=0;else{const k=3*x[n+j+I[H+d+I[y+b]]];z*=z,G=z*z*(l[k]*R+l[k+1]*s+l[k+2]*Z)}let p=.6-w*w-D*D-U*U;if(p<0)A=0;else{const k=3*x[n+V+I[H+i+I[y+F]]];p*=p,A=p*p*(l[k]*w+l[k+1]*D+l[k+2]*U)}let v=.6-Q*Q-B*B-E*E;if(v<0)K=0;else{const k=3*x[n+1+I[H+1+I[y+1]]];v*=v,K=v*v*(l[k]*Q+l[k+1]*B+l[k+2]*E)}return 32*(J+G+A+K)}noise4D(k,h,o,x){const I=this.perm;let q,Y,l,K,a;const N=(k+h+o+x)*J,X=Math.floor(k+N),c=Math.floor(h+N),W=Math.floor(o+N),f=Math.floor(x+N),M=(X+c+W+f)*G,T=k-(X-M),j=h-(c-M),d=o-(W-M),b=x-(f-M);let V=0,i=0,F=0,R=0;T>j?V++:i++,T>d?V++:F++,T>b?V++:R++,j>d?i++:F++,j>b?i++:R++,d>b?F++:R++;const s=V>=3?1:0,Z=i>=3?1:0,w=F>=3?1:0,D=R>=3?1:0,U=V>=2?1:0,Q=i>=2?1:0,B=F>=2?1:0,E=R>=2?1:0,n=V>=1?1:0,H=i>=1?1:0,y=F>=1?1:0,O=R>=1?1:0,z=T-s+G,p=j-Z+G,v=d-w+G,m=b-D+G,L=T-U+2*G,P=j-Q+2*G,r=d-B+2*G,t=b-E+2*G,S=T-n+3*G,C=j-H+3*G,g=d-y+3*G,e=b-O+3*G,u=T-1+4*G,kk=j-1+4*G,hk=d-1+4*G,ok=b-1+4*G,xk=255&X,Ik=255&c,qk=255&W,Yk=255&f;let Jk=.6-T*T-j*j-d*d-b*b;if(Jk<0)q=0;else{const k=I[xk+I[Ik+I[qk+I[Yk]]]]%32*4;Jk*=Jk,q=Jk*Jk*(A[k]*T+A[k+1]*j+A[k+2]*d+A[k+3]*b)}let Gk=.6-z*z-p*p-v*v-m*m;if(Gk<0)Y=0;else{const k=I[xk+s+I[Ik+Z+I[qk+w+I[Yk+D]]]]%32*4;Gk*=Gk,Y=Gk*Gk*(A[k]*z+A[k+1]*p+A[k+2]*v+A[k+3]*m)}let lk=.6-L*L-P*P-r*r-t*t;if(lk<0)l=0;else{const k=I[xk+U+I[Ik+Q+I[qk+B+I[Yk+E]]]]%32*4;lk*=lk,l=lk*lk*(A[k]*L+A[k+1]*P+A[k+2]*r+A[k+3]*t)}let Ak=.6-S*S-C*C-g*g-e*e;if(Ak<0)K=0;else{const k=I[xk+n+I[Ik+H+I[qk+y+I[Yk+O]]]]%32*4;Ak*=Ak,K=Ak*Ak*(A[k]*S+A[k+1]*C+A[k+2]*g+A[k+3]*e)}let Kk=.6-u*u-kk*kk-hk*hk-ok*ok;if(Kk<0)a=0;else{const k=I[xk+1+I[Ik+1+I[qk+1+I[Yk+1]]]]%32*4;Kk*=Kk,a=Kk*Kk*(A[k]*u+A[k+1]*kk+A[k+2]*hk+A[k+3]*ok)}return 27*(q+Y+l+K+a)}}}}]);