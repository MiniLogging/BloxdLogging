/*! For license information please see xf2sr.32.49932938.chunk.js.LICENSE.txt */
(self["1kjc9ee3uyt"]=self["1kjc9ee3uyt"]||[]).push([[32],{13561:(w,E,G)=>{"use strict";var P=G(13565),h=G(13573),B=G(13582);G.g.__TYPEDARRAY_POOL||(G.g.__TYPEDARRAY_POOL={UINT8:h([32,0]),UINT16:h([32,0]),UINT32:h([32,0]),INT8:h([32,0]),INT16:h([32,0]),INT32:h([32,0]),FLOAT:h([32,0]),DOUBLE:h([32,0]),DATA:h([32,0]),UINT8C:h([32,0]),BUFFER:h([32,0])});var y="undefined"!==typeof Uint8ClampedArray,x=G.g.__TYPEDARRAY_POOL;x.UINT8C||(x.UINT8C=h([32,0])),x.BUFFER||(x.BUFFER=h([32,0]));var U=x.DATA,l=x.BUFFER;function i(w){if(w){var E=w.length||w.byteLength,G=P.log2(E);U[G].push(w)}}function O(w){w=P.nextPow2(w);var E=P.log2(w),G=U[E];return G.length>0?G.pop():new ArrayBuffer(w)}function u(w){return new Uint8Array(O(w),0,w)}function V(w){return new Uint16Array(O(2*w),0,w)}function a(w){return new Uint32Array(O(4*w),0,w)}function Q(w){return new Int8Array(O(w),0,w)}function c(w){return new Int16Array(O(2*w),0,w)}function Z(w){return new Int32Array(O(4*w),0,w)}function J(w){return new Float32Array(O(4*w),0,w)}function d(w){return new Float64Array(O(8*w),0,w)}function K(w){return y?new Uint8ClampedArray(O(w),0,w):u(w)}function t(w){return new DataView(O(w),0,w)}E.free=function(w){if(B(w))l[P.log2(w.length)].push(w);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(w)&&(w=w.buffer),!w)return;var E=w.length||w.byteLength,G=0|P.log2(E);U[G].push(w)}},E.freeUint8=E.freeUint16=E.freeUint32=E.freeInt8=E.freeInt16=E.freeInt32=E.freeFloat32=E.freeFloat=E.freeFloat64=E.freeDouble=E.freeUint8Clamped=E.freeDataView=function(w){i(w.buffer)},E.freeArrayBuffer=i,E.freeBuffer=function(w){l[P.log2(w.length)].push(w)},E.malloc=function(w,E){if(void 0===E||"arraybuffer"===E)return O(w);switch(E){case"uint8":return u(w);case"uint16":return V(w);case"uint32":return a(w);case"int8":return Q(w);case"int16":return c(w);case"int32":return Z(w);case"float":case"float32":return J(w);case"double":case"float64":return d(w);case"uint8_clamped":return K(w);case"buffer":throw"Buffer not supported";case"data":case"dataview":return t(w);default:return null}return null},E.mallocArrayBuffer=O,E.mallocUint8=u,E.mallocUint16=V,E.mallocUint32=a,E.mallocInt8=Q,E.mallocInt16=c,E.mallocInt32=Z,E.mallocFloat32=E.mallocFloat=J,E.mallocFloat64=E.mallocDouble=d,E.mallocUint8Clamped=K,E.mallocDataView=t,E.clearCache=function(){for(var w=0;w<32;++w)x.UINT8[w].length=0,x.UINT16[w].length=0,x.UINT32[w].length=0,x.INT8[w].length=0,x.INT16[w].length=0,x.INT32[w].length=0,x.FLOAT[w].length=0,x.DOUBLE[w].length=0,x.UINT8C[w].length=0,U[w].length=0,l[w].length=0}},13639:(w,E,G)=>{w.exports=h;var P=G(12436);function h(w,E){if(!(this instanceof h))return new h(w,E);var G=P.create();P.add(G,w,E),this.base=P.min(P.create(),w,G),this.hi=P.clone(E),this.max=P.max(P.create(),w,G),this.mag=P.length(this.hi)}var B=h.prototype;B.width=function(){return this.hi[0]},B.height=function(){return this.hi[1]},B.depth=function(){return this.hi[2]},B.x0=function(){return this.base[0]},B.y0=function(){return this.base[1]},B.z0=function(){return this.base[2]},B.x1=function(){return this.max[0]},B.y1=function(){return this.max[1]},B.z1=function(){return this.max[2]},B.translate=function(w){return P.add(this.max,this.max,w),P.add(this.base,this.base,w),this},B.setPosition=function(w){return P.add(this.max,w,this.hi),P.k(this.base,w),this},B.expand=function(w){var E=P.create(),G=P.create();return P.max(E,w.max,this.max),P.min(G,w.base,this.base),P.cE(E,E,G),new h(G,E)},B.intersects=function(w){return!(w.base[0]>this.max[0])&&(!(w.base[1]>this.max[1])&&(!(w.base[2]>this.max[2])&&(!(w.max[0]<this.base[0])&&(!(w.max[1]<this.base[1])&&!(w.max[2]<this.base[2])))))},B.touches=function(w){var E=this.union(w);return null!==E&&(0==E.width()||0==E.height()||0==E.depth())},B.union=function(w){if(!this.intersects(w))return null;var E=Math.max(w.base[0],this.base[0]),G=Math.max(w.base[1],this.base[1]),P=Math.max(w.base[2],this.base[2]);return new h([E,G,P],[Math.min(w.max[0],this.max[0])-E,Math.min(w.max[1],this.max[1])-G,Math.min(w.max[2],this.max[2])-P])}},13565:(w,E)=>{"use strict";function G(w){var E=32;return(w&=-w)&&E--,65535&w&&(E-=16),16711935&w&&(E-=8),252645135&w&&(E-=4),858993459&w&&(E-=2),1431655765&w&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(w){return(w>0)-(w<0)},E.abs=function(w){var E=w>>31;return(w^E)-E},E.min=function(w,E){return E^(w^E)&-(w<E)},E.max=function(w,E){return w^(w^E)&-(w<E)},E.isPow2=function(w){return!(w&w-1)&&!!w},E.log2=function(w){var E,G;return E=(w>65535)<<4,E|=G=((w>>>=E)>255)<<3,E|=G=((w>>>=G)>15)<<2,(E|=G=((w>>>=G)>3)<<1)|(w>>>=G)>>1},E.log10=function(w){return w>=1e9?9:w>=1e8?8:w>=1e7?7:w>=1e6?6:w>=1e5?5:w>=1e4?4:w>=1e3?3:w>=100?2:w>=10?1:0},E.popCount=function(w){return 16843009*((w=(858993459&(w-=w>>>1&1431655765))+(w>>>2&858993459))+(w>>>4)&252645135)>>>24},E.countTrailingZeros=G,E.nextPow2=function(w){return w+=0===w,--w,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)+1},E.prevPow2=function(w){return w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)-(w>>>1)},E.parity=function(w){return w^=w>>>16,w^=w>>>8,w^=w>>>4,27030>>>(w&=15)&1};var P=new Array(256);!function(w){for(var E=0;E<256;++E){var G=E,P=E,h=7;for(G>>>=1;G;G>>>=1)P<<=1,P|=1&G,--h;w[E]=P<<h&255}}(P),E.reverse=function(w){return P[255&w]<<24|P[w>>>8&255]<<16|P[w>>>16&255]<<8|P[w>>>24&255]},E.interleave2=function(w,E){return(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(w,E){return(w=65535&((w=16711935&((w=252645135&((w=858993459&((w=w>>>E&1431655765)|w>>>1))|w>>>2))|w>>>4))|w>>>16))<<16>>16},E.interleave3=function(w,E,G){return w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2),(w|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2))<<2},E.deinterleave3=function(w,E){return(w=1023&((w=4278190335&((w=251719695&((w=3272356035&((w=w>>>E&1227133513)|w>>>2))|w>>>4))|w>>>8))|w>>>16))<<22>>22},E.nextCombination=function(w){var E=w|w-1;return E+1|(~E&-~E)-1>>>G(w)+1}},13557:(w,E,G)=>{"use strict";w.exports=function(w,E,G){switch(arguments.length){case 1:return P=[],l(h=w,h,i,!0),P;case 2:return"function"===typeof E?l(w,w,E,!0):function(w,E){return P=[],l(w,E,i,!1),P}(w,E);case 3:return l(w,E,G,!1);default:throw new Error("box-intersect: Invalid arguments")}var h};var P,h=G(13561),B=G(13585),y=G(13594);function x(w,E){for(var G=0;G<w;++G)if(!(E[G]<=E[G+w]))return!0;return!1}function U(w,E,G,P){for(var h=0,B=0,y=0,U=w.length;y<U;++y){var l=w[y];if(!x(E,l)){for(var i=0;i<2*E;++i)G[h++]=l[i];P[B++]=y}}return B}function l(w,E,G,P){var x=w.length,l=E.length;if(!(x<=0||l<=0)){var i=w[0].length>>>1;if(!(i<=0)){var O,u=h.mallocDouble(2*i*x),V=h.mallocInt32(x);if((x=U(w,i,u,V))>0){if(1===i&&P)B.init(x),O=B.sweepComplete(i,G,0,x,u,V,0,x,u,V);else{var a=h.mallocDouble(2*i*l),Q=h.mallocInt32(l);(l=U(E,i,a,Q))>0&&(B.init(x+l),O=1===i?B.sweepBipartite(i,G,0,x,u,V,0,l,a,Q):y(i,G,P,x,u,V,l,a,Q),h.free(a),h.free(Q))}h.free(u),h.free(V)}return O}}}function i(w,E){P.push([w,E])}},13598:(w,E)=>{"use strict";var G="d",P="ax",h="fp",B="es",y="rs",x="re",U="rb",l="bs",i="be",O="bb",u=[G,P,"vv",y,x,U,"ri",l,i,O,"bi"];function V(w){var E="bruteForce"+(w?"Full":"Partial"),P=[],y=u.slice();w||y.splice(3,0,h);var x=["function "+E+"("+y.join()+"){"];function U(E,h){var y=function(w,E,P){var h="bruteForce"+(w?"Red":"Blue")+(E?"Flip":"")+(P?"Full":""),y=["function ",h,"(",u.join(),"){","var ",B,"=2*",G,";"],x="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",U="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(P?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return w?y.push(x,"Q",":",U):y.push(U,"Q",":",x),P?y.push("if(y1<x0||x1<y0)continue;"):E?y.push("if(y0<=x0||x1<y0)continue;"):y.push("if(y0<x0||x1<y0)continue;"),y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),E?y.push("yi,xi"):y.push("xi,yi"),y.push(");if(rv!==void 0)return rv;}}}"),{name:h,code:y.join("")}}(E,h,w);P.push(y.code),x.push("return "+y.name+"("+u.join()+");")}x.push("if(re-rs>be-bs){"),w?(U(!0,!1),x.push("}else{"),U(!1,!1)):(x.push("if(fp){"),U(!0,!0),x.push("}else{"),U(!0,!1),x.push("}}else{if(fp){"),U(!1,!0),x.push("}else{"),U(!1,!1),x.push("}")),x.push("}}return "+E);var l=P.join("")+x.join("");return new Function(l)()}E.partial=V(!1),E.full=V(!0)},13594:(w,E,G)=>{"use strict";w.exports=function(w,E,G,B,i,g,o,f,k){!function(w,E){var G=8*h.log2(E+1)*(w+1)|0,B=h.nextPow2(K*G);q.length<B&&(P.free(q),q=P.mallocInt32(B));var y=h.nextPow2(t*G);W.length<y&&(P.free(W),W=P.mallocDouble(y))}(w,B+o);var N,v=0,C=2*w;T(v++,0,0,B,0,o,G?16:0,-1/0,1/0),G||T(v++,0,0,o,0,B,1,-1/0,1/0);for(;v>0;){var s=(v-=1)*K,F=q[s],M=q[s+1],p=q[s+2],D=q[s+3],e=q[s+4],R=q[s+5],H=v*t,z=W[H],L=W[H+1],m=1&R,n=!!(16&R),r=i,Y=g,S=f,X=k;if(m&&(r=f,Y=k,S=i,X=g),!(2&R&&M>=(p=c(w,F,M,p,r,Y,L)))&&!(4&R&&(M=Z(w,F,M,p,r,Y,z))>=p)){var b=p-M,A=e-D;if(n){if(w*b*(b+A)<V){if(void 0!==(N=U.scanComplete(w,F,E,M,p,r,Y,D,e,S,X)))return N;continue}}else{if(w*Math.min(b,A)<O){if(void 0!==(N=y(w,F,E,m,M,p,r,Y,D,e,S,X)))return N;continue}if(w*b*A<u){if(void 0!==(N=U.scanBipartite(w,F,E,m,M,p,r,Y,D,e,S,X)))return N;continue}}var ww=a(w,F,M,p,r,Y,z,L);if(M<ww)if(w*(ww-M)<O){if(void 0!==(N=x(w,F+1,E,M,ww,r,Y,D,e,S,X)))return N}else if(F===w-2){if(void 0!==(N=m?U.sweepBipartite(w,E,D,e,S,X,M,ww,r,Y):U.sweepBipartite(w,E,M,ww,r,Y,D,e,S,X)))return N}else T(v++,F+1,M,ww,D,e,m,-1/0,1/0),T(v++,F+1,D,e,M,ww,1^m,-1/0,1/0);if(ww<p){var Ew=l(w,F,D,e,S,X),Gw=S[C*Ew+F],Pw=Q(w,F,Ew,e,S,X,Gw);if(Pw<e&&T(v++,F,ww,p,Pw,e,(4|m)+(n?16:0),Gw,L),D<Ew&&T(v++,F,ww,p,D,Ew,(2|m)+(n?16:0),z,Gw),Ew+1===Pw){if(void 0!==(N=n?j(w,F,E,ww,p,r,Y,Ew,S,X[Ew]):I(w,F,E,m,ww,p,r,Y,Ew,S,X[Ew])))return N}else if(Ew<Pw){var hw;if(n){if(ww<(hw=J(w,F,ww,p,r,Y,Gw))){var Bw=Q(w,F,ww,hw,r,Y,Gw);if(F===w-2){if(ww<Bw&&void 0!==(N=U.sweepComplete(w,E,ww,Bw,r,Y,Ew,Pw,S,X)))return N;if(Bw<hw&&void 0!==(N=U.sweepBipartite(w,E,Bw,hw,r,Y,Ew,Pw,S,X)))return N}else ww<Bw&&T(v++,F+1,ww,Bw,Ew,Pw,16,-1/0,1/0),Bw<hw&&(T(v++,F+1,Bw,hw,Ew,Pw,0,-1/0,1/0),T(v++,F+1,Ew,Pw,Bw,hw,1,-1/0,1/0))}}else ww<(hw=m?d(w,F,ww,p,r,Y,Gw):J(w,F,ww,p,r,Y,Gw))&&(F===w-2?N=m?U.sweepBipartite(w,E,Ew,Pw,S,X,ww,hw,r,Y):U.sweepBipartite(w,E,ww,hw,r,Y,Ew,Pw,S,X):(T(v++,F+1,ww,hw,Ew,Pw,m,-1/0,1/0),T(v++,F+1,Ew,Pw,ww,hw,1^m,-1/0,1/0)))}}}}};var P=G(13561),h=G(13565),B=G(13598),y=B.partial,x=B.full,U=G(13585),l=G(13600),i=G(13603),O=128,u=1<<22,V=1<<22,a=i("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Q=i("lo===p0",["p0"]),c=i("lo<p0",["p0"]),Z=i("hi<=p0",["p0"]),J=i("lo<=p0&&p0<=hi",["p0"]),d=i("lo<p0&&p0<=hi",["p0"]),K=6,t=2,q=P.mallocInt32(1024),W=P.mallocDouble(1024);function T(w,E,G,P,h,B,y,x,U){var l=K*w;q[l]=E,q[l+1]=G,q[l+2]=P,q[l+3]=h,q[l+4]=B,q[l+5]=y;var i=t*w;W[i]=x,W[i+1]=U}function I(w,E,G,P,h,B,y,x,U,l,i){var O=2*w,u=U*O,V=l[u+E];w:for(var a=h,Q=h*O;a<B;++a,Q+=O){var c=y[Q+E],Z=y[Q+E+w];if(!(V<c||Z<V)&&(!P||V!==c)){for(var J,d=x[a],K=E+1;K<w;++K){c=y[Q+K],Z=y[Q+K+w];var t=l[u+K],q=l[u+K+w];if(Z<t||q<c)continue w}if(void 0!==(J=P?G(i,d):G(d,i)))return J}}}function j(w,E,G,P,h,B,y,x,U,l){var i=2*w,O=x*i,u=U[O+E];w:for(var V=P,a=P*i;V<h;++V,a+=i){var Q=y[V];if(Q!==l){var c=B[a+E],Z=B[a+E+w];if(!(u<c||Z<u)){for(var J=E+1;J<w;++J){c=B[a+J],Z=B[a+J+w];var d=U[O+J],K=U[O+J+w];if(Z<d||K<c)continue w}var t=G(Q,l);if(void 0!==t)return t}}}}},13600:(w,E,G)=>{"use strict";w.exports=function(w,E,G,y,x,U){if(y<=G+1)return G;var l=G,i=y,O=y+G>>>1,u=2*w,V=O,a=x[u*O+E];for(;l<i;){if(i-l<h){B(w,E,l,i,x,U),a=x[u*O+E];break}var Q=i-l,c=Math.random()*Q+l|0,Z=x[u*c+E],J=Math.random()*Q+l|0,d=x[u*J+E],K=Math.random()*Q+l|0,t=x[u*K+E];Z<=d?t>=d?(V=J,a=d):Z>=t?(V=c,a=Z):(V=K,a=t):d>=t?(V=J,a=d):t>=Z?(V=c,a=Z):(V=K,a=t);for(var q=u*(i-1),W=u*V,T=0;T<u;++T,++q,++W){var I=x[q];x[q]=x[W],x[W]=I}var j=U[i-1];U[i-1]=U[V],U[V]=j;for(q=u*(i-1),W=u*(V=P(w,E,l,i-1,x,U,a)),T=0;T<u;++T,++q,++W){I=x[q];x[q]=x[W],x[W]=I}j=U[i-1];if(U[i-1]=U[V],U[V]=j,O<V){for(i=V-1;l<i&&x[u*(i-1)+E]===a;)i-=1;i+=1}else{if(!(V<O))break;for(l=V+1;l<i&&x[u*l+E]===a;)l+=1}}return P(w,E,G,O,x,U,x[u*O+E])};var P=G(13603)("lo<p0",["p0"]),h=8;function B(w,E,G,P,h,B){for(var y=2*w,x=y*(G+1)+E,U=G+1;U<P;++U,x+=y)for(var l=h[x],i=U,O=y*(U-1);i>G&&h[O+E]>l;--i,O-=y){for(var u=O,V=O+y,a=0;a<y;++a,++u,++V){var Q=h[u];h[u]=h[V],h[V]=Q}var c=B[i];B[i]=B[i-1],B[i-1]=c}}},13603:w=>{"use strict";w.exports=function(w,G){var P="abcdef".split("").concat(G),h=[];w.indexOf("lo")>=0&&h.push("lo=e[k+n]");w.indexOf("hi")>=0&&h.push("hi=e[k+o]");return P.push(E.replace("_",h.join()).replace("$",w)),Function.apply(void 0,P)};var E="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13592:w=>{"use strict";w.exports=function(w,P){P<=4*E?G(0,P-1,w):l(0,P-1,w)};var E=32;function G(w,E,G){for(var P=2*(w+1),h=w+1;h<=E;++h){for(var B=G[P++],y=G[P++],x=h,U=P-2;x-- >w;){var l=G[U-2],i=G[U-1];if(l<B)break;if(l===B&&i<y)break;G[U]=l,G[U+1]=i,U-=2}G[U]=B,G[U+1]=y}}function P(w,E,G){E*=2;var P=G[w*=2],h=G[w+1];G[w]=G[E],G[w+1]=G[E+1],G[E]=P,G[E+1]=h}function h(w,E,G){E*=2,G[w*=2]=G[E],G[w+1]=G[E+1]}function B(w,E,G,P){E*=2,G*=2;var h=P[w*=2],B=P[w+1];P[w]=P[E],P[w+1]=P[E+1],P[E]=P[G],P[E+1]=P[G+1],P[G]=h,P[G+1]=B}function y(w,E,G,P,h){E*=2,h[w*=2]=h[E],h[E]=G,h[w+1]=h[E+1],h[E+1]=P}function x(w,E,G){E*=2;var P=G[w*=2],h=G[E];return!(P<h)&&(P!==h||G[w+1]>G[E+1])}function U(w,E,G,P){var h=P[w*=2];return h<E||h===E&&P[w+1]<G}function l(w,i,O){var u=(i-w+1)/6|0,V=w+u,a=i-u,Q=w+i>>1,c=Q-u,Z=Q+u,J=V,d=c,K=Q,t=Z,q=a,W=w+1,T=i-1,I=0;x(J,d,O)&&(I=J,J=d,d=I),x(t,q,O)&&(I=t,t=q,q=I),x(J,K,O)&&(I=J,J=K,K=I),x(d,K,O)&&(I=d,d=K,K=I),x(J,t,O)&&(I=J,J=t,t=I),x(K,t,O)&&(I=K,K=t,t=I),x(d,q,O)&&(I=d,d=q,q=I),x(d,K,O)&&(I=d,d=K,K=I),x(t,q,O)&&(I=t,t=q,q=I);for(var j=O[2*d],g=O[2*d+1],o=O[2*t],f=O[2*t+1],k=2*J,N=2*K,v=2*q,C=2*V,s=2*Q,F=2*a,M=0;M<2;++M){var p=O[k+M],D=O[N+M],e=O[v+M];O[C+M]=p,O[s+M]=D,O[F+M]=e}h(c,w,O),h(Z,i,O);for(var R=W;R<=T;++R)if(U(R,j,g,O))R!==W&&P(R,W,O),++W;else if(!U(R,o,f,O))for(;;){if(U(T,o,f,O)){U(T,j,g,O)?(B(R,W,T,O),++W,--T):(P(R,T,O),--T);break}if(--T<R)break}y(w,W-1,j,g,O),y(i,T+1,o,f,O),W-2-w<=E?G(w,W-2,O):l(w,W-2,O),i-(T+2)<=E?G(T+2,i,O):l(T+2,i,O),T-W<=E?G(W,T,O):l(W,T,O)}},13585:(w,E,G)=>{"use strict";w.exports={init:function(w){var E=h.nextPow2(w);U.length<E&&(P.free(U),U=P.mallocInt32(E));l.length<E&&(P.free(l),l=P.mallocInt32(E));i.length<E&&(P.free(i),i=P.mallocInt32(E));O.length<E&&(P.free(O),O=P.mallocInt32(E));u.length<E&&(P.free(u),u=P.mallocInt32(E));V.length<E&&(P.free(V),V=P.mallocInt32(E));var G=8*E;a.length<G&&(P.free(a),a=P.mallocDouble(G))},sweepBipartite:function(w,E,G,P,h,x,u,V,Z,J){for(var d=0,K=2*w,t=w-1,q=K-1,W=G;W<P;++W){var T=x[W],I=K*W;a[d++]=h[I+t],a[d++]=-(T+1),a[d++]=h[I+q],a[d++]=T}for(W=u;W<V;++W){T=J[W]+y;var j=K*W;a[d++]=Z[j+t],a[d++]=-T,a[d++]=Z[j+q],a[d++]=T}var g=d>>>1;B(a,g);var o=0,f=0;for(W=0;W<g;++W){var k=0|a[2*W+1];if(k>=y)Q(i,O,f--,k=k-y|0);else if(k>=0)Q(U,l,o--,k);else if(k<=-y){k=-k-y|0;for(var N=0;N<o;++N){if(void 0!==(v=E(U[N],k)))return v}c(i,O,f++,k)}else{k=-k-1|0;for(N=0;N<f;++N){var v;if(void 0!==(v=E(k,i[N])))return v}c(U,l,o++,k)}}},sweepComplete:function(w,E,G,P,h,y,x,Z,J,d){for(var K=0,t=2*w,q=w-1,W=t-1,T=G;T<P;++T){var I=y[T]+1<<1,j=t*T;a[K++]=h[j+q],a[K++]=-I,a[K++]=h[j+W],a[K++]=I}for(T=x;T<Z;++T){I=d[T]+1<<1;var g=t*T;a[K++]=J[g+q],a[K++]=1|-I,a[K++]=J[g+W],a[K++]=1|I}var o=K>>>1;B(a,o);var f=0,k=0,N=0;for(T=0;T<o;++T){var v=0|a[2*T+1],C=1&v;if(T<o-1&&v>>1===a[2*T+3]>>1&&(C=2,T+=1),v<0){for(var s=-(v>>1)-1,F=0;F<N;++F){if(void 0!==(M=E(u[F],s)))return M}if(0!==C)for(F=0;F<f;++F){if(void 0!==(M=E(U[F],s)))return M}if(1!==C)for(F=0;F<k;++F){var M;if(void 0!==(M=E(i[F],s)))return M}0===C?c(U,l,f++,s):1===C?c(i,O,k++,s):2===C&&c(u,V,N++,s)}else{s=(v>>1)-1;0===C?Q(U,l,f--,s):1===C?Q(i,O,k--,s):2===C&&Q(u,V,N--,s)}}},scanBipartite:function(w,E,G,P,h,x,i,O,u,V,Z,J){var d=0,K=2*w,t=E,q=E+w,W=1,T=1;P?T=y:W=y;for(var I=h;I<x;++I){var j=I+W,g=K*I;a[d++]=i[g+t],a[d++]=-j,a[d++]=i[g+q],a[d++]=j}for(I=u;I<V;++I){j=I+T;var o=K*I;a[d++]=Z[o+t],a[d++]=-j}var f=d>>>1;B(a,f);var k=0;for(I=0;I<f;++I){var N=0|a[2*I+1];if(N<0){var v=!1;if((j=-N)>=y?(v=!P,j-=y):(v=!!P,j-=1),v)c(U,l,k++,j);else{var C=J[j],s=K*j,F=Z[s+E+1],M=Z[s+E+1+w];w:for(var p=0;p<k;++p){var D=U[p],e=K*D;if(!(M<i[e+E+1]||i[e+E+1+w]<F)){for(var R=E+2;R<w;++R)if(Z[s+R+w]<i[e+R]||i[e+R+w]<Z[s+R])continue w;var H,z=O[D];if(void 0!==(H=P?G(C,z):G(z,C)))return H}}}}else Q(U,l,k--,N-W)}},scanComplete:function(w,E,G,P,h,x,l,i,O,u,V){for(var Q=0,c=2*w,Z=E,J=E+w,d=P;d<h;++d){var K=d+y,t=c*d;a[Q++]=x[t+Z],a[Q++]=-K,a[Q++]=x[t+J],a[Q++]=K}for(d=i;d<O;++d){K=d+1;var q=c*d;a[Q++]=u[q+Z],a[Q++]=-K}var W=Q>>>1;B(a,W);var T=0;for(d=0;d<W;++d){var I=0|a[2*d+1];if(I<0){if((K=-I)>=y)U[T++]=K-y;else{var j=V[K-=1],g=c*K,o=u[g+E+1],f=u[g+E+1+w];w:for(var k=0;k<T;++k){var N=U[k],v=l[N];if(v===j)break;var C=c*N;if(!(f<x[C+E+1]||x[C+E+1+w]<o)){for(var s=E+2;s<w;++s)if(u[g+s+w]<x[C+s]||x[C+s+w]<u[g+s])continue w;var F=G(v,j);if(void 0!==F)return F}}}}else{for(K=I-y,k=T-1;k>=0;--k)if(U[k]===K){for(s=k+1;s<T;++s)U[s-1]=U[s];break}--T}}}};var P=G(13561),h=G(13565),B=G(13592),y=1<<28,x=1024,U=P.mallocInt32(x),l=P.mallocInt32(x),i=P.mallocInt32(x),O=P.mallocInt32(x),u=P.mallocInt32(x),V=P.mallocInt32(x),a=P.mallocDouble(8192);function Q(w,E,G,P){var h=E[P],B=w[G-1];w[h]=B,E[B]=h}function c(w,E,G,P){w[G]=P,E[P]=G}},13573:w=>{"use strict";function E(w,G,P){var h=0|w[P];if(h<=0)return[];var B,y=new Array(h);if(P===w.length-1)for(B=0;B<h;++B)y[B]=G;else for(B=0;B<h;++B)y[B]=E(w,G,P+1);return y}w.exports=function(w,G){switch("undefined"===typeof G&&(G=0),typeof w){case"number":if(w>0)return function(w,E){var G,P;for(G=new Array(w),P=0;P<w;++P)G[P]=E;return G}(0|w,G);break;case"object":if("number"===typeof w.length)return E(w,G,0)}return[]}},13522:(w,E,G)=>{w.exports=function(){var w=this;this.components={},this.comps=this.components;var E=this.components,G=1,h={},B=[],y=[],x={timeout:!1,removals:[],multiComps:[]};function U(w,G){var P=E[G],B=h[G],y=B.hash[w];y&&(B.remove(w),P.Gh&&(P.multi?(y.forEach((E=>{E&&P.Gh(w,E)})),y.length=0):P.Gh(w,y)),x.removals.push(B),l())}function l(){x.timeout||(x.timeout=!0,setTimeout(i,1))}function i(){x.timeout=!1,O()}function O(){x.multiComps.length&&function(w){for(var E=0;E<w.length;E++){var{entID:G,data:P}=w[E],h=P.hash[G];if(h){for(var B=0;B<h.length;B++)h[B]||(h.splice(B,1),B--);0===h.length&&(P.remove(G),x.removals.push(P))}}w.length=0}(x.multiComps),x.removals.length&&function(w){for(var E=0;E<w.length;E++){w[E].flush()}w.length=0}(x.removals)}this.dO=h,this._systems=B,this._renderSystems=y,this.xi=function(E){var P=G++;return Array.isArray(E)&&E.forEach((E=>w.zU(P,E))),P},this.deleteEntity=function(E){return Object.keys(h).forEach((w=>{h[w].hash[E]&&U(E,w)})),w},this.qi=function(w){if(!w)throw new Error("Missing component definition");var G=w.name;if(!G)throw new Error("Component definition must have a name property.");if("string"!==typeof G)throw new Error("Component name must be a string.");if(""===G)throw new Error("Component name must be a non-empty string.");if(h[G])throw new Error(`Component ${G} already exists.`);var x={};return x.name=G,x.multi=!!w.multi,x.order=isNaN(w.order)?99:w.order,x.stateConstructor=w.stateConstructor||null,x.state=w.state||{},x.Mx=w.Mx||null,x.Gh=w.Gh||null,x.system=w.system||null,x.mx=w.mx||null,E[G]=x,h[G]=new P,h[G]._pendingMultiCleanup=!1,h[G]._multiCleanupIDs=x.multi?[]:null,x.system&&(B.push(G),B.sort(((w,G)=>E[w].order-E[G].order))),x.mx&&(y.push(G),y.sort(((w,G)=>E[w].order-E[G].order))),G},this.overwriteComponent=function(w,G){var P=E[w];if(!P)throw new Error(`Unknown component: ${w}`);if(!G)throw new Error("Missing component definition");if(P.name!==G.name)throw new Error("Overwriting component must use the same name property.");var x={};x.name=w,x.multi=!!G.multi,x.order=isNaN(G.order)?99:G.order,x.state=G.state||{},x.Mx=G.Mx||null,x.Gh=G.Gh||null,x.system=G.system||null,x.mx=G.mx||null,E[w]=x,h[w]._pendingMultiCleanup=!1,h[w]._multiCleanupIDs=x.multi?[]:null;var U=B.indexOf(w);x.system&&U<0&&B.push(w),!x.system&&U>=0&&B.splice(U,1),B.sort(((w,G)=>E[w].order-E[G].order));var l=y.indexOf(w);x.mx&&l<0&&y.push(w),!x.mx&&l>=0&&y.splice(l,1),y.sort(((w,G)=>E[w].order-E[G].order));var i=x.state;return this.Rl(w).forEach((w=>{for(var E in i)E in w||(w[E]=i[E]);x.Mx&&x.Mx(w.zx,w)})),w},this.deleteComponent=function(G){var P=h[G];if(!P)throw new Error(`Unknown component: ${G}`);P.flush(),P.list.forEach((w=>{w&&U(w.zx||w[0].zx,G)}));var x=B.indexOf(G),l=y.indexOf(G);return x>-1&&B.splice(x,1),l>-1&&y.splice(l,1),h[G].dispose(),delete h[G],delete E[G],w},this.zU=function(w,G,P){var B,y=E[G],x=h[G];if(!x)throw new Error(`Unknown component: ${G}.`);if(x.hash[w]&&!y.multi)throw new Error(`Entity ${w} already has component: ${G}.`);if(y.stateConstructor){if(!(B=new y.stateConstructor).hasOwnProperty("zx"))throw new Error(`Component ${y.name} stateConstructor type does not have property __id`)}else B=Object.assign({},{zx:w},y.state,P);if(B.zx=w,y.multi){var U=x.hash[w];U||(U=[],x.add(w,U)),U.push(B)}else x.add(w,B);return y.Mx&&y.Mx(w,B),this},this.wl=function(w,E){var G=h[E];if(!G)throw new Error(`Unknown component: ${E}.`);return!!G.hash[w]},this.rU=function(E,G){if(!h[G])throw new Error(`Unknown component: ${G}.`);return U(E,G),w},this.getState=function(w,E){var G=h[E];if(!G)throw new Error(`Unknown component: ${E}.`);return G.hash[w]},this.Rl=function(w){var E=h[w];if(!E)throw new Error(`Unknown component: ${w}.`);return O(),E.list},this.xV=function(w){if(!h[w])throw new Error(`Unknown component: ${w}.`);var E=h[w].hash;return w=>E[w]},this.iV=function(w){if(!h[w])throw new Error(`Unknown component: ${w}.`);var E=h[w].hash;return w=>!!E[w]},this.Jx=function(G){O();for(var P=0;P<B.length;P++){var y=B[P],x=E[y],U=h[y];x.system(G,U.list),O()}return w},this.render=function(G){O();for(var P=0;P<y.length;P++){var B=y[P],x=E[B],U=h[B];x.mx(G,U.list),O()}return w},this.removeMultiComponent=function(G,P,B){var y=E[P],U=h[P];if(!U)throw new Error(`Unknown component: ${P}.`);if(!y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(w,E,G,P){var h=G.hash[w];if(h){var B=h[P];B&&(h[P]=null,E.Gh&&E.Gh(w,B),x.multiComps.push({entID:w,data:G}),l())}}(G,y,U,B),w}};var P=G(13528)},13528:w=>{function E(w,E){var G=w._map[E];if(delete w.hash[E],delete w._map[E],G===w.list.length-1)w.list.pop();else{var P=w.list.pop();if(w.list[G]=P,null===P||null===P[0]){var h=w.list.length;for(var B in w._map)if(w._map[B]===h)return void(w._map[B]=G)}else{var y=P.zx||P[0].zx;w._map[y]=G}}}w.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(w,E){if("number"===typeof this._map[w]){var G=this._map[w];this.hash[w]=E,this.list[G]=E}else this._map[w]=this.list.length,this.hash[w]=E,this.list.push(E)}remove(w){var E=this._map[w];this.hash[w]=null,this.list[E]=null,this._pendingRemovals.push(w)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var w=0;w<this._pendingRemovals.length;w++){var G=this._pendingRemovals[w];null===this.hash[G]&&E(this,G)}this._pendingRemovals.length=0}}},13478:w=>{"use strict";var E,G="object"===typeof Reflect?Reflect:null,P=function(w,E,G){return Function.prototype.apply.call(w,E,G)};E=G&&"function"===typeof G.ownKeys?G.ownKeys:Object.getOwnPropertySymbols?function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:function(w){return Object.getOwnPropertyNames(w)};var h=Number.isNaN||function(w){return w!==w};function B(){B.init.call(this)}w.exports=B,w.exports.once=function(w,E){return new Promise((function(G,P){function h(G){w.removeListener(E,B),P(G)}function B(){"function"===typeof w.removeListener&&w.removeListener("error",h),G([].slice.call(arguments))}Q(w,E,B,{once:!0}),"error"!==E&&function(w,E,G){"function"===typeof w.on&&Q(w,"error",E,G)}(w,h,{once:!0})}))},B.EventEmitter=B,B.prototype._events=void 0,B.prototype._eventsCount=0,B.prototype._maxListeners=void 0;var y=10;function x(w){if("function"!==typeof w)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}function U(w){return void 0===w._maxListeners?B.defaultMaxListeners:w._maxListeners}function l(w,E,G,P){var h,B,y,l;if(x(G),void 0===(B=w._events)?(B=w._events=Object.create(null),w._eventsCount=0):(void 0!==B.newListener&&(w.emit("newListener",E,G.listener?G.listener:G),B=w._events),y=B[E]),void 0===y)y=B[E]=G,++w._eventsCount;else if("function"===typeof y?y=B[E]=P?[G,y]:[y,G]:P?y.unshift(G):y.push(G),(h=U(w))>0&&y.length>h&&!y.warned){y.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+y.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");i.name="MaxListenersExceededWarning",i.hE=w,i.type=E,i.count=y.length,l=i,console&&console.warn&&console.warn(l)}return w}function i(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function O(w,E,G){var P={fired:!1,wrapFn:void 0,target:w,type:E,listener:G},h=i.bind(P);return h.listener=G,P.wrapFn=h,h}function u(w,E,G){var P=w._events;if(void 0===P)return[];var h=P[E];return void 0===h?[]:"function"===typeof h?G?[h.listener||h]:[h]:G?function(w){for(var E=new Array(w.length),G=0;G<E.length;++G)E[G]=w[G].listener||w[G];return E}(h):a(h,h.length)}function V(w){var E=this._events;if(void 0!==E){var G=E[w];if("function"===typeof G)return 1;if(void 0!==G)return G.length}return 0}function a(w,E){for(var G=new Array(E),P=0;P<E;++P)G[P]=w[P];return G}function Q(w,E,G,P){if("function"===typeof w.on)P.once?w.once(E,G):w.on(E,G);else{if("function"!==typeof w.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w);w.addEventListener(E,(function h(B){P.once&&w.removeEventListener(E,h),G(B)}))}}Object.defineProperty(B,"defaultMaxListeners",{enumerable:!0,get:function(){return y},set:function(w){if("number"!==typeof w||w<0||h(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");y=w}}),B.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},B.prototype.setMaxListeners=function(w){if("number"!==typeof w||w<0||h(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this},B.prototype.getMaxListeners=function(){return U(this)},B.prototype.emit=function(w){for(var E=[],G=1;G<arguments.length;G++)E.push(arguments[G]);var h="error"===w,B=this._events;if(void 0!==B)h=h&&void 0===B.error;else if(!h)return!1;if(h){var y;if(E.length>0&&(y=E[0]),y instanceof Error)throw y;var x=new Error("Unhandled error."+(y?" ("+y.message+")":""));throw x.context=y,x}var U=B[w];if(void 0===U)return!1;if("function"===typeof U)P(U,this,E);else{var l=U.length,i=a(U,l);for(G=0;G<l;++G)P(i[G],this,E)}return!0},B.prototype.addListener=function(w,E){return l(this,w,E,!1)},B.prototype.on=B.prototype.addListener,B.prototype.prependListener=function(w,E){return l(this,w,E,!0)},B.prototype.once=function(w,E){return x(E),this.on(w,O(this,w,E)),this},B.prototype.prependOnceListener=function(w,E){return x(E),this.prependListener(w,O(this,w,E)),this},B.prototype.removeListener=function(w,E){var G,P,h,B,y;if(x(E),void 0===(P=this._events))return this;if(void 0===(G=P[w]))return this;if(G===E||G.listener===E)0===--this._eventsCount?this._events=Object.create(null):(delete P[w],P.removeListener&&this.emit("removeListener",w,G.listener||E));else if("function"!==typeof G){for(h=-1,B=G.length-1;B>=0;B--)if(G[B]===E||G[B].listener===E){y=G[B].listener,h=B;break}if(h<0)return this;0===h?G.shift():function(w,E){for(;E+1<w.length;E++)w[E]=w[E+1];w.pop()}(G,h),1===G.length&&(P[w]=G[0]),void 0!==P.removeListener&&this.emit("removeListener",w,y||E)}return this},B.prototype.off=B.prototype.removeListener,B.prototype.BE=function(w){var E,G,P;if(void 0===(G=this._events))return this;if(void 0===G.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==G[w]&&(0===--this._eventsCount?this._events=Object.create(null):delete G[w]),this;if(0===arguments.length){var h,B=Object.keys(G);for(P=0;P<B.length;++P)"removeListener"!==(h=B[P])&&this.BE(h);return this.BE("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(E=G[w]))this.removeListener(w,E);else if(void 0!==E)for(P=E.length-1;P>=0;P--)this.removeListener(w,E[P]);return this},B.prototype.listeners=function(w){return u(this,w,!0)},B.prototype.rawListeners=function(w){return u(this,w,!1)},B.listenerCount=function(w,E){return"function"===typeof w.listenerCount?w.listenerCount(E):V.call(w,E)},B.prototype.listenerCount=V,B.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]}},13771:w=>{"use strict";w.exports=function(w,E,G,P,h,B){var y=+E[0],x=+E[1],U=+E[2],l=+G[0],i=+G[1],O=+G[2],u=Math.sqrt(l*l+i*i+O*O);if(0===u)throw new Error("Can't raycast along a zero vector");return function(w,E,G,P,h,B,y,x,U,l){for(var i=0,O=Math.floor,u=0|O(E),V=0|O(G),a=0|O(P),Q=h>0?1:-1,c=B>0?1:-1,Z=y>0?1:-1,J=Math.abs(1/h),d=Math.abs(1/B),K=Math.abs(1/y),t=J<1/0?J*(Q>0?u+1-E:E-u):1/0,q=d<1/0?d*(c>0?V+1-G:G-V):1/0,W=K<1/0?K*(Z>0?a+1-P:P-a):1/0,T=-1;i<=x;){var I=w(u,V,a);if(I)return U&&(U[0]=E+i*h,U[1]=G+i*B,U[2]=P+i*y),l&&(l[0]=l[1]=l[2]=0,0===T&&(l[0]=-Q),1===T&&(l[1]=-c),2===T&&(l[2]=-Z)),I;t<q?t<W?(u+=Q,i=t,t+=J,T=0):(a+=Z,i=W,W+=K,T=2):q<W?(V+=c,i=q,q+=d,T=1):(a+=Z,i=W,W+=K,T=2)}return U&&(U[0]=E+i*h,U[1]=G+i*B,U[2]=P+i*y),l&&(l[0]=l[1]=l[2]=0),0}(w,y,x,U,l/=u,i/=u,O/=u,P="undefined"===typeof P?64:+P,h,B)}},13795:(w,E,G)=>{"use strict";G.d(E,{e:()=>B});var P=G(13478);function h(){this.Uu=!1,this.stopPropagation=!1,this.lu=!1,this.disabled=!1}class B{constructor(w,E){this.version="0.7.0";var G=Object.assign({},new h,E||{});this.element=w||document,this.Uu=!!G.Uu,this.stopPropagation=!!G.stopPropagation,this.lu=!!G.lu,this.disabled=!!G.disabled,this.filterEvents=(w,E)=>!0,this.down=new P.EventEmitter,this.up=new P.EventEmitter,this.state={},this.sl={dx:0,dy:0,bu:0,Cl:0,Au:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?x(this):document.addEventListener("DOMContentLoaded",(w=>{x(this)}),{once:!0})}bind(w){for(var E=arguments.length,G=new Array(E>1?E-1:0),P=1;P<E;P++)G[P-1]=arguments[P];G.forEach((E=>{var G=this._keyBindmap[E]||[];G.includes(w)||(G.push(w),this._keyBindmap[E]=G)})),this.state[w]=!!this.state[w],this.pressCount[w]=this.pressCount[w]||0,this.releaseCount[w]=this.releaseCount[w]||0}unbind(w){for(var E in this._keyBindmap){var G=this._keyBindmap[E],P=G.indexOf(w);P>-1&&G.splice(P,1)}}getBindings(){var w={};for(var E in this._keyBindmap){this._keyBindmap[E].forEach((G=>{w[G]=w[G]||[],w[G].push(E)}))}return w}Jx(){y(this.sl),y(this.pressCount),y(this.releaseCount)}}function y(w){for(var E in w)w[E]=0}function x(w){window.addEventListener("keydown",a.bind(null,w,!0),!1),window.addEventListener("keyup",a.bind(null,w,!1),!1);var E={passive:!0};w.element.addEventListener("touchstart",O.bind(void 0,w),{passive:!1}),w.element.addEventListener("touchend",V.bind(void 0,w),E),w.element.addEventListener("mousedown",Q.bind(null,w,!0),E),window.document.addEventListener("mouseup",Q.bind(null,w,!1),E),w.element.addEventListener("touchmove",c.bind(null,w),E),w.element.addEventListener("mousemove",c.bind(null,w),E),window.PointerEvent,w.element.addEventListener("wheel",Z.bind(null,w),E),w.element.addEventListener("contextmenu",J.bind(null,w),!1),window.addEventListener("blur",d.bind(null,w),!1)}var U=0,l=0,i=null;function O(w,E){E.preventDefault(),u(E)}function u(w){let E=!1;for(let G=0;G<w.touches.length;++G)if(w.touches[G].identifier===i){E=!0;break}if(!E){const E=w.changedTouches[0];U=E.clientX,l=E.clientY,i=E.identifier}}function V(w,E){for(var G=E.changedTouches,P=0;P<G.length;++P)G[P].identifier===i&&(i=null)}function a(w,E,G){K(G.code,E,w,G)}function Q(w,E,G){if("pointerId"in G)if(E){if(null!==w._touches.currID)return;w._touches.currID=G.pointerId}else{if(w._touches.currID!==G.pointerId)return;w._touches.currID=null}return K("Mouse"+("button"in G?G.button+1:1),E,w,G),!1}function c(w,E){var G=E.movementX||E.mozMovementX||0,P=E.movementY||E.mozMovementY||0;if(E.touches&&0===(G|P)){var h=function(w){u(w);for(let E=0;E<w.changedTouches.length;++E)if(w.changedTouches[E].identifier==i){const G=w.changedTouches[E],P=[G.clientX-U,G.clientY-l];return U=G.clientX,l=G.clientY,P}return console.error(`Did not find touch id ${i}`),[0,0]}(E);G=h[0],P=h[1]}w.sl.dx+=G,w.sl.dy+=P}function Z(w,E){var G=1;switch(E.deltaMode){case 0:G=1;break;case 1:G=12;break;case 2:G=w.element.clientHeight||window.innerHeight}w.sl.bu+=(E.deltaX||0)*G,w.sl.Cl+=(E.deltaY||0)*G,w.sl.Au+=(E.deltaZ||0)*G}function J(w,E){if(!w.lu)return E.preventDefault(),!1}function d(w){for(var E in w._keyStates)w._keyStates[E]&&(/^Mouse\d/.test(E)||K(E,!1,w,{code:E,note:"pqzlzwreu",preventDefault:()=>{},stopPropagation:()=>{}}))}function K(w,E,G,P){var h=G._keyBindmap[w];h&&(t(G._keyStates[w],E)&&(G._keyStates[w]=E,h.forEach((w=>{(!G.filterEvents||G.filterEvents(P,w))&&function(w,E,G,P){var h=E?G.pressCount:G.releaseCount;h[w]=(h[w]||0)+1;var B=G._bindPressCount[w]||0;(B+=E?1:-1)<0&&(B=0);G._bindPressCount[w]=B;var y=G.state[w];if(t(y,B)){G.state[w]=B>0;var x=E?G.down:G.up;G.disabled||x.emit(w,P)}}(w,E,G,P)}))),"button"in P||(G.Uu&&!P.defaultPrevented&&P.preventDefault(),G.stopPropagation&&P.stopPropagation()))}function t(w,E){return w?!E:E}},12490:w=>{w.exports=function(w,E,G){return w[0]=E[0]+G[0],w[1]=E[1]+G[1],w[2]=E[2]+G[2],w}},12455:(w,E,G)=>{w.exports=function(w,E){var G=P(w[0],w[1],w[2]),y=P(E[0],E[1],E[2]);h(G,G),h(y,y);var x=B(G,y);return x>1?0:Math.acos(x)};var P=G(12457),h=G(12466),B=G(12472)},12544:w=>{w.exports=function(w,E){return w[0]=Math.ceil(E[0]),w[1]=Math.ceil(E[1]),w[2]=Math.ceil(E[2]),w}},12449:w=>{w.exports=function(w){var E=new Float32Array(3);return E[0]=w[0],E[1]=w[1],E[2]=w[2],E}},12475:w=>{w.exports=function(w,E){return w[0]=E[0],w[1]=E[1],w[2]=E[2],w}},12447:w=>{w.exports=function(){var w=new Float32Array(3);return w[0]=0,w[1]=0,w[2]=0,w}},12621:w=>{w.exports=function(w,E,G){var P=E[0],h=E[1],B=E[2],y=G[0],x=G[1],U=G[2];return w[0]=h*U-B*x,w[1]=B*y-P*U,w[2]=P*x-h*y,w}},12567:(w,E,G)=>{w.exports=G(12562)},12562:w=>{w.exports=function(w,E){var G=E[0]-w[0],P=E[1]-w[1],h=E[2]-w[2];return Math.sqrt(G*G+P*P+h*h)}},12521:(w,E,G)=>{w.exports=G(12516)},12516:w=>{w.exports=function(w,E,G){return w[0]=E[0]/G[0],w[1]=E[1]/G[1],w[2]=E[2]/G[2],w}},12472:w=>{w.exports=function(w,E){return w[0]*E[0]+w[1]*E[1]+w[2]*E[2]}},12439:w=>{w.exports=1e-6},12484:(w,E,G)=>{w.exports=function(w,E){var G=w[0],h=w[1],B=w[2],y=E[0],x=E[1],U=E[2];return Math.abs(G-y)<=P*Math.max(1,Math.abs(G),Math.abs(y))&&Math.abs(h-x)<=P*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(B-U)<=P*Math.max(1,Math.abs(B),Math.abs(U))};var P=G(12439)},12488:w=>{w.exports=function(w,E){return w[0]===E[0]&&w[1]===E[1]&&w[2]===E[2]}},12537:w=>{w.exports=function(w,E){return w[0]=Math.floor(E[0]),w[1]=Math.floor(E[1]),w[2]=Math.floor(E[2]),w}},12667:(w,E,G)=>{w.exports=function(w,E,G,h,B,y){var x,U;E||(E=3);G||(G=0);U=h?Math.min(h*E+G,w.length):w.length;for(x=G;x<U;x+=E)P[0]=w[x],P[1]=w[x+1],P[2]=w[x+2],B(P,P,y),w[x]=P[0],w[x+1]=P[1],w[x+2]=P[2];return w};var P=G(12447)()},12457:w=>{w.exports=function(w,E,G){var P=new Float32Array(3);return P[0]=w,P[1]=E,P[2]=G,P}},12436:(w,E,G)=>{w.exports={EPSILON:G(12439),create:G(12447),clone:G(12449),angle:G(12455),xx:G(12457),k:G(12475),set:G(12480),equals:G(12484),exactEquals:G(12488),add:G(12490),cE:G(12498),sub:G(12502),multiply:G(12504),mul:G(12512),divide:G(12516),div:G(12521),min:G(12525),max:G(12533),floor:G(12537),ceil:G(12544),round:G(12550),scale:G(12554),Ux:G(12557),distance:G(12562),i:G(12567),squaredDistance:G(12572),sqrDist:G(12575),length:G(12581),len:G(12590),squaredLength:G(12598),lx:G(12603),negate:G(12608),inverse:G(12615),normalize:G(12466),dot:G(12472),cross:G(12621),hx:G(12627),random:G(12631),transformMat4:G(12636),transformMat3:G(12642),transformQuat:G(12645),ix:G(12647),Ox:G(12651),ux:G(12660),forEach:G(12667)}},12615:w=>{w.exports=function(w,E){return w[0]=1/E[0],w[1]=1/E[1],w[2]=1/E[2],w}},12590:(w,E,G)=>{w.exports=G(12581)},12581:w=>{w.exports=function(w){var E=w[0],G=w[1],P=w[2];return Math.sqrt(E*E+G*G+P*P)}},12627:w=>{w.exports=function(w,E,G,P){var h=E[0],B=E[1],y=E[2];return w[0]=h+P*(G[0]-h),w[1]=B+P*(G[1]-B),w[2]=y+P*(G[2]-y),w}},12533:w=>{w.exports=function(w,E,G){return w[0]=Math.max(E[0],G[0]),w[1]=Math.max(E[1],G[1]),w[2]=Math.max(E[2],G[2]),w}},12525:w=>{w.exports=function(w,E,G){return w[0]=Math.min(E[0],G[0]),w[1]=Math.min(E[1],G[1]),w[2]=Math.min(E[2],G[2]),w}},12512:(w,E,G)=>{w.exports=G(12504)},12504:w=>{w.exports=function(w,E,G){return w[0]=E[0]*G[0],w[1]=E[1]*G[1],w[2]=E[2]*G[2],w}},12608:w=>{w.exports=function(w,E){return w[0]=-E[0],w[1]=-E[1],w[2]=-E[2],w}},12466:w=>{w.exports=function(w,E){var G=E[0],P=E[1],h=E[2],B=G*G+P*P+h*h;B>0&&(B=1/Math.sqrt(B),w[0]=E[0]*B,w[1]=E[1]*B,w[2]=E[2]*B);return w}},12631:w=>{w.exports=function(w,E){E=E||1;var G=2*Math.random()*Math.PI,P=2*Math.random()-1,h=Math.sqrt(1-P*P)*E;return w[0]=Math.cos(G)*h,w[1]=Math.sin(G)*h,w[2]=P*E,w}},12647:w=>{w.exports=function(w,E,G,P){var h=G[1],B=G[2],y=E[1]-h,x=E[2]-B,U=Math.sin(P),l=Math.cos(P);return w[0]=E[0],w[1]=h+y*l-x*U,w[2]=B+y*U+x*l,w}},12651:w=>{w.exports=function(w,E,G,P){var h=G[0],B=G[2],y=E[0]-h,x=E[2]-B,U=Math.sin(P),l=Math.cos(P);return w[0]=h+x*U+y*l,w[1]=E[1],w[2]=B+x*l-y*U,w}},12660:w=>{w.exports=function(w,E,G,P){var h=G[0],B=G[1],y=E[0]-h,x=E[1]-B,U=Math.sin(P),l=Math.cos(P);return w[0]=h+y*l-x*U,w[1]=B+y*U+x*l,w[2]=E[2],w}},12550:w=>{w.exports=function(w,E){return w[0]=Math.round(E[0]),w[1]=Math.round(E[1]),w[2]=Math.round(E[2]),w}},12554:w=>{w.exports=function(w,E,G){return w[0]=E[0]*G,w[1]=E[1]*G,w[2]=E[2]*G,w}},12557:w=>{w.exports=function(w,E,G,P){return w[0]=E[0]+G[0]*P,w[1]=E[1]+G[1]*P,w[2]=E[2]+G[2]*P,w}},12480:w=>{w.exports=function(w,E,G,P){return w[0]=E,w[1]=G,w[2]=P,w}},12575:(w,E,G)=>{w.exports=G(12572)},12603:(w,E,G)=>{w.exports=G(12598)},12572:w=>{w.exports=function(w,E){var G=E[0]-w[0],P=E[1]-w[1],h=E[2]-w[2];return G*G+P*P+h*h}},12598:w=>{w.exports=function(w){var E=w[0],G=w[1],P=w[2];return E*E+G*G+P*P}},12502:(w,E,G)=>{w.exports=G(12498)},12498:w=>{w.exports=function(w,E,G){return w[0]=E[0]-G[0],w[1]=E[1]-G[1],w[2]=E[2]-G[2],w}},12642:w=>{w.exports=function(w,E,G){var P=E[0],h=E[1],B=E[2];return w[0]=P*G[0]+h*G[3]+B*G[6],w[1]=P*G[1]+h*G[4]+B*G[7],w[2]=P*G[2]+h*G[5]+B*G[8],w}},12636:w=>{w.exports=function(w,E,G){var P=E[0],h=E[1],B=E[2],y=G[3]*P+G[7]*h+G[11]*B+G[15];return y=y||1,w[0]=(G[0]*P+G[4]*h+G[8]*B+G[12])/y,w[1]=(G[1]*P+G[5]*h+G[9]*B+G[13])/y,w[2]=(G[2]*P+G[6]*h+G[10]*B+G[14])/y,w}},12645:w=>{w.exports=function(w,E,G){var P=E[0],h=E[1],B=E[2],y=G[0],x=G[1],U=G[2],l=G[3],i=l*P+x*B-U*h,O=l*h+U*P-y*B,u=l*B+y*h-x*P,V=-y*P-x*h-U*B;return w[0]=i*l+V*-y+O*-U-u*-x,w[1]=O*l+V*-x+u*-y-i*-U,w[2]=u*l+V*-U+i*-x-O*-y,w}},13503:w=>{"use strict";w.exports=function(w){for(var E=new Array(w),G=0;G<w;++G)E[G]=G;return E}},13582:w=>{w.exports=function(w){return null!=w&&null!=w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}},13773:(w,E,G)=>{"use strict";G.d(E,{e:()=>P});class P{constructor(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Li=!1,this.mi=!1,this.Hi=30,this.zi=0,this.wO=!1,this.fullscreen=!1,this.ri=function(w){},this.Yi=function(){},this.bi=function(){},this.Ph=function(){},this.Si=function(w){},this.onFullscreenChanged=function(w){},l((()=>{!function(w,E){w._nowObject=performance||Date,w._lastTick=0,w._renderAccum=0,w._rt=0,w._frameCB=x.bind(null,w),requestAnimationFrame(w._frameCB),E>0&&(w._intervalCB=y.bind(null,w),w._interval=setInterval(w._intervalCB,Math.max(E,1e3/w.Hi/2)))}(this,E),function(w,E){if(!E)return;var G=!1,P=!1;document.addEventListener("pointerlockchange",(P=>{G=document.pointerLockElement===E,w.Si(G)})),document.addEventListener("fullscreenchange",(G=>{P=document.fullscreenElement===E,w.onFullscreenChanged(P)})),Object.defineProperty(w,"wO",{get:()=>G,set:w=>{w&&!G?U(E):G&&!w&&function(w){w.exitPointerLock&&w.exitPointerLock()}(document)}}),Object.defineProperty(w,"fullscreen",{get:()=>P,set:w=>{w&&!P?E.requestFullscreen():P&&!w&&document.exitFullscreen()}}),E.addEventListener("click",(h=>{w.Li&&!G&&U(E),w.mi&&!P&&E.requestFullscreen()}));var h=()=>w.Ph();if(window.ResizeObserver){new ResizeObserver(h).observe(E)}else window.addEventListener("resize",h)}(this,w),this.bi()}))}}var h=3,B=20;function y(w){for(var E=1e3/w.Hi,G=w._nowObject.now()+B,P=0;w._nowObject.now()>=w._lastTick+E&&w._nowObject.now()<G&&++P<=h;)w.ri(E),w._lastTick+=E;var y=5*(E+5),x=w._nowObject.now();if(x-w._lastTick>y)for(;x>=w._lastTick+E;)w._lastTick+=E}function x(w){requestAnimationFrame(w._frameCB),y(w);var E=w._nowObject.now(),G=E-w._rt;if(w._rt=E,w.zi>0){w._renderAccum+=G;var P=1e3/w.zi;if(w._renderAccum<P)return;w._renderAccum=Math.min(w._renderAccum-P,P)}var h=1e3/w.Hi,B=(E-w._lastTick)/h;w.Yi(G,B,h)}function U(w){w.requestPointerLock&&w.requestPointerLock()}var l=w=>{if("loading"===document.readyState){var E=()=>{document.removeEventListener("readystatechange",E),w()};document.addEventListener("readystatechange",E)}else setTimeout(w,1)}},13496:(w,E,G)=>{var P=G(13503),h=G(13512),B="undefined"!==typeof Float64Array;function y(w,E){return w[0]-E[0]}function x(){var w,E=this.stride,G=new Array(E.length);for(w=0;w<G.length;++w)G[w]=[Math.abs(E[w]),w];G.sort(y);var P=new Array(G.length);for(w=0;w<P.length;++w)P[w]=G[w][1];return P}function U(w,E){var G=["View",E,"d",w].join("");E<0&&(G="View_Nil"+w);var h="generic"===w;if(-1===E){var B="function "+G+"(a){this.data=a;};var proto="+G+".prototype;proto.dtype='"+w+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+G+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+G+"(a){return new "+G+"(a);}";return new Function(B)()}if(0===E){B="function "+G+"(a,d) {this.data = a;this.offset = d};var proto="+G+".prototype;proto.dtype='"+w+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+G+"_copy() {return new "+G+"(this.data,this.offset)};proto.pick=function "+G+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+G+"_get(){return "+(h?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+G+"_set(v){return "+(h?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+G+"(a,b,c,d){return new "+G+"(a,d)}";return new Function("TrivialArray",B)(l[w][0])}B=["'use strict'"];var y=P(E),U=y.map((function(w){return"i"+w})),i="this.offset+"+y.map((function(w){return"this.stride["+w+"]*i"+w})).join("+"),O=y.map((function(w){return"b"+w})).join(","),u=y.map((function(w){return"c"+w})).join(",");B.push("function "+G+"(a,"+O+","+u+",d){this.data=a","this.shape=["+O+"]","this.stride=["+u+"]","this.offset=d|0}","var proto="+G+".prototype","proto.dtype='"+w+"'","proto.dimension="+E),B.push("Object.defineProperty(proto,'size',{get:function "+G+"_size(){return "+y.map((function(w){return"this.shape["+w+"]"})).join("*"),"}})"),1===E?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),E<4?(B.push("function "+G+"_order(){"),2===E?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+G+"_set("+U.join(",")+",v){"),h?B.push("return this.data.set("+i+",v)}"):B.push("return this.data["+i+"]=v}"),B.push("proto.get=function "+G+"_get("+U.join(",")+"){"),h?B.push("return this.data.get("+i+")}"):B.push("return this.data["+i+"]}"),B.push("proto.index=function "+G+"_index(",U.join(),"){return "+i+"}"),B.push("proto.hi=function "+G+"_hi("+U.join(",")+"){return new "+G+"(this.data,"+y.map((function(w){return["(typeof i",w,"!=='number'||i",w,"<0)?this.shape[",w,"]:i",w,"|0"].join("")})).join(",")+","+y.map((function(w){return"this.stride["+w+"]"})).join(",")+",this.offset)}");var V=y.map((function(w){return"a"+w+"=this.shape["+w+"]"})),a=y.map((function(w){return"c"+w+"=this.stride["+w+"]"}));B.push("proto.lo=function "+G+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+V.join(",")+","+a.join(","));for(var Q=0;Q<E;++Q)B.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){d=i"+Q+"|0;b+=c"+Q+"*d;a"+Q+"-=d}");B.push("return new "+G+"(this.data,"+y.map((function(w){return"a"+w})).join(",")+","+y.map((function(w){return"c"+w})).join(",")+",b)}"),B.push("proto.step=function "+G+"_step("+U.join(",")+"){var "+y.map((function(w){return"a"+w+"=this.shape["+w+"]"})).join(",")+","+y.map((function(w){return"b"+w+"=this.stride["+w+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Q=0;Q<E;++Q)B.push("if(typeof i"+Q+"==='number'){d=i"+Q+"|0;if(d<0){c+=b"+Q+"*(a"+Q+"-1);a"+Q+"=ceil(-a"+Q+"/d)}else{a"+Q+"=ceil(a"+Q+"/d)}b"+Q+"*=d}");B.push("return new "+G+"(this.data,"+y.map((function(w){return"a"+w})).join(",")+","+y.map((function(w){return"b"+w})).join(",")+",c)}");var c=new Array(E),Z=new Array(E);for(Q=0;Q<E;++Q)c[Q]="a[i"+Q+"]",Z[Q]="b[i"+Q+"]";B.push("proto.transpose=function "+G+"_transpose("+U+"){"+U.map((function(w,E){return w+"=("+w+"===undefined?"+E+":"+w+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+G+"(this.data,"+c.join(",")+","+Z.join(",")+",this.offset)}"),B.push("proto.pick=function "+G+"_pick("+U+"){var a=[],b=[],c=this.offset");for(Q=0;Q<E;++Q)B.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){c=(c+this.stride["+Q+"]*i"+Q+")|0}else{a.push(this.shape["+Q+"]);b.push(this.stride["+Q+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+G+"(data,shape,stride,offset){return new "+G+"(data,"+y.map((function(w){return"shape["+w+"]"})).join(",")+","+y.map((function(w){return"stride["+w+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(l[w],x)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};w.exports=function(w,E,G,P){if(void 0===w)return(0,l.array[0])([]);"number"===typeof w&&(w=[w]),void 0===E&&(E=[w.length]);var y=E.length;if(void 0===G){G=new Array(y);for(var x=y-1,i=1;x>=0;--x)G[x]=i,i*=E[x]}if(void 0===P){P=0;for(x=0;x<y;++x)G[x]<0&&(P-=(E[x]-1)*G[x])}for(var O=function(w){if(h(w))return"buffer";if(B)switch(Object.prototype.toString.call(w)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(w)?"array":"generic"}(w),u=l[O];u.length<=y+1;)u.push(U(O,u.length-1));return(0,u[y+1])(w,E,G,P)}},13512:w=>{function E(w){return!!w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}w.exports=function(w){return null!=w&&(E(w)||function(w){return"function"===typeof w.readFloatLE&&"function"===typeof w.slice&&E(w.slice(0,0))}(w)||!!w._isBuffer)}},13646:w=>{"use strict";var E=[],G=[],P=[],h=[],B=[],y=[],x=[],U=[],l=[],i=[],O=[],u=[];w.exports=function(w,V,a,Q,c,Z){for(var J=x,d=l,K=i,t=u,q=0;q<3;q++)J[q]=+a[q],K[q]=+V.max[q],d[q]=+V.base[q];Z||(Z=1e-10);var W=function(w,x,l,i,u,V){var a=E,Q=G,c=P,Z=h,J=B,d=y,K=U,t=Math.floor,q=0,W=0,T=0,I=0,j=0;if(g(),0===T)return 0;for(I=k();W<=T;){if(o(I)&&f())return q;I=k()}for(q+=T,j=0;j<3;j++)i[j]+=l[j],u[j]+=l[j];return q;function g(){if(W=0,0!==(T=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])))for(var w=0;w<3;w++){var E=l[w]>=0;Z[w]=E?1:-1;var G=E?u[w]:i[w];a[w]=E?i[w]:u[w],Q[w]=N(G,Z[w]),c[w]=v(a[w],Z[w]),K[w]=l[w]/T,J[w]=Math.abs(1/K[w]);var P=E?Q[w]+1-G:G-Q[w];d[w]=J[w]<1/0?J[w]*P:1/0}}function o(E){for(var G=Z[0],P=0===E?Q[0]:c[0],h=Q[0]+G,B=Z[1],y=1===E?Q[1]:c[1],x=Q[1]+B,U=Z[2],l=2===E?Q[2]:c[2],i=Q[2]+U,O=P;O!=h;O+=G)for(var u=y;u!=x;u+=B)for(var V=l;V!=i;V+=U)if(w(O,u,V))return!0;return!1}function f(){q+=W;var w=Z[I],E=W/T,G=O;for(j=0;j<3;j++){var P=l[j]*E;i[j]+=P,u[j]+=P,G[j]=l[j]-P}if(w>0?u[I]=Math.round(u[I]):i[I]=Math.round(i[I]),x(q,I,w,G))return!0;for(j=0;j<3;j++)l[j]=G[j];return g(),0===T}function k(){var w=d[0]<d[1]?d[0]<d[2]?0:2:d[1]<d[2]?1:2,E=d[w]-W;for(W=d[w],Q[w]+=Z[w],d[w]+=J[w],j=0;j<3;j++)a[j]+=E*K[j],c[j]=v(a[j],Z[j]);return w}function N(w,E){return t(w-E*V)}function v(w,E){return t(w+E*V)}}(w,Q,J,d,K,Z);if(!c){for(q=0;q<3;q++)t[q]=a[q]>0?K[q]-V.max[q]:d[q]-V.base[q];V.translate(t)}return W}},13804:(w,E,G)=>{"use strict";G.d(E,{b:()=>O});var P=G(13639),h=G(12436);class B{constructor(w,E,G,B,y,x,U){this.el=new P(w.base,w.hi),this.jh=E,this.friction=G,this.restitution=B,this.Xy=y,this.JV=x,this.by=!!U,this.Pi=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Ba=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Ql=h.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=h.create(),this._impulses=h.create(),this._sleepFrameCount=10}loadFromCopy(w){h.k(this.el.base,w.el.base),h.k(this.el.hi,w.el.hi),h.k(this.el.max,w.el.max),this.el.mag=w.el.mag,this.jh=w.jh,this.friction=w.friction,this.restitution=w.restitution,this.Xy=w.Xy,this.JV=w.JV,this.by=w.by,this.Pi=w.Pi,this.fluidDrag=w.fluidDrag,this.Ba=w.Ba,this.preventFallOffEdge=w.preventFallOffEdge,this.rolledBackLastTick=w.rolledBackLastTick,h.k(this.Ql,w.Ql),h.k(this.resting,w.resting),this.inFluid=w.inFluid,this._ratioInFluid=w._ratioInFluid,h.k(this._forces,w._forces),h.k(this._impulses,w._impulses),this._sleepFrameCount=w._sleepFrameCount}setPosition(w){y(w),h.cE(w,w,this.el.base),this.el.translate(w),this.Jl()}xh(){return h.clone(this.el.base)}applyForce(w){y(w),h.add(this._forces,this._forces,w),this.Jl()}applyImpulse(w){y(w),h.add(this._impulses,this._impulses,w),this.Jl()}Jl(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var y=w=>{};var x=G(13639),U=G(12436),l=G(13646);function i(){this.Pi=.1,this.fluidDrag=.4,this.Px=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function O(w,E,G){w=Object.assign(new i,w),this.gravity=w.gravity||[0,-10,0],this.Pi=w.Pi||.1,this.Px=w.Px||2,this.fluidDrag=w.fluidDrag||.4,this.minBounceImpulse=w.minBounceImpulse,this.bodies=[],this.Ru=w.Ru,this.testSolid=E,this.testFluid=G}O.prototype.IV=function(w,E,G,P,h,y){w=w||new x([0,0,0],[1,1,1]),"undefined"==typeof E&&(E=1),"undefined"==typeof G&&(G=1),"undefined"==typeof P&&(P=0),"undefined"==typeof h&&(h=1);var U=new B(w,E,G,P,h,y);return this.bodies.push(U),U},O.prototype.jV=function(w){var E=this.bodies.indexOf(w);E<0||(this.bodies.splice(E,1),w.el=w.JV=null)};var u=U.create(),V=U.create(),a=U.create(),Q=U.create(),c=U.create(),Z=U.create(),J=U.create(),d=new x([0,0,0],[1,1,1]),K=new B(d,1,1,0,1,(()=>{}),!1);function t(w,E,G){return E=G,E*=1-(1-w.ratioInFluid)**2}O.prototype.Jx=function(w){w/=1e3;var E=p(0,U.squaredLength(this.gravity));this.bodies.forEach((G=>function(w,E,G,P){U.k(c,E.resting),w.Ru&&K.loadFromCopy(E);if(E.jh<=0)return U.set(E.Ql,0,0,0),U.set(E._forces,0,0,0),void U.set(E._impulses,0,0,0);var h=P||0===E.Xy;if(function(w,E,G,P){if(E._sleepFrameCount>0)return!1;if(P)return!0;var h=!1,B=.5*G*G*E.Xy;return U.scale(M,w.gravity,B),l(w.testSolid,E.el,M,(function(){return h=!0,!0}),!0),h}(w,E,G,h))return;E._sleepFrameCount--,function(w,E){var G=E.el,P=Math.floor(G.base[0]),h=Math.floor(G.base[2]),B=Math.floor(G.base[1]),y=Math.floor(G.max[1]);if(!w.testFluid(P,B,h))return E.inFluid=!1,void(E.ratioInFluid=0);var x=1,l=B+1;for(;l<=y&&w.testFluid(P,l,h);)x++,l++;var i=(B+x-G.base[1])/G.hi[1];i>1&&(i=1);var O=G.hi[0]*G.hi[1]*G.hi[2]*i,u=W;U.scale(u,w.gravity,-w.Px*O*E.Xy),E.applyForce(u),E.inFluid=!0,E.ratioInFluid=i}(w,E),e(E._forces),e(E._impulses),e(E.Ql),e(E.resting),U.scale(u,E._forces,1/E.jh),U.Ux(u,u,w.gravity,E.Xy),U.scale(V,E._impulses,1/E.jh),U.Ux(V,V,u,G),U.add(E.Ql,E.Ql,V),E.friction&&(T(w,0,E,V,G),T(w,1,E,V,G),T(w,2,E,V,G));var B=E.fluidDrag>=0?E.fluidDrag:w.fluidDrag,y=E.Pi>=0?E.Pi:w.Pi,x=y,i=y;E.inFluid&&(x=t(E,x,E.fluidDragHoriz>=0?E.fluidDragHoriz:B),i=t(E,i,E.fluidDragVert>=0?E.fluidDragVert:B));x=Math.max(1-x*G/E.jh,0),i=Math.max(1-i*G/E.jh,0),U.set(q,x,i,x),U.multiply(E.Ql,E.Ql,q),U.scale(a,E.Ql,G),U.set(E._forces,0,0,0),U.set(E._impulses,0,0,0),E.by&&D(g,E.el);U.k(Z,a),U.set(J,0,0,0),E.preventFallOffEdge&&function(w,E,G,P){if(!E.resting[1]||G[1]>0)return;var h=C;D(h,E.el);for(var B=0;B<3;B+=2){U.set(v,0,0,0),v[B]=G[B];var y=!0;(y=(y=(y=(y=y&&!F(w,h.base[0]+v[0]+1e-5,h.base[1],h.base[2]+v[2]+1e-5))&&!F(w,h.max[0]+v[0]-1e-5,h.base[1],h.base[2]+v[2]+1e-5))&&!F(w,h.base[0]+v[0]+1e-5,h.base[1],h.max[2]+v[2]-1e-5))&&!F(w,h.max[0]+v[0]-1e-5,h.base[1],h.max[2]+v[2]-1e-5))?(P[B]=G[B]>0?1:-1,G[B]=0):0===B&&(U.set(s,G[0],0,0),j(w,h,s,P,E.slideOnCollision))}}(w,E,a,J);j(w,E.el,a,E.resting,E.slideOnCollision),E.by&&function(w,E,G,P){if(E.resting[1]>=0&&!E.inFluid)return;var h=0!==E.resting[0],B=0!==E.resting[2];if(!h&&!B)return;var y=Math.abs(P[0]/P[2]),x=4;if(!h&&y>x)return;if(!B&&y<1/x)return;U.add(f,G.base,P);var i=w.testSolid;l(i,G,P,(function(w,E,G,P){if(1!==E)return!0;P[E]=0}));var O=G.base[1],u=E.inFluid?1.951:1.001,V=Math.floor(O+u)-O;U.set(k,0,V,0);var a=!1;if(l(i,G,k,(function(w,E,G,P){return a=!0,!0})),a)return;U.cE(N,f,G.base),N[1]=0,j(w,G,N,o,!0);var Q=p(G.base[0],f[0]),c=p(G.base[2],f[2]);if(h&&!Q&&(!c||!B))return;if(B&&(!Q||!h)&&!c)return;var Z=!0;if(Z=Z&&!F(w,G.base[0]+1e-5,G.base[1],G.base[2]+1e-5),Z=Z&&!F(w,G.max[0]-1e-5,G.base[1],G.base[2]+1e-5),Z=Z&&!F(w,G.base[0]+1e-5,G.base[1],G.max[2]-1e-5),Z=Z&&!F(w,G.max[0]-1e-5,G.base[1],G.max[2]-1e-5),Z)return;D(E.el,G),E.resting[0]=o[0],E.resting[2]=o[2],E.Ba&&E.Ba()}(w,E,g,Z);for(var O=0;O<3;++O)E.resting[O]=E.resting[O]||J[O],Q[O]=0,E.resting[O]&&(c[O]||(Q[O]=-E.Ql[O]),E.Ql[O]=0);var d=U.length(Q);d>.001&&(U.scale(Q,Q,E.jh),E.JV&&E.JV(Q),E.restitution>0&&d>w.minBounceImpulse&&(U.scale(Q,Q,E.restitution),E.applyImpulse(Q)));var I=U.squaredLength(E.Ql);I>1e-5&&E.Jl();w.Ru&&w.Ru(E)?(E.loadFromCopy(K),E.rolledBackLastTick=!0):E.rolledBackLastTick=!1}(this,G,w,E)))};var q=U.create([0,0,0]);var W=U.create();function T(w,E,G,P,h){var B=G.resting[E],y=P[E];if(!G.alwaysApplyHorizFriction||1!==E){if(0===B)return;if(B*y<=0)return}U.k(I,G.Ql),I[E]=0;var x=U.length(I);if(!p(x,0)){var l=Math.abs(G.friction*w.gravity[E]*h),i=x>l?(x-l)/x:0;G.Ql[(E+1)%3]*=i,G.Ql[(E+2)%3]*=i}}var I=U.create();function j(w,E,G,P,h){return U.set(P,0,0,0),l(w.testSolid,E,G,(function(w,E,G,B){P[E]=G,B[E]=0,h||(B[0]=0,B[1]=0,B[2]=0)}))}var g=new x([],[]),o=U.create(),f=U.create(),k=U.create(),N=U.create();var v=U.create(),C=new x([],[]),s=U.create();function F(w,E,G,P){return w.testSolid(Math.floor(E),Math.floor(G-1),Math.floor(P))}var M=U.create();function p(w,E){return Math.abs(w-E)<1e-5}function D(w,E){for(var G=0;G<3;G++)w.base[G]=E.base[G],w.max[G]=E.max[G],w.hi[G]=E.hi[G]}var e=function(w){}},12326:function(w,E){!function(w){"use strict";var E=function(w,G){return E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,E){w.__proto__=E}||function(w,E){for(var G in E)Object.prototype.hasOwnProperty.call(E,G)&&(w[G]=E[G])},E(w,G)};function G(w,G){if("function"!==typeof G&&null!==G)throw new TypeError("Class extends value "+String(G)+" is not a constructor or null");function P(){this.constructor=w}E(w,G),w.prototype=null===G?Object.create(G):(P.prototype=G.prototype,new P)}function P(w,E,G,P){var h,B=arguments.length,y=B<3?E:null===P?P=Object.getOwnPropertyDescriptor(E,G):P;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)y=Reflect.decorate(w,E,G,P);else for(var x=w.length-1;x>=0;x--)(h=w[x])&&(y=(B<3?h(y):B>3?h(E,G,y):h(E,G))||y);return B>3&&y&&Object.defineProperty(E,G,y),y}function h(w,E,G){if(G||2===arguments.length)for(var P,h=0,B=E.length;h<B;h++)!P&&h in E||(P||(P=Array.prototype.slice.call(E,0,h)),P[h]=E[h]);return w.concat(P||Array.prototype.slice.call(E))}var B,y=255,x=213;w.OPERATION=void 0,(B=w.OPERATION||(w.OPERATION={}))[B.ADD=128]="ADD",B[B.REPLACE=0]="REPLACE",B[B.DELETE=64]="DELETE",B[B.DELETE_AND_ADD=192]="DELETE_AND_ADD",B[B.TOUCH=1]="TOUCH",B[B.CLEAR=10]="CLEAR";var U=function(){function E(w,E,G){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=w,this.setParent(E,G)}return E.prototype.setParent=function(w,E,G){var P=this;if(this.indexes||(this.indexes=this.ref instanceof Nw?this.ref._definition.indexes:{}),this.parent=w,this.parentIndex=G,E)if(this.root=E,this.ref instanceof Nw){var h=this.ref._definition;for(var B in h.schema){var y=this.ref[B];if(y&&y.$changes){var x=h.indexes[B];y.$changes.setParent(this.ref,E,x)}}}else"object"===typeof this.ref&&this.ref.forEach((function(w,E){if(w instanceof Nw){var G=w.$changes,h=P.ref.$changes.indexes[E];G.setParent(P.ref,P.root,h)}}))},E.prototype.operation=function(w){this.changes.set(--this.currentCustomOperation,w)},E.prototype.change=function(E,G){void 0===G&&(G=w.OPERATION.ADD);var P="number"===typeof E?E:this.indexes[E];this.assertValidIndex(P,E);var h=this.changes.get(P);h&&h.op!==w.OPERATION.DELETE&&h.op!==w.OPERATION.TOUCH||this.changes.set(P,{op:h&&h.op===w.OPERATION.DELETE?w.OPERATION.DELETE_AND_ADD:G,index:P}),this.allChanges.add(P),this.changed=!0,this.touchParents()},E.prototype.touch=function(E){var G="number"===typeof E?E:this.indexes[E];this.assertValidIndex(G,E),this.changes.has(G)||this.changes.set(G,{op:w.OPERATION.TOUCH,index:G}),this.allChanges.add(G),this.touchParents()},E.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},E.prototype.getType=function(w){if(this.ref._definition)return(E=this.ref._definition).schema[E.fieldsByIndex[w]];var E,G=(E=this.parent._definition).schema[E.fieldsByIndex[this.parentIndex]];return Object.values(G)[0]},E.prototype.getChildrenFilter=function(){var w=this.parent._definition.childFilters;return w&&w[this.parentIndex]},E.prototype.getValue=function(w){return this.ref.getByIndex(w)},E.prototype.delete=function(E){var G="number"===typeof E?E:this.indexes[E];if(void 0!==G){var P=this.getValue(G);this.changes.set(G,{op:w.OPERATION.DELETE,index:G}),this.allChanges.delete(G),delete this.caches[G],P&&P.$changes&&(P.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(E," (").concat(G,")"))},E.prototype.discard=function(E,G){var P=this;void 0===E&&(E=!1),void 0===G&&(G=!1),this.ref instanceof Nw||this.changes.forEach((function(E){if(E.op===w.OPERATION.DELETE){var G=P.ref.getIndex(E.index);delete P.indexes[G]}})),this.changes.clear(),this.changed=E,G&&this.allChanges.clear(),this.currentCustomOperation=0},E.prototype.discardAll=function(){var w=this;this.changes.forEach((function(E){var G=w.getValue(E.index);G&&G.$changes&&G.$changes.discardAll()})),this.discard()},E.prototype.cache=function(w,E){this.caches[w]=E},E.prototype.clone=function(){return new E(this.ref,this.parent,this.root)},E.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},E.prototype.assertValidIndex=function(w,E){if(void 0===w)throw new Error('ChangeTree: missing index for field "'.concat(E,'"'))},E}();function l(w,E,G,P){return w[E]||(w[E]=[]),w[E].push(G),null===P||void 0===P||P.forEach((function(w,E){return G(w,E)})),function(){return O(w[E],w[E].indexOf(G))}}function i(E){var G=this,P="string"!==typeof this.$changes.getType();this.$items.forEach((function(h,B){E.push({refId:G.$changes.refId,op:w.OPERATION.DELETE,field:B,value:void 0,previousValue:h}),P&&G.$changes.root.removeRef(h.$changes.refId)}))}function O(w,E){if(-1===E||E>=w.length)return!1;for(var G=w.length-1,P=E;P<G;P++)w[P]=w[P+1];return w.length=G,!0}var u=function(w,E){var G=w.toString(),P=E.toString();return G<P?-1:G>P?1:0};function V(w){return w.$proxy=!0,w=new Proxy(w,{get:function(w,E){return"symbol"===typeof E||isNaN(E)?w[E]:w.at(E)},set:function(w,E,G){if("symbol"===typeof E||isNaN(E))w[E]=G;else{var P=Array.from(w.$items.keys()),h=parseInt(P[E]||E);void 0===G||null===G?w.deleteAt(h):w.setAt(h,G)}return!0},deleteProperty:function(w,E){return"number"===typeof E?w.deleteAt(E):delete w[E],!0}})}var a=function(){function E(){for(var w=[],E=0;E<arguments.length;E++)w[E]=arguments[E];this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,w)}return E.prototype.Mx=function(E,G){return void 0===G&&(G=!0),l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,E,G?this.$items:void 0)},E.prototype.Gh=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,E)},E.is=function(w){return Array.isArray(w)||void 0!==w.array},Object.defineProperty(E.prototype,"length",{get:function(){return this.$items.size},set:function(w){0===w?this.clear():this.splice(w,this.length-w)},enumerable:!1,configurable:!0}),E.prototype.push=function(){for(var w,E=this,G=[],P=0;P<arguments.length;P++)G[P]=arguments[P];return G.forEach((function(G){w=E.$refId++,E.setAt(w,G)})),w},E.prototype.pop=function(){var w=Array.from(this.$indexes.values()).pop();if(void 0!==w){this.$changes.delete(w),this.$indexes.delete(w);var E=this.$items.get(w);return this.$items.delete(w),E}},E.prototype.at=function(w){var E=Array.from(this.$items.keys())[w];return this.$items.get(E)},E.prototype.setAt=function(E,G){var P,h;if(void 0!==G&&null!==G){if(this.$items.get(E)!==G){void 0!==G.$changes&&G.$changes.setParent(this,this.$changes.root,E);var B=null!==(h=null===(P=this.$changes.indexes[E])||void 0===P?void 0:P.op)&&void 0!==h?h:w.OPERATION.ADD;this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,G),this.$changes.change(E,B)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},E.prototype.deleteAt=function(w){var E=Array.from(this.$items.keys())[w];return void 0!==E&&this.$deleteAt(E)},E.prototype.$deleteAt=function(w){return this.$changes.delete(w),this.$indexes.delete(w),this.$items.delete(w)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&i.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.concat=function(){for(var w,G=[],P=0;P<arguments.length;P++)G[P]=arguments[P];return new(E.bind.apply(E,h([void 0],(w=Array.from(this.$items.values())).concat.apply(w,G),!1)))},E.prototype.join=function(w){return Array.from(this.$items.values()).join(w)},E.prototype.reverse=function(){var w=this,E=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(G,P){w.setAt(E[P],G)})),this},E.prototype.shift=function(){var w=Array.from(this.$items.keys()).shift();if(void 0!==w){var E=this.$items.get(w);return this.$deleteAt(w),E}},E.prototype.slice=function(w,G){var P=new E;return P.push.apply(P,Array.from(this.$items.values()).slice(w,G)),P},E.prototype.sort=function(w){var E=this;void 0===w&&(w=u);var G=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(w).forEach((function(w,P){E.setAt(G[P],w)})),this},E.prototype.splice=function(w,E){void 0===E&&(E=this.length-w);for(var G=Array.from(this.$items.keys()),P=[],h=w;h<w+E;h++)P.push(this.$items.get(G[h])),this.$deleteAt(G[h]);return P},E.prototype.unshift=function(){for(var w=this,E=[],G=0;G<arguments.length;G++)E[G]=arguments[G];var P=this.length,h=E.length,B=Array.from(this.$items.values());return E.forEach((function(E,G){w.setAt(G,E)})),B.forEach((function(E,G){w.setAt(h+G,E)})),P+h},E.prototype.indexOf=function(w,E){return Array.from(this.$items.values()).indexOf(w,E)},E.prototype.lastIndexOf=function(w,E){return void 0===E&&(E=this.length-1),Array.from(this.$items.values()).lastIndexOf(w,E)},E.prototype.every=function(w,E){return Array.from(this.$items.values()).every(w,E)},E.prototype.some=function(w,E){return Array.from(this.$items.values()).some(w,E)},E.prototype.forEach=function(w,E){Array.from(this.$items.values()).forEach(w,E)},E.prototype.map=function(w,E){return Array.from(this.$items.values()).map(w,E)},E.prototype.filter=function(w,E){return Array.from(this.$items.values()).filter(w,E)},E.prototype.reduce=function(w,E){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},E.prototype.reduceRight=function(w,E){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},E.prototype.find=function(w,E){return Array.from(this.$items.values()).find(w,E)},E.prototype.findIndex=function(w,E){return Array.from(this.$items.values()).findIndex(w,E)},E.prototype.fill=function(w,E,G){throw new Error("ArraySchema#fill() not implemented")},E.prototype.copyWithin=function(w,E,G){throw new Error("ArraySchema#copyWithin() not implemented")},E.prototype.toString=function(){return this.$items.toString()},E.prototype.toLocaleString=function(){return this.$items.toLocaleString()},E.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},E.prototype.includes=function(w,E){return Array.from(this.$items.values()).includes(w,E)},E.prototype.flatMap=function(w,E){throw new Error("ArraySchema#flatMap() is not supported.")},E.prototype.flat=function(w){throw new Error("ArraySchema#flat() is not supported.")},E.prototype.findLast=function(){var w=Array.from(this.$items.values());return w.findLast.apply(w,arguments)},E.prototype.findLastIndex=function(){var w=Array.from(this.$items.values());return w.findLastIndex.apply(w,arguments)},E.prototype.setIndex=function(w,E){this.$indexes.set(w,E)},E.prototype.getIndex=function(w){return this.$indexes.get(w)},E.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},E.prototype.deleteByIndex=function(w){var E=this.$indexes.get(w);this.$items.delete(E),this.$indexes.delete(w)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){return this.toArray().map((function(w){return"function"===typeof w.toJSON?w.toJSON():w}))},E.prototype.clone=function(w){return w?new(E.bind.apply(E,h([void 0],Array.from(this.$items.values()),!1))):new(E.bind.apply(E,h([void 0],this.map((function(w){return w.$changes?w.clone():w})),!1)))},E}();function Q(w){return w.$proxy=!0,w=new Proxy(w,{get:function(w,E){return"symbol"!==typeof E&&"undefined"===typeof w[E]?w.get(E):w[E]},set:function(w,E,G){return"symbol"!==typeof E&&-1===E.indexOf("$")&&"Mx"!==E&&"Gh"!==E&&"onChange"!==E?w.set(E,G):w[E]=G,!0},deleteProperty:function(w,E){return w.delete(E),!0}})}var c=function(){function E(w){var G=this;if(this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w)if(w instanceof Map||w instanceof E)w.forEach((function(w,E){return G.set(E,w)}));else for(var P in w)this.set(P,w[P])}return E.prototype.Mx=function(E,G){return void 0===G&&(G=!0),l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,E,G?this.$items:void 0)},E.prototype.Gh=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,E)},E.is=function(w){return void 0!==w.map},E.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(E.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.set=function(E,G){if(void 0===G||null===G)throw new Error("MapSchema#set('".concat(E,"', ").concat(G,"): trying to set ").concat(G," value on '").concat(E,"'."));E=E.toString();var P="undefined"!==typeof this.$changes.indexes[E],h=P?this.$changes.indexes[E]:this.$refId++,B=P?w.OPERATION.REPLACE:w.OPERATION.ADD,y=void 0!==G.$changes;if(y&&G.$changes.setParent(this,this.$changes.root,h),P){if(!y&&this.$items.get(E)===G)return;y&&this.$items.get(E)!==G&&(B=w.OPERATION.ADD)}else this.$changes.indexes[E]=h,this.$indexes.set(h,E);return this.$items.set(E,G),this.$changes.change(E,B),this},E.prototype.get=function(w){return this.$items.get(w)},E.prototype.delete=function(w){return this.$changes.delete(w),this.$items.delete(w)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&i.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(w){return this.$items.has(w)},E.prototype.forEach=function(w){this.$items.forEach(w)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(w,E){this.$indexes.set(w,E)},E.prototype.getIndex=function(w){return this.$indexes.get(w)},E.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},E.prototype.deleteByIndex=function(w){var E=this.$indexes.get(w);this.$items.delete(E),this.$indexes.delete(w)},E.prototype.toJSON=function(){var w={};return this.forEach((function(E,G){w[G]="function"===typeof E.toJSON?E.toJSON():E})),w},E.prototype.clone=function(w){var G;return w?G=Object.assign(new E,this):(G=new E,this.forEach((function(w,E){w.$changes?G.set(E,w.clone()):G.set(E,w)}))),G},E}(),Z={};function J(w,E){Z[w]=E}function d(w){return Z[w]}var K=function(){function w(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return w.create=function(E){var G=new w;return G.schema=Object.assign({},E&&E.schema||{}),G.indexes=Object.assign({},E&&E.indexes||{}),G.fieldsByIndex=Object.assign({},E&&E.fieldsByIndex||{}),G.descriptors=Object.assign({},E&&E.descriptors||{}),G.deprecated=Object.assign({},E&&E.deprecated||{}),G},w.prototype.addField=function(w,E){var G=this.getNextFieldIndex();this.fieldsByIndex[G]=w,this.indexes[w]=G,this.schema[w]=Array.isArray(E)?{array:E[0]}:E},w.prototype.hasField=function(w){return void 0!==this.indexes[w]},w.prototype.addFilter=function(w,E){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[w]]=E,this.indexesWithFilters.push(this.indexes[w]),!0},w.prototype.addChildrenFilter=function(w,E){var G=this.indexes[w],P=this.schema[w];if(d(Object.keys(P)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[G]=E,!0;console.warn("@filterChildren: field '".concat(w,"' can't have children. Ignoring filter."))},w.prototype.getChildrenFilter=function(w){return this.childFilters&&this.childFilters[this.indexes[w]]},w.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},w}();function t(w){return w._context&&w._context.useFilters}var q=function(){function w(){this.types={},this.schemas=new Map,this.useFilters=!1}return w.prototype.has=function(w){return this.schemas.has(w)},w.prototype.get=function(w){return this.types[w]},w.prototype.add=function(w,E){void 0===E&&(E=this.schemas.size),w._definition=K.create(w._definition),w._typeid=E,this.types[E]=w,this.schemas.set(w,E)},w.create=function(E){return void 0===E&&(E={}),function(G){return E.context||(E.context=new w),T(G,E)}},w}(),W=new q;function T(w,E){return void 0===E&&(E={}),function(G,P){var B=E.context||W,y=G.constructor;if(y._context=B,!w)throw new Error("".concat(y.name,': @type() reference provided for "').concat(P,"\" is undefined. Make sure you don't have any circular dependencies."));B.has(y)||B.add(y);var x=y._definition;if(x.addField(P,w),x.descriptors[P]){if(x.deprecated[P])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(P,"' definition on '").concat(y.name,"'.\nCheck @type() annotation"))}catch(Z){var U=Z.stack.split("\n")[4].trim();throw new Error("".concat(Z.message," ").concat(U))}}var l=a.is(w),i=!l&&c.is(w);if("string"!==typeof w&&!Nw.is(w)){var O=Object.values(w)[0];"string"===typeof O||B.has(O)||B.add(O)}if(E.manual)x.descriptors[P]={enumerable:!0,configurable:!0,writable:!0};else{var u="_".concat(P);x.descriptors[u]={enumerable:!1,configurable:!1,writable:!0},x.descriptors[P]={get:function(){return this[u]},set:function(w){w!==this[u]&&(void 0!==w&&null!==w?(!l||w instanceof a||(w=new(a.bind.apply(a,h([void 0],w,!1)))),!i||w instanceof c||(w=new c(w)),void 0===w.$proxy&&(i?w=Q(w):l&&(w=V(w))),this.$changes.change(P),w.$changes&&w.$changes.setParent(this,this.$changes.root,this._definition.indexes[P])):this[u]&&this.$changes.delete(P),this[u]=w)},enumerable:!0,configurable:!0}}}}function I(w){return function(E,G){var P=E.constructor;P._definition.addFilter(G,w)&&(P._context.useFilters=!0)}}function j(w){return function(E,G){var P=E.constructor;P._definition.addChildrenFilter(G,w)&&(P._context.useFilters=!0)}}function g(w){return void 0===w&&(w=!0),function(E,G){var P=E.constructor._definition;P.deprecated[G]=!0,w&&(P.descriptors[G]={get:function(){throw new Error("".concat(G," is deprecated."))},set:function(w){},enumerable:!1,configurable:!0})}}function o(w,E,G){for(var P in void 0===G&&(G={}),G.context||(G.context=w._context||G.context||W),E)T(E[P],G)(w.prototype,P);return w}function f(w){for(var E=0,G=0,P=0,h=w.length;P<h;P++)(E=w.charCodeAt(P))<128?G+=1:E<2048?G+=2:E<55296||E>=57344?G+=3:(P++,G+=4);return G}function k(w,E,G){for(var P=0,h=0,B=G.length;h<B;h++)(P=G.charCodeAt(h))<128?w[E++]=P:P<2048?(w[E++]=192|P>>6,w[E++]=128|63&P):P<55296||P>=57344?(w[E++]=224|P>>12,w[E++]=128|P>>6&63,w[E++]=128|63&P):(h++,P=65536+((1023&P)<<10|1023&G.charCodeAt(h)),w[E++]=240|P>>18,w[E++]=128|P>>12&63,w[E++]=128|P>>6&63,w[E++]=128|63&P)}function N(w,E){w.push(255&E)}function v(w,E){w.push(255&E)}function C(w,E){w.push(255&E),w.push(E>>8&255)}function s(w,E){w.push(255&E),w.push(E>>8&255)}function F(w,E){w.push(255&E),w.push(E>>8&255),w.push(E>>16&255),w.push(E>>24&255)}function M(w,E){var G=E>>24,P=E>>16,h=E>>8,B=E;w.push(255&B),w.push(255&h),w.push(255&P),w.push(255&G)}function p(w,E){var G=Math.floor(E/Math.pow(2,32));M(w,E>>>0),M(w,G)}function D(w,E){var G=E/Math.pow(2,32)|0;M(w,E>>>0),M(w,G)}function e(w,E){m(w,E)}function R(w,E){n(w,E)}var H=new Int32Array(2),z=new Float32Array(H.buffer),L=new Float64Array(H.buffer);function m(w,E){z[0]=E,F(w,H[0])}function n(w,E){L[0]=E,F(w,H[0]),F(w,H[1])}function r(w,E){return v(w,E?1:0)}function Y(w,E){E||(E="");var G=f(E),P=0;if(G<32)w.push(160|G),P=1;else if(G<256)w.push(217),v(w,G),P=2;else if(G<65536)w.push(218),s(w,G),P=3;else{if(!(G<4294967296))throw new Error("String too long");w.push(219),M(w,G),P=5}return k(w,w.length,E),P+G}function S(w,E){return isNaN(E)?S(w,0):isFinite(E)?E!==(0|E)?(w.push(203),n(w,E),9):E>=0?E<128?(v(w,E),1):E<256?(w.push(204),v(w,E),2):E<65536?(w.push(205),s(w,E),3):E<4294967296?(w.push(206),M(w,E),5):(w.push(207),D(w,E),9):E>=-32?(w.push(224|E+32),1):E>=-128?(w.push(208),N(w,E),2):E>=-32768?(w.push(209),C(w,E),3):E>=-2147483648?(w.push(210),F(w,E),5):(w.push(211),p(w,E),9):S(w,E>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var X=Object.freeze({__proto__:null,utf8Write:k,int8:N,uint8:v,int16:C,uint16:s,int32:F,uint32:M,int64:p,uint64:D,float32:e,float64:R,writeFloat32:m,writeFloat64:n,boolean:r,string:Y,number:S});function b(w,E,G){for(var P="",h=0,B=E,y=E+G;B<y;B++){var x=w[B];0!==(128&x)?192!==(224&x)?224!==(240&x)?240!==(248&x)?console.error("Invalid byte "+x.toString(16)):(h=(7&x)<<18|(63&w[++B])<<12|(63&w[++B])<<6|63&w[++B])>=65536?(h-=65536,P+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):P+=String.fromCharCode(h):P+=String.fromCharCode((15&x)<<12|(63&w[++B])<<6|63&w[++B]):P+=String.fromCharCode((31&x)<<6|63&w[++B]):P+=String.fromCharCode(x)}return P}function A(w,E){return ww(w,E)<<24>>24}function ww(w,E){return w[E.offset++]}function Ew(w,E){return Gw(w,E)<<16>>16}function Gw(w,E){return w[E.offset++]|w[E.offset++]<<8}function Pw(w,E){return w[E.offset++]|w[E.offset++]<<8|w[E.offset++]<<16|w[E.offset++]<<24}function hw(w,E){return Pw(w,E)>>>0}function Bw(w,E){return uw(w,E)}function yw(w,E){return Vw(w,E)}function xw(w,E){var G=hw(w,E);return Pw(w,E)*Math.pow(2,32)+G}function Uw(w,E){var G=hw(w,E);return hw(w,E)*Math.pow(2,32)+G}var lw=new Int32Array(2),iw=new Float32Array(lw.buffer),Ow=new Float64Array(lw.buffer);function uw(w,E){return lw[0]=Pw(w,E),iw[0]}function Vw(w,E){return lw[0]=Pw(w,E),lw[1]=Pw(w,E),Ow[0]}function aw(w,E){return ww(w,E)>0}function Qw(w,E){var G,P=w[E.offset++];P<192?G=31&P:217===P?G=ww(w,E):218===P?G=Gw(w,E):219===P&&(G=hw(w,E));var h=b(w,E.offset,G);return E.offset+=G,h}function cw(w,E){var G=w[E.offset];return G<192&&G>160||217===G||218===G||219===G}function Zw(w,E){var G=w[E.offset++];return G<128?G:202===G?uw(w,E):203===G?Vw(w,E):204===G?ww(w,E):205===G?Gw(w,E):206===G?hw(w,E):207===G?Uw(w,E):208===G?A(w,E):209===G?Ew(w,E):210===G?Pw(w,E):211===G?xw(w,E):G>223?-1*(255-G+1):void 0}function Jw(w,E){var G=w[E.offset];return G<128||G>=202&&G<=211}function dw(w,E){return w[E.offset]<160}function Kw(w,E){return w[E.offset-1]===y&&(w[E.offset]<128||w[E.offset]>=202&&w[E.offset]<=211)}var tw=Object.freeze({__proto__:null,int8:A,uint8:ww,int16:Ew,uint16:Gw,int32:Pw,uint32:hw,float32:Bw,float64:yw,int64:xw,uint64:Uw,readFloat32:uw,readFloat64:Vw,boolean:aw,string:Qw,stringCheck:cw,number:Zw,numberCheck:Jw,arrayCheck:dw,switchStructureCheck:Kw}),qw=function(){function E(w){var E=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w&&w.forEach((function(w){return E.add(w)}))}return E.prototype.Mx=function(E,G){return void 0===G&&(G=!0),l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,E,G?this.$items:void 0)},E.prototype.Gh=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,E)},E.is=function(w){return void 0!==w.collection},E.prototype.add=function(w){var E=this.$refId++;return void 0!==w.$changes&&w.$changes.setParent(this,this.$changes.root,E),this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,w),this.$changes.change(E),E},E.prototype.at=function(w){var E=Array.from(this.$items.keys())[w];return this.$items.get(E)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(w){for(var E,G,P=this.$items.entries();(G=P.next())&&!G.done;)if(w===G.value[1]){E=G.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&i.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(w){return Array.from(this.$items.values()).some((function(E){return E===w}))},E.prototype.forEach=function(w){var E=this;this.$items.forEach((function(G,P,h){return w(G,P,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(w,E){this.$indexes.set(w,E)},E.prototype.getIndex=function(w){return this.$indexes.get(w)},E.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},E.prototype.deleteByIndex=function(w){var E=this.$indexes.get(w);this.$items.delete(E),this.$indexes.delete(w)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var w=[];return this.forEach((function(E,G){w.push("function"===typeof E.toJSON?E.toJSON():E)})),w},E.prototype.clone=function(w){var G;return w?G=Object.assign(new E,this):(G=new E,this.forEach((function(w){w.$changes?G.add(w.clone()):G.add(w)}))),G},E}(),Ww=function(){function E(w){var E=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w&&w.forEach((function(w){return E.add(w)}))}return E.prototype.Mx=function(E,G){return void 0===G&&(G=!0),l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,E,G?this.$items:void 0)},E.prototype.Gh=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,E)},E.is=function(w){return void 0!==w.set},E.prototype.add=function(E){var G,P;if(this.has(E))return!1;var h=this.$refId++;void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,h);var B=null!==(P=null===(G=this.$changes.indexes[h])||void 0===G?void 0:G.op)&&void 0!==P?P:w.OPERATION.ADD;return this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,E),this.$changes.change(h,B),h},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(w){for(var E,G,P=this.$items.entries();(G=P.next())&&!G.done;)if(w===G.value[1]){E=G.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&i.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(w){for(var E,G=this.$items.values(),P=!1;(E=G.next())&&!E.done;)if(w===E.value){P=!0;break}return P},E.prototype.forEach=function(w){var E=this;this.$items.forEach((function(G,P,h){return w(G,P,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(w,E){this.$indexes.set(w,E)},E.prototype.getIndex=function(w){return this.$indexes.get(w)},E.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},E.prototype.deleteByIndex=function(w){var E=this.$indexes.get(w);this.$items.delete(E),this.$indexes.delete(w)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var w=[];return this.forEach((function(E,G){w.push("function"===typeof E.toJSON?E.toJSON():E)})),w},E.prototype.clone=function(w){var G;return w?G=Object.assign(new E,this):(G=new E,this.forEach((function(w){w.$changes?G.add(w.clone()):G.add(w)}))),G},E}(),Tw=function(){function w(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return w.prototype.addRefId=function(w){this.refIds.has(w)||(this.refIds.add(w),this.containerIndexes.set(w,new Set))},w.get=function(E){return void 0===E.$filterState&&(E.$filterState=new w),E.$filterState},w}(),Iw=function(){function w(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return w.prototype.getNextUniqueId=function(){return this.nextUniqueId++},w.prototype.addRef=function(w,E,G){void 0===G&&(G=!0),this.refs.set(w,E),G&&(this.refCounts[w]=(this.refCounts[w]||0)+1)},w.prototype.removeRef=function(w){this.refCounts[w]=this.refCounts[w]-1,this.deletedRefs.add(w)},w.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},w.prototype.garbageCollectDeletedRefs=function(){var w=this;this.deletedRefs.forEach((function(E){if(!(w.refCounts[E]>0)){var G=w.refs.get(E);if(G instanceof Nw)for(var P in G._definition.schema)"string"!==typeof G._definition.schema[P]&&G[P]&&G[P].$changes&&w.removeRef(G[P].$changes.refId);else{var h=G.$changes.parent._definition,B=h.schema[h.fieldsByIndex[G.$changes.parentIndex]];"function"===typeof Object.values(B)[0]&&Array.from(G.values()).forEach((function(E){return w.removeRef(E.$changes.refId)}))}w.refs.delete(E),delete w.refCounts[E]}})),this.deletedRefs.clear()},w}(),jw=function(w){function E(){return null!==w&&w.apply(this,arguments)||this}return G(E,w),E}(Error);function gw(w,E,G,P){var h,B=!1;switch(E){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":h="number",isNaN(w)&&console.log('trying to encode "NaN" in '.concat(G.constructor.name,"#").concat(P));break;case"string":h="string",B=!0;break;case"boolean":return}if(typeof w!==h&&(!B||B&&null!==w)){var y="'".concat(JSON.stringify(w),"'").concat(w&&w.constructor&&" (".concat(w.constructor.name,")")||"");throw new jw("a '".concat(h,"' was expected, but ").concat(y," was provided in ").concat(G.constructor.name,"#").concat(P))}}function ow(w,E,G,P){if(!(w instanceof E))throw new jw("a '".concat(E.name,"' was expected, but '").concat(w.constructor.name,"' was provided in ").concat(G.constructor.name,"#").concat(P))}function fw(w,E,G,P,h){gw(G,w,P,h);var B=X[w];if(!B)throw new jw("a '".concat(w,"' was expected, but ").concat(G," was provided in ").concat(P.constructor.name,"#").concat(h));B(E,G)}function kw(w,E,G){return tw[w](E,G)}var Nw=function(){function E(){for(var w=[],E=0;E<arguments.length;E++)w[E]=arguments[E];Object.defineProperties(this,{$changes:{value:new U(this,void 0,new Iw),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var G=this._definition.descriptors;G&&Object.defineProperties(this,G),w[0]&&this.assign(w[0])}return E.onError=function(w){console.error(w)},E.is=function(w){return w._definition&&void 0!==w._definition.schema},E.prototype.onChange=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,E)},E.prototype.Gh=function(E){return l(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,E)},E.prototype.assign=function(w){return Object.assign(this,w),this},Object.defineProperty(E.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),E.prototype.setDirty=function(w,E){this.$changes.change(w,E)},E.prototype.listen=function(w,E,G){var P=this;return void 0===G&&(G=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[w]||(this.$callbacks[w]=[]),this.$callbacks[w].push(E),G&&void 0!==this[w]&&E(this[w],void 0),function(){return O(P.$callbacks[w],P.$callbacks[w].indexOf(E))}},E.prototype.decode=function(G,P,h){var B;void 0===P&&(P={offset:0}),void 0===h&&(h=this);var x=[],U=this.$changes.root,l=G.length,i=0;for(U.refs.set(i,this);P.offset<l;){var O=G[P.offset++];if(O!=y){var u=h.$changes,V=void 0!==h._definition,Q=V?O>>6<<6:O;if(Q!==w.OPERATION.CLEAR){var Z=V?O%(Q||255):Zw(G,P),J=V?h._definition.fieldsByIndex[Z]:"",K=u.getType(Z),t=void 0,q=void 0,W=void 0;if(V?q=h["_".concat(J)]:(q=h.getByIndex(Z),(Q&w.OPERATION.ADD)===w.OPERATION.ADD?(W=h instanceof c?Qw(G,P):Z,h.setIndex(Z,W)):W=h.getIndex(Z)),(Q&w.OPERATION.DELETE)===w.OPERATION.DELETE&&(Q!==w.OPERATION.DELETE_AND_ADD&&h.deleteByIndex(Z),q&&q.$changes&&U.removeRef(q.$changes.refId),t=null),void 0!==J){if(Q===w.OPERATION.DELETE);else if(E.is(K)){var T=Zw(G,P);if(t=U.refs.get(T),Q!==w.OPERATION.REPLACE){var I=this.getSchemaType(G,P,K);t||((t=this.createTypeInstance(I)).$changes.refId=T,q&&(t.$callbacks=q.$callbacks,q.$changes.refId&&T!==q.$changes.refId&&U.removeRef(q.$changes.refId))),U.addRef(T,t,t!==q)}}else if("string"===typeof K)t=kw(K,G,P);else{var j=d(Object.keys(K)[0]),g=Zw(G,P),o=U.refs.has(g)?q||U.refs.get(g):new j.constructor;if((t=o.clone(!0)).$changes.refId=g,q&&(t.$callbacks=q.$callbacks,q.$changes.refId&&g!==q.$changes.refId)){U.removeRef(q.$changes.refId);for(var f=q.entries(),k=void 0;(k=f.next())&&!k.done;){var N=(B=k.value)[0],v=B[1];x.push({refId:g,op:w.OPERATION.DELETE,field:N,value:void 0,previousValue:v})}}U.addRef(g,t,o!==q)}if(null!==t&&void 0!==t)if(t.$changes&&t.$changes.setParent(u.ref,u.root,Z),h instanceof E)h[J]=t;else if(h instanceof c)N=W,h.$items.set(N,t),h.$changes.allChanges.add(Z);else if(h instanceof a)h.setAt(Z,t);else if(h instanceof qw){var C=h.add(t);h.setIndex(Z,C)}else h instanceof Ww&&!1!==(C=h.add(t))&&h.setIndex(Z,C);q!==t&&x.push({refId:i,op:Q,field:J,dynamicIndex:W,value:t,previousValue:q})}else{console.warn("@colyseus/schema: definition mismatch");for(var s={offset:P.offset};P.offset<l&&(!Kw(G,P)||(s.offset=P.offset+1,!U.refs.has(Zw(G,s))));)P.offset++}}else h.clear(x)}else{i=Zw(G,P);var F=U.refs.get(i);if(!F)throw new Error('"refId" not found: '.concat(i));h=F}}return this._triggerChanges(x),U.garbageCollectDeletedRefs(),x},E.prototype.encode=function(G,P,h){void 0===G&&(G=!1),void 0===P&&(P=[]),void 0===h&&(h=!1);for(var B=this.$changes,x=new WeakSet,U=[B],l=1,i=0;i<l;i++){var O=U[i],u=O.ref,V=u instanceof E;O.ensureRefId(),x.add(O),O!==B&&(O.changed||G)&&(v(P,y),S(P,O.refId));for(var a=G?Array.from(O.allChanges):Array.from(O.changes.values()),Q=0,Z=a.length;Q<Z;Q++){var J=G?{op:w.OPERATION.ADD,index:a[Q]}:a[Q],K=J.index,t=V?u._definition.fieldsByIndex&&u._definition.fieldsByIndex[K]:K,q=P.length;if(J.op!==w.OPERATION.TOUCH)if(V)v(P,K|J.op);else{if(v(P,J.op),J.op===w.OPERATION.CLEAR)continue;S(P,K)}if(V||(J.op&w.OPERATION.ADD)!=w.OPERATION.ADD||u instanceof c&&Y(P,O.ref.$indexes.get(K)),J.op!==w.OPERATION.DELETE){var W=O.getType(K),T=O.getValue(K);if(T&&T.$changes&&!x.has(T.$changes)&&(U.push(T.$changes),T.$changes.ensureRefId(),l++),J.op!==w.OPERATION.TOUCH){if(E.is(W))ow(T,W,u,t),S(P,T.$changes.refId),(J.op&w.OPERATION.ADD)===w.OPERATION.ADD&&this.tryEncodeTypeId(P,W,T.constructor);else if("string"===typeof W)fw(W,P,T,u,t);else{var I=d(Object.keys(W)[0]);ow(u["_".concat(t)],I.constructor,u,t),S(P,T.$changes.refId)}h&&O.cache(K,P.slice(q))}}}G||h||O.discard()}return P},E.prototype.encodeAll=function(w){return this.encode(!0,[],w)},E.prototype.applyFilters=function(G,P){var h,B;void 0===P&&(P=!1);for(var x=this,U=new Set,l=Tw.get(G),i=[this.$changes],O=1,u=[],V=function(V){var a=i[V];if(U.has(a.refId))return"continue";var Q=a.ref,Z=Q instanceof E;v(u,y),S(u,a.refId);var J=l.refIds.has(a),d=P||!J;l.addRefId(a);var K=l.containerIndexes.get(a),t=d?Array.from(a.allChanges):Array.from(a.changes.values());!P&&Z&&Q._definition.indexesWithFilters&&Q._definition.indexesWithFilters.forEach((function(E){!K.has(E)&&a.allChanges.has(E)&&(d?t.push(E):t.push({op:w.OPERATION.ADD,index:E}))}));for(var q=0,W=t.length;q<W;q++){var T=d?{op:w.OPERATION.ADD,index:t[q]}:t[q];if(T.op!==w.OPERATION.CLEAR){var I=T.index;if(T.op!==w.OPERATION.DELETE){var j=a.getValue(I),g=a.getType(I);if(Z){if((o=Q._definition.filters&&Q._definition.filters[I])&&!o.call(Q,G,j,x)){j&&j.$changes&&U.add(j.$changes.refId);continue}}else{var o,f=a.parent;if((o=a.getChildrenFilter())&&!o.call(f,G,Q.$indexes.get(I),j,x)){j&&j.$changes&&U.add(j.$changes.refId);continue}}if(j.$changes&&(i.push(j.$changes),O++),T.op!==w.OPERATION.TOUCH)if(T.op===w.OPERATION.ADD||Z)u.push.apply(u,null!==(h=a.caches[I])&&void 0!==h?h:[]),K.add(I);else if(K.has(I))u.push.apply(u,null!==(B=a.caches[I])&&void 0!==B?B:[]);else{if(K.add(I),v(u,w.OPERATION.ADD),S(u,I),Q instanceof c){var k=a.ref.$indexes.get(I);Y(u,k)}j.$changes?S(u,j.$changes.refId):X[g](u,j)}else j.$changes&&!Z&&(v(u,w.OPERATION.ADD),S(u,I),Q instanceof c&&(k=a.ref.$indexes.get(I),Y(u,k)),S(u,j.$changes.refId))}else Z?v(u,T.op|I):(v(u,T.op),S(u,I))}else v(u,T.op)}},a=0;a<O;a++)V(a);return u},E.prototype.clone=function(){var w,E=new this.constructor,G=this._definition.schema;for(var P in G)"object"===typeof this[P]&&"function"===typeof(null===(w=this[P])||void 0===w?void 0:w.clone)?E[P]=this[P].clone():E[P]=this[P];return E},E.prototype.toJSON=function(){var w=this._definition.schema,E=this._definition.deprecated,G={};for(var P in w)E[P]||null===this[P]||"undefined"===typeof this[P]||(G[P]="function"===typeof this[P].toJSON?this[P].toJSON():this["_".concat(P)]);return G},E.prototype.discardAllChanges=function(){this.$changes.discardAll()},E.prototype.getByIndex=function(w){return this[this._definition.fieldsByIndex[w]]},E.prototype.deleteByIndex=function(w){this[this._definition.fieldsByIndex[w]]=void 0},E.prototype.tryEncodeTypeId=function(w,E,G){E._typeid!==G._typeid&&(v(w,x),S(w,G._typeid))},E.prototype.getSchemaType=function(w,E,G){var P;return w[E.offset]===x&&(E.offset++,P=this.constructor._context.get(Zw(w,E))),P||G},E.prototype.createTypeInstance=function(w){var E=new w;return E.$changes.root=this.$changes.root,E},E.prototype._triggerChanges=function(G){for(var P,h,B,y,x,U,l,i,O,u=new Set,V=this.$changes.root.refs,a=function(a){var Q=G[a],c=Q.refId,Z=V.get(c),J=Z.$callbacks;if((Q.op&w.OPERATION.DELETE)===w.OPERATION.DELETE&&Q.previousValue instanceof E&&(null===(h=null===(P=Q.previousValue.$callbacks)||void 0===P?void 0:P[w.OPERATION.DELETE])||void 0===h||h.forEach((function(w){return w()}))),!J)return"continue";if(Z instanceof E){if(!u.has(c))try{null===(B=null===J||void 0===J?void 0:J[w.OPERATION.REPLACE])||void 0===B||B.forEach((function(w){return w()}))}catch(d){E.onError(d)}try{J.hasOwnProperty(Q.field)&&(null===(y=J[Q.field])||void 0===y||y.forEach((function(w){return w(Q.value,Q.previousValue)})))}catch(d){E.onError(d)}}else Q.op===w.OPERATION.ADD&&void 0===Q.previousValue?null===(x=J[w.OPERATION.ADD])||void 0===x||x.forEach((function(w){var E;return w(Q.value,null!==(E=Q.dynamicIndex)&&void 0!==E?E:Q.field)})):Q.op===w.OPERATION.DELETE?void 0!==Q.previousValue&&(null===(U=J[w.OPERATION.DELETE])||void 0===U||U.forEach((function(w){var E;return w(Q.previousValue,null!==(E=Q.dynamicIndex)&&void 0!==E?E:Q.field)}))):Q.op===w.OPERATION.DELETE_AND_ADD&&(void 0!==Q.previousValue&&(null===(l=J[w.OPERATION.DELETE])||void 0===l||l.forEach((function(w){var E;return w(Q.previousValue,null!==(E=Q.dynamicIndex)&&void 0!==E?E:Q.field)}))),null===(i=J[w.OPERATION.ADD])||void 0===i||i.forEach((function(w){var E;return w(Q.value,null!==(E=Q.dynamicIndex)&&void 0!==E?E:Q.field)}))),Q.value!==Q.previousValue&&(null===(O=J[w.OPERATION.REPLACE])||void 0===O||O.forEach((function(w){var E;return w(Q.value,null!==(E=Q.dynamicIndex)&&void 0!==E?E:Q.field)})));u.add(c)},Q=0;Q<G.length;Q++)a(Q)},E._definition=K.create(),E}();function vw(w){for(var E=[w.$changes],G=1,P={},h=P,B=function(w){var G=E[w];G.changes.forEach((function(w){var E=G.ref,P=w.index,B=E._definition?E._definition.fieldsByIndex[P]:E.$indexes.get(P);h[B]=G.getValue(P)}))},y=0;y<G;y++)B(y);return P}var Cw={context:new q},sw=function(w){function E(){return null!==w&&w.apply(this,arguments)||this}return G(E,w),P([T("string",Cw)],E.prototype,"name",void 0),P([T("string",Cw)],E.prototype,"type",void 0),P([T("number",Cw)],E.prototype,"referencedType",void 0),E}(Nw),Fw=function(w){function E(){var E=null!==w&&w.apply(this,arguments)||this;return E.fields=new a,E}return G(E,w),P([T("number",Cw)],E.prototype,"id",void 0),P([T([sw],Cw)],E.prototype,"fields",void 0),E}(Nw),Mw=function(w){function E(){var E=null!==w&&w.apply(this,arguments)||this;return E.types=new a,E}return G(E,w),E.encode=function(w){var G=w.constructor,P=new E;P.rootType=G._typeid;var h=function(w,E){for(var G in E){var h=new sw;h.name=G;var B=void 0;if("string"===typeof E[G])B=E[G];else{var y=E[G],x=void 0;Nw.is(y)?(B="ref",x=E[G]):"string"===typeof y[B=Object.keys(y)[0]]?B+=":"+y[B]:x=y[B],h.referencedType=x?x._typeid:-1}h.type=B,w.fields.push(h)}P.types.push(w)},B=G._context.types;for(var y in B){var x=new Fw;x.id=Number(y),h(x,B[y]._definition.schema)}return P.encodeAll()},E.decode=function(w,P){var h=new q,B=new E;B.decode(w,P);var y=B.types.reduce((function(w,E){var P=function(w){function E(){return null!==w&&w.apply(this,arguments)||this}return G(E,w),E}(Nw),B=E.id;return w[B]=P,h.add(P,B),w}),{});B.types.forEach((function(w){var E=y[w.id];w.fields.forEach((function(w){var G;if(void 0!==w.referencedType){var P=w.type,B=y[w.referencedType];if(!B){var x=w.type.split(":");P=x[0],B=x[1]}"ref"===P?T(B,{context:h})(E.prototype,w.name):T(((G={})[P]=B,G),{context:h})(E.prototype,w.name)}else T(w.type,{context:h})(E.prototype,w.name)}))}));var x=y[B.rootType],U=new x;for(var l in x._definition.schema){var i=x._definition.schema[l];"string"!==typeof i&&(U[l]="function"===typeof i?new i:new(d(Object.keys(i)[0]).constructor))}return U},P([T([Fw],Cw)],E.prototype,"types",void 0),P([T("number",Cw)],E.prototype,"rootType",void 0),E}(Nw);J("map",{constructor:c}),J("array",{constructor:a}),J("set",{constructor:Ww}),J("collection",{constructor:qw}),w.ArraySchema=a,w.CollectionSchema=qw,w.Context=q,w.MapSchema=c,w.Reflection=Mw,w.ReflectionField=sw,w.ReflectionType=Fw,w.Schema=Nw,w.SchemaDefinition=K,w.SetSchema=Ww,w.decode=tw,w.defineTypes=o,w.deprecated=g,w.dumpChanges=vw,w.encode=X,w.filter=I,w.filterChildren=j,w.hasFilter=t,w.registerType=J,w.type=T,Object.defineProperty(w,"__esModule",{value:!0})}(E)},13678:w=>{"use strict";w.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13674:(w,E,G)=>{var P=G(13678),h=G(13682),B=Object.hasOwnProperty,y=Object.create(null);for(var x in P)B.call(P,x)&&(y[P[x]]=x);var U=w.exports={to:{},get:{}};function l(w,E,G){return Math.min(Math.max(E,w),G)}function i(w){var E=Math.round(w).toString(16).toUpperCase();return E.length<2?"0"+E:E}U.get=function(w){var E,G;switch(w.substring(0,3).toLowerCase()){case"hsl":E=U.get.hsl(w),G="hsl";break;case"hwb":E=U.get.hwb(w),G="hwb";break;default:E=U.get.rgb(w),G="rgb"}return E?{model:G,value:E}:null},U.get.rgb=function(w){if(!w)return null;var E,G,h,y=[0,0,0,1];if(E=w.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(h=E[2],E=E[1],G=0;G<3;G++){var x=2*G;y[G]=parseInt(E.slice(x,x+2),16)}h&&(y[3]=parseInt(h,16)/255)}else if(E=w.match(/^#([a-f0-9]{3,4})$/i)){for(h=(E=E[1])[3],G=0;G<3;G++)y[G]=parseInt(E[G]+E[G],16);h&&(y[3]=parseInt(h+h,16)/255)}else if(E=w.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(G=0;G<3;G++)y[G]=parseInt(E[G+1],0);E[4]&&(E[5]?y[3]=.01*parseFloat(E[4]):y[3]=parseFloat(E[4]))}else{if(!(E=w.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(E=w.match(/^(\w+)$/))?"transparent"===E[1]?[0,0,0,0]:B.call(P,E[1])?((y=P[E[1]])[3]=1,y):null:null;for(G=0;G<3;G++)y[G]=Math.round(2.55*parseFloat(E[G+1]));E[4]&&(E[5]?y[3]=.01*parseFloat(E[4]):y[3]=parseFloat(E[4]))}for(G=0;G<3;G++)y[G]=l(y[G],0,255);return y[3]=l(y[3],0,1),y},U.get.hsl=function(w){if(!w)return null;var E=w.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var G=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,l(parseFloat(E[2]),0,100),l(parseFloat(E[3]),0,100),l(isNaN(G)?1:G,0,1)]}return null},U.get.hwb=function(w){if(!w)return null;var E=w.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var G=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,l(parseFloat(E[2]),0,100),l(parseFloat(E[3]),0,100),l(isNaN(G)?1:G,0,1)]}return null},U.to.hex=function(){var w=h(arguments);return"#"+i(w[0])+i(w[1])+i(w[2])+(w[3]<1?i(Math.round(255*w[3])):"")},U.to.rgb=function(){var w=h(arguments);return w.length<4||1===w[3]?"rgb("+Math.round(w[0])+", "+Math.round(w[1])+", "+Math.round(w[2])+")":"rgba("+Math.round(w[0])+", "+Math.round(w[1])+", "+Math.round(w[2])+", "+w[3]+")"},U.to.rgb.percent=function(){var w=h(arguments),E=Math.round(w[0]/255*100),G=Math.round(w[1]/255*100),P=Math.round(w[2]/255*100);return w.length<4||1===w[3]?"rgb("+E+"%, "+G+"%, "+P+"%)":"rgba("+E+"%, "+G+"%, "+P+"%, "+w[3]+")"},U.to.hsl=function(){var w=h(arguments);return w.length<4||1===w[3]?"hsl("+w[0]+", "+w[1]+"%, "+w[2]+"%)":"hsla("+w[0]+", "+w[1]+"%, "+w[2]+"%, "+w[3]+")"},U.to.hwb=function(){var w=h(arguments),E="";return w.length>=4&&1!==w[3]&&(E=", "+w[3]),"hwb("+w[0]+", "+w[1]+"%, "+w[2]+"%"+E+")"},U.to.keyword=function(w){return y[w.slice(0,3)]}},13671:(w,E,G)=>{const P=G(13674),h=G(13697),B=["keyword","gray","hex"],y={};for(const V of Object.keys(h))y[[...h[V].labels].sort().join("")]=V;const x={};function U(w,E){if(!(this instanceof U))return new U(w,E);if(E&&E in B&&(E=null),E&&!(E in h))throw new Error("Unknown model: "+E);let G,l;if(null==w)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(w instanceof U)this.model=w.model,this.color=[...w.color],this.valpha=w.valpha;else if("string"===typeof w){const E=P.get(w);if(null===E)throw new Error("Unable to parse color from string: "+w);this.model=E.model,l=h[this.model].channels,this.color=E.value.slice(0,l),this.valpha="number"===typeof E.value[l]?E.value[l]:1}else if(w.length>0){this.model=E||"rgb",l=h[this.model].channels;const G=Array.prototype.slice.call(w,0,l);this.color=u(G,l),this.valpha="number"===typeof w[l]?w[l]:1}else if("number"===typeof w)this.model="rgb",this.color=[w>>16&255,w>>8&255,255&w],this.valpha=1;else{this.valpha=1;const E=Object.keys(w);"alpha"in w&&(E.splice(E.indexOf("alpha"),1),this.valpha="number"===typeof w.alpha?w.alpha:0);const P=E.sort().join("");if(!(P in y))throw new Error("Unable to parse color from object: "+JSON.stringify(w));this.model=y[P];const{labels:B}=h[this.model],x=[];for(G=0;G<B.length;G++)x.push(w[B[G]]);this.color=u(x)}if(x[this.model])for(l=h[this.model].channels,G=0;G<l;G++){const w=x[this.model][G];w&&(this.color[G]=w(this.color[G]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}U.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(w){let E=this.model in P.to?this:this.rgb();E=E.round("number"===typeof w?w:1);const G=1===E.valpha?E.color:[...E.color,this.valpha];return P.to[E.model](G)},percentString(w){const E=this.rgb().round("number"===typeof w?w:1),G=1===E.valpha?E.color:[...E.color,this.valpha];return P.to.rgb.percent(G)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const w={},{channels:E}=h[this.model],{labels:G}=h[this.model];for(let P=0;P<E;P++)w[G[P]]=this.color[P];return 1!==this.valpha&&(w.alpha=this.valpha),w},unitArray(){const w=this.rgb().color;return w[0]/=255,w[1]/=255,w[2]/=255,1!==this.valpha&&w.push(this.valpha),w},unitObject(){const w=this.rgb().object();return w.r/=255,w.g/=255,w.b/=255,1!==this.valpha&&(w.alpha=this.valpha),w},round(w){return w=Math.max(w||0,0),new U([...this.color.map(l(w)),this.valpha],this.model)},alpha(w){return void 0!==w?new U([...this.color,Math.max(0,Math.min(1,w))],this.model):this.valpha},red:i("rgb",0,O(255)),green:i("rgb",1,O(255)),blue:i("rgb",2,O(255)),hue:i(["hsl","hsv","hsl","hwb","hcg"],0,(w=>(w%360+360)%360)),saturationl:i("hsl",1,O(100)),lightness:i("hsl",2,O(100)),saturationv:i("hsv",1,O(100)),value:i("hsv",2,O(100)),chroma:i("hcg",1,O(100)),gray:i("hcg",2,O(100)),white:i("hwb",1,O(100)),wblack:i("hwb",2,O(100)),cyan:i("cmyk",0,O(100)),magenta:i("cmyk",1,O(100)),yellow:i("cmyk",2,O(100)),black:i("cmyk",3,O(100)),x:i("xyz",0,O(95.047)),y:i("xyz",1,O(100)),z:i("xyz",2,O(108.833)),l:i("lab",0,O(100)),a:i("lab",1),b:i("lab",2),keyword(w){return void 0!==w?new U(w):h[this.model].keyword(this.color)},hex(w){return void 0!==w?new U(w):P.to.hex(this.rgb().round().color)},hexa(w){if(void 0!==w)return new U(w);const E=this.rgb().round().color;let G=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===G.length&&(G="0"+G),P.to.hex(E)+G},rgbNumber(){const w=this.rgb().color;return(255&w[0])<<16|(255&w[1])<<8|255&w[2]},luminosity(){const w=this.rgb().color,E=[];for(const[G,P]of w.entries()){const w=P/255;E[G]=w<=.04045?w/12.92:((w+.055)/1.055)**2.4}return.2126*E[0]+.7152*E[1]+.0722*E[2]},contrast(w){const E=this.luminosity(),G=w.luminosity();return E>G?(E+.05)/(G+.05):(G+.05)/(E+.05)},level(w){const E=this.contrast(w);return E>=7?"AAA":E>=4.5?"AA":""},isDark(){const w=this.rgb().color;return(2126*w[0]+7152*w[1]+722*w[2])/1e4<128},isLight(){return!this.isDark()},negate(){const w=this.rgb();for(let E=0;E<3;E++)w.color[E]=255-w.color[E];return w},lighten(w){const E=this.hsl();return E.color[2]+=E.color[2]*w,E},darken(w){const E=this.hsl();return E.color[2]-=E.color[2]*w,E},saturate(w){const E=this.hsl();return E.color[1]+=E.color[1]*w,E},desaturate(w){const E=this.hsl();return E.color[1]-=E.color[1]*w,E},whiten(w){const E=this.hwb();return E.color[1]+=E.color[1]*w,E},blacken(w){const E=this.hwb();return E.color[2]+=E.color[2]*w,E},grayscale(){const w=this.rgb().color,E=.3*w[0]+.59*w[1]+.11*w[2];return U.rgb(E,E,E)},fade(w){return this.alpha(this.valpha-this.valpha*w)},opaquer(w){return this.alpha(this.valpha+this.valpha*w)},rotate(w){const E=this.hsl();let G=E.color[0];return G=(G+w)%360,G=G<0?360+G:G,E.color[0]=G,E},mix(w,E){if(!w||!w.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof w);const G=w.rgb(),P=this.rgb(),h=void 0===E?.5:E,B=2*h-1,y=G.alpha()-P.alpha(),x=((B*y===-1?B:(B+y)/(1+B*y))+1)/2,l=1-x;return U.rgb(x*G.red()+l*P.red(),x*G.green()+l*P.green(),x*G.blue()+l*P.blue(),G.alpha()*h+P.alpha()*(1-h))}};for(const V of Object.keys(h)){if(B.includes(V))continue;const{channels:w}=h[V];U.prototype[V]=function(){if(this.model===V)return new U(this);for(var w=arguments.length,E=new Array(w),G=0;G<w;G++)E[G]=arguments[G];return E.length>0?new U(E,V):new U([...(P=h[this.model][V].raw(this.color),Array.isArray(P)?P:[P]),this.valpha],V);var P},U[V]=function(){for(var E=arguments.length,G=new Array(E),P=0;P<E;P++)G[P]=arguments[P];let h=G[0];return"number"===typeof h&&(h=u(G,w)),new U(h,V)}}function l(w){return function(E){return function(w,E){return Number(w.toFixed(E))}(E,w)}}function i(w,E,G){w=Array.isArray(w)?w:[w];for(const P of w)(x[P]||(x[P]=[]))[E]=G;return w=w[0],function(P){let h;return void 0!==P?(G&&(P=G(P)),h=this[w](),h.color[E]=P,h):(h=this[w]().color[E],G&&(h=G(h)),h)}}function O(w){return function(E){return Math.max(0,Math.min(w,E))}}function u(w,E){for(let G=0;G<E;G++)"number"!==typeof w[G]&&(w[G]=0);return w}w.exports=U},13703:(w,E,G)=>{const P=G(13711),h={};for(const y of Object.keys(P))h[P[y]]=y;const B={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};w.exports=B;for(const y of Object.keys(B)){if(!("channels"in B[y]))throw new Error("missing channels property: "+y);if(!("labels"in B[y]))throw new Error("missing channel labels property: "+y);if(B[y].labels.length!==B[y].channels)throw new Error("channel and label counts mismatch: "+y);const{channels:w,labels:E}=B[y];delete B[y].channels,delete B[y].labels,Object.defineProperty(B[y],"channels",{value:w}),Object.defineProperty(B[y],"labels",{value:E})}B.rgb.hsl=function(w){const E=w[0]/255,G=w[1]/255,P=w[2]/255,h=Math.min(E,G,P),B=Math.max(E,G,P),y=B-h;let x,U;B===h?x=0:E===B?x=(G-P)/y:G===B?x=2+(P-E)/y:P===B&&(x=4+(E-G)/y),x=Math.min(60*x,360),x<0&&(x+=360);const l=(h+B)/2;return U=B===h?0:l<=.5?y/(B+h):y/(2-B-h),[x,100*U,100*l]},B.rgb.hsv=function(w){let E,G,P,h,B;const y=w[0]/255,x=w[1]/255,U=w[2]/255,l=Math.max(y,x,U),i=l-Math.min(y,x,U),O=function(w){return(l-w)/6/i+.5};return 0===i?(h=0,B=0):(B=i/l,E=O(y),G=O(x),P=O(U),y===l?h=P-G:x===l?h=1/3+E-P:U===l&&(h=2/3+G-E),h<0?h+=1:h>1&&(h-=1)),[360*h,100*B,100*l]},B.rgb.hwb=function(w){const E=w[0],G=w[1];let P=w[2];const h=B.rgb.hsl(w)[0],y=1/255*Math.min(E,Math.min(G,P));return P=1-1/255*Math.max(E,Math.max(G,P)),[h,100*y,100*P]},B.rgb.cmyk=function(w){const E=w[0]/255,G=w[1]/255,P=w[2]/255,h=Math.min(1-E,1-G,1-P);return[100*((1-E-h)/(1-h)||0),100*((1-G-h)/(1-h)||0),100*((1-P-h)/(1-h)||0),100*h]},B.rgb.keyword=function(w){const E=h[w];if(E)return E;let G,B=1/0;for(const h of Object.keys(P)){const E=P[h],U=(x=E,((y=w)[0]-x[0])**2+(y[1]-x[1])**2+(y[2]-x[2])**2);U<B&&(B=U,G=h)}var y,x;return G},B.keyword.rgb=function(w){return P[w]},B.rgb.xyz=function(w){let E=w[0]/255,G=w[1]/255,P=w[2]/255;E=E>.04045?((E+.055)/1.055)**2.4:E/12.92,G=G>.04045?((G+.055)/1.055)**2.4:G/12.92,P=P>.04045?((P+.055)/1.055)**2.4:P/12.92;return[100*(.4124*E+.3576*G+.1805*P),100*(.2126*E+.7152*G+.0722*P),100*(.0193*E+.1192*G+.9505*P)]},B.rgb.lab=function(w){const E=B.rgb.xyz(w);let G=E[0],P=E[1],h=E[2];G/=95.047,P/=100,h/=108.883,G=G>.008856?G**(1/3):7.787*G+16/116,P=P>.008856?P**(1/3):7.787*P+16/116,h=h>.008856?h**(1/3):7.787*h+16/116;return[116*P-16,500*(G-P),200*(P-h)]},B.hsl.rgb=function(w){const E=w[0]/360,G=w[1]/100,P=w[2]/100;let h,B,y;if(0===G)return y=255*P,[y,y,y];h=P<.5?P*(1+G):P+G-P*G;const x=2*P-h,U=[0,0,0];for(let l=0;l<3;l++)B=E+1/3*-(l-1),B<0&&B++,B>1&&B--,y=6*B<1?x+6*(h-x)*B:2*B<1?h:3*B<2?x+(h-x)*(2/3-B)*6:x,U[l]=255*y;return U},B.hsl.hsv=function(w){const E=w[0];let G=w[1]/100,P=w[2]/100,h=G;const B=Math.max(P,.01);P*=2,G*=P<=1?P:2-P,h*=B<=1?B:2-B;return[E,100*(0===P?2*h/(B+h):2*G/(P+G)),100*((P+G)/2)]},B.hsv.rgb=function(w){const E=w[0]/60,G=w[1]/100;let P=w[2]/100;const h=Math.floor(E)%6,B=E-Math.floor(E),y=255*P*(1-G),x=255*P*(1-G*B),U=255*P*(1-G*(1-B));switch(P*=255,h){case 0:return[P,U,y];case 1:return[x,P,y];case 2:return[y,P,U];case 3:return[y,x,P];case 4:return[U,y,P];case 5:return[P,y,x]}},B.hsv.hsl=function(w){const E=w[0],G=w[1]/100,P=w[2]/100,h=Math.max(P,.01);let B,y;y=(2-G)*P;const x=(2-G)*h;return B=G*h,B/=x<=1?x:2-x,B=B||0,y/=2,[E,100*B,100*y]},B.hwb.rgb=function(w){const E=w[0]/360;let G=w[1]/100,P=w[2]/100;const h=G+P;let B;h>1&&(G/=h,P/=h);const y=Math.floor(6*E),x=1-P;B=6*E-y,0!==(1&y)&&(B=1-B);const U=G+B*(x-G);let l,i,O;switch(y){default:case 6:case 0:l=x,i=U,O=G;break;case 1:l=U,i=x,O=G;break;case 2:l=G,i=x,O=U;break;case 3:l=G,i=U,O=x;break;case 4:l=U,i=G,O=x;break;case 5:l=x,i=G,O=U}return[255*l,255*i,255*O]},B.cmyk.rgb=function(w){const E=w[0]/100,G=w[1]/100,P=w[2]/100,h=w[3]/100;return[255*(1-Math.min(1,E*(1-h)+h)),255*(1-Math.min(1,G*(1-h)+h)),255*(1-Math.min(1,P*(1-h)+h))]},B.xyz.rgb=function(w){const E=w[0]/100,G=w[1]/100,P=w[2]/100;let h,B,y;return h=3.2406*E+-1.5372*G+-.4986*P,B=-.9689*E+1.8758*G+.0415*P,y=.0557*E+-.204*G+1.057*P,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,h=Math.min(Math.max(0,h),1),B=Math.min(Math.max(0,B),1),y=Math.min(Math.max(0,y),1),[255*h,255*B,255*y]},B.xyz.lab=function(w){let E=w[0],G=w[1],P=w[2];E/=95.047,G/=100,P/=108.883,E=E>.008856?E**(1/3):7.787*E+16/116,G=G>.008856?G**(1/3):7.787*G+16/116,P=P>.008856?P**(1/3):7.787*P+16/116;return[116*G-16,500*(E-G),200*(G-P)]},B.lab.xyz=function(w){let E,G,P;G=(w[0]+16)/116,E=w[1]/500+G,P=G-w[2]/200;const h=G**3,B=E**3,y=P**3;return G=h>.008856?h:(G-16/116)/7.787,E=B>.008856?B:(E-16/116)/7.787,P=y>.008856?y:(P-16/116)/7.787,E*=95.047,G*=100,P*=108.883,[E,G,P]},B.lab.lch=function(w){const E=w[0],G=w[1],P=w[2];let h;h=360*Math.atan2(P,G)/2/Math.PI,h<0&&(h+=360);return[E,Math.sqrt(G*G+P*P),h]},B.lch.lab=function(w){const E=w[0],G=w[1],P=w[2]/360*2*Math.PI;return[E,G*Math.cos(P),G*Math.sin(P)]},B.rgb.ansi16=function(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[G,P,h]=w;let y=null===E?B.rgb.hsv(w)[2]:E;if(y=Math.round(y/50),0===y)return 30;let x=30+(Math.round(h/255)<<2|Math.round(P/255)<<1|Math.round(G/255));return 2===y&&(x+=60),x},B.hsv.ansi16=function(w){return B.rgb.ansi16(B.hsv.rgb(w),w[2])},B.rgb.ansi256=function(w){const E=w[0],G=w[1],P=w[2];if(E===G&&G===P)return E<8?16:E>248?231:Math.round((E-8)/247*24)+232;return 16+36*Math.round(E/255*5)+6*Math.round(G/255*5)+Math.round(P/255*5)},B.ansi16.rgb=function(w){let E=w%10;if(0===E||7===E)return w>50&&(E+=3.5),E=E/10.5*255,[E,E,E];const G=.5*(1+~~(w>50));return[(1&E)*G*255,(E>>1&1)*G*255,(E>>2&1)*G*255]},B.ansi256.rgb=function(w){if(w>=232){const E=10*(w-232)+8;return[E,E,E]}let E;w-=16;return[Math.floor(w/36)/5*255,Math.floor((E=w%36)/6)/5*255,E%6/5*255]},B.rgb.hex=function(w){const E=(((255&Math.round(w[0]))<<16)+((255&Math.round(w[1]))<<8)+(255&Math.round(w[2]))).toString(16).toUpperCase();return"000000".substring(E.length)+E},B.hex.rgb=function(w){const E=w.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!E)return[0,0,0];let G=E[0];3===E[0].length&&(G=G.split("").map((w=>w+w)).join(""));const P=parseInt(G,16);return[P>>16&255,P>>8&255,255&P]},B.rgb.hcg=function(w){const E=w[0]/255,G=w[1]/255,P=w[2]/255,h=Math.max(Math.max(E,G),P),B=Math.min(Math.min(E,G),P),y=h-B;let x,U;return x=y<1?B/(1-y):0,U=y<=0?0:h===E?(G-P)/y%6:h===G?2+(P-E)/y:4+(E-G)/y,U/=6,U%=1,[360*U,100*y,100*x]},B.hsl.hcg=function(w){const E=w[1]/100,G=w[2]/100,P=G<.5?2*E*G:2*E*(1-G);let h=0;return P<1&&(h=(G-.5*P)/(1-P)),[w[0],100*P,100*h]},B.hsv.hcg=function(w){const E=w[1]/100,G=w[2]/100,P=E*G;let h=0;return P<1&&(h=(G-P)/(1-P)),[w[0],100*P,100*h]},B.hcg.rgb=function(w){const E=w[0]/360,G=w[1]/100,P=w[2]/100;if(0===G)return[255*P,255*P,255*P];const h=[0,0,0],B=E%1*6,y=B%1,x=1-y;let U=0;switch(Math.floor(B)){case 0:h[0]=1,h[1]=y,h[2]=0;break;case 1:h[0]=x,h[1]=1,h[2]=0;break;case 2:h[0]=0,h[1]=1,h[2]=y;break;case 3:h[0]=0,h[1]=x,h[2]=1;break;case 4:h[0]=y,h[1]=0,h[2]=1;break;default:h[0]=1,h[1]=0,h[2]=x}return U=(1-G)*P,[255*(G*h[0]+U),255*(G*h[1]+U),255*(G*h[2]+U)]},B.hcg.hsv=function(w){const E=w[1]/100,G=E+w[2]/100*(1-E);let P=0;return G>0&&(P=E/G),[w[0],100*P,100*G]},B.hcg.hsl=function(w){const E=w[1]/100,G=w[2]/100*(1-E)+.5*E;let P=0;return G>0&&G<.5?P=E/(2*G):G>=.5&&G<1&&(P=E/(2*(1-G))),[w[0],100*P,100*G]},B.hcg.hwb=function(w){const E=w[1]/100,G=E+w[2]/100*(1-E);return[w[0],100*(G-E),100*(1-G)]},B.hwb.hcg=function(w){const E=w[1]/100,G=1-w[2]/100,P=G-E;let h=0;return P<1&&(h=(G-P)/(1-P)),[w[0],100*P,100*h]},B.apple.rgb=function(w){return[w[0]/65535*255,w[1]/65535*255,w[2]/65535*255]},B.rgb.apple=function(w){return[w[0]/255*65535,w[1]/255*65535,w[2]/255*65535]},B.gray.rgb=function(w){return[w[0]/100*255,w[0]/100*255,w[0]/100*255]},B.gray.hsl=function(w){return[0,0,w[0]]},B.gray.hsv=B.gray.hsl,B.gray.hwb=function(w){return[0,100,w[0]]},B.gray.cmyk=function(w){return[0,0,0,w[0]]},B.gray.lab=function(w){return[w[0],0,0]},B.gray.hex=function(w){const E=255&Math.round(w[0]/100*255),G=((E<<16)+(E<<8)+E).toString(16).toUpperCase();return"000000".substring(G.length)+G},B.rgb.gray=function(w){return[(w[0]+w[1]+w[2])/3/255*100]}},13697:(w,E,G)=>{const P=G(13703),h=G(13720),B={};Object.keys(P).forEach((w=>{B[w]={},Object.defineProperty(B[w],"channels",{value:P[w].channels}),Object.defineProperty(B[w],"labels",{value:P[w].labels});const E=h(w);Object.keys(E).forEach((G=>{const P=E[G];B[w][G]=function(w){const E=function(){for(var E=arguments.length,G=new Array(E),P=0;P<E;P++)G[P]=arguments[P];const h=G[0];if(void 0===h||null===h)return h;h.length>1&&(G=h);const B=w(G);if("object"===typeof B)for(let w=B.length,y=0;y<w;y++)B[y]=Math.round(B[y]);return B};return"conversion"in w&&(E.conversion=w.conversion),E}(P),B[w][G].raw=function(w){const E=function(){for(var E=arguments.length,G=new Array(E),P=0;P<E;P++)G[P]=arguments[P];const h=G[0];return void 0===h||null===h?h:(h.length>1&&(G=h),w(G))};return"conversion"in w&&(E.conversion=w.conversion),E}(P)}))})),w.exports=B},13720:(w,E,G)=>{const P=G(13703);function h(w){const E=function(){const w={},E=Object.keys(P);for(let G=E.length,P=0;P<G;P++)w[E[P]]={distance:-1,parent:null};return w}(),G=[w];for(E[w].distance=0;G.length;){const w=G.pop(),h=Object.keys(P[w]);for(let P=h.length,B=0;B<P;B++){const P=h[B],y=E[P];-1===y.distance&&(y.distance=E[w].distance+1,y.parent=w,G.unshift(P))}}return E}function B(w,E){return function(G){return E(w(G))}}function y(w,E){const G=[E[w].parent,w];let h=P[E[w].parent][w],y=E[w].parent;for(;E[y].parent;)G.unshift(E[y].parent),h=B(P[E[y].parent][y],h),y=E[y].parent;return h.conversion=G,h}w.exports=function(w){const E=h(w),G={},P=Object.keys(E);for(let h=P.length,B=0;B<h;B++){const w=P[B];null!==E[w].parent&&(G[w]=y(w,E))}return G}},13711:w=>{"use strict";w.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12353:(w,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.discordURLBuilder=void 0,E.discordURLBuilder=function(w){var E;const G=(null===(E=null===window||void 0===window?void 0:window.location)||void 0===E?void 0:E.hostname)||"localhost",P=w.hostname.split("."),h=!w.hostname.includes("trycloudflare.com")&&!w.hostname.includes("discordsays.com")&&P.length>2?`/${P[0]}`:"";return w.pathname.startsWith("/.proxy")?`${w.protocol}//${G}${h}${w.pathname}${w.search}`:`${w.protocol}//${G}/.proxy/colyseus${h}${w.pathname}${w.search}`}},12347:function(w,E,G){"use strict";var P,h,B,y,x=this&&this.__awaiter||function(w,E,G,P){return new(G||(G=Promise))((function(h,B){function y(w){try{U(P.next(w))}catch(E){B(E)}}function x(w){try{U(P.throw(w))}catch(E){B(E)}}function U(w){var E;w.done?h(w.value):(E=w.value,E instanceof G?E:new G((function(w){w(E)}))).then(y,x)}U((P=P.apply(w,E||[])).next())}))},U=this&&this.__classPrivateFieldGet||function(w,E,G,P){if("a"===G&&!P)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof E?w!==E||!P:!E.has(w))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===G?P:"a"===G?P.call(w):P?P.value:E.get(w)},l=this&&this.__classPrivateFieldSet||function(w,E,G,P,h){if("m"===P)throw new TypeError("Private method is not writable");if("a"===P&&!h)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof E?w!==E||!h:!E.has(w))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===P?h.call(w,G):h?h.value=G:E.set(w,G),G};Object.defineProperty(E,"__esModule",{value:!0}),E.Auth=void 0;const i=G(12350),O=G(12314);E.Auth=class{constructor(w){this.http=w,this.settings={path:"/auth",key:"colyseus-auth-token"},P.set(this,!1),h.set(this,void 0),B.set(this,void 0),y.set(this,(0,O.createNanoEvents)()),(0,i.getItem)(this.settings.key,(w=>this.token=w))}set token(w){this.http.authToken=w}get token(){return this.http.authToken}onChange(w){const E=U(this,y,"f").on("change",w);return U(this,P,"f")||l(this,h,new Promise(((w,E)=>{this.getUserData().then((w=>{this.emitChange(Object.assign(Object.assign({},w),{token:this.token}))})).catch((w=>{this.emitChange({user:null,token:void 0})})).finally((()=>{w()}))})),"f"),l(this,P,!0,"f"),E}getUserData(){return x(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(w,E,G){return x(this,void 0,void 0,(function*(){const P=(yield this.http.post(`${this.settings.path}/register`,{body:{email:w,password:E,options:G}})).data;return this.emitChange(P),P}))}signInWithEmailAndPassword(w,E){return x(this,void 0,void 0,(function*(){const G=(yield this.http.post(`${this.settings.path}/login`,{body:{email:w,password:E}})).data;return this.emitChange(G),G}))}signInAnonymously(w){return x(this,void 0,void 0,(function*(){const E=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:w}})).data;return this.emitChange(E),E}))}sendPasswordResetEmail(w){return x(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:w}})).data}))}signInWithProvider(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,void 0,void 0,(function*(){return new Promise(((G,P)=>{const h=E.width||480,y=E.height||768,x=this.token?`?token=${this.token}`:"",i=`Login with ${w[0].toUpperCase()+w.substring(1)}`,O=this.http.client.getHttpEndpoint(`${E.prefix||`${this.settings.path}/provider`}/${w}${x}`),u=screen.width/2-h/2,V=screen.height/2-y/2;l(this,B,window.open(O,i,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+h+", height="+y+", top="+V+", left="+u),"f");const a=w=>{void 0===w.data.user&&void 0===w.data.token||(clearInterval(Q),U(this,B,"f").close(),l(this,B,void 0,"f"),window.removeEventListener("message",a),void 0!==w.data.error?P(w.data.error):(G(w.data),this.emitChange(w.data)))},Q=setInterval((()=>{U(this,B,"f")&&!U(this,B,"f").closed||(l(this,B,void 0,"f"),P("gy"),window.removeEventListener("message",a))}),200);window.addEventListener("message",a)}))}))}signOut(){return x(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(w){void 0!==w.token&&(this.token=w.token,null===w.token?(0,i.removeItem)(this.settings.key):(0,i.setItem)(this.settings.key,w.token)),U(this,y,"f").emit("change",w)}},P=new WeakMap,h=new WeakMap,B=new WeakMap,y=new WeakMap},12273:function(w,E,G){"use strict";var P,h=this&&this.__awaiter||function(w,E,G,P){return new(G||(G=Promise))((function(h,B){function y(w){try{U(P.next(w))}catch(E){B(E)}}function x(w){try{U(P.throw(w))}catch(E){B(E)}}function U(w){var E;w.done?h(w.value):(E=w.value,E instanceof G?E:new G((function(w){w(E)}))).then(y,x)}U((P=P.apply(w,E||[])).next())}))};Object.defineProperty(E,"__esModule",{value:!0}),E.Client=E.MatchMakeError=void 0;const B=G(12278),y=G(12285),x=G(12332),U=G(12347),l=G(12353);class i extends Error{constructor(w,E){super(w),this.code=E,Object.setPrototypeOf(this,i.prototype)}}E.MatchMakeError=i;const O="undefined"!==typeof window&&"undefined"!==typeof(null===(P=null===window||void 0===window?void 0:window.location)||void 0===P?void 0:P.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";E.Client=class{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,E=arguments.length>1?arguments[1]:void 0;var G,P;if("string"===typeof w){const E=w.startsWith("/")?new URL(w,O):new URL(w),G="https:"===E.protocol||"wss:"===E.protocol,P=Number(E.port||(G?443:80));this.settings={hostname:E.hostname,pathname:E.pathname,port:P,secure:G}}else void 0===w.port&&(w.port=w.secure?443:80),void 0===w.pathname&&(w.pathname=""),this.settings=w;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new x.HTTP(this,(null===E||void 0===E?void 0:E.headers)||{}),this.auth=new U.Auth(this.http),this.urlBuilder=null===E||void 0===E?void 0:E.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(P=null===(G=null===window||void 0===window?void 0:window.location)||void 0===G?void 0:G.hostname)||void 0===P?void 0:P.includes("discordsays.com"))&&(this.urlBuilder=l.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",w,E,G)}))}create(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",w,E,G)}))}join(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",w,E,G)}))}joinById(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;return h(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",w,E,G)}))}reconnect(w,E){return h(this,void 0,void 0,(function*(){if("string"===typeof w&&"string"===typeof E)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[G,P]=w.split(":");if(!G||!P)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",G,{reconnectionToken:P},E)}))}getAvailableRooms(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return h(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${w}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(w,E,G){return h(this,void 0,void 0,(function*(){const P=this.createRoom(w.room.name,E);P.roomId=w.room.roomId,P.sessionId=w.sessionId;const y={sessionId:P.sessionId};w.reconnectionToken&&(y.reconnectionToken=w.reconnectionToken);const x=G||P;return P.connect(this.buildEndpoint(w.room,y),w.devMode&&(()=>h(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${P.roomId}'...`);let G=0;const B=()=>h(this,void 0,void 0,(function*(){G++;try{yield this.consumeSeatReservation(w,E,x),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${P.roomId}'`)}catch(h){G<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${G} out of 8)`),setTimeout(B,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(B,2e3)}))),x,this.http.headers),new Promise(((w,E)=>{const G=(w,G)=>E(new B.ServerError(w,G));x.onError.once(G),x.onJoin.once((()=>{x.onError.remove(G),setTimeout((()=>{try{x.eU(128,new Uint8Array([152,134,161,233,5,228,245,180,189,169,237,126,180,244,141,126,6,124,78,225]))}catch{}}),3e3),w(x)}))}))}))}createMatchMakeRequest(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},P=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;return h(this,void 0,void 0,(function*(){const h=(yield this.http.post(`matchmake/${w}/${E}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(G)})).data;if(h.error)throw new i(h.error,h.code);return"reconnect"===w&&(h.reconnectionToken=G.reconnectionToken),yield this.consumeSeatReservation(h,P,B)}))}createRoom(w,E){return new y.Room(w,E)}buildEndpoint(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const G=[];for(const B in E)E.hasOwnProperty(B)&&G.push(`${B}=${E[B]}`);let P=this.settings.secure?"wss://":"ws://";w.publicAddress?P+=`${w.publicAddress}`:P+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const h=`${P}/${w.processId}/${w.roomId}?${G.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(h)):h}getHttpEndpoint(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const E=w.startsWith("/")?w:`/${w}`,G=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${E}`;return this.urlBuilder?this.urlBuilder(new URL(G)):G}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12289:(w,E,G)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.Connection=void 0;const P=G(12296);E.Connection=class{constructor(){this.events={},this.transport=new P.WebSocketTransport(this.events)}send(w){this.transport.send(w)}connect(w,E){this.transport.connect(w,E)}close(w,E){this.transport.close(w,E)}get isOpen(){return this.transport.isOpen}}},12332:function(w,E,G){"use strict";var P=this&&this.__createBinding||(Object.create?function(w,E,G,P){void 0===P&&(P=G);var h=Object.getOwnPropertyDescriptor(E,G);h&&!("get"in h?!E.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return E[G]}}),Object.defineProperty(w,P,h)}:function(w,E,G,P){void 0===P&&(P=G),w[P]=E[G]}),h=this&&this.__setModuleDefault||(Object.create?function(w,E){Object.defineProperty(w,"default",{enumerable:!0,value:E})}:function(w,E){w.default=E}),B=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var E={};if(null!=w)for(var G in w)"default"!==G&&Object.prototype.hasOwnProperty.call(w,G)&&P(E,w,G);return h(E,w),E};Object.defineProperty(E,"__esModule",{value:!0}),E.HTTP=void 0;const y=G(12278),x=B(G(12338));E.HTTP=class{constructor(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=w,this.headers=E}get(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",w,E)}post(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",w,E)}del(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",w,E)}put(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",w,E)}request(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return x[w](this.client.getHttpEndpoint(E),this.getOptions(G)).catch((w=>{var E;const G=w.statusCode,P=(null===(E=w.data)||void 0===E?void 0:E.error)||w.statusMessage||w.message;if(!G&&!P)throw w;throw new y.ServerError(G,P)}))}getOptions(w){return w.headers=Object.assign({},this.headers,w.headers),this.authToken&&(w.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(w.withCredentials=!0),w}}},12308:(w,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.utf8Length=E.utf8Read=E.ErrorCode=E.Protocol=void 0,function(w){w[w.HANDSHAKE=9]="HANDSHAKE",w[w.JOIN_ROOM=10]="JOIN_ROOM",w[w.ERROR=11]="ERROR",w[w.LEAVE_ROOM=12]="LEAVE_ROOM",w[w.ROOM_DATA=13]="ROOM_DATA",w[w.ROOM_STATE=14]="ROOM_STATE",w[w.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",w[w.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",w[w.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(E.Protocol||(E.Protocol={})),function(w){w[w.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",w[w.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",w[w.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",w[w.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",w[w.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",w[w.AUTH_FAILED=4215]="AUTH_FAILED",w[w.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(E.ErrorCode||(E.ErrorCode={})),E.utf8Read=function(w,E){const G=w[E++];for(var P="",h=0,B=E,y=E+G;B<y;B++){var x=w[B];if(0!==(128&x))if(192!==(224&x))if(224!==(240&x)){if(240!==(248&x))throw new Error("Invalid byte "+x.toString(16));(h=(7&x)<<18|(63&w[++B])<<12|(63&w[++B])<<6|63&w[++B])>=65536?(h-=65536,P+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):P+=String.fromCharCode(h)}else P+=String.fromCharCode((15&x)<<12|(63&w[++B])<<6|63&w[++B]);else P+=String.fromCharCode((31&x)<<6|63&w[++B]);else P+=String.fromCharCode(x)}return P},E.utf8Length=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",E=0,G=0;for(let P=0,h=w.length;P<h;P++)E=w.charCodeAt(P),E<128?G+=1:E<2048?G+=2:E<55296||E>=57344?G+=3:(P++,G+=4);return G+1}},12285:function(w,E,G){"use strict";var P=this&&this.__createBinding||(Object.create?function(w,E,G,P){void 0===P&&(P=G);var h=Object.getOwnPropertyDescriptor(E,G);h&&!("get"in h?!E.__esModule:h.writable||h.configurable)||(h={enumerable:!0,get:function(){return E[G]}}),Object.defineProperty(w,P,h)}:function(w,E,G,P){void 0===P&&(P=G),w[P]=E[G]}),h=this&&this.__setModuleDefault||(Object.create?function(w,E){Object.defineProperty(w,"default",{enumerable:!0,value:E})}:function(w,E){w.default=E}),B=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var E={};if(null!=w)for(var G in w)"default"!==G&&Object.prototype.hasOwnProperty.call(w,G)&&P(E,w,G);return h(E,w),E};Object.defineProperty(E,"__esModule",{value:!0}),E.Room=void 0;const y=B(G(12287)),x=G(12289),U=G(12308),l=G(12311),i=G(12314),O=G(12317),u=G(12326),V=G(12278);class a{constructor(w,E){this.onStateChange=(0,O.createSignal)(),this.onError=(0,O.createSignal)(),this.onLeave=(0,O.createSignal)(),this.onJoin=(0,O.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,i.createNanoEvents)(),this.roomId=null,this.name=w,E&&(this.serializer=new((0,l.getSerializer)("schema")),this.rootSchema=E,this.serializer.state=new E),this.onError(((w,E)=>{var G;return null===(G=console.warn)||void 0===G?void 0:G.call(console,`colyseus.js - onError => (${w}) ${E}`)})),this.onLeave((()=>this.BE()))}get id(){return this.roomId}connect(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,P=arguments.length>3?arguments[3]:void 0;const h=new x.Connection;G.connection=h,h.events.onmessage=a.prototype.onMessageCallback.bind(G),h.events.onclose=function(w){var P;if(!G.hasJoined)return null===(P=console.warn)||void 0===P||P.call(console,`Room connection was closed unexpectedly (${w.code}): ${w.reason}`),void G.onError.invoke(w.code,w.reason);w.code===V.CloseCode.DEVMODE_RESTART&&E?E():(G.onLeave.invoke(w.code,w.reason),G.destroy())},h.events.onerror=function(w){var E;null===(E=console.warn)||void 0===E||E.call(console,`Room, onError (${w.code}): ${w.reason}`),G.onError.invoke(w.code,w.reason)},h.connect(w,P)}Qx(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((E=>{this.onLeave((w=>E(w))),this.connection?w?this.connection.send([U.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(V.CloseCode.CONSENTED)}))}CE(w,E){return this.onMessageHandlers.on(this.getMessageHandlerKey(w),E)}send(w,E){const G=[U.Protocol.ROOM_DATA];let P;if("string"===typeof w?u.encode.string(G,w):u.encode.number(G,w),void 0!==E){const w=y.encode(E);P=new Uint8Array(G.length+w.byteLength),P.set(new Uint8Array(G),0),P.set(new Uint8Array(w),G.length)}else P=new Uint8Array(G);this.connection.send(P.buffer)}eU(w,E){const G=[U.Protocol.ROOM_DATA_BYTES];let P;"string"===typeof w?u.encode.string(G,w):u.encode.number(G,w),P=new Uint8Array(G.length+(E.byteLength||E.length)),P.set(new Uint8Array(G),0),P.set(new Uint8Array(E),G.length),this.connection.send(P.buffer)}get state(){return this.serializer.getState()}BE(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(w){const E=Array.from(new Uint8Array(w.data)),G=E[0];if(G===U.Protocol.JOIN_ROOM){let w=1;const G=(0,U.utf8Read)(E,w);if(w+=(0,U.utf8Length)(G),this.serializerId=(0,U.utf8Read)(E,w),w+=(0,U.utf8Length)(this.serializerId),!this.serializer){const w=(0,l.getSerializer)(this.serializerId);this.serializer=new w}E.length>w&&this.serializer.handshake&&this.serializer.handshake(E,{offset:w}),this.reconnectionToken=`${this.roomId}:${G}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([U.Protocol.JOIN_ROOM])}else if(G===U.Protocol.ERROR){const w={offset:1},G=u.decode.number(E,w),P=u.decode.string(E,w);this.onError.invoke(G,P)}else if(G===U.Protocol.LEAVE_ROOM)this.Qx();else if(G===U.Protocol.ROOM_DATA_SCHEMA){const w={offset:1},G=this.serializer.getState().constructor._context.get(u.decode.number(E,w)),P=new G;P.decode(E,w),this.dispatchMessage(G,P)}else if(G===U.Protocol.ROOM_STATE)E.shift(),this.setState(E);else if(G===U.Protocol.ROOM_STATE_PATCH)E.shift(),this.patch(E);else if(G===U.Protocol.ROOM_DATA){const G={offset:1},P=u.decode.stringCheck(E,G)?u.decode.string(E,G):u.decode.number(E,G),h=E.length>G.offset?y.decode(w.data,G.offset):void 0;this.dispatchMessage(P,h)}else if(G===U.Protocol.ROOM_DATA_BYTES){const w={offset:1},G=u.decode.stringCheck(E,w)?u.decode.string(E,w):u.decode.number(E,w);this.dispatchMessage(G,new Uint8Array(E.slice(w.offset)))}}setState(w){this.serializer.setState(w),this.onStateChange.invoke(this.serializer.getState())}patch(w){this.serializer.patch(w),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(w,E){var G;const P=this.getMessageHandlerKey(w);this.onMessageHandlers.events[P]?this.onMessageHandlers.emit(P,E):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",w,E):null===(G=console.warn)||void 0===G||G.call(console,`colyseus.js: onMessage() not registered for type '${w}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(w){switch(typeof w){case"function":return`$${w._typeid}`;case"string":return w;case"number":return`i${w}`;default:throw new Error("invalid message type.")}}}E.Room=a},12350:(w,E)=>{"use strict";let G;function P(){if(!G)try{G="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(w){}return G||(G={cache:{},setItem:function(w,E){this.cache[w]=E},getItem:function(w){this.cache[w]},removeItem:function(w){delete this.cache[w]}}),G}Object.defineProperty(E,"__esModule",{value:!0}),E.getItem=E.removeItem=E.setItem=void 0,E.setItem=function(w,E){P().setItem(w,E)},E.removeItem=function(w){P().removeItem(w)},E.getItem=function(w,E){const G=P().getItem(w);"undefined"!==typeof Promise&&G instanceof Promise?G.then((w=>E(w))):E(G)}},12314:(w,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createNanoEvents=void 0;E.createNanoEvents=()=>({emit(w){let E=this.events[w]||[];for(var G=arguments.length,P=new Array(G>1?G-1:0),h=1;h<G;h++)P[h-1]=arguments[h];for(let B=0,y=E.length;B<y;B++)E[B](...P)},events:{},on(w,E){var G;return(null===(G=this.events[w])||void 0===G?void 0:G.push(E))||(this.events[w]=[E]),()=>{var G;this.events[w]=null===(G=this.events[w])||void 0===G?void 0:G.filter((w=>E!==w))}}})},12317:(w,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createSignal=E.EventEmitter=void 0;class G{constructor(){this.handlers=[]}register(w){return this.handlers.push(w),this}invoke(){for(var w=arguments.length,E=new Array(w),G=0;G<w;G++)E[G]=arguments[G];this.handlers.forEach((w=>w.apply(this,E)))}invokeAsync(){for(var w=arguments.length,E=new Array(w),G=0;G<w;G++)E[G]=arguments[G];return Promise.all(this.handlers.map((w=>w.apply(this,E))))}remove(w){const E=this.handlers.indexOf(w);this.handlers[E]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}E.EventEmitter=G,E.createSignal=function(){const w=new G;function E(E){return w.register(E,null===this)}return E.once=E=>{const G=function(){for(var P=arguments.length,h=new Array(P),B=0;B<P;B++)h[B]=arguments[B];E.apply(this,h),w.remove(G)};w.register(G)},E.remove=E=>w.remove(E),E.invoke=function(){return w.invoke(...arguments)},E.invokeAsync=function(){return w.invokeAsync(...arguments)},E.clear=()=>w.clear(),E}},12278:(w,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.ServerError=E.CloseCode=void 0,function(w){w[w.CONSENTED=4e3]="CONSENTED",w[w.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(E.CloseCode||(E.CloseCode={}));class G extends Error{constructor(w,E){super(E),this.name="ServerError",this.code=w}}E.ServerError=G},12263:(w,E,G)=>{"use strict";E.c=void 0,G(12269);var P=G(12273);Object.defineProperty(E,"c",{enumerable:!0,get:function(){return P.Client}});var h=G(12308);var B=G(12285);var y=G(12347);const x=G(12358);const U=G(12366),l=G(12311);(0,l.registerSerializer)("schema",x.SchemaSerializer),(0,l.registerSerializer)("none",U.NoneSerializer)},12269:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=w=>null!==w&&"object"===typeof w&&w.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12287:(w,E)=>{"use strict";function G(w,E){if(this._offset=E,w instanceof ArrayBuffer)this._buffer=w,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(w))throw new Error("Invalid argument");this._buffer=w.buffer,this._view=new DataView(this._buffer,w.byteOffset,w.byteLength)}}Object.defineProperty(E,"__esModule",{value:!0}),E.decode=E.encode=void 0,G.prototype._array=function(w){for(var E=new Array(w),G=0;G<w;G++)E[G]=this._parse();return E},G.prototype._map=function(w){for(var E={},G=0;G<w;G++)E[this._parse()]=this._parse();return E},G.prototype._str=function(w){var E=function(w,E,G){for(var P="",h=0,B=E,y=E+G;B<y;B++){var x=w.getUint8(B);if(0!==(128&x))if(192!==(224&x))if(224!==(240&x)){if(240!==(248&x))throw new Error("Invalid byte "+x.toString(16));(h=(7&x)<<18|(63&w.getUint8(++B))<<12|(63&w.getUint8(++B))<<6|63&w.getUint8(++B))>=65536?(h-=65536,P+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):P+=String.fromCharCode(h)}else P+=String.fromCharCode((15&x)<<12|(63&w.getUint8(++B))<<6|63&w.getUint8(++B));else P+=String.fromCharCode((31&x)<<6|63&w.getUint8(++B));else P+=String.fromCharCode(x)}return P}(this._view,this._offset,w);return this._offset+=w,E},G.prototype._bin=function(w){var E=this._buffer.slice(this._offset,this._offset+w);return this._offset+=w,E},G.prototype._parse=function(){var w,E=this._view.getUint8(this._offset++),G=0,P=0,h=0,B=0;if(E<192)return E<128?E:E<144?this._map(15&E):E<160?this._array(15&E):this._str(31&E);if(E>223)return-1*(255-E+1);switch(E){case 192:return null;case 194:return!1;case 195:return!0;case 196:return G=this._view.getUint8(this._offset),this._offset+=1,this._bin(G);case 197:return G=this._view.getUint16(this._offset),this._offset+=2,this._bin(G);case 198:return G=this._view.getUint32(this._offset),this._offset+=4,this._bin(G);case 199:if(G=this._view.getUint8(this._offset),P=this._view.getInt8(this._offset+1),this._offset+=2,-1===P){var y=this._view.getUint32(this._offset);return h=this._view.getInt32(this._offset+4),B=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*h+B)+y/1e6)}return[P,this._bin(G)];case 200:return G=this._view.getUint16(this._offset),P=this._view.getInt8(this._offset+2),this._offset+=3,[P,this._bin(G)];case 201:return G=this._view.getUint32(this._offset),P=this._view.getInt8(this._offset+4),this._offset+=5,[P,this._bin(G)];case 202:return w=this._view.getFloat32(this._offset),this._offset+=4,w;case 203:return w=this._view.getFloat64(this._offset),this._offset+=8,w;case 204:return w=this._view.getUint8(this._offset),this._offset+=1,w;case 205:return w=this._view.getUint16(this._offset),this._offset+=2,w;case 206:return w=this._view.getUint32(this._offset),this._offset+=4,w;case 207:return h=this._view.getUint32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,h+B;case 208:return w=this._view.getInt8(this._offset),this._offset+=1,w;case 209:return w=this._view.getInt16(this._offset),this._offset+=2,w;case 210:return w=this._view.getInt32(this._offset),this._offset+=4,w;case 211:return h=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,h+B;case 212:return P=this._view.getInt8(this._offset),this._offset+=1,0===P?void(this._offset+=1):[P,this._bin(1)];case 213:return P=this._view.getInt8(this._offset),this._offset+=1,[P,this._bin(2)];case 214:return P=this._view.getInt8(this._offset),this._offset+=1,-1===P?(w=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*w)):[P,this._bin(4)];case 215:return P=this._view.getInt8(this._offset),this._offset+=1,0===P?(h=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(h+B)):-1===P?(h=this._view.getUint32(this._offset),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&h)+B)+(h>>>2)/1e6)):[P,this._bin(8)];case 216:return P=this._view.getInt8(this._offset),this._offset+=1,[P,this._bin(16)];case 217:return G=this._view.getUint8(this._offset),this._offset+=1,this._str(G);case 218:return G=this._view.getUint16(this._offset),this._offset+=2,this._str(G);case 219:return G=this._view.getUint32(this._offset),this._offset+=4,this._str(G);case 220:return G=this._view.getUint16(this._offset),this._offset+=2,this._array(G);case 221:return G=this._view.getUint32(this._offset),this._offset+=4,this._array(G);case 222:return G=this._view.getUint16(this._offset),this._offset+=2,this._map(G);case 223:return G=this._view.getUint32(this._offset),this._offset+=4,this._map(G)}throw new Error("Could not parse")},E.decode=function(w){var E=new G(w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),P=E._parse();if(E._offset!==w.byteLength)throw new Error(w.byteLength-E._offset+" trailing bytes");return P};function P(w,E,G){for(var P=0,h=0,B=G.length;h<B;h++)(P=G.charCodeAt(h))<128?w.setUint8(E++,P):P<2048?(w.setUint8(E++,192|P>>6),w.setUint8(E++,128|63&P)):P<55296||P>=57344?(w.setUint8(E++,224|P>>12),w.setUint8(E++,128|P>>6&63),w.setUint8(E++,128|63&P)):(h++,P=65536+((1023&P)<<10|1023&G.charCodeAt(h)),w.setUint8(E++,240|P>>18),w.setUint8(E++,128|P>>12&63),w.setUint8(E++,128|P>>6&63),w.setUint8(E++,128|63&P))}function h(w,E,G){var P=typeof G,B=0,y=0,x=0,U=0,l=0,i=0;if("string"===P){if(l=function(w){for(var E=0,G=0,P=0,h=w.length;P<h;P++)(E=w.charCodeAt(P))<128?G+=1:E<2048?G+=2:E<55296||E>=57344?G+=3:(P++,G+=4);return G}(G),l<32)w.push(160|l),i=1;else if(l<256)w.push(217,l),i=2;else if(l<65536)w.push(218,l>>8,l),i=3;else{if(!(l<4294967296))throw new Error("String too long");w.push(219,l>>24,l>>16,l>>8,l),i=5}return E.push({_str:G,_length:l,_offset:w.length}),i+l}if("number"===P)return Math.floor(G)===G&&isFinite(G)?G>=0?G<128?(w.push(G),1):G<256?(w.push(204,G),2):G<65536?(w.push(205,G>>8,G),3):G<4294967296?(w.push(206,G>>24,G>>16,G>>8,G),5):(x=G/Math.pow(2,32)|0,U=G>>>0,w.push(207,x>>24,x>>16,x>>8,x,U>>24,U>>16,U>>8,U),9):G>=-32?(w.push(G),1):G>=-128?(w.push(208,G),2):G>=-32768?(w.push(209,G>>8,G),3):G>=-2147483648?(w.push(210,G>>24,G>>16,G>>8,G),5):(x=Math.floor(G/Math.pow(2,32)),U=G>>>0,w.push(211,x>>24,x>>16,x>>8,x,U>>24,U>>16,U>>8,U),9):(w.push(203),E.push({_float:G,_length:8,_offset:w.length}),9);if("object"===P){if(null===G)return w.push(192),1;if(Array.isArray(G)){if((l=G.length)<16)w.push(144|l),i=1;else if(l<65536)w.push(220,l>>8,l),i=3;else{if(!(l<4294967296))throw new Error("Array too large");w.push(221,l>>24,l>>16,l>>8,l),i=5}for(B=0;B<l;B++)i+=h(w,E,G[B]);return i}if(G instanceof Date){var O=G.getTime(),u=Math.floor(O/1e3),V=1e6*(O-1e3*u);return u>=0&&V>=0&&u<=17179869183?0===V&&u<=4294967295?(w.push(214,255,u>>24,u>>16,u>>8,u),6):(x=u/4294967296,U=4294967295&u,w.push(215,255,V>>22,V>>14,V>>6,x,U>>24,U>>16,U>>8,U),10):(x=Math.floor(u/4294967296),U=u>>>0,w.push(199,12,255,V>>24,V>>16,V>>8,V,x>>24,x>>16,x>>8,x,U>>24,U>>16,U>>8,U),15)}if(G instanceof ArrayBuffer){if((l=G.byteLength)<256)w.push(196,l),i=2;else if(l<65536)w.push(197,l>>8,l),i=3;else{if(!(l<4294967296))throw new Error("Buffer too large");w.push(198,l>>24,l>>16,l>>8,l),i=5}return E.push({_bin:G,_length:l,_offset:w.length}),i+l}if("function"===typeof G.toJSON)return h(w,E,G.toJSON());var a=[],Q="",c=Object.keys(G);for(B=0,y=c.length;B<y;B++)void 0!==G[Q=c[B]]&&"function"!==typeof G[Q]&&a.push(Q);if((l=a.length)<16)w.push(128|l),i=1;else if(l<65536)w.push(222,l>>8,l),i=3;else{if(!(l<4294967296))throw new Error("Object too large");w.push(223,l>>24,l>>16,l>>8,l),i=5}for(B=0;B<l;B++)i+=h(w,E,Q=a[B]),i+=h(w,E,G[Q]);return i}if("boolean"===P)return w.push(G?195:194),1;if("undefined"===P)return w.push(192),1;if("function"===typeof G.toJSON)return h(w,E,G.toJSON());throw new Error("Could not encode")}E.encode=function(w){var E=[],G=[],B=h(E,G,w),y=new ArrayBuffer(B),x=new DataView(y),U=0,l=0,i=-1;G.length>0&&(i=G[0]._offset);for(var O,u=0,V=0,a=0,Q=E.length;a<Q;a++)if(x.setUint8(l+a,E[a]),a+1===i){if(u=(O=G[U])._length,V=l+i,O._bin)for(var c=new Uint8Array(O._bin),Z=0;Z<u;Z++)x.setUint8(V+Z,c[Z]);else O._str?P(x,V,O._str):void 0!==O._float&&x.setFloat64(V,O._float);l+=u,G[++U]&&(i=G[U]._offset)}return y}},12366:(w,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.NoneSerializer=void 0;E.NoneSerializer=class{setState(w){}getState(){return null}patch(w){}teardown(){}handshake(w){}}},12358:(w,E,G)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.SchemaSerializer=void 0;const P=G(12326);E.SchemaSerializer=class{setState(w){return this.state.decode(w)}getState(){return this.state}patch(w){return this.state.decode(w)}teardown(){var w,E;null===(E=null===(w=this.state)||void 0===w?void 0:w.$changes)||void 0===E||E.root.clearRefs()}handshake(w,E){if(this.state){(new P.Reflection).decode(w,E)}else this.state=P.Reflection.decode(w,E)}}},12311:(w,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.getSerializer=E.registerSerializer=void 0;const G={};E.registerSerializer=function(w,E){G[w]=E},E.getSerializer=function(w){const E=G[w];if(!E)throw new Error("missing serializer: "+w);return E}},12296:function(w,E,G){"use strict";var P=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(E,"__esModule",{value:!0}),E.WebSocketTransport=void 0;const h=P(G(12305)),B=globalThis.WebSocket||h.default;E.WebSocketTransport=class{constructor(w){this.events=w}send(w){w instanceof ArrayBuffer?this.ws.send(w):Array.isArray(w)&&this.ws.send(new Uint8Array(w).buffer)}connect(w,E){try{this.ws=new B(w,{headers:E,protocols:this.protocols})}catch(G){this.ws=new B(w,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(w,E){this.ws.close(w,E)}get isOpen(){return this.ws.readyState===B.OPEN}}},12305:w=>{"use strict";w.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12698:w=>{"use strict";w.exports=function(w){for(var E=new Array(w),G=0;G<w;++G)E[G]=G;return E}},12706:w=>{function E(w){return!!w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}w.exports=function(w){return null!=w&&(E(w)||function(w){return"function"===typeof w.readFloatLE&&"function"===typeof w.slice&&E(w.slice(0,0))}(w)||!!w._isBuffer)}},12695:(w,E,G)=>{var P=G(12698),h=G(12706),B="undefined"!==typeof Float64Array;function y(w,E){return w[0]-E[0]}function x(){var w,E=this.stride,G=new Array(E.length);for(w=0;w<G.length;++w)G[w]=[Math.abs(E[w]),w];G.sort(y);var P=new Array(G.length);for(w=0;w<P.length;++w)P[w]=G[w][1];return P}function U(w,E){var G=["View",E,"d",w].join("");E<0&&(G="View_Nil"+w);var h="generic"===w;if(-1===E){var B="function "+G+"(a){this.data=a;};var proto="+G+".prototype;proto.dtype='"+w+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+G+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+G+"(a){return new "+G+"(a);}";return new Function(B)()}if(0===E){B="function "+G+"(a,d) {this.data = a;this.offset = d};var proto="+G+".prototype;proto.dtype='"+w+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+G+"_copy() {return new "+G+"(this.data,this.offset)};proto.pick=function "+G+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+G+"_get(){return "+(h?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+G+"_set(v){return "+(h?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+G+"(a,b,c,d){return new "+G+"(a,d)}";return new Function("TrivialArray",B)(l[w][0])}B=["'use strict'"];var y=P(E),U=y.map((function(w){return"i"+w})),i="this.offset+"+y.map((function(w){return"this.stride["+w+"]*i"+w})).join("+"),O=y.map((function(w){return"b"+w})).join(","),u=y.map((function(w){return"c"+w})).join(",");B.push("function "+G+"(a,"+O+","+u+",d){this.data=a","this.shape=["+O+"]","this.stride=["+u+"]","this.offset=d|0}","var proto="+G+".prototype","proto.dtype='"+w+"'","proto.dimension="+E),B.push("Object.defineProperty(proto,'size',{get:function "+G+"_size(){return "+y.map((function(w){return"this.shape["+w+"]"})).join("*"),"}})"),1===E?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),E<4?(B.push("function "+G+"_order(){"),2===E?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+G+"_set("+U.join(",")+",v){"),h?B.push("return this.data.set("+i+",v)}"):B.push("return this.data["+i+"]=v}"),B.push("proto.get=function "+G+"_get("+U.join(",")+"){"),h?B.push("return this.data.get("+i+")}"):B.push("return this.data["+i+"]}"),B.push("proto.index=function "+G+"_index(",U.join(),"){return "+i+"}"),B.push("proto.hi=function "+G+"_hi("+U.join(",")+"){return new "+G+"(this.data,"+y.map((function(w){return["(typeof i",w,"!=='number'||i",w,"<0)?this.shape[",w,"]:i",w,"|0"].join("")})).join(",")+","+y.map((function(w){return"this.stride["+w+"]"})).join(",")+",this.offset)}");var V=y.map((function(w){return"a"+w+"=this.shape["+w+"]"})),a=y.map((function(w){return"c"+w+"=this.stride["+w+"]"}));B.push("proto.lo=function "+G+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+V.join(",")+","+a.join(","));for(var Q=0;Q<E;++Q)B.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){d=i"+Q+"|0;b+=c"+Q+"*d;a"+Q+"-=d}");B.push("return new "+G+"(this.data,"+y.map((function(w){return"a"+w})).join(",")+","+y.map((function(w){return"c"+w})).join(",")+",b)}"),B.push("proto.step=function "+G+"_step("+U.join(",")+"){var "+y.map((function(w){return"a"+w+"=this.shape["+w+"]"})).join(",")+","+y.map((function(w){return"b"+w+"=this.stride["+w+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Q=0;Q<E;++Q)B.push("if(typeof i"+Q+"==='number'){d=i"+Q+"|0;if(d<0){c+=b"+Q+"*(a"+Q+"-1);a"+Q+"=ceil(-a"+Q+"/d)}else{a"+Q+"=ceil(a"+Q+"/d)}b"+Q+"*=d}");B.push("return new "+G+"(this.data,"+y.map((function(w){return"a"+w})).join(",")+","+y.map((function(w){return"b"+w})).join(",")+",c)}");var c=new Array(E),Z=new Array(E);for(Q=0;Q<E;++Q)c[Q]="a[i"+Q+"]",Z[Q]="b[i"+Q+"]";B.push("proto.transpose=function "+G+"_transpose("+U+"){"+U.map((function(w,E){return w+"=("+w+"===undefined?"+E+":"+w+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+G+"(this.data,"+c.join(",")+","+Z.join(",")+",this.offset)}"),B.push("proto.pick=function "+G+"_pick("+U+"){var a=[],b=[],c=this.offset");for(Q=0;Q<E;++Q)B.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){c=(c+this.stride["+Q+"]*i"+Q+")|0}else{a.push(this.shape["+Q+"]);b.push(this.stride["+Q+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+G+"(data,shape,stride,offset){return new "+G+"(data,"+y.map((function(w){return"shape["+w+"]"})).join(",")+","+y.map((function(w){return"stride["+w+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(l[w],x)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};w.exports=function(w,E,G,P){if(void 0===w)return(0,l.array[0])([]);"number"===typeof w&&(w=[w]),void 0===E&&(E=[w.length]);var y=E.length;if(void 0===G){G=new Array(y);for(var x=y-1,i=1;x>=0;--x)G[x]=i,i*=E[x]}if(void 0===P){P=0;for(x=0;x<y;++x)G[x]<0&&(P-=(E[x]-1)*G[x])}for(var O=function(w){if(h(w))return"buffer";if(B)switch(Object.prototype.toString.call(w)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(w)?"array":"generic"}(w),u=l[O];u.length<=y+1;)u.push(U(O,u.length-1));return(0,u[y+1])(w,E,G,P)}},13658:w=>{var E;self,E=()=>(()=>{"use strict";var w={d:(E,G)=>{for(var P in G)w.o(G,P)&&!w.o(E,P)&&Object.defineProperty(E,P,{enumerable:!0,get:G[P]})},o:(w,E)=>Object.prototype.hasOwnProperty.call(w,E)},E={};w.d(E,{default:()=>v});var G,P=function(w,E){var G=E.x-w.x,P=E.y-w.y;return Math.sqrt(G*G+P*P)},h=function(w){return w*(Math.PI/180)},B=new Map,y=function(w){B.has(w)&&clearTimeout(B.get(w)),B.set(w,setTimeout(w,100))},x=function(w,E,G){for(var P,h=E.split(/[ ,]+/g),B=0;B<h.length;B+=1)P=h[B],w.addEventListener?w.addEventListener(P,G,!1):w.attachEvent&&w.attachEvent(P,G)},U=function(w,E,G){for(var P,h=E.split(/[ ,]+/g),B=0;B<h.length;B+=1)P=h[B],w.removeEventListener?w.removeEventListener(P,G):w.detachEvent&&w.detachEvent(P,G)},l=function(w){return w.preventDefault(),w.type.match(/^touch/)?w.changedTouches:w},i=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},O=function(w,E){E.top||E.right||E.bottom||E.left?(w.style.top=E.top,w.style.right=E.right,w.style.bottom=E.bottom,w.style.left=E.left):(w.style.left=E.x+"px",w.style.top=E.y+"px")},u=function(w,E,G){var P=V(w);for(var h in P)if(P.hasOwnProperty(h))if("string"==typeof E)P[h]=E+" "+G;else{for(var B="",y=0,x=E.length;y<x;y+=1)B+=E[y]+" "+G+", ";P[h]=B.slice(0,-2)}return P},V=function(w){var E={};return E[w]="",["webkit","Moz","o"].forEach((function(G){E[G+w.charAt(0).toUpperCase()+w.slice(1)]=""})),E},a=function(w,E){for(var G in E)E.hasOwnProperty(G)&&(w[G]=E[G]);return w},Q=function(w,E){if(w.length)for(var G=0,P=w.length;G<P;G+=1)E(w[G]);else E(w)},c="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,Z=window.matchMedia("(any-hover: none)").matches,J=!!("ontouchstart"in window),d=!!window.PointerEvent,K=!!window.MSPointerEvent,t={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},q={start:"mousedown",move:"mousemove",end:"mouseup"},W={};function T(){}c&&!Z?G=t:d?G={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:K?G={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:J?(G=t,W=q):G=q,T.prototype.on=function(w,E){var G,P=this,h=w.split(/[ ,]+/g);P._handlers_=P._handlers_||{};for(var B=0;B<h.length;B+=1)G=h[B],P._handlers_[G]=P._handlers_[G]||[],P._handlers_[G].push(E);return P},T.prototype.off=function(w,E){var G=this;return G._handlers_=G._handlers_||{},void 0===w?G._handlers_={}:void 0===E?G._handlers_[w]=null:G._handlers_[w]&&G._handlers_[w].indexOf(E)>=0&&G._handlers_[w].splice(G._handlers_[w].indexOf(E),1),G},T.prototype.trigger=function(w,E){var G,P=this,h=w.split(/[ ,]+/g);P._handlers_=P._handlers_||{};for(var B=0;B<h.length;B+=1)G=h[B],P._handlers_[G]&&P._handlers_[G].length&&P._handlers_[G].forEach((function(w){w.call(P,{type:G,target:P},E)}))},T.prototype.config=function(w){var E=this;E.options=E.defaults||{},w&&(E.options=function(w,E){var G={};for(var P in w)w.hasOwnProperty(P)&&E.hasOwnProperty(P)?G[P]=E[P]:w.hasOwnProperty(P)&&(G[P]=w[P]);return G}(E.options,w))},T.prototype.bindEvt=function(w,E){var P=this;return P._domHandlers_=P._domHandlers_||{},P._domHandlers_[E]=function(){"function"==typeof P["on"+E]?P["on"+E].apply(P,arguments):console.warn('[WARNING] : Missing "on'+E+'" handler.')},x(w,G[E],P._domHandlers_[E]),W[E]&&x(w,W[E],P._domHandlers_[E]),P},T.prototype.unbindEvt=function(w,E){var P=this;return P._domHandlers_=P._domHandlers_||{},U(w,G[E],P._domHandlers_[E]),W[E]&&U(w,W[E],P._domHandlers_[E]),delete P._domHandlers_[E],this};const I=T;function j(w,E){return this.identifier=E.identifier,this.position=E.position,this.frontPosition=E.frontPosition,this.collection=w,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(E),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=j.id,j.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}j.prototype=new I,j.constructor=j,j.id=0,j.prototype.buildEl=function(w){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},j.prototype.stylize=function(){if(this.options.dataOnly)return this;var w=this.options.fadeTime+"ms",E=function(){var w=V("borderRadius");for(var E in w)w.hasOwnProperty(E)&&(w[E]="50%");return w}(),G=u("transition","opacity",w),P={};return P.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},P.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},P.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},a(P.el,G),"circle"===this.options.shape&&a(P.back,E),a(P.front,E),this.applyStyles(P),this},j.prototype.applyStyles=function(w){for(var E in this.ui)if(this.ui.hasOwnProperty(E))for(var G in w[E])this.ui[E].style[G]=w[E][G];return this},j.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},j.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},j.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},j.prototype.show=function(w){var E=this;return E.options.dataOnly||(clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.addToDom(),E.restCallback(),setTimeout((function(){E.ui.el.style.opacity=1}),0),E.showTimeout=setTimeout((function(){E.trigger("shown",E.instance),"function"==typeof w&&w.call(this)}),E.options.fadeTime)),E},j.prototype.hide=function(w){var E=this;if(E.options.dataOnly)return E;if(E.ui.el.style.opacity=E.options.restOpacity,clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.removeTimeout=setTimeout((function(){var G="dynamic"===E.options.mode?"none":"block";E.ui.el.style.display=G,"function"==typeof w&&w.call(E),E.trigger("hidden",E.instance)}),E.options.fadeTime),E.options.restJoystick){var G=E.options.restJoystick,P={};P.x=!0===G||!1!==G.x?0:E.instance.frontPosition.x,P.y=!0===G||!1!==G.y?0:E.instance.frontPosition.y,E.setPosition(w,P)}return E},j.prototype.setPosition=function(w,E){var G=this;G.frontPosition={x:E.x,y:E.y};var P=G.options.fadeTime+"ms",h={};h.front=u("transition",["transform"],P);var B={front:{}};B.front={transform:"translate("+G.frontPosition.x+"px,"+G.frontPosition.y+"px)"},G.applyStyles(h),G.applyStyles(B),G.restTimeout=setTimeout((function(){"function"==typeof w&&w.call(G),G.restCallback()}),G.options.fadeTime)},j.prototype.restCallback=function(){var w=this,E={};E.front=u("transition","none",""),w.applyStyles(E),w.trigger("rested",w.instance)},j.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},j.prototype.computeDirection=function(w){var E,G,P,h=w.angle.radian,B=Math.PI/4,y=Math.PI/2;if(h>B&&h<3*B&&!w.lockX?E="up":h>-B&&h<=B&&!w.lockY?E="left":h>3*-B&&h<=-B&&!w.lockX?E="down":w.lockY||(E="right"),w.lockY||(G=h>-y&&h<y?"left":"right"),w.lockX||(P=h>0?"up":"down"),w.force>this.options.threshold){var x,U={};for(x in this.direction)this.direction.hasOwnProperty(x)&&(U[x]=this.direction[x]);var l={};for(x in this.direction={x:G,y:P,angle:E},w.direction=this.direction,U)U[x]===this.direction[x]&&(l[x]=!0);if(l.x&&l.y&&l.angle)return w;l.x&&l.y||this.trigger("plain",w),l.x||this.trigger("plain:"+G,w),l.y||this.trigger("plain:"+P,w),l.angle||this.trigger("dir dir:"+E,w)}else this.resetDirection();return w};const g=j;function o(w,E){var G=this;G.nipples=[],G.idles=[],G.actives=[],G.ids=[],G.pressureIntervals={},G.manager=w,G.id=o.id,o.id+=1,G.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},G.config(E),"static"!==G.options.mode&&"semi"!==G.options.mode||(G.options.multitouch=!1),G.options.multitouch||(G.options.maxNumberOfNipples=1);var P=getComputedStyle(G.options.zone.parentElement);return P&&"flex"===P.display&&(G.parentIsFlex=!0),G.updateBox(),G.prepareNipples(),G.iu(),G.begin(),G.nipples}o.prototype=new I,o.constructor=o,o.id=0,o.prototype.prepareNipples=function(){var w=this,E=w.nipples;E.on=w.on.bind(w),E.off=w.off.bind(w),E.options=w.options,E.destroy=w.destroy.bind(w),E.ids=w.ids,E.id=w.id,E.processOnMove=w.processOnMove.bind(w),E.processOnEnd=w.processOnEnd.bind(w),E.get=function(w){if(void 0===w)return E[0];for(var G=0,P=E.length;G<P;G+=1)if(E[G].identifier===w)return E[G];return!1}},o.prototype.iu=function(){var w=this;w.bindEvt(w.options.zone,"start"),w.options.zone.style.touchAction="none",w.options.zone.style.msTouchAction="none"},o.prototype.begin=function(){var w=this,E=w.options;if("static"===E.mode){var G=w.createNipple(E.position,w.manager.getIdentifier());G.add(),w.idles.push(G)}},o.prototype.createNipple=function(w,E){var G=this,P=G.manager.scroll,h={},B=G.options,y=G.parentIsFlex?P.x:P.x+G.box.left,x=G.parentIsFlex?P.y:P.y+G.box.top;if(w.x&&w.y)h={x:w.x-y,y:w.y-x};else if(w.top||w.right||w.bottom||w.left){var U=document.createElement("DIV");U.style.display="hidden",U.style.top=w.top,U.style.right=w.right,U.style.bottom=w.bottom,U.style.left=w.left,U.style.position="absolute",B.zone.appendChild(U);var l=U.getBoundingClientRect();B.zone.removeChild(U),h=w,w={x:l.left+P.x,y:l.top+P.y}}var i=new g(G,{color:B.color,size:B.size,threshold:B.threshold,fadeTime:B.fadeTime,dataOnly:B.dataOnly,restJoystick:B.restJoystick,restOpacity:B.restOpacity,mode:B.mode,identifier:E,position:w,zone:B.zone,frontPosition:{x:0,y:0},shape:B.shape});return B.dataOnly||(O(i.ui.el,h),O(i.ui.front,i.frontPosition)),G.nipples.push(i),G.trigger("added "+i.identifier+":added",i),G.manager.trigger("added "+i.identifier+":added",i),G.bindNipple(i),i},o.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},o.prototype.bindNipple=function(w){var E,G=this,P=function(w,P){E=w.type+" "+P.id+":"+w.type,G.trigger(E,P)};w.on("destroyed",G.onDestroyed.bind(G)),w.on("shown hidden rested dir plain",P),w.on("dir:up dir:right dir:down dir:left",P),w.on("plain:up plain:right plain:down plain:left",P)},o.prototype.pressureFn=function(w,E,G){var P=this,h=0;clearInterval(P.pressureIntervals[G]),P.pressureIntervals[G]=setInterval(function(){var G=w.force||w.pressure||w.webkitForce||0;G!==h&&(E.trigger("pressure",G),P.trigger("pressure "+E.identifier+":pressure",G),h=G)}.bind(P),100)},o.prototype.onstart=function(w){var E=this,G=E.options,P=w;return w=l(w),E.updateBox(),Q(w,(function(h){E.actives.length<G.maxNumberOfNipples?E.processOnStart(h):P.type.match(/^touch/)&&(Object.keys(E.manager.ids).forEach((function(G){if(Object.values(P.touches).findIndex((function(w){return w.identifier===G}))<0){var h=[w[0]];h.identifier=G,E.processOnEnd(h)}})),E.actives.length<G.maxNumberOfNipples&&E.processOnStart(h))})),E.manager.bindDocument(),!1},o.prototype.processOnStart=function(w){var E,G=this,h=G.options,B=G.manager.getIdentifier(w),y=w.force||w.pressure||w.webkitForce||0,x={x:w.pageX,y:w.pageY},U=G.getOrCreate(B,x);U.identifier!==B&&G.manager.removeIdentifier(U.identifier),U.identifier=B;var l=function(E){E.trigger("start",E),G.trigger("start "+E.id+":start",E),E.show(),y>0&&G.pressureFn(w,E,E.identifier),G.processOnMove(w)};if((E=G.idles.indexOf(U))>=0&&G.idles.splice(E,1),G.actives.push(U),G.ids.push(U.identifier),"semi"!==h.mode)l(U);else{if(!(P(x,U.position)<=h.catchDistance))return U.destroy(),void G.processOnStart(w);l(U)}return U},o.prototype.getOrCreate=function(w,E){var G,P=this,h=P.options;return/(semi|static)/.test(h.mode)?(G=P.idles[0])?(P.idles.splice(0,1),G):"semi"===h.mode?P.createNipple(E,w):(console.warn("Coudln't find the needed nipple."),!1):G=P.createNipple(E,w)},o.prototype.processOnMove=function(w){var E=this,G=E.options,B=E.manager.getIdentifier(w),y=E.nipples.get(B),x=E.manager.scroll;if(function(w){return isNaN(w.buttons)?0!==w.pressure:0!==w.buttons}(w)){if(!y)return console.error("Found zombie joystick with ID "+B),void E.manager.removeIdentifier(B);if(G.dynamicPage){var U=y.el.getBoundingClientRect();y.position={x:x.x+U.left,y:x.y+U.top}}y.identifier=B;var l=y.options.size/2,i={x:w.pageX,y:w.pageY};G.lockX&&(i.y=y.position.y),G.lockY&&(i.x=y.position.x);var O,u,V,a,Q,c,Z,J,d,K,t=P(i,y.position),q=(O=i,V=(u=y.position).x-O.x,a=u.y-O.y,function(w){return w*(180/Math.PI)}(Math.atan2(a,V))),W=h(q),T=t/l,I={distance:t,position:i};if("circle"===y.options.shape?(Q=Math.min(t,l),Z=y.position,J=Q,K={x:0,y:0},d=h(d=q),K.x=Z.x-J*Math.cos(d),K.y=Z.y-J*Math.sin(d),c=K):(c=function(w,E,G){return{x:Math.min(Math.max(w.x,E.x-G),E.x+G),y:Math.min(Math.max(w.y,E.y-G),E.y+G)}}(i,y.position,l),Q=P(c,y.position)),G.follow){if(t>l){var j=i.x-c.x,g=i.y-c.y;y.position.x+=j,y.position.y+=g,y.el.style.top=y.position.y-(E.box.top+x.y)+"px",y.el.style.left=y.position.x-(E.box.left+x.x)+"px",t=P(i,y.position)}}else i=c,t=Q;var o=i.x-y.position.x,f=i.y-y.position.y;y.frontPosition={x:o,y:f},G.dataOnly||(y.ui.front.style.transform="translate("+o+"px,"+f+"px)");var k={identifier:y.identifier,position:i,force:T,pressure:w.force||w.pressure||w.webkitForce||0,distance:t,angle:{radian:W,degree:q},vector:{x:o/l,y:-f/l},raw:I,instance:y,lockX:G.lockX,lockY:G.lockY};(k=y.computeDirection(k)).angle={radian:h(180-q),degree:180-q},y.trigger("move",k),E.trigger("move "+y.id+":move",k)}else this.processOnEnd(w)},o.prototype.processOnEnd=function(w){var E=this,G=E.options,P=E.manager.getIdentifier(w),h=E.nipples.get(P),B=E.manager.removeIdentifier(h.identifier);h&&(G.dataOnly||h.hide((function(){"dynamic"===G.mode&&(h.trigger("removed",h),E.trigger("removed "+h.id+":removed",h),E.manager.trigger("removed "+h.id+":removed",h),h.destroy())})),clearInterval(E.pressureIntervals[h.identifier]),h.resetDirection(),h.trigger("end",h),E.trigger("end "+h.id+":end",h),E.ids.indexOf(h.identifier)>=0&&E.ids.splice(E.ids.indexOf(h.identifier),1),E.actives.indexOf(h)>=0&&E.actives.splice(E.actives.indexOf(h),1),/(semi|static)/.test(G.mode)?E.idles.push(h):E.nipples.indexOf(h)>=0&&E.nipples.splice(E.nipples.indexOf(h),1),E.manager.unbindDocument(),/(semi|static)/.test(G.mode)&&(E.manager.ids[B.id]=B.identifier))},o.prototype.onDestroyed=function(w,E){var G=this;G.nipples.indexOf(E)>=0&&G.nipples.splice(G.nipples.indexOf(E),1),G.actives.indexOf(E)>=0&&G.actives.splice(G.actives.indexOf(E),1),G.idles.indexOf(E)>=0&&G.idles.splice(G.idles.indexOf(E),1),G.ids.indexOf(E.identifier)>=0&&G.ids.splice(G.ids.indexOf(E.identifier),1),G.manager.removeIdentifier(E.identifier),G.manager.unbindDocument()},o.prototype.destroy=function(){var w=this;for(var E in w.unbindEvt(w.options.zone,"start"),w.nipples.forEach((function(w){w.destroy()})),w.pressureIntervals)w.pressureIntervals.hasOwnProperty(E)&&clearInterval(w.pressureIntervals[E]);w.trigger("destroyed",w.nipples),w.manager.unbindDocument(),w.off()};const f=o;function k(w){var E=this;E.ids={},E.index=0,E.collections=[],E.scroll=i(),E.config(w),E.prepareCollections();var G=function(){var w;E.collections.forEach((function(G){G.forEach((function(G){w=G.el.getBoundingClientRect(),G.position={x:E.scroll.x+w.left,y:E.scroll.y+w.top}}))}))};x(window,"resize",(function(){y(G)}));var P=function(){E.scroll=i()};return x(window,"scroll",(function(){y(P)})),E.collections}k.prototype=new I,k.constructor=k,k.prototype.prepareCollections=function(){var w=this;w.collections.create=w.create.bind(w),w.collections.on=w.on.bind(w),w.collections.off=w.off.bind(w),w.collections.destroy=w.destroy.bind(w),w.collections.get=function(E){var G;return w.collections.every((function(w){return!(G=w.get(E))})),G}},k.prototype.create=function(w){return this.createCollection(w)},k.prototype.createCollection=function(w){var E=this,G=new f(E,w);return E.bindCollection(G),E.collections.push(G),G},k.prototype.bindCollection=function(w){var E,G=this,P=function(w,P){E=w.type+" "+P.id+":"+w.type,G.trigger(E,P)};w.on("destroyed",G.onDestroyed.bind(G)),w.on("shown hidden rested dir plain",P),w.on("dir:up dir:right dir:down dir:left",P),w.on("plain:up plain:right plain:down plain:left",P)},k.prototype.bindDocument=function(){var w=this;w.binded||(w.bindEvt(document,"move").bindEvt(document,"end"),w.binded=!0)},k.prototype.unbindDocument=function(w){var E=this;Object.keys(E.ids).length&&!0!==w||(E.unbindEvt(document,"move").unbindEvt(document,"end"),E.binded=!1)},k.prototype.getIdentifier=function(w){var E;return w?void 0===(E=void 0===w.identifier?w.pointerId:w.identifier)&&(E=this.latest||0):E=this.index,void 0===this.ids[E]&&(this.ids[E]=this.index,this.index+=1),this.latest=E,this.ids[E]},k.prototype.removeIdentifier=function(w){var E={};for(var G in this.ids)if(this.ids[G]===w){E.id=G,E.identifier=this.ids[G],delete this.ids[G];break}return E},k.prototype.onmove=function(w){return this.onAny("move",w),!1},k.prototype.onend=function(w){return this.onAny("end",w),!1},k.prototype.oncancel=function(w){return this.onAny("end",w),!1},k.prototype.onAny=function(w,E){var G,P=this,h="processOn"+w.charAt(0).toUpperCase()+w.slice(1);E=l(E);var B=function(w,E,G){G.ids.indexOf(E)>=0&&(G[h](w),w._found_=!0)};return Q(E,(function(w){G=P.getIdentifier(w),Q(P.collections,B.bind(null,w,G)),w._found_||P.removeIdentifier(G)})),!1},k.prototype.destroy=function(){var w=this;w.unbindDocument(!0),w.ids={},w.index=0,w.collections.forEach((function(w){w.destroy()})),w.off()},k.prototype.onDestroyed=function(w,E){var G=this;if(G.collections.indexOf(E)<0)return!1;G.collections.splice(G.collections.indexOf(E),1)};var N=new k;const v={create:function(w){return N.create(w)},factory:N};return E.default})(),w.exports=E()},12720:(w,E,G)=>{"use strict";const{Deflate:P,deflate:h,deflateRaw:B,gzip:y}=G(12729),{Inflate:x,inflate:U,inflateRaw:l,ungzip:i}=G(12779),O=G(12764);w.exports.Deflate=P,w.exports.deflate=h,w.exports.deflateRaw=B,w.exports.gzip=y,w.exports.Inflate=x,w.exports.inflate=U,w.exports.inflateRaw=l,w.exports.ungzip=i,w.exports.constants=O},12729:(w,E,G)=>{"use strict";const P=G(12734),h=G(12766),B=G(12770),y=G(12759),x=G(12776),U=Object.prototype.toString,{Z_NO_FLUSH:l,Z_SYNC_FLUSH:i,Z_FULL_FLUSH:O,Z_FINISH:u,Z_OK:V,Z_STREAM_END:a,Z_DEFAULT_COMPRESSION:Q,Z_DEFAULT_STRATEGY:c,Z_DEFLATED:Z}=G(12764);function J(w){this.options=h.assign({level:Q,method:Z,Dw:16384,windowBits:15,memLevel:8,strategy:c},w||{});let E=this.options;E.raw&&E.windowBits>0?E.windowBits=-E.windowBits:E.gzip&&E.windowBits>0&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.iE="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0;let G=P.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(G!==V)throw new Error(y[G]);if(E.header&&P.deflateSetHeader(this.strm,E.header),E.dictionary){let w;if(w="string"===typeof E.dictionary?B.string2buf(E.dictionary):"[object ArrayBuffer]"===U.call(E.dictionary)?new Uint8Array(E.dictionary):E.dictionary,G=P.deflateSetDictionary(this.strm,w),G!==V)throw new Error(y[G]);this._dict_set=!0}}function d(w,E){const G=new J(E);if(G.push(w,!0),G.err)throw G.iE||y[G.err];return G.result}J.prototype.push=function(w,E){const G=this.strm,h=this.options.Dw;let y,x;if(this.ended)return!1;for(x=E===~~E?E:!0===E?u:l,"string"===typeof w?G.input=B.string2buf(w):"[object ArrayBuffer]"===U.call(w)?G.input=new Uint8Array(w):G.input=w,G.next_in=0,G.avail_in=G.input.length;;)if(0===G.avail_out&&(G.output=new Uint8Array(h),G.next_out=0,G.avail_out=h),(x===i||x===O)&&G.avail_out<=6)this.onData(G.output.subarray(0,G.next_out)),G.avail_out=0;else{if(y=P.deflate(G,x),y===a)return G.next_out>0&&this.onData(G.output.subarray(0,G.next_out)),y=P.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===V;if(0!==G.avail_out){if(x>0&&G.next_out>0)this.onData(G.output.subarray(0,G.next_out)),G.avail_out=0;else if(0===G.avail_in)break}else this.onData(G.output)}return!0},J.prototype.onData=function(w){this.chunks.push(w)},J.prototype.onEnd=function(w){w===V&&(this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.iE=this.strm.iE},w.exports.Deflate=J,w.exports.deflate=d,w.exports.deflateRaw=function(w,E){return(E=E||{}).raw=!0,d(w,E)},w.exports.gzip=function(w,E){return(E=E||{}).gzip=!0,d(w,E)},w.exports.constants=G(12764)},12779:(w,E,G)=>{"use strict";const P=G(12785),h=G(12766),B=G(12770),y=G(12759),x=G(12776),U=G(12796),l=Object.prototype.toString,{Z_NO_FLUSH:i,Z_FINISH:O,Z_OK:u,Z_STREAM_END:V,Z_NEED_DICT:a,Z_STREAM_ERROR:Q,Z_DATA_ERROR:c,Z_MEM_ERROR:Z}=G(12764);function J(w){this.options=h.assign({Dw:65536,windowBits:15,to:""},w||{});const E=this.options;E.raw&&E.windowBits>=0&&E.windowBits<16&&(E.windowBits=-E.windowBits,0===E.windowBits&&(E.windowBits=-15)),!(E.windowBits>=0&&E.windowBits<16)||w&&w.windowBits||(E.windowBits+=32),E.windowBits>15&&E.windowBits<48&&0===(15&E.windowBits)&&(E.windowBits|=15),this.err=0,this.iE="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0;let G=P.inflateInit2(this.strm,E.windowBits);if(G!==u)throw new Error(y[G]);if(this.header=new U,P.inflateGetHeader(this.strm,this.header),E.dictionary&&("string"===typeof E.dictionary?E.dictionary=B.string2buf(E.dictionary):"[object ArrayBuffer]"===l.call(E.dictionary)&&(E.dictionary=new Uint8Array(E.dictionary)),E.raw&&(G=P.inflateSetDictionary(this.strm,E.dictionary),G!==u)))throw new Error(y[G])}function d(w,E){const G=new J(E);if(G.push(w),G.err)throw G.iE||y[G.err];return G.result}J.prototype.push=function(w,E){const G=this.strm,h=this.options.Dw,y=this.options.dictionary;let x,U,J;if(this.ended)return!1;for(U=E===~~E?E:!0===E?O:i,"[object ArrayBuffer]"===l.call(w)?G.input=new Uint8Array(w):G.input=w,G.next_in=0,G.avail_in=G.input.length;;){for(0===G.avail_out&&(G.output=new Uint8Array(h),G.next_out=0,G.avail_out=h),x=P.inflate(G,U),x===a&&y&&(x=P.inflateSetDictionary(G,y),x===u?x=P.inflate(G,U):x===c&&(x=a));G.avail_in>0&&x===V&&G.state.wrap>0&&0!==w[G.next_in];)P.inflateReset(G),x=P.inflate(G,U);switch(x){case Q:case c:case a:case Z:return this.onEnd(x),this.ended=!0,!1}if(J=G.avail_out,G.next_out&&(0===G.avail_out||x===V))if("string"===this.options.to){let w=B.utf8border(G.output,G.next_out),E=G.next_out-w,P=B.buf2string(G.output,w);G.next_out=E,G.avail_out=h-E,E&&G.output.set(G.output.subarray(w,w+E),0),this.onData(P)}else this.onData(G.output.length===G.next_out?G.output:G.output.subarray(0,G.next_out));if(x!==u||0!==J){if(x===V)return x=P.inflateEnd(this.strm),this.onEnd(x),this.ended=!0,!0;if(0===G.avail_in)break}}return!0},J.prototype.onData=function(w){this.chunks.push(w)},J.prototype.onEnd=function(w){w===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.iE=this.strm.iE},w.exports.Inflate=J,w.exports.inflate=d,w.exports.inflateRaw=function(w,E){return(E=E||{}).raw=!0,d(w,E)},w.exports.ungzip=d,w.exports.constants=G(12764)},12766:w=>{"use strict";const E=(w,E)=>Object.prototype.hasOwnProperty.call(w,E);w.exports.assign=function(w){const G=Array.prototype.slice.call(arguments,1);for(;G.length;){const P=G.shift();if(P){if("object"!==typeof P)throw new TypeError(P+"must be non-object");for(const G in P)E(P,G)&&(w[G]=P[G])}}return w},w.exports.flattenChunks=w=>{let E=0;for(let P=0,h=w.length;P<h;P++)E+=w[P].length;const G=new Uint8Array(E);for(let P=0,h=0,B=w.length;P<B;P++){let E=w[P];G.set(E,h),h+=E.length}return G}},12770:w=>{"use strict";let E=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(P){E=!1}const G=new Uint8Array(256);for(let h=0;h<256;h++)G[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;G[254]=G[254]=1,w.exports.string2buf=w=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(w);let E,G,P,h,B,y=w.length,x=0;for(h=0;h<y;h++)G=w.charCodeAt(h),55296===(64512&G)&&h+1<y&&(P=w.charCodeAt(h+1),56320===(64512&P)&&(G=65536+(G-55296<<10)+(P-56320),h++)),x+=G<128?1:G<2048?2:G<65536?3:4;for(E=new Uint8Array(x),B=0,h=0;B<x;h++)G=w.charCodeAt(h),55296===(64512&G)&&h+1<y&&(P=w.charCodeAt(h+1),56320===(64512&P)&&(G=65536+(G-55296<<10)+(P-56320),h++)),G<128?E[B++]=G:G<2048?(E[B++]=192|G>>>6,E[B++]=128|63&G):G<65536?(E[B++]=224|G>>>12,E[B++]=128|G>>>6&63,E[B++]=128|63&G):(E[B++]=240|G>>>18,E[B++]=128|G>>>12&63,E[B++]=128|G>>>6&63,E[B++]=128|63&G);return E};w.exports.buf2string=(w,P)=>{const h=P||w.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(w.subarray(0,P));let B,y;const x=new Array(2*h);for(y=0,B=0;B<h;){let E=w[B++];if(E<128){x[y++]=E;continue}let P=G[E];if(P>4)x[y++]=65533,B+=P-1;else{for(E&=2===P?31:3===P?15:7;P>1&&B<h;)E=E<<6|63&w[B++],P--;P>1?x[y++]=65533:E<65536?x[y++]=E:(E-=65536,x[y++]=55296|E>>10&1023,x[y++]=56320|1023&E)}}return((w,G)=>{if(G<65534&&w.subarray&&E)return String.fromCharCode.apply(null,w.length===G?w:w.subarray(0,G));let P="";for(let E=0;E<G;E++)P+=String.fromCharCode(w[E]);return P})(x,y)},w.exports.utf8border=(w,E)=>{(E=E||w.length)>w.length&&(E=w.length);let P=E-1;for(;P>=0&&128===(192&w[P]);)P--;return P<0||0===P?E:P+G[w[P]]>E?P:E}},12749:w=>{"use strict";w.exports=(w,E,G,P)=>{let h=65535&w,B=w>>>16&65535,y=0;for(;0!==G;){y=G>2e3?2e3:G,G-=y;do{h=h+E[P++]|0,B=B+h|0}while(--y);h%=65521,B%=65521}return h|B<<16}},12764:w=>{"use strict";w.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12751:w=>{"use strict";const E=new Uint32Array((()=>{let w,E=[];for(var G=0;G<256;G++){w=G;for(var P=0;P<8;P++)w=1&w?3988292384^w>>>1:w>>>1;E[G]=w}return E})());w.exports=(w,G,P,h)=>{const B=E,y=h+P;w^=-1;for(let E=h;E<y;E++)w=w>>>8^B[255&(w^G[E])];return~w}},12734:(w,E,G)=>{"use strict";const{_tr_init:P,_tr_stored_block:h,_tr_flush_block:B,_tr_tally:y,_tr_align:x}=G(12741),U=G(12749),l=G(12751),i=G(12759),{Z_NO_FLUSH:O,Z_PARTIAL_FLUSH:u,Z_FULL_FLUSH:V,Z_FINISH:a,Z_BLOCK:Q,Z_OK:c,Z_STREAM_END:Z,Z_STREAM_ERROR:J,Z_DATA_ERROR:d,Z_BUF_ERROR:K,Z_DEFAULT_COMPRESSION:t,Z_FILTERED:q,Z_HUFFMAN_ONLY:W,Z_RLE:T,Z_FIXED:I,Z_DEFAULT_STRATEGY:j,Z_UNKNOWN:g,Z_DEFLATED:o}=G(12764),f=258,k=262,N=103,v=113,C=666,s=(w,E)=>(w.iE=i[E],E),F=w=>(w<<1)-(w>4?9:0),M=w=>{let E=w.length;for(;--E>=0;)w[E]=0};let p=(w,E,G)=>(E<<w.hash_shift^G)&w.hash_mask;const D=w=>{const E=w.state;let G=E.pending;G>w.avail_out&&(G=w.avail_out),0!==G&&(w.output.set(E.pending_buf.subarray(E.pending_out,E.pending_out+G),w.next_out),w.next_out+=G,E.pending_out+=G,w.total_out+=G,w.avail_out-=G,E.pending-=G,0===E.pending&&(E.pending_out=0))},e=(w,E)=>{B(w,w.block_start>=0?w.block_start:-1,w.strstart-w.block_start,E),w.block_start=w.strstart,D(w.strm)},R=(w,E)=>{w.pending_buf[w.pending++]=E},H=(w,E)=>{w.pending_buf[w.pending++]=E>>>8&255,w.pending_buf[w.pending++]=255&E},z=(w,E,G,P)=>{let h=w.avail_in;return h>P&&(h=P),0===h?0:(w.avail_in-=h,E.set(w.input.subarray(w.next_in,w.next_in+h),G),1===w.state.wrap?w.adler=U(w.adler,E,h,G):2===w.state.wrap&&(w.adler=l(w.adler,E,h,G)),w.next_in+=h,w.total_in+=h,h)},L=(w,E)=>{let G,P,h=w.max_chain_length,B=w.strstart,y=w.prev_length,x=w.nice_match;const U=w.strstart>w.w_size-k?w.strstart-(w.w_size-k):0,l=w.window,i=w.w_mask,O=w.prev,u=w.strstart+f;let V=l[B+y-1],a=l[B+y];w.prev_length>=w.good_match&&(h>>=2),x>w.lookahead&&(x=w.lookahead);do{if(G=E,l[G+y]===a&&l[G+y-1]===V&&l[G]===l[B]&&l[++G]===l[B+1]){B+=2,G++;do{}while(l[++B]===l[++G]&&l[++B]===l[++G]&&l[++B]===l[++G]&&l[++B]===l[++G]&&l[++B]===l[++G]&&l[++B]===l[++G]&&l[++B]===l[++G]&&l[++B]===l[++G]&&B<u);if(P=f-(u-B),B=u-f,P>y){if(w.match_start=E,y=P,P>=x)break;V=l[B+y-1],a=l[B+y]}}}while((E=O[E&i])>U&&0!==--h);return y<=w.lookahead?y:w.lookahead},m=w=>{const E=w.w_size;let G,P,h,B,y;do{if(B=w.window_size-w.lookahead-w.strstart,w.strstart>=E+(E-k)){w.window.set(w.window.subarray(E,E+E),0),w.match_start-=E,w.strstart-=E,w.block_start-=E,P=w.hash_size,G=P;do{h=w.head[--G],w.head[G]=h>=E?h-E:0}while(--P);P=E,G=P;do{h=w.prev[--G],w.prev[G]=h>=E?h-E:0}while(--P);B+=E}if(0===w.strm.avail_in)break;if(P=z(w.strm,w.window,w.strstart+w.lookahead,B),w.lookahead+=P,w.lookahead+w.insert>=3)for(y=w.strstart-w.insert,w.ins_h=w.window[y],w.ins_h=p(w,w.ins_h,w.window[y+1]);w.insert&&(w.ins_h=p(w,w.ins_h,w.window[y+3-1]),w.prev[y&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=y,y++,w.insert--,!(w.lookahead+w.insert<3)););}while(w.lookahead<k&&0!==w.strm.avail_in)},n=(w,E)=>{let G,P;for(;;){if(w.lookahead<k){if(m(w),w.lookahead<k&&E===O)return 1;if(0===w.lookahead)break}if(G=0,w.lookahead>=3&&(w.ins_h=p(w,w.ins_h,w.window[w.strstart+3-1]),G=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),0!==G&&w.strstart-G<=w.w_size-k&&(w.match_length=L(w,G)),w.match_length>=3)if(P=y(w,w.strstart-w.match_start,w.match_length-3),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=3){w.match_length--;do{w.strstart++,w.ins_h=p(w,w.ins_h,w.window[w.strstart+3-1]),G=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart}while(0!==--w.match_length);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=p(w,w.ins_h,w.window[w.strstart+1]);else P=y(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(P&&(e(w,!1),0===w.strm.avail_out))return 1}return w.insert=w.strstart<2?w.strstart:2,E===a?(e(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(e(w,!1),0===w.strm.avail_out)?1:2},r=(w,E)=>{let G,P,h;for(;;){if(w.lookahead<k){if(m(w),w.lookahead<k&&E===O)return 1;if(0===w.lookahead)break}if(G=0,w.lookahead>=3&&(w.ins_h=p(w,w.ins_h,w.window[w.strstart+3-1]),G=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=2,0!==G&&w.prev_length<w.max_lazy_match&&w.strstart-G<=w.w_size-k&&(w.match_length=L(w,G),w.match_length<=5&&(w.strategy===q||3===w.match_length&&w.strstart-w.match_start>4096)&&(w.match_length=2)),w.prev_length>=3&&w.match_length<=w.prev_length){h=w.strstart+w.lookahead-3,P=y(w,w.strstart-1-w.prev_match,w.prev_length-3),w.lookahead-=w.prev_length-1,w.prev_length-=2;do{++w.strstart<=h&&(w.ins_h=p(w,w.ins_h,w.window[w.strstart+3-1]),G=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart)}while(0!==--w.prev_length);if(w.match_available=0,w.match_length=2,w.strstart++,P&&(e(w,!1),0===w.strm.avail_out))return 1}else if(w.match_available){if(P=y(w,0,w.window[w.strstart-1]),P&&e(w,!1),w.strstart++,w.lookahead--,0===w.strm.avail_out)return 1}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(P=y(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<2?w.strstart:2,E===a?(e(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(e(w,!1),0===w.strm.avail_out)?1:2};function Y(w,E,G,P,h){this.good_length=w,this.max_lazy=E,this.nice_length=G,this.max_chain=P,this.func=h}const S=[new Y(0,0,0,0,((w,E)=>{let G=65535;for(G>w.pending_buf_size-5&&(G=w.pending_buf_size-5);;){if(w.lookahead<=1){if(m(w),0===w.lookahead&&E===O)return 1;if(0===w.lookahead)break}w.strstart+=w.lookahead,w.lookahead=0;const P=w.block_start+G;if((0===w.strstart||w.strstart>=P)&&(w.lookahead=w.strstart-P,w.strstart=P,e(w,!1),0===w.strm.avail_out))return 1;if(w.strstart-w.block_start>=w.w_size-k&&(e(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,E===a?(e(w,!0),0===w.strm.avail_out?3:4):(w.strstart>w.block_start&&(e(w,!1),w.strm.avail_out),1)})),new Y(4,4,8,4,n),new Y(4,5,16,8,n),new Y(4,6,32,32,n),new Y(4,4,16,16,r),new Y(8,16,32,32,r),new Y(8,16,128,128,r),new Y(8,32,128,256,r),new Y(32,128,258,1024,r),new Y(32,258,258,4096,r)];function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=o,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),M(this.dyn_ltree),M(this.dyn_dtree),M(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),M(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),M(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const b=w=>{if(!w||!w.state)return s(w,J);w.total_in=w.total_out=0,w.data_type=g;const E=w.state;return E.pending=0,E.pending_out=0,E.wrap<0&&(E.wrap=-E.wrap),E.status=E.wrap?42:v,w.adler=2===E.wrap?0:1,E.last_flush=O,P(E),c},A=w=>{const E=b(w);var G;return E===c&&((G=w.state).window_size=2*G.w_size,M(G.head),G.max_lazy_match=S[G.level].max_lazy,G.good_match=S[G.level].good_length,G.nice_match=S[G.level].nice_length,G.max_chain_length=S[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=2,G.match_available=0,G.ins_h=0),E},ww=(w,E,G,P,h,B)=>{if(!w)return J;let y=1;if(E===t&&(E=6),P<0?(y=0,P=-P):P>15&&(y=2,P-=16),h<1||h>9||G!==o||P<8||P>15||E<0||E>9||B<0||B>I)return s(w,J);8===P&&(P=9);const x=new X;return w.state=x,x.strm=w,x.wrap=y,x.gzhead=null,x.w_bits=P,x.w_size=1<<x.w_bits,x.w_mask=x.w_size-1,x.hash_bits=h+7,x.hash_size=1<<x.hash_bits,x.hash_mask=x.hash_size-1,x.hash_shift=~~((x.hash_bits+3-1)/3),x.window=new Uint8Array(2*x.w_size),x.head=new Uint16Array(x.hash_size),x.prev=new Uint16Array(x.w_size),x.lit_bufsize=1<<h+6,x.pending_buf_size=4*x.lit_bufsize,x.pending_buf=new Uint8Array(x.pending_buf_size),x.d_buf=1*x.lit_bufsize,x.l_buf=3*x.lit_bufsize,x.level=E,x.strategy=B,x.method=G,A(w)};w.exports.deflateInit=(w,E)=>ww(w,E,o,15,8,j),w.exports.deflateInit2=ww,w.exports.deflateReset=A,w.exports.deflateResetKeep=b,w.exports.deflateSetHeader=(w,E)=>w&&w.state?2!==w.state.wrap?J:(w.state.gzhead=E,c):J,w.exports.deflate=(w,E)=>{let G,P;if(!w||!w.state||E>Q||E<0)return w?s(w,J):J;const B=w.state;if(!w.output||!w.input&&0!==w.avail_in||B.status===C&&E!==a)return s(w,0===w.avail_out?K:J);B.strm=w;const U=B.last_flush;if(B.last_flush=E,42===B.status)if(2===B.wrap)w.adler=0,R(B,31),R(B,139),R(B,8),B.gzhead?(R(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),R(B,255&B.gzhead.time),R(B,B.gzhead.time>>8&255),R(B,B.gzhead.time>>16&255),R(B,B.gzhead.time>>24&255),R(B,9===B.level?2:B.strategy>=W||B.level<2?4:0),R(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(R(B,255&B.gzhead.extra.length),R(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(w.adler=l(w.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(R(B,0),R(B,0),R(B,0),R(B,0),R(B,0),R(B,9===B.level?2:B.strategy>=W||B.level<2?4:0),R(B,3),B.status=v);else{let E=o+(B.w_bits-8<<4)<<8,G=-1;G=B.strategy>=W||B.level<2?0:B.level<6?1:6===B.level?2:3,E|=G<<6,0!==B.strstart&&(E|=32),E+=31-E%31,B.status=v,H(B,E),0!==B.strstart&&(H(B,w.adler>>>16),H(B,65535&w.adler)),w.adler=1}if(69===B.status)if(B.gzhead.extra){for(G=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>G&&(w.adler=l(w.adler,B.pending_buf,B.pending-G,G)),D(w),G=B.pending,B.pending!==B.pending_buf_size));)R(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>G&&(w.adler=l(w.adler,B.pending_buf,B.pending-G,G)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(73===B.status)if(B.gzhead.name){G=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>G&&(w.adler=l(w.adler,B.pending_buf,B.pending-G,G)),D(w),G=B.pending,B.pending===B.pending_buf_size)){P=1;break}P=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,R(B,P)}while(0!==P);B.gzhead.hcrc&&B.pending>G&&(w.adler=l(w.adler,B.pending_buf,B.pending-G,G)),0===P&&(B.gzindex=0,B.status=91)}else B.status=91;if(91===B.status)if(B.gzhead.comment){G=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>G&&(w.adler=l(w.adler,B.pending_buf,B.pending-G,G)),D(w),G=B.pending,B.pending===B.pending_buf_size)){P=1;break}P=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,R(B,P)}while(0!==P);B.gzhead.hcrc&&B.pending>G&&(w.adler=l(w.adler,B.pending_buf,B.pending-G,G)),0===P&&(B.status=N)}else B.status=N;if(B.status===N&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&D(w),B.pending+2<=B.pending_buf_size&&(R(B,255&w.adler),R(B,w.adler>>8&255),w.adler=0,B.status=v)):B.status=v),0!==B.pending){if(D(w),0===w.avail_out)return B.last_flush=-1,c}else if(0===w.avail_in&&F(E)<=F(U)&&E!==a)return s(w,K);if(B.status===C&&0!==w.avail_in)return s(w,K);if(0!==w.avail_in||0!==B.lookahead||E!==O&&B.status!==C){let G=B.strategy===W?((w,E)=>{let G;for(;;){if(0===w.lookahead&&(m(w),0===w.lookahead)){if(E===O)return 1;break}if(w.match_length=0,G=y(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++,G&&(e(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,E===a?(e(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(e(w,!1),0===w.strm.avail_out)?1:2})(B,E):B.strategy===T?((w,E)=>{let G,P,h,B;const x=w.window;for(;;){if(w.lookahead<=f){if(m(w),w.lookahead<=f&&E===O)return 1;if(0===w.lookahead)break}if(w.match_length=0,w.lookahead>=3&&w.strstart>0&&(h=w.strstart-1,P=x[h],P===x[++h]&&P===x[++h]&&P===x[++h])){B=w.strstart+f;do{}while(P===x[++h]&&P===x[++h]&&P===x[++h]&&P===x[++h]&&P===x[++h]&&P===x[++h]&&P===x[++h]&&P===x[++h]&&h<B);w.match_length=f-(B-h),w.match_length>w.lookahead&&(w.match_length=w.lookahead)}if(w.match_length>=3?(G=y(w,1,w.match_length-3),w.lookahead-=w.match_length,w.strstart+=w.match_length,w.match_length=0):(G=y(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++),G&&(e(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,E===a?(e(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(e(w,!1),0===w.strm.avail_out)?1:2})(B,E):S[B.level].func(B,E);if(3!==G&&4!==G||(B.status=C),1===G||3===G)return 0===w.avail_out&&(B.last_flush=-1),c;if(2===G&&(E===u?x(B):E!==Q&&(h(B,0,0,!1),E===V&&(M(B.head),0===B.lookahead&&(B.strstart=0,B.block_start=0,B.insert=0))),D(w),0===w.avail_out))return B.last_flush=-1,c}return E!==a?c:B.wrap<=0?Z:(2===B.wrap?(R(B,255&w.adler),R(B,w.adler>>8&255),R(B,w.adler>>16&255),R(B,w.adler>>24&255),R(B,255&w.total_in),R(B,w.total_in>>8&255),R(B,w.total_in>>16&255),R(B,w.total_in>>24&255)):(H(B,w.adler>>>16),H(B,65535&w.adler)),D(w),B.wrap>0&&(B.wrap=-B.wrap),0!==B.pending?c:Z)},w.exports.deflateEnd=w=>{if(!w||!w.state)return J;const E=w.state.status;return 42!==E&&69!==E&&73!==E&&91!==E&&E!==N&&E!==v&&E!==C?s(w,J):(w.state=null,E===v?s(w,d):c)},w.exports.deflateSetDictionary=(w,E)=>{let G=E.length;if(!w||!w.state)return J;const P=w.state,h=P.wrap;if(2===h||1===h&&42!==P.status||P.lookahead)return J;if(1===h&&(w.adler=U(w.adler,E,G,0)),P.wrap=0,G>=P.w_size){0===h&&(M(P.head),P.strstart=0,P.block_start=0,P.insert=0);let w=new Uint8Array(P.w_size);w.set(E.subarray(G-P.w_size,G),0),E=w,G=P.w_size}const B=w.avail_in,y=w.next_in,x=w.input;for(w.avail_in=G,w.next_in=0,w.input=E,m(P);P.lookahead>=3;){let w=P.strstart,E=P.lookahead-2;do{P.ins_h=p(P,P.ins_h,P.window[w+3-1]),P.prev[w&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=w,w++}while(--E);P.strstart=w,P.lookahead=2,m(P)}return P.strstart+=P.lookahead,P.block_start=P.strstart,P.insert=P.lookahead,P.lookahead=0,P.match_length=P.prev_length=2,P.match_available=0,w.next_in=y,w.input=x,w.avail_in=B,P.wrap=h,c},w.exports.deflateInfo="pako deflate (from Nodeca project)"},12796:w=>{"use strict";w.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12790:w=>{"use strict";w.exports=function(w,E){let G,P,h,B,y,x,U,l,i,O,u,V,a,Q,c,Z,J,d,K,t,q,W,T,I;const j=w.state;G=w.next_in,T=w.input,P=G+(w.avail_in-5),h=w.next_out,I=w.output,B=h-(E-w.avail_out),y=h+(w.avail_out-257),x=j.dmax,U=j.wsize,l=j.whave,i=j.wnext,O=j.window,u=j.hold,V=j.bits,a=j.lencode,Q=j.distcode,c=(1<<j.lenbits)-1,Z=(1<<j.distbits)-1;w:do{V<15&&(u+=T[G++]<<V,V+=8,u+=T[G++]<<V,V+=8),J=a[u&c];E:for(;;){if(d=J>>>24,u>>>=d,V-=d,d=J>>>16&255,0===d)I[h++]=65535&J;else{if(!(16&d)){if(0===(64&d)){J=a[(65535&J)+(u&(1<<d)-1)];continue E}if(32&d){j.mode=12;break w}w.iE="invalid literal/length code",j.mode=30;break w}K=65535&J,d&=15,d&&(V<d&&(u+=T[G++]<<V,V+=8),K+=u&(1<<d)-1,u>>>=d,V-=d),V<15&&(u+=T[G++]<<V,V+=8,u+=T[G++]<<V,V+=8),J=Q[u&Z];G:for(;;){if(d=J>>>24,u>>>=d,V-=d,d=J>>>16&255,!(16&d)){if(0===(64&d)){J=Q[(65535&J)+(u&(1<<d)-1)];continue G}w.iE="invalid distance code",j.mode=30;break w}if(t=65535&J,d&=15,V<d&&(u+=T[G++]<<V,V+=8,V<d&&(u+=T[G++]<<V,V+=8)),t+=u&(1<<d)-1,t>x){w.iE="invalid distance too far back",j.mode=30;break w}if(u>>>=d,V-=d,d=h-B,t>d){if(d=t-d,d>l&&j.sane){w.iE="invalid distance too far back",j.mode=30;break w}if(q=0,W=O,0===i){if(q+=U-d,d<K){K-=d;do{I[h++]=O[q++]}while(--d);q=h-t,W=I}}else if(i<d){if(q+=U+i-d,d-=i,d<K){K-=d;do{I[h++]=O[q++]}while(--d);if(q=0,i<K){d=i,K-=d;do{I[h++]=O[q++]}while(--d);q=h-t,W=I}}}else if(q+=i-d,d<K){K-=d;do{I[h++]=O[q++]}while(--d);q=h-t,W=I}for(;K>2;)I[h++]=W[q++],I[h++]=W[q++],I[h++]=W[q++],K-=3;K&&(I[h++]=W[q++],K>1&&(I[h++]=W[q++]))}else{q=h-t;do{I[h++]=I[q++],I[h++]=I[q++],I[h++]=I[q++],K-=3}while(K>2);K&&(I[h++]=I[q++],K>1&&(I[h++]=I[q++]))}break}}break}}while(G<P&&h<y);K=V>>3,G-=K,V-=K<<3,u&=(1<<V)-1,w.next_in=G,w.next_out=h,w.avail_in=G<P?P-G+5:5-(G-P),w.avail_out=h<y?y-h+257:257-(h-y),j.hold=u,j.bits=V}},12785:(w,E,G)=>{"use strict";const P=G(12749),h=G(12751),B=G(12790),y=G(12793),{Z_FINISH:x,Z_BLOCK:U,Z_TREES:l,Z_OK:i,Z_STREAM_END:O,Z_NEED_DICT:u,Z_STREAM_ERROR:V,Z_DATA_ERROR:a,Z_MEM_ERROR:Q,Z_BUF_ERROR:c,Z_DEFLATED:Z}=G(12764),J=12,d=30,K=w=>(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24);function t(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const q=w=>{if(!w||!w.state)return V;const E=w.state;return w.total_in=w.total_out=E.total=0,w.iE="",E.wrap&&(w.adler=1&E.wrap),E.mode=1,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new Int32Array(852),E.distcode=E.distdyn=new Int32Array(592),E.sane=1,E.back=-1,i},W=w=>{if(!w||!w.state)return V;const E=w.state;return E.wsize=0,E.whave=0,E.wnext=0,q(w)},T=(w,E)=>{let G;if(!w||!w.state)return V;const P=w.state;return E<0?(G=0,E=-E):(G=1+(E>>4),E<48&&(E&=15)),E&&(E<8||E>15)?V:(null!==P.window&&P.wbits!==E&&(P.window=null),P.wrap=G,P.wbits=E,W(w))},I=(w,E)=>{if(!w)return V;const G=new t;w.state=G,G.window=null;const P=T(w,E);return P!==i&&(w.state=null),P};let j,g,o=!0;const f=w=>{if(o){j=new Int32Array(512),g=new Int32Array(32);let E=0;for(;E<144;)w.lens[E++]=8;for(;E<256;)w.lens[E++]=9;for(;E<280;)w.lens[E++]=7;for(;E<288;)w.lens[E++]=8;for(y(1,w.lens,0,288,j,0,w.work,{bits:9}),E=0;E<32;)w.lens[E++]=5;y(2,w.lens,0,32,g,0,w.work,{bits:5}),o=!1}w.lencode=j,w.lenbits=9,w.distcode=g,w.distbits=5},k=(w,E,G,P)=>{let h;const B=w.state;return null===B.window&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new Uint8Array(B.wsize)),P>=B.wsize?(B.window.set(E.subarray(G-B.wsize,G),0),B.wnext=0,B.whave=B.wsize):(h=B.wsize-B.wnext,h>P&&(h=P),B.window.set(E.subarray(G-P,G-P+h),B.wnext),(P-=h)?(B.window.set(E.subarray(G-P,G),0),B.wnext=P,B.whave=B.wsize):(B.wnext+=h,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=h))),0};w.exports.inflateReset=W,w.exports.inflateReset2=T,w.exports.inflateResetKeep=q,w.exports.inflateInit=w=>I(w,15),w.exports.inflateInit2=I,w.exports.inflate=(w,E)=>{let G,t,q,W,T,I,j,g,o,N,v,C,s,F,M,p,D,e,R,H,z,L,m=0;const n=new Uint8Array(4);let r,Y;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!w||!w.state||!w.output||!w.input&&0!==w.avail_in)return V;G=w.state,G.mode===J&&(G.mode=13),T=w.next_out,q=w.output,j=w.avail_out,W=w.next_in,t=w.input,I=w.avail_in,g=G.hold,o=G.bits,N=I,v=j,L=i;w:for(;;)switch(G.mode){case 1:if(0===G.wrap){G.mode=13;break}for(;o<16;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(2&G.wrap&&35615===g){G.check=0,n[0]=255&g,n[1]=g>>>8&255,G.check=h(G.check,n,2,0),g=0,o=0,G.mode=2;break}if(G.flags=0,G.head&&(G.head.done=!1),!(1&G.wrap)||(((255&g)<<8)+(g>>8))%31){w.iE="incorrect header check",G.mode=d;break}if((15&g)!==Z){w.iE="unknown compression method",G.mode=d;break}if(g>>>=4,o-=4,z=8+(15&g),0===G.wbits)G.wbits=z;else if(z>G.wbits){w.iE="invalid window size",G.mode=d;break}G.dmax=1<<G.wbits,w.adler=G.check=1,G.mode=512&g?10:J,g=0,o=0;break;case 2:for(;o<16;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(G.flags=g,(255&G.flags)!==Z){w.iE="unknown compression method",G.mode=d;break}if(57344&G.flags){w.iE="unknown header flags set",G.mode=d;break}G.head&&(G.head.text=g>>8&1),512&G.flags&&(n[0]=255&g,n[1]=g>>>8&255,G.check=h(G.check,n,2,0)),g=0,o=0,G.mode=3;case 3:for(;o<32;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}G.head&&(G.head.time=g),512&G.flags&&(n[0]=255&g,n[1]=g>>>8&255,n[2]=g>>>16&255,n[3]=g>>>24&255,G.check=h(G.check,n,4,0)),g=0,o=0,G.mode=4;case 4:for(;o<16;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}G.head&&(G.head.xflags=255&g,G.head.os=g>>8),512&G.flags&&(n[0]=255&g,n[1]=g>>>8&255,G.check=h(G.check,n,2,0)),g=0,o=0,G.mode=5;case 5:if(1024&G.flags){for(;o<16;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}G.length=g,G.head&&(G.head.extra_len=g),512&G.flags&&(n[0]=255&g,n[1]=g>>>8&255,G.check=h(G.check,n,2,0)),g=0,o=0}else G.head&&(G.head.extra=null);G.mode=6;case 6:if(1024&G.flags&&(C=G.length,C>I&&(C=I),C&&(G.head&&(z=G.head.extra_len-G.length,G.head.extra||(G.head.extra=new Uint8Array(G.head.extra_len)),G.head.extra.set(t.subarray(W,W+C),z)),512&G.flags&&(G.check=h(G.check,t,C,W)),I-=C,W+=C,G.length-=C),G.length))break w;G.length=0,G.mode=7;case 7:if(2048&G.flags){if(0===I)break w;C=0;do{z=t[W+C++],G.head&&z&&G.length<65536&&(G.head.name+=String.fromCharCode(z))}while(z&&C<I);if(512&G.flags&&(G.check=h(G.check,t,C,W)),I-=C,W+=C,z)break w}else G.head&&(G.head.name=null);G.length=0,G.mode=8;case 8:if(4096&G.flags){if(0===I)break w;C=0;do{z=t[W+C++],G.head&&z&&G.length<65536&&(G.head.comment+=String.fromCharCode(z))}while(z&&C<I);if(512&G.flags&&(G.check=h(G.check,t,C,W)),I-=C,W+=C,z)break w}else G.head&&(G.head.comment=null);G.mode=9;case 9:if(512&G.flags){for(;o<16;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(g!==(65535&G.check)){w.iE="header crc mismatch",G.mode=d;break}g=0,o=0}G.head&&(G.head.hcrc=G.flags>>9&1,G.head.done=!0),w.adler=G.check=0,G.mode=J;break;case 10:for(;o<32;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}w.adler=G.check=K(g),g=0,o=0,G.mode=11;case 11:if(0===G.havedict)return w.next_out=T,w.avail_out=j,w.next_in=W,w.avail_in=I,G.hold=g,G.bits=o,u;w.adler=G.check=1,G.mode=J;case J:if(E===U||E===l)break w;case 13:if(G.last){g>>>=7&o,o-=7&o,G.mode=27;break}for(;o<3;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}switch(G.last=1&g,g>>>=1,o-=1,3&g){case 0:G.mode=14;break;case 1:if(f(G),G.mode=20,E===l){g>>>=2,o-=2;break w}break;case 2:G.mode=17;break;case 3:w.iE="invalid block type",G.mode=d}g>>>=2,o-=2;break;case 14:for(g>>>=7&o,o-=7&o;o<32;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if((65535&g)!==(g>>>16^65535)){w.iE="invalid stored block lengths",G.mode=d;break}if(G.length=65535&g,g=0,o=0,G.mode=15,E===l)break w;case 15:G.mode=16;case 16:if(C=G.length,C){if(C>I&&(C=I),C>j&&(C=j),0===C)break w;q.set(t.subarray(W,W+C),T),I-=C,W+=C,j-=C,T+=C,G.length-=C;break}G.mode=J;break;case 17:for(;o<14;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(G.nlen=257+(31&g),g>>>=5,o-=5,G.ndist=1+(31&g),g>>>=5,o-=5,G.ncode=4+(15&g),g>>>=4,o-=4,G.nlen>286||G.ndist>30){w.iE="too many length or distance symbols",G.mode=d;break}G.have=0,G.mode=18;case 18:for(;G.have<G.ncode;){for(;o<3;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}G.lens[S[G.have++]]=7&g,g>>>=3,o-=3}for(;G.have<19;)G.lens[S[G.have++]]=0;if(G.lencode=G.lendyn,G.lenbits=7,r={bits:G.lenbits},L=y(0,G.lens,0,19,G.lencode,0,G.work,r),G.lenbits=r.bits,L){w.iE="invalid code lengths set",G.mode=d;break}G.have=0,G.mode=19;case 19:for(;G.have<G.nlen+G.ndist;){for(;m=G.lencode[g&(1<<G.lenbits)-1],M=m>>>24,p=m>>>16&255,D=65535&m,!(M<=o);){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(D<16)g>>>=M,o-=M,G.lens[G.have++]=D;else{if(16===D){for(Y=M+2;o<Y;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(g>>>=M,o-=M,0===G.have){w.iE="invalid bit length repeat",G.mode=d;break}z=G.lens[G.have-1],C=3+(3&g),g>>>=2,o-=2}else if(17===D){for(Y=M+3;o<Y;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}g>>>=M,o-=M,z=0,C=3+(7&g),g>>>=3,o-=3}else{for(Y=M+7;o<Y;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}g>>>=M,o-=M,z=0,C=11+(127&g),g>>>=7,o-=7}if(G.have+C>G.nlen+G.ndist){w.iE="invalid bit length repeat",G.mode=d;break}for(;C--;)G.lens[G.have++]=z}}if(G.mode===d)break;if(0===G.lens[256]){w.iE="invalid code -- missing end-of-block",G.mode=d;break}if(G.lenbits=9,r={bits:G.lenbits},L=y(1,G.lens,0,G.nlen,G.lencode,0,G.work,r),G.lenbits=r.bits,L){w.iE="invalid literal/lengths set",G.mode=d;break}if(G.distbits=6,G.distcode=G.distdyn,r={bits:G.distbits},L=y(2,G.lens,G.nlen,G.ndist,G.distcode,0,G.work,r),G.distbits=r.bits,L){w.iE="invalid distances set",G.mode=d;break}if(G.mode=20,E===l)break w;case 20:G.mode=21;case 21:if(I>=6&&j>=258){w.next_out=T,w.avail_out=j,w.next_in=W,w.avail_in=I,G.hold=g,G.bits=o,B(w,v),T=w.next_out,q=w.output,j=w.avail_out,W=w.next_in,t=w.input,I=w.avail_in,g=G.hold,o=G.bits,G.mode===J&&(G.back=-1);break}for(G.back=0;m=G.lencode[g&(1<<G.lenbits)-1],M=m>>>24,p=m>>>16&255,D=65535&m,!(M<=o);){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(p&&0===(240&p)){for(e=M,R=p,H=D;m=G.lencode[H+((g&(1<<e+R)-1)>>e)],M=m>>>24,p=m>>>16&255,D=65535&m,!(e+M<=o);){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}g>>>=e,o-=e,G.back+=e}if(g>>>=M,o-=M,G.back+=M,G.length=D,0===p){G.mode=26;break}if(32&p){G.back=-1,G.mode=J;break}if(64&p){w.iE="invalid literal/length code",G.mode=d;break}G.extra=15&p,G.mode=22;case 22:if(G.extra){for(Y=G.extra;o<Y;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}G.length+=g&(1<<G.extra)-1,g>>>=G.extra,o-=G.extra,G.back+=G.extra}G.was=G.length,G.mode=23;case 23:for(;m=G.distcode[g&(1<<G.distbits)-1],M=m>>>24,p=m>>>16&255,D=65535&m,!(M<=o);){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(0===(240&p)){for(e=M,R=p,H=D;m=G.distcode[H+((g&(1<<e+R)-1)>>e)],M=m>>>24,p=m>>>16&255,D=65535&m,!(e+M<=o);){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}g>>>=e,o-=e,G.back+=e}if(g>>>=M,o-=M,G.back+=M,64&p){w.iE="invalid distance code",G.mode=d;break}G.offset=D,G.extra=15&p,G.mode=24;case 24:if(G.extra){for(Y=G.extra;o<Y;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}G.offset+=g&(1<<G.extra)-1,g>>>=G.extra,o-=G.extra,G.back+=G.extra}if(G.offset>G.dmax){w.iE="invalid distance too far back",G.mode=d;break}G.mode=25;case 25:if(0===j)break w;if(C=v-j,G.offset>C){if(C=G.offset-C,C>G.whave&&G.sane){w.iE="invalid distance too far back",G.mode=d;break}C>G.wnext?(C-=G.wnext,s=G.wsize-C):s=G.wnext-C,C>G.length&&(C=G.length),F=G.window}else F=q,s=T-G.offset,C=G.length;C>j&&(C=j),j-=C,G.length-=C;do{q[T++]=F[s++]}while(--C);0===G.length&&(G.mode=21);break;case 26:if(0===j)break w;q[T++]=G.length,j--,G.mode=21;break;case 27:if(G.wrap){for(;o<32;){if(0===I)break w;I--,g|=t[W++]<<o,o+=8}if(v-=j,w.total_out+=v,G.total+=v,v&&(w.adler=G.check=G.flags?h(G.check,q,v,T-v):P(G.check,q,v,T-v)),v=j,(G.flags?g:K(g))!==G.check){w.iE="incorrect data check",G.mode=d;break}g=0,o=0}G.mode=28;case 28:if(G.wrap&&G.flags){for(;o<32;){if(0===I)break w;I--,g+=t[W++]<<o,o+=8}if(g!==(4294967295&G.total)){w.iE="incorrect length check",G.mode=d;break}g=0,o=0}G.mode=29;case 29:L=O;break w;case d:L=a;break w;case 31:return Q;default:return V}return w.next_out=T,w.avail_out=j,w.next_in=W,w.avail_in=I,G.hold=g,G.bits=o,(G.wsize||v!==w.avail_out&&G.mode<d&&(G.mode<27||E!==x))&&k(w,w.output,w.next_out,v-w.avail_out)?(G.mode=31,Q):(N-=w.avail_in,v-=w.avail_out,w.total_in+=N,w.total_out+=v,G.total+=v,G.wrap&&v&&(w.adler=G.check=G.flags?h(G.check,q,v,w.next_out-v):P(G.check,q,v,w.next_out-v)),w.data_type=G.bits+(G.last?64:0)+(G.mode===J?128:0)+(20===G.mode||15===G.mode?256:0),(0===N&&0===v||E===x)&&L===i&&(L=c),L)},w.exports.inflateEnd=w=>{if(!w||!w.state)return V;let E=w.state;return E.window&&(E.window=null),w.state=null,i},w.exports.inflateGetHeader=(w,E)=>{if(!w||!w.state)return V;const G=w.state;return 0===(2&G.wrap)?V:(G.head=E,E.done=!1,i)},w.exports.inflateSetDictionary=(w,E)=>{const G=E.length;let h,B,y;return w&&w.state?(h=w.state,0!==h.wrap&&11!==h.mode?V:11===h.mode&&(B=1,B=P(B,E,G,0),B!==h.check)?a:(y=k(w,E,G,G),y?(h.mode=31,Q):(h.havedict=1,i))):V},w.exports.inflateInfo="pako inflate (from Nodeca project)"},12793:w=>{"use strict";const E=15,G=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),P=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),h=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),B=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);w.exports=(w,y,x,U,l,i,O,u)=>{const V=u.bits;let a,Q,c,Z,J,d,K=0,t=0,q=0,W=0,T=0,I=0,j=0,g=0,o=0,f=0,k=null,N=0;const v=new Uint16Array(16),C=new Uint16Array(16);let s,F,M,p=null,D=0;for(K=0;K<=E;K++)v[K]=0;for(t=0;t<U;t++)v[y[x+t]]++;for(T=V,W=E;W>=1&&0===v[W];W--);if(T>W&&(T=W),0===W)return l[i++]=20971520,l[i++]=20971520,u.bits=1,0;for(q=1;q<W&&0===v[q];q++);for(T<q&&(T=q),g=1,K=1;K<=E;K++)if(g<<=1,g-=v[K],g<0)return-1;if(g>0&&(0===w||1!==W))return-1;for(C[1]=0,K=1;K<E;K++)C[K+1]=C[K]+v[K];for(t=0;t<U;t++)0!==y[x+t]&&(O[C[y[x+t]]++]=t);if(0===w?(k=p=O,d=19):1===w?(k=G,N-=257,p=P,D-=257,d=256):(k=h,p=B,d=-1),f=0,t=0,K=q,J=i,I=T,j=0,c=-1,o=1<<T,Z=o-1,1===w&&o>852||2===w&&o>592)return 1;for(;;){s=K-j,O[t]<d?(F=0,M=O[t]):O[t]>d?(F=p[D+O[t]],M=k[N+O[t]]):(F=96,M=0),a=1<<K-j,Q=1<<I,q=Q;do{Q-=a,l[J+(f>>j)+Q]=s<<24|F<<16|M}while(0!==Q);for(a=1<<K-1;f&a;)a>>=1;if(0!==a?(f&=a-1,f+=a):f=0,t++,0===--v[K]){if(K===W)break;K=y[x+O[t]]}if(K>T&&(f&Z)!==c){for(0===j&&(j=T),J+=q,I=K-j,g=1<<I;I+j<W&&(g-=v[I+j],!(g<=0));)I++,g<<=1;if(o+=1<<I,1===w&&o>852||2===w&&o>592)return 1;c=f&Z,l[c]=T<<24|I<<16|J-i}}return 0!==f&&(l[J+f]=K-j<<24|64<<16),u.bits=T,0}},12759:w=>{"use strict";w.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12741:w=>{"use strict";function E(w){let E=w.length;for(;--E>=0;)w[E]=0}const G=256,P=286,h=30,B=15,y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),x=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=new Array(576);E(i);const O=new Array(60);E(O);const u=new Array(512);E(u);const V=new Array(256);E(V);const a=new Array(29);E(a);const Q=new Array(h);function c(w,E,G,P,h){this.static_tree=w,this.extra_bits=E,this.extra_base=G,this.elems=P,this.max_length=h,this.has_stree=w&&w.length}let Z,J,d;function K(w,E){this.dyn_tree=w,this.max_code=0,this.stat_desc=E}E(Q);const t=w=>w<256?u[w]:u[256+(w>>>7)],q=(w,E)=>{w.pending_buf[w.pending++]=255&E,w.pending_buf[w.pending++]=E>>>8&255},W=(w,E,G)=>{w.bi_valid>16-G?(w.bi_buf|=E<<w.bi_valid&65535,q(w,w.bi_buf),w.bi_buf=E>>16-w.bi_valid,w.bi_valid+=G-16):(w.bi_buf|=E<<w.bi_valid&65535,w.bi_valid+=G)},T=(w,E,G)=>{W(w,G[2*E],G[2*E+1])},I=(w,E)=>{let G=0;do{G|=1&w,w>>>=1,G<<=1}while(--E>0);return G>>>1},j=(w,E,G)=>{const P=new Array(16);let h,y,x=0;for(h=1;h<=B;h++)P[h]=x=x+G[h-1]<<1;for(y=0;y<=E;y++){let E=w[2*y+1];0!==E&&(w[2*y]=I(P[E]++,E))}},g=w=>{let E;for(E=0;E<P;E++)w.dyn_ltree[2*E]=0;for(E=0;E<h;E++)w.dyn_dtree[2*E]=0;for(E=0;E<19;E++)w.bl_tree[2*E]=0;w.dyn_ltree[512]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0},o=w=>{w.bi_valid>8?q(w,w.bi_buf):w.bi_valid>0&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0},f=(w,E,G,P)=>{const h=2*E,B=2*G;return w[h]<w[B]||w[h]===w[B]&&P[E]<=P[G]},k=(w,E,G)=>{const P=w.heap[G];let h=G<<1;for(;h<=w.heap_len&&(h<w.heap_len&&f(E,w.heap[h+1],w.heap[h],w.depth)&&h++,!f(E,P,w.heap[h],w.depth));)w.heap[G]=w.heap[h],G=h,h<<=1;w.heap[G]=P},N=(w,E,P)=>{let h,B,U,l,i=0;if(0!==w.last_lit)do{h=w.pending_buf[w.d_buf+2*i]<<8|w.pending_buf[w.d_buf+2*i+1],B=w.pending_buf[w.l_buf+i],i++,0===h?T(w,B,E):(U=V[B],T(w,U+G+1,E),l=y[U],0!==l&&(B-=a[U],W(w,B,l)),h--,U=t(h),T(w,U,P),l=x[U],0!==l&&(h-=Q[U],W(w,h,l)))}while(i<w.last_lit);T(w,256,E)},v=(w,E)=>{const G=E.dyn_tree,P=E.stat_desc.static_tree,h=E.stat_desc.has_stree,y=E.stat_desc.elems;let x,U,l,i=-1;for(w.heap_len=0,w.heap_max=573,x=0;x<y;x++)0!==G[2*x]?(w.heap[++w.heap_len]=i=x,w.depth[x]=0):G[2*x+1]=0;for(;w.heap_len<2;)l=w.heap[++w.heap_len]=i<2?++i:0,G[2*l]=1,w.depth[l]=0,w.opt_len--,h&&(w.static_len-=P[2*l+1]);for(E.max_code=i,x=w.heap_len>>1;x>=1;x--)k(w,G,x);l=y;do{x=w.heap[1],w.heap[1]=w.heap[w.heap_len--],k(w,G,1),U=w.heap[1],w.heap[--w.heap_max]=x,w.heap[--w.heap_max]=U,G[2*l]=G[2*x]+G[2*U],w.depth[l]=(w.depth[x]>=w.depth[U]?w.depth[x]:w.depth[U])+1,G[2*x+1]=G[2*U+1]=l,w.heap[1]=l++,k(w,G,1)}while(w.heap_len>=2);w.heap[--w.heap_max]=w.heap[1],((w,E)=>{const G=E.dyn_tree,P=E.max_code,h=E.stat_desc.static_tree,y=E.stat_desc.has_stree,x=E.stat_desc.extra_bits,U=E.stat_desc.extra_base,l=E.stat_desc.max_length;let i,O,u,V,a,Q,c=0;for(V=0;V<=B;V++)w.bl_count[V]=0;for(G[2*w.heap[w.heap_max]+1]=0,i=w.heap_max+1;i<573;i++)O=w.heap[i],V=G[2*G[2*O+1]+1]+1,V>l&&(V=l,c++),G[2*O+1]=V,O>P||(w.bl_count[V]++,a=0,O>=U&&(a=x[O-U]),Q=G[2*O],w.opt_len+=Q*(V+a),y&&(w.static_len+=Q*(h[2*O+1]+a)));if(0!==c){do{for(V=l-1;0===w.bl_count[V];)V--;w.bl_count[V]--,w.bl_count[V+1]+=2,w.bl_count[l]--,c-=2}while(c>0);for(V=l;0!==V;V--)for(O=w.bl_count[V];0!==O;)u=w.heap[--i],u>P||(G[2*u+1]!==V&&(w.opt_len+=(V-G[2*u+1])*G[2*u],G[2*u+1]=V),O--)}})(w,E),j(G,i,w.bl_count)},C=(w,E,G)=>{let P,h,B=-1,y=E[1],x=0,U=7,l=4;for(0===y&&(U=138,l=3),E[2*(G+1)+1]=65535,P=0;P<=G;P++)h=y,y=E[2*(P+1)+1],++x<U&&h===y||(x<l?w.bl_tree[2*h]+=x:0!==h?(h!==B&&w.bl_tree[2*h]++,w.bl_tree[32]++):x<=10?w.bl_tree[34]++:w.bl_tree[36]++,x=0,B=h,0===y?(U=138,l=3):h===y?(U=6,l=3):(U=7,l=4))},s=(w,E,G)=>{let P,h,B=-1,y=E[1],x=0,U=7,l=4;for(0===y&&(U=138,l=3),P=0;P<=G;P++)if(h=y,y=E[2*(P+1)+1],!(++x<U&&h===y)){if(x<l)do{T(w,h,w.bl_tree)}while(0!==--x);else 0!==h?(h!==B&&(T(w,h,w.bl_tree),x--),T(w,16,w.bl_tree),W(w,x-3,2)):x<=10?(T(w,17,w.bl_tree),W(w,x-3,3)):(T(w,18,w.bl_tree),W(w,x-11,7));x=0,B=h,0===y?(U=138,l=3):h===y?(U=6,l=3):(U=7,l=4)}};let F=!1;const M=(w,E,G,P)=>{W(w,0+(P?1:0),3),((w,E,G,P)=>{o(w),P&&(q(w,G),q(w,~G)),w.pending_buf.set(w.window.subarray(E,E+G),w.pending),w.pending+=G})(w,E,G,!0)};w.exports._tr_init=w=>{F||((()=>{let w,E,G,l,K;const t=new Array(16);for(G=0,l=0;l<28;l++)for(a[l]=G,w=0;w<1<<y[l];w++)V[G++]=l;for(V[G-1]=l,K=0,l=0;l<16;l++)for(Q[l]=K,w=0;w<1<<x[l];w++)u[K++]=l;for(K>>=7;l<h;l++)for(Q[l]=K<<7,w=0;w<1<<x[l]-7;w++)u[256+K++]=l;for(E=0;E<=B;E++)t[E]=0;for(w=0;w<=143;)i[2*w+1]=8,w++,t[8]++;for(;w<=255;)i[2*w+1]=9,w++,t[9]++;for(;w<=279;)i[2*w+1]=7,w++,t[7]++;for(;w<=287;)i[2*w+1]=8,w++,t[8]++;for(j(i,287,t),w=0;w<h;w++)O[2*w+1]=5,O[2*w]=I(w,5);Z=new c(i,y,257,P,B),J=new c(O,x,0,h,B),d=new c(new Array(0),U,0,19,7)})(),F=!0),w.l_desc=new K(w.dyn_ltree,Z),w.d_desc=new K(w.dyn_dtree,J),w.bl_desc=new K(w.bl_tree,d),w.bi_buf=0,w.bi_valid=0,g(w)},w.exports._tr_stored_block=M,w.exports._tr_flush_block=(w,E,P,h)=>{let B,y,x=0;w.level>0?(2===w.strm.data_type&&(w.strm.data_type=(w=>{let E,P=4093624447;for(E=0;E<=31;E++,P>>>=1)if(1&P&&0!==w.dyn_ltree[2*E])return 0;if(0!==w.dyn_ltree[18]||0!==w.dyn_ltree[20]||0!==w.dyn_ltree[26])return 1;for(E=32;E<G;E++)if(0!==w.dyn_ltree[2*E])return 1;return 0})(w)),v(w,w.l_desc),v(w,w.d_desc),x=(w=>{let E;for(C(w,w.dyn_ltree,w.l_desc.max_code),C(w,w.dyn_dtree,w.d_desc.max_code),v(w,w.bl_desc),E=18;E>=3&&0===w.bl_tree[2*l[E]+1];E--);return w.opt_len+=3*(E+1)+5+5+4,E})(w),B=w.opt_len+3+7>>>3,y=w.static_len+3+7>>>3,y<=B&&(B=y)):B=y=P+5,P+4<=B&&-1!==E?M(w,E,P,h):4===w.strategy||y===B?(W(w,2+(h?1:0),3),N(w,i,O)):(W(w,4+(h?1:0),3),((w,E,G,P)=>{let h;for(W(w,E-257,5),W(w,G-1,5),W(w,P-4,4),h=0;h<P;h++)W(w,w.bl_tree[2*l[h]+1],3);s(w,w.dyn_ltree,E-1),s(w,w.dyn_dtree,G-1)})(w,w.l_desc.max_code+1,w.d_desc.max_code+1,x+1),N(w,w.dyn_ltree,w.dyn_dtree)),g(w),h&&o(w)},w.exports._tr_tally=(w,E,P)=>(w.pending_buf[w.d_buf+2*w.last_lit]=E>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&E,w.pending_buf[w.l_buf+w.last_lit]=255&P,w.last_lit++,0===E?w.dyn_ltree[2*P]++:(w.matches++,E--,w.dyn_ltree[2*(V[P]+G+1)]++,w.dyn_dtree[2*t(E)]++),w.last_lit===w.lit_bufsize-1),w.exports._tr_align=w=>{W(w,2,3),T(w,256,i),(w=>{16===w.bi_valid?(q(w,w.bi_buf),w.bi_buf=0,w.bi_valid=0):w.bi_valid>=8&&(w.pending_buf[w.pending++]=255&w.bi_buf,w.bi_buf>>=8,w.bi_valid-=8)})(w)}},12776:w=>{"use strict";w.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.iE="",this.state=null,this.data_type=2,this.adler=0}},12428:w=>{function E(w,E,G){for(var P=w.length,h=-1/0,B=1/0,y=0;y<P;y++){var x=(G[0][y]-w[y])/E[y],U=(G[1][y]-w[y])/E[y];if(x>U){var l=x;x=U,U=l}if(U<h||x>B)return 1/0;x>h&&(h=x),U<B&&(B=U)}return h>B?1/0:h}w.exports=function(w,G,P,h){var B=E(G,P,h);if(B===1/0)w=null;else{w=w||[];for(var y=0;y<G.length;y++)w[y]=G[y]+P[y]*B}return w},w.exports.distance=E},13739:(w,E,G)=>{"use strict";G.d(E,{b:()=>y});var P=G(32);const h=P.useLayoutEffect;const B=function(w){var E=(0,P.useRef)(w);return h((function(){E.current=w})),E};var y=function(w){var E=B(w);(0,P.xE)((function(){var w=function(w){var G;if(null!=E.current&&(G=E.current(w)),w.defaultPrevented&&(w.returnValue=""),"string"===typeof G)return w.returnValue=G,G};return window.addEventListener("beforeunload",w),function(){window.removeEventListener("beforeunload",w)}}),[])}},13682:(w,E,G)=>{"use strict";var P=G(13690),h=Array.prototype.concat,B=Array.prototype.slice,y=w.exports=function(w){for(var E=[],G=0,y=w.length;G<y;G++){var x=w[G];P(x)?E=h.call(E,B.call(x)):E.push(x)}return E};y.wrap=function(w){return function(){return w(y(arguments))}}},13690:w=>{w.exports=function(w){return!(!w||"string"===typeof w)&&(w instanceof Array||Array.isArray(w)||w.length>=0&&(w.splice instanceof Function||Object.getOwnPropertyDescriptor(w,w.length-1)&&"String"!==w.constructor.name))}},12684:(w,E,G)=>{var P=G(12688);function h(w){for(var E,G,h=0,B=w.length,y=0;y<w.length;){for(E=w[y],G=0;y<B&&w[y]===E;)++y,++G;h+=P.log2(G)/7|0,h+=P.log2(E>>>0)/7|0,h+=2}return h}E.size=h,E.encode=function(w,E){E||(E=new Uint8Array(h(w)));for(var G,P,B=0,y=E.length,x=0;x<w.length;){for(G=w[x],P=0;x<w.length&&w[x]===G;)++x,++P;for(;B<y&&P>=128;)E[B++]=128+(127&P),P>>>=7;if(B>=y)throw new Error("RLE buffer overflow");for(E[B++]=P,G>>>=0;B<y&&G>=128;)E[B++]=128+(127&G),G>>>=7;if(B>=y)throw new Error("RLE buffer overflow");E[B++]=G}return E},E.decode=function(w,E){for(var G,P,h,B,y=E.length,x=w.length,U=0,l=0;l<x;){for(G=0,P=0;l<x&&w[l]>=128;)G+=(127&w[l++])<<P,P+=7;if(G+=w[l++]<<P,l>=x)throw new Error("RLE buffer underrun");if(U+G>y)throw new Error("Chunk buffer overflow");for(h=0,P=0;l<x&&w[l]>=128;)h+=(127&w[l++])<<P,P+=7;if(l>=x)throw new Error("RLE buffer underrun");for(h+=w[l++]<<P,B=0;B<G;++B)E[U++]=h}return E}},12688:(w,E)=>{"use strict";function G(w){var E=32;return(w&=-w)&&E--,65535&w&&(E-=16),16711935&w&&(E-=8),252645135&w&&(E-=4),858993459&w&&(E-=2),1431655765&w&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(w){return(w>0)-(w<0)},E.abs=function(w){var E=w>>31;return(w^E)-E},E.min=function(w,E){return E^(w^E)&-(w<E)},E.max=function(w,E){return w^(w^E)&-(w<E)},E.isPow2=function(w){return!(w&w-1)&&!!w},E.log2=function(w){var E,G;return E=(w>65535)<<4,E|=G=((w>>>=E)>255)<<3,E|=G=((w>>>=G)>15)<<2,(E|=G=((w>>>=G)>3)<<1)|(w>>>=G)>>1},E.log10=function(w){return w>=1e9?9:w>=1e8?8:w>=1e7?7:w>=1e6?6:w>=1e5?5:w>=1e4?4:w>=1e3?3:w>=100?2:w>=10?1:0},E.popCount=function(w){return 16843009*((w=(858993459&(w-=w>>>1&1431655765))+(w>>>2&858993459))+(w>>>4)&252645135)>>>24},E.countTrailingZeros=G,E.nextPow2=function(w){return w+=0===w,--w,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)+1},E.prevPow2=function(w){return w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)-(w>>>1)},E.parity=function(w){return w^=w>>>16,w^=w>>>8,w^=w>>>4,27030>>>(w&=15)&1};var P=new Array(256);!function(w){for(var E=0;E<256;++E){var G=E,P=E,h=7;for(G>>>=1;G;G>>>=1)P<<=1,P|=1&G,--h;w[E]=P<<h&255}}(P),E.reverse=function(w){return P[255&w]<<24|P[w>>>8&255]<<16|P[w>>>16&255]<<8|P[w>>>24&255]},E.interleave2=function(w,E){return(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(w,E){return(w=65535&((w=16711935&((w=252645135&((w=858993459&((w=w>>>E&1431655765)|w>>>1))|w>>>2))|w>>>4))|w>>>16))<<16>>16},E.interleave3=function(w,E,G){return w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2),(w|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2))<<2},E.deinterleave3=function(w,E){return(w=1023&((w=4278190335&((w=251719695&((w=3272356035&((w=w>>>E&1227133513)|w>>>2))|w>>>4))|w>>>8))|w>>>16))<<22>>22},E.nextCombination=function(w){var E=w|w-1;return E+1|(~E&-~E)-1>>>G(w)+1}},12715:w=>{"use strict";w.exports=function(w,E,G,P){var h=self||window;try{try{var B;try{B=new h.Blob([w])}catch(l){(B=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(w),B=B.getBlob()}var y=h.URL||h.webkitURL,x=y.createObjectURL(B),U=new h[E](x,G);return y.revokeObjectURL(x),U}catch(l){return new h[E]("data:application/javascript,".concat(encodeURIComponent(w)),G)}}catch(l){if(!P)throw Error("Inline worker is not supported");return new h[E](P,G)}}},12414:(w,E,G)=>{"use strict";function P(w,E,G,P,h){var B={};return Object.keys(P).forEach((function(w){B[w]=P[w]})),B.enumerable=!!B.enumerable,B.configurable=!!B.configurable,("value"in B||B.initializer)&&(B.writable=!0),B=G.slice().reverse().reduce((function(G,P){return P(w,E,G)||G}),B),h&&void 0!==B.initializer&&(B.value=B.initializer?B.initializer.call(h):void 0,B.initializer=void 0),void 0===B.initializer&&(Object.defineProperty(w,E,B),B=null),B}G.d(E,{c:()=>P})},12412:(w,E,G)=>{"use strict";function P(w,E,G,P){G&&Object.defineProperty(w,E,{enumerable:G.enumerable,configurable:G.configurable,writable:G.writable,value:G.initializer?G.initializer.call(P):void 0})}G.d(E,{d:()=>P})},13729:(w,E,G)=>{"use strict";G.d(E,{d:()=>y,f:()=>O,j:()=>x,k:()=>B,n:()=>U,r:()=>h,t:()=>l,x:()=>i});var P=G(11874);class h{constructor(){this._easingMode=h.EASINGMODE_EASEIN}setEasingMode(w){const E=Math.min(Math.max(w,0),2);this._easingMode=E}getEasingMode(){return this._easingMode}easeInCore(w){throw new Error("You must implement this method")}ease(w){switch(this._easingMode){case h.EASINGMODE_EASEIN:return this.easeInCore(w);case h.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-w)}return w>=.5?.5*(1-this.easeInCore(2*(1-w)))+.5:.5*this.easeInCore(2*w)}}h.EASINGMODE_EASEIN=0,h.EASINGMODE_EASEOUT=1,h.EASINGMODE_EASEINOUT=2;class B extends h{easeInCore(w){return w=Math.max(0,Math.min(1,w)),1-Math.sqrt(1-w*w)}}class y extends h{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=w}easeInCore(w){const E=Math.max(0,this.amplitude);return Math.pow(w,3)-w*E*Math.sin(3.141592653589793*w)}}class x extends h{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=w,this.bounciness=E}easeInCore(w){const E=Math.max(0,this.bounces);let G=this.bounciness;G<=1&&(G=1.001);const P=Math.pow(G,E),h=1-G,B=(1-P)/h+.5*P,y=w*B,x=Math.log(-y*(1-G)+1)/Math.log(G),U=Math.floor(x),l=U+1,i=(1-Math.pow(G,U))/(h*B),O=.5*(i+(1-Math.pow(G,l))/(h*B)),u=w-O,V=O-i;return-Math.pow(1/G,E-U)/(V*V)*(u-V)*(u+V)}}class U extends h{easeInCore(w){return w*w*w}}class l extends h{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=w,this.springiness=E}easeInCore(w){let E;const G=Math.max(0,this.oscillations),P=Math.max(0,this.springiness);return E=0==P?w:(Math.exp(P*w)-1)/(Math.exp(P)-1),E*Math.sin((6.283185307179586*G+1.5707963267948966)*w)}}class i extends h{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=w}easeInCore(w){return this.exponent<=0?w:(Math.exp(this.exponent*w)-1)/(Math.exp(this.exponent)-1)}}class O extends h{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=w,this.y1=E,this.x2=G,this.y2=P}easeInCore(w){return P.e.Interpolate(w,this.x1,this.y1,this.x2,this.y2)}}},13219:(w,E,G)=>{"use strict";G.d(E,{b:()=>y});var P=G(11679),h=G(11684),B=G(12081);class y extends B.e{get _matrix(){return this._compose(),this.Iu}set _matrix(w){(w.updateFlag!==this.Iu.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Iu.B(w),this._markAsDirtyAndDecompose())}constructor(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(w,E.Ww(),!1),this.name=w,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=E,this.Iu=(null===h||void 0===h?void 0:h.clone())??P.Matrix.Identity(),this._restMatrix=B??this.Iu.clone(),this._bindMatrix=y??this.Iu.clone(),this._index=x,this._absoluteMatrix=new P.Matrix,this._absoluteBindMatrix=new P.Matrix,this._absoluteInverseBindMatrix=new P.Matrix,this._finalMatrix=new P.Matrix,E.bones.push(this),this.setParent(G,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(w){this.setParent(w)}setParent(w){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==w){if(this.parent){const w=this.parent.children.indexOf(this);-1!==w&&this.parent.children.splice(w,1)}this._parentNode=w,this.parent&&this.parent.children.push(this),E&&this._updateAbsoluteBindMatrices(),this.Sl()}}getLocalMatrix(){return this._compose(),this.Iu}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(w){this._restMatrix.B(w)}setRestPose(w){this.setRestMatrix(w)}getBindPose(){return this.getBindMatrix()}setBindMatrix(w){this.bh(w)}setBindPose(w){this.setBindMatrix(w)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const w=P.TmpVectors.QE[0],E=P.TmpVectors.Quaternion[0],G=P.TmpVectors.QE[1];this.getRestMatrix().decompose(w,E,G),this._linkedTransformNode.position.B(G),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??P.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.B(E),this._linkedTransformNode.qx.B(w)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(w){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=w,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.wU}set position(w){this._decompose(),this.wU.B(w),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(w){this.setRotation(w)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(w){this.setRotationQuaternion(w)}get qx(){return this.getScale()}set qx(w){this.setScale(w)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=P.QE.Zero(),this._localRotation=P.Quaternion.Zero(),this.wU=P.QE.Zero()),this.Iu.decompose(this._localScaling,this._localRotation,this.wU))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,P.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.wU,this.Iu)):this._needToCompose=!1)}bh(w){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.B(w),E&&this._updateAbsoluteBindMatrices(),G?this._matrix=w:this.Sl()}_updateAbsoluteBindMatrices(w){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(w||(w=this._bindMatrix),this.parent?w.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.B(w),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),E)for(let G=0;G<this.children.length;G++)this.children[G]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Sl(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Sl(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Sl(),this._needToDecompose=!0}_updatePosition(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=this.getLocalMatrix();if(0==E)h?(B.addAtIndex(12,w.x),B.addAtIndex(13,w.y),B.addAtIndex(14,w.z)):B.setTranslationFromFloats(w.x,w.y,w.z);else{let E=null;G&&(E=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const x=y._TmpMats[0],U=y._TmpVecs[0];this.parent?G&&E?(x.B(this.parent.getAbsoluteMatrix()),x.multiplyToRef(E,x)):x.B(this.parent.getAbsoluteMatrix()):P.Matrix.IdentityToRef(x),h&&x.setTranslationFromFloats(0,0,0),x.invert(),P.QE.TransformCoordinatesToRef(w,x,U),h?(B.addAtIndex(12,U.x),B.addAtIndex(13,U.y),B.addAtIndex(14,U.z)):B.setTranslationFromFloats(U.x,U.y,U.z)}this._markAsDirtyAndDecompose()}translate(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;this._updatePosition(w,E,G,!0)}setPosition(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;this._updatePosition(w,E,G,!1)}setAbsolutePosition(w,E){this.setPosition(w,1,E)}scale(w,E,G){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=this.getLocalMatrix(),x=y._TmpMats[0];P.Matrix.ScalingToRef(w,E,G,x),x.multiplyToRef(B,B),x.invert();for(const P of this.children){const h=P.getLocalMatrix();h.multiplyToRef(x,h),h.multiplyAtIndex(12,w),h.multiplyAtIndex(13,E),h.multiplyAtIndex(14,G),P._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),h)for(const P of this.children)P.scale(w,E,G,h)}setScale(w){this._decompose(),this._localScaling.B(w),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(w){this._decompose(),w.B(this._localScaling)}setYawPitchRoll(w,E,G){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4?arguments[4]:void 0;if(0===h){const x=y._TmpQuat;return P.Quaternion.RotationYawPitchRollToRef(w,E,G,x),void this.setRotationQuaternion(x,h,B)}const x=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,B))return;const U=y._TmpMats[1];P.Matrix.RotationYawPitchRollToRef(w,E,G,U),x.multiplyToRef(U,U),this._rotateWithMatrix(U,h,B)}rotate(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3?arguments[3]:void 0;const B=y._TmpMats[0];B.setTranslationFromFloats(0,0,0),P.Matrix.RotationAxisToRef(w,E,B),this._rotateWithMatrix(B,G,h)}setAxisAngle(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3?arguments[3]:void 0;if(0===G){const B=y._TmpQuat;return P.Quaternion.RotationAxisToRef(w,E,B),void this.setRotationQuaternion(B,G,h)}const B=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,h))return;const x=y._TmpMats[1];P.Matrix.RotationAxisToRef(w,E,x),B.multiplyToRef(x,x),this._rotateWithMatrix(x,G,h)}setRotation(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(w.y,w.x,w.z,E,G)}setRotationQuaternion(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;if(0===E)return this._decompose(),this._localRotation.B(w),void this._markAsDirtyAndCompose();const h=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,G))return;const B=y._TmpMats[1];P.Matrix.FromQuaternionToRef(w,B),h.multiplyToRef(B,B),this._rotateWithMatrix(B,E,G)}setRotationMatrix(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;if(0===E){const h=y._TmpQuat;return P.Quaternion.FromRotationMatrixToRef(w,h),void this.setRotationQuaternion(h,E,G)}const h=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,G))return;const B=y._TmpMats[1];B.B(w),h.multiplyToRef(w,B),this._rotateWithMatrix(B,E,G)}_rotateWithMatrix(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;const P=this.getLocalMatrix(),h=P.m[12],B=P.m[13],x=P.m[14],U=this.getParent(),l=y._TmpMats[3],i=y._TmpMats[4];U&&1==E?(G?(l.B(G.getWorldMatrix()),U.getAbsoluteMatrix().multiplyToRef(l,l)):l.B(U.getAbsoluteMatrix()),i.B(l),i.invert(),P.multiplyToRef(l,P),P.multiplyToRef(w,P),P.multiplyToRef(i,P)):1==E&&G?(l.B(G.getWorldMatrix()),i.B(l),i.invert(),P.multiplyToRef(l,P),P.multiplyToRef(w,P),P.multiplyToRef(i,P)):P.multiplyToRef(w,P),P.setTranslationFromFloats(h,B,x),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(w,E){const G=y._TmpMats[2];return w.B(this.getAbsoluteMatrix()),E?(w.multiplyToRef(E.getWorldMatrix(),w),P.Matrix.ScalingToRef(E.qx.x,E.qx.y,E.qx.z,G)):P.Matrix.IdentityToRef(G),w.invert(),!isNaN(w.m[0])&&(G.multiplyAtIndex(0,this._scalingDeterminant),w.multiplyToRef(G,w),!0)}xh(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=P.QE.Zero();return this.getPositionToRef(w,E,G),G}getPositionToRef(){let w=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const w=this.getLocalMatrix();E.x=w.m[12],E.y=w.m[13],E.z=w.m[14]}else{let G=null;w&&(G=w.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let P=y._TmpMats[0];w&&G?(P.B(this.getAbsoluteMatrix()),P.multiplyToRef(G,P)):P=this.getAbsoluteMatrix(),E.x=P.m[12],E.y=P.m[13],E.z=P.m[14]}}getAbsolutePosition(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=P.QE.Zero();return this.getPositionToRef(1,w,E),E}getAbsolutePositionToRef(w,E){this.getPositionToRef(1,w,E)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Iu.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.B(this.Iu);const w=this._skeleton.getPoseMatrix();w&&this._absoluteMatrix.multiplyToRef(w,this._absoluteMatrix)}const w=this.children,E=w.length;for(let G=0;G<E;G++)w[G].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}gU(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=P.QE.Zero();return this.getDirectionToRef(w,E,G),G}getDirectionToRef(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0,h=null;E&&(h=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=y._TmpMats[0];B.B(this.getAbsoluteMatrix()),E&&h&&B.multiplyToRef(h,B),P.QE.TransformNormalToRef(w,B,G),G.normalize()}getRotation(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=P.QE.Zero();return this.getRotationToRef(w,E,G),G}getRotationToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0;const P=y._TmpQuat;this.getRotationQuaternionToRef(w,E,P),P.toEulerAnglesToRef(G)}getRotationQuaternion(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=P.Quaternion.Identity();return this.getRotationQuaternionToRef(w,E,G),G}getRotationQuaternionToRef(){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),E.B(this._localRotation);else{const G=y._TmpMats[0],P=this.getAbsoluteMatrix();w?P.multiplyToRef(w.getWorldMatrix(),G):G.B(P),G.multiplyAtIndex(0,this._scalingDeterminant),G.multiplyAtIndex(1,this._scalingDeterminant),G.multiplyAtIndex(2,this._scalingDeterminant),G.decompose(void 0,E,void 0)}}getRotationMatrix(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1?arguments[1]:void 0;const G=P.Matrix.Identity();return this.getRotationMatrixToRef(w,E,G),G}getRotationMatrixToRef(){let w=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(E);else{const G=y._TmpMats[0],P=this.getAbsoluteMatrix();w?P.multiplyToRef(w.getWorldMatrix(),G):G.B(P),G.multiplyAtIndex(0,this._scalingDeterminant),G.multiplyAtIndex(1,this._scalingDeterminant),G.multiplyAtIndex(2,this._scalingDeterminant),G.getRotationMatrixToRef(E)}}getAbsolutePositionFromLocal(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=P.QE.Zero();return this.getAbsolutePositionFromLocalToRef(w,E,G),G}getAbsolutePositionFromLocalToRef(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0,h=null;E&&(h=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=y._TmpMats[0];B.B(this.getAbsoluteMatrix()),E&&h&&B.multiplyToRef(h,B),P.QE.TransformCoordinatesToRef(w,B,G)}getLocalPositionFromAbsolute(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=P.QE.Zero();return this.getLocalPositionFromAbsoluteToRef(w,E,G),G}getLocalPositionFromAbsoluteToRef(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0,h=null;E&&(h=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=y._TmpMats[0];B.B(this.getAbsoluteMatrix()),E&&h&&B.multiplyToRef(h,B),B.invert(),P.QE.TransformCoordinatesToRef(w,B,G)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const w=this._skeleton.bones.indexOf(this);if(-1!==w&&this._skeleton.bones.splice(w,1),this._parentNode&&this._parentNode.children){const w=this._parentNode.children,E=w.indexOf(this);-1!==E&&w.splice(E,1)}super.dispose()}}y._TmpVecs=(0,h.d)(2,P.QE.Zero),y._TmpQuat=P.Quaternion.Identity(),y._TmpMats=(0,h.d)(5,P.Matrix.Identity)},13722:(w,E,G)=>{"use strict";G.d(E,{c:()=>v});var P=G(11668),h=G(11671),B=G(11504),y=G(11679),x=G(11689),U=G(12081),l=G(12103),i=G(11947),O=G(11528),u=G(11681);class V{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(w){this._zoomStopsAnimation=w}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(w){this._idleRotationSpeed=w}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(w){this._idleRotationWaitTime=w}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(w){this._idleRotationSpinupTime=w}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(w){this._attachedCamera=w;const E=this._attachedCamera.Ww();this._onPrePointerObservableObserver=E.onPrePointerObservable.add((w=>{w.type!==i.e.POINTERDOWN?w.type===i.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const w=O.c.Now;let E=0;null!=this._lastFrameTime&&(E=w-this._lastFrameTime),this._lastFrameTime=w,this._applyUserInteraction();const G=w-this._lastInteractionTime-this._idleRotationWaitTime,P=Math.max(Math.min(G/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*P,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(E/1e3))}))}detach(){if(!this._attachedCamera)return;const w=this._attachedCamera.Ww();this._onPrePointerObservableObserver&&w.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(w){this._lastInteractionTime=w??O.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<u.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let w=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(w=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?w:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=O.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var a=G(13729),Q=G(12181);class c{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(w){if(this._autoTransitionRange===w)return;this._autoTransitionRange=w;const E=this._attachedCamera;E&&(w?this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((w=>{if(w&&(w.Ah(!0),w.getBoundingInfo)){const E=w.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*E,this.upperRadiusTransitionRange=.05*E}})):this._onMeshTargetChangedObserver&&E.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(w){this._attachedCamera=w,this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(w){return!!this._attachedCamera&&(this._attachedCamera.radius===w&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(w){if(!this._attachedCamera)return;this._radiusBounceTransition||(c.EasingFunction.setEasingMode(c.EasingMode),this._radiusBounceTransition=Q.e.CreateAnimation("radius",Q.e.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const E=Q.e.TransitionTo("radius",this._attachedCamera.radius+w,this._attachedCamera,this._attachedCamera.Ww(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));E&&this._animatables.push(E)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}c.EasingFunction=new a.d(.3),c.EasingMode=a.r.EASINGMODE_EASEOUT;class Z{constructor(){this.onTargetFramingAnimationEndObservable=new B.d,this._mode=Z.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(w){this._mode=w}get mode(){return this._mode}set radiusScale(w){this._radiusScale=w}get radiusScale(){return this._radiusScale}set positionScale(w){this._positionScale=w}get positionScale(){return this._positionScale}set defaultElevation(w){this._defaultElevation=w}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(w){this._elevationReturnTime=w}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(w){this._elevationReturnWaitTime=w}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(w){this._zoomStopsAnimation=w}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(w){this._framingTime=w}get framingTime(){return this._framingTime}init(){}attach(w){this._attachedCamera=w;const E=this._attachedCamera.Ww();Z.EasingFunction.setEasingMode(Z.EasingMode),this._onPrePointerObservableObserver=E.onPrePointerObservable.add((w=>{w.type!==i.e.POINTERDOWN?w.type===i.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=w.onMeshTargetChangedObservable.add((w=>{w&&w.getBoundingInfo&&this.zoomOnMesh(w,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const w=this._attachedCamera.Ww();this._onPrePointerObservableObserver&&w.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w.Ah(!0);const P=w.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(P.minimumWorld,P.maximumWorld,E,G)}zoomOnMeshHierarchy(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w.Ah(!0);const P=w.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(P.min,P.max,E,G)}zoomOnMeshesHierarchy(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new y.QE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new y.QE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let B=0;B<w.length;B++){const E=w[B].getHierarchyBoundingVectors(!0);y.QE.CheckExtends(E.min,P,h),y.QE.CheckExtends(E.max,P,h)}this.zoomOnBoundingInfo(P,h,E,G)}zoomOnBoundingInfo(w,E){let G,P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const B=w.y,x=B+(E.y-B)*this._positionScale,U=E.cE(w).scale(.5);if(!isFinite(x))return!1;if(P)G=new y.QE(0,x,0);else{const E=w.add(U);G=new y.QE(E.x,x,E.z)}this._vectorTransition||(this._vectorTransition=Q.e.CreateAnimation("target",Q.e.ANIMATIONTYPE_VECTOR3,60,Z.EasingFunction)),this._betaIsAnimating=!0;let l=Q.e.TransitionTo("target",G,this._attachedCamera,this._attachedCamera.Ww(),60,this._vectorTransition,this._framingTime);l&&this._animatables.push(l);let i=0;if(this._mode===Z.FitFrustumSidesMode){const G=this._calculateLowerRadiusFromModelBoundingSphere(w,E);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=U.length()+this._attachedCamera.Sh),i=G}else this._mode===Z.IgnoreBoundsSizeMode&&(i=this._calculateLowerRadiusFromModelBoundingSphere(w,E),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Sh));if(this.autoCorrectCameraLimitsAndSensibility){const G=E.cE(w).length();this._attachedCamera.panningSensibility=5e3/G,this._attachedCamera.wheelPrecision=100/i}return this._radiusTransition||(this._radiusTransition=Q.e.CreateAnimation("radius",Q.e.ANIMATIONTYPE_FLOAT,60,Z.EasingFunction)),l=Q.e.TransitionTo("radius",i,this._attachedCamera,this._attachedCamera.Ww(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),h&&h(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),l&&this._animatables.push(l),!0}_calculateLowerRadiusFromModelBoundingSphere(w,E){const G=this._attachedCamera;if(!G)return 0;let P=G._calculateLowerRadiusFromModelBoundingSphere(w,E,this._radiusScale);return G.lowerRadiusLimit&&this._mode===Z.IgnoreBoundsSizeMode&&(P=P<G.lowerRadiusLimit?G.lowerRadiusLimit:P),G.upperRadiusLimit&&(P=P>G.upperRadiusLimit?G.upperRadiusLimit:P),P}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const w=O.c.Now-this._lastInteractionTime,E=.5*Math.PI-this._defaultElevation,G=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>G&&w>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Q.e.CreateAnimation("beta",Q.e.ANIMATIONTYPE_FLOAT,60,Z.EasingFunction));const w=Q.e.TransitionTo("beta",E,this._attachedCamera,this._attachedCamera.Ww(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));w&&this._animatables.push(w)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=O.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Z.EasingFunction=new a.x,Z.EasingMode=a.r.EASINGMODE_EASEINOUT,Z.IgnoreBoundsSizeMode=0,Z.FitFrustumSidesMode=1;var J=G(12110),d=G(12139),K=G(13212),t=G(11498);class q{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(w){w=t.Tools.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),G=E.getInputElement();let P=0,h=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=B=>{var y,x;const U=B.event,l="touch"===U.pointerType;if(B.type!==i.e.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const O=U.target;if(this._altKey=U.altKey,this._ctrlKey=U.ctrlKey,this._metaKey=U.metaKey,this._shiftKey=U.shiftKey,this._buttonsPressed=U.buttons,E.isPointerLock){const w=U.movementX,E=U.movementY;this.onTouch(null,w,E),this._pointA=null,this._pointB=null}else{if(B.type!==i.e.POINTERDOWN&&B.type!==i.e.POINTERDOUBLETAP&&l&&(null===(y=this._pointA)||void 0===y?void 0:y.pointerId)!==U.pointerId&&(null===(x=this._pointB)||void 0===x?void 0:x.pointerId)!==U.pointerId)return;if(B.type!==i.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!l)if(B.type===i.e.POINTERDOUBLETAP)this.onDoubleTap(U.pointerType);else if(B.type!==i.e.POINTERUP||this._currentMousePointerIdDown!==U.pointerId&&!l){if(B.type===i.e.POINTERMOVE)if(w||U.preventDefault(),this._pointA&&null===this._pointB){const w=U.clientX-this._pointA.x,E=U.clientY-this._pointA.y;this._pointA.x=U.clientX,this._pointA.y=U.clientY,this.onTouch(this._pointA,w,E)}else if(this._pointA&&this._pointB){const w=this._pointA.pointerId===U.pointerId?this._pointA:this._pointB;w.x=U.clientX,w.y=U.clientY;const E=this._pointA.x-this._pointB.x,G=this._pointA.y-this._pointB.y,y=E*E+G*G,x={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:U.pointerId,type:B.type};this.onMultiTouch(this._pointA,this._pointB,P,y,h,x),h=x,P=y}}else{try{null===O||void 0===O||O.releasePointerCapture(U.pointerId)}catch(u){}l||(this._pointB=null),E._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==U.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==U.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==P||h)&&(this.onMultiTouch(this._pointA,this._pointB,P,0,h,null),P=0,h=null),this._currentMousePointerIdDown=-1,this.onButtonUp(U),w||U.preventDefault()}else{try{null===O||void 0===O||O.setPointerCapture(U.pointerId)}catch(u){}if(null===this._pointA)this._pointA={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType};else{if(null!==this._pointB)return;this._pointB={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType}}-1!==this._currentMousePointerIdDown||l||(this._currentMousePointerIdDown=U.pointerId),this.onButtonDown(U),w||(U.preventDefault(),G&&G.focus())}}},this._observer=this.camera.Ww()._inputManager._addCameraPointerObserver(this._pointerInput,i.e.POINTERDOWN|i.e.POINTERUP|i.e.POINTERMOVE|i.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,P=0,h=null,this.onLostFocus()},this._contextMenuBind=w=>this.onContextMenu(w),G&&G.addEventListener("contextmenu",this._contextMenuBind,!1);const B=this.camera.Ww().getEngine().getHostWindow();B&&t.Tools.RegisterTopRootEvents(B,[{name:"blur",handler:this._onLostFocus}])}MO(){if(this._onLostFocus){const w=this.camera.Ww().getEngine().getHostWindow();w&&t.Tools.UnregisterTopRootEvents(w,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Ww()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const w=this.camera.Ww().getEngine().getInputElement();w&&w.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(w){}onTouch(w,E,G){}onMultiTouch(w,E,G,P,h,B){}onContextMenu(w){w.preventDefault()}onButtonDown(w){}onButtonUp(w){}onLostFocus(){}}(0,P.c)([(0,h.F)()],q.prototype,"buttons",void 0);class W extends q{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(w,E){if(0!==this.panningSensibility&&w&&E){const G=E.x-w.x,P=E.y-w.y;this.camera.inertialPanningX+=-G/this.panningSensibility,this.camera.inertialPanningY+=P/this.panningSensibility}}_computePinchZoom(w,E){const G=this.camera.radius||W.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=G*Math.sqrt(w)/Math.sqrt(E):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(E-w)*G*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(E-w)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(w,E,G){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-E/this.panningSensibility,this.camera.inertialPanningY+=G/this.panningSensibility):(this.camera.inertialAlphaOffset-=E/this.angularSensibilityX,this.camera.inertialBetaOffset-=G/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(w,E,G,P,h,B){0===G&&null===h||0===P&&null===B||(this.multiTouchPanAndZoom?(this._computePinchZoom(G,P),this._computeMultiTouchPanning(h,B)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(P)-Math.sqrt(G))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(G,P),this._isPinching=!0):this._computeMultiTouchPanning(h,B)):this.multiTouchPanning?this._computeMultiTouchPanning(h,B):this.pinchZoom&&this._computePinchZoom(G,P))}onButtonDown(w){this._isPanClick=w.button===this.camera._panningMouseButton}onButtonUp(w){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}W.MinimumRadiusForPinch=.001,(0,P.c)([(0,h.F)()],W.prototype,"buttons",void 0),(0,P.c)([(0,h.F)()],W.prototype,"angularSensibilityX",void 0),(0,P.c)([(0,h.F)()],W.prototype,"angularSensibilityY",void 0),(0,P.c)([(0,h.F)()],W.prototype,"pinchPrecision",void 0),(0,P.c)([(0,h.F)()],W.prototype,"pinchDeltaPercentage",void 0),(0,P.c)([(0,h.F)()],W.prototype,"useNaturalPinchZoom",void 0),(0,P.c)([(0,h.F)()],W.prototype,"pinchZoom",void 0),(0,P.c)([(0,h.F)()],W.prototype,"panningSensibility",void 0),(0,P.c)([(0,h.F)()],W.prototype,"multiTouchPanning",void 0),(0,P.c)([(0,h.F)()],W.prototype,"multiTouchPanAndZoom",void 0),K.c.ArcRotateCameraPointersInput=W;var T=G(11950);class I{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(w){w=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ww(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const G=E.event;if(!G.metaKey)if(E.type===T.b.KEYDOWN){if(this._ctrlPressed=G.ctrlKey,this._altPressed=G.altKey,-1!==this.keysUp.indexOf(G.keyCode)||-1!==this.keysDown.indexOf(G.keyCode)||-1!==this.keysLeft.indexOf(G.keyCode)||-1!==this.keysRight.indexOf(G.keyCode)||-1!==this.keysReset.indexOf(G.keyCode)){-1===this._keys.indexOf(G.keyCode)&&this._keys.push(G.keyCode),G.preventDefault&&(w||G.preventDefault())}}else if(-1!==this.keysUp.indexOf(G.keyCode)||-1!==this.keysDown.indexOf(G.keyCode)||-1!==this.keysLeft.indexOf(G.keyCode)||-1!==this.keysRight.indexOf(G.keyCode)||-1!==this.keysReset.indexOf(G.keyCode)){const E=this._keys.indexOf(G.keyCode);E>=0&&this._keys.splice(E,1),G.preventDefault&&(w||G.preventDefault())}})))}MO(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const w=this.camera;for(let E=0;E<this._keys.length;E++){const G=this._keys[E];-1!==this.keysLeft.indexOf(G)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningX-=1/this.panningSensibility:w.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(G)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?w.inertialRadiusOffset+=1/this.zoomingSensibility:w.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(G)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningX+=1/this.panningSensibility:w.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(G)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?w.inertialRadiusOffset-=1/this.zoomingSensibility:w.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(G)&&w.useInputToRestoreState&&w.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,P.c)([(0,h.F)()],I.prototype,"keysUp",void 0),(0,P.c)([(0,h.F)()],I.prototype,"keysDown",void 0),(0,P.c)([(0,h.F)()],I.prototype,"keysLeft",void 0),(0,P.c)([(0,h.F)()],I.prototype,"keysRight",void 0),(0,P.c)([(0,h.F)()],I.prototype,"keysReset",void 0),(0,P.c)([(0,h.F)()],I.prototype,"panningSensibility",void 0),(0,P.c)([(0,h.F)()],I.prototype,"zoomingSensibility",void 0),(0,P.c)([(0,h.F)()],I.prototype,"useAltToZoom",void 0),(0,P.c)([(0,h.F)()],I.prototype,"angularSpeed",void 0),K.c.ArcRotateCameraKeyboardMoveInput=I;var j=G(11722),g=G(11955);class o{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new y.QE(0,0,0),this._globalOffset=new y.QE(0,0,0),this._inertialPanning=y.QE.Zero()}_computeDeltaFromMouseWheelLegacyEvent(w,E){let G=0;const P=.01*w*this.wheelDeltaPercentage*E;return G=w>0?P/(1+this.wheelDeltaPercentage):P*(1+this.wheelDeltaPercentage),G}attachControl(w){w=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==i.e.POINTERWHEEL)return;const G=E.event;let P=0;const h=G.deltaMode===g.e.DOM_DELTA_LINE?40:1,B=-G.deltaY*h;if(this.customComputeDeltaFromMouseWheel)P=this.customComputeDeltaFromMouseWheel(B,this,G);else if(this.wheelDeltaPercentage){if(P=this._computeDeltaFromMouseWheelLegacyEvent(B,this.camera.radius),P>0){let w=this.camera.radius,E=this.camera.inertialRadiusOffset+P;for(let G=0;G<20&&!(w<=E)&&!(Math.abs(E*this.camera.inertia)<.001);G++)w-=E,E*=this.camera.inertia;w=(0,x.Clamp)(w,0,Number.MAX_VALUE),P=this._computeDeltaFromMouseWheelLegacyEvent(B,w)}}else P=B/(40*this.wheelPrecision);P&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(P)):this.camera.inertialRadiusOffset+=P),G.preventDefault&&(w||G.preventDefault())},this._observer=this.camera.Ww()._inputManager._addCameraPointerObserver(this._wheel,i.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Wx(0)}MO(){this._observer&&(this.camera.Ww()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const w=this.camera;0+w.inertialAlphaOffset+w.inertialBetaOffset+w.inertialRadiusOffset&&(this._updateHitPlane(),w.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(w.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const w=this.camera,E=w.target.cE(w.position);this._hitPlane=j.d.FromPositionAndNormal(w.target,E)}_getPosition(){const w=this.camera,E=w.Ww(),G=E.createPickingRay(E.pointerX,E.pointerY,y.Matrix.Identity(),w,!1);0===w.targetScreenOffset.x&&0===w.targetScreenOffset.y||(this._viewOffset.set(w.targetScreenOffset.x,w.targetScreenOffset.y,0),w.getViewMatrix().invertToRef(w._cameraTransformMatrix),this._globalOffset=y.QE.TransformNormal(this._viewOffset,w._cameraTransformMatrix),G.origin.addInPlace(this._globalOffset));let P=0;return this._hitPlane&&(P=G.intersectsPlane(this._hitPlane)??0),G.origin.addInPlace(G.direction.scaleInPlace(P))}_zoomToMouse(w){const E=this.camera,G=1-E.inertia;if(E.lowerRadiusLimit){const P=E.lowerRadiusLimit??0;E.radius-(E.inertialRadiusOffset+w)/G<P&&(w=(E.radius-P)*G-E.inertialRadiusOffset)}if(E.upperRadiusLimit){const P=E.upperRadiusLimit??0;E.radius-(E.inertialRadiusOffset+w)/G>P&&(w=(E.radius-P)*G-E.inertialRadiusOffset)}const P=w/G/E.radius,h=this._getPosition(),B=y.TmpVectors.QE[6];h.subtractToRef(E.target,B),B.scaleInPlace(P),B.scaleInPlace(G),this._inertialPanning.addInPlace(B),E.inertialRadiusOffset+=w}_zeroIfClose(w){Math.abs(w.x)<u.d&&(w.x=0),Math.abs(w.y)<u.d&&(w.y=0),Math.abs(w.z)<u.d&&(w.z=0)}}(0,P.c)([(0,h.F)()],o.prototype,"wheelPrecision",void 0),(0,P.c)([(0,h.F)()],o.prototype,"zoomToMouseLocation",void 0),(0,P.c)([(0,h.F)()],o.prototype,"wheelDeltaPercentage",void 0),K.c.ArcRotateCameraMouseWheelInput=o;class f extends K.e{constructor(w){super(w)}addMouseWheel(){return this.add(new o),this}addPointers(){return this.add(new W),this}addKeyboard(){return this.add(new I),this}}var k=G(11646);function N(w,E){return isNaN(w)?E:w}U.e.AddNodeConstructor("ArcRotateCamera",((w,E)=>()=>new v(w,0,0,1,y.QE.Zero(),E)));class v extends d.c{get target(){return this._target}set target(w){this.setTarget(w)}get targetHost(){return this._targetHost}set targetHost(w){w&&this.setTarget(w)}getTarget(){return this.target}get position(){return this._position}set position(w){this.setPosition(w)}set upVector(w){this._upToYMatrix||(this._yToUpMatrix=new y.Matrix,this._upToYMatrix=new y.Matrix,this._upVector=y.QE.Zero()),w.normalize(),this._upVector.B(w),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){y.Matrix.RotationAlignToRef(y.QE.UpReadOnly,this._upVector,this._yToUpMatrix),y.Matrix.RotationAlignToRef(this._upVector,y.QE.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const w=this.inputs.attached.pointers;return w?w.angularSensibilityX:0}set angularSensibilityX(w){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityX=w)}get angularSensibilityY(){const w=this.inputs.attached.pointers;return w?w.angularSensibilityY:0}set angularSensibilityY(w){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityY=w)}get pinchPrecision(){const w=this.inputs.attached.pointers;return w?w.pinchPrecision:0}set pinchPrecision(w){const E=this.inputs.attached.pointers;E&&(E.pinchPrecision=w)}get pinchDeltaPercentage(){const w=this.inputs.attached.pointers;return w?w.pinchDeltaPercentage:0}set pinchDeltaPercentage(w){const E=this.inputs.attached.pointers;E&&(E.pinchDeltaPercentage=w)}get useNaturalPinchZoom(){const w=this.inputs.attached.pointers;return!!w&&w.useNaturalPinchZoom}set useNaturalPinchZoom(w){const E=this.inputs.attached.pointers;E&&(E.useNaturalPinchZoom=w)}get panningSensibility(){const w=this.inputs.attached.pointers;return w?w.panningSensibility:0}set panningSensibility(w){const E=this.inputs.attached.pointers;E&&(E.panningSensibility=w)}get keysUp(){const w=this.inputs.attached.keyboard;return w?w.keysUp:[]}set keysUp(w){const E=this.inputs.attached.keyboard;E&&(E.keysUp=w)}get keysDown(){const w=this.inputs.attached.keyboard;return w?w.keysDown:[]}set keysDown(w){const E=this.inputs.attached.keyboard;E&&(E.keysDown=w)}get keysLeft(){const w=this.inputs.attached.keyboard;return w?w.keysLeft:[]}set keysLeft(w){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=w)}get keysRight(){const w=this.inputs.attached.keyboard;return w?w.keysRight:[]}set keysRight(w){const E=this.inputs.attached.keyboard;E&&(E.keysRight=w)}get wheelPrecision(){const w=this.inputs.attached.mousewheel;return w?w.wheelPrecision:0}set wheelPrecision(w){const E=this.inputs.attached.mousewheel;E&&(E.wheelPrecision=w)}get zoomToMouseLocation(){const w=this.inputs.attached.mousewheel;return!!w&&w.zoomToMouseLocation}set zoomToMouseLocation(w){const E=this.inputs.attached.mousewheel;E&&(E.zoomToMouseLocation=w)}get wheelDeltaPercentage(){const w=this.inputs.attached.mousewheel;return w?w.wheelDeltaPercentage:0}set wheelDeltaPercentage(w){const E=this.inputs.attached.mousewheel;E&&(E.wheelDeltaPercentage=w)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(w){w!==this.useBouncingBehavior&&(w?(this._bouncingBehavior=new c,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(w){w!==this.useFramingBehavior&&(w?(this._framingBehavior=new Z,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(w){w!==this.useAutoRotationBehavior&&(w?(this._autoRotationBehavior=new V,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(w,E,G,P,h,x){var U;let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(w,y.QE.Zero(),x,l),U=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=y.QE.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new y.Matrix,this.panningAxis=new y.QE(1,1,0),this._transformedDirection=new y.QE,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new B.d,this.checkCollisions=!1,this.collisionRadius=new y.QE(.5,.5,.5),this._previousPosition=y.QE.Zero(),this._collisionVelocity=y.QE.Zero(),this._newPosition=y.QE.Zero(),this._computationVector=y.QE.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new y.QE(NaN,NaN,NaN),this._goalTargetScreenOffset=new y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G?(U.setPosition(E),U.JV&&U.JV(G)):U._previousPosition.B(U._position);const P=Math.cos(U.alpha),h=Math.sin(U.alpha),B=Math.cos(U.beta);let y=Math.sin(U.beta);0===y&&(y=1e-4);const x=U._getTargetPosition();U._computationVector.tx(U.radius*P*y,U.radius*B,U.radius*h*y),x.addToRef(U._computationVector,U._newPosition),U._position.B(U._newPosition);let l=U.upVector;U.allowUpsideDown&&U.beta<0&&(l=l.clone(),l=l.negate()),U._computeViewMatrix(U._position,x,l),U._viewMatrix.addAtIndex(12,U.targetScreenOffset.x),U._viewMatrix.addAtIndex(13,U.targetScreenOffset.y),U._collisionTriggered=!1},this._target=y.QE.Zero(),h&&this.setTarget(h),this.alpha=E,this.beta=G,this.radius=P,this.getViewMatrix(),this.inputs=new f(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new y.QE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=y.Vector2.Zero()}_updateCache(w){w||super._updateCache(),this._cache._target.B(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.B(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const w=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?w.addToRef(this._targetBoundingCenter,this._target):this._target.B(w)}const w=this._getLockedTargetPosition();return w||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>u.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,B=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=B?this._currentInterpolationFactor=B:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=N(w,this._goalAlpha),this._goalBeta=N(E,this._goalBeta),this._goalRadius=N(G,this._goalRadius),this._goalTarget.set(N(P.x,this._goalTarget.x),N(P.y,this._goalTarget.y),N(P.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(N(h.x,this._goalTargetScreenOffset.x),N(h.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,x.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,x.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,x.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,x.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(w,E){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const h=arguments;E=t.Tools.BackCompatCameraNoPreventDefault(h),this._useCtrlForPanning=G,this._panningMouseButton=P,"boolean"===typeof h[0]&&(h.length>1&&(this._useCtrlForPanning=h[1]),h.length>2&&(this._panningMouseButton=h[2])),this.inputs.attachElement(E),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}MO(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let w=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){w=!0;const E=this.invertRotation?-1:1,G=this._calculateHandednessMultiplier();let P=this.inertialAlphaOffset*G;this.beta<0&&(P*=-1),this.alpha+=P*E,this.beta+=this.inertialBetaOffset*E,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<u.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<u.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*u.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){w=!0;const E=new y.QE(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),E.multiplyInPlace(this.panningAxis),y.QE.TransformNormalToRef(E,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const w=this.upVector,E=y.QE.CrossToRef(this._transformedDirection,w,this._transformedDirection);y.QE.CrossToRef(w,E,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);y.QE.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.B(this._transformedDirection)}else{if(this.parent){const w=y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(w),w.transposeToRef(w),y.QE.TransformCoordinatesToRef(this._transformedDirection,w,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*u.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*u.d&&(this.inertialPanningY=0)}if(w)this.stopInterpolation();else if(this._isInterpolating){let w=!1;const E=this._scene.getEngine().getDeltaTime()/1e3,G=1-Math.pow(2,-E/this._currentInterpolationFactor),P=N(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const E=y.TmpVectors.QE[0].set(N(this._goalTarget.x,this._target.x),N(this._goalTarget.y,this._target.y),N(this._goalTarget.z,this._target.z));y.QE.LerpToRef(this.target,E,G,this._target),10*y.QE.Distance(this.target,E)/P<u.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.B(E),this.setTarget(this.target,!1,!0,!0)):w=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const E=y.Quaternion.RotationAlphaBetaGammaToRef(N(this._goalAlpha,this.alpha),N(this._goalBeta,this.beta),0,y.TmpVectors.Quaternion[0]),P=y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,y.TmpVectors.Quaternion[1]),h=y.Quaternion.SlerpToRef(P,E,G,y.TmpVectors.Quaternion[2]);h.normalize();const B=h.toAlphaBetaGammaToRef(y.TmpVectors.QE[0]);if(this.alpha=B.x,this.beta=B.y,h.isApprox(E,u.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const w=E.toAlphaBetaGammaToRef(y.TmpVectors.QE[0]);this.alpha=w.x,this.beta=w.y}else w=!0}if(isNaN(this._goalRadius)||(this.radius+=(P-this.radius)*G,Math.abs(P/this.radius-1)<u.d?(this._goalRadius=NaN,this.radius=P):w=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const E=y.TmpVectors.Vector2[0].set(N(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),N(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));y.Vector2.LerpToRef(this.targetScreenOffset,E,G,this.targetScreenOffset),y.Vector2.Distance(this.targetScreenOffset,E)<u.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.B(E)):w=!0}this._isInterpolating=w}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||y.QE.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const w=this.alpha;var E,G;this.alpha=function(w){let E=Math.PI/2;return 0===w.x&&0===w.z||(E=Math.acos(w.x/Math.sqrt(Math.pow(w.x,2)+Math.pow(w.z,2)))),w.z<0&&(E=2*Math.PI-E),E}(this._computationVector),this.beta=(E=this._computationVector.y,G=this.radius,Math.acos(E/G));const P=Math.round((w-this.alpha)/(2*Math.PI));this.alpha+=2*P*Math.PI,this._checkLimits()}setPosition(w){this._position.equals(w)||(this._position.B(w),this.rebuildAnglesAndRadius())}setTarget(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(P=this.overrideCloneAlphaBetaRadius??P,w.Ah)E&&w.getBoundingInfo?this._targetBoundingCenter=w.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,w.Ah(),this._targetHost=w,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const E=w,P=this._getTargetPosition();if(P&&!G&&P.equals(E))return;this._targetHost=null,this._target=E,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}P||this.rebuildAnglesAndRadius()}_getViewMatrix(){const w=Math.cos(this.alpha),E=Math.sin(this.alpha),G=Math.cos(this.beta);let P=Math.sin(this.beta);0===P&&(P=1e-4),0===this.radius&&(this.radius=1e-4);const h=this._getTargetPosition();if(this._computationVector.tx(this.radius*w*P,this.radius*G,this.radius*E*P),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||y.QE.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),h.addToRef(this._computationVector,this._newPosition),this.Ww().collisionsEnabled&&this.checkCollisions){const w=this.Ww().collisionCoordinator;this._collider||(this._collider=w.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,w.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.B(this._newPosition);let w=this.upVector;this.allowUpsideDown&&P<0&&(w=w.negate()),this._computeViewMatrix(this._position,h,w),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.B(h),this._viewMatrix}zoomOn(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w=w||this.Ww().meshes;const G=l.c.MinMax(w);let P=this._calculateLowerRadiusFromModelBoundingSphere(G.min,G.max);if(P=Math.max(Math.min(P,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=P*this.zoomOnFactor,this.mode===J.c.ORTHOGRAPHIC_CAMERA){const w=this.Ww().getEngine().getAspectRatio(this),E=P*this.zoomOnFactor/2;this.orthoLeft=-E*w,this.orthoRight=E*w,this.orthoBottom=-E,this.orthoTop=E}this.focusOn({min:G.min,max:G.max,distance:P},E)}focusOn(w){let E,G,P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===w.min){const P=w||this.Ww().meshes;E=l.c.MinMax(P),G=y.QE.Distance(E.min,E.max)}else{E=w,G=w.distance}this._target=l.c.Center(E),P||(this.maxZ=2*G)}createRigCamera(w,E){let G=0;switch(this.cameraRigMode){case J.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case J.c.RIG_MODE_VR:G=this._cameraRigParams.stereoHalfAngle*(0===E?1:-1);break;case J.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:G=this._cameraRigParams.stereoHalfAngle*(0===E?-1:1)}const P=new v(w,this.alpha+G,this.beta,this.radius,this._target,this.Ww());return P._cameraRigParams={},P.isRigCamera=!0,P.rigParent=this,P.upVector=this.upVector,P.mode=this.mode,P.orthoLeft=this.orthoLeft,P.orthoRight=this.orthoRight,P.orthoBottom=this.orthoBottom,P.orthoTop=this.orthoTop,P}_updateRigCameras(){const w=this._rigCameras[0],E=this._rigCameras[1];switch(w.beta=E.beta=this.beta,this.cameraRigMode){case J.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case J.c.RIG_MODE_VR:w.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case J.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:w.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const P=y.QE.Distance(w,E),h=this.Ww().getEngine().getAspectRatio(this),B=Math.tan(this.fov/2),x=B*h,U=.5*P*G,l=U*Math.sqrt(1+1/(x*x)),i=U*Math.sqrt(1+1/(B*B));return Math.max(l,i)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,P.c)([(0,h.F)()],v.prototype,"alpha",void 0),(0,P.c)([(0,h.F)()],v.prototype,"beta",void 0),(0,P.c)([(0,h.F)()],v.prototype,"radius",void 0),(0,P.c)([(0,h.F)()],v.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,P.c)([(0,h.C)("target")],v.prototype,"_target",void 0),(0,P.c)([(0,h.s)("targetHost")],v.prototype,"_targetHost",void 0),(0,P.c)([(0,h.F)()],v.prototype,"inertialAlphaOffset",void 0),(0,P.c)([(0,h.F)()],v.prototype,"inertialBetaOffset",void 0),(0,P.c)([(0,h.F)()],v.prototype,"inertialRadiusOffset",void 0),(0,P.c)([(0,h.F)()],v.prototype,"lowerAlphaLimit",void 0),(0,P.c)([(0,h.F)()],v.prototype,"upperAlphaLimit",void 0),(0,P.c)([(0,h.F)()],v.prototype,"lowerBetaLimit",void 0),(0,P.c)([(0,h.F)()],v.prototype,"upperBetaLimit",void 0),(0,P.c)([(0,h.F)()],v.prototype,"lowerRadiusLimit",void 0),(0,P.c)([(0,h.F)()],v.prototype,"upperRadiusLimit",void 0),(0,P.c)([(0,h.F)()],v.prototype,"lowerTargetYLimit",void 0),(0,P.c)([(0,h.F)()],v.prototype,"inertialPanningX",void 0),(0,P.c)([(0,h.F)()],v.prototype,"inertialPanningY",void 0),(0,P.c)([(0,h.F)()],v.prototype,"pinchToPanMaxDistance",void 0),(0,P.c)([(0,h.F)()],v.prototype,"panningDistanceLimit",void 0),(0,P.c)([(0,h.C)()],v.prototype,"panningOriginTarget",void 0),(0,P.c)([(0,h.F)()],v.prototype,"panningInertia",void 0),(0,P.c)([(0,h.F)()],v.prototype,"zoomToMouseLocation",null),(0,P.c)([(0,h.F)()],v.prototype,"zoomOnFactor",void 0),(0,P.c)([(0,h.A)()],v.prototype,"targetScreenOffset",void 0),(0,P.c)([(0,h.F)()],v.prototype,"allowUpsideDown",void 0),(0,P.c)([(0,h.F)()],v.prototype,"useInputToRestoreState",void 0),(0,P.c)([(0,h.F)()],v.prototype,"restoreStateInterpolationFactor",void 0),(0,k.g)("BABYLON.ArcRotateCamera",v)},13212:(w,E,G)=>{"use strict";G.d(E,{c:()=>y,e:()=>x});var P=G(11518),h=G(11706),B=G(12110),y={};class x{constructor(w){this.attachedToElement=!1,this.attached={},this.camera=w,this.checkInputs=()=>{}}add(w){const E=w.getSimpleName();this.attached[E]?P.e.Warn("camera input of type "+E+" already exists on camera"):(this.attached[E]=w,w.camera=this.camera,w.checkInputs&&(this.checkInputs=this._addCheckInputs(w.checkInputs.bind(w))),this.attachedToElement&&w.attachControl(this.noPreventDefault))}remove(w){for(const E in this.attached){const G=this.attached[E];if(G===w)return G.MO(),G.camera=null,delete this.attached[E],void this.rebuildInputCheck()}}removeByType(w){for(const E in this.attached){const G=this.attached[E];G.getClassName()===w&&(G.MO(),G.camera=null,delete this.attached[E],this.rebuildInputCheck())}}_addCheckInputs(w){const E=this.checkInputs;return()=>{E(),w()}}attachInput(w){this.attachedToElement&&w.attachControl(this.noPreventDefault)}attachElement(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){w=!B.c.ForceAttachControlToAlwaysPreventDefault&&w,this.attachedToElement=!0,this.noPreventDefault=w;for(const E in this.attached)this.attached[E].attachControl(w)}}detachElement(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const E in this.attached)this.attached[E].MO(),w&&(this.attached[E].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const w in this.attached){const E=this.attached[w];E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(w){const E={};for(const G in this.attached){const w=this.attached[G],P=h.b.Serialize(w);E[w.getClassName()]=P}w.inputsmgr=E}parse(w){const E=w.inputsmgr;if(E){this.clear();for(const w in E){const G=y[w];if(G){const P=E[w],B=h.b.Parse((()=>new G),P,null);this.add(B)}}}else for(const G in this.attached){const E=y[this.attached[G].getClassName()];if(E){const P=h.b.Parse((()=>new E),w,null);this.remove(this.attached[G]),this.add(P)}}}}},13204:(w,E,G)=>{"use strict";G.d(E,{c:()=>q});var P=G(11668),h=G(11671),B=G(11679),y=G(12139),x=G(13212),U=G(11950),l=G(11498);class i{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(w){w=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ww(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const G=E.event;if(!G.metaKey)if(E.type===U.b.KEYDOWN){if(-1!==this.keysUp.indexOf(G.keyCode)||-1!==this.keysDown.indexOf(G.keyCode)||-1!==this.keysLeft.indexOf(G.keyCode)||-1!==this.keysRight.indexOf(G.keyCode)||-1!==this.keysUpward.indexOf(G.keyCode)||-1!==this.keysDownward.indexOf(G.keyCode)||-1!==this.keysRotateLeft.indexOf(G.keyCode)||-1!==this.keysRotateRight.indexOf(G.keyCode)||-1!==this.keysRotateUp.indexOf(G.keyCode)||-1!==this.keysRotateDown.indexOf(G.keyCode)){-1===this._keys.indexOf(G.keyCode)&&this._keys.push(G.keyCode),w||G.preventDefault()}}else if(-1!==this.keysUp.indexOf(G.keyCode)||-1!==this.keysDown.indexOf(G.keyCode)||-1!==this.keysLeft.indexOf(G.keyCode)||-1!==this.keysRight.indexOf(G.keyCode)||-1!==this.keysUpward.indexOf(G.keyCode)||-1!==this.keysDownward.indexOf(G.keyCode)||-1!==this.keysRotateLeft.indexOf(G.keyCode)||-1!==this.keysRotateRight.indexOf(G.keyCode)||-1!==this.keysRotateUp.indexOf(G.keyCode)||-1!==this.keysRotateDown.indexOf(G.keyCode)){const E=this._keys.indexOf(G.keyCode);E>=0&&this._keys.splice(E,1),w||G.preventDefault()}})))}MO(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const w=this.camera;for(let E=0;E<this._keys.length;E++){const G=this._keys[E],P=w._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(G)?w._localDirection.tx(-P,0,0):-1!==this.keysUp.indexOf(G)?w._localDirection.tx(0,0,P):-1!==this.keysRight.indexOf(G)?w._localDirection.tx(P,0,0):-1!==this.keysDown.indexOf(G)?w._localDirection.tx(0,0,-P):-1!==this.keysUpward.indexOf(G)?w._localDirection.tx(0,P,0):-1!==this.keysDownward.indexOf(G)?w._localDirection.tx(0,-P,0):-1!==this.keysRotateLeft.indexOf(G)?(w._localDirection.tx(0,0,0),w.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(G)?(w._localDirection.tx(0,0,0),w.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(G)?(w._localDirection.tx(0,0,0),w.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(G)&&(w._localDirection.tx(0,0,0),w.cameraRotation.x+=this._getLocalRotation()),w.Ww().useRightHandedSystem&&(w._localDirection.z*=-1),w.getViewMatrix().invertToRef(w._cameraTransformMatrix),B.QE.TransformNormalToRef(w._localDirection,w._cameraTransformMatrix,w._transformedDirection),w.cameraDirection.addInPlace(w._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const w=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*w}}(0,P.c)([(0,h.F)()],i.prototype,"keysUp",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysUpward",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysDown",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysDownward",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysLeft",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysRight",void 0),(0,P.c)([(0,h.F)()],i.prototype,"rotationSpeed",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysRotateLeft",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysRotateRight",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysRotateUp",void 0),(0,P.c)([(0,h.F)()],i.prototype,"keysRotateDown",void 0),x.c.FreeCameraKeyboardMoveInput=i;var O=G(11504),u=G(11947);class V{constructor(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=w,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new O.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(w){w=l.Tools.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),G=E.getInputElement();this._pointerInput||(this._pointerInput=P=>{const h=P.event,B="touch"===h.pointerType;if(!this.touchEnabled&&B)return;if(P.type!==u.e.POINTERMOVE&&-1===this.buttons.indexOf(h.button))return;const y=h.target;if(P.type===u.e.POINTERDOWN){if(B&&-1!==this._activePointerId||!B&&-1!==this._currentActiveButton)return;this._activePointerId=h.pointerId;try{null===y||void 0===y||y.setPointerCapture(h.pointerId)}catch(x){}-1===this._currentActiveButton&&(this._currentActiveButton=h.button),this._previousPosition={x:h.clientX,y:h.clientY},w||(h.preventDefault(),G&&G.focus()),E.isPointerLock&&this._onMouseMove&&this._onMouseMove(P.event)}else if(P.type===u.e.POINTERUP){if(B&&this._activePointerId!==h.pointerId||!B&&this._currentActiveButton!==h.button)return;try{null===y||void 0===y||y.releasePointerCapture(h.pointerId)}catch(x){}this._currentActiveButton=-1,this._previousPosition=null,w||h.preventDefault(),this._activePointerId=-1}else if(P.type===u.e.POINTERMOVE&&(this._activePointerId===h.pointerId||!B))if(E.isPointerLock&&this._onMouseMove)this._onMouseMove(P.event);else if(this._previousPosition){const E=this.camera._calculateHandednessMultiplier(),G=(h.clientX-this._previousPosition.x)*E,P=h.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=G/this.angularSensibility,this.camera.cameraRotation.x+=P/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:G,offsetY:P}),this._previousPosition={x:h.clientX,y:h.clientY},w||h.preventDefault()}}),this._onMouseMove=G=>{if(!E.isPointerLock)return;const P=this.camera._calculateHandednessMultiplier(),h=G.movementX*P;this.camera.cameraRotation.y+=h/this.angularSensibility;const B=G.movementY;this.camera.cameraRotation.x+=B/this.angularSensibility,this._previousPosition=null,w||G.preventDefault()},this._observer=this.camera.Ww()._inputManager._addCameraPointerObserver(this._pointerInput,u.e.POINTERDOWN|u.e.POINTERUP|u.e.POINTERMOVE),G&&(this._contextMenuBind=w=>this.onContextMenu(w),G.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(w){w.preventDefault()}MO(){if(this._observer){if(this.camera.Ww()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const w=this.camera.getEngine().getInputElement();w&&w.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,P.c)([(0,h.F)()],V.prototype,"buttons",void 0),(0,P.c)([(0,h.F)()],V.prototype,"angularSensibility",void 0),x.c.FreeCameraMouseInput=V;var a,Q=G(11955);class c{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new O.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(w){w=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==u.e.POINTERWHEEL)return;const G=E.event,P=G.deltaMode===Q.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*P*G.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*P*G.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*P*G.deltaZ/this._normalize,G.preventDefault&&(w||G.preventDefault())},this._observer=this.camera.Ww()._inputManager._addCameraPointerObserver(this._wheel,u.e.POINTERWHEEL)}MO(){this._observer&&(this.camera.Ww()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,P.c)([(0,h.F)()],c.prototype,"wheelPrecisionX",void 0),(0,P.c)([(0,h.F)()],c.prototype,"wheelPrecisionY",void 0),(0,P.c)([(0,h.F)()],c.prototype,"wheelPrecisionZ",void 0),function(w){w[w.MoveRelative=0]="MoveRelative",w[w.RotateRelative=1]="RotateRelative",w[w.MoveScene=2]="MoveScene"}(a||(a={}));class Z extends c{constructor(){super(...arguments),this._moveRelative=B.QE.Zero(),this._rotateRelative=B.QE.Zero(),this._moveScene=B.QE.Zero(),this._wheelXAction=a.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=a.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(w){null===w&&this._wheelXAction!==a.MoveRelative||(this._wheelXAction=a.MoveRelative,this._wheelXActionCoordinate=w)}get wheelXMoveRelative(){return this._wheelXAction!==a.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(w){null===w&&this._wheelYAction!==a.MoveRelative||(this._wheelYAction=a.MoveRelative,this._wheelYActionCoordinate=w)}get wheelYMoveRelative(){return this._wheelYAction!==a.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(w){null===w&&this._wheelZAction!==a.MoveRelative||(this._wheelZAction=a.MoveRelative,this._wheelZActionCoordinate=w)}get wheelZMoveRelative(){return this._wheelZAction!==a.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(w){null===w&&this._wheelXAction!==a.RotateRelative||(this._wheelXAction=a.RotateRelative,this._wheelXActionCoordinate=w)}get wheelXRotateRelative(){return this._wheelXAction!==a.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(w){null===w&&this._wheelYAction!==a.RotateRelative||(this._wheelYAction=a.RotateRelative,this._wheelYActionCoordinate=w)}get wheelYRotateRelative(){return this._wheelYAction!==a.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(w){null===w&&this._wheelZAction!==a.RotateRelative||(this._wheelZAction=a.RotateRelative,this._wheelZActionCoordinate=w)}get wheelZRotateRelative(){return this._wheelZAction!==a.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(w){null===w&&this._wheelXAction!==a.MoveScene||(this._wheelXAction=a.MoveScene,this._wheelXActionCoordinate=w)}get wheelXMoveScene(){return this._wheelXAction!==a.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(w){null===w&&this._wheelYAction!==a.MoveScene||(this._wheelYAction=a.MoveScene,this._wheelYActionCoordinate=w)}get wheelYMoveScene(){return this._wheelYAction!==a.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(w){null===w&&this._wheelZAction!==a.MoveScene||(this._wheelZAction=a.MoveScene,this._wheelZActionCoordinate=w)}get wheelZMoveScene(){return this._wheelZAction!==a.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Wx(0),this._rotateRelative.Wx(0),this._moveScene.Wx(0),this._updateCamera(),this.camera.Ww().useRightHandedSystem&&(this._moveRelative.z*=-1);const w=B.Matrix.Zero();this.camera.getViewMatrix().invertToRef(w);const E=B.QE.Zero();B.QE.TransformNormalToRef(this._moveRelative,w,E),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(E),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(w,E,G){if(0===w)return;if(null===E||null===G)return;let P=null;switch(E){case a.MoveRelative:P=this._moveRelative;break;case a.RotateRelative:P=this._rotateRelative;break;case a.MoveScene:P=this._moveScene}switch(G){case 0:P.set(w,0,0);break;case 1:P.set(0,w,0);break;case 2:P.set(0,0,w)}}}(0,P.c)([(0,h.F)()],Z.prototype,"wheelXMoveRelative",null),(0,P.c)([(0,h.F)()],Z.prototype,"wheelYMoveRelative",null),(0,P.c)([(0,h.F)()],Z.prototype,"wheelZMoveRelative",null),(0,P.c)([(0,h.F)()],Z.prototype,"wheelXRotateRelative",null),(0,P.c)([(0,h.F)()],Z.prototype,"wheelYRotateRelative",null),(0,P.c)([(0,h.F)()],Z.prototype,"wheelZRotateRelative",null),(0,P.c)([(0,h.F)()],Z.prototype,"wheelXMoveScene",null),(0,P.c)([(0,h.F)()],Z.prototype,"wheelYMoveScene",null),(0,P.c)([(0,h.F)()],Z.prototype,"wheelZMoveScene",null),x.c.FreeCameraMouseWheelInput=Z;class J{constructor(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=w,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=l.Tools.IsSafari()}attachControl(w){w=l.Tools.BackCompatCameraNoPreventDefault(arguments);let E=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=G=>{const P=G.event,h="mouse"===P.pointerType||this._isSafari&&"undefined"===typeof P.pointerType;if(this.allowMouse||!h)if(G.type===u.e.POINTERDOWN){if(w||P.preventDefault(),this._pointerPressed.push(P.pointerId),1!==this._pointerPressed.length)return;E={x:P.clientX,y:P.clientY}}else if(G.type===u.e.POINTERUP){w||P.preventDefault();const G=this._pointerPressed.indexOf(P.pointerId);if(-1===G)return;if(this._pointerPressed.splice(G,1),0!=G)return;E=null,this._offsetX=null,this._offsetY=null}else if(G.type===u.e.POINTERMOVE){if(w||P.preventDefault(),!E)return;if(0!=this._pointerPressed.indexOf(P.pointerId))return;this._offsetX=P.clientX-E.x,this._offsetY=-(P.clientY-E.y)}}),this._observer=this.camera.Ww()._inputManager._addCameraPointerObserver(this._pointerInput,u.e.POINTERDOWN|u.e.POINTERUP|u.e.POINTERMOVE),this._onLostFocus){const w=this.camera.getEngine().getInputElement();w&&w.addEventListener("blur",this._onLostFocus)}}MO(){if(this._pointerInput){if(this._observer&&(this.camera.Ww()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const w=this.camera.getEngine().getInputElement();w&&w.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const w=this.camera,E=w._calculateHandednessMultiplier();w.cameraRotation.y=E*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)w.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const E=w._computeLocalCameraSpeed(),G=new B.QE(0,0,0!==this.touchMoveSensibility?E*this._offsetY/this.touchMoveSensibility:0);B.Matrix.RotationYawPitchRollToRef(w.rotation.y,w.rotation.x,0,w._cameraRotationMatrix),w.cameraDirection.addInPlace(B.QE.TransformCoordinates(G,w._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,P.c)([(0,h.F)()],J.prototype,"touchAngularSensibility",void 0),(0,P.c)([(0,h.F)()],J.prototype,"touchMoveSensibility",void 0),x.c.FreeCameraTouchInput=J;class d extends x.e{constructor(w){super(w),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new i),this}addMouse(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new V(w),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new Z,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new J),this}clear(){super.clear(),this._mouseInput=null}}var K=G(11646),t=G(11578);class q extends y.c{get angularSensibility(){const w=this.inputs.attached.mouse;return w?w.angularSensibility:0}set angularSensibility(w){const E=this.inputs.attached.mouse;E&&(E.angularSensibility=w)}get keysUp(){const w=this.inputs.attached.keyboard;return w?w.keysUp:[]}set keysUp(w){const E=this.inputs.attached.keyboard;E&&(E.keysUp=w)}get keysUpward(){const w=this.inputs.attached.keyboard;return w?w.keysUpward:[]}set keysUpward(w){const E=this.inputs.attached.keyboard;E&&(E.keysUpward=w)}get keysDown(){const w=this.inputs.attached.keyboard;return w?w.keysDown:[]}set keysDown(w){const E=this.inputs.attached.keyboard;E&&(E.keysDown=w)}get keysDownward(){const w=this.inputs.attached.keyboard;return w?w.keysDownward:[]}set keysDownward(w){const E=this.inputs.attached.keyboard;E&&(E.keysDownward=w)}get keysLeft(){const w=this.inputs.attached.keyboard;return w?w.keysLeft:[]}set keysLeft(w){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=w)}get keysRight(){const w=this.inputs.attached.keyboard;return w?w.keysRight:[]}set keysRight(w){const E=this.inputs.attached.keyboard;E&&(E.keysRight=w)}get keysRotateLeft(){const w=this.inputs.attached.keyboard;return w?w.keysRotateLeft:[]}set keysRotateLeft(w){const E=this.inputs.attached.keyboard;E&&(E.keysRotateLeft=w)}get keysRotateRight(){const w=this.inputs.attached.keyboard;return w?w.keysRotateRight:[]}set keysRotateRight(w){const E=this.inputs.attached.keyboard;E&&(E.keysRotateRight=w)}get keysRotateUp(){const w=this.inputs.attached.keyboard;return w?w.keysRotateUp:[]}set keysRotateUp(w){const E=this.inputs.attached.keyboard;E&&(E.keysRotateUp=w)}get keysRotateDown(){const w=this.inputs.attached.keyboard;return w?w.keysRotateDown:[]}set keysRotateDown(w){const E=this.inputs.attached.keyboard;E&&(E.keysRotateDown=w)}constructor(w,E,G){var P;super(w,E,G,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),P=this,this.ellipsoid=new B.QE(.5,1,.5),this.ellipsoidOffset=new B.QE(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=B.QE.Zero(),this._diffPosition=B.QE.Zero(),this._newPosition=B.QE.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P._newPosition.B(E),P._newPosition.subtractToRef(P._oldPosition,P._diffPosition),P._diffPosition.length()>t.b.CollisionsEpsilon&&(P.position.addToRef(P._diffPosition,P._deferredPositionUpdate),P._deferOnly?P._deferredUpdated=!0:P.position.B(P._deferredPositionUpdate),P.JV&&G&&P.JV(G))},this.inputs=new d(this),this.inputs.addKeyboard().addMouse()}attachControl(w,E){E=l.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(E)}MO(){this.inputs.detachElement(),this.cameraDirection=new B.QE(0,0,0),this.cameraRotation=new B.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(w){this._collisionMask=isNaN(w)?-1:w}_collideWithWorld(w){let E;E=this.parent?B.QE.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,E.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const G=this.Ww().collisionCoordinator;this._collider||(this._collider=G.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let P=w;this.applyGravity&&(P=w.add(this.Ww().gravity)),G.getNewPosition(this._oldPosition,P,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=B.QE.Zero(),this._transformedDirection=B.QE.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(w){this._needMoveForGravity=w}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Ww().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Ya"}}(0,P.c)([(0,h.C)()],q.prototype,"ellipsoid",void 0),(0,P.c)([(0,h.C)()],q.prototype,"ellipsoidOffset",void 0),(0,P.c)([(0,h.F)()],q.prototype,"checkCollisions",void 0),(0,P.c)([(0,h.F)()],q.prototype,"applyGravity",void 0),(0,K.g)("BABYLON.FreeCamera",q)},13777:(w,E,G)=>{"use strict";G.d(E,{c:()=>B});var P=G(11771),h=G(13779);class B{constructor(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=G,this.PO=[],this._maxBlockCapacity=E||64,this._selectionContent=new P.b(1024),this._creationFunc=w}update(w,E,G){h.c._CreateBlocks(w,E,G,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}li(w){for(let E=0;E<this.ti.length;E++){this.ti[E].addEntry(w)}}Ui(w){for(let E=0;E<this.ti.length;E++){this.ti[E].removeEntry(w)}}select(w,E){this._selectionContent.reset();for(let G=0;G<this.ti.length;G++){this.ti[G].select(w,this._selectionContent,E)}return E?this._selectionContent.concat(this.PO):this._selectionContent.concatWithNoDuplicate(this.PO),this._selectionContent}intersects(w,E,G){this._selectionContent.reset();for(let P=0;P<this.ti.length;P++){this.ti[P].intersects(w,E,this._selectionContent,G)}return G?this._selectionContent.concat(this.PO):this._selectionContent.concatWithNoDuplicate(this.PO),this._selectionContent}intersectsRay(w){this._selectionContent.reset();for(let E=0;E<this.ti.length;E++){this.ti[E].intersectsRay(w,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.PO),this._selectionContent}}B.CreationFuncForMeshes=(w,E)=>{const G=w.getBoundingInfo();!w.isBlocked&&G.boundingBox.intersectsMinMax(E.UO,E.lO)&&E.entries.push(w)},B.CreationFuncForSubMeshes=(w,E)=>{w.getBoundingInfo().boundingBox.intersectsMinMax(E.UO,E.lO)&&E.entries.push(w)}},13779:(w,E,G)=>{"use strict";G.d(E,{c:()=>B});var P=G(11679),h=G(12003);class B{constructor(w,E,G,P,h,B){this.entries=[],this.iO=new Array,this._capacity=G,this._depth=P,this._maxDepth=h,this._creationFunc=B,this._minPoint=w,this._maxPoint=E,this.iO.push(w.clone()),this.iO.push(E.clone()),this.iO.push(w.clone()),this.iO[2].x=E.x,this.iO.push(w.clone()),this.iO[3].y=E.y,this.iO.push(w.clone()),this.iO[4].z=E.z,this.iO.push(E.clone()),this.iO[5].z=w.z,this.iO.push(E.clone()),this.iO[6].x=w.x,this.iO.push(E.clone()),this.iO[7].y=w.y}get Cx(){return this._capacity}get UO(){return this._minPoint}get lO(){return this._maxPoint}addEntry(w){if(this.ti)for(let E=0;E<this.ti.length;E++){this.ti[E].addEntry(w)}else this._creationFunc(w,this),this.entries.length>this.Cx&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(w){if(this.ti){for(let E=0;E<this.ti.length;E++){this.ti[E].removeEntry(w)}return}const E=this.entries.indexOf(w);E>-1&&this.entries.splice(E,1)}addEntries(w){for(let E=0;E<w.length;E++){const G=w[E];this.addEntry(G)}}select(w,E,G){if(h.c.IsInFrustum(this.iO,w)){if(this.ti){for(let P=0;P<this.ti.length;P++){this.ti[P].select(w,E,G)}return}G?E.concat(this.entries):E.concatWithNoDuplicate(this.entries)}}intersects(w,E,G,P){if(h.c.IntersectsSphere(this._minPoint,this._maxPoint,w,E)){if(this.ti){for(let h=0;h<this.ti.length;h++){this.ti[h].intersects(w,E,G,P)}return}P?G.concat(this.entries):G.concatWithNoDuplicate(this.entries)}}intersectsRay(w,E){if(w.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.ti){for(let G=0;G<this.ti.length;G++){this.ti[G].intersectsRay(w,E)}return}E.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){B._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(w,E,G,h,y,x,U,l){U.ti=new Array;const i=new P.QE((E.x-w.x)/2,(E.y-w.y)/2,(E.z-w.z)/2);for(let P=0;P<2;P++)for(let E=0;E<2;E++)for(let O=0;O<2;O++){const u=w.add(i.multiplyByFloats(P,E,O)),V=w.add(i.multiplyByFloats(P+1,E+1,O+1)),a=new B(u,V,h,y+1,x,l);a.addEntries(G),U.ti.push(a)}}}},13783:(w,E,G)=>{"use strict";G.d(E,{e:()=>i});var P=G(11908),h=G(11679),B=G(12087),y=G(12979),x=G(11944),U=G(13777),l=G(11543);P.d.prototype.createOrUpdateSelectionOctree=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,G=this._getComponent(x.c.NAME_OCTREE);G||(G=new i(this),this.Oh(G)),this.EO||(this.EO=new U.c(U.c.CreationFuncForMeshes,w,E));const P=this.getWorldExtends();return this.EO.update(P.min,P.max,this.meshes),this.EO},Object.defineProperty(P.d.prototype,"selectionOctree",{get:function(){return this.EO},enumerable:!0,configurable:!0}),B.b.prototype.createOrUpdateSubmeshesOctree=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const G=this.Ww();let P=G._getComponent(x.c.NAME_OCTREE);P||(P=new i(G),G.Oh(P)),this._submeshesOctree||(this._submeshesOctree=new U.c(U.c.CreationFuncForSubMeshes,w,E)),this.Ah(!0);const h=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(h.minimumWorld,h.maximumWorld,this.Dh),this._submeshesOctree};class i{constructor(w){this.name=x.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new y.c(h.QE.Zero(),new h.QE(1,1,1)),(w=w||l.e.LastCreatedScene)&&(this.ZE=w,this.ZE.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ZE.getActiveSubMeshCandidates=w=>this.getActiveSubMeshCandidates(w),this.ZE.getCollidingSubMeshCandidates=(w,E)=>this.getCollidingSubMeshCandidates(w,E),this.ZE.getIntersectingSubMeshCandidates=(w,E)=>this.getIntersectingSubMeshCandidates(w,E))}register(){this.ZE.onMeshRemovedObservable.add((w=>{const E=this.ZE.selectionOctree;if(void 0!==E&&null!==E){const G=E.PO.indexOf(w);-1!==G&&E.PO.splice(G,1)}})),this.ZE.onMeshImportedObservable.add((w=>{const E=this.ZE.selectionOctree;void 0!==E&&null!==E&&E.li(w)}))}getActiveMeshCandidates(){var w;return(null===(w=this.ZE.EO)||void 0===w?void 0:w.select(this.ZE.frustumPlanes))||this.ZE._getDefaultMeshCandidates()}getActiveSubMeshCandidates(w){if(w._submeshesOctree&&w.useOctreeForRenderingSelection){return w._submeshesOctree.select(this.ZE.frustumPlanes)}return this.ZE._getDefaultSubMeshCandidates(w)}getIntersectingSubMeshCandidates(w,E){if(w._submeshesOctree&&w.useOctreeForPicking){y.c.TransformToRef(E,w.getWorldMatrix(),this._tempRay);return w._submeshesOctree.intersectsRay(this._tempRay)}return this.ZE._getDefaultSubMeshCandidates(w)}getCollidingSubMeshCandidates(w,E){if(w._submeshesOctree&&w.useOctreeForCollisions){const G=E._velocityWorldLength+Math.max(E._radius.x,E._radius.y,E._radius.z);return w._submeshesOctree.intersects(E._basePointWorld,G)}return this.ZE._getDefaultSubMeshCandidates(w)}rebuild(){}dispose(){}}},12979:(w,E,G)=>{"use strict";G.d(E,{c:()=>V});var P=G(11908),h=G(12110),B=G(11681),y=G(11679),x=G(11684),U=G(11993),l=G(11936),i=G(11543),O=G(11959);const u={internalPickerForMesh:void 0};class V{constructor(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.d;this.origin=w,this.direction=E,this.length=G,this.epsilon=P}clone(){return new V(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const P=V._TmpVector3[0].tx(w.x-G,w.y-G,w.z-G),h=V._TmpVector3[1].tx(E.x+G,E.y+G,E.z+G);let B,y,x,U,l=0,i=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<P.x||this.origin.x>h.x)return!1}else if(B=1/this.direction.x,y=(P.x-this.origin.x)*B,x=(h.x-this.origin.x)*B,x===-1/0&&(x=1/0),y>x&&(U=y,y=x,x=U),l=Math.max(y,l),i=Math.min(x,i),l>i)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<P.y||this.origin.y>h.y)return!1}else if(B=1/this.direction.y,y=(P.y-this.origin.y)*B,x=(h.y-this.origin.y)*B,x===-1/0&&(x=1/0),y>x&&(U=y,y=x,x=U),l=Math.max(y,l),i=Math.min(x,i),l>i)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<P.z||this.origin.z>h.z)return!1}else if(B=1/this.direction.z,y=(P.z-this.origin.z)*B,x=(h.z-this.origin.z)*B,x===-1/0&&(x=1/0),y>x&&(U=y,y=x,x=U),l=Math.max(y,l),i=Math.min(x,i),l>i)return!1;return!0}intersectsBox(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(w.minimum,w.maximum,E)}intersectsSphere(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const G=w.center.x-this.origin.x,P=w.center.y-this.origin.y,h=w.center.z-this.origin.z,B=G*G+P*P+h*h,y=w.radius+E,x=y*y;if(B<=x)return!0;const U=G*this.direction.x+P*this.direction.y+h*this.direction.z;if(U<0)return!1;return B-U*U<=x}intersectsTriangle(w,E,G){const P=V._TmpVector3[0],h=V._TmpVector3[1],B=V._TmpVector3[2],x=V._TmpVector3[3],l=V._TmpVector3[4];E.subtractToRef(w,P),G.subtractToRef(w,h),y.QE.CrossToRef(this.direction,h,B);const i=y.QE.Dot(P,B);if(0===i)return null;const O=1/i;this.origin.subtractToRef(w,x);const u=y.QE.Dot(x,B)*O;if(u<-this.epsilon||u>1+this.epsilon)return null;y.QE.CrossToRef(x,P,l);const a=y.QE.Dot(this.direction,l)*O;if(a<-this.epsilon||u+a>1+this.epsilon)return null;const Q=y.QE.Dot(h,l)*O;return Q>this.length?null:new U.c(1-u-a,u,Q)}intersectsPlane(w){let E;const G=y.QE.Dot(w.normal,this.direction);if(Math.abs(G)<9.99999997475243e-7)return null;{const P=y.QE.Dot(w.normal,this.origin);return E=(-w.d-P)/G,E<0?E<-9.99999997475243e-7?null:0:E}}intersectsAxis(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(w){case"y":{const w=(this.origin.y-E)/this.direction.y;return w>0?null:new y.QE(this.origin.x+this.direction.x*-w,E,this.origin.z+this.direction.z*-w)}case"x":{const w=(this.origin.x-E)/this.direction.x;return w>0?null:new y.QE(E,this.origin.y+this.direction.y*-w,this.origin.z+this.direction.z*-w)}case"z":{const w=(this.origin.z-E)/this.direction.z;return w>0?null:new y.QE(this.origin.x+this.direction.x*-w,this.origin.y+this.direction.y*-w,E)}default:return null}}intersectsMesh(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const x=y.TmpVectors.Matrix[0];return w.getWorldMatrix().invertToRef(x),this._tmpRay?V.TransformToRef(this,x,this._tmpRay):this._tmpRay=V.Transform(this,x),w.intersects(this._tmpRay,E,G,P,h,B)}intersectsMeshes(w,E,G){G?G.length=0:G=[];for(let P=0;P<w.length;P++){const h=this.intersectsMesh(w[P],E);h.hit&&G.push(h)}return G.sort(this._comparePickingInfo),G}_comparePickingInfo(w,E){return w.distance<E.distance?-1:w.distance>E.distance?1:0}intersectionSegment(w,E,G){const P=this.origin,h=y.TmpVectors.QE[0],B=y.TmpVectors.QE[1],x=y.TmpVectors.QE[2],U=y.TmpVectors.QE[3];E.subtractToRef(w,h),this.direction.scaleToRef(V._Rayl,x),P.addToRef(x,B),w.subtractToRef(P,U);const l=y.QE.Dot(h,h),i=y.QE.Dot(h,x),O=y.QE.Dot(x,x),u=y.QE.Dot(h,U),a=y.QE.Dot(x,U),Q=l*O-i*i;let c,Z,J=Q,d=Q;Q<V._Smallnum?(c=0,J=1,Z=a,d=O):(c=i*a-O*u,Z=l*a-i*u,c<0?(c=0,Z=a,d=O):c>J&&(c=J,Z=a+i,d=O)),Z<0?(Z=0,-u<0?c=0:-u>l?c=J:(c=-u,J=l)):Z>d&&(Z=d,-u+i<0?c=0:-u+i>l?c=J:(c=-u+i,J=l));const K=Math.abs(c)<V._Smallnum?0:c/J,t=Math.abs(Z)<V._Smallnum?0:Z/d,q=y.TmpVectors.QE[4];x.scaleToRef(t,q);const W=y.TmpVectors.QE[5];h.scaleToRef(K,W),W.addInPlace(U);const T=y.TmpVectors.QE[6];W.subtractToRef(q,T);return t>0&&t<=this.length&&T.lengthSquared()<G*G?W.length():-1}update(w,E,G,P,h,B,x){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){V._RayDistant||(V._RayDistant=V.Zero()),V._RayDistant.unprojectRayToRef(w,E,G,P,y.Matrix.IdentityReadOnly,B,x);const U=y.TmpVectors.Matrix[0];h.invertToRef(U),V.TransformToRef(V._RayDistant,U,this)}else this.unprojectRayToRef(w,E,G,P,h,B,x);return this}static Zero(){return new V(y.QE.Zero(),y.QE.Zero())}static CreateNew(w,E,G,P,h,B,y){return V.Zero().update(w,E,G,P,h,B,y)}static CreateNewFromTo(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.Matrix.IdentityReadOnly;const P=new V(new y.QE(0,0,0),new y.QE(0,0,0));return V.CreateFromToToRef(w,E,P,G)}static CreateFromToToRef(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.Matrix.IdentityReadOnly;G.origin.B(w);const h=E.subtractToRef(w,G.direction),B=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);return G.length=B,G.direction.normalize(),V.TransformToRef(G,P,G)}static Transform(w,E){const G=new V(new y.QE(0,0,0),new y.QE(0,0,0));return V.TransformToRef(w,E,G),G}static TransformToRef(w,E,G){y.QE.TransformCoordinatesToRef(w.origin,E,G.origin),y.QE.TransformNormalToRef(w.direction,E,G.direction),G.length=w.length,G.epsilon=w.epsilon;const P=G.direction,h=P.length();if(0!==h&&1!==h){const w=1/h;P.x*=w,P.y*=w,P.z*=w,G.length*=h}return G}unprojectRayToRef(w,E,G,P,h,B,x){const U=y.TmpVectors.Matrix[0];h.multiplyToRef(B,U),U.multiplyToRef(x,U),U.invert();const l=i.e.LastCreatedEngine,O=y.TmpVectors.QE[0];O.x=w/G*2-1,O.y=-(E/P*2-1),O.z=null!==l&&void 0!==l&&l.useReverseDepthBuffer?1:null!==l&&void 0!==l&&l.isNDCHalfZRange?0:-1;const u=y.TmpVectors.QE[1].tx(O.x,O.y,1-1e-8),V=y.TmpVectors.QE[2],a=y.TmpVectors.QE[3];y.QE._UnprojectFromInvertedMatrixToRef(O,U,V),y.QE._UnprojectFromInvertedMatrixToRef(u,U,a),this.origin.B(V),a.subtractToRef(V,this.direction),this.direction.normalize()}}function a(w,E,G,P,h){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=V.Zero();return Q(w,E,G,P,y,h,B),y}function Q(w,E,G,P,h,B){let x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=w.getEngine();if(!B&&!(B=w.activeCamera))return w;const i=B.viewport,O=l.getRenderHeight(),{x:u,y:V,width:a,height:Q}=i.toGlobal(l.getRenderWidth(),O),c=1/l.getHardwareScalingLevel();return E=E*c-u,G=G*c-(O-V-Q),h.update(E,G,a,Q,P||y.Matrix.IdentityReadOnly,x?y.Matrix.IdentityReadOnly:B.getViewMatrix(),B.getProjectionMatrix(),U),w}function c(w,E,G,P,h){if(!l.d)return w;const B=w.getEngine();if(!h&&!(h=w.activeCamera))throw new Error("Active camera not set");const x=h.viewport,U=B.getRenderHeight(),{x:i,y:O,width:u,height:V}=x.toGlobal(B.getRenderWidth(),U),a=y.Matrix.Identity(),Q=1/B.getHardwareScalingLevel();return E=E*Q-i,G=G*Q-(U-O-V),P.update(E,G,u,V,a,a,h.getProjectionMatrix()),w}function Z(w,E,G,P,h,B,y,x){const U=E(P,G.enableDistantPicking),l=G.intersects(U,h,y,B,P,x);return l&&l.hit?!h&&null!=w&&l.distance>=w.distance?null:l:null}function J(w,E,G,P,h,B){let x=null;const U=!!(w.activeCameras&&w.activeCameras.length>1&&w.cameraToUseForPointers!==w.activeCamera),i=w.cameraToUseForPointers||w.activeCamera,O=u.internalPickerForMesh||Z;for(let l=0;l<w.meshes.length;l++){const u=w.meshes[l];if(G){if(!G(u,-1))continue}else if(!u.isEnabled()||!u.isVisible||!u.mU)continue;const V=U&&u.isWorldMatrixCameraDependent(),a=u.Ah(V,i);if(u.hasThinInstances&&u.Tl){const w=O(x,E,u,a,!0,!0,B);if(w){if(h)return w;const U=y.TmpVectors.Matrix[1],l=u.thinInstanceGetWorldMatrices();for(let w=0;w<l.length;w++){if(G&&!G(u,w))continue;l[w].multiplyToRef(a,U);const y=O(x,E,u,U,P,h,B,!0);if(y&&(x=y,x.thinInstanceIndex=w,P))return x}}}else{const w=O(x,E,u,a,P,h,B);if(w&&(x=w,P))return x}}return x||new l.d}function d(w,E,G,P){if(!l.d)return null;const h=[],B=!!(w.activeCameras&&w.activeCameras.length>1&&w.cameraToUseForPointers!==w.activeCamera),x=w.cameraToUseForPointers||w.activeCamera,U=u.internalPickerForMesh||Z;for(let l=0;l<w.meshes.length;l++){const i=w.meshes[l];if(G){if(!G(i,-1))continue}else if(!i.isEnabled()||!i.isVisible||!i.mU)continue;const O=B&&i.isWorldMatrixCameraDependent(),u=i.Ah(O,x);if(i.hasThinInstances&&i.Tl){if(U(null,E,i,u,!0,!0,P)){const w=y.TmpVectors.Matrix[1],B=i.thinInstanceGetWorldMatrices();for(let y=0;y<B.length;y++){if(G&&!G(i,y))continue;B[y].multiplyToRef(u,w);const x=U(null,E,i,w,!1,!1,P,!0);x&&(x.thinInstanceIndex=y,h.push(x))}}}else{const w=U(null,E,i,u,!1,!1,P);w&&h.push(w)}}return h}function K(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,P=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;P||(P=w.getWorldMatrix()),E.length=G,h?E.origin.B(h):E.origin.B(w.position);const B=y.TmpVectors.QE[2];B.set(0,0,w._scene.useRightHandedSystem?-1:1);const x=y.TmpVectors.QE[3];return y.QE.TransformNormalToRef(B,P,x),y.QE.NormalizeToRef(x,E.direction),E}var t,q;V._TmpVector3=(0,x.d)(6,y.QE.Zero),V._RayDistant=V.Zero(),V._Smallnum=1e-8,V._Rayl=1e9,t=P.d,(q=h.c)&&(q.prototype.getForwardRay=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,E=arguments.length>1?arguments[1]:void 0,G=arguments.length>2?arguments[2]:void 0;return K(this,new V(y.QE.Zero(),y.QE.Zero(),w),w,E,G)},q.prototype.getForwardRayToRef=function(w){return K(this,w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),t&&(O.b._IsPickingAvailable=!0,t.prototype.createPickingRay=function(w,E,G,P){return a(this,w,E,G,P,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),P.d.prototype.createPickingRayToRef=function(w,E,G,P,h){return Q(this,w,E,G,P,h,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},P.d.prototype.createPickingRayInCameraSpace=function(w,E,G){return function(w,E,G,P){const h=V.Zero();return c(w,E,G,h,P),h}(this,w,E,G)},P.d.prototype.createPickingRayInCameraSpaceToRef=function(w,E,G,P){return c(this,w,E,G,P)},P.d.prototype.pickWithBoundingInfo=function(w,E,G,P,h){return function(w,E,G,P,h,B){if(!l.d)return null;const x=J(w,(P=>(w._tempPickingRay||(w._tempPickingRay=V.Zero()),Q(w,E,G,P,w._tempPickingRay,B||null),w._tempPickingRay)),P,h,!0);return x&&(x.ray=a(w,E,G,y.Matrix.Identity(),B||null)),x}(this,w,E,G,P,h)},P.d.prototype.uG=function(w,E,G,P,h,B){return function(w,E,G,P,h,B,x){const U=J(w,((P,h)=>(w._tempPickingRay||(w._tempPickingRay=V.Zero()),Q(w,E,G,P,w._tempPickingRay,B||null,!1,h),w._tempPickingRay)),P,h,!1,x);return U&&(U.ray=a(w,E,G,y.Matrix.Identity(),B||null)),U}(this,w,E,G,P,h,B)},P.d.prototype.pickWithRay=function(w,E,G,P){return function(w,E,G,P,h){const B=J(w,(G=>(w._pickWithRayInverseMatrix||(w._pickWithRayInverseMatrix=y.Matrix.Identity()),G.invertToRef(w._pickWithRayInverseMatrix),w._cachedRayForTransform||(w._cachedRayForTransform=V.Zero()),V.TransformToRef(E,w._pickWithRayInverseMatrix,w._cachedRayForTransform),w._cachedRayForTransform)),G,P,!1,h);return B&&(B.ray=E),B}(this,w,E,G,P)},P.d.prototype.multiPick=function(w,E,G,P,h){return function(w,E,G,P,h,B){return d(w,(P=>a(w,E,G,P,h||null)),P,B)}(this,w,E,G,P,h)},P.d.prototype.multiPickWithRay=function(w,E,G){return function(w,E,G,P){return d(w,(G=>(w._pickWithRayInverseMatrix||(w._pickWithRayInverseMatrix=y.Matrix.Identity()),G.invertToRef(w._pickWithRayInverseMatrix),w._cachedRayForTransform||(w._cachedRayForTransform=V.Zero()),V.TransformToRef(E,w._pickWithRayInverseMatrix,w._cachedRayForTransform),w._cachedRayForTransform)),G,P)}(this,w,E,G)}},13255:(w,E,G)=>{"use strict";var P=G(11626),h=G(11518),B=G(11547),y=G(11650),x=G(11578),U=G(11635);x.b.prototype._partialLoadFile=function(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(w,(w=>{G[E]=w,G._internalCount++,6===G._internalCount&&P(G)}),void 0,void 0,!0,((w,E)=>{h&&w&&h(w.status+" "+w.statusText,E)}))},x.b.prototype._cascadeLoadFiles=function(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=[];h._internalCount=0;for(let B=0;B<6;B++)this._partialLoadFile(G[B],B,h,E,P)},x.b.prototype._cascadeLoadImgs=function(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5?arguments[5]:void 0;const y=[];y._internalCount=0;for(let x=0;x<6;x++)this._partialLoadImg(P[x],x,y,w,E,G,h,B)},x.b.prototype._partialLoadImg=function(w,E,G,P,h,x){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0;const i=(0,y.e)();(0,B.p)(w,(w=>{G[E]=w,G._internalCount++,P&&P.removePendingData(i),6===G._internalCount&&x&&x(h,G)}),((w,E)=>{P&&P.removePendingData(i),U&&U(w,E)}),P?P.offlineProvider:null,l),P&&P.addPendingData(i)},x.b.prototype.createCubeTextureBase=function(w,E,G,B){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,Z=arguments.length>14&&void 0!==arguments[14]&&arguments[14],J=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const d=a||new P.e(this,7);d.isCube=!0,d.url=w,d.generateMipMaps=!B,d._lodGenerationScale=u,d._lodGenerationOffset=V,d._useSRGBBuffer=!!Z&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!B),d!==a&&(d.label=w.substring(0,60)),this._doNotHandleContextLost||(d._extension=i,d._files=G,d._buffer=J);const K=w;this._transformTextureUrl&&!a&&(w=this._transformTextureUrl(w));const t=i??function(w){const E=w.split("?")[0],G=E.lastIndexOf(".");return G>-1?E.substring(G).toLowerCase():""}(w),q=(0,U.d)(t),W=(w,E)=>{d.dispose(),x?x(w,E):w&&h.e.Warn(w)},T=(P,x)=>{w===K?P&&W(P.status+" "+P.statusText,x):(h.e.Warn(`Failed to load ${w}, falling back to the ${K}`),this.createCubeTextureBase(K,E,G,!!B,y,W,l,i,O,u,V,d,Q,c,Z,J))};if(q)q.then((P=>{const h=w=>{Q&&Q(d,w),P.loadCubeData(w,d,O,y,((w,E)=>{W(w,E)}))};J?h(J):G&&6===G.length?P.supportCascades?this._cascadeLoadFiles(E,(w=>h(w.map((w=>new Uint8Array(w))))),G,W):W("Textures type does not support cascades."):this._loadFile(w,(w=>h(new Uint8Array(w))),void 0,void 0,!0,T)}));else{if(!G||0===G.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(E,d,((w,E)=>{c&&c(w,E)}),G,W)}return this._internalTexturesCache.push(d),d}},13789:(w,E,G)=>{"use strict";G(11518);var P=G(11797);G(11626),G(11754),G(11618),G(11857),G(11810);P.b},13274:(w,E,G)=>{"use strict";G.d(E,{d:()=>h});var P=G(11646);class h{constructor(w){this.value=this._toInt(w)}_toInt(w){return 0|w}add(w){return new h(this.value+w.value)}cE(w){return new h(this.value-w.value)}multiply(w){return new h(Math.imul(this.value,w.value))}divide(w){return new h(this.value/w.value)}getClassName(){return h.ClassName}equals(w){return this.value===w.value}static FromValue(w){return new h(w)}toString(){return this.value.toString()}}h.ClassName="FlowGraphInteger",(0,P.g)("FlowGraphInteger",h)},13284:(w,E,G)=>{"use strict";G.d(E,{c:()=>h,e:()=>B});var P=G(11679);class h{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Wh=w}get m(){return this.Wh}transformVector(w){return this.transformVectorToRef(w,new P.Vector2)}transformVectorToRef(w,E){return E.x=w.x*this.Wh[0]+w.y*this.Wh[1],E.y=w.x*this.Wh[2]+w.y*this.Wh[3],E}Lh(){return this.toArray()}toArray(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let E=0;E<4;E++)w[E]=this.Wh[E];return w}VG(w){for(let E=0;E<4;E++)this.Wh[E]=w[E];return this}multiplyToRef(w,E){const G=w.Wh,P=this.Wh,h=E.Wh;return h[0]=G[0]*P[0]+G[1]*P[2],h[1]=G[0]*P[1]+G[1]*P[3],h[2]=G[2]*P[0]+G[3]*P[2],h[3]=G[2]*P[1]+G[3]*P[3],E}multiply(w){return this.multiplyToRef(w,new h)}divideToRef(w,E){const G=this.Wh,P=w.Wh,h=E.Wh;return h[0]=G[0]/P[0],h[1]=G[1]/P[1],h[2]=G[2]/P[2],h[3]=G[3]/P[3],E}divide(w){return this.divideToRef(w,new h)}addToRef(w,E){const G=this.Wh,P=w.m,h=E.m;return h[0]=G[0]+P[0],h[1]=G[1]+P[1],h[2]=G[2]+P[2],h[3]=G[3]+P[3],E}add(w){return this.addToRef(w,new h)}subtractToRef(w,E){const G=this.Wh,P=w.m,h=E.m;return h[0]=G[0]-P[0],h[1]=G[1]-P[1],h[2]=G[2]-P[2],h[3]=G[3]-P[3],E}cE(w){return this.subtractToRef(w,new h)}transpose(){const w=this.Wh;return new h([w[0],w[2],w[1],w[3]])}determinant(){const w=this.Wh;return w[0]*w[3]-w[1]*w[2]}inverse(){const w=this.determinant();if(0===w)throw new Error("Matrix is not invertible");const E=this.Wh,G=1/w;return new h([E[3]*G,-E[1]*G,-E[2]*G,E[0]*G])}equals(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const G=this.Wh,P=w.m;return 0===E?G[0]===P[0]&&G[1]===P[1]&&G[2]===P[2]&&G[3]===P[3]:Math.abs(G[0]-P[0])<E&&Math.abs(G[1]-P[1])<E&&Math.abs(G[2]-P[2])<E&&Math.abs(G[3]-P[3])<E}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Wh.join(", ")})`}}class B{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Wh=w}get m(){return this.Wh}transformVector(w){return this.transformVectorToRef(w,new P.QE)}transformVectorToRef(w,E){const G=this.Wh;return E.x=w.x*G[0]+w.y*G[1]+w.z*G[2],E.y=w.x*G[3]+w.y*G[4]+w.z*G[5],E.z=w.x*G[6]+w.y*G[7]+w.z*G[8],E}multiplyToRef(w,E){const G=w.Wh,P=this.Wh,h=E.m;return h[0]=G[0]*P[0]+G[1]*P[3]+G[2]*P[6],h[1]=G[0]*P[1]+G[1]*P[4]+G[2]*P[7],h[2]=G[0]*P[2]+G[1]*P[5]+G[2]*P[8],h[3]=G[3]*P[0]+G[4]*P[3]+G[5]*P[6],h[4]=G[3]*P[1]+G[4]*P[4]+G[5]*P[7],h[5]=G[3]*P[2]+G[4]*P[5]+G[5]*P[8],h[6]=G[6]*P[0]+G[7]*P[3]+G[8]*P[6],h[7]=G[6]*P[1]+G[7]*P[4]+G[8]*P[7],h[8]=G[6]*P[2]+G[7]*P[5]+G[8]*P[8],E}multiply(w){return this.multiplyToRef(w,new B)}divideToRef(w,E){const G=this.Wh,P=w.m,h=E.m;return h[0]=G[0]/P[0],h[1]=G[1]/P[1],h[2]=G[2]/P[2],h[3]=G[3]/P[3],h[4]=G[4]/P[4],h[5]=G[5]/P[5],h[6]=G[6]/P[6],h[7]=G[7]/P[7],h[8]=G[8]/P[8],E}divide(w){return this.divideToRef(w,new B)}addToRef(w,E){const G=this.Wh,P=w.m,h=E.m;return h[0]=G[0]+P[0],h[1]=G[1]+P[1],h[2]=G[2]+P[2],h[3]=G[3]+P[3],h[4]=G[4]+P[4],h[5]=G[5]+P[5],h[6]=G[6]+P[6],h[7]=G[7]+P[7],h[8]=G[8]+P[8],E}add(w){return this.addToRef(w,new B)}subtractToRef(w,E){const G=this.Wh,P=w.m,h=E.m;return h[0]=G[0]-P[0],h[1]=G[1]-P[1],h[2]=G[2]-P[2],h[3]=G[3]-P[3],h[4]=G[4]-P[4],h[5]=G[5]-P[5],h[6]=G[6]-P[6],h[7]=G[7]-P[7],h[8]=G[8]-P[8],E}cE(w){return this.subtractToRef(w,new B)}toArray(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let E=0;E<9;E++)w[E]=this.Wh[E];return w}Lh(){return this.toArray()}VG(w){for(let E=0;E<9;E++)this.Wh[E]=w[E];return this}transpose(){const w=this.Wh;return new B([w[0],w[3],w[6],w[1],w[4],w[7],w[2],w[5],w[8]])}determinant(){const w=this.Wh;return w[0]*(w[4]*w[8]-w[5]*w[7])-w[1]*(w[3]*w[8]-w[5]*w[6])+w[2]*(w[3]*w[7]-w[4]*w[6])}inverse(){const w=this.determinant();if(0===w)throw new Error("Matrix is not invertible");const E=this.Wh,G=1/w;return new B([(E[4]*E[8]-E[5]*E[7])*G,(E[2]*E[7]-E[1]*E[8])*G,(E[1]*E[5]-E[2]*E[4])*G,(E[5]*E[6]-E[3]*E[8])*G,(E[0]*E[8]-E[2]*E[6])*G,(E[2]*E[3]-E[0]*E[5])*G,(E[3]*E[7]-E[4]*E[6])*G,(E[1]*E[6]-E[0]*E[7])*G,(E[0]*E[4]-E[1]*E[3])*G])}equals(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const G=this.Wh,P=w.m;return 0===E?G[0]===P[0]&&G[1]===P[1]&&G[2]===P[2]&&G[3]===P[3]&&G[4]===P[4]&&G[5]===P[5]&&G[6]===P[6]&&G[7]===P[7]&&G[8]===P[8]:Math.abs(G[0]-P[0])<E&&Math.abs(G[1]-P[1])<E&&Math.abs(G[2]-P[2])<E&&Math.abs(G[3]-P[3])<E&&Math.abs(G[4]-P[4])<E&&Math.abs(G[5]-P[5])<E&&Math.abs(G[6]-P[6])<E&&Math.abs(G[7]-P[7])<E&&Math.abs(G[8]-P[8])<E}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Wh.join(", ")})`}}},13292:(w,E,G)=>{"use strict";var P;function h(w,E,G,P){switch(E){case"Animation":return P?w.animations.find((w=>w.uniqueId===G))??null:w.animations[G]??null;case"AnimationGroup":return P?w.animationGroups.find((w=>w.uniqueId===G))??null:w.animationGroups[G]??null;case"Mesh":return P?w.meshes.find((w=>w.uniqueId===G))??null:w.meshes[G]??null;case"Material":return P?w.materials.find((w=>w.uniqueId===G))??null:w.materials[G]??null;case"Zi":return P?w.cameras.find((w=>w.uniqueId===G))??null:w.cameras[G]??null;case"Light":return P?w.lights.find((w=>w.uniqueId===G))??null:w.lights[G]??null;default:return null}}G.d(E,{d:()=>h}),function(w){w.Animation="Animation",w.AnimationGroup="AnimationGroup",w.Mesh="Mesh",w.Material="Material",w.Zi="Zi",w.Light="Light"}(P||(P={}))},13321:(w,E,G)=>{"use strict";G.d(E,{d:()=>h});var P=G(13330);class h extends P.d{constructor(w,E){if(super(w),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),E)for(const G of E)this._eventsSignalOutputs[G]=this._registerSignalOutput(G+"Event")}_executeOnTick(w){}_startPendingTasks(w){w._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(w),this._resetAfterCanceled(w)),this._preparePendingTasks(w),w._addPendingBlock(this),this.out._activateSignal(w),w._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(w){w._deleteExecutionVariable(this,"_initialized"),w._removePendingBlock(this)}}},13298:(w,E,G)=>{"use strict";G.d(E,{d:()=>l});var P=G(11650),h=G(11646),B=G(13304),y=G(11504),x=G(13271);class U extends B.c{constructor(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:P.defaultValue,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(w,E,G),this.richType=P,this._defaultValue=h,this._optional=B,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new y.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(w){this._isDisabled!==w&&(this._isDisabled=w,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(w,E){E._getConnectionValue(this)!==w&&(E._setConnectionValue(this,w),this.onValueChangedObservable.notifyObservers(w))}resetToDefaultValue(w){w._setConnectionValue(this,this._defaultValue)}connectTo(w){this._isDisabled||super.connectTo(w)}_getValueOrDefault(w){const E=w._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(E):E}getValue(w){if(1===this.connectionType){w._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(w);const E=this._getValueOrDefault(w);return this._lastValue=E,this.richType.typeTransformer?this.richType.typeTransformer(E):E}const E=this.isConnected()?this._connectedPoint[0].getValue(w):this._getValueOrDefault(w);return this._lastValue=E,this.richType.typeTransformer?this.richType.typeTransformer(E):E}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(w),w.richType={},this.richType.serialize(w.richType),w.optional=this._optional,(0,x.g)("defaultValue",this._defaultValue,w)}}(0,h.g)("FlowGraphDataConnection",U);class l{constructor(w){var E;this.config=w,this.uniqueId=(0,P.e)(),this.name=(null===(E=this.config)||void 0===E?void 0:E.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(w){}registerDataInput(w,E,G){const P=new U(w,0,this,E,G);return this.dataInputs.push(P),P}registerDataOutput(w,E,G){const P=new U(w,1,this,E,G);return this.dataOutputs.push(P),P}getDataInput(w){return this.dataInputs.find((E=>E.name===w))}getDataOutput(w){return this.dataOutputs.find((E=>E.name===w))}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.g;if(w.uniqueId=this.uniqueId,w.config={},this.config){const G=this.config,P=Object.keys(G);for(const h of P)E(h,G[h],w.config)}w.dataInputs=[],w.dataOutputs=[],w.className=this.getClassName();for(const G of this.dataInputs){const E={};G.serialize(E),w.dataInputs.push(E)}for(const G of this.dataOutputs){const E={};G.serialize(E),w.dataOutputs.push(E)}}deserialize(w){}_log(w,E,G){var P;null===(P=w.logger)||void 0===P||P.addLogItem({action:E,aG:G,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13304:(w,E,G)=>{"use strict";G.d(E,{c:()=>B});var P,h=G(11650);!function(w){w[w.Input=0]="Input",w[w.Output=1]="Output"}(P||(P={}));class B{constructor(w,E,G){this._ownerBlock=G,this._connectedPoint=[],this.uniqueId=(0,h.e)(),this.connectedPointIds=[],this.name=w,this._connectionType=E}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(w){if(this._connectionType===w._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||w._isSingularConnection()&&w._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(w),w._connectedPoint.push(this)}disconnectFrom(w){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const G=this._connectedPoint.indexOf(w),P=w._connectedPoint.indexOf(this);-1!==G&&-1!==P&&(E&&this._connectedPoint.splice(G,1),w._connectedPoint.splice(P,1))}disconnectFromAll(){for(const w of this._connectedPoint)this.disconnectFrom(w,!1);this._connectedPoint.length=0}dispose(){for(const w of this._connectedPoint)this.disconnectFrom(w)}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w.uniqueId=this.uniqueId,w.name=this.name,w._connectionType=this._connectionType,w.connectedPointIds=[],w.className=this.getClassName();for(const E of this._connectedPoint)w.connectedPointIds.push(E.uniqueId)}getClassName(){return"FGConnection"}deserialize(w){this.uniqueId=w.uniqueId,this.name=w.name,this._connectionType=w._connectionType,this.connectedPointIds=w.connectedPointIds}}},13269:(w,E,G)=>{"use strict";G.d(E,{b:()=>d});var P,h=G(11504),B=G(11668),y=G(11671),x=G(11650),U=G(13271),l=G(13292),i=G(11518);!function(w){w.ExecuteBlock="ExecuteBlock",w.ExecuteEvent="ExecuteEvent",w.TriggerConnection="TriggerConnection",w.ContextVariableSet="ContextVariableSet",w.GlobalVariableSet="GlobalVariableSet",w.GlobalVariableDelete="GlobalVariableDelete",w.GlobalVariableGet="GlobalVariableGet",w.AddConnection="AddConnection",w.GetConnectionValue="GetConnectionValue",w.SetConnectionValue="SetConnectionValue",w.ActivateSignal="ActivateSignal",w.ContextVariableGet="ContextVariableGet"}(P||(P={}));class O{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(w){if(w.time||(w.time=Date.now()),this.log.push(w),this.logToConsole){var E;const G=null===(E=w.aG)||void 0===E?void 0:E.value;"object"===typeof G&&G.getClassName?i.e.Log(`[FGLog] ${w.className}:${w.uniqueId.split("-")[0]} ${w.action} - ${JSON.stringify(G.getClassName())}: ${G.toString()}`):i.e.Log(`[FGLog] ${w.className}:${w.uniqueId.split("-")[0]} ${w.action} - ${JSON.stringify(w.aG)}`)}}getItemsOfType(w){return this.log.filter((E=>E.action===w))}}class u{get enableLogging(){return this._enableLogging}set enableLogging(w){this._enableLogging!==w&&(this._enableLogging=w,this._enableLogging?(this.logger=new O,this.logger.logToConsole=!0):this.logger=null)}constructor(w){this.uniqueId=(0,x.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new h.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=w,this.assetsContext=w.assetsContext??w.ZE}hasVariable(w){return w in this._userVariables}setVariable(w,E){var G;this._userVariables[w]=E,null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",aG:{name:w,value:E}})}getAsset(w,E){return(0,l.d)(this.assetsContext,w,E)}getVariable(w){var E;return null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",aG:{name:w,value:this._userVariables[w]}}),this._userVariables[w]}get userVariables(){return this._userVariables}Ww(){return this._configuration.ZE}_getUniqueIdPrefixedName(w,E){return`${w.uniqueId}_${E}`}_getGlobalContextVariable(w,E){var G;return null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",aG:{name:w,defaultValue:E,possibleValue:this._globalContextVariables[w]}}),this._hasGlobalContextVariable(w)?this._globalContextVariables[w]:E}_setGlobalContextVariable(w,E){var G;null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",aG:{name:w,value:E}}),this._globalContextVariables[w]=E}_deleteGlobalContextVariable(w){var E;null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",aG:{name:w}}),delete this._globalContextVariables[w]}_hasGlobalContextVariable(w){return w in this._globalContextVariables}_setExecutionVariable(w,E,G){this._executionVariables[this._getUniqueIdPrefixedName(w,E)]=G}_getExecutionVariable(w,E,G){return this._hasExecutionVariable(w,E)?this._executionVariables[this._getUniqueIdPrefixedName(w,E)]:G}_deleteExecutionVariable(w,E){delete this._executionVariables[this._getUniqueIdPrefixedName(w,E)]}_hasExecutionVariable(w,E){return this._getUniqueIdPrefixedName(w,E)in this._executionVariables}_hasConnectionValue(w){return w.uniqueId in this._connectionValues}_setConnectionValue(w,E){var G;this._connectionValues[w.uniqueId]=E,null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",aG:{connectionPointId:w.uniqueId,value:E}})}_setConnectionValueByKey(w,E){this._connectionValues[w]=E}_getConnectionValue(w){var E;return null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",aG:{connectionPointId:w.uniqueId,value:this._connectionValues[w.uniqueId]}}),this._connectionValues[w.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(w){this._pendingBlocks.includes(w)||(this._pendingBlocks.push(w),this._pendingBlocks.sort(((w,E)=>w.priority-E.priority)))}_removePendingBlock(w){const E=this._pendingBlocks.indexOf(w);-1!==E&&this._pendingBlocks.splice(E,1)}_clearPendingBlocks(){for(const w of this._pendingBlocks)w._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(w){var E;this.onNodeExecutedObservable.notifyObservers(w),null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:w.getClassName(),uniqueId:w.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(w){this._setGlobalContextVariable("timeSinceStart",w.timeSinceStart),this._setGlobalContextVariable("deltaTime",w.deltaTime);for(const G of this._pendingBlocks){var E;null===(E=G._executeOnTick)||void 0===E||E.call(G,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.g;w.uniqueId=this.uniqueId,w._userVariables={};for(const P in this._userVariables)E(P,this._userVariables[P],w._userVariables);w._connectionValues={};for(const P in this._connectionValues)E(P,this._connectionValues[P],w._connectionValues);var G;this.assetsContext!==this.Ww()&&(w._assetsContext={meshes:this.assetsContext.meshes.map((w=>w.id)),materials:this.assetsContext.materials.map((w=>w.id)),textures:this.assetsContext.textures.map((w=>w.name)),animations:this.assetsContext.animations.map((w=>w.name)),lights:this.assetsContext.lights.map((w=>w.id)),cameras:this.assetsContext.cameras.map((w=>w.id)),Mu:null===(G=this.assetsContext.Mu)||void 0===G?void 0:G.map((w=>w.name)),skeletons:this.assetsContext.skeletons.map((w=>w.id)),Pu:this.assetsContext.Pu.map((w=>w.name)),geometries:this.assetsContext.geometries.map((w=>w.id)),multiMaterials:this.assetsContext.multiMaterials.map((w=>w.id)),transformNodes:this.assetsContext.transformNodes.map((w=>w.id))})}getClassName(){return"FlowGraphContext"}}(0,B.c)([(0,y.F)()],u.prototype,"uniqueId",void 0);var V=G(13296),a=G(11947);class Q{constructor(w){this.onEventTriggeredObservable=new h.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=w,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.qh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const w=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",aG:{timeSinceStart:this._startingTime,deltaTime:w}}),this._startingTime+=w})),this._meshPickedObserver=this._scene.onPointerObservable.add((w=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",aG:w})}),a.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((w=>{const E=w.pointerId,G=w.mesh,P=this._pointerUnderMeshState[E];!P&&G?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",aG:{pointerId:E,mesh:G}}):P&&!G?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",aG:{pointerId:E,mesh:P}}):P&&G&&P!==G&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",aG:{pointerId:E,mesh:P,over:G}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",aG:{pointerId:E,mesh:G,out:P}})),this._pointerUnderMeshState[E]=G}),a.e.POINTERMOVE)}dispose(){var w,E,G,P,h;null===(w=this._sceneDisposeObserver)||void 0===w||w.remove(),null===(E=this._sceneReadyObserver)||void 0===E||E.remove(),null===(G=this._sceneOnBeforeRenderObserver)||void 0===G||G.remove(),null===(P=this._meshPickedObserver)||void 0===P||P.remove(),null===(h=this._meshUnderPointerObserver)||void 0===h||h.remove(),this.onEventTriggeredObservable.clear()}}var c,Z=G(13306);!function(w){w[w.Stopped=0]="Stopped",w[w.Started=1]="Started"}(c||(c={}));class J{get state(){return this._state}set state(w){this._state=w,this.onStateChangedObservable.notifyObservers(w)}constructor(w){this.onStateChangedObservable=new h.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=w.ZE,this._sceneEventCoordinator=new Q(this._scene),this._coordinator=w.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((w=>{for(const E of this._executionContexts){const G=this._getContextualOrder(w.type,E);for(const P of G)if(!P._executeEvent(E,w.aG))break}switch(w.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const E of this._executionContexts)E._notifyOnTick(w.aG);break;case"SceneDispose":this.dispose()}}))}createContext(){const w=new u({ZE:this._scene,coordinator:this._coordinator});return this._executionContexts.push(w),w}getContext(w){return this._executionContexts[w]}addEventBlock(w){if("PointerOver"!==w.type&&"PointerOut"!==w.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==w.type&&this._eventBlocks[w.type].push(w),1===this.state)for(const E of this._executionContexts)w._startPendingTasks(E);else this.onStateChangedObservable.addOnce((E=>{if(1===E)for(const G of this._executionContexts)w._startPendingTasks(G)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((w=>{1===w&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const w of this._executionContexts)for(const E in this._eventBlocks){const G=this._getContextualOrder(E,w);for(const E of G)E._startPendingTasks(w)}}_getContextualOrder(w,E){const G=this._eventBlocks[w].sort(((w,E)=>E.initPriority-w.initPriority));if("MeshPick"===w){const w=[];for(const P of G){const h=P.asset.getValue(E);let B=0;for(;B<G.length;B++){const w=G[B].asset.getValue(E);if(h&&w&&(0,Z.m)(h,w))break}w.splice(B,0,P)}return w}return G}dispose(){var w;if(0!==this.state){this.state=0;for(const w of this._executionContexts)w._clearPendingBlocks();this._executionContexts.length=0;for(const w in this._eventBlocks)this._eventBlocks[w].length=0;null===(w=this._eventObserver)||void 0===w||w.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(w){const E=[],G=new Set;for(const P in this._eventBlocks)for(const w of this._eventBlocks[P])E.push(w),G.add(w.uniqueId);for(;E.length>0;){const P=E.pop();w(P);for(const w of P.dataInputs)for(const P of w._connectedPoint)G.has(P._ownerBlock.uniqueId)||(E.push(P._ownerBlock),G.add(P._ownerBlock.uniqueId));if(P instanceof V.e)for(const w of P.signalOutputs)for(const P of w._connectedPoint)G.has(P._ownerBlock.uniqueId)||(E.push(P._ownerBlock),G.add(P._ownerBlock.uniqueId))}}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1?arguments[1]:void 0;w.allBlocks=[],this.visitAllBlocks((E=>{const G={};E.serialize(G),w.allBlocks.push(G)})),w.executionContexts=[];for(const G of this._executionContexts){const P={};G.serialize(P,E),w.executionContexts.push(P)}}}class d{constructor(w){this.config=w,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.ZE.qh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.ZE.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const w=this._executeOnNextFrame.slice(0);if(w.length)for(const E of w){this.notifyCustomEvent(E.id,E.data,!1);const w=this._executeOnNextFrame.findIndex((w=>w.uniqueId===E.uniqueId));-1!==w&&this._executeOnNextFrame.splice(w,1)}}));(d.SceneCoordinators.get(this.config.ZE)??[]).push(this)}createGraph(){const w=new J({ZE:this.config.ZE,coordinator:this});return this._flowGraphs.push(w),w}removeGraph(w){const E=this._flowGraphs.indexOf(w);-1!==E&&(w.dispose(),this._flowGraphs.splice(E,1))}start(){for(const w of this._flowGraphs)w.start()}dispose(){var w,E;for(const h of this._flowGraphs)h.dispose();this._flowGraphs.length=0,null===(w=this._disposeObserver)||void 0===w||w.remove(),null===(E=this._onBeforeRenderObserver)||void 0===E||E.remove();const G=d.SceneCoordinators.get(this.config.ZE)??[],P=G.indexOf(this);-1!==P&&G.splice(P,1)}serialize(w,E){w._flowGraphs=[];for(const G of this._flowGraphs){const P={};G.serialize(P,E),w._flowGraphs.push(P)}w.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(w){let E=this._customEventsMap.get(w);return E||(E=new h.d,this._customEventsMap.set(w,E)),E}notifyCustomEvent(w,E){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:w,data:E,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(w)){const E=this._eventExecutionCounter.get(w);if(this._eventExecutionCounter.set(w,E+1),E>=d.MaxEventTypeExecutionPerFrame)return void(E===d.MaxEventTypeExecutionPerFrame&&i.e.Warn(`FlowGraphCoordinator: Too many executions of event "${w}".`))}else this._eventExecutionCounter.set(w,1);const G=this._customEventsMap.get(w);G&&G.notifyObservers(E)}}d.MaxEventsPerType=30,d.MaxEventTypeExecutionPerFrame=30,d.SceneCoordinators=new Map},13315:(w,E,G)=>{"use strict";G.d(E,{c:()=>h});var P=G(13321);class h extends P.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(w){w._notifyExecuteNode(this),this.done._activateSignal(w)}}},13296:(w,E,G)=>{"use strict";G.d(E,{e:()=>x});var P=G(13298),h=G(13304),B=G(11646);class y extends h.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(w){super.connectTo(w),this._connectedPoint.sort(((w,E)=>E.priority-w.priority))}_activateSignal(w){var E;if(null===(E=w.logger)||void 0===E||E.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,aG:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)w._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(w,this),w._increaseExecutionId();else for(const G of this._connectedPoint)G._activateSignal(w)}}(0,B.g)("FlowGraphSignalConnection",y);class x extends P.d{constructor(w){super(w),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(w){const E=new y(w,0,this);return this.signalInputs.push(E),E}_registerSignalOutput(w){const E=new y(w,1,this);return this.signalOutputs.push(E),E}_unregisterSignalInput(w){const E=this.signalInputs.findIndex((E=>E.name===w));-1!==E&&(this.signalInputs[E].dispose(),this.signalInputs.splice(E,1))}_unregisterSignalOutput(w){const E=this.signalOutputs.findIndex((E=>E.name===w));-1!==E&&(this.signalOutputs[E].dispose(),this.signalOutputs.splice(E,1))}_reportError(w,E){this.error.aG="string"===typeof E?new Error(E):E,this.error._activateSignal(w)}getSignalInput(w){return this.signalInputs.find((E=>E.name===w))}getSignalOutput(w){return this.signalOutputs.find((E=>E.name===w))}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(w),w.signalInputs=[],w.signalOutputs=[];for(const E of this.signalInputs){const G={};E.serialize(G),w.signalInputs.push(G)}for(const E of this.signalOutputs){const G={};E.serialize(G),w.signalOutputs.push(G)}}deserialize(w){for(let E=0;E<w.signalInputs.length;E++){const G=this.getSignalInput(w.signalInputs[E].name);if(!G)throw new Error("Could not find signal input with name "+w.signalInputs[E].name+" in block "+w.className);G.deserialize(w.signalInputs[E])}for(let E=0;E<w.signalOutputs.length;E++){const G=this.getSignalOutput(w.signalOutputs[E].name);if(!G)throw new Error("Could not find signal output with name "+w.signalOutputs[E].name+" in block "+w.className);G.deserialize(w.signalOutputs[E])}}getClassName(){return"FlowGraphExecutionBlock"}}},13330:(w,E,G)=>{"use strict";G.d(E,{d:()=>h});var P=G(13296);class h extends P.e{constructor(w){super(w),this.out=this._registerSignalOutput("out")}}},13281:(w,E,G)=>{"use strict";G.d(E,{B:()=>Q,F:()=>I,I:()=>j,K:()=>T,N:()=>W,c:()=>l,g:()=>u,h:()=>q,j:()=>c,k:()=>Z,o:()=>J,r:()=>O,t:()=>t,u:()=>i,x:()=>V,z:()=>a});var P,h=G(11679),B=G(11716),y=G(13274),x=G(13284);!function(w){w.Any="any",w.String="string",w.Number="number",w.Boolean="boolean",w.Object="object",w.Integer="FlowGraphInteger",w.Vector2="Vector2",w.QE="QE",w.Vector4="Vector4",w.Quaternion="Quaternion",w.Matrix="Matrix",w.Matrix2D="Matrix2D",w.Matrix3D="Matrix3D",w.dE="dE",w.Tx="Tx"}(P||(P={}));class U{constructor(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=w,this.defaultValue=E,this.animationType=G}serialize(w){w.typeName=this.typeName,w.defaultValue=this.defaultValue}}const l=new U("any",void 0),i=new U("string",""),O=new U("number",0,0),u=new U("boolean",!1),V=new U("Vector2",h.Vector2.Zero(),5),a=new U("QE",h.QE.Zero(),1),Q=new U("Vector4",h.Vector4.Zero()),c=new U("Matrix",h.Matrix.Identity(),3),Z=new U("Matrix2D",new x.c),J=new U("Matrix3D",new x.e),d=new U("dE",B.dE.Black(),4),K=new U("Tx",new B.Tx(0,0,0,0),7),t=new U("Quaternion",h.Quaternion.Identity(),2);t.typeTransformer=w=>{if(w.getClassName){if("Vector4"===w.getClassName())return h.Quaternion.KE(w.Lh());if("QE"===w.getClassName())return h.Quaternion.FromEulerVector(w);if("Matrix"===w.getClassName())return h.Quaternion.FromRotationMatrix(w)}return w};const q=new U("FlowGraphInteger",new y.d(0),0);function W(w){const E=w;switch(typeof w){case"string":return i;case"number":return O;case"boolean":return u;case"object":if(E.getClassName)switch(E.getClassName()){case"Vector2":return V;case"QE":return a;case"Vector4":return Q;case"Matrix":return c;case"dE":return d;case"Tx":return K;case"Quaternion":return t;case"FlowGraphInteger":return q;case"Matrix2D":return Z;case"Matrix3D":return J}return l;default:return l}}function T(w){switch(w){case"string":return i;case"number":return O;case"boolean":return u;case"Vector2":return V;case"QE":return a;case"Vector4":return Q;case"Matrix":return c;case"dE":return d;case"Tx":return K;case"Quaternion":return t;case"FlowGraphInteger":return q;case"Matrix2D":return Z;case"Matrix3D":return J;default:return l}}function I(w){switch(w){case"number":default:return 0;case"Vector2":return 5;case"QE":return 1;case"Matrix":return 3;case"dE":return 4;case"Tx":return 7;case"Quaternion":return 2}}function j(w){switch(w){case 0:return O;case 5:return V;case 1:return a;case 3:return c;case 4:return d;case 7:return K;case 2:return t;default:return l}}},13271:(w,E,G)=>{"use strict";G.d(E,{c:()=>i,g:()=>l,h:()=>O});var P=G(11716),h=G(11679),B=G(13274),y=G(13281),x=G(13284);function U(w){return"Vector2"===w||"QE"===w||"Vector4"===w||"Quaternion"===w||"dE"===w||"Tx"===w}function l(w,E,G){var P;const h=(null===E||void 0===E||null===(P=E.getClassName)||void 0===P?void 0:P.call(E))??"";if(U(h)||function(w){return"Matrix"===w||"Matrix2D"===w||"Matrix3D"===w}(h))G[w]={value:E.Lh(),className:h};else if("FlowGraphInteger"===h)G[w]={value:E.value,className:h};else if(h&&(E.id||E.name))G[w]={id:E.id,name:E.name,className:h};else{if("object"===typeof E)throw new Error(`Could not serialize value ${E}`);G[w]=E}}function i(w,E,G,l){const O=E[w];let u;const V=(null===O||void 0===O?void 0:O.type)??(null===O||void 0===O?void 0:O.className);if(function(w){return"Mesh"===w||"AbstractMesh"===w||"GroundMesh"===w||"InstanceMesh"===w||"LinesMesh"===w||"GoldbergMesh"===w||"GreasedLineMesh"===w||"TrailMesh"===w}(V)){let w=l.meshes.filter((w=>O.id?w.id===O.id:w.name===O.name));0===w.length&&(w=l.transformNodes.filter((w=>O.id?w.id===O.id:w.name===O.name))),u=O.uniqueId?w.find((w=>w.uniqueId===O.uniqueId)):w[0]}else if(U(V))u=function(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===w)return h.Vector2.KE(E);if("QE"===w)return G&&(E[2]*=-1),h.QE.KE(E);if("Vector4"===w)return h.Vector4.KE(E);if("Quaternion"===w)return G&&(E[2]*=-1,E[3]*=-1),h.Quaternion.KE(E);if("dE"===w)return new P.dE(E[0],E[1],E[2]);if("Tx"===w)return new P.Tx(E[0],E[1],E[2],E[3]);throw new Error(`Unknown vector class name ${w}`)}(V,O.value);else if(function(w){return"AnimationGroup"===w}(V)){const w=l.animationGroups.filter((w=>w.name===O.name));u=1===w.length?w[0]:w.find((w=>w.uniqueId===O.uniqueId))}else u="Matrix"===V?h.Matrix.KE(O.value):"Matrix2D"===V?new x.c(O.value):"Matrix3D"===V?new x.e(O.value):"FlowGraphInteger"===V?B.d.FromValue(O.value):"number"===V||"string"===V||"boolean"===V?O.value[0]:O&&void 0!==O.value?O.value:Array.isArray(O)?O.reduce(((w,E)=>E.eventData?(w[E.id]={type:(0,y.K)(E.type)},"undefined"!==typeof E.value&&(w[E.id].value=i("value",E,G,l)),w):w),{}):O;return u}function O(w){return"FlowGraphJsonPointerParserBlock"===w}},13306:(w,E,G)=>{"use strict";function P(w,E){return!(!w.parent||w.parent!==E&&!P(w.parent,E))}function h(w){if(w.getClassName)return w.getClassName()}function B(w,E){return w===E&&("Vector2"===w||"QE"===w||"Vector4"===w||"Quaternion"===w)}function y(w,E){return w===E&&("Matrix"===w||"Matrix2D"===w||"Matrix3D"===w)}function x(w,E){return"FlowGraphInteger"===w&&"FlowGraphInteger"===E}function U(w,E){const G="number"===typeof w||"number"===typeof(null===w||void 0===w?void 0:w.value);return G&&!E?!isNaN(l(w)):G}function l(w){return"number"===typeof w?w:w.value}G.d(E,{b:()=>x,f:()=>y,h:()=>B,l:()=>h,m:()=>P,q:()=>l,u:()=>U})},12710:(w,E,G)=>{"use strict";G.r(E),G.d(E,{SceneInstrumentation:()=>B});var P=G(11498),h=G(11879);class B{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(w){w!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=w,w?(this._onBeforeActiveMeshesEvaluationObserver=this.ZE.onBeforeActiveMeshesEvaluationObservable.add((()=>{P.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ZE.onAfterActiveMeshesEvaluationObservable.add((()=>{P.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ZE.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ZE.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(w){w!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=w,w?(this._onBeforeRenderTargetsRenderObserver=this.ZE.onBeforeRenderTargetsRenderObservable.add((()=>{P.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ZE.onAfterRenderTargetsRenderObservable.add((()=>{P.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ZE.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ZE.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(w){w!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=w,w?(this._onBeforeParticlesRenderingObserver=this.ZE.onBeforeParticlesRenderingObservable.add((()=>{P.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ZE.onAfterParticlesRenderingObservable.add((()=>{P.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ZE.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ZE.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(w){w!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=w,this.ZE.spriteManagers&&(w?(this._onBeforeSpritesRenderingObserver=this.ZE.onBeforeSpritesRenderingObservable.add((()=>{P.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ZE.onAfterSpritesRenderingObservable.add((()=>{P.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ZE.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ZE.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(w){w!==this._capturePhysicsTime&&this.ZE.onBeforePhysicsObservable&&(this._capturePhysicsTime=w,w?(this._onBeforePhysicsObserver=this.ZE.onBeforePhysicsObservable.add((()=>{P.Tools.StartPerformanceCounter("Sa"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ZE.onAfterPhysicsObservable.add((()=>{P.Tools.EndPerformanceCounter("Sa"),this._physicsTime.endMonitoring()}))):(this.ZE.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ZE.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(w){w!==this._captureAnimationsTime&&(this._captureAnimationsTime=w,w?this._onAfterAnimationsObserver=this.ZE.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ZE.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(w){this._captureFrameTime=w}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(w){this._captureInterFrameTime=w}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(w){w!==this._captureRenderTime&&(this._captureRenderTime=w,w?(this._onBeforeDrawPhaseObserver=this.ZE.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),P.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ZE.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),P.Tools.EndPerformanceCounter("Main render")}))):(this.ZE.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ZE.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(w){w!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=w,w?(this._onBeforeCameraRenderObserver=this.ZE.onBeforeCameraRenderObservable.add((w=>{this._cameraRenderTime.beginMonitoring(),P.Tools.StartPerformanceCounter(`Rendering camera ${w.name}`)})),this._onAfterCameraRenderObserver=this.ZE.onAfterCameraRenderObservable.add((w=>{this._cameraRenderTime.endMonitoring(!1),P.Tools.EndPerformanceCounter(`Rendering camera ${w.name}`)}))):(this.ZE.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ZE.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ZE.getEngine()._drawCalls}constructor(w){this.ZE=w,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new h.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new h.c,this._captureFrameTime=!1,this._frameTime=new h.c,this._captureRenderTime=!1,this._renderTime=new h.c,this._captureInterFrameTime=!1,this._interFrameTime=new h.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new h.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new h.c,this._capturePhysicsTime=!1,this._physicsTime=new h.c,this._captureAnimationsTime=!1,this._animationsTime=new h.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new h.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=w.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(P.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ZE.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=w.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(P.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Kh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Kh(),this._captureParticlesRenderTime&&this._particlesRenderTime.Kh(),this._captureSpritesRenderTime&&this._spritesRenderTime.Kh(),this._captureRenderTime&&this._renderTime.Kh(),this._captureCameraRenderTime&&this._cameraRenderTime.Kh()}))}dispose(){this._disposed||(this.ZE.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ZE.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ZE.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ZE.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ZE.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ZE.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ZE.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ZE.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ZE.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ZE.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ZE.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ZE.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ZE.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ZE.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ZE.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ZE.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ZE.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ZE=null,this._disposed=!0)}}},13267:(w,E,G)=>{"use strict";G.d(E,{c:()=>i});var P=G(11668),h=G(11671),B=G(11679),y=G(12081),x=G(12194),U=G(12251),l=G(11646);y.e.AddNodeConstructor("Light_Type_1",((w,E)=>()=>new i(w,B.QE.Zero(),E)));class i extends U.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(w){this._shadowFrustumSize=w,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(w){this._shadowOrthoScale=w,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(w){this._orthoLeft=w}get orthoRight(){return this._orthoRight}set orthoRight(w){this._orthoRight=w}get orthoTop(){return this._orthoTop}set orthoTop(w){this._orthoTop=w}get orthoBottom(){return this._orthoBottom}set orthoBottom(w){this._orthoBottom=w}constructor(w,E,G){super(w,G),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=E.scale(-1),this.direction=E}getClassName(){return"Xa"}getTypeID(){return x.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(w,E,G){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(w):this._setDefaultAutoExtendShadowProjectionMatrix(w,E,G)}_setDefaultFixedFrustumShadowProjectionMatrix(w){const E=this.Ww().activeCamera;E&&B.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:E.Sh,void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ,w,this.Ww().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(w,E,G){const P=this.Ww().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const w=B.QE.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let P=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let y=0;y<G.length;y++){const x=G[y];if(!x)continue;const U=x.getBoundingInfo().boundingBox;for(let G=0;G<U.vectorsWorld.length;G++)B.QE.TransformCoordinatesToRef(U.vectorsWorld[G],E,w),w.x<this._orthoLeft&&(this._orthoLeft=w.x),w.y<this._orthoBottom&&(this._orthoBottom=w.y),w.x>this._orthoRight&&(this._orthoRight=w.x),w.y>this._orthoTop&&(this._orthoTop=w.y),this.autoCalcShadowZBounds&&(w.z<P&&(P=w.z),w.z>h&&(h=w.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=P,this._shadowMaxZ=h)}const h=this._orthoRight-this._orthoLeft,y=this._orthoTop-this._orthoBottom,x=void 0!==this.shadowMinZ?this.shadowMinZ:(null===P||void 0===P?void 0:P.Sh)||0,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===P||void 0===P?void 0:P.maxZ)||1e4,l=this.Ww().getEngine().useReverseDepthBuffer;B.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-h*this.shadowOrthoScale,this._orthoRight+h*this.shadowOrthoScale,this._orthoBottom-y*this.shadowOrthoScale,this._orthoTop+y*this.shadowOrthoScale,l?U:x,l?x:U,w,this.Ww().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(w,E){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,E),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,E),this)}transferToNodeMaterialEffect(w,E){return this.computeTransformedInformation()?(w.setFloat3(E,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(w.setFloat3(E,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(w){const E=this._scene.getEngine();return!E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:1}getDepthMaxZ(w){const E=this._scene.getEngine();return E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:1}prepareLightSpecificDefines(w,E){w["DIRLIGHT"+E]=!0}}(0,P.c)([(0,h.F)()],i.prototype,"shadowFrustumSize",null),(0,P.c)([(0,h.F)()],i.prototype,"shadowOrthoScale",null),(0,P.c)([(0,h.F)()],i.prototype,"autoUpdateExtends",void 0),(0,P.c)([(0,h.F)()],i.prototype,"autoCalcShadowZBounds",void 0),(0,P.c)([(0,h.F)("orthoLeft")],i.prototype,"_orthoLeft",void 0),(0,P.c)([(0,h.F)("orthoRight")],i.prototype,"_orthoRight",void 0),(0,P.c)([(0,h.F)("orthoTop")],i.prototype,"_orthoTop",void 0),(0,P.c)([(0,h.F)("orthoBottom")],i.prototype,"_orthoBottom",void 0),(0,l.g)("BABYLON.DirectionalLight",i)},13736:(w,E,G)=>{"use strict";G.d(E,{e:()=>i});var P=G(11668),h=G(11671),B=G(11679),y=G(11716),x=G(12081),U=G(12194),l=G(11646);x.e.AddNodeConstructor("Light_Type_3",((w,E)=>()=>new i(w,B.QE.Zero(),E)));class i extends U.e{constructor(w,E,G){super(w,G),this.groundColor=new y.dE(0,0,0),this.direction=E||B.QE.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ba"}setDirectionToTarget(w){return this.direction=B.QE.Normalize(w.cE(B.QE.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(w,E){const G=B.QE.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",G.x,G.y,G.z,0,E),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.gx),E),this}transferToNodeMaterialEffect(w,E){const G=B.QE.Normalize(this.direction);return w.setFloat3(E,G.x,G.y,G.z),this}Ah(){return this._worldMatrix||(this._worldMatrix=B.Matrix.Identity()),this._worldMatrix}getTypeID(){return U.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(w,E){w["HEMILIGHT"+E]=!0}}(0,P.c)([(0,h.j)()],i.prototype,"groundColor",void 0),(0,P.c)([(0,h.C)()],i.prototype,"direction",void 0),(0,l.g)("BABYLON.HemisphericLight",i)},13240:(w,E,G)=>{"use strict";G.d(E,{e:()=>O});var P=G(11668),h=G(11671),B=G(11679),y=G(12081),x=G(12194),U=G(12251),l=G(11663),i=G(11646);y.e.AddNodeConstructor("Light_Type_2",((w,E)=>()=>new O(w,B.QE.Zero(),B.QE.Zero(),0,0,E)));class O extends U.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(w){this._iesProfileTexture!==w&&(this._iesProfileTexture=w,this._iesProfileTexture&&O._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(w){this._angle=w,this._cosHalfAngle=Math.cos(.5*w),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(w){this._innerAngle=w,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(w){this._shadowAngleScale=w,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(w){this._projectionTextureLightNear=w,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(w){this._projectionTextureLightFar=w,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(w){this._projectionTextureUpDirection=w,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(w){this._projectionTexture!==w&&(this._projectionTexture=w,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(O._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):O._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(w){return void 0!==w.onGeneratedObservable}static _IsTexture(w){return void 0!==w.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(w){this._projectionTextureProjectionLightMatrix=w,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(w,E,G,P,h,y){super(w,y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=B.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=B.QE.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=B.QE.Zero(),this._projectionTextureViewLightMatrix=B.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=B.Matrix.Zero(),this._projectionTextureScalingMatrix=B.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=E,this.direction=G,this.angle=P,this.exponent=h}getClassName(){return"SpotLight"}getTypeID(){return x.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(w){super._setDirection(w),this._projectionTextureViewLightDirty=!0}_setPosition(w){super._setPosition(w),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(w,E,G){const P=this.Ww().activeCamera;if(!P)return;this._shadowAngleScale=this._shadowAngleScale||1;const h=this._shadowAngleScale*this._angle,y=void 0!==this.shadowMinZ?this.shadowMinZ:P.Sh,x=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,U=this.Ww().getEngine().useReverseDepthBuffer;B.Matrix.PerspectiveFovLHToRef(h,1,U?x:y,U?y:x,w,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),B.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const w=this.projectionTextureLightFar,E=this.projectionTextureLightNear,G=w/(w-E),P=-G*E,h=1/Math.tan(this._angle/2);B.Matrix.FromValuesToRef(h/1,0,0,0,0,h,0,0,0,0,G,1,0,0,P,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof l.c){const w=this._projectionTexture.uScale/2,E=this._projectionTexture.vScale/2;B.Matrix.FromValuesToRef(w,0,0,0,0,E,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(w,E){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),w.setMatrix("textureProjectionMatrix"+E,this._projectionTextureMatrix),w.setTexture("projectionLightTexture"+E,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&w.setTexture("iesLightTexture"+E,this._iesProfileTexture),this}transferToEffect(w,E){let G;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,E),G=B.QE.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,E),G=B.QE.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",G.x,G.y,G.z,this._cosHalfAngle,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,E),this}transferToNodeMaterialEffect(w,E){let G;return G=this.computeTransformedInformation()?B.QE.Normalize(this.transformedDirection):B.QE.Normalize(this.direction),this.Ww().useRightHandedSystem?w.setFloat3(E,-G.x,-G.y,-G.z):w.setFloat3(E,G.x,G.y,G.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(w){const E=this._scene.getEngine(),G=void 0!==this.shadowMinZ?this.shadowMinZ:(null===w||void 0===w?void 0:w.Sh)??0;return E.useReverseDepthBuffer&&E.isNDCHalfZRange?G:this._scene.getEngine().isNDCHalfZRange?0:G}getDepthMaxZ(w){const E=this._scene.getEngine(),G=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===w||void 0===w?void 0:w.maxZ)??1e4;return E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:G}prepareLightSpecificDefines(w,E){w["SPOTLIGHT"+E]=!0,w["PROJECTEDLIGHTTEXTURE"+E]=!(!this.projectionTexture||!this.projectionTexture.isReady()),w["IESLIGHTTEXTURE"+E]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,P.c)([(0,h.F)()],O.prototype,"angle",null),(0,P.c)([(0,h.F)()],O.prototype,"innerAngle",null),(0,P.c)([(0,h.F)()],O.prototype,"shadowAngleScale",null),(0,P.c)([(0,h.F)()],O.prototype,"exponent",void 0),(0,P.c)([(0,h.F)()],O.prototype,"projectionTextureLightNear",null),(0,P.c)([(0,h.F)()],O.prototype,"projectionTextureLightFar",null),(0,P.c)([(0,h.F)()],O.prototype,"projectionTextureUpDirection",null),(0,P.c)([(0,h.y)("projectedLightTexture")],O.prototype,"_projectionTexture",void 0),(0,i.g)("BABYLON.SpotLight",O)},12965:(w,E,G)=>{"use strict";G.d(E,{d:()=>y,e:()=>B,i:()=>x});const P={},h={};function B(w,E){P[w]=E}function y(w,E){h[w]=E}function x(w){return h[w]?h[w]:null}},12873:(w,E,G)=>{"use strict";G.d(E,{c:()=>W,e:()=>s});var P,h=G(11498),B=G(11504),y=G(11908),x=G(11543),U=G(11518),l=G(12127),i=G(11547),O=G(11555),u=G(11650),V=G(11578),a=G(11540);!function(w){w[w.Clean=0]="Clean",w[w.Stop=1]="Stop",w[w.Sync=2]="Sync",w[w.NoSync=3]="NoSync"}(P||(P={}));const Q=new B.d,c={};let Z=!1;function J(){return c[".babylon"]}function d(w,E){const G=c[w];return G||(U.e.Warn("Unable to find a plugin to load "+w+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),E?J():void 0)}function K(w,E,G){let P="Unable to load from "+(w.rawData?"binary data":w.url);return E?P+=`: ${E}`:G&&(P+=`: ${G}`),P}async function t(w,E,G,P,h,B,y,x,U){var l;const O="data:"===(u=w.url).substring(0,5)?u.substring(5):null;var u;if(w.rawData&&!y)throw"When using ArrayBufferView to load data the file extension must be provided.";const Z=O||y?"":function(w){const E=w.indexOf("?");-1!==E&&(w=w.substring(0,E));const G=w.lastIndexOf(".");return w.substring(G,w.length).toLowerCase()}(w.url);let K=y?d(y,!0):O?function(w){for(const E in c){const G=c[E].plugin;if(G.canDirectLoad&&G.canDirectLoad(w))return c[E]}return J()}(w.url):d(Z,!1);if(!K&&Z){if(w.url&&!w.url.startsWith("blob:")){const E=await async function(w,E){const G=E.method||"GET";return await new Promise(((P,h)=>{const B=new a.c;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const w={};if(E.responseHeaders)for(const G of E.responseHeaders)w[G]=B.getResponseHeader(G)||"";P({response:B.response,headerValues:w})}else h(`Unable to fetch data from ${w}. Error code: ${B.status}`)})),B.open(G,w),B.send()}))}(w.url,{method:"HEAD",responseHeaders:["Content-Type"]}),G=E.headerValues?E.headerValues["Content-Type"]:"";G&&(K=function(w){for(const E in c){const G=c[E];if(G.mimeType===w)return G}}(G))}K||(K=J())}if(!K)throw new Error(`No plugin or fallback for ${y??w.url}`);if(!1===(null===U||void 0===U||null===(l=U[K.plugin.name])||void 0===l?void 0:l.enabled))throw new Error(`The '${K.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(w.rawData&&!K.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(w=>{if(K.plugin.createPlugin){const E=K.plugin.createPlugin(U??{});return E instanceof Promise?(E.then(w).catch((w=>{h("Error instantiating plugin.",w)})),null):(w(E),E)}return w(K.plugin),K.plugin})((U=>{var l;if(!U)throw`The loader plugin corresponding to the '${y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Q.notifyObservers(U),O&&(U.canDirectLoad&&U.canDirectLoad(w.url)||!(0,i.l)(w.url))){if(U.directLoad){const w=U.directLoad(E,O);w instanceof Promise?w.then((w=>{G(U,w)})).catch((w=>{h("Error in directLoad of _loadData: "+w,w)})):G(U,w)}else G(U,O);return}const u=K.isBinary,a=(w,P)=>{E.O?h("Scene has been disposed"):G(U,w,P)};let c=null,Z=!1;null===(l=U.qh)||void 0===l||l.add((()=>{Z=!0,c&&(c.abort(),c=null),B()}));const J=()=>{if(Z)return;const G=(w,E)=>{h(null===w||void 0===w?void 0:w.statusText,E)};if(!U.loadFile&&w.rawData)throw"Plugin does not support loading ArrayBufferView.";c=U.loadFile?U.loadFile(E,w.rawData||w.file||w.url,w.rootUrl,a,P,u,G,x):E._loadFile(w.file||w.url,a,P,!0,u,G)},d=E.getEngine();let t=d.enableOfflineSupport;if(t){let G=!1;for(const P of E.disableOfflineSupportExceptionRules)if(P.test(w.url)){G=!0;break}t=!G}t&&V.b.OfflineProviderFactory?E.offlineProvider=V.b.OfflineProviderFactory(w.url,J,d.disableManifestCheck):J()}))}function q(w,E){let G,P,B=null,y=null;if(E)if(E.name)G=`file:${E.name}`,P=E.name,B=E;else if(ArrayBuffer.isView(E))G="",P=(0,u.e)(),y=E;else if(E.startsWith("data:"))G=E,P="";else if(w){const B=E;if("/"===B.substring(0,1))return h.Tools.Error("Wrong sceneFilename parameter"),null;G=w+B,P=B}else G=E,P=h.Tools.GetFilename(E),w=h.Tools.GetFolderPath(E);else G=w,P=h.Tools.GetFilename(w),w=h.Tools.GetFolderPath(w);return{url:G,rootUrl:w,name:P,file:B,rawData:y}}function W(w){if("string"===typeof w.extensions){const E=w.extensions;c[E.toLowerCase()]={plugin:w,isBinary:!1}}else{const E=w.extensions,G=Object.keys(E);for(const P of G)c[P.toLowerCase()]={plugin:w,isBinary:E[P].isBinary,mimeType:E[P].mimeType}}}async function T(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x.e.LastCreatedScene,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!P)return U.e.Error("No scene available to import mesh to"),null;const V=q(E,G);if(!V)return null;const a={};P.addPendingData(a);const Q=()=>{P.removePendingData(a)},c=(w,E)=>{const G=K(V,w,E);y?y(P,G,new O.i(G,O.e.SceneLoaderError,E)):U.e.Error(G),Q()},Z=B?w=>{try{B(w)}catch(E){c("Error in onProgress callback: "+E,E)}}:void 0,J=(w,E,G,B,y,x,U,l)=>{if(P.importedMeshesFiles.push(V.url),h)try{h(w,E,G,B,y,x,U,l)}catch(i){c("Error in onSuccess callback: "+i,i)}P.removePendingData(a)};return await t(V,P,((E,G,h)=>{if(E.rewriteRootURL&&(V.rootUrl=E.rewriteRootURL(V.rootUrl,h)),E.importMesh){const h=[],B=[],y=[];if(!E.importMesh(w,P,G,V.rootUrl,h,B,y,c))return;P.loadingPluginName=E.name,J(h,B,y,[],[],[],[],[])}else{E.importMeshAsync(w,P,G,V.rootUrl,Z,V.name).then((w=>{P.loadingPluginName=E.name,J(w.meshes,w.Pu,w.skeletons,w.animationGroups,w.transformNodes,w.geometries,w.lights,w.spriteManagers)})).catch((w=>{c(w.message,w)}))}}),Z,c,Q,l,i,u)}async function I(w,E,G,P,h,B,y,x){return await new Promise(((U,l)=>{try{T(w,E,G,P,((w,E,G,P,h,B,y,x)=>{U({meshes:w,Pu:E,skeletons:G,animationGroups:P,transformNodes:h,geometries:B,lights:y,spriteManagers:x})}),h,((w,E,G)=>{l(G||new Error(E))}),B,y,x).catch(l)}catch(O){l(O)}}))}async function j(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.e.LastCreatedEngine,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};G?await o(w,E,new y.d(G),P,B,U,l,i,O):h.Tools.Error("No engine available")}async function g(w,E,G,P,h,B,y){return await new Promise(((x,U)=>{j(w,E,G,(w=>{x(w)}),P,((w,E,G)=>{U(G||new Error(E))}),h,B,y)}))}async function o(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.e.LastCreatedScene,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!G)return U.e.Error("No scene available to append to"),null;const V=q(w,E);if(!V)return null;const a={};G.addPendingData(a);const Q=()=>{G.removePendingData(a)};l.c.ShowLoadingScreen&&!Z&&(Z=!0,G.getEngine().displayLoadingUI(),G.executeWhenReady((()=>{G.getEngine().hideLoadingUI(),Z=!1})));const c=(w,E)=>{const P=K(V,w,E);B?B(G,P,new O.i(P,O.e.SceneLoaderError,E)):U.e.Error(P),Q()},J=h?w=>{try{h(w)}catch(E){c("Error in onProgress callback",E)}}:void 0,d=()=>{if(P)try{P(G)}catch(w){c("Error in onSuccess callback",w)}G.removePendingData(a)};return await t(V,G,((w,E)=>{if(w.load){if(!w.load(G,E,V.rootUrl,c))return;G.loadingPluginName=w.name,d()}else{w.loadAsync(G,E,V.rootUrl,J,V.name).then((()=>{G.loadingPluginName=w.name,d()})).catch((w=>{c(w.message,w)}))}}),J,c,Q,y,i,u)}async function f(w,E,G,P,h,B,y){return await new Promise(((x,U)=>{try{o(w,E,G,(w=>{x(w)}),P,((w,E,G)=>{U(G||new Error(E))}),h,B,y).catch(U)}catch(O){U(O)}}))}async function k(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.e.LastCreatedScene,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!G)return U.e.Error("No scene available to load asset container to"),null;const u=q(w,E);if(!u)return null;const V={};G.addPendingData(V);const a=()=>{G.removePendingData(V)},Q=(w,E)=>{const P=K(u,w,E);B?B(G,P,new O.i(P,O.e.SceneLoaderError,E)):U.e.Error(P),a()},c=h?w=>{try{h(w)}catch(E){Q("Error in onProgress callback",E)}}:void 0,Z=w=>{if(P)try{P(w)}catch(E){Q("Error in onSuccess callback",E)}G.removePendingData(V)};return await t(u,G,((w,E)=>{if(w.loadAssetContainer){const P=w.loadAssetContainer(G,E,u.rootUrl,Q);if(!P)return;P.populateRootNodes(),G.loadingPluginName=w.name,Z(P)}else if(w.loadAssetContainerAsync){w.loadAssetContainerAsync(G,E,u.rootUrl,c,u.name).then((E=>{E.populateRootNodes(),G.loadingPluginName=w.name,Z(E)})).catch((w=>{Q(w.message,w)}))}else Q("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),c,Q,a,y,l,i)}async function N(w,E,G,P,h,B,y){return await new Promise(((x,U)=>{try{k(w,E,G,(w=>{x(w)}),P,((w,E,G)=>{U(G||new Error(E))}),h,B,y).catch(U)}catch(O){U(O)}}))}async function v(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.e.LastCreatedScene,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!G)return void U.e.Error("No scene available to load animations to");if(P){for(const P of G.animatables)P.reset();G.stopAllAnimations();const w=G.animationGroups.slice();for(const G of w)G.dispose();const E=G.getNodes();for(const G of E)G.animations&&(G.animations=[])}else switch(h){case 0:const w=G.animationGroups.slice();for(const E of w)E.dispose();break;case 1:for(const E of G.animationGroups)E.stop();break;case 2:for(const E of G.animationGroups)E.reset(),E.restart();break;case 3:break;default:return void U.e.Error("Unknown animation group loading mode value '"+h+"'")}const a=G.animatables.length;await k(w,E,G,(w=>{w.mergeAnimationsTo(G,G.animatables.slice(a),B),w.dispose(),G.onAnimationFileImportedObservable.notifyObservers(G),y&&y(G)}),l,i,O,u,V)}async function C(w,E,G,P,h,B,y,x,U,l){return await new Promise(((i,u)=>{try{v(w,E,G,P,h,B,(w=>{i(w)}),y,((w,E,G)=>{u(G||new Error(E))}),x,U,l).catch(u)}catch(O){u(O)}}))}class s{static get ForceFullSceneLoadingForIncremental(){return l.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(w){l.c.ForceFullSceneLoadingForIncremental=w}static get ShowLoadingScreen(){return l.c.ShowLoadingScreen}static set ShowLoadingScreen(w){l.c.ShowLoadingScreen=w}static get loggingLevel(){return l.c.loggingLevel}static set loggingLevel(w){l.c.loggingLevel=w}static get CleanBoneMatrixWeights(){return l.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(w){l.c.CleanBoneMatrixWeights=w}static GetDefaultPlugin(){return J()}static GetPluginForExtension(w){var E;return null===(E=d(w,!0))||void 0===E?void 0:E.plugin}static IsPluginForExtensionAvailable(w){return function(w){return!!c[w]}(w)}static RegisterPlugin(w){W(w)}static ImportMesh(w,E,G,P,h,B,y,U,l){T(w,E,G,P,h,B,y,U,l).catch((w=>null===y||void 0===y?void 0:y(x.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async ImportMeshAsync(w,E,G,P,h,B,y){return await I(w,E,G,P,h,B,y)}static Load(w,E,G,P,h,B,y,U){j(w,E,G,P,h,B,y,U).catch((w=>null===B||void 0===B?void 0:B(x.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async LoadAsync(w,E,G,P,h,B){return await g(w,E,G,P,h,B)}static Append(w,E,G,P,h,B,y,U){o(w,E,G,P,h,B,y,U).catch((w=>null===B||void 0===B?void 0:B(G??x.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async AppendAsync(w,E,G,P,h,B){return await f(w,E,G,P,h,B)}static LoadAssetContainer(w,E,G,P,h,B,y,U){k(w,E,G,P,h,B,y,U).catch((w=>null===B||void 0===B?void 0:B(G??x.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async LoadAssetContainerAsync(w,E,G,P,h,B){return await N(w,E,G,P,h,B)}static ImportAnimations(w,E,G,P,h,B,y,U,l,i,O){v(w,E,G,P,h,B,y,U,l,i,O).catch((w=>null===l||void 0===l?void 0:l(G??x.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async ImportAnimationsAsync(w,E,G,P,h,B,y,x,U,l,i){return await C(w,E,G,P,h,B,x,l,i)}}s.NO_LOGGING=0,s.MINIMAL_LOGGING=1,s.SUMMARY_LOGGING=2,s.DETAILED_LOGGING=3,s.OnPluginActivatedObservable=Q},13250:(w,E,G)=>{"use strict";G.d(E,{d:()=>u});var P=G(11668),h=G(11671),B=G(11498),y=G(11679),x=G(11695),U=G(11663),l=G(11646),i=G(11504),O=G(11706);G(13255);class u extends x.c{set boundingBoxSize(w){if(this._boundingBoxSize&&this._boundingBoxSize.equals(w))return;this._boundingBoxSize=w;const E=this.Ww();E&&E.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(w){this._rotationY=w,this.setReflectionTextureMatrix(y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(w,E,G){let P="";for(const h of w)P+=h;return new u(P,E,null,G,w)}static CreateFromPrefilteredData(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=E.useDelayedTextureLoading;E.useDelayedTextureLoading=!1;const B=new u(w,E,null,!1,null,null,null,void 0,!0,G,P);return E.useDelayedTextureLoading=h,B}constructor(w,E){var G;let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,a=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,Z=arguments.length>13?arguments[13]:void 0,J=arguments.length>14?arguments[14]:void 0;super(E),this.onLoadObservable=new i.d,this.boundingBoxPosition=y.QE.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new y.Matrix,this._buffer=null,this.name=w,this.url=w,this._noMipmap=h,this.mh=!1,this.isCube=!0,this._textureMatrix=y.Matrix.Identity(),this.coordinatesMode=U.c.CUBIC_MODE;let d=null,K=null;null===P||Array.isArray(P)?(this._noMipmap=h,this._format=O,this._createPolynomials=a,d=P,this._loaderOptions=Z,this._useSRGBBuffer=J,this._lodScale=Q,this._lodOffset=c):(d=P.extensions??null,this._noMipmap=P.noMipmap??!1,B=P.files??null,K=P.buffer??null,this._format=P.format??5,u=P.prefiltered??!1,V=P.forcedExtension??null,this._createPolynomials=P.createPolynomials??!1,this._lodScale=P.lodScale??.8,this._lodOffset=P.lodOffset??0,this._loaderOptions=P.loaderOptions,this._useSRGBBuffer=P.useSRGBBuffer,x=P.S??null,l=P.onError??null),(w||B)&&this.updateURL(w,V,x,u,l,d,null===(G=this.Ww())||void 0===G?void 0:G.useDelayedTextureLoading,B,K)}getClassName(){return"CubeTexture"}updateURL(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=w),this.url=w,E&&(this._forcedExtension=E);const l=w.lastIndexOf("."),i=E||(l>-1?w.substring(l).toLowerCase():""),O=0===i.indexOf(".dds"),u=0===i.indexOf(".env"),V=0===i.indexOf(".basis");if(u?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=P,P&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),x)this._files=x;else if(V||u||O||B||(B=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,B){for(let E=0;E<B.length;E++)this._files.push(w+B[E]);this._extensions=B}this._buffer=U,y?(this.delayLoadState=4,this._delayedOnLoad=G,this._delayedOnError=h):this._loadTexture(G,h)}delayLoad(w){4===this.delayLoadState&&(w&&(this._forcedExtension=w),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(w){var E,G;if(w.updateFlag===this._textureMatrix.updateFlag)return;w.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(G=this.Ww())||void 0===G||G.markAllMaterialsAsDirty(1,(w=>-1!==w.getActiveTextures().indexOf(this))));if(this._textureMatrix=w,null===(E=this.Ww())||void 0===E||!E.useRightHandedSystem)return;const P=y.TmpVectors.QE[0],h=y.TmpVectors.Quaternion[0],B=y.TmpVectors.QE[1];this._textureMatrix.decompose(P,h,B),h.z*=-1,h.w*=-1,y.Matrix.ComposeToRef(P,h,B,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var w;return null!==(w=this.Ww())&&void 0!==w&&w.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=this.Ww(),P=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const h=()=>{var E;(this.onLoadObservable.notifyObservers(this),P)&&(P.dispose(),null===(E=this.Ww())||void 0===E||E.markAllMaterialsAsDirty(1));w&&w()},y=(w,G)=>{this._loadingError=!0,this._errorObject={message:w,exception:G},E&&E(w,G),U.c.OnTextureLoadErrorObservable.notifyObservers(this)};var x;this._texture?this._texture.isReady?B.Tools.SetImmediate((()=>h())):this._texture.onLoadedObservable.add((()=>h())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,G,this._lodScale,this._lodOffset,w,y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,G,this._files,this._noMipmap,w,y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(x=this._texture)||void 0===x||x.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(w,E,G){const P=O.b.Parse((()=>{let P=!1;return w.prefiltered&&(P=w.prefiltered),new u(G+(w.url??w.name),E,w.extensions,!1,w.files||null,null,null,void 0,P,w.forcedExtension)}),w,E);if(w.boundingBoxPosition&&(P.boundingBoxPosition=y.QE.KE(w.boundingBoxPosition)),w.boundingBoxSize&&(P.boundingBoxSize=y.QE.KE(w.boundingBoxSize)),w.animations)for(let h=0;h<w.animations.length;h++){const E=w.animations[h],G=(0,l.e)("BABYLON.Animation");G&&P.animations.push(G.Parse(E))}return P}clone(){let w=0;const E=O.b.Clone((()=>{const E=new u(this.url,this.Ww()||this._getEngine(),this._extensions,this._noMipmap,this._files);return w=E.uniqueId,E}),this);return E.uniqueId=w,E}}(0,P.c)([(0,h.F)()],u.prototype,"url",void 0),(0,P.c)([(0,h.C)()],u.prototype,"boundingBoxPosition",void 0),(0,P.c)([(0,h.C)()],u.prototype,"boundingBoxSize",null),(0,P.c)([(0,h.F)("rotationY")],u.prototype,"rotationY",null),(0,P.c)([(0,h.F)("files")],u.prototype,"_files",void 0),(0,P.c)([(0,h.F)("forcedExtension")],u.prototype,"_forcedExtension",void 0),(0,P.c)([(0,h.F)("extensions")],u.prototype,"_extensions",void 0),(0,P.c)([(0,h.p)("textureMatrix")],u.prototype,"_textureMatrix",void 0),(0,P.c)([(0,h.p)("textureMatrixRefraction")],u.prototype,"_textureMatrixRefraction",void 0),U.c._CubeTextureParser=u.Parse,(0,l.g)("BABYLON.CubeTexture",u)},13742:(w,E,G)=>{"use strict";G.d(E,{e:()=>U});var P=G(11518),h=G(11663),B=G(11652),y=G(11806),x=G(11626);y.ThinEngine.prototype.createDynamicTexture=function(w,E,G,P){const h=new x.e(this,4);return h.baseWidth=w,h.baseHeight=E,G&&(w=this.needPOTTextures?(0,B.e)(w,this._caps.maxTextureSize):w,E=this.needPOTTextures?(0,B.e)(E,this._caps.maxTextureSize):E),h.width=w,h.height=E,h.isReady=!1,h.generateMipMaps=G,h.samplingMode=P,this.updateTextureSamplingMode(P,h),this._internalTexturesCache.push(h),h},y.ThinEngine.prototype.updateDynamicTexture=function(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!w)return;const y=this._gl,x=y.TEXTURE_2D,U=this._bindTextureDirectly(x,w,!0,B);this._unpackFlipY(void 0===G?w.invertY:G),P&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const l=this._getWebGLTextureType(w.type),i=this._getInternalFormat(h||w.format),O=this._getRGBABufferInternalSizedFormat(w.type,i);y.texImage2D(x,0,O,i,l,E),w.generateMipMaps&&y.generateMipmap(x),U||this._bindTextureDirectly(x,null),P&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),h&&(w.format=h),w._dynamicTextureSource=E,w._premulAlpha=P,w.invertY=G||!1,w.isReady=!0};class U extends h.c{constructor(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,x=arguments.length>6?arguments[6]:void 0;const U=!G||G._isScene;super(null,U?G:null===G||void 0===G?void 0:G.ZE,U?!P:G,x,B,void 0,void 0,void 0,void 0,y),this.name=w,this.wrapU=h.c.CLAMP_ADDRESSMODE,this.wrapV=h.c.CLAMP_ADDRESSMODE,this._generateMipMaps=P;const l=this._getEngine();if(!l)return;if(E.getContext)this._canvas=E,this._ownCanvas=!1,this._texture=l.createDynamicTexture(this._canvas.width,this._canvas.height,P,B);else{this._canvas=l.createCanvas(1,1),this._ownCanvas=!0;const w=E;w.width||0===w.width?this._texture=l.createDynamicTexture(w.width,w.height,P,B):this._texture=l.createDynamicTexture(E,E,P,B)}const i=this.getSize();this._canvas.width!==i.width&&(this._canvas.width=i.width),this._canvas.height!==i.height&&(this._canvas.height=i.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(w){this._canvas.width=w.width,this._canvas.height=w.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(w.width,w.height,this._generateMipMaps,this.samplingMode)}scale(w){const E=this.getSize();E.width*=w,E.height*=w,this._recreate(E)}scaleTo(w,E){const G=this.getSize();G.width=w,G.height=E,this._recreate(G)}getContext(){return this._context}clear(w){const E=this.getSize();w&&(this._context.fillStyle=w),this._context.clearRect(0,0,E.width,E.height)}update(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===w||w,E,this._format||void 0,void 0,G)}drawText(w,E,G,P,h,B,y){let x=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const U=this.getSize();if(B&&(this._context.fillStyle=B,this._context.fillRect(0,0,U.width,U.height)),this._context.font=P,null===E||void 0===E){const G=this._context.measureText(w);E=(U.width-G.width)/2}if(null===G||void 0===G){const w=parseInt(P.replace(/\D/g,""));G=U.height/2+w/3.65}this._context.fillStyle=h||"",this._context.fillText(w,E,G),x&&this.update(y)}dispose(){var w,E;(super.dispose(),this._ownCanvas)&&(null===(w=this._canvas)||void 0===w||null===(E=w.remove)||void 0===E||E.call(w));this._canvas=null,this._context=null}clone(){const w=this.Ww();if(!w)return this;const E=this.getSize(),G=new U(this.name,E,w,this._generateMipMaps);return G.mh=this.mh,G.level=this.level,G.wrapU=this.wrapU,G.wrapV=this.wrapV,G}serialize(){const w=this.Ww();w&&!w.isReady()&&P.e.Warn("The scene must be ready before serializing the dynamic texture");const E=super.serialize();return U._IsCanvasElement(this._canvas)&&(E.base64String=this._canvas.toDataURL()),E.invertY=this._invertY,E.samplingMode=this.samplingMode,E}static _IsCanvasElement(w){return void 0!==w.toDataURL}_rebuild(){this.update()}}},13162:(w,E,G)=>{"use strict";G.d(E,{b:()=>h});var P=G(11663);class h extends P.c{get depth(){return this._depth}constructor(w,E,G,h,B,y){let x=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:P.c.TRILINEAR_SAMPLINGMODE,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,O=arguments.length>10?arguments[10]:void 0;super(null,y,!x,U),this.format=B,this._texture=y.getEngine().createRawTexture2DArray(w,E,G,h,B,x,U,l,null,i,O),this._depth=h,this.is2DArray=!0}update(w){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,w,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(w,E,G,P,B){return new h(w,E,G,P,5,B,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12985:(w,E,G)=>{"use strict";G.d(E,{d:()=>x,g:()=>U,h:()=>B,l:()=>y});var P=G(11689),h=G(11679);function B(w,E){return`{X: ${w.x.toFixed(E)} Y: ${w.y.toFixed(E)}}`}function y(w,E){return`{X: ${w._x.toFixed(E)} Y: ${w._y.toFixed(E)} Z: ${w._z.toFixed(E)}}`}function x(w,E){return 2*Math.acos((0,P.Clamp)(h.Quaternion.Dot(w,E)))}function U(w,E){const G=new h.Quaternion;return function(w,E,G){const B=h.QE.Cross(w,E),y=Math.acos((0,P.Clamp)(h.QE.Dot(w,E),-1,1));h.Quaternion.RotationAxisToRef(B,y,G)}(w,E,G),G}},12823:(w,E,G)=>{"use strict";G.d(E,{d:()=>l});var P=G(11679),h=G(11716),B=G(12103),y=G(12089),x=G(11728);G(12825);function U(w){let E=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const G=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],B=[];let U=[];const l=w.width||w.size||1,i=w.height||w.size||1,O=w.depth||w.size||1,u=w.wrap||!1;let V=void 0===w.topBaseAt?1:w.topBaseAt,a=void 0===w.bottomBaseAt?0:w.bottomBaseAt;V=(V+4)%4,a=(a+4)%4;let Q=[2,0,3,1][V],c=[2,0,1,3][a],Z=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(u){E=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],Z=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let w=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],G=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const P=[17,18,19,16],h=[22,23,20,21];for(;Q>0;)w.unshift(w.pop()),P.unshift(P.pop()),Q--;for(;c>0;)G.unshift(G.pop()),h.unshift(h.pop()),c--;w=w.flat(),G=G.flat(),Z=Z.concat(w).concat(G),E.push(P[0],P[2],P[3],P[0],P[1],P[2]),E.push(h[0],h[2],h[3],h[0],h[1],h[2])}const J=[l/2,i/2,O/2];U=Z.reduce(((w,E,G)=>w.concat(E*J[G%3])),[]);const d=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE,K=w.faceUV||new Array(6),t=w.faceColors,q=[];for(let y=0;y<6;y++)void 0===K[y]&&(K[y]=new P.Vector4(0,0,1,1)),t&&void 0===t[y]&&(t[y]=new h.Tx(1,1,1,1));for(let P=0;P<6;P++)if(B.push(K[P].z,x.b?1-K[P].w:K[P].w),B.push(K[P].x,x.b?1-K[P].w:K[P].w),B.push(K[P].x,x.b?1-K[P].y:K[P].y),B.push(K[P].z,x.b?1-K[P].y:K[P].y),t)for(let w=0;w<4;w++)q.push(t[P].r,t[P].g,t[P].b,t[P].a);y.d._ComputeSides(d,U,E,G,B,w.frontUVs,w.backUVs);const W=new y.d;if(W.indices=E,W.Iw=U,W.jw=G,W.ow=B,t){const w=d===y.d.DOUBLESIDE?q.concat(q):q;W.gw=w}return W}function l(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new B.c(w,G);E.sideOrientation=B.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return U(E).kw(P,E.updatable),P}y.d.CreateBox=U,B.c.CreateBox=function(w,E){return l(w,{size:E,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12973:(w,E,G)=>{"use strict";G.d(E,{d:()=>x});var P=G(12103),h=G(12089),B=G(11728);function y(w){const E=[],G=[],P=[],y=[],x=w.radius||.5,U=w.tessellation||64,l=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,i=0===w.sideOrientation?0:w.sideOrientation||h.d.DEFAULTSIDE;E.push(0,0,0),y.push(.5,.5);const O=2*Math.PI*l,u=1===l?O/U:O/(U-1);let V=0;for(let h=0;h<U;h++){const w=Math.cos(V),G=Math.sin(V),P=(w+1)/2,h=(1-G)/2;E.push(x*w,x*G,0),y.push(P,B.b?1-h:h),V+=u}1===l&&(E.push(E[3],E[4],E[5]),y.push(y[2],B.b?1-y[3]:y[3]));const a=E.length/3;for(let h=1;h<a-1;h++)G.push(h+1,0,h);h.d.ComputeNormals(E,G,P),h.d._ComputeSides(i,E,G,P,y,w.frontUVs,w.backUVs);const Q=new h.d;return Q.indices=G,Q.Iw=E,Q.jw=P,Q.ow=y,Q}function x(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new P.c(w,G);E.sideOrientation=P.c._GetDefaultSideOrientation(E.sideOrientation),h._originalBuilderSideOrientation=E.sideOrientation;return y(E).kw(h,E.updatable),h}h.d.CreateDisc=y,P.c.CreateDisc=function(w,E,G){return x(w,{radius:E,tessellation:G,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12825:(w,E,G)=>{"use strict";G.d(E,{h:()=>c,e:()=>J,i:()=>Z});var P=G(11679),h=G(11716),B=G(12103),y=G(12089),x=G(11748);B.c._GroundMeshParser=(w,E)=>U.Parse(w,E);class U extends B.c{constructor(w,E){super(w,E),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=w,this._subdivisionsY=w,this.subdivide(w);const G=this;G.createOrUpdateSubmeshesOctree&&G.createOrUpdateSubmeshesOctree(E)}getHeightAtCoordinates(w,E){const G=this.getWorldMatrix(),h=P.TmpVectors.Matrix[5];G.invertToRef(h);const B=P.TmpVectors.QE[8];if(P.QE.TransformCoordinatesFromFloatsToRef(w,0,E,h,B),w=B.x,E=B.z,w<this._minX||w>=this._maxX||E<=this._minZ||E>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const y=this._getFacetAt(w,E),x=-(y.x*w+y.z*E+y.w)/y.y;return P.QE.TransformCoordinatesFromFloatsToRef(0,x,0,G,B),B.y}getNormalAtCoordinates(w,E){const G=new P.QE(0,1,0);return this.getNormalAtCoordinatesToRef(w,E,G),G}getNormalAtCoordinatesToRef(w,E,G){const h=this.getWorldMatrix(),B=P.TmpVectors.Matrix[5];h.invertToRef(B);const y=P.TmpVectors.QE[8];if(P.QE.TransformCoordinatesFromFloatsToRef(w,0,E,B,y),w=y.x,E=y.z,w<this._minX||w>this._maxX||E<this._minZ||E>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const x=this._getFacetAt(w,E);return P.QE.TransformNormalFromFloatsToRef(x.x,x.y,x.z,h,G),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(w,E){const G=Math.floor((w+this._maxX)*this._subdivisionsX/this._width),P=Math.floor(-(E+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),h=this._heightQuads[P*this._subdivisionsX+G];let B;return B=E<h.slope.x*w+h.slope.y?h.facet1:h.facet2,B}_initHeightQuads(){const w=this._subdivisionsX,E=this._subdivisionsY;this._heightQuads=[];for(let G=0;G<E;G++)for(let E=0;E<w;E++){const h={slope:P.Vector2.Zero(),facet1:new P.Vector4(0,0,0,0),facet2:new P.Vector4(0,0,0,0)};this._heightQuads[G*w+E]=h}return this}_computeHeightQuads(){const w=this.getVerticesData(x.g.PositionKind);if(!w)return this;const E=P.TmpVectors.QE[3],G=P.TmpVectors.QE[2],h=P.TmpVectors.QE[1],B=P.TmpVectors.QE[0],y=P.TmpVectors.QE[4],U=P.TmpVectors.QE[5],l=P.TmpVectors.QE[6],i=P.TmpVectors.QE[7],O=P.TmpVectors.QE[8];let u=0,V=0,a=0,Q=0,c=0,Z=0,J=0;const d=this._subdivisionsX,K=this._subdivisionsY;for(let x=0;x<K;x++)for(let K=0;K<d;K++){u=3*K,V=x*(d+1)*3,a=(x+1)*(d+1)*3,E.x=w[V+u],E.y=w[V+u+1],E.z=w[V+u+2],G.x=w[V+u+3],G.y=w[V+u+4],G.z=w[V+u+5],h.x=w[a+u],h.y=w[a+u+1],h.z=w[a+u+2],B.x=w[a+u+3],B.y=w[a+u+4],B.z=w[a+u+5],Q=(B.z-E.z)/(B.x-E.x),c=E.z-Q*E.x,G.subtractToRef(E,y),h.subtractToRef(E,U),B.subtractToRef(E,l),P.QE.CrossToRef(l,U,i),P.QE.CrossToRef(y,l,O),i.normalize(),O.normalize(),Z=-(i.x*E.x+i.y*E.y+i.z*E.z),J=-(O.x*G.x+O.y*G.y+O.z*G.z);const t=this._heightQuads[x*d+K];t.slope.tx(Q,c),t.facet1.tx(i.x,i.y,i.z,Z),t.facet2.tx(O.x,O.y,O.z,J)}return this}serialize(w){super.serialize(w),w.subdivisionsX=this._subdivisionsX,w.subdivisionsY=this._subdivisionsY,w.minX=this._minX,w.maxX=this._maxX,w.Sh=this._minZ,w.maxZ=this._maxZ,w.width=this._width,w.height=this._height}static Parse(w,E){const G=new U(w.name,E);return G._subdivisionsX=w.subdivisionsX||1,G._subdivisionsY=w.subdivisionsY||1,G._minX=w.minX,G._maxX=w.maxX,G._minZ=w.Sh,G._maxZ=w.maxZ,G._width=w.width,G._height=w.height,G}}var l=G(11498),i=G(11543),O=G(11681),u=G(11728);function V(w){const E=[],G=[],h=[],B=[];let x,U;const l=w.width||w.size||1,i=w.height||w.size||1,O=0|(w.subdivisionsX||w.subdivisions||1),V=0|(w.subdivisionsY||w.subdivisions||1);for(x=0;x<=V;x++)for(U=0;U<=O;U++){const w=new P.QE(U*l/O-l/2,0,(V-x)*i/V-i/2),E=new P.QE(0,1,0);G.push(w.x,w.y,w.z),h.push(E.x,E.y,E.z),B.push(U/O,u.b?x/V:1-x/V)}for(x=0;x<V;x++)for(U=0;U<O;U++)E.push(U+1+(x+1)*(O+1)),E.push(U+1+x*(O+1)),E.push(U+x*(O+1)),E.push(U+(x+1)*(O+1)),E.push(U+1+(x+1)*(O+1)),E.push(U+x*(O+1));const a=new y.d;return a.indices=E,a.Iw=G,a.jw=h,a.ow=B,a}function a(w){const E=void 0!==w.xmin&&null!==w.xmin?w.xmin:-1,G=void 0!==w.zmin&&null!==w.zmin?w.zmin:-1,h=void 0!==w.xmax&&null!==w.xmax?w.xmax:1,B=void 0!==w.zmax&&null!==w.zmax?w.zmax:1,x=w.subdivisions||{w:1,h:1},U=w.precision||{w:1,h:1},l=[],i=[],O=[],u=[];let V,a,Q,c;x.h=x.h<1?1:x.h,x.w=x.w<1?1:x.w,U.w=U.w<1?1:U.w,U.h=U.h<1?1:U.h;const Z=(h-E)/x.w,J=(B-G)/x.h;function d(w,E,G,h){const B=i.length/3,y=U.w+1;for(V=0;V<U.h;V++)for(a=0;a<U.w;a++){const w=[B+a+V*y,B+(a+1)+V*y,B+(a+1)+(V+1)*y,B+a+(V+1)*y];l.push(w[1]),l.push(w[2]),l.push(w[3]),l.push(w[0]),l.push(w[1]),l.push(w[3])}const x=P.QE.Zero(),Q=new P.QE(0,1,0);for(V=0;V<=U.h;V++)for(x.z=V*(h-E)/U.h+E,a=0;a<=U.w;a++)x.x=a*(G-w)/U.w+w,x.y=0,i.push(x.x,x.y,x.z),O.push(Q.x,Q.y,Q.z),u.push(a/U.w,V/U.h)}for(Q=0;Q<x.h;Q++)for(c=0;c<x.w;c++)d(E+c*Z,G+Q*J,E+(c+1)*Z,G+(Q+1)*J);const K=new y.d;return K.indices=l,K.Iw=i,K.jw=O,K.ow=u,K}function Q(w){const E=[],G=[],B=[],x=[];let U,l;const i=w.colorFilter||new h.dE(.3,.59,.11),u=w.alphaFilter||0;let V=!1;if(w.minHeight>w.maxHeight){V=!0;const E=w.maxHeight;w.maxHeight=w.minHeight,w.minHeight=E}for(U=0;U<=w.subdivisions;U++)for(l=0;l<=w.subdivisions;l++){const E=new P.QE(l*w.width/w.subdivisions-w.width/2,0,(w.subdivisions-U)*w.height/w.subdivisions-w.height/2),h=4*(((E.x+w.width/2)/w.width*(w.bufferWidth-1)|0)+((1-(E.z+w.height/2)/w.height)*(w.bufferHeight-1)|0)*w.bufferWidth);let y=w.buffer[h]/255,a=w.buffer[h+1]/255,Q=w.buffer[h+2]/255;const c=w.buffer[h+3]/255;V&&(y=1-y,a=1-a,Q=1-Q);const Z=y*i.r+a*i.g+Q*i.b;E.y=c>=u?w.minHeight+(w.maxHeight-w.minHeight)*Z:w.minHeight-O.d,w.heightBuffer&&(w.heightBuffer[U*(w.subdivisions+1)+l]=E.y),G.push(E.x,E.y,E.z),B.push(0,0,0),x.push(l/w.subdivisions,1-U/w.subdivisions)}for(U=0;U<w.subdivisions;U++)for(l=0;l<w.subdivisions;l++){const P=l+1+(U+1)*(w.subdivisions+1),h=l+1+U*(w.subdivisions+1),B=l+U*(w.subdivisions+1),y=l+(U+1)*(w.subdivisions+1),x=G[3*P+1]>=w.minHeight,i=G[3*h+1]>=w.minHeight,O=G[3*B+1]>=w.minHeight;x&&i&&O&&(E.push(P),E.push(h),E.push(B));G[3*y+1]>=w.minHeight&&x&&O&&(E.push(y),E.push(P),E.push(B))}y.d.ComputeNormals(G,E,B);const a=new y.d;return a.indices=E,a.Iw=G,a.jw=B,a.ow=x,a}function c(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const G=new U(w,arguments.length>2?arguments[2]:void 0);G._setReady(!1),G._subdivisionsX=E.subdivisionsX||E.subdivisions||1,G._subdivisionsY=E.subdivisionsY||E.subdivisions||1,G._width=E.width||1,G._height=E.height||1,G._maxX=G._width/2,G._maxZ=G._height/2,G._minX=-G._maxX,G._minZ=-G._maxZ;return V(E).kw(G,E.updatable),G._setReady(!0),G}function Z(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new B.c(w,G);return a(E).kw(P,E.updatable),P}function J(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=G.width||10,y=G.height||10,x=G.subdivisions||1,O=G.minHeight||0,u=G.maxHeight||1,V=G.colorFilter||new h.dE(.3,.59,.11),a=G.alphaFilter||0,c=G.updatable,Z=G.onReady;P=P||i.e.LastCreatedScene;const J=new U(w,P);let d;J._subdivisionsX=x,J._subdivisionsY=x,J._width=B,J._height=y,J._maxX=J._width/2,J._maxZ=J._height/2,J._minX=-J._maxX,J._minZ=-J._maxZ,J._setReady(!1),G.passHeightBufferInCallback&&(d=new Float32Array((x+1)*(x+1)));const K=(w,E,G)=>{Q({width:B,height:y,subdivisions:x,minHeight:O,maxHeight:u,colorFilter:V,buffer:w,bufferWidth:E,bufferHeight:G,alphaFilter:a,heightBuffer:d}).kw(J,c),Z&&Z(J,d),J._setReady(!0)};if("string"===typeof E){const w=w=>{var E;const G=w.width,h=w.height;if(P.O)return;const B=null===(E=P)||void 0===E?void 0:E.getEngine().resizeImageBitmap(w,G,h);K(B,G,h)};l.Tools.LoadImage(E,w,G.onError?G.onError:()=>{},P.offlineProvider)}else K(E.data,E.width,E.height);return J}y.d.CreateGround=V,y.d.CreateTiledGround=a,y.d.CreateGroundFromHeightMap=Q,B.c.CreateGround=(w,E,G,P,h,B)=>c(w,{width:E,height:G,subdivisions:P,updatable:B},h),B.c.CreateTiledGround=(w,E,G,P,h,B,y,x,U)=>Z(w,{xmin:E,zmin:G,xmax:P,zmax:h,subdivisions:B,precision:y,updatable:U},x),B.c.CreateGroundFromHeightMap=(w,E,G,P,h,B,y,x,U,l,i)=>J(w,E,{width:G,height:P,subdivisions:h,minHeight:B,maxHeight:y,updatable:U,onReady:l,alphaFilter:i},x)},13456:(w,E,G)=>{"use strict";G.d(E,{b:()=>V,e:()=>O,f:()=>u});var P=G(11679),h=G(12103),B=G(12089),y=G(12197),x=G(11748),U=G(11518);function l(w){const E=[],G=[],P=w.lines,h=w.gw,y=[];let x=0;for(let B=0;B<P.length;B++){const w=P[B];for(let P=0;P<w.length;P++){const{x:U,y:l,z:i}=w[P];if(G.push(U,l,i),h){const w=h[B],{r:E,g:G,b:x,a:U}=w[P];y.push(E,G,x,U)}P>0&&(E.push(x-1),E.push(x)),x++}}const U=new B.d;return U.indices=E,U.Iw=G,h&&(U.gw=y),U}function i(w){const E=w.dashSize||3,G=w.gapSize||1,h=w.dashNb||200,y=w.points,x=[],U=[],l=P.QE.Zero();let i=0,O=0,u=0,V=0,a=0,Q=0,c=0;for(c=0;c<y.length-1;c++)y[c+1].subtractToRef(y[c],l),i+=l.length();for(u=i/h,V=E*u/(E+G),c=0;c<y.length-1;c++){y[c+1].subtractToRef(y[c],l),O=Math.floor(l.length()/u),l.normalize();for(let w=0;w<O;w++)a=u*w,x.push(y[c].x+a*l.x,y[c].y+a*l.y,y[c].z+a*l.z),x.push(y[c].x+(a+V)*l.x,y[c].y+(a+V)*l.y,y[c].z+(a+V)*l.z),U.push(Q,Q+1),Q+=2}const Z=new B.d;return Z.Iw=x,Z.indices=U,Z}function O(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=E.instance,h=E.lines,B=E.gw;if(P){const w=P.getVerticesData(x.g.PositionKind);let E,G;B&&(E=P.getVerticesData(x.g.ColorKind));let y=0,U=0;for(let P=0;P<h.length;P++){const x=h[P];for(let h=0;h<x.length;h++)w[y]=x[h].x,w[y+1]=x[h].y,w[y+2]=x[h].z,B&&E&&(G=B[P],E[U]=G[h].r,E[U+1]=G[h].g,E[U+2]=G[h].b,E[U+3]=G[h].a,U+=4),y+=3}return P.updateVerticesData(x.g.PositionKind,w,!1,!1),B&&E&&P.updateVerticesData(x.g.ColorKind,E,!1,!1),P.refreshBoundingInfo(),P}const U=!!B,i=new y.c(w,G,null,void 0,void 0,U,E.useVertexAlpha,E.material);return l(E).kw(i,E.updatable),i}function u(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=E.gw?[E.gw]:null;return O(w,{lines:[E.points],updatable:E.updatable,instance:E.instance,gw:P,useVertexAlpha:E.useVertexAlpha,material:E.material},G)}function V(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=E.points,x=E.instance,l=E.gapSize||1,O=E.dashSize||3;if(x){const w=w=>{const E=P.QE.Zero(),G=w.length/6;let h=0,y=0,U=0,l=0,i=0,O=0,u=0,V=0;for(u=0;u<B.length-1;u++)B[u+1].subtractToRef(B[u],E),h+=E.length();U=h/G;const a=x._creationDataStorage.dashSize;for(l=a*U/(a+x._creationDataStorage.gapSize),u=0;u<B.length-1;u++)for(B[u+1].subtractToRef(B[u],E),y=Math.floor(E.length()/U),E.normalize(),V=0;V<y&&O<w.length;)i=U*V,w[O]=B[u].x+i*E.x,w[O+1]=B[u].y+i*E.y,w[O+2]=B[u].z+i*E.z,w[O+3]=B[u].x+(i+l)*E.x,w[O+4]=B[u].y+(i+l)*E.y,w[O+5]=B[u].z+(i+l)*E.z,O+=6,V++;for(;O<w.length;)w[O]=B[u].x,w[O+1]=B[u].y,w[O+2]=B[u].z,O+=3};return(E.dashNb||E.dashSize||E.gapSize||E.useVertexAlpha||E.material)&&U.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),x.updateMeshPositions(w,!1),x}const u=new y.c(w,G,null,void 0,void 0,void 0,E.useVertexAlpha,E.material);return i(E).kw(u,E.updatable),u._creationDataStorage=new h.d,u._creationDataStorage.dashSize=O,u._creationDataStorage.gapSize=l,u}B.d.CreateLineSystem=l,B.d.CreateDashedLines=i,h.c.Wl=function(w,E){return u(w,{points:E,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},h.c.CreateDashedLines=function(w,E,G,P,h){return V(w,{points:E,dashSize:G,gapSize:P,dashNb:h,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12879:(w,E,G)=>{"use strict";G.d(E,{b:()=>x,c:()=>U});var P=G(12103),h=G(12089),B=G(11728);function y(w){const E=[],G=[],P=[],y=[],x=void 0!==w.width?w.width:void 0!==w.size?w.size:1,U=void 0!==w.height?w.height:void 0!==w.size?w.size:1,l=0===w.sideOrientation?0:w.sideOrientation||h.d.DEFAULTSIDE,i=x/2,O=U/2;G.push(-i,-O,0),P.push(0,0,-1),y.push(0,B.b?1:0),G.push(i,-O,0),P.push(0,0,-1),y.push(1,B.b?1:0),G.push(i,O,0),P.push(0,0,-1),y.push(1,B.b?0:1),G.push(-i,O,0),P.push(0,0,-1),y.push(0,B.b?0:1),E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),h.d._ComputeSides(l,G,E,P,y,w.frontUVs,w.backUVs);const u=new h.d;return u.indices=E,u.Iw=G,u.jw=P,u.ow=y,u}function x(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new P.c(w,G);E.sideOrientation=P.c._GetDefaultSideOrientation(E.sideOrientation),h._originalBuilderSideOrientation=E.sideOrientation;return y(E).kw(h,E.updatable),E.sourcePlane&&(h.translate(E.sourcePlane.normal,-E.sourcePlane.d),h.setDirection(E.sourcePlane.normal.scale(-1))),h}const U={jl:x};h.d.jl=y,P.c.jl=(w,E,G,P,h)=>x(w,{size:E,width:E,height:E,sideOrientation:h,updatable:P},G)},12961:(w,E,G)=>{"use strict";G.d(E,{e:()=>U});var P=G(11679),h=G(12103),B=G(12089),y=G(11728);function x(w){const E=0|(w.segments||32),G=w.diameterX||w.diameter||1,h=w.diameterY||w.diameter||1,x=w.diameterZ||w.diameter||1,U=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,l=w.slice&&w.slice<=0?1:w.slice||1,i=0===w.sideOrientation?0:w.sideOrientation||B.d.DEFAULTSIDE,O=!!w.dedupTopBottomIndices,u=new P.QE(G/2,h/2,x/2),V=2+E,a=2*V,Q=[],c=[],Z=[],J=[];for(let B=0;B<=V;B++){const w=B/V,E=w*Math.PI*l;for(let G=0;G<=a;G++){const h=G/a,B=h*Math.PI*2*U,x=P.Matrix.RotationZ(-E),l=P.Matrix.RotationY(B),i=P.QE.TransformCoordinates(P.QE.Up(),x),O=P.QE.TransformCoordinates(i,l),V=O.multiply(u),Q=O.divide(u).normalize();c.push(V.x,V.y,V.z),Z.push(Q.x,Q.y,Q.z),J.push(h,y.b?1-w:w)}if(B>0){const w=c.length/3;for(let E=w-2*(a+1);E+a+2<w;E++)O?(B>1&&(Q.push(E),Q.push(E+1),Q.push(E+a+1)),(B<V||l<1)&&(Q.push(E+a+1),Q.push(E+1),Q.push(E+a+2))):(Q.push(E),Q.push(E+1),Q.push(E+a+1),Q.push(E+a+1),Q.push(E+1),Q.push(E+a+2))}}B.d._ComputeSides(i,c,Q,Z,J,w.frontUVs,w.backUVs);const d=new B.d;return d.indices=Q,d.Iw=c,d.jw=Z,d.ow=J,d}function U(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new h.c(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return x(E).kw(P,E.updatable),P}B.d.CreateSphere=x,h.c.CreateSphere=(w,E,G,P,h,B)=>U(w,{segments:E,diameterX:G,diameterY:G,diameterZ:G,sideOrientation:B,updatable:h},P)},13752:(w,E,G)=>{"use strict";G.d(E,{d:()=>x});var P=G(12219),h=G(13261),B=G(12237),y=G(12089);class x{static get Configuration(){return{get decoder(){return h.b.DefaultConfiguration},set decoder(w){h.b.DefaultConfiguration=w}}}static set Configuration(w){h.b.DefaultConfiguration=w.decoder}static get DecoderAvailable(){return(0,P.j)(h.b.DefaultConfiguration)}static get Default(){return x._Default??(x._Default=new x),x._Default}static ResetDefault(w){x._Default&&(w||x._Default.dispose(),x._Default=null)}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.DefaultNumWorkers;const E="number"===typeof w?{...h.b.DefaultConfiguration,numWorkers:w}:{...h.b.DefaultConfiguration,...w};this._decoder=new h.b(E)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(w,E,G){return this._decoder.decodeMeshToMeshDataAsync(w,E,G)}async decodeMeshToGeometryAsync(w,E,G,P){return await this._decoder.decodeMeshToGeometryAsync(w,E,G,P)}async _decodeMeshToGeometryForGltfAsync(w,E,G,P,h,B){return await this._decoder._decodeMeshToGeometryForGltfAsync(w,E,G,P,h,B)}async decodeMeshAsync(w,E){const G=await this._decoder.decodeMeshToMeshDataAsync(w,E),P=new y.d;G.indices&&(P.indices=G.indices);for(const h of G.attributes){const w=B.c.GetFloatData(h.data,h.size,B.c.GetDataType(h.data),h.byteOffset,h.byteStride,h.normalized,G.totalVertices);P.set(w,h.kind)}return P}}x.DefaultNumWorkers=(0,P.g)(),x._Default=null},13261:(w,E,G)=>{"use strict";G.d(E,{b:()=>l});var P=G(12219),h=G(11498),B=G(12118),y=G(12237),x=G(11518),U=G(12235);class l extends P.c{static get DefaultAvailable(){return(0,P.j)(l.DefaultConfiguration)}static get Default(){return l._Default??(l._Default=new l),l._Default}static ResetDefault(w){l._Default&&(w||l._Default.dispose(),l._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(w,E){return{module:await(E||DracoDecoderModule)({wasmBinary:w})}}_getWorkerContent(){return`${U.b}(${U.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.DefaultConfiguration)}decodeMeshToMeshDataAsync(w,E,G){const P=w instanceof ArrayBuffer?new Int8Array(w):new Int8Array(w.buffer,w.byteOffset,w.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async w=>await new Promise(((h,B)=>{w.push(((w,y)=>{let U=null;const l=[],i=E=>{w.removeEventListener("error",i),w.removeEventListener("message",O),B(E),y()},O=E=>{const P=E.data;switch(P.id){case"indices":U=P.data;break;case"attribute":l.push({kind:P.kind,data:P.data,size:P.size,byteOffset:P.byteOffset,byteStride:P.byteStride,normalized:(B=P.kind,u=P.normalized,G&&void 0!==G[B]?(u!==G[B]&&x.e.Warn(`Normalized flag from Draco data (${u}) does not match normalized flag from glTF accessor (${G[B]}). Using flag from glTF accessor.`),G[B]):u)});break;case"decodeMeshDone":w.removeEventListener("error",i),w.removeEventListener("message",O),h({indices:U,attributes:l,totalVertices:P.totalVertices}),y()}var B,u};w.addEventListener("error",i),w.addEventListener("message",O);const u=P.slice();w.postMessage({id:"decodeMesh",dataView:u,attributes:E},[u.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((w=>{let G=null;const h=[],B=(0,U.b)(w.module,P,E,(w=>{G=w}),((w,E,G,P,B,y)=>{h.push({kind:w,data:E,size:G,byteOffset:P,byteStride:B,normalized:y})}));return{indices:G,attributes:h,totalVertices:B}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(w,E,G,P){const h=await this.decodeMeshToMeshDataAsync(G,P),x=new B.d(w,E);h.indices&&x.setIndices(h.indices);for(const B of h.attributes)x.setVerticesBuffer(new y.c(E.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),h.totalVertices);return x}async _decodeMeshToGeometryForGltfAsync(w,E,G,P,h,x){const U=await this.decodeMeshToMeshDataAsync(G,P,h),l=new B.d(w,E);x&&(l._boundingInfo=x,l.useBoundingInfoFromGeometry=!0),U.indices&&l.setIndices(U.indices);for(const B of U.attributes)l.setVerticesBuffer(new y.c(E.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),U.totalVertices);return l}}l.DefaultConfiguration={wasmUrl:`${h.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${h.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${h.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},l._Default=null},13449:(w,E,G)=>{"use strict";G.d(E,{d:()=>xw});var P=G(11679),h=G(12103),B=G(11748),y=G(12089),x=G(11728);function U(w){let E=w.pathArray;const G=w.closeArray||!1,P=w.closePath||!1,h=w.invertUV||!1,U=Math.floor(E[0].length/2);let l=w.offset||U;l=l>U?U:Math.floor(l);const i=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE,O=w.ow,u=w.gw,V=[],a=[],Q=[],c=[],Z=[],J=[],d=[],K=[];let t;const q=[],W=[];let T,I,j;if(E.length<2){const w=[],G=[];for(I=0;I<E[0].length-l;I++)w.push(E[0][I]),G.push(E[0][I+l]);E=[w,G]}let g=0;const o=P?1:0,f=G?1:0;let k,N,v,C,s,F;for(t=E[0].length,T=0;T<E.length+f;T++){for(d[T]=0,Z[T]=[0],k=T===E.length?E[0]:E[T],N=k.length,t=t<N?t:N,j=0;j<N;)V.push(k[j].x,k[j].y,k[j].z),j>0&&(v=k[j].cE(k[j-1]).length(),C=v+d[T],Z[T].push(C),d[T]=C),j++;P&&(j--,V.push(k[0].x,k[0].y,k[0].z),v=k[j].cE(k[0]).length(),C=v+d[T],Z[T].push(C),d[T]=C),q[T]=N+o,W[T]=g,g+=N+o}let M,p,D=null,e=null;for(I=0;I<t+o;I++)for(K[I]=0,J[I]=[0],T=0;T<E.length-1+f;T++)s=E[T],F=T===E.length-1?E[0]:E[T+1],I===t?(D=s[0],e=F[0]):(D=s[I],e=F[I]),v=e.cE(D).length(),C=v+K[I],J[I].push(C),K[I]=C;if(O)for(T=0;T<O.length;T++)c.push(O[T].x,x.b?1-O[T].y:O[T].y);else for(T=0;T<E.length+f;T++)for(I=0;I<t+o;I++)M=0!=d[T]?Z[T][I]/d[T]:0,p=0!=K[I]?J[I][T]/K[I]:0,h?c.push(p,M):c.push(M,x.b?1-p:p);T=0;let R=0,H=q[T]-1,z=q[T+1]-1,L=H<z?H:z,m=W[1]-W[0];const n=q.length-1;for(;R<=L&&T<n;)a.push(R,R+m,R+1),a.push(R+m+1,R+1,R+m),R+=1,R===L&&(T++,m=W[T+1]-W[T],H=q[T]-1,z=q[T+1]-1,R=W[T],L=H<z?H+R:z+R);if(y.d.ComputeNormals(V,a,Q),P){let w=0,G=0;for(T=0;T<E.length;T++){w=3*W[T],G=T+1<E.length?3*(W[T+1]-1):Q.length-3,Q[w]=.5*(Q[w]+Q[G]),Q[w+1]=.5*(Q[w+1]+Q[G+1]),Q[w+2]=.5*(Q[w+2]+Q[G+2]);const P=Math.sqrt(Q[w]*Q[w]+Q[w+1]*Q[w+1]+Q[w+2]*Q[w+2]);Q[w]/=P,Q[w+1]/=P,Q[w+2]/=P,Q[G]=Q[w],Q[G+1]=Q[w+1],Q[G+2]=Q[w+2]}}if(G){let w=3*W[0],G=3*W[E.length];for(I=0;I<t+o;I++){Q[w]=.5*(Q[w]+Q[G]),Q[w+1]=.5*(Q[w+1]+Q[G+1]),Q[w+2]=.5*(Q[w+2]+Q[G+2]);const E=Math.sqrt(Q[w]*Q[w]+Q[w+1]*Q[w+1]+Q[w+2]*Q[w+2]);Q[w]/=E,Q[w+1]/=E,Q[w+2]/=E,Q[G]=Q[w],Q[G+1]=Q[w+1],Q[G+2]=Q[w+2],w+=3,G+=3}}y.d._ComputeSides(i,V,a,Q,c,w.frontUVs,w.backUVs);let r=null;if(u){r=new Float32Array(4*u.length);for(let w=0;w<u.length;w++)r[4*w]=u[w].r,r[4*w+1]=u[w].g,r[4*w+2]=u[w].b,r[4*w+3]=u[w].a}const Y=new y.d,S=new Float32Array(V),X=new Float32Array(Q),b=new Float32Array(c);return Y.indices=a,Y.Iw=S,Y.jw=X,Y.ow=b,r&&Y.set(r,B.g.ColorKind),P&&(Y._idx=W),Y}function l(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=E.pathArray,i=E.closeArray,O=E.closePath,u=h.c._GetDefaultSideOrientation(E.sideOrientation),V=E.instance,a=E.updatable;if(V){const w=P.TmpVectors.QE[0].Wx(Number.MAX_VALUE),G=P.TmpVectors.QE[1].Wx(-Number.MAX_VALUE),U=E=>{let P=l[0].length;const B=V;let y=0;const x=B._originalBuilderSideOrientation===h.c.DOUBLESIDE?2:1;for(let h=1;h<=x;++h)for(let x=0;x<l.length;++x){const h=l[x],U=h.length;P=P<U?P:U;for(let B=0;B<P;++B){const P=h[B];E[y]=P.x,E[y+1]=P.y,E[y+2]=P.z,w.minimizeInPlaceFromFloats(P.x,P.y,P.z),G.maximizeInPlaceFromFloats(P.x,P.y,P.z),y+=3}if(B._creationDataStorage&&B._creationDataStorage.closePath){const w=h[0];E[y]=w.x,E[y+1]=w.y,E[y+2]=w.z,y+=3}}},i=V.getVerticesData(B.g.PositionKind);if(U(i),V.hasBoundingInfo?V.getBoundingInfo().reConstruct(w,G,V._worldMatrix):V.buildBoundingInfo(w,G,V._worldMatrix),V.updateVerticesData(B.g.PositionKind,i,!1,!1),E.gw){const w=V.getVerticesData(B.g.ColorKind);for(let G=0,P=0;G<E.gw.length;G++,P+=4){const h=E.gw[G];w[P]=h.r,w[P+1]=h.g,w[P+2]=h.b,w[P+3]=h.a}V.updateVerticesData(B.g.ColorKind,w,!1,!1)}if(E.ow){const w=V.getVerticesData(B.g.UVKind);for(let G=0;G<E.ow.length;G++)w[2*G]=E.ow[G].x,w[2*G+1]=x.b?1-E.ow[G].y:E.ow[G].y;V.updateVerticesData(B.g.UVKind,w,!1,!1)}if(!V.areNormalsFrozen||V.isFacetDataEnabled){const w=V.ny(),E=V.getVerticesData(B.g.NormalKind),G=V.isFacetDataEnabled?V.getFacetDataParameters():null;if(y.d.ComputeNormals(i,w,E,G),V._creationDataStorage&&V._creationDataStorage.closePath){let w=0,G=0;for(let P=0;P<l.length;P++)w=3*V._creationDataStorage.idx[P],G=P+1<l.length?3*(V._creationDataStorage.idx[P+1]-1):E.length-3,E[w]=.5*(E[w]+E[G]),E[w+1]=.5*(E[w+1]+E[G+1]),E[w+2]=.5*(E[w+2]+E[G+2]),E[G]=E[w],E[G+1]=E[w+1],E[G+2]=E[w+2]}V.areNormalsFrozen||V.updateVerticesData(B.g.NormalKind,E,!1,!1)}return V}{const P=new h.c(w,G);P._originalBuilderSideOrientation=u,P._creationDataStorage=new h.d;const B=U(E);return O&&(P._creationDataStorage.idx=B._idx),P._creationDataStorage.closePath=O,P._creationDataStorage.closeArray=i,B.kw(P,a),P}}y.d.CreateRibbon=U,h.c.CreateRibbon=function(w,E){return l(w,{pathArray:E,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var i=G(12973),O=G(12823),u=G(11716);function V(w){const E=w.pattern||h.c.NO_FLIP,G=w.tileWidth||w.tileSize||1,P=w.tileHeight||w.tileSize||1,B=w.alignHorizontal||0,x=w.alignVertical||0,U=w.width||w.size||1,l=Math.floor(U/G);let i=U-l*G;const O=w.height||w.size||1,u=Math.floor(O/P);let V=O-u*P;const a=G*l/2,Q=P*u/2;let c=0,Z=0,J=0,d=0,K=0,t=0;if(i>0||V>0){switch(J=-a,d=-Q,K=a,t=Q,B){case h.c.CENTER:i/=2,J-=i,K+=i;break;case h.c.LEFT:K+=i,c=-i/2;break;case h.c.RIGHT:J-=i,c=i/2}switch(x){case h.c.CENTER:V/=2,d-=V,t+=V;break;case h.c.BOTTOM:t+=V,Z=-V/2;break;case h.c.TOP:d-=V,Z=V/2}}const q=[],W=[],T=[];T[0]=[0,0,1,0,1,1,0,1],T[1]=[0,0,1,0,1,1,0,1],E!==h.c.ROTATE_TILE&&E!==h.c.ROTATE_ROW||(T[1]=[1,1,0,1,0,0,1,0]),E!==h.c.FLIP_TILE&&E!==h.c.FLIP_ROW||(T[1]=[1,0,0,0,0,1,1,1]),E!==h.c.FLIP_N_ROTATE_TILE&&E!==h.c.FLIP_N_ROTATE_ROW||(T[1]=[0,1,1,1,1,0,0,0]);let I=[];const j=[],g=[];let o=0;for(let y=0;y<u;y++)for(let w=0;w<l;w++)q.push(w*G-a+c,y*P-Q+Z,0),q.push((w+1)*G-a+c,y*P-Q+Z,0),q.push((w+1)*G-a+c,(y+1)*P-Q+Z,0),q.push(w*G-a+c,(y+1)*P-Q+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),I=E===h.c.FLIP_TILE||E===h.c.ROTATE_TILE||E===h.c.FLIP_N_ROTATE_TILE?I.concat(T[(w%2+y%2)%2]):E===h.c.FLIP_ROW||E===h.c.ROTATE_ROW||E===h.c.FLIP_N_ROTATE_ROW?I.concat(T[y%2]):I.concat(T[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),o+=4;if(i>0||V>0){const w=V>0&&(x===h.c.CENTER||x===h.c.TOP),y=V>0&&(x===h.c.CENTER||x===h.c.BOTTOM),U=i>0&&(B===h.c.CENTER||B===h.c.RIGHT),O=i>0&&(B===h.c.CENTER||B===h.c.LEFT);let T,f,k,N,v=[];if(w&&U&&(q.push(J+c,d+Z,0),q.push(-a+c,d+Z,0),q.push(-a+c,d+V+Z,0),q.push(J+c,d+V+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,T=1-i/G,f=1-V/P,k=1,N=1,v=[T,f,k,f,k,N,T,N],E===h.c.ROTATE_ROW&&(v=[1-T,1-f,1-k,1-f,1-k,1-N,1-T,1-N]),E===h.c.FLIP_ROW&&(v=[1-T,f,1-k,f,1-k,N,1-T,N]),E===h.c.FLIP_N_ROTATE_ROW&&(v=[T,1-f,k,1-f,k,1-N,T,1-N]),I=I.concat(v),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&O&&(q.push(a+c,d+Z,0),q.push(K+c,d+Z,0),q.push(K+c,d+V+Z,0),q.push(a+c,d+V+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,T=0,f=1-V/P,k=i/G,N=1,v=[T,f,k,f,k,N,T,N],(E===h.c.ROTATE_ROW||E===h.c.ROTATE_TILE&&l%2===0)&&(v=[1-T,1-f,1-k,1-f,1-k,1-N,1-T,1-N]),(E===h.c.FLIP_ROW||E===h.c.FLIP_TILE&&l%2===0)&&(v=[1-T,f,1-k,f,1-k,N,1-T,N]),(E===h.c.FLIP_N_ROTATE_ROW||E===h.c.FLIP_N_ROTATE_TILE&&l%2===0)&&(v=[T,1-f,k,1-f,k,1-N,T,1-N]),I=I.concat(v),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&U&&(q.push(J+c,Q+Z,0),q.push(-a+c,Q+Z,0),q.push(-a+c,t+Z,0),q.push(J+c,t+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,T=1-i/G,f=0,k=1,N=V/P,v=[T,f,k,f,k,N,T,N],(E===h.c.ROTATE_ROW&&u%2===1||E===h.c.ROTATE_TILE&&u%1===0)&&(v=[1-T,1-f,1-k,1-f,1-k,1-N,1-T,1-N]),(E===h.c.FLIP_ROW&&u%2===1||E===h.c.FLIP_TILE&&u%2===0)&&(v=[1-T,f,1-k,f,1-k,N,1-T,N]),(E===h.c.FLIP_N_ROTATE_ROW&&u%2===1||E===h.c.FLIP_N_ROTATE_TILE&&u%2===0)&&(v=[T,1-f,k,1-f,k,1-N,T,1-N]),I=I.concat(v),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&O&&(q.push(a+c,Q+Z,0),q.push(K+c,Q+Z,0),q.push(K+c,t+Z,0),q.push(a+c,t+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,T=0,f=0,k=i/G,N=V/P,v=[T,f,k,f,k,N,T,N],(E===h.c.ROTATE_ROW&&u%2===1||E===h.c.ROTATE_TILE&&(u+l)%2===1)&&(v=[1-T,1-f,1-k,1-f,1-k,1-N,1-T,1-N]),(E===h.c.FLIP_ROW&&u%2===1||E===h.c.FLIP_TILE&&(u+l)%2===1)&&(v=[1-T,f,1-k,f,1-k,N,1-T,N]),(E===h.c.FLIP_N_ROTATE_ROW&&u%2===1||E===h.c.FLIP_N_ROTATE_TILE&&(u+l)%2===1)&&(v=[T,1-f,k,1-f,k,1-N,T,1-N]),I=I.concat(v),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w){const w=[];T=0,f=1-V/P,k=1,N=1,w[0]=[T,f,k,f,k,N,T,N],w[1]=[T,f,k,f,k,N,T,N],E!==h.c.ROTATE_TILE&&E!==h.c.ROTATE_ROW||(w[1]=[1-T,1-f,1-k,1-f,1-k,1-N,1-T,1-N]),E!==h.c.FLIP_TILE&&E!==h.c.FLIP_ROW||(w[1]=[1-T,f,1-k,f,1-k,N,1-T,N]),E!==h.c.FLIP_N_ROTATE_TILE&&E!==h.c.FLIP_N_ROTATE_ROW||(w[1]=[T,1-f,k,1-f,k,1-N,T,1-N]);for(let P=0;P<l;P++)q.push(P*G-a+c,d+Z,0),q.push((P+1)*G-a+c,d+Z,0),q.push((P+1)*G-a+c,d+V+Z,0),q.push(P*G-a+c,d+V+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,I=E===h.c.FLIP_TILE||E===h.c.ROTATE_TILE||E===h.c.FLIP_N_ROTATE_TILE?I.concat(w[(P+1)%2]):E===h.c.FLIP_ROW||E===h.c.ROTATE_ROW||E===h.c.FLIP_N_ROTATE_ROW?I.concat(w[1]):I.concat(w[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const w=[];T=0,f=0,k=1,N=V/P,w[0]=[T,f,k,f,k,N,T,N],w[1]=[T,f,k,f,k,N,T,N],E!==h.c.ROTATE_TILE&&E!==h.c.ROTATE_ROW||(w[1]=[1-T,1-f,1-k,1-f,1-k,1-N,1-T,1-N]),E!==h.c.FLIP_TILE&&E!==h.c.FLIP_ROW||(w[1]=[1-T,f,1-k,f,1-k,N,1-T,N]),E!==h.c.FLIP_N_ROTATE_TILE&&E!==h.c.FLIP_N_ROTATE_ROW||(w[1]=[T,1-f,k,1-f,k,1-N,T,1-N]);for(let P=0;P<l;P++)q.push(P*G-a+c,t-V+Z,0),q.push((P+1)*G-a+c,t-V+Z,0),q.push((P+1)*G-a+c,t+Z,0),q.push(P*G-a+c,t+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,I=E===h.c.FLIP_TILE||E===h.c.ROTATE_TILE||E===h.c.FLIP_N_ROTATE_TILE?I.concat(w[(P+u)%2]):E===h.c.FLIP_ROW||E===h.c.ROTATE_ROW||E===h.c.FLIP_N_ROTATE_ROW?I.concat(w[u%2]):I.concat(w[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const w=[];T=1-i/G,f=0,k=1,N=1,w[0]=[T,f,k,f,k,N,T,N],w[1]=[T,f,k,f,k,N,T,N],E!==h.c.ROTATE_TILE&&E!==h.c.ROTATE_ROW||(w[1]=[1-T,1-f,1-k,1-f,1-k,1-N,1-T,1-N]),E!==h.c.FLIP_TILE&&E!==h.c.FLIP_ROW||(w[1]=[1-T,f,1-k,f,1-k,N,1-T,N]),E!==h.c.FLIP_N_ROTATE_TILE&&E!==h.c.FLIP_N_ROTATE_ROW||(w[1]=[T,1-f,k,1-f,k,1-N,T,1-N]);for(let G=0;G<u;G++)q.push(J+c,G*P-Q+Z,0),q.push(J+i+c,G*P-Q+Z,0),q.push(J+i+c,(G+1)*P-Q+Z,0),q.push(J+c,(G+1)*P-Q+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,I=E===h.c.FLIP_TILE||E===h.c.ROTATE_TILE||E===h.c.FLIP_N_ROTATE_TILE?I.concat(w[(G+1)%2]):E===h.c.FLIP_ROW||E===h.c.ROTATE_ROW||E===h.c.FLIP_N_ROTATE_ROW?I.concat(w[G%2]):I.concat(w[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){const w=[];T=0,f=0,k=i/P,N=1,w[0]=[T,f,k,f,k,N,T,N],w[1]=[T,f,k,f,k,N,T,N],E!==h.c.ROTATE_TILE&&E!==h.c.ROTATE_ROW||(w[1]=[1-T,1-f,1-k,1-f,1-k,1-N,1-T,1-N]),E!==h.c.FLIP_TILE&&E!==h.c.FLIP_ROW||(w[1]=[1-T,f,1-k,f,1-k,N,1-T,N]),E!==h.c.FLIP_N_ROTATE_TILE&&E!==h.c.FLIP_N_ROTATE_ROW||(w[1]=[T,1-f,k,1-f,k,1-N,T,1-N]);for(let G=0;G<u;G++)q.push(K-i+c,G*P-Q+Z,0),q.push(K+c,G*P-Q+Z,0),q.push(K+c,(G+1)*P-Q+Z,0),q.push(K-i+c,(G+1)*P-Q+Z,0),g.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,I=E===h.c.FLIP_TILE||E===h.c.ROTATE_TILE||E===h.c.FLIP_N_ROTATE_TILE?I.concat(w[(G+l)%2]):E===h.c.FLIP_ROW||E===h.c.ROTATE_ROW||E===h.c.FLIP_N_ROTATE_ROW?I.concat(w[G%2]):I.concat(w[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const f=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE;y.d._ComputeSides(f,q,g,W,I,w.frontUVs,w.backUVs);const k=new y.d;k.indices=g,k.Iw=q,k.jw=W,k.ow=I;const N=f===y.d.DOUBLESIDE?j.concat(j):j;return k.gw=N,k}function a(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new h.c(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return V(E).kw(P,E.updatable),P}function Q(w){const E=w.faceUV||new Array(6),G=w.faceColors,B=w.pattern||h.c.NO_FLIP,U=w.width||w.size||1,l=w.height||w.size||1,i=w.depth||w.size||1,O=w.tileWidth||w.tileSize||1,a=w.tileHeight||w.tileSize||1,Q=w.alignHorizontal||0,c=w.alignVertical||0,Z=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE;for(let h=0;h<6;h++)void 0===E[h]&&(E[h]=new P.Vector4(0,0,1,1)),G&&void 0===G[h]&&(G[h]=new u.Tx(1,1,1,1));const J=U/2,d=l/2,K=i/2,t=[];for(let P=0;P<2;P++)t[P]=V({pattern:B,tileWidth:O,tileHeight:a,width:U,height:l,alignVertical:c,alignHorizontal:Q,sideOrientation:Z});for(let P=2;P<4;P++)t[P]=V({pattern:B,tileWidth:O,tileHeight:a,width:i,height:l,alignVertical:c,alignHorizontal:Q,sideOrientation:Z});let q=c;c===h.c.BOTTOM?q=h.c.TOP:c===h.c.TOP&&(q=h.c.BOTTOM);for(let P=4;P<6;P++)t[P]=V({pattern:B,tileWidth:O,tileHeight:a,width:U,height:i,alignVertical:q,alignHorizontal:Q,sideOrientation:Z});let W=[],T=[],I=[],j=[];const g=[],o=[],f=[],k=[];let N=0,v=0;for(let h=0;h<6;h++){const w=t[h].Iw.length;o[h]=[],f[h]=[];for(let E=0;E<w/3;E++)o[h].push(new P.QE(t[h].Iw[3*E],t[h].Iw[3*E+1],t[h].Iw[3*E+2])),f[h].push(new P.QE(t[h].jw[3*E],t[h].jw[3*E+1],t[h].jw[3*E+2]));N=t[h].ow.length,k[h]=[];for(let G=0;G<N;G+=2)k[h][G]=E[h].x+(E[h].z-E[h].x)*t[h].ow[G],k[h][G+1]=E[h].y+(E[h].w-E[h].y)*t[h].ow[G+1],x.b&&(k[h][G+1]=1-k[h][G+1]);if(I=I.concat(k[h]),j=j.concat(t[h].indices.map((w=>w+v))),v+=o[h].length,G)for(let E=0;E<4;E++)g.push(G[h].r,G[h].g,G[h].b,G[h].a)}const C=new P.QE(0,0,K),s=P.Matrix.RotationY(Math.PI);W=o[0].map((w=>P.QE.TransformNormal(w,s).add(C))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[]),T=f[0].map((w=>P.QE.TransformNormal(w,s))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[]),W=W.concat(o[1].map((w=>w.cE(C))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[])),T=T.concat(f[1].map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[]));const F=new P.QE(J,0,0),M=P.Matrix.RotationY(-Math.PI/2);W=W.concat(o[2].map((w=>P.QE.TransformNormal(w,M).add(F))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[])),T=T.concat(f[2].map((w=>P.QE.TransformNormal(w,M))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[]));const p=P.Matrix.RotationY(Math.PI/2);W=W.concat(o[3].map((w=>P.QE.TransformNormal(w,p).cE(F))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[])),T=T.concat(f[3].map((w=>P.QE.TransformNormal(w,p))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[]));const D=new P.QE(0,d,0),e=P.Matrix.RotationX(Math.PI/2);W=W.concat(o[4].map((w=>P.QE.TransformNormal(w,e).add(D))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[])),T=T.concat(f[4].map((w=>P.QE.TransformNormal(w,e))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[]));const R=P.Matrix.RotationX(-Math.PI/2);W=W.concat(o[5].map((w=>P.QE.TransformNormal(w,R).cE(D))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[])),T=T.concat(f[5].map((w=>P.QE.TransformNormal(w,R))).map((w=>[w.x,w.y,w.z])).reduce(((w,E)=>w.concat(E)),[])),y.d._ComputeSides(Z,W,j,T,I);const H=new y.d;if(H.indices=j,H.Iw=W,H.jw=T,H.ow=I,G){const w=Z===y.d.DOUBLESIDE?g.concat(g):g;H.gw=w}return H}function c(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new h.c(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return Q(E).kw(P,E.updatable),P}y.d.CreateTiledPlane=V;y.d.CreateTiledBox=Q;var Z=G(12961),J=G(11908),d=G(11870);function K(w){const E=w.height||2;let G=0===w.diameterTop?0:w.diameterTop||w.diameter||1,B=0===w.diameterBottom?0:w.diameterBottom||w.diameter||1;G=G||1e-5,B=B||1e-5;const U=0|(w.tessellation||24),l=0|(w.subdivisions||1),i=!!w.hasRings,O=!!w.enclose,V=0===w.cap?0:w.cap||h.c.CAP_ALL,a=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,Q=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE,c=w.faceUV||new Array(3),Z=w.faceColors,J=2+(1+(1!==a&&O?2:0))*(i?l:1);let K;for(K=0;K<J;K++)Z&&void 0===Z[K]&&(Z[K]=new u.Tx(1,1,1,1));for(K=0;K<J;K++)c&&void 0===c[K]&&(c[K]=new P.Vector4(0,0,1,1));const t=[],q=[],W=[],T=[],I=[],j=2*Math.PI*a/U;let g,o,f;const k=(B-G)/2/E,N=P.QE.Zero(),v=P.QE.Zero(),C=P.QE.Zero(),s=P.QE.Zero(),F=P.QE.Zero(),M=d.d.Y;let p,D,e,R=1,H=1,z=0,L=0;for(p=0;p<=l;p++)for(o=p/l,f=(o*(G-B)+B)/2,R=i&&0!==p&&p!==l?2:1,e=0;e<R;e++){for(i&&(H+=e),O&&(H+=2*e),D=0;D<=U;D++)g=D*j,N.x=Math.cos(-g)*f,N.y=-E/2+o*E,N.z=Math.sin(-g)*f,0===G&&p===l?(v.x=W[W.length-3*(U+1)],v.y=W[W.length-3*(U+1)+1],v.z=W[W.length-3*(U+1)+2]):(v.x=N.x,v.z=N.z,v.y=Math.sqrt(v.x*v.x+v.z*v.z)*k,v.normalize()),0===D&&(C.B(N),s.B(v)),q.push(N.x,N.y,N.z),W.push(v.x,v.y,v.z),L=i?z!==H?c[H].y:c[H].w:c[H].y+(c[H].w-c[H].y)*o,T.push(c[H].x+(c[H].z-c[H].x)*D/U,x.b?1-L:L),Z&&I.push(Z[H].r,Z[H].g,Z[H].b,Z[H].a);1!==a&&O&&(q.push(N.x,N.y,N.z),q.push(0,N.y,0),q.push(0,N.y,0),q.push(C.x,C.y,C.z),P.QE.CrossToRef(M,v,F),F.normalize(),W.push(F.x,F.y,F.z,F.x,F.y,F.z),P.QE.CrossToRef(s,M,F),F.normalize(),W.push(F.x,F.y,F.z,F.x,F.y,F.z),L=i?z!==H?c[H+1].y:c[H+1].w:c[H+1].y+(c[H+1].w-c[H+1].y)*o,T.push(c[H+1].x,x.b?1-L:L),T.push(c[H+1].z,x.b?1-L:L),L=i?z!==H?c[H+2].y:c[H+2].w:c[H+2].y+(c[H+2].w-c[H+2].y)*o,T.push(c[H+2].x,x.b?1-L:L),T.push(c[H+2].z,x.b?1-L:L),Z&&(I.push(Z[H+1].r,Z[H+1].g,Z[H+1].b,Z[H+1].a),I.push(Z[H+1].r,Z[H+1].g,Z[H+1].b,Z[H+1].a),I.push(Z[H+2].r,Z[H+2].g,Z[H+2].b,Z[H+2].a),I.push(Z[H+2].r,Z[H+2].g,Z[H+2].b,Z[H+2].a))),z!==H&&(z=H)}const m=1!==a&&O?U+4:U;for(p=0,H=0;H<l;H++){let w=0,E=0,G=0,P=0;for(D=0;D<U;D++)w=p*(m+1)+D,E=(p+1)*(m+1)+D,G=p*(m+1)+(D+1),P=(p+1)*(m+1)+(D+1),t.push(w,E,G),t.push(P,G,E);1!==a&&O&&(t.push(w+2,E+2,G+2),t.push(P+2,G+2,E+2),t.push(w+4,E+4,G+4),t.push(P+4,G+4,E+4)),p=i?p+2:p+1}const n=w=>{const h=w?G/2:B/2;if(0===h)return;let y,l,i;const O=w?c[J-1]:c[0];let u=null;Z&&(u=w?Z[J-1]:Z[0]);const V=q.length/3,Q=w?E/2:-E/2,d=new P.QE(0,Q,0);q.push(d.x,d.y,d.z),W.push(0,w?1:-1,0);const K=O.y+.5*(O.w-O.y);T.push(O.x+.5*(O.z-O.x),x.b?1-K:K),u&&I.push(u.r,u.g,u.b,u.a);const j=new P.Vector2(.5,.5);for(i=0;i<=U;i++){y=2*Math.PI*i*a/U;const E=Math.cos(-y),G=Math.sin(-y);l=new P.QE(E*h,Q,G*h);const B=new P.Vector2(E*j.x+.5,G*j.y+.5);q.push(l.x,l.y,l.z),W.push(0,w?1:-1,0);const V=O.y+(O.w-O.y)*B.y;T.push(O.x+(O.z-O.x)*B.x,x.b?1-V:V),u&&I.push(u.r,u.g,u.b,u.a)}for(i=0;i<U;i++)w?(t.push(V),t.push(V+(i+2)),t.push(V+(i+1))):(t.push(V),t.push(V+(i+1)),t.push(V+(i+2)))};V!==h.c.CAP_START&&V!==h.c.CAP_ALL||n(!1),V!==h.c.CAP_END&&V!==h.c.CAP_ALL||n(!0),y.d._ComputeSides(Q,q,t,W,T,w.frontUVs,w.backUVs);const r=new y.d;return r.indices=t,r.Iw=q,r.jw=W,r.ow=T,Z&&(r.gw=I),r}function t(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;const P=new h.c(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return K(E).kw(P,E.updatable),P}function q(w){const E=[],G=[],h=[],B=[],U=w.diameter||1,l=w.thickness||.5,i=0|(w.tessellation||16),O=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE,u=i+1;for(let y=0;y<=i;y++){const w=y/i,O=y*Math.PI*2/i-Math.PI/2,V=P.Matrix.Translation(U/2,0,0).multiply(P.Matrix.RotationY(O));for(let U=0;U<=i;U++){const O=1-U/i,a=U*Math.PI*2/i+Math.PI,Q=Math.cos(a),c=Math.sin(a);let Z=new P.QE(Q,c,0),J=Z.scale(l/2);const d=new P.Vector2(w,O);J=P.QE.TransformCoordinates(J,V),Z=P.QE.TransformNormal(Z,V),G.push(J.x,J.y,J.z),h.push(Z.x,Z.y,Z.z),B.push(d.x,x.b?1-d.y:d.y);const K=(y+1)%u,t=(U+1)%u;E.push(y*u+U),E.push(y*u+t),E.push(K*u+U),E.push(y*u+t),E.push(K*u+t),E.push(K*u+U)}}y.d._ComputeSides(O,G,E,h,B,w.frontUVs,w.backUVs);const V=new y.d;return V.indices=E,V.Iw=G,V.jw=h,V.ow=B,V}function W(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;const P=new h.c(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return q(E).kw(P,E.updatable),P}y.d.CreateCylinder=K,h.c.CreateCylinder=(w,E,G,P,B,y,x,U,l)=>{void 0!==x&&x instanceof J.d||(void 0!==x&&(l=U||h.c.DEFAULTSIDE,U=x),x=y,y=1);return t(w,{height:E,diameterTop:G,diameterBottom:P,tessellation:B,subdivisions:y,sideOrientation:l,updatable:U},x)};function T(w){const E=[],G=[],h=[],B=[],U=w.radius||2,l=w.tube||.5,i=w.radialSegments||32,O=w.tubularSegments||32,u=w.p||2,V=w.q||3,a=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE,Q=w=>{const E=Math.cos(w),G=Math.sin(w),h=V/u*w,B=Math.cos(h),y=U*(2+B)*.5*E,x=U*(2+B)*G*.5,l=U*Math.sin(h)*.5;return new P.QE(y,x,l)};let c,Z;for(c=0;c<=i;c++){const w=c%i/i*2*u*Math.PI,E=Q(w),h=Q(w+.01),y=h.cE(E);let U=h.add(E);const V=P.QE.Cross(y,U);for(U=P.QE.Cross(V,y),V.normalize(),U.normalize(),Z=0;Z<O;Z++){const w=Z%O/O*2*Math.PI,P=-l*Math.cos(w),h=l*Math.sin(w);G.push(E.x+P*U.x+h*V.x),G.push(E.y+P*U.y+h*V.y),G.push(E.z+P*U.z+h*V.z),B.push(c/i),B.push(x.b?1-Z/O:Z/O)}}for(c=0;c<i;c++)for(Z=0;Z<O;Z++){const w=(Z+1)%O,G=c*O+Z,P=(c+1)*O+Z,h=(c+1)*O+w,B=c*O+w;E.push(B),E.push(P),E.push(G),E.push(B),E.push(h),E.push(P)}y.d.ComputeNormals(G,E,h),y.d._ComputeSides(a,G,E,h,B,w.frontUVs,w.backUVs);const J=new y.d;return J.indices=E,J.Iw=G,J.jw=h,J.ow=B,J}function I(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;const P=new h.c(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return T(E).kw(P,E.updatable),P}y.d.CreateTorus=q,h.c.CreateTorus=(w,E,G,P,h,B,y)=>W(w,{diameter:E,thickness:G,tessellation:P,sideOrientation:y,updatable:B},h);y.d.CreateTorusKnot=T,h.c.CreateTorusKnot=(w,E,G,P,h,B,y,x,U,l)=>I(w,{radius:E,tube:G,radialSegments:P,tubularSegments:h,p:B,q:y,sideOrientation:l,updatable:U},x);var j=G(13456),g=G(12209),o=G(11874);function f(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=E.path,B=E.shape,y=E.scale||1,x=E.rotation||0,U=0===E.cap?0:E.cap||h.c.NO_CAP,l=E.updatable,i=h.c._GetDefaultSideOrientation(E.sideOrientation),O=E.instance||null,u=E.invertUV||!1,V=E.closeShape||!1,a=E.closePath||!1,Q=E.capFunction||null;return N(w,B,P,y,x,null,null,a,V,U,!1,G,!!l,i,O,u,E.frontUVs||null,E.backUVs||null,E.firstNormal||null,!!E.adjustFrame,Q)}function k(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=E.path,B=E.shape,y=E.scaleFunction||(()=>1),x=E.rotationFunction||(()=>0),U=E.closePath||E.ribbonCloseArray||!1,l=E.closeShape||E.ribbonClosePath||!1,i=0===E.cap?0:E.cap||h.c.NO_CAP,O=E.updatable,u=E.firstNormal||null,V=E.adjustFrame||!1,a=h.c._GetDefaultSideOrientation(E.sideOrientation),Q=E.instance,c=E.invertUV||!1,Z=E.capFunction||null;return N(w,B,P,null,null,y,x,U,l,i,!0,G,!!O,a,Q||null,c,E.frontUVs||null,E.backUVs||null,u,V,Z||null)}function N(w,E,G,B,y,x,U,i,O,u,V,a,Q,c,Z,J,d,K,t,q,W){const T=(w,E,G,B,y,x,U,l,i,O,u)=>{const V=G.getTangents(),a=G.getNormals(),Q=G.getBinormals(),c=G.getDistances();if(u)for(let h=0;h<V.length;h++)if(0==V[h].x&&0==V[h].y&&0==V[h].z&&V[h].B(V[h-1]),0==a[h].x&&0==a[h].y&&0==a[h].z&&a[h].B(a[h-1]),0==Q[h].x&&0==Q[h].y&&0==Q[h].z&&Q[h].B(Q[h-1]),h>0){let w=V[h-1];P.QE.Dot(w,V[h])<0&&V[h].scaleInPlace(-1),w=a[h-1],P.QE.Dot(w,a[h])<0&&a[h].scaleInPlace(-1),w=Q[h-1],P.QE.Dot(w,Q[h])<0&&Q[h].scaleInPlace(-1)}let Z=0;const J=O&&l?l:()=>null!==x?x:0,d=O&&U?U:()=>null!==y?y:1;let K=i===h.c.NO_CAP||i===h.c.CAP_END?0:2;const t=P.TmpVectors.Matrix[0];for(let h=0;h<E.length;h++){const G=[],y=J(h,c[h]),x=d(h,c[h]);P.Matrix.RotationAxisToRef(V[h],Z,t);for(let B=0;B<w.length;B++){const y=V[h].scale(w[B].z).add(a[h].scale(w[B].x)).add(Q[h].scale(w[B].y)),U=P.QE.Zero();P.QE.TransformCoordinatesToRef(y,t,U),U.scaleInPlace(x).addInPlace(E[h]),G[B]=U}B[K]=G,Z+=y,K++}const q=W||(w=>{const E=Array(),G=P.QE.Zero();let h;for(h=0;h<w.length;h++)G.addInPlace(w[h]);for(G.scaleInPlace(1/w.length),h=0;h<w.length;h++)E.push(G);return E});switch(i){case h.c.NO_CAP:break;case h.c.CAP_START:B[0]=q(B[2]),B[1]=B[2];break;case h.c.CAP_END:B[K]=B[K-1],B[K+1]=q(B[K-1]);break;case h.c.CAP_ALL:B[0]=q(B[2]),B[1]=B[2],B[K]=B[K-1],B[K+1]=q(B[K-1])}return B};let I,j;if(Z){const w=Z._creationDataStorage;return I=t?w.path3D.update(G,t):w.path3D.update(G),j=T(E,G,w.path3D,w.pathArray,B,y,x,U,w.cap,V,q),Z=l("",{pathArray:j,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:Z},a||void 0)}I=t?new o.o(G,t):new o.o(G);j=T(E,G,I,new Array,B,y,x,U,u=u<0||u>3?0:u,V,q);const g=l(w,{pathArray:j,closeArray:i,closePath:O,updatable:Q,sideOrientation:c,invertUV:J,frontUVs:d||void 0,backUVs:K||void 0},a);return g._creationDataStorage.pathArray=j,g._creationDataStorage.path3D=I,g._creationDataStorage.cap=u,g}function v(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=E.arc?E.arc<=0||E.arc>1?1:E.arc:1,y=void 0===E.closed||E.closed,x=E.shape,U=E.radius||1,i=E.tessellation||64,O=E.clip||0,u=E.updatable,V=h.c._GetDefaultSideOrientation(E.sideOrientation),a=E.cap||h.c.NO_CAP,Q=2*Math.PI,c=[],Z=E.invertUV||!1;let J=0,d=0;const K=Q/i*B;let t,q;for(J=0;J<=i-O;J++){for(q=[],a!=h.c.CAP_START&&a!=h.c.CAP_ALL||(q.push(new P.QE(0,x[0].y,0)),q.push(new P.QE(Math.cos(J*K)*x[0].x*U,x[0].y,Math.sin(J*K)*x[0].x*U))),d=0;d<x.length;d++)t=new P.QE(Math.cos(J*K)*x[d].x*U,x[d].y,Math.sin(J*K)*x[d].x*U),q.push(t);a!=h.c.CAP_END&&a!=h.c.CAP_ALL||(q.push(new P.QE(Math.cos(J*K)*x[x.length-1].x*U,x[x.length-1].y,Math.sin(J*K)*x[x.length-1].x*U)),q.push(new P.QE(0,x[x.length-1].y,0))),c.push(q)}return l(w,{pathArray:c,closeArray:y,sideOrientation:V,updatable:u,invertUV:Z,frontUVs:E.frontUVs,backUVs:E.backUVs},G)}h.c.ExtrudeShape=function(w,E,G,P,B,y){let x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,i=arguments.length>9?arguments[9]:void 0;return f(w,{shape:E,path:G,scale:P,rotation:B,cap:0===y?0:y||h.c.NO_CAP,sideOrientation:l,instance:i,updatable:U},x)},h.c.ExtrudeShapeCustom=(w,E,G,P,B,y,x,U,l,i,O,u)=>k(w,{shape:E,path:G,scaleFunction:P,rotationFunction:B,ribbonCloseArray:y,ribbonClosePath:x,cap:0===U?0:U||h.c.NO_CAP,sideOrientation:O,instance:u,updatable:i},l);h.c.CreateLathe=(w,E,G,P,h,B,y)=>v(w,{shape:E,radius:G,tessellation:P,sideOrientation:y,updatable:B},h);var C=G(12879),s=G(12825);function F(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=E.path;let y=E.instance,x=1;void 0!==E.radius?x=E.radius:y&&(x=y._creationDataStorage.radius);const U=E.tessellation||64,i=E.radiusFunction||null;let O=E.cap||h.c.NO_CAP;const u=E.invertUV||!1,V=E.updatable,a=h.c._GetDefaultSideOrientation(E.sideOrientation);E.arc=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1;const Q=(w,E,G,B,y,x,U,l)=>{const i=E.getTangents(),O=E.getNormals(),u=E.getDistances(),V=2*Math.PI/y*l,a=x||(()=>B);let Q,c,Z,J;const d=P.TmpVectors.Matrix[0];let K=U===h.c.NO_CAP||U===h.c.CAP_END?0:2;for(let h=0;h<w.length;h++){c=a(h,u[h]),Q=Array(),Z=O[h];for(let E=0;E<y;E++)P.Matrix.RotationAxisToRef(i[h],V*E,d),J=Q[E]?Q[E]:P.QE.Zero(),P.QE.TransformCoordinatesToRef(Z,d,J),J.scaleInPlace(c).addInPlace(w[h]),Q[E]=J;G[K]=Q,K++}const t=(E,G)=>{const P=Array();for(let h=0;h<E;h++)P.push(w[G]);return P};switch(U){case h.c.NO_CAP:break;case h.c.CAP_START:G[0]=t(y,0),G[1]=G[2].slice(0);break;case h.c.CAP_END:G[K]=G[K-1].slice(0),G[K+1]=t(y,w.length-1);break;case h.c.CAP_ALL:G[0]=t(y,0),G[1]=G[2].slice(0),G[K]=G[K-1].slice(0),G[K+1]=t(y,w.length-1)}return G};let c,Z;if(y){const w=y._creationDataStorage,G=E.arc||w.arc;return c=w.path3D.update(B),Z=Q(B,c,w.pathArray,x,w.tessellation,i,w.cap,G),y=l("",{pathArray:Z,instance:y}),w.path3D=c,w.pathArray=Z,w.arc=G,w.radius=x,y}c=new o.o(B);O=O<0||O>3?0:O,Z=Q(B,c,new Array,x,U,i,O,E.arc);const J=l(w,{pathArray:Z,closePath:!0,closeArray:!1,updatable:V,sideOrientation:a,invertUV:u,frontUVs:E.frontUVs,backUVs:E.backUVs},G);return J._creationDataStorage.pathArray=Z,J._creationDataStorage.path3D=c,J._creationDataStorage.tessellation=U,J._creationDataStorage.cap=O,J._creationDataStorage.arc=E.arc,J._creationDataStorage.radius=x,J}function M(w){const E=[];E[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},E[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},E[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},E[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},E[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},E[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},E[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},E[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},E[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},E[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},E[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},E[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},E[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},E[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},E[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const G=w.type&&(w.type<0||w.type>=E.length)?0:w.type||0,h=w.size,B=w.sizeX||h||1,U=w.sizeY||h||1,l=w.sizeZ||h||1,i=w.custom||E[G],O=i.face.length,V=w.faceUV||new Array(O),a=w.faceColors,Q=void 0===w.flat||w.flat,c=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE,Z=[],J=[],d=[],K=[],t=[];let q=0,W=0;const T=[];let I,j,g,o,f,k,N=0,v=0;if(Q)for(v=0;v<O;v++)a&&void 0===a[v]&&(a[v]=new u.Tx(1,1,1,1)),V&&void 0===V[v]&&(V[v]=new P.Vector4(0,0,1,1));if(Q)for(v=0;v<O;v++){const w=i.face[v].length;for(g=2*Math.PI/w,o=.5*Math.tan(g/2),f=.5,N=0;N<w;N++)Z.push(i.vertex[i.face[v][N]][0]*B,i.vertex[i.face[v][N]][1]*U,i.vertex[i.face[v][N]][2]*l),T.push(q),q++,I=V[v].x+(V[v].z-V[v].x)*(.5+o),j=V[v].y+(V[v].w-V[v].y)*(f-.5),K.push(I,x.b?1-j:j),k=o*Math.cos(g)-f*Math.sin(g),f=o*Math.sin(g)+f*Math.cos(g),o=k,a&&t.push(a[v].r,a[v].g,a[v].b,a[v].a);for(N=0;N<w-2;N++)J.push(T[0+W],T[N+2+W],T[N+1+W]);W+=w}else{for(N=0;N<i.vertex.length;N++)Z.push(i.vertex[N][0]*B,i.vertex[N][1]*U,i.vertex[N][2]*l),K.push(0,x.b?1:0);for(v=0;v<O;v++)for(N=0;N<i.face[v].length-2;N++)J.push(i.face[v][0],i.face[v][N+2],i.face[v][N+1])}y.d.ComputeNormals(Z,J,d),y.d._ComputeSides(c,Z,J,d,K,w.frontUVs,w.backUVs);const C=new y.d;return C.Iw=Z,C.indices=J,C.jw=d,C.ow=K,a&&Q&&(C.gw=t),C}function p(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new h.c(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return M(E).kw(P,E.updatable),P}h.c.CreateTube=(w,E,G,P,h,B,y,x,U,l)=>F(w,{path:E,radius:G,tessellation:P,radiusFunction:h,arc:1,cap:B,updatable:x,sideOrientation:U,instance:l},y);function D(w){const E=w.sideOrientation||y.d.DEFAULTSIDE,G=w.radius||1,h=void 0===w.flat||w.flat,B=0|(w.subdivisions||4),U=w.radiusX||G,l=w.radiusY||G,i=w.radiusZ||G,O=(1+Math.sqrt(5))/2,u=[-1,O,-0,1,O,0,-1,-O,0,1,-O,0,0,-1,-O,0,1,-O,0,-1,O,0,1,O,O,0,1,O,0,-1,-O,0,1,-O,0,-1],V=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],a=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Q=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],c=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],Z=[],J=[],d=[],K=[];let t=0;const q=new Array(3),W=new Array(3);let T;for(T=0;T<3;T++)q[T]=P.QE.Zero(),W[T]=P.Vector2.Zero();for(let y=0;y<20;y++){for(T=0;T<3;T++){const w=V[3*y+T];q[T].tx(u[3*a[w]],u[3*a[w]+1],u[3*a[w]+2]),q[T].normalize(),W[T].tx(.134765625*Q[2*w]+.05859375+-.0390625*c[y],.2333984375*Q[2*w+1]+.025390625+.01953125*c[y])}const w=(w,E,G,y)=>{const O=P.QE.Lerp(q[0],q[2],E/B),u=P.QE.Lerp(q[1],q[2],E/B),V=B===E?q[2]:P.QE.Lerp(O,u,w/(B-E));let a;if(V.normalize(),h){const w=P.QE.Lerp(q[0],q[2],y/B),E=P.QE.Lerp(q[1],q[2],y/B);a=P.QE.Lerp(w,E,G/(B-y))}else a=new P.QE(V.x,V.y,V.z);a.x/=U,a.y/=l,a.z/=i,a.normalize();const Q=P.Vector2.Lerp(W[0],W[2],E/B),c=P.Vector2.Lerp(W[1],W[2],E/B),T=B===E?W[2]:P.Vector2.Lerp(Q,c,w/(B-E));J.push(V.x*U,V.y*l,V.z*i),d.push(a.x,a.y,a.z),K.push(T.x,x.b?1-T.y:T.y),Z.push(t),t++};for(let E=0;E<B;E++)for(let G=0;G+E<B;G++)w(G,E,G+1/3,E+1/3),w(G+1,E,G+1/3,E+1/3),w(G,E+1,G+1/3,E+1/3),G+E+1<B&&(w(G+1,E,G+2/3,E+2/3),w(G+1,E+1,G+2/3,E+2/3),w(G,E+1,G+2/3,E+2/3))}y.d._ComputeSides(E,J,Z,d,K,w.frontUVs,w.backUVs);const I=new y.d;return I.indices=Z,I.Iw=J,I.jw=d,I.ow=K,I}function e(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new h.c(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),P._originalBuilderSideOrientation=E.sideOrientation;return D(E).kw(P,E.updatable),P}y.d.CreatePolyhedron=M,h.c.CreatePolyhedron=(w,E,G)=>p(w,E,G);y.d.CreateIcoSphere=D,h.c.CreateIcoSphere=(w,E,G)=>e(w,E,G);var R=G(11689);const H=new P.QE(1,0,0),z=new P.QE(-1,0,0),L=new P.QE(0,1,0),m=new P.QE(0,-1,0),n=new P.QE(0,0,1),r=new P.QE(0,0,-1);class Y{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.QE.Zero(),E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.QE.Up(),G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.Vector2.Zero(),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=w,this.normal=E,this.uv=G,this.vertexIdx=h,this.vertexIdxForBones=B,this.localPositionOverride=y,this.localNormalOverride=x,this.matrixIndicesOverride=U,this.matrixWeightsOverride=l}clone(){var w,E,G,P;return new Y(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(w=this.localPositionOverride)||void 0===w?void 0:w.slice(),null===(E=this.localNormalOverride)||void 0===E?void 0:E.slice(),null===(G=this.matrixIndicesOverride)||void 0===G?void 0:G.slice(),null===(P=this.matrixWeightsOverride)||void 0===P?void 0:P.slice())}}function S(w,E,G){var U,l,i,O,u;const V=!!E.skeleton,a=!(null===(U=E.morphTargetManager)||void 0===U||!U.numTargets),Q=G.localMode||V,c=E.ny(),Z=V||a?E.Rx(!0,!0):E.getVerticesData(B.g.PositionKind),J=V||a?E.getNormalsData(!0,!0):E.getVerticesData(B.g.NormalKind),d=Q?V?E.getVerticesData(B.g.PositionKind):Z:null,K=Q?V?E.getVerticesData(B.g.NormalKind):J:null,t=E.getVerticesData(B.g.UVKind),q=V?E.getVerticesData(B.g.MatricesIndicesKind):null,W=V?E.getVerticesData(B.g.MatricesWeightsKind):null,T=V?E.getVerticesData(B.g.MatricesIndicesExtraKind):null,I=V?E.getVerticesData(B.g.MatricesWeightsExtraKind):null,j=G.position||P.QE.Zero();let g=G.normal||P.QE.Up();const o=G.size||P.QE.One(),f=G.angle||0;if(!g){const w=new P.QE(0,0,1),G=E.Ww().activeCamera,h=P.QE.TransformCoordinates(w,G.getWorldMatrix());g=G.globalPosition.cE(h)}const k=-Math.atan2(g.z,g.x)-Math.PI/2,N=Math.sqrt(g.x*g.x+g.z*g.z),v=Math.atan2(g.y,N),C=new y.d;C.indices=[],C.Iw=[],C.jw=[],C.ow=[],C.matricesIndices=V?[]:null,C.matricesWeights=V?[]:null,C.matricesIndicesExtra=T?[]:null,C.matricesWeightsExtra=I?[]:null;let s=0;const F=(w,E)=>{const h=new Y;if(!c||!Z||!J)return h;const B=c[w];if(h.vertexIdx=3*B,h.vertexIdxForBones=4*B,h.position=new P.QE(Z[3*B],Z[3*B+1],Z[3*B+2]),P.QE.TransformCoordinatesToRef(h.position,E,h.position),h.normal=new P.QE(J[3*B],J[3*B+1],J[3*B+2]),P.QE.TransformNormalToRef(h.normal,E,h.normal),G.captureUVS&&t){const w=t[2*B+1];h.uv=new P.Vector2(t[2*B],x.b?1-w:w)}return h},M=[0,0,0,0],p=(w,E)=>{if(0===w.length)return w;const G=.5*Math.abs(P.QE.Dot(o,E)),h=(w,E,G,P)=>{for(let h=0;h<P;++h)if(w[G+h]===E)return G+h;return-1},B=(w,B)=>{const y=P.QE.GetClipFactor(w.position,B.position,E,G);let x=M,U=M;if(q&&W){const E=w.matrixIndicesOverride?0:w.vertexIdxForBones,G=w.matrixIndicesOverride??q,P=w.matrixWeightsOverride??W,l=B.matrixIndicesOverride?0:B.vertexIdxForBones,i=B.matrixIndicesOverride??q,O=B.matrixWeightsOverride??W;x=[0,0,0,0],U=[0,0,0,0];let u=0;for(let w=0;w<4;++w)if(P[E+w]>0){const B=h(i,G[E+w],l,4);x[u]=G[E+w],U[u]=(0,R.Lerp)(P[E+w],B>=0?O[B]:0,y),u++}for(let w=0;w<4&&u<4;++w){const P=i[l+w];-1===h(G,P,E,4)&&(x[u]=P,U[u]=(0,R.Lerp)(0,O[l+w],y),u++)}const V=U[0]+U[1]+U[2]+U[3];U[0]/=V,U[1]/=V,U[2]/=V,U[3]/=V}const l=w.localPositionOverride?w.localPositionOverride[0]:(null===d||void 0===d?void 0:d[w.vertexIdx])??0,i=w.localPositionOverride?w.localPositionOverride[1]:(null===d||void 0===d?void 0:d[w.vertexIdx+1])??0,O=w.localPositionOverride?w.localPositionOverride[2]:(null===d||void 0===d?void 0:d[w.vertexIdx+2])??0,u=B.localPositionOverride?B.localPositionOverride[0]:(null===d||void 0===d?void 0:d[B.vertexIdx])??0,V=B.localPositionOverride?B.localPositionOverride[1]:(null===d||void 0===d?void 0:d[B.vertexIdx+1])??0,a=B.localPositionOverride?B.localPositionOverride[2]:(null===d||void 0===d?void 0:d[B.vertexIdx+2])??0,Q=w.localNormalOverride?w.localNormalOverride[0]:(null===K||void 0===K?void 0:K[w.vertexIdx])??0,c=w.localNormalOverride?w.localNormalOverride[1]:(null===K||void 0===K?void 0:K[w.vertexIdx+1])??0,Z=w.localNormalOverride?w.localNormalOverride[2]:(null===K||void 0===K?void 0:K[w.vertexIdx+2])??0,J=Q+((B.localNormalOverride?B.localNormalOverride[0]:(null===K||void 0===K?void 0:K[B.vertexIdx])??0)-Q)*y,t=c+((B.localNormalOverride?B.localNormalOverride[1]:(null===K||void 0===K?void 0:K[B.vertexIdx+1])??0)-c)*y,T=Z+((B.localNormalOverride?B.localNormalOverride[2]:(null===K||void 0===K?void 0:K[B.vertexIdx+2])??0)-Z)*y,I=Math.sqrt(J*J+t*t+T*T);return new Y(P.QE.Lerp(w.position,B.position,y),P.QE.Lerp(w.normal,B.normal,y).normalize(),P.Vector2.Lerp(w.uv,B.uv,y),-1,-1,d?[l+(u-l)*y,i+(V-i)*y,O+(a-O)*y]:null,K?[J/I,t/I,T/I]:null,x,U)};let y=null;w.length>3&&(y=[]);for(let x=0;x<w.length;x+=3){let h=0,U=null,l=null,i=null,O=null;const u=P.QE.Dot(w[x].position,E)-G>0,V=P.QE.Dot(w[x+1].position,E)-G>0,a=P.QE.Dot(w[x+2].position,E)-G>0;switch(h=(u?1:0)+(V?1:0)+(a?1:0),h){case 0:w.length>3?(y.push(w[x]),y.push(w[x+1]),y.push(w[x+2])):y=w;break;case 1:if(y=y??new Array,u&&(U=w[x+1],l=w[x+2],i=B(w[x],U),O=B(w[x],l)),V){U=w[x],l=w[x+2],i=B(w[x+1],U),O=B(w[x+1],l),y.push(i),y.push(l.clone()),y.push(U.clone()),y.push(l.clone()),y.push(i.clone()),y.push(O);break}a&&(U=w[x],l=w[x+1],i=B(w[x+2],U),O=B(w[x+2],l)),U&&l&&i&&O&&(y.push(U.clone()),y.push(l.clone()),y.push(i),y.push(O),y.push(i.clone()),y.push(l.clone()));break;case 2:y=y??new Array,u||(U=w[x].clone(),l=B(U,w[x+1]),i=B(U,w[x+2]),y.push(U),y.push(l),y.push(i)),V||(U=w[x+1].clone(),l=B(U,w[x+2]),i=B(U,w[x]),y.push(U),y.push(l),y.push(i)),a||(U=w[x+2].clone(),l=B(U,w[x]),i=B(U,w[x+1]),y.push(U),y.push(l),y.push(i))}}return y},D=E instanceof h.c?E:null,e=null===D||void 0===D?void 0:D._thinInstanceDataStorage.matrixData,S=(null===D||void 0===D?void 0:D.jx)||1,X=P.TmpVectors.Matrix[0];X.B(P.Matrix.IdentityReadOnly);for(let h=0;h<S;++h){if(null!==D&&void 0!==D&&D.hasThinInstances&&e){const w=16*h;X.setRowFromFloats(0,e[w+0],e[w+1],e[w+2],e[w+3]),X.setRowFromFloats(1,e[w+4],e[w+5],e[w+6],e[w+7]),X.setRowFromFloats(2,e[w+8],e[w+9],e[w+10],e[w+11]),X.setRowFromFloats(3,e[w+12],e[w+13],e[w+14],e[w+15])}const w=P.Matrix.RotationYawPitchRoll(k,v,f).multiply(P.Matrix.Translation(j.x,j.y,j.z)),B=P.Matrix.Invert(w),y=E.getWorldMatrix(),U=X.multiply(y).multiply(B),l=new Array(3);for(let E=0;E<c.length;E+=3){let w=l;if(w[0]=F(E,U),w[1]=F(E+1,U),w[2]=F(E+2,U),!(G.cullBackFaces&&-w[0].normal.z<=0&&-w[1].normal.z<=0&&-w[2].normal.z<=0)&&(w=p(w,H),w&&(w=p(w,z),w&&(w=p(w,L),w&&(w=p(w,m),w&&(w=p(w,n),w&&(w=p(w,r),w)))))))for(let E=0;E<w.length;E++){const P=w[E];if(C.indices.push(s),Q?(P.localPositionOverride?(C.Iw[3*s]=P.localPositionOverride[0],C.Iw[3*s+1]=P.localPositionOverride[1],C.Iw[3*s+2]=P.localPositionOverride[2]):d&&(C.Iw[3*s]=d[P.vertexIdx],C.Iw[3*s+1]=d[P.vertexIdx+1],C.Iw[3*s+2]=d[P.vertexIdx+2]),P.localNormalOverride?(C.jw[3*s]=P.localNormalOverride[0],C.jw[3*s+1]=P.localNormalOverride[1],C.jw[3*s+2]=P.localNormalOverride[2]):K&&(C.jw[3*s]=K[P.vertexIdx],C.jw[3*s+1]=K[P.vertexIdx+1],C.jw[3*s+2]=K[P.vertexIdx+2])):(P.position.toArray(C.Iw,3*s),P.normal.toArray(C.jw,3*s)),C.matricesIndices&&C.matricesWeights&&(P.matrixIndicesOverride?(C.matricesIndices[4*s]=P.matrixIndicesOverride[0],C.matricesIndices[4*s+1]=P.matrixIndicesOverride[1],C.matricesIndices[4*s+2]=P.matrixIndicesOverride[2],C.matricesIndices[4*s+3]=P.matrixIndicesOverride[3]):(q&&(C.matricesIndices[4*s]=q[P.vertexIdxForBones],C.matricesIndices[4*s+1]=q[P.vertexIdxForBones+1],C.matricesIndices[4*s+2]=q[P.vertexIdxForBones+2],C.matricesIndices[4*s+3]=q[P.vertexIdxForBones+3]),T&&C.matricesIndicesExtra&&(C.matricesIndicesExtra[4*s]=T[P.vertexIdxForBones],C.matricesIndicesExtra[4*s+1]=T[P.vertexIdxForBones+1],C.matricesIndicesExtra[4*s+2]=T[P.vertexIdxForBones+2],C.matricesIndicesExtra[4*s+3]=T[P.vertexIdxForBones+3])),P.matrixWeightsOverride?(C.matricesWeights[4*s]=P.matrixWeightsOverride[0],C.matricesWeights[4*s+1]=P.matrixWeightsOverride[1],C.matricesWeights[4*s+2]=P.matrixWeightsOverride[2],C.matricesWeights[4*s+3]=P.matrixWeightsOverride[3]):(W&&(C.matricesWeights[4*s]=W[P.vertexIdxForBones],C.matricesWeights[4*s+1]=W[P.vertexIdxForBones+1],C.matricesWeights[4*s+2]=W[P.vertexIdxForBones+2],C.matricesWeights[4*s+3]=W[P.vertexIdxForBones+3]),I&&C.matricesWeightsExtra&&(C.matricesWeightsExtra[4*s]=I[P.vertexIdxForBones],C.matricesWeightsExtra[4*s+1]=I[P.vertexIdxForBones+1],C.matricesWeightsExtra[4*s+2]=I[P.vertexIdxForBones+2],C.matricesWeightsExtra[4*s+3]=I[P.vertexIdxForBones+3]))),G.captureUVS)P.uv.toArray(C.ow,2*s);else{C.ow.push(.5+P.position.x/o.x);const w=.5+P.position.y/o.y;C.ow.push(x.b?1-w:w)}s++}}}0===C.indices.length&&(C.indices=null),0===C.Iw.length&&(C.Iw=null),0===C.jw.length&&(C.jw=null),0===C.ow.length&&(C.ow=null),0===(null===(l=C.matricesIndices)||void 0===l?void 0:l.length)&&(C.matricesIndices=null),0===(null===(i=C.matricesWeights)||void 0===i?void 0:i.length)&&(C.matricesWeights=null),0===(null===(O=C.matricesIndicesExtra)||void 0===O?void 0:O.length)&&(C.matricesIndicesExtra=null),0===(null===(u=C.matricesWeightsExtra)||void 0===u?void 0:u.length)&&(C.matricesWeightsExtra=null);const b=new h.c(w,E.Ww());return C.kw(b),Q?(b.skeleton=E.skeleton,b.parent=E):(b.position=j.clone(),b.rotation=new P.QE(v,k,f)),b.Ah(!0),b.refreshBoundingInfo(!0,!0),b}function X(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const E=0|Math.max(w.subdivisions?w.subdivisions:2,1),G=0|Math.max(w.tessellation?w.tessellation:16,3),h=Math.max(w.height?w.height:1,0),B=Math.max(w.radius?w.radius:.25,0),U=0|Math.max(w.capSubdivisions?w.capSubdivisions:6,1),l=G,i=E,O=Math.max(w.radiusTop?w.radiusTop:B,0),u=Math.max(w.radiusBottom?w.radiusBottom:B,0),V=h-(O+u),a=2*Math.PI,Q=Math.max(w.topCapSubdivisions?w.topCapSubdivisions:U,1),c=Math.max(w.bottomCapSubdivisions?w.bottomCapSubdivisions:U,1),Z=Math.acos((u-O)/h);let J=[];const d=[],K=[],t=[];let q=0;const W=[],T=.5*V,I=.5*Math.PI;let j,g;const o=P.QE.Zero(),f=P.QE.Zero(),k=Math.cos(Z),N=Math.sin(Z),v=new P.Vector2(O*N,T+O*k).cE(new P.Vector2(u*N,u*k-T)).length(),C=O*Z+v+u*(I-Z);let s=0;for(g=0;g<=Q;g++){const w=[],E=I-Z*(g/Q);s+=O*Z/Q;const G=Math.cos(E),P=Math.sin(E),h=G*O;for(j=0;j<=l;j++){const E=j/l,B=E*a+0,y=Math.sin(B),U=Math.cos(B);f.x=h*y,f.y=T+P*O,f.z=h*U,d.push(f.x,f.y,f.z),o.set(G*y,P,G*U),K.push(o.x,o.y,o.z),t.push(E,x.b?s/C:1-s/C),w.push(q),q++}W.push(w)}const F=h-O-u+k*O-k*u,M=N*(u-O)/F;for(g=1;g<=i;g++){const w=[];s+=v/i;const E=N*(g*(u-O)/i+O);for(j=0;j<=l;j++){const G=j/l,P=G*a+0,h=Math.sin(P),B=Math.cos(P);f.x=E*h,f.y=T+k*O-g*F/i,f.z=E*B,d.push(f.x,f.y,f.z),o.set(h,M,B).normalize(),K.push(o.x,o.y,o.z),t.push(G,x.b?s/C:1-s/C),w.push(q),q++}W.push(w)}for(g=1;g<=c;g++){const w=[],E=I-Z-(Math.PI-Z)*(g/c);s+=u*Z/c;const G=Math.cos(E),P=Math.sin(E),h=G*u;for(j=0;j<=l;j++){const E=j/l,B=E*a+0,y=Math.sin(B),U=Math.cos(B);f.x=h*y,f.y=P*u-T,f.z=h*U,d.push(f.x,f.y,f.z),o.set(G*y,P,G*U),K.push(o.x,o.y,o.z),t.push(E,x.b?s/C:1-s/C),w.push(q),q++}W.push(w)}for(j=0;j<l;j++)for(g=0;g<Q+i+c;g++){const w=W[g][j],E=W[g+1][j],G=W[g+1][j+1],P=W[g][j+1];J.push(w),J.push(E),J.push(P),J.push(E),J.push(G),J.push(P)}if(J=J.reverse(),w.orientation&&!w.orientation.equals(P.QE.Up())){const E=new P.Matrix;w.orientation.clone().scale(.5*Math.PI).cross(P.QE.Up()).toQuaternion().toRotationMatrix(E);const G=P.QE.Zero();for(let w=0;w<d.length;w+=3)G.set(d[w],d[w+1],d[w+2]),P.QE.TransformCoordinatesToRef(G.clone(),E,G),d[w]=G.x,d[w+1]=G.y,d[w+2]=G.z}const p=new y.d;return p.Iw=d,p.jw=K,p.ow=t,p.indices=J,p}function b(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:P.QE.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new h.c(w,G);return X(E).kw(B,E.updatable),B}h.c.CreateDecal=(w,E,G,P,h,B)=>S(w,E,{position:G,normal:P,size:h,angle:B});h.c.CreateCapsule=(w,E,G)=>b(w,E,G),y.d.CreateCapsule=X;var A=G(11518),ww=G(11681);class Ew{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=w,this.y=E,w!==Math.floor(w)&&(w=Math.floor(w),A.e.Warn("x is not an integer, floor(x) used")),E!==Math.floor(E)&&(E=Math.floor(E),A.e.Warn("y is not an integer, floor(y) used"))}clone(){return new Ew(this.x,this.y)}rotate60About(w){const E=this.x;return this.x=w.x+w.y-this.y,this.y=E+this.y-w.x,this}rotateNeg60About(w){const E=this.x;return this.x=E+this.y-w.y,this.y=w.x+w.y-E,this}rotate120(w,E){w!==Math.floor(w)&&(w=Math.floor(w),A.e.Warn("m not an integer only floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),A.e.Warn("n not an integer only floor(n) used"));const G=this.x;return this.x=w-G-this.y,this.y=E+G,this}rotateNeg120(w,E){w!==Math.floor(w)&&(w=Math.floor(w),A.e.Warn("m is not an integer, floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),A.e.Warn("n is not an integer,   floor(n) used"));const G=this.x;return this.x=this.y-E,this.y=w+E-G-this.y,this}toCartesianOrigin(w,E){const G=P.QE.Zero();return G.x=w.x+2*this.x*E+this.y*E,G.y=w.y+Math.sqrt(3)*this.y*E,G}static Zero(){return new Ew(0,0)}}class Gw{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Pw("icosahedron","Regular",[[0,ww.f,-1],[-ww.f,1,0],[-1,0,-ww.f],[1,0,-ww.f],[ww.f,1,0],[0,ww.f,1],[-1,0,ww.f],[-ww.f,-1,0],[0,-ww.f,-1],[ww.f,-1,0],[1,0,ww.f],[0,-ww.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let w=12;const E={},G=this.m,P=this.n;let h,B,y,x,U,l=G,i=1,O=0;0!==P&&(l=(0,R.HighestCommonFactor)(G,P)),i=G/l,O=P/l;const u=Ew.Zero(),V=new Ew(G,P),a=new Ew(-P,G+P),Q=Ew.Zero(),c=Ew.Zero(),Z=Ew.Zero();let J,d,K,t,q=[];const W=[],T=this.vertByDist,I=(G,P,h,B)=>{J=G+"|"+h,d=P+"|"+B,J in E||d in E?J in E&&!(d in E)?E[d]=E[J]:d in E&&!(J in E)&&(E[J]=E[d]):(E[J]=w,E[d]=w,w++),T[h][0]>2?W[E[J]]=[-T[h][0],T[h][1],E[J]]:W[E[J]]=[q[T[h][0]],T[h][1],E[J]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let j=0;j<20;j++){if(q=this.IDATA.face[j],y=q[2],x=q[1],U=q[0],K=u.x+"|"+u.y,J=j+"|"+K,J in E||(E[J]=y,W[y]=[q[T[K][0]],T[K][1]]),K=V.x+"|"+V.y,J=j+"|"+K,J in E||(E[J]=x,W[x]=[q[T[K][0]],T[K][1]]),K=a.x+"|"+a.y,J=j+"|"+K,J in E||(E[J]=U,W[U]=[q[T[K][0]],T[K][1]]),h=this.IDATA.edgematch[j][0],B=this.IDATA.edgematch[j][1],"B"===B)for(let w=1;w<l;w++)c.x=G-w*(i+O),c.y=P+w*i,Z.x=-w*O,Z.y=w*(i+O),K=c.x+"|"+c.y,t=Z.x+"|"+Z.y,I(j,h,K,t);if("O"===B)for(let w=1;w<l;w++)Z.x=-w*O,Z.y=w*(i+O),Q.x=w*i,Q.y=w*O,K=Z.x+"|"+Z.y,t=Q.x+"|"+Q.y,I(j,h,K,t);if(h=this.IDATA.edgematch[j][2],B=this.IDATA.edgematch[j][3],B&&"A"===B)for(let w=1;w<l;w++)Q.x=w*i,Q.y=w*O,c.x=G-(l-w)*(i+O),c.y=P+(l-w)*i,K=Q.x+"|"+Q.y,t=c.x+"|"+c.y,I(j,h,K,t);for(let G=0;G<this.vertices.length;G++)K=this.vertices[G].x+"|"+this.vertices[G].y,J=j+"|"+K,J in E||(E[J]=w++,T[K][0]>2?W[E[J]]=[-T[K][0],T[K][1],E[J]]:W[E[J]]=[q[T[K][0]],T[K][1],E[J]])}this.closestTo=W,this.vecToidx=E}calcCoeffs(){const w=this.m,E=this.n,G=Math.sqrt(3)/3,P=w*w+E*E+w*E;this.coau=(w+E)/P,this.cobu=-E/P,this.coav=-G*(w-E)/P,this.cobv=G*(2*w+E)/P}createInnerFacets(){const w=this.m,E=this.n;for(let G=0;G<E+w+1;G++)for(let w=this.min[G];w<this.max[G]+1;w++)w<this.max[G]&&w<this.max[G+1]+1&&this.innerFacets.push(["|"+w+"|"+G,"|"+w+"|"+(G+1),"|"+(w+1)+"|"+G]),G>0&&w<this.max[G-1]&&w+1<this.max[G]+1&&this.innerFacets.push(["|"+w+"|"+G,"|"+(w+1)+"|"+G,"|"+(w+1)+"|"+(G-1)])}edgeVecsABOB(){const w=this.m,E=this.n,G=new Ew(-E,w+E);for(let P=1;P<w+E;P++){const w=new Ew(this.min[P],P),E=new Ew(this.min[P-1],P-1),h=new Ew(this.min[P+1],P+1),B=w.clone(),y=E.clone(),x=h.clone();B.rotate60About(G),y.rotate60About(G),x.rotate60About(G);const U=new Ew(this.max[B.y],B.y),l=new Ew(this.max[B.y-1],B.y-1),i=new Ew(this.max[B.y-1]-1,B.y-1);B.x===U.x&&B.y===U.y||(B.x!==l.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,l,i]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,i,U])):B.y===x.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([w,E,l]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([w,l,h])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([w,E,l]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,l,U])))}}mapABOBtoOBOA(){const w=new Ew(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const G=[];for(let P=0;P<3;P++)w.x=this.isoVecsABOB[E][P].x,w.y=this.isoVecsABOB[E][P].y,0===this.vertexTypes[E][P]&&w.rotateNeg120(this.m,this.n),G.push(w.clone());this.isoVecsOBOA.push(G)}}mapABOBtoBAOA(){const w=new Ew(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const G=[];for(let P=0;P<3;P++)w.x=this.isoVecsABOB[E][P].x,w.y=this.isoVecsABOB[E][P].y,1===this.vertexTypes[E][P]&&w.rotate120(this.m,this.n),G.push(w.clone());this.isoVecsBAOA.push(G)}}MapToFace(w,E){const G=this.IDATA.face[w],h=G[2],B=G[1],y=G[0],x=P.QE.KE(this.IDATA.vertex[h]),U=P.QE.KE(this.IDATA.vertex[B]),l=P.QE.KE(this.IDATA.vertex[y]),i=U.cE(x),O=l.cE(x),u=i.scale(this.coau).add(O.scale(this.cobu)),V=i.scale(this.coav).add(O.scale(this.cobv)),a=[];let Q,c=P.TmpVectors.QE[0];for(let P=0;P<this.cartesian.length;P++)c=u.scale(this.cartesian[P].x).add(V.scale(this.cartesian[P].y)).add(x),a[P]=[c.x,c.y,c.z],Q=w+"|"+this.vertices[P].x+"|"+this.vertices[P].y,E.vertex[this.vecToidx[Q]]=[c.x,c.y,c.z]}build(w,E){const G=[],P=Ew.Zero(),h=new Ew(w,E),B=new Ew(-E,w+E);G.push(P,h,B);for(let K=E;K<w+1;K++)for(let E=0;E<w+1-K;E++)G.push(new Ew(E,K));if(E>0){const P=(0,R.HighestCommonFactor)(w,E),h=w/P,B=E/P;for(let x=1;x<P;x++)G.push(new Ew(x*h,x*B)),G.push(new Ew(-x*B,x*(h+B))),G.push(new Ew(w-x*(h+B),E+x*h));const y=w/E;for(let x=1;x<E;x++)for(let P=0;P<x*y;P++)G.push(new Ew(P,x)),G.push(new Ew(P,x).rotate120(w,E)),G.push(new Ew(P,x).rotateNeg120(w,E))}G.sort(((w,E)=>w.x-E.x)),G.sort(((w,E)=>w.y-E.y));const y=new Array(w+E+1),x=new Array(w+E+1);for(let K=0;K<y.length;K++)y[K]=1/0,x[K]=-1/0;let U=0,l=0;const i=G.length;for(let K=0;K<i;K++)l=G[K].x,U=G[K].y,y[U]=Math.min(l,y[U]),x[U]=Math.max(l,x[U]);const O=(G,P)=>{const h=G.clone();return"A"===P&&h.rotateNeg120(w,E),"B"===P&&h.rotate120(w,E),h.x<0?h.y:h.x+h.y},u=[],V=[],a=[],Q=[],c={},Z=[];let J=-1,d=-1;for(let K=0;K<i;K++)u[K]=G[K].toCartesianOrigin(new Ew(0,0),.5),V[K]=O(G[K],"O"),a[K]=O(G[K],"A"),Q[K]=O(G[K],"B"),V[K]===a[K]&&a[K]===Q[K]?(J=3,d=V[K]):V[K]===a[K]?(J=4,d=V[K]):a[K]===Q[K]?(J=5,d=a[K]):Q[K]===V[K]&&(J=6,d=V[K]),V[K]<a[K]&&V[K]<Q[K]&&(J=2,d=V[K]),a[K]<V[K]&&a[K]<Q[K]&&(J=1,d=a[K]),Q[K]<a[K]&&Q[K]<V[K]&&(J=0,d=Q[K]),Z.push([J,d,G[K].x,G[K].y]);Z.sort(((w,E)=>w[2]-E[2])),Z.sort(((w,E)=>w[3]-E[3])),Z.sort(((w,E)=>w[1]-E[1])),Z.sort(((w,E)=>w[0]-E[0]));for(let K=0;K<Z.length;K++)c[Z[K][2]+"|"+Z[K][3]]=[Z[K][0],Z[K][1],K];return this.m=w,this.n=E,this.vertices=G,this.vertByDist=c,this.cartesian=u,this.min=y,this.max=x,this}}class Pw{constructor(w,E,G,P){this.name=w,this.category=E,this.vertex=G,this.face=P}}class hw extends Pw{innerToData(w,E){for(let G=0;G<E.innerFacets.length;G++)this.face.push(E.innerFacets[G].map((G=>E.vecToidx[w+G])))}mapABOBtoDATA(w,E){const G=E.IDATA.edgematch[w][0];for(let P=0;P<E.isoVecsABOB.length;P++){const h=[];for(let B=0;B<3;B++)0===E.vertexTypes[P][B]?h.push(w+"|"+E.isoVecsABOB[P][B].x+"|"+E.isoVecsABOB[P][B].y):h.push(G+"|"+E.isoVecsABOB[P][B].x+"|"+E.isoVecsABOB[P][B].y);this.face.push([E.vecToidx[h[0]],E.vecToidx[h[1]],E.vecToidx[h[2]]])}}mapOBOAtoDATA(w,E){const G=E.IDATA.edgematch[w][0];for(let P=0;P<E.isoVecsOBOA.length;P++){const h=[];for(let B=0;B<3;B++)1===E.vertexTypes[P][B]?h.push(w+"|"+E.isoVecsOBOA[P][B].x+"|"+E.isoVecsOBOA[P][B].y):h.push(G+"|"+E.isoVecsOBOA[P][B].x+"|"+E.isoVecsOBOA[P][B].y);this.face.push([E.vecToidx[h[0]],E.vecToidx[h[1]],E.vecToidx[h[2]]])}}mapBAOAtoDATA(w,E){const G=E.IDATA.edgematch[w][2];for(let P=0;P<E.isoVecsBAOA.length;P++){const h=[];for(let B=0;B<3;B++)1===E.vertexTypes[P][B]?h.push(w+"|"+E.isoVecsBAOA[P][B].x+"|"+E.isoVecsBAOA[P][B].y):h.push(G+"|"+E.isoVecsBAOA[P][B].x+"|"+E.isoVecsBAOA[P][B].y);this.face.push([E.vecToidx[h[0]],E.vecToidx[h[1]],E.vecToidx[h[2]]])}}orderData(w){const E=[];for(let B=0;B<13;B++)E[B]=[];const G=w.closestTo;for(let B=0;B<G.length;B++)G[B][0]>-1?G[B][1]>0&&E[G[B][0]].push([B,G[B][1]]):E[12].push([B,G[B][0]]);const P=[];for(let B=0;B<12;B++)P[B]=B;let h=12;for(let B=0;B<12;B++){E[B].sort(((w,E)=>w[1]-E[1]));for(let w=0;w<E[B].length;w++)P[E[B][w][0]]=h++}for(let B=0;B<E[12].length;B++)P[E[12][B][0]]=h++;for(let B=0;B<this.vertex.length;B++)this.vertex[B].push(P[B]);this.vertex.sort(((w,E)=>w[3]-E[3]));for(let B=0;B<this.vertex.length;B++)this.vertex[B].pop();for(let B=0;B<this.face.length;B++)for(let w=0;w<this.face[B].length;w++)this.face[B][w]=P[this.face[B][w]];this.sharedNodes=E[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(w,E){const G=[],P=[];let h=E.pop();P.push(h);let B=this.face[h].indexOf(w);B=(B+2)%3;let y=this.face[h][B];G.push(y);let x=0;for(;E.length>0;)h=E[x],this.face[h].indexOf(y)>-1?(B=(this.face[h].indexOf(y)+1)%3,y=this.face[h][B],G.push(y),P.push(h),E.splice(x,1),x=0):x++;return this.adjacentFaces.push(G),P}toGoldbergPolyhedronData(){const w=new Pw("GeoDual","Goldberg",[],[]);w.name="GD dual";const E=this.vertex.length,G=new Array(E);for(let U=0;U<E;U++)G[U]=[];for(let U=0;U<this.face.length;U++)for(let w=0;w<3;w++)G[this.face[U][w]].push(U);let P=0,h=0,B=0,y=[],x=[];this.adjacentFaces=[];for(let U=0;U<G.length;U++){w.face[U]=this.setOrder(U,G[U].concat([]));for(const E of G[U]){P=0,h=0,B=0,y=this.face[E];for(let w=0;w<3;w++)x=this.vertex[y[w]],P+=x[0],h+=x[1],B+=x[2];w.vertex[E]=[P/3,h/3,B/3]}}return w}static BuildGeodesicData(w){const E=new hw("Geodesic-m-n","Geodesic",[[0,ww.f,-1],[-ww.f,1,0],[-1,0,-ww.f],[1,0,-ww.f],[ww.f,1,0],[0,ww.f,1],[-1,0,ww.f],[-ww.f,-1,0],[0,-ww.f,-1],[ww.f,-1,0],[1,0,ww.f],[0,-ww.f,1]],[]);w.setIndices(),w.calcCoeffs(),w.createInnerFacets(),w.edgeVecsABOB(),w.mapABOBtoOBOA(),w.mapABOBtoBAOA();for(let G=0;G<w.IDATA.face.length;G++)w.MapToFace(G,E),E.innerToData(G,w),"B"===w.IDATA.edgematch[G][1]&&E.mapABOBtoDATA(G,w),"O"===w.IDATA.edgematch[G][1]&&E.mapOBOAtoDATA(G,w),"A"===w.IDATA.edgematch[G][3]&&E.mapBAOAtoDATA(G,w);E.orderData(w);return E.vertex=E.vertex.map((function(w){const E=w[0],G=w[1],P=w[2],h=Math.sqrt(E*E+G*G+P*P);return w[0]*=1/h,w[1]*=1/h,w[2]*=1/h,w})),E}}h.c._GoldbergMeshParser=(w,E)=>Bw.Parse(w,E);class Bw extends h.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(w,E){return void 0===E?(w>this.goldbergData.nbUnsharedFaces-1&&(A.e.Warn("Maximum number of unshared faces used"),w=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+w):(w>11&&(A.e.Warn("Last pole used"),w=11),E>this.goldbergData.nbFacesAtPole-1&&(A.e.Warn("Maximum number of faces at a pole used"),E=this.goldbergData.nbFacesAtPole-1),12+w*this.goldbergData.nbFacesAtPole+E)}_changeGoldbergFaceColors(w){for(let G=0;G<w.length;G++){const E=w[G][0],P=w[G][1],h=w[G][2];for(let w=E;w<P+1;w++)this.goldbergData.faceColors[w]=h}const E=[];for(let G=0;G<12;G++)for(let w=0;w<5;w++)E.push(this.goldbergData.faceColors[G].r,this.goldbergData.faceColors[G].g,this.goldbergData.faceColors[G].b,this.goldbergData.faceColors[G].a);for(let G=12;G<this.goldbergData.faceColors.length;G++)for(let w=0;w<6;w++)E.push(this.goldbergData.faceColors[G].r,this.goldbergData.faceColors[G].g,this.goldbergData.faceColors[G].b,this.goldbergData.faceColors[G].a);return E}setGoldbergFaceColors(w){const E=this._changeGoldbergFaceColors(w);this.Fw(B.g.ColorKind,E)}updateGoldbergFaceColors(w){const E=this._changeGoldbergFaceColors(w);this.updateVerticesData(B.g.ColorKind,E)}_changeGoldbergFaceUVs(w){const E=this.getVerticesData(B.g.UVKind);for(let G=0;G<w.length;G++){const P=w[G][0],h=w[G][1],B=w[G][2],y=w[G][3],x=w[G][4],U=[],l=[];let i,O;for(let w=0;w<5;w++)i=B.x+y*Math.cos(x+w*Math.PI/2.5),O=B.y+y*Math.sin(x+w*Math.PI/2.5),i<0&&(i=0),i>1&&(i=1),U.push(i,O);for(let w=0;w<6;w++)i=B.x+y*Math.cos(x+w*Math.PI/3),O=B.y+y*Math.sin(x+w*Math.PI/3),i<0&&(i=0),i>1&&(i=1),l.push(i,O);for(let w=P;w<Math.min(12,h+1);w++)for(let G=0;G<5;G++)E[10*w+2*G]=U[2*G],E[10*w+2*G+1]=U[2*G+1];for(let w=Math.max(12,P);w<h+1;w++)for(let G=0;G<6;G++)E[12*w-24+2*G]=l[2*G],E[12*w-23+2*G]=l[2*G+1]}return E}setGoldbergFaceUVs(w){const E=this._changeGoldbergFaceUVs(w);this.Fw(B.g.UVKind,E)}updateGoldbergFaceUVs(w){const E=this._changeGoldbergFaceUVs(w);this.updateVerticesData(B.g.UVKind,E)}placeOnGoldbergFaceAt(w,E,G){const h=P.QE.RotationFromAxis(this.goldbergData.faceXaxis[E],this.goldbergData.faceYaxis[E],this.goldbergData.faceZaxis[E]);w.rotation=h,w.position=this.goldbergData.faceCenters[E].add(this.goldbergData.faceXaxis[E].scale(G.x)).add(this.goldbergData.faceYaxis[E].scale(G.y)).add(this.goldbergData.faceZaxis[E].scale(G.z))}serialize(w){super.serialize(w),w.type="GoldbergMesh";const E={};if(E.adjacentFaces=this.goldbergData.adjacentFaces,E.nbSharedFaces=this.goldbergData.nbSharedFaces,E.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,E.nbFaces=this.goldbergData.nbFaces,E.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){E.faceColors=[];for(const w of this.goldbergData.faceColors)E.faceColors.push(w.Lh())}if(this.goldbergData.faceCenters){E.faceCenters=[];for(const w of this.goldbergData.faceCenters)E.faceCenters.push(w.Lh())}if(this.goldbergData.faceZaxis){E.faceZaxis=[];for(const w of this.goldbergData.faceZaxis)E.faceZaxis.push(w.Lh())}if(this.goldbergData.faceYaxis){E.faceYaxis=[];for(const w of this.goldbergData.faceYaxis)E.faceYaxis.push(w.Lh())}if(this.goldbergData.faceXaxis){E.faceXaxis=[];for(const w of this.goldbergData.faceXaxis)E.faceXaxis.push(w.Lh())}w.goldbergData=E}static Parse(w,E){const G=w.goldbergData;G.faceColors=G.faceColors.map((w=>u.Tx.KE(w))),G.faceCenters=G.faceCenters.map((w=>P.QE.KE(w))),G.faceZaxis=G.faceZaxis.map((w=>P.QE.KE(w))),G.faceXaxis=G.faceXaxis.map((w=>P.QE.KE(w))),G.faceYaxis=G.faceYaxis.map((w=>P.QE.KE(w)));const h=new Bw(w.name,E);return h.goldbergData=G,h}}var yw=G(12205);const xw={CreateBox:O.d,CreateTiledBox:c,CreateSphere:Z.e,CreateDisc:i.d,CreateIcoSphere:e,CreateRibbon:l,CreateCylinder:t,CreateTorus:W,CreateTorusKnot:I,CreateLineSystem:j.e,Wl:j.f,CreateDashedLines:j.b,ExtrudeShape:f,ExtrudeShapeCustom:k,CreateLathe:v,CreateTiledPlane:a,jl:C.b,CreateGround:s.h,CreateTiledGround:s.i,CreateGroundFromHeightMap:s.e,CreatePolygon:g.c,ExtrudePolygon:g.g,CreateTube:F,CreatePolyhedron:p,CreateGeodesic:function(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=E.m||1;P!==Math.floor(P)&&(P=Math.floor(P),A.e.Warn("m not an integer only floor(m) used"));let h=E.n||0;if(h!==Math.floor(h)&&(h=Math.floor(h),A.e.Warn("n not an integer only floor(n) used")),h>P){const w=h;h=P,P=w,A.e.Warn("n > m therefore m and n swapped")}const B=new Gw;return B.build(P,h),p(w,{custom:hw.BuildGeodesicData(B),size:E.size,sizeX:E.sizeX,sizeY:E.sizeY,sizeZ:E.sizeZ,faceUV:E.faceUV,faceColors:E.faceColors,flat:E.flat,updatable:E.updatable,sideOrientation:E.sideOrientation,frontUVs:E.frontUVs,backUVs:E.backUVs},G)},CreateGoldberg:function(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=E.size,U=E.sizeX||B||1,l=E.sizeY||B||1,i=E.sizeZ||B||1;let O=E.m||1;O!==Math.floor(O)&&(O=Math.floor(O),A.e.Warn("m not an integer only floor(m) used"));let V=E.n||0;if(V!==Math.floor(V)&&(V=Math.floor(V),A.e.Warn("n not an integer only floor(n) used")),V>O){const w=V;V=O,O=w,A.e.Warn("n > m therefore m and n swapped")}const a=new Gw;a.build(O,V);const Q=hw.BuildGeodesicData(a),c=Q.toGoldbergPolyhedronData(),Z=new Bw(w,G);E.sideOrientation=h.c._GetDefaultSideOrientation(E.sideOrientation),Z._originalBuilderSideOrientation=E.sideOrientation;(function(w,E){const G=w.size,h=w.sizeX||G||1,B=w.sizeY||G||1,U=w.sizeZ||G||1,l=0===w.sideOrientation?0:w.sideOrientation||y.d.DEFAULTSIDE,i=[],O=[],u=[],V=[];let a=1/0,Q=-1/0,c=1/0,Z=-1/0;for(let P=0;P<E.vertex.length;P++)a=Math.min(a,E.vertex[P][0]*h),Q=Math.max(Q,E.vertex[P][0]*h),c=Math.min(c,E.vertex[P][1]*B),Z=Math.max(Z,E.vertex[P][1]*B);let J=0;for(let y=0;y<E.face.length;y++){const w=E.face[y],G=P.QE.KE(E.vertex[w[0]]),l=P.QE.KE(E.vertex[w[2]]),d=P.QE.KE(E.vertex[w[1]]),K=l.cE(G),t=d.cE(G),q=P.QE.Cross(t,K).normalize();for(let P=0;P<w.length;P++){u.push(q.x,q.y,q.z);const G=E.vertex[w[P]];i.push(G[0]*h,G[1]*B,G[2]*U);const y=(G[1]*B-c)/(Z-c);V.push((G[0]*h-a)/(Q-a),x.b?1-y:y)}for(let E=0;E<w.length-2;E++)O.push(J,J+E+2,J+E+1);J+=w.length}y.d._ComputeSides(l,i,O,u,V);const d=new y.d;return d.Iw=i,d.indices=O,d.jw=u,d.ow=V,d})(E,c).kw(Z,E.updatable),Z.goldbergData.nbSharedFaces=Q.sharedNodes,Z.goldbergData.nbUnsharedFaces=Q.poleNodes,Z.goldbergData.adjacentFaces=Q.adjacentFaces,Z.goldbergData.nbFaces=Z.goldbergData.nbSharedFaces+Z.goldbergData.nbUnsharedFaces,Z.goldbergData.nbFacesAtPole=(Z.goldbergData.nbUnsharedFaces-12)/12;for(let h=0;h<Q.vertex.length;h++)Z.goldbergData.faceCenters.push(P.QE.KE(Q.vertex[h])),Z.goldbergData.faceCenters[h].x*=U,Z.goldbergData.faceCenters[h].y*=l,Z.goldbergData.faceCenters[h].z*=i,Z.goldbergData.faceColors.push(new u.Tx(1,1,1,1));for(let h=0;h<c.face.length;h++){const w=c.face[h],E=P.QE.KE(c.vertex[w[0]]),G=P.QE.KE(c.vertex[w[2]]),B=P.QE.KE(c.vertex[w[1]]),y=G.cE(E),x=B.cE(E),U=P.QE.Cross(x,y).normalize(),l=P.QE.Cross(x,U).normalize();Z.goldbergData.faceXaxis.push(x.normalize()),Z.goldbergData.faceYaxis.push(U),Z.goldbergData.faceZaxis.push(l)}return Z},CreateDecal:S,CreateCapsule:b,CreateText:yw.e}},12895:(w,E,G)=>{"use strict";G.d(E,{e:()=>xE});var P=G(11679),h=G(12044);class B extends h.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var y=G(11716),x=(G(11845),G(11646));class U{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(w){this._targetStopDuration!==w&&(this._targetStopDuration=w)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(w){this._noiseTexture!==w&&(this._noiseTexture=w,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(w){this._animationSheetEnabled!==w&&(this._animationSheetEnabled=w)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(w){this._isAnimationSheetEnabled!=w&&(this._isAnimationSheetEnabled=w,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(w){this._useLogarithmicDepth=w&&this.Ww().getEngine().getCaps().fragmentDepthSupported}Ww(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(w){switch(w){case U.BLENDMODE_MULTIPLYADD:return;case U.BLENDMODE_ADD:w=1;break;case U.BLENDMODE_ONEONE:w=6;break;case U.BLENDMODE_STANDARD:w=2;break;case U.BLENDMODE_MULTIPLY:w=4;break;case U.BLENDMODE_SUBTRACT:w=3}this._engine.setAlphaMode(w)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:P.QE.Zero()}set direction1(w){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=w)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:P.QE.Zero()}set direction2(w){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=w)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:P.QE.Zero()}set minEmitBox(w){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=w)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:P.QE.Zero()}set maxEmitBox(w){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=w)}get billboardMode(){return this._billboardMode}set billboardMode(w){this._billboardMode!==w&&(this._billboardMode=w,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(w){this._isBillboardBased!==w&&(this._isBillboardBased=w,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(w){this._attachImageProcessingConfiguration(w)}_attachImageProcessingConfiguration(w){w!==this._imageProcessingConfiguration&&(!w&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=w)}_reset(){}_removeGradientAndTexture(w,E,G){if(!E)return this;let P=0;for(const h of E){if(h.gradient===w){E.splice(P,1);break}P++}return G&&G.dispose(),this}constructor(w){this.animations=[],this.renderingGroupId=0,this.hE=P.QE.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new P.QE(10,10,10),this.onAnimationEnd=null,this.blendMode=U.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new P.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Kl=new P.QE(0,0,0),this._useLogarithmicDepth=!1,this.gravity=P.QE.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new y.Tx(1,1,1,1),this.color2=new y.Tx(1,1,1,1),this.colorDead=new y.Tx(0,0,0,1),this.textureMask=new y.Tx(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new B,this.id=w,this.name=w}createPointEmitter(w,E){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new P.QE(0,1,0),arguments.length>2&&void 0!==arguments[2]||new P.QE(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new P.QE(0,1,0),arguments.length>4&&void 0!==arguments[4]||new P.QE(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new P.QE(0,1,0),arguments.length>3&&void 0!==arguments[3]||new P.QE(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(w,E,G,P){throw new Error("Method not implemented.")}}U.BLENDMODE_ONEONE=0,U.BLENDMODE_STANDARD=1,U.BLENDMODE_ADD=2,U.BLENDMODE_MULTIPLY=3,U.BLENDMODE_MULTIPLYADD=4,U.BLENDMODE_SUBTRACT=-1,(0,x.g)("BABYLON.BaseParticleSystem",U);var l=G(11689),i=G(11526);class O{constructor(){this.direction1=new P.QE(0,1,0),this.direction2=new P.QE(0,1,0),this.minEmitBox=new P.QE(-.5,-.5,-.5),this.maxEmitBox=new P.QE(.5,.5,.5)}startDirectionFunction(w,E,G,h){const B=(0,l.RandomRange)(this.direction1.x,this.direction2.x),y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),x=(0,l.RandomRange)(this.direction1.z,this.direction2.z);if(h)return E.x=B,E.y=y,void(E.z=x);P.QE.TransformNormalFromFloatsToRef(B,y,x,w,E)}startPositionFunction(w,E,G,h){const B=(0,l.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),y=(0,l.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),x=(0,l.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(h)return E.x=B,E.y=y,void(E.z=x);P.QE.TransformCoordinatesFromFloatsToRef(B,y,x,w,E)}clone(){const w=new O;return i.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2),w.setVector3("minEmitBox",this.minEmitBox),w.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3),w.addUniform("minEmitBox",3),w.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.direction1=this.direction1.Lh(),w.direction2=this.direction2.Lh(),w.minEmitBox=this.minEmitBox.Lh(),w.maxEmitBox=this.maxEmitBox.Lh(),w}parse(w){P.QE.FromArrayToRef(w.direction1,0,this.direction1),P.QE.FromArrayToRef(w.direction2,0,this.direction2),P.QE.FromArrayToRef(w.minEmitBox,0,this.minEmitBox),P.QE.FromArrayToRef(w.maxEmitBox,0,this.maxEmitBox)}}class u{get radius(){return this._radius}set radius(w){this._radius=w,this._buildHeight()}get angle(){return this._angle}set angle(w){this._angle=w,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=G,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=E,this.radius=w}startDirectionFunction(w,E,G,h){h?P.TmpVectors.QE[0].B(G.wU).normalize():G.position.subtractToRef(w.getTranslation(),P.TmpVectors.QE[0]).normalize();const B=(0,l.RandomRange)(0,this.directionRandomizer),y=(0,l.RandomRange)(0,this.directionRandomizer),x=(0,l.RandomRange)(0,this.directionRandomizer);E.x=P.TmpVectors.QE[0].x+B,E.y=P.TmpVectors.QE[0].y+y,E.z=P.TmpVectors.QE[0].z+x,E.normalize()}startPositionFunction(w,E,G,h){const B=(0,l.RandomRange)(0,2*Math.PI);let y;this.emitFromSpawnPointOnly?y=1e-4:(y=(0,l.RandomRange)(0,this.heightRange),y=1-y*y);let x=this._radius-(0,l.RandomRange)(0,this._radius*this.radiusRange);x*=y;const U=x*Math.sin(B),i=x*Math.cos(B),O=y*this._height;if(h)return E.x=U,E.y=O,void(E.z=i);P.QE.TransformCoordinatesFromFloatsToRef(U,O,i,w,E)}clone(){const w=new u(this._radius,this._angle,this.directionRandomizer);return i.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat2("radius",this._radius,this.radiusRange),w.setFloat("coneAngle",this._angle),w.setFloat2("height",this._height,this.heightRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",2),w.addUniform("coneAngle",1),w.addUniform("height",2),w.addUniform("directionRandomizer",1)}getEffectDefines(){let w="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(w+="\n#define CONEEMITTERSPAWNPOINT"),w}getClassName(){return"ConeParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this._radius,w.angle=this._angle,w.directionRandomizer=this.directionRandomizer,w.radiusRange=this.radiusRange,w.heightRange=this.heightRange,w.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,w}parse(w){this.radius=w.radius,this.angle=w.angle,this.directionRandomizer=w.directionRandomizer,this.radiusRange=void 0!==w.radiusRange?w.radiusRange:1,this.heightRange=void 0!==w.radiusRange?w.heightRange:1,this.emitFromSpawnPointOnly=void 0!==w.emitFromSpawnPointOnly&&w.emitFromSpawnPointOnly}}class V extends u{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.QE(0,1,0),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.QE(0,1,0);super(w,E),this.direction1=G,this.direction2=h}startDirectionFunction(w,E){const G=(0,l.RandomRange)(this.direction1.x,this.direction2.x),h=(0,l.RandomRange)(this.direction1.y,this.direction2.y),B=(0,l.RandomRange)(this.direction1.z,this.direction2.z);P.QE.TransformNormalFromFloatsToRef(G,h,B,w,E)}clone(){const w=new V(this.radius,this.angle,this.direction1,this.direction2);return i.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.Lh(),w.direction2=this.direction2.Lh(),w}parse(w){super.parse(w),this.direction1.B(w.direction1),this.direction2.B(w.direction2)}}class a{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=w,this.height=E,this.radiusRange=G,this.directionRandomizer=h,this._tempVector=P.QE.Zero()}startDirectionFunction(w,E,G,h,B){G.position.subtractToRef(w.getTranslation(),this._tempVector),this._tempVector.normalize(),P.QE.TransformNormalToRef(this._tempVector,B,this._tempVector);const y=(0,l.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let x=Math.atan2(this._tempVector.x,this._tempVector.z);x+=(0,l.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=y,this._tempVector.x=Math.sin(x),this._tempVector.z=Math.cos(x),this._tempVector.normalize(),h?E.B(this._tempVector):P.QE.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,w,E)}startPositionFunction(w,E,G,h){const B=(0,l.RandomRange)(-this.height/2,this.height/2),y=(0,l.RandomRange)(0,2*Math.PI),x=(0,l.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),U=Math.sqrt(x)*this.radius,i=U*Math.cos(y),O=U*Math.sin(y);h?E.tx(i,B,O):P.QE.TransformCoordinatesFromFloatsToRef(i,B,O,w,E)}clone(){const w=new a(this.radius,this.directionRandomizer);return i.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("height",this.height),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("height",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.height=this.height,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.height=w.height,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class Q extends a{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.QE(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.QE(0,1,0);super(w,E,G),this.direction1=h,this.direction2=B}startDirectionFunction(w,E,G,h){const B=(0,l.RandomRange)(this.direction1.x,this.direction2.x),y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),x=(0,l.RandomRange)(this.direction1.z,this.direction2.z);h?E.tx(B,y,x):P.QE.TransformNormalFromFloatsToRef(B,y,x,w,E)}clone(){const w=new Q(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return i.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("height",this.height),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("height",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.Lh(),w.direction2=this.direction2.Lh(),w}parse(w){super.parse(w),P.QE.FromArrayToRef(w.direction1,0,this.direction1),P.QE.FromArrayToRef(w.direction2,0,this.direction2)}}class c{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=w,this.radiusRange=E,this.directionRandomizer=G}startDirectionFunction(w,E,G,h){const B=G.position.cE(w.getTranslation()).normalize(),y=(0,l.RandomRange)(0,this.directionRandomizer),x=(0,l.RandomRange)(0,this.directionRandomizer),U=(0,l.RandomRange)(0,this.directionRandomizer);B.x+=y,B.y+=x,B.z+=U,B.normalize(),h?E.B(B):P.QE.TransformNormalFromFloatsToRef(B.x,B.y,B.z,w,E)}startPositionFunction(w,E,G,h){const B=this.radius-(0,l.RandomRange)(0,this.radius*this.radiusRange),y=(0,l.RandomRange)(0,1),x=(0,l.RandomRange)(0,2*Math.PI),U=Math.acos(2*y-1),i=B*Math.cos(x)*Math.sin(U),O=B*Math.cos(U),u=B*Math.sin(x)*Math.sin(U);h?E.tx(i,Math.abs(O),u):P.QE.TransformCoordinatesFromFloatsToRef(i,Math.abs(O),u,w,E)}clone(){const w=new c(this.radius,this.directionRandomizer);return i.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class Z{constructor(){this.direction1=new P.QE(0,1,0),this.direction2=new P.QE(0,1,0)}startDirectionFunction(w,E,G,h){const B=(0,l.RandomRange)(this.direction1.x,this.direction2.x),y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),x=(0,l.RandomRange)(this.direction1.z,this.direction2.z);h?E.tx(B,y,x):P.QE.TransformNormalFromFloatsToRef(B,y,x,w,E)}startPositionFunction(w,E,G,h){h?E.tx(0,0,0):P.QE.TransformCoordinatesFromFloatsToRef(0,0,0,w,E)}clone(){const w=new Z;return i.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.direction1=this.direction1.Lh(),w.direction2=this.direction2.Lh(),w}parse(w){P.QE.FromArrayToRef(w.direction1,0,this.direction1),P.QE.FromArrayToRef(w.direction2,0,this.direction2)}}class J{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=w,this.radiusRange=E,this.directionRandomizer=G}startDirectionFunction(w,E,G,h){const B=G.position.cE(w.getTranslation()).normalize(),y=(0,l.RandomRange)(0,this.directionRandomizer),x=(0,l.RandomRange)(0,this.directionRandomizer),U=(0,l.RandomRange)(0,this.directionRandomizer);B.x+=y,B.y+=x,B.z+=U,B.normalize(),h?E.B(B):P.QE.TransformNormalFromFloatsToRef(B.x,B.y,B.z,w,E)}startPositionFunction(w,E,G,h){const B=this.radius-(0,l.RandomRange)(0,this.radius*this.radiusRange),y=(0,l.RandomRange)(0,1),x=(0,l.RandomRange)(0,2*Math.PI),U=Math.acos(2*y-1),i=B*Math.cos(x)*Math.sin(U),O=B*Math.cos(U),u=B*Math.sin(x)*Math.sin(U);h?E.tx(i,O,u):P.QE.TransformCoordinatesFromFloatsToRef(i,O,u,w,E)}clone(){const w=new J(this.radius,this.directionRandomizer);return i.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class d extends J{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.QE(0,1,0),G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.QE(0,1,0);super(w),this.direction1=E,this.direction2=G}startDirectionFunction(w,E){const G=(0,l.RandomRange)(this.direction1.x,this.direction2.x),h=(0,l.RandomRange)(this.direction1.y,this.direction2.y),B=(0,l.RandomRange)(this.direction1.z,this.direction2.z);P.QE.TransformNormalFromFloatsToRef(G,h,B,w,E)}clone(){const w=new d(this.radius,this.direction1,this.direction2);return i.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.Lh(),w.direction2=this.direction2.Lh(),w}parse(w){super.parse(w),this.direction1.B(w.direction1),this.direction2.B(w.direction2)}}class K{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(w,E,G,h){const B=P.TmpVectors.QE[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,G,B);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,G,B);const w=P.TmpVectors.QE[1];B.subtractToRef(G.position,w),w.scaleToRef(1/G.lifeTime,B)}else B.set(0,0,0);h?E.B(B):P.QE.TransformNormalToRef(B,w,E)}startPositionFunction(w,E,G,h){const B=P.TmpVectors.QE[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,G,B):B.set(0,0,0),h?E.B(B):P.QE.TransformCoordinatesToRef(B,w,E)}clone(){const w=new K;return i.d.DeepCopy(this,w),w}applyToShader(w){}buildUniformLayout(w){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.particlePositionGenerator=this.particlePositionGenerator,w.particleDestinationGenerator=this.particleDestinationGenerator,w}parse(w){w.particlePositionGenerator&&(this.particlePositionGenerator=w.particlePositionGenerator),w.particleDestinationGenerator&&(this.particleDestinationGenerator=w.particleDestinationGenerator)}}var t=G(11748);class q{get mesh(){return this._mesh}set mesh(w){this._mesh!==w&&(this._mesh=w,w?(this._indices=w.ny(),this._positions=w.getVerticesData(t.g.PositionKind),this._normals=w.getVerticesData(t.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=P.QE.Zero(),this._mesh=null,this.direction1=new P.QE(0,1,0),this.direction2=new P.QE(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=w}startDirectionFunction(w,E,G,h){if(this.useMeshNormalsForDirection&&this._normals)return void P.QE.TransformNormalToRef(this._storedNormal,w,E);const B=(0,l.RandomRange)(this.direction1.x,this.direction2.x),y=(0,l.RandomRange)(this.direction1.y,this.direction2.y),x=(0,l.RandomRange)(this.direction1.z,this.direction2.z);h?E.tx(B,y,x):P.QE.TransformNormalFromFloatsToRef(B,y,x,w,E)}startPositionFunction(w,E,G,h){if(!this._indices||!this._positions)return;const B=3*(Math.random()*(this._indices.length/3)|0),y=Math.random(),x=Math.random()*(1-y),U=1-y-x,l=this._indices[B],i=this._indices[B+1],O=this._indices[B+2],u=P.TmpVectors.QE[0],V=P.TmpVectors.QE[1],a=P.TmpVectors.QE[2],Q=P.TmpVectors.QE[3];P.QE.FromArrayToRef(this._positions,3*l,u),P.QE.FromArrayToRef(this._positions,3*i,V),P.QE.FromArrayToRef(this._positions,3*O,a),Q.x=y*u.x+x*V.x+U*a.x,Q.y=y*u.y+x*V.y+U*a.y,Q.z=y*u.z+x*V.z+U*a.z,h?E.tx(Q.x,Q.y,Q.z):P.QE.TransformCoordinatesFromFloatsToRef(Q.x,Q.y,Q.z,w,E),this.useMeshNormalsForDirection&&this._normals&&(P.QE.FromArrayToRef(this._normals,3*l,u),P.QE.FromArrayToRef(this._normals,3*i,V),P.QE.FromArrayToRef(this._normals,3*O,a),this._storedNormal.x=y*u.x+x*V.x+U*a.x,this._storedNormal.y=y*u.y+x*V.y+U*a.y,this._storedNormal.z=y*u.z+x*V.z+U*a.z)}clone(){const w=new q(this.mesh);return i.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var w;const E={};return E.type=this.getClassName(),E.direction1=this.direction1.Lh(),E.direction2=this.direction2.Lh(),E.meshId=null===(w=this.mesh)||void 0===w?void 0:w.id,E.useMeshNormalsForDirection=this.useMeshNormalsForDirection,E}parse(w,E){P.QE.FromArrayToRef(w.direction1,0,this.direction1),P.QE.FromArrayToRef(w.direction2,0,this.direction2),w.meshId&&E&&(this.mesh=E.getLastMeshById(w.meshId)),this.useMeshNormalsForDirection=w.useMeshNormalsForDirection}}class W{_isUbo(w){return void 0!==w.addUniform}constructor(w){this._isUbo(w)?(this.setMatrix3x3=w.updateMatrix3x3.bind(w),this.setMatrix2x2=w.updateMatrix2x2.bind(w),this.setFloat=w.updateFloat.bind(w),this.setFloat2=w.updateFloat2.bind(w),this.setFloat3=w.updateFloat3.bind(w),this.setFloat4=w.updateFloat4.bind(w),this.setFloatArray=w.updateFloatArray.bind(w),this.setArray=w.updateArray.bind(w),this.setIntArray=w.updateIntArray.bind(w),this.setMatrix=w.bh.bind(w),this.setMatrices=w.updateMatrices.bind(w),this.setVector3=w.updateVector3.bind(w),this.setVector4=w.updateVector4.bind(w),this.setColor3=w.updateColor3.bind(w),this.setColor4=w.updateColor4.bind(w),this.setDirectColor4=w.updateDirectColor4.bind(w),this.setInt=w.updateInt.bind(w),this.setInt2=w.updateInt2.bind(w),this.setInt3=w.updateInt3.bind(w),this.setInt4=w.updateInt4.bind(w)):(this.setMatrix3x3=w.setMatrix3x3.bind(w),this.setMatrix2x2=w.setMatrix2x2.bind(w),this.setFloat=w.setFloat.bind(w),this.setFloat2=w.setFloat2.bind(w),this.setFloat3=w.setFloat3.bind(w),this.setFloat4=w.setFloat4.bind(w),this.setFloatArray=w.setFloatArray.bind(w),this.setArray=w.setArray.bind(w),this.setIntArray=w.setIntArray.bind(w),this.setMatrix=w.setMatrix.bind(w),this.setMatrices=w.setMatrices.bind(w),this.setVector3=w.setVector3.bind(w),this.setVector4=w.setVector4.bind(w),this.setColor3=w.setColor3.bind(w),this.setColor4=w.setColor4.bind(w),this.setDirectColor4=w.setDirectColor4.bind(w),this.setInt=w.setInt.bind(w),this.setInt2=w.setInt2.bind(w),this.setInt3=w.setInt3.bind(w),this.setInt4=w.setInt4.bind(w))}}var T=G(11595);const I="gpuUpdateParticlesPixelShader",j="#version 300 es\nvoid main() {discard;}\n";T.b.ShadersStore[I]||(T.b.ShadersStore[I]=j);const g="gpuUpdateParticlesVertexShader",o="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";T.b.ShadersStore[g]||(T.b.ShadersStore[g]=o);(0,x.g)("BABYLON.WebGL2ParticleSystem",class{constructor(w,E){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=w,this._engine=E,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var w;return(null===(w=this._updateEffect)||void 0===w?void 0:w.isReady())??!1}createUpdateBuffer(w){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof K&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=w,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new W(this._updateEffect)}createVertexBuffers(w,E){this._updateVAO.push(this._createUpdateVAO(w)),this._renderVAO.push(this._engine.recordVertexArrayObject(E,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=E}createParticleBuffer(w){return w}bindDrawBuffers(w,E,G){G?this._engine.bindBuffers(this._renderVertexBuffers,G,E):this._engine.bindVertexArrayObject(this._renderVAO[w],null)}preUpdateParticleBuffer(){const w=this._engine;if(this._engine.enableEffect(this._updateEffect),!w.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(w,E,G){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[w],null);const P=this._engine;P.bindTransformFeedbackBuffer(E.getBuffer()),P.setRasterizerState(!1),P.beginTransformFeedback(!0),P.drawArraysType(3,0,G),P.endTransformFeedback(),P.setRasterizerState(!0),P.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let w=0;w<this._updateVAO.length;w++)this._engine.releaseVertexArrayObject(this._updateVAO[w]);this._updateVAO.length=0;for(let w=0;w<this._renderVAO.length;w++)this._engine.releaseVertexArrayObject(this._renderVAO[w]);this._renderVAO.length=0}_createUpdateVAO(w){const E={};E.position=w.createVertexBuffer("position",0,3);let G=3;E.age=w.createVertexBuffer("age",G,1),G+=1,E.size=w.createVertexBuffer("size",G,3),G+=3,E.life=w.createVertexBuffer("life",G,1),G+=1,E.seed=w.createVertexBuffer("seed",G,4),G+=4,E.direction=w.createVertexBuffer("direction",G,3),G+=3,this._parent.particleEmitterType instanceof K&&(E.initialPosition=w.createVertexBuffer("initialPosition",G,3),G+=3),this._parent._colorGradientsTexture||(E.color=w.createVertexBuffer("color",G,4),G+=4),this._parent._isBillboardBased||(E.initialDirection=w.createVertexBuffer("initialDirection",G,3),G+=3),this._parent.noiseTexture&&(E.noiseCoordinates1=w.createVertexBuffer("noiseCoordinates1",G,3),G+=3,E.noiseCoordinates2=w.createVertexBuffer("noiseCoordinates2",G,3),G+=3),this._parent._angularSpeedGradientsTexture?(E.angle=w.createVertexBuffer("angle",G,1),G+=1):(E.angle=w.createVertexBuffer("angle",G,2),G+=2),this._parent._isAnimationSheetEnabled&&(E.cellIndex=w.createVertexBuffer("cellIndex",G,1),G+=1,this._parent.spriteRandomStartCell&&(E.cellStartOffset=w.createVertexBuffer("cellStartOffset",G,1),G+=1));const P=this._engine.recordVertexArrayObject(E,null,this._updateEffect);return this._engine.bindArrayBuffer(null),P}});class f{constructor(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,P=arguments.length>3?arguments[3]:void 0;this._engine=w,this._label=P,this._engine._storageBuffers.push(this),this._create(E,G)}_create(w,E){this._bufferSize=w,this._creationFlags=E,this._buffer=this._engine.createStorageBuffer(w,E,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(w,E,G){this._buffer&&this._engine.updateStorageBuffer(this._buffer,w,E,G)}async read(w,E,G,P){return await this._engine.readFromStorageBuffer(this._buffer,w,E,G,P)}dispose(){const w=this._engine._storageBuffers,E=w.indexOf(this);-1!==E&&(w[E]=w[w.length-1],w.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var k=G(11668),N=G(11671),v=G(11706),C=G(11663),s=G(11961),F=G(11518),M=G(11630),p=G(11879);class D{constructor(){this._gpuTimeInFrameId=-1,this.counter=new p.c}_addDuration(w,E){w<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==w?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(E,!1),this._gpuTimeInFrameId=w):this.counter.addCount(E,!1))}}var e=G(11576);class R{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=w,this._engine=E,this.uniqueId=s.d.UniqueId,E.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new D),this._engine.getCaps().supportComputeShaders?P.bindingsMapping?(this._context=E.createComputeContext(),this._shaderPath=G,this._options={bindingsMapping:{},defines:[],...P}):F.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):F.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(w,E){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const P=this._bindings[w];this._bindings[w]={type:G?0:4,object:E,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!P||P.object!==E||P.type!==this._bindings[w].type)}setStorageTexture(w,E){const G=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!G||G.object!==E),this._bindings[w]={type:1,object:E,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}setExternalTexture(w,E){const G=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!G||G.object!==E),this._bindings[w]={type:6,object:E,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}setVideoTexture(w,E){return!!E.externalTexture&&(this.setExternalTexture(w,E.externalTexture),!0)}setUniformBuffer(w,E){const G=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!G||G.object!==E),this._bindings[w]={type:R._BufferIsDataBuffer(E)?7:2,object:E,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}setStorageBuffer(w,E){const G=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!G||G.object!==E),this._bindings[w]={type:R._BufferIsDataBuffer(E)?7:3,object:E,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}setTextureSampler(w,E){const G=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!G||!E.compareSampler(G.object)),this._bindings[w]={type:5,object:E,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}isReady(){let w=this._effect;for(const h in this._bindings){const w=this._bindings[h],E=w.type,G=w.object;switch(E){case 0:case 4:case 1:if(!G.isReady())return!1;break;case 6:if(!G.isReady())return!1;break}}const E=[],G=this._shaderPath;if(this._options.defines)for(let h=0;h<this._options.defines.length;h++)E.push(this._options.defines[h]);const P=E.join("\n");return this._cachedDefines!==P&&(this._cachedDefines=P,w=this._engine.createComputeEffect(G,{defines:P,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=w),!!w.isReady()}dispatch(w,E,G){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,w,E,G,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const G=R._BufferIsDataBuffer(w)?w:w.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,G,E,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const E in this._bindings){const G=this._bindings[E];if(!this._options.bindingsMapping[E])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+E+"'");switch(G.type){case 0:{const P=this._samplers[E],h=G.object;var w;if(!P||!h._texture||!P.compareSampler(h._texture))this._samplers[E]=(new M.c).setParameters(h.wrapU,h.wrapV,h.wrapR,h.anisotropicFilteringLevel,h._texture.samplingMode,null===(w=h._texture)||void 0===w?void 0:w._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const w=G.object;w.getBuffer()!==G.buffer&&(G.buffer=w.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((h=>{(0,e.g)((()=>this.dispatch(w,E,G)),h,void 0,P)}))}serialize(){const w=v.b.Serialize(this);w.options=this._options,w.shaderPath=this._shaderPath,w.iu={},w.textures={};for(const E in this._bindings){const G=this._bindings[E],P=G.object;switch(G.type){case 0:case 4:case 1:{const h=P.serialize();h&&(w.textures[E]=h,w.iu[E]={type:G.type});break}}}return w}static Parse(w,E,G){const P=v.b.Parse((()=>new R(w.name,E.getEngine(),w.shaderPath,w.options)),w,E,G);for(const h in w.textures){const B=w.iu[h],y=C.c.Parse(w.textures[h],E,G);0===B.type?P.setTexture(h,y):4===B.type?P.setTexture(h,y,!1):P.setStorageTexture(h,y)}return P}static _BufferIsDataBuffer(w){return void 0!==w.underlyingResource}}(0,k.c)([(0,N.F)()],R.prototype,"name",void 0),(0,k.c)([(0,N.F)()],R.prototype,"fastMode",void 0),(0,x.g)("BABYLON.ComputeShader",R);var H=G(11932);const z="gpuUpdateParticlesComputeShader",L="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";T.b.ShadersStoreWGSL[z]||(T.b.ShadersStoreWGSL[z]=L);(0,x.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(w,E){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=w,this._engine=E}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var w;return(null===(w=this._updateComputeShader)||void 0===w?void 0:w.isReady())??!1}createUpdateBuffer(w){var E;const G={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(G.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(G.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(G.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(G.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(G.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(G.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(G.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new R("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:G,defines:w.split("\n")}),null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=new H.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new W(this._simParamsComputeShader)}createVertexBuffers(w,E){this._renderVertexBuffers.push(E)}createParticleBuffer(w){const E=new f(this._engine,4*w.length,11,"ComputeShaderParticleSystemBuffer");return E.update(w),this._bufferComputeShader.push(E),E.getBuffer()}bindDrawBuffers(w,E,G){this._engine.bindBuffers(this._renderVertexBuffers[w],G,E)}preUpdateParticleBuffer(){}updateParticleBuffer(w,E,G){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[w]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^w]),this._updateComputeShader.dispatch(Math.ceil(G/64))}releaseBuffers(){var w;for(let E=0;E<this._bufferComputeShader.length;++E)this._bufferComputeShader[E].dispose();this._bufferComputeShader.length=0,null===(w=this._simParamsComputeShader)||void 0===w||w.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class m{constructor(w,E,G){this.gradient=w,this.color1=E,this.color2=G}getColorToRef(w){this.color2?y.Tx.LerpToRef(this.color1,this.color2,Math.random(),w):w.B(this.color1)}}class n{constructor(w,E){this.gradient=w,this.color=E}}class r{constructor(w,E,G){this.gradient=w,this.factor1=E,this.factor2=G}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class Y{static GetCurrentGradient(w,E,G){if(E[0].gradient>w)return void G(E[0],E[0],1);for(let h=0;h<E.length-1;h++){const P=E[h],B=E[h+1];if(w>=P.gradient&&w<=B.gradient){return void G(P,B,(w-P.gradient)/(B.gradient-P.gradient))}}const P=E.length-1;G(E[P],E[P],1)}}var S=G(11504),X=G(12132),b=G(11543);class A{constructor(w){this.particleSystem=w,this.position=P.QE.Zero(),this.direction=P.QE.Zero(),this.color=new y.Tx(0,0,0,0),this.colorStep=new y.Tx(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new P.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new y.Tx(0,0,0,0),this._currentColor2=new y.Tx(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=A._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let w=this.age,E=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===E?(E=1,w=this._randomCellOffset):w+=this._randomCellOffset);const G=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let P;P=this._initialSpriteCellLoop?(0,l.Clamp)(w*E%this.lifeTime/this.lifeTime):(0,l.Clamp)(w*E/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+P*G|0}_inheritParticleInfoToSubEmitter(w){if(w.particleSystem.hE.position){const E=w.particleSystem.hE;if(E.position.B(this.position),w.inheritDirection){const w=P.TmpVectors.QE[0];this.direction.normalizeToRef(w),E.setDirection(w,0,Math.PI/2)}}else{w.particleSystem.hE.B(this.position)}this.direction.scaleToRef(w.inheritedVelocityAmount/2,P.TmpVectors.QE[0]),w.particleSystem._inheritedVelocityOffset.B(P.TmpVectors.QE[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const w of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(w)}_reset(){this.age=0,this.id=A._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(w){w.position.B(this.position),this._initialDirection?w._initialDirection?w._initialDirection.B(this._initialDirection):w._initialDirection=this._initialDirection.clone():w._initialDirection=null,w.direction.B(this.direction),this.wU&&(w.wU?w.wU.B(this.wU):w.wU=this.wU.clone()),w.color.B(this.color),w.colorStep.B(this.colorStep),w.lifeTime=this.lifeTime,w.age=this.age,w._randomCellOffset=this._randomCellOffset,w.size=this.size,w.scale.B(this.scale),w.angle=this.angle,w.angularSpeed=this.angularSpeed,w.particleSystem=this.particleSystem,w.cellIndex=this.cellIndex,w.id=this.id,w._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(w._currentColorGradient=this._currentColorGradient,w._currentColor1.B(this._currentColor1),w._currentColor2.B(this._currentColor2)),this._currentSizeGradient&&(w._currentSizeGradient=this._currentSizeGradient,w._currentSize1=this._currentSize1,w._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(w._currentAngularSpeedGradient=this._currentAngularSpeedGradient,w._currentAngularSpeed1=this._currentAngularSpeed1,w._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(w._currentVelocityGradient=this._currentVelocityGradient,w._currentVelocity1=this._currentVelocity1,w._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(w._currentLimitVelocityGradient=this._currentLimitVelocityGradient,w._currentLimitVelocity1=this._currentLimitVelocity1,w._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(w._currentDragGradient=this._currentDragGradient,w._currentDrag1=this._currentDrag1,w._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(w._initialStartSpriteCellId=this._initialStartSpriteCellId,w._initialEndSpriteCellId=this._initialEndSpriteCellId,w._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(w.remapData&&this.remapData?w.remapData.B(this.remapData):w.remapData=new P.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(w._randomNoiseCoordinates1?(w._randomNoiseCoordinates1.B(this._randomNoiseCoordinates1),w._randomNoiseCoordinates2.B(this._randomNoiseCoordinates2)):(w._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),w._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}A._Count=0;var ww=G(11787),Ew=(G(11837),G(12029)),Gw=G(12020),Pw=G(11930);function hw(w,E){const G=(0,l.RandomRange)(0,1);y.Tx.LerpToRef(E.color1,E.color2,G,w.color),E.colorDead.subtractToRef(w.color,E._colorDiff),E._colorDiff.scaleToRef(1/w.lifeTime,w.colorStep)}function Bw(w,E){w._currentColorGradient=E._colorGradients[0],w._currentColorGradient.getColorToRef(w.color),w._currentColor1.B(w.color),E._colorGradients.length>1?E._colorGradients[1].getColorToRef(w._currentColor2):w._currentColor2.B(w.color)}function yw(w,E){const G=E._colorGradients;Y.GetCurrentGradient(E._ratio,G,((E,G,P)=>{E!==w._currentColorGradient&&(w._currentColor1.B(w._currentColor2),G.getColorToRef(w._currentColor2),w._currentColorGradient=E),y.Tx.LerpToRef(w._currentColor1,w._currentColor2,P,w.color)}))}function xw(w,E){w.colorStep.scaleToRef(E._scaledUpdateSpeed,E._scaledColorStep),w.color.addInPlace(E._scaledColorStep),w.color.a<0&&(w.color.a=0)}function Uw(w,E){Y.GetCurrentGradient(E._ratio,E._angularSpeedGradients,((E,G,P)=>{E!==w._currentAngularSpeedGradient&&(w._currentAngularSpeed1=w._currentAngularSpeed2,w._currentAngularSpeed2=G.getFactor(),w._currentAngularSpeedGradient=E),w.angularSpeed=(0,l.Lerp)(w._currentAngularSpeed1,w._currentAngularSpeed2,P)}))}function lw(w,E){w.angle+=w.angularSpeed*E._scaledUpdateSpeed}function iw(w,E){E.particleEmitterType.startDirectionFunction(E._emitterWorldMatrix,w.direction,w,E.isLocal,E._emitterInverseWorldMatrix)}function Ow(w,E){E.startDirectionFunction(E._emitterWorldMatrix,w.direction,w,E.isLocal)}function uw(w,E){w._currentVelocityGradient=E._velocityGradients[0],w._currentVelocity1=w._currentVelocityGradient.getFactor(),E._velocityGradients.length>1?w._currentVelocity2=E._velocityGradients[1].getFactor():w._currentVelocity2=w._currentVelocity1}function Vw(w,E){w._currentLimitVelocityGradient=E._limitVelocityGradients[0],w._currentLimitVelocity1=w._currentLimitVelocityGradient.getFactor(),E._limitVelocityGradients.length>1?w._currentLimitVelocity2=E._limitVelocityGradients[1].getFactor():w._currentLimitVelocity2=w._currentLimitVelocity1}function aw(w,E){Y.GetCurrentGradient(E._ratio,E._velocityGradients,((G,P,h)=>{G!==w._currentVelocityGradient&&(w._currentVelocity1=w._currentVelocity2,w._currentVelocity2=P.getFactor(),w._currentVelocityGradient=G),E._directionScale*=(0,l.Lerp)(w._currentVelocity1,w._currentVelocity2,h)}))}function Qw(w,E){Y.GetCurrentGradient(E._ratio,E._limitVelocityGradients,((G,P,h)=>{G!==w._currentLimitVelocityGradient&&(w._currentLimitVelocity1=w._currentLimitVelocity2,w._currentLimitVelocity2=P.getFactor(),w._currentLimitVelocityGradient=G);const B=(0,l.Lerp)(w._currentLimitVelocity1,w._currentLimitVelocity2,h);w.direction.length()>B&&w.direction.scaleInPlace(E.limitVelocityDamping)}))}function cw(w,E){w.direction.scaleToRef(E._directionScale,E._scaledDirection)}function Zw(w,E){E.particleEmitterType.startPositionFunction(E._emitterWorldMatrix,w.position,w,E.isLocal)}function Jw(w,E){E.startPositionFunction(E._emitterWorldMatrix,w.position,w,E.isLocal)}function dw(w,E){w.wU?w.wU.B(w.position):w.wU=w.position.clone(),P.QE.TransformCoordinatesToRef(w.wU,E._emitterWorldMatrix,w.position)}function Kw(w,E){E.isLocal&&w.wU?(w.wU.addInPlace(E._scaledDirection),P.QE.TransformCoordinatesToRef(w.wU,E._emitterWorldMatrix,w.position)):w.position.addInPlace(E._scaledDirection)}function tw(w,E){w._currentDragGradient=E._dragGradients[0],w._currentDrag1=w._currentDragGradient.getFactor(),E._dragGradients.length>1?w._currentDrag2=E._dragGradients[1].getFactor():w._currentDrag2=w._currentDrag1}function qw(w,E){Y.GetCurrentGradient(E._ratio,E._dragGradients,((G,P,h)=>{G!==w._currentDragGradient&&(w._currentDrag1=w._currentDrag2,w._currentDrag2=P.getFactor(),w._currentDragGradient=G);const B=(0,l.Lerp)(w._currentDrag1,w._currentDrag2,h);E._scaledDirection.scaleInPlace(1-B)}))}function Ww(w,E){w._randomNoiseCoordinates1?(w._randomNoiseCoordinates1.tx(Math.random(),Math.random(),Math.random()),w._randomNoiseCoordinates2.tx(Math.random(),Math.random(),Math.random())):(w._randomNoiseCoordinates1=new P.QE(Math.random(),Math.random(),Math.random()),w._randomNoiseCoordinates2=new P.QE(Math.random(),Math.random(),Math.random()))}function Tw(w,E){const G=E._noiseTextureData,h=E._noiseTextureSize;if(G&&h&&w._randomNoiseCoordinates1){const B=E._fetchR(w._randomNoiseCoordinates1.x,w._randomNoiseCoordinates1.y,h.width,h.height,G),y=E._fetchR(w._randomNoiseCoordinates1.z,w._randomNoiseCoordinates2.x,h.width,h.height,G),x=E._fetchR(w._randomNoiseCoordinates2.y,w._randomNoiseCoordinates2.z,h.width,h.height,G),U=P.TmpVectors.QE[0],l=P.TmpVectors.QE[1];U.tx((2*B-1)*E.noiseStrength.x,(2*y-1)*E.noiseStrength.y,(2*x-1)*E.noiseStrength.z),U.scaleToRef(E._tempScaledUpdateSpeed,l),w.direction.addInPlace(l)}}function Iw(w,E){E.gravity.scaleToRef(E._tempScaledUpdateSpeed,E._scaledGravity),w.direction.addInPlace(E._scaledGravity)}function jw(w,E){w.size=(0,l.RandomRange)(E.minSize,E.maxSize),w.scale.tx((0,l.RandomRange)(E.minScaleX,E.maxScaleX),(0,l.RandomRange)(E.minScaleY,E.maxScaleY))}function gw(w,E){w._currentSizeGradient=E._sizeGradients[0],w._currentSize1=w._currentSizeGradient.getFactor(),w.size=w._currentSize1,E._sizeGradients.length>1?w._currentSize2=E._sizeGradients[1].getFactor():w._currentSize2=w._currentSize1,w.scale.tx((0,l.RandomRange)(E.minScaleX,E.maxScaleX),(0,l.RandomRange)(E.minScaleY,E.maxScaleY))}function ow(w,E){const G=E._actualFrame/E.targetStopDuration;Y.GetCurrentGradient(G,E._startSizeGradients,((G,P,h)=>{G!==E._currentStartSizeGradient&&(E._currentStartSize1=E._currentStartSize2,E._currentStartSize2=P.getFactor(),E._currentStartSizeGradient=G);const B=(0,l.Lerp)(E._currentStartSize1,E._currentStartSize2,h);w.scale.scaleInPlace(B)}))}function fw(w,E){Y.GetCurrentGradient(E._ratio,E._sizeGradients,((E,G,P)=>{E!==w._currentSizeGradient&&(w._currentSize1=w._currentSize2,w._currentSize2=G.getFactor(),w._currentSizeGradient=E),w.size=(0,l.Lerp)(w._currentSize1,w._currentSize2,P)}))}function kw(w,E){w.remapData=new P.Vector4(0,1,0,1)}function Nw(w,E){E._colorRemapGradients&&E._colorRemapGradients.length>0&&Y.GetCurrentGradient(E._ratio,E._colorRemapGradients,((E,G,P)=>{const h=(0,l.Lerp)(E.factor1,G.factor1,P),B=(0,l.Lerp)(E.factor2,G.factor2,P);w.remapData.x=h,w.remapData.y=B-h})),E._alphaRemapGradients&&E._alphaRemapGradients.length>0&&Y.GetCurrentGradient(E._ratio,E._alphaRemapGradients,((E,G,P)=>{const h=(0,l.Lerp)(E.factor1,G.factor1,P),B=(0,l.Lerp)(E.factor2,G.factor2,P);w.remapData.z=h,w.remapData.w=B-h}))}function vw(w,E){const G=(0,l.Clamp)(E._actualFrame/E.targetStopDuration);Y.GetCurrentGradient(G,E._lifeTimeGradients,((E,P)=>{const h=E,B=P,y=h.getFactor(),x=B.getFactor(),U=(G-h.gradient)/(B.gradient-h.gradient);w.lifeTime=(0,l.Lerp)(y,x,U)})),E._emitPower=(0,l.RandomRange)(E.minEmitPower,E.maxEmitPower)}function Cw(w,E){w.lifeTime=(0,l.RandomRange)(E.minLifeTime,E.maxLifeTime),E._emitPower=(0,l.RandomRange)(E.minEmitPower,E.maxEmitPower)}function sw(w,E){0===E._emitPower?(w._initialDirection?w._initialDirection.B(w.direction):w._initialDirection=w.direction.clone(),w.direction.set(0,0,0)):(w._initialDirection=null,w.direction.scaleInPlace(E._emitPower)),w.direction.addInPlace(E._inheritedVelocityOffset)}function Fw(w,E){w.angularSpeed=(0,l.RandomRange)(E.minAngularSpeed,E.maxAngularSpeed),w.angle=(0,l.RandomRange)(E.minInitialRotation,E.maxInitialRotation)}function Mw(w,E){w._currentAngularSpeedGradient=E._angularSpeedGradients[0],w.angularSpeed=w._currentAngularSpeedGradient.getFactor(),w._currentAngularSpeed1=w.angularSpeed,E._angularSpeedGradients.length>1?w._currentAngularSpeed2=E._angularSpeedGradients[1].getFactor():w._currentAngularSpeed2=w._currentAngularSpeed1,w.angle=(0,l.RandomRange)(E.minInitialRotation,E.maxInitialRotation)}function pw(w,E){w._initialStartSpriteCellId=E.startSpriteCellID,w._initialEndSpriteCellId=E.endSpriteCellID,w._initialSpriteCellLoop=E.spriteCellLoop}function Dw(w,E){w.previousItem=E.previousItem,w.nextItem=E,E.previousItem&&(E.previousItem.nextItem=w),E.previousItem=w}function ew(w,E){w.previousItem=E,w.nextItem=E.nextItem,E.nextItem&&(E.nextItem.previousItem=w),E.nextItem=w}function Rw(w,E){let G=E;for(;G.nextItem;)G=G.nextItem;w.previousItem=G,w.nextItem=G.nextItem,G.nextItem=w}function Hw(w){w.previousItem&&(w.previousItem.nextItem=w.nextItem),w.nextItem&&(w.nextItem.previousItem=w.previousItem)}class zw extends U{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(w){this._startDirectionFunction!==w&&(this._startDirectionFunction=w,this._directionProcessing.process=w?Ow:iw)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(w){this._startPositionFunction!==w&&(this._startPositionFunction=w,this._positionCreation.process=w?Jw:Zw)}set onDispose(w){this._onDisposeObserver&&this.qh.remove(this._onDisposeObserver),this._onDisposeObserver=this.qh.add(w)}get O(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(w){this._useRampGradients!==w&&(this._useRampGradients=w,this._resetEffect(),w?(this._rampCreation={process:kw,previousItem:null,nextItem:null},ew(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Nw,previousItem:null,nextItem:null},ew(this._remapGradientProcessing,this._gravityProcessing)):(Hw(this._rampCreation),Hw(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(w){this._isLocal!==w&&(this._isLocal=w,w?(this._isLocalCreation={process:dw,previousItem:null,nextItem:null},ew(this._isLocalCreation,this._positionCreation)):Hw(this._isLocalCreation))}get particles(){return this.Bu}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(w){this._animationSheetEnabled!==w&&(this._animationSheetEnabled=w,w?(this._sheetCreation={process:pw,previousItem:null,nextItem:null},ew(this._sheetCreation,this._colorCreation)):Hw(this._sheetCreation),this._reset())}getActiveCount(){return this.Bu.length}getClassName(){return"nx"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var w;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(w=this._customWrappers[E])||void 0===w?void 0:w.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[w]??this._customWrappers[0]}setCustomEffect(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new ww.c(this._engine),this._customWrappers[E].effect=w,this._customWrappers[E].drawContext&&(this._customWrappers[E].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(w){if(this.noiseTexture!==w){if(this._noiseTexture=w,!w)return Hw(this._noiseCreation),void Hw(this._noiseProcessing);this._noiseCreation={process:Ww,previousItem:null,nextItem:null},ew(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Tw,previousItem:null,nextItem:null},ew(this._noiseProcessing,this._positionProcessing)}}constructor(w,E,G){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(w),this._emitterInverseWorldMatrix=P.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new P.QE,this.qh=new S.d,this.onStoppedObservable=new S.d,this.onStartedObservable=new S.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Bu=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new y.Tx(0,0,0,0),this._colorDiff=new y.Tx(0,0,0,0),this._scaledDirection=P.QE.Zero(),this._scaledGravity=P.QE.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=w=>{},this.recycleParticle=w=>{const E=this.Bu.pop();E!==w&&E.copyTo(w),this._stockParticles.push(E)},this._createParticle=()=>{let w;return 0!==this._stockParticles.length?(w=this._stockParticles.pop(),w._reset()):w=new A(this),this._prepareParticle(w),w},this.paused=!1,this._shadersLoaded=!1,this._capacity=E,this._epsilon=x,G&&"Scene"!==G.getClassName()?(this._engine=G,this.defaultProjectionMatrix=P.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=G||b.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Pu.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Cw,previousItem:null,nextItem:null},this._positionCreation={process:Zw,previousItem:null,nextItem:null},ew(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:iw,previousItem:null,nextItem:null},ew(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:sw,previousItem:null,nextItem:null},ew(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:jw,previousItem:null,nextItem:null},ew(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Fw,previousItem:null,nextItem:null},ew(this._angleCreation,this._sizeCreation),this._colorCreation={process:hw,previousItem:null,nextItem:null},ew(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,U||(this._colorProcessing={process:xw,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:lw,previousItem:null,nextItem:null},ew(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:cw,previousItem:null,nextItem:null},ew(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Kw,previousItem:null,nextItem:null},ew(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Iw,previousItem:null,nextItem:null},ew(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=B,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ww.c(this._engine)},this._customWrappers[0].effect=h,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new O,this.updateFunction=w=>{var E;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(E=this.noiseTexture.getContent())||void 0===E||E.then((w=>{this._noiseTextureData=w})));const G=w===this.Bu;for(let P=0;P<w.length;P++){const E=w[P];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const h=E.age;if(E.age+=this._tempScaledUpdateSpeed,E.age>E.lifeTime){const w=E.age-h,G=E.lifeTime-h;this._tempScaledUpdateSpeed=G*this._tempScaledUpdateSpeed/w,E.age=E.lifeTime}this._ratio=E.age/E.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let B=this._updateQueueStart;for(;B;)B.process(E,this),B=B.nextItem;if(this._isAnimationSheetEnabled&&!U&&E.updateCellIndex(),E._inheritParticleInfoToSubEmitters(),E.age>=E.lifeTime){if(this._emitFromParticle(E),E._attachedSubEmitters){for(const w of E._attachedSubEmitters)w.particleSystem.disposeOnStop=!0,w.particleSystem.stop();E._attachedSubEmitters=null}this.recycleParticle(E),G&&P--}else;}}}serialize(w){throw new Error("Method not implemented.")}clone(w,E){throw new Error("Method not implemented.")}_addFactorGradient(w,E,G,P){const h=new r(E,G,P);w.push(h),w.sort(((w,E)=>w.gradient<E.gradient?-1:w.gradient>E.gradient?1:0))}_removeFactorGradient(w,E){if(!w)return;let G=0;for(const P of w){if(P.gradient===E){w.splice(G,1);break}G++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=vw:this._lifeTimeCreation.process=Cw}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:ow,previousItem:null,nextItem:null},ew(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Hw(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(w){this.targetStopDuration!==w&&(this._targetStopDuration=w,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(w,E,G){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,w,E,G),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(w){return this._removeFactorGradient(this._lifeTimeGradients,w),this._syncLifeTimeCreation(),this}addSizeGradient(w,E,G){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=gw,this._sizeGradientProcessing={process:fw,previousItem:null,nextItem:null},Dw(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,w,E,G),this}removeSizeGradient(w){var E;return this._removeFactorGradient(this._sizeGradients,w),0===(null===(E=this._sizeGradients)||void 0===E?void 0:E.length)&&(Hw(this._sizeGradientProcessing),this._sizeCreation.process=jw),this}addColorRemapGradient(w,E,G){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,w,E,G),this}removeColorRemapGradient(w){return this._removeFactorGradient(this._colorRemapGradients,w),this}addAlphaRemapGradient(w,E,G){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,w,E,G),this}removeAlphaRemapGradient(w){return this._removeFactorGradient(this._alphaRemapGradients,w),this}addAngularSpeedGradient(w,E,G){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Mw,this._angularSpeedGradientProcessing={process:Uw,previousItem:null,nextItem:null},Dw(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,w,E,G),this}removeAngularSpeedGradient(w){var E;return this._removeFactorGradient(this._angularSpeedGradients,w),0===(null===(E=this._angularSpeedGradients)||void 0===E?void 0:E.length)&&(this._angleCreation.process=Fw,Hw(this._angularSpeedGradientProcessing)),this}addVelocityGradient(w,E,G){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:uw,previousItem:null,nextItem:null},ew(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:aw,previousItem:null,nextItem:null},Dw(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,w,E,G),this}removeVelocityGradient(w){var E;return this._removeFactorGradient(this._velocityGradients,w),0===(null===(E=this._velocityGradients)||void 0===E?void 0:E.length)&&(Hw(this._velocityCreation),Hw(this._velocityGradientProcessing)),this}addLimitVelocityGradient(w,E,G){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Vw,previousItem:null,nextItem:null},ew(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Qw,previousItem:null,nextItem:null},ew(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,w,E,G),this}removeLimitVelocityGradient(w){var E;return this._removeFactorGradient(this._limitVelocityGradients,w),0===(null===(E=this._limitVelocityGradients)||void 0===E?void 0:E.length)&&(Hw(this._limitVelocityCreation),Hw(this._limitVelocityGradientProcessing)),this}addDragGradient(w,E,G){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:tw,previousItem:null,nextItem:null},Dw(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:qw,previousItem:null,nextItem:null},Dw(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,w,E,G),this}removeDragGradient(w){var E;return this._removeFactorGradient(this._dragGradients,w),0===(null===(E=this._dragGradients)||void 0===E?void 0:E.length)&&(Hw(this._dragCreation),Hw(this._dragGradientProcessing)),this}addEmitRateGradient(w,E,G){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,w,E,G),this}removeEmitRateGradient(w){return this._removeFactorGradient(this._emitRateGradients,w),this}addStartSizeGradient(w,E,G){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,w,E,G),this._syncStartSizeCreation(),this}removeStartSizeGradient(w){return this._removeFactorGradient(this._startSizeGradients,w),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const w=new Uint8Array(4*this._rawTextureWidth),E=y.TmpColors.dE[0];for(let G=0;G<this._rawTextureWidth;G++){const P=G/this._rawTextureWidth;Y.GetCurrentGradient(P,this._rampGradients,((P,h,B)=>{y.dE.LerpToRef(P.color,h.color,B,E),w[4*G]=255*E.r,w[4*G+1]=255*E.g,w[4*G+2]=255*E.b,w[4*G+3]=255}))}this._rampGradientsTexture=X.e.CreateRGBATexture(w,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((w,E)=>w.gradient<E.gradient?-1:w.gradient>E.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(w,E){this._rampGradients||(this._rampGradients=[]);const G=new n(w,E);return this._rampGradients.push(G),this._syncRampGradientTexture(),this}removeRampGradient(w){return this._removeGradientAndTexture(w,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(w,E,G){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Bw,this._colorProcessing.process=yw);const P=new m(w,E,G);return this._colorGradients.push(P),this._colorGradients.sort(((w,E)=>w.gradient<E.gradient?-1:w.gradient>E.gradient?1:0)),this}removeColorGradient(w){if(!this._colorGradients)return this;let E=0;for(const G of this._colorGradients){if(G.gradient===w){this._colorGradients.splice(E,1);break}E++}return 0===this._colorGradients.length&&(this._colorCreation.process=hw,this._colorProcessing.process=xw),this}resetDrawCache(){if(this._drawWrappers){for(const w of this._drawWrappers)if(w)for(const E of w)null===E||void 0===E||E.dispose();this._drawWrappers=[]}}_fetchR(w,E,G,P,h){return h[4*(((w=.5*Math.abs(w)+.5)*G%G|0)+((E=.5*Math.abs(E)+.5)*P%P|0)*G)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const w=this._engine,E=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*E),this._vertexBuffer=new t.d(w,this._vertexData,!0,E);let G=0;const P=this._vertexBuffer.createVertexBuffer(t.g.PositionKind,G,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[t.g.PositionKind]=P,G+=3;const h=this._vertexBuffer.createVertexBuffer(t.g.ColorKind,G,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[t.g.ColorKind]=h,G+=4;const B=this._vertexBuffer.createVertexBuffer("angle",G,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=B,G+=1;const y=this._vertexBuffer.createVertexBuffer("size",G,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=y,G+=2,this._isAnimationSheetEnabled){const w=this._vertexBuffer.createVertexBuffer("cellIndex",G,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=w,G+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const w=this._vertexBuffer.createVertexBuffer("direction",G,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=w,G+=3}if(this._useRampGradients){const w=this._vertexBuffer.createVertexBuffer("remapData",G,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=w,G+=4}let x;if(this._useInstancing){const E=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new t.d(w,E,!1,2),x=this._spriteBuffer.createVertexBuffer("offset",0,2)}else x=this._vertexBuffer.createVertexBuffer("offset",G,2,this._vertexBufferSize,this._useInstancing),G+=2;this._vertexBuffers.offset=x,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const w=[],E=[];let G=0;for(let P=0;P<this._capacity;P++)w.push(G),w.push(G+1),w.push(G+2),w.push(G),w.push(G+2),w.push(G+3),E.push(G,G+1,G+1,G+2,G+2,G+3,G+3,G,G,G+3),G+=4;this._indexBuffer=this._engine.createIndexBuffer(w),this._linesIndexBuffer=this._engine.createIndexBuffer(E)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(w)setTimeout((()=>{this.start(0)}),w);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var E;-1!==(null===(E=this.hE)||void 0===E?void 0:E.getClassName().indexOf("Mesh"))&&this.hE.Ah(!0);const w=this.noiseTexture;if(w&&w.onGeneratedObservable)w.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),w.render()}))}));else for(let E=0;E<this.preWarmCycles;E++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(w))}_postStop(w){}reset(){this._stockParticles.length=0,this.Bu.length=0}_appendParticleVertex(w,E,G,h){let B=w*this._vertexBufferSize;if(this._vertexData[B++]=E.position.x+this.Kl.x,this._vertexData[B++]=E.position.y+this.Kl.y,this._vertexData[B++]=E.position.z+this.Kl.z,this._vertexData[B++]=E.color.r,this._vertexData[B++]=E.color.g,this._vertexData[B++]=E.color.b,this._vertexData[B++]=E.color.a,this._vertexData[B++]=E.angle,this._vertexData[B++]=E.scale.x*E.size,this._vertexData[B++]=E.scale.y*E.size,this._isAnimationSheetEnabled&&(this._vertexData[B++]=E.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[B++]=E.direction.x,this._vertexData[B++]=E.direction.y,this._vertexData[B++]=E.direction.z);else if(E._initialDirection){let w=E._initialDirection;this.isLocal&&(P.QE.TransformNormalToRef(w,this._emitterWorldMatrix,P.TmpVectors.QE[0]),w=P.TmpVectors.QE[0]),0===w.x&&0===w.z&&(w.x=.001),this._vertexData[B++]=w.x,this._vertexData[B++]=w.y,this._vertexData[B++]=w.z}else{let w=E.direction;this.isLocal&&(P.QE.TransformNormalToRef(w,this._emitterWorldMatrix,P.TmpVectors.QE[0]),w=P.TmpVectors.QE[0]),0===w.x&&0===w.z&&(w.x=.001),this._vertexData[B++]=w.x,this._vertexData[B++]=w.y,this._vertexData[B++]=w.z}this._useRampGradients&&E.remapData&&(this._vertexData[B++]=E.remapData.x,this._vertexData[B++]=E.remapData.y,this._vertexData[B++]=E.remapData.z,this._vertexData[B++]=E.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===G?G=this._epsilon:1===G&&(G=1-this._epsilon),0===h?h=this._epsilon:1===h&&(h=1-this._epsilon)),this._vertexData[B++]=G,this._vertexData[B++]=h)}_prepareParticle(w){}_createNewOnes(w){let E;for(let G=0;G<w&&this.Bu.length!==this._capacity;G++){E=this._createParticle(),this.Bu.push(E);let w=this._createQueueStart;for(;w;)w.process(E,this),w=w.nextItem;E._inheritParticleInfoToSubEmitters()}}_update(w){if(this._alive=this.Bu.length>0,this.hE.position){const w=this.hE;this._emitterWorldMatrix=w.getWorldMatrix()}else{const w=this.hE;this._emitterWorldMatrix=P.Matrix.Translation(w.x,w.y,w.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Bu),this._createNewOnes(w)}static _GetAttributeNamesOrOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=[t.g.PositionKind,t.g.ColorKind,"angle","offset","size"];return w&&P.push("cellIndex"),E||P.push("direction"),G&&P.push("remapData"),P}static _GetEffectCreationOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Ew.b)(P),w&&P.push("particlesInfos"),E&&P.push("logarithmicDepthConstant"),G&&(P.push("vFogInfos"),P.push("vFogColor")),P}fillDefines(w,E){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ew.g)(this,this._scene,w),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&w.push("#define FOG")),this._isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&w.push("#define LOGARITHMICDEPTH"),E===U.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&w.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case 2:w.push("#define BILLBOARDY");break;case 8:case 9:w.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&w.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:w.push("#define BILLBOARDMODE_ALL")}G&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(w,E,G){E.push(...zw._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),w.push(...zw._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),G.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Pw.i)(w,this._imageProcessingConfigurationDefines),(0,Pw.e)(G,this._imageProcessingConfigurationDefines))}_getWrapper(w){const E=this._getCustomDrawWrapper(w);if(null!==E&&void 0!==E&&E.effect)return E;const G=[];this.fillDefines(G,w);const P=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let h=this._drawWrappers[P];h||(h=this._drawWrappers[P]=[]);let B=h[w];B||(B=new ww.c(this._engine),B.drawContext&&(B.drawContext.useInstancing=this._useInstancing),h[w]=B);const y=G.join("\n");if(B.defines!==y){const w=[],E=[],G=[];this.fillUniformsAttributesAndSamplerNames(E,w,G),B.setEffect(this._engine.createEffect("particles",w,E,G,y,void 0,void 0,void 0,void 0,this._shaderLanguage),y)}return B}animate(){var w;let E,G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!G&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(G?this.preWarmStepOffset:(null===(w=this._scene)||void 0===w?void 0:w.getAnimationRatio())||1),this.manualEmitCount>-1)E=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let w=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const E=this._actualFrame/this.targetStopDuration;Y.GetCurrentGradient(E,this._emitRateGradients,((E,G,P)=>{E!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=G.getFactor(),this._currentEmitRateGradient=E),w=(0,l.Lerp)(this._currentEmitRate1,this._currentEmitRate2,P)}))}E=w*this._scaledUpdateSpeed|0,this._newPartsExcess+=w*this._scaledUpdateSpeed-E}if(this._newPartsExcess>1&&(E+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?E=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(E),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!G){let w=0;for(let E=0;E<this.Bu.length;E++){const G=this.Bu[E];this._appendParticleVertices(w,G),w+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Bu.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(w,E){this._appendParticleVertex(w++,E,0,0),this._useInstancing||(this._appendParticleVertex(w++,E,1,0),this._appendParticleVertex(w++,E,1,1),this._appendParticleVertex(w++,E,0,1))}rebuild(){var w;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(w=this._spriteBuffer)||void 0===w||w._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!zw.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(G.bind(G,13054)),Promise.resolve().then(G.bind(G,13010))])):await Promise.all([Promise.resolve().then(G.bind(G,12997)),Promise.resolve().then(G.bind(G,12987))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.hE||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==U.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(U.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(U.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(w){const E=this._getWrapper(w),G=E.effect,h=this._engine;h.enableEffect(E);const B=this.defaultViewMatrix??this._scene.getViewMatrix();if(G.setTexture("diffuseSampler",this.particleTexture),G.setMatrix("view",B),G.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const w=this.particleTexture.getBaseSize();G.setFloat3("particlesInfos",this.spriteCellWidth/w.width,this.spriteCellHeight/w.height,this.spriteCellWidth/w.width)}if(G.setVector2("translationPivot",this.translationPivot),G.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const w=this._scene.activeCamera;G.setVector3("eyePosition",w.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),G.setTexture("rampSampler",this._rampGradientsTexture));const y=G.defines;var x,U,l,i,O,u;(this._scene&&((0,Ew.e)(G,this,this._scene),this.applyFog&&(0,Gw.h)(this._scene,void 0,G)),y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(B.invertToRef(P.TmpVectors.Matrix[0]),G.setMatrix("invView",P.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?h.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,G):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,G)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?h.bindBuffers(this._vertexBuffers,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBuffer:this._indexBuffer,G):h.bindBuffers(this._vertexBuffers,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBufferUseInstancing:null,G);(this.useLogarithmicDepth&&this._scene&&(0,Gw.n)(y,G,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(G),this._setEngineBasedOnBlendMode(w),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(G),this._useInstancing)?null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?h.drawElementsType(6,0,10,this.Bu.length):h.drawArraysType(7,0,4,this.Bu.length):null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?h.drawElementsType(1,0,10*this.Bu.length):h.drawElementsType(0,0,6*this.Bu.length);return this.Bu.length}render(){if(!this.isReady()||!this.Bu.length)return 0;const w=this._engine;w.setState&&(w.setState(!1),this.forceDepthWrite&&w.setDepthWrite(!0));let E=0;return E=this.blendMode===U.BLENDMODE_MULTIPLYADD?this._render(U.BLENDMODE_MULTIPLY)+this._render(U.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),E}_onDispose(){}dispose(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),w&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),w&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(E,G),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const w=this._scene.Pu.indexOf(this);w>-1&&this._scene.Pu.splice(w,1),this._scene._activeParticleSystems.dispose()}this.qh.notifyObservers(this),this.qh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}zw.ForceGLSL=!1;var Lw,mw=G(11536);!function(w){w[w.ATTACHED=0]="ATTACHED",w[w.END=1]="END"}(Lw||(Lw={}));class nw{constructor(w){if(this.particleSystem=w,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!w.hE||!w.hE.dispose){const E=(0,x.e)("BABYLON.AbstractMesh");w.hE=new E("SubemitterSystemEmitter",w.Ww()),w._disposeEmitterOnDispose=!0}}clone(){let w=this.particleSystem.hE;if(w){if(w instanceof P.QE)w=w.clone();else if(-1!==w.getClassName().indexOf("Mesh")){w=new((0,x.e)("BABYLON.Mesh"))("",w.Ww()),w.isVisible=!1}}else w=new P.QE;const E=new nw(this.particleSystem.clone(this.particleSystem.name,w));return E.particleSystem.name+="Clone",E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem._disposeEmitterOnDispose=!0,E.particleSystem.disposeOnStop=!0,E}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem=this.particleSystem.serialize(w),E}static _ParseParticleSystem(w,E,G){throw(0,mw.d)("ParseParticle")}static Parse(w,E,G){const P=w.particleSystem,h=new nw(nw._ParseParticleSystem(P,E,G,!0));return h.type=w.type,h.inheritDirection=w.inheritDirection,h.inheritedVelocityAmount=w.inheritedVelocityAmount,h.particleSystem._isSubEmitter=!0,h}dispose(){this.particleSystem.dispose()}}var rw=G(11578);function Yw(w,E){const G=new Z;return G.direction1=w,G.direction2=E,G}function Sw(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Xw(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function bw(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.QE(0,1,0),G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.QE(0,1,0);return new d(w,E,G)}function Aw(){return new a(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function wE(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.QE(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.QE(0,1,0);return new Q(w,E,G,h,B)}function EE(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new u(w,E)}function GE(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.QE(0,1,0),h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.QE(0,1,0);return new V(w,E,G,h)}const PE=P.QE.Zero(),hE=P.QE.Zero(),BE=P.QE.Zero();class yE{constructor(){this.strength=0,this.position=P.QE.Zero()}_processParticle(w,E){this.position.subtractToRef(w.position,PE);const G=PE.lengthSquared()+1;PE.normalize().scaleToRef(this.strength/G,hE),hE.scaleToRef(E._tempScaledUpdateSpeed,BE),w.direction.addInPlace(BE)}serialize(){return{position:this.position.Lh(),strength:this.strength}}}class xE extends zw{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=w=>{if(!this._subEmitters||0===this._subEmitters.length)return;const E=Math.floor(Math.random()*this._subEmitters.length);for(const G of this._subEmitters[E])if(1===G.type){const E=G.clone();w._inheritParticleInfoToSubEmitter(E),E.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(E.particleSystem),E.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(w,E){const G=Yw(w,E);return this.particleEmitterType=G,G}get flowMap(){return this._flowMap}set flowMap(w){this._flowMap!==w&&(this._flowMap=w,this._flowMapUpdate&&(Hw(this._flowMapUpdate),this._flowMapUpdate=null),w&&(this._flowMapUpdate={process:w=>{var E;const G=null===(E=this.Ww())||void 0===E?void 0:E.getTransformMatrix();this._flowMap._processParticle(w,this.flowMapStrength*this._tempScaledUpdateSpeed,G)},previousItem:null,nextItem:null},ew(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(w){this._attractors.push(w),1===this._attractors.length&&(this._attractorUpdate={process:w=>{for(const E of this._attractors)E._processParticle(w,this)},previousItem:null,nextItem:null},ew(this._attractorUpdate,this._directionProcessing))}removeAttractor(w){const E=this._attractors.indexOf(w);-1!==E&&this._attractors.splice(E,1),0===this._attractors.length&&Hw(this._attractorUpdate)}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(w)}createHemisphericEmitter(){const w=Sw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createSphereEmitter(){const w=Xw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createDirectedSphereEmitter(){const w=bw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.QE(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.QE(0,1,0));return this.particleEmitterType=w,w}createCylinderEmitter(){const w=Aw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=w,w}createDirectedCylinderEmitter(){const w=wE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.QE(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.QE(0,1,0));return this.particleEmitterType=w,w}createConeEmitter(){const w=EE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=w,w}createDirectedConeEmitter(){const w=GE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.QE(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.QE(0,1,0));return this.particleEmitterType=w,w}createBoxEmitter(w,E,G,P){const h=new O;return this.particleEmitterType=h,this.direction1=w,this.direction2=E,this.minEmitBox=G,this.maxEmitBox=P,h}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const w of this.subEmitters)w instanceof xE?this._subEmitters.push([new nw(w)]):w instanceof nw?this._subEmitters.push([w]):w instanceof Array&&this._subEmitters.push(w)}_stopSubEmitters(){if(this.activeSubSystems){for(const w of this.activeSubSystems)w.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const w=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==w&&this._rootParticleSystem.activeSubSystems.splice(w,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(w){w&&this._stopSubEmitters()}_prepareParticle(w){if(this._subEmitters&&this._subEmitters.length>0){const E=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];w._attachedSubEmitters=[];for(const G of E)if(0===G.type){const E=G.clone();w._attachedSubEmitters.push(E),E.particleSystem.start()}}}_onDispose(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),w&&this.particles)for(const G of this.particles)if(G._attachedSubEmitters)for(let w=G._attachedSubEmitters.length-1;w>=0;w-=1)G._attachedSubEmitters[w].dispose();if(E&&this.activeSubSystems)for(let G=this.activeSubSystems.length-1;G>=0;G-=1)this.activeSubSystems[G].dispose();if(this._subEmitters&&this._subEmitters.length){for(let w=0;w<this._subEmitters.length;w++)for(const E of this._subEmitters[w])E.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.hE&&this.hE.dispose&&this.hE.dispose(!0)}static _Parse(w,E,G,h){let B;B=G instanceof rw.b?null:G;const U=(0,x.e)("BABYLON.Texture");if(U&&B&&(w.texture?E.particleTexture=U.Parse(w.texture,B,h):w.textureName&&(E.particleTexture=new U(h+w.textureName,B,!1,void 0===w.invertY||w.invertY),E.particleTexture.name=w.textureName)),w.emitterId||0===w.emitterId||void 0!==w.hE?w.emitterId&&B?E.hE=B.getLastMeshById(w.emitterId):E.hE=P.QE.KE(w.hE):E.hE=P.QE.Zero(),E.isLocal=!!w.isLocal,void 0!==w.renderingGroupId&&(E.renderingGroupId=w.renderingGroupId),void 0!==w.isBillboardBased&&(E.isBillboardBased=w.isBillboardBased),void 0!==w.billboardMode&&(E.billboardMode=w.billboardMode),void 0!==w.useLogarithmicDepth&&(E.useLogarithmicDepth=w.useLogarithmicDepth),w.animations){for(let G=0;G<w.animations.length;G++){const P=w.animations[G],h=(0,x.e)("BABYLON.Animation");h&&E.animations.push(h.Parse(P))}E.beginAnimationOnStart=w.beginAnimationOnStart,E.beginAnimationFrom=w.beginAnimationFrom,E.beginAnimationTo=w.beginAnimationTo,E.beginAnimationLoop=w.beginAnimationLoop}if(w.autoAnimate&&B&&B.beginAnimation(E,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),E.startDelay=0|w.startDelay,E.minAngularSpeed=w.minAngularSpeed,E.maxAngularSpeed=w.maxAngularSpeed,E.minSize=w.minSize,E.maxSize=w.maxSize,w.minScaleX&&(E.minScaleX=w.minScaleX,E.maxScaleX=w.maxScaleX,E.minScaleY=w.minScaleY,E.maxScaleY=w.maxScaleY),void 0!==w.preWarmCycles&&(E.preWarmCycles=w.preWarmCycles,E.preWarmStepOffset=w.preWarmStepOffset),void 0!==w.minInitialRotation&&(E.minInitialRotation=w.minInitialRotation,E.maxInitialRotation=w.maxInitialRotation),E.minLifeTime=w.minLifeTime,E.maxLifeTime=w.maxLifeTime,E.minEmitPower=w.minEmitPower,E.maxEmitPower=w.maxEmitPower,E.emitRate=w.emitRate,E.gravity=P.QE.KE(w.gravity),w.noiseStrength&&(E.noiseStrength=P.QE.KE(w.noiseStrength)),E.color1=y.Tx.KE(w.color1),E.color2=y.Tx.KE(w.color2),E.colorDead=y.Tx.KE(w.colorDead),E.updateSpeed=w.updateSpeed,E.targetStopDuration=w.targetStopDuration,E.blendMode=w.blendMode,w.colorGradients)for(const P of w.colorGradients)E.addColorGradient(P.gradient,y.Tx.KE(P.color1),P.color2?y.Tx.KE(P.color2):void 0);if(w.rampGradients){for(const G of w.rampGradients)E.addRampGradient(G.gradient,y.dE.KE(G.color));E.useRampGradients=w.useRampGradients}if(w.colorRemapGradients)for(const P of w.colorRemapGradients)E.addColorRemapGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.alphaRemapGradients)for(const P of w.alphaRemapGradients)E.addAlphaRemapGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.sizeGradients)for(const P of w.sizeGradients)E.addSizeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.angularSpeedGradients)for(const P of w.angularSpeedGradients)E.addAngularSpeedGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.velocityGradients)for(const P of w.velocityGradients)E.addVelocityGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.dragGradients)for(const P of w.dragGradients)E.addDragGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.emitRateGradients)for(const P of w.emitRateGradients)E.addEmitRateGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.startSizeGradients)for(const P of w.startSizeGradients)E.addStartSizeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.lifeTimeGradients)for(const P of w.lifeTimeGradients)E.addLifeTimeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(w.limitVelocityGradients){for(const G of w.limitVelocityGradients)E.addLimitVelocityGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);E.limitVelocityDamping=w.limitVelocityDamping}if(w.noiseTexture&&B){const G=(0,x.e)("BABYLON.ProceduralTexture");E.noiseTexture=G.Parse(w.noiseTexture,B,h)}let l;if(w.particleEmitterType){switch(w.particleEmitterType.type){case"SphereParticleEmitter":l=new J;break;case"SphereDirectedParticleEmitter":l=new d;break;case"ConeEmitter":case"ConeParticleEmitter":l=new u;break;case"ConeDirectedParticleEmitter":l=new V;break;case"CylinderParticleEmitter":l=new a;break;case"CylinderDirectedParticleEmitter":l=new Q;break;case"HemisphericParticleEmitter":l=new c;break;case"PointParticleEmitter":l=new Z;break;case"MeshParticleEmitter":l=new q;break;case"CustomParticleEmitter":l=new K;break;default:l=new O}l.parse(w.particleEmitterType,B)}else l=new O,l.parse(w,B);E.particleEmitterType=l,E.startSpriteCellID=w.startSpriteCellID,E.endSpriteCellID=w.endSpriteCellID,E.spriteCellLoop=w.spriteCellLoop??!0,E.spriteCellWidth=w.spriteCellWidth,E.spriteCellHeight=w.spriteCellHeight,E.spriteCellChangeSpeed=w.spriteCellChangeSpeed,E.spriteRandomStartCell=w.spriteRandomStartCell,E.disposeOnStop=w.disposeOnStop??!1,E.manualEmitCount=w.manualEmitCount??-1}static Parse(w,E,G){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const x=w.name;let U,l,i=null,O=null;if(E instanceof rw.b?U=E:(l=E,U=l.getEngine()),w.customShader&&U.createEffectForParticles){O=w.customShader;const E=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"";i=U.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,E)}const u=new xE(x,B||w.Cx,E,i,w.isAnimationSheetEnabled);if(u.customShader=O,u._rootUrl=G,w.id&&(u.id=w.id),w.subEmitters){u.subEmitters=[];for(const P of w.subEmitters){const w=[];for(const h of P)w.push(nw.Parse(h,E,G));u.subEmitters.push(w)}}if(w.attractors)for(const y of w.attractors){const w=new yE;w.position=P.QE.KE(y.position),w.strength=y.strength,u.addAttractor(w)}return xE._Parse(w,u,E,G),w.textureMask&&(u.textureMask=y.Tx.KE(w.textureMask)),w.Kl&&(u.Kl=P.QE.KE(w.Kl)),w.preventAutoStart&&(u.preventAutoStart=w.preventAutoStart),h||u.preventAutoStart||u.start(),u}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};if(xE._Serialize(E,this,w),E.textureMask=this.textureMask.Lh(),E.customShader=this.customShader,E.preventAutoStart=this.preventAutoStart,E.Kl=this.Kl.Lh(),this.subEmitters){E.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const G of this._subEmitters){const P=[];for(const E of G)P.push(E.serialize(w));E.subEmitters.push(P)}}if(this._attractors&&this._attractors.length){E.attractors=[];for(const w of this._attractors)E.attractors.push(w.serialize())}return E}static _Serialize(w,E,G){if(w.name=E.name,w.id=E.id,w.Cx=E.getCapacity(),w.disposeOnStop=E.disposeOnStop,w.manualEmitCount=E.manualEmitCount,E.hE.position){const G=E.hE;w.emitterId=G.id}else{const G=E.hE;w.hE=G.Lh()}E.particleEmitterType&&(w.particleEmitterType=E.particleEmitterType.serialize()),E.particleTexture&&(G?w.texture=E.particleTexture.serialize():(w.textureName=E.particleTexture.name,w.invertY=!!E.particleTexture._invertY)),w.isLocal=E.isLocal,v.b.AppendSerializedAnimations(E,w),w.beginAnimationOnStart=E.beginAnimationOnStart,w.beginAnimationFrom=E.beginAnimationFrom,w.beginAnimationTo=E.beginAnimationTo,w.beginAnimationLoop=E.beginAnimationLoop,w.startDelay=E.startDelay,w.renderingGroupId=E.renderingGroupId,w.isBillboardBased=E.isBillboardBased,w.billboardMode=E.billboardMode,w.minAngularSpeed=E.minAngularSpeed,w.maxAngularSpeed=E.maxAngularSpeed,w.minSize=E.minSize,w.maxSize=E.maxSize,w.minScaleX=E.minScaleX,w.maxScaleX=E.maxScaleX,w.minScaleY=E.minScaleY,w.maxScaleY=E.maxScaleY,w.minEmitPower=E.minEmitPower,w.maxEmitPower=E.maxEmitPower,w.minLifeTime=E.minLifeTime,w.maxLifeTime=E.maxLifeTime,w.emitRate=E.emitRate,w.gravity=E.gravity.Lh(),w.noiseStrength=E.noiseStrength.Lh(),w.color1=E.color1.Lh(),w.color2=E.color2.Lh(),w.colorDead=E.colorDead.Lh(),w.updateSpeed=E.updateSpeed,w.targetStopDuration=E.targetStopDuration,w.blendMode=E.blendMode,w.preWarmCycles=E.preWarmCycles,w.preWarmStepOffset=E.preWarmStepOffset,w.minInitialRotation=E.minInitialRotation,w.maxInitialRotation=E.maxInitialRotation,w.startSpriteCellID=E.startSpriteCellID,w.spriteCellLoop=E.spriteCellLoop,w.endSpriteCellID=E.endSpriteCellID,w.spriteCellChangeSpeed=E.spriteCellChangeSpeed,w.spriteCellWidth=E.spriteCellWidth,w.spriteCellHeight=E.spriteCellHeight,w.spriteRandomStartCell=E.spriteRandomStartCell,w.isAnimationSheetEnabled=E.isAnimationSheetEnabled,w.useLogarithmicDepth=E.useLogarithmicDepth;const P=E.getColorGradients();if(P){w.colorGradients=[];for(const E of P){const G={gradient:E.gradient,color1:E.color1.Lh()};E.color2?G.color2=E.color2.Lh():G.color2=E.color1.Lh(),w.colorGradients.push(G)}}const h=E.getRampGradients();if(h){w.rampGradients=[];for(const E of h){const G={gradient:E.gradient,color:E.color.Lh()};w.rampGradients.push(G)}w.useRampGradients=E.useRampGradients}const B=E.getColorRemapGradients();if(B){w.colorRemapGradients=[];for(const E of B){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.colorRemapGradients.push(G)}}const y=E.getAlphaRemapGradients();if(y){w.alphaRemapGradients=[];for(const E of y){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.alphaRemapGradients.push(G)}}const x=E.getSizeGradients();if(x){w.sizeGradients=[];for(const E of x){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.sizeGradients.push(G)}}const U=E.getAngularSpeedGradients();if(U){w.angularSpeedGradients=[];for(const E of U){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.angularSpeedGradients.push(G)}}const l=E.getVelocityGradients();if(l){w.velocityGradients=[];for(const E of l){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.velocityGradients.push(G)}}const i=E.getDragGradients();if(i){w.dragGradients=[];for(const E of i){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.dragGradients.push(G)}}const O=E.getEmitRateGradients();if(O){w.emitRateGradients=[];for(const E of O){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.emitRateGradients.push(G)}}const u=E.getStartSizeGradients();if(u){w.startSizeGradients=[];for(const E of u){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.startSizeGradients.push(G)}}const V=E.getLifeTimeGradients();if(V){w.lifeTimeGradients=[];for(const E of V){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.lifeTimeGradients.push(G)}}const a=E.getLimitVelocityGradients();if(a){w.limitVelocityGradients=[];for(const E of a){const G={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?G.factor2=E.factor2:G.factor2=E.factor1,w.limitVelocityGradients.push(G)}w.limitVelocityDamping=E.limitVelocityDamping}E.noiseTexture&&(w.noiseTexture=E.noiseTexture.serialize())}clone(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P={...this._customWrappers};let h=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){h=this.customShader;const w=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"",E=B.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,w);P[0]?P[0].effect=E:this.setCustomEffect(E,0)}const y=this.serialize(G),x=xE.Parse(y,this._scene||this._engine,this._rootUrl);return x.name=w,x.customShader=h,x._customWrappers=P,void 0===E&&(E=this.hE),this.noiseTexture&&(x.noiseTexture=this.noiseTexture.clone()),x.hE=E,this.preventAutoStart||x.start(),x}}xE.BILLBOARDMODE_Y=2,xE.BILLBOARDMODE_ALL=7,xE.BILLBOARDMODE_STRETCHED=8,xE.BILLBOARDMODE_STRETCHED_LOCAL=9,nw._ParseParticleSystem=xE.Parse;var UE=G(11915),lE=G(11908),iE=G(11797);iE.b.prototype.createTransformFeedback=function(){const w=this._gl.createTransformFeedback();if(!w)throw new Error("Unable to create Transform Feedback");return w},iE.b.prototype.deleteTransformFeedback=function(w){this._gl.deleteTransformFeedback(w)},iE.b.prototype.bindTransformFeedback=function(w){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,w)},iE.b.prototype.beginTransformFeedback=function(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(w?this._gl.POINTS:this._gl.TRIANGLES)},iE.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},iE.b.prototype.setTranformFeedbackVaryings=function(w,E){this._gl.transformFeedbackVaryings(w,E,this._gl.INTERLEAVED_ATTRIBS)},iE.b.prototype.bindTransformFeedbackBuffer=function(w){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,w?w.underlyingResource:null)},iE.b.prototype.readTransformFeedbackBuffer=function(w){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,w)};const OE="clipPlaneFragmentDeclaration2",uE="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";T.b.IncludesShadersStore[OE]||(T.b.IncludesShadersStore[OE]=uE);G(12903),G(12905),G(12913),G(12917),G(12921),G(12923),G(12925),G(12933);const VE="gpuRenderParticlesPixelShader",aE="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";T.b.ShadersStore[VE]||(T.b.ShadersStore[VE]=aE);const QE="clipPlaneVertexDeclaration2",cE="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";T.b.IncludesShadersStore[QE]||(T.b.IncludesShadersStore[QE]=cE);G(12937),G(12946),G(12953),G(12957);const ZE="gpuRenderParticlesVertexShader",JE="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";T.b.ShadersStore[ZE]||(T.b.ShadersStore[ZE]=JE);class dE extends U{static get IsSupported(){if(!b.e.LastCreatedEngine)return!1;const w=b.e.LastCreatedEngine.getCaps();return w.supportTransformFeedbacks||w.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(w){this._maxActiveParticleCount=Math.min(w,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(w){this.maxActiveParticleCount=w}createPointEmitter(w,E){const G=Yw(w,E);return this.particleEmitterType=G,G}createHemisphericEmitter(){const w=Sw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createSphereEmitter(){const w=Xw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createDirectedSphereEmitter(){const w=bw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.QE(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.QE(0,1,0));return this.particleEmitterType=w,w}createCylinderEmitter(){const w=Aw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=w,w}createDirectedCylinderEmitter(){const w=wE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.QE(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.QE(0,1,0));return this.particleEmitterType=w,w}createConeEmitter(){const w=EE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=w,w}createDirectedConeEmitter(){const w=GE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.QE(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.QE(0,1,0));return this.particleEmitterType=w,w}createBoxEmitter(w,E,G,P){const h=new O;return this.particleEmitterType=h,this.direction1=w,this.direction2=E,this.minEmitBox=G,this.maxEmitBox=P,h}get flowMap(){return this._flowMap}set flowMap(w){this._flowMap!==w&&(this._flowMap=w)}isReady(){if(!this.hE||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==xE.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(xE.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(xE.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";w?setTimeout((()=>{this.start(0)}),w):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var w;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(w=this._customWrappers[E])||void 0===w?void 0:w.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[w]??this._customWrappers[0]}setCustomEffect(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new ww.c(this._engine),this._customWrappers[E].effect=w}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(w,E,G){return super._removeGradientAndTexture(w,E,G),this._releaseBuffers(),this}addColorGradient(w,E){this._colorGradients||(this._colorGradients=[]);const G=new m(w,E);return this._colorGradients.push(G),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(w&&this._colorGradients.sort(((w,E)=>w.gradient<E.gradient?-1:w.gradient>E.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(w){return this._removeGradientAndTexture(w,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const E in this._drawWrappers){var w;null===(w=this._drawWrappers[E].drawContext)||void 0===w||w.reset()}}_addFactorGradient(w,E,G){const P=new r(E,G);w.push(P),this._releaseBuffers()}addSizeGradient(w,E){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,w,E),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(w){return this._removeGradientAndTexture(w,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(w,E){if(!w)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&w.sort(((w,E)=>w.gradient<E.gradient?-1:w.gradient>E.gradient?1:0));const G=this;G[E]&&(G[E].dispose(),G[E]=null)}addAngularSpeedGradient(w,E){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,w,E),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(w){return this._removeGradientAndTexture(w,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(w,E){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,w,E),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(w){return this._removeGradientAndTexture(w,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(w,E){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,w,E),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(w){return this._removeGradientAndTexture(w,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(w,E){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,w,E),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(w){return this._removeGradientAndTexture(w,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(w){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(w,E,G){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(w),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.qh=new S.d,this.onStoppedObservable=new S.d,this.onStartedObservable=new S.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,G&&"Scene"!==G.getClassName()?(this._engine=G,this.defaultProjectionMatrix=P.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=G||b.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Pu.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,x.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,x.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,x.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,x.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ww.c(this._engine)},this._customWrappers[0].effect=h,this._drawWrappers={0:new ww.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(E=E??{}).randomTextureSize||delete E.randomTextureSize;const y={Cx:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...E},U=E;isFinite(U)&&(y.Cx=U),this._capacity=y.Cx,this._maxActiveParticleCount=y.Cx,this._currentActiveCount=0,this._isAnimationSheetEnabled=B,this.particleEmitterType=new O;const l=Math.min(this._engine.getCaps().maxTextureSize,y.randomTextureSize);let i=[];for(let P=0;P<l;++P)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture=new X.e(new Float32Array(i),l,1,5,G,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,i=[];for(let P=0;P<l;++P)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture2=new X.e(new Float32Array(i),l,1,5,G,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=l}_reset(){this._releaseBuffers()}_createVertexBuffers(w,E,G){const P={};P.position=E.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let h=3;P.age=E.createVertexBuffer("age",h,1,this._attributesStrideSize,!0),h+=1,P.size=E.createVertexBuffer("size",h,3,this._attributesStrideSize,!0),h+=3,P.life=E.createVertexBuffer("life",h,1,this._attributesStrideSize,!0),h+=1,h+=4,this.billboardMode===xE.BILLBOARDMODE_STRETCHED&&(P.direction=E.createVertexBuffer("direction",h,3,this._attributesStrideSize,!0)),h+=3,this._platform.alignDataInBuffer&&(h+=1),this.particleEmitterType instanceof K&&(h+=3,this._platform.alignDataInBuffer&&(h+=1)),this._colorGradientsTexture||(P.color=E.createVertexBuffer("color",h,4,this._attributesStrideSize,!0),h+=4),this._isBillboardBased||(P.initialDirection=E.createVertexBuffer("initialDirection",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1)),this.noiseTexture&&(P.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1),P.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",h,3,this._attributesStrideSize,!0),h+=3,this._platform.alignDataInBuffer&&(h+=1)),P.angle=E.createVertexBuffer("angle",h,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?h++:h+=2,this._isAnimationSheetEnabled&&(P.cellIndex=E.createVertexBuffer("cellIndex",h,1,this._attributesStrideSize,!0),h+=1,this.spriteRandomStartCell&&(P.cellStartOffset=E.createVertexBuffer("cellStartOffset",h,1,this._attributesStrideSize,!0),h+=1)),P.offset=G.createVertexBuffer("offset",0,2),P.uv=G.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(P),this._platform.createVertexBuffers(w,P),this.resetDrawCache()}_initialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!w)return;const E=this._engine,G=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof K&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const h=this.particleEmitterType instanceof K,B=P.TmpVectors.QE[0];let y=0;for(let P=0;P<this._capacity;P++)if(G.push(0),G.push(0),G.push(0),G.push(0),G.push(0),G.push(0),G.push(0),G.push(0),G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),h?(this.particleEmitterType.particleDestinationGenerator(P,null,B),G.push(B.x),G.push(B.y),G.push(B.z)):(G.push(0),G.push(0),G.push(0)),this._platform.alignDataInBuffer&&G.push(0),y+=16,h&&(this.particleEmitterType.particlePositionGenerator(P,null,B),G.push(B.x),G.push(B.y),G.push(B.z),this._platform.alignDataInBuffer&&G.push(0),y+=4),this._colorGradientsTexture||(G.push(0),G.push(0),G.push(0),G.push(0),y+=4),this.isBillboardBased||(G.push(0),G.push(0),G.push(0),this._platform.alignDataInBuffer&&G.push(0),y+=4),this.noiseTexture&&(G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),this._platform.alignDataInBuffer&&G.push(0),G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),this._platform.alignDataInBuffer&&G.push(0),y+=8),G.push(0),y+=1,this._angularSpeedGradientsTexture||(G.push(0),y+=1),this._isAnimationSheetEnabled&&(G.push(0),y+=1,this.spriteRandomStartCell&&(G.push(0),y+=1)),this._platform.alignDataInBuffer){let w=3-(y+3&3);for(y+=w;w-- >0;)G.push(0)}const x=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),U=this._platform.createParticleBuffer(G),l=this._platform.createParticleBuffer(G);this._buffer0=new t.d(E,U,!1,this._attributesStrideSize),this._buffer1=new t.d(E,l,!1,this._attributesStrideSize),this._spriteBuffer=new t.d(E,x,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let w=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(w+="\n#define BILLBOARD"),this._colorGradientsTexture&&(w+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(w+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(w+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(w+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(w+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(w+="\n#define DRAGGRADIENTS"),this._flowMap&&(w+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(w+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(w+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(w+="\n#define NOISE"),this.isLocal&&(w+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===w||(this._cachedUpdateDefines=w,this._updateBuffer=this._platform.createUpdateBuffer(w)),this._platform.isUpdateBufferReady()}_getWrapper(w){const E=this._getCustomDrawWrapper(w);if(null!==E&&void 0!==E&&E.effect)return E;const G=[];this.fillDefines(G,w);let P=this._drawWrappers[w];P||(P=new ww.c(this._engine),P.drawContext&&(P.drawContext.useInstancing=!0),this._drawWrappers[w]=P);const h=G.join("\n");if(P.defines!==h){const w=[],E=[],G=[];this.fillUniformsAttributesAndSamplerNames(E,w,G),P.setEffect(this._engine.createEffect("gpuRenderParticles",w,E,G,h),h)}return P}static _GetAttributeNamesOrOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=[t.g.PositionKind,"age","life","size","angle"];return w||h.push(t.g.ColorKind),E&&h.push("cellIndex"),G||h.push("initialDirection"),P&&h.push("direction"),h.push("offset",t.g.UVKind),h}static _GetEffectCreationOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=["emitterWM","Kl","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Ew.b)(P),w&&P.push("sheetInfos"),E&&P.push("logarithmicDepthConstant"),G&&(P.push("vFogInfos"),P.push("vFogColor")),P}fillDefines(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ew.g)(this,this._scene,w),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==lE.d.FOGMODE_NONE&&w.push("#define FOG")),E===xE.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this.isLocal&&w.push("#define LOCAL"),this.useLogarithmicDepth&&w.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case xE.BILLBOARDMODE_Y:w.push("#define BILLBOARDY");break;case xE.BILLBOARDMODE_STRETCHED:w.push("#define BILLBOARDSTRETCHED");break;case xE.BILLBOARDMODE_ALL:w.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&w.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),G&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(w,E,G){E.push(...dE._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===xE.BILLBOARDMODE_STRETCHED)),w.push(...dE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),G.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(UE.b.PrepareUniforms(w,this._imageProcessingConfigurationDefines),UE.b.PrepareSamplers(G,this._imageProcessingConfigurationDefines))}animate(){var w;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(E?this.preWarmStepOffset:(null===(w=this._scene)||void 0===w?void 0:w.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(w,E){const G=this[E];if(!w||!w.length||G)return;const P=new Float32Array(this._rawTextureWidth);for(let h=0;h<this._rawTextureWidth;h++){const E=h/this._rawTextureWidth;Y.GetCurrentGradient(E,w,((w,E,G)=>{P[h]=(0,l.Lerp)(w.factor1,E.factor1,G)}))}this[E]=X.e.CreateRTexture(P,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[E].name=E.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const w=new Uint8Array(4*this._rawTextureWidth),E=y.TmpColors.Tx[0];for(let G=0;G<this._rawTextureWidth;G++){const P=G/this._rawTextureWidth;Y.GetCurrentGradient(P,this._colorGradients,((P,h,B)=>{y.Tx.LerpToRef(P.color1,h.color1,B,E),w[4*G]=255*E.r,w[4*G+1]=255*E.g,w[4*G+2]=255*E.b,w[4*G+3]=255*E.a}))}this._colorGradientsTexture=X.e.CreateRGBATexture(w,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(w,E){var G,h,B,y;const x=this._getWrapper(w),U=x.effect;this._engine.enableEffect(x);const l=(null===(G=this._scene)||void 0===G?void 0:G.getViewMatrix())||P.Matrix.IdentityReadOnly;if(U.setMatrix("view",l),U.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),U.setTexture("diffuseSampler",this.particleTexture),U.setVector2("translationPivot",this.translationPivot),U.setVector3("Kl",this.Kl),this.isLocal&&U.setMatrix("emitterWM",E),this._colorGradientsTexture?U.setTexture("colorGradientSampler",this._colorGradientsTexture):U.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const w=this.particleTexture.getBaseSize();U.setFloat3("sheetInfos",this.spriteCellWidth/w.width,this.spriteCellHeight/w.height,w.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const w=this._scene.activeCamera;U.setVector3("eyePosition",w.globalPosition)}const i=U.defines;if(this._scene&&((0,Ew.e)(U,this,this._scene),this.applyFog&&(0,Gw.h)(this._scene,void 0,U)),i.indexOf("#define BILLBOARDMODE_ALL")>=0){const w=l.clone();w.invert(),U.setMatrix("invView",w)}return this.useLogarithmicDepth&&this._scene&&(0,Gw.n)(i,U,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(U),this._setEngineBasedOnBlendMode(w),this._platform.bindDrawBuffers(this._targetIndex,U,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(U),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(y=this._scene)&&void 0!==y&&y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(w){if(!this.hE||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!w)if(this.hE.position){w=this.hE.getWorldMatrix()}else{const E=this.hE;w=P.TmpVectors.Matrix[0],P.Matrix.TranslationToRef(E.x,E.y,E.z,w)}const E=this._engine,G=E.getDepthWrite();if(E.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const w=this.Ww();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",w.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",w),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const h=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=h,E.setDepthWrite(G)}render(){let w,E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!E&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let w=0;w<this.preWarmCycles;w++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const w=0|this._accumulatedCount;this._accumulatedCount-=w,this._currentActiveCount+=w}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.hE.position){w=this.hE.getWorldMatrix()}else{const E=this.hE;w=P.TmpVectors.Matrix[0],P.Matrix.TranslationToRef(E.x,E.y,E.z,w)}const h=this._engine;this.updateInAnimate||this._update(w);let B=0;return E||G||(h.setState(!1),this.forceDepthWrite&&h.setDepthWrite(!0),B=this.blendMode===xE.BLENDMODE_MULTIPLYADD?this._render(xE.BLENDMODE_MULTIPLY,w)+this._render(xE.BLENDMODE_ADD,w):this._render(this.blendMode,w),this._engine.setAlphaMode(0)),B}rebuild(){const w=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(w,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,w()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const E in this._drawWrappers){this._drawWrappers[E].dispose()}if(this._drawWrappers={},this._scene){const w=this._scene.Pu.indexOf(this);w>-1&&this._scene.Pu.splice(w,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let E=0;E<this._renderVertexBuffers.length;++E){const w=this._renderVertexBuffers[E];for(const E in w)w[E].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),w&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),w&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.qh.notifyObservers(this),this.qh.clear()}clone(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P={...this._customWrappers};let h=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){h=this.customShader;const w=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"";P[0]=B.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,w,void 0,void 0,void 0,this)}const y=this.serialize(G),x=dE.Parse(y,this._scene||this._engine,this._rootUrl);return x.name=w,x.customShader=h,x._customWrappers=P,void 0===E&&(E=this.hE),this.noiseTexture&&(x.noiseTexture=this.noiseTexture.clone()),x.hE=E,x}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return xE._Serialize(E,this,w),E.activeParticleCount=this.activeParticleCount,E.randomTextureSize=this._randomTextureSize,E.customShader=this.customShader,E}static Parse(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0;const B=w.name;let y,x;E instanceof rw.b?y=E:(x=E,y=x.getEngine());const U=new dE(B,{Cx:h||w.Cx,randomTextureSize:w.randomTextureSize},E,null,w.isAnimationSheetEnabled);if(U._rootUrl=G,w.customShader&&y.createEffectForParticles){const E=w.customShader,G=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",P=y.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,G,void 0,void 0,void 0,U);U.setCustomEffect(P,0),U.customShader=E}return w.id&&(U.id=w.id),w.activeParticleCount&&(U.activeParticleCount=w.activeParticleCount),xE._Parse(w,U,E,G),w.preventAutoStart&&(U.preventAutoStart=w.preventAutoStart),P||U.preventAutoStart||U.start(),U}}var KE=G(11498),tE=G(12961),qE=G(12036);class WE{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(w){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const E of this.systems)E.hE=w;this._emitterNode=w}setEmitterAsSphere(w,E,G){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:w,renderingGroupId:E};const P=(0,tE.e)("emitterSphere",{diameter:w.diameter,segments:w.segments},G);P.renderingGroupId=E;const h=new qE.JE("emitterSphereMaterial",G);h.emissiveColor=w.color,P.material=h;for(const B of this.systems)B.hE=P;this._emitterNode=P}start(w){for(const E of this.systems)w&&(E.hE=w),E.start()}dispose(){for(const w of this.systems)w.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={systems:[]};for(const G of this.systems)E.systems.push(G.serialize(w));return this._emitterNode&&(E.hE=this._emitterCreationOptions),E}static Parse(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;const h=new WE,B=this.BaseAssetsUrl+"/textures/";E=E||b.e.LastCreatedScene;for(const y of w.systems)h.systems.push(G?dE.Parse(y,E,B,!0,P):xE.Parse(y,E,B,!0,P));if(w.hE){const G=w.hE.options;if("Sphere"===w.hE.kind)h.setEmitterAsSphere({diameter:G.diameter,segments:G.segments,color:y.dE.KE(G.color)},w.hE.renderingGroupId,E)}return h}}WE.BaseAssetsUrl="https://assets.babylonjs.com/particles";var TE=G(11540);class IE{static CreateDefault(w){let E,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,P=arguments.length>2?arguments[2]:void 0;E=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new dE("default system",{Cx:G},P):new xE("default system",G,P),E.hE=w;const h=KE.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return E.particleTexture=new C.c(h,E.Ww()),E.createConeEmitter(.1,Math.PI/4),E.color1=new y.Tx(1,1,1,1),E.color2=new y.Tx(1,1,1,1),E.colorDead=new y.Tx(1,1,1,0),E.minSize=.1,E.maxSize=.1,E.minEmitPower=2,E.maxEmitPower=2,E.updateSpeed=1/60,E.emitRate=30,E}static CreateAsync(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;E||(E=b.e.LastCreatedScene);const h={};return E.addPendingData(h),new Promise(((B,y)=>{if(G&&!dE.IsSupported)return E.removePendingData(h),y("Particle system with GPU is not supported.");KE.Tools.LoadFile(`${IE.BaseAssetsUrl}/systems/${w}.json`,(w=>{E.removePendingData(h);const y=JSON.parse(w.toString());return B(WE.Parse(y,E,G,P))}),void 0,void 0,void 0,(()=>(E.removePendingData(h),y(`An error occurred with the creation of your particle system. Check if your type '${w}' exists.`))))}))}static ExportSet(w){const E=new WE;for(const G of w)E.systems.push(G);return E}static ParseFromFileAsync(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",B=arguments.length>5?arguments[5]:void 0;return new Promise(((y,x)=>{const U=new TE.c;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const E=JSON.parse(U.responseText);let x;x=P?dE.Parse(E,G,h,!1,B):xE.Parse(E,G,h,!1,B),w&&(x.name=w),y(x)}else x("Unable to load the particle system")})),U.open("GET",E),U.send()}))}static ParseFromSnippetAsync(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",h=arguments.length>4?arguments[4]:void 0;if("_BLANK"===w){const w=this.CreateDefault(null);return w.start(),Promise.resolve(w)}return new Promise(((B,y)=>{const x=new TE.c;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){const y=JSON.parse(JSON.parse(x.responseText).jsonPayload),U=JSON.parse(y.particleSystem);let l;l=G?dE.Parse(U,E,P,!1,h):xE.Parse(U,E,P,!1,h),l.snippetId=w,B(l)}else y("Unable to load the snippet "+w)})),x.open("GET",this.SnippetUrl+"/"+w.replace(/#/g,"/")),x.send()}))}}IE.BaseAssetsUrl=WE.BaseAssetsUrl,IE.SnippetUrl="https://snippet.babylonjs.com",IE.CreateFromSnippetAsync=IE.ParseFromSnippetAsync;var jE=G(12103),gE=G(11944),oE=G(12965);(0,oE.e)(gE.c.NAME_PARTICLESYSTEM,((w,E,G,P)=>{const h=(0,oE.i)(gE.c.NAME_PARTICLESYSTEM);if(h&&void 0!==w.Pu&&null!==w.Pu)for(let B=0,y=w.Pu.length;B<y;B++){const y=w.Pu[B];G.Pu.push(h(y,E,P))}})),(0,oE.d)(gE.c.NAME_PARTICLESYSTEM,((w,E,G)=>{if(w.activeParticleCount){return dE.Parse(w,E,G)}return xE.Parse(w,E,G)})),rw.b.prototype.createEffectForParticles=function(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0,x=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=arguments.length>9?arguments[9]:void 0,O=[],u=[];const V=[];return U?U.fillUniformsAttributesAndSamplerNames(u,O,V):(O=xE._GetAttributeNamesOrOptions(),u=xE._GetEffectCreationOptions()),-1===h.indexOf(" BILLBOARD")&&(h+="\n#define BILLBOARD\n"),null!==U&&void 0!==U&&U.isAnimationSheetEnabled&&-1===h.indexOf(" ANIMATESHEET")&&(h+="\n#define ANIMATESHEET\n"),-1===P.indexOf("diffuseSampler")&&P.push("diffuseSampler"),this.createEffect({vertex:i??(null===U||void 0===U?void 0:U.vertexShaderName)??"particles",fragmentElement:w},O,u.concat(E),V.concat(P),h,B,y,x,void 0,l,(async()=>{0===l?await Promise.resolve().then(G.bind(G,12997)):await Promise.resolve().then(G.bind(G,13054))}))},jE.c.prototype.getEmittedParticleSystems=function(){const w=[];for(let E=0;E<this.Ww().Pu.length;E++){const G=this.Ww().Pu[E];G.hE===this&&w.push(G)}return w},jE.c.prototype.getHierarchyEmittedParticleSystems=function(){const w=[],E=this.getDescendants();E.push(this);for(let G=0;G<this.Ww().Pu.length;G++){const P=this.Ww().Pu[G],h=P.hE;h.position&&-1!==E.indexOf(h)&&w.push(P)}return w};G(11998),G(12008),G(12087);G(12089),G(12973),G(11870),G(11991),G(12130);G(11868);var fE;G(12979),G(11695);!function(w){w[w.Color=2]="Color",w[w.UV=1]="UV",w[w.Random=0]="Random",w[w.Stated=3]="Stated"}(fE||(fE={}));var kE=G(11890);const NE=new P.QE(0,0,0),vE=new P.QE(0,0,0),CE=new P.QE(0,0,0);class sE{constructor(w,E,G){this.width=w,this.height=E,this.data=G}processFlowable(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2?arguments[2]:void 0;if(!G)return;G instanceof P.Matrix?P.QE.TransformCoordinatesToRef(w.position,G,CE):(CE.x=G.x,CE.y=G.y,CE.z=G.z);const h=.5*CE.x+.5,B=1-(.5*CE.y+.5),y=Math.floor(h*this.width),x=Math.floor(B*this.height);if(y<0||y>=this.width||x<0||x>=this.height)return;const U=4*(x*this.width+y),l=this.data[U]/255*2-1,i=this.data[U+1]/255*2-1,O=this.data[U+2]/255*2-1,u=this.data[U+3]/255;NE.set(l,i,O),NE.scaleToRef(E*u,vE),w.direction.addInPlace(vE)}_processParticle(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2?arguments[2]:void 0;this.processFlowable(w,E,G)}static async FromUrlAsync(w){return await new Promise(((E,G)=>{const P=document.createElement("canvas"),h=P.getContext("2d");let B=null;const y=new Image;y.crossOrigin="anonymous",y.src=w,y.onerror=E=>{G(new Error(`Failed to load image: ${w} : ${E}`))},y.onload=()=>{P.width=y.width,P.height=y.height,h.drawImage(y,0,0),B=h.getImageData(0,0,P.width,P.height),E(new sE(P.width,P.height,B.data))}}))}static async ExtractFromTextureAsync(w){return await new Promise(((E,G)=>{if(!w.isReady())return void w.onLoadObservable.addOnce((async()=>{try{const G=await this.ExtractFromTextureAsync(w);E(G)}catch(P){G(P)}}));const P=w.getSize();kE.m.GetTextureDataAsync(w,P.width,P.height).then((w=>{E(new sE(P.width,P.height,new Uint8ClampedArray(w)))})).catch(G)}))}}var FE,ME,pE,DE,eE,RE,HE,zE,LE;!function(w){w[w.Int=1]="Int",w[w.Float=2]="Float",w[w.Vector2=4]="Vector2",w[w.QE=8]="QE",w[w.Matrix=16]="Matrix",w[w.Particle=32]="Particle",w[w.Texture=64]="Texture",w[w.Tx=128]="Tx",w[w.FloatGradient=256]="FloatGradient",w[w.Vector2Gradient=512]="Vector2Gradient",w[w.Vector3Gradient=1024]="Vector3Gradient",w[w.Color4Gradient=2048]="Color4Gradient",w[w.System=4096]="System",w[w.AutoDetect=8192]="AutoDetect",w[w.BasedOnInput=16384]="BasedOnInput",w[w.Undefined=32768]="Undefined",w[w.All=65535]="All"}(FE||(FE={})),function(w){w[w.Compatible=0]="Compatible",w[w.TypeIncompatible=1]="TypeIncompatible",w[w.HierarchyIssue=2]="HierarchyIssue"}(ME||(ME={})),function(w){w[w.Input=0]="Input",w[w.Output=1]="Output"}(pE||(pE={}));class mE{get direction(){return this._direction}get type(){if(this._type===FE.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===FE.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(w){this._type=w}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((w=>w.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(w,E,G){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=FE.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new S.d,this.onDisconnectionObservable=new S.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=E,this.name=w,this._direction=G}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(w){var E;return this.isConnected?null!==(E=this._connectedPoint)&&void 0!==E&&E._storedFunction?this._connectedPoint._storedFunction(w):this._connectedPoint._storedValue:this.value}canConnectTo(w){return 0===this.checkCompatibilityState(w)}checkCompatibilityState(w){const E=this._ownerBlock,G=w.ownerBlock;if(this.type!==w.type&&w.innerType!==FE.AutoDetect)return w.acceptedConnectionPointTypes&&-1!==w.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(w.excludedConnectionPointTypes&&-1!==w.excludedConnectionPointTypes.indexOf(this.type))return 1;let P=G,h=E;return 0===this.direction&&(P=E,h=G),P.isAnAncestorOf(h)?2:0}connectTo(w){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(w))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${w.ownerBlock.name}".${w.name}`;return this._endpoints.push(w),w._connectedPoint=this,this.onConnectionObservable.notifyObservers(w),w.onConnectionObservable.notifyObservers(this),this}disconnectFrom(w){const E=this._endpoints.indexOf(w);return-1===E||(this._endpoints.splice(E,1),w._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(w),w.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(w){let E=1;for(;E<FE.All;)w&E||this.excludedConnectionPointTypes.push(E),E<<=1}serialize(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const E={};return E.name=this.name,E.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Lh?(E.valueType="BABYLON."+this.value.getClassName(),E.value=this.value.Lh()):(E.valueType="number",E.value=this.value)),w&&this.connectedPoint&&(E.inputName=this.name,E.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,E.targetConnectionName=this.connectedPoint.name,E.isExposedOnFrame=!0,E.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(E.isExposedOnFrame=!0,E.exposedPortPosition=this.exposedPortPosition),E}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class nE{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(w){this._name=w}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(w){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new S.d,this.qh=new S.d,this.onInputChangedObservable=new S.d,this.visibleOnFrame=!1,this._name=w,this.uniqueId=s.d.UniqueId}_inputRename(w){return w}_outputRename(w){return w}isAnAncestorOf(w){for(const E of this._outputs)if(E.hasEndpoints)for(const G of E.endpoints){if(G.ownerBlock===w)return!0;if(G.ownerBlock.isAnAncestorOf(w))return!0}return!1}isAnAncestorOfType(w){if(this.getClassName()===w)return!0;for(const E of this._outputs)if(E.hasEndpoints)for(const G of E.endpoints)if(G.ownerBlock.isAnAncestorOfType(w))return!0;return!1}getInputByName(w){const E=this._inputs.filter((E=>E.name===w));return E.length?E[0]:null}_linkConnectionTypes(w,E){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[E]._acceptedConnectionPointType=this._inputs[w]:(this._inputs[w]._linkedConnectionSource=this._inputs[E],this._inputs[w]._isMainLinkSource=!0),this._inputs[E]._linkedConnectionSource=this._inputs[w]}registerInput(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;const y=new mE(w,this,0);return y.type=E,y.isOptional=G,y.defaultValue=P,y.value=P,y.valueMin=h,y.valueMax=B,this._inputs.push(y),this.onInputChangedObservable.notifyObservers(y),this}registerOutput(w,E,G){return(G=G??new mE(w,this,1)).type=E,this._outputs.push(G),this}_build(w){}_customBuildStep(w){}build(w){if(this._buildId===w.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((w=>w.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=w.buildId;for(const E of this._inputs){if(!E.connectedPoint){E.isOptional||w.notConnectedNonOptionalInputs.push(E);continue}const G=E.connectedPoint.ownerBlock;G&&G!==this&&!G.isSystem&&G.build(w)}return this._customBuildStep(w),w.verbose&&F.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(w),this.onBuildObservable.notifyObservers(this),!1}serialize(){const w={};w.customType="BABYLON."+this.getClassName(),w.id=this.uniqueId,w.name=this.name,w.visibleOnFrame=this.visibleOnFrame,w.inputs=[],w.outputs=[];for(const E of this.inputs)w.inputs.push(E.serialize());for(const E of this.outputs)w.outputs.push(E.serialize(!1));return w}_deserialize(w){this._name=w.name,this.comments=w.comments,this.visibleOnFrame=!!w.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(w)}_deserializePortDisplayNamesAndExposedOnFrame(w){const E=w.inputs,G=w.outputs;if(E)for(const P of E){const w=this.inputs.find((w=>w.name===P.name));if(!w)return;if(P.displayName&&(w.displayName=P.displayName),P.isExposedOnFrame&&(w.isExposedOnFrame=P.isExposedOnFrame,w.exposedPortPosition=P.exposedPortPosition),void 0!==P.value&&null!==P.value)if("number"===P.valueType)w.value=P.value;else{const E=(0,x.e)(P.valueType);E&&(w.value=E.KE(P.value))}}if(G)for(let P=0;P<G.length;P++){const w=G[P];w.displayName&&(this.outputs[P].displayName=w.displayName),w.isExposedOnFrame&&(this.outputs[P].isExposedOnFrame=w.isExposedOnFrame,this.outputs[P].exposedPortPosition=w.exposedPortPosition)}}clone(){const w=this.serialize(),E=(0,x.e)(w.customType);if(E){const G=new E;return G._deserialize(w),G}return null}dispose(){this.qh.notifyObservers(this),this.qh.clear();for(const w of this.inputs)w.dispose();for(const w of this.outputs)w.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function rE(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",P=arguments.length>3?arguments[3]:void 0;return(h,B)=>{let y=h._propStore;y||(y=[],h._propStore=y),y.push({propertyName:B,displayName:w,type:E,groupName:G,options:P??{},className:h.getClassName()})}}(0,k.c)([(0,N.F)("comment")],nE.prototype,"comments",void 0),function(w){w[w.Boolean=0]="Boolean",w[w.Float=1]="Float",w[w.Int=2]="Int",w[w.Vector2=3]="Vector2",w[w.List=4]="List",w[w.Tx=5]="Tx",w[w.SamplingMode=6]="SamplingMode",w[w.TextureFormat=7]="TextureFormat",w[w.TextureType=8]="TextureType"}(DE||(DE={})),function(w){w[w.None=0]="None",w[w.Position=1]="Position",w[w.Direction=2]="Direction",w[w.Age=3]="Age",w[w.Lifetime=4]="Lifetime",w[w.Color=5]="Color",w[w.ScaledDirection=6]="ScaledDirection",w[w.Scale=7]="Scale",w[w.AgeGradient=8]="AgeGradient",w[w.Angle=9]="Angle",w[w.SpriteCellIndex=16]="SpriteCellIndex",w[w.SpriteCellStart=17]="SpriteCellStart",w[w.SpriteCellEnd=18]="SpriteCellEnd"}(eE||(eE={})),function(w){w[w.None=0]="None",w[w.Time=1]="Time",w[w.Delta=2]="Delta",w[w.Emitter=3]="Emitter"}(RE||(RE={}));class YE{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let w="";for(const E of this.notConnectedNonOptionalInputs)w+=`input ${E.name} from block ${E.ownerBlock.name}[${E.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(w)throw"Build of Node Particle System Set failed:\n"+w}adapt(w,E){const G=w.getConnectedValue(this)||0;if(w.type===E)return G;switch(E){case FE.Vector2:return new P.Vector2(G,G);case FE.QE:return new P.QE(G,G,G);case FE.Tx:return new y.Tx(G,G,G,G)}return null}getContextualValue(w){if(!this.particleContext||!this.systemContext)return null;switch(w){case eE.Position:return this.particleContext.position;case eE.Direction:return this.particleContext.direction;case eE.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case eE.Color:return this.particleContext.color;case eE.Age:return this.particleContext.age;case eE.Lifetime:return this.particleContext.lifeTime;case eE.Angle:return this.particleContext.angle;case eE.Scale:return this.particleContext.scale;case eE.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case eE.SpriteCellEnd:return this.systemContext.endSpriteCellID;case eE.SpriteCellIndex:return this.particleContext.cellIndex;case eE.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.hE.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.hE.absolutePosition:this.systemContext.hE:null}getSystemValue(w){if(!this.particleContext||!this.systemContext)return null;switch(w){case RE.Time:return this.systemContext._actualFrame;case RE.Delta:return this.systemContext._scaledUpdateSpeed;case RE.Emitter:if(this.isEmitterTransformNode){return this.systemContext.hE.absolutePosition}return this.systemContext.hE}return null}}function SE(w,E,G){const P=new YE;P.ZE=E;const h=w.createSystem(P);return h.canStart=()=>!0,h.hE=G.clone(),h.disposeOnStop=!0,h.start(),h}class XE extends nE{constructor(w){super(w),this.blendMode=U.BLENDMODE_ONEONE,this.Cx=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",FE.Particle),this.registerInput("texture",FE.Texture),this.registerInput("onStart",FE.System,!0),this.registerInput("onEnd",FE.System,!0),this.registerOutput("system",FE.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(w){w.Cx=this.Cx,w.buildId=this._buildId++,this.build(w);const E=this.particle.getConnectedValue(w);return E.particleTexture=this.texture.getConnectedValue(w),E.emitRate=this.emitRate,E.blendMode=this.blendMode,E.name=this.name,E._nodeGenerated=!0,E._targetStopDuration=this.targetStopDuration,E.startDelay=this.startDelay,this.system._storedValue=this,E.canStart=()=>!this.doNoStart,E.onStartedObservable.add((G=>{const P=this.onStart.getConnectedValue(w);P&&G.onStartedObservable.addOnce((()=>{w.systemContext=E;const G=SE(P,w.ZE,w.emitterPosition);this.qh.addOnce((()=>{G.dispose()}))}));const h=this.onEnd.getConnectedValue(w);h&&G.onStoppedObservable.addOnce((()=>{w.systemContext=E;const G=SE(h,w.ZE,w.emitterPosition);this.qh.addOnce((()=>{G.dispose()}))}))})),this.qh.addOnce((()=>{E.dispose()})),E}serialize(){const w=super.serialize();return w.Cx=this.Cx,w.emitRate=this.emitRate,w.blendMode=this.blendMode,w.doNoStart=this.doNoStart,w.targetStopDuration=this.targetStopDuration,w.startDelay=this.startDelay,w}_deserialize(w){super._deserialize(w),this.Cx=w.Cx,this.emitRate=w.emitRate,this.doNoStart=!!w.doNoStart,void 0!==w.blendMode&&(this.blendMode=w.blendMode),void 0!==w.targetStopDuration&&(this.targetStopDuration=w.targetStopDuration),void 0!==w.startDelay&&(this.startDelay=w.startDelay)}}(0,k.c)([rE("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:U.BLENDMODE_ONEONE},{label:"Standard",value:U.BLENDMODE_STANDARD},{label:"Add",value:U.BLENDMODE_ADD},{label:"Multiply",value:U.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:U.BLENDMODE_MULTIPLYADD}]})],XE.prototype,"blendMode",void 0),(0,k.c)([rE("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],XE.prototype,"Cx",void 0),(0,k.c)([rE("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XE.prototype,"emitRate",void 0),(0,k.c)([rE("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XE.prototype,"targetStopDuration",void 0),(0,k.c)([rE("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XE.prototype,"startDelay",void 0),(0,k.c)([rE("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],XE.prototype,"doNoStart",void 0),(0,x.g)("BABYLON.SystemBlock",XE);class bE extends nE{get type(){if(this._type===FE.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=FE.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=FE.Vector2,this._type;case"QE":return this._type=FE.QE,this._type;case"Tx":return this._type=FE.Tx,this._type;case"Matrix":return this._type=FE.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===eE.None&&this._systemSource!==RE.None}get systemSource(){return this._systemSource}set systemSource(w){if(this._systemSource=w,w!==RE.None){switch(this._contextualSource=eE.None,this._type=FE.Float,w){case RE.Time:case RE.Delta:this._type=FE.Float;break;case RE.Emitter:this._type=FE.QE}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==eE.None}get contextualValue(){return this._contextualSource}set contextualValue(w){if(this._contextualSource=w,w!==eE.None){switch(this._systemSource=RE.None,w){case eE.Scale:this._type=FE.Vector2;break;case eE.Position:case eE.Direction:case eE.ScaledDirection:this._type=FE.QE;break;case eE.Color:this._type=FE.Tx;break;case eE.Age:case eE.Lifetime:case eE.Angle:case eE.AgeGradient:this._type=FE.Float;break;case eE.SpriteCellEnd:case eE.SpriteCellStart:case eE.SpriteCellIndex:this._type=FE.Int}this.output&&(this.output.type=this._type)}}constructor(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FE.AutoDetect;super(w),this._type=FE.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new S.d,this._systemSource=RE.None,this._contextualSource=eE.None,this._type=E,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",E)}get value(){return this._storedValue}set value(w){this.type===FE.Float&&this.min!==this.max&&(w=Math.max(this.min,w),w=Math.min(this.max,w)),this._storedValue=w,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(w){this._valueCallback=w}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case FE.Int:case FE.Float:this.value=0;break;case FE.Vector2:this.value=P.Vector2.Zero();break;case FE.QE:this.value=P.QE.Zero();break;case FE.Tx:this.value=new y.Tx(1,1,1,1);break;case FE.Matrix:this.value=P.Matrix.Identity()}}_build(w){super._build(w),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=w=>w.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=w=>w.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const w=super.serialize();return w.type=this.type,w.contextualValue=this.contextualValue,w.systemSource=this.systemSource,w.min=this.min,w.max=this.max,w.groupInInspector=this.groupInInspector,w.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Lh?(w.valueType="BABYLON."+this._storedValue.getClassName(),w.value=this._storedValue.Lh()):(w.valueType="number",w.value=this._storedValue)),w}_deserialize(w){if(super._deserialize(w),this._type=w.type,this.contextualValue=w.contextualValue,this.systemSource=w.systemSource||RE.None,this.min=w.min||0,this.max=w.max||0,this.groupInInspector=w.groupInInspector||"",void 0!==w.displayInInspector&&(this.displayInInspector=w.displayInInspector),w.valueType)if("number"===w.valueType)this._storedValue=w.value;else{const E=(0,x.e)(w.valueType);E&&(this._storedValue=E.KE(w.value))}}}(0,x.g)("BABYLON.ParticleInputBlock",bE);class AE extends nE{get url(){return this._url}set url(w){this._url!==w&&(this._cachedData=null,this._url=w,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(w){this._textureDataUrl!==w&&(this._cachedData=null,this._textureDataUrl=w,this._url="",this._sourceTexture=null)}set sourceTexture(w){this._sourceTexture!==w&&(this._cachedData=null,this._sourceTexture=w,this._url="",this._textureDataUrl="")}constructor(w){super(w),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",FE.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const w=this.texture._storedValue;return await new Promise(((E,G)=>{if(!w.isReady())return void w.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),E(this._cachedData)}catch(w){G(w)}}));const P=w.getSize();kE.m.GetTextureDataAsync(w,P.width,P.height).then((G=>{this._cachedData={width:P.width,height:P.height,data:new Uint8ClampedArray(G)},w.dispose(),E(this._cachedData)})).catch(G)}))}_build(w){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new C.c(this._textureDataUrl,w.ZE):this.texture._storedValue=new C.c(this._url,w.ZE):this.texture._storedValue=null}serialize(){const w=super.serialize();return w.url=this.url,w.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(w.textureDataUrl=this.textureDataUrl),w}_deserialize(w){super._deserialize(w),this.url=w.url,this.serializedCachedData=!!w.serializedCachedData,w.textureDataUrl&&(this.textureDataUrl=w.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,x.g)("BABYLON.ParticleTextureSourceBlock",AE);class wG extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("position",FE.QE),this.registerOutput("output",FE.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(w){const E=this.particle.getConnectedValue(w);if(this.output._storedValue=E,!this.position.isConnected)return;const G={process:G=>{w.particleContext=G,w.systemContext=E,G.position.B(this.position.getConnectedValue(w))},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G}}(0,x.g)("BABYLON.UpdatePositionBlock",wG),function(w){w[w.Add=0]="Add",w[w.Subtract=1]="Subtract",w[w.Multiply=2]="Multiply",w[w.Divide=3]="Divide",w[w.Max=4]="Max",w[w.Min=5]="Min"}(HE||(HE={}));class EG extends nE{constructor(w){super(w),this.operation=HE.Add,this.registerInput("left",FE.AutoDetect),this.registerInput("right",FE.AutoDetect),this.registerOutput("output",FE.BasedOnInput),this.output._typeConnectionSource=this.left;const E=[FE.Matrix,FE.Particle,FE.Texture,FE.System,FE.FloatGradient,FE.Color4Gradient,FE.Vector2Gradient,FE.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...E),this.right.excludedConnectionPointTypes.push(...E),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(w){let E;const G=this.left,h=this.right;if(!G.isConnected||!h.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const B=G.type===FE.Float||G.type===FE.Int,x=h.type===FE.Float||h.type===FE.Int,U=B&&x;switch(this.operation){case HE.Add:E=U?w=>G.getConnectedValue(w)+h.getConnectedValue(w):B?w=>w.adapt(G,h.type).add(h.getConnectedValue(w)):w=>G.getConnectedValue(w).add(w.adapt(h,G.type));break;case HE.Subtract:E=U?w=>G.getConnectedValue(w)-h.getConnectedValue(w):B?w=>w.adapt(G,h.type).cE(h.getConnectedValue(w)):w=>G.getConnectedValue(w).cE(w.adapt(h,G.type));break;case HE.Multiply:E=U?w=>G.getConnectedValue(w)*h.getConnectedValue(w):B?w=>w.adapt(G,h.type).multiply(h.getConnectedValue(w)):w=>G.getConnectedValue(w).multiply(w.adapt(h,G.type));break;case HE.Divide:E=U?w=>G.getConnectedValue(w)/h.getConnectedValue(w):B?w=>w.adapt(G,h.type).divide(h.getConnectedValue(w)):w=>G.getConnectedValue(w).divide(w.adapt(h,G.type));break;case HE.Min:if(U)E=w=>Math.min(G.getConnectedValue(w),h.getConnectedValue(w));else{const[w,x]=B?[h,G]:[G,h];switch(w.type){case FE.Vector2:E=E=>P.Vector2.Minimize(w.getConnectedValue(E),E.adapt(x,w.type));break;case FE.QE:E=E=>P.QE.Minimize(w.getConnectedValue(E),E.adapt(x,w.type));break;case FE.Tx:E=E=>{const G=w.getConnectedValue(E),{r:P,g:h,b:B,a:U}=E.adapt(x,w.type);return new y.Tx(Math.min(G.r,P),Math.min(G.g,h),Math.min(G.b,B),Math.min(G.a,U))}}}break;case HE.Max:if(!U){const[w,x]=B?[h,G]:[G,h];switch(w.type){case FE.Vector2:E=E=>P.Vector2.Maximize(w.getConnectedValue(E),E.adapt(x,w.type));break;case FE.QE:E=E=>P.QE.Maximize(w.getConnectedValue(E),E.adapt(x,w.type));break;case FE.Tx:E=E=>{const G=w.getConnectedValue(E),{r:P,g:h,b:B,a:U}=E.adapt(x,w.type);return new y.Tx(Math.max(G.r,P),Math.min(G.g,h),Math.min(G.b,B),Math.min(G.a,U))}}break}E=w=>Math.max(G.getConnectedValue(w),h.getConnectedValue(w))}this.output._storedFunction=w=>G.type===FE.Int?0|E(w):E(w)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===FE.Int||this.left.type===FE.Float&&this.right.type!==FE.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[w,E]of[[this.left,this.right],[this.right,this.left]])w.acceptedConnectionPointTypes=[FE.Int,FE.Float],E.isConnected&&(w.acceptedConnectionPointTypes.push(E.type),E.type!==FE.Int&&E.type!==FE.Float||w.acceptedConnectionPointTypes.push(FE.Vector2,FE.QE,FE.Tx))}dispose(){super.dispose();for(const w of this._connectionObservers)w.remove();this._connectionObservers.length=0}serialize(){const w=super.serialize();return w.operation=this.operation,w}_deserialize(w){super._deserialize(w),this.operation=w.operation}}(0,k.c)([rE("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:HE.Add},{label:"Subtract",value:HE.Subtract},{label:"Multiply",value:HE.Multiply},{label:"Divide",value:HE.Divide},{label:"Max",value:HE.Max},{label:"Min",value:HE.Min}]})],EG.prototype,"operation",void 0),(0,x.g)("BABYLON.ParticleMathBlock",EG);class GG extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("direction1",FE.QE,!0,new P.QE(0,1,0)),this.registerInput("direction2",FE.QE,!0,new P.QE(0,1,0)),this.registerInput("minEmitBox",FE.QE,!0,new P.QE(-.5,-.5,-.5)),this.registerInput("maxEmitBox",FE.QE,!0,new P.QE(.5,.5,.5)),this.registerOutput("output",FE.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(w){const E=this.particle.getConnectedValue(w);E._directionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.direction1.getConnectedValue(w),B=this.direction2.getConnectedValue(w),y=(0,l.RandomRange)(h.x,B.x),x=(0,l.RandomRange)(h.y,B.y),U=(0,l.RandomRange)(h.z,B.z);w.isEmitterTransformNode?P.QE.TransformNormalFromFloatsToRef(y,x,U,w.emitterWorldMatrix,G.direction):G.direction.tx(y,x,U)},E._positionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.minEmitBox.getConnectedValue(w),B=this.maxEmitBox.getConnectedValue(w),y=(0,l.RandomRange)(h.x,B.x),x=(0,l.RandomRange)(h.y,B.y),U=(0,l.RandomRange)(h.z,B.z);w.isEmitterTransformNode?P.QE.TransformCoordinatesFromFloatsToRef(y,x,U,w.emitterWorldMatrix,G.position):(G.position.tx(y,x,U),G.position.addInPlace(w.emitterPosition))},this.output._storedValue=E}}(0,x.g)("BABYLON.BoxShapeBlock",GG);class PG extends nE{constructor(w){super(w),this.registerInput("emitPower",FE.Float,!0,1),this.registerInput("lifeTime",FE.Float,!0,1),this.registerInput("color",FE.Tx,!0,new y.Tx(1,1,1,1)),this.registerInput("scale",FE.Vector2,!0,new P.Vector2(1,1)),this.registerInput("angle",FE.Float,!0,0),this.registerOutput("particle",FE.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(w){const E=new xE(this.name,w.Cx,w.ZE,null,!1,void 0,!0);E.particleEmitterType=new Z,E._lifeTimeCreation.process=(E,G)=>{w.particleContext=E,E.lifeTime=this.lifeTime.getConnectedValue(w),G._emitPower=this.emitPower.getConnectedValue(w)},E._colorCreation.process=E=>{w.particleContext=E,E.color.B(this.color.getConnectedValue(w))},E._sizeCreation.process=E=>{w.particleContext=E,E.size=1,E.scale.B(this.scale.getConnectedValue(w))},E._angleCreation.process=E=>{w.particleContext=E,E.angle=this.angle.getConnectedValue(w)},this.particle._storedValue=E}}(0,x.g)("BABYLON.CreateParticleBlock",PG);class hG{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const w=[];for(const E of this.attachedBlocks)E.isInput&&w.push(E);return w}constructor(w){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new S.d,this.name=w}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(w){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(w)&&this.attachedBlocks.push(w);for(const G of w.inputs){const P=G.connectedPoint;if(P){const G=P.ownerBlock;G!==w&&this._initializeBlock(G,E)}}}async buildAsync(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((G=>{const P=new WE;for(const w of this._systemBlocks)this._initializeBlock(w);for(const h of this.systemBlocks){const G=new YE;G.buildId=this._buildId++,G.ZE=w,G.verbose=E;const B=h.createSystem(G);G.emitErrors(),P.systems.push(B)}this.onBuildObservable.notifyObservers(this),G(P)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const w=new XE("Particle system"),E=new wG("Update position");E.output.connectTo(w.particle);const G=new bE("Position");G.contextualValue=eE.Position;const P=new bE("Scaled direction");P.contextualValue=eE.ScaledDirection;const h=new EG("Add");h.operation=HE.Add,G.output.connectTo(h.left),P.output.connectTo(h.right),h.output.connectTo(E.position);const B=new PG("Create particle"),y=new GG("Box shape");B.particle.connectTo(y.particle),y.output.connectTo(E.particle);const x=new AE("Texture");x.texture.connectTo(w.texture),x.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(w)}removeBlock(w){const E=this.attachedBlocks.indexOf(w);if(E>-1&&this.attachedBlocks.splice(E,1),w.isSystem){const E=this._systemBlocks.indexOf(w);E>-1&&this._systemBlocks.splice(E,1)}}parseSerializedObject(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E||this.clear();const G={};for(const P of w.ti){const w=(0,x.e)(P.customType);if(w){const E=new w;E._deserialize(P),G[P.id]=E,this.attachedBlocks.push(E),E.isSystem&&this._systemBlocks.push(E)}}for(const P of this.attachedBlocks)if(P.isTeleportOut){const w=P,E=w._tempEntryPointUniqueId;if(E){const P=G[E];P&&P.attachToEndpoint(w)}}for(let P=0;P<w.ti.length;P++){const h=w.ti[P],B=G[h.id];B&&(B.inputs.length&&h.inputs.some((w=>w.targetConnectionName))&&!E||this._restoreConnections(B,w,G))}if(w.locations||w.editorData&&w.editorData.locations){const P=w.locations||w.editorData.locations;for(const w of P)G[w.wh]&&(w.wh=G[w.wh].uniqueId);E&&this.editorData&&this.editorData.locations&&P.concat(this.editorData.locations),w.locations?this.editorData={locations:P}:(this.editorData=w.editorData,this.editorData.locations=P);const h=[];for(const w in G)h[w]=G[w].uniqueId;this.editorData.map=h}this.comment=w.comment}_restoreConnections(w,E,G){for(const P of w.outputs)for(const h of E.ti){const B=G[h.id];if(B)for(const y of h.inputs)if(G[y.targetBlockId]!==w||y.targetConnectionName!==P.name);else{const w=B.getInputByName(y.inputName);if(!w||w.isConnected)continue;P.connectTo(w,!0),this._restoreConnections(B,E,G)}}}serialize(w){const E=w?{}:v.b.Serialize(this);E.editorData=JSON.parse(JSON.stringify(this.editorData));let G=[];w?G=w:E.customType="BABYLON.NodeParticleSystemSet",E.ti=[];for(const P of G)E.ti.push(P.serialize());if(!w)for(const P of this.attachedBlocks)-1===G.indexOf(P)&&E.ti.push(P.serialize());return E}dispose(){for(const w of this.attachedBlocks)w.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(w){const E=new hG(w);return E.setToDefault(),E}static Parse(w){const E=v.b.Parse((()=>new hG(w.name)),w,null);return E.parseSerializedObject(w),E}static ParseFromSnippetAsync(w,E){return"_BLANK"===w?Promise.resolve(hG.CreateDefault("blank")):new Promise(((G,P)=>{const h=new TE.c;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const y=JSON.parse(JSON.parse(h.responseText).jsonPayload),x=JSON.parse(y.nodeParticle);E||(E=v.b.Parse((()=>new hG(w)),x,null)),E.parseSerializedObject(x),E.snippetId=w;try{G(E)}catch(B){P(B)}}else P("Unable to load the snippet "+w)})),h.open("GET",this.SnippetUrl+"/"+w.replace(/#/g,"/")),h.send()}))}}hG.EditorURL=`${KE.Tools._DefaultCdnUrl}/v${rw.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,hG.SnippetUrl="https://snippet.babylonjs.com",(0,k.c)([(0,N.F)()],hG.prototype,"name",void 0),(0,k.c)([(0,N.F)("comment")],hG.prototype,"comment",void 0),function(w){w[w.None=0]="None",w[w.PerParticle=1]="PerParticle",w[w.PerSystem=2]="PerSystem"}(zE||(zE={}));class BG extends nE{constructor(w){super(w),this._currentLockId=-2,this.lockMode=zE.PerParticle,this.registerInput("min",FE.AutoDetect,!0,0),this.registerInput("max",FE.AutoDetect,!0,1),this.registerOutput("output",FE.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FE.Float|FE.Int|FE.Vector2|FE.QE|FE.Tx),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(FE.Float|FE.Int|FE.Vector2|FE.QE|FE.Tx),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=FE.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let w=null;switch(this._currentLockId=-2,this.min.type){case FE.AutoDetect:case FE.Int:case FE.Float:w=w=>{const E=this.min.getConnectedValue(w)||0,G=this.max.getConnectedValue(w)||1;return E+Math.random()*(G-E)};break;case FE.Vector2:w=w=>{const E=this.min.getConnectedValue(w)||P.Vector2.Zero(),G=this.max.getConnectedValue(w)||P.Vector2.One();return new P.Vector2(E.x+Math.random()*(G.x-E.x),E.y+Math.random()*(G.y-E.y))};break;case FE.QE:w=w=>{const E=this.min.getConnectedValue(w)||P.QE.Zero(),G=this.max.getConnectedValue(w)||P.QE.One();return new P.QE(E.x+Math.random()*(G.x-E.x),E.y+Math.random()*(G.y-E.y),E.z+Math.random()*(G.z-E.z))};break;case FE.Tx:w=w=>{const E=this.min.getConnectedValue(w)||new y.Tx(0,0,0,0),G=this.max.getConnectedValue(w)||new y.Tx(1,1,1,1);return new y.Tx(E.x+Math.random()*(G.x-E.x),E.y+Math.random()*(G.y-E.y),E.z+Math.random()*(G.z-E.z),E.w+Math.random()*(G.w-E.w))}}this.output._storedFunction=E=>{var G;let P=0;switch(this.lockMode){case zE.PerParticle:P=(null===(G=E.particleContext)||void 0===G?void 0:G.id)||-1;break;case zE.PerSystem:P=E.buildId||0}return this._currentLockId!==P&&(this.lockMode!==zE.None&&(this._currentLockId=P),this.output._storedValue=w(E)),this.output._storedValue}}serialize(){const w=super.serialize();return w.lockMode=this.lockMode,w}_deserialize(w){super._deserialize(w),this.lockMode=w.lockMode}}(0,k.c)([rE("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:zE.None},{label:"Per particle",value:zE.PerParticle},{label:"Per system",value:zE.PerSystem}]})],BG.prototype,"lockMode",void 0),(0,x.g)("BABYLON.ParticleRandomBlock",BG);class yG extends nE{constructor(w){super(w),this._currentLockId=-2,this.lockMode=zE.PerParticle,this.registerInput("min",FE.AutoDetect),this.registerInput("max",FE.AutoDetect),this.registerOutput("output",FE.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const E=[FE.Matrix,FE.Particle,FE.Texture,FE.System,FE.FloatGradient,FE.Color4Gradient,FE.Vector2Gradient,FE.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...E),this.max.excludedConnectionPointTypes.push(...E)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let w=null;switch(this._currentLockId=-2,this.min.type){case FE.Float:case FE.Int:w=w=>{const E=this.min.getConnectedValue(w),G=this.max.getConnectedValue(w);return Math.random()*(G-E)+E};break;case FE.Vector2:w=w=>{const E=this.min.getConnectedValue(w),G=this.max.getConnectedValue(w);return new P.Vector2(Math.random()*(G.x-E.x)+E.x,Math.random()*(G.y-E.y)+E.y)};break;case FE.QE:w=w=>{const E=this.min.getConnectedValue(w),G=this.max.getConnectedValue(w);return new P.QE(Math.random()*(G.x-E.x)+E.x,Math.random()*(G.y-E.y)+E.y,Math.random()*(G.z-E.z)+E.z)};break;case FE.Tx:w=w=>{const E=this.min.getConnectedValue(w),G=this.max.getConnectedValue(w);return new y.Tx(Math.random()*(G.r-E.r)+E.r,Math.random()*(G.g-E.g)+E.g,Math.random()*(G.b-E.b)+E.b,Math.random()*(G.a-E.a)+E.a)}}this.output._storedFunction=E=>{var G;let P=0;switch(this.lockMode){case zE.PerParticle:P=(null===(G=E.particleContext)||void 0===G?void 0:G.id)||-1;break;case zE.PerSystem:P=E.buildId||0}return this._currentLockId!==P&&(this.lockMode!==zE.None&&(this._currentLockId=P),this.output._storedValue=w(E)),this.output._storedValue}}serialize(){const w=super.serialize();return w.lockMode=this.lockMode,w}_deserialize(w){super._deserialize(w),void 0!==w.lockMode&&(this.lockMode=w.lockMode)}}(0,k.c)([rE("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:zE.None},{label:"Per particle",value:zE.PerParticle},{label:"Per system",value:zE.PerSystem}]})],yG.prototype,"lockMode",void 0),(0,x.g)("BABYLON.RandomRangeBlock",yG);(0,x.g)("BABYLON.ParticleLerpBlock",class extends nE{constructor(w){super(w),this.registerInput("left",FE.AutoDetect),this.registerInput("right",FE.AutoDetect),this.registerInput("gradient",FE.Float,!0,0,0,1),this.registerOutput("output",FE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FE.Float|FE.Int|FE.Vector2|FE.QE|FE.Tx)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const w=(w,E,G)=>(1-w)*E+w*G;this.output._storedFunction=E=>{const G=this.left.getConnectedValue(E),h=this.right.getConnectedValue(E),B=this.gradient.getConnectedValue(E);switch(this.left.type){case FE.Int:case FE.Float:return w(B,G,h);case FE.Vector2:return new P.Vector2(w(B,G.x,h.x),w(B,G.y,h.y));case FE.QE:return new P.QE(w(B,G.x,h.x),w(B,G.y,h.y),w(B,G.z,h.z));case FE.Tx:return new y.Tx(w(B,G.r,h.r),w(B,G.g,h.g),w(B,G.b,h.b),w(B,G.a,h.a))}return 0}}});(0,x.g)("BABYLON.UpdateDirectionBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("direction",FE.QE),this.registerOutput("output",FE.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(w){const E=this.particle.getConnectedValue(w);if(this.output._storedValue=E,!this.direction.isConnected)return;const G={process:G=>{w.particleContext=G,w.systemContext=E,G.direction.B(this.direction.getConnectedValue(w))},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G}});(0,x.g)("BABYLON.UpdateColorBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("color",FE.Tx),this.registerOutput("output",FE.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(w){const E=this.particle.getConnectedValue(w);if(this.output._storedValue=E,!this.color.isConnected)return;const G={process:G=>{w.particleContext=G,w.systemContext=E,G.color.B(this.color.getConnectedValue(w))},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G}});(0,x.g)("BABYLON.UpdateScaleBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("scale",FE.Vector2),this.registerOutput("output",FE.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(w){const E=this.particle.getConnectedValue(w);if(this.output._storedValue=E,!this.scale.isConnected)return;const G={process:G=>{w.particleContext=G,w.systemContext=E,G.scale.B(this.scale.getConnectedValue(w))},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G}});(0,x.g)("BABYLON.UpdateAngleBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("angle",FE.Float),this.registerOutput("output",FE.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(w){const E=this.particle.getConnectedValue(w);if(this.output._storedValue=E,!this.angle.isConnected)return;const G={process:G=>{w.particleContext=G,w.systemContext=E,G.angle=this.angle.getConnectedValue(w)},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G}});(0,x.g)("BABYLON.BasicPositionUpdateBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerOutput("output",FE.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(w){const E=this.particle.getConnectedValue(w),G={process:G=>{w.particleContext=G,w.systemContext=E,G.direction.scaleToRef(E._directionScale,E._scaledDirection),G.position.addInPlace(E._scaledDirection)},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G,this.output._storedValue=E}});(0,x.g)("BABYLON.BasicSpriteUpdateBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerOutput("output",FE.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(w){const E=this.particle.getConnectedValue(w),G={process:G=>{w.particleContext=G,w.systemContext=E,G.updateCellIndex()},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G,this.output._storedValue=E}});(0,x.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("cellIndex",FE.Int),this.registerOutput("output",FE.Particle),this.cellIndex.acceptedConnectionPointTypes=[FE.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(w){const E=this.particle.getConnectedValue(w);if(this.output._storedValue=E,!this.cellIndex.isConnected)return;const G={process:G=>{w.particleContext=G,w.systemContext=E,G.cellIndex=Math.floor(this.cellIndex.getConnectedValue(w))},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G}});class xG extends nE{constructor(w){super(w),this.strength=1,this.registerInput("particle",FE.Particle),this.registerInput("flowMap",FE.Texture),this.registerOutput("output",FE.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(w){var E;const G=this.particle.getConnectedValue(w),P=w.ZE;let h;(null===(E=this.flowMap.connectedPoint)||void 0===E?void 0:E.ownerBlock).extractTextureContentAsync().then((w=>{w&&(h=new sE(w.width,w.height,w.data))}));const B={process:w=>{const E=P.getTransformMatrix();h&&h._processParticle(w,this.strength*G._tempScaledUpdateSpeed,E)},previousItem:null,nextItem:null};G._updateQueueStart?Rw(B,G._updateQueueStart):G._updateQueueStart=B,this.output._storedValue=G}serialize(){const w=super.serialize();return w.strength=this.strength,w}_deserialize(w){super._deserialize(w),this.strength=w.strength}}(0,k.c)([rE("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xG.prototype,"strength",void 0),(0,x.g)("BABYLON.UpdateFlowMapBlock",xG);(0,x.g)("BABYLON.SphereShapeBlock",class extends nE{constructor(w){super(w),this.registerInput("input",FE.Particle),this.registerInput("radius",FE.Float,!0,1),this.registerInput("radiusRange",FE.Float,!0,1,0,1),this.registerInput("directionRandomizer",FE.Float,!0,0,0,1),this.registerOutput("output",FE.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(w){const E=this.input.getConnectedValue(w);E._directionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.directionRandomizer.getConnectedValue(w),B=G.position.cE(w.emitterPosition).normalize(),y=(0,l.RandomRange)(0,h),x=(0,l.RandomRange)(0,h),U=(0,l.RandomRange)(0,h);B.x+=y,B.y+=x,B.z+=U,B.normalize(),w.isEmitterTransformNode?P.QE.TransformNormalFromFloatsToRef(y,x,U,w.emitterWorldMatrix,G.direction):G.direction.tx(y,x,U)},E._positionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.radius.getConnectedValue(w),B=this.radiusRange.getConnectedValue(w),y=h-(0,l.RandomRange)(0,h*B),x=(0,l.RandomRange)(0,1),U=(0,l.RandomRange)(0,2*Math.PI),i=Math.acos(2*x-1),O=y*Math.cos(U)*Math.sin(i),u=y*Math.cos(i),V=y*Math.sin(U)*Math.sin(i);w.isEmitterTransformNode?P.QE.TransformCoordinatesFromFloatsToRef(O,u,V,w.emitterWorldMatrix,G.position):(G.position.tx(O,u,V),G.position.addInPlace(w.emitterPosition))},this.output._storedValue=E}});(0,x.g)("BABYLON.PointShapeBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("direction1",FE.QE,!0,new P.QE(0,1,0)),this.registerInput("direction2",FE.QE,!0,new P.QE(0,1,0)),this.registerOutput("output",FE.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){const E=this.particle.getConnectedValue(w);E._directionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.direction1.getConnectedValue(w),B=this.direction2.getConnectedValue(w),y=(0,l.RandomRange)(h.x,B.x),x=(0,l.RandomRange)(h.y,B.y),U=(0,l.RandomRange)(h.z,B.z);w.isEmitterTransformNode?P.QE.TransformNormalFromFloatsToRef(y,x,U,w.emitterWorldMatrix,G.direction):G.direction.tx(y,x,U)},E._positionCreation.process=G=>{w.systemContext=E,w.isEmitterTransformNode?P.QE.TransformCoordinatesFromFloatsToRef(0,0,0,w.emitterWorldMatrix,G.position):G.position.B(w.emitterPosition)},this.output._storedValue=E}});(0,x.g)("BABYLON.CustomShapeBlock",class extends nE{constructor(w){super(w),this.registerInput("particle",FE.Particle),this.registerInput("position",FE.QE,!0,new P.QE(0,0,0)),this.registerInput("direction",FE.QE,!0,new P.QE(0,1,0)),this.registerOutput("output",FE.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){const E=this.particle.getConnectedValue(w);E._directionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.direction.getConnectedValue(w);w.isEmitterTransformNode?P.QE.TransformNormalToRef(h,w.emitterWorldMatrix,G.direction):G.direction.B(h)},E._positionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.position.getConnectedValue(w);w.isEmitterTransformNode?P.QE.TransformCoordinatesToRef(h,w.emitterWorldMatrix,G.position):(G.position.B(h),G.position.addInPlace(w.emitterPosition))},this.output._storedValue=E}});(0,x.g)("BABYLON.CylinderShapeBlock",class extends nE{constructor(w){super(w),this._tempVector=P.QE.Zero(),this.registerInput("particle",FE.Particle),this.registerInput("radius",FE.Float,!0,1),this.registerInput("height",FE.Float,!0,1,0),this.registerInput("radiusRange",FE.Float,!0,1,0,1),this.registerInput("directionRandomizer",FE.Float,!0,0,0,1),this.registerOutput("output",FE.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(w){const E=this.particle.getConnectedValue(w);E._directionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.directionRandomizer.getConnectedValue(w);G.position.subtractToRef(w.emitterPosition,this._tempVector),this._tempVector.normalize(),w.isEmitterTransformNode&&P.QE.TransformNormalToRef(this._tempVector,w.emitterInverseWorldMatrix,this._tempVector);const B=(0,l.RandomRange)(-h/2,h/2);let y=Math.atan2(this._tempVector.x,this._tempVector.z);y+=(0,l.RandomRange)(-Math.PI/2,Math.PI/2)*h,this._tempVector.y=B,this._tempVector.x=Math.sin(y),this._tempVector.z=Math.cos(y),this._tempVector.normalize(),w.isEmitterTransformNode?P.QE.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,w.emitterWorldMatrix,G.direction):G.direction.B(this._tempVector)},E._positionCreation.process=G=>{w.particleContext=G,w.systemContext=E;const h=this.height.getConnectedValue(w),B=this.radiusRange.getConnectedValue(w),y=this.radius.getConnectedValue(w),x=(0,l.RandomRange)(-h/2,h/2),U=(0,l.RandomRange)(0,2*Math.PI),i=(0,l.RandomRange)((1-B)*(1-B),1),O=Math.sqrt(i)*y,u=O*Math.cos(U),V=O*Math.sin(U);w.isEmitterTransformNode?P.QE.TransformCoordinatesFromFloatsToRef(u,x,V,w.emitterWorldMatrix,G.position):(G.position.tx(u,x,V),G.position.addInPlace(w.emitterPosition))},this.output._storedValue=E}});class UG extends nE{constructor(w){super(w),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",FE.Particle),this.registerOutput("output",FE.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);const E=this.particle.getConnectedValue(w);E._isAnimationSheetEnabled=!0,E.spriteCellWidth=this.width,E.spriteCellHeight=this.height,E.startSpriteCellID=this.start,E.endSpriteCellID=this.end,E.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=E}serialize(){const w=super.serialize();return w.width=this.width,w.height=this.height,w.start=this.start,w.end=this.end,w.randomStartCell=this.randomStartCell,w}_deserialize(w){super._deserialize(w),this.width=w.width,this.height=w.height,this.start=w.start,this.end=w.end,this.randomStartCell=w.randomStartCell}}(0,k.c)([rE("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UG.prototype,"start",void 0),(0,k.c)([rE("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UG.prototype,"end",void 0),(0,k.c)([rE("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UG.prototype,"width",void 0),(0,k.c)([rE("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UG.prototype,"height",void 0),(0,k.c)([rE("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UG.prototype,"loop",void 0),(0,k.c)([rE("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UG.prototype,"randomStartCell",void 0),(0,x.g)("BABYLON.SetupSpriteSheetBlock",UG);class lG extends nE{constructor(w){super(w),this.reference=0,this.registerInput("value",FE.AutoDetect),this.registerOutput("output",FE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=w=>{switch(w){case FE.Float:return FE.FloatGradient;case FE.Vector2:return FE.Vector2Gradient;case FE.QE:return FE.Vector3Gradient;case FE.Tx:return FE.Color4Gradient}return w},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FE.Float|FE.Vector2|FE.QE|FE.Tx)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=w=>null}serialize(){const w=super.serialize();return w.reference=this.reference,w}_deserialize(w){super._deserialize(w),this.reference=w.reference}}(0,k.c)([rE("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],lG.prototype,"reference",void 0),(0,x.g)("BABYLON.ParticleGradientValueBlock",lG);(0,x.g)("BABYLON.ParticleGradientBlock",class extends nE{constructor(w){super(w),this._entryCount=1,this.registerInput("gradient",FE.Float,!0,1,0,1),this.registerInput("value0",FE.AutoDetect),this.registerOutput("output",FE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=w=>{switch(w){case FE.FloatGradient:return FE.Float;case FE.Vector2Gradient:return FE.Vector2;case FE.Vector3Gradient:return FE.QE;case FE.Color4Gradient:return FE.Tx}return w},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(FE.FloatGradient|FE.Vector2Gradient|FE.Vector3Gradient|FE.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(w){this._inputs[w].onConnectionObservable.add((()=>{this._entryCount>w||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),FE.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const w=[];for(let G=1;G<this._inputs.length;G++){var E;if(this._inputs[G].isConnected)w.push(null===(E=this._inputs[G].connectedPoint)||void 0===E?void 0:E.ownerBlock)}w.sort(((w,E)=>w.reference-E.reference)),this.output._storedFunction=E=>{const G=this.gradient.getConnectedValue(E);if(1===w.length)return w[0].value.getConnectedValue(E);let h=null;for(let B=w.length-1;B>=0;B--){const x=w[B];if(x.reference<=G){const w=x.value.getConnectedValue(E);if(h){const B=h.value.getConnectedValue(E),U=h.reference,i=x.reference,O=Math.max(0,Math.min(1,(G-i)/(U-i)));switch(this.output.type){case FE.Float:return(0,l.Lerp)(w,B,O);case FE.Vector2:return P.Vector2.Lerp(w,B,O);case FE.QE:return P.QE.Lerp(w,B,O);case FE.Tx:return y.Tx.Lerp(w,B,O)}}return w}h=x}return 0}}});(0,x.g)("BABYLON.ParticleConverterBlock",class extends nE{constructor(w){super(w),this.registerInput("color ",FE.Tx,!0),this.registerInput("xyz ",FE.QE,!0),this.registerInput("xy ",FE.Vector2,!0),this.registerInput("zw ",FE.Vector2,!0),this.registerInput("x ",FE.Float,!0),this.registerInput("y ",FE.Float,!0),this.registerInput("z ",FE.Float,!0),this.registerInput("w ",FE.Float,!0),this.registerOutput("color",FE.Tx),this.registerOutput("xyz",FE.QE),this.registerOutput("xy",FE.Vector2),this.registerOutput("zw",FE.Vector2),this.registerOutput("x",FE.Float),this.registerOutput("y",FE.Float),this.registerOutput("z",FE.Float),this.registerOutput("w",FE.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(w){return"color "===w?"colorIn":"xyz "===w?"xyzIn":"xy "===w?"xyIn":"zw "===w?"zwIn":"x "===w?"xIn":"y "===w?"yIn":"z "===w?"zIn":"w "===w?"wIn":w}_outputRename(w){switch(w){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return w}}_build(w){super._build(w);const E=this.xIn,G=this.yIn,h=this.zIn,B=this.wIn,x=this.xyIn,U=this.zwIn,l=this.xyzIn,i=this.colorIn,O=this.colorOut,u=this.xyzOut,V=this.xyOut,a=this.zwOut,Q=this.xOut,c=this.yOut,Z=this.zOut,J=this.wOut,d=w=>{if(i.isConnected)return i.getConnectedValue(w);let P=0,O=0,u=0,V=0;if(E.isConnected&&(P=E.getConnectedValue(w)),G.isConnected&&(O=G.getConnectedValue(w)),h.isConnected&&(u=h.getConnectedValue(w)),B.isConnected&&(V=B.getConnectedValue(w)),x.isConnected){const E=x.getConnectedValue(w);E&&(P=E.x,O=E.y)}if(U.isConnected){const E=U.getConnectedValue(w);E&&(u=E.x,V=E.y)}if(l.isConnected){const E=l.getConnectedValue(w);E&&(P=E.x,O=E.y,u=E.z)}return new y.Tx(P,O,u,V)};O._storedFunction=w=>d(w),u._storedFunction=w=>{const E=d(w);return new P.QE(E.r,E.g,E.b)},V._storedFunction=w=>{const E=d(w);return new P.Vector2(E.r,E.g)},a._storedFunction=w=>{const E=d(w);return new P.Vector2(E.b,E.a)},Q._storedFunction=w=>d(w).r,c._storedFunction=w=>d(w).g,Z._storedFunction=w=>d(w).b,J._storedFunction=w=>d(w).a}}),function(w){w[w.Cos=0]="Cos",w[w.Sin=1]="Sin",w[w.Abs=2]="Abs",w[w.Exp=3]="Exp",w[w.Exp2=4]="Exp2",w[w.Round=5]="Round",w[w.Floor=6]="Floor",w[w.Ceiling=7]="Ceiling",w[w.Sqrt=8]="Sqrt",w[w.Log=9]="Log",w[w.Tan=10]="Tan",w[w.ArcTan=11]="ArcTan",w[w.ArcCos=12]="ArcCos",w[w.ArcSin=13]="ArcSin",w[w.Sign=14]="Sign",w[w.Negate=15]="Negate",w[w.OneMinus=16]="OneMinus",w[w.Reciprocal=17]="Reciprocal",w[w.ToDegrees=18]="ToDegrees",w[w.ToRadians=19]="ToRadians",w[w.Fract=20]="Fract"}(LE||(LE={}));class iG extends nE{constructor(w){super(w),this.operation=LE.Cos,this.registerInput("input",FE.AutoDetect),this.registerOutput("output",FE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FE.Float|FE.Int|FE.Vector2|FE.QE|FE.Tx)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);let E=null;switch(this.operation){case LE.Cos:E=w=>Math.cos(w);break;case LE.Sin:E=w=>Math.sin(w);break;case LE.Abs:E=w=>Math.abs(w);break;case LE.Exp:E=w=>Math.exp(w);break;case LE.Exp2:E=w=>Math.pow(2,w);break;case LE.Round:E=w=>Math.round(w);break;case LE.Floor:E=w=>Math.floor(w);break;case LE.Ceiling:E=w=>Math.ceil(w);break;case LE.Sqrt:E=w=>Math.sqrt(w);break;case LE.Log:E=w=>Math.log(w);break;case LE.Tan:E=w=>Math.tan(w);break;case LE.ArcTan:E=w=>Math.atan(w);break;case LE.ArcCos:E=w=>Math.acos(w);break;case LE.ArcSin:E=w=>Math.asin(w);break;case LE.Sign:E=w=>Math.sign(w);break;case LE.Negate:E=w=>-w;break;case LE.OneMinus:E=w=>1-w;break;case LE.Reciprocal:E=w=>1/w;break;case LE.ToRadians:E=w=>w*Math.PI/180;break;case LE.ToDegrees:E=w=>180*w/Math.PI;break;case LE.Fract:E=w=>w>=0?w-Math.floor(w):w-Math.ceil(w)}if(!E)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case FE.Int:case FE.Float:this.output._storedFunction=w=>{const G=this.input.getConnectedValue(w);return E(G)};break;case FE.Vector2:this.output._storedFunction=w=>{const G=this.input.getConnectedValue(w);return new P.Vector2(E(G.x),E(G.y))};break;case FE.QE:this.output._storedFunction=w=>{const G=this.input.getConnectedValue(w);return new P.QE(E(G.x),E(G.y),E(G.z))};break;case FE.Tx:this.output._storedFunction=w=>{const G=this.input.getConnectedValue(w);return new y.Tx(E(G.r),E(G.g),E(G.b),E(G.a))}}return this}serialize(){const w=super.serialize();return w.operation=this.operation,w}_deserialize(w){super._deserialize(w),this.operation=w.operation}}(0,k.c)([rE("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:LE.Cos},{label:"Sin",value:LE.Sin},{label:"Abs",value:LE.Abs},{label:"Exp",value:LE.Exp},{label:"Exp2",value:LE.Exp2},{label:"Round",value:LE.Round},{label:"Floor",value:LE.Floor},{label:"Ceiling",value:LE.Ceiling},{label:"Sqrt",value:LE.Sqrt},{label:"Log",value:LE.Log},{label:"Tan",value:LE.Tan},{label:"ArcTan",value:LE.ArcTan},{label:"ArcCos",value:LE.ArcCos},{label:"ArcSin",value:LE.ArcSin},{label:"Sign",value:LE.Sign},{label:"Negate",value:LE.Negate},{label:"OneMinus",value:LE.OneMinus},{label:"Reciprocal",value:LE.Reciprocal},{label:"ToDegrees",value:LE.ToDegrees},{label:"ToRadians",value:LE.ToRadians},{label:"Fract",value:LE.Fract}]})],iG.prototype,"operation",void 0),(0,x.g)("BABYLON.ParticleTrigonometryBlock",iG);var OG,uG=G(12985);class VG extends nE{constructor(w){super(w),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",FE.AutoDetect),this.registerOutput("output",FE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(FE.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(FE.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(FE.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(FE.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(FE.System),this._inputs[0].excludedConnectionPointTypes.push(FE.Particle),this._inputs[0].excludedConnectionPointTypes.push(FE.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const E=w=>{const E=this.input.getConnectedValue(w);if(this.log.length>=this.stackSize)return E;if(null===E||void 0===E)return this.log.push(["null",""]),E;switch(this.input.type){case FE.Vector2:this.log.push([(0,uG.h)(E,4),E.toString()]);break;case FE.QE:this.log.push([(0,uG.l)(E,4),E.toString()]);break;case FE.Tx:this.log.push([`{R: ${E.r.toFixed(4)} G: ${E.g.toFixed(4)} B: ${E.b.toFixed(4)} A: ${E.a.toFixed(4)}}`,E.toString()]);break;default:this.log.push([E.toString(),E.toString()])}return E};this.output.isConnected?this.output._storedFunction=E:this.output._storedValue=E(w)}serialize(){const w=super.serialize();return w.stackSize=this.stackSize,w}_deserialize(w){super._deserialize(w),this.stackSize=w.stackSize}}(0,k.c)([rE("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],VG.prototype,"stackSize",void 0),(0,x.g)("BABYLON.ParticleDebugBlock",VG);(0,x.g)("BABYLON.ParticleElbowBlock",class extends nE{constructor(w){super(w),this.registerInput("input",FE.AutoDetect),this.registerOutput("output",FE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);const E=this._outputs[0],G=this._inputs[0];E._storedFunction=w=>G.getConnectedValue(w)}});(0,x.g)("BABYLON.ParticleTeleportInBlock",class extends nE{get endpoints(){return this._endpoints}constructor(w){super(w),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",FE.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(w){if(this.getClassName()===w)return!0;for(const E of this.endpoints)if(E.isAnAncestorOfType(w))return!0;return!1}isAnAncestorOf(w){for(const E of this.endpoints){if(E===w)return!0;if(E.isAnAncestorOf(w))return!0}return!1}attachToEndpoint(w){w.detach(),this._endpoints.push(w),w._entryPoint=this,w._outputs[0]._typeConnectionSource=this._inputs[0],w._tempEntryPointUniqueId=null,w.name="> "+this.name}detachFromEndpoint(w){const E=this._endpoints.indexOf(w);-1!==E&&(this._endpoints.splice(E,1),w._outputs[0]._typeConnectionSource=null,w._entryPoint=null)}_build(){for(const w of this._endpoints)w.output._storedFunction=w=>this.input.getConnectedValue(w)}});(0,x.g)("BABYLON.ParticleTeleportOutBlock",class extends nE{constructor(w){super(w),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",FE.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(w){this.entryPoint&&this.entryPoint.build(w)}clone(){const w=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(w),w}serialize(){var w;const E=super.serialize();return E.entryPoint=(null===(w=this.entryPoint)||void 0===w?void 0:w.uniqueId)??"",E}_deserialize(w){super._deserialize(w),this._tempEntryPointUniqueId=w.entryPoint}}),function(w){w[w.Equal=0]="Equal",w[w.NotEqual=1]="NotEqual",w[w.LessThan=2]="LessThan",w[w.GreaterThan=3]="GreaterThan",w[w.LessOrEqual=4]="LessOrEqual",w[w.GreaterOrEqual=5]="GreaterOrEqual",w[w.Xor=6]="Xor",w[w.Or=7]="Or",w[w.And=8]="And"}(OG||(OG={}));class aG extends nE{constructor(w){super(w),this.test=OG.Equal,this.epsilon=0,this.registerInput("left",FE.Float),this.registerInput("right",FE.Float,!0,0),this.registerInput("ifTrue",FE.AutoDetect,!0,1),this.registerInput("ifFalse",FE.AutoDetect,!0,0),this.registerOutput("output",FE.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=FE.Float,this._inputs[0].acceptedConnectionPointTypes.push(FE.Int),this._inputs[1].acceptedConnectionPointTypes.push(FE.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const w=w=>{const E=this.left.getConnectedValue(w),G=this.right.getConnectedValue(w);let P=!1;switch(this.test){case OG.Equal:P=(0,l.WithinEpsilon)(E,G,this.epsilon);break;case OG.NotEqual:P=!(0,l.WithinEpsilon)(E,G,this.epsilon);break;case OG.LessThan:P=E<G+this.epsilon;break;case OG.GreaterThan:P=E>G-this.epsilon;break;case OG.LessOrEqual:P=E<=G+this.epsilon;break;case OG.GreaterOrEqual:P=E>=G-this.epsilon;break;case OG.Xor:P=!!E&&!G||!E&&!!G;break;case OG.Or:P=!!E||!!G;break;case OG.And:P=!!E&&!!G}return P};this.output._storedFunction=E=>w(E)?this.ifTrue.getConnectedValue(E):this.ifFalse.getConnectedValue(E)}serialize(){const w=super.serialize();return w.test=this.test,w.epsilon=this.epsilon,w}_deserialize(w){super._deserialize(w),this.test=w.test,void 0!==w.epsilon&&(this.epsilon=w.epsilon)}}(0,k.c)([rE("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:OG.Equal},{label:"NotEqual",value:OG.NotEqual},{label:"LessThan",value:OG.LessThan},{label:"GreaterThan",value:OG.GreaterThan},{label:"LessOrEqual",value:OG.LessOrEqual},{label:"GreaterOrEqual",value:OG.GreaterOrEqual},{label:"Xor",value:OG.Xor},{label:"Or",value:OG.Or},{label:"And",value:OG.And}]})],aG.prototype,"test",void 0),(0,k.c)([rE("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],aG.prototype,"epsilon",void 0),(0,x.g)("BABYLON.ParticleConditionBlock",aG);class QG extends nE{constructor(w){super(w),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",FE.Particle),this.registerInput("condition",FE.Float,!0,0),this.registerInput("system",FE.System),this.registerOutput("output",FE.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){this._triggerCount=0;const E=this.input.getConnectedValue(w),G={process:G=>{if(w.particleContext=G,w.systemContext=E,0!==this.condition.getConnectedValue(w)&&(0===this.limit||this._triggerCount<this.limit)){const P=(new Date).getTime();if(this._previousOne&&P-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=P;const h=this.system.getConnectedValue(w);if(h){const P=SE(h,w.ZE,G.position);P.qh.addOnce((()=>{this._triggerCount--})),E.qh.addOnce((()=>{P.dispose()}))}}},previousItem:null,nextItem:null};E._updateQueueStart?Rw(G,E._updateQueueStart):E._updateQueueStart=G,this.output._storedValue=E}serialize(){const w=super.serialize();return w.limit=this.limit,w.delay=this.delay,w}_deserialize(w){super._deserialize(w),void 0!==w.limit&&(this.limit=w.limit),void 0!==w.delay&&(this.delay=w.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,k.c)([rE("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],QG.prototype,"limit",void 0),(0,k.c)([rE("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],QG.prototype,"delay",void 0),(0,x.g)("BABYLON.ParticleTriggerBlock",QG);G(12987),G(12997),G(13010),G(13054)},13044:(w,E,G)=>{"use strict";var P=G(11595);const h="clipPlaneFragment",B="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13017:(w,E,G)=>{"use strict";var P=G(11595);const h="clipPlaneFragmentDeclaration",B="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13066:(w,E,G)=>{"use strict";var P=G(11595);const h="clipPlaneVertex",B="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13061:(w,E,G)=>{"use strict";var P=G(11595);const h="clipPlaneVertexDeclaration",B="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13049:(w,E,G)=>{"use strict";var P=G(11595);const h="fogFragment",B="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13036:(w,E,G)=>{"use strict";var P=G(11595);const h="fogFragmentDeclaration",B="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13073:(w,E,G)=>{"use strict";var P=G(11595);const h="fogVertex",B="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13063:(w,E,G)=>{"use strict";var P=G(11595);const h="fogVertexDeclaration",B="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13030:(w,E,G)=>{"use strict";var P=G(11595);const h="helperFunctions",B="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13019:(w,E,G)=>{"use strict";var P=G(11595);const h="imageProcessingDeclaration",B="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13032:(w,E,G)=>{"use strict";var P=G(11595);const h="imageProcessingFunctions",B="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13025:(w,E,G)=>{"use strict";var P=G(11595);const h="logDepthDeclaration",B="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13047:(w,E,G)=>{"use strict";var P=G(11595);const h="logDepthFragment",B="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13077:(w,E,G)=>{"use strict";var P=G(11595);const h="logDepthVertex",B="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";P.b.IncludesShadersStoreWGSL[h]||(P.b.IncludesShadersStoreWGSL[h]=B)},13010:(w,E,G)=>{"use strict";G.r(E),G.d(E,{particlesPixelShaderWGSL:()=>y});var P=G(11595);G(13017),G(13019),G(13025),G(13030),G(13032),G(13036),G(13044),G(13047),G(13049);const h="particlesPixelShader",B="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";P.b.ShadersStoreWGSL[h]||(P.b.ShadersStoreWGSL[h]=B);const y={name:h,shader:B}},13054:(w,E,G)=>{"use strict";G.r(E),G.d(E,{particlesVertexShaderWGSL:()=>y});var P=G(11595);G(13061),G(13063),G(13025),G(13066),G(13073),G(13077);const h="particlesVertexShader",B="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";P.b.ShadersStoreWGSL[h]||(P.b.ShadersStoreWGSL[h]=B);const y={name:h,shader:B}},12923:(w,E,G)=>{"use strict";var P=G(11595);const h="clipPlaneFragment",B="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12993:(w,E,G)=>{"use strict";var P=G(11595);const h="clipPlaneFragmentDeclaration",B="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12946:(w,E,G)=>{"use strict";var P=G(11595);const h="clipPlaneVertex",B="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},13005:(w,E,G)=>{"use strict";var P=G(11595);const h="clipPlaneVertexDeclaration",B="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12933:(w,E,G)=>{"use strict";var P=G(11595);const h="fogFragment",B="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12921:(w,E,G)=>{"use strict";var P=G(11595);const h="fogFragmentDeclaration",B="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12953:(w,E,G)=>{"use strict";var P=G(11595);const h="fogVertex",B="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12937:(w,E,G)=>{"use strict";var P=G(11595);const h="fogVertexDeclaration",B="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12913:(w,E,G)=>{"use strict";var P=G(11595);const h="helperFunctions",B="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12903:(w,E,G)=>{"use strict";var P=G(11595);const h="imageProcessingDeclaration",B="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12917:(w,E,G)=>{"use strict";var P=G(11595);const h="imageProcessingFunctions",B="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12905:(w,E,G)=>{"use strict";var P=G(11595);const h="logDepthDeclaration",B="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12925:(w,E,G)=>{"use strict";var P=G(11595);const h="logDepthFragment",B="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12957:(w,E,G)=>{"use strict";var P=G(11595);const h="logDepthVertex",B="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";P.b.IncludesShadersStore[h]||(P.b.IncludesShadersStore[h]=B)},12987:(w,E,G)=>{"use strict";G.r(E),G.d(E,{particlesPixelShader:()=>y});var P=G(11595);G(12993),G(12903),G(12905),G(12913),G(12917),G(12921),G(12923),G(12925),G(12933);const h="particlesPixelShader",B="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";P.b.ShadersStore[h]||(P.b.ShadersStore[h]=B);const y={name:h,shader:B}},12997:(w,E,G)=>{"use strict";G.r(E),G.d(E,{particlesVertexShader:()=>y});var P=G(11595);G(13005),G(12937),G(12905),G(12946),G(12953),G(12957);const h="particlesVertexShader",B="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";P.b.ShadersStore[h]||(P.b.ShadersStore[h]=B);const y={name:h,shader:B}},13333:(w,E,G)=>{"use strict";G.r(E),G.d(E,{FlowGraphGLTFDataProvider:()=>B});var P=G(13298),h=G(13281);class B extends P.d{constructor(w){var E,G;super();const P=w.glTF,B=(null===(E=P.animations)||void 0===E?void 0:E.map((w=>w._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",h.c,B);const y=(null===(G=P.nodes)||void 0===G?void 0:G.map((w=>w._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",h.c,y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13231:(w,E,G)=>{"use strict";G.d(E,{b:()=>c,f:()=>a,j:()=>V,n:()=>Q});var P=G(11679),h=G(12134),B=G(11716),y=G(13240);const x=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class U{constructor(w,E){this._gltf=w,this._infoTree=E}convert(w){let E,G=this._gltf,P=this._infoTree;if(!w.startsWith("/"))throw new Error("Path must start with a /");const h=w.split("/");if(h.shift(),h[h.length-1].includes(".length")){const w=h[h.length-1].split(".");h.pop(),h.push(...w)}let B=!1;for(const U of h){const h="length"===U;if(h&&!P.__array__)throw new Error(`Path ${w} is invalid`);if(P.__ignoreObjectTree__&&(B=!0),P.__array__&&!h)P=P.__array__;else if(P=P[U],!P)throw new Error(`Path ${w} is invalid`);if(!B)if(void 0===G){if(!x.find((E=>E.regex.test(w))))throw new Error(`Path ${w} is invalid`)}else if(!h){var y;G=null===(y=G)||void 0===y?void 0:y[U]}(P.__target__||h)&&(E=G)}return{object:E,info:P}}}function l(w,E,G,P){const h=i(w,E);return P?h[G][P]:h[G]}function i(w,E,G){var P,B;return null===(P=w._data)||void 0===P||null===(B=P[(null===G||void 0===G?void 0:G.fillMode)??h.e.MATERIAL_TriangleFillMode])||void 0===B?void 0:B.babylonMaterial}function O(w,E){return{offset:{componentsCount:2,type:"Vector2",get:(G,h,B)=>{const y=l(G,B,w,E);return new P.Vector2(null===y||void 0===y?void 0:y.uOffset,null===y||void 0===y?void 0:y.vOffset)},getTarget:i,set:(G,P,h,B)=>{const y=l(P,B,w,E);y.uOffset=G.x,y.vOffset=G.y},getPropertyName:[()=>`${w}${E?"."+E:""}.uOffset`,()=>`${w}${E?"."+E:""}.vOffset`]},rotation:{type:"number",get:(G,P,h)=>{var B;return null===(B=l(G,h,w,E))||void 0===B?void 0:B.wAng},getTarget:i,set:(G,P,h,B)=>l(P,B,w,E).wAng=G,getPropertyName:[()=>`${w}${E?"."+E:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(G,h,B)=>{const y=l(G,B,w,E);return new P.Vector2(null===y||void 0===y?void 0:y.uScale,null===y||void 0===y?void 0:y.vScale)},getTarget:i,set:(G,P,h,B)=>{const y=l(P,B,w,E);y.uScale=G.x,y.vScale=G.y},getPropertyName:[()=>`${w}${E?"."+E:""}.uScale`,()=>`${w}${E?"."+E:""}.vScale`]}}}const u={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:w=>{var E,G;return new P.Vector2((null===(E=w._babylonCamera)||void 0===E?void 0:E.orthoLeft)??0,(null===(G=w._babylonCamera)||void 0===G?void 0:G.orthoRight)??0)},set:(w,E)=>{E._babylonCamera&&(E._babylonCamera.orthoLeft=w.x,E._babylonCamera.orthoRight=w.y)},getTarget:w=>w,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:w=>{var E,G;return new P.Vector2((null===(E=w._babylonCamera)||void 0===E?void 0:E.orthoBottom)??0,(null===(G=w._babylonCamera)||void 0===G?void 0:G.orthoTop)??0)},set:(w,E)=>{E._babylonCamera&&(E._babylonCamera.orthoBottom=w.x,E._babylonCamera.orthoTop=w.y)},getTarget:w=>w,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:w=>{var E;return null===(E=w._babylonCamera)||void 0===E?void 0:E.maxZ},set:(w,E)=>{E._babylonCamera&&(E._babylonCamera.maxZ=w)},getTarget:w=>w,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:w=>{var E;return null===(E=w._babylonCamera)||void 0===E?void 0:E.Sh},set:(w,E)=>{E._babylonCamera&&(E._babylonCamera.Sh=w)},getTarget:w=>w,getPropertyName:[()=>"Sh"]}},perspective:{aspectRatio:{type:"number",get:w=>{var E;return null===(E=w._babylonCamera)||void 0===E?void 0:E.getEngine().getAspectRatio(w._babylonCamera)},getTarget:w=>w,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:w=>{var E;return null===(E=w._babylonCamera)||void 0===E?void 0:E.fov},set:(w,E)=>{E._babylonCamera&&(E._babylonCamera.fov=w)},getTarget:w=>w,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:w=>{var E;return null===(E=w._babylonCamera)||void 0===E?void 0:E.maxZ},set:(w,E)=>{E._babylonCamera&&(E._babylonCamera.maxZ=w)},getTarget:w=>w,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:w=>{var E;return null===(E=w._babylonCamera)||void 0===E?void 0:E.Sh},set:(w,E)=>{E._babylonCamera&&(E._babylonCamera.Sh=w)},getTarget:w=>w,getPropertyName:[()=>"Sh"]}}}},nodes:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"QE",get:w=>{var E;return null===(E=w._babylonTransformNode)||void 0===E?void 0:E.position},set:(w,E)=>{var G;return null===(G=E._babylonTransformNode)||void 0===G?void 0:G.position.B(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:w=>{var E;return null===(E=w._babylonTransformNode)||void 0===E?void 0:E.rotationQuaternion},set:(w,E)=>{var G,P;return null===(G=E._babylonTransformNode)||void 0===G||null===(P=G.rotationQuaternion)||void 0===P?void 0:P.B(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"QE",get:w=>{var E;return null===(E=w._babylonTransformNode)||void 0===E?void 0:E.qx},set:(w,E)=>{var G;return null===(G=E._babylonTransformNode)||void 0===G?void 0:G.qx.B(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"qx"]},weights:{length:{type:"number",get:w=>w._numMorphTargets,getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(w,E)=>{var G,P;return void 0!==E?null===(G=w._primitiveBabylonMeshes)||void 0===G||null===(P=G[0].morphTargetManager)||void 0===P?void 0:P.getTarget(E).influence:void 0},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(w,E)=>[0],getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:w=>{var E,G,h;return P.Matrix.Compose(null===(E=w._babylonTransformNode)||void 0===E?void 0:E.qx,null===(G=w._babylonTransformNode)||void 0===G?void 0:G.rotationQuaternion,null===(h=w._babylonTransformNode)||void 0===h?void 0:h.position)},getTarget:w=>w._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:w=>{var E,G,h,B;const y=P.Matrix.Identity();let x=w.parent;for(;x&&x.parent;)x=x.parent;const U=(null===(E=w._babylonTransformNode)||void 0===E?void 0:E.position._isDirty)||(null===(G=w._babylonTransformNode)||void 0===G||null===(h=G.rotationQuaternion)||void 0===h?void 0:h._isDirty)||(null===(B=w._babylonTransformNode)||void 0===B?void 0:B.qx._isDirty);if(x){var l;const E=null===(l=x._babylonTransformNode)||void 0===l?void 0:l.Ah(!0).invert();var i,O;if(E)null===(i=w._babylonTransformNode)||void 0===i||null===(O=i.Ah(U))||void 0===O||O.multiplyToRef(E,y)}else w._babylonTransformNode&&y.B(w._babylonTransformNode.Ah(U));return y},getTarget:w=>w._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:w=>{var E,G;return null===(E=w._babylonTransformNode)||void 0===E||null===(G=E.getChildren((w=>w instanceof y.e),!0)[0])||void 0===G?void 0:G.gx},getTarget:w=>{var E;return null===(E=w._babylonTransformNode)||void 0===E?void 0:E.getChildren((w=>w instanceof y.e),!0)[0]},set:(w,E)=>{if(E._babylonTransformNode){const G=E._babylonTransformNode.getChildren((w=>w instanceof y.e),!0)[0];G&&(G.gx=w)}}},color:{type:"dE",get:w=>{var E,G;return null===(E=w._babylonTransformNode)||void 0===E||null===(G=E.getChildren((w=>w instanceof y.e),!0)[0])||void 0===G?void 0:G.ox},getTarget:w=>{var E;return null===(E=w._babylonTransformNode)||void 0===E?void 0:E.getChildren((w=>w instanceof y.e),!0)[0]},set:(w,E)=>{if(E._babylonTransformNode){const G=E._babylonTransformNode.getChildren((w=>w instanceof y.e),!0)[0];G&&(G.ox=w)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"dE",get:(w,E,G)=>i(w,E,G).emissiveColor,set:(w,E,G,P)=>i(E,G,P).emissiveColor.B(w),getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:O("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(w,E,G)=>{var P;return null===(P=l(w,G,"bumpTexture"))||void 0===P?void 0:P.level},set:(w,E,G,P)=>{const h=l(E,P,"bumpTexture");h&&(h.level=w)},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:O("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(w,E,G)=>i(w,E,G).ambientTextureStrength,set:(w,E,G,P)=>{const h=i(E,G,P);h&&(h.ambientTextureStrength=w)},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:O("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Tx",get:(w,E,G)=>{const P=i(w,E,G);return B.Tx.FromColor3(P.albedoColor,P.alpha)},set:(w,E,G,P)=>{const h=i(E,G,P);h.albedoColor.set(w.r,w.g,w.b),h.alpha=w.a},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:O("albedoTexture")}},metallicFactor:{type:"number",get:(w,E,G)=>i(w,E,G).metallic,set:(w,E,G,P)=>{const h=i(E,G,P);h&&(h.metallic=w)},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(w,E,G)=>i(w,E,G).roughness,set:(w,E,G,P)=>{const h=i(E,G,P);h&&(h.roughness=w)},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:O("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(w,E,G)=>i(w,E,G).anisotropy.gx,set:(w,E,G,P)=>{i(E,G,P).anisotropy.gx=w},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(w,E,G)=>i(w,E,G).anisotropy.angle,set:(w,E,G,P)=>{i(E,G,P).anisotropy.angle=w},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:O("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(w,E,G)=>i(w,E,G).clearCoat.gx,set:(w,E,G,P)=>{i(E,G,P).clearCoat.gx=w},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(w,E,G)=>i(w,E,G).clearCoat.roughness,set:(w,E,G,P)=>{i(E,G,P).clearCoat.roughness=w},getTarget:(w,E,G)=>i(w,E,G),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:O("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(w,E,G)=>{var P;return null===(P=i(w,E,G).clearCoat.bumpTexture)||void 0===P?void 0:P.level},getTarget:i,set:(w,E,G,P)=>i(E,G,P).clearCoat.bumpTexture.level=w},extensions:{KHR_texture_transform:O("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:O("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(w,E,G)=>i(w,E,G).subSurface.dispersion,getTarget:i,set:(w,E,G,P)=>i(E,G,P).subSurface.dispersion=w}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(w,E,G)=>i(w,E,G).emissiveIntensity,getTarget:i,set:(w,E,G,P)=>i(E,G,P).emissiveIntensity=w}},KHR_materials_ior:{ior:{type:"number",get:(w,E,G)=>i(w,E,G).indexOfRefraction,getTarget:i,set:(w,E,G,P)=>i(E,G,P).indexOfRefraction=w}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(w,E,G)=>i(w,E,G).iridescence.gx,getTarget:i,set:(w,E,G,P)=>i(E,G,P).iridescence.gx=w},iridescenceIor:{type:"number",get:(w,E,G)=>i(w,E,G).iridescence.indexOfRefraction,getTarget:i,set:(w,E,G,P)=>i(E,G,P).iridescence.indexOfRefraction=w},iridescenceTexture:{extensions:{KHR_texture_transform:O("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(w,E,G)=>i(w,E,G).iridescence.maximumThickness,getTarget:i,set:(w,E,G,P)=>i(E,G,P).iridescence.maximumThickness=w},iridescenceThicknessMinimum:{type:"number",get:(w,E,G)=>i(w,E,G).iridescence.minimumThickness,getTarget:i,set:(w,E,G,P)=>i(E,G,P).iridescence.minimumThickness=w},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:O("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"dE",get:(w,E,G)=>i(w,E,G).sheen.color,getTarget:i,set:(w,E,G,P)=>i(E,G,P).sheen.color.B(w)},sheenColorTexture:{extensions:{KHR_texture_transform:O("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(w,E,G)=>i(w,E,G).sheen.gx,getTarget:i,set:(w,E,G,P)=>i(E,G,P).sheen.gx=w},sheenRoughnessTexture:{extensions:{KHR_texture_transform:O("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(w,E,G)=>i(w,E,G).metallicF0Factor,getTarget:i,set:(w,E,G,P)=>i(E,G,P).metallicF0Factor=w,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"dE",get:(w,E,G)=>i(w,E,G).metallicReflectanceColor,getTarget:i,set:(w,E,G,P)=>i(E,G,P).metallicReflectanceColor.B(w),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:O("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:O("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(w,E,G)=>i(w,E,G).subSurface.refractionIntensity,getTarget:i,set:(w,E,G,P)=>i(E,G,P).subSurface.refractionIntensity=w,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:O("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(w,E,G)=>i(w,E,G).subSurface.translucencyIntensity,getTarget:i,set:(w,E,G,P)=>i(E,G,P).subSurface.translucencyIntensity=w},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:O("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"dE",get:(w,E,G)=>i(w,E,G).subSurface.translucencyColor,getTarget:i,set:(w,E,G,P)=>{var h;return w&&(null===(h=i(E,G,P).subSurface.translucencyColor)||void 0===h?void 0:h.B(w))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:O("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"dE",get:(w,E,G)=>i(w,E,G).subSurface.tintColor,getTarget:i,set:(w,E,G,P)=>i(E,G,P).subSurface.tintColor.B(w)},attenuationDistance:{type:"number",get:(w,E,G)=>i(w,E,G).subSurface.tintColorAtDistance,getTarget:i,set:(w,E,G,P)=>i(E,G,P).subSurface.tintColorAtDistance=w},thicknessFactor:{type:"number",get:(w,E,G)=>i(w,E,G).subSurface.maximumThickness,getTarget:i,set:(w,E,G,P)=>i(E,G,P).subSurface.maximumThickness=w},thicknessTexture:{extensions:{KHR_texture_transform:O("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonLight)),getPropertyName:[w=>"length"]},__array__:{__target__:!0,color:{type:"dE",get:w=>{var E;return null===(E=w._babylonLight)||void 0===E?void 0:E.ox},set:(w,E)=>{var G;return null===(G=E._babylonLight)||void 0===G?void 0:G.ox.B(w)},getTarget:w=>w._babylonLight,getPropertyName:[w=>"diffuse"]},gx:{type:"number",get:w=>{var E;return null===(E=w._babylonLight)||void 0===E?void 0:E.gx},set:(w,E)=>E._babylonLight?E._babylonLight.gx=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"intensity"]},range:{type:"number",get:w=>{var E;return null===(E=w._babylonLight)||void 0===E?void 0:E.range},set:(w,E)=>E._babylonLight?E._babylonLight.range=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"range"]},spot:{innerConeAngle:{type:"number",get:w=>{var E;return null===(E=w._babylonLight)||void 0===E?void 0:E.innerAngle},set:(w,E)=>E._babylonLight?E._babylonLight.innerAngle=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"innerConeAngle"]},outerConeAngle:{type:"number",get:w=>{var E;return null===(E=w._babylonLight)||void 0===E?void 0:E.angle},set:(w,E)=>E._babylonLight?E._babylonLight.angle=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonLight)),getPropertyName:[w=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonTexture)),getPropertyName:[w=>"length"]},__array__:{__target__:!0,gx:{type:"number",get:w=>{var E;return null===(E=w._babylonTexture)||void 0===E?void 0:E.level},set:(w,E)=>{E._babylonTexture&&(E._babylonTexture.level=w)},getTarget:w=>w._babylonTexture},rotation:{type:"Quaternion",get:w=>{var E;return w._babylonTexture&&P.Quaternion.FromRotationMatrix(null===(E=w._babylonTexture)||void 0===E?void 0:E.getReflectionTextureMatrix())},set:(w,E)=>{var G;E._babylonTexture&&(null!==(G=E._babylonTexture.Ww())&&void 0!==G&&G.useRightHandedSystem||(w=P.Quaternion.Inverse(w)),P.Matrix.FromQuaternionToRef(w,E._babylonTexture.getReflectionTextureMatrix()))},getTarget:w=>w._babylonTexture}}}}},animations:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>{var E;return null===(E=w.primitives[0]._instanceData)||void 0===E?void 0:E.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function V(w){return new U(w,u)}function a(w){const E=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let G=u;for(const P of E)P&&(G=G[P]);if(G&&G.type&&G.get)return G}function Q(w,E){const G=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let P=u;for(const h of G)h&&(P=P[h]);P&&P.type&&P.get&&(P.interpolation=E)}function c(w,E){const G=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let P=u;for(const h of G)if(h){if(!P[h]){if("?"===h){P.__ignoreObjectTree__=!0;continue}P[h]={},"__array__"===h&&(P[h].__target__=!0)}P=P[h]}Object.assign(P,E)}},13244:(w,E,G)=>{"use strict";G.r(E),G.d(E,{AnimationPropertyInfo:()=>l,TransformNodeAnimationPropertyInfo:()=>i,WeightAnimationPropertyInfo:()=>O,getQuaternion:()=>x,getVector3:()=>y,getWeights:()=>U});var P=G(12181),h=G(11679),B=G(13231);function y(w,E,G,P){return h.QE.KE(E,G).scaleInPlace(P)}function x(w,E,G,P){return h.Quaternion.KE(E,G).scaleInPlace(P)}function U(w,E,G,P){const h=new Array(w._numMorphTargets);for(let B=0;B<h.length;B++)h[B]=E[G++]*P;return h}class l{constructor(w,E,G,P){this.type=w,this.name=E,this.getValue=G,this.getStride=P}_buildAnimation(w,E,G){const h=new P.e(w,this.name,E,this.type);return h.setKeys(G),h}}class i extends l{buildAnimations(w,E,G,P){const h=[];return h.push({babylonAnimatable:w._babylonTransformNode,babylonAnimation:this._buildAnimation(E,G,P)}),h}}class O extends l{buildAnimations(w,E,G,h){const B=[];if(w._numMorphTargets)for(let y=0;y<w._numMorphTargets;y++){const x=new P.e(`${E}_${y}`,this.name,G,this.type);if(x.setKeys(h.map((w=>({frame:w.frame,inTangent:w.inTangent?w.inTangent[y]:void 0,value:w.value[y],outTangent:w.outTangent?w.outTangent[y]:void 0,interpolation:w.interpolation})))),w._primitiveBabylonMeshes)for(const E of w._primitiveBabylonMeshes)if(E.morphTargetManager){const w=E.morphTargetManager.getTarget(y),G=x.clone();w.animations.push(G),B.push({babylonAnimatable:w,babylonAnimation:G})}}return B}}(0,B.n)("/nodes/{}/translation",[new i(P.e.ANIMATIONTYPE_VECTOR3,"position",y,(()=>3))]),(0,B.n)("/nodes/{}/rotation",[new i(P.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",x,(()=>4))]),(0,B.n)("/nodes/{}/scale",[new i(P.e.ANIMATIONTYPE_VECTOR3,"qx",y,(()=>3))]),(0,B.n)("/nodes/{}/weights",[new O(P.e.ANIMATIONTYPE_FLOAT,"influence",U,(w=>w._numMorphTargets))])},13197:(w,E,G)=>{"use strict";class P{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((w,E)=>{this._resolve=w,this._reject=E}))}}var h=G(11679),B=G(11716),y=G(11498),x=G(12110),U=G(13204),l=G(13219),i=G(11504),O=G(12132),u=G(12181),V=G(12186),a=G(11543),Q=G(11518),c=G(11526);class Z{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(w){this._useTextureToStoreBoneMatrices=w,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(w){this._animationPropertiesOverride=w}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(w,E,G){this.name=w,this.id=E,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=h.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new i.d,this.bones=[],this._scene=G||a.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const P=this._scene.getEngine().getCaps();this._canUseTextureForBones=P.textureFloat&&P.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((w=>!w.getParent()))}getTransformMatrices(w){if(this.needInitialSkinMatrix){if(!w)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return w._bonesTransformMatrices||this.prepare(!0),w._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(w){return this.needInitialSkinMatrix&&w._transformMatrixTexture?w._transformMatrixTexture:this._transformMatrixTexture}Ww(){return this._scene}toString(w){let E=`Name: ${this.name}, nBones: ${this.bones.length}`;if(E+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,w){E+=", Ranges: {";let w=!0;for(const G in this._ranges)w&&(E+=", ",w=!1),E+=G;E+="}"}return E}getBoneIndexByName(w){for(let E=0,G=this.bones.length;E<G;E++)if(this.bones[E].name===w)return E;return-1}createAnimationRange(w,E,G){if(!this._ranges[w]){this._ranges[w]=new V.e(w,E,G);for(let P=0,h=this.bones.length;P<h;P++)this.bones[P].animations[0]&&this.bones[P].animations[0].createRange(w,E,G)}}deleteAnimationRange(w){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let G=0,P=this.bones.length;G<P;G++)this.bones[G].animations[0]&&this.bones[G].animations[0].deleteRange(w,E);this._ranges[w]=null}getAnimationRange(w){return this._ranges[w]||null}getAnimationRanges(){const w=[];let E;for(E in this._ranges)w.push(this._ranges[E]);return w}copyAnimationRange(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[E]||!w.getAnimationRange(E))return!1;let P=!0;const h=this._getHighestAnimationFrame()+1,B={},y=w.bones;let x,U;for(U=0,x=y.length;U<x;U++)B[y[U].name]=y[U];this.bones.length!==y.length&&(Q.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${y.length}`),P=!1);const l=G&&this.dimensionsAtRest&&w.dimensionsAtRest?this.dimensionsAtRest.divide(w.dimensionsAtRest):null;for(U=0,x=this.bones.length;U<x;U++){const w=this.bones[U].name,y=B[w];y?P=P&&this.bones[U].copyAnimationRange(y,E,h,G,l):(Q.e.Warn("copyAnimationRange: not same rig, missing source bone "+w),P=!1)}const i=w.getAnimationRange(E);return i&&(this._ranges[E]=new V.e(E,i.from+h,i.to+h)),P}returnToRest(){for(const w of this.bones)-1!==w._index&&w.returnToRest()}_getHighestAnimationFrame(){let w=0;for(let E=0,G=this.bones.length;E<G;E++)if(this.bones[E].animations[0]){const G=this.bones[E].animations[0].getHighestFrame();w<G&&(w=G)}return w}beginAnimation(w,E,G,P){const h=this.getAnimationRange(w);return h?this._scene.beginAnimation(this,h.from,h.to,E,G,P):null}static MakeAnimationAdditive(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;const P=w.getAnimationRange(G);if(!P)return null;const h=w._scene.getAllAnimatablesByTarget(w);let B=null;for(let x=0;x<h.length;x++){const w=h[x];if(w.fromFrame===(null===P||void 0===P?void 0:P.from)&&w.toFrame===(null===P||void 0===P?void 0:P.to)){B=w;break}}const y=w.getAnimatables();for(let x=0;x<y.length;x++){const w=y[x].animations;if(w)for(let P=0;P<w.length;P++)u.e.MakeAnimationAdditive(w[P],E,G)}return B&&(B.isAdditive=!0),w}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(w){this._meshesWithPoseMatrix.push(w)}_unregisterMeshWithPoseMatrix(w){const E=this._meshesWithPoseMatrix.indexOf(w);E>-1&&this._meshesWithPoseMatrix.splice(E,1)}_computeTransformMatrices(w,E){this.onBeforeComputeObservable.notifyObservers(this);for(let G=0;G<this.bones.length;G++){const P=this.bones[G];P._childUpdateId++;const h=P.getParent();if(h?P.getLocalMatrix().multiplyToRef(h.getFinalMatrix(),P.getFinalMatrix()):E?P.getLocalMatrix().multiplyToRef(E,P.getFinalMatrix()):P.getFinalMatrix().B(P.getLocalMatrix()),-1!==P._index){const E=null===P._index?G:P._index;P.getAbsoluteInverseBindMatrix().multiplyToArray(P.getFinalMatrix(),w,16*E)}}this._identity.copyToArray(w,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const w=this.Ww().getRenderId();if(this._currentRenderId===w)return;this._currentRenderId=w}if(this._numBonesWithLinkedTransformNode>0)for(const w of this.bones)if(w._linkedTransformNode){const E=w._linkedTransformNode;w.position=E.position,E.rotationQuaternion?w.rotationQuaternion=E.rotationQuaternion:w.rotation=E.rotation,w.qx=E.qx}if(this.needInitialSkinMatrix)for(const w of this._meshesWithPoseMatrix){const E=w.getPoseMatrix();let G=this._isDirty;if(w._bonesTransformMatrices&&w._bonesTransformMatrices.length===16*(this.bones.length+1)||(w._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),G=!0),G){if(this._synchronizedWithMesh!==w){this._synchronizedWithMesh=w;for(const w of this.bones)if(!w.getParent()){w.getBindMatrix().multiplyToRef(E,h.TmpVectors.Matrix[1]),w._updateAbsoluteBindMatrices(h.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const E=4*(this.bones.length+1);w._transformMatrixTexture&&w._transformMatrixTexture.getSize().width===E||(w._transformMatrixTexture&&w._transformMatrixTexture.dispose(),w._transformMatrixTexture=O.e.CreateRGBATexture(w._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(w._bonesTransformMatrices,E),this.isUsingTextureForMatrices&&w._transformMatrixTexture&&w._transformMatrixTexture.update(w._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=O.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let w=0;w<this.bones.length;w++)this._animatables.push(this.bones[w])}return this._animatables}clone(w,E){const G=new Z(w,E||w,this._scene);G.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let P=0;P<this.bones.length;P++){const w=this.bones[P];let E=null;const h=w.getParent();if(h){const w=this.bones.indexOf(h);E=G.bones[w]}const B=new l.b(w.name,G,E,w.getBindMatrix().clone(),w.getRestMatrix().clone());B._index=w._index,w._linkedTransformNode&&B.linkTransformNode(w._linkedTransformNode),c.d.DeepCopy(w.animations,B.animations)}if(this._ranges){G._ranges={};for(const w in this._ranges){const E=this._ranges[w];E&&(G._ranges[w]=E.clone())}}return this._isDirty=!0,G.prepare(!0),G}enableBlending(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const E of this.bones)for(const G of E.animations)G.enableBlending=!0,G.blendingSpeed=w}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Ww().stopAnimation(this),this.Ww().removeSkeleton(this),this._parentContainer){const w=this._parentContainer.skeletons.indexOf(this);w>-1&&this._parentContainer.skeletons.splice(w,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const w={};w.name=this.name,w.id=this.id,this.dimensionsAtRest&&(w.dimensionsAtRest=this.dimensionsAtRest.Lh()),w.bones=[],w.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let G=0;G<this.bones.length;G++){var E;const P=this.bones[G],h=P.getParent(),B={parentBoneIndex:h?this.bones.indexOf(h):-1,index:P.getIndex(),name:P.name,id:P.id,matrix:P.getBindMatrix().Lh(),rest:P.getRestMatrix().Lh(),linkedTransformNodeId:null===(E=P.getTransformNode())||void 0===E?void 0:E.id};w.bones.push(B),P.length&&(B.length=P.length),P.metadata&&(B.metadata=P.metadata),P.animations&&P.animations.length>0&&(B.animation=P.animations[0].serialize()),w.ranges=[];for(const E in this._ranges){const G=this._ranges[E];if(!G)continue;const P={};P.name=E,P.from=G.from,P.to=G.to,w.ranges.push(P)}}return w}static Parse(w,E){const G=new Z(w.name,w.id,E);let P;for(w.dimensionsAtRest&&(G.dimensionsAtRest=h.QE.KE(w.dimensionsAtRest)),G.needInitialSkinMatrix=w.needInitialSkinMatrix,P=0;P<w.bones.length;P++){const E=w.bones[P],B=w.bones[P].index;let y=null;E.parentBoneIndex>-1&&(y=G.bones[E.parentBoneIndex]);const x=E.rest?h.Matrix.KE(E.rest):null,U=new l.b(E.name,G,y,h.Matrix.KE(E.matrix),x,null,B);void 0!==E.id&&null!==E.id&&(U.id=E.id),E.length&&(U.length=E.length),E.metadata&&(U.metadata=E.metadata),E.animation&&U.animations.push(u.e.Parse(E.animation)),void 0!==E.linkedTransformNodeId&&null!==E.linkedTransformNodeId&&(G._hasWaitingData=!0,U._waitingTransformNodeId=E.linkedTransformNodeId)}if(w.ranges)for(P=0;P<w.ranges.length;P++){const E=w.ranges[P];G.createAnimationRange(E.name,E.from,E.to)}return G}computeAbsoluteMatrices(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||w)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(w)}getPoseMatrix(){let w=null;return this._meshesWithPoseMatrix.length>0&&(w=this._meshesWithPoseMatrix[0].getPoseMatrix()),w}sortBones(){const w=[],E=new Array(this.bones.length);for(let G=0;G<this.bones.length;G++)this._sortBones(G,w,E);this.bones=w}_sortBones(w,E,G){if(G[w])return;G[w]=!0;const P=this.bones[w];if(!P)return;void 0===P._index&&(P._index=w);const h=P.getParent();h&&this._sortBones(this.bones.indexOf(h),E,G),E.push(P)}setCurrentPoseAsRest(){for(const w of this.bones)w.setCurrentPoseAsRest()}}var J=G(11986),d=G(12145),K=G(11663),t=G(12079),q=G(11748),W=G(12118),T=G(12087),I=G(12103),j=G(12191),g=G(11771),o=G(13162);class f{set areUpdatesFrozen(w){w?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new g.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,w||(w=a.e.LastCreatedScene),this._scene=w,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const w=this._scene.getEngine().getCaps();this._canUseTextureForTargets=w.canUseGLVertexID&&w.textureFloat&&w.maxVertexTextureImageUnits>0&&w.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return f.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?f.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(w){this._numMaxInfluencers!==w&&(this._numMaxInfluencers=w,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(w){this._useTextureToStoreTargets!==w&&(this._useTextureToStoreTargets=w,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var w;return f.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(w=this._scene)&&void 0!==w&&w.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(w){return this._activeTargets.data[w]}getTarget(w){return this._targets[w]}getTargetByName(w){for(const E of this._targets)if(E.name===w)return E;return null}addTarget(w){this._targets.push(w),this._targetInfluenceChangedObservers.push(w.onInfluenceChanged.add((w=>{this.areUpdatesFrozen&&w&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(w)}))),this._targetDataLayoutChangedObservers.push(w._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(w){const E=this._targets.indexOf(w);E>=0&&(this._targets.splice(E,1),w.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(E,1)[0]),w._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(E,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(w)}_bind(w){w.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),w.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),w.setTexture("morphTargets",this._targetStoreTexture),w.setInt("morphTargetCount",this.numInfluencers)}clone(){const w=new f(this._scene);for(const E of this._targets)w.addTarget(E.clone());return w.enablePositionMorphing=this.enablePositionMorphing,w.enableNormalMorphing=this.enableNormalMorphing,w.enableTangentMorphing=this.enableTangentMorphing,w.enableUVMorphing=this.enableUVMorphing,w.enableUV2Morphing=this.enableUV2Morphing,w.enableColorMorphing=this.enableColorMorphing,w}serialize(){const w={};w.id=this.uniqueId,w.targets=[];for(const E of this._targets)w.targets.push(E.serialize());return w}_syncActiveTargets(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const E=!!this._targetStoreTexture,G=this.isUsingTextureForTargets;(this._mustSynchronize||E!==G)&&(this._mustSynchronize=!1,this.synchronize());let P=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let h=-1;for(const B of this._targets)if(h++,0!==B.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=f.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(B),this._morphTargetTextureIndices[P]=h,this._tempInfluences[P++]=B.influence}this._morphTargetTextureIndices.length!==P&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,P)),this._influences&&this._influences.length===P||(this._influences=new Float32Array(P));for(let B=0;B<P;B++)this._influences[B]=this._tempInfluences[B];if(w&&this._scene)for(const B of this._scene.meshes)B.morphTargetManager===this&&(G?B._markSubMeshesAsAttributesDirty():B._syncGeometryWithMorphTargetManager())}synchronize(){var w;if(!this._scene||this.areUpdatesFrozen)return;const E=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(w=this._targetStoreTexture)||void 0===w||w.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>E.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const G of this._targets){this._supportsPositions=this._supportsPositions&&G.hasPositions,this._supportsNormals=this._supportsNormals&&G.hasNormals,this._supportsTangents=this._supportsTangents&&G.hasTangents,this._supportsUVs=this._supportsUVs&&G.hasUVs,this._supportsUV2s=this._supportsUV2s&&G.hasUV2s,this._supportsColors=this._supportsColors&&G.hasColors;const w=G.vertexCount;if(0===this._vertexCount)this._vertexCount=w;else if(this._vertexCount!==w)return void Q.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${G.name}": ${w}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const w=E.getCaps().maxTextureSize;this._textureWidth>w&&(this._textureHeight=Math.ceil(this._textureWidth/w),this._textureWidth=w);const G=this._targets.length,P=new Float32Array(G*this._textureWidth*this._textureHeight*4);let h=0;for(let E=0;E<G;E++){const w=this._targets[E],G=w.getPositions(),B=w.getNormals(),y=w.getUVs(),x=w.getTangents(),U=w.getUV2s(),l=w.getColors();h=E*this._textureWidth*this._textureHeight*4;for(let E=0;E<this._vertexCount;E++)this._supportsPositions&&G&&(P[h]=G[3*E],P[h+1]=G[3*E+1],P[h+2]=G[3*E+2],h+=4),this._supportsNormals&&B&&(P[h]=B[3*E],P[h+1]=B[3*E+1],P[h+2]=B[3*E+2],h+=4),this._supportsUVs&&y&&(P[h]=y[2*E],P[h+1]=y[2*E+1],h+=4),this._supportsTangents&&x&&(P[h]=x[3*E],P[h+1]=x[3*E+1],P[h+2]=x[3*E+2],h+=4),this._supportsUV2s&&U&&(P[h]=U[2*E],P[h+1]=U[2*E+1],h+=4),this._supportsColors&&l&&(P[h]=l[4*E],P[h+1]=l[4*E+1],P[h+2]=l[4*E+2],P[h+3]=l[4*E+3],h+=4)}this._targetStoreTexture=o.b.CreateRGBATexture(P,this._textureWidth,this._textureHeight,G,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const G of this._scene.meshes)G.morphTargetManager===this&&G._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const w=this._parentContainer.morphTargetManagers.indexOf(this);w>-1&&this._parentContainer.morphTargetManagers.splice(w,1),this._parentContainer=null}for(const w of this._targets)this._scene.stopAnimation(w)}}static Parse(w,E){const G=new f(E);for(const P of w.targets)G.addTarget(j.b.Parse(P,E));return G}}f.EnableTextureStorage=!0,f.MaxActiveMorphTargetsInVertexAttributeMode=8,f.ConstantTargetCountForTextureMode=0;var k=G(13227),N=G(11547),v=G(11998);const C=new Map,s=C;function F(w,E,G){M(w)&&Q.e.Warn(`Extension with the name '${w}' already exists`),C.set(w,{isGLTFExtension:E,factory:G})}function M(w){return C.delete(w)}var p=G(13231),D=G(12244),e=G(11760);class R{static Get(w,E,G){if(!E||void 0==G||!E[G])throw new Error(`${w}: Failed to find index (${G})`);return E[G]}static TryGet(w,E){return w&&void 0!=E&&w[E]?w[E]:null}static Assign(w){if(w)for(let E=0;E<w.length;E++)w[E].index=E}}function H(w){if(w.min&&w.max){const E=w.min,G=w.max,P=h.TmpVectors.QE[0].tx(E[0],E[1],E[2]),B=h.TmpVectors.QE[1].tx(G[0],G[1],G[2]);if(w.normalized&&5126!==w.componentType){let E=1;switch(w.componentType){case 5120:E=127;break;case 5121:E=255;break;case 5122:E=32767;break;case 5123:E=65535}const G=1/E;P.scaleInPlace(G),B.scaleInPlace(G)}return new v.c(P,B)}return null}class z{static RegisterExtension(w,E){F(w,!1,E)}static UnregisterExtension(w){return M(w)}get fh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(w){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=w}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((w=>w.dispose&&w.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(w,E,G,P,h,B){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=E,this._assetContainer=G,this._loadData(P);let B=null;if(w){const E={};if(this._gltf.nodes)for(const w of this._gltf.nodes)w.name&&(E[w.name]=w.index);B=(w instanceof Array?w:[w]).map((w=>{const G=E[w];if(void 0===G)throw new Error(`Failed to find node '${w}'`);return G}))}return await this._loadAsync(h,y,B,(()=>({meshes:this._getMeshes(),Pu:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=w,this._loadData(E),await this._loadAsync(G,h,null,(()=>{}))}async _loadAsync(w,E,G,P){return await Promise.resolve().then((async()=>{this._rootUrl=w,this._uniqueRootUrl=!w.startsWith("file:")&&E?w:`${w}${Date.now()}/`,this._fileName=E,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const h=`${k.k[k.k.LOADING]} => ${k.k[k.k.READY]}`,B=`${k.k[k.k.LOADING]} => ${k.k[k.k.COMPLETE]}`;this._parent._startPerformanceCounter(h),this._parent._startPerformanceCounter(B),this._parent._setState(k.k.LOADING),this._extensionsOnLoading();const x=new Array;if(!this.parent.loadOnlyMaterials)if(G)x.push(this.loadSceneAsync("/nodes",{nodes:G,index:-1}));else if(void 0!=this._gltf.ZE||this._gltf.scenes&&this._gltf.scenes[0]){const w=R.Get("/scene",this._gltf.scenes,this._gltf.ZE||0);x.push(this.loadSceneAsync(`/scenes/${w.index}`,w))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let w=0;w<this._gltf.materials.length;++w){const E=this._gltf.materials[w],G="/materials/"+w,P=J.b.TriangleFillMode;x.push(this._loadMaterialAsync(G,E,null,P,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&x.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&x.push(this._compileShadowGeneratorsAsync());const U=Promise.all(x).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.bx(!0);for(const w of this._babylonScene.materials){const E=w;void 0!==E.maxSimultaneousLights&&(E.maxSimultaneousLights=Math.max(E.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(k.k.READY),this._skipStartAnimationStep||this._startAnimations(),P()}));return await U.then((w=>(this._parent._endPerformanceCounter(h),y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(B),this._parent._setState(k.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(w=>{this._parent.onErrorObservable.notifyObservers(w),this._parent.onErrorObservable.clear(),this.dispose()}))})),w)))})).catch((w=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(w),this._parent.onErrorObservable.clear(),this.dispose()),w}))}_loadData(w){if(this._gltf=w.json,this._setupData(),w.bin){const E=this._gltf.buffers;if(E&&E[0]&&!E[0].uri){const G=E[0];(G.byteLength<w.bin.byteLength-3||G.byteLength>w.bin.byteLength)&&Q.e.Warn(`Binary buffer length (${G.byteLength}) from JSON does not match chunk length (${w.bin.byteLength})`),this._bin=w.bin}else Q.e.Warn("Unexpected BIN chunk")}}_setupData(){if(R.Assign(this._gltf.accessors),R.Assign(this._gltf.animations),R.Assign(this._gltf.buffers),R.Assign(this._gltf.bufferViews),R.Assign(this._gltf.cameras),R.Assign(this._gltf.images),R.Assign(this._gltf.materials),R.Assign(this._gltf.meshes),R.Assign(this._gltf.nodes),R.Assign(this._gltf.samplers),R.Assign(this._gltf.scenes),R.Assign(this._gltf.skins),R.Assign(this._gltf.textures),this._gltf.nodes){const w={};for(const G of this._gltf.nodes)if(G.children)for(const E of G.children)w[E]=G.index;const E=this._createRootNode();for(const G of this._gltf.nodes){const P=w[G.index];G.parent=void 0===P?E:this._gltf.nodes[P]}}}async _loadExtensionsAsync(){const w=[];if(s.forEach(((E,G)=>{var P;!1===(null===(P=this.parent.extensionOptions[G])||void 0===P?void 0:P.enabled)?E.isGLTFExtension&&this.isExtensionUsed(G)&&Q.e.Warn(`Extension ${G} is used but has been explicitly disabled.`):E.isGLTFExtension&&!this.isExtensionUsed(G)||w.push((async()=>{const w=await E.factory(this);return w.name!==G&&Q.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${w.name} !== ${G}`),this._parent.onExtensionLoadedObservable.notifyObservers(w),w})())})),this._extensions.push(...await Promise.all(w)),this._extensions.sort(((w,E)=>(w.order||Number.MAX_VALUE)-(E.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const G of this._gltf.extensionsRequired){if(!this._extensions.some((w=>w.name===G&&w.enabled))){var E;if(!1===(null===(E=this.parent.extensionOptions[G])||void 0===E?void 0:E.enabled))throw new Error(`Required extension ${G} is disabled`);throw new Error(`Required extension ${G} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new I.c("__root__",this._babylonScene);this._rootBabylonMesh=w,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.bx(!1);const E={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case k.h.AUTO:this._babylonScene.useRightHandedSystem||(E.rotation=[0,1,0,0],E.scale=[1,1,-1],z._LoadTransform(E,this._rootBabylonMesh));break;case k.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(w),E}loadSceneAsync(w,E){const G=this._extensionsLoadSceneAsync(w,E);if(G)return G;const P=new Array;if(this.logOpen(`${w} ${E.name||""}`),E.nodes)for(const h of E.nodes){const E=R.Get(`${w}/nodes/${h}`,this._gltf.nodes,h);P.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(w=>{w.parent=this._rootBabylonMesh})))}for(const h of this._postSceneLoadActions)h();return P.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(P).then((()=>{}))}_forEachPrimitive(w,E){if(w._primitiveBabylonMeshes)for(const G of w._primitiveBabylonMeshes)E(G)}_getGeometries(){const w=[],E=this._gltf.nodes;if(E)for(const G of E)this._forEachPrimitive(G,(E=>{const G=E.py;G&&-1===w.indexOf(G)&&w.push(G)}));return w}_getMeshes(){const w=[];this._rootBabylonMesh instanceof T.b&&w.push(this._rootBabylonMesh);const E=this._gltf.nodes;if(E)for(const G of E)this._forEachPrimitive(G,(E=>{w.push(E)}));return w}_getTransformNodes(){const w=[],E=this._gltf.nodes;if(E)for(const G of E)G._babylonTransformNode&&"ua"===G._babylonTransformNode.getClassName()&&w.push(G._babylonTransformNode),G._babylonTransformNodeForSkin&&w.push(G._babylonTransformNodeForSkin);return w}_getSkeletons(){const w=[],E=this._gltf.skins;if(E)for(const G of E)G._data&&w.push(G._data.babylonSkeleton);return w}_getAnimationGroups(){const w=[],E=this._gltf.animations;if(E)for(const G of E)G._babylonAnimationGroup&&w.push(G._babylonAnimationGroup);return w}_startAnimations(){switch(this._parent.animationStartMode){case k.g.NONE:break;case k.g.FIRST:{const w=this._getAnimationGroups();0!==w.length&&w[0].start(!0);break}case k.g.ALL:{const w=this._getAnimationGroups();for(const E of w)E.start(!0);break}default:return void Q.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadNodeAsync(w,E,G);if(P)return P;if(E._babylonTransformNode)throw new Error(`${w}: Invalid recursive node hierarchy`);const h=new Array;this.logOpen(`${w} ${E.name||""}`);const B=P=>{if(z.AddPointerMetadata(P,w),z._LoadTransform(E,P),void 0!=E.camera){const G=R.Get(`${w}/camera`,this._gltf.cameras,E.camera);h.push(this.loadCameraAsync(`/cameras/${G.index}`,G,(w=>{w.parent=P,this._babylonScene.useRightHandedSystem||(P.qx.x=-1)})))}if(E.children)for(const G of E.children){const E=R.Get(`${w}/children/${G}`,this._gltf.nodes,G);h.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(w=>{w.parent=P})))}G(P)},y=void 0!=E.mesh,x=this._parent.loadSkins&&void 0!=E.skin;if(!y||x){const w=E.name||`node${E.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new t.e(w,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==E.mesh?E._babylonTransformNode=G:E._babylonTransformNodeForSkin=G,B(G)}if(y)if(x){const G=R.Get(`${w}/mesh`,this._gltf.meshes,E.mesh);h.push(this._loadMeshAsync(`/meshes/${G.index}`,E,G,(G=>{const P=E._babylonTransformNodeForSkin;G.metadata=(0,D.c)(P.metadata,G.metadata||{});const B=R.Get(`${w}/skin`,this._gltf.skins,E.skin);h.push(this._loadSkinAsync(`/skins/${B.index}`,E,B,(w=>{this._forEachPrimitive(E,(E=>{E.skeleton=w})),this._postSceneLoadActions.push((()=>{if(void 0!=B.skeleton){const w=R.Get(`/skins/${B.index}/skeleton`,this._gltf.nodes,B.skeleton).parent;E.index===w.index?G.parent=P.parent:G.parent=w._babylonTransformNode}else G.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:P,skinnedNode:G})}))})))})))}else{const G=R.Get(`${w}/mesh`,this._gltf.meshes,E.mesh);h.push(this._loadMeshAsync(`/meshes/${G.index}`,E,G,B))}return this.logClose(),Promise.all(h).then((()=>(this._forEachPrimitive(E,(w=>{const E=w;!E.isAnInstance&&E.py&&E.py.useBoundingInfoFromGeometry?w.Cw():w.refreshBoundingInfo(!0,!0)})),E._babylonTransformNode)))}_loadMeshAsync(w,E,G,P){const h=G.primitives;if(!h||!h.length)throw new Error(`${w}: Primitives are missing`);void 0==h[0].index&&R.Assign(h);const B=new Array;this.logOpen(`${w} ${G.name||""}`);const y=E.name||`node${E.index}`;if(1===h.length){const P=G.primitives[0];B.push(this._loadMeshPrimitiveAsync(`${w}/primitives/${P.index}`,y,E,G,P,(w=>{E._babylonTransformNode=w,E._primitiveBabylonMeshes=[w]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,E._babylonTransformNode=new t.e(y,this._babylonScene),E._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._primitiveBabylonMeshes=[];for(const P of h)B.push(this._loadMeshPrimitiveAsync(`${w}/primitives/${P.index}`,`${y}_primitive${P.index}`,E,G,P,(w=>{w.parent=E._babylonTransformNode,E._primitiveBabylonMeshes.push(w)})))}return P(E._babylonTransformNode),this.logClose(),Promise.all(B).then((()=>E._babylonTransformNode))}_loadMeshPrimitiveAsync(w,E,G,P,h,B){const y=this._extensionsLoadMeshPrimitiveAsync(w,E,G,P,h,B);if(y)return y;this.logOpen(`${w}`);const x=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==G.skin&&!P.primitives[0].targets;let U,l;if(x&&h._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,U=h._instanceData.babylonSourceMesh.createInstance(E),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l=h._instanceData.promise;else{const B=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new I.c(E,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.sideOrientation=this._babylonScene.useRightHandedSystem?J.b.CounterClockWiseSideOrientation:J.b.ClockWiseSideOrientation,this._createMorphTargets(w,G,P,h,y),B.push(this._loadVertexDataAsync(w,h,y).then((async E=>await this._loadMorphTargetsAsync(w,h,y,E).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,E.kw(y),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const i=z._GetDrawMode(w,h.mode);if(void 0==h.material){let w=this._defaultBabylonMaterialData[i];w||(w=this._createDefaultMaterial("__GLTFLoader._default",i),this._parent.onMaterialLoadedObservable.notifyObservers(w),this._defaultBabylonMaterialData[i]=w),y.material=w}else if(!this.parent.skipMaterials){const E=R.Get(`${w}/material`,this._gltf.materials,h.material);B.push(this._loadMaterialAsync(`/materials/${E.index}`,E,y,i,(w=>{y.material=w})))}l=Promise.all(B),x&&(h._instanceData={babylonSourceMesh:y,promise:l}),U=y}return z.AddPointerMetadata(U,w),this._parent.onMeshLoadedObservable.notifyObservers(U),B(U),this.logClose(),l.then((()=>U))}_loadVertexDataAsync(w,E,G){const P=this._extensionsLoadVertexDataAsync(w,E,G);if(P)return P;const h=E.attributes;if(!h)throw new Error(`${w}: Attributes are missing`);const B=new Array,y=new W.d(G.name,this._babylonScene);if(void 0==E.indices)G.isUnIndexed=!0;else{const G=R.Get(`${w}/indices`,this._gltf.accessors,E.indices);B.push(this._loadIndicesAccessorAsync(`/accessors/${G.index}`,G).then((w=>{y.setIndices(w)})))}const x=(E,P,x)=>{if(void 0==h[E])return;G._delayInfo=G._delayInfo||[],-1===G._delayInfo.indexOf(P)&&G._delayInfo.push(P);const U=R.Get(`${w}/attributes/${E}`,this._gltf.accessors,h[E]);B.push(this._loadVertexAccessorAsync(`/accessors/${U.index}`,U,P).then((w=>{if(w.getKind()===q.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!G.skeleton){const w=H(U);w&&(y._boundingInfo=w,y.useBoundingInfoFromGeometry=!0)}y.setVerticesBuffer(w,U.count)}))),P==q.g.MatricesIndicesExtraKind&&(G.numBoneInfluencers=8),x&&x(U)};return x("POSITION",q.g.PositionKind),x("NORMAL",q.g.NormalKind),x("TANGENT",q.g.TangentKind),x("TEXCOORD_0",q.g.UVKind),x("TEXCOORD_1",q.g.UV2Kind),x("TEXCOORD_2",q.g.UV3Kind),x("TEXCOORD_3",q.g.UV4Kind),x("TEXCOORD_4",q.g.UV5Kind),x("TEXCOORD_5",q.g.UV6Kind),x("JOINTS_0",q.g.MatricesIndicesKind),x("WEIGHTS_0",q.g.MatricesWeightsKind),x("JOINTS_1",q.g.MatricesIndicesExtraKind),x("WEIGHTS_1",q.g.MatricesWeightsExtraKind),x("COLOR_0",q.g.ColorKind,(w=>{"VEC4"===w.type&&(G.hasVertexAlpha=!0)})),Promise.all(B).then((()=>y))}_createMorphTargets(w,E,G,P,h){if(!P.targets||!this._parent.loadMorphTargets)return;if(void 0==E._numMorphTargets)E._numMorphTargets=P.targets.length;else if(P.targets.length!==E._numMorphTargets)throw new Error(`${w}: Primitives do not have the same number of targets`);const B=G.extras?G.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,h.morphTargetManager=new f(this._babylonScene),h.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.morphTargetManager.areUpdatesFrozen=!0;for(let y=0;y<P.targets.length;y++){const w=E.weights?E.weights[y]:G.weights?G.weights[y]:0,P=B?B[y]:`morphTarget${y}`;h.morphTargetManager.addTarget(new j.b(P,w,h.Ww()))}}_loadMorphTargetsAsync(w,E,G,P){if(!E.targets||!this._parent.loadMorphTargets)return Promise.resolve();const h=new Array,B=G.morphTargetManager;for(let y=0;y<B.numTargets;y++){const G=B.getTarget(y);h.push(this._loadMorphTargetVertexDataAsync(`${w}/targets/${y}`,P,E.targets[y],G))}return Promise.all(h).then((()=>{B.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(w,E,G,P){const h=new Array,B=(P,B,y)=>{if(void 0==G[P])return;const x=E.getVertexBuffer(B);if(!x)return;const U=R.Get(`${w}/${P}`,this._gltf.accessors,G[P]);h.push(this._loadFloatAccessorAsync(`/accessors/${U.index}`,U).then((w=>{y(x,w)})))};return B("POSITION",q.g.PositionKind,((w,E)=>{const G=new Float32Array(E.length);w.forEach(E.length,((w,P)=>{G[P]=E[P]+w})),P.setPositions(G)})),B("NORMAL",q.g.NormalKind,((w,E)=>{const G=new Float32Array(E.length);w.forEach(G.length,((w,P)=>{G[P]=E[P]+w})),P.setNormals(G)})),B("TANGENT",q.g.TangentKind,((w,E)=>{const G=new Float32Array(E.length/3*4);let h=0;w.forEach(E.length/3*4,((w,P)=>{(P+1)%4!==0&&(G[h]=E[h]+w,h++)})),P.setTangents(G)})),B("TEXCOORD_0",q.g.UVKind,((w,E)=>{const G=new Float32Array(E.length);w.forEach(E.length,((w,P)=>{G[P]=E[P]+w})),P.setUVs(G)})),B("TEXCOORD_1",q.g.UV2Kind,((w,E)=>{const G=new Float32Array(E.length);w.forEach(E.length,((w,P)=>{G[P]=E[P]+w})),P.setUV2s(G)})),B("COLOR_0",q.g.ColorKind,((E,G)=>{let h=null;const B=E.getSize();if(3===B){h=new Float32Array(G.length/3*4),E.forEach(G.length,((w,E)=>{const P=Math.floor(E/3),B=E%3;h[4*P+B]=G[3*P+B]+w}));for(let w=0;w<G.length/3;++w)h[4*w+3]=1}else{if(4!==B)throw new Error(`${w}: Invalid number of components (${B}) for COLOR_0 attribute`);h=new Float32Array(G.length),E.forEach(G.length,((w,E)=>{h[E]=G[E]+w}))}P.setColors(h)})),await Promise.all(h).then((()=>{}))}static _LoadTransform(w,E){if(void 0!=w.skin)return;let G=h.QE.Zero(),P=h.Quaternion.Identity(),B=h.QE.One();if(w.matrix){h.Matrix.KE(w.matrix).decompose(B,P,G)}else w.translation&&(G=h.QE.KE(w.translation)),w.rotation&&(P=h.Quaternion.KE(w.rotation)),w.scale&&(B=h.QE.KE(w.scale));E.position=G,E.rotationQuaternion=P,E.qx=B}_loadSkinAsync(w,E,G,P){if(!this._parent.loadSkins)return Promise.resolve();const h=this._extensionsLoadSkinAsync(w,E,G);if(h)return h;if(G._data)return P(G._data.babylonSkeleton),G._data.promise;const B=`skeleton${G.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new Z(G.name||B,B,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(w,G,y);const x=this._loadSkinInverseBindMatricesDataAsync(w,G).then((w=>{this._updateBoneMatrices(y,w)}));return G._data={babylonSkeleton:y,promise:x},P(y),x}_loadBones(w,E,G){if(void 0==E.skeleton||this._parent.alwaysComputeSkeletonRootNode){const G=this._findSkeletonRootNode(`${w}/joints`,E.joints);if(G)if(void 0===E.skeleton)E.skeleton=G.index;else{const P=(w,E)=>{for(;E.parent;E=E.parent)if(E.parent===w)return!0;return!1},h=R.Get(`${w}/skeleton`,this._gltf.nodes,E.skeleton);h===G||P(h,G)||(Q.e.Warn(`${w}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),E.skeleton=G.index)}else Q.e.Warn(`${w}: Failed to find common root`)}const P={};for(const h of E.joints){const B=R.Get(`${w}/joints/${h}`,this._gltf.nodes,h);this._loadBone(B,E,G,P)}}_findSkeletonRootNode(w,E){if(0===E.length)return null;const G={};for(const h of E){const E=[];let P=R.Get(`${w}/${h}`,this._gltf.nodes,h);for(;-1!==P.index;)E.unshift(P),P=P.parent;G[h]=E}let P=null;for(let h=0;;++h){let w=G[E[0]];if(h>=w.length)return P;const B=w[h];for(let y=1;y<E.length;++y)if(w=G[E[y]],h>=w.length||B!==w[h])return P;P=B}}_loadBone(w,E,G,P){w._isJoint=!0;let h=P[w.index];if(h)return h;let B=null;w.index!==E.skeleton&&(w.parent&&-1!==w.parent.index?B=this._loadBone(w.parent,E,G,P):void 0!==E.skeleton&&Q.e.Warn(`/skins/${E.index}/skeleton: Skeleton node is not a common root`));const y=E.joints.indexOf(w.index);return h=new l.b(w.name||`joint${w.index}`,G,B,this._getNodeMatrix(w),null,null,y),P[w.index]=h,this._postSceneLoadActions.push((()=>{h.linkTransformNode(w._babylonTransformNode)})),h}_loadSkinInverseBindMatricesDataAsync(w,E){if(void 0==E.inverseBindMatrices)return Promise.resolve(null);const G=R.Get(`${w}/inverseBindMatrices`,this._gltf.accessors,E.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${G.index}`,G)}_updateBoneMatrices(w,E){for(const G of w.bones){const w=h.Matrix.Identity(),P=G._index;E&&-1!==P&&(h.Matrix.FromArrayToRef(E,16*P,w),w.invertToRef(w));const B=G.getParent();B&&w.multiplyToRef(B.getAbsoluteInverseBindMatrix(),w),G.bh(w,!1,!1),G._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(w){return w.matrix?h.Matrix.KE(w.matrix):h.Matrix.Compose(w.scale?h.QE.KE(w.scale):h.QE.One(),w.rotation?h.Quaternion.KE(w.rotation):h.Quaternion.Identity(),w.translation?h.QE.KE(w.translation):h.QE.Zero())}loadCameraAsync(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadCameraAsync(w,E,G);if(P)return P;const B=new Array;this.logOpen(`${w} ${E.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new U.c(E.name||`camera${E.index}`,h.QE.Zero(),this._babylonScene,!1);switch(y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonCamera=y,y.setTarget(new h.QE(0,0,-1)),E.type){case"perspective":{const G=E.perspective;if(!G)throw new Error(`${w}: Camera perspective properties are missing`);y.fov=G.yfov,y.Sh=G.znear,y.maxZ=G.zfar||0;break}case"orthographic":if(!E.orthographic)throw new Error(`${w}: Camera orthographic properties are missing`);y.mode=x.c.ORTHOGRAPHIC_CAMERA,y.orthoLeft=-E.orthographic.xmag,y.orthoRight=E.orthographic.xmag,y.orthoBottom=-E.orthographic.ymag,y.orthoTop=E.orthographic.ymag,y.Sh=E.orthographic.znear,y.maxZ=E.orthographic.zfar;break;default:throw new Error(`${w}: Invalid camera type (${E.type})`)}return z.AddPointerMetadata(y,w),this._parent.onCameraLoadedObservable.notifyObservers(y),G(y),this.logClose(),Promise.all(B).then((()=>y))}_loadAnimationsAsync(){const w=this._gltf.animations;if(!w)return Promise.resolve();const E=new Array;for(let G=0;G<w.length;G++){const P=w[G];E.push(this.loadAnimationAsync(`/animations/${P.index}`,P).then((w=>{0===w.targetedAnimations.length&&w.dispose()})))}return Promise.all(E).then((()=>{}))}loadAnimationAsync(w,E){const P=this._extensionsLoadAnimationAsync(w,E);return P||G.e(78).then(G.bind(G,14703)).then((G=>{let{AnimationGroup:P}=G;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new P(E.name||`animation${E.index}`,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonAnimationGroup=h;const B=new Array;R.Assign(E.channels),R.Assign(E.samplers);for(const y of E.channels)B.push(this._loadAnimationChannelAsync(`${w}/channels/${y.index}`,w,E,y,((w,E)=>{w.animations=w.animations||[],w.animations.push(E),h.addTargetedAnimation(E,w)})));return Promise.all(B).then((()=>(h.normalize(0),h)))}))}async _loadAnimationChannelAsync(w,E,P,h,B){const y=this._extensionsLoadAnimationChannelAsync(w,E,P,h,B);if(y)return await y;if(void 0==h.target.node)return await Promise.resolve();const x=R.Get(`${w}/target/node`,this._gltf.nodes,h.target.node),U=h.target.path,l="weights"===U;if(l&&!x._numMorphTargets||!l&&!x._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!l&&!x._isJoint)return await Promise.resolve();let i;switch(await Promise.resolve().then(G.bind(G,13244)),U){case"translation":var O;i=null===(O=(0,p.f)("/nodes/{}/translation"))||void 0===O?void 0:O.interpolation;break;case"rotation":var u;i=null===(u=(0,p.f)("/nodes/{}/rotation"))||void 0===u?void 0:u.interpolation;break;case"scale":var V;i=null===(V=(0,p.f)("/nodes/{}/scale"))||void 0===V?void 0:V.interpolation;break;case"weights":var a;i=null===(a=(0,p.f)("/nodes/{}/weights"))||void 0===a?void 0:a.interpolation;break;default:throw new Error(`${w}/target/path: Invalid value (${h.target.path})`)}if(!i)throw new Error(`${w}/target/path: Could not find interpolation properties for target path (${h.target.path})`);const Q={object:x,info:i};return await this._loadAnimationChannelFromTargetInfoAsync(w,E,P,h,Q,B)}_loadAnimationChannelFromTargetInfoAsync(w,E,G,P,h,B){const y=this.parent.targetFps,x=1/y,U=R.Get(`${w}/sampler`,G.samplers,P.sampler);return this._loadAnimationSamplerAsync(`${E}/samplers/${P.sampler}`,U).then((w=>{let E=0;const U=h.object,l=h.info;for(const h of l){const l=h.getStride(U),i=w.input,O=w.output,u=new Array(i.length);let V=0;switch(w.interpolation){case"STEP":for(let w=0;w<i.length;w++){const E=h.getValue(U,O,V,1);V+=l,u[w]={frame:i[w]*y,value:E,interpolation:1}}break;case"CUBICSPLINE":for(let w=0;w<i.length;w++){const E=h.getValue(U,O,V,x);V+=l;const G=h.getValue(U,O,V,1);V+=l;const P=h.getValue(U,O,V,x);V+=l,u[w]={frame:i[w]*y,inTangent:E,value:G,outTangent:P}}break;case"LINEAR":for(let w=0;w<i.length;w++){const E=h.getValue(U,O,V,1);V+=l,u[w]={frame:i[w]*y,value:E}}}if(V>0){const w=`${G.name||`animation${G.index}`}_channel${P.index}_${E}`,x=h.buildAnimations(U,w,y,u);for(const G of x)E++,B(G.babylonAnimatable,G.babylonAnimation)}}}))}_loadAnimationSamplerAsync(w,E){if(E._data)return E._data;const G=E.interpolation||"LINEAR";switch(G){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${w}/interpolation: Invalid value (${E.interpolation})`)}const P=R.Get(`${w}/input`,this._gltf.accessors,E.input),h=R.Get(`${w}/output`,this._gltf.accessors,E.output);return E._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${P.index}`,P),this._loadFloatAccessorAsync(`/accessors/${h.index}`,h)]).then((w=>{let[E,P]=w;return{input:E,interpolation:G,output:P}})),E._data}loadBufferAsync(w,E,G,P){const h=this._extensionsLoadBufferAsync(w,E,G,P);if(h)return h;if(!E._data)if(E.uri)E._data=this.loadUriAsync(`${w}/uri`,E,E.uri);else{if(!this._bin)throw new Error(`${w}: Uri is missing or the binary glTF is missing its binary chunk`);E._data=this._bin.readAsync(0,E.byteLength)}return E._data.then((E=>{try{return new Uint8Array(E.buffer,E.byteOffset+G,P)}catch(h){throw new Error(`${w}: ${h.message}`)}}))}loadBufferViewAsync(w,E){const G=this._extensionsLoadBufferViewAsync(w,E);if(G)return G;if(E._data)return E._data;const P=R.Get(`${w}/buffer`,this._gltf.buffers,E.buffer);return E._data=this.loadBufferAsync(`/buffers/${P.index}`,P,E.byteOffset||0,E.byteLength),E._data}_loadAccessorAsync(w,E,G){if(E._data)return E._data;const P=z._GetNumComponents(w,E.type),h=P*q.g.GetTypeByteLength(E.componentType),B=P*E.count;if(void 0==E.bufferView)E._data=Promise.resolve(new G(B));else{const y=R.Get(`${w}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((x=>{if(5126!==E.componentType||E.normalized||y.byteStride&&y.byteStride!==h){const w=new G(B);return q.g.ForEach(x,E.byteOffset||0,y.byteStride||h,P,E.componentType,w.length,E.normalized||!1,((E,G)=>{w[G]=E})),w}return z._GetTypedArray(w,E.componentType,x,E.byteOffset,B)}))}if(E.sparse){const B=E.sparse;E._data=E._data.then((y=>{const x=y,U=R.Get(`${w}/sparse/indices/bufferView`,this._gltf.bufferViews,B.indices.bufferView),l=R.Get(`${w}/sparse/values/bufferView`,this._gltf.bufferViews,B.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${U.index}`,U),this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)]).then((y=>{let[U,l]=y;const i=z._GetTypedArray(`${w}/sparse/indices`,B.indices.componentType,U,B.indices.byteOffset,B.count),O=P*B.count;let u;if(5126!==E.componentType||E.normalized){const y=z._GetTypedArray(`${w}/sparse/values`,E.componentType,l,B.values.byteOffset,O);u=new G(O),q.g.ForEach(y,0,h,P,E.componentType,u.length,E.normalized||!1,((w,E)=>{u[E]=w}))}else u=z._GetTypedArray(`${w}/sparse/values`,E.componentType,l,B.values.byteOffset,O);let V=0;for(let w=0;w<i.length;w++){let E=i[w]*P;for(let w=0;w<P;w++)x[E++]=u[V++]}return x}))}))}return E._data}_loadFloatAccessorAsync(w,E){return this._loadAccessorAsync(w,E,Float32Array)}_loadIndicesAccessorAsync(w,E){if("SCALAR"!==E.type)throw new Error(`${w}/type: Invalid value ${E.type}`);if(5121!==E.componentType&&5123!==E.componentType&&5125!==E.componentType)throw new Error(`${w}/componentType: Invalid value ${E.componentType}`);if(E._data)return E._data;if(E.sparse){const G=z._GetTypedArrayConstructor(`${w}/componentType`,E.componentType);E._data=this._loadAccessorAsync(w,E,G)}else{const G=R.Get(`${w}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((G=>z._GetTypedArray(w,E.componentType,G,E.byteOffset,E.count)))}return E._data}_loadVertexBufferViewAsync(w){if(w._babylonBuffer)return w._babylonBuffer;const E=this._babylonScene.getEngine();return w._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((w=>new q.d(E,w,!1))),w._babylonBuffer}_loadVertexAccessorAsync(w,E,G){var P;if(null!==(P=E._babylonVertexBuffer)&&void 0!==P&&P[G])return E._babylonVertexBuffer[G];E._babylonVertexBuffer||(E._babylonVertexBuffer={});const h=this._babylonScene.getEngine();if(E.sparse||void 0==E.bufferView)E._babylonVertexBuffer[G]=this._loadFloatAccessorAsync(w,E).then((w=>new q.g(h,w,G,!1)));else{const P=R.Get(`${w}/bufferView`,this._gltf.bufferViews,E.bufferView);E._babylonVertexBuffer[G]=this._loadVertexBufferViewAsync(P).then((B=>{const y=z._GetNumComponents(w,E.type);return new q.g(h,B,G,!1,void 0,P.byteStride,void 0,E.byteOffset,y,E.componentType,E.normalized,!0,void 0,!0)}))}return E._babylonVertexBuffer[G]}_loadMaterialMetallicRoughnessPropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;return E&&(E.baseColorFactor?(G.albedoColor=B.dE.KE(E.baseColorFactor),G.alpha=E.baseColorFactor[3]):G.albedoColor=B.dE.White(),G.metallic=void 0==E.metallicFactor?1:E.metallicFactor,G.roughness=void 0==E.roughnessFactor?1:E.roughnessFactor,E.baseColorTexture&&P.push(this.loadTextureInfoAsync(`${w}/baseColorTexture`,E.baseColorTexture,(w=>{w.name=`${G.name} (Base Color)`,G.albedoTexture=w}))),E.metallicRoughnessTexture&&(E.metallicRoughnessTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${w}/metallicRoughnessTexture`,E.metallicRoughnessTexture,(w=>{w.name=`${G.name} (Metallic Roughness)`,G.metallicTexture=w}))),G.useMetallnessFromMetallicTextureBlue=!0,G.useRoughnessFromMetallicTextureGreen=!0,G.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(P).then((()=>{}))}_loadMaterialAsync(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const B=this._extensionsLoadMaterialAsync(w,E,G,P,h);if(B)return B;E._data=E._data||{};let y=E._data[P];if(!y){this.logOpen(`${w} ${E.name||""}`);const G=this.createMaterial(w,E,P);y={babylonMaterial:G,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(w,E,G)},E._data[P]=y,z.AddPointerMetadata(G,w),this._parent.onMaterialLoadedObservable.notifyObservers(G),this.logClose()}return G&&(y.babylonMeshes.push(G),G.qh.addOnce((()=>{const w=y.babylonMeshes.indexOf(G);-1!==w&&y.babylonMeshes.splice(w,1)}))),h(y.babylonMaterial),y.promise.then((()=>y.babylonMaterial))}_createDefaultMaterial(w,E){this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new d.b(w,this._babylonScene);return G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.fillMode=E,G.enableSpecularAntiAliasing=!0,G.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,G.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,G.transparencyMode=d.b.PBRMATERIAL_OPAQUE,G.metallic=1,G.roughness=1,G}createMaterial(w,E,G){const P=this._extensionsCreateMaterial(w,E,G);if(P)return P;const h=E.name||`material${E.index}`;return this._createDefaultMaterial(h,G)}loadMaterialPropertiesAsync(w,E,G){const P=this._extensionsLoadMaterialPropertiesAsync(w,E,G);if(P)return P;const h=new Array;return h.push(this.loadMaterialBasePropertiesAsync(w,E,G)),E.pbrMetallicRoughness&&h.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${w}/pbrMetallicRoughness`,E.pbrMetallicRoughness,G)),this.loadMaterialAlphaProperties(w,E,G),Promise.all(h).then((()=>{}))}loadMaterialBasePropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;return G.emissiveColor=E.emissiveFactor?B.dE.KE(E.emissiveFactor):new B.dE(0,0,0),E.doubleSided&&(G.Kx=!1,G.twoSidedLighting=!0),E.normalTexture&&(E.normalTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${w}/normalTexture`,E.normalTexture,(w=>{w.name=`${G.name} (Normal)`,G.bumpTexture=w}))),G.invertNormalMapX=!this._babylonScene.useRightHandedSystem,G.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=E.normalTexture.scale&&G.bumpTexture&&(G.bumpTexture.level=E.normalTexture.scale),G.forceIrradianceInFragment=!0),E.occlusionTexture&&(E.occlusionTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${w}/occlusionTexture`,E.occlusionTexture,(w=>{w.name=`${G.name} (Occlusion)`,G.ambientTexture=w}))),G.useAmbientInGrayScale=!0,void 0!=E.occlusionTexture.strength&&(G.ambientTextureStrength=E.occlusionTexture.strength)),E.emissiveTexture&&P.push(this.loadTextureInfoAsync(`${w}/emissiveTexture`,E.emissiveTexture,(w=>{w.name=`${G.name} (Emissive)`,G.emissiveTexture=w}))),Promise.all(P).then((()=>{}))}loadMaterialAlphaProperties(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);switch(E.alphaMode||"OPAQUE"){case"OPAQUE":G.transparencyMode=d.b.PBRMATERIAL_OPAQUE,G.alpha=1;break;case"MASK":G.transparencyMode=d.b.PBRMATERIAL_ALPHATEST,G.alphaCutOff=void 0==E.alphaCutoff?.5:E.alphaCutoff,G.albedoTexture&&(G.albedoTexture.mh=!0);break;case"BLEND":G.transparencyMode=d.b.PBRMATERIAL_ALPHABLEND,G.albedoTexture&&(G.albedoTexture.mh=!0,G.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${w}/alphaMode: Invalid value (${E.alphaMode})`)}}loadTextureInfoAsync(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadTextureInfoAsync(w,E,G);if(P)return P;if(this.logOpen(`${w}`),E.texCoord>=6)throw new Error(`${w}/texCoord: Invalid value (${E.texCoord})`);const h=R.Get(`${w}/index`,this._gltf.textures,E.index);h._textureInfo=E;const B=this._loadTextureAsync(`/textures/${E.index}`,h,(P=>{P.coordinatesIndex=E.texCoord||0,z.AddPointerMetadata(P,w),this._parent.onTextureLoadedObservable.notifyObservers(P),G(P)}));return this.logClose(),B}_loadTextureAsync(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadTextureAsync(w,E,G);if(P)return P;this.logOpen(`${w} ${E.name||""}`);const h=void 0==E.sampler?z.DefaultSampler:R.Get(`${w}/sampler`,this._gltf.samplers,E.sampler),B=R.Get(`${w}/source`,this._gltf.images,E.source),y=this._createTextureAsync(w,h,B,G,void 0,!E._textureInfo.nonColorData);return this.logClose(),y}_createTextureAsync(w,E,G){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},B=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0;const x=this._loadSampler(`/samplers/${E.index}`,E),U=new Array,l=new P;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i={noMipmap:x.noMipMaps,invertY:!1,samplingMode:x.samplingMode,S:()=>{this._disposed||l.resolve()},onError:(E,G)=>{this._disposed||l.reject(new Error(`${w}: ${G&&G.message?G.message:E||"Failed to load texture"}`))},mimeType:G.mimeType??(0,N.j)(G.uri??""),loaderOptions:B,useSRGBBuffer:!!y&&this._parent.useSRGBBuffers},O=new K.c(null,this._babylonScene,i);return O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.push(l.promise),U.push(this.loadImageAsync(`/images/${G.index}`,G).then((w=>{const E=G.uri||`${this._fileName}#image${G.index}`,P=`data:${this._uniqueRootUrl}${E}`;O.updateURL(P,w);const h=O.getInternalTexture();h&&(h.label=G.name)}))),O.wrapU=x.wrapU,O.wrapV=x.wrapV,h(O),this._parent.useGltfTextureNames&&(O.name=G.name||G.uri||`image${G.index}`),Promise.all(U).then((()=>O))}_loadSampler(w,E){return E._data||(E._data={noMipMaps:9728===E.minFilter||9729===E.minFilter,samplingMode:z._GetTextureSamplingMode(w,E),wrapU:z._GetTextureWrapMode(`${w}/wrapS`,E.wrapS),wrapV:z._GetTextureWrapMode(`${w}/wrapT`,E.wrapT)}),E._data}loadImageAsync(w,E){if(!E._data){if(this.logOpen(`${w} ${E.name||""}`),E.uri)E._data=this.loadUriAsync(`${w}/uri`,E,E.uri);else{const G=R.Get(`${w}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G)}this.logClose()}return E._data}loadUriAsync(w,E,G){const P=this._extensionsLoadUriAsync(w,E,G);if(P)return P;if(!z._ValidateUri(G))throw new Error(`${w}: '${G}' is invalid`);if((0,N.l)(G)){const E=new Uint8Array((0,N.b)(G));return this.log(`${w}: Decoded ${G.substring(0,64)}... (${E.length} bytes)`),Promise.resolve(E)}return this.log(`${w}: Loading ${G}`),this._parent.preprocessUrlAsync(this._rootUrl+G).then((E=>new Promise(((P,h)=>{this._parent._loadFile(this._babylonScene,E,(E=>{this._disposed||(this.log(`${w}: Loaded ${G} (${E.byteLength} bytes)`),P(new Uint8Array(E)))}),!0,(E=>{h(new N.m(`${w}: Failed to load '${G}'${E?": "+E.status+" "+E.statusText:""}`,E))}))}))))}static AddPointerMetadata(w,E){w.metadata=w.metadata||{};const G=w._internalMetadata=w._internalMetadata||{},P=G.fh=G.fh||{};(P.pointers=P.pointers||[]).push(E)}static _GetTextureWrapMode(w,E){switch(E=void 0==E?10497:E){case 33071:return K.c.CLAMP_ADDRESSMODE;case 33648:return K.c.MIRROR_ADDRESSMODE;case 10497:return K.c.WRAP_ADDRESSMODE;default:return Q.e.Warn(`${w}: Invalid value (${E})`),K.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(w,E){const G=void 0==E.magFilter?9729:E.magFilter,P=void 0==E.minFilter?9987:E.minFilter;if(9729===G)switch(P){case 9728:return K.c.LINEAR_NEAREST;case 9729:return K.c.LINEAR_LINEAR;case 9984:return K.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return K.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return K.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return K.c.LINEAR_LINEAR_MIPLINEAR;default:return Q.e.Warn(`${w}/minFilter: Invalid value (${P})`),K.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==G&&Q.e.Warn(`${w}/magFilter: Invalid value (${G})`),P){case 9728:return K.c.NEAREST_NEAREST;case 9729:return K.c.NEAREST_LINEAR;case 9984:return K.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return K.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return K.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return K.c.NEAREST_LINEAR_MIPLINEAR;default:return Q.e.Warn(`${w}/minFilter: Invalid value (${P})`),K.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(w,E){try{return(0,e.p)(E)}catch(G){throw new Error(`${w}: ${G.message}`)}}static _GetTypedArray(w,E,G,P,h){const B=G.buffer;P=G.byteOffset+(P||0);const y=z._GetTypedArrayConstructor(`${w}/componentType`,E),x=q.g.GetTypeByteLength(E);return P%x!==0?(Q.e.Warn(`${w}: Copying buffer as byte offset (${P}) is not a multiple of component type byte length (${x})`),new y(B.slice(P,P+h*x),0)):new y(B,P,h)}static _GetNumComponents(w,E){switch(E){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${w}: Invalid type (${E})`)}static _ValidateUri(w){return y.Tools.IsBase64(w)||-1===w.indexOf("..")}static _GetDrawMode(w,E){switch(void 0==E&&(E=4),E){case 0:return J.b.PointListDrawMode;case 1:return J.b.LineListDrawMode;case 2:return J.b.LineLoopDrawMode;case 3:return J.b.LineStripDrawMode;case 4:return J.b.TriangleFillMode;case 5:return J.b.TriangleStripDrawMode;case 6:return J.b.TriangleFanDrawMode}throw new Error(`${w}: Invalid mesh primitive mode (${E})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const w=new Array;if(this._gltf.materials)for(const E of this._gltf.materials)if(E._data)for(const G in E._data){const P=E._data[G];for(const E of P.babylonMeshes){E.Ah(!0);const G=P.babylonMaterial;w.push(G.forceCompilationAsync(E)),w.push(G.forceCompilationAsync(E,{useInstances:!0})),this._parent.useClipPlane&&(w.push(G.forceCompilationAsync(E,{clipPlane:!0})),w.push(G.forceCompilationAsync(E,{clipPlane:!0,useInstances:!0})))}}return Promise.all(w).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const w=new Array,E=this._babylonScene.lights;for(const G of E){const E=G.getShadowGenerator();E&&w.push(E.forceCompilationAsync())}return Promise.all(w).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(w){for(const E of this._extensions)E.enabled&&w(E)}_applyExtensions(w,E,G){for(const P of this._extensions)if(P.enabled){const h=`${P.name}.${E}`,B=w;B._activeLoaderExtensionFunctions=B._activeLoaderExtensionFunctions||{};const y=B._activeLoaderExtensionFunctions;if(!y[h]){y[h]=!0;try{const w=G(P);if(w)return w}finally{delete y[h]}}}return null}_extensionsOnLoading(){this._forEachExtensions((w=>w.onLoading&&w.onLoading()))}_extensionsOnReady(){this._forEachExtensions((w=>w.onReady&&w.onReady()))}_extensionsLoadSceneAsync(w,E){return this._applyExtensions(E,"loadScene",(G=>G.loadSceneAsync&&G.loadSceneAsync(w,E)))}_extensionsLoadNodeAsync(w,E,G){return this._applyExtensions(E,"loadNode",(P=>P.loadNodeAsync&&P.loadNodeAsync(w,E,G)))}_extensionsLoadCameraAsync(w,E,G){return this._applyExtensions(E,"loadCamera",(P=>P.loadCameraAsync&&P.loadCameraAsync(w,E,G)))}_extensionsLoadVertexDataAsync(w,E,G){return this._applyExtensions(E,"loadVertexData",(P=>P._loadVertexDataAsync&&P._loadVertexDataAsync(w,E,G)))}_extensionsLoadMeshPrimitiveAsync(w,E,G,P,h,B){return this._applyExtensions(h,"loadMeshPrimitive",(y=>y._loadMeshPrimitiveAsync&&y._loadMeshPrimitiveAsync(w,E,G,P,h,B)))}_extensionsLoadMaterialAsync(w,E,G,P,h){return this._applyExtensions(E,"loadMaterial",(B=>B._loadMaterialAsync&&B._loadMaterialAsync(w,E,G,P,h)))}_extensionsCreateMaterial(w,E,G){return this._applyExtensions(E,"createMaterial",(P=>P.createMaterial&&P.createMaterial(w,E,G)))}_extensionsLoadMaterialPropertiesAsync(w,E,G){return this._applyExtensions(E,"loadMaterialProperties",(P=>P.loadMaterialPropertiesAsync&&P.loadMaterialPropertiesAsync(w,E,G)))}_extensionsLoadTextureInfoAsync(w,E,G){return this._applyExtensions(E,"loadTextureInfo",(P=>P.loadTextureInfoAsync&&P.loadTextureInfoAsync(w,E,G)))}_extensionsLoadTextureAsync(w,E,G){return this._applyExtensions(E,"loadTexture",(P=>P._loadTextureAsync&&P._loadTextureAsync(w,E,G)))}_extensionsLoadAnimationAsync(w,E){return this._applyExtensions(E,"loadAnimation",(G=>G.loadAnimationAsync&&G.loadAnimationAsync(w,E)))}_extensionsLoadAnimationChannelAsync(w,E,G,P,h){return this._applyExtensions(G,"loadAnimationChannel",(B=>B._loadAnimationChannelAsync&&B._loadAnimationChannelAsync(w,E,G,P,h)))}_extensionsLoadSkinAsync(w,E,G){return this._applyExtensions(G,"loadSkin",(P=>P._loadSkinAsync&&P._loadSkinAsync(w,E,G)))}_extensionsLoadUriAsync(w,E,G){return this._applyExtensions(E,"loadUri",(P=>P._loadUriAsync&&P._loadUriAsync(w,E,G)))}_extensionsLoadBufferViewAsync(w,E){return this._applyExtensions(E,"loadBufferView",(G=>G.loadBufferViewAsync&&G.loadBufferViewAsync(w,E)))}_extensionsLoadBufferAsync(w,E,G,P){return this._applyExtensions(E,"loadBuffer",(h=>h.loadBufferAsync&&h.loadBufferAsync(w,E,G,P)))}static LoadExtensionAsync(w,E,G,P){if(!E.extensions)return null;const h=E.extensions[G];return h?P(`${w}/extensions/${G}`,h):null}static LoadExtraAsync(w,E,G,P){if(!E.extras)return null;const h=E.extras[G];return h?P(`${w}/extras/${G}`,h):null}isExtensionUsed(w){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(w)}logOpen(w){this._parent._logOpen(w)}logClose(){this._parent._logClose()}log(w){this._parent._log(w)}startPerformanceCounter(w){this._parent._startPerformanceCounter(w)}endPerformanceCounter(w){this._parent._endPerformanceCounter(w)}}z.DefaultSampler={index:-1},k.e._CreateGLTF2Loader=w=>new z(w);var L=G(13244),m=G(11863),n=G(11706),r=G(13247),Y=G(13250);class S extends Y.d{constructor(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",w),this._texture=w.getEngine().createRawCubeTexture(E,G,P,h,B,y,x,U)}update(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,w,E,G,P,h)}updateRGBDAsync(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,r.h)(this._texture,w,E,G,P).then((()=>{}))}clone(){return n.b.Clone((()=>{const w=this.Ww(),E=this._texture,G=new S(w,E._bufferViewArray,E.width,E.format,E.type,E.generateMipMaps,E.invertY,E.samplingMode,E._compression);return 13===E.source&&G.updateRGBDAsync(E._bufferViewArrayArray,E._sphericalPolynomial,E._lodGenerationScale,E._lodGenerationOffset),G}),this)}}const X="EXT_lights_image_based";class b{constructor(w){this.name=X,this._loader=w,this.enabled=this._loader.isExtensionUsed(X)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.fh.extensions;if(w&&w[this.name]){const E=w[this.name];this._lights=E.lights}}loadSceneAsync(w,E){return z.LoadExtensionAsync(w,E,this.name,(async(G,P)=>{this._loader._allMaterialsDirtyRequired=!0;const h=new Array;h.push(this._loader.loadSceneAsync(w,E)),this._loader.logOpen(`${G}`);const B=R.Get(`${G}/light`,this._lights,P.ih);return h.push(this._loadLightAsync(`/extensions/${this.name}/lights/${P.ih}`,B).then((w=>{this._loader.babylonScene.environmentTexture=w}))),this._loader.logClose(),await Promise.all(h).then((()=>{}))}))}_loadLightAsync(w,E){if(!E._loaded){const G=new Array;this._loader.logOpen(`${w}`);const P=new Array(E.specularImages.length);for(let h=0;h<E.specularImages.length;h++){const B=E.specularImages[h];P[h]=new Array(B.length);for(let E=0;E<B.length;E++){const y=`${w}/specularImages/${h}/${E}`;this._loader.logOpen(`${y}`);const x=B[E],U=R.Get(y,this._loader.fh.images,x);G.push(this._loader.loadImageAsync(`/images/${x}`,U).then((w=>{P[h][E]=w}))),this._loader.logClose()}}this._loader.logClose(),E._loaded=Promise.all(G).then((async()=>{const G=new S(this._loader.babylonScene,null,E.specularImageSize);if(G.name=E.name||"environment",E._babylonTexture=G,void 0!=E.gx&&(G.level=E.gx),E.rotation){let w=h.Quaternion.KE(E.rotation);this._loader.babylonScene.useRightHandedSystem||(w=h.Quaternion.Inverse(w)),h.Matrix.FromQuaternionToRef(w,G.getReflectionTextureMatrix())}if(!E.irradianceCoefficients)throw new Error(`${w}: Irradiance coefficients are missing`);const B=m.c.KE(E.irradianceCoefficients);B.scaleInPlace(E.gx),B.convertIrradianceToLambertianRadiance();const y=m.d.FromHarmonics(B),x=(P.length-1)/Math.log2(E.specularImageSize);return await G.updateRGBDAsync(P,y,x)}))}return E._loaded.then((()=>E._babylonTexture))}}M(X),F(X,!0,(w=>new b(w)));G(12214);const A="EXT_mesh_gpu_instancing";class ww{constructor(w){this.name=A,this._loader=w,this.enabled=this._loader.isExtensionUsed(A)}dispose(){this._loader=null}loadNodeAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(w,P)=>{this._loader._disableInstancedMesh++;const B=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,G);if(this._loader._disableInstancedMesh--,!E._primitiveBabylonMeshes)return await B;const y=new Array;let x=0;const U=E=>{if(void 0==P.attributes[E])return void y.push(Promise.resolve(null));const G=R.Get(`${w}/attributes/${E}`,this._loader.fh.accessors,P.attributes[E]);if(y.push(this._loader._loadFloatAccessorAsync(`/accessors/${G.bufferView}`,G)),0===x)x=G.count;else if(x!==G.count)throw new Error(`${w}/attributes: Instance buffer accessors do not have the same count.`)};return U("TRANSLATION"),U("ROTATION"),U("SCALE"),await B.then((async w=>{const[G,P,B]=await Promise.all(y),U=new Float32Array(16*x);h.TmpVectors.QE[0].tx(0,0,0),h.TmpVectors.Quaternion[0].tx(0,0,0,1),h.TmpVectors.QE[1].tx(1,1,1);for(let E=0;E<x;++E)G&&h.QE.FromArrayToRef(G,3*E,h.TmpVectors.QE[0]),P&&h.Quaternion.FromArrayToRef(P,4*E,h.TmpVectors.Quaternion[0]),B&&h.QE.FromArrayToRef(B,3*E,h.TmpVectors.QE[1]),h.Matrix.ComposeToRef(h.TmpVectors.QE[1],h.TmpVectors.Quaternion[0],h.TmpVectors.QE[0],h.TmpVectors.Matrix[0]),h.TmpVectors.Matrix[0].copyToArray(U,16*E);for(const h of E._primitiveBabylonMeshes)h.WO("matrix",U,16,!0);return w}))}))}}M(A),F(A,!0,(w=>new ww(w)));let Ew=0,Gw=null;class Pw{static get Default(){return Pw._Default||(Pw._Default=new Pw),Pw._Default}constructor(){const w=Pw.Configuration.decoder;this._decoderModulePromise=y.Tools.LoadBabylonScriptAsync(w.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(w,E,G,P,h){await this._decoderModulePromise,0===Ew&&(MeshoptDecoder.useWorkers(1),Ew=1);const B=await MeshoptDecoder.decodeGltfBufferAsync(E,G,w,P,h);return null!==Gw&&clearTimeout(Gw),Gw=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Ew=0,Gw=null}),1e3),B}}Pw.Configuration={decoder:{url:`${y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Pw._Default=null;const hw="EXT_meshopt_compression";class Bw{constructor(w){this.name=hw,this.enabled=w.isExtensionUsed(hw),this._loader=w}dispose(){this._loader=null}loadBufferViewAsync(w,E){return z.LoadExtensionAsync(w,E,this.name,(async(G,P)=>{const h=E;if(h._meshOptData)return await h._meshOptData;const B=R.Get(`${w}/buffer`,this._loader.fh.buffers,P.buffer);return h._meshOptData=this._loader.loadBufferAsync(`/buffers/${B.index}`,B,P.byteOffset||0,P.byteLength).then((async w=>await Pw.Default.decodeGltfBufferAsync(w,P.count,P.byteStride,P.mode,P.filter))),await h._meshOptData}))}}M(hw),F(hw,!0,(w=>new Bw(w)));const yw="EXT_texture_webp";class xw{constructor(w){this.name=yw,this._loader=w,this.enabled=w.isExtensionUsed(yw)}dispose(){this._loader=null}_loadTextureAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=void 0==E.sampler?z.DefaultSampler:R.Get(`${w}/sampler`,this._loader.fh.samplers,E.sampler),y=R.Get(`${P}/source`,this._loader.fh.images,h.source);return await this._loader._createTextureAsync(w,B,y,(w=>{G(w)}),void 0,!E._textureInfo.nonColorData)}))}}M(yw),F(yw,!0,(w=>new xw(w)));const Uw="EXT_texture_avif";class lw{constructor(w){this.name=Uw,this._loader=w,this.enabled=w.isExtensionUsed(Uw)}dispose(){this._loader=null}_loadTextureAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=void 0==E.sampler?z.DefaultSampler:R.Get(`${w}/sampler`,this._loader.fh.samplers,E.sampler),y=R.Get(`${P}/source`,this._loader.fh.images,h.source);return await this._loader._createTextureAsync(w,B,y,(w=>{G(w)}),void 0,!E._textureInfo.nonColorData)}))}}M(Uw),F(Uw,!0,(w=>new lw(w)));var iw=G(13240),Ow=G(12194);const uw="EXT_lights_ies";class Vw{constructor(w){this.name=uw,this._loader=w,this.enabled=this._loader.isExtensionUsed(uw)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.fh.extensions;if(w&&w[this.name]){const E=w[this.name];this._lights=E.lights,R.Assign(this._lights)}}loadNodeAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,y)=>{let x,U;this._loader._allMaterialsDirtyRequired=!0;const l=await this._loader.loadNodeAsync(w,E,(w=>{U=R.Get(P,this._lights,y.ih);const E=U.name||w.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,x=new iw.e(E,h.QE.Zero(),h.QE.Backward(),0,1,this._loader.babylonScene),x.angle=Math.PI/2,x.innerAngle=0,x._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,U._babylonLight=x,x.falloffType=Ow.e.FALLOFF_GLTF,x.ox=y.color?B.dE.KE(y.color):B.dE.White(),x.gx=y.multiplier||1,x.range=Number.MAX_VALUE,x.parent=w,this._loader._babylonLights.push(x),z.AddPointerMetadata(x,P),G(w)}));let i;if(U.uri)i=await this._loader.loadUriAsync(w,U,U.uri);else{const E=R.Get(`${w}/bufferView`,this._loader.fh.bufferViews,U.bufferView);i=await this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E)}return x.iesProfileTexture=new K.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,i,!0,void 0,void 0,void 0,void 0,".ies"),l}))}}M(uw),F(uw,!0,(w=>new Vw(w)));var aw=G(13261);const Qw="KHR_draco_mesh_compression";class cw{constructor(w){this.name=Qw,this.useNormalizedFlagFromAccessor=!0,this._loader=w,this.enabled=aw.b.DefaultAvailable&&this._loader.isExtensionUsed(Qw)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{if(void 0!=E.mode&&4!==E.mode&&5!==E.mode)throw new Error(`${w}: Unsupported mode ${E.mode}`);const B={},y={},x=(w,P)=>{const x=h.attributes[w];if(void 0!=x&&(G._delayInfo=G._delayInfo||[],-1===G._delayInfo.indexOf(P)&&G._delayInfo.push(P),B[P]=x,this.useNormalizedFlagFromAccessor)){const G=R.TryGet(this._loader.fh.accessors,E.attributes[w]);G&&(y[P]=G.normalized||!1)}};x("POSITION",q.g.PositionKind),x("NORMAL",q.g.NormalKind),x("TANGENT",q.g.TangentKind),x("TEXCOORD_0",q.g.UVKind),x("TEXCOORD_1",q.g.UV2Kind),x("TEXCOORD_2",q.g.UV3Kind),x("TEXCOORD_3",q.g.UV4Kind),x("TEXCOORD_4",q.g.UV5Kind),x("TEXCOORD_5",q.g.UV6Kind),x("JOINTS_0",q.g.MatricesIndicesKind),x("WEIGHTS_0",q.g.MatricesWeightsKind),x("COLOR_0",q.g.ColorKind);const U=R.Get(P,this._loader.fh.bufferViews,h.bufferView);return U._dracoBabylonGeometry||(U._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((async P=>{const h=this.dracoDecoder||aw.b.Default,x=R.TryGet(this._loader.fh.accessors,E.attributes.POSITION),U=this._loader.parent.alwaysComputeBoundingBox||G.skeleton||!x?null:H(x);return await h._decodeMeshToGeometryForGltfAsync(G.name,this._loader.babylonScene,P,B,y,U).catch((E=>{throw new Error(`${w}: ${E.message}`)}))}))),await U._dracoBabylonGeometry}))}}M(Qw),F(Qw,!0,(w=>new cw(w)));var Zw=G(13267),Jw=G(11668),dw=G(11671),Kw=G(12081),tw=G(12251),qw=G(11646);Kw.e.AddNodeConstructor("Light_Type_0",((w,E)=>()=>new Ww(w,h.QE.Zero(),E)));class Ww extends tw.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(w){this._shadowAngle=w,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(w){const E=this.needCube();if(this._direction=w,this.needCube()!==E&&this._shadowGenerators){const w=this._shadowGenerators.values();for(let E=w.next();!0!==E.done;E=w.next()){E.value.recreateShadowMap()}}}constructor(w,E,G){super(w,G),this._shadowAngle=Math.PI/2,this.position=E}getClassName(){return"PointLight"}getTypeID(){return Ow.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(w){if(this.direction)return super.getShadowDirection(w);switch(w){case 0:return new h.QE(1,0,0);case 1:return new h.QE(-1,0,0);case 2:return new h.QE(0,-1,0);case 3:return new h.QE(0,1,0);case 4:return new h.QE(0,0,1);case 5:return new h.QE(0,0,-1)}return h.QE.Zero()}_setDefaultShadowProjectionMatrix(w,E,G){const P=this.Ww().activeCamera;if(!P)return;const B=void 0!==this.shadowMinZ?this.shadowMinZ:P.Sh,y=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,x=this.Ww().getEngine().useReverseDepthBuffer;h.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,x?y:B,x?B:y,w,!0,this._scene.getEngine().isNDCHalfZRange,void 0,x)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(w,E){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,E):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,E),this}transferToNodeMaterialEffect(w,E){return this.computeTransformedInformation()?w.setFloat3(E,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):w.setFloat3(E,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(w,E){w["POINTLIGHT"+E]=!0}}(0,Jw.c)([(0,dw.F)()],Ww.prototype,"shadowAngle",null),(0,qw.g)("BABYLON.PointLight",Ww);const Tw="KHR_lights_punctual";class Iw{constructor(w){this.name=Tw,this._loader=w,this.enabled=this._loader.isExtensionUsed(Tw)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.fh.extensions;if(w&&w[this.name]){const E=w[this.name];this._lights=E.lights,R.Assign(this._lights)}}loadNodeAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(w,E,(w=>{let E;const x=R.Get(P,this._lights,y.ih),U=x.name||w.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,x.type){case"directional":{const w=new Zw.c(U,h.QE.Backward(),this._loader.babylonScene);w.position.Wx(0),E=w;break}case"point":E=new Ww(U,h.QE.Zero(),this._loader.babylonScene);break;case"spot":{const w=new iw.e(U,h.QE.Zero(),h.QE.Backward(),0,1,this._loader.babylonScene);w.angle=2*(x.spot&&x.spot.outerConeAngle||Math.PI/4),w.innerAngle=2*(x.spot&&x.spot.innerConeAngle||0),E=w;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${P}: Invalid light type (${x.type})`)}E._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,x._babylonLight=E,E.falloffType=Ow.e.FALLOFF_GLTF,E.ox=x.color?B.dE.KE(x.color):B.dE.White(),E.gx=void 0==x.gx?1:x.gx,E.range=void 0==x.range?Number.MAX_VALUE:x.range,E.parent=w,this._loader._babylonLights.push(E),z.AddPointerMetadata(E,P),G(w)})))))}}M(Tw),F(Tw,!0,(w=>new Iw(w)));const jw="KHR_materials_pbrSpecularGlossiness";class gw{constructor(w){this.name=jw,this.order=200,this._loader=w,this.enabled=this._loader.isExtensionUsed(jw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialBasePropertiesAsync(w,E,G)),B.push(this._loadSpecularGlossinessPropertiesAsync(P,h,G)),this._loader.loadMaterialAlphaProperties(w,E,G),await Promise.all(B).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;return G.metallic=null,G.roughness=null,E.diffuseFactor?(G.albedoColor=B.dE.KE(E.diffuseFactor),G.alpha=E.diffuseFactor[3]):G.albedoColor=B.dE.White(),G.reflectivityColor=E.specularFactor?B.dE.KE(E.specularFactor):B.dE.White(),G.microSurface=void 0==E.glossinessFactor?1:E.glossinessFactor,E.diffuseTexture&&P.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTexture`,E.diffuseTexture,(w=>{w.name=`${G.name} (Diffuse)`,G.albedoTexture=w}))),E.specularGlossinessTexture&&(P.push(this._loader.loadTextureInfoAsync(`${w}/specularGlossinessTexture`,E.specularGlossinessTexture,(w=>{w.name=`${G.name} (Specular Glossiness)`,G.reflectivityTexture=w,G.reflectivityTexture.mh=!0}))),G.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(P).then((()=>{}))}}M(jw),F(jw,!0,(w=>new gw(w)));const ow="KHR_materials_unlit";class fw{constructor(w){this.name=ow,this.order=210,this._loader=w,this.enabled=this._loader.isExtensionUsed(ow)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async()=>await this._loadUnlitPropertiesAsync(w,E,G)))}_loadUnlitPropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;G.unlit=!0;const h=E.pbrMetallicRoughness;return h&&(h.baseColorFactor?(G.albedoColor=B.dE.KE(h.baseColorFactor),G.alpha=h.baseColorFactor[3]):G.albedoColor=B.dE.White(),h.baseColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${w}/baseColorTexture`,h.baseColorTexture,(w=>{w.name=`${G.name} (Base Color)`,G.albedoTexture=w})))),E.doubleSided&&(G.Kx=!1,G.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(w,E,G),Promise.all(P).then((()=>{}))}}M(ow),F(ow,!0,(w=>new fw(w)));const kw="KHR_materials_clearcoat";class Nw{constructor(w){this.name=kw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(kw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadClearCoatPropertiesAsync(P,h,G)),await Promise.all(B)}))}_loadClearCoatPropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;return G.clearCoat.isEnabled=!0,G.clearCoat.useRoughnessFromMainTexture=!1,G.clearCoat.remapF0OnInterfaceChange=!1,void 0!=E.clearcoatFactor?G.clearCoat.gx=E.clearcoatFactor:G.clearCoat.gx=0,E.clearcoatTexture&&P.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatTexture`,E.clearcoatTexture,(w=>{w.name=`${G.name} (ClearCoat)`,G.clearCoat.texture=w}))),void 0!=E.clearcoatRoughnessFactor?G.clearCoat.roughness=E.clearcoatRoughnessFactor:G.clearCoat.roughness=0,E.clearcoatRoughnessTexture&&(E.clearcoatRoughnessTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatRoughnessTexture`,E.clearcoatRoughnessTexture,(w=>{w.name=`${G.name} (ClearCoat Roughness)`,G.clearCoat.textureRoughness=w})))),E.clearcoatNormalTexture&&(E.clearcoatNormalTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatNormalTexture`,E.clearcoatNormalTexture,(w=>{w.name=`${G.name} (ClearCoat Normal)`,G.clearCoat.bumpTexture=w}))),G.invertNormalMapX=!G.Ww().useRightHandedSystem,G.invertNormalMapY=G.Ww().useRightHandedSystem,void 0!=E.clearcoatNormalTexture.scale&&(G.clearCoat.bumpTexture.level=E.clearcoatNormalTexture.scale)),Promise.all(P).then((()=>{}))}}M(kw),F(kw,!0,(w=>new Nw(w)));const vw="KHR_materials_iridescence";class Cw{constructor(w){this.name=vw,this.order=195,this._loader=w,this.enabled=this._loader.isExtensionUsed(vw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadIridescencePropertiesAsync(P,h,G)),await Promise.all(B).then((()=>{}))}))}_loadIridescencePropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;return G.iridescence.isEnabled=!0,G.iridescence.gx=E.iridescenceFactor??0,G.iridescence.indexOfRefraction=E.iridescenceIor??E.iridescenceIOR??1.3,G.iridescence.minimumThickness=E.iridescenceThicknessMinimum??100,G.iridescence.maximumThickness=E.iridescenceThicknessMaximum??400,E.iridescenceTexture&&P.push(this._loader.loadTextureInfoAsync(`${w}/iridescenceTexture`,E.iridescenceTexture,(w=>{w.name=`${G.name} (Iridescence)`,G.iridescence.texture=w}))),E.iridescenceThicknessTexture&&P.push(this._loader.loadTextureInfoAsync(`${w}/iridescenceThicknessTexture`,E.iridescenceThicknessTexture,(w=>{w.name=`${G.name} (Iridescence Thickness)`,G.iridescence.thicknessTexture=w}))),Promise.all(P).then((()=>{}))}}M(vw),F(vw,!0,(w=>new Cw(w)));const sw="KHR_materials_anisotropy";class Fw{constructor(w){this.name=sw,this.order=195,this._loader=w,this.enabled=this._loader.isExtensionUsed(sw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadIridescencePropertiesAsync(P,h,G)),await Promise.all(B)}))}async _loadIridescencePropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;G.anisotropy.isEnabled=!0,G.anisotropy.gx=E.anisotropyStrength??0,G.anisotropy.angle=E.anisotropyRotation??0,E.anisotropyTexture&&(E.anisotropyTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${w}/anisotropyTexture`,E.anisotropyTexture,(w=>{w.name=`${G.name} (Anisotropy Intensity)`,G.anisotropy.texture=w})))),await Promise.all(P)}}M(sw),F(sw,!0,(w=>new Fw(w)));const Mw="KHR_materials_emissive_strength";class pw{constructor(w){this.name=Mw,this.order=170,this._loader=w,this.enabled=this._loader.isExtensionUsed(Mw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>await this._loader.loadMaterialPropertiesAsync(w,E,G).then((()=>{this._loadEmissiveProperties(P,h,G)}))))}_loadEmissiveProperties(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);void 0!==E.emissiveStrength&&(G.emissiveIntensity=E.emissiveStrength)}}M(Mw),F(Mw,!0,(w=>new pw(w)));const Dw="KHR_materials_sheen";class ew{constructor(w){this.name=Dw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(Dw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadSheenPropertiesAsync(P,h,G)),await Promise.all(B).then((()=>{}))}))}_loadSheenPropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;return G.sheen.isEnabled=!0,G.sheen.gx=1,void 0!=E.sheenColorFactor?G.sheen.color=B.dE.KE(E.sheenColorFactor):G.sheen.color=B.dE.Black(),E.sheenColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${w}/sheenColorTexture`,E.sheenColorTexture,(w=>{w.name=`${G.name} (Sheen Color)`,G.sheen.texture=w}))),void 0!==E.sheenRoughnessFactor?G.sheen.roughness=E.sheenRoughnessFactor:G.sheen.roughness=0,E.sheenRoughnessTexture&&(E.sheenRoughnessTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${w}/sheenRoughnessTexture`,E.sheenRoughnessTexture,(w=>{w.name=`${G.name} (Sheen Roughness)`,G.sheen.textureRoughness=w})))),G.sheen.albedoScaling=!0,G.sheen.useRoughnessFromMainTexture=!1,Promise.all(P).then((()=>{}))}}M(Dw),F(Dw,!0,(w=>new ew(w)));var Rw=G(12134);const Hw="KHR_materials_specular";class zw{constructor(w){this.name=Hw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(Hw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;if(B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadSpecularPropertiesAsync(P,h,G)),h.extensions&&h.extensions.EXT_materials_specular_edge_color&&G instanceof d.b){h.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(G.brdf.dielectricSpecularModel=Rw.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,G.brdf.conductorSpecularModel=Rw.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(B).then((()=>{}))}))}_loadSpecularPropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;return void 0!==E.specularFactor&&(G.metallicF0Factor=E.specularFactor),void 0!==E.specularColorFactor&&(G.metallicReflectanceColor=B.dE.KE(E.specularColorFactor)),E.specularTexture&&(E.specularTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${w}/specularTexture`,E.specularTexture,(w=>{w.name=`${G.name} (Specular)`,G.metallicReflectanceTexture=w,G.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),E.specularColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${w}/specularColorTexture`,E.specularColorTexture,(w=>{w.name=`${G.name} (Specular Color)`,G.reflectanceTexture=w}))),Promise.all(P).then((()=>{}))}}M(Hw),F(Hw,!0,(w=>new zw(w)));const Lw="KHR_materials_ior";class mw{constructor(w){this.name=Lw,this.order=180,this._loader=w,this.enabled=this._loader.isExtensionUsed(Lw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadIorPropertiesAsync(P,h,G)),await Promise.all(B).then((()=>{}))}))}_loadIorPropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);return void 0!==E.ior?G.indexOfRefraction=E.ior:G.indexOfRefraction=mw._DEFAULT_IOR,Promise.resolve()}}mw._DEFAULT_IOR=1.5,M(Lw),F(Lw,!0,(w=>new mw(w)));const nw="KHR_materials_variants";class rw{constructor(w){this.name=nw,this._loader=w,this.enabled=this._loader.isExtensionUsed(nw)}dispose(){this._loader=null}static GetAvailableVariants(w){const E=this._GetExtensionMetadata(w);return E?Object.keys(E.variants):[]}getAvailableVariants(w){return rw.GetAvailableVariants(w)}static SelectVariant(w,E){const G=this._GetExtensionMetadata(w);if(!G)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${nw} extension`);const P=w=>{const E=G.variants[w];if(E)for(const G of E)G.mesh.material=G.material};if(E instanceof Array)for(const h of E)P(h);else P(E);G.lastSelected=E}selectVariant(w,E){rw.SelectVariant(w,E)}static Reset(w){const E=this._GetExtensionMetadata(w);if(!E)throw new Error(`Cannot reset on a glTF mesh that does not have the ${nw} extension`);for(const G of E.original)G.mesh.material=G.material;E.lastSelected=null}reset(w){rw.Reset(w)}static GetLastSelectedVariant(w){const E=this._GetExtensionMetadata(w);if(!E)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${nw} extension`);return E.lastSelected}getLastSelectedVariant(w){return rw.GetLastSelectedVariant(w)}static _GetExtensionMetadata(w){var E,G;return(null===w||void 0===w||null===(E=w._internalMetadata)||void 0===E||null===(G=E.fh)||void 0===G?void 0:G[nw])||null}onLoading(){const w=this._loader.fh.extensions;if(w&&w[this.name]){const E=w[this.name];this._variants=E.variants}}onReady(){const w=this._loader.rootBabylonMesh;if(w){var E;const G=this._loader.parent.extensionOptions[nw];null!==G&&void 0!==G&&G.defaultVariant&&rw.SelectVariant(w,G.defaultVariant),null===G||void 0===G||null===(E=G.onLoaded)||void 0===E||E.call(G,{get variants(){return rw.GetAvailableVariants(w)},get selectedVariant(){const E=rw.GetLastSelectedVariant(w);return E?Array.isArray(E)?E[0]:E:rw.GetAvailableVariants(w)[0]},set selectedVariant(E){rw.SelectVariant(w,E)}})}}_loadMeshPrimitiveAsync(w,E,G,P,h,B){return z.LoadExtensionAsync(w,h,this.name,(async(y,x)=>{const U=new Array;return U.push(this._loader._loadMeshPrimitiveAsync(w,E,G,P,h,(E=>{if(B(E),E instanceof I.c){const G=z._GetDrawMode(w,h.mode),P=this._loader.rootBabylonMesh,B=P?P._internalMetadata=P._internalMetadata||{}:{},l=B.fh=B.fh||{},i=l[nw]=l[nw]||{lastSelected:null,original:[],variants:{}};i.original.push({mesh:E,material:E.material});for(let w=0;w<x.mappings.length;++w){const h=x.mappings[w],B=R.Get(`${y}/mappings/${w}/material`,this._loader.fh.materials,h.material);U.push(this._loader._loadMaterialAsync(`#/materials/${h.material}`,B,E,G,(w=>{for(let G=0;G<h.variants.length;++G){const B=h.variants[G],y=R.Get(`/extensions/${nw}/variants/${B}`,this._variants,B);i.variants[y.name]=i.variants[y.name]||[],i.variants[y.name].push({mesh:E,material:w}),E.onClonedObservable.add((w=>{const G=w;let h=null,B=G;do{if(B=B.parent,!B)return;h=rw._GetExtensionMetadata(B)}while(null===h);if(P&&h===rw._GetExtensionMetadata(P)){B._internalMetadata={};for(const w in P._internalMetadata)B._internalMetadata[w]=P._internalMetadata[w];B._internalMetadata.fh=[];for(const w in P._internalMetadata.fh)B._internalMetadata.fh[w]=P._internalMetadata.fh[w];B._internalMetadata.fh[nw]={lastSelected:null,original:[],variants:{}};for(const w of h.original)B._internalMetadata.fh[nw].original.push({mesh:w.mesh,material:w.material});for(const w in h.variants)if(Object.prototype.hasOwnProperty.call(h.variants,w)){B._internalMetadata.fh[nw].variants[w]=[];for(const E of h.variants[w])B._internalMetadata.fh[nw].variants[w].push({mesh:E.mesh,material:E.material})}h=B._internalMetadata.fh[nw]}for(const P of h.original)P.mesh===E&&(P.mesh=G);for(const P of h.variants[y.name])P.mesh===E&&(P.mesh=G)}))}})))}}}))),await Promise.all(U).then((w=>{let[E]=w;return E}))}))}}M(nw),F(nw,!0,(w=>new rw(w)));var Yw=G(11737);class Sw{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Rw.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(w,E){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Sw._GetDefaultOptions(),...w},this._scene=E,this._scene._transmissionHelper=this,this.onErrorObservable=new i.d,this._scene.qh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(w){if(!Object.keys(w).filter((E=>this._options[E]!==w[E])).length)return;const E={...this._options,...w},G=this._options;this._options=E,E.renderSize===G.renderSize&&E.renderTargetTextureType===G.renderTargetTextureType&&E.generateMipmaps===G.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=E.samples,this._opaqueRenderTarget.lodGenerationScale=E.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=E.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(w){return!!w&&!!(w instanceof d.b&&w.subSurface.isRefractionEnabled)}_addMesh(w){this._materialObservers[w.uniqueId]=w.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(w.material)?(w.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(w)&&this._transparentMeshesCache.push(w)):-1===this._opaqueMeshesCache.indexOf(w)&&this._opaqueMeshesCache.push(w)}))}_removeMesh(w){w.onMaterialChangedObservable.remove(this._materialObservers[w.uniqueId]),delete this._materialObservers[w.uniqueId];let E=this._transparentMeshesCache.indexOf(w);-1!==E&&this._transparentMeshesCache.splice(E,1),E=this._opaqueMeshesCache.indexOf(w),-1!==E&&this._opaqueMeshesCache.splice(E,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(w){const E=this._transparentMeshesCache.indexOf(w),G=this._opaqueMeshesCache.indexOf(w);this._shouldRenderAsTransmission(w.material)?(w.material instanceof d.b&&(w.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==G?(this._opaqueMeshesCache.splice(G,1),this._transparentMeshesCache.push(w)):-1===E&&this._transparentMeshesCache.push(w)):-1!==E?(this._transparentMeshesCache.splice(E,1),this._opaqueMeshesCache.push(w)):-1===G&&this._opaqueMeshesCache.push(w)}_isRenderTargetValid(){var w;return null!==(null===(w=this._opaqueRenderTarget)||void 0===w?void 0:w.getInternalTexture())}_setupRenderTargets(){var w;let E;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Yw.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(w=this._options.clearColor)||void 0===w?void 0:w.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((w=>{E=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?w.clearColor.B(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(w.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=E}));for(const G of this._transparentMeshesCache)this._shouldRenderAsTransmission(G.material)&&(G.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Xw="KHR_materials_transmission";class bw{constructor(w){this.name=Xw,this.order=175,this._loader=w,this.enabled=this._loader.isExtensionUsed(Xw),this.enabled&&(w.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadTransparentPropertiesAsync(P,E,G,h)),await Promise.all(B).then((()=>{}))}))}_loadTransparentPropertiesAsync(w,E,G,P){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const h=G;if(h.subSurface.isRefractionEnabled=!0,h.subSurface.volumeIndexOfRefraction=1,h.subSurface.useAlbedoToTintRefraction=!0,void 0===P.transmissionFactor)return h.subSurface.refractionIntensity=0,h.subSurface.isRefractionEnabled=!1,Promise.resolve();{var B;h.subSurface.refractionIntensity=P.transmissionFactor;const w=h.Ww();if(h.subSurface.refractionIntensity&&!w._transmissionHelper)new Sw({},h.Ww());else if(h.subSurface.refractionIntensity&&(null===(B=w._transmissionHelper)||void 0===B||!B._isRenderTargetValid())){var y;null===(y=w._transmissionHelper)||void 0===y||y._setupRenderTargets()}}return h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=0,P.transmissionTexture?(P.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${w}/transmissionTexture`,P.transmissionTexture,void 0).then((w=>{w.name=`${G.name} (Transmission)`,h.subSurface.refractionIntensityTexture=w,h.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}M(Xw),F(Xw,!0,(w=>new bw(w)));const Aw="KHR_materials_diffuse_transmission";class wE{constructor(w){this.name=Aw,this.order=174,this._loader=w,this.enabled=this._loader.isExtensionUsed(Aw),this.enabled&&(w.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadTranslucentPropertiesAsync(P,E,G,h)),await Promise.all(B).then((()=>{}))}))}_loadTranslucentPropertiesAsync(w,E,G,P){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const h=G;if(h.subSurface.isTranslucencyEnabled=!0,h.subSurface.volumeIndexOfRefraction=1,h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=0,h.subSurface.useAlbedoToTintTranslucency=!1,void 0===P.diffuseTransmissionFactor)return h.subSurface.translucencyIntensity=0,h.subSurface.isTranslucencyEnabled=!1,Promise.resolve();h.subSurface.translucencyIntensity=P.diffuseTransmissionFactor;const y=new Array;return h.subSurface.useGltfStyleTextures=!0,P.diffuseTransmissionTexture&&(P.diffuseTransmissionTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTransmissionTexture`,P.diffuseTransmissionTexture).then((w=>{w.name=`${G.name} (Diffuse Transmission)`,h.subSurface.translucencyIntensityTexture=w})))),void 0!==P.diffuseTransmissionColorFactor?h.subSurface.translucencyColor=B.dE.KE(P.diffuseTransmissionColorFactor):h.subSurface.translucencyColor=B.dE.White(),P.diffuseTransmissionColorTexture&&y.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTransmissionColorTexture`,P.diffuseTransmissionColorTexture).then((w=>{w.name=`${G.name} (Diffuse Transmission Color)`,h.subSurface.translucencyColorTexture=w}))),Promise.all(y).then((()=>{}))}}M(Aw),F(Aw,!0,(w=>new wE(w)));const EE="KHR_materials_volume";class GE{constructor(w){this.name=EE,this.order=173,this._loader=w,this.enabled=this._loader.isExtensionUsed(EE),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadVolumePropertiesAsync(P,E,G,h)),await Promise.all(B).then((()=>{}))}))}_loadVolumePropertiesAsync(w,E,G,P){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);if(!G.subSurface.isRefractionEnabled&&!G.subSurface.isTranslucencyEnabled||!P.thicknessFactor)return Promise.resolve();G.subSurface.volumeIndexOfRefraction=G.indexOfRefraction;const h=void 0!==P.attenuationDistance?P.attenuationDistance:Number.MAX_VALUE;return G.subSurface.tintColorAtDistance=h,void 0!==P.attenuationColor&&3==P.attenuationColor.length&&G.subSurface.tintColor.tx(P.attenuationColor[0],P.attenuationColor[1],P.attenuationColor[2]),G.subSurface.minimumThickness=0,G.subSurface.maximumThickness=P.thicknessFactor,G.subSurface.useThicknessAsDepth=!0,P.thicknessTexture?(P.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${w}/thicknessTexture`,P.thicknessTexture).then((w=>{w.name=`${G.name} (Thickness)`,G.subSurface.thicknessTexture=w,G.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}M(EE),F(EE,!0,(w=>new GE(w)));const PE="KHR_materials_dispersion";class hE{constructor(w){this.name=PE,this.order=174,this._loader=w,this.enabled=this._loader.isExtensionUsed(PE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadDispersionPropertiesAsync(P,E,G,h)),await Promise.all(B).then((()=>{}))}))}_loadDispersionPropertiesAsync(w,E,G,P){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);return G.subSurface.isRefractionEnabled&&P.dispersion?(G.subSurface.isDispersionEnabled=!0,G.subSurface.dispersion=P.dispersion,Promise.resolve()):Promise.resolve()}}M(PE),F(PE,!0,(w=>new hE(w)));const BE="EXT_materials_diffuse_roughness";class yE{constructor(w){this.name=BE,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(BE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(w,E,G)),B.push(this._loadDiffuseRoughnessPropertiesAsync(P,h,G)),await Promise.all(B).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(w,E,G){if(!(G instanceof d.b))throw new Error(`${w}: Material type not supported`);const P=new Array;return G.brdf.baseDiffuseModel=Rw.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=E.diffuseRoughnessFactor?G.baseDiffuseRoughness=E.diffuseRoughnessFactor:G.baseDiffuseRoughness=0,E.diffuseRoughnessTexture&&P.push(this._loader.loadTextureInfoAsync(`${w}/diffuseRoughnessTexture`,E.diffuseRoughnessTexture,(w=>{w.name=`${G.name} (Diffuse Roughness)`,G.baseDiffuseRoughnessTexture=w}))),Promise.all(P).then((()=>{}))}}M(BE),F(BE,!0,(w=>new yE(w)));const xE="KHR_mesh_quantization";class UE{constructor(w){this.name=xE,this.enabled=w.isExtensionUsed(xE)}dispose(){}}M(xE),F(xE,!0,(w=>new UE(w)));const lE="KHR_texture_basisu";class iE{constructor(w){this.name=lE,this._loader=w,this.enabled=w.isExtensionUsed(lE)}dispose(){this._loader=null}_loadTextureAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>{const B=void 0==E.sampler?z.DefaultSampler:R.Get(`${w}/sampler`,this._loader.fh.samplers,E.sampler),y=R.Get(`${P}/source`,this._loader.fh.images,h.source);return await this._loader._createTextureAsync(w,B,y,(w=>{G(w)}),E._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!E._textureInfo.nonColorData)}))}}M(lE),F(lE,!0,(w=>new iE(w)));const OE="KHR_texture_transform";class uE{constructor(w){this.name=OE,this._loader=w,this.enabled=this._loader.isExtensionUsed(OE)}dispose(){this._loader=null}loadTextureInfoAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(P,h)=>await this._loader.loadTextureInfoAsync(w,E,(w=>{if(!(w instanceof K.c))throw new Error(`${P}: Texture type not supported`);h.offset&&(w.uOffset=h.offset[0],w.vOffset=h.offset[1]),w.uRotationCenter=0,w.vRotationCenter=0,h.rotation&&(w.wAng=-h.rotation),h.scale&&(w.uScale=h.scale[0],w.vScale=h.scale[1]),void 0!=h.texCoord&&(w.coordinatesIndex=h.texCoord),G(w)}))))}}M(OE),F(OE,!0,(w=>new uE(w)));const VE="KHR_xmp_json_ld";class aE{constructor(w){this.name=VE,this.order=100,this._loader=w,this.enabled=this._loader.isExtensionUsed(VE)}dispose(){this._loader=null}onLoading(){var w,E,G;if(null===this._loader.rootBabylonMesh)return;const P=null===(w=this._loader.fh.extensions)||void 0===w?void 0:w.KHR_xmp_json_ld,h=null===(E=this._loader.fh.asset)||void 0===E||null===(G=E.extensions)||void 0===G?void 0:G.KHR_xmp_json_ld;if(P&&h){const w=+h.packet;P.packets&&w<P.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=P.packets[w])}}}function QE(w,E,G,P){return B.dE.KE(E,G).scale(P)}function cE(w,E,G,P){return E[G]*P}function ZE(w,E,G,P){return-E[G]*P}function JE(w,E,G,P){return E[G+1]*P}function dE(w,E,G,P){return E[G]*P*2}function KE(w){return{scale:[new qE(u.e.ANIMATIONTYPE_FLOAT,`${w}.uScale`,cE,(()=>2)),new qE(u.e.ANIMATIONTYPE_FLOAT,`${w}.vScale`,JE,(()=>2))],offset:[new qE(u.e.ANIMATIONTYPE_FLOAT,`${w}.uOffset`,cE,(()=>2)),new qE(u.e.ANIMATIONTYPE_FLOAT,`${w}.vOffset`,JE,(()=>2))],rotation:[new qE(u.e.ANIMATIONTYPE_FLOAT,`${w}.wAng`,ZE,(()=>1))]}}M(VE),F(VE,!0,(w=>new aE(w)));class tE extends L.AnimationPropertyInfo{buildAnimations(w,E,G,P){return[{babylonAnimatable:w._babylonCamera,babylonAnimation:this._buildAnimation(E,G,P)}]}}class qE extends L.AnimationPropertyInfo{buildAnimations(w,E,G,P){const h=[];for(const B in w._data)h.push({babylonAnimatable:w._data[B].babylonMaterial,babylonAnimation:this._buildAnimation(E,G,P)});return h}}class WE extends L.AnimationPropertyInfo{buildAnimations(w,E,G,P){return[{babylonAnimatable:w._babylonLight,babylonAnimation:this._buildAnimation(E,G,P)}]}}(0,p.n)("/cameras/{}/orthographic/xmag",[new tE(u.e.ANIMATIONTYPE_FLOAT,"orthoLeft",ZE,(()=>1)),new tE(u.e.ANIMATIONTYPE_FLOAT,"orthoRight",JE,(()=>1))]),(0,p.n)("/cameras/{}/orthographic/ymag",[new tE(u.e.ANIMATIONTYPE_FLOAT,"orthoBottom",ZE,(()=>1)),new tE(u.e.ANIMATIONTYPE_FLOAT,"orthoTop",JE,(()=>1))]),(0,p.n)("/cameras/{}/orthographic/zfar",[new tE(u.e.ANIMATIONTYPE_FLOAT,"maxZ",cE,(()=>1))]),(0,p.n)("/cameras/{}/orthographic/znear",[new tE(u.e.ANIMATIONTYPE_FLOAT,"Sh",cE,(()=>1))]),(0,p.n)("/cameras/{}/perspective/yfov",[new tE(u.e.ANIMATIONTYPE_FLOAT,"fov",cE,(()=>1))]),(0,p.n)("/cameras/{}/perspective/zfar",[new tE(u.e.ANIMATIONTYPE_FLOAT,"maxZ",cE,(()=>1))]),(0,p.n)("/cameras/{}/perspective/znear",[new tE(u.e.ANIMATIONTYPE_FLOAT,"Sh",cE,(()=>1))]),(0,p.n)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new qE(u.e.ANIMATIONTYPE_COLOR3,"albedoColor",QE,(()=>4)),new qE(u.e.ANIMATIONTYPE_FLOAT,"alpha",(function(w,E,G,P){return E[G+3]*P}),(()=>4))]),(0,p.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"metallic",cE,(()=>1))]),(0,p.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"roughness",cE,(()=>1))]);const TE=KE("albedoTexture");(0,p.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",TE.scale),(0,p.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",TE.offset),(0,p.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",TE.rotation);const IE=KE("metallicTexture");(0,p.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",IE.scale),(0,p.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",IE.offset),(0,p.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",IE.rotation),(0,p.n)("/materials/{}/emissiveFactor",[new qE(u.e.ANIMATIONTYPE_COLOR3,"emissiveColor",QE,(()=>3))]);const jE=KE("bumpTexture");(0,p.n)("/materials/{}/normalTexture/scale",[new qE(u.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",cE,(()=>1))]),(0,p.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",jE.scale),(0,p.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",jE.offset),(0,p.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",jE.rotation),(0,p.n)("/materials/{}/occlusionTexture/strength",[new qE(u.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",cE,(()=>1))]);const gE=KE("ambientTexture");(0,p.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",gE.scale),(0,p.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",gE.offset),(0,p.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",gE.rotation);const oE=KE("emissiveTexture");(0,p.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",oE.scale),(0,p.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",oE.offset),(0,p.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",oE.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new qE(u.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new qE(u.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",cE,(()=>1))]);const fE=KE("anisotropy.texture");(0,p.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",fE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",fE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",fE.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",cE,(()=>1))]);const kE=KE("clearCoat.texture");(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",kE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",kE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",kE.rotation);const NE=KE("clearCoat.bumpTexture");(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new qE(u.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",NE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",NE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",NE.rotation);const vE=KE("clearCoat.textureRoughness");(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",vE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",vE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",vE.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new qE(u.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_ior/ior",[new qE(u.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new qE(u.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new qE(u.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",cE,(()=>1))]);const CE=KE("iridescence.texture");(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",CE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",CE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",CE.rotation);const sE=KE("iridescence.thicknessTexture");(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",sE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",sE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",sE.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new qE(u.e.ANIMATIONTYPE_COLOR3,"sheen.color",QE,(()=>3))]),(0,p.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",cE,(()=>1))]);const FE=KE("sheen.texture");(0,p.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",FE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",FE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",FE.rotation);const ME=KE("sheen.textureRoughness");(0,p.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",ME.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",ME.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",ME.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new qE(u.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",QE,(()=>3))]);const pE=KE("metallicReflectanceTexture");(0,p.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",pE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",pE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",pE.rotation);const DE=KE("reflectanceTexture");(0,p.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",DE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",DE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",DE.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",cE,(()=>1))]);const eE=KE("subSurface.refractionIntensityTexture");(0,p.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",eE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",eE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",eE.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new qE(u.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",QE,(()=>3))]),(0,p.n)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new qE(u.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",cE,(()=>1))]),(0,p.n)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",cE,(()=>1))]);const RE=KE("subSurface.thicknessTexture");(0,p.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",RE.scale),(0,p.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",RE.offset),(0,p.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",RE.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new qE(u.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",cE,(()=>1))]);const HE=KE("subSurface.translucencyIntensityTexture");(0,p.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",HE.scale),(0,p.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",HE.offset),(0,p.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",HE.rotation),(0,p.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new qE(u.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",QE,(()=>3))]);const zE=KE("subSurface.translucencyColorTexture");(0,p.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",zE.scale),(0,p.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",zE.offset),(0,p.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",zE.rotation),(0,p.n)("/extensions/KHR_lights_punctual/lights/{}/color",[new WE(u.e.ANIMATIONTYPE_COLOR3,"diffuse",QE,(()=>3))]),(0,p.n)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new WE(u.e.ANIMATIONTYPE_FLOAT,"intensity",cE,(()=>1))]),(0,p.n)("/extensions/KHR_lights_punctual/lights/{}/range",[new WE(u.e.ANIMATIONTYPE_FLOAT,"range",cE,(()=>1))]),(0,p.n)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new WE(u.e.ANIMATIONTYPE_FLOAT,"innerAngle",dE,(()=>1))]),(0,p.n)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new WE(u.e.ANIMATIONTYPE_FLOAT,"angle",dE,(()=>1))]),(0,p.n)("/nodes/{}/extensions/EXT_lights_ies/color",[new WE(u.e.ANIMATIONTYPE_COLOR3,"diffuse",QE,(()=>3))]),(0,p.n)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new WE(u.e.ANIMATIONTYPE_FLOAT,"intensity",cE,(()=>1))]);const LE="KHR_animation_pointer";class mE{constructor(w){this.name=LE,this._loader=w,this._pathToObjectConverter=(0,p.j)(this._loader.fh)}get enabled(){return this._loader.isExtensionUsed(LE)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(w,E,G,P,h){var B;const y=null===(B=P.target.extensions)||void 0===B?void 0:B.KHR_animation_pointer;if(!y||!this._pathToObjectConverter)return null;"pointer"!==P.target.path&&Q.e.Warn(`${w}/target/path: Value (${P.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=P.target.node&&Q.e.Warn(`${w}/target/node: Value (${P.target.node}) must not be present when using the ${this.name} extension`);const x=`${w}/extensions/${this.name}`,U=y.pointer;if(!U)throw new Error(`${x}: Pointer is missing`);try{const B=this._pathToObjectConverter.convert(U);if(!B.info.interpolation)throw new Error(`${x}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(w,E,G,P,{object:B.object,info:B.info.interpolation},h)}catch(l){return Q.e.Warn(`${x}/pointer: Invalid pointer (${U}) skipped`),null}}}M(LE),F(LE,!0,(w=>new mE(w)));class nE{constructor(w,E,G){this.frame=w,this.action=E,this.onlyOnce=G,this.isDone=!1}_clone(){return new nE(this.frame,this.action,this.onlyOnce)}}var rE=G(11536),YE=G(11578),SE=G(11576);class XE{get loop(){return this._loop}set loop(w){w!==this._loop&&(this._loop=w,this.updateOptions({loop:w}))}get currentTime(){var w;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(w=YE.b.audioEngine)&&void 0!==w&&w.audioContext&&(this.isPlaying||this.isPaused)){const w=this.isPaused?0:YE.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+w}return 0}get spatialSound(){return this._spatialSound}set spatialSound(w){if(w==this._spatialSound)return;const E=this.isPlaying;this.pause(),w?(this._spatialSound=w,this._updateSpatialParameters()):this._disableSpatialSound(),E&&this.play()}constructor(w,E,G){var P;let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new i.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=h.QE.Zero(),this._localDirection=new h.QE(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=w,G=G||a.e.LastCreatedScene)if(this._scene=G,XE._SceneComponentInitialization(G),this._readyToPlayCallback=B,this._customAttenuationFunction=(w,E,G,P,h)=>E<G?w*(1-E/G):0,x&&(this.autoplay=x.autoplay||!1,this._loop=x.loop||!1,void 0!==x.volume&&(this._volume=x.volume),this._spatialSound=x.spatialSound??!1,this.maxDistance=x.maxDistance??100,this.useCustomAttenuation=x.useCustomAttenuation??!1,this.rolloffFactor=x.rolloffFactor||1,this.refDistance=x.refDistance||1,this.distanceModel=x.distanceModel||"linear",this._playbackRate=x.playbackRate||1,this._streaming=x.streaming??!1,this._length=x.length,this._offset=x.offset),null!==(P=YE.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&YE.b.audioEngine.audioContext){this._soundGain=YE.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let w=!0;if(E)try{"string"===typeof E?(this._urlType="String",this._url=E):E instanceof ArrayBuffer?this._urlType="ArrayBuffer":E instanceof HTMLMediaElement?this._urlType="MediaElement":E instanceof MediaStream?this._urlType="MediaStream":E instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(E)&&(this._urlType="Array");let G=[],P=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=YE.b.audioEngine.audioContext.createMediaElementSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=YE.b.audioEngine.audioContext.createMediaStreamSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":E.byteLength>0&&(P=!0,this._soundLoaded(E));break;case"AudioBuffer":this._audioBufferLoaded(E);break;case"String":G.push(E);case"Array":0===G.length&&(G=E);for(let w=0;w<G.length;w++){const E=G[w];if(P=x&&x.skipCodecCheck||-1!==E.indexOf(".mp3",E.length-4)&&YE.b.audioEngine.isMP3supported||-1!==E.indexOf(".ogg",E.length-4)&&YE.b.audioEngine.isOGGsupported||-1!==E.indexOf(".wav",E.length-4)||-1!==E.indexOf(".m4a",E.length-4)||-1!==E.indexOf(".mp4",E.length-4)||-1!==E.indexOf("blob:"),P){this._streaming?(this._htmlAudioElement=new Audio(E),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,y.Tools.SetCorsBehavior(E,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(E,(w=>{this._soundLoaded(w)}),void 0,!0,!0,(w=>{w&&Q.e.Error("XHR "+w.status+" error on: "+E+"."),Q.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:w=!1}w?P||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Q.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(U){Q.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),YE.b.audioEngine&&!YE.b.audioEngine.WarnedWebAudioUnsupported&&(Q.e.Error("Web Audio is not supported by your browser."),YE.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var w;null!==(w=YE.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(w){var E;null!==(E=YE.b.audioEngine)&&void 0!==E&&E.audioContext&&(this._audioBuffer=w,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(w){var E;null!==(E=YE.b.audioEngine)&&void 0!==E&&E.audioContext&&YE.b.audioEngine.audioContext.decodeAudioData(w,(w=>{this._audioBufferLoaded(w)}),(w=>{Q.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+w)}))}setAudioBuffer(w){var E;null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this._audioBuffer=w,this._isReadyToPlay=!0)}updateOptions(w){w&&(this.loop=w.loop??this.loop,this.maxDistance=w.maxDistance??this.maxDistance,this.useCustomAttenuation=w.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=w.rolloffFactor??this.rolloffFactor,this.refDistance=w.refDistance??this.refDistance,this.distanceModel=w.distanceModel??this.distanceModel,this._playbackRate=w.playbackRate??this._playbackRate,this._length=w.length??void 0,this.spatialSound=w.spatialSound??this._spatialSound,this._setOffset(w.offset??void 0),this.setVolume(w.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var w;null!==(w=YE.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&YE.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??YE.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var w;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(w=this._soundPanner)||void 0===w||w.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var w;null!==(w=YE.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(w){var E;null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(w),this._isOutputConnected=!0)}setDirectionalCone(w,E,G){E<w?Q.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=w,this._coneOuterAngle=E,this._coneOuterGain=G,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(w){if(w!=this._coneInnerAngle){var E;if(this._coneOuterAngle<w)return void Q.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=w,null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(w){if(w!=this._coneOuterAngle){var E;if(w<this._coneInnerAngle)return void Q.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=w,null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(w){var E;w.equals(this._position)||(this._position.B(w),null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(w){var E;this._localDirection=w,null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const w=this._connectedTransformNode.getWorldMatrix(),E=h.QE.TransformNormal(this._localDirection,w);E.normalize(),this._soundPanner.orientationX.value=E.x,this._soundPanner.orientationY.value=E.y,this._soundPanner.orientationZ.value=E.z}updateDistanceFromListener(){var w;if(null!==(w=YE.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const w=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.cE(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,w,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(w){this._customAttenuationFunction=w}play(w,E,G){var P;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(P=YE.b.audioEngine)&&void 0!==P&&P.audioContext)try{var h,B;this._clearTimeoutsAndObservers();let P=w?(null===(h=YE.b.audioEngine)||void 0===h?void 0:h.audioContext.currentTime)+w:null===(B=YE.b.audioEngine)||void 0===B?void 0:B.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=YE.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const w=()=>{var G;if(null!==(G=YE.b.audioEngine)&&void 0!==G&&G.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=E??0;const G=this._htmlAudioElement.play();void 0!==G&&G.catch((()=>{var E,G;(null===(E=YE.b.audioEngine)||void 0===E||E.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(G=YE.b.audioEngine)||void 0===G?void 0:G.onAudioUnlockedObservable.addOnce((()=>{w()})))}))}else{var P;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(P=YE.b.audioEngine)||void 0===P?void 0:P.onAudioUnlockedObservable.addOnce((()=>{w()}))}};w()}}else{var y;const h=()=>{var h;if(null!==(h=YE.b.audioEngine)&&void 0!==h&&h.audioContext){var B;if(G=G||this._length,void 0!==E&&this._setOffset(E),this._soundSource){const w=this._soundSource;w.onended=()=>{w.disconnect()}}if(this._soundSource=null===(B=YE.b.audioEngine)||void 0===B?void 0:B.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==E&&(this._soundSource.loopStart=E),void 0!==G&&(this._soundSource.loopEnd=(0|E)+G),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},P=w?(null===(y=YE.b.audioEngine)||void 0===y?void 0:y.audioContext.currentTime)+w:YE.b.audioEngine.audioContext.currentTime;const h=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(P,h,this.loop?void 0:G)}}};"suspended"===(null===(y=YE.b.audioEngine)||void 0===y?void 0:y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var w;"suspended"===(null===(w=YE.b.audioEngine)||void 0===w?void 0:w.audioContext.state)?(YE.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=YE.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{h()})))):h()}),500):h()}this._startTime=P,this.isPlaying=!0,this.isPaused=!1}catch(x){Q.e.Error("Error while trying to play audio: "+this.name+", "+x.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(w){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var G;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(G=this._streamingSource)||void 0===G||G.disconnect();this.isPlaying=!1}else if(null!==(E=YE.b.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource){const E=w?YE.b.audioEngine.audioContext.currentTime+w:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(E)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var w;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var E;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(E=this._streamingSource)||void 0===E||E.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(w=YE.b.audioEngine)&&void 0!==w&&w.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=YE.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(w,E){var G;null!==(G=YE.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._soundGain&&(E&&YE.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(YE.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,YE.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(w,YE.b.audioEngine.audioContext.currentTime+E)):this._soundGain.gain.value=w),this._volume=w}setPlaybackRate(w){this._playbackRate=w,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(w){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=w,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=w=>this._onRegisterAfterWorldMatrixUpdate(w),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(w){var E;if(w.getBoundingInfo){const E=w.getBoundingInfo();this.setPosition(E.boundingSphere.centerWorld)}else this.setPosition(w.absolutePosition);null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const w=()=>{(0,SE.g)((()=>this._isReadyToPlay),(()=>{G._audioBuffer=this.getAudioBuffer(),G._isReadyToPlay=!0,G.autoplay&&G.play(0,this._offset,this._length)}),void 0,300)},E={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},G=new XE(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,E);return this.useCustomAttenuation&&G.setAttenuationFunction(this._customAttenuationFunction),G.setPosition(this._position),G.setPlaybackRate(this._playbackRate),w(),G}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const w={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(w.connectedMeshId=this._connectedTransformNode.id),w.position=this._position.Lh(),w.refDistance=this.refDistance,w.distanceModel=this.distanceModel,w.isDirectional=this._isDirectional,w.localDirectionToMesh=this._localDirection.Lh(),w.coneInnerAngle=this._coneInnerAngle,w.coneOuterAngle=this._coneOuterAngle,w.coneOuterGain=this._coneOuterGain),w}static Parse(w,E,G,P){const B=w.name;let y;y=w.url?G+w.url:G+B;const x={autoplay:w.autoplay,loop:w.loop,volume:w.volume,spatialSound:w.spatialSound,maxDistance:w.maxDistance,rolloffFactor:w.rolloffFactor,refDistance:w.refDistance,distanceModel:w.distanceModel,playbackRate:w.playbackRate};let U;if(P){const w=()=>{(0,SE.g)((()=>P._isReadyToPlay),(()=>{U._audioBuffer=P.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,U._offset,U._length)}),void 0,300)};U=new XE(B,new ArrayBuffer(0),E,null,x),w()}else U=new XE(B,y,E,(()=>{E.removePendingData(U)}),x),E.addPendingData(U);if(w.position){const E=h.QE.KE(w.position);U.setPosition(E)}if(w.isDirectional&&(U.setDirectionalCone(w.coneInnerAngle||360,w.coneOuterAngle||360,w.coneOuterGain||0),w.localDirectionToMesh)){const E=h.QE.KE(w.localDirectionToMesh);U.setLocalDirectionToMesh(E)}if(w.connectedMeshId){const G=E.getMeshById(w.connectedMeshId);G&&U.attachToMesh(G)}return w.metadata&&(U.metadata=w.metadata),U}_setOffset(w){this._offset!==w&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=w)}_clearTimeoutsAndObservers(){var w;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(w=YE.b.audioEngine)||void 0===w||w.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}XE._SceneComponentInitialization=w=>{throw(0,rE.d)("AudioSceneComponent")},(0,qw.g)("BABYLON.Sound",XE);class bE{constructor(w,E,G){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],E.length!==G.length)throw new Error("Sounds length does not equal weights length");this.loop=w,this._weights=G;let P=0;for(const B of G)P+=B;const h=P>0?1/P:0;for(let B=0;B<this._weights.length;B++)this._weights[B]*=h;this._sounds=E;for(const B of this._sounds)B.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(w){if(w!==this._coneInnerAngle){if(this._coneOuterAngle<w)return void Q.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=w;for(const E of this._sounds)E.directionalConeInnerAngle=w}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(w){if(w!==this._coneOuterAngle){if(w<this._coneInnerAngle)return void Q.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=w;for(const E of this._sounds)E.directionalConeOuterAngle=w}}get volume(){return this._volume}set volume(w){if(w!==this._volume)for(const E of this._sounds)E.setVolume(w)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(w){if(!this.isPaused){this.stop();const w=Math.random();let E=0;for(let G=0;G<this._weights.length;G++)if(E+=this._weights[G],w<=E){this._currentIndex=G;break}}const E=this._sounds[this._currentIndex??0];E.isReady()?E.play(0,this.isPaused?void 0:w):E.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class AE{constructor(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(w=w||a.e.LastCreatedScene)&&(this._scene=w,this.soundCollection=[],this._options=E,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var w;null!==(w=YE.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&YE.b.audioEngine.audioContext&&(this._outputAudioNode=YE.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(YE.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(YE.b.audioEngine&&YE.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(w){var E;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&w.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==w.soundTrackId&&(-1===w.soundTrackId?this._scene.mainSoundTrack.removeSound(w):this._scene.soundTracks&&this._scene.soundTracks[w.soundTrackId].removeSound(w)),this.soundCollection.push(w),w.soundTrackId=this.id}removeSound(w){const E=this.soundCollection.indexOf(w);-1!==E&&this.soundCollection.splice(E,1)}setVolume(w){var E;null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=w)}switchPanningModelToHRTF(){var w;if(null!==(w=YE.b.audioEngine)&&void 0!==w&&w.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var w;if(null!==(w=YE.b.audioEngine)&&void 0!==w&&w.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToEqualPower()}connectToAnalyser(w){var E;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=w,null!==(E=YE.b.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,YE.b.audioEngine.masterGain))}}var wG=G(11944),EG=G(11908),GG=G(11513);YE.b.AudioEngineFactory=(w,E,G)=>new PG(w,E,G);class PG{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new i.d,this.onAudioLockedObservable=new i.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,GG.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const P=document.createElement("audio");this._hostElement=w,this._audioContext=E,this._audioDestination=G;try{P&&P.canPlayType&&(P.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||P.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(h){}try{P&&P.canPlayType&&P.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(h){}}lock(){this._triggerSuspendedState()}unlock(){var w,E;if("running"===(null===(w=this._audioContext)||void 0===w?void 0:w.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(E=this._audioContext)||void 0===E||E.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Q.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var w;null===(w=this._audioContext)||void 0===w||w.addEventListener("statechange",(()=>{var w;this.unlocked&&"running"!==(null===(w=this._audioContext)||void 0===w?void 0:w.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var w;return null!==(w=this._audioContext)&&void 0!==w&&w.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(w){this.canUseWebAudio=!1,Q.e.Error("Web Audio: "+w.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(w){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const w=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",E=document.createElement("style");E.appendChild(document.createTextNode(w)),document.getElementsByTagName("head")[0].appendChild(E),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var w;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(w=this._audioContext)||void 0===w||w.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(w){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=w)}connectToAnalyser(w){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=w,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var hG=G(11528);(0,G(12965).e)(wG.c.NAME_AUDIO,((w,E,G,P)=>{let h,B=[];if(G.Mu=G.Mu||[],void 0!==w.Mu&&null!==w.Mu)for(let x=0,U=w.Mu.length;x<U;x++){var y;const U=w.Mu[x];null!==(y=YE.b.audioEngine)&&void 0!==y&&y.canUseWebAudio?(U.url||(U.url=U.name),B[U.url]?G.Mu.push(XE.Parse(U,E,P,B[U.url])):(h=XE.Parse(U,E,P),B[U.url]=h,G.Mu.push(h))):G.Mu.push(new XE(U.name,null,E))}B=[]})),Object.defineProperty(EG.d.prototype,"mainSoundTrack",{get:function(){let w=this._getComponent(wG.c.NAME_AUDIO);return w||(w=new BG(this),this.Oh(w)),this._mainSoundTrack||(this._mainSoundTrack=new AE(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),EG.d.prototype.getSoundByName=function(w){let E;for(E=0;E<this.mainSoundTrack.soundCollection.length;E++)if(this.mainSoundTrack.soundCollection[E].name===w)return this.mainSoundTrack.soundCollection[E];if(this.soundTracks)for(let G=0;G<this.soundTracks.length;G++)for(E=0;E<this.soundTracks[G].soundCollection.length;E++)if(this.soundTracks[G].soundCollection[E].name===w)return this.soundTracks[G].soundCollection[E];return null},Object.defineProperty(EG.d.prototype,"audioEnabled",{get:function(){let w=this._getComponent(wG.c.NAME_AUDIO);return w||(w=new BG(this),this.Oh(w)),w.audioEnabled},set:function(w){let E=this._getComponent(wG.c.NAME_AUDIO);E||(E=new BG(this),this.Oh(E)),w?E.enableAudio():E.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(EG.d.prototype,"headphone",{get:function(){let w=this._getComponent(wG.c.NAME_AUDIO);return w||(w=new BG(this),this.Oh(w)),w.headphone},set:function(w){let E=this._getComponent(wG.c.NAME_AUDIO);E||(E=new BG(this),this.Oh(E)),w?E.switchAudioModeForHeadphones():E.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(EG.d.prototype,"audioListenerPositionProvider",{get:function(){let w=this._getComponent(wG.c.NAME_AUDIO);return w||(w=new BG(this),this.Oh(w)),w.audioListenerPositionProvider},set:function(w){let E=this._getComponent(wG.c.NAME_AUDIO);if(E||(E=new BG(this),this.Oh(E)),w&&"function"!==typeof w)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");E.audioListenerPositionProvider=w},enumerable:!0,configurable:!0}),Object.defineProperty(EG.d.prototype,"audioListenerRotationProvider",{get:function(){let w=this._getComponent(wG.c.NAME_AUDIO);return w||(w=new BG(this),this.Oh(w)),w.audioListenerRotationProvider},set:function(w){let E=this._getComponent(wG.c.NAME_AUDIO);if(E||(E=new BG(this),this.Oh(E)),w&&"function"!==typeof w)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");E.audioListenerRotationProvider=w},enumerable:!0,configurable:!0}),Object.defineProperty(EG.d.prototype,"audioPositioningRefreshRate",{get:function(){let w=this._getComponent(wG.c.NAME_AUDIO);return w||(w=new BG(this),this.Oh(w)),w.audioPositioningRefreshRate},set:function(w){let E=this._getComponent(wG.c.NAME_AUDIO);E||(E=new BG(this),this.Oh(E)),E.audioPositioningRefreshRate=w},enumerable:!0,configurable:!0});class BG{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(w){this.name=wG.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new h.QE,this._cachedCameraPosition=new h.QE,this._lastCheck=0,this._invertMatrixTemp=new h.Matrix,this._cameraDirectionTemp=new h.QE,(w=w||a.e.LastCreatedScene)&&(this.ZE=w,w.soundTracks=[],w.Mu=[])}register(){this.ZE._afterRenderStage.registerStep(wG.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(w){if(w.Mu=[],this.ZE.soundTracks)for(let E=0;E<this.ZE.soundTracks.length;E++){const G=this.ZE.soundTracks[E];for(let E=0;E<G.soundCollection.length;E++)w.Mu.push(G.soundCollection[E].serialize())}}addFromContainer(w){if(w.Mu)for(const E of w.Mu)E.play(),E.autoplay=!0,this.ZE.mainSoundTrack.addSound(E)}removeFromContainer(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(w.Mu)for(const G of w.Mu)G.stop(),G.autoplay=!1,this.ZE.mainSoundTrack.removeSound(G),E&&G.dispose()}dispose(){const w=this.ZE;if(w._mainSoundTrack&&w.mainSoundTrack.dispose(),w.soundTracks)for(let E=0;E<w.soundTracks.length;E++)w.soundTracks[E].dispose()}disableAudio(){const w=this.ZE;let E;for(this._audioEnabled=!1,YE.b.audioEngine&&YE.b.audioEngine.audioContext&&YE.b.audioEngine.audioContext.suspend(),E=0;E<w.mainSoundTrack.soundCollection.length;E++)w.mainSoundTrack.soundCollection[E].pause();if(w.soundTracks)for(E=0;E<w.soundTracks.length;E++)for(let G=0;G<w.soundTracks[E].soundCollection.length;G++)w.soundTracks[E].soundCollection[G].pause()}enableAudio(){const w=this.ZE;let E;for(this._audioEnabled=!0,YE.b.audioEngine&&YE.b.audioEngine.audioContext&&YE.b.audioEngine.audioContext.resume(),E=0;E<w.mainSoundTrack.soundCollection.length;E++)w.mainSoundTrack.soundCollection[E].isPaused&&w.mainSoundTrack.soundCollection[E].play();if(w.soundTracks)for(E=0;E<w.soundTracks.length;E++)for(let G=0;G<w.soundTracks[E].soundCollection.length;G++)w.soundTracks[E].soundCollection[G].isPaused&&w.soundTracks[E].soundCollection[G].play()}switchAudioModeForHeadphones(){const w=this.ZE;if(this._headphone=!0,w.mainSoundTrack.switchPanningModelToHRTF(),w.soundTracks)for(let E=0;E<w.soundTracks.length;E++)w.soundTracks[E].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const w=this.ZE;if(this._headphone=!1,w.mainSoundTrack.switchPanningModelToEqualPower(),w.soundTracks)for(let E=0;E<w.soundTracks.length;E++)w.soundTracks[E].switchPanningModelToEqualPower()}_afterRender(){const w=hG.c.Now;if(this._lastCheck&&w-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=w;const E=this.ZE;if(!this._audioEnabled||!E._mainSoundTrack||!E.soundTracks||0===E._mainSoundTrack.soundCollection.length&&1===E.soundTracks.length)return;const G=YE.b.audioEngine;if(G&&G.audioContext){let w,P=E.activeCamera;if(E.activeCameras&&E.activeCameras.length>0&&(P=E.activeCameras[0]),this.audioListenerPositionProvider){const w=this.audioListenerPositionProvider();G.audioContext.listener.setPosition(w.x||0,w.y||0,w.z||0)}else P?this._cachedCameraPosition.equals(P.globalPosition)||(this._cachedCameraPosition.B(P.globalPosition),G.audioContext.listener.setPosition(P.globalPosition.x,P.globalPosition.y,P.globalPosition.z)):G.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const w=this.audioListenerRotationProvider();G.audioContext.listener.setOrientation(w.x||0,w.y||0,w.z||0,0,1,0)}else P?(P.rigCameras&&P.rigCameras.length>0&&(P=P.rigCameras[0]),P.getViewMatrix().invertToRef(this._invertMatrixTemp),h.QE.TransformNormalToRef(BG._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.B(this._cameraDirectionTemp),G.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):G.audioContext.listener.setOrientation(0,0,0,0,1,0);for(w=0;w<E.mainSoundTrack.soundCollection.length;w++){const G=E.mainSoundTrack.soundCollection[w];G.useCustomAttenuation&&G.updateDistanceFromListener()}if(E.soundTracks)for(w=0;w<E.soundTracks.length;w++)for(let G=0;G<E.soundTracks[w].soundCollection.length;G++){const P=E.soundTracks[w].soundCollection[G];P.useCustomAttenuation&&P.updateDistanceFromListener()}}}}BG._CameraDirection=new h.QE(0,0,-1),XE._SceneComponentInitialization=w=>{let E=w._getComponent(wG.c.NAME_AUDIO);E||(E=new BG(w),w.Oh(E))};const yG="MSFT_audio_emitter";class xG{constructor(w){this.name=yG,this._loader=w,this.enabled=this._loader.isExtensionUsed(yG)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const w=this._loader.fh.extensions;if(w&&w[this.name]){const E=w[this.name];this._clips=E.clips,this._emitters=E.emitters,R.Assign(this._clips),R.Assign(this._emitters)}}loadSceneAsync(w,E){return z.LoadExtensionAsync(w,E,this.name,(async(G,P)=>{const h=new Array;h.push(this._loader.loadSceneAsync(w,E));for(const w of P.emitters){const E=R.Get(`${G}/emitters`,this._emitters,w);if(void 0!=E.refDistance||void 0!=E.maxDistance||void 0!=E.rolloffFactor||void 0!=E.distanceModel||void 0!=E.innerAngle||void 0!=E.outerAngle)throw new Error(`${G}: Direction or Distance properties are not allowed on emitters attached to a scene`);h.push(this._loadEmitterAsync(`${G}/emitters/${E.index}`,E))}await Promise.all(h)}))}loadNodeAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(w,P)=>{const B=new Array,x=await this._loader.loadNodeAsync(w,E,(E=>{for(const G of P.emitters){const P=R.Get(`${w}/emitters`,this._emitters,G);B.push(this._loadEmitterAsync(`${w}/emitters/${P.index}`,P).then((()=>{for(const w of P._babylonSounds)w.attachToMesh(E),void 0==P.innerAngle&&void 0==P.outerAngle||(w.setLocalDirectionToMesh(h.QE.Forward()),w.setDirectionalCone(2*y.Tools.ToDegrees(void 0==P.innerAngle?Math.PI:P.innerAngle),2*y.Tools.ToDegrees(void 0==P.outerAngle?Math.PI:P.outerAngle),0))})))}G(E)}));return await Promise.all(B),x}))}loadAnimationAsync(w,E){return z.LoadExtensionAsync(w,E,this.name,(async(G,P)=>{const h=await this._loader.loadAnimationAsync(w,E),B=new Array;R.Assign(P.events);for(const y of P.events)B.push(this._loadAnimationEventAsync(`${G}/events/${y.index}`,w,E,y,h));return await Promise.all(B),h}))}_loadClipAsync(w,E){if(E._objectURL)return E._objectURL;let G;if(E.uri)G=this._loader.loadUriAsync(w,E,E.uri);else{const P=R.Get(`${w}/bufferView`,this._loader.fh.bufferViews,E.bufferView);G=this._loader.loadBufferViewAsync(`/bufferViews/${P.index}`,P)}return E._objectURL=G.then((w=>URL.createObjectURL(new Blob([w],{type:E.mimeType})))),E._objectURL}_loadEmitterAsync(w,E){if(E._babylonSounds=E._babylonSounds||[],!E._babylonData){const w=new Array,G=E.name||`emitter${E.index}`,P={loop:!1,autoplay:!1,volume:void 0==E.volume?1:E.volume};for(let B=0;B<E.clips.length;B++){const h=`/extensions/${this.name}/clips`,y=R.Get(h,this._clips,E.clips[B].clip);w.push(this._loadClipAsync(`${h}/${E.clips[B].clip}`,y).then((w=>{const h=E._babylonSounds[B]=new XE(G,w,this._loader.babylonScene,null,P);h.refDistance=E.refDistance||1,h.maxDistance=E.maxDistance||256,h.rolloffFactor=E.rolloffFactor||1,h.distanceModel=E.distanceModel||"exponential"})))}const h=Promise.all(w).then((()=>{const w=E.clips.map((w=>w.weight||1)),G=new bE(E.loop||!1,E._babylonSounds,w);E.innerAngle&&(G.directionalConeInnerAngle=2*y.Tools.ToDegrees(E.innerAngle)),E.outerAngle&&(G.directionalConeOuterAngle=2*y.Tools.ToDegrees(E.outerAngle)),E.volume&&(G.volume=E.volume),E._babylonData.sound=G}));E._babylonData={loaded:h}}return E._babylonData.loaded}_getEventAction(w,E,G,P,h){switch(G){case"play":return w=>{const G=(h||0)+(w-P);E.play(G)};case"stop":return()=>{E.stop()};case"pause":return()=>{E.pause()};default:throw new Error(`${w}: Unsupported action ${G}`)}}_loadAnimationEventAsync(w,E,G,P,h){if(0==h.targetedAnimations.length)return Promise.resolve();const B=h.targetedAnimations[0],y=P.hE,x=R.Get(`/extensions/${this.name}/emitters`,this._emitters,y);return this._loadEmitterAsync(w,x).then((()=>{const E=x._babylonData.sound;if(E){const G=new nE(P.time,this._getEventAction(w,E,P.action,P.time,P.startOffset));B.animation.addEvent(G),h.onAnimationGroupEndObservable.add((()=>{E.stop()})),h.onAnimationGroupPauseObservable.add((()=>{E.pause()}))}}))}}M(yG),F(yG,!0,(w=>new xG(w)));const UG="MSFT_lod";class lG{constructor(w){var E;this.name=UG,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new i.d,this.onMaterialLODsLoadedObservable=new i.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=w,this.maxLODsToLoad=(null===(E=this._loader.parent.extensionOptions[UG])||void 0===E?void 0:E.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(UG)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let w=0;w<this._nodePromiseLODs.length;w++){const E=Promise.all(this._nodePromiseLODs[w]).then((()=>{0!==w&&(this._loader.endPerformanceCounter(`Node LOD ${w}`),this._loader.log(`Loaded node LOD ${w}`)),this.onNodeLODsLoadedObservable.notifyObservers(w),w!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${w+1}`),this._loadBufferLOD(this._nodeBufferLODs,w+1),this._nodeSignalLODs[w]&&this._nodeSignalLODs[w].resolve())}));this._loader._completePromises.push(E)}for(let w=0;w<this._materialPromiseLODs.length;w++){const E=Promise.all(this._materialPromiseLODs[w]).then((()=>{0!==w&&(this._loader.endPerformanceCounter(`Material LOD ${w}`),this._loader.log(`Loaded material LOD ${w}`)),this.onMaterialLODsLoadedObservable.notifyObservers(w),w!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${w+1}`),this._loadBufferLOD(this._materialBufferLODs,w+1),this._materialSignalLODs[w]&&this._materialSignalLODs[w].resolve())}));this._loader._completePromises.push(E)}}loadSceneAsync(w,E){const G=this._loader.loadSceneAsync(w,E);return this._loadBufferLOD(this._bufferLODs,0),G}loadNodeAsync(w,E,G){return z.LoadExtensionAsync(w,E,this.name,(async(w,h)=>{let B;const y=this._getLODs(w,E,this._loader.fh.nodes,h.ids);this._loader.logOpen(`${w}`);for(let E=0;E<y.length;E++){const w=y[E];0!==E&&(this._nodeIndexLOD=E,this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new P);const h=w=>{G(w),w.bx(!1)},x=this._loader.loadNodeAsync(`/nodes/${w.index}`,w,h).then((w=>{if(0!==E){const w=y[E-1];w._babylonTransformNode&&(this._disposeTransformNode(w._babylonTransformNode),delete w._babylonTransformNode)}return w.bx(!0),w}));this._nodePromiseLODs[E]=this._nodePromiseLODs[E]||[],0===E?B=x:(this._nodeIndexLOD=null,this._nodePromiseLODs[E].push(x))}return this._loader.logClose(),await B}))}_loadMaterialAsync(w,E,G,P,h){return this._nodeIndexLOD?null:z.LoadExtensionAsync(w,E,this.name,(async(w,B)=>{let y;const x=this._getLODs(w,E,this._loader.fh.materials,B.ids);this._loader.logOpen(`${w}`);for(let E=0;E<x.length;E++){const w=x[E];0!==E&&(this._materialIndexLOD=E);const B=this._loader._loadMaterialAsync(`/materials/${w.index}`,w,G,P,(w=>{0===E&&h(w)})).then((w=>{if(0!==E){h(w);const G=x[E-1]._data;G[P]&&(this._disposeMaterials([G[P].babylonMaterial]),delete G[P])}return w}));this._materialPromiseLODs[E]=this._materialPromiseLODs[E]||[],0===E?y=B:(this._materialIndexLOD=null,this._materialPromiseLODs[E].push(B))}return this._loader.logClose(),await y}))}_loadUriAsync(w,E,G){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const h=this._nodeIndexLOD-1;return this._nodeSignalLODs[h]=this._nodeSignalLODs[h]||new P,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(w,E,G)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const h=this._materialIndexLOD-1;return this._materialSignalLODs[h]=this._materialSignalLODs[h]||new P,this._materialSignalLODs[h].promise.then((async()=>await this._loader.loadUriAsync(w,E,G)))}return null}loadBufferAsync(w,E,G,h){if(this._loader.parent.useRangeRequests&&!E.uri){if(!this._loader.bin)throw new Error(`${w}: Uri is missing or the binary glTF is missing its binary chunk`);const E=async(w,E)=>{const B=G,y=B+h-1;let x=w[E];return x?(x.start=Math.min(x.start,B),x.end=Math.max(x.end,y)):(x={start:B,end:y,loaded:new P},w[E]=x),await x.loaded.promise.then((w=>new Uint8Array(w.buffer,w.byteOffset+G-x.start,h)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?E(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?E(this._materialBufferLODs,this._materialIndexLOD):E(this._bufferLODs,0)}return null}_loadBufferLOD(w,E){const G=w[E];G&&(this._loader.log(`Loading buffer range [${G.start}-${G.end}]`),this._loader.bin.readAsync(G.start,G.end-G.start+1).then((w=>{G.loaded.resolve(w)}),(w=>{G.loaded.reject(w)})))}_getLODs(w,E,G,P){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const h=[];for(let B=P.length-1;B>=0;B--)if(h.push(R.Get(`${w}/ids/${P[B]}`,G,P[B])),h.length===this.maxLODsToLoad)return h;return h.push(E),h}_disposeTransformNode(w){const E=[],G=w.material;G&&E.push(G);for(const h of w.getChildMeshes())h.material&&E.push(h.material);w.dispose();const P=E.filter((w=>this._loader.babylonScene.meshes.every((E=>E.material!=w))));this._disposeMaterials(P)}_disposeMaterials(w){const E={};for(const G of w){for(const w of G.getActiveTextures())E[w.uniqueId]=w;G.dispose()}for(const G in E)for(const w of this._loader.babylonScene.materials)w.hasTexture(E[G])&&delete E[G];for(const G in E)E[G].dispose()}}M(UG),F(UG,!0,(w=>new lG(w)));const iG="MSFT_minecraftMesh";class OG{constructor(w){this.name=iG,this._loader=w,this.enabled=this._loader.isExtensionUsed(iG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtraAsync(w,E,this.name,(async(P,h)=>{if(h){if(!(G instanceof d.b))throw new Error(`${P}: Material type not supported`);const h=this._loader.loadMaterialPropertiesAsync(w,E,G);return G.needAlphaBlending()&&(G.forceDepthWrite=!0,G.separateCullingPass=!0),G.Kx=G.forceDepthWrite,G.twoSidedLighting=!0,await h}}))}}M(iG),F(iG,!0,(w=>new OG(w)));const uG="MSFT_sRGBFactors";class VG{constructor(w){this.name=uG,this._loader=w,this.enabled=this._loader.isExtensionUsed(uG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,E,G){return z.LoadExtraAsync(w,E,this.name,(async(P,h)=>{if(h){if(!(G instanceof d.b))throw new Error(`${P}: Material type not supported`);const h=this._loader.loadMaterialPropertiesAsync(w,E,G),B=G.Ww().getEngine().useExactSrgbConversions;return G.albedoTexture||G.albedoColor.toLinearSpaceToRef(G.albedoColor,B),G.reflectivityTexture||G.reflectivityColor.toLinearSpaceToRef(G.reflectivityColor,B),await h}}))}}M(uG),F(uG,!0,(w=>new VG(w)));var aG=G(13269);const QG={};var cG=G(13315),ZG=G(13296),JG=G(13271),dG=G(13281);function KG(w,E){for(const G of w)for(const w of G.dataOutputs)if(w.uniqueId===E)return w;throw new Error("Could not find data out connection with unique id "+E)}function tG(w,E){for(const G of w)if(G instanceof ZG.e)for(const w of G.signalInputs)if(w.uniqueId===E)return w;throw new Error("Could not find signal in connection with unique id "+E)}async function qG(w,E){const P=await Promise.all(w.allBlocks.map((async w=>{const E=function(w){switch(w){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([G.e(78),G.e(79)]).then(G.bind(G,14707))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await G.e(80).then(G.bind(G,14711))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await G.e(81).then(G.bind(G,14720))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await G.e(82).then(G.bind(G,14729))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await G.e(83).then(G.bind(G,14732))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await G.e(84).then(G.bind(G,14739))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await G.e(85).then(G.bind(G,14748))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await G.e(86).then(G.bind(G,14751))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await G.e(87).then(G.bind(G,14760))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await G.e(90).then(G.bind(G,14787))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await G.e(90).then(G.bind(G,14787))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await G.e(90).then(G.bind(G,14787))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await G.e(90).then(G.bind(G,14787))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await G.e(95).then(G.bind(G,14796))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await G.e(96).then(G.bind(G,14801))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await G.e(97).then(G.bind(G,14809))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await G.e(98).then(G.bind(G,14813))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await G.e(99).then(G.bind(G,14822))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await G.e(100).then(G.bind(G,14824))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await G.e(101).then(G.bind(G,14833))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await G.e(102).then(G.bind(G,14841))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await G.e(103).then(G.bind(G,14849))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await G.e(104).then(G.bind(G,14858))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await G.e(105).then(G.bind(G,14862))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await G.e(106).then(G.bind(G,14870))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await G.e(107).then(G.bind(G,14877))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await G.e(108).then(G.bind(G,14885))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await G.e(109).then(G.bind(G,14889))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await G.e(110).then(G.bind(G,14898))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await G.e(111).then(G.bind(G,14900))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await G.e(112).then(G.bind(G,14904))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await G.e(113).then(G.bind(G,14907))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await G.e(92).then(G.bind(G,14913))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await G.e(114).then(G.bind(G,14921))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await G.e(115).then(G.bind(G,14926))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await G.e(116).then(G.bind(G,14934))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await G.e(93).then(G.bind(G,14938))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await G.e(88).then(G.bind(G,14767))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await G.e(94).then(G.bind(G,14942))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await G.e(94).then(G.bind(G,14942))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await G.e(94).then(G.bind(G,14942))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await G.e(94).then(G.bind(G,14942))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await G.e(94).then(G.bind(G,14942))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await G.e(94).then(G.bind(G,14942))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await G.e(94).then(G.bind(G,14942))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await G.e(94).then(G.bind(G,14942))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await G.e(89).then(G.bind(G,14785))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await G.e(90).then(G.bind(G,14787))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await G.e(90).then(G.bind(G,14787))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await G.e(91).then(G.bind(G,14945))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await G.e(91).then(G.bind(G,14945))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await G.e(91).then(G.bind(G,14945))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await G.e(91).then(G.bind(G,14945))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await G.e(91).then(G.bind(G,14945))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await G.e(91).then(G.bind(G,14945))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await G.e(117).then(G.bind(G,14954))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await G.e(118).then(G.bind(G,14960))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await G.e(119).then(G.bind(G,14968))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await G.e(120).then(G.bind(G,14971))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await G.e(121).then(G.bind(G,14977))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await G.e(122).then(G.bind(G,14986))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await G.e(123).then(G.bind(G,14990))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await G.e(124).then(G.bind(G,14996))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await G.e(125).then(G.bind(G,14998))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await G.e(126).then(G.bind(G,15e3))).FlowGraphDataSwitchBlock;default:if(QG[w])return QG[w];throw new Error(`Unknown block name ${w}`)}}(w.className);return await E()})));return function(w,E,G){const P=E.coordinator.createGraph(),h=[],B=E.valueParseFunction??JG.c;for(let y=0;y<w.allBlocks.length;y++){const x=TG(w.allBlocks[y],{ZE:E.coordinator.config.ZE,pathConverter:E.pathConverter,assetsContainer:E.coordinator.config.ZE,valueParseFunction:B},G[y]);h.push(x),x instanceof cG.c&&P.addEventBlock(x)}for(const y of h){for(const w of y.dataInputs)for(const E of w.connectedPointIds){const G=KG(h,E);w.connectTo(G)}if(y instanceof ZG.e)for(const w of y.signalOutputs)for(const E of w.connectedPointIds){const G=tG(h,E);w.connectTo(G)}}for(const y of w.executionContexts)WG(y,{graph:P,valueParseFunction:B},w.rightHanded);return P}(w,E,P)}function WG(w,E,G){const P=E.graph.createContext();w.enableLogging&&(P.enableLogging=!0),P.treatDataAsRightHanded=G||!1;const h=E.valueParseFunction??JG.c;P.uniqueId=w.uniqueId;const B=P.Ww();if(w._assetsContext){var y,x,U,l,i,O,u,V,a,Q;const E=w._assetsContext,G={meshes:null===(y=E.meshes)||void 0===y?void 0:y.map((w=>B.getMeshById(w))),lights:null===(x=E.lights)||void 0===x?void 0:x.map((w=>B.getLightByName(w))),cameras:null===(U=E.cameras)||void 0===U?void 0:U.map((w=>B.getCameraByName(w))),materials:null===(l=E.materials)||void 0===l?void 0:l.map((w=>B.getMaterialById(w))),textures:null===(i=E.textures)||void 0===i?void 0:i.map((w=>B.getTextureByName(w))),animations:null===(O=E.animations)||void 0===O?void 0:O.map((w=>B.animations.find((E=>E.name===w)))),skeletons:null===(u=E.skeletons)||void 0===u?void 0:u.map((w=>B.getSkeletonByName(w))),Pu:null===(V=E.Pu)||void 0===V?void 0:V.map((w=>B.getParticleSystemById(w))),animationGroups:null===(a=E.animationGroups)||void 0===a?void 0:a.map((w=>B.getAnimationGroupByName(w))),transformNodes:null===(Q=E.transformNodes)||void 0===Q?void 0:Q.map((w=>B.getTransformNodeById(w))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Mu:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};P.assetsContext=G}for(const c in w._userVariables){const E=h(c,w._userVariables,P.assetsContext,B);P.userVariables[c]=E}for(const c in w._connectionValues){const E=h(c,w._connectionValues,P.assetsContext,B);P._setConnectionValueByKey(c,E)}return P}function TG(w,E,G){const P={},h=E.valueParseFunction??JG.c;if(w.config)for(const y in w.config)P[y]=h(y,w.config,E.assetsContainer||E.ZE,E.ZE);if((0,JG.h)(w.className)){if(!E.pathConverter)throw new Error("Path converter is required for this block");P.pathConverter=E.pathConverter}const B=new G(P);B.uniqueId=w.uniqueId;for(let y=0;y<w.dataInputs.length;y++){const E=B.getDataInput(w.dataInputs[y].name);if(!E)throw new Error("Could not find data input with name "+w.dataInputs[y].name+" in block "+w.className);E.deserialize(w.dataInputs[y])}for(let y=0;y<w.dataOutputs.length;y++){const E=B.getDataOutput(w.dataOutputs[y].name);if(!E)throw new Error("Could not find data output with name "+w.dataOutputs[y].name+" in block "+w.className);E.deserialize(w.dataOutputs[y])}return B.metadata=w.metadata,B.deserialize&&B.deserialize(w),B}function IG(w){const[E,G]=w.split(":");return jG({op:E,extension:G})}function jG(w){var E;let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const P=w.extension?null===(E=oG[w.extension])||void 0===E?void 0:E[w.op]:fG[w.op];if(!P&&(Q.e.Warn(`No mapping found for operation ${w.op} and extension ${w.extension||"KHR_interactivity"}`),G)){const E={},G={flows:{}};if(w.inputValueSockets){E.values={};for(const G in w.inputValueSockets)E.values[G]={name:G}}return w.outputValueSockets&&(G.values={},Object.keys(w.outputValueSockets).forEach((w=>{G.values[w]={name:w}}))),{ti:[],inputs:E,outputs:G}}return P}function gG(w,E,G){oG[E]||(oG[E]={}),oG[E][w]=G}const oG={BABYLON:{"flow/log":{ti:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},fG={"event/onStart":{ti:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{ti:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{ti:["FlowGraphSendCustomEventBlock"],extraProcessor(w,E,G,P,h){if("event/send"!==E.op||!w.configuration||1!==Object.keys(w.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const B=w.configuration.event.value[0];if("number"!==typeof B)throw new Error("Event id should be a number");const y=P.arrays.events[B],x=h[0];return x.config||(x.config={}),x.config.eventId=y.eventId,x.config.eventData=y.eventData,h}},"event/receive":{ti:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(w,E){var G;if(!w.configuration)return Q.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const P=w.configuration.event;if(!P)return Q.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const h=P.value[0];if("number"!==typeof h)return Q.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(G=E.events)||void 0===G?void 0:G[h])?{valid:!0}:(Q.e.Error(`Event with id ${h} not found`),{valid:!1,error:`Event with id ${h} not found`})},extraProcessor(w,E,G,P,h){if("event/receive"!==E.op||!w.configuration||1!==Object.keys(w.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const B=w.configuration.event.value[0];if("number"!==typeof B)throw new Error("Event id should be a number");const y=P.arrays.events[B],x=h[0];return x.config||(x.config={}),x.config.eventId=y.eventId,x.config.eventData=y.eventData,h}},"math/e":kG("FlowGraphEBlock"),"math/pi":kG("FlowGraphPIBlock"),"math/inf":kG("FlowGraphInfBlock"),"math/nan":kG("FlowGraphNaNBlock"),"math/abs":kG("FlowGraphAbsBlock"),"math/sign":kG("FlowGraphSignBlock"),"math/trunc":kG("FlowGraphTruncBlock"),"math/floor":kG("FlowGraphFloorBlock"),"math/ceil":kG("FlowGraphCeilBlock"),"math/round":{ti:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h){var B;return(B=h[0]).config||(B.config={}),h[0].config.roundHalfAwayFromZero=!0,h}},"math/fract":kG("FlowGraphFractBlock"),"math/neg":kG("FlowGraphNegationBlock"),"math/add":kG("FlowGraphAddBlock",["a","b"],!0),"math/sub":kG("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{ti:["FlowGraphMultiplyBlock"],extraProcessor(w,E,G,P,h){var B;(B=h[0]).config||(B.config={}),h[0].config.useMatrixPerComponent=!0,h[0].config.preventIntegerFloatArithmetic=!0;let y=-1;return Object.keys(w.values||{}).find((E=>{var G;return void 0!==(null===(G=w.values)||void 0===G?void 0:G[E].type)&&(y=w.values[E].type,!0)})),-1!==y&&(h[0].config.type=P.arrays.types[y].flowGraphType),h},validation:w=>w.values?NG(w):{valid:!0}},"math/div":kG("FlowGraphDivideBlock",["a","b"],!0),"math/rem":kG("FlowGraphModuloBlock",["a","b"]),"math/min":kG("FlowGraphMinBlock",["a","b"]),"math/max":kG("FlowGraphMaxBlock",["a","b"]),"math/clamp":kG("FlowGraphClampBlock",["a","b","c"]),"math/saturate":kG("FlowGraphSaturateBlock"),"math/mix":kG("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":kG("FlowGraphEqualityBlock",["a","b"]),"math/lt":kG("FlowGraphLessThanBlock",["a","b"]),"math/le":kG("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":kG("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":kG("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":kG("FlowGraphIsNaNBlock"),"math/isinf":kG("FlowGraphIsInfBlock"),"math/select":{ti:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{ti:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":kG("FlowGraphSinBlock"),"math/cos":kG("FlowGraphCosBlock"),"math/tan":kG("FlowGraphTanBlock"),"math/asin":kG("FlowGraphASinBlock"),"math/acos":kG("FlowGraphACosBlock"),"math/atan":kG("FlowGraphATanBlock"),"math/atan2":kG("FlowGraphATan2Block",["a","b"]),"math/sinh":kG("FlowGraphSinhBlock"),"math/cosh":kG("FlowGraphCoshBlock"),"math/tanh":kG("FlowGraphTanhBlock"),"math/asinh":kG("FlowGraphASinhBlock"),"math/acosh":kG("FlowGraphACoshBlock"),"math/atanh":kG("FlowGraphATanhBlock"),"math/exp":kG("FlowGraphExponentialBlock"),"math/log":kG("FlowGraphLogBlock"),"math/log2":kG("FlowGraphLog2Block"),"math/log10":kG("FlowGraphLog10Block"),"math/sqrt":kG("FlowGraphSquareRootBlock"),"math/cbrt":kG("FlowGraphCubeRootBlock"),"math/pow":kG("FlowGraphPowerBlock",["a","b"]),"math/length":kG("FlowGraphLengthBlock"),"math/normalize":kG("FlowGraphNormalizeBlock"),"math/dot":kG("FlowGraphDotBlock",["a","b"]),"math/cross":kG("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":kG("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":kG("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{ti:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{ti:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{ti:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{ti:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{ti:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{ti:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{ti:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":kG("FlowGraphTransposeBlock"),"math/determinant":kG("FlowGraphDeterminantBlock"),"math/inverse":kG("FlowGraphInvertMatrixBlock"),"math/matmul":kG("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{ti:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"qx",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h,B){const y=h[0].dataInputs.find((w=>"rotationQuaternion"===w.name));if(!y)throw new Error("Rotation quaternion input not found");return B._connectionValues[y.uniqueId]&&(B._connectionValues[y.uniqueId].type="Quaternion"),h}},"math/matDecompose":{ti:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"qx"}}}},"math/quatConjugate":kG("FlowGraphConjugateBlock",["a"]),"math/quatMul":{ti:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h){var B;return(B=h[0]).config||(B.config={}),h[0].config.type="Quaternion",h}},"math/quatAngleBetween":kG("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{ti:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":kG("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":kG("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{ti:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h){var B;return(B=h[0]).config||(B.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract2x2":{ti:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{ti:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h){var B;return(B=h[0]).config||(B.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract3x3":{ti:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{ti:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h){var B;return(B=h[0]).config||(B.config={}),h[0].config.inputIsColumnMajor=!0,h}},"math/extract4x4":{ti:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{ti:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h,B){var y,x;(x=h[0]).config||(x.config={});const U=h[0].dataInputs[0];return h[0].config.valueType=(null===(y=B._connectionValues[U.uniqueId])||void 0===y?void 0:y.type)??"FlowGraphInteger",h}},"math/and":{ti:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h,B){var y,x,U;(U=h[0]).config||(U.config={});const l=h[0].dataInputs[0],i=h[0].dataInputs[1];return h[0].config.valueType=(null===(y=B._connectionValues[l.uniqueId])||void 0===y?void 0:y.type)??(null===(x=B._connectionValues[i.uniqueId])||void 0===x?void 0:x.type)??"FlowGraphInteger",h}},"math/or":{ti:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h,B){var y,x,U;(U=h[0]).config||(U.config={});const l=h[0].dataInputs[0],i=h[0].dataInputs[1];return h[0].config.valueType=(null===(y=B._connectionValues[l.uniqueId])||void 0===y?void 0:y.type)??(null===(x=B._connectionValues[i.uniqueId])||void 0===x?void 0:x.type)??"FlowGraphInteger",h}},"math/xor":{ti:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,E,G,P,h,B){var y,x,U;(U=h[0]).config||(U.config={});const l=h[0].dataInputs[0],i=h[0].dataInputs[1];return h[0].config.valueType=(null===(y=B._connectionValues[l.uniqueId])||void 0===y?void 0:y.type)??(null===(x=B._connectionValues[i.uniqueId])||void 0===x?void 0:x.type)??"FlowGraphInteger",h}},"math/asr":kG("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":kG("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":kG("FlowGraphLeadingZerosBlock"),"math/ctz":kG("FlowGraphTrailingZerosBlock"),"math/popcnt":kG("FlowGraphOneBitsCounterBlock"),"math/rad":kG("FlowGraphDegToRadBlock"),"math/deg":kG("FlowGraphRadToDegBlock"),"type/boolToInt":kG("FlowGraphBooleanToInt"),"type/boolToFloat":kG("FlowGraphBooleanToFloat"),"type/intToBool":kG("FlowGraphIntToBoolean"),"type/intToFloat":kG("FlowGraphIntToFloat"),"type/floatToInt":kG("FlowGraphFloatToInt"),"type/floatToBool":kG("FlowGraphFloatToBoolean"),"flow/sequence":{ti:["FlowGraphSequenceBlock"],extraProcessor(w,E,G,P,h){const B=h[0];return B.config||(B.config={}),B.config.outputSignalCount=Object.keys(w.flows||[]).length,B.signalOutputs.forEach(((w,E)=>{w.name="out_"+E})),h}},"flow/branch":{ti:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{ti:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(w){if(w.configuration&&w.configuration.cases){const E=w.configuration.cases.value;if(!E.every((w=>"number"===typeof w&&/^-?\d+$/.test(w.toString()))))return Q.e.Warn("Switch cases should be integers. Using empty array instead."),w.configuration.cases.value=[],{valid:!0};const G=new Set(E);w.configuration.cases.value=Array.from(G)}return{valid:!0}},extraProcessor(w,E,G,P,h){if("flow/switch"!==E.op||!w.flows||0===Object.keys(w.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return h[0].signalOutputs.forEach((w=>{"default"!==w.name&&(w.name="out_"+w.name)})),h}},"flow/while":{ti:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{ti:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(w,E,G,P,h){const B=h[0];return B.config||(B.config={}),B.config.incrementIndexWhenLoopDone=!0,h}},"flow/doN":{ti:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{ti:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(w,E,G,P,h){if("flow/multiGate"!==E.op||!w.flows||0===Object.keys(w.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const B=h[0];return B.config||(B.config={}),B.config.outputSignalCount=Object.keys(w.flows).length,B.signalOutputs.forEach(((w,E)=>{w.name="out_"+E})),h}},"flow/waitAll":{ti:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(w){var E,G;return"number"!==typeof(null===(E=w.configuration)||void 0===E||null===(G=E.inputFlows)||void 0===G?void 0:G.value[0])&&(w.configuration=w.configuration||{inputFlows:{value:[0]}},w.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{ti:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{ti:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{ti:["FlowGraphCancelDelayBlock"]},"variable/get":{ti:["FlowGraphGetVariableBlock"],validation(w){var E,G;return null!==(E=w.configuration)&&void 0!==E&&null!==(G=E.variable)&&void 0!==G&&G.value?{valid:!0}:(Q.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(w,E)=>[E.getVariableName(w[0])]}}},"variable/set":{ti:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(w,E)=>[E.getVariableName(w[0])]}}},"variable/setMultiple":{ti:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(w,E)=>[w[0].map((w=>E.getVariableName(w)))]}},extraProcessor:(w,E,G,P,h)=>(h[0].dataInputs.forEach((w=>{w.name=P.getVariableName(+w.name)})),h)},"variable/interpolate":{ti:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(w,E)=>[E.getVariableName(w[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:w=>!0===w[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",qG:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",qG:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",qG:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",qG:"FlowGraphPlayAnimationBlock"},out:{name:"out",qG:"FlowGraphPlayAnimationBlock"},done:{name:"done",qG:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(w,E,G,P,h){var B,y,x;const U=h[0],l=null===(B=w.configuration)||void 0===B?void 0:B.variable.value[0];if("number"!==typeof l)throw Q.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const i=P.arrays.staticVariables[l];"undefined"===typeof U.config.animationType.value&&(P.arrays.staticVariables,U.config.animationType.value=(0,dG.F)(i.type));const O=h[4];return O.config||(O.config={}),(y=O.config).variable||(y.variable={}),O.config.variable.value=P.getVariableName(l),(x=h[3]).config||(x.config={}),h}},"pointer/get":{ti:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",qG:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",qG:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,E,G,P,h)=>(h.forEach((w=>{"FlowGraphJsonPointerParserBlock"===w.className&&(w.config||(w.config={}),w.config.outputValue=!0)})),h)},"pointer/set":{ti:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",qG:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",qG:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,E,G,P,h)=>(h.forEach((w=>{"FlowGraphJsonPointerParserBlock"===w.className&&(w.config||(w.config={}),w.config.outputValue=!0)})),h)},"pointer/interpolate":{ti:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",qG:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",qG:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",qG:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",qG:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",qG:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",qG:"FlowGraphPlayAnimationBlock"},out:{name:"out",qG:"FlowGraphPlayAnimationBlock"},done:{name:"done",qG:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,E,G,P,h)=>(h.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className?(E.config||(E.config={}),E.config.outputValue=!0):"FlowGraphInterpolationBlock"===E.className&&(E.config||(E.config={}),Object.keys(w.values||[]).forEach((G=>{var h;const B=null===(h=w.values)||void 0===h?void 0:h[G];if("value"===G&&B){const w=B.type;void 0!==w&&(E.config.animationType=P.arrays.types[w].flowGraphType)}})))})),h)},"animation/start":{ti:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",qG:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(w,E)=>[w[0]*E._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(w,E)=>[w[0]*E._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,E,G,P,h,B,y){const x=h[h.length-1];return x.config||(x.config={}),x.config.glTF=y,h}},"animation/stop":{ti:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",qG:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,E,G,P,h,B,y){const x=h[h.length-1];return x.config||(x.config={}),x.config.glTF=y,h}},"animation/stopAt":{ti:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",qG:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(w,E)=>[w[0]*E._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,E,G,P,h,B,y){const x=h[h.length-1];return x.config||(x.config={}),x.config.glTF=y,h}},"math/switch":{ti:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(w){if(w.configuration&&w.configuration.cases){const E=w.configuration.cases.value;if(!E.every((w=>"number"===typeof w&&/^-?\d+$/.test(w.toString()))))return Q.e.Warn("Switch cases should be integers. Using empty array instead."),w.configuration.cases.value=[],{valid:!0};const G=new Set(E);w.configuration.cases.value=Array.from(G)}return{valid:!0}},extraProcessor(w,E,G,P,h){const B=h[0];return B.dataInputs.forEach((w=>{"default"!==w.name&&"case"!==w.name&&(w.name="in_"+w.name)})),B.config||(B.config={}),B.config.treatCasesAsIntegers=!0,h}},"debug/log":{ti:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function kG(w){let E=arguments.length>2?arguments[2]:void 0;return{ti:[w],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((w,E)=>(w[E]={name:E},w)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(w,G,P,h,B){var y;if(E){(y=B[0]).config||(y.config={}),B[0].config.preventIntegerFloatArithmetic=!0;let E=-1;Object.keys(w.values||{}).find((G=>{var P;return void 0!==(null===(P=w.values)||void 0===P?void 0:P[G].type)&&(E=w.values[G].type,!0)})),-1!==E&&(B[0].config.type=h.arrays.types[E].flowGraphType)}return B},validation:w=>E?NG(w):{valid:!0}}}function NG(w){if(w.values){const E=Object.keys(w.values).map((E=>w.values[E].type)).filter((w=>void 0!==w));if(!E.every((w=>w===E[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}fG["math/compose"]=fG["math/matCompose"],fG["math/decompose"]=fG["math/matDecompose"];var vG=G(11650);const CG={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"QE",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class sG{constructor(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=w,this._gltf=E,this._animationTargetFps=G,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const w of this._interactivityGraph.types)this._types.push(CG[w.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const w of this._interactivityGraph.declarations){const E=jG(w);if(!E)throw Q.e.Error(["No mapping found for declaration",w]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:E,fullOperationName:w.extension?w.op+":"+w.extension:w.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const w of this._interactivityGraph.variables){const E=this._parseVariable(w);this._staticVariables.push(E)}}_parseVariable(w,E){const G=this._types[w.type];if(!G)throw Q.e.Error(["No type found for variable",w]),new Error("Error parsing variables");if(w.value&&w.value.length!==G.length)throw Q.e.Error(["Invalid value length for variable",w,G]),new Error("Error parsing variables");const P=w.value||[];if(!P.length)switch(G.flowGraphType){case"boolean":P.push(!1);break;case"FlowGraphInteger":P.push(0);break;case"number":P.push(NaN);break;case"Vector2":P.push(NaN,NaN);break;case"QE":P.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":P.fill(NaN,0,4);break;case"Matrix":P.fill(NaN,0,16);break;case"Matrix3D":P.fill(NaN,0,9)}return"number"===G.elementType&&"string"===typeof P[0]&&(P[0]=parseFloat(P[0])),{type:G.flowGraphType,value:E?E(P,this):P}}_parseEvents(){if(this._interactivityGraph.events)for(const w of this._interactivityGraph.events){const E={eventId:w.id||"internalEvent_"+this._internalEventsCounter++};w.values&&(E.eventData=Object.keys(w.values).map((E=>{var G;const P=null===(G=w.values)||void 0===G?void 0:G[E];if(!P)throw Q.e.Error(["No value found for event key",E]),new Error("Error parsing events");const h=this._types[P.type];if(!h)throw Q.e.Error(["No type found for event value",P]),new Error("Error parsing events");const B="undefined"!==typeof P.value?this._parseVariable(P):void 0;return{id:E,type:h.flowGraphType,eventData:!0,value:B}}))),this._events.push(E)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const E of this._interactivityGraph.nodes){if("number"!==typeof E.declaration)throw Q.e.Error(["No declaration found for node",E]),new Error("Error parsing nodes");const G=this._mappings[E.declaration];if(!G)throw Q.e.Error(["No mapping found for node",E]),new Error("Error parsing nodes");if(G.flowGraphMapping.validation){const P=G.flowGraphMapping.validation(E,this._interactivityGraph,this._gltf);var w;if(!P.valid)throw new Error(`Error validating interactivity node ${null===(w=this._interactivityGraph.declarations)||void 0===w?void 0:w[E.declaration].op} - ${P.error}`)}const P=[];for(const w of G.flowGraphMapping.ti){const h=this._getEmptyBlock(w,G.fullOperationName);this._parseNodeConfiguration(E,h,G.flowGraphMapping,w),P.push(h)}this._nodes.push({ti:P,fullOperationName:G.fullOperationName})}}_getEmptyBlock(w,E){return{uniqueId:(0,vG.e)(),className:w,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:E,metadata:{}}}_parseNodeConfiguration(w,E,G,P){const h=E.config;if(w.configuration){const E=Object.keys(w.configuration);for(const x of E){var B,y;const E=null===(B=w.configuration)||void 0===B?void 0:B[x];if(!E)throw Q.e.Error(["No value found for node configuration",x]),new Error("Error parsing node configuration");const U=null===(y=G.configuration)||void 0===y?void 0:y[x];if(U&&U.qG?U.qG===P:0===G.ti.indexOf(P)){const w=(null===U||void 0===U?void 0:U.name)||x;E&&"undefined"!==typeof E.value||"undefined"===typeof(null===U||void 0===U?void 0:U.defaultValue)?E.value.length>=0?h[w]={value:1===E.value.length?E.value[0]:E.value}:Q.e.Warn(["Invalid value for node configuration",E]):h[w]={value:U.defaultValue},U&&U.dataTransformer&&(h[w].value=U.dataTransformer([h[w].value],this)[0])}}}}_parseNodeConnections(w){for(let q=0;q<this._nodes.length;q++){var E;const W=null===(E=this._interactivityGraph.nodes)||void 0===E?void 0:E[q];if(!W)throw Q.e.Error(["No node found for interactivity node",this._nodes[q]]),new Error("Error parsing node connections");const T=this._nodes[q],I=this._mappings[W.declaration];if(!I)throw Q.e.Error(["No mapping found for node",W]),new Error("Error parsing node connections");const j=W.flows||{},g=Object.keys(j).sort();for(const w of g){var G,P,h,B;const E=j[w],l=null===(G=I.flowGraphMapping.outputs)||void 0===G||null===(P=G.flows)||void 0===P?void 0:P[w],i=(null===l||void 0===l?void 0:l.name)||w,O=this._createNewSocketConnection(i,!0);(l&&l.qG&&T.ti.find((w=>w.className===l.qG))||T.ti[0]).signalOutputs.push(O);const u=E.node,V=this._nodes[u];if(!V)throw Q.e.Error(["No node found for input node id",u]),new Error("Error parsing node connections");const a=IG(V.fullOperationName);if(!a)throw Q.e.Error(["No mapping found for input node",V]),new Error("Error parsing node connections");let c=null===(h=a.inputs)||void 0===h||null===(B=h.flows)||void 0===B?void 0:B[E.socket||"in"],Z=!1;if(!c)for(const w in null===(y=a.inputs)||void 0===y?void 0:y.flows){var y,x,U;if(w.startsWith("[")&&w.endsWith("]"))Z=!0,c=null===(x=a.inputs)||void 0===x||null===(U=x.flows)||void 0===U?void 0:U[w]}const J=c?Z?c.name.replace("$1",E.socket||""):c.name:E.socket||"in",d=c&&c.qG&&V.ti.find((w=>w.className===c.qG))||V.ti[0];let K=d.signalInputs.find((w=>w.name===J));K||(K=this._createNewSocketConnection(J),d.signalInputs.push(K)),K.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(K.uniqueId)}const o=W.values||{},f=Object.keys(o);for(const E of f){var l,i;const G=o[E];let P=null===(l=I.flowGraphMapping.inputs)||void 0===l||null===(i=l.values)||void 0===i?void 0:i[E],h=!1;if(!P)for(const w in null===(O=I.flowGraphMapping.inputs)||void 0===O?void 0:O.values){var O,u,V;if(w.startsWith("[")&&w.endsWith("]"))h=!0,P=null===(u=I.flowGraphMapping.inputs)||void 0===u||null===(V=u.values)||void 0===V?void 0:V[w]}const B=P?h?P.name.replace("$1",E):P.name:E,y=this._createNewSocketConnection(B);if((P&&P.qG&&T.ti.find((w=>w.className===P.qG))||T.ti[0]).dataInputs.push(y),void 0!==G.value){const E=this._parseVariable(G,P&&P.dataTransformer);w._connectionValues[y.uniqueId]=E}else{if("undefined"===typeof G.node)throw Q.e.Error(["Invalid value for value connection",G]),new Error("Error parsing node connections");{var a,c,Z;const w=G.node,E=G.socket||"value",P=this._nodes[w];if(!P)throw Q.e.Error(["No node found for output socket reference",G]),new Error("Error parsing node connections");const h=IG(P.fullOperationName);if(!h)throw Q.e.Error(["No mapping found for output socket reference",G]),new Error("Error parsing node connections");let B=null===(a=h.outputs)||void 0===a||null===(c=a.values)||void 0===c?void 0:c[E],x=!1;if(!B)for(const G in null===(J=h.outputs)||void 0===J?void 0:J.values){var J,d,K;if(G.startsWith("[")&&G.endsWith("]"))x=!0,B=null===(d=h.outputs)||void 0===d||null===(K=d.values)||void 0===K?void 0:K[G]}const U=B?x?B.name.replace("$1",E):null===(Z=B)||void 0===Z?void 0:Z.name:E,l=B&&B.qG&&P.ti.find((w=>w.className===B.qG))||P.ti[0];let i=l.dataOutputs.find((w=>w.name===U));i||(i=this._createNewSocketConnection(U,!0),l.dataOutputs.push(i)),y.connectedPointIds.push(i.uniqueId),i.connectedPointIds.push(y.uniqueId)}}}if(I.flowGraphMapping.interBlockConnectors)for(const w of I.flowGraphMapping.interBlockConnectors){const E=w.input,G=w.output,P=w.isVariable;this._connectFlowGraphNodes(E,G,T.ti[w.inputBlockIndex],T.ti[w.outputBlockIndex],P)}if(I.flowGraphMapping.extraProcessor){var t;const E=null===(t=this._interactivityGraph.declarations)||void 0===t?void 0:t[W.declaration];if(!E)throw Q.e.Error(["No declaration found for extra processor",W]),new Error("Error parsing node connections");T.ti=I.flowGraphMapping.extraProcessor(W,E,I.flowGraphMapping,this,T.ti,w,this._gltf)}}}_createNewSocketConnection(w,E){return{uniqueId:(0,vG.e)(),name:w,_connectionType:E?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(w,E,G,P,h){const B=h?G.dataInputs:G.signalInputs,y=h?P.dataOutputs:P.signalOutputs,x=B.find((E=>E.name===w))||this._createNewSocketConnection(w),U=y.find((w=>w.name===E))||this._createNewSocketConnection(E,!0);B.find((E=>E.name===w))||B.push(x),y.find((w=>w.name===E))||y.push(U),x.connectedPointIds.push(U.uniqueId),U.connectedPointIds.push(x.uniqueId)}getVariableName(w){return"staticVariable_"+w}serializeToFlowGraph(){const w={uniqueId:(0,vG.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(w);for(let E=0;E<this._staticVariables.length;E++){const G=this._staticVariables[E];w._userVariables[this.getVariableName(E)]=G}return{rightHanded:!0,allBlocks:this._nodes.reduce(((w,E)=>w.concat(E.ti)),[]),executionContexts:[w]}}}const FG="KHR_interactivity";class MG{constructor(w){this._loader=w,this.name=FG,this.enabled=this._loader.isExtensionUsed(FG),this._pathConverter=(0,p.j)(this._loader.fh),w._skipStartAnimationStep=!0;const E=w.babylonScene;E&&function(w){(0,p.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!w.activeCamera)return new h.Quaternion(NaN,NaN,NaN,NaN);const E=h.Quaternion.FromRotationMatrix(w.activeCamera.getWorldMatrix()).normalize();return w.useRightHandedSystem||(E.w*=-1,E.x*=-1),E},type:"Quaternion",getTarget:()=>w.activeCamera}),(0,p.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!w.activeCamera)return new h.QE(NaN,NaN,NaN);const E=w.activeCamera.getWorldMatrix().getTranslation();return w.useRightHandedSystem||(E.x*=-1),E},type:"QE",getTarget:()=>w.activeCamera}),(0,p.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:w=>{var E;return(null===(E=w._babylonAnimationGroup)||void 0===E?void 0:E.isPlaying)??!1},type:"boolean",getTarget:w=>w._babylonAnimationGroup}),(0,p.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:w=>{var E;return((null===(E=w._babylonAnimationGroup)||void 0===E?void 0:E.from)??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,p.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:w=>{var E;return((null===(E=w._babylonAnimationGroup)||void 0===E?void 0:E.to)??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,p.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:w=>{var E;return((null===(E=w._babylonAnimationGroup)||void 0===E?void 0:E.getCurrentFrame())??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,p.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:w=>{var E;return((null===(E=w._babylonAnimationGroup)||void 0===E?void 0:E.getCurrentFrame())??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup})}(E)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var w;if(!this._loader.babylonScene||!this._pathConverter)return;const E=this._loader.babylonScene,G=null===(w=this._loader.fh.extensions)||void 0===w?void 0:w.KHR_interactivity;if(!G)return;const P=new aG.b({ZE:E});P.dispatchEventsSynchronously=!1;const h=G.graphs.map((w=>new sG(w,this._loader.fh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(h.map((async w=>await qG(w,{coordinator:P,pathConverter:this._pathConverter})))),P.start()}}var pG;pG=async()=>(await Promise.resolve().then(G.bind(G,13333))).FlowGraphGLTFDataProvider,QG[`${FG}/${"FlowGraphGLTFDataProvider"}`]=pG,M(FG),F(FG,!0,(w=>new MG(w)));const DG="KHR_node_visibility";(0,p.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:w=>{const E=w._babylonTransformNode;return!E||void 0===E.isVisible||E.isVisible},set:(w,E)=>{var G,P;null===(G=E._primitiveBabylonMeshes)||void 0===G||G.forEach((w=>{w.inheritVisibility=!0})),E._babylonTransformNode&&(E._babylonTransformNode.isVisible=w),null===(P=E._primitiveBabylonMeshes)||void 0===P||P.forEach((E=>{E.isVisible=w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class eG{constructor(w){this.name=DG,this._loader=w,this.enabled=w.isExtensionUsed(DG)}async onReady(){var w;null===(w=this._loader.fh.nodes)||void 0===w||w.forEach((w=>{var E,G,P,h;(null===(E=w._primitiveBabylonMeshes)||void 0===E||E.forEach((w=>{w.inheritVisibility=!0})),null!==(G=w.extensions)&&void 0!==G&&G.KHR_node_visibility)&&(!1===(null===(P=w.extensions)||void 0===P?void 0:P.KHR_node_visibility.visible)&&(w._babylonTransformNode&&(w._babylonTransformNode.isVisible=!1),null===(h=w._primitiveBabylonMeshes)||void 0===h||h.forEach((w=>{w.isVisible=!1}))))}))}dispose(){this._loader=null}}M(DG),F(DG,!0,(w=>new eG(w)));const RG="KHR_node_selectability";gG("event/onSelect",RG,{ti:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qG:"FlowGraphGetVariableBlock",dataTransformer:w=>["pickedMesh_"+w[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",qG:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,E,G,P,h,B,y){var x,U,l,i,O,u;const V=h[h.length-1];V.config=V.config||{},V.config.glTF=y;const a=null===(x=w.configuration)||void 0===x||null===(U=x.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const Q="pickedMesh_"+a;return h[1].config.variable=Q,B._userVariables[Q]={className:"Mesh",id:null===y||void 0===y||null===(l=y.nodes)||void 0===l||null===(i=l[a]._babylonTransformNode)||void 0===i?void 0:i.id,uniqueId:null===y||void 0===y||null===(O=y.nodes)||void 0===O||null===(u=O[a]._babylonTransformNode)||void 0===u?void 0:u.uniqueId},h}}),(0,p.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:w=>{const E=w._babylonTransformNode;return!E||void 0===E.mU||E.mU},set:(w,E)=>{var G;null===(G=E._primitiveBabylonMeshes)||void 0===G||G.forEach((E=>{E.mU=w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"mU"],type:"boolean"});class HG{constructor(w){this.name=RG,this._loader=w,this.enabled=w.isExtensionUsed(RG)}async onReady(){var w;null===(w=this._loader.fh.nodes)||void 0===w||w.forEach((w=>{var E,G,P;null!==(E=w.extensions)&&void 0!==E&&E.KHR_node_selectability&&!1===(null===(G=w.extensions)||void 0===G?void 0:G.KHR_node_selectability.selectable)&&(null===(P=w._babylonTransformNode)||void 0===P||P.getChildMeshes().forEach((w=>{w.mU=!1})))}))}dispose(){this._loader=null}}M(RG),F(RG,!0,(w=>new HG(w)));const zG="KHR_node_hoverability",LG="targetMeshPointerOver_";gG("event/onHoverIn",zG,{ti:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qG:"FlowGraphGetVariableBlock",dataTransformer:w=>[LG+w[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",qG:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,E,G,P,h,B,y){var x,U,l,i,O,u;const V=h[h.length-1];V.config=V.config||{},V.config.glTF=y;const a=null===(x=w.configuration)||void 0===x||null===(U=x.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const Q=LG+a;return h[1].config.variable=Q,B._userVariables[Q]={className:"Mesh",id:null===y||void 0===y||null===(l=y.nodes)||void 0===l||null===(i=l[a]._babylonTransformNode)||void 0===i?void 0:i.id,uniqueId:null===y||void 0===y||null===(O=y.nodes)||void 0===O||null===(u=O[a]._babylonTransformNode)||void 0===u?void 0:u.uniqueId},h}});const mG="targetMeshPointerOut_";gG("event/onHoverOut",zG,{ti:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qG:"FlowGraphGetVariableBlock",dataTransformer:w=>[mG+w[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",qG:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,E,G,P,h,B,y){var x,U,l,i,O,u;const V=h[h.length-1];V.config=V.config||{},V.config.glTF=y;const a=null===(x=w.configuration)||void 0===x||null===(U=x.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===a||"number"!==typeof a)throw new Error("nodeIndex not found in configuration");const Q=mG+a;return h[1].config.variable=Q,B._userVariables[Q]={className:"Mesh",id:null===y||void 0===y||null===(l=y.nodes)||void 0===l||null===(i=l[a]._babylonTransformNode)||void 0===i?void 0:i.id,uniqueId:null===y||void 0===y||null===(O=y.nodes)||void 0===O||null===(u=O[a]._babylonTransformNode)||void 0===u?void 0:u.uniqueId},h}}),(0,p.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:w=>{const E=w._babylonTransformNode;return!E||void 0===E.pointerOverDisableMeshTesting||E.pointerOverDisableMeshTesting},set:(w,E)=>{var G;null===(G=E._primitiveBabylonMeshes)||void 0===G||G.forEach((E=>{E.pointerOverDisableMeshTesting=!w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class nG{constructor(w){this.name=zG,this._loader=w,this.enabled=w.isExtensionUsed(zG)}async onReady(){var w;null===(w=this._loader.fh.nodes)||void 0===w||w.forEach((w=>{var E,G,P;null!==(E=w.extensions)&&void 0!==E&&E.KHR_node_hoverability&&!1===(null===(G=w.extensions)||void 0===G?void 0:G.KHR_node_hoverability.hoverable)&&(null===(P=w._babylonTransformNode)||void 0===P||P.getChildMeshes().forEach((w=>{w.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}M(zG),F(zG,!0,(w=>new nG(w)));const rG="ExtrasAsMetadata";class YG{_assignExtras(w,E){if(E.extras&&Object.keys(E.extras).length>0){const G=w.metadata=w.metadata||{};(G.fh=G.fh||{}).extras=E.extras}}constructor(w){this.name=rG,this.enabled=!0,this._loader=w}dispose(){this._loader=null}loadNodeAsync(w,E,G){return this._loader.loadNodeAsync(w,E,(w=>{this._assignExtras(w,E),G(w)}))}loadCameraAsync(w,E,G){return this._loader.loadCameraAsync(w,E,(w=>{this._assignExtras(w,E),G(w)}))}createMaterial(w,E,G){const P=this._loader.createMaterial(w,E,G);return this._assignExtras(P,E),P}}M(rG),F(rG,!1,(w=>new YG(w)));G(13333)},13227:(w,E,G)=>{"use strict";G.d(E,{e:()=>N,g:()=>I,h:()=>T,k:()=>j});var P=G(11504),h=G(11498),B=G(12873),y=G(12103),x=G(12079),U=G(12087),l=G(11518),i=G(11543),O=G(12098),u=G(12194),V=G(12110),a=G(11712);class Q{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Pu=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Mu=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(w){this._environmentTexture=w}getNodes(){let w=[];w=w.concat(this.meshes),w=w.concat(this.lights),w=w.concat(this.cameras),w=w.concat(this.transformNodes);for(const E of this.skeletons)w=w.concat(E.bones);return w}}class c extends Q{}class Z{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const w=this.rootNodes;for(const P of w)P.dispose();w.length=0;const E=this.skeletons;for(const P of E)P.dispose();E.length=0;const G=this.animationGroups;for(const P of G)P.dispose();G.length=0}}class J extends Q{constructor(w){super(),this._wasAddedToScene=!1,(w=w||i.e.LastCreatedScene)&&(this.ZE=w,this.proceduralTextures=[],w.qh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=w.getEngine().onContextRestoredObservable.add((()=>{for(const w of this.geometries)w._rebuild();for(const w of this.meshes)w._rebuild();for(const w of this.Pu)w.rebuild();for(const w of this.textures)w._rebuild()})))}_topologicalSort(w){const E=new Map;for(const y of w)E.set(y.uniqueId,y);const G={dependsOn:new Map,dependedBy:new Map};for(const y of w){const w=y.uniqueId;G.dependsOn.set(w,new Set),G.dependedBy.set(w,new Set)}for(const y of w){const w=y.uniqueId,P=G.dependsOn.get(w);if(y instanceof O.b){const h=y.sourceMesh;E.has(h.uniqueId)&&(P.add(h.uniqueId),G.dependedBy.get(h.uniqueId).add(w))}const h=G.dependedBy.get(w);for(const B of y.getDescendants()){const P=B.uniqueId;if(E.has(P)){h.add(P);G.dependsOn.get(P).add(w)}}}const P=[],h=[];for(const y of w){const w=y.uniqueId;0===G.dependsOn.get(w).size&&(h.push(y),E.delete(w))}const B=h;for(;B.length>0;){const w=B.shift();P.push(w);const h=G.dependedBy.get(w.uniqueId);for(const P of Array.from(h.values())){const h=G.dependsOn.get(P);h.delete(w.uniqueId),0===h.size&&E.get(P)&&(B.push(E.get(P)),E.delete(P))}}return E.size>0&&(l.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),E.forEach((w=>{l.e.Error(w.name)}))),P}_addNodeAndDescendantsToList(w,E,G,P){if(G&&(!P||P(G))&&!E.has(G.uniqueId)){w.push(G),E.add(G.uniqueId);for(const h of G.getDescendants(!0))this._addNodeAndDescendantsToList(w,E,h,P)}}_isNodeInContainer(w){return w instanceof U.b&&-1!==this.meshes.indexOf(w)||(w instanceof x.e&&-1!==this.transformNodes.indexOf(w)||(w instanceof u.e&&-1!==this.lights.indexOf(w)||w instanceof V.c&&-1!==this.cameras.indexOf(w)))}_isValidHierarchy(){for(const w of this.meshes)if(w.parent&&!this._isNodeInContainer(w.parent))return l.e.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.transformNodes)if(w.parent&&!this._isNodeInContainer(w.parent))return l.e.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.lights)if(w.parent&&!this._isNodeInContainer(w.parent))return l.e.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.cameras)if(w.parent&&!this._isNodeInContainer(w.parent))return l.e.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const P={},B={},x=new Z,U=[],l=[],i={doNotInstantiate:!0,...G},O=[],u=new Set;for(const h of this.transformNodes)null===h.parent&&this._addNodeAndDescendantsToList(O,u,h,i.predicate);for(const h of this.meshes)null===h.parent&&this._addNodeAndDescendantsToList(O,u,h,i.predicate);const V=this._topologicalSort(O),a=(G,h)=>{if(((E,G)=>{if(P[E.uniqueId]=G.uniqueId,B[G.uniqueId]=G,w&&(G.name=w(E.name)),G instanceof y.c){const w=G;if(w.morphTargetManager){const G=E.morphTargetManager;w.morphTargetManager=G.clone();for(let E=0;E<G.numTargets;E++){const h=G.getTarget(E),y=w.morphTargetManager.getTarget(E);P[h.uniqueId]=y.uniqueId,B[y.uniqueId]=y}}}})(G,h),G.parent){const w=P[G.parent.uniqueId],E=B[w];h.parent=E||G.parent}if(h.position&&G.position&&h.position.B(G.position),h.rotationQuaternion&&G.rotationQuaternion&&h.rotationQuaternion.B(G.rotationQuaternion),h.rotation&&G.rotation&&h.rotation.B(G.rotation),h.qx&&G.qx&&h.qx.B(G.qx),h.material){const y=h;if(y.material)if(E){const E=G.material;if(-1===l.indexOf(E)){let G=E.clone(w?w(E.name):"Clone of "+E.name);if(l.push(E),P[E.uniqueId]=G.uniqueId,B[G.uniqueId]=G,"MultiMaterial"===E.getClassName()){const h=E;for(const E of h.Ix)E&&(G=E.clone(w?w(E.name):"Clone of "+E.name),l.push(E),P[E.uniqueId]=G.uniqueId,B[G.uniqueId]=G);h.Ix=h.Ix.map((w=>w&&B[P[w.uniqueId]]))}}"InstancedMesh"!==y.getClassName()&&(y.material=B[P[E.uniqueId]])}else"MultiMaterial"===y.material.getClassName()?-1===this.ZE.multiMaterials.indexOf(y.material)&&this.ZE.addMultiMaterial(y.material):-1===this.ZE.materials.indexOf(y.material)&&this.ZE.addMaterial(y.material)}null===h.parent&&x.rootNodes.push(h)};for(const h of V)if("InstancedMesh"===h.getClassName()){const w=h,E=w.sourceMesh,G=P[E.uniqueId];a(w,("number"===typeof G?B[G]:E).createInstance(w.name))}else{let w=!0;"ua"===h.getClassName()||"Node"===h.getClassName()||h.skeleton||!h.getTotalVertices||0===h.getTotalVertices()?w=!1:i.doNotInstantiate&&(w="function"===typeof i.doNotInstantiate?!i.doNotInstantiate(h):!i.doNotInstantiate);const E=w?h.createInstance(`instance of ${h.name}`):h.clone(`Clone of ${h.name}`,null,!0);if(!E)throw new Error(`Could not clone or instantiate node on Asset Container ${h.name}`);a(h,E)}for(const h of this.skeletons){if(i.predicate&&!i.predicate(h))continue;const E=h.clone(w?w(h.name):"Clone of "+h.name);for(const w of this.meshes)if(w.skeleton===h&&!w.isAnInstance){const G=B[P[w.uniqueId]];if(!G||G.isAnInstance)continue;if(G.skeleton=E,-1!==U.indexOf(E))continue;U.push(E);for(const w of E.bones)w._linkedTransformNode&&(w._linkedTransformNode=B[P[w._linkedTransformNode.uniqueId]])}x.skeletons.push(E)}for(const h of this.animationGroups){if(i.predicate&&!i.predicate(h))continue;const E=h.clone(w?w(h.name):"Clone of "+h.name,(w=>B[P[w.uniqueId]]||w));x.animationGroups.push(E)}return x}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ZE.environmentTexture=this.environmentTexture);for(const w of this.ZE._serializableComponents)w.addFromContainer(this);this.ZE.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=[];for(const G of this.cameras)w&&!w(G)||(this.ZE.addCamera(G),E.push(G));for(const G of this.lights)w&&!w(G)||(this.ZE.addLight(G),E.push(G));for(const G of this.meshes)w&&!w(G)||(this.ZE.li(G),E.push(G));for(const G of this.skeletons)w&&!w(G)||this.ZE.addSkeleton(G);for(const G of this.animations)w&&!w(G)||this.ZE.addAnimation(G);for(const G of this.animationGroups)w&&!w(G)||this.ZE.addAnimationGroup(G);for(const G of this.multiMaterials)w&&!w(G)||this.ZE.addMultiMaterial(G);for(const G of this.materials)w&&!w(G)||this.ZE.addMaterial(G);for(const G of this.morphTargetManagers)w&&!w(G)||this.ZE.addMorphTargetManager(G);for(const G of this.geometries)w&&!w(G)||this.ZE.addGeometry(G);for(const G of this.transformNodes)w&&!w(G)||(this.ZE.addTransformNode(G),E.push(G));for(const G of this.actionManagers)w&&!w(G)||this.ZE.addActionManager(G);for(const G of this.textures)w&&!w(G)||this.ZE.addTexture(G);for(const G of this.reflectionProbes)w&&!w(G)||this.ZE.addReflectionProbe(G);for(const G of E)G.parent&&-1===this.ZE.getNodes().indexOf(G.parent)&&(G.setParent?G.setParent(null):G.parent=null)}removeAllFromScene(){this._isValidHierarchy()||h.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ZE.environmentTexture&&(this.ZE.environmentTexture=null);for(const w of this.ZE._serializableComponents)w.removeFromContainer(this)}removeFromScene(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const E of this.cameras)w&&!w(E)||this.ZE.removeCamera(E);for(const E of this.lights)w&&!w(E)||this.ZE.removeLight(E);for(const E of this.meshes)w&&!w(E)||this.ZE.Ui(E,!0);for(const E of this.skeletons)w&&!w(E)||this.ZE.removeSkeleton(E);for(const E of this.animations)w&&!w(E)||this.ZE.removeAnimation(E);for(const E of this.animationGroups)w&&!w(E)||this.ZE.removeAnimationGroup(E);for(const E of this.multiMaterials)w&&!w(E)||this.ZE.removeMultiMaterial(E);for(const E of this.materials)w&&!w(E)||this.ZE.removeMaterial(E);for(const E of this.morphTargetManagers)w&&!w(E)||this.ZE.removeMorphTargetManager(E);for(const E of this.geometries)w&&!w(E)||this.ZE.removeGeometry(E);for(const E of this.transformNodes)w&&!w(E)||this.ZE.removeTransformNode(E);for(const E of this.actionManagers)w&&!w(E)||this.ZE.removeActionManager(E);for(const E of this.textures)w&&!w(E)||this.ZE.removeTexture(E);for(const E of this.reflectionProbes)w&&!w(E)||this.ZE.removeReflectionProbe(E)}dispose(){const w=this.cameras.slice(0);for(const V of w)V.dispose();this.cameras.length=0;const E=this.lights.slice(0);for(const V of E)V.dispose();this.lights.length=0;const G=this.meshes.slice(0);for(const V of G)V.dispose();this.meshes.length=0;const P=this.skeletons.slice(0);for(const V of P)V.dispose();this.skeletons.length=0;const h=this.animationGroups.slice(0);for(const V of h)V.dispose();this.animationGroups.length=0;const B=this.multiMaterials.slice(0);for(const V of B)V.dispose();this.multiMaterials.length=0;const y=this.materials.slice(0);for(const V of y)V.dispose();this.materials.length=0;const x=this.geometries.slice(0);for(const V of x)V.dispose();this.geometries.length=0;const U=this.transformNodes.slice(0);for(const V of U)V.dispose();this.transformNodes.length=0;const l=this.actionManagers.slice(0);for(const V of l)V.dispose();this.actionManagers.length=0;const i=this.textures.slice(0);for(const V of i)V.dispose();this.textures.length=0;const O=this.reflectionProbes.slice(0);for(const V of O)V.dispose();this.reflectionProbes.length=0;const u=this.morphTargetManagers.slice(0);for(const V of u)V.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const V of this.ZE._serializableComponents)V.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ZE.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(w,E,G){if(w&&E)for(const P of w){let w=!0;if(G)for(const E of G)if(P===E){w=!1;break}w&&(E.push(P),P._parentContainer=this)}}moveAllFromScene(w){this._wasAddedToScene=!1,void 0===w&&(w=new c);for(const E in this)Object.prototype.hasOwnProperty.call(this,E)&&(this[E]=this[E]||("_environmentTexture"===E?null:[]),this._moveAssets(this.ZE[E],this[E],w[E]));this.environmentTexture=this.ZE.environmentTexture,this.removeAllFromScene()}createRootMesh(){const w=new y.c("assetContainerRootMesh",this.ZE);for(const E of this.meshes)E.parent||w.addChild(E);return this.meshes.unshift(w),w}mergeAnimationsTo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.e.LastCreatedScene,E=arguments.length>1?arguments[1]:void 0,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!w)return l.e.Error("No scene available to merge animations to"),[];const P=G||(E=>{let G=null;const P=E.animations.length?E.animations[0].targetProperty:"",h=E.name.split(".").join("").split("_primitive")[0];switch(P){case"position":case"rotationQuaternion":G=w.getTransformNodeByName(E.name)||w.getTransformNodeByName(h);break;case"influence":G=w.getMorphTargetByName(E.name)||w.getMorphTargetByName(h);break;default:G=w.getNodeByName(E.name)||w.getNodeByName(h)}return G}),h=this.getNodes();for(const x of h){const w=P(x);if(null!==w){for(const E of x.animations){const G=w.animations.filter((w=>w.targetProperty===E.targetProperty));for(const E of G){const G=w.animations.indexOf(E,0);G>-1&&w.animations.splice(G,1)}}w.animations=w.animations.concat(x.animations)}}const B=[],y=this.animationGroups.slice();for(const x of y){B.push(x.clone(x.name,P));for(const w of x.animatables)w.stop()}for(const x of E){const E=P(x.target);E&&(w.beginAnimation(E,x.fromFrame,x.toFrame,x.loopAnimation,x.speedRatio,x.onAnimationEnd?x.onAnimationEnd:void 0,void 0,!0,void 0,x.onAnimationLoop?x.onAnimationLoop:void 0),w.stopAnimation(x.target))}return B}populateRootNodes(){this.rootNodes.length=0;for(const w of this.meshes)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.transformNodes)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.lights)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.cameras)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w)}addAllAssetsToContainer(w){if(!w)return;const E=[],G=new Set;for(E.push(w);E.length>0;){const w=E.pop();if(w instanceof y.c?(w.py&&-1===this.geometries.indexOf(w.py)&&this.geometries.push(w.py),this.meshes.push(w)):w instanceof O.b?this.meshes.push(w):w instanceof x.e?this.transformNodes.push(w):w instanceof u.e?this.lights.push(w):w instanceof V.c&&this.cameras.push(w),w instanceof U.b){if(w.material&&-1===this.materials.indexOf(w.material)){this.materials.push(w.material);for(const E of w.material.getActiveTextures())-1===this.textures.indexOf(E)&&this.textures.push(E)}w.skeleton&&-1===this.skeletons.indexOf(w.skeleton)&&this.skeletons.push(w.skeleton),w.morphTargetManager&&-1===this.morphTargetManagers.indexOf(w.morphTargetManager)&&this.morphTargetManagers.push(w.morphTargetManager)}for(const P of w.getChildren())G.has(P)||E.push(P);G.add(w)}this.populateRootNodes()}_getByTags(w,E,G){if(void 0===E)return w;const P=[];for(const h in w){const B=w[h];a.e&&a.e.MatchesQuery(B,E)&&(!G||G(B))&&P.push(B)}return P}getMeshesByTags(w,E){return this._getByTags(this.meshes,w,E)}getCamerasByTags(w,E){return this._getByTags(this.cameras,w,E)}getLightsByTags(w,E){return this._getByTags(this.lights,w,E)}getMaterialsByTags(w,E){return this._getByTags(this.materials,w,E).concat(this._getByTags(this.multiMaterials,w,E))}getTransformNodesByTags(w,E){return this._getByTags(this.transformNodes,w,E)}}var d=G(11558);class K{constructor(w){this.byteOffset=0,this.buffer=w}async loadAsync(w){const E=await this.buffer.readAsync(this.byteOffset,w);this._dataView=new DataView(E.buffer,E.byteOffset,E.byteLength),this._dataByteOffset=0}readUint32(){const w=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,w}readUint8Array(w){const E=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,w);return this._dataByteOffset+=w,this.byteOffset+=w,E}readString(w){return(0,d.d)(this.readUint8Array(w))}skipBytes(w){this._dataByteOffset+=w,this.byteOffset+=w}}var t=G(13229);const q="Z2xURg",W={name:"fh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:w=>-1!==w.indexOf("asset")&&-1!==w.indexOf("version")||w.startsWith("data:base64,"+q)||w.startsWith("data:;base64,"+q)||w.startsWith("data:application/octet-stream;base64,"+q)||w.startsWith("data:model/gltf-binary;base64,"+q)};var T,I,j,g=G(11547),o=G(11555);function f(w,E,G){try{return Promise.resolve(new Uint8Array(w,E,G))}catch(P){return Promise.reject(P)}}!function(w){w[w.AUTO=0]="AUTO",w[w.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(T||(T={})),function(w){w[w.NONE=0]="NONE",w[w.FIRST=1]="FIRST",w[w.ALL=2]="ALL"}(I||(I={})),function(w){w[w.LOADING=0]="LOADING",w[w.READY=1]="READY",w[w.COMPLETE=2]="COMPLETE"}(j||(j={}));class k{constructor(){this.coordinateSystemMode=T.AUTO,this.animationStartMode=I.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=w=>Promise.resolve(w),this.extensionOptions={}}B(w){w&&(this.onParsed=w.onParsed,this.coordinateSystemMode=w.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=w.animationStartMode??this.animationStartMode,this.loadNodeAnimations=w.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=w.loadSkins??this.loadSkins,this.loadMorphTargets=w.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=w.compileMaterials??this.compileMaterials,this.useClipPlane=w.useClipPlane??this.useClipPlane,this.compileShadowGenerators=w.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=w.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=w.useRangeRequests??this.useRangeRequests,this.createInstances=w.createInstances??this.createInstances,this.alwaysComputeBoundingBox=w.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=w.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=w.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=w.skipMaterials??this.skipMaterials,this.useSRGBBuffers=w.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=w.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=w.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=w.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=w.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=w.customRootNode,this.onMeshLoaded=w.onMeshLoaded,this.onSkinLoaded=w.onSkinLoaded,this.onTextureLoaded=w.onTextureLoaded,this.onMaterialLoaded=w.onMaterialLoaded,this.onCameraLoaded=w.onCameraLoaded,this.extensionOptions=w.extensionOptions??this.extensionOptions)}}class N extends k{constructor(w){super(),this.onParsedObservable=new P.d,this.onMeshLoadedObservable=new P.d,this.onSkinLoadedObservable=new P.d,this.onTextureLoadedObservable=new P.d,this.onMaterialLoadedObservable=new P.d,this.onCameraLoadedObservable=new P.d,this.onCompleteObservable=new P.d,this.onErrorObservable=new P.d,this.qh=new P.d,this.onExtensionLoadedObservable=new P.d,this.validate=!1,this.onValidatedObservable=new P.d,this._loader=null,this._state=null,this._requests=new Array,this.name=W.name,this.extensions=W.extensions,this.onLoaderStateChangedObservable=new P.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.B(w)}set onParsed(w){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),w&&(this._onParsedObserver=this.onParsedObservable.add(w))}set onMeshLoaded(w){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),w&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(w))}set onSkinLoaded(w){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),w&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((E=>w(E.node,E.skinnedNode))))}set onTextureLoaded(w){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),w&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(w))}set onMaterialLoaded(w){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),w&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(w))}set onCameraLoaded(w){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),w&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(w))}set onComplete(w){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(w)}set onError(w){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(w)}set onDispose(w){this._onDisposeObserver&&this.qh.remove(this._onDisposeObserver),this._onDisposeObserver=this.qh.add(w)}set onExtensionLoaded(w){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(w)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(w){this._loggingEnabled!==w&&(this._loggingEnabled=w,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(w){this._capturePerformanceCounters!==w&&(this._capturePerformanceCounters=w,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(w){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(w)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const w of this._requests)w.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=w=>Promise.resolve(w),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.qh.notifyObservers(void 0),this.qh.clear()}loadFile(w,E,G,B,y,x,U,i){if(ArrayBuffer.isView(E))return this._loadBinary(w,E,G,B,U,i),null;this._progressCallback=y;const O=E.name||h.Tools.GetFilename(E);if(x){if(this.useRangeRequests){this.validate&&l.e.Warn("glTF validation is not supported when range requests are enabled");const G={abort:()=>{},onCompleteObservable:new P.d},h={readAsync:(G,P)=>new Promise(((h,B)=>{this._loadFile(w,E,(w=>{h(new Uint8Array(w))}),!0,(w=>{B(w)}),(w=>{w.setRequestHeader("Range",`bytes=${G}-${G+P-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new K(h)).then((w=>{G.onCompleteObservable.notifyObservers(G),B(w)}),U?w=>U(void 0,w):void 0),G}return this._loadFile(w,E,(E=>{this._validate(w,new Uint8Array(E,0,E.byteLength),G,O),this._unpackBinaryAsync(new K({readAsync:(w,G)=>f(E,w,G),byteLength:E.byteLength})).then((w=>{B(w)}),U?w=>U(void 0,w):void 0)}),!0,U)}return this._loadFile(w,E,(E=>{try{this._validate(w,E,G,O),B({json:this._parseJson(E)})}catch{U&&U()}}),!1,U)}_loadBinary(w,E,G,P,h,B){this._validate(w,new Uint8Array(E.buffer,E.byteOffset,E.byteLength),G,B),this._unpackBinaryAsync(new K({readAsync:(w,G)=>function(w,E,G){try{if(E<0||E>=w.byteLength)throw new RangeError("Offset is out of range.");if(E+G>w.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(w.buffer,w.byteOffset+E,G))}catch(P){return Promise.reject(P)}}(E,w,G),byteLength:E.byteLength})).then((w=>{P(w)}),h?w=>h(void 0,w):void 0)}importMeshAsync(w,E,G,P,h,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(G),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(G),this._loader.importMeshAsync(w,E,null,G,P,h,B))))}loadAsync(w,E,G,P,h){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(E),this._loader.loadAsync(w,E,G,P,h))))}loadAssetContainerAsync(w,E,G,P,h){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(E);const B=new J(w),y=[];this.onMaterialLoadedObservable.add((w=>{y.push(w)}));const x=[];this.onTextureLoadedObservable.add((w=>{x.push(w)}));const U=[];this.onCameraLoadedObservable.add((w=>{U.push(w)}));const l=[];return this.onMeshLoadedObservable.add((w=>{w.morphTargetManager&&l.push(w.morphTargetManager)})),this._loader.importMeshAsync(null,w,B,E,G,P,h).then((w=>(Array.prototype.push.apply(B.geometries,w.geometries),Array.prototype.push.apply(B.meshes,w.meshes),Array.prototype.push.apply(B.Pu,w.Pu),Array.prototype.push.apply(B.skeletons,w.skeletons),Array.prototype.push.apply(B.animationGroups,w.animationGroups),Array.prototype.push.apply(B.materials,y),Array.prototype.push.apply(B.textures,x),Array.prototype.push.apply(B.lights,w.lights),Array.prototype.push.apply(B.transformNodes,w.transformNodes),Array.prototype.push.apply(B.cameras,U),Array.prototype.push.apply(B.morphTargetManagers,l),B)))}))}canDirectLoad(w){return W.canDirectLoad(w)}directLoad(w,E){if(E.startsWith("base64,"+q)||E.startsWith(";base64,"+q)||E.startsWith("application/octet-stream;base64,"+q)||E.startsWith("model/gltf-binary;base64,"+q)){const G=(0,g.b)(E);return this._validate(w,new Uint8Array(G,0,G.byteLength)),this._unpackBinaryAsync(new K({readAsync:(w,E)=>f(G,w,E),byteLength:G.byteLength}))}return this._validate(w,E),Promise.resolve({json:this._parseJson(E)})}createPlugin(w){return new N(w[W.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((w,E)=>{this.onCompleteObservable.addOnce((()=>{w()})),this.onErrorObservable.addOnce((w=>{E(w)}))}))}_setState(w){this._state!==w&&(this._state=w,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(j[this._state]))}_loadFile(w,E,G,P,h,B){const y=w._loadFile(E,G,(w=>{this._onProgress(w,y)}),!0,P,h,B);return y.onCompleteObservable.add((()=>{y._lengthComputable=!0,y._total=y._loaded})),this._requests.push(y),y}_onProgress(w,E){if(!this._progressCallback)return;E._lengthComputable=w.lengthComputable,E._loaded=w.loaded,E._total=w.total;let G=!0,P=0,h=0;for(const B of this._requests){if(void 0===B._lengthComputable||void 0===B._loaded||void 0===B._total)return;G=G&&B._lengthComputable,P+=B._loaded,h+=B._total}this._progressCallback({lengthComputable:G,loaded:P,total:G?h:0})}_validate(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),t.e.ValidateAsync(E,G,P,(E=>this.preprocessUrlAsync(G+E).then((E=>w._loadFileAsync(E,void 0,!0,!0).then((w=>new Uint8Array(w,0,w.byteLength))))))).then((w=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(w),this.onValidatedObservable.clear()}),(w=>{this._endPerformanceCounter("Validate JSON"),h.Tools.Warn(`Failed to validate: ${w.message}`),this.onValidatedObservable.clear()})))}_getLoader(w){const E=w.json.asset||{};this._log(`Asset version: ${E.version}`),E.minVersion&&this._log(`Asset minimum version: ${E.minVersion}`),E.generator&&this._log(`Asset generator: ${E.generator}`);const G=N._parseVersion(E.version);if(!G)throw new Error("Invalid version: "+E.version);if(void 0!==E.minVersion){const w=N._parseVersion(E.minVersion);if(!w)throw new Error("Invalid minimum version: "+E.minVersion);if(N._compareVersion(w,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+E.minVersion)}const P={1:N._CreateGLTF1Loader,2:N._CreateGLTF2Loader}[G.major];if(!P)throw new Error("Unsupported version: "+E.version);return P(this)}_parseJson(w){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${w.length}`);const E=JSON.parse(w);return this._endPerformanceCounter("Parse JSON"),E}_unpackBinaryAsync(w){return this._startPerformanceCounter("Unpack Binary"),w.loadAsync(20).then((()=>{const E=w.readUint32();if(1179937895!==E)throw new o.i("Unexpected magic: "+E,o.e.GLTFLoaderUnexpectedMagicError);const G=w.readUint32();this.loggingEnabled&&this._log(`Binary version: ${G}`);const P=w.readUint32();let h;switch(this.useRangeRequests||P===w.buffer.byteLength||l.e.Warn(`Length in header does not match actual data length: ${P} != ${w.buffer.byteLength}`),G){case 1:h=this._unpackBinaryV1Async(w,P);break;case 2:h=this._unpackBinaryV2Async(w,P);break;default:throw new Error("Unsupported version: "+G)}return this._endPerformanceCounter("Unpack Binary"),h}))}_unpackBinaryV1Async(w,E){const G=w.readUint32(),P=w.readUint32();if(0!==P)throw new Error(`Unexpected content format: ${P}`);const h=E-w.byteOffset,B={json:this._parseJson(w.readString(G)),bin:null};if(0!==h){const E=w.byteOffset;B.bin={readAsync:(G,P)=>w.buffer.readAsync(E+G,P),byteLength:h}}return Promise.resolve(B)}_unpackBinaryV2Async(w,E){const G=1313821514,P=5130562,h=w.readUint32();if(w.readUint32()!==G)throw new Error("First chunk format is not JSON");return w.byteOffset+h===E?w.loadAsync(h).then((()=>({json:this._parseJson(w.readString(h)),bin:null}))):w.loadAsync(h+8).then((()=>{const B={json:this._parseJson(w.readString(h)),bin:null},y=()=>{const h=w.readUint32();switch(w.readUint32()){case G:throw new Error("Unexpected JSON chunk");case P:{const E=w.byteOffset;B.bin={readAsync:(G,P)=>w.buffer.readAsync(E+G,P),byteLength:h},w.skipBytes(h);break}default:w.skipBytes(h)}return w.byteOffset!==E?w.loadAsync(8).then(y):Promise.resolve(B)};return y()}))}static _parseVersion(w){if("1.0"===w||"1.0.1"===w)return{major:1,minor:0};const E=(w+"").match(/^(\d+)\.(\d+)/);return E?{major:parseInt(E[1]),minor:parseInt(E[2])}:null}static _compareVersion(w,E){return w.major>E.major?1:w.major<E.major?-1:w.minor>E.minor?1:w.minor<E.minor?-1:0}_logOpen(w){this._log(w),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(w){const E=N._logSpaces.substring(0,2*this._logIndentLevel);l.e.Log(`${E}${w}`)}_logDisabled(w){}_startPerformanceCounterEnabled(w){h.Tools.StartPerformanceCounter(w)}_startPerformanceCounterDisabled(w){}_endPerformanceCounterEnabled(w){h.Tools.EndPerformanceCounter(w)}_endPerformanceCounterDisabled(w){}}N.IncrementalLoading=!0,N.HomogeneousCoordinates=!1,N._logSpaces="                                ",(0,B.c)(new N)},13229:(w,E,G)=>{"use strict";G.d(E,{e:()=>y});var P=G(11498);function h(w,E,G,P){const h={externalResourceFunction:P};return G&&(h.uri="file:"===E?G:E+G),ArrayBuffer.isView(w)?GLTFValidator.validateBytes(w,h):GLTFValidator.validateString(w,h)}function B(){const w=[];onmessage=E=>{const G=E.data;switch(G.id){case"init":importScripts(G.url);break;case"validate":h(G.data,G.rootUrl,G.fileName,(E=>new Promise(((G,P)=>{const h=w.length;w.push({resolve:G,reject:P}),postMessage({id:"getExternalResource",index:h,uri:E})})))).then((w=>{postMessage({id:"validate.resolve",value:w})}),(w=>{postMessage({id:"validate.reject",reason:w})}));break;case"getExternalResource.resolve":w[G.index].resolve(G.value);break;case"getExternalResource.reject":w[G.index].reject(G.reason)}}}class y{static ValidateAsync(w,E,G,y){return"function"===typeof Worker?new Promise(((x,U)=>{const l=`${h}(${B})()`,i=URL.createObjectURL(new Blob([l],{type:"application/javascript"})),O=new Worker(i),u=w=>{O.removeEventListener("error",u),O.removeEventListener("message",V),U(w)},V=w=>{const E=w.data;switch(E.id){case"getExternalResource":y(E.uri).then((w=>{O.postMessage({id:"getExternalResource.resolve",index:E.index,value:w},[w.buffer])}),(w=>{O.postMessage({id:"getExternalResource.reject",index:E.index,reason:w})}));break;case"validate.resolve":O.removeEventListener("error",u),O.removeEventListener("message",V),x(E.value),O.terminate();break;case"validate.reject":O.removeEventListener("error",u),O.removeEventListener("message",V),U(E.reason),O.terminate()}};if(O.addEventListener("error",u),O.addEventListener("message",V),O.postMessage({id:"init",url:P.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(w)){const P=w.slice();O.postMessage({id:"validate",data:P,rootUrl:E,fileName:G},[P.buffer])}else O.postMessage({id:"validate",data:w,rootUrl:E,fileName:G})})):(this._LoadScriptPromise||(this._LoadScriptPromise=P.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>h(w,E,G,y))))}}y.Configuration={url:`${P.Tools._DefaultCdnUrl}/gltf_validator.js`}},13746:(w,E,G)=>{"use strict";G.d(E,{c:()=>W});var P=G(11668),h=G(11671),B=G(11706),y=G(11679),x=G(12044),U=G(11979),l=G(11748),i=G(11908),O=G(11646),u=G(11595);G(12993),G(12905),G(12921),G(12913),G(12923),G(12925),G(12933);const V="imageProcessingCompatibility",a="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";u.b.IncludesShadersStore[V]||(u.b.IncludesShadersStore[V]=a);const Q="skyPixelShader",c="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";u.b.ShadersStore[Q]||(u.b.ShadersStore[Q]=c);G(13005),G(12937),G(12946),G(12957),G(12953);const Z="skyVertexShader",J="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";u.b.ShadersStore[Z]||(u.b.ShadersStore[Z]=J);var d=G(11973),K=G(12029),t=G(12020);class q extends x.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class W extends U.d{constructor(w,E){super(w,E),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new y.QE(0,100,0),this.useSunPosition=!1,this.cameraOffset=y.QE.Zero(),this.up=y.QE.Up(),this.dithering=!1,this._cameraPosition=y.QE.Zero(),this._skyOrientation=new y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(w,E){const G=E._drawWrapper;if(this.isFrozen&&G.effect&&G._wasPreviouslyReady)return!0;E.materialDefines||(E.materialDefines=new q);const P=E.materialDefines,h=this.Ww();if(this._isReadyForSubMesh(E))return!0;if((0,t.W)(w,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,P),(0,t.M)(w,P,!0,!1),P.IMAGEPROCESSINGPOSTPROCESS!==h.imageProcessingConfiguration.applyByPostProcess&&P.markAsMiscDirty(),P.DITHER!==this.dithering&&P.markAsMiscDirty(),P.isDirty){P.markAsProcessed(),h.resetCachedMaterial();const w=new d.e;P.FOG&&w.addFallback(1,"FOG"),P.IMAGEPROCESSINGPOSTPROCESS=h.imageProcessingConfiguration.applyByPostProcess,P.DITHER=this.dithering;const G=[l.g.PositionKind];P.VERTEXCOLOR&&G.push(l.g.ColorKind);const B="sky",y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,K.b)(y);const x=P.toString();E.setEffect(h.getEngine().createEffect(B,G,y,[],x,w,this.onCompiled,this.onError),P,this._materialContext)}return!(!E.effect||!E.effect.isReady())&&(P._renderId=h.getRenderId(),G._wasPreviouslyReady=!0,!0)}bindForSubMesh(w,E,G){const P=this.Ww(),h=G.materialDefines;if(!h)return;const B=G.effect;if(!B)return;this._activeEffect=B,this.bindOnlyWorldMatrix(w),this._activeEffect.setMatrix("viewProjection",P.getTransformMatrix()),this._mustRebind(P,B,G)&&((0,K.e)(B,this,P),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,t.n)(h,B,P)),P.fogEnabled&&E.applyFog&&P.fogMode!==i.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",P.getViewMatrix()),(0,t.h)(P,E,this._activeEffect);const x=P.activeCamera;if(x){const w=x.getWorldMatrix();this._cameraPosition.x=w.m[12],this._cameraPosition.y=w.m[13],this._cameraPosition.z=w.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const w=Math.PI*(this.inclination-.5),E=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(E)*Math.cos(w),this.sunPosition.y=this.distance*Math.sin(-w),this.sunPosition.z=this.distance*Math.sin(E)*Math.cos(w),y.Quaternion.FromUnitVectorsToRef(y.QE.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(E,this._activeEffect,G)}getAnimatables(){return[]}dispose(w){super.dispose(w)}clone(w){return B.b.Clone((()=>new W(w,this.Ww())),this)}serialize(){const w=super.serialize();return w.customType="BABYLON.SkyMaterial",w}getClassName(){return"SkyMaterial"}static Parse(w,E,G){return B.b.Parse((()=>new W(w.name,E)),w,E,G)}}(0,P.c)([(0,h.F)()],W.prototype,"luminance",void 0),(0,P.c)([(0,h.F)()],W.prototype,"turbidity",void 0),(0,P.c)([(0,h.F)()],W.prototype,"rayleigh",void 0),(0,P.c)([(0,h.F)()],W.prototype,"mieCoefficient",void 0),(0,P.c)([(0,h.F)()],W.prototype,"mieDirectionalG",void 0),(0,P.c)([(0,h.F)()],W.prototype,"distance",void 0),(0,P.c)([(0,h.F)()],W.prototype,"inclination",void 0),(0,P.c)([(0,h.F)()],W.prototype,"azimuth",void 0),(0,P.c)([(0,h.C)()],W.prototype,"sunPosition",void 0),(0,P.c)([(0,h.F)()],W.prototype,"useSunPosition",void 0),(0,P.c)([(0,h.C)()],W.prototype,"cameraOffset",void 0),(0,P.c)([(0,h.C)()],W.prototype,"up",void 0),(0,P.c)([(0,h.F)()],W.prototype,"dithering",void 0),(0,O.g)("BABYLON.SkyMaterial",W)},12338:(w,E,G)=>{"use strict";function P(w,E){E.headers=w.headers||{},E.statusMessage=w.statusText,E.statusCode=w.status,E.data=w.response}function h(w,E,G){return new Promise((function(h,B){G=G||{};var y,x,U,l=new XMLHttpRequest,i=G.body,O=G.headers||{};for(y in G.timeout&&(l.timeout=G.timeout),l.ontimeout=l.onerror=function(w){w.timeout="timeout"==w.type,B(w)},l.open(w,E.href||E),l.onload=function(){for(U=l.getAllResponseHeaders().trim().split(/[\r\n]+/),P(l,l);x=U.shift();)x=x.split(": "),l.headers[x.shift().toLowerCase()]=x.join(": ");if((x=l.headers["content-type"])&&~x.indexOf("application/json"))try{l.data=JSON.parse(l.data,G.reviver)}catch(w){return P(l,w),B(w)}(l.status>=400?B:h)(l)},typeof FormData<"u"&&i instanceof FormData||i&&"object"==typeof i&&(O["content-type"]="application/json",i=JSON.stringify(i)),l.withCredentials=!!G.withCredentials,O)l.setRequestHeader(y,O[y]);l.send(i)}))}G.r(E),G.d(E,{del:()=>U,get:()=>B,patch:()=>x,post:()=>y,put:()=>l,send:()=>h});var B=h.bind(h,"GET"),y=h.bind(h,"POST"),x=h.bind(h,"PATCH"),U=h.bind(h,"DELETE"),l=h.bind(h,"PUT")},13862:(w,E,G)=>{"use strict";G.d(E,{e:()=>O});const P=.5*(Math.sqrt(3)-1),h=(3-Math.sqrt(3))/6,B=1/3,y=1/6,x=(Math.sqrt(5)-1)/4,U=(5-Math.sqrt(5))/20,l=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),i=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const O=class{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const E="function"==typeof w?w:function(w){let E=0,G=0,P=0,h=1;const B=function(){let w=4022871197;return function(E){E=E.toString();for(let G=0;G<E.length;G++){w+=E.charCodeAt(G);let P=.02519603282416938*w;w=P>>>0,P-=w,P*=w,w=P>>>0,P-=w,w+=4294967296*P}return 2.3283064365386963e-10*(w>>>0)}}();E=B(" "),G=B(" "),P=B(" "),E-=B(w),E<0&&(E+=1);G-=B(w),G<0&&(G+=1);P-=B(w),P<0&&(P+=1);return function(){const w=2091639*E+2.3283064365386963e-10*h;return E=G,G=P,P=w-(h=0|w)}}(w);this.p=function(w){const E=new Uint8Array(256);for(let G=0;G<256;G++)E[G]=G;for(let G=0;G<255;G++){const P=G+~~(w()*(256-G)),h=E[G];E[G]=E[P],E[P]=h}return E}(E),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let G=0;G<512;G++)this.perm[G]=this.p[255&G],this.permMod12[G]=this.perm[G]%12}noise2D(w,E){const G=this.permMod12,B=this.perm;let y=0,x=0,U=0;const i=(w+E)*P,O=Math.floor(w+i),u=Math.floor(E+i),V=(O+u)*h,a=w-(O-V),Q=E-(u-V);let c,Z;a>Q?(c=1,Z=0):(c=0,Z=1);const J=a-c+h,d=Q-Z+h,K=a-1+2*h,t=Q-1+2*h,q=255&O,W=255&u;let T=.5-a*a-Q*Q;if(T>=0){const w=3*G[q+B[W]];T*=T,y=T*T*(l[w]*a+l[w+1]*Q)}let I=.5-J*J-d*d;if(I>=0){const w=3*G[q+c+B[W+Z]];I*=I,x=I*I*(l[w]*J+l[w+1]*d)}let j=.5-K*K-t*t;if(j>=0){const w=3*G[q+1+B[W+1]];j*=j,U=j*j*(l[w]*K+l[w+1]*t)}return 70*(y+x+U)}noise3D(w,E,G){const P=this.permMod12,h=this.perm;let x,U,i,O;const u=(w+E+G)*B,V=Math.floor(w+u),a=Math.floor(E+u),Q=Math.floor(G+u),c=(V+a+Q)*y,Z=w-(V-c),J=E-(a-c),d=G-(Q-c);let K,t,q,W,T,I;Z>=J?J>=d?(K=1,t=0,q=0,W=1,T=1,I=0):Z>=d?(K=1,t=0,q=0,W=1,T=0,I=1):(K=0,t=0,q=1,W=1,T=0,I=1):J<d?(K=0,t=0,q=1,W=0,T=1,I=1):Z<d?(K=0,t=1,q=0,W=0,T=1,I=1):(K=0,t=1,q=0,W=1,T=1,I=0);const j=Z-K+y,g=J-t+y,o=d-q+y,f=Z-W+2*y,k=J-T+2*y,N=d-I+2*y,v=Z-1+.5,C=J-1+.5,s=d-1+.5,F=255&V,M=255&a,p=255&Q;let D=.6-Z*Z-J*J-d*d;if(D<0)x=0;else{const w=3*P[F+h[M+h[p]]];D*=D,x=D*D*(l[w]*Z+l[w+1]*J+l[w+2]*d)}let e=.6-j*j-g*g-o*o;if(e<0)U=0;else{const w=3*P[F+K+h[M+t+h[p+q]]];e*=e,U=e*e*(l[w]*j+l[w+1]*g+l[w+2]*o)}let R=.6-f*f-k*k-N*N;if(R<0)i=0;else{const w=3*P[F+W+h[M+T+h[p+I]]];R*=R,i=R*R*(l[w]*f+l[w+1]*k+l[w+2]*N)}let H=.6-v*v-C*C-s*s;if(H<0)O=0;else{const w=3*P[F+1+h[M+1+h[p+1]]];H*=H,O=H*H*(l[w]*v+l[w+1]*C+l[w+2]*s)}return 32*(x+U+i+O)}noise4D(w,E,G,P){const h=this.perm;let B,y,l,O,u;const V=(w+E+G+P)*x,a=Math.floor(w+V),Q=Math.floor(E+V),c=Math.floor(G+V),Z=Math.floor(P+V),J=(a+Q+c+Z)*U,d=w-(a-J),K=E-(Q-J),t=G-(c-J),q=P-(Z-J);let W=0,T=0,I=0,j=0;d>K?W++:T++,d>t?W++:I++,d>q?W++:j++,K>t?T++:I++,K>q?T++:j++,t>q?I++:j++;const g=W>=3?1:0,o=T>=3?1:0,f=I>=3?1:0,k=j>=3?1:0,N=W>=2?1:0,v=T>=2?1:0,C=I>=2?1:0,s=j>=2?1:0,F=W>=1?1:0,M=T>=1?1:0,p=I>=1?1:0,D=j>=1?1:0,e=d-g+U,R=K-o+U,H=t-f+U,z=q-k+U,L=d-N+2*U,m=K-v+2*U,n=t-C+2*U,r=q-s+2*U,Y=d-F+3*U,S=K-M+3*U,X=t-p+3*U,b=q-D+3*U,A=d-1+4*U,ww=K-1+4*U,Ew=t-1+4*U,Gw=q-1+4*U,Pw=255&a,hw=255&Q,Bw=255&c,yw=255&Z;let xw=.6-d*d-K*K-t*t-q*q;if(xw<0)B=0;else{const w=h[Pw+h[hw+h[Bw+h[yw]]]]%32*4;xw*=xw,B=xw*xw*(i[w]*d+i[w+1]*K+i[w+2]*t+i[w+3]*q)}let Uw=.6-e*e-R*R-H*H-z*z;if(Uw<0)y=0;else{const w=h[Pw+g+h[hw+o+h[Bw+f+h[yw+k]]]]%32*4;Uw*=Uw,y=Uw*Uw*(i[w]*e+i[w+1]*R+i[w+2]*H+i[w+3]*z)}let lw=.6-L*L-m*m-n*n-r*r;if(lw<0)l=0;else{const w=h[Pw+N+h[hw+v+h[Bw+C+h[yw+s]]]]%32*4;lw*=lw,l=lw*lw*(i[w]*L+i[w+1]*m+i[w+2]*n+i[w+3]*r)}let iw=.6-Y*Y-S*S-X*X-b*b;if(iw<0)O=0;else{const w=h[Pw+F+h[hw+M+h[Bw+p+h[yw+D]]]]%32*4;iw*=iw,O=iw*iw*(i[w]*Y+i[w+1]*S+i[w+2]*X+i[w+3]*b)}let Ow=.6-A*A-ww*ww-Ew*Ew-Gw*Gw;if(Ow<0)u=0;else{const w=h[Pw+1+h[hw+1+h[Bw+1+h[yw+1]]]]%32*4;Ow*=Ow,u=Ow*Ow*(i[w]*A+i[w+1]*ww+i[w+2]*Ew+i[w+3]*Gw)}return 27*(B+y+l+O+u)}}}}]);