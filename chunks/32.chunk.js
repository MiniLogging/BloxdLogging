/*! For license information please see bsqs6o.32.b4baad77.chunk.js.LICENSE.txt */
(self.zcqpiao938m=self.zcqpiao938m||[]).push([[32],{13793:(C,U,K)=>{"use strict";var m=K(13798),O=K(13803),X=K(13812);K.g.__TYPEDARRAY_POOL||(K.g.__TYPEDARRAY_POOL={UINT8:O([32,0]),UINT16:O([32,0]),UINT32:O([32,0]),INT8:O([32,0]),INT16:O([32,0]),INT32:O([32,0]),FLOAT:O([32,0]),DOUBLE:O([32,0]),DATA:O([32,0]),UINT8C:O([32,0]),BUFFER:O([32,0])});var A="undefined"!==typeof Uint8ClampedArray,e=K.g.__TYPEDARRAY_POOL;e.UINT8C||(e.UINT8C=O([32,0])),e.BUFFER||(e.BUFFER=O([32,0]));var t=e.DATA,z=e.BUFFER;function j(C){if(C){var U=C.length||C.byteLength,K=m.log2(U);t[K].push(C)}}function p(C){C=m.nextPow2(C);var U=m.log2(C),K=t[U];return K.length>0?K.pop():new ArrayBuffer(C)}function E(C){return new Uint8Array(p(C),0,C)}function u(C){return new Uint16Array(p(2*C),0,C)}function b(C){return new Uint32Array(p(4*C),0,C)}function v(C){return new Int8Array(p(C),0,C)}function Q(C){return new Int16Array(p(2*C),0,C)}function V(C){return new Int32Array(p(4*C),0,C)}function f(C){return new Float32Array(p(4*C),0,C)}function F(C){return new Float64Array(p(8*C),0,C)}function Z(C){return A?new Uint8ClampedArray(p(C),0,C):E(C)}function P(C){return new DataView(p(C),0,C)}U.free=function(C){if(X(C))z[m.log2(C.length)].push(C);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(C)&&(C=C.buffer),!C)return;var U=C.length||C.byteLength,K=0|m.log2(U);t[K].push(C)}},U.freeUint8=U.freeUint16=U.freeUint32=U.freeInt8=U.freeInt16=U.freeInt32=U.freeFloat32=U.freeFloat=U.freeFloat64=U.freeDouble=U.freeUint8Clamped=U.freeDataView=function(C){j(C.buffer)},U.freeArrayBuffer=j,U.freeBuffer=function(C){z[m.log2(C.length)].push(C)},U.malloc=function(C,U){if(void 0===U||"arraybuffer"===U)return p(C);switch(U){case"uint8":return E(C);case"uint16":return u(C);case"uint32":return b(C);case"int8":return v(C);case"int16":return Q(C);case"int32":return V(C);case"float":case"float32":return f(C);case"double":case"float64":return F(C);case"uint8_clamped":return Z(C);case"buffer":throw"Buffer not supported";case"data":case"dataview":return P(C);default:return null}return null},U.mallocArrayBuffer=p,U.mallocUint8=E,U.mallocUint16=u,U.mallocUint32=b,U.mallocInt8=v,U.mallocInt16=Q,U.mallocInt32=V,U.mallocFloat32=U.mallocFloat=f,U.mallocFloat64=U.mallocDouble=F,U.mallocUint8Clamped=Z,U.mallocDataView=P,U.clearCache=function(){for(var C=0;C<32;++C)e.UINT8[C].length=0,e.UINT16[C].length=0,e.UINT32[C].length=0,e.INT8[C].length=0,e.INT16[C].length=0,e.INT32[C].length=0,e.FLOAT[C].length=0,e.DOUBLE[C].length=0,e.UINT8C[C].length=0,t[C].length=0,z[C].length=0}},13886:(C,U,K)=>{C.exports=O;var m=K(12628);function O(C,U){if(!(this instanceof O))return new O(C,U);var K=m.create();m.add(K,C,U),this.base=m.min(m.create(),C,K),this.ej=m.clone(U),this.max=m.max(m.create(),C,K),this.mag=m.length(this.ej)}var X=O.prototype;X.width=function(){return this.ej[0]},X.height=function(){return this.ej[1]},X.depth=function(){return this.ej[2]},X.x0=function(){return this.base[0]},X.y0=function(){return this.base[1]},X.z0=function(){return this.base[2]},X.x1=function(){return this.max[0]},X.y1=function(){return this.max[1]},X.z1=function(){return this.max[2]},X.translate=function(C){return m.add(this.max,this.max,C),m.add(this.base,this.base,C),this},X.setPosition=function(C){return m.add(this.max,C,this.ej),m.k(this.base,C),this},X.expand=function(C){var U=m.create(),K=m.create();return m.max(U,C.max,this.max),m.min(K,C.base,this.base),m.vU(U,U,K),new O(K,U)},X.intersects=function(C){return!(C.base[0]>this.max[0])&&(!(C.base[1]>this.max[1])&&(!(C.base[2]>this.max[2])&&(!(C.max[0]<this.base[0])&&(!(C.max[1]<this.base[1])&&!(C.max[2]<this.base[2])))))},X.touches=function(C){var U=this.union(C);return null!==U&&(0==U.width()||0==U.height()||0==U.depth())},X.union=function(C){if(!this.intersects(C))return null;var U=Math.max(C.base[0],this.base[0]),K=Math.max(C.base[1],this.base[1]),m=Math.max(C.base[2],this.base[2]);return new O([U,K,m],[Math.min(C.max[0],this.max[0])-U,Math.min(C.max[1],this.max[1])-K,Math.min(C.max[2],this.max[2])-m])}},13798:(C,U)=>{"use strict";function K(C){var U=32;return(C&=-C)&&U--,65535&C&&(U-=16),16711935&C&&(U-=8),252645135&C&&(U-=4),858993459&C&&(U-=2),1431655765&C&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(C){return(C>0)-(C<0)},U.abs=function(C){var U=C>>31;return(C^U)-U},U.min=function(C,U){return U^(C^U)&-(C<U)},U.max=function(C,U){return C^(C^U)&-(C<U)},U.isPow2=function(C){return!(C&C-1)&&!!C},U.log2=function(C){var U,K;return U=(C>65535)<<4,U|=K=((C>>>=U)>255)<<3,U|=K=((C>>>=K)>15)<<2,(U|=K=((C>>>=K)>3)<<1)|(C>>>=K)>>1},U.log10=function(C){return C>=1e9?9:C>=1e8?8:C>=1e7?7:C>=1e6?6:C>=1e5?5:C>=1e4?4:C>=1e3?3:C>=100?2:C>=10?1:0},U.popCount=function(C){return 16843009*((C=(858993459&(C-=C>>>1&1431655765))+(C>>>2&858993459))+(C>>>4)&252645135)>>>24},U.countTrailingZeros=K,U.nextPow2=function(C){return C+=0===C,--C,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)+1},U.prevPow2=function(C){return C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)-(C>>>1)},U.parity=function(C){return C^=C>>>16,C^=C>>>8,C^=C>>>4,27030>>>(C&=15)&1};var m=new Array(256);!function(C){for(var U=0;U<256;++U){var K=U,m=U,O=7;for(K>>>=1;K;K>>>=1)m<<=1,m|=1&K,--O;C[U]=m<<O&255}}(m),U.reverse=function(C){return m[255&C]<<24|m[C>>>8&255]<<16|m[C>>>16&255]<<8|m[C>>>24&255]},U.interleave2=function(C,U){return(C=1431655765&((C=858993459&((C=252645135&((C=16711935&((C&=65535)|C<<8))|C<<4))|C<<2))|C<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(C,U){return(C=65535&((C=16711935&((C=252645135&((C=858993459&((C=C>>>U&1431655765)|C>>>1))|C>>>2))|C>>>4))|C>>>16))<<16>>16},U.interleave3=function(C,U,K){return C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2),(C|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2))<<2},U.deinterleave3=function(C,U){return(C=1023&((C=4278190335&((C=251719695&((C=3272356035&((C=C>>>U&1227133513)|C>>>2))|C>>>4))|C>>>8))|C>>>16))<<22>>22},U.nextCombination=function(C){var U=C|C-1;return U+1|(~U&-~U)-1>>>K(C)+1}},13785:(C,U,K)=>{"use strict";C.exports=function(C,U,K){switch(arguments.length){case 1:return m=[],z(O=C,O,j,!0),m;case 2:return"function"===typeof U?z(C,C,U,!0):function(C,U){return m=[],z(C,U,j,!1),m}(C,U);case 3:return z(C,U,K,!1);default:throw new Error("box-intersect: Invalid arguments")}var O};var m,O=K(13793),X=K(13821),A=K(13831);function e(C,U){for(var K=0;K<C;++K)if(!(U[K]<=U[K+C]))return!0;return!1}function t(C,U,K,m){for(var O=0,X=0,A=0,t=C.length;A<t;++A){var z=C[A];if(!e(U,z)){for(var j=0;j<2*U;++j)K[O++]=z[j];m[X++]=A}}return X}function z(C,U,K,m){var e=C.length,z=U.length;if(!(e<=0||z<=0)){var j=C[0].length>>>1;if(!(j<=0)){var p,E=O.mallocDouble(2*j*e),u=O.mallocInt32(e);if((e=t(C,j,E,u))>0){if(1===j&&m)X.init(e),p=X.sweepComplete(j,K,0,e,E,u,0,e,E,u);else{var b=O.mallocDouble(2*j*z),v=O.mallocInt32(z);(z=t(U,j,b,v))>0&&(X.init(e+z),p=1===j?X.sweepBipartite(j,K,0,e,E,u,0,z,b,v):A(j,K,m,e,E,u,z,b,v),O.free(b),O.free(v))}O.free(E),O.free(u)}return p}}}function j(C,U){m.push([C,U])}},13840:(C,U)=>{"use strict";var K="d",m="ax",O="fp",X="es",A="rs",e="re",t="rb",z="bs",j="be",p="bb",E=[K,m,"vv",A,e,t,"ri",z,j,p,"bi"];function u(C){var U="bruteForce"+(C?"Full":"Partial"),m=[],A=E.slice();C||A.splice(3,0,O);var e=["function "+U+"("+A.join()+"){"];function t(U,O){var A=function(C,U,m){var O="bruteForce"+(C?"Red":"Blue")+(U?"Flip":"")+(m?"Full":""),A=["function ",O,"(",E.join(),"){","var ",X,"=2*",K,";"],e="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",t="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(m?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return C?A.push(e,"Q",":",t):A.push(t,"Q",":",e),m?A.push("if(y1<x0||x1<y0)continue;"):U?A.push("if(y0<=x0||x1<y0)continue;"):A.push("if(y0<x0||x1<y0)continue;"),A.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),U?A.push("yi,xi"):A.push("xi,yi"),A.push(");if(rv!==void 0)return rv;}}}"),{name:O,code:A.join("")}}(U,O,C);m.push(A.code),e.push("return "+A.name+"("+E.join()+");")}e.push("if(re-rs>be-bs){"),C?(t(!0,!1),e.push("}else{"),t(!1,!1)):(e.push("if(fp){"),t(!0,!0),e.push("}else{"),t(!0,!1),e.push("}}else{if(fp){"),t(!1,!0),e.push("}else{"),t(!1,!1),e.push("}")),e.push("}}return "+U);var z=m.join("")+e.join("");return new Function(z)()}U.partial=u(!1),U.full=u(!0)},13831:(C,U,K)=>{"use strict";C.exports=function(C,U,K,X,j,r,i,D,l){!function(C,U){var K=8*O.log2(U+1)*(C+1)|0,X=O.nextPow2(Z*K);H.length<X&&(m.free(H),H=m.mallocInt32(X));var A=O.nextPow2(P*K);d.length<A&&(m.free(d),d=m.mallocDouble(A))}(C,X+i);var G,J=0,o=2*C;T(J++,0,0,X,0,i,K?16:0,-1/0,1/0),K||T(J++,0,0,i,0,X,1,-1/0,1/0);for(;J>0;){var B=(J-=1)*Z,k=H[B],w=H[B+1],h=H[B+2],c=H[B+3],N=H[B+4],g=H[B+5],M=J*P,L=d[M],Y=d[M+1],W=1&g,x=!!(16&g),n=j,S=r,s=D,R=l;if(W&&(n=D,S=l,s=j,R=r),!(2&g&&w>=(h=Q(C,k,w,h,n,S,Y)))&&!(4&g&&(w=V(C,k,w,h,n,S,L))>=h)){var q=h-w,I=N-c;if(x){if(C*q*(q+I)<u){if(void 0!==(G=t.scanComplete(C,k,U,w,h,n,S,c,N,s,R)))return G;continue}}else{if(C*Math.min(q,I)<p){if(void 0!==(G=A(C,k,U,W,w,h,n,S,c,N,s,R)))return G;continue}if(C*q*I<E){if(void 0!==(G=t.scanBipartite(C,k,U,W,w,h,n,S,c,N,s,R)))return G;continue}}var CC=b(C,k,w,h,n,S,L,Y);if(w<CC)if(C*(CC-w)<p){if(void 0!==(G=e(C,k+1,U,w,CC,n,S,c,N,s,R)))return G}else if(k===C-2){if(void 0!==(G=W?t.sweepBipartite(C,U,c,N,s,R,w,CC,n,S):t.sweepBipartite(C,U,w,CC,n,S,c,N,s,R)))return G}else T(J++,k+1,w,CC,c,N,W,-1/0,1/0),T(J++,k+1,c,N,w,CC,1^W,-1/0,1/0);if(CC<h){var UC=z(C,k,c,N,s,R),KC=s[o*UC+k],mC=v(C,k,UC,N,s,R,KC);if(mC<N&&T(J++,k,CC,h,mC,N,(4|W)+(x?16:0),KC,Y),c<UC&&T(J++,k,CC,h,c,UC,(2|W)+(x?16:0),L,KC),UC+1===mC){if(void 0!==(G=x?a(C,k,U,CC,h,n,S,UC,s,R[UC]):y(C,k,U,W,CC,h,n,S,UC,s,R[UC])))return G}else if(UC<mC){var OC;if(x){if(CC<(OC=f(C,k,CC,h,n,S,KC))){var XC=v(C,k,CC,OC,n,S,KC);if(k===C-2){if(CC<XC&&void 0!==(G=t.sweepComplete(C,U,CC,XC,n,S,UC,mC,s,R)))return G;if(XC<OC&&void 0!==(G=t.sweepBipartite(C,U,XC,OC,n,S,UC,mC,s,R)))return G}else CC<XC&&T(J++,k+1,CC,XC,UC,mC,16,-1/0,1/0),XC<OC&&(T(J++,k+1,XC,OC,UC,mC,0,-1/0,1/0),T(J++,k+1,UC,mC,XC,OC,1,-1/0,1/0))}}else CC<(OC=W?F(C,k,CC,h,n,S,KC):f(C,k,CC,h,n,S,KC))&&(k===C-2?G=W?t.sweepBipartite(C,U,UC,mC,s,R,CC,OC,n,S):t.sweepBipartite(C,U,CC,OC,n,S,UC,mC,s,R):(T(J++,k+1,CC,OC,UC,mC,W,-1/0,1/0),T(J++,k+1,UC,mC,CC,OC,1^W,-1/0,1/0)))}}}}};var m=K(13793),O=K(13798),X=K(13840),A=X.partial,e=X.full,t=K(13821),z=K(13842),j=K(13850),p=128,E=1<<22,u=1<<22,b=j("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),v=j("lo===p0",["p0"]),Q=j("lo<p0",["p0"]),V=j("hi<=p0",["p0"]),f=j("lo<=p0&&p0<=hi",["p0"]),F=j("lo<p0&&p0<=hi",["p0"]),Z=6,P=2,H=m.mallocInt32(1024),d=m.mallocDouble(1024);function T(C,U,K,m,O,X,A,e,t){var z=Z*C;H[z]=U,H[z+1]=K,H[z+2]=m,H[z+3]=O,H[z+4]=X,H[z+5]=A;var j=P*C;d[j]=e,d[j+1]=t}function y(C,U,K,m,O,X,A,e,t,z,j){var p=2*C,E=t*p,u=z[E+U];C:for(var b=O,v=O*p;b<X;++b,v+=p){var Q=A[v+U],V=A[v+U+C];if(!(u<Q||V<u)&&(!m||u!==Q)){for(var f,F=e[b],Z=U+1;Z<C;++Z){Q=A[v+Z],V=A[v+Z+C];var P=z[E+Z],H=z[E+Z+C];if(V<P||H<Q)continue C}if(void 0!==(f=m?K(j,F):K(F,j)))return f}}}function a(C,U,K,m,O,X,A,e,t,z){var j=2*C,p=e*j,E=t[p+U];C:for(var u=m,b=m*j;u<O;++u,b+=j){var v=A[u];if(v!==z){var Q=X[b+U],V=X[b+U+C];if(!(E<Q||V<E)){for(var f=U+1;f<C;++f){Q=X[b+f],V=X[b+f+C];var F=t[p+f],Z=t[p+f+C];if(V<F||Z<Q)continue C}var P=K(v,z);if(void 0!==P)return P}}}}},13842:(C,U,K)=>{"use strict";C.exports=function(C,U,K,A,e,t){if(A<=K+1)return K;var z=K,j=A,p=A+K>>>1,E=2*C,u=p,b=e[E*p+U];for(;z<j;){if(j-z<O){X(C,U,z,j,e,t),b=e[E*p+U];break}var v=j-z,Q=Math.random()*v+z|0,V=e[E*Q+U],f=Math.random()*v+z|0,F=e[E*f+U],Z=Math.random()*v+z|0,P=e[E*Z+U];V<=F?P>=F?(u=f,b=F):V>=P?(u=Q,b=V):(u=Z,b=P):F>=P?(u=f,b=F):P>=V?(u=Q,b=V):(u=Z,b=P);for(var H=E*(j-1),d=E*u,T=0;T<E;++T,++H,++d){var y=e[H];e[H]=e[d],e[d]=y}var a=t[j-1];t[j-1]=t[u],t[u]=a;for(H=E*(j-1),d=E*(u=m(C,U,z,j-1,e,t,b)),T=0;T<E;++T,++H,++d){y=e[H];e[H]=e[d],e[d]=y}a=t[j-1];if(t[j-1]=t[u],t[u]=a,p<u){for(j=u-1;z<j&&e[E*(j-1)+U]===b;)j-=1;j+=1}else{if(!(u<p))break;for(z=u+1;z<j&&e[E*z+U]===b;)z+=1}}return m(C,U,K,p,e,t,e[E*p+U])};var m=K(13850)("lo<p0",["p0"]),O=8;function X(C,U,K,m,O,X){for(var A=2*C,e=A*(K+1)+U,t=K+1;t<m;++t,e+=A)for(var z=O[e],j=t,p=A*(t-1);j>K&&O[p+U]>z;--j,p-=A){for(var E=p,u=p+A,b=0;b<A;++b,++E,++u){var v=O[E];O[E]=O[u],O[u]=v}var Q=X[j];X[j]=X[j-1],X[j-1]=Q}}},13850:C=>{"use strict";C.exports=function(C,K){var m="abcdef".split("").concat(K),O=[];C.indexOf("lo")>=0&&O.push("lo=e[k+n]");C.indexOf("hi")>=0&&O.push("hi=e[k+o]");return m.push(U.replace("_",O.join()).replace("$",C)),Function.apply(void 0,m)};var U="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13824:C=>{"use strict";C.exports=function(C,m){m<=4*U?K(0,m-1,C):z(0,m-1,C)};var U=32;function K(C,U,K){for(var m=2*(C+1),O=C+1;O<=U;++O){for(var X=K[m++],A=K[m++],e=O,t=m-2;e-- >C;){var z=K[t-2],j=K[t-1];if(z<X)break;if(z===X&&j<A)break;K[t]=z,K[t+1]=j,t-=2}K[t]=X,K[t+1]=A}}function m(C,U,K){U*=2;var m=K[C*=2],O=K[C+1];K[C]=K[U],K[C+1]=K[U+1],K[U]=m,K[U+1]=O}function O(C,U,K){U*=2,K[C*=2]=K[U],K[C+1]=K[U+1]}function X(C,U,K,m){U*=2,K*=2;var O=m[C*=2],X=m[C+1];m[C]=m[U],m[C+1]=m[U+1],m[U]=m[K],m[U+1]=m[K+1],m[K]=O,m[K+1]=X}function A(C,U,K,m,O){U*=2,O[C*=2]=O[U],O[U]=K,O[C+1]=O[U+1],O[U+1]=m}function e(C,U,K){U*=2;var m=K[C*=2],O=K[U];return!(m<O)&&(m!==O||K[C+1]>K[U+1])}function t(C,U,K,m){var O=m[C*=2];return O<U||O===U&&m[C+1]<K}function z(C,j,p){var E=(j-C+1)/6|0,u=C+E,b=j-E,v=C+j>>1,Q=v-E,V=v+E,f=u,F=Q,Z=v,P=V,H=b,d=C+1,T=j-1,y=0;e(f,F,p)&&(y=f,f=F,F=y),e(P,H,p)&&(y=P,P=H,H=y),e(f,Z,p)&&(y=f,f=Z,Z=y),e(F,Z,p)&&(y=F,F=Z,Z=y),e(f,P,p)&&(y=f,f=P,P=y),e(Z,P,p)&&(y=Z,Z=P,P=y),e(F,H,p)&&(y=F,F=H,H=y),e(F,Z,p)&&(y=F,F=Z,Z=y),e(P,H,p)&&(y=P,P=H,H=y);for(var a=p[2*F],r=p[2*F+1],i=p[2*P],D=p[2*P+1],l=2*f,G=2*Z,J=2*H,o=2*u,B=2*v,k=2*b,w=0;w<2;++w){var h=p[l+w],c=p[G+w],N=p[J+w];p[o+w]=h,p[B+w]=c,p[k+w]=N}O(Q,C,p),O(V,j,p);for(var g=d;g<=T;++g)if(t(g,a,r,p))g!==d&&m(g,d,p),++d;else if(!t(g,i,D,p))for(;;){if(t(T,i,D,p)){t(T,a,r,p)?(X(g,d,T,p),++d,--T):(m(g,T,p),--T);break}if(--T<g)break}A(C,d-1,a,r,p),A(j,T+1,i,D,p),d-2-C<=U?K(C,d-2,p):z(C,d-2,p),j-(T+2)<=U?K(T+2,j,p):z(T+2,j,p),T-d<=U?K(d,T,p):z(d,T,p)}},13821:(C,U,K)=>{"use strict";C.exports={init:function(C){var U=O.nextPow2(C);t.length<U&&(m.free(t),t=m.mallocInt32(U));z.length<U&&(m.free(z),z=m.mallocInt32(U));j.length<U&&(m.free(j),j=m.mallocInt32(U));p.length<U&&(m.free(p),p=m.mallocInt32(U));E.length<U&&(m.free(E),E=m.mallocInt32(U));u.length<U&&(m.free(u),u=m.mallocInt32(U));var K=8*U;b.length<K&&(m.free(b),b=m.mallocDouble(K))},sweepBipartite:function(C,U,K,m,O,e,E,u,V,f){for(var F=0,Z=2*C,P=C-1,H=Z-1,d=K;d<m;++d){var T=e[d],y=Z*d;b[F++]=O[y+P],b[F++]=-(T+1),b[F++]=O[y+H],b[F++]=T}for(d=E;d<u;++d){T=f[d]+A;var a=Z*d;b[F++]=V[a+P],b[F++]=-T,b[F++]=V[a+H],b[F++]=T}var r=F>>>1;X(b,r);var i=0,D=0;for(d=0;d<r;++d){var l=0|b[2*d+1];if(l>=A)v(j,p,D--,l=l-A|0);else if(l>=0)v(t,z,i--,l);else if(l<=-A){l=-l-A|0;for(var G=0;G<i;++G){if(void 0!==(J=U(t[G],l)))return J}Q(j,p,D++,l)}else{l=-l-1|0;for(G=0;G<D;++G){var J;if(void 0!==(J=U(l,j[G])))return J}Q(t,z,i++,l)}}},sweepComplete:function(C,U,K,m,O,A,e,V,f,F){for(var Z=0,P=2*C,H=C-1,d=P-1,T=K;T<m;++T){var y=A[T]+1<<1,a=P*T;b[Z++]=O[a+H],b[Z++]=-y,b[Z++]=O[a+d],b[Z++]=y}for(T=e;T<V;++T){y=F[T]+1<<1;var r=P*T;b[Z++]=f[r+H],b[Z++]=1|-y,b[Z++]=f[r+d],b[Z++]=1|y}var i=Z>>>1;X(b,i);var D=0,l=0,G=0;for(T=0;T<i;++T){var J=0|b[2*T+1],o=1&J;if(T<i-1&&J>>1===b[2*T+3]>>1&&(o=2,T+=1),J<0){for(var B=-(J>>1)-1,k=0;k<G;++k){if(void 0!==(w=U(E[k],B)))return w}if(0!==o)for(k=0;k<D;++k){if(void 0!==(w=U(t[k],B)))return w}if(1!==o)for(k=0;k<l;++k){var w;if(void 0!==(w=U(j[k],B)))return w}0===o?Q(t,z,D++,B):1===o?Q(j,p,l++,B):2===o&&Q(E,u,G++,B)}else{B=(J>>1)-1;0===o?v(t,z,D--,B):1===o?v(j,p,l--,B):2===o&&v(E,u,G--,B)}}},scanBipartite:function(C,U,K,m,O,e,j,p,E,u,V,f){var F=0,Z=2*C,P=U,H=U+C,d=1,T=1;m?T=A:d=A;for(var y=O;y<e;++y){var a=y+d,r=Z*y;b[F++]=j[r+P],b[F++]=-a,b[F++]=j[r+H],b[F++]=a}for(y=E;y<u;++y){a=y+T;var i=Z*y;b[F++]=V[i+P],b[F++]=-a}var D=F>>>1;X(b,D);var l=0;for(y=0;y<D;++y){var G=0|b[2*y+1];if(G<0){var J=!1;if((a=-G)>=A?(J=!m,a-=A):(J=!!m,a-=1),J)Q(t,z,l++,a);else{var o=f[a],B=Z*a,k=V[B+U+1],w=V[B+U+1+C];C:for(var h=0;h<l;++h){var c=t[h],N=Z*c;if(!(w<j[N+U+1]||j[N+U+1+C]<k)){for(var g=U+2;g<C;++g)if(V[B+g+C]<j[N+g]||j[N+g+C]<V[B+g])continue C;var M,L=p[c];if(void 0!==(M=m?K(o,L):K(L,o)))return M}}}}else v(t,z,l--,G-d)}},scanComplete:function(C,U,K,m,O,e,z,j,p,E,u){for(var v=0,Q=2*C,V=U,f=U+C,F=m;F<O;++F){var Z=F+A,P=Q*F;b[v++]=e[P+V],b[v++]=-Z,b[v++]=e[P+f],b[v++]=Z}for(F=j;F<p;++F){Z=F+1;var H=Q*F;b[v++]=E[H+V],b[v++]=-Z}var d=v>>>1;X(b,d);var T=0;for(F=0;F<d;++F){var y=0|b[2*F+1];if(y<0){if((Z=-y)>=A)t[T++]=Z-A;else{var a=u[Z-=1],r=Q*Z,i=E[r+U+1],D=E[r+U+1+C];C:for(var l=0;l<T;++l){var G=t[l],J=z[G];if(J===a)break;var o=Q*G;if(!(D<e[o+U+1]||e[o+U+1+C]<i)){for(var B=U+2;B<C;++B)if(E[r+B+C]<e[o+B]||e[o+B+C]<E[r+B])continue C;var k=K(J,a);if(void 0!==k)return k}}}}else{for(Z=y-A,l=T-1;l>=0;--l)if(t[l]===Z){for(B=l+1;B<T;++B)t[B-1]=t[B];break}--T}}}};var m=K(13793),O=K(13798),X=K(13824),A=1<<28,e=1024,t=m.mallocInt32(e),z=m.mallocInt32(e),j=m.mallocInt32(e),p=m.mallocInt32(e),E=m.mallocInt32(e),u=m.mallocInt32(e),b=m.mallocDouble(8192);function v(C,U,K,m){var O=U[m],X=C[K-1];C[O]=X,U[X]=O}function Q(C,U,K,m){C[K]=m,U[m]=K}},13803:C=>{"use strict";function U(C,K,m){var O=0|C[m];if(O<=0)return[];var X,A=new Array(O);if(m===C.length-1)for(X=0;X<O;++X)A[X]=K;else for(X=0;X<O;++X)A[X]=U(C,K,m+1);return A}C.exports=function(C,K){switch("undefined"===typeof K&&(K=0),typeof C){case"number":if(C>0)return function(C,U){var K,m;for(K=new Array(C),m=0;m<C;++m)K[m]=U;return K}(0|C,K);break;case"object":if("number"===typeof C.length)return U(C,K,0)}return[]}},13751:(C,U,K)=>{C.exports=function(){var C=this;this.components={},this.comps=this.components;var U=this.components,K=1,O={},X=[],A=[],e={timeout:!1,removals:[],multiComps:[]};function t(C,K){var m=U[K],X=O[K],A=X.hash[C];A&&(X.remove(C),m.IX&&(m.multi?(A.forEach((U=>{U&&m.IX(C,U)})),A.length=0):m.IX(C,A)),e.removals.push(X),z())}function z(){e.timeout||(e.timeout=!0,setTimeout(j,1))}function j(){e.timeout=!1,p()}function p(){e.multiComps.length&&function(C){for(var U=0;U<C.length;U++){var{entID:K,data:m}=C[U],O=m.hash[K];if(O){for(var X=0;X<O.length;X++)O[X]||(O.splice(X,1),X--);0===O.length&&(m.remove(K),e.removals.push(m))}}C.length=0}(e.multiComps),e.removals.length&&function(C){for(var U=0;U<C.length;U++){C[U].flush()}C.length=0}(e.removals)}this.Pp=O,this._systems=X,this._renderSystems=A,this.jj=function(U){var m=K++;return Array.isArray(U)&&U.forEach((U=>C.Yt(m,U))),m},this.deleteEntity=function(U){return Object.keys(O).forEach((C=>{O[C].hash[U]&&t(U,C)})),C},this.yj=function(C){if(!C)throw new Error("Missing component definition");var K=C.name;if(!K)throw new Error("Component definition must have a name property.");if("string"!==typeof K)throw new Error("Component name must be a string.");if(""===K)throw new Error("Component name must be a non-empty string.");if(O[K])throw new Error(`Component ${K} already exists.`);var e={};return e.name=K,e.multi=!!C.multi,e.order=isNaN(C.order)?99:C.order,e.stateConstructor=C.stateConstructor||null,e.state=C.state||{},e.De=C.De||null,e.IX=C.IX||null,e.system=C.system||null,e.we=C.we||null,U[K]=e,O[K]=new m,O[K]._pendingMultiCleanup=!1,O[K]._multiCleanupIDs=e.multi?[]:null,e.system&&(X.push(K),X.sort(((C,K)=>U[C].order-U[K].order))),e.we&&(A.push(K),A.sort(((C,K)=>U[C].order-U[K].order))),K},this.overwriteComponent=function(C,K){var m=U[C];if(!m)throw new Error(`Unknown component: ${C}`);if(!K)throw new Error("Missing component definition");if(m.name!==K.name)throw new Error("Overwriting component must use the same name property.");var e={};e.name=C,e.multi=!!K.multi,e.order=isNaN(K.order)?99:K.order,e.state=K.state||{},e.De=K.De||null,e.IX=K.IX||null,e.system=K.system||null,e.we=K.we||null,U[C]=e,O[C]._pendingMultiCleanup=!1,O[C]._multiCleanupIDs=e.multi?[]:null;var t=X.indexOf(C);e.system&&t<0&&X.push(C),!e.system&&t>=0&&X.splice(t,1),X.sort(((C,K)=>U[C].order-U[K].order));var z=A.indexOf(C);e.we&&z<0&&A.push(C),!e.we&&z>=0&&A.splice(z,1),A.sort(((C,K)=>U[C].order-U[K].order));var j=e.state;return this.Yz(C).forEach((C=>{for(var U in j)U in C||(C[U]=j[U]);e.De&&e.De(C.Be,C)})),C},this.deleteComponent=function(K){var m=O[K];if(!m)throw new Error(`Unknown component: ${K}`);m.flush(),m.list.forEach((C=>{C&&t(C.Be||C[0].Be,K)}));var e=X.indexOf(K),z=A.indexOf(K);return e>-1&&X.splice(e,1),z>-1&&A.splice(z,1),O[K].dispose(),delete O[K],delete U[K],C},this.Yt=function(C,K,m){var X,A=U[K],e=O[K];if(!e)throw new Error(`Unknown component: ${K}.`);if(e.hash[C]&&!A.multi)throw new Error(`Entity ${C} already has component: ${K}.`);if(A.stateConstructor){if(!(X=new A.stateConstructor).hasOwnProperty("Be"))throw new Error(`Component ${A.name} stateConstructor type does not have property __id`)}else X=Object.assign({},{Be:C},A.state,m);if(X.Be=C,A.multi){var t=e.hash[C];t||(t=[],e.add(C,t)),t.push(X)}else e.add(C,X);return A.De&&A.De(C,X),this},this.Uz=function(C,U){var K=O[U];if(!K)throw new Error(`Unknown component: ${U}.`);return!!K.hash[C]},this.St=function(U,K){if(!O[K])throw new Error(`Unknown component: ${K}.`);return t(U,K),C},this.getState=function(C,U){var K=O[U];if(!K)throw new Error(`Unknown component: ${U}.`);return K.hash[C]},this.Yz=function(C){var U=O[C];if(!U)throw new Error(`Unknown component: ${C}.`);return p(),U.list},this.ju=function(C){if(!O[C])throw new Error(`Unknown component: ${C}.`);var U=O[C].hash;return C=>U[C]},this.uu=function(C){if(!O[C])throw new Error(`Unknown component: ${C}.`);var U=O[C].hash;return C=>!!U[C]},this.YA=function(K){p();for(var m=0;m<X.length;m++){var A=X[m],e=U[A],t=O[A];e.system(K,t.list),p()}return C},this.render=function(K){p();for(var m=0;m<A.length;m++){var X=A[m],e=U[X],t=O[X];e.we(K,t.list),p()}return C},this.removeMultiComponent=function(K,m,X){var A=U[m],t=O[m];if(!t)throw new Error(`Unknown component: ${m}.`);if(!A.multi)throw new Error("removeMultiComponent called on non-multi component");return function(C,U,K,m){var O=K.hash[C];if(O){var X=O[m];X&&(O[m]=null,U.IX&&U.IX(C,X),e.multiComps.push({entID:C,data:K}),z())}}(K,A,t,X),C}};var m=K(13758)},13758:C=>{function U(C,U){var K=C._map[U];if(delete C.hash[U],delete C._map[U],K===C.list.length-1)C.list.pop();else{var m=C.list.pop();if(C.list[K]=m,null===m||null===m[0]){var O=C.list.length;for(var X in C._map)if(C._map[X]===O)return void(C._map[X]=K)}else{var A=m.Be||m[0].Be;C._map[A]=K}}}C.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(C,U){if("number"===typeof this._map[C]){var K=this._map[C];this.hash[C]=U,this.list[K]=U}else this._map[C]=this.list.length,this.hash[C]=U,this.list.push(U)}remove(C){var U=this._map[C];this.hash[C]=null,this.list[U]=null,this._pendingRemovals.push(C)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var C=0;C<this._pendingRemovals.length;C++){var K=this._pendingRemovals[C];null===this.hash[K]&&U(this,K)}this._pendingRemovals.length=0}}},13719:C=>{"use strict";var U,K="object"===typeof Reflect?Reflect:null,m=function(C,U,K){return Function.prototype.apply.call(C,U,K)};U=K&&"function"===typeof K.ownKeys?K.ownKeys:Object.getOwnPropertySymbols?function(C){return Object.getOwnPropertyNames(C).concat(Object.getOwnPropertySymbols(C))}:function(C){return Object.getOwnPropertyNames(C)};var O=Number.isNaN||function(C){return C!==C};function X(){X.init.call(this)}C.exports=X,C.exports.once=function(C,U){return new Promise((function(K,m){function O(K){C.removeListener(U,X),m(K)}function X(){"function"===typeof C.removeListener&&C.removeListener("error",O),K([].slice.call(arguments))}v(C,U,X,{once:!0}),"error"!==U&&function(C,U,K){"function"===typeof C.on&&v(C,"error",U,K)}(C,O,{once:!0})}))},X.EventEmitter=X,X.prototype._events=void 0,X.prototype._eventsCount=0,X.prototype._maxListeners=void 0;var A=10;function e(C){if("function"!==typeof C)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}function t(C){return void 0===C._maxListeners?X.defaultMaxListeners:C._maxListeners}function z(C,U,K,m){var O,X,A,z;if(e(K),void 0===(X=C._events)?(X=C._events=Object.create(null),C._eventsCount=0):(void 0!==X.newListener&&(C.emit("newListener",U,K.listener?K.listener:K),X=C._events),A=X[U]),void 0===A)A=X[U]=K,++C._eventsCount;else if("function"===typeof A?A=X[U]=m?[K,A]:[A,K]:m?A.unshift(K):A.push(K),(O=t(C))>0&&A.length>O&&!A.warned){A.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(U)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.mU=C,j.type=U,j.count=A.length,z=j,console&&console.warn&&console.warn(z)}return C}function j(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(C,U,K){var m={fired:!1,wrapFn:void 0,target:C,type:U,listener:K},O=j.bind(m);return O.listener=K,m.wrapFn=O,O}function E(C,U,K){var m=C._events;if(void 0===m)return[];var O=m[U];return void 0===O?[]:"function"===typeof O?K?[O.listener||O]:[O]:K?function(C){for(var U=new Array(C.length),K=0;K<U.length;++K)U[K]=C[K].listener||C[K];return U}(O):b(O,O.length)}function u(C){var U=this._events;if(void 0!==U){var K=U[C];if("function"===typeof K)return 1;if(void 0!==K)return K.length}return 0}function b(C,U){for(var K=new Array(U),m=0;m<U;++m)K[m]=C[m];return K}function v(C,U,K,m){if("function"===typeof C.on)m.once?C.once(U,K):C.on(U,K);else{if("function"!==typeof C.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C);C.addEventListener(U,(function O(X){m.once&&C.removeEventListener(U,O),K(X)}))}}Object.defineProperty(X,"defaultMaxListeners",{enumerable:!0,get:function(){return A},set:function(C){if("number"!==typeof C||C<0||O(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");A=C}}),X.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},X.prototype.setMaxListeners=function(C){if("number"!==typeof C||C<0||O(C))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+C+".");return this._maxListeners=C,this},X.prototype.getMaxListeners=function(){return t(this)},X.prototype.emit=function(C){for(var U=[],K=1;K<arguments.length;K++)U.push(arguments[K]);var O="error"===C,X=this._events;if(void 0!==X)O=O&&void 0===X.error;else if(!O)return!1;if(O){var A;if(U.length>0&&(A=U[0]),A instanceof Error)throw A;var e=new Error("Unhandled error."+(A?" ("+A.message+")":""));throw e.context=A,e}var t=X[C];if(void 0===t)return!1;if("function"===typeof t)m(t,this,U);else{var z=t.length,j=b(t,z);for(K=0;K<z;++K)m(j[K],this,U)}return!0},X.prototype.addListener=function(C,U){return z(this,C,U,!1)},X.prototype.on=X.prototype.addListener,X.prototype.prependListener=function(C,U){return z(this,C,U,!0)},X.prototype.once=function(C,U){return e(U),this.on(C,p(this,C,U)),this},X.prototype.prependOnceListener=function(C,U){return e(U),this.prependListener(C,p(this,C,U)),this},X.prototype.removeListener=function(C,U){var K,m,O,X,A;if(e(U),void 0===(m=this._events))return this;if(void 0===(K=m[C]))return this;if(K===U||K.listener===U)0===--this._eventsCount?this._events=Object.create(null):(delete m[C],m.removeListener&&this.emit("removeListener",C,K.listener||U));else if("function"!==typeof K){for(O=-1,X=K.length-1;X>=0;X--)if(K[X]===U||K[X].listener===U){A=K[X].listener,O=X;break}if(O<0)return this;0===O?K.shift():function(C,U){for(;U+1<C.length;U++)C[U]=C[U+1];C.pop()}(K,O),1===K.length&&(m[C]=K[0]),void 0!==m.removeListener&&this.emit("removeListener",C,A||U)}return this},X.prototype.off=X.prototype.removeListener,X.prototype.OU=function(C){var U,K,m;if(void 0===(K=this._events))return this;if(void 0===K.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==K[C]&&(0===--this._eventsCount?this._events=Object.create(null):delete K[C]),this;if(0===arguments.length){var O,X=Object.keys(K);for(m=0;m<X.length;++m)"removeListener"!==(O=X[m])&&this.OU(O);return this.OU("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(U=K[C]))this.removeListener(C,U);else if(void 0!==U)for(m=U.length-1;m>=0;m--)this.removeListener(C,U[m]);return this},X.prototype.listeners=function(C){return E(this,C,!0)},X.prototype.rawListeners=function(C){return E(this,C,!1)},X.listenerCount=function(C,U){return"function"===typeof C.listenerCount?C.listenerCount(U):u.call(C,U)},X.prototype.listenerCount=u,X.prototype.eventNames=function(){return this._eventsCount>0?U(this._events):[]}},14012:C=>{"use strict";C.exports=function(C,U,K,m,O,X){var A=+U[0],e=+U[1],t=+U[2],z=+K[0],j=+K[1],p=+K[2],E=Math.sqrt(z*z+j*j+p*p);if(0===E)throw new Error("Can't raycast along a zero vector");return function(C,U,K,m,O,X,A,e,t,z){for(var j=0,p=Math.floor,E=0|p(U),u=0|p(K),b=0|p(m),v=O>0?1:-1,Q=X>0?1:-1,V=A>0?1:-1,f=Math.abs(1/O),F=Math.abs(1/X),Z=Math.abs(1/A),P=f<1/0?f*(v>0?E+1-U:U-E):1/0,H=F<1/0?F*(Q>0?u+1-K:K-u):1/0,d=Z<1/0?Z*(V>0?b+1-m:m-b):1/0,T=-1;j<=e;){var y=C(E,u,b);if(y)return t&&(t[0]=U+j*O,t[1]=K+j*X,t[2]=m+j*A),z&&(z[0]=z[1]=z[2]=0,0===T&&(z[0]=-v),1===T&&(z[1]=-Q),2===T&&(z[2]=-V)),y;P<H?P<d?(E+=v,j=P,P+=f,T=0):(b+=V,j=d,d+=Z,T=2):H<d?(u+=Q,j=H,H+=F,T=1):(b+=V,j=d,d+=Z,T=2)}return t&&(t[0]=U+j*O,t[1]=K+j*X,t[2]=m+j*A),z&&(z[0]=z[1]=z[2]=0),0}(C,A,e,t,z/=E,j/=E,p/=E,m="undefined"===typeof m?64:+m,O,X)}},14049:(C,U,K)=>{"use strict";K.d(U,{b:()=>X});var m=K(13719);function O(){this.pE=!1,this.stopPropagation=!1,this.EE=!1,this.disabled=!1}class X{constructor(C,U){this.version="0.7.0";var K=Object.assign({},new O,U||{});this.element=C||document,this.pE=!!K.pE,this.stopPropagation=!!K.stopPropagation,this.EE=!!K.EE,this.disabled=!!K.disabled,this.filterEvents=(C,U)=>!0,this.down=new m.EventEmitter,this.up=new m.EventEmitter,this.state={},this.hz={dx:0,dy:0,Uu:0,wz:0,Ku:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?e(this):document.addEventListener("DOMContentLoaded",(C=>{e(this)}),{once:!0})}bind(C){for(var U=arguments.length,K=new Array(U>1?U-1:0),m=1;m<U;m++)K[m-1]=arguments[m];K.forEach((U=>{var K=this._keyBindmap[U]||[];K.includes(C)||(K.push(C),this._keyBindmap[U]=K)})),this.state[C]=!!this.state[C],this.pressCount[C]=this.pressCount[C]||0,this.releaseCount[C]=this.releaseCount[C]||0}unbind(C){for(var U in this._keyBindmap){var K=this._keyBindmap[U],m=K.indexOf(C);m>-1&&K.splice(m,1)}}getBindings(){var C={};for(var U in this._keyBindmap){this._keyBindmap[U].forEach((K=>{C[K]=C[K]||[],C[K].push(U)}))}return C}YA(){A(this.hz),A(this.pressCount),A(this.releaseCount)}}function A(C){for(var U in C)C[U]=0}function e(C){window.addEventListener("keydown",b.bind(null,C,!0),!1),window.addEventListener("keyup",b.bind(null,C,!1),!1);var U={passive:!0};C.element.addEventListener("touchstart",p.bind(void 0,C),{passive:!1}),C.element.addEventListener("touchend",u.bind(void 0,C),U),C.element.addEventListener("mousedown",v.bind(null,C,!0),U),window.document.addEventListener("mouseup",v.bind(null,C,!1),U),C.element.addEventListener("touchmove",Q.bind(null,C),U),C.element.addEventListener("mousemove",Q.bind(null,C),U),window.PointerEvent,C.element.addEventListener("wheel",V.bind(null,C),U),C.element.addEventListener("contextmenu",f.bind(null,C),!1),window.addEventListener("blur",F.bind(null,C),!1)}var t=0,z=0,j=null;function p(C,U){U.preventDefault(),E(U)}function E(C){let U=!1;for(let K=0;K<C.touches.length;++K)if(C.touches[K].identifier===j){U=!0;break}if(!U){const U=C.changedTouches[0];t=U.clientX,z=U.clientY,j=U.identifier}}function u(C,U){for(var K=U.changedTouches,m=0;m<K.length;++m)K[m].identifier===j&&(j=null)}function b(C,U,K){Z(K.code,U,C,K)}function v(C,U,K){if("pointerId"in K)if(U){if(null!==C._touches.currID)return;C._touches.currID=K.pointerId}else{if(C._touches.currID!==K.pointerId)return;C._touches.currID=null}return Z("Mouse"+("button"in K?K.button+1:1),U,C,K),!1}function Q(C,U){var K=U.movementX||U.mozMovementX||0,m=U.movementY||U.mozMovementY||0;if(U.touches&&0===(K|m)){var O=function(C){E(C);for(let U=0;U<C.changedTouches.length;++U)if(C.changedTouches[U].identifier==j){const K=C.changedTouches[U],m=[K.clientX-t,K.clientY-z];return t=K.clientX,z=K.clientY,m}return console.error(`Did not find touch id ${j}`),[0,0]}(U);K=O[0],m=O[1]}C.hz.dx+=K,C.hz.dy+=m}function V(C,U){var K=1;switch(U.deltaMode){case 0:K=1;break;case 1:K=12;break;case 2:K=C.element.clientHeight||window.innerHeight}C.hz.Uu+=(U.deltaX||0)*K,C.hz.wz+=(U.deltaY||0)*K,C.hz.Ku+=(U.deltaZ||0)*K}function f(C,U){if(!C.EE)return U.preventDefault(),!1}function F(C){for(var U in C._keyStates)C._keyStates[U]&&(/^Mouse\d/.test(U)||Z(U,!1,C,{code:U,note:"4ui9h9js6ov",preventDefault:()=>{},stopPropagation:()=>{}}))}function Z(C,U,K,m){var O=K._keyBindmap[C];O&&(P(K._keyStates[C],U)&&(K._keyStates[C]=U,O.forEach((C=>{(!K.filterEvents||K.filterEvents(m,C))&&function(C,U,K,m){var O=U?K.pressCount:K.releaseCount;O[C]=(O[C]||0)+1;var X=K._bindPressCount[C]||0;(X+=U?1:-1)<0&&(X=0);K._bindPressCount[C]=X;var A=K.state[C];if(P(A,X)){K.state[C]=X>0;var e=U?K.down:K.up;K.disabled||e.emit(C,m)}}(C,U,K,m)}))),"button"in m||(K.pE&&!m.defaultPrevented&&m.preventDefault(),K.stopPropagation&&m.stopPropagation()))}function P(C,U){return C?!U:U}},12691:C=>{C.exports=function(C,U,K){return C[0]=U[0]+K[0],C[1]=U[1]+K[1],C[2]=U[2]+K[2],C}},12651:(C,U,K)=>{C.exports=function(C,U){var K=m(C[0],C[1],C[2]),A=m(U[0],U[1],U[2]);O(K,K),O(A,A);var e=X(K,A);return e>1?0:Math.acos(e)};var m=K(12655),O=K(12664),X=K(12670)},12736:C=>{C.exports=function(C,U){return C[0]=Math.ceil(U[0]),C[1]=Math.ceil(U[1]),C[2]=Math.ceil(U[2]),C}},12644:C=>{C.exports=function(C){var U=new Float32Array(3);return U[0]=C[0],U[1]=C[1],U[2]=C[2],U}},12672:C=>{C.exports=function(C,U){return C[0]=U[0],C[1]=U[1],C[2]=U[2],C}},12638:C=>{C.exports=function(){var C=new Float32Array(3);return C[0]=0,C[1]=0,C[2]=0,C}},12804:C=>{C.exports=function(C,U,K){var m=U[0],O=U[1],X=U[2],A=K[0],e=K[1],t=K[2];return C[0]=O*t-X*e,C[1]=X*A-m*t,C[2]=m*e-O*A,C}},12761:(C,U,K)=>{C.exports=K(12758)},12758:C=>{C.exports=function(C,U){var K=U[0]-C[0],m=U[1]-C[1],O=U[2]-C[2];return Math.sqrt(K*K+m*m+O*O)}},12712:(C,U,K)=>{C.exports=K(12709)},12709:C=>{C.exports=function(C,U,K){return C[0]=U[0]/K[0],C[1]=U[1]/K[1],C[2]=U[2]/K[2],C}},12670:C=>{C.exports=function(C,U){return C[0]*U[0]+C[1]*U[1]+C[2]*U[2]}},12634:C=>{C.exports=1e-6},12679:(C,U,K)=>{C.exports=function(C,U){var K=C[0],O=C[1],X=C[2],A=U[0],e=U[1],t=U[2];return Math.abs(K-A)<=m*Math.max(1,Math.abs(K),Math.abs(A))&&Math.abs(O-e)<=m*Math.max(1,Math.abs(O),Math.abs(e))&&Math.abs(X-t)<=m*Math.max(1,Math.abs(X),Math.abs(t))};var m=K(12634)},12683:C=>{C.exports=function(C,U){return C[0]===U[0]&&C[1]===U[1]&&C[2]===U[2]}},12728:C=>{C.exports=function(C,U){return C[0]=Math.floor(U[0]),C[1]=Math.floor(U[1]),C[2]=Math.floor(U[2]),C}},12859:(C,U,K)=>{C.exports=function(C,U,K,O,X,A){var e,t;U||(U=3);K||(K=0);t=O?Math.min(O*U+K,C.length):C.length;for(e=K;e<t;e+=U)m[0]=C[e],m[1]=C[e+1],m[2]=C[e+2],X(m,m,A),C[e]=m[0],C[e+1]=m[1],C[e+2]=m[2];return C};var m=K(12638)()},12655:C=>{C.exports=function(C,U,K){var m=new Float32Array(3);return m[0]=C,m[1]=U,m[2]=K,m}},12628:(C,U,K)=>{C.exports={EPSILON:K(12634),create:K(12638),clone:K(12644),angle:K(12651),BA:K(12655),k:K(12672),set:K(12677),equals:K(12679),exactEquals:K(12683),add:K(12691),vU:K(12694),sub:K(12699),multiply:K(12701),mul:K(12706),divide:K(12709),div:K(12712),min:K(12718),max:K(12721),floor:K(12728),ceil:K(12736),round:K(12741),scale:K(12743),kA:K(12752),distance:K(12758),j:K(12761),squaredDistance:K(12763),sqrDist:K(12765),length:K(12774),len:K(12776),squaredLength:K(12784),wA:K(12793),negate:K(12795),inverse:K(12797),normalize:K(12664),dot:K(12670),cross:K(12804),GA:K(12812),random:K(12814),transformMat4:K(12823),transformMat3:K(12826),transformQuat:K(12835),hA:K(12844),cA:K(12848),NA:K(12853),forEach:K(12859)}},12797:C=>{C.exports=function(C,U){return C[0]=1/U[0],C[1]=1/U[1],C[2]=1/U[2],C}},12776:(C,U,K)=>{C.exports=K(12774)},12774:C=>{C.exports=function(C){var U=C[0],K=C[1],m=C[2];return Math.sqrt(U*U+K*K+m*m)}},12812:C=>{C.exports=function(C,U,K,m){var O=U[0],X=U[1],A=U[2];return C[0]=O+m*(K[0]-O),C[1]=X+m*(K[1]-X),C[2]=A+m*(K[2]-A),C}},12721:C=>{C.exports=function(C,U,K){return C[0]=Math.max(U[0],K[0]),C[1]=Math.max(U[1],K[1]),C[2]=Math.max(U[2],K[2]),C}},12718:C=>{C.exports=function(C,U,K){return C[0]=Math.min(U[0],K[0]),C[1]=Math.min(U[1],K[1]),C[2]=Math.min(U[2],K[2]),C}},12706:(C,U,K)=>{C.exports=K(12701)},12701:C=>{C.exports=function(C,U,K){return C[0]=U[0]*K[0],C[1]=U[1]*K[1],C[2]=U[2]*K[2],C}},12795:C=>{C.exports=function(C,U){return C[0]=-U[0],C[1]=-U[1],C[2]=-U[2],C}},12664:C=>{C.exports=function(C,U){var K=U[0],m=U[1],O=U[2],X=K*K+m*m+O*O;X>0&&(X=1/Math.sqrt(X),C[0]=U[0]*X,C[1]=U[1]*X,C[2]=U[2]*X);return C}},12814:C=>{C.exports=function(C,U){U=U||1;var K=2*Math.random()*Math.PI,m=2*Math.random()-1,O=Math.sqrt(1-m*m)*U;return C[0]=Math.cos(K)*O,C[1]=Math.sin(K)*O,C[2]=m*U,C}},12844:C=>{C.exports=function(C,U,K,m){var O=K[1],X=K[2],A=U[1]-O,e=U[2]-X,t=Math.sin(m),z=Math.cos(m);return C[0]=U[0],C[1]=O+A*z-e*t,C[2]=X+A*t+e*z,C}},12848:C=>{C.exports=function(C,U,K,m){var O=K[0],X=K[2],A=U[0]-O,e=U[2]-X,t=Math.sin(m),z=Math.cos(m);return C[0]=O+e*t+A*z,C[1]=U[1],C[2]=X+e*z-A*t,C}},12853:C=>{C.exports=function(C,U,K,m){var O=K[0],X=K[1],A=U[0]-O,e=U[1]-X,t=Math.sin(m),z=Math.cos(m);return C[0]=O+A*z-e*t,C[1]=X+A*t+e*z,C[2]=U[2],C}},12741:C=>{C.exports=function(C,U){return C[0]=Math.round(U[0]),C[1]=Math.round(U[1]),C[2]=Math.round(U[2]),C}},12743:C=>{C.exports=function(C,U,K){return C[0]=U[0]*K,C[1]=U[1]*K,C[2]=U[2]*K,C}},12752:C=>{C.exports=function(C,U,K,m){return C[0]=U[0]+K[0]*m,C[1]=U[1]+K[1]*m,C[2]=U[2]+K[2]*m,C}},12677:C=>{C.exports=function(C,U,K,m){return C[0]=U,C[1]=K,C[2]=m,C}},12765:(C,U,K)=>{C.exports=K(12763)},12793:(C,U,K)=>{C.exports=K(12784)},12763:C=>{C.exports=function(C,U){var K=U[0]-C[0],m=U[1]-C[1],O=U[2]-C[2];return K*K+m*m+O*O}},12784:C=>{C.exports=function(C){var U=C[0],K=C[1],m=C[2];return U*U+K*K+m*m}},12699:(C,U,K)=>{C.exports=K(12694)},12694:C=>{C.exports=function(C,U,K){return C[0]=U[0]-K[0],C[1]=U[1]-K[1],C[2]=U[2]-K[2],C}},12826:C=>{C.exports=function(C,U,K){var m=U[0],O=U[1],X=U[2];return C[0]=m*K[0]+O*K[3]+X*K[6],C[1]=m*K[1]+O*K[4]+X*K[7],C[2]=m*K[2]+O*K[5]+X*K[8],C}},12823:C=>{C.exports=function(C,U,K){var m=U[0],O=U[1],X=U[2],A=K[3]*m+K[7]*O+K[11]*X+K[15];return A=A||1,C[0]=(K[0]*m+K[4]*O+K[8]*X+K[12])/A,C[1]=(K[1]*m+K[5]*O+K[9]*X+K[13])/A,C[2]=(K[2]*m+K[6]*O+K[10]*X+K[14])/A,C}},12835:C=>{C.exports=function(C,U,K){var m=U[0],O=U[1],X=U[2],A=K[0],e=K[1],t=K[2],z=K[3],j=z*m+e*X-t*O,p=z*O+t*m-A*X,E=z*X+A*O-e*m,u=-A*m-e*O-t*X;return C[0]=j*z+u*-A+p*-t-E*-e,C[1]=p*z+u*-e+E*-A-j*-t,C[2]=E*z+u*-t+j*-e-p*-A,C}},13738:C=>{"use strict";C.exports=function(C){for(var U=new Array(C),K=0;K<C;++K)U[K]=K;return U}},13812:C=>{C.exports=function(C){return null!=C&&null!=C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}},14020:(C,U,K)=>{"use strict";K.d(U,{b:()=>m});class m{constructor(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.xj=!1,this.nj=!1,this.Yj=30,this.Wj=0,this.Kp=!1,this.fullscreen=!1,this.sj=function(C){},this.Rj=function(){},this.Cp=function(){},this.WA=function(){},this.qj=function(C){},this.onFullscreenChanged=function(C){},z((()=>{!function(C,U){C._nowObject=performance||Date,C._lastTick=0,C._renderAccum=0,C._rt=0,C._frameCB=e.bind(null,C),requestAnimationFrame(C._frameCB),U>0&&(C._intervalCB=A.bind(null,C),C._interval=setInterval(C._intervalCB,Math.max(U,1e3/C.Yj/2)))}(this,U),function(C,U){if(!U)return;var K=!1,m=!1;document.addEventListener("pointerlockchange",(m=>{K=document.pointerLockElement===U,C.qj(K)})),document.addEventListener("fullscreenchange",(K=>{m=document.fullscreenElement===U,C.onFullscreenChanged(m)})),Object.defineProperty(C,"Kp",{get:()=>K,set:C=>{C&&!K?t(U):K&&!C&&function(C){C.exitPointerLock&&C.exitPointerLock()}(document)}}),Object.defineProperty(C,"fullscreen",{get:()=>m,set:C=>{C&&!m?U.requestFullscreen():m&&!C&&document.exitFullscreen()}}),U.addEventListener("click",(O=>{C.xj&&!K&&t(U),C.nj&&!m&&U.requestFullscreen()}));var O=()=>C.WA();if(window.ResizeObserver){new ResizeObserver(O).observe(U)}else window.addEventListener("resize",O)}(this,C),this.Cp()}))}}var O=3,X=20;function A(C){for(var U=1e3/C.Yj,K=C._nowObject.now()+X,m=0;C._nowObject.now()>=C._lastTick+U&&C._nowObject.now()<K&&++m<=O;)C.sj(U),C._lastTick+=U;var A=5*(U+5),e=C._nowObject.now();if(e-C._lastTick>A)for(;e>=C._lastTick+U;)C._lastTick+=U}function e(C){requestAnimationFrame(C._frameCB),A(C);var U=C._nowObject.now(),K=U-C._rt;if(C._rt=U,C.Wj>0){C._renderAccum+=K;var m=1e3/C.Wj;if(C._renderAccum<m)return;C._renderAccum=Math.min(C._renderAccum-m,m)}var O=1e3/C.Yj,X=(U-C._lastTick)/O;C.Rj(K,X,O)}function t(C){C.requestPointerLock&&C.requestPointerLock()}var z=C=>{if("loading"===document.readyState){var U=()=>{document.removeEventListener("readystatechange",U),C()};document.addEventListener("readystatechange",U)}else setTimeout(C,1)}},13736:(C,U,K)=>{var m=K(13738),O=K(13742),X="undefined"!==typeof Float64Array;function A(C,U){return C[0]-U[0]}function e(){var C,U=this.stride,K=new Array(U.length);for(C=0;C<K.length;++C)K[C]=[Math.abs(U[C]),C];K.sort(A);var m=new Array(K.length);for(C=0;C<m.length;++C)m[C]=K[C][1];return m}function t(C,U){var K=["View",U,"d",C].join("");U<0&&(K="View_Nil"+C);var O="generic"===C;if(-1===U){var X="function "+K+"(a){this.data=a;};var proto="+K+".prototype;proto.dtype='"+C+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+K+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+K+"(a){return new "+K+"(a);}";return new Function(X)()}if(0===U){X="function "+K+"(a,d) {this.data = a;this.offset = d};var proto="+K+".prototype;proto.dtype='"+C+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+K+"_copy() {return new "+K+"(this.data,this.offset)};proto.pick=function "+K+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+K+"_get(){return "+(O?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+K+"_set(v){return "+(O?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+K+"(a,b,c,d){return new "+K+"(a,d)}";return new Function("TrivialArray",X)(z[C][0])}X=["'use strict'"];var A=m(U),t=A.map((function(C){return"i"+C})),j="this.offset+"+A.map((function(C){return"this.stride["+C+"]*i"+C})).join("+"),p=A.map((function(C){return"b"+C})).join(","),E=A.map((function(C){return"c"+C})).join(",");X.push("function "+K+"(a,"+p+","+E+",d){this.data=a","this.shape=["+p+"]","this.stride=["+E+"]","this.offset=d|0}","var proto="+K+".prototype","proto.dtype='"+C+"'","proto.dimension="+U),X.push("Object.defineProperty(proto,'size',{get:function "+K+"_size(){return "+A.map((function(C){return"this.shape["+C+"]"})).join("*"),"}})"),1===U?X.push("proto.order=[0]"):(X.push("Object.defineProperty(proto,'order',{get:"),U<4?(X.push("function "+K+"_order(){"),2===U?X.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&X.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):X.push("ORDER})")),X.push("proto.set=function "+K+"_set("+t.join(",")+",v){"),O?X.push("return this.data.set("+j+",v)}"):X.push("return this.data["+j+"]=v}"),X.push("proto.get=function "+K+"_get("+t.join(",")+"){"),O?X.push("return this.data.get("+j+")}"):X.push("return this.data["+j+"]}"),X.push("proto.index=function "+K+"_index(",t.join(),"){return "+j+"}"),X.push("proto.hi=function "+K+"_hi("+t.join(",")+"){return new "+K+"(this.data,"+A.map((function(C){return["(typeof i",C,"!=='number'||i",C,"<0)?this.shape[",C,"]:i",C,"|0"].join("")})).join(",")+","+A.map((function(C){return"this.stride["+C+"]"})).join(",")+",this.offset)}");var u=A.map((function(C){return"a"+C+"=this.shape["+C+"]"})),b=A.map((function(C){return"c"+C+"=this.stride["+C+"]"}));X.push("proto.lo=function "+K+"_lo("+t.join(",")+"){var b=this.offset,d=0,"+u.join(",")+","+b.join(","));for(var v=0;v<U;++v)X.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");X.push("return new "+K+"(this.data,"+A.map((function(C){return"a"+C})).join(",")+","+A.map((function(C){return"c"+C})).join(",")+",b)}"),X.push("proto.step=function "+K+"_step("+t.join(",")+"){var "+A.map((function(C){return"a"+C+"=this.shape["+C+"]"})).join(",")+","+A.map((function(C){return"b"+C+"=this.stride["+C+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(v=0;v<U;++v)X.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");X.push("return new "+K+"(this.data,"+A.map((function(C){return"a"+C})).join(",")+","+A.map((function(C){return"b"+C})).join(",")+",c)}");var Q=new Array(U),V=new Array(U);for(v=0;v<U;++v)Q[v]="a[i"+v+"]",V[v]="b[i"+v+"]";X.push("proto.transpose=function "+K+"_transpose("+t+"){"+t.map((function(C,U){return C+"=("+C+"===undefined?"+U+":"+C+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+K+"(this.data,"+Q.join(",")+","+V.join(",")+",this.offset)}"),X.push("proto.pick=function "+K+"_pick("+t+"){var a=[],b=[],c=this.offset");for(v=0;v<U;++v)X.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return X.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),X.push("return function construct_"+K+"(data,shape,stride,offset){return new "+K+"(data,"+A.map((function(C){return"shape["+C+"]"})).join(",")+","+A.map((function(C){return"stride["+C+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",X.join("\n"))(z[C],e)}var z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};C.exports=function(C,U,K,m){if(void 0===C)return(0,z.array[0])([]);"number"===typeof C&&(C=[C]),void 0===U&&(U=[C.length]);var A=U.length;if(void 0===K){K=new Array(A);for(var e=A-1,j=1;e>=0;--e)K[e]=j,j*=U[e]}if(void 0===m){m=0;for(e=0;e<A;++e)K[e]<0&&(m-=(U[e]-1)*K[e])}for(var p=function(C){if(O(C))return"buffer";if(X)switch(Object.prototype.toString.call(C)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(C)?"array":"generic"}(C),E=z[p];E.length<=A+1;)E.push(t(p,E.length-1));return(0,E[A+1])(C,U,K,m)}},13742:C=>{function U(C){return!!C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}C.exports=function(C){return null!=C&&(U(C)||function(C){return"function"===typeof C.readFloatLE&&"function"===typeof C.slice&&U(C.slice(0,0))}(C)||!!C._isBuffer)}},13890:C=>{"use strict";var U=[],K=[],m=[],O=[],X=[],A=[],e=[],t=[],z=[],j=[],p=[],E=[];C.exports=function(C,u,b,v,Q,V){for(var f=e,F=z,Z=j,P=E,H=0;H<3;H++)f[H]=+b[H],Z[H]=+u.max[H],F[H]=+u.base[H];V||(V=1e-10);var d=function(C,e,z,j,E,u){var b=U,v=K,Q=m,V=O,f=X,F=A,Z=t,P=Math.floor,H=0,d=0,T=0,y=0,a=0;if(r(),0===T)return 0;for(y=l();d<=T;){if(i(y)&&D())return H;y=l()}for(H+=T,a=0;a<3;a++)j[a]+=z[a],E[a]+=z[a];return H;function r(){if(d=0,0!==(T=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2])))for(var C=0;C<3;C++){var U=z[C]>=0;V[C]=U?1:-1;var K=U?E[C]:j[C];b[C]=U?j[C]:E[C],v[C]=G(K,V[C]),Q[C]=J(b[C],V[C]),Z[C]=z[C]/T,f[C]=Math.abs(1/Z[C]);var m=U?v[C]+1-K:K-v[C];F[C]=f[C]<1/0?f[C]*m:1/0}}function i(U){for(var K=V[0],m=0===U?v[0]:Q[0],O=v[0]+K,X=V[1],A=1===U?v[1]:Q[1],e=v[1]+X,t=V[2],z=2===U?v[2]:Q[2],j=v[2]+t,p=m;p!=O;p+=K)for(var E=A;E!=e;E+=X)for(var u=z;u!=j;u+=t)if(C(p,E,u))return!0;return!1}function D(){H+=d;var C=V[y],U=d/T,K=p;for(a=0;a<3;a++){var m=z[a]*U;j[a]+=m,E[a]+=m,K[a]=z[a]-m}if(C>0?E[y]=Math.round(E[y]):j[y]=Math.round(j[y]),e(H,y,C,K))return!0;for(a=0;a<3;a++)z[a]=K[a];return r(),0===T}function l(){var C=F[0]<F[1]?F[0]<F[2]?0:2:F[1]<F[2]?1:2,U=F[C]-d;for(d=F[C],v[C]+=V[C],F[C]+=f[C],a=0;a<3;a++)b[a]+=U*Z[a],Q[a]=J(b[a],V[a]);return C}function G(C,U){return P(C-U*u)}function J(C,U){return P(C+U*u)}}(C,v,f,F,Z,V);if(!Q){for(H=0;H<3;H++)P[H]=b[H]>0?Z[H]-u.max[H]:F[H]-u.base[H];u.translate(P)}return d}},14053:(C,U,K)=>{"use strict";K.d(U,{c:()=>p});var m=K(13886),O=K(12628);class X{constructor(C,U,K,X,A,e,t){this.Lz=new m(C.base,C.ej),this.cO=U,this.friction=K,this.restitution=X,this.TA=A,this.Pu=e,this.yA=!!t,this.Aj=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.lb=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Vz=O.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=O.create(),this._impulses=O.create(),this._sleepFrameCount=10}loadFromCopy(C){O.k(this.Lz.base,C.Lz.base),O.k(this.Lz.ej,C.Lz.ej),O.k(this.Lz.max,C.Lz.max),this.Lz.mag=C.Lz.mag,this.cO=C.cO,this.friction=C.friction,this.restitution=C.restitution,this.TA=C.TA,this.Pu=C.Pu,this.yA=C.yA,this.Aj=C.Aj,this.fluidDrag=C.fluidDrag,this.lb=C.lb,this.preventFallOffEdge=C.preventFallOffEdge,this.rolledBackLastTick=C.rolledBackLastTick,O.k(this.Vz,C.Vz),O.k(this.resting,C.resting),this.inFluid=C.inFluid,this._ratioInFluid=C._ratioInFluid,O.k(this._forces,C._forces),O.k(this._impulses,C._impulses),this._sleepFrameCount=C._sleepFrameCount}setPosition(C){A(C),O.vU(C,C,this.Lz.base),this.Lz.translate(C),this.Zz()}xA(){return O.clone(this.Lz.base)}applyForce(C){A(C),O.add(this._forces,this._forces,C),this.Zz()}applyImpulse(C){A(C),O.add(this._impulses,this._impulses,C),this.Zz()}Zz(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var A=C=>{};var e=K(13886),t=K(12628),z=K(13890);function j(){this.Aj=.1,this.fluidDrag=.4,this.lA=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function p(C,U,K){C=Object.assign(new j,C),this.gravity=C.gravity||[0,-10,0],this.Aj=C.Aj||.1,this.lA=C.lA||2,this.fluidDrag=C.fluidDrag||.4,this.minBounceImpulse=C.minBounceImpulse,this.bodies=[],this.YE=C.YE,this.testSolid=U,this.testFluid=K}p.prototype.iu=function(C,U,K,m,O,A){C=C||new e([0,0,0],[1,1,1]),"undefined"==typeof U&&(U=1),"undefined"==typeof K&&(K=1),"undefined"==typeof m&&(m=0),"undefined"==typeof O&&(O=1);var t=new X(C,U,K,m,O,A);return this.bodies.push(t),t},p.prototype.Du=function(C){var U=this.bodies.indexOf(C);U<0||(this.bodies.splice(U,1),C.Lz=C.Pu=null)};var E=t.create(),u=t.create(),b=t.create(),v=t.create(),Q=t.create(),V=t.create(),f=t.create(),F=new e([0,0,0],[1,1,1]),Z=new X(F,1,1,0,1,(()=>{}),!1);function P(C,U,K){return U=K,U*=1-(1-C.ratioInFluid)**2}p.prototype.YA=function(C){C/=1e3;var U=h(0,t.squaredLength(this.gravity));this.bodies.forEach((K=>function(C,U,K,m){t.k(Q,U.resting),C.YE&&Z.loadFromCopy(U);if(U.cO<=0)return t.set(U.Vz,0,0,0),t.set(U._forces,0,0,0),void t.set(U._impulses,0,0,0);var O=m||0===U.TA;if(function(C,U,K,m){if(U._sleepFrameCount>0)return!1;if(m)return!0;var O=!1,X=.5*K*K*U.TA;return t.scale(w,C.gravity,X),z(C.testSolid,U.Lz,w,(function(){return O=!0,!0}),!0),O}(C,U,K,O))return;U._sleepFrameCount--,function(C,U){var K=U.Lz,m=Math.floor(K.base[0]),O=Math.floor(K.base[2]),X=Math.floor(K.base[1]),A=Math.floor(K.max[1]);if(!C.testFluid(m,X,O))return U.inFluid=!1,void(U.ratioInFluid=0);var e=1,z=X+1;for(;z<=A&&C.testFluid(m,z,O);)e++,z++;var j=(X+e-K.base[1])/K.ej[1];j>1&&(j=1);var p=K.ej[0]*K.ej[1]*K.ej[2]*j,E=d;t.scale(E,C.gravity,-C.lA*p*U.TA),U.applyForce(E),U.inFluid=!0,U.ratioInFluid=j}(C,U),N(U._forces),N(U._impulses),N(U.Vz),N(U.resting),t.scale(E,U._forces,1/U.cO),t.kA(E,E,C.gravity,U.TA),t.scale(u,U._impulses,1/U.cO),t.kA(u,u,E,K),t.add(U.Vz,U.Vz,u),U.friction&&(T(C,0,U,u,K),T(C,1,U,u,K),T(C,2,U,u,K));var X=U.fluidDrag>=0?U.fluidDrag:C.fluidDrag,A=U.Aj>=0?U.Aj:C.Aj,e=A,j=A;U.inFluid&&(e=P(U,e,U.fluidDragHoriz>=0?U.fluidDragHoriz:X),j=P(U,j,U.fluidDragVert>=0?U.fluidDragVert:X));e=Math.max(1-e*K/U.cO,0),j=Math.max(1-j*K/U.cO,0),t.set(H,e,j,e),t.multiply(U.Vz,U.Vz,H),t.scale(b,U.Vz,K),t.set(U._forces,0,0,0),t.set(U._impulses,0,0,0),U.yA&&c(r,U.Lz);t.k(V,b),t.set(f,0,0,0),U.preventFallOffEdge&&function(C,U,K,m){if(!U.resting[1]||K[1]>0)return;var O=o;c(O,U.Lz);for(var X=0;X<3;X+=2){t.set(J,0,0,0),J[X]=K[X];var A=!0;(A=(A=(A=(A=A&&!k(C,O.base[0]+J[0]+1e-5,O.base[1],O.base[2]+J[2]+1e-5))&&!k(C,O.max[0]+J[0]-1e-5,O.base[1],O.base[2]+J[2]+1e-5))&&!k(C,O.base[0]+J[0]+1e-5,O.base[1],O.max[2]+J[2]-1e-5))&&!k(C,O.max[0]+J[0]-1e-5,O.base[1],O.max[2]+J[2]-1e-5))?(m[X]=K[X]>0?1:-1,K[X]=0):0===X&&(t.set(B,K[0],0,0),a(C,O,B,m,U.slideOnCollision))}}(C,U,b,f);a(C,U.Lz,b,U.resting,U.slideOnCollision),U.yA&&function(C,U,K,m){if(U.resting[1]>=0&&!U.inFluid)return;var O=0!==U.resting[0],X=0!==U.resting[2];if(!O&&!X)return;var A=Math.abs(m[0]/m[2]),e=4;if(!O&&A>e)return;if(!X&&A<1/e)return;t.add(D,K.base,m);var j=C.testSolid;z(j,K,m,(function(C,U,K,m){if(1!==U)return!0;m[U]=0}));var p=K.base[1],E=U.inFluid?1.951:1.001,u=Math.floor(p+E)-p;t.set(l,0,u,0);var b=!1;if(z(j,K,l,(function(C,U,K,m){return b=!0,!0})),b)return;t.vU(G,D,K.base),G[1]=0,a(C,K,G,i,!0);var v=h(K.base[0],D[0]),Q=h(K.base[2],D[2]);if(O&&!v&&(!Q||!X))return;if(X&&(!v||!O)&&!Q)return;var V=!0;if(V=V&&!k(C,K.base[0]+1e-5,K.base[1],K.base[2]+1e-5),V=V&&!k(C,K.max[0]-1e-5,K.base[1],K.base[2]+1e-5),V=V&&!k(C,K.base[0]+1e-5,K.base[1],K.max[2]-1e-5),V=V&&!k(C,K.max[0]-1e-5,K.base[1],K.max[2]-1e-5),V)return;c(U.Lz,K),U.resting[0]=i[0],U.resting[2]=i[2],U.lb&&U.lb()}(C,U,r,V);for(var p=0;p<3;++p)U.resting[p]=U.resting[p]||f[p],v[p]=0,U.resting[p]&&(Q[p]||(v[p]=-U.Vz[p]),U.Vz[p]=0);var F=t.length(v);F>.001&&(t.scale(v,v,U.cO),U.Pu&&U.Pu(v),U.restitution>0&&F>C.minBounceImpulse&&(t.scale(v,v,U.restitution),U.applyImpulse(v)));var y=t.squaredLength(U.Vz);y>1e-5&&U.Zz();C.YE&&C.YE(U)?(U.loadFromCopy(Z),U.rolledBackLastTick=!0):U.rolledBackLastTick=!1}(this,K,C,U)))};var H=t.create([0,0,0]);var d=t.create();function T(C,U,K,m,O){var X=K.resting[U],A=m[U];if(!K.alwaysApplyHorizFriction||1!==U){if(0===X)return;if(X*A<=0)return}t.k(y,K.Vz),y[U]=0;var e=t.length(y);if(!h(e,0)){var z=Math.abs(K.friction*C.gravity[U]*O),j=e>z?(e-z)/e:0;K.Vz[(U+1)%3]*=j,K.Vz[(U+2)%3]*=j}}var y=t.create();function a(C,U,K,m,O){return t.set(m,0,0,0),z(C.testSolid,U,K,(function(C,U,K,X){m[U]=K,X[U]=0,O||(X[0]=0,X[1]=0,X[2]=0)}))}var r=new e([],[]),i=t.create(),D=t.create(),l=t.create(),G=t.create();var J=t.create(),o=new e([],[]),B=t.create();function k(C,U,K,m){return C.testSolid(Math.floor(U),Math.floor(K-1),Math.floor(m))}var w=t.create();function h(C,U){return Math.abs(C-U)<1e-5}function c(C,U){for(var K=0;K<3;K++)C.base[K]=U.base[K],C.max[K]=U.max[K],C.ej[K]=U.ej[K]}var N=function(C){}},12497:function(C,U){!function(C){"use strict";var U=function(C,K){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,U){C.__proto__=U}||function(C,U){for(var K in U)Object.prototype.hasOwnProperty.call(U,K)&&(C[K]=U[K])},U(C,K)};function K(C,K){if("function"!==typeof K&&null!==K)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function m(){this.constructor=C}U(C,K),C.prototype=null===K?Object.create(K):(m.prototype=K.prototype,new m)}function m(C,U,K,m){var O,X=arguments.length,A=X<3?U:null===m?m=Object.getOwnPropertyDescriptor(U,K):m;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)A=Reflect.decorate(C,U,K,m);else for(var e=C.length-1;e>=0;e--)(O=C[e])&&(A=(X<3?O(A):X>3?O(U,K,A):O(U,K))||A);return X>3&&A&&Object.defineProperty(U,K,A),A}function O(C,U,K){if(K||2===arguments.length)for(var m,O=0,X=U.length;O<X;O++)!m&&O in U||(m||(m=Array.prototype.slice.call(U,0,O)),m[O]=U[O]);return C.concat(m||Array.prototype.slice.call(U))}var X,A=255,e=213;C.OPERATION=void 0,(X=C.OPERATION||(C.OPERATION={}))[X.ADD=128]="ADD",X[X.REPLACE=0]="REPLACE",X[X.DELETE=64]="DELETE",X[X.DELETE_AND_ADD=192]="DELETE_AND_ADD",X[X.TOUCH=1]="TOUCH",X[X.CLEAR=10]="CLEAR";var t=function(){function U(C,U,K){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=C,this.setParent(U,K)}return U.prototype.setParent=function(C,U,K){var m=this;if(this.indexes||(this.indexes=this.ref instanceof GC?this.ref._definition.indexes:{}),this.parent=C,this.parentIndex=K,U)if(this.root=U,this.ref instanceof GC){var O=this.ref._definition;for(var X in O.schema){var A=this.ref[X];if(A&&A.$changes){var e=O.indexes[X];A.$changes.setParent(this.ref,U,e)}}}else"object"===typeof this.ref&&this.ref.forEach((function(C,U){if(C instanceof GC){var K=C.$changes,O=m.ref.$changes.indexes[U];K.setParent(m.ref,m.root,O)}}))},U.prototype.operation=function(C){this.changes.set(--this.currentCustomOperation,C)},U.prototype.change=function(U,K){void 0===K&&(K=C.OPERATION.ADD);var m="number"===typeof U?U:this.indexes[U];this.assertValidIndex(m,U);var O=this.changes.get(m);O&&O.op!==C.OPERATION.DELETE&&O.op!==C.OPERATION.TOUCH||this.changes.set(m,{op:O&&O.op===C.OPERATION.DELETE?C.OPERATION.DELETE_AND_ADD:K,index:m}),this.allChanges.add(m),this.changed=!0,this.touchParents()},U.prototype.touch=function(U){var K="number"===typeof U?U:this.indexes[U];this.assertValidIndex(K,U),this.changes.has(K)||this.changes.set(K,{op:C.OPERATION.TOUCH,index:K}),this.allChanges.add(K),this.touchParents()},U.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},U.prototype.getType=function(C){if(this.ref._definition)return(U=this.ref._definition).schema[U.fieldsByIndex[C]];var U,K=(U=this.parent._definition).schema[U.fieldsByIndex[this.parentIndex]];return Object.values(K)[0]},U.prototype.getChildrenFilter=function(){var C=this.parent._definition.childFilters;return C&&C[this.parentIndex]},U.prototype.getValue=function(C){return this.ref.getByIndex(C)},U.prototype.delete=function(U){var K="number"===typeof U?U:this.indexes[U];if(void 0!==K){var m=this.getValue(K);this.changes.set(K,{op:C.OPERATION.DELETE,index:K}),this.allChanges.delete(K),delete this.caches[K],m&&m.$changes&&(m.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(U," (").concat(K,")"))},U.prototype.discard=function(U,K){var m=this;void 0===U&&(U=!1),void 0===K&&(K=!1),this.ref instanceof GC||this.changes.forEach((function(U){if(U.op===C.OPERATION.DELETE){var K=m.ref.getIndex(U.index);delete m.indexes[K]}})),this.changes.clear(),this.changed=U,K&&this.allChanges.clear(),this.currentCustomOperation=0},U.prototype.discardAll=function(){var C=this;this.changes.forEach((function(U){var K=C.getValue(U.index);K&&K.$changes&&K.$changes.discardAll()})),this.discard()},U.prototype.cache=function(C,U){this.caches[C]=U},U.prototype.clone=function(){return new U(this.ref,this.parent,this.root)},U.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},U.prototype.assertValidIndex=function(C,U){if(void 0===C)throw new Error('ChangeTree: missing index for field "'.concat(U,'"'))},U}();function z(C,U,K,m){return C[U]||(C[U]=[]),C[U].push(K),null===m||void 0===m||m.forEach((function(C,U){return K(C,U)})),function(){return p(C[U],C[U].indexOf(K))}}function j(U){var K=this,m="string"!==typeof this.$changes.getType();this.$items.forEach((function(O,X){U.push({refId:K.$changes.refId,op:C.OPERATION.DELETE,field:X,value:void 0,previousValue:O}),m&&K.$changes.root.removeRef(O.$changes.refId)}))}function p(C,U){if(-1===U||U>=C.length)return!1;for(var K=C.length-1,m=U;m<K;m++)C[m]=C[m+1];return C.length=K,!0}var E=function(C,U){var K=C.toString(),m=U.toString();return K<m?-1:K>m?1:0};function u(C){return C.$proxy=!0,C=new Proxy(C,{get:function(C,U){return"symbol"===typeof U||isNaN(U)?C[U]:C.at(U)},set:function(C,U,K){if("symbol"===typeof U||isNaN(U))C[U]=K;else{var m=Array.from(C.$items.keys()),O=parseInt(m[U]||U);void 0===K||null===K?C.deleteAt(O):C.setAt(O,K)}return!0},deleteProperty:function(C,U){return"number"===typeof U?C.deleteAt(U):delete C[U],!0}})}var b=function(){function U(){for(var C=[],U=0;U<arguments.length;U++)C[U]=arguments[U];this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,C)}return U.prototype.De=function(U,K){return void 0===K&&(K=!0),z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,U,K?this.$items:void 0)},U.prototype.IX=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,U)},U.is=function(C){return Array.isArray(C)||void 0!==C.array},Object.defineProperty(U.prototype,"length",{get:function(){return this.$items.size},set:function(C){0===C?this.clear():this.splice(C,this.length-C)},enumerable:!1,configurable:!0}),U.prototype.push=function(){for(var C,U=this,K=[],m=0;m<arguments.length;m++)K[m]=arguments[m];return K.forEach((function(K){C=U.$refId++,U.setAt(C,K)})),C},U.prototype.pop=function(){var C=Array.from(this.$indexes.values()).pop();if(void 0!==C){this.$changes.delete(C),this.$indexes.delete(C);var U=this.$items.get(C);return this.$items.delete(C),U}},U.prototype.at=function(C){var U=Array.from(this.$items.keys())[C];return this.$items.get(U)},U.prototype.setAt=function(U,K){var m,O;if(void 0!==K&&null!==K){if(this.$items.get(U)!==K){void 0!==K.$changes&&K.$changes.setParent(this,this.$changes.root,U);var X=null!==(O=null===(m=this.$changes.indexes[U])||void 0===m?void 0:m.op)&&void 0!==O?O:C.OPERATION.ADD;this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,K),this.$changes.change(U,X)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},U.prototype.deleteAt=function(C){var U=Array.from(this.$items.keys())[C];return void 0!==U&&this.$deleteAt(U)},U.prototype.$deleteAt=function(C){return this.$changes.delete(C),this.$indexes.delete(C),this.$items.delete(C)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&j.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.concat=function(){for(var C,K=[],m=0;m<arguments.length;m++)K[m]=arguments[m];return new(U.bind.apply(U,O([void 0],(C=Array.from(this.$items.values())).concat.apply(C,K),!1)))},U.prototype.join=function(C){return Array.from(this.$items.values()).join(C)},U.prototype.reverse=function(){var C=this,U=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(K,m){C.setAt(U[m],K)})),this},U.prototype.shift=function(){var C=Array.from(this.$items.keys()).shift();if(void 0!==C){var U=this.$items.get(C);return this.$deleteAt(C),U}},U.prototype.slice=function(C,K){var m=new U;return m.push.apply(m,Array.from(this.$items.values()).slice(C,K)),m},U.prototype.sort=function(C){var U=this;void 0===C&&(C=E);var K=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(C).forEach((function(C,m){U.setAt(K[m],C)})),this},U.prototype.splice=function(C,U){void 0===U&&(U=this.length-C);for(var K=Array.from(this.$items.keys()),m=[],O=C;O<C+U;O++)m.push(this.$items.get(K[O])),this.$deleteAt(K[O]);return m},U.prototype.unshift=function(){for(var C=this,U=[],K=0;K<arguments.length;K++)U[K]=arguments[K];var m=this.length,O=U.length,X=Array.from(this.$items.values());return U.forEach((function(U,K){C.setAt(K,U)})),X.forEach((function(U,K){C.setAt(O+K,U)})),m+O},U.prototype.indexOf=function(C,U){return Array.from(this.$items.values()).indexOf(C,U)},U.prototype.lastIndexOf=function(C,U){return void 0===U&&(U=this.length-1),Array.from(this.$items.values()).lastIndexOf(C,U)},U.prototype.every=function(C,U){return Array.from(this.$items.values()).every(C,U)},U.prototype.some=function(C,U){return Array.from(this.$items.values()).some(C,U)},U.prototype.forEach=function(C,U){Array.from(this.$items.values()).forEach(C,U)},U.prototype.map=function(C,U){return Array.from(this.$items.values()).map(C,U)},U.prototype.filter=function(C,U){return Array.from(this.$items.values()).filter(C,U)},U.prototype.reduce=function(C,U){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},U.prototype.reduceRight=function(C,U){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},U.prototype.find=function(C,U){return Array.from(this.$items.values()).find(C,U)},U.prototype.findIndex=function(C,U){return Array.from(this.$items.values()).findIndex(C,U)},U.prototype.fill=function(C,U,K){throw new Error("ArraySchema#fill() not implemented")},U.prototype.copyWithin=function(C,U,K){throw new Error("ArraySchema#copyWithin() not implemented")},U.prototype.toString=function(){return this.$items.toString()},U.prototype.toLocaleString=function(){return this.$items.toLocaleString()},U.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},U.prototype.includes=function(C,U){return Array.from(this.$items.values()).includes(C,U)},U.prototype.flatMap=function(C,U){throw new Error("ArraySchema#flatMap() is not supported.")},U.prototype.flat=function(C){throw new Error("ArraySchema#flat() is not supported.")},U.prototype.findLast=function(){var C=Array.from(this.$items.values());return C.findLast.apply(C,arguments)},U.prototype.findLastIndex=function(){var C=Array.from(this.$items.values());return C.findLastIndex.apply(C,arguments)},U.prototype.setIndex=function(C,U){this.$indexes.set(C,U)},U.prototype.getIndex=function(C){return this.$indexes.get(C)},U.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},U.prototype.deleteByIndex=function(C){var U=this.$indexes.get(C);this.$items.delete(U),this.$indexes.delete(C)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){return this.toArray().map((function(C){return"function"===typeof C.toJSON?C.toJSON():C}))},U.prototype.clone=function(C){return C?new(U.bind.apply(U,O([void 0],Array.from(this.$items.values()),!1))):new(U.bind.apply(U,O([void 0],this.map((function(C){return C.$changes?C.clone():C})),!1)))},U}();function v(C){return C.$proxy=!0,C=new Proxy(C,{get:function(C,U){return"symbol"!==typeof U&&"undefined"===typeof C[U]?C.get(U):C[U]},set:function(C,U,K){return"symbol"!==typeof U&&-1===U.indexOf("$")&&"De"!==U&&"IX"!==U&&"onChange"!==U?C.set(U,K):C[U]=K,!0},deleteProperty:function(C,U){return C.delete(U),!0}})}var Q=function(){function U(C){var K=this;if(this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C)if(C instanceof Map||C instanceof U)C.forEach((function(C,U){return K.set(U,C)}));else for(var m in C)this.set(m,C[m])}return U.prototype.De=function(U,K){return void 0===K&&(K=!0),z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,U,K?this.$items:void 0)},U.prototype.IX=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,U)},U.is=function(C){return void 0!==C.map},U.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(U.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(U,Symbol.species,{get:function(){return U},enumerable:!1,configurable:!0}),U.prototype.set=function(U,K){if(void 0===K||null===K)throw new Error("MapSchema#set('".concat(U,"', ").concat(K,"): trying to set ").concat(K," value on '").concat(U,"'."));U=U.toString();var m="undefined"!==typeof this.$changes.indexes[U],O=m?this.$changes.indexes[U]:this.$refId++,X=m?C.OPERATION.REPLACE:C.OPERATION.ADD,A=void 0!==K.$changes;if(A&&K.$changes.setParent(this,this.$changes.root,O),m){if(!A&&this.$items.get(U)===K)return;A&&this.$items.get(U)!==K&&(X=C.OPERATION.ADD)}else this.$changes.indexes[U]=O,this.$indexes.set(O,U);return this.$items.set(U,K),this.$changes.change(U,X),this},U.prototype.get=function(C){return this.$items.get(C)},U.prototype.delete=function(C){return this.$changes.delete(C),this.$items.delete(C)},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&j.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(C){return this.$items.has(C)},U.prototype.forEach=function(C){this.$items.forEach(C)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.keys=function(){return this.$items.keys()},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(C,U){this.$indexes.set(C,U)},U.prototype.getIndex=function(C){return this.$indexes.get(C)},U.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},U.prototype.deleteByIndex=function(C){var U=this.$indexes.get(C);this.$items.delete(U),this.$indexes.delete(C)},U.prototype.toJSON=function(){var C={};return this.forEach((function(U,K){C[K]="function"===typeof U.toJSON?U.toJSON():U})),C},U.prototype.clone=function(C){var K;return C?K=Object.assign(new U,this):(K=new U,this.forEach((function(C,U){C.$changes?K.set(U,C.clone()):K.set(U,C)}))),K},U}(),V={};function f(C,U){V[C]=U}function F(C){return V[C]}var Z=function(){function C(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return C.create=function(U){var K=new C;return K.schema=Object.assign({},U&&U.schema||{}),K.indexes=Object.assign({},U&&U.indexes||{}),K.fieldsByIndex=Object.assign({},U&&U.fieldsByIndex||{}),K.descriptors=Object.assign({},U&&U.descriptors||{}),K.deprecated=Object.assign({},U&&U.deprecated||{}),K},C.prototype.addField=function(C,U){var K=this.getNextFieldIndex();this.fieldsByIndex[K]=C,this.indexes[C]=K,this.schema[C]=Array.isArray(U)?{array:U[0]}:U},C.prototype.hasField=function(C){return void 0!==this.indexes[C]},C.prototype.addFilter=function(C,U){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[C]]=U,this.indexesWithFilters.push(this.indexes[C]),!0},C.prototype.addChildrenFilter=function(C,U){var K=this.indexes[C],m=this.schema[C];if(F(Object.keys(m)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[K]=U,!0;console.warn("@filterChildren: field '".concat(C,"' can't have children. Ignoring filter."))},C.prototype.getChildrenFilter=function(C){return this.childFilters&&this.childFilters[this.indexes[C]]},C.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},C}();function P(C){return C._context&&C._context.useFilters}var H=function(){function C(){this.types={},this.schemas=new Map,this.useFilters=!1}return C.prototype.has=function(C){return this.schemas.has(C)},C.prototype.get=function(C){return this.types[C]},C.prototype.add=function(C,U){void 0===U&&(U=this.schemas.size),C._definition=Z.create(C._definition),C._typeid=U,this.types[U]=C,this.schemas.set(C,U)},C.create=function(U){return void 0===U&&(U={}),function(K){return U.context||(U.context=new C),T(K,U)}},C}(),d=new H;function T(C,U){return void 0===U&&(U={}),function(K,m){var X=U.context||d,A=K.constructor;if(A._context=X,!C)throw new Error("".concat(A.name,': @type() reference provided for "').concat(m,"\" is undefined. Make sure you don't have any circular dependencies."));X.has(A)||X.add(A);var e=A._definition;if(e.addField(m,C),e.descriptors[m]){if(e.deprecated[m])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(m,"' definition on '").concat(A.name,"'.\nCheck @type() annotation"))}catch(V){var t=V.stack.split("\n")[4].trim();throw new Error("".concat(V.message," ").concat(t))}}var z=b.is(C),j=!z&&Q.is(C);if("string"!==typeof C&&!GC.is(C)){var p=Object.values(C)[0];"string"===typeof p||X.has(p)||X.add(p)}if(U.manual)e.descriptors[m]={enumerable:!0,configurable:!0,writable:!0};else{var E="_".concat(m);e.descriptors[E]={enumerable:!1,configurable:!1,writable:!0},e.descriptors[m]={get:function(){return this[E]},set:function(C){C!==this[E]&&(void 0!==C&&null!==C?(!z||C instanceof b||(C=new(b.bind.apply(b,O([void 0],C,!1)))),!j||C instanceof Q||(C=new Q(C)),void 0===C.$proxy&&(j?C=v(C):z&&(C=u(C))),this.$changes.change(m),C.$changes&&C.$changes.setParent(this,this.$changes.root,this._definition.indexes[m])):this[E]&&this.$changes.delete(m),this[E]=C)},enumerable:!0,configurable:!0}}}}function y(C){return function(U,K){var m=U.constructor;m._definition.addFilter(K,C)&&(m._context.useFilters=!0)}}function a(C){return function(U,K){var m=U.constructor;m._definition.addChildrenFilter(K,C)&&(m._context.useFilters=!0)}}function r(C){return void 0===C&&(C=!0),function(U,K){var m=U.constructor._definition;m.deprecated[K]=!0,C&&(m.descriptors[K]={get:function(){throw new Error("".concat(K," is deprecated."))},set:function(C){},enumerable:!1,configurable:!0})}}function i(C,U,K){for(var m in void 0===K&&(K={}),K.context||(K.context=C._context||K.context||d),U)T(U[m],K)(C.prototype,m);return C}function D(C){for(var U=0,K=0,m=0,O=C.length;m<O;m++)(U=C.charCodeAt(m))<128?K+=1:U<2048?K+=2:U<55296||U>=57344?K+=3:(m++,K+=4);return K}function l(C,U,K){for(var m=0,O=0,X=K.length;O<X;O++)(m=K.charCodeAt(O))<128?C[U++]=m:m<2048?(C[U++]=192|m>>6,C[U++]=128|63&m):m<55296||m>=57344?(C[U++]=224|m>>12,C[U++]=128|m>>6&63,C[U++]=128|63&m):(O++,m=65536+((1023&m)<<10|1023&K.charCodeAt(O)),C[U++]=240|m>>18,C[U++]=128|m>>12&63,C[U++]=128|m>>6&63,C[U++]=128|63&m)}function G(C,U){C.push(255&U)}function J(C,U){C.push(255&U)}function o(C,U){C.push(255&U),C.push(U>>8&255)}function B(C,U){C.push(255&U),C.push(U>>8&255)}function k(C,U){C.push(255&U),C.push(U>>8&255),C.push(U>>16&255),C.push(U>>24&255)}function w(C,U){var K=U>>24,m=U>>16,O=U>>8,X=U;C.push(255&X),C.push(255&O),C.push(255&m),C.push(255&K)}function h(C,U){var K=Math.floor(U/Math.pow(2,32));w(C,U>>>0),w(C,K)}function c(C,U){var K=U/Math.pow(2,32)|0;w(C,U>>>0),w(C,K)}function N(C,U){W(C,U)}function g(C,U){x(C,U)}var M=new Int32Array(2),L=new Float32Array(M.buffer),Y=new Float64Array(M.buffer);function W(C,U){L[0]=U,k(C,M[0])}function x(C,U){Y[0]=U,k(C,M[0]),k(C,M[1])}function n(C,U){return J(C,U?1:0)}function S(C,U){U||(U="");var K=D(U),m=0;if(K<32)C.push(160|K),m=1;else if(K<256)C.push(217),J(C,K),m=2;else if(K<65536)C.push(218),B(C,K),m=3;else{if(!(K<4294967296))throw new Error("String too long");C.push(219),w(C,K),m=5}return l(C,C.length,U),m+K}function s(C,U){return isNaN(U)?s(C,0):isFinite(U)?U!==(0|U)?(C.push(203),x(C,U),9):U>=0?U<128?(J(C,U),1):U<256?(C.push(204),J(C,U),2):U<65536?(C.push(205),B(C,U),3):U<4294967296?(C.push(206),w(C,U),5):(C.push(207),c(C,U),9):U>=-32?(C.push(224|U+32),1):U>=-128?(C.push(208),G(C,U),2):U>=-32768?(C.push(209),o(C,U),3):U>=-2147483648?(C.push(210),k(C,U),5):(C.push(211),h(C,U),9):s(C,U>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var R=Object.freeze({__proto__:null,utf8Write:l,int8:G,uint8:J,int16:o,uint16:B,int32:k,uint32:w,int64:h,uint64:c,float32:N,float64:g,writeFloat32:W,writeFloat64:x,boolean:n,string:S,number:s});function q(C,U,K){for(var m="",O=0,X=U,A=U+K;X<A;X++){var e=C[X];0!==(128&e)?192!==(224&e)?224!==(240&e)?240!==(248&e)?console.error("Invalid byte "+e.toString(16)):(O=(7&e)<<18|(63&C[++X])<<12|(63&C[++X])<<6|63&C[++X])>=65536?(O-=65536,m+=String.fromCharCode(55296+(O>>>10),56320+(1023&O))):m+=String.fromCharCode(O):m+=String.fromCharCode((15&e)<<12|(63&C[++X])<<6|63&C[++X]):m+=String.fromCharCode((31&e)<<6|63&C[++X]):m+=String.fromCharCode(e)}return m}function I(C,U){return CC(C,U)<<24>>24}function CC(C,U){return C[U.offset++]}function UC(C,U){return KC(C,U)<<16>>16}function KC(C,U){return C[U.offset++]|C[U.offset++]<<8}function mC(C,U){return C[U.offset++]|C[U.offset++]<<8|C[U.offset++]<<16|C[U.offset++]<<24}function OC(C,U){return mC(C,U)>>>0}function XC(C,U){return EC(C,U)}function AC(C,U){return uC(C,U)}function eC(C,U){var K=OC(C,U);return mC(C,U)*Math.pow(2,32)+K}function tC(C,U){var K=OC(C,U);return OC(C,U)*Math.pow(2,32)+K}var zC=new Int32Array(2),jC=new Float32Array(zC.buffer),pC=new Float64Array(zC.buffer);function EC(C,U){return zC[0]=mC(C,U),jC[0]}function uC(C,U){return zC[0]=mC(C,U),zC[1]=mC(C,U),pC[0]}function bC(C,U){return CC(C,U)>0}function vC(C,U){var K,m=C[U.offset++];m<192?K=31&m:217===m?K=CC(C,U):218===m?K=KC(C,U):219===m&&(K=OC(C,U));var O=q(C,U.offset,K);return U.offset+=K,O}function QC(C,U){var K=C[U.offset];return K<192&&K>160||217===K||218===K||219===K}function VC(C,U){var K=C[U.offset++];return K<128?K:202===K?EC(C,U):203===K?uC(C,U):204===K?CC(C,U):205===K?KC(C,U):206===K?OC(C,U):207===K?tC(C,U):208===K?I(C,U):209===K?UC(C,U):210===K?mC(C,U):211===K?eC(C,U):K>223?-1*(255-K+1):void 0}function fC(C,U){var K=C[U.offset];return K<128||K>=202&&K<=211}function FC(C,U){return C[U.offset]<160}function ZC(C,U){return C[U.offset-1]===A&&(C[U.offset]<128||C[U.offset]>=202&&C[U.offset]<=211)}var PC=Object.freeze({__proto__:null,int8:I,uint8:CC,int16:UC,uint16:KC,int32:mC,uint32:OC,float32:XC,float64:AC,int64:eC,uint64:tC,readFloat32:EC,readFloat64:uC,boolean:bC,string:vC,stringCheck:QC,number:VC,numberCheck:fC,arrayCheck:FC,switchStructureCheck:ZC}),HC=function(){function U(C){var U=this;this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C&&C.forEach((function(C){return U.add(C)}))}return U.prototype.De=function(U,K){return void 0===K&&(K=!0),z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,U,K?this.$items:void 0)},U.prototype.IX=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,U)},U.is=function(C){return void 0!==C.collection},U.prototype.add=function(C){var U=this.$refId++;return void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,U),this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,C),this.$changes.change(U),U},U.prototype.at=function(C){var U=Array.from(this.$items.keys())[C];return this.$items.get(U)},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(C){for(var U,K,m=this.$items.entries();(K=m.next())&&!K.done;)if(C===K.value[1]){U=K.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&j.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(C){return Array.from(this.$items.values()).some((function(U){return U===C}))},U.prototype.forEach=function(C){var U=this;this.$items.forEach((function(K,m,O){return C(K,m,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(C,U){this.$indexes.set(C,U)},U.prototype.getIndex=function(C){return this.$indexes.get(C)},U.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},U.prototype.deleteByIndex=function(C){var U=this.$indexes.get(C);this.$items.delete(U),this.$indexes.delete(C)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var C=[];return this.forEach((function(U,K){C.push("function"===typeof U.toJSON?U.toJSON():U)})),C},U.prototype.clone=function(C){var K;return C?K=Object.assign(new U,this):(K=new U,this.forEach((function(C){C.$changes?K.add(C.clone()):K.add(C)}))),K},U}(),dC=function(){function U(C){var U=this;this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,C&&C.forEach((function(C){return U.add(C)}))}return U.prototype.De=function(U,K){return void 0===K&&(K=!0),z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.ADD,U,K?this.$items:void 0)},U.prototype.IX=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,U)},U.prototype.onChange=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,U)},U.is=function(C){return void 0!==C.set},U.prototype.add=function(U){var K,m;if(this.has(U))return!1;var O=this.$refId++;void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,O);var X=null!==(m=null===(K=this.$changes.indexes[O])||void 0===K?void 0:K.op)&&void 0!==m?m:C.OPERATION.ADD;return this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,U),this.$changes.change(O,X),O},U.prototype.entries=function(){return this.$items.entries()},U.prototype.delete=function(C){for(var U,K,m=this.$items.entries();(K=m.next())&&!K.done;)if(C===K.value[1]){U=K.value[0];break}return void 0!==U&&(this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U))},U.prototype.clear=function(U){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),U&&j.call(this,U),this.$items.clear(),this.$changes.operation({index:0,op:C.OPERATION.CLEAR}),this.$changes.touchParents()},U.prototype.has=function(C){for(var U,K=this.$items.values(),m=!1;(U=K.next())&&!U.done;)if(C===U.value){m=!0;break}return m},U.prototype.forEach=function(C){var U=this;this.$items.forEach((function(K,m,O){return C(K,m,U)}))},U.prototype.values=function(){return this.$items.values()},Object.defineProperty(U.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),U.prototype.setIndex=function(C,U){this.$indexes.set(C,U)},U.prototype.getIndex=function(C){return this.$indexes.get(C)},U.prototype.getByIndex=function(C){return this.$items.get(this.$indexes.get(C))},U.prototype.deleteByIndex=function(C){var U=this.$indexes.get(C);this.$items.delete(U),this.$indexes.delete(C)},U.prototype.toArray=function(){return Array.from(this.$items.values())},U.prototype.toJSON=function(){var C=[];return this.forEach((function(U,K){C.push("function"===typeof U.toJSON?U.toJSON():U)})),C},U.prototype.clone=function(C){var K;return C?K=Object.assign(new U,this):(K=new U,this.forEach((function(C){C.$changes?K.add(C.clone()):K.add(C)}))),K},U}(),TC=function(){function C(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return C.prototype.addRefId=function(C){this.refIds.has(C)||(this.refIds.add(C),this.containerIndexes.set(C,new Set))},C.get=function(U){return void 0===U.$filterState&&(U.$filterState=new C),U.$filterState},C}(),yC=function(){function C(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return C.prototype.getNextUniqueId=function(){return this.nextUniqueId++},C.prototype.addRef=function(C,U,K){void 0===K&&(K=!0),this.refs.set(C,U),K&&(this.refCounts[C]=(this.refCounts[C]||0)+1)},C.prototype.removeRef=function(C){this.refCounts[C]=this.refCounts[C]-1,this.deletedRefs.add(C)},C.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},C.prototype.garbageCollectDeletedRefs=function(){var C=this;this.deletedRefs.forEach((function(U){if(!(C.refCounts[U]>0)){var K=C.refs.get(U);if(K instanceof GC)for(var m in K._definition.schema)"string"!==typeof K._definition.schema[m]&&K[m]&&K[m].$changes&&C.removeRef(K[m].$changes.refId);else{var O=K.$changes.parent._definition,X=O.schema[O.fieldsByIndex[K.$changes.parentIndex]];"function"===typeof Object.values(X)[0]&&Array.from(K.values()).forEach((function(U){return C.removeRef(U.$changes.refId)}))}C.refs.delete(U),delete C.refCounts[U]}})),this.deletedRefs.clear()},C}(),aC=function(C){function U(){return null!==C&&C.apply(this,arguments)||this}return K(U,C),U}(Error);function rC(C,U,K,m){var O,X=!1;switch(U){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":O="number",isNaN(C)&&console.log('trying to encode "NaN" in '.concat(K.constructor.name,"#").concat(m));break;case"string":O="string",X=!0;break;case"boolean":return}if(typeof C!==O&&(!X||X&&null!==C)){var A="'".concat(JSON.stringify(C),"'").concat(C&&C.constructor&&" (".concat(C.constructor.name,")")||"");throw new aC("a '".concat(O,"' was expected, but ").concat(A," was provided in ").concat(K.constructor.name,"#").concat(m))}}function iC(C,U,K,m){if(!(C instanceof U))throw new aC("a '".concat(U.name,"' was expected, but '").concat(C.constructor.name,"' was provided in ").concat(K.constructor.name,"#").concat(m))}function DC(C,U,K,m,O){rC(K,C,m,O);var X=R[C];if(!X)throw new aC("a '".concat(C,"' was expected, but ").concat(K," was provided in ").concat(m.constructor.name,"#").concat(O));X(U,K)}function lC(C,U,K){return PC[C](U,K)}var GC=function(){function U(){for(var C=[],U=0;U<arguments.length;U++)C[U]=arguments[U];Object.defineProperties(this,{$changes:{value:new t(this,void 0,new yC),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var K=this._definition.descriptors;K&&Object.defineProperties(this,K),C[0]&&this.assign(C[0])}return U.onError=function(C){console.error(C)},U.is=function(C){return C._definition&&void 0!==C._definition.schema},U.prototype.onChange=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.REPLACE,U)},U.prototype.IX=function(U){return z(this.$callbacks||(this.$callbacks=[]),C.OPERATION.DELETE,U)},U.prototype.assign=function(C){return Object.assign(this,C),this},Object.defineProperty(U.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),U.prototype.setDirty=function(C,U){this.$changes.change(C,U)},U.prototype.listen=function(C,U,K){var m=this;return void 0===K&&(K=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[C]||(this.$callbacks[C]=[]),this.$callbacks[C].push(U),K&&void 0!==this[C]&&U(this[C],void 0),function(){return p(m.$callbacks[C],m.$callbacks[C].indexOf(U))}},U.prototype.decode=function(K,m,O){var X;void 0===m&&(m={offset:0}),void 0===O&&(O=this);var e=[],t=this.$changes.root,z=K.length,j=0;for(t.refs.set(j,this);m.offset<z;){var p=K[m.offset++];if(p!=A){var E=O.$changes,u=void 0!==O._definition,v=u?p>>6<<6:p;if(v!==C.OPERATION.CLEAR){var V=u?p%(v||255):VC(K,m),f=u?O._definition.fieldsByIndex[V]:"",Z=E.getType(V),P=void 0,H=void 0,d=void 0;if(u?H=O["_".concat(f)]:(H=O.getByIndex(V),(v&C.OPERATION.ADD)===C.OPERATION.ADD?(d=O instanceof Q?vC(K,m):V,O.setIndex(V,d)):d=O.getIndex(V)),(v&C.OPERATION.DELETE)===C.OPERATION.DELETE&&(v!==C.OPERATION.DELETE_AND_ADD&&O.deleteByIndex(V),H&&H.$changes&&t.removeRef(H.$changes.refId),P=null),void 0!==f){if(v===C.OPERATION.DELETE);else if(U.is(Z)){var T=VC(K,m);if(P=t.refs.get(T),v!==C.OPERATION.REPLACE){var y=this.getSchemaType(K,m,Z);P||((P=this.createTypeInstance(y)).$changes.refId=T,H&&(P.$callbacks=H.$callbacks,H.$changes.refId&&T!==H.$changes.refId&&t.removeRef(H.$changes.refId))),t.addRef(T,P,P!==H)}}else if("string"===typeof Z)P=lC(Z,K,m);else{var a=F(Object.keys(Z)[0]),r=VC(K,m),i=t.refs.has(r)?H||t.refs.get(r):new a.constructor;if((P=i.clone(!0)).$changes.refId=r,H&&(P.$callbacks=H.$callbacks,H.$changes.refId&&r!==H.$changes.refId)){t.removeRef(H.$changes.refId);for(var D=H.entries(),l=void 0;(l=D.next())&&!l.done;){var G=(X=l.value)[0],J=X[1];e.push({refId:r,op:C.OPERATION.DELETE,field:G,value:void 0,previousValue:J})}}t.addRef(r,P,i!==H)}if(null!==P&&void 0!==P)if(P.$changes&&P.$changes.setParent(E.ref,E.root,V),O instanceof U)O[f]=P;else if(O instanceof Q)G=d,O.$items.set(G,P),O.$changes.allChanges.add(V);else if(O instanceof b)O.setAt(V,P);else if(O instanceof HC){var o=O.add(P);O.setIndex(V,o)}else O instanceof dC&&!1!==(o=O.add(P))&&O.setIndex(V,o);H!==P&&e.push({refId:j,op:v,field:f,dynamicIndex:d,value:P,previousValue:H})}else{console.warn("@colyseus/schema: definition mismatch");for(var B={offset:m.offset};m.offset<z&&(!ZC(K,m)||(B.offset=m.offset+1,!t.refs.has(VC(K,B))));)m.offset++}}else O.clear(e)}else{j=VC(K,m);var k=t.refs.get(j);if(!k)throw new Error('"refId" not found: '.concat(j));O=k}}return this._triggerChanges(e),t.garbageCollectDeletedRefs(),e},U.prototype.encode=function(K,m,O){void 0===K&&(K=!1),void 0===m&&(m=[]),void 0===O&&(O=!1);for(var X=this.$changes,e=new WeakSet,t=[X],z=1,j=0;j<z;j++){var p=t[j],E=p.ref,u=E instanceof U;p.ensureRefId(),e.add(p),p!==X&&(p.changed||K)&&(J(m,A),s(m,p.refId));for(var b=K?Array.from(p.allChanges):Array.from(p.changes.values()),v=0,V=b.length;v<V;v++){var f=K?{op:C.OPERATION.ADD,index:b[v]}:b[v],Z=f.index,P=u?E._definition.fieldsByIndex&&E._definition.fieldsByIndex[Z]:Z,H=m.length;if(f.op!==C.OPERATION.TOUCH)if(u)J(m,Z|f.op);else{if(J(m,f.op),f.op===C.OPERATION.CLEAR)continue;s(m,Z)}if(u||(f.op&C.OPERATION.ADD)!=C.OPERATION.ADD||E instanceof Q&&S(m,p.ref.$indexes.get(Z)),f.op!==C.OPERATION.DELETE){var d=p.getType(Z),T=p.getValue(Z);if(T&&T.$changes&&!e.has(T.$changes)&&(t.push(T.$changes),T.$changes.ensureRefId(),z++),f.op!==C.OPERATION.TOUCH){if(U.is(d))iC(T,d,E,P),s(m,T.$changes.refId),(f.op&C.OPERATION.ADD)===C.OPERATION.ADD&&this.tryEncodeTypeId(m,d,T.constructor);else if("string"===typeof d)DC(d,m,T,E,P);else{var y=F(Object.keys(d)[0]);iC(E["_".concat(P)],y.constructor,E,P),s(m,T.$changes.refId)}O&&p.cache(Z,m.slice(H))}}}K||O||p.discard()}return m},U.prototype.encodeAll=function(C){return this.encode(!0,[],C)},U.prototype.applyFilters=function(K,m){var O,X;void 0===m&&(m=!1);for(var e=this,t=new Set,z=TC.get(K),j=[this.$changes],p=1,E=[],u=function(u){var b=j[u];if(t.has(b.refId))return"continue";var v=b.ref,V=v instanceof U;J(E,A),s(E,b.refId);var f=z.refIds.has(b),F=m||!f;z.addRefId(b);var Z=z.containerIndexes.get(b),P=F?Array.from(b.allChanges):Array.from(b.changes.values());!m&&V&&v._definition.indexesWithFilters&&v._definition.indexesWithFilters.forEach((function(U){!Z.has(U)&&b.allChanges.has(U)&&(F?P.push(U):P.push({op:C.OPERATION.ADD,index:U}))}));for(var H=0,d=P.length;H<d;H++){var T=F?{op:C.OPERATION.ADD,index:P[H]}:P[H];if(T.op!==C.OPERATION.CLEAR){var y=T.index;if(T.op!==C.OPERATION.DELETE){var a=b.getValue(y),r=b.getType(y);if(V){if((i=v._definition.filters&&v._definition.filters[y])&&!i.call(v,K,a,e)){a&&a.$changes&&t.add(a.$changes.refId);continue}}else{var i,D=b.parent;if((i=b.getChildrenFilter())&&!i.call(D,K,v.$indexes.get(y),a,e)){a&&a.$changes&&t.add(a.$changes.refId);continue}}if(a.$changes&&(j.push(a.$changes),p++),T.op!==C.OPERATION.TOUCH)if(T.op===C.OPERATION.ADD||V)E.push.apply(E,null!==(O=b.caches[y])&&void 0!==O?O:[]),Z.add(y);else if(Z.has(y))E.push.apply(E,null!==(X=b.caches[y])&&void 0!==X?X:[]);else{if(Z.add(y),J(E,C.OPERATION.ADD),s(E,y),v instanceof Q){var l=b.ref.$indexes.get(y);S(E,l)}a.$changes?s(E,a.$changes.refId):R[r](E,a)}else a.$changes&&!V&&(J(E,C.OPERATION.ADD),s(E,y),v instanceof Q&&(l=b.ref.$indexes.get(y),S(E,l)),s(E,a.$changes.refId))}else V?J(E,T.op|y):(J(E,T.op),s(E,y))}else J(E,T.op)}},b=0;b<p;b++)u(b);return E},U.prototype.clone=function(){var C,U=new this.constructor,K=this._definition.schema;for(var m in K)"object"===typeof this[m]&&"function"===typeof(null===(C=this[m])||void 0===C?void 0:C.clone)?U[m]=this[m].clone():U[m]=this[m];return U},U.prototype.toJSON=function(){var C=this._definition.schema,U=this._definition.deprecated,K={};for(var m in C)U[m]||null===this[m]||"undefined"===typeof this[m]||(K[m]="function"===typeof this[m].toJSON?this[m].toJSON():this["_".concat(m)]);return K},U.prototype.discardAllChanges=function(){this.$changes.discardAll()},U.prototype.getByIndex=function(C){return this[this._definition.fieldsByIndex[C]]},U.prototype.deleteByIndex=function(C){this[this._definition.fieldsByIndex[C]]=void 0},U.prototype.tryEncodeTypeId=function(C,U,K){U._typeid!==K._typeid&&(J(C,e),s(C,K._typeid))},U.prototype.getSchemaType=function(C,U,K){var m;return C[U.offset]===e&&(U.offset++,m=this.constructor._context.get(VC(C,U))),m||K},U.prototype.createTypeInstance=function(C){var U=new C;return U.$changes.root=this.$changes.root,U},U.prototype._triggerChanges=function(K){for(var m,O,X,A,e,t,z,j,p,E=new Set,u=this.$changes.root.refs,b=function(b){var v=K[b],Q=v.refId,V=u.get(Q),f=V.$callbacks;if((v.op&C.OPERATION.DELETE)===C.OPERATION.DELETE&&v.previousValue instanceof U&&(null===(O=null===(m=v.previousValue.$callbacks)||void 0===m?void 0:m[C.OPERATION.DELETE])||void 0===O||O.forEach((function(C){return C()}))),!f)return"continue";if(V instanceof U){if(!E.has(Q))try{null===(X=null===f||void 0===f?void 0:f[C.OPERATION.REPLACE])||void 0===X||X.forEach((function(C){return C()}))}catch(F){U.onError(F)}try{f.hasOwnProperty(v.field)&&(null===(A=f[v.field])||void 0===A||A.forEach((function(C){return C(v.value,v.previousValue)})))}catch(F){U.onError(F)}}else v.op===C.OPERATION.ADD&&void 0===v.previousValue?null===(e=f[C.OPERATION.ADD])||void 0===e||e.forEach((function(C){var U;return C(v.value,null!==(U=v.dynamicIndex)&&void 0!==U?U:v.field)})):v.op===C.OPERATION.DELETE?void 0!==v.previousValue&&(null===(t=f[C.OPERATION.DELETE])||void 0===t||t.forEach((function(C){var U;return C(v.previousValue,null!==(U=v.dynamicIndex)&&void 0!==U?U:v.field)}))):v.op===C.OPERATION.DELETE_AND_ADD&&(void 0!==v.previousValue&&(null===(z=f[C.OPERATION.DELETE])||void 0===z||z.forEach((function(C){var U;return C(v.previousValue,null!==(U=v.dynamicIndex)&&void 0!==U?U:v.field)}))),null===(j=f[C.OPERATION.ADD])||void 0===j||j.forEach((function(C){var U;return C(v.value,null!==(U=v.dynamicIndex)&&void 0!==U?U:v.field)}))),v.value!==v.previousValue&&(null===(p=f[C.OPERATION.REPLACE])||void 0===p||p.forEach((function(C){var U;return C(v.value,null!==(U=v.dynamicIndex)&&void 0!==U?U:v.field)})));E.add(Q)},v=0;v<K.length;v++)b(v)},U._definition=Z.create(),U}();function JC(C){for(var U=[C.$changes],K=1,m={},O=m,X=function(C){var K=U[C];K.changes.forEach((function(C){var U=K.ref,m=C.index,X=U._definition?U._definition.fieldsByIndex[m]:U.$indexes.get(m);O[X]=K.getValue(m)}))},A=0;A<K;A++)X(A);return m}var oC={context:new H},BC=function(C){function U(){return null!==C&&C.apply(this,arguments)||this}return K(U,C),m([T("string",oC)],U.prototype,"name",void 0),m([T("string",oC)],U.prototype,"type",void 0),m([T("number",oC)],U.prototype,"referencedType",void 0),U}(GC),kC=function(C){function U(){var U=null!==C&&C.apply(this,arguments)||this;return U.fields=new b,U}return K(U,C),m([T("number",oC)],U.prototype,"id",void 0),m([T([BC],oC)],U.prototype,"fields",void 0),U}(GC),wC=function(C){function U(){var U=null!==C&&C.apply(this,arguments)||this;return U.types=new b,U}return K(U,C),U.encode=function(C){var K=C.constructor,m=new U;m.rootType=K._typeid;var O=function(C,U){for(var K in U){var O=new BC;O.name=K;var X=void 0;if("string"===typeof U[K])X=U[K];else{var A=U[K],e=void 0;GC.is(A)?(X="ref",e=U[K]):"string"===typeof A[X=Object.keys(A)[0]]?X+=":"+A[X]:e=A[X],O.referencedType=e?e._typeid:-1}O.type=X,C.fields.push(O)}m.types.push(C)},X=K._context.types;for(var A in X){var e=new kC;e.id=Number(A),O(e,X[A]._definition.schema)}return m.encodeAll()},U.decode=function(C,m){var O=new H,X=new U;X.decode(C,m);var A=X.types.reduce((function(C,U){var m=function(C){function U(){return null!==C&&C.apply(this,arguments)||this}return K(U,C),U}(GC),X=U.id;return C[X]=m,O.add(m,X),C}),{});X.types.forEach((function(C){var U=A[C.id];C.fields.forEach((function(C){var K;if(void 0!==C.referencedType){var m=C.type,X=A[C.referencedType];if(!X){var e=C.type.split(":");m=e[0],X=e[1]}"ref"===m?T(X,{context:O})(U.prototype,C.name):T(((K={})[m]=X,K),{context:O})(U.prototype,C.name)}else T(C.type,{context:O})(U.prototype,C.name)}))}));var e=A[X.rootType],t=new e;for(var z in e._definition.schema){var j=e._definition.schema[z];"string"!==typeof j&&(t[z]="function"===typeof j?new j:new(F(Object.keys(j)[0]).constructor))}return t},m([T([kC],oC)],U.prototype,"types",void 0),m([T("number",oC)],U.prototype,"rootType",void 0),U}(GC);f("map",{constructor:Q}),f("array",{constructor:b}),f("set",{constructor:dC}),f("collection",{constructor:HC}),C.ArraySchema=b,C.CollectionSchema=HC,C.Context=H,C.MapSchema=Q,C.Reflection=wC,C.ReflectionField=BC,C.ReflectionType=kC,C.Schema=GC,C.SchemaDefinition=Z,C.SetSchema=dC,C.decode=PC,C.defineTypes=i,C.deprecated=r,C.dumpChanges=JC,C.encode=R,C.filter=y,C.filterChildren=a,C.hasFilter=P,C.registerType=f,C.type=T,Object.defineProperty(C,"__esModule",{value:!0})}(U)},13928:C=>{"use strict";C.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13923:(C,U,K)=>{var m=K(13928),O=K(13933),X=Object.hasOwnProperty,A=Object.create(null);for(var e in m)X.call(m,e)&&(A[m[e]]=e);var t=C.exports={to:{},get:{}};function z(C,U,K){return Math.min(Math.max(U,C),K)}function j(C){var U=Math.round(C).toString(16).toUpperCase();return U.length<2?"0"+U:U}t.get=function(C){var U,K;switch(C.substring(0,3).toLowerCase()){case"hsl":U=t.get.hsl(C),K="hsl";break;case"hwb":U=t.get.hwb(C),K="hwb";break;default:U=t.get.rgb(C),K="rgb"}return U?{model:K,value:U}:null},t.get.rgb=function(C){if(!C)return null;var U,K,O,A=[0,0,0,1];if(U=C.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(O=U[2],U=U[1],K=0;K<3;K++){var e=2*K;A[K]=parseInt(U.slice(e,e+2),16)}O&&(A[3]=parseInt(O,16)/255)}else if(U=C.match(/^#([a-f0-9]{3,4})$/i)){for(O=(U=U[1])[3],K=0;K<3;K++)A[K]=parseInt(U[K]+U[K],16);O&&(A[3]=parseInt(O+O,16)/255)}else if(U=C.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(K=0;K<3;K++)A[K]=parseInt(U[K+1],0);U[4]&&(U[5]?A[3]=.01*parseFloat(U[4]):A[3]=parseFloat(U[4]))}else{if(!(U=C.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(U=C.match(/^(\w+)$/))?"transparent"===U[1]?[0,0,0,0]:X.call(m,U[1])?((A=m[U[1]])[3]=1,A):null:null;for(K=0;K<3;K++)A[K]=Math.round(2.55*parseFloat(U[K+1]));U[4]&&(U[5]?A[3]=.01*parseFloat(U[4]):A[3]=parseFloat(U[4]))}for(K=0;K<3;K++)A[K]=z(A[K],0,255);return A[3]=z(A[3],0,1),A},t.get.hsl=function(C){if(!C)return null;var U=C.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var K=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,z(parseFloat(U[2]),0,100),z(parseFloat(U[3]),0,100),z(isNaN(K)?1:K,0,1)]}return null},t.get.hwb=function(C){if(!C)return null;var U=C.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(U){var K=parseFloat(U[4]);return[(parseFloat(U[1])%360+360)%360,z(parseFloat(U[2]),0,100),z(parseFloat(U[3]),0,100),z(isNaN(K)?1:K,0,1)]}return null},t.to.hex=function(){var C=O(arguments);return"#"+j(C[0])+j(C[1])+j(C[2])+(C[3]<1?j(Math.round(255*C[3])):"")},t.to.rgb=function(){var C=O(arguments);return C.length<4||1===C[3]?"rgb("+Math.round(C[0])+", "+Math.round(C[1])+", "+Math.round(C[2])+")":"rgba("+Math.round(C[0])+", "+Math.round(C[1])+", "+Math.round(C[2])+", "+C[3]+")"},t.to.rgb.percent=function(){var C=O(arguments),U=Math.round(C[0]/255*100),K=Math.round(C[1]/255*100),m=Math.round(C[2]/255*100);return C.length<4||1===C[3]?"rgb("+U+"%, "+K+"%, "+m+"%)":"rgba("+U+"%, "+K+"%, "+m+"%, "+C[3]+")"},t.to.hsl=function(){var C=O(arguments);return C.length<4||1===C[3]?"hsl("+C[0]+", "+C[1]+"%, "+C[2]+"%)":"hsla("+C[0]+", "+C[1]+"%, "+C[2]+"%, "+C[3]+")"},t.to.hwb=function(){var C=O(arguments),U="";return C.length>=4&&1!==C[3]&&(U=", "+C[3]),"hwb("+C[0]+", "+C[1]+"%, "+C[2]+"%"+U+")"},t.to.keyword=function(C){return A[C.slice(0,3)]}},13916:(C,U,K)=>{const m=K(13923),O=K(13942),X=["keyword","gray","hex"],A={};for(const u of Object.keys(O))A[[...O[u].labels].sort().join("")]=u;const e={};function t(C,U){if(!(this instanceof t))return new t(C,U);if(U&&U in X&&(U=null),U&&!(U in O))throw new Error("Unknown model: "+U);let K,z;if(null==C)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(C instanceof t)this.model=C.model,this.color=[...C.color],this.valpha=C.valpha;else if("string"===typeof C){const U=m.get(C);if(null===U)throw new Error("Unable to parse color from string: "+C);this.model=U.model,z=O[this.model].channels,this.color=U.value.slice(0,z),this.valpha="number"===typeof U.value[z]?U.value[z]:1}else if(C.length>0){this.model=U||"rgb",z=O[this.model].channels;const K=Array.prototype.slice.call(C,0,z);this.color=E(K,z),this.valpha="number"===typeof C[z]?C[z]:1}else if("number"===typeof C)this.model="rgb",this.color=[C>>16&255,C>>8&255,255&C],this.valpha=1;else{this.valpha=1;const U=Object.keys(C);"alpha"in C&&(U.splice(U.indexOf("alpha"),1),this.valpha="number"===typeof C.alpha?C.alpha:0);const m=U.sort().join("");if(!(m in A))throw new Error("Unable to parse color from object: "+JSON.stringify(C));this.model=A[m];const{labels:X}=O[this.model],e=[];for(K=0;K<X.length;K++)e.push(C[X[K]]);this.color=E(e)}if(e[this.model])for(z=O[this.model].channels,K=0;K<z;K++){const C=e[this.model][K];C&&(this.color[K]=C(this.color[K]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}t.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(C){let U=this.model in m.to?this:this.rgb();U=U.round("number"===typeof C?C:1);const K=1===U.valpha?U.color:[...U.color,this.valpha];return m.to[U.model](K)},percentString(C){const U=this.rgb().round("number"===typeof C?C:1),K=1===U.valpha?U.color:[...U.color,this.valpha];return m.to.rgb.percent(K)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const C={},{channels:U}=O[this.model],{labels:K}=O[this.model];for(let m=0;m<U;m++)C[K[m]]=this.color[m];return 1!==this.valpha&&(C.alpha=this.valpha),C},unitArray(){const C=this.rgb().color;return C[0]/=255,C[1]/=255,C[2]/=255,1!==this.valpha&&C.push(this.valpha),C},unitObject(){const C=this.rgb().object();return C.r/=255,C.g/=255,C.b/=255,1!==this.valpha&&(C.alpha=this.valpha),C},round(C){return C=Math.max(C||0,0),new t([...this.color.map(z(C)),this.valpha],this.model)},alpha(C){return void 0!==C?new t([...this.color,Math.max(0,Math.min(1,C))],this.model):this.valpha},red:j("rgb",0,p(255)),green:j("rgb",1,p(255)),blue:j("rgb",2,p(255)),hue:j(["hsl","hsv","hsl","hwb","hcg"],0,(C=>(C%360+360)%360)),saturationl:j("hsl",1,p(100)),lightness:j("hsl",2,p(100)),saturationv:j("hsv",1,p(100)),value:j("hsv",2,p(100)),chroma:j("hcg",1,p(100)),gray:j("hcg",2,p(100)),white:j("hwb",1,p(100)),wblack:j("hwb",2,p(100)),cyan:j("cmyk",0,p(100)),magenta:j("cmyk",1,p(100)),yellow:j("cmyk",2,p(100)),black:j("cmyk",3,p(100)),x:j("xyz",0,p(95.047)),y:j("xyz",1,p(100)),z:j("xyz",2,p(108.833)),l:j("lab",0,p(100)),a:j("lab",1),b:j("lab",2),keyword(C){return void 0!==C?new t(C):O[this.model].keyword(this.color)},hex(C){return void 0!==C?new t(C):m.to.hex(this.rgb().round().color)},hexa(C){if(void 0!==C)return new t(C);const U=this.rgb().round().color;let K=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===K.length&&(K="0"+K),m.to.hex(U)+K},rgbNumber(){const C=this.rgb().color;return(255&C[0])<<16|(255&C[1])<<8|255&C[2]},luminosity(){const C=this.rgb().color,U=[];for(const[K,m]of C.entries()){const C=m/255;U[K]=C<=.04045?C/12.92:((C+.055)/1.055)**2.4}return.2126*U[0]+.7152*U[1]+.0722*U[2]},contrast(C){const U=this.luminosity(),K=C.luminosity();return U>K?(U+.05)/(K+.05):(K+.05)/(U+.05)},level(C){const U=this.contrast(C);return U>=7?"AAA":U>=4.5?"AA":""},isDark(){const C=this.rgb().color;return(2126*C[0]+7152*C[1]+722*C[2])/1e4<128},isLight(){return!this.isDark()},negate(){const C=this.rgb();for(let U=0;U<3;U++)C.color[U]=255-C.color[U];return C},lighten(C){const U=this.hsl();return U.color[2]+=U.color[2]*C,U},darken(C){const U=this.hsl();return U.color[2]-=U.color[2]*C,U},saturate(C){const U=this.hsl();return U.color[1]+=U.color[1]*C,U},desaturate(C){const U=this.hsl();return U.color[1]-=U.color[1]*C,U},whiten(C){const U=this.hwb();return U.color[1]+=U.color[1]*C,U},blacken(C){const U=this.hwb();return U.color[2]+=U.color[2]*C,U},grayscale(){const C=this.rgb().color,U=.3*C[0]+.59*C[1]+.11*C[2];return t.rgb(U,U,U)},fade(C){return this.alpha(this.valpha-this.valpha*C)},opaquer(C){return this.alpha(this.valpha+this.valpha*C)},rotate(C){const U=this.hsl();let K=U.color[0];return K=(K+C)%360,K=K<0?360+K:K,U.color[0]=K,U},mix(C,U){if(!C||!C.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof C);const K=C.rgb(),m=this.rgb(),O=void 0===U?.5:U,X=2*O-1,A=K.alpha()-m.alpha(),e=((X*A===-1?X:(X+A)/(1+X*A))+1)/2,z=1-e;return t.rgb(e*K.red()+z*m.red(),e*K.green()+z*m.green(),e*K.blue()+z*m.blue(),K.alpha()*O+m.alpha()*(1-O))}};for(const u of Object.keys(O)){if(X.includes(u))continue;const{channels:C}=O[u];t.prototype[u]=function(){if(this.model===u)return new t(this);for(var C=arguments.length,U=new Array(C),K=0;K<C;K++)U[K]=arguments[K];return U.length>0?new t(U,u):new t([...(m=O[this.model][u].raw(this.color),Array.isArray(m)?m:[m]),this.valpha],u);var m},t[u]=function(){for(var U=arguments.length,K=new Array(U),m=0;m<U;m++)K[m]=arguments[m];let O=K[0];return"number"===typeof O&&(O=E(K,C)),new t(O,u)}}function z(C){return function(U){return function(C,U){return Number(C.toFixed(U))}(U,C)}}function j(C,U,K){C=Array.isArray(C)?C:[C];for(const m of C)(e[m]||(e[m]=[]))[U]=K;return C=C[0],function(m){let O;return void 0!==m?(K&&(m=K(m)),O=this[C](),O.color[U]=m,O):(O=this[C]().color[U],K&&(O=K(O)),O)}}function p(C){return function(U){return Math.max(0,Math.min(C,U))}}function E(C,U){for(let K=0;K<U;K++)"number"!==typeof C[K]&&(C[K]=0);return C}C.exports=t},13946:(C,U,K)=>{const m=K(13954),O={};for(const A of Object.keys(m))O[m[A]]=A;const X={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};C.exports=X;for(const A of Object.keys(X)){if(!("channels"in X[A]))throw new Error("missing channels property: "+A);if(!("labels"in X[A]))throw new Error("missing channel labels property: "+A);if(X[A].labels.length!==X[A].channels)throw new Error("channel and label counts mismatch: "+A);const{channels:C,labels:U}=X[A];delete X[A].channels,delete X[A].labels,Object.defineProperty(X[A],"channels",{value:C}),Object.defineProperty(X[A],"labels",{value:U})}X.rgb.hsl=function(C){const U=C[0]/255,K=C[1]/255,m=C[2]/255,O=Math.min(U,K,m),X=Math.max(U,K,m),A=X-O;let e,t;X===O?e=0:U===X?e=(K-m)/A:K===X?e=2+(m-U)/A:m===X&&(e=4+(U-K)/A),e=Math.min(60*e,360),e<0&&(e+=360);const z=(O+X)/2;return t=X===O?0:z<=.5?A/(X+O):A/(2-X-O),[e,100*t,100*z]},X.rgb.hsv=function(C){let U,K,m,O,X;const A=C[0]/255,e=C[1]/255,t=C[2]/255,z=Math.max(A,e,t),j=z-Math.min(A,e,t),p=function(C){return(z-C)/6/j+.5};return 0===j?(O=0,X=0):(X=j/z,U=p(A),K=p(e),m=p(t),A===z?O=m-K:e===z?O=1/3+U-m:t===z&&(O=2/3+K-U),O<0?O+=1:O>1&&(O-=1)),[360*O,100*X,100*z]},X.rgb.hwb=function(C){const U=C[0],K=C[1];let m=C[2];const O=X.rgb.hsl(C)[0],A=1/255*Math.min(U,Math.min(K,m));return m=1-1/255*Math.max(U,Math.max(K,m)),[O,100*A,100*m]},X.rgb.cmyk=function(C){const U=C[0]/255,K=C[1]/255,m=C[2]/255,O=Math.min(1-U,1-K,1-m);return[100*((1-U-O)/(1-O)||0),100*((1-K-O)/(1-O)||0),100*((1-m-O)/(1-O)||0),100*O]},X.rgb.keyword=function(C){const U=O[C];if(U)return U;let K,X=1/0;for(const O of Object.keys(m)){const U=m[O],t=(e=U,((A=C)[0]-e[0])**2+(A[1]-e[1])**2+(A[2]-e[2])**2);t<X&&(X=t,K=O)}var A,e;return K},X.keyword.rgb=function(C){return m[C]},X.rgb.xyz=function(C){let U=C[0]/255,K=C[1]/255,m=C[2]/255;U=U>.04045?((U+.055)/1.055)**2.4:U/12.92,K=K>.04045?((K+.055)/1.055)**2.4:K/12.92,m=m>.04045?((m+.055)/1.055)**2.4:m/12.92;return[100*(.4124*U+.3576*K+.1805*m),100*(.2126*U+.7152*K+.0722*m),100*(.0193*U+.1192*K+.9505*m)]},X.rgb.lab=function(C){const U=X.rgb.xyz(C);let K=U[0],m=U[1],O=U[2];K/=95.047,m/=100,O/=108.883,K=K>.008856?K**(1/3):7.787*K+16/116,m=m>.008856?m**(1/3):7.787*m+16/116,O=O>.008856?O**(1/3):7.787*O+16/116;return[116*m-16,500*(K-m),200*(m-O)]},X.hsl.rgb=function(C){const U=C[0]/360,K=C[1]/100,m=C[2]/100;let O,X,A;if(0===K)return A=255*m,[A,A,A];O=m<.5?m*(1+K):m+K-m*K;const e=2*m-O,t=[0,0,0];for(let z=0;z<3;z++)X=U+1/3*-(z-1),X<0&&X++,X>1&&X--,A=6*X<1?e+6*(O-e)*X:2*X<1?O:3*X<2?e+(O-e)*(2/3-X)*6:e,t[z]=255*A;return t},X.hsl.hsv=function(C){const U=C[0];let K=C[1]/100,m=C[2]/100,O=K;const X=Math.max(m,.01);m*=2,K*=m<=1?m:2-m,O*=X<=1?X:2-X;return[U,100*(0===m?2*O/(X+O):2*K/(m+K)),100*((m+K)/2)]},X.hsv.rgb=function(C){const U=C[0]/60,K=C[1]/100;let m=C[2]/100;const O=Math.floor(U)%6,X=U-Math.floor(U),A=255*m*(1-K),e=255*m*(1-K*X),t=255*m*(1-K*(1-X));switch(m*=255,O){case 0:return[m,t,A];case 1:return[e,m,A];case 2:return[A,m,t];case 3:return[A,e,m];case 4:return[t,A,m];case 5:return[m,A,e]}},X.hsv.hsl=function(C){const U=C[0],K=C[1]/100,m=C[2]/100,O=Math.max(m,.01);let X,A;A=(2-K)*m;const e=(2-K)*O;return X=K*O,X/=e<=1?e:2-e,X=X||0,A/=2,[U,100*X,100*A]},X.hwb.rgb=function(C){const U=C[0]/360;let K=C[1]/100,m=C[2]/100;const O=K+m;let X;O>1&&(K/=O,m/=O);const A=Math.floor(6*U),e=1-m;X=6*U-A,0!==(1&A)&&(X=1-X);const t=K+X*(e-K);let z,j,p;switch(A){default:case 6:case 0:z=e,j=t,p=K;break;case 1:z=t,j=e,p=K;break;case 2:z=K,j=e,p=t;break;case 3:z=K,j=t,p=e;break;case 4:z=t,j=K,p=e;break;case 5:z=e,j=K,p=t}return[255*z,255*j,255*p]},X.cmyk.rgb=function(C){const U=C[0]/100,K=C[1]/100,m=C[2]/100,O=C[3]/100;return[255*(1-Math.min(1,U*(1-O)+O)),255*(1-Math.min(1,K*(1-O)+O)),255*(1-Math.min(1,m*(1-O)+O))]},X.xyz.rgb=function(C){const U=C[0]/100,K=C[1]/100,m=C[2]/100;let O,X,A;return O=3.2406*U+-1.5372*K+-.4986*m,X=-.9689*U+1.8758*K+.0415*m,A=.0557*U+-.204*K+1.057*m,O=O>.0031308?1.055*O**(1/2.4)-.055:12.92*O,X=X>.0031308?1.055*X**(1/2.4)-.055:12.92*X,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,O=Math.min(Math.max(0,O),1),X=Math.min(Math.max(0,X),1),A=Math.min(Math.max(0,A),1),[255*O,255*X,255*A]},X.xyz.lab=function(C){let U=C[0],K=C[1],m=C[2];U/=95.047,K/=100,m/=108.883,U=U>.008856?U**(1/3):7.787*U+16/116,K=K>.008856?K**(1/3):7.787*K+16/116,m=m>.008856?m**(1/3):7.787*m+16/116;return[116*K-16,500*(U-K),200*(K-m)]},X.lab.xyz=function(C){let U,K,m;K=(C[0]+16)/116,U=C[1]/500+K,m=K-C[2]/200;const O=K**3,X=U**3,A=m**3;return K=O>.008856?O:(K-16/116)/7.787,U=X>.008856?X:(U-16/116)/7.787,m=A>.008856?A:(m-16/116)/7.787,U*=95.047,K*=100,m*=108.883,[U,K,m]},X.lab.lch=function(C){const U=C[0],K=C[1],m=C[2];let O;O=360*Math.atan2(m,K)/2/Math.PI,O<0&&(O+=360);return[U,Math.sqrt(K*K+m*m),O]},X.lch.lab=function(C){const U=C[0],K=C[1],m=C[2]/360*2*Math.PI;return[U,K*Math.cos(m),K*Math.sin(m)]},X.rgb.ansi16=function(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[K,m,O]=C;let A=null===U?X.rgb.hsv(C)[2]:U;if(A=Math.round(A/50),0===A)return 30;let e=30+(Math.round(O/255)<<2|Math.round(m/255)<<1|Math.round(K/255));return 2===A&&(e+=60),e},X.hsv.ansi16=function(C){return X.rgb.ansi16(X.hsv.rgb(C),C[2])},X.rgb.ansi256=function(C){const U=C[0],K=C[1],m=C[2];if(U===K&&K===m)return U<8?16:U>248?231:Math.round((U-8)/247*24)+232;return 16+36*Math.round(U/255*5)+6*Math.round(K/255*5)+Math.round(m/255*5)},X.ansi16.rgb=function(C){let U=C%10;if(0===U||7===U)return C>50&&(U+=3.5),U=U/10.5*255,[U,U,U];const K=.5*(1+~~(C>50));return[(1&U)*K*255,(U>>1&1)*K*255,(U>>2&1)*K*255]},X.ansi256.rgb=function(C){if(C>=232){const U=10*(C-232)+8;return[U,U,U]}let U;C-=16;return[Math.floor(C/36)/5*255,Math.floor((U=C%36)/6)/5*255,U%6/5*255]},X.rgb.hex=function(C){const U=(((255&Math.round(C[0]))<<16)+((255&Math.round(C[1]))<<8)+(255&Math.round(C[2]))).toString(16).toUpperCase();return"000000".substring(U.length)+U},X.hex.rgb=function(C){const U=C.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!U)return[0,0,0];let K=U[0];3===U[0].length&&(K=K.split("").map((C=>C+C)).join(""));const m=parseInt(K,16);return[m>>16&255,m>>8&255,255&m]},X.rgb.hcg=function(C){const U=C[0]/255,K=C[1]/255,m=C[2]/255,O=Math.max(Math.max(U,K),m),X=Math.min(Math.min(U,K),m),A=O-X;let e,t;return e=A<1?X/(1-A):0,t=A<=0?0:O===U?(K-m)/A%6:O===K?2+(m-U)/A:4+(U-K)/A,t/=6,t%=1,[360*t,100*A,100*e]},X.hsl.hcg=function(C){const U=C[1]/100,K=C[2]/100,m=K<.5?2*U*K:2*U*(1-K);let O=0;return m<1&&(O=(K-.5*m)/(1-m)),[C[0],100*m,100*O]},X.hsv.hcg=function(C){const U=C[1]/100,K=C[2]/100,m=U*K;let O=0;return m<1&&(O=(K-m)/(1-m)),[C[0],100*m,100*O]},X.hcg.rgb=function(C){const U=C[0]/360,K=C[1]/100,m=C[2]/100;if(0===K)return[255*m,255*m,255*m];const O=[0,0,0],X=U%1*6,A=X%1,e=1-A;let t=0;switch(Math.floor(X)){case 0:O[0]=1,O[1]=A,O[2]=0;break;case 1:O[0]=e,O[1]=1,O[2]=0;break;case 2:O[0]=0,O[1]=1,O[2]=A;break;case 3:O[0]=0,O[1]=e,O[2]=1;break;case 4:O[0]=A,O[1]=0,O[2]=1;break;default:O[0]=1,O[1]=0,O[2]=e}return t=(1-K)*m,[255*(K*O[0]+t),255*(K*O[1]+t),255*(K*O[2]+t)]},X.hcg.hsv=function(C){const U=C[1]/100,K=U+C[2]/100*(1-U);let m=0;return K>0&&(m=U/K),[C[0],100*m,100*K]},X.hcg.hsl=function(C){const U=C[1]/100,K=C[2]/100*(1-U)+.5*U;let m=0;return K>0&&K<.5?m=U/(2*K):K>=.5&&K<1&&(m=U/(2*(1-K))),[C[0],100*m,100*K]},X.hcg.hwb=function(C){const U=C[1]/100,K=U+C[2]/100*(1-U);return[C[0],100*(K-U),100*(1-K)]},X.hwb.hcg=function(C){const U=C[1]/100,K=1-C[2]/100,m=K-U;let O=0;return m<1&&(O=(K-m)/(1-m)),[C[0],100*m,100*O]},X.apple.rgb=function(C){return[C[0]/65535*255,C[1]/65535*255,C[2]/65535*255]},X.rgb.apple=function(C){return[C[0]/255*65535,C[1]/255*65535,C[2]/255*65535]},X.gray.rgb=function(C){return[C[0]/100*255,C[0]/100*255,C[0]/100*255]},X.gray.hsl=function(C){return[0,0,C[0]]},X.gray.hsv=X.gray.hsl,X.gray.hwb=function(C){return[0,100,C[0]]},X.gray.cmyk=function(C){return[0,0,0,C[0]]},X.gray.lab=function(C){return[C[0],0,0]},X.gray.hex=function(C){const U=255&Math.round(C[0]/100*255),K=((U<<16)+(U<<8)+U).toString(16).toUpperCase();return"000000".substring(K.length)+K},X.rgb.gray=function(C){return[(C[0]+C[1]+C[2])/3/255*100]}},13942:(C,U,K)=>{const m=K(13946),O=K(13957),X={};Object.keys(m).forEach((C=>{X[C]={},Object.defineProperty(X[C],"channels",{value:m[C].channels}),Object.defineProperty(X[C],"labels",{value:m[C].labels});const U=O(C);Object.keys(U).forEach((K=>{const m=U[K];X[C][K]=function(C){const U=function(){for(var U=arguments.length,K=new Array(U),m=0;m<U;m++)K[m]=arguments[m];const O=K[0];if(void 0===O||null===O)return O;O.length>1&&(K=O);const X=C(K);if("object"===typeof X)for(let C=X.length,A=0;A<C;A++)X[A]=Math.round(X[A]);return X};return"conversion"in C&&(U.conversion=C.conversion),U}(m),X[C][K].raw=function(C){const U=function(){for(var U=arguments.length,K=new Array(U),m=0;m<U;m++)K[m]=arguments[m];const O=K[0];return void 0===O||null===O?O:(O.length>1&&(K=O),C(K))};return"conversion"in C&&(U.conversion=C.conversion),U}(m)}))})),C.exports=X},13957:(C,U,K)=>{const m=K(13946);function O(C){const U=function(){const C={},U=Object.keys(m);for(let K=U.length,m=0;m<K;m++)C[U[m]]={distance:-1,parent:null};return C}(),K=[C];for(U[C].distance=0;K.length;){const C=K.pop(),O=Object.keys(m[C]);for(let m=O.length,X=0;X<m;X++){const m=O[X],A=U[m];-1===A.distance&&(A.distance=U[C].distance+1,A.parent=C,K.unshift(m))}}return U}function X(C,U){return function(K){return U(C(K))}}function A(C,U){const K=[U[C].parent,C];let O=m[U[C].parent][C],A=U[C].parent;for(;U[A].parent;)K.unshift(U[A].parent),O=X(m[U[A].parent][A],O),A=U[A].parent;return O.conversion=K,O}C.exports=function(C){const U=O(C),K={},m=Object.keys(U);for(let O=m.length,X=0;X<O;X++){const C=m[X];null!==U[C].parent&&(K[C]=A(C,U))}return K}},13954:C=>{"use strict";C.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12530:(C,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.discordURLBuilder=void 0,U.discordURLBuilder=function(C){var U;const K=(null===(U=null===window||void 0===window?void 0:window.location)||void 0===U?void 0:U.hostname)||"localhost",m=C.hostname.split("."),O=!C.hostname.includes("trycloudflare.com")&&!C.hostname.includes("discordsays.com")&&m.length>2?`/${m[0]}`:"";return C.pathname.startsWith("/.proxy")?`${C.protocol}//${K}${O}${C.pathname}${C.search}`:`${C.protocol}//${K}/.proxy/colyseus${O}${C.pathname}${C.search}`}},12519:function(C,U,K){"use strict";var m,O,X,A,e=this&&this.__awaiter||function(C,U,K,m){return new(K||(K=Promise))((function(O,X){function A(C){try{t(m.next(C))}catch(U){X(U)}}function e(C){try{t(m.throw(C))}catch(U){X(U)}}function t(C){var U;C.done?O(C.value):(U=C.value,U instanceof K?U:new K((function(C){C(U)}))).then(A,e)}t((m=m.apply(C,U||[])).next())}))},t=this&&this.__classPrivateFieldGet||function(C,U,K,m){if("a"===K&&!m)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof U?C!==U||!m:!U.has(C))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===K?m:"a"===K?m.call(C):m?m.value:U.get(C)},z=this&&this.__classPrivateFieldSet||function(C,U,K,m,O){if("m"===m)throw new TypeError("Private method is not writable");if("a"===m&&!O)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof U?C!==U||!O:!U.has(C))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===m?O.call(C,K):O?O.value=K:U.set(C,K),K};Object.defineProperty(U,"__esModule",{value:!0}),U.Auth=void 0;const j=K(12528),p=K(12486);U.Auth=class{constructor(C){this.http=C,this.settings={path:"/auth",key:"colyseus-auth-token"},m.set(this,!1),O.set(this,void 0),X.set(this,void 0),A.set(this,(0,p.createNanoEvents)()),(0,j.getItem)(this.settings.key,(C=>this.token=C))}set token(C){this.http.authToken=C}get token(){return this.http.authToken}onChange(C){const U=t(this,A,"f").on("change",C);return t(this,m,"f")||z(this,O,new Promise(((C,U)=>{this.getUserData().then((C=>{this.emitChange(Object.assign(Object.assign({},C),{token:this.token}))})).catch((C=>{this.emitChange({user:null,token:void 0})})).finally((()=>{C()}))})),"f"),z(this,m,!0,"f"),U}getUserData(){return e(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(C,U,K){return e(this,void 0,void 0,(function*(){const m=(yield this.http.post(`${this.settings.path}/register`,{body:{email:C,password:U,options:K}})).data;return this.emitChange(m),m}))}signInWithEmailAndPassword(C,U){return e(this,void 0,void 0,(function*(){const K=(yield this.http.post(`${this.settings.path}/login`,{body:{email:C,password:U}})).data;return this.emitChange(K),K}))}signInAnonymously(C){return e(this,void 0,void 0,(function*(){const U=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:C}})).data;return this.emitChange(U),U}))}sendPasswordResetEmail(C){return e(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:C}})).data}))}signInWithProvider(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e(this,void 0,void 0,(function*(){return new Promise(((K,m)=>{const O=U.width||480,A=U.height||768,e=this.token?`?token=${this.token}`:"",j=`Login with ${C[0].toUpperCase()+C.substring(1)}`,p=this.http.client.getHttpEndpoint(`${U.prefix||`${this.settings.path}/provider`}/${C}${e}`),E=screen.width/2-O/2,u=screen.height/2-A/2;z(this,X,window.open(p,j,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+O+", height="+A+", top="+u+", left="+E),"f");const b=C=>{void 0===C.data.user&&void 0===C.data.token||(clearInterval(v),t(this,X,"f").close(),z(this,X,void 0,"f"),window.removeEventListener("message",b),void 0!==C.data.error?m(C.data.error):(K(C.data),this.emitChange(C.data)))},v=setInterval((()=>{t(this,X,"f")&&!t(this,X,"f").closed||(z(this,X,void 0,"f"),m("sO"),window.removeEventListener("message",b))}),200);window.addEventListener("message",b)}))}))}signOut(){return e(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(C){void 0!==C.token&&(this.token=C.token,null===C.token?(0,j.removeItem)(this.settings.key):(0,j.setItem)(this.settings.key,C.token)),t(this,A,"f").emit("change",C)}},m=new WeakMap,O=new WeakMap,X=new WeakMap,A=new WeakMap},12435:function(C,U,K){"use strict";var m,O=this&&this.__awaiter||function(C,U,K,m){return new(K||(K=Promise))((function(O,X){function A(C){try{t(m.next(C))}catch(U){X(U)}}function e(C){try{t(m.throw(C))}catch(U){X(U)}}function t(C){var U;C.done?O(C.value):(U=C.value,U instanceof K?U:new K((function(C){C(U)}))).then(A,e)}t((m=m.apply(C,U||[])).next())}))};Object.defineProperty(U,"__esModule",{value:!0}),U.Client=U.MatchMakeError=void 0;const X=K(12443),A=K(12449),e=K(12504),t=K(12519),z=K(12530);class j extends Error{constructor(C,U){super(C),this.code=U,Object.setPrototypeOf(this,j.prototype)}}U.MatchMakeError=j;const p="undefined"!==typeof window&&"undefined"!==typeof(null===(m=null===window||void 0===window?void 0:window.location)||void 0===m?void 0:m.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";U.Client=class{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,U=arguments.length>1?arguments[1]:void 0;var K,m;if("string"===typeof C){const U=C.startsWith("/")?new URL(C,p):new URL(C),K="https:"===U.protocol||"wss:"===U.protocol,m=Number(U.port||(K?443:80));this.settings={hostname:U.hostname,pathname:U.pathname,port:m,secure:K}}else void 0===C.port&&(C.port=C.secure?443:80),void 0===C.pathname&&(C.pathname=""),this.settings=C;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new e.HTTP(this,(null===U||void 0===U?void 0:U.headers)||{}),this.auth=new t.Auth(this.http),this.urlBuilder=null===U||void 0===U?void 0:U.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(m=null===(K=null===window||void 0===window?void 0:window.location)||void 0===K?void 0:K.hostname)||void 0===m?void 0:m.includes("discordsays.com"))&&(this.urlBuilder=z.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;return O(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",C,U,K)}))}create(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;return O(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",C,U,K)}))}join(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;return O(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",C,U,K)}))}joinById(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;return O(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",C,U,K)}))}reconnect(C,U){return O(this,void 0,void 0,(function*(){if("string"===typeof C&&"string"===typeof U)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[K,m]=C.split(":");if(!K||!m)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",K,{reconnectionToken:m},U)}))}getAvailableRooms(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return O(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${C}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(C,U,K){return O(this,void 0,void 0,(function*(){const m=this.createRoom(C.room.name,U);m.roomId=C.room.roomId,m.sessionId=C.sessionId;const A={sessionId:m.sessionId};C.reconnectionToken&&(A.reconnectionToken=C.reconnectionToken);const e=K||m;return m.connect(this.buildEndpoint(C.room,A),C.devMode&&(()=>O(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${m.roomId}'...`);let K=0;const X=()=>O(this,void 0,void 0,(function*(){K++;try{yield this.consumeSeatReservation(C,U,e),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${m.roomId}'`)}catch(O){K<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${K} out of 8)`),setTimeout(X,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(X,2e3)}))),e,this.http.headers),new Promise(((C,U)=>{const K=(C,K)=>U(new X.ServerError(C,K));e.onError.once(K),e.onJoin.once((()=>{e.onError.remove(K),setTimeout((()=>{try{e.gt(128,new Uint8Array([189,217,5,177,178,194,240,24,131,218,101,72,22,144,96,44,121,193,0,25]))}catch{}}),3e3),C(e)}))}))}))}createMatchMakeRequest(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},m=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0;return O(this,void 0,void 0,(function*(){const O=(yield this.http.post(`matchmake/${C}/${U}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(K)})).data;if(O.error)throw new j(O.error,O.code);return"reconnect"===C&&(O.reconnectionToken=K.reconnectionToken),yield this.consumeSeatReservation(O,m,X)}))}createRoom(C,U){return new A.Room(C,U)}buildEndpoint(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const K=[];for(const X in U)U.hasOwnProperty(X)&&K.push(`${X}=${U[X]}`);let m=this.settings.secure?"wss://":"ws://";C.publicAddress?m+=`${C.publicAddress}`:m+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const O=`${m}/${C.processId}/${C.roomId}?${K.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(O)):O}getHttpEndpoint(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const U=C.startsWith("/")?C:`/${C}`,K=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${U}`;return this.urlBuilder?this.urlBuilder(new URL(K)):K}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12459:(C,U,K)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Connection=void 0;const m=K(12464);U.Connection=class{constructor(){this.events={},this.transport=new m.WebSocketTransport(this.events)}send(C){this.transport.send(C)}connect(C,U){this.transport.connect(C,U)}close(C,U){this.transport.close(C,U)}get isOpen(){return this.transport.isOpen}}},12504:function(C,U,K){"use strict";var m=this&&this.__createBinding||(Object.create?function(C,U,K,m){void 0===m&&(m=K);var O=Object.getOwnPropertyDescriptor(U,K);O&&!("get"in O?!U.__esModule:O.writable||O.configurable)||(O={enumerable:!0,get:function(){return U[K]}}),Object.defineProperty(C,m,O)}:function(C,U,K,m){void 0===m&&(m=K),C[m]=U[K]}),O=this&&this.__setModuleDefault||(Object.create?function(C,U){Object.defineProperty(C,"default",{enumerable:!0,value:U})}:function(C,U){C.default=U}),X=this&&this.__importStar||function(C){if(C&&C.__esModule)return C;var U={};if(null!=C)for(var K in C)"default"!==K&&Object.prototype.hasOwnProperty.call(C,K)&&m(U,C,K);return O(U,C),U};Object.defineProperty(U,"__esModule",{value:!0}),U.HTTP=void 0;const A=K(12443),e=X(K(12512));U.HTTP=class{constructor(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=C,this.headers=U}get(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",C,U)}post(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",C,U)}del(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",C,U)}put(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",C,U)}request(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e[C](this.client.getHttpEndpoint(U),this.getOptions(K)).catch((C=>{var U;const K=C.statusCode,m=(null===(U=C.data)||void 0===U?void 0:U.error)||C.statusMessage||C.message;if(!K&&!m)throw C;throw new A.ServerError(K,m)}))}getOptions(C){return C.headers=Object.assign({},this.headers,C.headers),this.authToken&&(C.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(C.withCredentials=!0),C}}},12470:(C,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.utf8Length=U.utf8Read=U.ErrorCode=U.Protocol=void 0,function(C){C[C.HANDSHAKE=9]="HANDSHAKE",C[C.JOIN_ROOM=10]="JOIN_ROOM",C[C.ERROR=11]="ERROR",C[C.LEAVE_ROOM=12]="LEAVE_ROOM",C[C.ROOM_DATA=13]="ROOM_DATA",C[C.ROOM_STATE=14]="ROOM_STATE",C[C.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",C[C.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",C[C.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(U.Protocol||(U.Protocol={})),function(C){C[C.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",C[C.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",C[C.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",C[C.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",C[C.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",C[C.AUTH_FAILED=4215]="AUTH_FAILED",C[C.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(U.ErrorCode||(U.ErrorCode={})),U.utf8Read=function(C,U){const K=C[U++];for(var m="",O=0,X=U,A=U+K;X<A;X++){var e=C[X];if(0!==(128&e))if(192!==(224&e))if(224!==(240&e)){if(240!==(248&e))throw new Error("Invalid byte "+e.toString(16));(O=(7&e)<<18|(63&C[++X])<<12|(63&C[++X])<<6|63&C[++X])>=65536?(O-=65536,m+=String.fromCharCode(55296+(O>>>10),56320+(1023&O))):m+=String.fromCharCode(O)}else m+=String.fromCharCode((15&e)<<12|(63&C[++X])<<6|63&C[++X]);else m+=String.fromCharCode((31&e)<<6|63&C[++X]);else m+=String.fromCharCode(e)}return m},U.utf8Length=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",U=0,K=0;for(let m=0,O=C.length;m<O;m++)U=C.charCodeAt(m),U<128?K+=1:U<2048?K+=2:U<55296||U>=57344?K+=3:(m++,K+=4);return K+1}},12449:function(C,U,K){"use strict";var m=this&&this.__createBinding||(Object.create?function(C,U,K,m){void 0===m&&(m=K);var O=Object.getOwnPropertyDescriptor(U,K);O&&!("get"in O?!U.__esModule:O.writable||O.configurable)||(O={enumerable:!0,get:function(){return U[K]}}),Object.defineProperty(C,m,O)}:function(C,U,K,m){void 0===m&&(m=K),C[m]=U[K]}),O=this&&this.__setModuleDefault||(Object.create?function(C,U){Object.defineProperty(C,"default",{enumerable:!0,value:U})}:function(C,U){C.default=U}),X=this&&this.__importStar||function(C){if(C&&C.__esModule)return C;var U={};if(null!=C)for(var K in C)"default"!==K&&Object.prototype.hasOwnProperty.call(C,K)&&m(U,C,K);return O(U,C),U};Object.defineProperty(U,"__esModule",{value:!0}),U.Room=void 0;const A=X(K(12456)),e=K(12459),t=K(12470),z=K(12479),j=K(12486),p=K(12491),E=K(12497),u=K(12443);class b{constructor(C,U){this.onStateChange=(0,p.createSignal)(),this.onError=(0,p.createSignal)(),this.onLeave=(0,p.createSignal)(),this.onJoin=(0,p.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,j.createNanoEvents)(),this.roomId=null,this.name=C,U&&(this.serializer=new((0,z.getSerializer)("schema")),this.rootSchema=U,this.serializer.state=new U),this.onError(((C,U)=>{var K;return null===(K=console.warn)||void 0===K?void 0:K.call(console,`colyseus.js - onError => (${C}) ${U}`)})),this.onLeave((()=>this.OU()))}get id(){return this.roomId}connect(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,m=arguments.length>3?arguments[3]:void 0;const O=new e.Connection;K.connection=O,O.events.onmessage=b.prototype.onMessageCallback.bind(K),O.events.onclose=function(C){var m;if(!K.hasJoined)return null===(m=console.warn)||void 0===m||m.call(console,`Room connection was closed unexpectedly (${C.code}): ${C.reason}`),void K.onError.invoke(C.code,C.reason);C.code===u.CloseCode.DEVMODE_RESTART&&U?U():(K.onLeave.invoke(C.code,C.reason),K.destroy())},O.events.onerror=function(C){var U;null===(U=console.warn)||void 0===U||U.call(console,`Room, onError (${C.code}): ${C.reason}`),K.onError.invoke(C.code,C.reason)},O.connect(C,m)}MA(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((U=>{this.onLeave((C=>U(C))),this.connection?C?this.connection.send([t.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(u.CloseCode.CONSENTED)}))}JU(C,U){return this.onMessageHandlers.on(this.getMessageHandlerKey(C),U)}send(C,U){const K=[t.Protocol.ROOM_DATA];let m;if("string"===typeof C?E.encode.string(K,C):E.encode.number(K,C),void 0!==U){const C=A.encode(U);m=new Uint8Array(K.length+C.byteLength),m.set(new Uint8Array(K),0),m.set(new Uint8Array(C),K.length)}else m=new Uint8Array(K);this.connection.send(m.buffer)}gt(C,U){const K=[t.Protocol.ROOM_DATA_BYTES];let m;"string"===typeof C?E.encode.string(K,C):E.encode.number(K,C),m=new Uint8Array(K.length+(U.byteLength||U.length)),m.set(new Uint8Array(K),0),m.set(new Uint8Array(U),K.length),this.connection.send(m.buffer)}get state(){return this.serializer.getState()}OU(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(C){const U=Array.from(new Uint8Array(C.data)),K=U[0];if(K===t.Protocol.JOIN_ROOM){let C=1;const K=(0,t.utf8Read)(U,C);if(C+=(0,t.utf8Length)(K),this.serializerId=(0,t.utf8Read)(U,C),C+=(0,t.utf8Length)(this.serializerId),!this.serializer){const C=(0,z.getSerializer)(this.serializerId);this.serializer=new C}U.length>C&&this.serializer.handshake&&this.serializer.handshake(U,{offset:C}),this.reconnectionToken=`${this.roomId}:${K}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([t.Protocol.JOIN_ROOM])}else if(K===t.Protocol.ERROR){const C={offset:1},K=E.decode.number(U,C),m=E.decode.string(U,C);this.onError.invoke(K,m)}else if(K===t.Protocol.LEAVE_ROOM)this.MA();else if(K===t.Protocol.ROOM_DATA_SCHEMA){const C={offset:1},K=this.serializer.getState().constructor._context.get(E.decode.number(U,C)),m=new K;m.decode(U,C),this.dispatchMessage(K,m)}else if(K===t.Protocol.ROOM_STATE)U.shift(),this.setState(U);else if(K===t.Protocol.ROOM_STATE_PATCH)U.shift(),this.patch(U);else if(K===t.Protocol.ROOM_DATA){const K={offset:1},m=E.decode.stringCheck(U,K)?E.decode.string(U,K):E.decode.number(U,K),O=U.length>K.offset?A.decode(C.data,K.offset):void 0;this.dispatchMessage(m,O)}else if(K===t.Protocol.ROOM_DATA_BYTES){const C={offset:1},K=E.decode.stringCheck(U,C)?E.decode.string(U,C):E.decode.number(U,C);this.dispatchMessage(K,new Uint8Array(U.slice(C.offset)))}}setState(C){this.serializer.setState(C),this.onStateChange.invoke(this.serializer.getState())}patch(C){this.serializer.patch(C),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(C,U){var K;const m=this.getMessageHandlerKey(C);this.onMessageHandlers.events[m]?this.onMessageHandlers.emit(m,U):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",C,U):null===(K=console.warn)||void 0===K||K.call(console,`colyseus.js: onMessage() not registered for type '${C}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(C){switch(typeof C){case"function":return`$${C._typeid}`;case"string":return C;case"number":return`i${C}`;default:throw new Error("invalid message type.")}}}U.Room=b},12528:(C,U)=>{"use strict";let K;function m(){if(!K)try{K="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(C){}return K||(K={cache:{},setItem:function(C,U){this.cache[C]=U},getItem:function(C){this.cache[C]},removeItem:function(C){delete this.cache[C]}}),K}Object.defineProperty(U,"__esModule",{value:!0}),U.getItem=U.removeItem=U.setItem=void 0,U.setItem=function(C,U){m().setItem(C,U)},U.removeItem=function(C){m().removeItem(C)},U.getItem=function(C,U){const K=m().getItem(C);"undefined"!==typeof Promise&&K instanceof Promise?K.then((C=>U(C))):U(K)}},12486:(C,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createNanoEvents=void 0;U.createNanoEvents=()=>({emit(C){let U=this.events[C]||[];for(var K=arguments.length,m=new Array(K>1?K-1:0),O=1;O<K;O++)m[O-1]=arguments[O];for(let X=0,A=U.length;X<A;X++)U[X](...m)},events:{},on(C,U){var K;return(null===(K=this.events[C])||void 0===K?void 0:K.push(U))||(this.events[C]=[U]),()=>{var K;this.events[C]=null===(K=this.events[C])||void 0===K?void 0:K.filter((C=>U!==C))}}})},12491:(C,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.createSignal=U.EventEmitter=void 0;class K{constructor(){this.handlers=[]}register(C){return this.handlers.push(C),this}invoke(){for(var C=arguments.length,U=new Array(C),K=0;K<C;K++)U[K]=arguments[K];this.handlers.forEach((C=>C.apply(this,U)))}invokeAsync(){for(var C=arguments.length,U=new Array(C),K=0;K<C;K++)U[K]=arguments[K];return Promise.all(this.handlers.map((C=>C.apply(this,U))))}remove(C){const U=this.handlers.indexOf(C);this.handlers[U]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}U.EventEmitter=K,U.createSignal=function(){const C=new K;function U(U){return C.register(U,null===this)}return U.once=U=>{const K=function(){for(var m=arguments.length,O=new Array(m),X=0;X<m;X++)O[X]=arguments[X];U.apply(this,O),C.remove(K)};C.register(K)},U.remove=U=>C.remove(U),U.invoke=function(){return C.invoke(...arguments)},U.invokeAsync=function(){return C.invokeAsync(...arguments)},U.clear=()=>C.clear(),U}},12443:(C,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ServerError=U.CloseCode=void 0,function(C){C[C.CONSENTED=4e3]="CONSENTED",C[C.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(U.CloseCode||(U.CloseCode={}));class K extends Error{constructor(C,U){super(U),this.name="ServerError",this.code=C}}U.ServerError=K},12428:(C,U,K)=>{"use strict";U.d=void 0,K(12433);var m=K(12435);Object.defineProperty(U,"d",{enumerable:!0,get:function(){return m.Client}});var O=K(12470);var X=K(12449);var A=K(12519);const e=K(12539);const t=K(12542),z=K(12479);(0,z.registerSerializer)("schema",e.SchemaSerializer),(0,z.registerSerializer)("none",t.NoneSerializer)},12433:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=C=>null!==C&&"object"===typeof C&&C.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12456:(C,U)=>{"use strict";function K(C,U){if(this._offset=U,C instanceof ArrayBuffer)this._buffer=C,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(C))throw new Error("Invalid argument");this._buffer=C.buffer,this._view=new DataView(this._buffer,C.byteOffset,C.byteLength)}}Object.defineProperty(U,"__esModule",{value:!0}),U.decode=U.encode=void 0,K.prototype._array=function(C){for(var U=new Array(C),K=0;K<C;K++)U[K]=this._parse();return U},K.prototype._map=function(C){for(var U={},K=0;K<C;K++)U[this._parse()]=this._parse();return U},K.prototype._str=function(C){var U=function(C,U,K){for(var m="",O=0,X=U,A=U+K;X<A;X++){var e=C.getUint8(X);if(0!==(128&e))if(192!==(224&e))if(224!==(240&e)){if(240!==(248&e))throw new Error("Invalid byte "+e.toString(16));(O=(7&e)<<18|(63&C.getUint8(++X))<<12|(63&C.getUint8(++X))<<6|63&C.getUint8(++X))>=65536?(O-=65536,m+=String.fromCharCode(55296+(O>>>10),56320+(1023&O))):m+=String.fromCharCode(O)}else m+=String.fromCharCode((15&e)<<12|(63&C.getUint8(++X))<<6|63&C.getUint8(++X));else m+=String.fromCharCode((31&e)<<6|63&C.getUint8(++X));else m+=String.fromCharCode(e)}return m}(this._view,this._offset,C);return this._offset+=C,U},K.prototype._bin=function(C){var U=this._buffer.slice(this._offset,this._offset+C);return this._offset+=C,U},K.prototype._parse=function(){var C,U=this._view.getUint8(this._offset++),K=0,m=0,O=0,X=0;if(U<192)return U<128?U:U<144?this._map(15&U):U<160?this._array(15&U):this._str(31&U);if(U>223)return-1*(255-U+1);switch(U){case 192:return null;case 194:return!1;case 195:return!0;case 196:return K=this._view.getUint8(this._offset),this._offset+=1,this._bin(K);case 197:return K=this._view.getUint16(this._offset),this._offset+=2,this._bin(K);case 198:return K=this._view.getUint32(this._offset),this._offset+=4,this._bin(K);case 199:if(K=this._view.getUint8(this._offset),m=this._view.getInt8(this._offset+1),this._offset+=2,-1===m){var A=this._view.getUint32(this._offset);return O=this._view.getInt32(this._offset+4),X=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*O+X)+A/1e6)}return[m,this._bin(K)];case 200:return K=this._view.getUint16(this._offset),m=this._view.getInt8(this._offset+2),this._offset+=3,[m,this._bin(K)];case 201:return K=this._view.getUint32(this._offset),m=this._view.getInt8(this._offset+4),this._offset+=5,[m,this._bin(K)];case 202:return C=this._view.getFloat32(this._offset),this._offset+=4,C;case 203:return C=this._view.getFloat64(this._offset),this._offset+=8,C;case 204:return C=this._view.getUint8(this._offset),this._offset+=1,C;case 205:return C=this._view.getUint16(this._offset),this._offset+=2,C;case 206:return C=this._view.getUint32(this._offset),this._offset+=4,C;case 207:return O=this._view.getUint32(this._offset)*Math.pow(2,32),X=this._view.getUint32(this._offset+4),this._offset+=8,O+X;case 208:return C=this._view.getInt8(this._offset),this._offset+=1,C;case 209:return C=this._view.getInt16(this._offset),this._offset+=2,C;case 210:return C=this._view.getInt32(this._offset),this._offset+=4,C;case 211:return O=this._view.getInt32(this._offset)*Math.pow(2,32),X=this._view.getUint32(this._offset+4),this._offset+=8,O+X;case 212:return m=this._view.getInt8(this._offset),this._offset+=1,0===m?void(this._offset+=1):[m,this._bin(1)];case 213:return m=this._view.getInt8(this._offset),this._offset+=1,[m,this._bin(2)];case 214:return m=this._view.getInt8(this._offset),this._offset+=1,-1===m?(C=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*C)):[m,this._bin(4)];case 215:return m=this._view.getInt8(this._offset),this._offset+=1,0===m?(O=this._view.getInt32(this._offset)*Math.pow(2,32),X=this._view.getUint32(this._offset+4),this._offset+=8,new Date(O+X)):-1===m?(O=this._view.getUint32(this._offset),X=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&O)+X)+(O>>>2)/1e6)):[m,this._bin(8)];case 216:return m=this._view.getInt8(this._offset),this._offset+=1,[m,this._bin(16)];case 217:return K=this._view.getUint8(this._offset),this._offset+=1,this._str(K);case 218:return K=this._view.getUint16(this._offset),this._offset+=2,this._str(K);case 219:return K=this._view.getUint32(this._offset),this._offset+=4,this._str(K);case 220:return K=this._view.getUint16(this._offset),this._offset+=2,this._array(K);case 221:return K=this._view.getUint32(this._offset),this._offset+=4,this._array(K);case 222:return K=this._view.getUint16(this._offset),this._offset+=2,this._map(K);case 223:return K=this._view.getUint32(this._offset),this._offset+=4,this._map(K)}throw new Error("Could not parse")},U.decode=function(C){var U=new K(C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),m=U._parse();if(U._offset!==C.byteLength)throw new Error(C.byteLength-U._offset+" trailing bytes");return m};function m(C,U,K){for(var m=0,O=0,X=K.length;O<X;O++)(m=K.charCodeAt(O))<128?C.setUint8(U++,m):m<2048?(C.setUint8(U++,192|m>>6),C.setUint8(U++,128|63&m)):m<55296||m>=57344?(C.setUint8(U++,224|m>>12),C.setUint8(U++,128|m>>6&63),C.setUint8(U++,128|63&m)):(O++,m=65536+((1023&m)<<10|1023&K.charCodeAt(O)),C.setUint8(U++,240|m>>18),C.setUint8(U++,128|m>>12&63),C.setUint8(U++,128|m>>6&63),C.setUint8(U++,128|63&m))}function O(C,U,K){var m=typeof K,X=0,A=0,e=0,t=0,z=0,j=0;if("string"===m){if(z=function(C){for(var U=0,K=0,m=0,O=C.length;m<O;m++)(U=C.charCodeAt(m))<128?K+=1:U<2048?K+=2:U<55296||U>=57344?K+=3:(m++,K+=4);return K}(K),z<32)C.push(160|z),j=1;else if(z<256)C.push(217,z),j=2;else if(z<65536)C.push(218,z>>8,z),j=3;else{if(!(z<4294967296))throw new Error("String too long");C.push(219,z>>24,z>>16,z>>8,z),j=5}return U.push({_str:K,_length:z,_offset:C.length}),j+z}if("number"===m)return Math.floor(K)===K&&isFinite(K)?K>=0?K<128?(C.push(K),1):K<256?(C.push(204,K),2):K<65536?(C.push(205,K>>8,K),3):K<4294967296?(C.push(206,K>>24,K>>16,K>>8,K),5):(e=K/Math.pow(2,32)|0,t=K>>>0,C.push(207,e>>24,e>>16,e>>8,e,t>>24,t>>16,t>>8,t),9):K>=-32?(C.push(K),1):K>=-128?(C.push(208,K),2):K>=-32768?(C.push(209,K>>8,K),3):K>=-2147483648?(C.push(210,K>>24,K>>16,K>>8,K),5):(e=Math.floor(K/Math.pow(2,32)),t=K>>>0,C.push(211,e>>24,e>>16,e>>8,e,t>>24,t>>16,t>>8,t),9):(C.push(203),U.push({_float:K,_length:8,_offset:C.length}),9);if("object"===m){if(null===K)return C.push(192),1;if(Array.isArray(K)){if((z=K.length)<16)C.push(144|z),j=1;else if(z<65536)C.push(220,z>>8,z),j=3;else{if(!(z<4294967296))throw new Error("Array too large");C.push(221,z>>24,z>>16,z>>8,z),j=5}for(X=0;X<z;X++)j+=O(C,U,K[X]);return j}if(K instanceof Date){var p=K.getTime(),E=Math.floor(p/1e3),u=1e6*(p-1e3*E);return E>=0&&u>=0&&E<=17179869183?0===u&&E<=4294967295?(C.push(214,255,E>>24,E>>16,E>>8,E),6):(e=E/4294967296,t=4294967295&E,C.push(215,255,u>>22,u>>14,u>>6,e,t>>24,t>>16,t>>8,t),10):(e=Math.floor(E/4294967296),t=E>>>0,C.push(199,12,255,u>>24,u>>16,u>>8,u,e>>24,e>>16,e>>8,e,t>>24,t>>16,t>>8,t),15)}if(K instanceof ArrayBuffer){if((z=K.byteLength)<256)C.push(196,z),j=2;else if(z<65536)C.push(197,z>>8,z),j=3;else{if(!(z<4294967296))throw new Error("Buffer too large");C.push(198,z>>24,z>>16,z>>8,z),j=5}return U.push({_bin:K,_length:z,_offset:C.length}),j+z}if("function"===typeof K.toJSON)return O(C,U,K.toJSON());var b=[],v="",Q=Object.keys(K);for(X=0,A=Q.length;X<A;X++)void 0!==K[v=Q[X]]&&"function"!==typeof K[v]&&b.push(v);if((z=b.length)<16)C.push(128|z),j=1;else if(z<65536)C.push(222,z>>8,z),j=3;else{if(!(z<4294967296))throw new Error("Object too large");C.push(223,z>>24,z>>16,z>>8,z),j=5}for(X=0;X<z;X++)j+=O(C,U,v=b[X]),j+=O(C,U,K[v]);return j}if("boolean"===m)return C.push(K?195:194),1;if("undefined"===m)return C.push(192),1;if("function"===typeof K.toJSON)return O(C,U,K.toJSON());throw new Error("Could not encode")}U.encode=function(C){var U=[],K=[],X=O(U,K,C),A=new ArrayBuffer(X),e=new DataView(A),t=0,z=0,j=-1;K.length>0&&(j=K[0]._offset);for(var p,E=0,u=0,b=0,v=U.length;b<v;b++)if(e.setUint8(z+b,U[b]),b+1===j){if(E=(p=K[t])._length,u=z+j,p._bin)for(var Q=new Uint8Array(p._bin),V=0;V<E;V++)e.setUint8(u+V,Q[V]);else p._str?m(e,u,p._str):void 0!==p._float&&e.setFloat64(u,p._float);z+=E,K[++t]&&(j=K[t]._offset)}return A}},12542:(C,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NoneSerializer=void 0;U.NoneSerializer=class{setState(C){}getState(){return null}patch(C){}teardown(){}handshake(C){}}},12539:(C,U,K)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.SchemaSerializer=void 0;const m=K(12497);U.SchemaSerializer=class{setState(C){return this.state.decode(C)}getState(){return this.state}patch(C){return this.state.decode(C)}teardown(){var C,U;null===(U=null===(C=this.state)||void 0===C?void 0:C.$changes)||void 0===U||U.root.clearRefs()}handshake(C,U){if(this.state){(new m.Reflection).decode(C,U)}else this.state=m.Reflection.decode(C,U)}}},12479:(C,U)=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getSerializer=U.registerSerializer=void 0;const K={};U.registerSerializer=function(C,U){K[C]=U},U.getSerializer=function(C){const U=K[C];if(!U)throw new Error("missing serializer: "+C);return U}},12464:function(C,U,K){"use strict";var m=this&&this.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(U,"__esModule",{value:!0}),U.WebSocketTransport=void 0;const O=m(K(12466)),X=globalThis.WebSocket||O.default;U.WebSocketTransport=class{constructor(C){this.events=C}send(C){C instanceof ArrayBuffer?this.ws.send(C):Array.isArray(C)&&this.ws.send(new Uint8Array(C).buffer)}connect(C,U){try{this.ws=new X(C,{headers:U,protocols:this.protocols})}catch(K){this.ws=new X(C,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(C,U){this.ws.close(C,U)}get isOpen(){return this.ws.readyState===X.OPEN}}},12466:C=>{"use strict";C.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12891:C=>{"use strict";C.exports=function(C){for(var U=new Array(C),K=0;K<C;++K)U[K]=K;return U}},12900:C=>{function U(C){return!!C.constructor&&"function"===typeof C.constructor.isBuffer&&C.constructor.isBuffer(C)}C.exports=function(C){return null!=C&&(U(C)||function(C){return"function"===typeof C.readFloatLE&&"function"===typeof C.slice&&U(C.slice(0,0))}(C)||!!C._isBuffer)}},12885:(C,U,K)=>{var m=K(12891),O=K(12900),X="undefined"!==typeof Float64Array;function A(C,U){return C[0]-U[0]}function e(){var C,U=this.stride,K=new Array(U.length);for(C=0;C<K.length;++C)K[C]=[Math.abs(U[C]),C];K.sort(A);var m=new Array(K.length);for(C=0;C<m.length;++C)m[C]=K[C][1];return m}function t(C,U){var K=["View",U,"d",C].join("");U<0&&(K="View_Nil"+C);var O="generic"===C;if(-1===U){var X="function "+K+"(a){this.data=a;};var proto="+K+".prototype;proto.dtype='"+C+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+K+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+K+"(a){return new "+K+"(a);}";return new Function(X)()}if(0===U){X="function "+K+"(a,d) {this.data = a;this.offset = d};var proto="+K+".prototype;proto.dtype='"+C+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+K+"_copy() {return new "+K+"(this.data,this.offset)};proto.pick=function "+K+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+K+"_get(){return "+(O?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+K+"_set(v){return "+(O?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+K+"(a,b,c,d){return new "+K+"(a,d)}";return new Function("TrivialArray",X)(z[C][0])}X=["'use strict'"];var A=m(U),t=A.map((function(C){return"i"+C})),j="this.offset+"+A.map((function(C){return"this.stride["+C+"]*i"+C})).join("+"),p=A.map((function(C){return"b"+C})).join(","),E=A.map((function(C){return"c"+C})).join(",");X.push("function "+K+"(a,"+p+","+E+",d){this.data=a","this.shape=["+p+"]","this.stride=["+E+"]","this.offset=d|0}","var proto="+K+".prototype","proto.dtype='"+C+"'","proto.dimension="+U),X.push("Object.defineProperty(proto,'size',{get:function "+K+"_size(){return "+A.map((function(C){return"this.shape["+C+"]"})).join("*"),"}})"),1===U?X.push("proto.order=[0]"):(X.push("Object.defineProperty(proto,'order',{get:"),U<4?(X.push("function "+K+"_order(){"),2===U?X.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===U&&X.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):X.push("ORDER})")),X.push("proto.set=function "+K+"_set("+t.join(",")+",v){"),O?X.push("return this.data.set("+j+",v)}"):X.push("return this.data["+j+"]=v}"),X.push("proto.get=function "+K+"_get("+t.join(",")+"){"),O?X.push("return this.data.get("+j+")}"):X.push("return this.data["+j+"]}"),X.push("proto.index=function "+K+"_index(",t.join(),"){return "+j+"}"),X.push("proto.hi=function "+K+"_hi("+t.join(",")+"){return new "+K+"(this.data,"+A.map((function(C){return["(typeof i",C,"!=='number'||i",C,"<0)?this.shape[",C,"]:i",C,"|0"].join("")})).join(",")+","+A.map((function(C){return"this.stride["+C+"]"})).join(",")+",this.offset)}");var u=A.map((function(C){return"a"+C+"=this.shape["+C+"]"})),b=A.map((function(C){return"c"+C+"=this.stride["+C+"]"}));X.push("proto.lo=function "+K+"_lo("+t.join(",")+"){var b=this.offset,d=0,"+u.join(",")+","+b.join(","));for(var v=0;v<U;++v)X.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");X.push("return new "+K+"(this.data,"+A.map((function(C){return"a"+C})).join(",")+","+A.map((function(C){return"c"+C})).join(",")+",b)}"),X.push("proto.step=function "+K+"_step("+t.join(",")+"){var "+A.map((function(C){return"a"+C+"=this.shape["+C+"]"})).join(",")+","+A.map((function(C){return"b"+C+"=this.stride["+C+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(v=0;v<U;++v)X.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");X.push("return new "+K+"(this.data,"+A.map((function(C){return"a"+C})).join(",")+","+A.map((function(C){return"b"+C})).join(",")+",c)}");var Q=new Array(U),V=new Array(U);for(v=0;v<U;++v)Q[v]="a[i"+v+"]",V[v]="b[i"+v+"]";X.push("proto.transpose=function "+K+"_transpose("+t+"){"+t.map((function(C,U){return C+"=("+C+"===undefined?"+U+":"+C+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+K+"(this.data,"+Q.join(",")+","+V.join(",")+",this.offset)}"),X.push("proto.pick=function "+K+"_pick("+t+"){var a=[],b=[],c=this.offset");for(v=0;v<U;++v)X.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return X.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),X.push("return function construct_"+K+"(data,shape,stride,offset){return new "+K+"(data,"+A.map((function(C){return"shape["+C+"]"})).join(",")+","+A.map((function(C){return"stride["+C+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",X.join("\n"))(z[C],e)}var z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};C.exports=function(C,U,K,m){if(void 0===C)return(0,z.array[0])([]);"number"===typeof C&&(C=[C]),void 0===U&&(U=[C.length]);var A=U.length;if(void 0===K){K=new Array(A);for(var e=A-1,j=1;e>=0;--e)K[e]=j,j*=U[e]}if(void 0===m){m=0;for(e=0;e<A;++e)K[e]<0&&(m-=(U[e]-1)*K[e])}for(var p=function(C){if(O(C))return"buffer";if(X)switch(Object.prototype.toString.call(C)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(C)?"array":"generic"}(C),E=z[p];E.length<=A+1;)E.push(t(p,E.length-1));return(0,E[A+1])(C,U,K,m)}},13895:C=>{var U;self,U=()=>(()=>{"use strict";var C={d:(U,K)=>{for(var m in K)C.o(K,m)&&!C.o(U,m)&&Object.defineProperty(U,m,{enumerable:!0,get:K[m]})},o:(C,U)=>Object.prototype.hasOwnProperty.call(C,U)},U={};C.d(U,{default:()=>J});var K,m=function(C,U){var K=U.x-C.x,m=U.y-C.y;return Math.sqrt(K*K+m*m)},O=function(C){return C*(Math.PI/180)},X=new Map,A=function(C){X.has(C)&&clearTimeout(X.get(C)),X.set(C,setTimeout(C,100))},e=function(C,U,K){for(var m,O=U.split(/[ ,]+/g),X=0;X<O.length;X+=1)m=O[X],C.addEventListener?C.addEventListener(m,K,!1):C.attachEvent&&C.attachEvent(m,K)},t=function(C,U,K){for(var m,O=U.split(/[ ,]+/g),X=0;X<O.length;X+=1)m=O[X],C.removeEventListener?C.removeEventListener(m,K):C.detachEvent&&C.detachEvent(m,K)},z=function(C){return C.preventDefault(),C.type.match(/^touch/)?C.changedTouches:C},j=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},p=function(C,U){U.top||U.right||U.bottom||U.left?(C.style.top=U.top,C.style.right=U.right,C.style.bottom=U.bottom,C.style.left=U.left):(C.style.left=U.x+"px",C.style.top=U.y+"px")},E=function(C,U,K){var m=u(C);for(var O in m)if(m.hasOwnProperty(O))if("string"==typeof U)m[O]=U+" "+K;else{for(var X="",A=0,e=U.length;A<e;A+=1)X+=U[A]+" "+K+", ";m[O]=X.slice(0,-2)}return m},u=function(C){var U={};return U[C]="",["webkit","Moz","o"].forEach((function(K){U[K+C.charAt(0).toUpperCase()+C.slice(1)]=""})),U},b=function(C,U){for(var K in U)U.hasOwnProperty(K)&&(C[K]=U[K]);return C},v=function(C,U){if(C.length)for(var K=0,m=C.length;K<m;K+=1)U(C[K]);else U(C)},Q="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,V=window.matchMedia("(any-hover: none)").matches,f=!!("ontouchstart"in window),F=!!window.PointerEvent,Z=!!window.MSPointerEvent,P={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},H={start:"mousedown",move:"mousemove",end:"mouseup"},d={};function T(){}Q&&!V?K=P:F?K={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Z?K={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:f?(K=P,d=H):K=H,T.prototype.on=function(C,U){var K,m=this,O=C.split(/[ ,]+/g);m._handlers_=m._handlers_||{};for(var X=0;X<O.length;X+=1)K=O[X],m._handlers_[K]=m._handlers_[K]||[],m._handlers_[K].push(U);return m},T.prototype.off=function(C,U){var K=this;return K._handlers_=K._handlers_||{},void 0===C?K._handlers_={}:void 0===U?K._handlers_[C]=null:K._handlers_[C]&&K._handlers_[C].indexOf(U)>=0&&K._handlers_[C].splice(K._handlers_[C].indexOf(U),1),K},T.prototype.trigger=function(C,U){var K,m=this,O=C.split(/[ ,]+/g);m._handlers_=m._handlers_||{};for(var X=0;X<O.length;X+=1)K=O[X],m._handlers_[K]&&m._handlers_[K].length&&m._handlers_[K].forEach((function(C){C.call(m,{type:K,target:m},U)}))},T.prototype.config=function(C){var U=this;U.options=U.defaults||{},C&&(U.options=function(C,U){var K={};for(var m in C)C.hasOwnProperty(m)&&U.hasOwnProperty(m)?K[m]=U[m]:C.hasOwnProperty(m)&&(K[m]=C[m]);return K}(U.options,C))},T.prototype.bindEvt=function(C,U){var m=this;return m._domHandlers_=m._domHandlers_||{},m._domHandlers_[U]=function(){"function"==typeof m["on"+U]?m["on"+U].apply(m,arguments):console.warn('[WARNING] : Missing "on'+U+'" handler.')},e(C,K[U],m._domHandlers_[U]),d[U]&&e(C,d[U],m._domHandlers_[U]),m},T.prototype.unbindEvt=function(C,U){var m=this;return m._domHandlers_=m._domHandlers_||{},t(C,K[U],m._domHandlers_[U]),d[U]&&t(C,d[U],m._domHandlers_[U]),delete m._domHandlers_[U],this};const y=T;function a(C,U){return this.identifier=U.identifier,this.position=U.position,this.frontPosition=U.frontPosition,this.collection=C,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(U),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=a.id,a.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}a.prototype=new y,a.constructor=a,a.id=0,a.prototype.buildEl=function(C){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},a.prototype.stylize=function(){if(this.options.dataOnly)return this;var C=this.options.fadeTime+"ms",U=function(){var C=u("borderRadius");for(var U in C)C.hasOwnProperty(U)&&(C[U]="50%");return C}(),K=E("transition","opacity",C),m={};return m.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},m.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},m.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},b(m.el,K),"circle"===this.options.shape&&b(m.back,U),b(m.front,U),this.applyStyles(m),this},a.prototype.applyStyles=function(C){for(var U in this.ui)if(this.ui.hasOwnProperty(U))for(var K in C[U])this.ui[U].style[K]=C[U][K];return this},a.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},a.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},a.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},a.prototype.show=function(C){var U=this;return U.options.dataOnly||(clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.addToDom(),U.restCallback(),setTimeout((function(){U.ui.el.style.opacity=1}),0),U.showTimeout=setTimeout((function(){U.trigger("shown",U.instance),"function"==typeof C&&C.call(this)}),U.options.fadeTime)),U},a.prototype.hide=function(C){var U=this;if(U.options.dataOnly)return U;if(U.ui.el.style.opacity=U.options.restOpacity,clearTimeout(U.removeTimeout),clearTimeout(U.showTimeout),clearTimeout(U.restTimeout),U.removeTimeout=setTimeout((function(){var K="dynamic"===U.options.mode?"none":"block";U.ui.el.style.display=K,"function"==typeof C&&C.call(U),U.trigger("hidden",U.instance)}),U.options.fadeTime),U.options.restJoystick){var K=U.options.restJoystick,m={};m.x=!0===K||!1!==K.x?0:U.instance.frontPosition.x,m.y=!0===K||!1!==K.y?0:U.instance.frontPosition.y,U.setPosition(C,m)}return U},a.prototype.setPosition=function(C,U){var K=this;K.frontPosition={x:U.x,y:U.y};var m=K.options.fadeTime+"ms",O={};O.front=E("transition",["transform"],m);var X={front:{}};X.front={transform:"translate("+K.frontPosition.x+"px,"+K.frontPosition.y+"px)"},K.applyStyles(O),K.applyStyles(X),K.restTimeout=setTimeout((function(){"function"==typeof C&&C.call(K),K.restCallback()}),K.options.fadeTime)},a.prototype.restCallback=function(){var C=this,U={};U.front=E("transition","none",""),C.applyStyles(U),C.trigger("rested",C.instance)},a.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},a.prototype.computeDirection=function(C){var U,K,m,O=C.angle.radian,X=Math.PI/4,A=Math.PI/2;if(O>X&&O<3*X&&!C.lockX?U="up":O>-X&&O<=X&&!C.lockY?U="left":O>3*-X&&O<=-X&&!C.lockX?U="down":C.lockY||(U="right"),C.lockY||(K=O>-A&&O<A?"left":"right"),C.lockX||(m=O>0?"up":"down"),C.force>this.options.threshold){var e,t={};for(e in this.direction)this.direction.hasOwnProperty(e)&&(t[e]=this.direction[e]);var z={};for(e in this.direction={x:K,y:m,angle:U},C.direction=this.direction,t)t[e]===this.direction[e]&&(z[e]=!0);if(z.x&&z.y&&z.angle)return C;z.x&&z.y||this.trigger("plain",C),z.x||this.trigger("plain:"+K,C),z.y||this.trigger("plain:"+m,C),z.angle||this.trigger("dir dir:"+U,C)}else this.resetDirection();return C};const r=a;function i(C,U){var K=this;K.nipples=[],K.idles=[],K.actives=[],K.ids=[],K.pressureIntervals={},K.manager=C,K.id=i.id,i.id+=1,K.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},K.config(U),"static"!==K.options.mode&&"semi"!==K.options.mode||(K.options.multitouch=!1),K.options.multitouch||(K.options.maxNumberOfNipples=1);var m=getComputedStyle(K.options.zone.parentElement);return m&&"flex"===m.display&&(K.parentIsFlex=!0),K.updateBox(),K.prepareNipples(),K.uE(),K.begin(),K.nipples}i.prototype=new y,i.constructor=i,i.id=0,i.prototype.prepareNipples=function(){var C=this,U=C.nipples;U.on=C.on.bind(C),U.off=C.off.bind(C),U.options=C.options,U.destroy=C.destroy.bind(C),U.ids=C.ids,U.id=C.id,U.processOnMove=C.processOnMove.bind(C),U.processOnEnd=C.processOnEnd.bind(C),U.get=function(C){if(void 0===C)return U[0];for(var K=0,m=U.length;K<m;K+=1)if(U[K].identifier===C)return U[K];return!1}},i.prototype.uE=function(){var C=this;C.bindEvt(C.options.zone,"start"),C.options.zone.style.touchAction="none",C.options.zone.style.msTouchAction="none"},i.prototype.begin=function(){var C=this,U=C.options;if("static"===U.mode){var K=C.createNipple(U.position,C.manager.getIdentifier());K.add(),C.idles.push(K)}},i.prototype.createNipple=function(C,U){var K=this,m=K.manager.scroll,O={},X=K.options,A=K.parentIsFlex?m.x:m.x+K.box.left,e=K.parentIsFlex?m.y:m.y+K.box.top;if(C.x&&C.y)O={x:C.x-A,y:C.y-e};else if(C.top||C.right||C.bottom||C.left){var t=document.createElement("DIV");t.style.display="hidden",t.style.top=C.top,t.style.right=C.right,t.style.bottom=C.bottom,t.style.left=C.left,t.style.position="absolute",X.zone.appendChild(t);var z=t.getBoundingClientRect();X.zone.removeChild(t),O=C,C={x:z.left+m.x,y:z.top+m.y}}var j=new r(K,{color:X.color,size:X.size,threshold:X.threshold,fadeTime:X.fadeTime,dataOnly:X.dataOnly,restJoystick:X.restJoystick,restOpacity:X.restOpacity,mode:X.mode,identifier:U,position:C,zone:X.zone,frontPosition:{x:0,y:0},shape:X.shape});return X.dataOnly||(p(j.ui.el,O),p(j.ui.front,j.frontPosition)),K.nipples.push(j),K.trigger("added "+j.identifier+":added",j),K.manager.trigger("added "+j.identifier+":added",j),K.bindNipple(j),j},i.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},i.prototype.bindNipple=function(C){var U,K=this,m=function(C,m){U=C.type+" "+m.id+":"+C.type,K.trigger(U,m)};C.on("destroyed",K.onDestroyed.bind(K)),C.on("shown hidden rested dir plain",m),C.on("dir:up dir:right dir:down dir:left",m),C.on("plain:up plain:right plain:down plain:left",m)},i.prototype.pressureFn=function(C,U,K){var m=this,O=0;clearInterval(m.pressureIntervals[K]),m.pressureIntervals[K]=setInterval(function(){var K=C.force||C.pressure||C.webkitForce||0;K!==O&&(U.trigger("pressure",K),m.trigger("pressure "+U.identifier+":pressure",K),O=K)}.bind(m),100)},i.prototype.onstart=function(C){var U=this,K=U.options,m=C;return C=z(C),U.updateBox(),v(C,(function(O){U.actives.length<K.maxNumberOfNipples?U.processOnStart(O):m.type.match(/^touch/)&&(Object.keys(U.manager.ids).forEach((function(K){if(Object.values(m.touches).findIndex((function(C){return C.identifier===K}))<0){var O=[C[0]];O.identifier=K,U.processOnEnd(O)}})),U.actives.length<K.maxNumberOfNipples&&U.processOnStart(O))})),U.manager.bindDocument(),!1},i.prototype.processOnStart=function(C){var U,K=this,O=K.options,X=K.manager.getIdentifier(C),A=C.force||C.pressure||C.webkitForce||0,e={x:C.pageX,y:C.pageY},t=K.getOrCreate(X,e);t.identifier!==X&&K.manager.removeIdentifier(t.identifier),t.identifier=X;var z=function(U){U.trigger("start",U),K.trigger("start "+U.id+":start",U),U.show(),A>0&&K.pressureFn(C,U,U.identifier),K.processOnMove(C)};if((U=K.idles.indexOf(t))>=0&&K.idles.splice(U,1),K.actives.push(t),K.ids.push(t.identifier),"semi"!==O.mode)z(t);else{if(!(m(e,t.position)<=O.catchDistance))return t.destroy(),void K.processOnStart(C);z(t)}return t},i.prototype.getOrCreate=function(C,U){var K,m=this,O=m.options;return/(semi|static)/.test(O.mode)?(K=m.idles[0])?(m.idles.splice(0,1),K):"semi"===O.mode?m.createNipple(U,C):(console.warn("Coudln't find the needed nipple."),!1):K=m.createNipple(U,C)},i.prototype.processOnMove=function(C){var U=this,K=U.options,X=U.manager.getIdentifier(C),A=U.nipples.get(X),e=U.manager.scroll;if(function(C){return isNaN(C.buttons)?0!==C.pressure:0!==C.buttons}(C)){if(!A)return console.error("Found zombie joystick with ID "+X),void U.manager.removeIdentifier(X);if(K.dynamicPage){var t=A.el.getBoundingClientRect();A.position={x:e.x+t.left,y:e.y+t.top}}A.identifier=X;var z=A.options.size/2,j={x:C.pageX,y:C.pageY};K.lockX&&(j.y=A.position.y),K.lockY&&(j.x=A.position.x);var p,E,u,b,v,Q,V,f,F,Z,P=m(j,A.position),H=(p=j,u=(E=A.position).x-p.x,b=E.y-p.y,function(C){return C*(180/Math.PI)}(Math.atan2(b,u))),d=O(H),T=P/z,y={distance:P,position:j};if("circle"===A.options.shape?(v=Math.min(P,z),V=A.position,f=v,Z={x:0,y:0},F=O(F=H),Z.x=V.x-f*Math.cos(F),Z.y=V.y-f*Math.sin(F),Q=Z):(Q=function(C,U,K){return{x:Math.min(Math.max(C.x,U.x-K),U.x+K),y:Math.min(Math.max(C.y,U.y-K),U.y+K)}}(j,A.position,z),v=m(Q,A.position)),K.follow){if(P>z){var a=j.x-Q.x,r=j.y-Q.y;A.position.x+=a,A.position.y+=r,A.el.style.top=A.position.y-(U.box.top+e.y)+"px",A.el.style.left=A.position.x-(U.box.left+e.x)+"px",P=m(j,A.position)}}else j=Q,P=v;var i=j.x-A.position.x,D=j.y-A.position.y;A.frontPosition={x:i,y:D},K.dataOnly||(A.ui.front.style.transform="translate("+i+"px,"+D+"px)");var l={identifier:A.identifier,position:j,force:T,pressure:C.force||C.pressure||C.webkitForce||0,distance:P,angle:{radian:d,degree:H},vector:{x:i/z,y:-D/z},raw:y,instance:A,lockX:K.lockX,lockY:K.lockY};(l=A.computeDirection(l)).angle={radian:O(180-H),degree:180-H},A.trigger("move",l),U.trigger("move "+A.id+":move",l)}else this.processOnEnd(C)},i.prototype.processOnEnd=function(C){var U=this,K=U.options,m=U.manager.getIdentifier(C),O=U.nipples.get(m),X=U.manager.removeIdentifier(O.identifier);O&&(K.dataOnly||O.hide((function(){"dynamic"===K.mode&&(O.trigger("removed",O),U.trigger("removed "+O.id+":removed",O),U.manager.trigger("removed "+O.id+":removed",O),O.destroy())})),clearInterval(U.pressureIntervals[O.identifier]),O.resetDirection(),O.trigger("end",O),U.trigger("end "+O.id+":end",O),U.ids.indexOf(O.identifier)>=0&&U.ids.splice(U.ids.indexOf(O.identifier),1),U.actives.indexOf(O)>=0&&U.actives.splice(U.actives.indexOf(O),1),/(semi|static)/.test(K.mode)?U.idles.push(O):U.nipples.indexOf(O)>=0&&U.nipples.splice(U.nipples.indexOf(O),1),U.manager.unbindDocument(),/(semi|static)/.test(K.mode)&&(U.manager.ids[X.id]=X.identifier))},i.prototype.onDestroyed=function(C,U){var K=this;K.nipples.indexOf(U)>=0&&K.nipples.splice(K.nipples.indexOf(U),1),K.actives.indexOf(U)>=0&&K.actives.splice(K.actives.indexOf(U),1),K.idles.indexOf(U)>=0&&K.idles.splice(K.idles.indexOf(U),1),K.ids.indexOf(U.identifier)>=0&&K.ids.splice(K.ids.indexOf(U.identifier),1),K.manager.removeIdentifier(U.identifier),K.manager.unbindDocument()},i.prototype.destroy=function(){var C=this;for(var U in C.unbindEvt(C.options.zone,"start"),C.nipples.forEach((function(C){C.destroy()})),C.pressureIntervals)C.pressureIntervals.hasOwnProperty(U)&&clearInterval(C.pressureIntervals[U]);C.trigger("destroyed",C.nipples),C.manager.unbindDocument(),C.off()};const D=i;function l(C){var U=this;U.ids={},U.index=0,U.collections=[],U.scroll=j(),U.config(C),U.prepareCollections();var K=function(){var C;U.collections.forEach((function(K){K.forEach((function(K){C=K.el.getBoundingClientRect(),K.position={x:U.scroll.x+C.left,y:U.scroll.y+C.top}}))}))};e(window,"resize",(function(){A(K)}));var m=function(){U.scroll=j()};return e(window,"scroll",(function(){A(m)})),U.collections}l.prototype=new y,l.constructor=l,l.prototype.prepareCollections=function(){var C=this;C.collections.create=C.create.bind(C),C.collections.on=C.on.bind(C),C.collections.off=C.off.bind(C),C.collections.destroy=C.destroy.bind(C),C.collections.get=function(U){var K;return C.collections.every((function(C){return!(K=C.get(U))})),K}},l.prototype.create=function(C){return this.createCollection(C)},l.prototype.createCollection=function(C){var U=this,K=new D(U,C);return U.bindCollection(K),U.collections.push(K),K},l.prototype.bindCollection=function(C){var U,K=this,m=function(C,m){U=C.type+" "+m.id+":"+C.type,K.trigger(U,m)};C.on("destroyed",K.onDestroyed.bind(K)),C.on("shown hidden rested dir plain",m),C.on("dir:up dir:right dir:down dir:left",m),C.on("plain:up plain:right plain:down plain:left",m)},l.prototype.bindDocument=function(){var C=this;C.binded||(C.bindEvt(document,"move").bindEvt(document,"end"),C.binded=!0)},l.prototype.unbindDocument=function(C){var U=this;Object.keys(U.ids).length&&!0!==C||(U.unbindEvt(document,"move").unbindEvt(document,"end"),U.binded=!1)},l.prototype.getIdentifier=function(C){var U;return C?void 0===(U=void 0===C.identifier?C.pointerId:C.identifier)&&(U=this.latest||0):U=this.index,void 0===this.ids[U]&&(this.ids[U]=this.index,this.index+=1),this.latest=U,this.ids[U]},l.prototype.removeIdentifier=function(C){var U={};for(var K in this.ids)if(this.ids[K]===C){U.id=K,U.identifier=this.ids[K],delete this.ids[K];break}return U},l.prototype.onmove=function(C){return this.onAny("move",C),!1},l.prototype.onend=function(C){return this.onAny("end",C),!1},l.prototype.oncancel=function(C){return this.onAny("end",C),!1},l.prototype.onAny=function(C,U){var K,m=this,O="processOn"+C.charAt(0).toUpperCase()+C.slice(1);U=z(U);var X=function(C,U,K){K.ids.indexOf(U)>=0&&(K[O](C),C._found_=!0)};return v(U,(function(C){K=m.getIdentifier(C),v(m.collections,X.bind(null,C,K)),C._found_||m.removeIdentifier(K)})),!1},l.prototype.destroy=function(){var C=this;C.unbindDocument(!0),C.ids={},C.index=0,C.collections.forEach((function(C){C.destroy()})),C.off()},l.prototype.onDestroyed=function(C,U){var K=this;if(K.collections.indexOf(U)<0)return!1;K.collections.splice(K.collections.indexOf(U),1)};var G=new l;const J={create:function(C){return G.create(C)},factory:G};return U.default})(),C.exports=U()},12913:(C,U,K)=>{"use strict";const{Deflate:m,deflate:O,deflateRaw:X,gzip:A}=K(12919),{Inflate:e,inflate:t,inflateRaw:z,ungzip:j}=K(12973),p=K(12953);C.exports.Deflate=m,C.exports.deflate=O,C.exports.deflateRaw=X,C.exports.gzip=A,C.exports.Inflate=e,C.exports.inflate=t,C.exports.inflateRaw=z,C.exports.ungzip=j,C.exports.constants=p},12919:(C,U,K)=>{"use strict";const m=K(12921),O=K(12959),X=K(12964),A=K(12949),e=K(12967),t=Object.prototype.toString,{Z_NO_FLUSH:z,Z_SYNC_FLUSH:j,Z_FULL_FLUSH:p,Z_FINISH:E,Z_OK:u,Z_STREAM_END:b,Z_DEFAULT_COMPRESSION:v,Z_DEFAULT_STRATEGY:Q,Z_DEFLATED:V}=K(12953);function f(C){this.options=O.assign({level:v,method:V,hC:16384,windowBits:15,memLevel:8,strategy:Q},C||{});let U=this.options;U.raw&&U.windowBits>0?U.windowBits=-U.windowBits:U.gzip&&U.windowBits>0&&U.windowBits<16&&(U.windowBits+=16),this.err=0,this.zU="",this.ended=!1,this.chunks=[],this.strm=new e,this.strm.avail_out=0;let K=m.deflateInit2(this.strm,U.level,U.method,U.windowBits,U.memLevel,U.strategy);if(K!==u)throw new Error(A[K]);if(U.header&&m.deflateSetHeader(this.strm,U.header),U.dictionary){let C;if(C="string"===typeof U.dictionary?X.string2buf(U.dictionary):"[object ArrayBuffer]"===t.call(U.dictionary)?new Uint8Array(U.dictionary):U.dictionary,K=m.deflateSetDictionary(this.strm,C),K!==u)throw new Error(A[K]);this._dict_set=!0}}function F(C,U){const K=new f(U);if(K.push(C,!0),K.err)throw K.zU||A[K.err];return K.result}f.prototype.push=function(C,U){const K=this.strm,O=this.options.hC;let A,e;if(this.ended)return!1;for(e=U===~~U?U:!0===U?E:z,"string"===typeof C?K.input=X.string2buf(C):"[object ArrayBuffer]"===t.call(C)?K.input=new Uint8Array(C):K.input=C,K.next_in=0,K.avail_in=K.input.length;;)if(0===K.avail_out&&(K.output=new Uint8Array(O),K.next_out=0,K.avail_out=O),(e===j||e===p)&&K.avail_out<=6)this.onData(K.output.subarray(0,K.next_out)),K.avail_out=0;else{if(A=m.deflate(K,e),A===b)return K.next_out>0&&this.onData(K.output.subarray(0,K.next_out)),A=m.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===u;if(0!==K.avail_out){if(e>0&&K.next_out>0)this.onData(K.output.subarray(0,K.next_out)),K.avail_out=0;else if(0===K.avail_in)break}else this.onData(K.output)}return!0},f.prototype.onData=function(C){this.chunks.push(C)},f.prototype.onEnd=function(C){C===u&&(this.result=O.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.zU=this.strm.zU},C.exports.Deflate=f,C.exports.deflate=F,C.exports.deflateRaw=function(C,U){return(U=U||{}).raw=!0,F(C,U)},C.exports.gzip=function(C,U){return(U=U||{}).gzip=!0,F(C,U)},C.exports.constants=K(12953)},12973:(C,U,K)=>{"use strict";const m=K(12980),O=K(12959),X=K(12964),A=K(12949),e=K(12967),t=K(12997),z=Object.prototype.toString,{Z_NO_FLUSH:j,Z_FINISH:p,Z_OK:E,Z_STREAM_END:u,Z_NEED_DICT:b,Z_STREAM_ERROR:v,Z_DATA_ERROR:Q,Z_MEM_ERROR:V}=K(12953);function f(C){this.options=O.assign({hC:65536,windowBits:15,to:""},C||{});const U=this.options;U.raw&&U.windowBits>=0&&U.windowBits<16&&(U.windowBits=-U.windowBits,0===U.windowBits&&(U.windowBits=-15)),!(U.windowBits>=0&&U.windowBits<16)||C&&C.windowBits||(U.windowBits+=32),U.windowBits>15&&U.windowBits<48&&0===(15&U.windowBits)&&(U.windowBits|=15),this.err=0,this.zU="",this.ended=!1,this.chunks=[],this.strm=new e,this.strm.avail_out=0;let K=m.inflateInit2(this.strm,U.windowBits);if(K!==E)throw new Error(A[K]);if(this.header=new t,m.inflateGetHeader(this.strm,this.header),U.dictionary&&("string"===typeof U.dictionary?U.dictionary=X.string2buf(U.dictionary):"[object ArrayBuffer]"===z.call(U.dictionary)&&(U.dictionary=new Uint8Array(U.dictionary)),U.raw&&(K=m.inflateSetDictionary(this.strm,U.dictionary),K!==E)))throw new Error(A[K])}function F(C,U){const K=new f(U);if(K.push(C),K.err)throw K.zU||A[K.err];return K.result}f.prototype.push=function(C,U){const K=this.strm,O=this.options.hC,A=this.options.dictionary;let e,t,f;if(this.ended)return!1;for(t=U===~~U?U:!0===U?p:j,"[object ArrayBuffer]"===z.call(C)?K.input=new Uint8Array(C):K.input=C,K.next_in=0,K.avail_in=K.input.length;;){for(0===K.avail_out&&(K.output=new Uint8Array(O),K.next_out=0,K.avail_out=O),e=m.inflate(K,t),e===b&&A&&(e=m.inflateSetDictionary(K,A),e===E?e=m.inflate(K,t):e===Q&&(e=b));K.avail_in>0&&e===u&&K.state.wrap>0&&0!==C[K.next_in];)m.inflateReset(K),e=m.inflate(K,t);switch(e){case v:case Q:case b:case V:return this.onEnd(e),this.ended=!0,!1}if(f=K.avail_out,K.next_out&&(0===K.avail_out||e===u))if("string"===this.options.to){let C=X.utf8border(K.output,K.next_out),U=K.next_out-C,m=X.buf2string(K.output,C);K.next_out=U,K.avail_out=O-U,U&&K.output.set(K.output.subarray(C,C+U),0),this.onData(m)}else this.onData(K.output.length===K.next_out?K.output:K.output.subarray(0,K.next_out));if(e!==E||0!==f){if(e===u)return e=m.inflateEnd(this.strm),this.onEnd(e),this.ended=!0,!0;if(0===K.avail_in)break}}return!0},f.prototype.onData=function(C){this.chunks.push(C)},f.prototype.onEnd=function(C){C===E&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=O.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.zU=this.strm.zU},C.exports.Inflate=f,C.exports.inflate=F,C.exports.inflateRaw=function(C,U){return(U=U||{}).raw=!0,F(C,U)},C.exports.ungzip=F,C.exports.constants=K(12953)},12959:C=>{"use strict";const U=(C,U)=>Object.prototype.hasOwnProperty.call(C,U);C.exports.assign=function(C){const K=Array.prototype.slice.call(arguments,1);for(;K.length;){const m=K.shift();if(m){if("object"!==typeof m)throw new TypeError(m+"must be non-object");for(const K in m)U(m,K)&&(C[K]=m[K])}}return C},C.exports.flattenChunks=C=>{let U=0;for(let m=0,O=C.length;m<O;m++)U+=C[m].length;const K=new Uint8Array(U);for(let m=0,O=0,X=C.length;m<X;m++){let U=C[m];K.set(U,O),O+=U.length}return K}},12964:C=>{"use strict";let U=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(m){U=!1}const K=new Uint8Array(256);for(let O=0;O<256;O++)K[O]=O>=252?6:O>=248?5:O>=240?4:O>=224?3:O>=192?2:1;K[254]=K[254]=1,C.exports.string2buf=C=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(C);let U,K,m,O,X,A=C.length,e=0;for(O=0;O<A;O++)K=C.charCodeAt(O),55296===(64512&K)&&O+1<A&&(m=C.charCodeAt(O+1),56320===(64512&m)&&(K=65536+(K-55296<<10)+(m-56320),O++)),e+=K<128?1:K<2048?2:K<65536?3:4;for(U=new Uint8Array(e),X=0,O=0;X<e;O++)K=C.charCodeAt(O),55296===(64512&K)&&O+1<A&&(m=C.charCodeAt(O+1),56320===(64512&m)&&(K=65536+(K-55296<<10)+(m-56320),O++)),K<128?U[X++]=K:K<2048?(U[X++]=192|K>>>6,U[X++]=128|63&K):K<65536?(U[X++]=224|K>>>12,U[X++]=128|K>>>6&63,U[X++]=128|63&K):(U[X++]=240|K>>>18,U[X++]=128|K>>>12&63,U[X++]=128|K>>>6&63,U[X++]=128|63&K);return U};C.exports.buf2string=(C,m)=>{const O=m||C.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(C.subarray(0,m));let X,A;const e=new Array(2*O);for(A=0,X=0;X<O;){let U=C[X++];if(U<128){e[A++]=U;continue}let m=K[U];if(m>4)e[A++]=65533,X+=m-1;else{for(U&=2===m?31:3===m?15:7;m>1&&X<O;)U=U<<6|63&C[X++],m--;m>1?e[A++]=65533:U<65536?e[A++]=U:(U-=65536,e[A++]=55296|U>>10&1023,e[A++]=56320|1023&U)}}return((C,K)=>{if(K<65534&&C.subarray&&U)return String.fromCharCode.apply(null,C.length===K?C:C.subarray(0,K));let m="";for(let U=0;U<K;U++)m+=String.fromCharCode(C[U]);return m})(e,A)},C.exports.utf8border=(C,U)=>{(U=U||C.length)>C.length&&(U=C.length);let m=U-1;for(;m>=0&&128===(192&C[m]);)m--;return m<0||0===m?U:m+K[C[m]]>U?m:U}},12933:C=>{"use strict";C.exports=(C,U,K,m)=>{let O=65535&C,X=C>>>16&65535,A=0;for(;0!==K;){A=K>2e3?2e3:K,K-=A;do{O=O+U[m++]|0,X=X+O|0}while(--A);O%=65521,X%=65521}return O|X<<16}},12953:C=>{"use strict";C.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12940:C=>{"use strict";const U=new Uint32Array((()=>{let C,U=[];for(var K=0;K<256;K++){C=K;for(var m=0;m<8;m++)C=1&C?3988292384^C>>>1:C>>>1;U[K]=C}return U})());C.exports=(C,K,m,O)=>{const X=U,A=O+m;C^=-1;for(let U=O;U<A;U++)C=C>>>8^X[255&(C^K[U])];return~C}},12921:(C,U,K)=>{"use strict";const{_tr_init:m,_tr_stored_block:O,_tr_flush_block:X,_tr_tally:A,_tr_align:e}=K(12929),t=K(12933),z=K(12940),j=K(12949),{Z_NO_FLUSH:p,Z_PARTIAL_FLUSH:E,Z_FULL_FLUSH:u,Z_FINISH:b,Z_BLOCK:v,Z_OK:Q,Z_STREAM_END:V,Z_STREAM_ERROR:f,Z_DATA_ERROR:F,Z_BUF_ERROR:Z,Z_DEFAULT_COMPRESSION:P,Z_FILTERED:H,Z_HUFFMAN_ONLY:d,Z_RLE:T,Z_FIXED:y,Z_DEFAULT_STRATEGY:a,Z_UNKNOWN:r,Z_DEFLATED:i}=K(12953),D=258,l=262,G=103,J=113,o=666,B=(C,U)=>(C.zU=j[U],U),k=C=>(C<<1)-(C>4?9:0),w=C=>{let U=C.length;for(;--U>=0;)C[U]=0};let h=(C,U,K)=>(U<<C.hash_shift^K)&C.hash_mask;const c=C=>{const U=C.state;let K=U.pending;K>C.avail_out&&(K=C.avail_out),0!==K&&(C.output.set(U.pending_buf.subarray(U.pending_out,U.pending_out+K),C.next_out),C.next_out+=K,U.pending_out+=K,C.total_out+=K,C.avail_out-=K,U.pending-=K,0===U.pending&&(U.pending_out=0))},N=(C,U)=>{X(C,C.block_start>=0?C.block_start:-1,C.strstart-C.block_start,U),C.block_start=C.strstart,c(C.strm)},g=(C,U)=>{C.pending_buf[C.pending++]=U},M=(C,U)=>{C.pending_buf[C.pending++]=U>>>8&255,C.pending_buf[C.pending++]=255&U},L=(C,U,K,m)=>{let O=C.avail_in;return O>m&&(O=m),0===O?0:(C.avail_in-=O,U.set(C.input.subarray(C.next_in,C.next_in+O),K),1===C.state.wrap?C.adler=t(C.adler,U,O,K):2===C.state.wrap&&(C.adler=z(C.adler,U,O,K)),C.next_in+=O,C.total_in+=O,O)},Y=(C,U)=>{let K,m,O=C.max_chain_length,X=C.strstart,A=C.prev_length,e=C.nice_match;const t=C.strstart>C.w_size-l?C.strstart-(C.w_size-l):0,z=C.window,j=C.w_mask,p=C.prev,E=C.strstart+D;let u=z[X+A-1],b=z[X+A];C.prev_length>=C.good_match&&(O>>=2),e>C.lookahead&&(e=C.lookahead);do{if(K=U,z[K+A]===b&&z[K+A-1]===u&&z[K]===z[X]&&z[++K]===z[X+1]){X+=2,K++;do{}while(z[++X]===z[++K]&&z[++X]===z[++K]&&z[++X]===z[++K]&&z[++X]===z[++K]&&z[++X]===z[++K]&&z[++X]===z[++K]&&z[++X]===z[++K]&&z[++X]===z[++K]&&X<E);if(m=D-(E-X),X=E-D,m>A){if(C.match_start=U,A=m,m>=e)break;u=z[X+A-1],b=z[X+A]}}}while((U=p[U&j])>t&&0!==--O);return A<=C.lookahead?A:C.lookahead},W=C=>{const U=C.w_size;let K,m,O,X,A;do{if(X=C.window_size-C.lookahead-C.strstart,C.strstart>=U+(U-l)){C.window.set(C.window.subarray(U,U+U),0),C.match_start-=U,C.strstart-=U,C.block_start-=U,m=C.hash_size,K=m;do{O=C.head[--K],C.head[K]=O>=U?O-U:0}while(--m);m=U,K=m;do{O=C.prev[--K],C.prev[K]=O>=U?O-U:0}while(--m);X+=U}if(0===C.strm.avail_in)break;if(m=L(C.strm,C.window,C.strstart+C.lookahead,X),C.lookahead+=m,C.lookahead+C.insert>=3)for(A=C.strstart-C.insert,C.ins_h=C.window[A],C.ins_h=h(C,C.ins_h,C.window[A+1]);C.insert&&(C.ins_h=h(C,C.ins_h,C.window[A+3-1]),C.prev[A&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=A,A++,C.insert--,!(C.lookahead+C.insert<3)););}while(C.lookahead<l&&0!==C.strm.avail_in)},x=(C,U)=>{let K,m;for(;;){if(C.lookahead<l){if(W(C),C.lookahead<l&&U===p)return 1;if(0===C.lookahead)break}if(K=0,C.lookahead>=3&&(C.ins_h=h(C,C.ins_h,C.window[C.strstart+3-1]),K=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),0!==K&&C.strstart-K<=C.w_size-l&&(C.match_length=Y(C,K)),C.match_length>=3)if(m=A(C,C.strstart-C.match_start,C.match_length-3),C.lookahead-=C.match_length,C.match_length<=C.max_lazy_match&&C.lookahead>=3){C.match_length--;do{C.strstart++,C.ins_h=h(C,C.ins_h,C.window[C.strstart+3-1]),K=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart}while(0!==--C.match_length);C.strstart++}else C.strstart+=C.match_length,C.match_length=0,C.ins_h=C.window[C.strstart],C.ins_h=h(C,C.ins_h,C.window[C.strstart+1]);else m=A(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++;if(m&&(N(C,!1),0===C.strm.avail_out))return 1}return C.insert=C.strstart<2?C.strstart:2,U===b?(N(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(N(C,!1),0===C.strm.avail_out)?1:2},n=(C,U)=>{let K,m,O;for(;;){if(C.lookahead<l){if(W(C),C.lookahead<l&&U===p)return 1;if(0===C.lookahead)break}if(K=0,C.lookahead>=3&&(C.ins_h=h(C,C.ins_h,C.window[C.strstart+3-1]),K=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),C.prev_length=C.match_length,C.prev_match=C.match_start,C.match_length=2,0!==K&&C.prev_length<C.max_lazy_match&&C.strstart-K<=C.w_size-l&&(C.match_length=Y(C,K),C.match_length<=5&&(C.strategy===H||3===C.match_length&&C.strstart-C.match_start>4096)&&(C.match_length=2)),C.prev_length>=3&&C.match_length<=C.prev_length){O=C.strstart+C.lookahead-3,m=A(C,C.strstart-1-C.prev_match,C.prev_length-3),C.lookahead-=C.prev_length-1,C.prev_length-=2;do{++C.strstart<=O&&(C.ins_h=h(C,C.ins_h,C.window[C.strstart+3-1]),K=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart)}while(0!==--C.prev_length);if(C.match_available=0,C.match_length=2,C.strstart++,m&&(N(C,!1),0===C.strm.avail_out))return 1}else if(C.match_available){if(m=A(C,0,C.window[C.strstart-1]),m&&N(C,!1),C.strstart++,C.lookahead--,0===C.strm.avail_out)return 1}else C.match_available=1,C.strstart++,C.lookahead--}return C.match_available&&(m=A(C,0,C.window[C.strstart-1]),C.match_available=0),C.insert=C.strstart<2?C.strstart:2,U===b?(N(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(N(C,!1),0===C.strm.avail_out)?1:2};function S(C,U,K,m,O){this.good_length=C,this.max_lazy=U,this.nice_length=K,this.max_chain=m,this.func=O}const s=[new S(0,0,0,0,((C,U)=>{let K=65535;for(K>C.pending_buf_size-5&&(K=C.pending_buf_size-5);;){if(C.lookahead<=1){if(W(C),0===C.lookahead&&U===p)return 1;if(0===C.lookahead)break}C.strstart+=C.lookahead,C.lookahead=0;const m=C.block_start+K;if((0===C.strstart||C.strstart>=m)&&(C.lookahead=C.strstart-m,C.strstart=m,N(C,!1),0===C.strm.avail_out))return 1;if(C.strstart-C.block_start>=C.w_size-l&&(N(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,U===b?(N(C,!0),0===C.strm.avail_out?3:4):(C.strstart>C.block_start&&(N(C,!1),C.strm.avail_out),1)})),new S(4,4,8,4,x),new S(4,5,16,8,x),new S(4,6,32,32,x),new S(4,4,16,16,n),new S(8,16,32,32,n),new S(8,16,128,128,n),new S(8,32,128,256,n),new S(32,128,258,1024,n),new S(32,258,258,4096,n)];function R(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=i,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const q=C=>{if(!C||!C.state)return B(C,f);C.total_in=C.total_out=0,C.data_type=r;const U=C.state;return U.pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?42:J,C.adler=2===U.wrap?0:1,U.last_flush=p,m(U),Q},I=C=>{const U=q(C);var K;return U===Q&&((K=C.state).window_size=2*K.w_size,w(K.head),K.max_lazy_match=s[K.level].max_lazy,K.good_match=s[K.level].good_length,K.nice_match=s[K.level].nice_length,K.max_chain_length=s[K.level].max_chain,K.strstart=0,K.block_start=0,K.lookahead=0,K.insert=0,K.match_length=K.prev_length=2,K.match_available=0,K.ins_h=0),U},CC=(C,U,K,m,O,X)=>{if(!C)return f;let A=1;if(U===P&&(U=6),m<0?(A=0,m=-m):m>15&&(A=2,m-=16),O<1||O>9||K!==i||m<8||m>15||U<0||U>9||X<0||X>y)return B(C,f);8===m&&(m=9);const e=new R;return C.state=e,e.strm=C,e.wrap=A,e.gzhead=null,e.w_bits=m,e.w_size=1<<e.w_bits,e.w_mask=e.w_size-1,e.hash_bits=O+7,e.hash_size=1<<e.hash_bits,e.hash_mask=e.hash_size-1,e.hash_shift=~~((e.hash_bits+3-1)/3),e.window=new Uint8Array(2*e.w_size),e.head=new Uint16Array(e.hash_size),e.prev=new Uint16Array(e.w_size),e.lit_bufsize=1<<O+6,e.pending_buf_size=4*e.lit_bufsize,e.pending_buf=new Uint8Array(e.pending_buf_size),e.d_buf=1*e.lit_bufsize,e.l_buf=3*e.lit_bufsize,e.level=U,e.strategy=X,e.method=K,I(C)};C.exports.deflateInit=(C,U)=>CC(C,U,i,15,8,a),C.exports.deflateInit2=CC,C.exports.deflateReset=I,C.exports.deflateResetKeep=q,C.exports.deflateSetHeader=(C,U)=>C&&C.state?2!==C.state.wrap?f:(C.state.gzhead=U,Q):f,C.exports.deflate=(C,U)=>{let K,m;if(!C||!C.state||U>v||U<0)return C?B(C,f):f;const X=C.state;if(!C.output||!C.input&&0!==C.avail_in||X.status===o&&U!==b)return B(C,0===C.avail_out?Z:f);X.strm=C;const t=X.last_flush;if(X.last_flush=U,42===X.status)if(2===X.wrap)C.adler=0,g(X,31),g(X,139),g(X,8),X.gzhead?(g(X,(X.gzhead.text?1:0)+(X.gzhead.hcrc?2:0)+(X.gzhead.extra?4:0)+(X.gzhead.name?8:0)+(X.gzhead.comment?16:0)),g(X,255&X.gzhead.time),g(X,X.gzhead.time>>8&255),g(X,X.gzhead.time>>16&255),g(X,X.gzhead.time>>24&255),g(X,9===X.level?2:X.strategy>=d||X.level<2?4:0),g(X,255&X.gzhead.os),X.gzhead.extra&&X.gzhead.extra.length&&(g(X,255&X.gzhead.extra.length),g(X,X.gzhead.extra.length>>8&255)),X.gzhead.hcrc&&(C.adler=z(C.adler,X.pending_buf,X.pending,0)),X.gzindex=0,X.status=69):(g(X,0),g(X,0),g(X,0),g(X,0),g(X,0),g(X,9===X.level?2:X.strategy>=d||X.level<2?4:0),g(X,3),X.status=J);else{let U=i+(X.w_bits-8<<4)<<8,K=-1;K=X.strategy>=d||X.level<2?0:X.level<6?1:6===X.level?2:3,U|=K<<6,0!==X.strstart&&(U|=32),U+=31-U%31,X.status=J,M(X,U),0!==X.strstart&&(M(X,C.adler>>>16),M(X,65535&C.adler)),C.adler=1}if(69===X.status)if(X.gzhead.extra){for(K=X.pending;X.gzindex<(65535&X.gzhead.extra.length)&&(X.pending!==X.pending_buf_size||(X.gzhead.hcrc&&X.pending>K&&(C.adler=z(C.adler,X.pending_buf,X.pending-K,K)),c(C),K=X.pending,X.pending!==X.pending_buf_size));)g(X,255&X.gzhead.extra[X.gzindex]),X.gzindex++;X.gzhead.hcrc&&X.pending>K&&(C.adler=z(C.adler,X.pending_buf,X.pending-K,K)),X.gzindex===X.gzhead.extra.length&&(X.gzindex=0,X.status=73)}else X.status=73;if(73===X.status)if(X.gzhead.name){K=X.pending;do{if(X.pending===X.pending_buf_size&&(X.gzhead.hcrc&&X.pending>K&&(C.adler=z(C.adler,X.pending_buf,X.pending-K,K)),c(C),K=X.pending,X.pending===X.pending_buf_size)){m=1;break}m=X.gzindex<X.gzhead.name.length?255&X.gzhead.name.charCodeAt(X.gzindex++):0,g(X,m)}while(0!==m);X.gzhead.hcrc&&X.pending>K&&(C.adler=z(C.adler,X.pending_buf,X.pending-K,K)),0===m&&(X.gzindex=0,X.status=91)}else X.status=91;if(91===X.status)if(X.gzhead.comment){K=X.pending;do{if(X.pending===X.pending_buf_size&&(X.gzhead.hcrc&&X.pending>K&&(C.adler=z(C.adler,X.pending_buf,X.pending-K,K)),c(C),K=X.pending,X.pending===X.pending_buf_size)){m=1;break}m=X.gzindex<X.gzhead.comment.length?255&X.gzhead.comment.charCodeAt(X.gzindex++):0,g(X,m)}while(0!==m);X.gzhead.hcrc&&X.pending>K&&(C.adler=z(C.adler,X.pending_buf,X.pending-K,K)),0===m&&(X.status=G)}else X.status=G;if(X.status===G&&(X.gzhead.hcrc?(X.pending+2>X.pending_buf_size&&c(C),X.pending+2<=X.pending_buf_size&&(g(X,255&C.adler),g(X,C.adler>>8&255),C.adler=0,X.status=J)):X.status=J),0!==X.pending){if(c(C),0===C.avail_out)return X.last_flush=-1,Q}else if(0===C.avail_in&&k(U)<=k(t)&&U!==b)return B(C,Z);if(X.status===o&&0!==C.avail_in)return B(C,Z);if(0!==C.avail_in||0!==X.lookahead||U!==p&&X.status!==o){let K=X.strategy===d?((C,U)=>{let K;for(;;){if(0===C.lookahead&&(W(C),0===C.lookahead)){if(U===p)return 1;break}if(C.match_length=0,K=A(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++,K&&(N(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,U===b?(N(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(N(C,!1),0===C.strm.avail_out)?1:2})(X,U):X.strategy===T?((C,U)=>{let K,m,O,X;const e=C.window;for(;;){if(C.lookahead<=D){if(W(C),C.lookahead<=D&&U===p)return 1;if(0===C.lookahead)break}if(C.match_length=0,C.lookahead>=3&&C.strstart>0&&(O=C.strstart-1,m=e[O],m===e[++O]&&m===e[++O]&&m===e[++O])){X=C.strstart+D;do{}while(m===e[++O]&&m===e[++O]&&m===e[++O]&&m===e[++O]&&m===e[++O]&&m===e[++O]&&m===e[++O]&&m===e[++O]&&O<X);C.match_length=D-(X-O),C.match_length>C.lookahead&&(C.match_length=C.lookahead)}if(C.match_length>=3?(K=A(C,1,C.match_length-3),C.lookahead-=C.match_length,C.strstart+=C.match_length,C.match_length=0):(K=A(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++),K&&(N(C,!1),0===C.strm.avail_out))return 1}return C.insert=0,U===b?(N(C,!0),0===C.strm.avail_out?3:4):C.last_lit&&(N(C,!1),0===C.strm.avail_out)?1:2})(X,U):s[X.level].func(X,U);if(3!==K&&4!==K||(X.status=o),1===K||3===K)return 0===C.avail_out&&(X.last_flush=-1),Q;if(2===K&&(U===E?e(X):U!==v&&(O(X,0,0,!1),U===u&&(w(X.head),0===X.lookahead&&(X.strstart=0,X.block_start=0,X.insert=0))),c(C),0===C.avail_out))return X.last_flush=-1,Q}return U!==b?Q:X.wrap<=0?V:(2===X.wrap?(g(X,255&C.adler),g(X,C.adler>>8&255),g(X,C.adler>>16&255),g(X,C.adler>>24&255),g(X,255&C.total_in),g(X,C.total_in>>8&255),g(X,C.total_in>>16&255),g(X,C.total_in>>24&255)):(M(X,C.adler>>>16),M(X,65535&C.adler)),c(C),X.wrap>0&&(X.wrap=-X.wrap),0!==X.pending?Q:V)},C.exports.deflateEnd=C=>{if(!C||!C.state)return f;const U=C.state.status;return 42!==U&&69!==U&&73!==U&&91!==U&&U!==G&&U!==J&&U!==o?B(C,f):(C.state=null,U===J?B(C,F):Q)},C.exports.deflateSetDictionary=(C,U)=>{let K=U.length;if(!C||!C.state)return f;const m=C.state,O=m.wrap;if(2===O||1===O&&42!==m.status||m.lookahead)return f;if(1===O&&(C.adler=t(C.adler,U,K,0)),m.wrap=0,K>=m.w_size){0===O&&(w(m.head),m.strstart=0,m.block_start=0,m.insert=0);let C=new Uint8Array(m.w_size);C.set(U.subarray(K-m.w_size,K),0),U=C,K=m.w_size}const X=C.avail_in,A=C.next_in,e=C.input;for(C.avail_in=K,C.next_in=0,C.input=U,W(m);m.lookahead>=3;){let C=m.strstart,U=m.lookahead-2;do{m.ins_h=h(m,m.ins_h,m.window[C+3-1]),m.prev[C&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=C,C++}while(--U);m.strstart=C,m.lookahead=2,W(m)}return m.strstart+=m.lookahead,m.block_start=m.strstart,m.insert=m.lookahead,m.lookahead=0,m.match_length=m.prev_length=2,m.match_available=0,C.next_in=A,C.input=e,C.avail_in=X,m.wrap=O,Q},C.exports.deflateInfo="pako deflate (from Nodeca project)"},12997:C=>{"use strict";C.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12984:C=>{"use strict";C.exports=function(C,U){let K,m,O,X,A,e,t,z,j,p,E,u,b,v,Q,V,f,F,Z,P,H,d,T,y;const a=C.state;K=C.next_in,T=C.input,m=K+(C.avail_in-5),O=C.next_out,y=C.output,X=O-(U-C.avail_out),A=O+(C.avail_out-257),e=a.dmax,t=a.wsize,z=a.whave,j=a.wnext,p=a.window,E=a.hold,u=a.bits,b=a.lencode,v=a.distcode,Q=(1<<a.lenbits)-1,V=(1<<a.distbits)-1;C:do{u<15&&(E+=T[K++]<<u,u+=8,E+=T[K++]<<u,u+=8),f=b[E&Q];U:for(;;){if(F=f>>>24,E>>>=F,u-=F,F=f>>>16&255,0===F)y[O++]=65535&f;else{if(!(16&F)){if(0===(64&F)){f=b[(65535&f)+(E&(1<<F)-1)];continue U}if(32&F){a.mode=12;break C}C.zU="invalid literal/length code",a.mode=30;break C}Z=65535&f,F&=15,F&&(u<F&&(E+=T[K++]<<u,u+=8),Z+=E&(1<<F)-1,E>>>=F,u-=F),u<15&&(E+=T[K++]<<u,u+=8,E+=T[K++]<<u,u+=8),f=v[E&V];K:for(;;){if(F=f>>>24,E>>>=F,u-=F,F=f>>>16&255,!(16&F)){if(0===(64&F)){f=v[(65535&f)+(E&(1<<F)-1)];continue K}C.zU="invalid distance code",a.mode=30;break C}if(P=65535&f,F&=15,u<F&&(E+=T[K++]<<u,u+=8,u<F&&(E+=T[K++]<<u,u+=8)),P+=E&(1<<F)-1,P>e){C.zU="invalid distance too far back",a.mode=30;break C}if(E>>>=F,u-=F,F=O-X,P>F){if(F=P-F,F>z&&a.sane){C.zU="invalid distance too far back",a.mode=30;break C}if(H=0,d=p,0===j){if(H+=t-F,F<Z){Z-=F;do{y[O++]=p[H++]}while(--F);H=O-P,d=y}}else if(j<F){if(H+=t+j-F,F-=j,F<Z){Z-=F;do{y[O++]=p[H++]}while(--F);if(H=0,j<Z){F=j,Z-=F;do{y[O++]=p[H++]}while(--F);H=O-P,d=y}}}else if(H+=j-F,F<Z){Z-=F;do{y[O++]=p[H++]}while(--F);H=O-P,d=y}for(;Z>2;)y[O++]=d[H++],y[O++]=d[H++],y[O++]=d[H++],Z-=3;Z&&(y[O++]=d[H++],Z>1&&(y[O++]=d[H++]))}else{H=O-P;do{y[O++]=y[H++],y[O++]=y[H++],y[O++]=y[H++],Z-=3}while(Z>2);Z&&(y[O++]=y[H++],Z>1&&(y[O++]=y[H++]))}break}}break}}while(K<m&&O<A);Z=u>>3,K-=Z,u-=Z<<3,E&=(1<<u)-1,C.next_in=K,C.next_out=O,C.avail_in=K<m?m-K+5:5-(K-m),C.avail_out=O<A?A-O+257:257-(O-A),a.hold=E,a.bits=u}},12980:(C,U,K)=>{"use strict";const m=K(12933),O=K(12940),X=K(12984),A=K(12992),{Z_FINISH:e,Z_BLOCK:t,Z_TREES:z,Z_OK:j,Z_STREAM_END:p,Z_NEED_DICT:E,Z_STREAM_ERROR:u,Z_DATA_ERROR:b,Z_MEM_ERROR:v,Z_BUF_ERROR:Q,Z_DEFLATED:V}=K(12953),f=12,F=30,Z=C=>(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24);function P(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const H=C=>{if(!C||!C.state)return u;const U=C.state;return C.total_in=C.total_out=U.total=0,C.zU="",U.wrap&&(C.adler=1&U.wrap),U.mode=1,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new Int32Array(852),U.distcode=U.distdyn=new Int32Array(592),U.sane=1,U.back=-1,j},d=C=>{if(!C||!C.state)return u;const U=C.state;return U.wsize=0,U.whave=0,U.wnext=0,H(C)},T=(C,U)=>{let K;if(!C||!C.state)return u;const m=C.state;return U<0?(K=0,U=-U):(K=1+(U>>4),U<48&&(U&=15)),U&&(U<8||U>15)?u:(null!==m.window&&m.wbits!==U&&(m.window=null),m.wrap=K,m.wbits=U,d(C))},y=(C,U)=>{if(!C)return u;const K=new P;C.state=K,K.window=null;const m=T(C,U);return m!==j&&(C.state=null),m};let a,r,i=!0;const D=C=>{if(i){a=new Int32Array(512),r=new Int32Array(32);let U=0;for(;U<144;)C.lens[U++]=8;for(;U<256;)C.lens[U++]=9;for(;U<280;)C.lens[U++]=7;for(;U<288;)C.lens[U++]=8;for(A(1,C.lens,0,288,a,0,C.work,{bits:9}),U=0;U<32;)C.lens[U++]=5;A(2,C.lens,0,32,r,0,C.work,{bits:5}),i=!1}C.lencode=a,C.lenbits=9,C.distcode=r,C.distbits=5},l=(C,U,K,m)=>{let O;const X=C.state;return null===X.window&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new Uint8Array(X.wsize)),m>=X.wsize?(X.window.set(U.subarray(K-X.wsize,K),0),X.wnext=0,X.whave=X.wsize):(O=X.wsize-X.wnext,O>m&&(O=m),X.window.set(U.subarray(K-m,K-m+O),X.wnext),(m-=O)?(X.window.set(U.subarray(K-m,K),0),X.wnext=m,X.whave=X.wsize):(X.wnext+=O,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=O))),0};C.exports.inflateReset=d,C.exports.inflateReset2=T,C.exports.inflateResetKeep=H,C.exports.inflateInit=C=>y(C,15),C.exports.inflateInit2=y,C.exports.inflate=(C,U)=>{let K,P,H,d,T,y,a,r,i,G,J,o,B,k,w,h,c,N,g,M,L,Y,W=0;const x=new Uint8Array(4);let n,S;const s=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!C||!C.state||!C.output||!C.input&&0!==C.avail_in)return u;K=C.state,K.mode===f&&(K.mode=13),T=C.next_out,H=C.output,a=C.avail_out,d=C.next_in,P=C.input,y=C.avail_in,r=K.hold,i=K.bits,G=y,J=a,Y=j;C:for(;;)switch(K.mode){case 1:if(0===K.wrap){K.mode=13;break}for(;i<16;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(2&K.wrap&&35615===r){K.check=0,x[0]=255&r,x[1]=r>>>8&255,K.check=O(K.check,x,2,0),r=0,i=0,K.mode=2;break}if(K.flags=0,K.head&&(K.head.done=!1),!(1&K.wrap)||(((255&r)<<8)+(r>>8))%31){C.zU="incorrect header check",K.mode=F;break}if((15&r)!==V){C.zU="unknown compression method",K.mode=F;break}if(r>>>=4,i-=4,L=8+(15&r),0===K.wbits)K.wbits=L;else if(L>K.wbits){C.zU="invalid window size",K.mode=F;break}K.dmax=1<<K.wbits,C.adler=K.check=1,K.mode=512&r?10:f,r=0,i=0;break;case 2:for(;i<16;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(K.flags=r,(255&K.flags)!==V){C.zU="unknown compression method",K.mode=F;break}if(57344&K.flags){C.zU="unknown header flags set",K.mode=F;break}K.head&&(K.head.text=r>>8&1),512&K.flags&&(x[0]=255&r,x[1]=r>>>8&255,K.check=O(K.check,x,2,0)),r=0,i=0,K.mode=3;case 3:for(;i<32;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}K.head&&(K.head.time=r),512&K.flags&&(x[0]=255&r,x[1]=r>>>8&255,x[2]=r>>>16&255,x[3]=r>>>24&255,K.check=O(K.check,x,4,0)),r=0,i=0,K.mode=4;case 4:for(;i<16;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}K.head&&(K.head.xflags=255&r,K.head.os=r>>8),512&K.flags&&(x[0]=255&r,x[1]=r>>>8&255,K.check=O(K.check,x,2,0)),r=0,i=0,K.mode=5;case 5:if(1024&K.flags){for(;i<16;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}K.length=r,K.head&&(K.head.extra_len=r),512&K.flags&&(x[0]=255&r,x[1]=r>>>8&255,K.check=O(K.check,x,2,0)),r=0,i=0}else K.head&&(K.head.extra=null);K.mode=6;case 6:if(1024&K.flags&&(o=K.length,o>y&&(o=y),o&&(K.head&&(L=K.head.extra_len-K.length,K.head.extra||(K.head.extra=new Uint8Array(K.head.extra_len)),K.head.extra.set(P.subarray(d,d+o),L)),512&K.flags&&(K.check=O(K.check,P,o,d)),y-=o,d+=o,K.length-=o),K.length))break C;K.length=0,K.mode=7;case 7:if(2048&K.flags){if(0===y)break C;o=0;do{L=P[d+o++],K.head&&L&&K.length<65536&&(K.head.name+=String.fromCharCode(L))}while(L&&o<y);if(512&K.flags&&(K.check=O(K.check,P,o,d)),y-=o,d+=o,L)break C}else K.head&&(K.head.name=null);K.length=0,K.mode=8;case 8:if(4096&K.flags){if(0===y)break C;o=0;do{L=P[d+o++],K.head&&L&&K.length<65536&&(K.head.comment+=String.fromCharCode(L))}while(L&&o<y);if(512&K.flags&&(K.check=O(K.check,P,o,d)),y-=o,d+=o,L)break C}else K.head&&(K.head.comment=null);K.mode=9;case 9:if(512&K.flags){for(;i<16;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(r!==(65535&K.check)){C.zU="header crc mismatch",K.mode=F;break}r=0,i=0}K.head&&(K.head.hcrc=K.flags>>9&1,K.head.done=!0),C.adler=K.check=0,K.mode=f;break;case 10:for(;i<32;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}C.adler=K.check=Z(r),r=0,i=0,K.mode=11;case 11:if(0===K.havedict)return C.next_out=T,C.avail_out=a,C.next_in=d,C.avail_in=y,K.hold=r,K.bits=i,E;C.adler=K.check=1,K.mode=f;case f:if(U===t||U===z)break C;case 13:if(K.last){r>>>=7&i,i-=7&i,K.mode=27;break}for(;i<3;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}switch(K.last=1&r,r>>>=1,i-=1,3&r){case 0:K.mode=14;break;case 1:if(D(K),K.mode=20,U===z){r>>>=2,i-=2;break C}break;case 2:K.mode=17;break;case 3:C.zU="invalid block type",K.mode=F}r>>>=2,i-=2;break;case 14:for(r>>>=7&i,i-=7&i;i<32;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if((65535&r)!==(r>>>16^65535)){C.zU="invalid stored block lengths",K.mode=F;break}if(K.length=65535&r,r=0,i=0,K.mode=15,U===z)break C;case 15:K.mode=16;case 16:if(o=K.length,o){if(o>y&&(o=y),o>a&&(o=a),0===o)break C;H.set(P.subarray(d,d+o),T),y-=o,d+=o,a-=o,T+=o,K.length-=o;break}K.mode=f;break;case 17:for(;i<14;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(K.nlen=257+(31&r),r>>>=5,i-=5,K.ndist=1+(31&r),r>>>=5,i-=5,K.ncode=4+(15&r),r>>>=4,i-=4,K.nlen>286||K.ndist>30){C.zU="too many length or distance symbols",K.mode=F;break}K.have=0,K.mode=18;case 18:for(;K.have<K.ncode;){for(;i<3;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}K.lens[s[K.have++]]=7&r,r>>>=3,i-=3}for(;K.have<19;)K.lens[s[K.have++]]=0;if(K.lencode=K.lendyn,K.lenbits=7,n={bits:K.lenbits},Y=A(0,K.lens,0,19,K.lencode,0,K.work,n),K.lenbits=n.bits,Y){C.zU="invalid code lengths set",K.mode=F;break}K.have=0,K.mode=19;case 19:for(;K.have<K.nlen+K.ndist;){for(;W=K.lencode[r&(1<<K.lenbits)-1],w=W>>>24,h=W>>>16&255,c=65535&W,!(w<=i);){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(c<16)r>>>=w,i-=w,K.lens[K.have++]=c;else{if(16===c){for(S=w+2;i<S;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(r>>>=w,i-=w,0===K.have){C.zU="invalid bit length repeat",K.mode=F;break}L=K.lens[K.have-1],o=3+(3&r),r>>>=2,i-=2}else if(17===c){for(S=w+3;i<S;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}r>>>=w,i-=w,L=0,o=3+(7&r),r>>>=3,i-=3}else{for(S=w+7;i<S;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}r>>>=w,i-=w,L=0,o=11+(127&r),r>>>=7,i-=7}if(K.have+o>K.nlen+K.ndist){C.zU="invalid bit length repeat",K.mode=F;break}for(;o--;)K.lens[K.have++]=L}}if(K.mode===F)break;if(0===K.lens[256]){C.zU="invalid code -- missing end-of-block",K.mode=F;break}if(K.lenbits=9,n={bits:K.lenbits},Y=A(1,K.lens,0,K.nlen,K.lencode,0,K.work,n),K.lenbits=n.bits,Y){C.zU="invalid literal/lengths set",K.mode=F;break}if(K.distbits=6,K.distcode=K.distdyn,n={bits:K.distbits},Y=A(2,K.lens,K.nlen,K.ndist,K.distcode,0,K.work,n),K.distbits=n.bits,Y){C.zU="invalid distances set",K.mode=F;break}if(K.mode=20,U===z)break C;case 20:K.mode=21;case 21:if(y>=6&&a>=258){C.next_out=T,C.avail_out=a,C.next_in=d,C.avail_in=y,K.hold=r,K.bits=i,X(C,J),T=C.next_out,H=C.output,a=C.avail_out,d=C.next_in,P=C.input,y=C.avail_in,r=K.hold,i=K.bits,K.mode===f&&(K.back=-1);break}for(K.back=0;W=K.lencode[r&(1<<K.lenbits)-1],w=W>>>24,h=W>>>16&255,c=65535&W,!(w<=i);){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(h&&0===(240&h)){for(N=w,g=h,M=c;W=K.lencode[M+((r&(1<<N+g)-1)>>N)],w=W>>>24,h=W>>>16&255,c=65535&W,!(N+w<=i);){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}r>>>=N,i-=N,K.back+=N}if(r>>>=w,i-=w,K.back+=w,K.length=c,0===h){K.mode=26;break}if(32&h){K.back=-1,K.mode=f;break}if(64&h){C.zU="invalid literal/length code",K.mode=F;break}K.extra=15&h,K.mode=22;case 22:if(K.extra){for(S=K.extra;i<S;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}K.length+=r&(1<<K.extra)-1,r>>>=K.extra,i-=K.extra,K.back+=K.extra}K.was=K.length,K.mode=23;case 23:for(;W=K.distcode[r&(1<<K.distbits)-1],w=W>>>24,h=W>>>16&255,c=65535&W,!(w<=i);){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(0===(240&h)){for(N=w,g=h,M=c;W=K.distcode[M+((r&(1<<N+g)-1)>>N)],w=W>>>24,h=W>>>16&255,c=65535&W,!(N+w<=i);){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}r>>>=N,i-=N,K.back+=N}if(r>>>=w,i-=w,K.back+=w,64&h){C.zU="invalid distance code",K.mode=F;break}K.offset=c,K.extra=15&h,K.mode=24;case 24:if(K.extra){for(S=K.extra;i<S;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}K.offset+=r&(1<<K.extra)-1,r>>>=K.extra,i-=K.extra,K.back+=K.extra}if(K.offset>K.dmax){C.zU="invalid distance too far back",K.mode=F;break}K.mode=25;case 25:if(0===a)break C;if(o=J-a,K.offset>o){if(o=K.offset-o,o>K.whave&&K.sane){C.zU="invalid distance too far back",K.mode=F;break}o>K.wnext?(o-=K.wnext,B=K.wsize-o):B=K.wnext-o,o>K.length&&(o=K.length),k=K.window}else k=H,B=T-K.offset,o=K.length;o>a&&(o=a),a-=o,K.length-=o;do{H[T++]=k[B++]}while(--o);0===K.length&&(K.mode=21);break;case 26:if(0===a)break C;H[T++]=K.length,a--,K.mode=21;break;case 27:if(K.wrap){for(;i<32;){if(0===y)break C;y--,r|=P[d++]<<i,i+=8}if(J-=a,C.total_out+=J,K.total+=J,J&&(C.adler=K.check=K.flags?O(K.check,H,J,T-J):m(K.check,H,J,T-J)),J=a,(K.flags?r:Z(r))!==K.check){C.zU="incorrect data check",K.mode=F;break}r=0,i=0}K.mode=28;case 28:if(K.wrap&&K.flags){for(;i<32;){if(0===y)break C;y--,r+=P[d++]<<i,i+=8}if(r!==(4294967295&K.total)){C.zU="incorrect length check",K.mode=F;break}r=0,i=0}K.mode=29;case 29:Y=p;break C;case F:Y=b;break C;case 31:return v;default:return u}return C.next_out=T,C.avail_out=a,C.next_in=d,C.avail_in=y,K.hold=r,K.bits=i,(K.wsize||J!==C.avail_out&&K.mode<F&&(K.mode<27||U!==e))&&l(C,C.output,C.next_out,J-C.avail_out)?(K.mode=31,v):(G-=C.avail_in,J-=C.avail_out,C.total_in+=G,C.total_out+=J,K.total+=J,K.wrap&&J&&(C.adler=K.check=K.flags?O(K.check,H,J,C.next_out-J):m(K.check,H,J,C.next_out-J)),C.data_type=K.bits+(K.last?64:0)+(K.mode===f?128:0)+(20===K.mode||15===K.mode?256:0),(0===G&&0===J||U===e)&&Y===j&&(Y=Q),Y)},C.exports.inflateEnd=C=>{if(!C||!C.state)return u;let U=C.state;return U.window&&(U.window=null),C.state=null,j},C.exports.inflateGetHeader=(C,U)=>{if(!C||!C.state)return u;const K=C.state;return 0===(2&K.wrap)?u:(K.head=U,U.done=!1,j)},C.exports.inflateSetDictionary=(C,U)=>{const K=U.length;let O,X,A;return C&&C.state?(O=C.state,0!==O.wrap&&11!==O.mode?u:11===O.mode&&(X=1,X=m(X,U,K,0),X!==O.check)?b:(A=l(C,U,K,K),A?(O.mode=31,v):(O.havedict=1,j))):u},C.exports.inflateInfo="pako inflate (from Nodeca project)"},12992:C=>{"use strict";const U=15,K=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),m=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),O=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),X=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);C.exports=(C,A,e,t,z,j,p,E)=>{const u=E.bits;let b,v,Q,V,f,F,Z=0,P=0,H=0,d=0,T=0,y=0,a=0,r=0,i=0,D=0,l=null,G=0;const J=new Uint16Array(16),o=new Uint16Array(16);let B,k,w,h=null,c=0;for(Z=0;Z<=U;Z++)J[Z]=0;for(P=0;P<t;P++)J[A[e+P]]++;for(T=u,d=U;d>=1&&0===J[d];d--);if(T>d&&(T=d),0===d)return z[j++]=20971520,z[j++]=20971520,E.bits=1,0;for(H=1;H<d&&0===J[H];H++);for(T<H&&(T=H),r=1,Z=1;Z<=U;Z++)if(r<<=1,r-=J[Z],r<0)return-1;if(r>0&&(0===C||1!==d))return-1;for(o[1]=0,Z=1;Z<U;Z++)o[Z+1]=o[Z]+J[Z];for(P=0;P<t;P++)0!==A[e+P]&&(p[o[A[e+P]]++]=P);if(0===C?(l=h=p,F=19):1===C?(l=K,G-=257,h=m,c-=257,F=256):(l=O,h=X,F=-1),D=0,P=0,Z=H,f=j,y=T,a=0,Q=-1,i=1<<T,V=i-1,1===C&&i>852||2===C&&i>592)return 1;for(;;){B=Z-a,p[P]<F?(k=0,w=p[P]):p[P]>F?(k=h[c+p[P]],w=l[G+p[P]]):(k=96,w=0),b=1<<Z-a,v=1<<y,H=v;do{v-=b,z[f+(D>>a)+v]=B<<24|k<<16|w}while(0!==v);for(b=1<<Z-1;D&b;)b>>=1;if(0!==b?(D&=b-1,D+=b):D=0,P++,0===--J[Z]){if(Z===d)break;Z=A[e+p[P]]}if(Z>T&&(D&V)!==Q){for(0===a&&(a=T),f+=H,y=Z-a,r=1<<y;y+a<d&&(r-=J[y+a],!(r<=0));)y++,r<<=1;if(i+=1<<y,1===C&&i>852||2===C&&i>592)return 1;Q=D&V,z[Q]=T<<24|y<<16|f-j}}return 0!==D&&(z[f+D]=Z-a<<24|64<<16),E.bits=T,0}},12949:C=>{"use strict";C.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12929:C=>{"use strict";function U(C){let U=C.length;for(;--U>=0;)C[U]=0}const K=256,m=286,O=30,X=15,A=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),e=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),j=new Array(576);U(j);const p=new Array(60);U(p);const E=new Array(512);U(E);const u=new Array(256);U(u);const b=new Array(29);U(b);const v=new Array(O);function Q(C,U,K,m,O){this.static_tree=C,this.extra_bits=U,this.extra_base=K,this.elems=m,this.max_length=O,this.has_stree=C&&C.length}let V,f,F;function Z(C,U){this.dyn_tree=C,this.max_code=0,this.stat_desc=U}U(v);const P=C=>C<256?E[C]:E[256+(C>>>7)],H=(C,U)=>{C.pending_buf[C.pending++]=255&U,C.pending_buf[C.pending++]=U>>>8&255},d=(C,U,K)=>{C.bi_valid>16-K?(C.bi_buf|=U<<C.bi_valid&65535,H(C,C.bi_buf),C.bi_buf=U>>16-C.bi_valid,C.bi_valid+=K-16):(C.bi_buf|=U<<C.bi_valid&65535,C.bi_valid+=K)},T=(C,U,K)=>{d(C,K[2*U],K[2*U+1])},y=(C,U)=>{let K=0;do{K|=1&C,C>>>=1,K<<=1}while(--U>0);return K>>>1},a=(C,U,K)=>{const m=new Array(16);let O,A,e=0;for(O=1;O<=X;O++)m[O]=e=e+K[O-1]<<1;for(A=0;A<=U;A++){let U=C[2*A+1];0!==U&&(C[2*A]=y(m[U]++,U))}},r=C=>{let U;for(U=0;U<m;U++)C.dyn_ltree[2*U]=0;for(U=0;U<O;U++)C.dyn_dtree[2*U]=0;for(U=0;U<19;U++)C.bl_tree[2*U]=0;C.dyn_ltree[512]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0},i=C=>{C.bi_valid>8?H(C,C.bi_buf):C.bi_valid>0&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0},D=(C,U,K,m)=>{const O=2*U,X=2*K;return C[O]<C[X]||C[O]===C[X]&&m[U]<=m[K]},l=(C,U,K)=>{const m=C.heap[K];let O=K<<1;for(;O<=C.heap_len&&(O<C.heap_len&&D(U,C.heap[O+1],C.heap[O],C.depth)&&O++,!D(U,m,C.heap[O],C.depth));)C.heap[K]=C.heap[O],K=O,O<<=1;C.heap[K]=m},G=(C,U,m)=>{let O,X,t,z,j=0;if(0!==C.last_lit)do{O=C.pending_buf[C.d_buf+2*j]<<8|C.pending_buf[C.d_buf+2*j+1],X=C.pending_buf[C.l_buf+j],j++,0===O?T(C,X,U):(t=u[X],T(C,t+K+1,U),z=A[t],0!==z&&(X-=b[t],d(C,X,z)),O--,t=P(O),T(C,t,m),z=e[t],0!==z&&(O-=v[t],d(C,O,z)))}while(j<C.last_lit);T(C,256,U)},J=(C,U)=>{const K=U.dyn_tree,m=U.stat_desc.static_tree,O=U.stat_desc.has_stree,A=U.stat_desc.elems;let e,t,z,j=-1;for(C.heap_len=0,C.heap_max=573,e=0;e<A;e++)0!==K[2*e]?(C.heap[++C.heap_len]=j=e,C.depth[e]=0):K[2*e+1]=0;for(;C.heap_len<2;)z=C.heap[++C.heap_len]=j<2?++j:0,K[2*z]=1,C.depth[z]=0,C.opt_len--,O&&(C.static_len-=m[2*z+1]);for(U.max_code=j,e=C.heap_len>>1;e>=1;e--)l(C,K,e);z=A;do{e=C.heap[1],C.heap[1]=C.heap[C.heap_len--],l(C,K,1),t=C.heap[1],C.heap[--C.heap_max]=e,C.heap[--C.heap_max]=t,K[2*z]=K[2*e]+K[2*t],C.depth[z]=(C.depth[e]>=C.depth[t]?C.depth[e]:C.depth[t])+1,K[2*e+1]=K[2*t+1]=z,C.heap[1]=z++,l(C,K,1)}while(C.heap_len>=2);C.heap[--C.heap_max]=C.heap[1],((C,U)=>{const K=U.dyn_tree,m=U.max_code,O=U.stat_desc.static_tree,A=U.stat_desc.has_stree,e=U.stat_desc.extra_bits,t=U.stat_desc.extra_base,z=U.stat_desc.max_length;let j,p,E,u,b,v,Q=0;for(u=0;u<=X;u++)C.bl_count[u]=0;for(K[2*C.heap[C.heap_max]+1]=0,j=C.heap_max+1;j<573;j++)p=C.heap[j],u=K[2*K[2*p+1]+1]+1,u>z&&(u=z,Q++),K[2*p+1]=u,p>m||(C.bl_count[u]++,b=0,p>=t&&(b=e[p-t]),v=K[2*p],C.opt_len+=v*(u+b),A&&(C.static_len+=v*(O[2*p+1]+b)));if(0!==Q){do{for(u=z-1;0===C.bl_count[u];)u--;C.bl_count[u]--,C.bl_count[u+1]+=2,C.bl_count[z]--,Q-=2}while(Q>0);for(u=z;0!==u;u--)for(p=C.bl_count[u];0!==p;)E=C.heap[--j],E>m||(K[2*E+1]!==u&&(C.opt_len+=(u-K[2*E+1])*K[2*E],K[2*E+1]=u),p--)}})(C,U),a(K,j,C.bl_count)},o=(C,U,K)=>{let m,O,X=-1,A=U[1],e=0,t=7,z=4;for(0===A&&(t=138,z=3),U[2*(K+1)+1]=65535,m=0;m<=K;m++)O=A,A=U[2*(m+1)+1],++e<t&&O===A||(e<z?C.bl_tree[2*O]+=e:0!==O?(O!==X&&C.bl_tree[2*O]++,C.bl_tree[32]++):e<=10?C.bl_tree[34]++:C.bl_tree[36]++,e=0,X=O,0===A?(t=138,z=3):O===A?(t=6,z=3):(t=7,z=4))},B=(C,U,K)=>{let m,O,X=-1,A=U[1],e=0,t=7,z=4;for(0===A&&(t=138,z=3),m=0;m<=K;m++)if(O=A,A=U[2*(m+1)+1],!(++e<t&&O===A)){if(e<z)do{T(C,O,C.bl_tree)}while(0!==--e);else 0!==O?(O!==X&&(T(C,O,C.bl_tree),e--),T(C,16,C.bl_tree),d(C,e-3,2)):e<=10?(T(C,17,C.bl_tree),d(C,e-3,3)):(T(C,18,C.bl_tree),d(C,e-11,7));e=0,X=O,0===A?(t=138,z=3):O===A?(t=6,z=3):(t=7,z=4)}};let k=!1;const w=(C,U,K,m)=>{d(C,0+(m?1:0),3),((C,U,K,m)=>{i(C),m&&(H(C,K),H(C,~K)),C.pending_buf.set(C.window.subarray(U,U+K),C.pending),C.pending+=K})(C,U,K,!0)};C.exports._tr_init=C=>{k||((()=>{let C,U,K,z,Z;const P=new Array(16);for(K=0,z=0;z<28;z++)for(b[z]=K,C=0;C<1<<A[z];C++)u[K++]=z;for(u[K-1]=z,Z=0,z=0;z<16;z++)for(v[z]=Z,C=0;C<1<<e[z];C++)E[Z++]=z;for(Z>>=7;z<O;z++)for(v[z]=Z<<7,C=0;C<1<<e[z]-7;C++)E[256+Z++]=z;for(U=0;U<=X;U++)P[U]=0;for(C=0;C<=143;)j[2*C+1]=8,C++,P[8]++;for(;C<=255;)j[2*C+1]=9,C++,P[9]++;for(;C<=279;)j[2*C+1]=7,C++,P[7]++;for(;C<=287;)j[2*C+1]=8,C++,P[8]++;for(a(j,287,P),C=0;C<O;C++)p[2*C+1]=5,p[2*C]=y(C,5);V=new Q(j,A,257,m,X),f=new Q(p,e,0,O,X),F=new Q(new Array(0),t,0,19,7)})(),k=!0),C.l_desc=new Z(C.dyn_ltree,V),C.d_desc=new Z(C.dyn_dtree,f),C.bl_desc=new Z(C.bl_tree,F),C.bi_buf=0,C.bi_valid=0,r(C)},C.exports._tr_stored_block=w,C.exports._tr_flush_block=(C,U,m,O)=>{let X,A,e=0;C.level>0?(2===C.strm.data_type&&(C.strm.data_type=(C=>{let U,m=4093624447;for(U=0;U<=31;U++,m>>>=1)if(1&m&&0!==C.dyn_ltree[2*U])return 0;if(0!==C.dyn_ltree[18]||0!==C.dyn_ltree[20]||0!==C.dyn_ltree[26])return 1;for(U=32;U<K;U++)if(0!==C.dyn_ltree[2*U])return 1;return 0})(C)),J(C,C.l_desc),J(C,C.d_desc),e=(C=>{let U;for(o(C,C.dyn_ltree,C.l_desc.max_code),o(C,C.dyn_dtree,C.d_desc.max_code),J(C,C.bl_desc),U=18;U>=3&&0===C.bl_tree[2*z[U]+1];U--);return C.opt_len+=3*(U+1)+5+5+4,U})(C),X=C.opt_len+3+7>>>3,A=C.static_len+3+7>>>3,A<=X&&(X=A)):X=A=m+5,m+4<=X&&-1!==U?w(C,U,m,O):4===C.strategy||A===X?(d(C,2+(O?1:0),3),G(C,j,p)):(d(C,4+(O?1:0),3),((C,U,K,m)=>{let O;for(d(C,U-257,5),d(C,K-1,5),d(C,m-4,4),O=0;O<m;O++)d(C,C.bl_tree[2*z[O]+1],3);B(C,C.dyn_ltree,U-1),B(C,C.dyn_dtree,K-1)})(C,C.l_desc.max_code+1,C.d_desc.max_code+1,e+1),G(C,C.dyn_ltree,C.dyn_dtree)),r(C),O&&i(C)},C.exports._tr_tally=(C,U,m)=>(C.pending_buf[C.d_buf+2*C.last_lit]=U>>>8&255,C.pending_buf[C.d_buf+2*C.last_lit+1]=255&U,C.pending_buf[C.l_buf+C.last_lit]=255&m,C.last_lit++,0===U?C.dyn_ltree[2*m]++:(C.matches++,U--,C.dyn_ltree[2*(u[m]+K+1)]++,C.dyn_dtree[2*P(U)]++),C.last_lit===C.lit_bufsize-1),C.exports._tr_align=C=>{d(C,2,3),T(C,256,j),(C=>{16===C.bi_valid?(H(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):C.bi_valid>=8&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)})(C)}},12967:C=>{"use strict";C.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.zU="",this.state=null,this.data_type=2,this.adler=0}},12617:C=>{function U(C,U,K){for(var m=C.length,O=-1/0,X=1/0,A=0;A<m;A++){var e=(K[0][A]-C[A])/U[A],t=(K[1][A]-C[A])/U[A];if(e>t){var z=e;e=t,t=z}if(t<O||e>X)return 1/0;e>O&&(O=e),t<X&&(X=t)}return O>X?1/0:O}C.exports=function(C,K,m,O){var X=U(K,m,O);if(X===1/0)C=null;else{C=C||[];for(var A=0;A<K.length;A++)C[A]=K[A]+m[A]*X}return C},C.exports.distance=U},13988:(C,U,K)=>{"use strict";K.d(U,{d:()=>A});var m=K(37);const O=m.useLayoutEffect;const X=function(C){var U=(0,m.useRef)(C);return O((function(){U.current=C})),U};var A=function(C){var U=X(C);(0,m.AU)((function(){var C=function(C){var K;if(null!=U.current&&(K=U.current(C)),C.defaultPrevented&&(C.returnValue=""),"string"===typeof K)return C.returnValue=K,K};return window.addEventListener("beforeunload",C),function(){window.removeEventListener("beforeunload",C)}}),[])}},13933:(C,U,K)=>{"use strict";var m=K(13940),O=Array.prototype.concat,X=Array.prototype.slice,A=C.exports=function(C){for(var U=[],K=0,A=C.length;K<A;K++){var e=C[K];m(e)?U=O.call(U,X.call(e)):U.push(e)}return U};A.wrap=function(C){return function(){return C(A(arguments))}}},13940:C=>{C.exports=function(C){return!(!C||"string"===typeof C)&&(C instanceof Array||Array.isArray(C)||C.length>=0&&(C.splice instanceof Function||Object.getOwnPropertyDescriptor(C,C.length-1)&&"String"!==C.constructor.name))}},12881:(C,U,K)=>{var m=K(12883);function O(C){for(var U,K,O=0,X=C.length,A=0;A<C.length;){for(U=C[A],K=0;A<X&&C[A]===U;)++A,++K;O+=m.log2(K)/7|0,O+=m.log2(U>>>0)/7|0,O+=2}return O}U.size=O,U.encode=function(C,U){U||(U=new Uint8Array(O(C)));for(var K,m,X=0,A=U.length,e=0;e<C.length;){for(K=C[e],m=0;e<C.length&&C[e]===K;)++e,++m;for(;X<A&&m>=128;)U[X++]=128+(127&m),m>>>=7;if(X>=A)throw new Error("RLE buffer overflow");for(U[X++]=m,K>>>=0;X<A&&K>=128;)U[X++]=128+(127&K),K>>>=7;if(X>=A)throw new Error("RLE buffer overflow");U[X++]=K}return U},U.decode=function(C,U){for(var K,m,O,X,A=U.length,e=C.length,t=0,z=0;z<e;){for(K=0,m=0;z<e&&C[z]>=128;)K+=(127&C[z++])<<m,m+=7;if(K+=C[z++]<<m,z>=e)throw new Error("RLE buffer underrun");if(t+K>A)throw new Error("Chunk buffer overflow");for(O=0,m=0;z<e&&C[z]>=128;)O+=(127&C[z++])<<m,m+=7;if(z>=e)throw new Error("RLE buffer underrun");for(O+=C[z++]<<m,X=0;X<K;++X)U[t++]=O}return U}},12883:(C,U)=>{"use strict";function K(C){var U=32;return(C&=-C)&&U--,65535&C&&(U-=16),16711935&C&&(U-=8),252645135&C&&(U-=4),858993459&C&&(U-=2),1431655765&C&&(U-=1),U}U.INT_BITS=32,U.INT_MAX=2147483647,U.INT_MIN=-1<<31,U.sign=function(C){return(C>0)-(C<0)},U.abs=function(C){var U=C>>31;return(C^U)-U},U.min=function(C,U){return U^(C^U)&-(C<U)},U.max=function(C,U){return C^(C^U)&-(C<U)},U.isPow2=function(C){return!(C&C-1)&&!!C},U.log2=function(C){var U,K;return U=(C>65535)<<4,U|=K=((C>>>=U)>255)<<3,U|=K=((C>>>=K)>15)<<2,(U|=K=((C>>>=K)>3)<<1)|(C>>>=K)>>1},U.log10=function(C){return C>=1e9?9:C>=1e8?8:C>=1e7?7:C>=1e6?6:C>=1e5?5:C>=1e4?4:C>=1e3?3:C>=100?2:C>=10?1:0},U.popCount=function(C){return 16843009*((C=(858993459&(C-=C>>>1&1431655765))+(C>>>2&858993459))+(C>>>4)&252645135)>>>24},U.countTrailingZeros=K,U.nextPow2=function(C){return C+=0===C,--C,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)+1},U.prevPow2=function(C){return C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,(C|=C>>>16)-(C>>>1)},U.parity=function(C){return C^=C>>>16,C^=C>>>8,C^=C>>>4,27030>>>(C&=15)&1};var m=new Array(256);!function(C){for(var U=0;U<256;++U){var K=U,m=U,O=7;for(K>>>=1;K;K>>>=1)m<<=1,m|=1&K,--O;C[U]=m<<O&255}}(m),U.reverse=function(C){return m[255&C]<<24|m[C>>>8&255]<<16|m[C>>>16&255]<<8|m[C>>>24&255]},U.interleave2=function(C,U){return(C=1431655765&((C=858993459&((C=252645135&((C=16711935&((C&=65535)|C<<8))|C<<4))|C<<2))|C<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))<<1},U.deinterleave2=function(C,U){return(C=65535&((C=16711935&((C=252645135&((C=858993459&((C=C>>>U&1431655765)|C>>>1))|C>>>2))|C>>>4))|C>>>16))<<16>>16},U.interleave3=function(C,U,K){return C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2),(C|=(U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2))<<1)|(K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2))<<2},U.deinterleave3=function(C,U){return(C=1023&((C=4278190335&((C=251719695&((C=3272356035&((C=C>>>U&1227133513)|C>>>2))|C>>>4))|C>>>8))|C>>>16))<<22>>22},U.nextCombination=function(C){var U=C|C-1;return U+1|(~U&-~U)-1>>>K(C)+1}},12911:C=>{"use strict";C.exports=function(C,U,K,m){var O=self||window;try{try{var X;try{X=new O.Blob([C])}catch(z){(X=new(O.BlobBuilder||O.WebKitBlobBuilder||O.MozBlobBuilder||O.MSBlobBuilder)).append(C),X=X.getBlob()}var A=O.URL||O.webkitURL,e=A.createObjectURL(X),t=new O[U](e,K);return A.revokeObjectURL(e),t}catch(z){return new O[U]("data:application/javascript,".concat(encodeURIComponent(C)),K)}}catch(z){if(!m)throw Error("Inline worker is not supported");return new O[U](m,K)}}},12603:(C,U,K)=>{"use strict";function m(C,U,K,m,O){var X={};return Object.keys(m).forEach((function(C){X[C]=m[C]})),X.enumerable=!!X.enumerable,X.configurable=!!X.configurable,("value"in X||X.initializer)&&(X.writable=!0),X=K.slice().reverse().reduce((function(K,m){return m(C,U,K)||K}),X),O&&void 0!==X.initializer&&(X.value=X.initializer?X.initializer.call(O):void 0,X.initializer=void 0),void 0===X.initializer&&(Object.defineProperty(C,U,X),X=null),X}K.d(U,{b:()=>m})},12598:(C,U,K)=>{"use strict";function m(C,U,K,m){K&&Object.defineProperty(C,U,{enumerable:K.enumerable,configurable:K.configurable,writable:K.writable,value:K.initializer?K.initializer.call(m):void 0})}K.d(U,{b:()=>m})},13975:(C,U,K)=>{"use strict";K.d(U,{c:()=>A,g:()=>p,k:()=>e,l:()=>X,p:()=>t,r:()=>O,s:()=>z,w:()=>j});var m=K(12045);class O{constructor(){this._easingMode=O.EASINGMODE_EASEIN}setEasingMode(C){const U=Math.min(Math.max(C,0),2);this._easingMode=U}getEasingMode(){return this._easingMode}easeInCore(C){throw new Error("You must implement this method")}ease(C){switch(this._easingMode){case O.EASINGMODE_EASEIN:return this.easeInCore(C);case O.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-C)}return C>=.5?.5*(1-this.easeInCore(2*(1-C)))+.5:.5*this.easeInCore(2*C)}}O.EASINGMODE_EASEIN=0,O.EASINGMODE_EASEOUT=1,O.EASINGMODE_EASEINOUT=2;class X extends O{easeInCore(C){return C=Math.max(0,Math.min(1,C)),1-Math.sqrt(1-C*C)}}class A extends O{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=C}easeInCore(C){const U=Math.max(0,this.amplitude);return Math.pow(C,3)-C*U*Math.sin(3.141592653589793*C)}}class e extends O{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=C,this.bounciness=U}easeInCore(C){const U=Math.max(0,this.bounces);let K=this.bounciness;K<=1&&(K=1.001);const m=Math.pow(K,U),O=1-K,X=(1-m)/O+.5*m,A=C*X,e=Math.log(-A*(1-K)+1)/Math.log(K),t=Math.floor(e),z=t+1,j=(1-Math.pow(K,t))/(O*X),p=.5*(j+(1-Math.pow(K,z))/(O*X)),E=C-p,u=p-j;return-Math.pow(1/K,U-t)/(u*u)*(E-u)*(E+u)}}class t extends O{easeInCore(C){return C*C*C}}class z extends O{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=C,this.springiness=U}easeInCore(C){let U;const K=Math.max(0,this.oscillations),m=Math.max(0,this.springiness);return U=0==m?C:(Math.exp(m*C)-1)/(Math.exp(m)-1),U*Math.sin((6.283185307179586*K+1.5707963267948966)*C)}}class j extends O{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=C}easeInCore(C){return this.exponent<=0?C:(Math.exp(this.exponent*C)-1)/(Math.exp(this.exponent)-1)}}class p extends O{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=C,this.y1=U,this.x2=K,this.y2=m}easeInCore(C){return m.d.Interpolate(C,this.x1,this.y1,this.x2,this.y2)}}},13443:(C,U,K)=>{"use strict";K.d(U,{c:()=>A});var m=K(11827),O=K(11844),X=K(12254);class A extends X.c{get _matrix(){return this._compose(),this.iE}set _matrix(C){(C.updateFlag!==this.iE.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.iE.m(C),this._markAsDirtyAndDecompose())}constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(C,U.dC(),!1),this.name=C,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=U,this.iE=(null===O||void 0===O?void 0:O.clone())??m.Matrix.Identity(),this._restMatrix=X??this.iE.clone(),this._bindMatrix=A??this.iE.clone(),this._index=e,this._absoluteMatrix=new m.Matrix,this._absoluteBindMatrix=new m.Matrix,this._absoluteInverseBindMatrix=new m.Matrix,this._finalMatrix=new m.Matrix,U.bones.push(this),this.setParent(K,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(C){this.setParent(C)}setParent(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==C){if(this.parent){const C=this.parent.children.indexOf(this);-1!==C&&this.parent.children.splice(C,1)}this._parentNode=C,this.parent&&this.parent.children.push(this),U&&this._updateAbsoluteBindMatrices(),this.Iz()}}getLocalMatrix(){return this._compose(),this.iE}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(C){this._restMatrix.m(C)}setRestPose(C){this.setRestMatrix(C)}getBindPose(){return this.getBindMatrix()}setBindMatrix(C){this.ee(C)}setBindPose(C){this.setBindMatrix(C)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const C=m.TmpVectors.bU[0],U=m.TmpVectors.Quaternion[0],K=m.TmpVectors.bU[1];this.getRestMatrix().decompose(C,U,K),this._linkedTransformNode.position.m(K),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??m.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.m(U),this._linkedTransformNode.ue.m(C)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(C){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=C,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.ne}set position(C){this._decompose(),this.ne.m(C),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(C){this.setRotation(C)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(C){this.setRotationQuaternion(C)}get ue(){return this.getScale()}set ue(C){this.setScale(C)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=m.bU.Zero(),this._localRotation=m.Quaternion.Zero(),this.ne=m.bU.Zero()),this.iE.decompose(this._localScaling,this._localRotation,this.ne))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,m.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.ne,this.iE)):this._needToCompose=!1)}ee(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.m(C),U&&this._updateAbsoluteBindMatrices(),K?this._matrix=C:this.Iz()}_updateAbsoluteBindMatrices(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(C||(C=this._bindMatrix),this.parent?C.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.m(C),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),U)for(let K=0;K<this.children.length;K++)this.children[K]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Iz(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Iz(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Iz(),this._needToDecompose=!0}_updatePosition(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0,O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const X=this.getLocalMatrix();if(0==U)O?(X.addAtIndex(12,C.x),X.addAtIndex(13,C.y),X.addAtIndex(14,C.z)):X.setTranslationFromFloats(C.x,C.y,C.z);else{let U=null;K&&(U=K.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const e=A._TmpMats[0],t=A._TmpVecs[0];this.parent?K&&U?(e.m(this.parent.getAbsoluteMatrix()),e.multiplyToRef(U,e)):e.m(this.parent.getAbsoluteMatrix()):m.Matrix.IdentityToRef(e),O&&e.setTranslationFromFloats(0,0,0),e.invert(),m.bU.TransformCoordinatesToRef(C,e,t),O?(X.addAtIndex(12,t.x),X.addAtIndex(13,t.y),X.addAtIndex(14,t.z)):X.setTranslationFromFloats(t.x,t.y,t.z)}this._markAsDirtyAndDecompose()}translate(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;this._updatePosition(C,U,K,!0)}setPosition(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;this._updatePosition(C,U,K,!1)}setAbsolutePosition(C,U){this.setPosition(C,1,U)}scale(C,U,K){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const X=this.getLocalMatrix(),e=A._TmpMats[0];m.Matrix.ScalingToRef(C,U,K,e),e.multiplyToRef(X,X),e.invert();for(const m of this.children){const O=m.getLocalMatrix();O.multiplyToRef(e,O),O.multiplyAtIndex(12,C),O.multiplyAtIndex(13,U),O.multiplyAtIndex(14,K),m._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),O)for(const m of this.children)m.scale(C,U,K,O)}setScale(C){this._decompose(),this._localScaling.m(C),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(C){this._decompose(),C.m(this._localScaling)}setYawPitchRoll(C,U,K){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,X=arguments.length>4?arguments[4]:void 0;if(0===O){const e=A._TmpQuat;return m.Quaternion.RotationYawPitchRollToRef(C,U,K,e),void this.setRotationQuaternion(e,O,X)}const e=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(e,X))return;const t=A._TmpMats[1];m.Matrix.RotationYawPitchRollToRef(C,U,K,t),e.multiplyToRef(t,t),this._rotateWithMatrix(t,O,X)}rotate(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=arguments.length>3?arguments[3]:void 0;const X=A._TmpMats[0];X.setTranslationFromFloats(0,0,0),m.Matrix.RotationAxisToRef(C,U,X),this._rotateWithMatrix(X,K,O)}setAxisAngle(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=arguments.length>3?arguments[3]:void 0;if(0===K){const X=A._TmpQuat;return m.Quaternion.RotationAxisToRef(C,U,X),void this.setRotationQuaternion(X,K,O)}const X=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,O))return;const e=A._TmpMats[1];m.Matrix.RotationAxisToRef(C,U,e),X.multiplyToRef(e,e),this._rotateWithMatrix(e,K,O)}setRotation(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(C.y,C.x,C.z,U,K)}setRotationQuaternion(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;if(0===U)return this._decompose(),this._localRotation.m(C),void this._markAsDirtyAndCompose();const O=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,K))return;const X=A._TmpMats[1];m.Matrix.FromQuaternionToRef(C,X),O.multiplyToRef(X,X),this._rotateWithMatrix(X,U,K)}setRotationMatrix(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;if(0===U){const O=A._TmpQuat;return m.Quaternion.FromRotationMatrixToRef(C,O),void this.setRotationQuaternion(O,U,K)}const O=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,K))return;const X=A._TmpMats[1];X.m(C),O.multiplyToRef(C,X),this._rotateWithMatrix(X,U,K)}_rotateWithMatrix(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;const m=this.getLocalMatrix(),O=m.m[12],X=m.m[13],e=m.m[14],t=this.getParent(),z=A._TmpMats[3],j=A._TmpMats[4];t&&1==U?(K?(z.m(K.getWorldMatrix()),t.getAbsoluteMatrix().multiplyToRef(z,z)):z.m(t.getAbsoluteMatrix()),j.m(z),j.invert(),m.multiplyToRef(z,m),m.multiplyToRef(C,m),m.multiplyToRef(j,m)):1==U&&K?(z.m(K.getWorldMatrix()),j.m(z),j.invert(),m.multiplyToRef(z,m),m.multiplyToRef(C,m),m.multiplyToRef(j,m)):m.multiplyToRef(C,m),m.setTranslationFromFloats(O,X,e),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(C,U){const K=A._TmpMats[2];return C.m(this.getAbsoluteMatrix()),U?(C.multiplyToRef(U.getWorldMatrix(),C),m.Matrix.ScalingToRef(U.ue.x,U.ue.y,U.ue.z,K)):m.Matrix.IdentityToRef(K),C.invert(),!isNaN(C.m[0])&&(K.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyToRef(K,C),!0)}xA(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=m.bU.Zero();return this.getPositionToRef(C,U,K),K}getPositionToRef(){let C=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const C=this.getLocalMatrix();U.x=C.m[12],U.y=C.m[13],U.z=C.m[14]}else{let K=null;C&&(K=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let m=A._TmpMats[0];C&&K?(m.m(this.getAbsoluteMatrix()),m.multiplyToRef(K,m)):m=this.getAbsoluteMatrix(),U.x=m.m[12],U.y=m.m[13],U.z=m.m[14]}}getAbsolutePosition(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=m.bU.Zero();return this.getPositionToRef(1,C,U),U}getAbsolutePositionToRef(C,U){this.getPositionToRef(1,C,U)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.iE.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.m(this.iE);const C=this._skeleton.getPoseMatrix();C&&this._absoluteMatrix.multiplyToRef(C,this._absoluteMatrix)}const C=this.children,U=C.length;for(let K=0;K<U;K++)C[K].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}it(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=m.bU.Zero();return this.getDirectionToRef(C,U,K),K}getDirectionToRef(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,O=null;U&&(O=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=A._TmpMats[0];X.m(this.getAbsoluteMatrix()),U&&O&&X.multiplyToRef(O,X),m.bU.TransformNormalToRef(C,X,K),K.normalize()}getRotation(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=m.bU.Zero();return this.getRotationToRef(C,U,K),K}getRotationToRef(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0;const m=A._TmpQuat;this.getRotationQuaternionToRef(C,U,m),m.toEulerAnglesToRef(K)}getRotationQuaternion(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=m.Quaternion.Identity();return this.getRotationQuaternionToRef(C,U,K),K}getRotationQuaternionToRef(){let C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),U.m(this._localRotation);else{const K=A._TmpMats[0],m=this.getAbsoluteMatrix();C?m.multiplyToRef(C.getWorldMatrix(),K):K.m(m),K.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyAtIndex(1,this._scalingDeterminant),K.multiplyAtIndex(2,this._scalingDeterminant),K.decompose(void 0,U,void 0)}}getRotationMatrix(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1?arguments[1]:void 0;const K=m.Matrix.Identity();return this.getRotationMatrixToRef(C,U,K),K}getRotationMatrixToRef(){let C=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(U);else{const K=A._TmpMats[0],m=this.getAbsoluteMatrix();C?m.multiplyToRef(C.getWorldMatrix(),K):K.m(m),K.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyAtIndex(1,this._scalingDeterminant),K.multiplyAtIndex(2,this._scalingDeterminant),K.getRotationMatrixToRef(U)}}getAbsolutePositionFromLocal(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=m.bU.Zero();return this.getAbsolutePositionFromLocalToRef(C,U,K),K}getAbsolutePositionFromLocalToRef(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,O=null;U&&(O=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=A._TmpMats[0];X.m(this.getAbsoluteMatrix()),U&&O&&X.multiplyToRef(O,X),m.bU.TransformCoordinatesToRef(C,X,K)}getLocalPositionFromAbsolute(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=m.bU.Zero();return this.getLocalPositionFromAbsoluteToRef(C,U,K),K}getLocalPositionFromAbsoluteToRef(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,O=null;U&&(O=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=A._TmpMats[0];X.m(this.getAbsoluteMatrix()),U&&O&&X.multiplyToRef(O,X),X.invert(),m.bU.TransformCoordinatesToRef(C,X,K)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const C=this._skeleton.bones.indexOf(this);if(-1!==C&&this._skeleton.bones.splice(C,1),this._parentNode&&this._parentNode.children){const C=this._parentNode.children,U=C.indexOf(this);-1!==U&&C.splice(U,1)}super.dispose()}}A._TmpVecs=(0,O.e)(2,m.bU.Zero),A._TmpQuat=m.Quaternion.Identity(),A._TmpMats=(0,O.e)(5,m.Matrix.Identity)},13966:(C,U,K)=>{"use strict";K.d(U,{b:()=>J});var m=K(11810),O=K(11818),X=K(11663),A=K(11827),e=K(11846),t=K(12254),z=K(12285),j=K(12116),p=K(11688),E=K(11835);class u{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(C){this._zoomStopsAnimation=C}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(C){this._idleRotationSpeed=C}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(C){this._idleRotationWaitTime=C}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(C){this._idleRotationSpinupTime=C}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(C){this._attachedCamera=C;const U=this._attachedCamera.dC();this._onPrePointerObservableObserver=U.onPrePointerObservable.add((C=>{C.type!==j.b.POINTERDOWN?C.type===j.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const C=p.c.Now;let U=0;null!=this._lastFrameTime&&(U=C-this._lastFrameTime),this._lastFrameTime=C,this._applyUserInteraction();const K=C-this._lastInteractionTime-this._idleRotationWaitTime,m=Math.max(Math.min(K/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*m,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(U/1e3))}))}detach(){if(!this._attachedCamera)return;const C=this._attachedCamera.dC();this._onPrePointerObservableObserver&&C.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(C){this._lastInteractionTime=C??p.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<E.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let C=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(C=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?C:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=p.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var b=K(13975),v=K(12357);class Q{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(C){if(this._autoTransitionRange===C)return;this._autoTransitionRange=C;const U=this._attachedCamera;U&&(C?this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((C=>{if(C&&(C.te(!0),C.getBoundingInfo)){const U=C.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*U,this.upperRadiusTransitionRange=.05*U}})):this._onMeshTargetChangedObserver&&U.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(C){this._attachedCamera=C,this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(C){return!!this._attachedCamera&&(this._attachedCamera.radius===C&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(C){if(!this._attachedCamera)return;this._radiusBounceTransition||(Q.EasingFunction.setEasingMode(Q.EasingMode),this._radiusBounceTransition=v.c.CreateAnimation("radius",v.c.ANIMATIONTYPE_FLOAT,60,Q.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const U=v.c.TransitionTo("radius",this._attachedCamera.radius+C,this._attachedCamera,this._attachedCamera.dC(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));U&&this._animatables.push(U)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}Q.EasingFunction=new b.c(.3),Q.EasingMode=b.r.EASINGMODE_EASEOUT;class V{constructor(){this.onTargetFramingAnimationEndObservable=new X.b,this._mode=V.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(C){this._mode=C}get mode(){return this._mode}set radiusScale(C){this._radiusScale=C}get radiusScale(){return this._radiusScale}set positionScale(C){this._positionScale=C}get positionScale(){return this._positionScale}set defaultElevation(C){this._defaultElevation=C}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(C){this._elevationReturnTime=C}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(C){this._elevationReturnWaitTime=C}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(C){this._zoomStopsAnimation=C}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(C){this._framingTime=C}get framingTime(){return this._framingTime}init(){}attach(C){this._attachedCamera=C;const U=this._attachedCamera.dC();V.EasingFunction.setEasingMode(V.EasingMode),this._onPrePointerObservableObserver=U.onPrePointerObservable.add((C=>{C.type!==j.b.POINTERDOWN?C.type===j.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=C.onMeshTargetChangedObservable.add((C=>{C&&C.getBoundingInfo&&this.zoomOnMesh(C,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=C.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const C=this._attachedCamera.dC();this._onPrePointerObservableObserver&&C.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C.te(!0);const m=C.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(m.minimumWorld,m.maximumWorld,U,K)}zoomOnMeshHierarchy(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C.te(!0);const m=C.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(m.min,m.max,U,K)}zoomOnMeshesHierarchy(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new A.bU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new A.bU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let X=0;X<C.length;X++){const U=C[X].getHierarchyBoundingVectors(!0);A.bU.CheckExtends(U.min,m,O),A.bU.CheckExtends(U.max,m,O)}this.zoomOnBoundingInfo(m,O,U,K)}zoomOnBoundingInfo(C,U){let K,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const X=C.y,e=X+(U.y-X)*this._positionScale,t=U.vU(C).scale(.5);if(!isFinite(e))return!1;if(m)K=new A.bU(0,e,0);else{const U=C.add(t);K=new A.bU(U.x,e,U.z)}this._vectorTransition||(this._vectorTransition=v.c.CreateAnimation("target",v.c.ANIMATIONTYPE_VECTOR3,60,V.EasingFunction)),this._betaIsAnimating=!0;let z=v.c.TransitionTo("target",K,this._attachedCamera,this._attachedCamera.dC(),60,this._vectorTransition,this._framingTime);z&&this._animatables.push(z);let j=0;if(this._mode===V.FitFrustumSidesMode){const K=this._calculateLowerRadiusFromModelBoundingSphere(C,U);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=t.length()+this._attachedCamera.Ae),j=K}else this._mode===V.IgnoreBoundsSizeMode&&(j=this._calculateLowerRadiusFromModelBoundingSphere(C,U),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ae));if(this.autoCorrectCameraLimitsAndSensibility){const K=U.vU(C).length();this._attachedCamera.panningSensibility=5e3/K,this._attachedCamera.wheelPrecision=100/j}return this._radiusTransition||(this._radiusTransition=v.c.CreateAnimation("radius",v.c.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),z=v.c.TransitionTo("radius",j,this._attachedCamera,this._attachedCamera.dC(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),O&&O(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),z&&this._animatables.push(z),!0}_calculateLowerRadiusFromModelBoundingSphere(C,U){const K=this._attachedCamera;if(!K)return 0;let m=K._calculateLowerRadiusFromModelBoundingSphere(C,U,this._radiusScale);return K.lowerRadiusLimit&&this._mode===V.IgnoreBoundsSizeMode&&(m=m<K.lowerRadiusLimit?K.lowerRadiusLimit:m),K.upperRadiusLimit&&(m=m>K.upperRadiusLimit?K.upperRadiusLimit:m),m}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const C=p.c.Now-this._lastInteractionTime,U=.5*Math.PI-this._defaultElevation,K=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>K&&C>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=v.c.CreateAnimation("beta",v.c.ANIMATIONTYPE_FLOAT,60,V.EasingFunction));const C=v.c.TransitionTo("beta",U,this._attachedCamera,this._attachedCamera.dC(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));C&&this._animatables.push(C)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=p.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}V.EasingFunction=new b.w,V.EasingMode=b.r.EASINGMODE_EASEINOUT,V.IgnoreBoundsSizeMode=0,V.FitFrustumSidesMode=1;var f=K(12292),F=K(12323),Z=K(13439),P=K(11660);class H{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(C){C=P.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),K=U.getInputElement();let m=0,O=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=X=>{var A,e;const t=X.event,z="touch"===t.pointerType;if(X.type!==j.b.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const p=t.target;if(this._altKey=t.altKey,this._ctrlKey=t.ctrlKey,this._metaKey=t.metaKey,this._shiftKey=t.shiftKey,this._buttonsPressed=t.buttons,U.isPointerLock){const C=t.movementX,U=t.movementY;this.onTouch(null,C,U),this._pointA=null,this._pointB=null}else{if(X.type!==j.b.POINTERDOWN&&X.type!==j.b.POINTERDOUBLETAP&&z&&(null===(A=this._pointA)||void 0===A?void 0:A.pointerId)!==t.pointerId&&(null===(e=this._pointB)||void 0===e?void 0:e.pointerId)!==t.pointerId)return;if(X.type!==j.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!z)if(X.type===j.b.POINTERDOUBLETAP)this.onDoubleTap(t.pointerType);else if(X.type!==j.b.POINTERUP||this._currentMousePointerIdDown!==t.pointerId&&!z){if(X.type===j.b.POINTERMOVE)if(C||t.preventDefault(),this._pointA&&null===this._pointB){const C=t.clientX-this._pointA.x,U=t.clientY-this._pointA.y;this._pointA.x=t.clientX,this._pointA.y=t.clientY,this.onTouch(this._pointA,C,U)}else if(this._pointA&&this._pointB){const C=this._pointA.pointerId===t.pointerId?this._pointA:this._pointB;C.x=t.clientX,C.y=t.clientY;const U=this._pointA.x-this._pointB.x,K=this._pointA.y-this._pointB.y,A=U*U+K*K,e={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:t.pointerId,type:X.type};this.onMultiTouch(this._pointA,this._pointB,m,A,O,e),O=e,m=A}}else{try{null===p||void 0===p||p.releasePointerCapture(t.pointerId)}catch(E){}z||(this._pointB=null),U._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==t.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==t.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==m||O)&&(this.onMultiTouch(this._pointA,this._pointB,m,0,O,null),m=0,O=null),this._currentMousePointerIdDown=-1,this.onButtonUp(t),C||t.preventDefault()}else{try{null===p||void 0===p||p.setPointerCapture(t.pointerId)}catch(E){}if(null===this._pointA)this._pointA={x:t.clientX,y:t.clientY,pointerId:t.pointerId,type:t.pointerType};else{if(null!==this._pointB)return;this._pointB={x:t.clientX,y:t.clientY,pointerId:t.pointerId,type:t.pointerType}}-1!==this._currentMousePointerIdDown||z||(this._currentMousePointerIdDown=t.pointerId),this.onButtonDown(t),C||(t.preventDefault(),K&&K.focus())}}},this._observer=this.camera.dC()._inputManager._addCameraPointerObserver(this._pointerInput,j.b.POINTERDOWN|j.b.POINTERUP|j.b.POINTERMOVE|j.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,m=0,O=null,this.onLostFocus()},this._contextMenuBind=C=>this.onContextMenu(C),K&&K.addEventListener("contextmenu",this._contextMenuBind,!1);const X=this.camera.dC().getEngine().getHostWindow();X&&P.Tools.RegisterTopRootEvents(X,[{name:"blur",handler:this._onLostFocus}])}Np(){if(this._onLostFocus){const C=this.camera.dC().getEngine().getHostWindow();C&&P.Tools.UnregisterTopRootEvents(C,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.dC()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const C=this.camera.dC().getEngine().getInputElement();C&&C.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(C){}onTouch(C,U,K){}onMultiTouch(C,U,K,m,O,X){}onContextMenu(C){C.preventDefault()}onButtonDown(C){}onButtonUp(C){}onLostFocus(){}}(0,m.d)([(0,O.O)()],H.prototype,"buttons",void 0);class d extends H{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(C,U){if(0!==this.panningSensibility&&C&&U){const K=U.x-C.x,m=U.y-C.y;this.camera.inertialPanningX+=-K/this.panningSensibility,this.camera.inertialPanningY+=m/this.panningSensibility}}_computePinchZoom(C,U){const K=this.camera.radius||d.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=K*Math.sqrt(C)/Math.sqrt(U):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(U-C)*K*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(U-C)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(C,U,K){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-U/this.panningSensibility,this.camera.inertialPanningY+=K/this.panningSensibility):(this.camera.inertialAlphaOffset-=U/this.angularSensibilityX,this.camera.inertialBetaOffset-=K/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(C,U,K,m,O,X){0===K&&null===O||0===m&&null===X||(this.multiTouchPanAndZoom?(this._computePinchZoom(K,m),this._computeMultiTouchPanning(O,X)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(m)-Math.sqrt(K))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(K,m),this._isPinching=!0):this._computeMultiTouchPanning(O,X)):this.multiTouchPanning?this._computeMultiTouchPanning(O,X):this.pinchZoom&&this._computePinchZoom(K,m))}onButtonDown(C){this._isPanClick=C.button===this.camera._panningMouseButton}onButtonUp(C){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}d.MinimumRadiusForPinch=.001,(0,m.d)([(0,O.O)()],d.prototype,"buttons",void 0),(0,m.d)([(0,O.O)()],d.prototype,"angularSensibilityX",void 0),(0,m.d)([(0,O.O)()],d.prototype,"angularSensibilityY",void 0),(0,m.d)([(0,O.O)()],d.prototype,"pinchPrecision",void 0),(0,m.d)([(0,O.O)()],d.prototype,"pinchDeltaPercentage",void 0),(0,m.d)([(0,O.O)()],d.prototype,"useNaturalPinchZoom",void 0),(0,m.d)([(0,O.O)()],d.prototype,"pinchZoom",void 0),(0,m.d)([(0,O.O)()],d.prototype,"panningSensibility",void 0),(0,m.d)([(0,O.O)()],d.prototype,"multiTouchPanning",void 0),(0,m.d)([(0,O.O)()],d.prototype,"multiTouchPanAndZoom",void 0),Z.b.ArcRotateCameraPointersInput=d;var T=K(12123);class y{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(C){C=P.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.dC(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const K=U.event;if(!K.metaKey)if(U.type===T.e.KEYDOWN){if(this._ctrlPressed=K.ctrlKey,this._altPressed=K.altKey,-1!==this.keysUp.indexOf(K.keyCode)||-1!==this.keysDown.indexOf(K.keyCode)||-1!==this.keysLeft.indexOf(K.keyCode)||-1!==this.keysRight.indexOf(K.keyCode)||-1!==this.keysReset.indexOf(K.keyCode)){-1===this._keys.indexOf(K.keyCode)&&this._keys.push(K.keyCode),K.preventDefault&&(C||K.preventDefault())}}else if(-1!==this.keysUp.indexOf(K.keyCode)||-1!==this.keysDown.indexOf(K.keyCode)||-1!==this.keysLeft.indexOf(K.keyCode)||-1!==this.keysRight.indexOf(K.keyCode)||-1!==this.keysReset.indexOf(K.keyCode)){const U=this._keys.indexOf(K.keyCode);U>=0&&this._keys.splice(U,1),K.preventDefault&&(C||K.preventDefault())}})))}Np(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const C=this.camera;for(let U=0;U<this._keys.length;U++){const K=this._keys[U];-1!==this.keysLeft.indexOf(K)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningX-=1/this.panningSensibility:C.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(K)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?C.inertialRadiusOffset+=1/this.zoomingSensibility:C.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(K)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningX+=1/this.panningSensibility:C.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(K)?this._ctrlPressed&&this.camera._useCtrlForPanning?C.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?C.inertialRadiusOffset-=1/this.zoomingSensibility:C.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(K)&&C.useInputToRestoreState&&C.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,m.d)([(0,O.O)()],y.prototype,"keysUp",void 0),(0,m.d)([(0,O.O)()],y.prototype,"keysDown",void 0),(0,m.d)([(0,O.O)()],y.prototype,"keysLeft",void 0),(0,m.d)([(0,O.O)()],y.prototype,"keysRight",void 0),(0,m.d)([(0,O.O)()],y.prototype,"keysReset",void 0),(0,m.d)([(0,O.O)()],y.prototype,"panningSensibility",void 0),(0,m.d)([(0,O.O)()],y.prototype,"zoomingSensibility",void 0),(0,m.d)([(0,O.O)()],y.prototype,"useAltToZoom",void 0),(0,m.d)([(0,O.O)()],y.prototype,"angularSpeed",void 0),Z.b.ArcRotateCameraKeyboardMoveInput=y;var a=K(11886),r=K(12131);class i{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new A.bU(0,0,0),this._globalOffset=new A.bU(0,0,0),this._inertialPanning=A.bU.Zero()}_computeDeltaFromMouseWheelLegacyEvent(C,U){let K=0;const m=.01*C*this.wheelDeltaPercentage*U;return K=C>0?m/(1+this.wheelDeltaPercentage):m*(1+this.wheelDeltaPercentage),K}attachControl(C){C=P.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==j.b.POINTERWHEEL)return;const K=U.event;let m=0;const O=K.deltaMode===r.e.DOM_DELTA_LINE?40:1,X=-K.deltaY*O;if(this.customComputeDeltaFromMouseWheel)m=this.customComputeDeltaFromMouseWheel(X,this,K);else if(this.wheelDeltaPercentage){if(m=this._computeDeltaFromMouseWheelLegacyEvent(X,this.camera.radius),m>0){let C=this.camera.radius,U=this.camera.inertialRadiusOffset+m;for(let K=0;K<20&&!(C<=U)&&!(Math.abs(U*this.camera.inertia)<.001);K++)C-=U,U*=this.camera.inertia;C=(0,e.Clamp)(C,0,Number.MAX_VALUE),m=this._computeDeltaFromMouseWheelLegacyEvent(X,C)}}else m=X/(40*this.wheelPrecision);m&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(m)):this.camera.inertialRadiusOffset+=m),K.preventDefault&&(C||K.preventDefault())},this._observer=this.camera.dC()._inputManager._addCameraPointerObserver(this._wheel,j.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.be(0)}Np(){this._observer&&(this.camera.dC()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const C=this.camera;0+C.inertialAlphaOffset+C.inertialBetaOffset+C.inertialRadiusOffset&&(this._updateHitPlane(),C.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(C.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const C=this.camera,U=C.target.vU(C.position);this._hitPlane=a.b.FromPositionAndNormal(C.target,U)}_getPosition(){const C=this.camera,U=C.dC(),K=U.createPickingRay(U.pointerX,U.pointerY,A.Matrix.Identity(),C,!1);0===C.targetScreenOffset.x&&0===C.targetScreenOffset.y||(this._viewOffset.set(C.targetScreenOffset.x,C.targetScreenOffset.y,0),C.getViewMatrix().invertToRef(C._cameraTransformMatrix),this._globalOffset=A.bU.TransformNormal(this._viewOffset,C._cameraTransformMatrix),K.origin.addInPlace(this._globalOffset));let m=0;return this._hitPlane&&(m=K.intersectsPlane(this._hitPlane)??0),K.origin.addInPlace(K.direction.scaleInPlace(m))}_zoomToMouse(C){const U=this.camera,K=1-U.inertia;if(U.lowerRadiusLimit){const m=U.lowerRadiusLimit??0;U.radius-(U.inertialRadiusOffset+C)/K<m&&(C=(U.radius-m)*K-U.inertialRadiusOffset)}if(U.upperRadiusLimit){const m=U.upperRadiusLimit??0;U.radius-(U.inertialRadiusOffset+C)/K>m&&(C=(U.radius-m)*K-U.inertialRadiusOffset)}const m=C/K/U.radius,O=this._getPosition(),X=A.TmpVectors.bU[6];O.subtractToRef(U.target,X),X.scaleInPlace(m),X.scaleInPlace(K),this._inertialPanning.addInPlace(X),U.inertialRadiusOffset+=C}_zeroIfClose(C){Math.abs(C.x)<E.d&&(C.x=0),Math.abs(C.y)<E.d&&(C.y=0),Math.abs(C.z)<E.d&&(C.z=0)}}(0,m.d)([(0,O.O)()],i.prototype,"wheelPrecision",void 0),(0,m.d)([(0,O.O)()],i.prototype,"zoomToMouseLocation",void 0),(0,m.d)([(0,O.O)()],i.prototype,"wheelDeltaPercentage",void 0),Z.b.ArcRotateCameraMouseWheelInput=i;class D extends Z.f{constructor(C){super(C)}addMouseWheel(){return this.add(new i),this}addPointers(){return this.add(new d),this}addKeyboard(){return this.add(new y),this}}var l=K(11789);function G(C,U){return isNaN(C)?U:C}t.c.AddNodeConstructor("ArcRotateCamera",((C,U)=>()=>new J(C,0,0,1,A.bU.Zero(),U)));class J extends F.d{get target(){return this._target}set target(C){this.setTarget(C)}get targetHost(){return this._targetHost}set targetHost(C){C&&this.setTarget(C)}getTarget(){return this.target}get position(){return this._position}set position(C){this.setPosition(C)}set upVector(C){this._upToYMatrix||(this._yToUpMatrix=new A.Matrix,this._upToYMatrix=new A.Matrix,this._upVector=A.bU.Zero()),C.normalize(),this._upVector.m(C),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){A.Matrix.RotationAlignToRef(A.bU.UpReadOnly,this._upVector,this._yToUpMatrix),A.Matrix.RotationAlignToRef(this._upVector,A.bU.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const C=this.inputs.attached.pointers;return C?C.angularSensibilityX:0}set angularSensibilityX(C){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityX=C)}get angularSensibilityY(){const C=this.inputs.attached.pointers;return C?C.angularSensibilityY:0}set angularSensibilityY(C){const U=this.inputs.attached.pointers;U&&(U.angularSensibilityY=C)}get pinchPrecision(){const C=this.inputs.attached.pointers;return C?C.pinchPrecision:0}set pinchPrecision(C){const U=this.inputs.attached.pointers;U&&(U.pinchPrecision=C)}get pinchDeltaPercentage(){const C=this.inputs.attached.pointers;return C?C.pinchDeltaPercentage:0}set pinchDeltaPercentage(C){const U=this.inputs.attached.pointers;U&&(U.pinchDeltaPercentage=C)}get useNaturalPinchZoom(){const C=this.inputs.attached.pointers;return!!C&&C.useNaturalPinchZoom}set useNaturalPinchZoom(C){const U=this.inputs.attached.pointers;U&&(U.useNaturalPinchZoom=C)}get panningSensibility(){const C=this.inputs.attached.pointers;return C?C.panningSensibility:0}set panningSensibility(C){const U=this.inputs.attached.pointers;U&&(U.panningSensibility=C)}get keysUp(){const C=this.inputs.attached.keyboard;return C?C.keysUp:[]}set keysUp(C){const U=this.inputs.attached.keyboard;U&&(U.keysUp=C)}get keysDown(){const C=this.inputs.attached.keyboard;return C?C.keysDown:[]}set keysDown(C){const U=this.inputs.attached.keyboard;U&&(U.keysDown=C)}get keysLeft(){const C=this.inputs.attached.keyboard;return C?C.keysLeft:[]}set keysLeft(C){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=C)}get keysRight(){const C=this.inputs.attached.keyboard;return C?C.keysRight:[]}set keysRight(C){const U=this.inputs.attached.keyboard;U&&(U.keysRight=C)}get wheelPrecision(){const C=this.inputs.attached.mousewheel;return C?C.wheelPrecision:0}set wheelPrecision(C){const U=this.inputs.attached.mousewheel;U&&(U.wheelPrecision=C)}get zoomToMouseLocation(){const C=this.inputs.attached.mousewheel;return!!C&&C.zoomToMouseLocation}set zoomToMouseLocation(C){const U=this.inputs.attached.mousewheel;U&&(U.zoomToMouseLocation=C)}get wheelDeltaPercentage(){const C=this.inputs.attached.mousewheel;return C?C.wheelDeltaPercentage:0}set wheelDeltaPercentage(C){const U=this.inputs.attached.mousewheel;U&&(U.wheelDeltaPercentage=C)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(C){C!==this.useBouncingBehavior&&(C?(this._bouncingBehavior=new Q,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(C){C!==this.useFramingBehavior&&(C?(this._framingBehavior=new V,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(C){C!==this.useAutoRotationBehavior&&(C?(this._autoRotationBehavior=new u,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(C,U,K,m,O,e){var t;let z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(C,A.bU.Zero(),e,z),t=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=A.bU.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=A.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new A.Matrix,this.panningAxis=new A.bU(1,1,0),this._transformedDirection=new A.bU,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new X.b,this.checkCollisions=!1,this.collisionRadius=new A.bU(.5,.5,.5),this._previousPosition=A.bU.Zero(),this._collisionVelocity=A.bU.Zero(),this._newPosition=A.bU.Zero(),this._computationVector=A.bU.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new A.bU(NaN,NaN,NaN),this._goalTargetScreenOffset=new A.Vector2(NaN,NaN),this._onCollisionPositionChange=function(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K?(t.setPosition(U),t.Pu&&t.Pu(K)):t._previousPosition.m(t._position);const m=Math.cos(t.alpha),O=Math.sin(t.alpha),X=Math.cos(t.beta);let A=Math.sin(t.beta);0===A&&(A=1e-4);const e=t._getTargetPosition();t._computationVector.Ee(t.radius*m*A,t.radius*X,t.radius*O*A),e.addToRef(t._computationVector,t._newPosition),t._position.m(t._newPosition);let z=t.upVector;t.allowUpsideDown&&t.beta<0&&(z=z.clone(),z=z.negate()),t._computeViewMatrix(t._position,e,z),t._viewMatrix.addAtIndex(12,t.targetScreenOffset.x),t._viewMatrix.addAtIndex(13,t.targetScreenOffset.y),t._collisionTriggered=!1},this._target=A.bU.Zero(),O&&this.setTarget(O),this.alpha=U,this.beta=K,this.radius=m,this.getViewMatrix(),this.inputs=new D(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new A.bU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=A.Vector2.Zero()}_updateCache(C){C||super._updateCache(),this._cache._target.m(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.m(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const C=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?C.addToRef(this._targetBoundingCenter,this._target):this._target.m(C)}const C=this._getLockedTargetPosition();return C||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>E.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,X=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=X?this._currentInterpolationFactor=X:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=G(C,this._goalAlpha),this._goalBeta=G(U,this._goalBeta),this._goalRadius=G(K,this._goalRadius),this._goalTarget.set(G(m.x,this._goalTarget.x),G(m.y,this._goalTarget.y),G(m.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(G(O.x,this._goalTargetScreenOffset.x),G(O.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,e.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,e.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,e.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,e.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(C,U){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const O=arguments;U=P.Tools.BackCompatCameraNoPreventDefault(O),this._useCtrlForPanning=K,this._panningMouseButton=m,"boolean"===typeof O[0]&&(O.length>1&&(this._useCtrlForPanning=O[1]),O.length>2&&(this._panningMouseButton=O[2])),this.inputs.attachElement(U),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Np(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let C=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){C=!0;const U=this.invertRotation?-1:1,K=this._calculateHandednessMultiplier();let m=this.inertialAlphaOffset*K;this.beta<0&&(m*=-1),this.alpha+=m*U,this.beta+=this.inertialBetaOffset*U,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<E.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<E.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*E.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){C=!0;const U=new A.bU(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),U.multiplyInPlace(this.panningAxis),A.bU.TransformNormalToRef(U,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const C=this.upVector,U=A.bU.CrossToRef(this._transformedDirection,C,this._transformedDirection);A.bU.CrossToRef(C,U,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);A.bU.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.m(this._transformedDirection)}else{if(this.parent){const C=A.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(C),C.transposeToRef(C),A.bU.TransformCoordinatesToRef(this._transformedDirection,C,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*E.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*E.d&&(this.inertialPanningY=0)}if(C)this.stopInterpolation();else if(this._isInterpolating){let C=!1;const U=this._scene.getEngine().getDeltaTime()/1e3,K=1-Math.pow(2,-U/this._currentInterpolationFactor),m=G(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const U=A.TmpVectors.bU[0].set(G(this._goalTarget.x,this._target.x),G(this._goalTarget.y,this._target.y),G(this._goalTarget.z,this._target.z));A.bU.LerpToRef(this.target,U,K,this._target),10*A.bU.Distance(this.target,U)/m<E.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.m(U),this.setTarget(this.target,!1,!0,!0)):C=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const U=A.Quaternion.RotationAlphaBetaGammaToRef(G(this._goalAlpha,this.alpha),G(this._goalBeta,this.beta),0,A.TmpVectors.Quaternion[0]),m=A.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,A.TmpVectors.Quaternion[1]),O=A.Quaternion.SlerpToRef(m,U,K,A.TmpVectors.Quaternion[2]);O.normalize();const X=O.toAlphaBetaGammaToRef(A.TmpVectors.bU[0]);if(this.alpha=X.x,this.beta=X.y,O.isApprox(U,E.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const C=U.toAlphaBetaGammaToRef(A.TmpVectors.bU[0]);this.alpha=C.x,this.beta=C.y}else C=!0}if(isNaN(this._goalRadius)||(this.radius+=(m-this.radius)*K,Math.abs(m/this.radius-1)<E.d?(this._goalRadius=NaN,this.radius=m):C=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const U=A.TmpVectors.Vector2[0].set(G(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),G(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));A.Vector2.LerpToRef(this.targetScreenOffset,U,K,this.targetScreenOffset),A.Vector2.Distance(this.targetScreenOffset,U)<E.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.m(U)):C=!0}this._isInterpolating=C}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||A.bU.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const C=this.alpha;var U,K;this.alpha=function(C){let U=Math.PI/2;return 0===C.x&&0===C.z||(U=Math.acos(C.x/Math.sqrt(Math.pow(C.x,2)+Math.pow(C.z,2)))),C.z<0&&(U=2*Math.PI-U),U}(this._computationVector),this.beta=(U=this._computationVector.y,K=this.radius,Math.acos(U/K));const m=Math.round((C-this.alpha)/(2*Math.PI));this.alpha+=2*m*Math.PI,this._checkLimits()}setPosition(C){this._position.equals(C)||(this._position.m(C),this.rebuildAnglesAndRadius())}setTarget(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(m=this.overrideCloneAlphaBetaRadius??m,C.te)U&&C.getBoundingInfo?this._targetBoundingCenter=C.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,C.te(),this._targetHost=C,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const U=C,m=this._getTargetPosition();if(m&&!K&&m.equals(U))return;this._targetHost=null,this._target=U,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}m||this.rebuildAnglesAndRadius()}_getViewMatrix(){const C=Math.cos(this.alpha),U=Math.sin(this.alpha),K=Math.cos(this.beta);let m=Math.sin(this.beta);0===m&&(m=1e-4),0===this.radius&&(this.radius=1e-4);const O=this._getTargetPosition();if(this._computationVector.Ee(this.radius*C*m,this.radius*K,this.radius*U*m),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||A.bU.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),O.addToRef(this._computationVector,this._newPosition),this.dC().collisionsEnabled&&this.checkCollisions){const C=this.dC().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,C.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.m(this._newPosition);let C=this.upVector;this.allowUpsideDown&&m<0&&(C=C.negate()),this._computeViewMatrix(this._position,O,C),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.m(O),this._viewMatrix}zoomOn(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];C=C||this.dC().meshes;const K=z.b.MinMax(C);let m=this._calculateLowerRadiusFromModelBoundingSphere(K.min,K.max);if(m=Math.max(Math.min(m,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=m*this.zoomOnFactor,this.mode===f.b.ORTHOGRAPHIC_CAMERA){const C=this.dC().getEngine().getAspectRatio(this),U=m*this.zoomOnFactor/2;this.orthoLeft=-U*C,this.orthoRight=U*C,this.orthoBottom=-U,this.orthoTop=U}this.focusOn({min:K.min,max:K.max,distance:m},U)}focusOn(C){let U,K,m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===C.min){const m=C||this.dC().meshes;U=z.b.MinMax(m),K=A.bU.Distance(U.min,U.max)}else{U=C,K=C.distance}this._target=z.b.Center(U),m||(this.maxZ=2*K)}createRigCamera(C,U){let K=0;switch(this.cameraRigMode){case f.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.b.RIG_MODE_VR:K=this._cameraRigParams.stereoHalfAngle*(0===U?1:-1);break;case f.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:K=this._cameraRigParams.stereoHalfAngle*(0===U?-1:1)}const m=new J(C,this.alpha+K,this.beta,this.radius,this._target,this.dC());return m._cameraRigParams={},m.isRigCamera=!0,m.rigParent=this,m.upVector=this.upVector,m.mode=this.mode,m.orthoLeft=this.orthoLeft,m.orthoRight=this.orthoRight,m.orthoBottom=this.orthoBottom,m.orthoTop=this.orthoTop,m}_updateRigCameras(){const C=this._rigCameras[0],U=this._rigCameras[1];switch(C.beta=U.beta=this.beta,this.cameraRigMode){case f.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.b.RIG_MODE_VR:C.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case f.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const m=A.bU.Distance(C,U),O=this.dC().getEngine().getAspectRatio(this),X=Math.tan(this.fov/2),e=X*O,t=.5*m*K,z=t*Math.sqrt(1+1/(e*e)),j=t*Math.sqrt(1+1/(X*X));return Math.max(z,j)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,m.d)([(0,O.O)()],J.prototype,"alpha",void 0),(0,m.d)([(0,O.O)()],J.prototype,"beta",void 0),(0,m.d)([(0,O.O)()],J.prototype,"radius",void 0),(0,m.d)([(0,O.O)()],J.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,m.d)([(0,O.L)("target")],J.prototype,"_target",void 0),(0,m.d)([(0,O.A)("targetHost")],J.prototype,"_targetHost",void 0),(0,m.d)([(0,O.O)()],J.prototype,"inertialAlphaOffset",void 0),(0,m.d)([(0,O.O)()],J.prototype,"inertialBetaOffset",void 0),(0,m.d)([(0,O.O)()],J.prototype,"inertialRadiusOffset",void 0),(0,m.d)([(0,O.O)()],J.prototype,"lowerAlphaLimit",void 0),(0,m.d)([(0,O.O)()],J.prototype,"upperAlphaLimit",void 0),(0,m.d)([(0,O.O)()],J.prototype,"lowerBetaLimit",void 0),(0,m.d)([(0,O.O)()],J.prototype,"upperBetaLimit",void 0),(0,m.d)([(0,O.O)()],J.prototype,"lowerRadiusLimit",void 0),(0,m.d)([(0,O.O)()],J.prototype,"upperRadiusLimit",void 0),(0,m.d)([(0,O.O)()],J.prototype,"lowerTargetYLimit",void 0),(0,m.d)([(0,O.O)()],J.prototype,"inertialPanningX",void 0),(0,m.d)([(0,O.O)()],J.prototype,"inertialPanningY",void 0),(0,m.d)([(0,O.O)()],J.prototype,"pinchToPanMaxDistance",void 0),(0,m.d)([(0,O.O)()],J.prototype,"panningDistanceLimit",void 0),(0,m.d)([(0,O.L)()],J.prototype,"panningOriginTarget",void 0),(0,m.d)([(0,O.O)()],J.prototype,"panningInertia",void 0),(0,m.d)([(0,O.O)()],J.prototype,"zoomToMouseLocation",null),(0,m.d)([(0,O.O)()],J.prototype,"zoomOnFactor",void 0),(0,m.d)([(0,O.H)()],J.prototype,"targetScreenOffset",void 0),(0,m.d)([(0,O.O)()],J.prototype,"allowUpsideDown",void 0),(0,m.d)([(0,O.O)()],J.prototype,"useInputToRestoreState",void 0),(0,m.d)([(0,O.O)()],J.prototype,"restoreStateInterpolationFactor",void 0),(0,l.h)("BABYLON.ArcRotateCamera",J)},13439:(C,U,K)=>{"use strict";K.d(U,{b:()=>A,f:()=>e});var m=K(11679),O=K(11863),X=K(12292),A={};class e{constructor(C){this.attachedToElement=!1,this.attached={},this.camera=C,this.checkInputs=()=>{}}add(C){const U=C.getSimpleName();this.attached[U]?m.d.Warn("camera input of type "+U+" already exists on camera"):(this.attached[U]=C,C.camera=this.camera,C.checkInputs&&(this.checkInputs=this._addCheckInputs(C.checkInputs.bind(C))),this.attachedToElement&&C.attachControl(this.noPreventDefault))}remove(C){for(const U in this.attached){const K=this.attached[U];if(K===C)return K.Np(),K.camera=null,delete this.attached[U],void this.rebuildInputCheck()}}removeByType(C){for(const U in this.attached){const K=this.attached[U];K.getClassName()===C&&(K.Np(),K.camera=null,delete this.attached[U],this.rebuildInputCheck())}}_addCheckInputs(C){const U=this.checkInputs;return()=>{U(),C()}}attachInput(C){this.attachedToElement&&C.attachControl(this.noPreventDefault)}attachElement(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){C=!X.b.ForceAttachControlToAlwaysPreventDefault&&C,this.attachedToElement=!0,this.noPreventDefault=C;for(const U in this.attached)this.attached[U].attachControl(C)}}detachElement(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const U in this.attached)this.attached[U].Np(),C&&(this.attached[U].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const C in this.attached){const U=this.attached[C];U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(C){const U={};for(const K in this.attached){const C=this.attached[K],m=O.c.Serialize(C);U[C.getClassName()]=m}C.inputsmgr=U}parse(C){const U=C.inputsmgr;if(U){this.clear();for(const C in U){const K=A[C];if(K){const m=U[C],X=O.c.Parse((()=>new K),m,null);this.add(X)}}}else for(const K in this.attached){const U=A[this.attached[K].getClassName()];if(U){const m=O.c.Parse((()=>new U),C,null);this.remove(this.attached[K]),this.add(m)}}}}},13431:(C,U,K)=>{"use strict";K.d(U,{b:()=>H});var m=K(11810),O=K(11818),X=K(11827),A=K(12323),e=K(13439),t=K(12123),z=K(11660);class j{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(C){C=z.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.dC(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((U=>{const K=U.event;if(!K.metaKey)if(U.type===t.e.KEYDOWN){if(-1!==this.keysUp.indexOf(K.keyCode)||-1!==this.keysDown.indexOf(K.keyCode)||-1!==this.keysLeft.indexOf(K.keyCode)||-1!==this.keysRight.indexOf(K.keyCode)||-1!==this.keysUpward.indexOf(K.keyCode)||-1!==this.keysDownward.indexOf(K.keyCode)||-1!==this.keysRotateLeft.indexOf(K.keyCode)||-1!==this.keysRotateRight.indexOf(K.keyCode)||-1!==this.keysRotateUp.indexOf(K.keyCode)||-1!==this.keysRotateDown.indexOf(K.keyCode)){-1===this._keys.indexOf(K.keyCode)&&this._keys.push(K.keyCode),C||K.preventDefault()}}else if(-1!==this.keysUp.indexOf(K.keyCode)||-1!==this.keysDown.indexOf(K.keyCode)||-1!==this.keysLeft.indexOf(K.keyCode)||-1!==this.keysRight.indexOf(K.keyCode)||-1!==this.keysUpward.indexOf(K.keyCode)||-1!==this.keysDownward.indexOf(K.keyCode)||-1!==this.keysRotateLeft.indexOf(K.keyCode)||-1!==this.keysRotateRight.indexOf(K.keyCode)||-1!==this.keysRotateUp.indexOf(K.keyCode)||-1!==this.keysRotateDown.indexOf(K.keyCode)){const U=this._keys.indexOf(K.keyCode);U>=0&&this._keys.splice(U,1),C||K.preventDefault()}})))}Np(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const C=this.camera;for(let U=0;U<this._keys.length;U++){const K=this._keys[U],m=C._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(K)?C._localDirection.Ee(-m,0,0):-1!==this.keysUp.indexOf(K)?C._localDirection.Ee(0,0,m):-1!==this.keysRight.indexOf(K)?C._localDirection.Ee(m,0,0):-1!==this.keysDown.indexOf(K)?C._localDirection.Ee(0,0,-m):-1!==this.keysUpward.indexOf(K)?C._localDirection.Ee(0,m,0):-1!==this.keysDownward.indexOf(K)?C._localDirection.Ee(0,-m,0):-1!==this.keysRotateLeft.indexOf(K)?(C._localDirection.Ee(0,0,0),C.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(K)?(C._localDirection.Ee(0,0,0),C.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(K)?(C._localDirection.Ee(0,0,0),C.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(K)&&(C._localDirection.Ee(0,0,0),C.cameraRotation.x+=this._getLocalRotation()),C.dC().useRightHandedSystem&&(C._localDirection.z*=-1),C.getViewMatrix().invertToRef(C._cameraTransformMatrix),X.bU.TransformNormalToRef(C._localDirection,C._cameraTransformMatrix,C._transformedDirection),C.cameraDirection.addInPlace(C._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const C=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*C}}(0,m.d)([(0,O.O)()],j.prototype,"keysUp",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysUpward",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysDown",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysDownward",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysLeft",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysRight",void 0),(0,m.d)([(0,O.O)()],j.prototype,"rotationSpeed",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysRotateLeft",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysRotateRight",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysRotateUp",void 0),(0,m.d)([(0,O.O)()],j.prototype,"keysRotateDown",void 0),e.b.FreeCameraKeyboardMoveInput=j;var p=K(11663),E=K(12116);class u{constructor(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=C,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new p.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(C){C=z.Tools.BackCompatCameraNoPreventDefault(arguments);const U=this.camera.getEngine(),K=U.getInputElement();this._pointerInput||(this._pointerInput=m=>{const O=m.event,X="touch"===O.pointerType;if(!this.touchEnabled&&X)return;if(m.type!==E.b.POINTERMOVE&&-1===this.buttons.indexOf(O.button))return;const A=O.target;if(m.type===E.b.POINTERDOWN){if(X&&-1!==this._activePointerId||!X&&-1!==this._currentActiveButton)return;this._activePointerId=O.pointerId;try{null===A||void 0===A||A.setPointerCapture(O.pointerId)}catch(e){}-1===this._currentActiveButton&&(this._currentActiveButton=O.button),this._previousPosition={x:O.clientX,y:O.clientY},C||(O.preventDefault(),K&&K.focus()),U.isPointerLock&&this._onMouseMove&&this._onMouseMove(m.event)}else if(m.type===E.b.POINTERUP){if(X&&this._activePointerId!==O.pointerId||!X&&this._currentActiveButton!==O.button)return;try{null===A||void 0===A||A.releasePointerCapture(O.pointerId)}catch(e){}this._currentActiveButton=-1,this._previousPosition=null,C||O.preventDefault(),this._activePointerId=-1}else if(m.type===E.b.POINTERMOVE&&(this._activePointerId===O.pointerId||!X))if(U.isPointerLock&&this._onMouseMove)this._onMouseMove(m.event);else if(this._previousPosition){const U=this.camera._calculateHandednessMultiplier(),K=(O.clientX-this._previousPosition.x)*U,m=O.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=K/this.angularSensibility,this.camera.cameraRotation.x+=m/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:K,offsetY:m}),this._previousPosition={x:O.clientX,y:O.clientY},C||O.preventDefault()}}),this._onMouseMove=K=>{if(!U.isPointerLock)return;const m=this.camera._calculateHandednessMultiplier(),O=K.movementX*m;this.camera.cameraRotation.y+=O/this.angularSensibility;const X=K.movementY;this.camera.cameraRotation.x+=X/this.angularSensibility,this._previousPosition=null,C||K.preventDefault()},this._observer=this.camera.dC()._inputManager._addCameraPointerObserver(this._pointerInput,E.b.POINTERDOWN|E.b.POINTERUP|E.b.POINTERMOVE),K&&(this._contextMenuBind=C=>this.onContextMenu(C),K.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(C){C.preventDefault()}Np(){if(this._observer){if(this.camera.dC()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const C=this.camera.getEngine().getInputElement();C&&C.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,m.d)([(0,O.O)()],u.prototype,"buttons",void 0),(0,m.d)([(0,O.O)()],u.prototype,"angularSensibility",void 0),e.b.FreeCameraMouseInput=u;var b,v=K(12131);class Q{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new p.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(C){C=z.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=U=>{if(U.type!==E.b.POINTERWHEEL)return;const K=U.event,m=K.deltaMode===v.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*m*K.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*m*K.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*m*K.deltaZ/this._normalize,K.preventDefault&&(C||K.preventDefault())},this._observer=this.camera.dC()._inputManager._addCameraPointerObserver(this._wheel,E.b.POINTERWHEEL)}Np(){this._observer&&(this.camera.dC()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,m.d)([(0,O.O)()],Q.prototype,"wheelPrecisionX",void 0),(0,m.d)([(0,O.O)()],Q.prototype,"wheelPrecisionY",void 0),(0,m.d)([(0,O.O)()],Q.prototype,"wheelPrecisionZ",void 0),function(C){C[C.MoveRelative=0]="MoveRelative",C[C.RotateRelative=1]="RotateRelative",C[C.MoveScene=2]="MoveScene"}(b||(b={}));class V extends Q{constructor(){super(...arguments),this._moveRelative=X.bU.Zero(),this._rotateRelative=X.bU.Zero(),this._moveScene=X.bU.Zero(),this._wheelXAction=b.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=b.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(C){null===C&&this._wheelXAction!==b.MoveRelative||(this._wheelXAction=b.MoveRelative,this._wheelXActionCoordinate=C)}get wheelXMoveRelative(){return this._wheelXAction!==b.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(C){null===C&&this._wheelYAction!==b.MoveRelative||(this._wheelYAction=b.MoveRelative,this._wheelYActionCoordinate=C)}get wheelYMoveRelative(){return this._wheelYAction!==b.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(C){null===C&&this._wheelZAction!==b.MoveRelative||(this._wheelZAction=b.MoveRelative,this._wheelZActionCoordinate=C)}get wheelZMoveRelative(){return this._wheelZAction!==b.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(C){null===C&&this._wheelXAction!==b.RotateRelative||(this._wheelXAction=b.RotateRelative,this._wheelXActionCoordinate=C)}get wheelXRotateRelative(){return this._wheelXAction!==b.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(C){null===C&&this._wheelYAction!==b.RotateRelative||(this._wheelYAction=b.RotateRelative,this._wheelYActionCoordinate=C)}get wheelYRotateRelative(){return this._wheelYAction!==b.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(C){null===C&&this._wheelZAction!==b.RotateRelative||(this._wheelZAction=b.RotateRelative,this._wheelZActionCoordinate=C)}get wheelZRotateRelative(){return this._wheelZAction!==b.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(C){null===C&&this._wheelXAction!==b.MoveScene||(this._wheelXAction=b.MoveScene,this._wheelXActionCoordinate=C)}get wheelXMoveScene(){return this._wheelXAction!==b.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(C){null===C&&this._wheelYAction!==b.MoveScene||(this._wheelYAction=b.MoveScene,this._wheelYActionCoordinate=C)}get wheelYMoveScene(){return this._wheelYAction!==b.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(C){null===C&&this._wheelZAction!==b.MoveScene||(this._wheelZAction=b.MoveScene,this._wheelZActionCoordinate=C)}get wheelZMoveScene(){return this._wheelZAction!==b.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.be(0),this._rotateRelative.be(0),this._moveScene.be(0),this._updateCamera(),this.camera.dC().useRightHandedSystem&&(this._moveRelative.z*=-1);const C=X.Matrix.Zero();this.camera.getViewMatrix().invertToRef(C);const U=X.bU.Zero();X.bU.TransformNormalToRef(this._moveRelative,C,U),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(U),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(C,U,K){if(0===C)return;if(null===U||null===K)return;let m=null;switch(U){case b.MoveRelative:m=this._moveRelative;break;case b.RotateRelative:m=this._rotateRelative;break;case b.MoveScene:m=this._moveScene}switch(K){case 0:m.set(C,0,0);break;case 1:m.set(0,C,0);break;case 2:m.set(0,0,C)}}}(0,m.d)([(0,O.O)()],V.prototype,"wheelXMoveRelative",null),(0,m.d)([(0,O.O)()],V.prototype,"wheelYMoveRelative",null),(0,m.d)([(0,O.O)()],V.prototype,"wheelZMoveRelative",null),(0,m.d)([(0,O.O)()],V.prototype,"wheelXRotateRelative",null),(0,m.d)([(0,O.O)()],V.prototype,"wheelYRotateRelative",null),(0,m.d)([(0,O.O)()],V.prototype,"wheelZRotateRelative",null),(0,m.d)([(0,O.O)()],V.prototype,"wheelXMoveScene",null),(0,m.d)([(0,O.O)()],V.prototype,"wheelYMoveScene",null),(0,m.d)([(0,O.O)()],V.prototype,"wheelZMoveScene",null),e.b.FreeCameraMouseWheelInput=V;class f{constructor(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=C,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=z.Tools.IsSafari()}attachControl(C){C=z.Tools.BackCompatCameraNoPreventDefault(arguments);let U=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=K=>{const m=K.event,O="mouse"===m.pointerType||this._isSafari&&"undefined"===typeof m.pointerType;if(this.allowMouse||!O)if(K.type===E.b.POINTERDOWN){if(C||m.preventDefault(),this._pointerPressed.push(m.pointerId),1!==this._pointerPressed.length)return;U={x:m.clientX,y:m.clientY}}else if(K.type===E.b.POINTERUP){C||m.preventDefault();const K=this._pointerPressed.indexOf(m.pointerId);if(-1===K)return;if(this._pointerPressed.splice(K,1),0!=K)return;U=null,this._offsetX=null,this._offsetY=null}else if(K.type===E.b.POINTERMOVE){if(C||m.preventDefault(),!U)return;if(0!=this._pointerPressed.indexOf(m.pointerId))return;this._offsetX=m.clientX-U.x,this._offsetY=-(m.clientY-U.y)}}),this._observer=this.camera.dC()._inputManager._addCameraPointerObserver(this._pointerInput,E.b.POINTERDOWN|E.b.POINTERUP|E.b.POINTERMOVE),this._onLostFocus){const C=this.camera.getEngine().getInputElement();C&&C.addEventListener("blur",this._onLostFocus)}}Np(){if(this._pointerInput){if(this._observer&&(this.camera.dC()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const C=this.camera.getEngine().getInputElement();C&&C.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const C=this.camera,U=C._calculateHandednessMultiplier();C.cameraRotation.y=U*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)C.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const U=C._computeLocalCameraSpeed(),K=new X.bU(0,0,0!==this.touchMoveSensibility?U*this._offsetY/this.touchMoveSensibility:0);X.Matrix.RotationYawPitchRollToRef(C.rotation.y,C.rotation.x,0,C._cameraRotationMatrix),C.cameraDirection.addInPlace(X.bU.TransformCoordinates(K,C._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,m.d)([(0,O.O)()],f.prototype,"touchAngularSensibility",void 0),(0,m.d)([(0,O.O)()],f.prototype,"touchMoveSensibility",void 0),e.b.FreeCameraTouchInput=f;class F extends e.f{constructor(C){super(C),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new j),this}addMouse(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new u(C),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new V,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new f),this}clear(){super.clear(),this._mouseInput=null}}var Z=K(11789),P=K(11735);class H extends A.d{get angularSensibility(){const C=this.inputs.attached.mouse;return C?C.angularSensibility:0}set angularSensibility(C){const U=this.inputs.attached.mouse;U&&(U.angularSensibility=C)}get keysUp(){const C=this.inputs.attached.keyboard;return C?C.keysUp:[]}set keysUp(C){const U=this.inputs.attached.keyboard;U&&(U.keysUp=C)}get keysUpward(){const C=this.inputs.attached.keyboard;return C?C.keysUpward:[]}set keysUpward(C){const U=this.inputs.attached.keyboard;U&&(U.keysUpward=C)}get keysDown(){const C=this.inputs.attached.keyboard;return C?C.keysDown:[]}set keysDown(C){const U=this.inputs.attached.keyboard;U&&(U.keysDown=C)}get keysDownward(){const C=this.inputs.attached.keyboard;return C?C.keysDownward:[]}set keysDownward(C){const U=this.inputs.attached.keyboard;U&&(U.keysDownward=C)}get keysLeft(){const C=this.inputs.attached.keyboard;return C?C.keysLeft:[]}set keysLeft(C){const U=this.inputs.attached.keyboard;U&&(U.keysLeft=C)}get keysRight(){const C=this.inputs.attached.keyboard;return C?C.keysRight:[]}set keysRight(C){const U=this.inputs.attached.keyboard;U&&(U.keysRight=C)}get keysRotateLeft(){const C=this.inputs.attached.keyboard;return C?C.keysRotateLeft:[]}set keysRotateLeft(C){const U=this.inputs.attached.keyboard;U&&(U.keysRotateLeft=C)}get keysRotateRight(){const C=this.inputs.attached.keyboard;return C?C.keysRotateRight:[]}set keysRotateRight(C){const U=this.inputs.attached.keyboard;U&&(U.keysRotateRight=C)}get keysRotateUp(){const C=this.inputs.attached.keyboard;return C?C.keysRotateUp:[]}set keysRotateUp(C){const U=this.inputs.attached.keyboard;U&&(U.keysRotateUp=C)}get keysRotateDown(){const C=this.inputs.attached.keyboard;return C?C.keysRotateDown:[]}set keysRotateDown(C){const U=this.inputs.attached.keyboard;U&&(U.keysRotateDown=C)}constructor(C,U,K){var m;super(C,U,K,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),m=this,this.ellipsoid=new X.bU(.5,1,.5),this.ellipsoidOffset=new X.bU(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=X.bU.Zero(),this._diffPosition=X.bU.Zero(),this._newPosition=X.bU.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;m._newPosition.m(U),m._newPosition.subtractToRef(m._oldPosition,m._diffPosition),m._diffPosition.length()>P.b.CollisionsEpsilon&&(m.position.addToRef(m._diffPosition,m._deferredPositionUpdate),m._deferOnly?m._deferredUpdated=!0:m.position.m(m._deferredPositionUpdate),m.Pu&&K&&m.Pu(K))},this.inputs=new F(this),this.inputs.addKeyboard().addMouse()}attachControl(C,U){U=z.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(U)}Np(){this.inputs.detachElement(),this.cameraDirection=new X.bU(0,0,0),this.cameraRotation=new X.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(C){this._collisionMask=isNaN(C)?-1:C}_collideWithWorld(C){let U;U=this.parent?X.bU.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,U.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const K=this.dC().collisionCoordinator;this._collider||(this._collider=K.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let m=C;this.applyGravity&&(m=C.add(this.dC().gravity)),K.getNewPosition(this._oldPosition,m,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=X.bU.Zero(),this._transformedDirection=X.bU.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(C){this._needMoveForGravity=C}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.dC().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"le"}}(0,m.d)([(0,O.L)()],H.prototype,"ellipsoid",void 0),(0,m.d)([(0,O.L)()],H.prototype,"ellipsoidOffset",void 0),(0,m.d)([(0,O.O)()],H.prototype,"checkCollisions",void 0),(0,m.d)([(0,O.O)()],H.prototype,"applyGravity",void 0),(0,Z.h)("BABYLON.FreeCamera",H)},14027:(C,U,K)=>{"use strict";K.d(U,{d:()=>X});var m=K(11930),O=K(14031);class X{constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=K,this.Xp=[],this._maxBlockCapacity=U||64,this._selectionContent=new m.b(1024),this._creationFunc=C}update(C,U,K){O.d._CreateBlocks(C,U,K,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Ej(C){for(let U=0;U<this.Tj.length;U++){this.Tj[U].addEntry(C)}}pj(C){for(let U=0;U<this.Tj.length;U++){this.Tj[U].removeEntry(C)}}select(C,U){this._selectionContent.reset();for(let K=0;K<this.Tj.length;K++){this.Tj[K].select(C,this._selectionContent,U)}return U?this._selectionContent.concat(this.Xp):this._selectionContent.concatWithNoDuplicate(this.Xp),this._selectionContent}intersects(C,U,K){this._selectionContent.reset();for(let m=0;m<this.Tj.length;m++){this.Tj[m].intersects(C,U,this._selectionContent,K)}return K?this._selectionContent.concat(this.Xp):this._selectionContent.concatWithNoDuplicate(this.Xp),this._selectionContent}intersectsRay(C){this._selectionContent.reset();for(let U=0;U<this.Tj.length;U++){this.Tj[U].intersectsRay(C,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Xp),this._selectionContent}}X.CreationFuncForMeshes=(C,U)=>{const K=C.getBoundingInfo();!C.isBlocked&&K.boundingBox.intersectsMinMax(U.jp,U.pp)&&U.entries.push(C)},X.CreationFuncForSubMeshes=(C,U)=>{C.getBoundingInfo().boundingBox.intersectsMinMax(U.jp,U.pp)&&U.entries.push(C)}},14031:(C,U,K)=>{"use strict";K.d(U,{d:()=>X});var m=K(11827),O=K(12183);class X{constructor(C,U,K,m,O,X){this.entries=[],this.Ep=new Array,this._capacity=K,this._depth=m,this._maxDepth=O,this._creationFunc=X,this._minPoint=C,this._maxPoint=U,this.Ep.push(C.clone()),this.Ep.push(U.clone()),this.Ep.push(C.clone()),this.Ep[2].x=U.x,this.Ep.push(C.clone()),this.Ep[3].y=U.y,this.Ep.push(C.clone()),this.Ep[4].z=U.z,this.Ep.push(U.clone()),this.Ep[5].z=C.z,this.Ep.push(U.clone()),this.Ep[6].x=C.x,this.Ep.push(U.clone()),this.Ep[7].y=C.y}get ye(){return this._capacity}get jp(){return this._minPoint}get pp(){return this._maxPoint}addEntry(C){if(this.Tj)for(let U=0;U<this.Tj.length;U++){this.Tj[U].addEntry(C)}else this._creationFunc(C,this),this.entries.length>this.ye&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(C){if(this.Tj){for(let U=0;U<this.Tj.length;U++){this.Tj[U].removeEntry(C)}return}const U=this.entries.indexOf(C);U>-1&&this.entries.splice(U,1)}addEntries(C){for(let U=0;U<C.length;U++){const K=C[U];this.addEntry(K)}}select(C,U,K){if(O.b.IsInFrustum(this.Ep,C)){if(this.Tj){for(let m=0;m<this.Tj.length;m++){this.Tj[m].select(C,U,K)}return}K?U.concat(this.entries):U.concatWithNoDuplicate(this.entries)}}intersects(C,U,K,m){if(O.b.IntersectsSphere(this._minPoint,this._maxPoint,C,U)){if(this.Tj){for(let O=0;O<this.Tj.length;O++){this.Tj[O].intersects(C,U,K,m)}return}m?K.concat(this.entries):K.concatWithNoDuplicate(this.entries)}}intersectsRay(C,U){if(C.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Tj){for(let K=0;K<this.Tj.length;K++){this.Tj[K].intersectsRay(C,U)}return}U.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){X._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(C,U,K,O,A,e,t,z){t.Tj=new Array;const j=new m.bU((U.x-C.x)/2,(U.y-C.y)/2,(U.z-C.z)/2);for(let m=0;m<2;m++)for(let U=0;U<2;U++)for(let p=0;p<2;p++){const E=C.add(j.multiplyByFloats(m,U,p)),u=C.add(j.multiplyByFloats(m+1,U+1,p+1)),b=new X(E,u,O,A+1,e,z);b.addEntries(K),t.Tj.push(b)}}}},14033:(C,U,K)=>{"use strict";K.d(U,{c:()=>j});var m=K(12078),O=K(11827),X=K(12262),A=K(13180),e=K(12109),t=K(14027),z=K(11703);m.b.prototype.createOrUpdateSelectionOctree=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,K=this._getComponent(e.d.NAME_OCTREE);K||(K=new j(this),this.SA(K)),this.mp||(this.mp=new t.d(t.d.CreationFuncForMeshes,C,U));const m=this.getWorldExtends();return this.mp.update(m.min,m.max,this.meshes),this.mp},Object.defineProperty(m.b.prototype,"selectionOctree",{get:function(){return this.mp},enumerable:!0,configurable:!0}),X.d.prototype.createOrUpdateSubmeshesOctree=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const K=this.dC();let m=K._getComponent(e.d.NAME_OCTREE);m||(m=new j(K),K.SA(m)),this._submeshesOctree||(this._submeshesOctree=new t.d(t.d.CreationFuncForSubMeshes,C,U)),this.te(!0);const O=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(O.minimumWorld,O.maximumWorld,this.me),this._submeshesOctree};class j{constructor(C){this.name=e.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new A.c(O.bU.Zero(),new O.bU(1,1,1)),(C=C||z.c.LastCreatedScene)&&(this.QU=C,this.QU.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.QU.getActiveSubMeshCandidates=C=>this.getActiveSubMeshCandidates(C),this.QU.getCollidingSubMeshCandidates=(C,U)=>this.getCollidingSubMeshCandidates(C,U),this.QU.getIntersectingSubMeshCandidates=(C,U)=>this.getIntersectingSubMeshCandidates(C,U))}register(){this.QU.onMeshRemovedObservable.add((C=>{const U=this.QU.selectionOctree;if(void 0!==U&&null!==U){const K=U.Xp.indexOf(C);-1!==K&&U.Xp.splice(K,1)}})),this.QU.onMeshImportedObservable.add((C=>{const U=this.QU.selectionOctree;void 0!==U&&null!==U&&U.Ej(C)}))}getActiveMeshCandidates(){var C;return(null===(C=this.QU.mp)||void 0===C?void 0:C.select(this.QU.frustumPlanes))||this.QU._getDefaultMeshCandidates()}getActiveSubMeshCandidates(C){if(C._submeshesOctree&&C.useOctreeForRenderingSelection){return C._submeshesOctree.select(this.QU.frustumPlanes)}return this.QU._getDefaultSubMeshCandidates(C)}getIntersectingSubMeshCandidates(C,U){if(C._submeshesOctree&&C.useOctreeForPicking){A.c.TransformToRef(U,C.getWorldMatrix(),this._tempRay);return C._submeshesOctree.intersectsRay(this._tempRay)}return this.QU._getDefaultSubMeshCandidates(C)}getCollidingSubMeshCandidates(C,U){if(C._submeshesOctree&&C.useOctreeForCollisions){const K=U._velocityWorldLength+Math.max(U._radius.x,U._radius.y,U._radius.z);return C._submeshesOctree.intersects(U._basePointWorld,K)}return this.QU._getDefaultSubMeshCandidates(C)}rebuild(){}dispose(){}}},13180:(C,U,K)=>{"use strict";K.d(U,{c:()=>u});var m=K(12078),O=K(12292),X=K(11835),A=K(11827),e=K(11844),t=K(12169),z=K(12103),j=K(11703),p=K(12138);const E={internalPickerForMesh:void 0};class u{constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.d;this.origin=C,this.direction=U,this.length=K,this.epsilon=m}clone(){return new u(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const m=u._TmpVector3[0].Ee(C.x-K,C.y-K,C.z-K),O=u._TmpVector3[1].Ee(U.x+K,U.y+K,U.z+K);let X,A,e,t,z=0,j=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<m.x||this.origin.x>O.x)return!1}else if(X=1/this.direction.x,A=(m.x-this.origin.x)*X,e=(O.x-this.origin.x)*X,e===-1/0&&(e=1/0),A>e&&(t=A,A=e,e=t),z=Math.max(A,z),j=Math.min(e,j),z>j)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<m.y||this.origin.y>O.y)return!1}else if(X=1/this.direction.y,A=(m.y-this.origin.y)*X,e=(O.y-this.origin.y)*X,e===-1/0&&(e=1/0),A>e&&(t=A,A=e,e=t),z=Math.max(A,z),j=Math.min(e,j),z>j)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<m.z||this.origin.z>O.z)return!1}else if(X=1/this.direction.z,A=(m.z-this.origin.z)*X,e=(O.z-this.origin.z)*X,e===-1/0&&(e=1/0),A>e&&(t=A,A=e,e=t),z=Math.max(A,z),j=Math.min(e,j),z>j)return!1;return!0}intersectsBox(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(C.minimum,C.maximum,U)}intersectsSphere(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const K=C.center.x-this.origin.x,m=C.center.y-this.origin.y,O=C.center.z-this.origin.z,X=K*K+m*m+O*O,A=C.radius+U,e=A*A;if(X<=e)return!0;const t=K*this.direction.x+m*this.direction.y+O*this.direction.z;if(t<0)return!1;return X-t*t<=e}intersectsTriangle(C,U,K){const m=u._TmpVector3[0],O=u._TmpVector3[1],X=u._TmpVector3[2],e=u._TmpVector3[3],z=u._TmpVector3[4];U.subtractToRef(C,m),K.subtractToRef(C,O),A.bU.CrossToRef(this.direction,O,X);const j=A.bU.Dot(m,X);if(0===j)return null;const p=1/j;this.origin.subtractToRef(C,e);const E=A.bU.Dot(e,X)*p;if(E<-this.epsilon||E>1+this.epsilon)return null;A.bU.CrossToRef(e,m,z);const b=A.bU.Dot(this.direction,z)*p;if(b<-this.epsilon||E+b>1+this.epsilon)return null;const v=A.bU.Dot(O,z)*p;return v>this.length?null:new t.c(1-E-b,E,v)}intersectsPlane(C){let U;const K=A.bU.Dot(C.normal,this.direction);if(Math.abs(K)<9.99999997475243e-7)return null;{const m=A.bU.Dot(C.normal,this.origin);return U=(-C.d-m)/K,U<0?U<-9.99999997475243e-7?null:0:U}}intersectsAxis(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(C){case"y":{const C=(this.origin.y-U)/this.direction.y;return C>0?null:new A.bU(this.origin.x+this.direction.x*-C,U,this.origin.z+this.direction.z*-C)}case"x":{const C=(this.origin.x-U)/this.direction.x;return C>0?null:new A.bU(U,this.origin.y+this.direction.y*-C,this.origin.z+this.direction.z*-C)}case"z":{const C=(this.origin.z-U)/this.direction.z;return C>0?null:new A.bU(this.origin.x+this.direction.x*-C,this.origin.y+this.direction.y*-C,U)}default:return null}}intersectsMesh(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4?arguments[4]:void 0,X=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const e=A.TmpVectors.Matrix[0];return C.getWorldMatrix().invertToRef(e),this._tmpRay?u.TransformToRef(this,e,this._tmpRay):this._tmpRay=u.Transform(this,e),C.intersects(this._tmpRay,U,K,m,O,X)}intersectsMeshes(C,U,K){K?K.length=0:K=[];for(let m=0;m<C.length;m++){const O=this.intersectsMesh(C[m],U);O.hit&&K.push(O)}return K.sort(this._comparePickingInfo),K}_comparePickingInfo(C,U){return C.distance<U.distance?-1:C.distance>U.distance?1:0}intersectionSegment(C,U,K){const m=this.origin,O=A.TmpVectors.bU[0],X=A.TmpVectors.bU[1],e=A.TmpVectors.bU[2],t=A.TmpVectors.bU[3];U.subtractToRef(C,O),this.direction.scaleToRef(u._Rayl,e),m.addToRef(e,X),C.subtractToRef(m,t);const z=A.bU.Dot(O,O),j=A.bU.Dot(O,e),p=A.bU.Dot(e,e),E=A.bU.Dot(O,t),b=A.bU.Dot(e,t),v=z*p-j*j;let Q,V,f=v,F=v;v<u._Smallnum?(Q=0,f=1,V=b,F=p):(Q=j*b-p*E,V=z*b-j*E,Q<0?(Q=0,V=b,F=p):Q>f&&(Q=f,V=b+j,F=p)),V<0?(V=0,-E<0?Q=0:-E>z?Q=f:(Q=-E,f=z)):V>F&&(V=F,-E+j<0?Q=0:-E+j>z?Q=f:(Q=-E+j,f=z));const Z=Math.abs(Q)<u._Smallnum?0:Q/f,P=Math.abs(V)<u._Smallnum?0:V/F,H=A.TmpVectors.bU[4];e.scaleToRef(P,H);const d=A.TmpVectors.bU[5];O.scaleToRef(Z,d),d.addInPlace(t);const T=A.TmpVectors.bU[6];d.subtractToRef(H,T);return P>0&&P<=this.length&&T.lengthSquared()<K*K?d.length():-1}update(C,U,K,m,O,X,e){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){u._RayDistant||(u._RayDistant=u.Zero()),u._RayDistant.unprojectRayToRef(C,U,K,m,A.Matrix.IdentityReadOnly,X,e);const t=A.TmpVectors.Matrix[0];O.invertToRef(t),u.TransformToRef(u._RayDistant,t,this)}else this.unprojectRayToRef(C,U,K,m,O,X,e);return this}static Zero(){return new u(A.bU.Zero(),A.bU.Zero())}static CreateNew(C,U,K,m,O,X,A){return u.Zero().update(C,U,K,m,O,X,A)}static CreateNewFromTo(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.Matrix.IdentityReadOnly;const m=new u(new A.bU(0,0,0),new A.bU(0,0,0));return u.CreateFromToToRef(C,U,m,K)}static CreateFromToToRef(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.Matrix.IdentityReadOnly;K.origin.m(C);const O=U.subtractToRef(C,K.direction),X=Math.sqrt(O.x*O.x+O.y*O.y+O.z*O.z);return K.length=X,K.direction.normalize(),u.TransformToRef(K,m,K)}static Transform(C,U){const K=new u(new A.bU(0,0,0),new A.bU(0,0,0));return u.TransformToRef(C,U,K),K}static TransformToRef(C,U,K){A.bU.TransformCoordinatesToRef(C.origin,U,K.origin),A.bU.TransformNormalToRef(C.direction,U,K.direction),K.length=C.length,K.epsilon=C.epsilon;const m=K.direction,O=m.length();if(0!==O&&1!==O){const C=1/O;m.x*=C,m.y*=C,m.z*=C,K.length*=O}return K}unprojectRayToRef(C,U,K,m,O,X,e){const t=A.TmpVectors.Matrix[0];O.multiplyToRef(X,t),t.multiplyToRef(e,t),t.invert();const z=j.c.LastCreatedEngine,p=A.TmpVectors.bU[0];p.x=C/K*2-1,p.y=-(U/m*2-1),p.z=null!==z&&void 0!==z&&z.useReverseDepthBuffer?1:null!==z&&void 0!==z&&z.isNDCHalfZRange?0:-1;const E=A.TmpVectors.bU[1].Ee(p.x,p.y,1-1e-8),u=A.TmpVectors.bU[2],b=A.TmpVectors.bU[3];A.bU._UnprojectFromInvertedMatrixToRef(p,t,u),A.bU._UnprojectFromInvertedMatrixToRef(E,t,b),this.origin.m(u),b.subtractToRef(u,this.direction),this.direction.normalize()}}function b(C,U,K,m,O){let X=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=u.Zero();return v(C,U,K,m,A,O,X),A}function v(C,U,K,m,O,X){let e=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const z=C.getEngine();if(!X&&!(X=C.activeCamera))return C;const j=X.viewport,p=z.getRenderHeight(),{x:E,y:u,width:b,height:v}=j.toGlobal(z.getRenderWidth(),p),Q=1/z.getHardwareScalingLevel();return U=U*Q-E,K=K*Q-(p-u-v),O.update(U,K,b,v,m||A.Matrix.IdentityReadOnly,e?A.Matrix.IdentityReadOnly:X.getViewMatrix(),X.getProjectionMatrix(),t),C}function Q(C,U,K,m,O){if(!z.b)return C;const X=C.getEngine();if(!O&&!(O=C.activeCamera))throw new Error("Active camera not set");const e=O.viewport,t=X.getRenderHeight(),{x:j,y:p,width:E,height:u}=e.toGlobal(X.getRenderWidth(),t),b=A.Matrix.Identity(),v=1/X.getHardwareScalingLevel();return U=U*v-j,K=K*v-(t-p-u),m.update(U,K,E,u,b,b,O.getProjectionMatrix()),C}function V(C,U,K,m,O,X,A,e){const t=U(m,K.enableDistantPicking),z=K.intersects(t,O,A,X,m,e);return z&&z.hit?!O&&null!=C&&z.distance>=C.distance?null:z:null}function f(C,U,K,m,O,X){let e=null;const t=!!(C.activeCameras&&C.activeCameras.length>1&&C.cameraToUseForPointers!==C.activeCamera),j=C.cameraToUseForPointers||C.activeCamera,p=E.internalPickerForMesh||V;for(let z=0;z<C.meshes.length;z++){const E=C.meshes[z];if(K){if(!K(E,-1))continue}else if(!E.isEnabled()||!E.isVisible||!E.xt)continue;const u=t&&E.isWorldMatrixCameraDependent(),b=E.te(u,j);if(E.hasThinInstances&&E.rz){const C=p(e,U,E,b,!0,!0,X);if(C){if(O)return C;const t=A.TmpVectors.Matrix[1],z=E.thinInstanceGetWorldMatrices();for(let C=0;C<z.length;C++){if(K&&!K(E,C))continue;z[C].multiplyToRef(b,t);const A=p(e,U,E,t,m,O,X,!0);if(A&&(e=A,e.thinInstanceIndex=C,m))return e}}}else{const C=p(e,U,E,b,m,O,X);if(C&&(e=C,m))return e}}return e||new z.b}function F(C,U,K,m){if(!z.b)return null;const O=[],X=!!(C.activeCameras&&C.activeCameras.length>1&&C.cameraToUseForPointers!==C.activeCamera),e=C.cameraToUseForPointers||C.activeCamera,t=E.internalPickerForMesh||V;for(let z=0;z<C.meshes.length;z++){const j=C.meshes[z];if(K){if(!K(j,-1))continue}else if(!j.isEnabled()||!j.isVisible||!j.xt)continue;const p=X&&j.isWorldMatrixCameraDependent(),E=j.te(p,e);if(j.hasThinInstances&&j.rz){if(t(null,U,j,E,!0,!0,m)){const C=A.TmpVectors.Matrix[1],X=j.thinInstanceGetWorldMatrices();for(let A=0;A<X.length;A++){if(K&&!K(j,A))continue;X[A].multiplyToRef(E,C);const e=t(null,U,j,C,!1,!1,m,!0);e&&(e.thinInstanceIndex=A,O.push(e))}}}else{const C=t(null,U,j,E,!1,!1,m);C&&O.push(C)}}return O}function Z(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,m=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0;m||(m=C.getWorldMatrix()),U.length=K,O?U.origin.m(O):U.origin.m(C.position);const X=A.TmpVectors.bU[2];X.set(0,0,C._scene.useRightHandedSystem?-1:1);const e=A.TmpVectors.bU[3];return A.bU.TransformNormalToRef(X,m,e),A.bU.NormalizeToRef(e,U.direction),U}var P,H;u._TmpVector3=(0,e.e)(6,A.bU.Zero),u._RayDistant=u.Zero(),u._Smallnum=1e-8,u._Rayl=1e9,P=m.b,(H=O.b)&&(H.prototype.getForwardRay=function(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,U=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;return Z(this,new u(A.bU.Zero(),A.bU.Zero(),C),C,U,K)},H.prototype.getForwardRayToRef=function(C){return Z(this,C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),P&&(p.e._IsPickingAvailable=!0,P.prototype.createPickingRay=function(C,U,K,m){return b(this,C,U,K,m,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),m.b.prototype.createPickingRayToRef=function(C,U,K,m,O){return v(this,C,U,K,m,O,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},m.b.prototype.createPickingRayInCameraSpace=function(C,U,K){return function(C,U,K,m){const O=u.Zero();return Q(C,U,K,O,m),O}(this,C,U,K)},m.b.prototype.createPickingRayInCameraSpaceToRef=function(C,U,K,m){return Q(this,C,U,K,m)},m.b.prototype.pickWithBoundingInfo=function(C,U,K,m,O){return function(C,U,K,m,O,X){if(!z.b)return null;const e=f(C,(m=>(C._tempPickingRay||(C._tempPickingRay=u.Zero()),v(C,U,K,m,C._tempPickingRay,X||null),C._tempPickingRay)),m,O,!0);return e&&(e.ray=b(C,U,K,A.Matrix.Identity(),X||null)),e}(this,C,U,K,m,O)},m.b.prototype.EK=function(C,U,K,m,O,X){return function(C,U,K,m,O,X,e){const t=f(C,((m,O)=>(C._tempPickingRay||(C._tempPickingRay=u.Zero()),v(C,U,K,m,C._tempPickingRay,X||null,!1,O),C._tempPickingRay)),m,O,!1,e);return t&&(t.ray=b(C,U,K,A.Matrix.Identity(),X||null)),t}(this,C,U,K,m,O,X)},m.b.prototype.pickWithRay=function(C,U,K,m){return function(C,U,K,m,O){const X=f(C,(K=>(C._pickWithRayInverseMatrix||(C._pickWithRayInverseMatrix=A.Matrix.Identity()),K.invertToRef(C._pickWithRayInverseMatrix),C._cachedRayForTransform||(C._cachedRayForTransform=u.Zero()),u.TransformToRef(U,C._pickWithRayInverseMatrix,C._cachedRayForTransform),C._cachedRayForTransform)),K,m,!1,O);return X&&(X.ray=U),X}(this,C,U,K,m)},m.b.prototype.multiPick=function(C,U,K,m,O){return function(C,U,K,m,O,X){return F(C,(m=>b(C,U,K,m,O||null)),m,X)}(this,C,U,K,m,O)},m.b.prototype.multiPickWithRay=function(C,U,K){return function(C,U,K,m){return F(C,(K=>(C._pickWithRayInverseMatrix||(C._pickWithRayInverseMatrix=A.Matrix.Identity()),K.invertToRef(C._pickWithRayInverseMatrix),C._cachedRayForTransform||(C._cachedRayForTransform=u.Zero()),u.TransformToRef(U,C._pickWithRayInverseMatrix,C._cachedRayForTransform),C._cachedRayForTransform)),K,m)}(this,C,U,K)}},13483:(C,U,K)=>{"use strict";var m=K(11773),O=K(11679),X=K(11709),A=K(11793),e=K(11735),t=K(11779);e.b.prototype._partialLoadFile=function(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(C,(C=>{K[U]=C,K._internalCount++,6===K._internalCount&&m(K)}),void 0,void 0,!0,((C,U)=>{O&&C&&O(C.status+" "+C.statusText,U)}))},e.b.prototype._cascadeLoadFiles=function(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const O=[];O._internalCount=0;for(let X=0;X<6;X++)this._partialLoadFile(K[X],X,O,U,m)},e.b.prototype._cascadeLoadImgs=function(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5?arguments[5]:void 0;const A=[];A._internalCount=0;for(let e=0;e<6;e++)this._partialLoadImg(m[e],e,A,C,U,K,O,X)},e.b.prototype._partialLoadImg=function(C,U,K,m,O,e){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7?arguments[7]:void 0;const j=(0,A.d)();(0,X.r)(C,(C=>{K[U]=C,K._internalCount++,m&&m.removePendingData(j),6===K._internalCount&&e&&e(O,K)}),((C,U)=>{m&&m.removePendingData(j),t&&t(C,U)}),m?m.offlineProvider:null,z),m&&m.addPendingData(j)},e.b.prototype.createCubeTextureBase=function(C,U,K,X){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,v=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,Q=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,V=arguments.length>14&&void 0!==arguments[14]&&arguments[14],f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const F=b||new m.d(this,7);F.isCube=!0,F.url=C,F.generateMipMaps=!X,F._lodGenerationScale=E,F._lodGenerationOffset=u,F._useSRGBBuffer=!!V&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!X),F!==b&&(F.label=C.substring(0,60)),this._doNotHandleContextLost||(F._extension=j,F._files=K,F._buffer=f);const Z=C;this._transformTextureUrl&&!b&&(C=this._transformTextureUrl(C));const P=j??function(C){const U=C.split("?")[0],K=U.lastIndexOf(".");return K>-1?U.substring(K).toLowerCase():""}(C),H=(0,t.b)(P),d=(C,U)=>{F.dispose(),e?e(C,U):C&&O.d.Warn(C)},T=(m,e)=>{C===Z?m&&d(m.status+" "+m.statusText,e):(O.d.Warn(`Failed to load ${C}, falling back to the ${Z}`),this.createCubeTextureBase(Z,U,K,!!X,A,d,z,j,p,E,u,F,v,Q,V,f))};if(H)H.then((m=>{const O=C=>{v&&v(F,C),m.loadCubeData(C,F,p,A,((C,U)=>{d(C,U)}))};f?O(f):K&&6===K.length?m.supportCascades?this._cascadeLoadFiles(U,(C=>O(C.map((C=>new Uint8Array(C))))),K,d):d("Textures type does not support cascades."):this._loadFile(C,(C=>O(new Uint8Array(C))),void 0,void 0,!0,T)}));else{if(!K||0===K.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(U,F,((C,U)=>{Q&&Q(C,U)}),K,d)}return this._internalTexturesCache.push(F),F}},14042:(C,U,K)=>{"use strict";K(11679);var m=K(11958);K(11773),K(11909),K(11764),K(12008),K(11964);m.c},13508:(C,U,K)=>{"use strict";K.d(U,{d:()=>O});var m=K(11789);class O{constructor(C){this.value=this._toInt(C)}_toInt(C){return 0|C}add(C){return new O(this.value+C.value)}vU(C){return new O(this.value-C.value)}multiply(C){return new O(Math.imul(this.value,C.value))}divide(C){return new O(this.value/C.value)}getClassName(){return O.ClassName}equals(C){return this.value===C.value}static FromValue(C){return new O(C)}toString(){return this.value.toString()}}O.ClassName="FlowGraphInteger",(0,m.h)("FlowGraphInteger",O)},13517:(C,U,K)=>{"use strict";K.d(U,{e:()=>O,g:()=>X});var m=K(11827);class O{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.qA=C}get m(){return this.qA}transformVector(C){return this.transformVectorToRef(C,new m.Vector2)}transformVectorToRef(C,U){return U.x=C.x*this.qA[0]+C.y*this.qA[1],U.y=C.x*this.qA[2]+C.y*this.qA[3],U}Oe(){return this.toArray()}toArray(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<4;U++)C[U]=this.qA[U];return C}uK(C){for(let U=0;U<4;U++)this.qA[U]=C[U];return this}multiplyToRef(C,U){const K=C.qA,m=this.qA,O=U.qA;return O[0]=K[0]*m[0]+K[1]*m[2],O[1]=K[0]*m[1]+K[1]*m[3],O[2]=K[2]*m[0]+K[3]*m[2],O[3]=K[2]*m[1]+K[3]*m[3],U}multiply(C){return this.multiplyToRef(C,new O)}divideToRef(C,U){const K=this.qA,m=C.qA,O=U.qA;return O[0]=K[0]/m[0],O[1]=K[1]/m[1],O[2]=K[2]/m[2],O[3]=K[3]/m[3],U}divide(C){return this.divideToRef(C,new O)}addToRef(C,U){const K=this.qA,m=C.m,O=U.m;return O[0]=K[0]+m[0],O[1]=K[1]+m[1],O[2]=K[2]+m[2],O[3]=K[3]+m[3],U}add(C){return this.addToRef(C,new O)}subtractToRef(C,U){const K=this.qA,m=C.m,O=U.m;return O[0]=K[0]-m[0],O[1]=K[1]-m[1],O[2]=K[2]-m[2],O[3]=K[3]-m[3],U}vU(C){return this.subtractToRef(C,new O)}transpose(){const C=this.qA;return new O([C[0],C[2],C[1],C[3]])}determinant(){const C=this.qA;return C[0]*C[3]-C[1]*C[2]}inverse(){const C=this.determinant();if(0===C)throw new Error("Matrix is not invertible");const U=this.qA,K=1/C;return new O([U[3]*K,-U[1]*K,-U[2]*K,U[0]*K])}equals(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const K=this.qA,m=C.m;return 0===U?K[0]===m[0]&&K[1]===m[1]&&K[2]===m[2]&&K[3]===m[3]:Math.abs(K[0]-m[0])<U&&Math.abs(K[1]-m[1])<U&&Math.abs(K[2]-m[2])<U&&Math.abs(K[3]-m[3])<U}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.qA.join(", ")})`}}class X{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.qA=C}get m(){return this.qA}transformVector(C){return this.transformVectorToRef(C,new m.bU)}transformVectorToRef(C,U){const K=this.qA;return U.x=C.x*K[0]+C.y*K[1]+C.z*K[2],U.y=C.x*K[3]+C.y*K[4]+C.z*K[5],U.z=C.x*K[6]+C.y*K[7]+C.z*K[8],U}multiplyToRef(C,U){const K=C.qA,m=this.qA,O=U.m;return O[0]=K[0]*m[0]+K[1]*m[3]+K[2]*m[6],O[1]=K[0]*m[1]+K[1]*m[4]+K[2]*m[7],O[2]=K[0]*m[2]+K[1]*m[5]+K[2]*m[8],O[3]=K[3]*m[0]+K[4]*m[3]+K[5]*m[6],O[4]=K[3]*m[1]+K[4]*m[4]+K[5]*m[7],O[5]=K[3]*m[2]+K[4]*m[5]+K[5]*m[8],O[6]=K[6]*m[0]+K[7]*m[3]+K[8]*m[6],O[7]=K[6]*m[1]+K[7]*m[4]+K[8]*m[7],O[8]=K[6]*m[2]+K[7]*m[5]+K[8]*m[8],U}multiply(C){return this.multiplyToRef(C,new X)}divideToRef(C,U){const K=this.qA,m=C.m,O=U.m;return O[0]=K[0]/m[0],O[1]=K[1]/m[1],O[2]=K[2]/m[2],O[3]=K[3]/m[3],O[4]=K[4]/m[4],O[5]=K[5]/m[5],O[6]=K[6]/m[6],O[7]=K[7]/m[7],O[8]=K[8]/m[8],U}divide(C){return this.divideToRef(C,new X)}addToRef(C,U){const K=this.qA,m=C.m,O=U.m;return O[0]=K[0]+m[0],O[1]=K[1]+m[1],O[2]=K[2]+m[2],O[3]=K[3]+m[3],O[4]=K[4]+m[4],O[5]=K[5]+m[5],O[6]=K[6]+m[6],O[7]=K[7]+m[7],O[8]=K[8]+m[8],U}add(C){return this.addToRef(C,new X)}subtractToRef(C,U){const K=this.qA,m=C.m,O=U.m;return O[0]=K[0]-m[0],O[1]=K[1]-m[1],O[2]=K[2]-m[2],O[3]=K[3]-m[3],O[4]=K[4]-m[4],O[5]=K[5]-m[5],O[6]=K[6]-m[6],O[7]=K[7]-m[7],O[8]=K[8]-m[8],U}vU(C){return this.subtractToRef(C,new X)}toArray(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let U=0;U<9;U++)C[U]=this.qA[U];return C}Oe(){return this.toArray()}uK(C){for(let U=0;U<9;U++)this.qA[U]=C[U];return this}transpose(){const C=this.qA;return new X([C[0],C[3],C[6],C[1],C[4],C[7],C[2],C[5],C[8]])}determinant(){const C=this.qA;return C[0]*(C[4]*C[8]-C[5]*C[7])-C[1]*(C[3]*C[8]-C[5]*C[6])+C[2]*(C[3]*C[7]-C[4]*C[6])}inverse(){const C=this.determinant();if(0===C)throw new Error("Matrix is not invertible");const U=this.qA,K=1/C;return new X([(U[4]*U[8]-U[5]*U[7])*K,(U[2]*U[7]-U[1]*U[8])*K,(U[1]*U[5]-U[2]*U[4])*K,(U[5]*U[6]-U[3]*U[8])*K,(U[0]*U[8]-U[2]*U[6])*K,(U[2]*U[3]-U[0]*U[5])*K,(U[3]*U[7]-U[4]*U[6])*K,(U[1]*U[6]-U[0]*U[7])*K,(U[0]*U[4]-U[1]*U[3])*K])}equals(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const K=this.qA,m=C.m;return 0===U?K[0]===m[0]&&K[1]===m[1]&&K[2]===m[2]&&K[3]===m[3]&&K[4]===m[4]&&K[5]===m[5]&&K[6]===m[6]&&K[7]===m[7]&&K[8]===m[8]:Math.abs(K[0]-m[0])<U&&Math.abs(K[1]-m[1])<U&&Math.abs(K[2]-m[2])<U&&Math.abs(K[3]-m[3])<U&&Math.abs(K[4]-m[4])<U&&Math.abs(K[5]-m[5])<U&&Math.abs(K[6]-m[6])<U&&Math.abs(K[7]-m[7])<U&&Math.abs(K[8]-m[8])<U}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.qA.join(", ")})`}}},13522:(C,U,K)=>{"use strict";var m;function O(C,U,K,m){switch(U){case"Animation":return m?C.animations.find((C=>C.uniqueId===K))??null:C.animations[K]??null;case"AnimationGroup":return m?C.animationGroups.find((C=>C.uniqueId===K))??null:C.animationGroups[K]??null;case"Mesh":return m?C.meshes.find((C=>C.uniqueId===K))??null:C.meshes[K]??null;case"Material":return m?C.materials.find((C=>C.uniqueId===K))??null:C.materials[K]??null;case"Zj":return m?C.cameras.find((C=>C.uniqueId===K))??null:C.cameras[K]??null;case"Light":return m?C.lights.find((C=>C.uniqueId===K))??null:C.lights[K]??null;default:return null}}K.d(U,{d:()=>O}),function(C){C.Animation="Animation",C.AnimationGroup="AnimationGroup",C.Mesh="Mesh",C.Material="Material",C.Zj="Zj",C.Light="Light"}(m||(m={}))},13559:(C,U,K)=>{"use strict";K.d(U,{c:()=>O});var m=K(13564);class O extends m.c{constructor(C,U){if(super(C),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),U)for(const K of U)this._eventsSignalOutputs[K]=this._registerSignalOutput(K+"Event")}_executeOnTick(C){}_startPendingTasks(C){C._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(C),this._resetAfterCanceled(C)),this._preparePendingTasks(C),C._addPendingBlock(this),this.out._activateSignal(C),C._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(C){C._deleteExecutionVariable(this,"_initialized"),C._removePendingBlock(this)}}},13539:(C,U,K)=>{"use strict";K.d(U,{e:()=>z});var m=K(11793),O=K(11789),X=K(13543),A=K(11663),e=K(13502);class t extends X.b{constructor(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:m.defaultValue,X=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(C,U,K),this.richType=m,this._defaultValue=O,this._optional=X,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new A.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(C){this._isDisabled!==C&&(this._isDisabled=C,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(C,U){U._getConnectionValue(this)!==C&&(U._setConnectionValue(this,C),this.onValueChangedObservable.notifyObservers(C))}resetToDefaultValue(C){C._setConnectionValue(this,this._defaultValue)}connectTo(C){this._isDisabled||super.connectTo(C)}_getValueOrDefault(C){const U=C._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(U):U}getValue(C){if(1===this.connectionType){C._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(C);const U=this._getValueOrDefault(C);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}const U=this.isConnected()?this._connectedPoint[0].getValue(C):this._getValueOrDefault(C);return this._lastValue=U,this.richType.typeTransformer?this.richType.typeTransformer(U):U}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(C),C.richType={},this.richType.serialize(C.richType),C.optional=this._optional,(0,e.f)("defaultValue",this._defaultValue,C)}}(0,O.h)("FlowGraphDataConnection",t);class z{constructor(C){var U;this.config=C,this.uniqueId=(0,m.d)(),this.name=(null===(U=this.config)||void 0===U?void 0:U.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(C){}registerDataInput(C,U,K){const m=new t(C,0,this,U,K);return this.dataInputs.push(m),m}registerDataOutput(C,U,K){const m=new t(C,1,this,U,K);return this.dataOutputs.push(m),m}getDataInput(C){return this.dataInputs.find((U=>U.name===C))}getDataOutput(C){return this.dataOutputs.find((U=>U.name===C))}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.f;if(C.uniqueId=this.uniqueId,C.config={},this.config){const K=this.config,m=Object.keys(K);for(const O of m)U(O,K[O],C.config)}C.dataInputs=[],C.dataOutputs=[],C.className=this.getClassName();for(const K of this.dataInputs){const U={};K.serialize(U),C.dataInputs.push(U)}for(const K of this.dataOutputs){const U={};K.serialize(U),C.dataOutputs.push(U)}}deserialize(C){}_log(C,U,K){var m;null===(m=C.logger)||void 0===m||m.addLogItem({action:U,bK:K,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13543:(C,U,K)=>{"use strict";K.d(U,{b:()=>X});var m,O=K(11793);!function(C){C[C.Input=0]="Input",C[C.Output=1]="Output"}(m||(m={}));class X{constructor(C,U,K){this._ownerBlock=K,this._connectedPoint=[],this.uniqueId=(0,O.d)(),this.connectedPointIds=[],this.name=C,this._connectionType=U}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(C){if(this._connectionType===C._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||C._isSingularConnection()&&C._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(C),C._connectedPoint.push(this)}disconnectFrom(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const K=this._connectedPoint.indexOf(C),m=C._connectedPoint.indexOf(this);-1!==K&&-1!==m&&(U&&this._connectedPoint.splice(K,1),C._connectedPoint.splice(m,1))}disconnectFromAll(){for(const C of this._connectedPoint)this.disconnectFrom(C,!1);this._connectedPoint.length=0}dispose(){for(const C of this._connectedPoint)this.disconnectFrom(C)}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};C.uniqueId=this.uniqueId,C.name=this.name,C._connectionType=this._connectionType,C.connectedPointIds=[],C.className=this.getClassName();for(const U of this._connectedPoint)C.connectedPointIds.push(U.uniqueId)}getClassName(){return"FGConnection"}deserialize(C){this.uniqueId=C.uniqueId,this.name=C.name,this._connectionType=C._connectionType,this.connectedPointIds=C.connectedPointIds}}},13495:(C,U,K)=>{"use strict";K.d(U,{d:()=>F});var m,O=K(11663),X=K(11810),A=K(11818),e=K(11793),t=K(13502),z=K(13522),j=K(11679);!function(C){C.ExecuteBlock="ExecuteBlock",C.ExecuteEvent="ExecuteEvent",C.TriggerConnection="TriggerConnection",C.ContextVariableSet="ContextVariableSet",C.GlobalVariableSet="GlobalVariableSet",C.GlobalVariableDelete="GlobalVariableDelete",C.GlobalVariableGet="GlobalVariableGet",C.AddConnection="AddConnection",C.GetConnectionValue="GetConnectionValue",C.SetConnectionValue="SetConnectionValue",C.ActivateSignal="ActivateSignal",C.ContextVariableGet="ContextVariableGet"}(m||(m={}));class p{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(C){if(C.time||(C.time=Date.now()),this.log.push(C),this.logToConsole){var U;const K=null===(U=C.bK)||void 0===U?void 0:U.value;"object"===typeof K&&K.getClassName?j.d.Log(`[FGLog] ${C.className}:${C.uniqueId.split("-")[0]} ${C.action} - ${JSON.stringify(K.getClassName())}: ${K.toString()}`):j.d.Log(`[FGLog] ${C.className}:${C.uniqueId.split("-")[0]} ${C.action} - ${JSON.stringify(C.bK)}`)}}getItemsOfType(C){return this.log.filter((U=>U.action===C))}}class E{get enableLogging(){return this._enableLogging}set enableLogging(C){this._enableLogging!==C&&(this._enableLogging=C,this._enableLogging?(this.logger=new p,this.logger.logToConsole=!0):this.logger=null)}constructor(C){this.uniqueId=(0,e.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new O.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=C,this.assetsContext=C.assetsContext??C.QU}hasVariable(C){return C in this._userVariables}setVariable(C,U){var K;this._userVariables[C]=U,null===(K=this.logger)||void 0===K||K.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",bK:{name:C,value:U}})}getAsset(C,U){return(0,z.d)(this.assetsContext,C,U)}getVariable(C){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",bK:{name:C,value:this._userVariables[C]}}),this._userVariables[C]}get userVariables(){return this._userVariables}dC(){return this._configuration.QU}_getUniqueIdPrefixedName(C,U){return`${C.uniqueId}_${U}`}_getGlobalContextVariable(C,U){var K;return null===(K=this.logger)||void 0===K||K.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",bK:{name:C,defaultValue:U,possibleValue:this._globalContextVariables[C]}}),this._hasGlobalContextVariable(C)?this._globalContextVariables[C]:U}_setGlobalContextVariable(C,U){var K;null===(K=this.logger)||void 0===K||K.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",bK:{name:C,value:U}}),this._globalContextVariables[C]=U}_deleteGlobalContextVariable(C){var U;null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",bK:{name:C}}),delete this._globalContextVariables[C]}_hasGlobalContextVariable(C){return C in this._globalContextVariables}_setExecutionVariable(C,U,K){this._executionVariables[this._getUniqueIdPrefixedName(C,U)]=K}_getExecutionVariable(C,U,K){return this._hasExecutionVariable(C,U)?this._executionVariables[this._getUniqueIdPrefixedName(C,U)]:K}_deleteExecutionVariable(C,U){delete this._executionVariables[this._getUniqueIdPrefixedName(C,U)]}_hasExecutionVariable(C,U){return this._getUniqueIdPrefixedName(C,U)in this._executionVariables}_hasConnectionValue(C){return C.uniqueId in this._connectionValues}_setConnectionValue(C,U){var K;this._connectionValues[C.uniqueId]=U,null===(K=this.logger)||void 0===K||K.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",bK:{connectionPointId:C.uniqueId,value:U}})}_setConnectionValueByKey(C,U){this._connectionValues[C]=U}_getConnectionValue(C){var U;return null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",bK:{connectionPointId:C.uniqueId,value:this._connectionValues[C.uniqueId]}}),this._connectionValues[C.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(C){this._pendingBlocks.includes(C)||(this._pendingBlocks.push(C),this._pendingBlocks.sort(((C,U)=>C.priority-U.priority)))}_removePendingBlock(C){const U=this._pendingBlocks.indexOf(C);-1!==U&&this._pendingBlocks.splice(U,1)}_clearPendingBlocks(){for(const C of this._pendingBlocks)C._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(C){var U;this.onNodeExecutedObservable.notifyObservers(C),null===(U=this.logger)||void 0===U||U.addLogItem({time:Date.now(),className:C.getClassName(),uniqueId:C.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(C){this._setGlobalContextVariable("timeSinceStart",C.timeSinceStart),this._setGlobalContextVariable("deltaTime",C.deltaTime);for(const K of this._pendingBlocks){var U;null===(U=K._executeOnTick)||void 0===U||U.call(K,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.f;C.uniqueId=this.uniqueId,C._userVariables={};for(const m in this._userVariables)U(m,this._userVariables[m],C._userVariables);C._connectionValues={};for(const m in this._connectionValues)U(m,this._connectionValues[m],C._connectionValues);var K;this.assetsContext!==this.dC()&&(C._assetsContext={meshes:this.assetsContext.meshes.map((C=>C.id)),materials:this.assetsContext.materials.map((C=>C.id)),textures:this.assetsContext.textures.map((C=>C.name)),animations:this.assetsContext.animations.map((C=>C.name)),lights:this.assetsContext.lights.map((C=>C.id)),cameras:this.assetsContext.cameras.map((C=>C.id)),NE:null===(K=this.assetsContext.NE)||void 0===K?void 0:K.map((C=>C.name)),skeletons:this.assetsContext.skeletons.map((C=>C.id)),AE:this.assetsContext.AE.map((C=>C.name)),geometries:this.assetsContext.geometries.map((C=>C.id)),multiMaterials:this.assetsContext.multiMaterials.map((C=>C.id)),transformNodes:this.assetsContext.transformNodes.map((C=>C.id))})}getClassName(){return"FlowGraphContext"}}(0,X.d)([(0,A.O)()],E.prototype,"uniqueId",void 0);var u=K(13531),b=K(12116);class v{constructor(C){this.onEventTriggeredObservable=new O.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=C,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.RA.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const C=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",bK:{timeSinceStart:this._startingTime,deltaTime:C}}),this._startingTime+=C})),this._meshPickedObserver=this._scene.onPointerObservable.add((C=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",bK:C})}),b.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((C=>{const U=C.pointerId,K=C.mesh,m=this._pointerUnderMeshState[U];!m&&K?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",bK:{pointerId:U,mesh:K}}):m&&!K?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",bK:{pointerId:U,mesh:m}}):m&&K&&m!==K&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",bK:{pointerId:U,mesh:m,over:K}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",bK:{pointerId:U,mesh:K,out:m}})),this._pointerUnderMeshState[U]=K}),b.b.POINTERMOVE)}dispose(){var C,U,K,m,O;null===(C=this._sceneDisposeObserver)||void 0===C||C.remove(),null===(U=this._sceneReadyObserver)||void 0===U||U.remove(),null===(K=this._sceneOnBeforeRenderObserver)||void 0===K||K.remove(),null===(m=this._meshPickedObserver)||void 0===m||m.remove(),null===(O=this._meshUnderPointerObserver)||void 0===O||O.remove(),this.onEventTriggeredObservable.clear()}}var Q,V=K(13552);!function(C){C[C.Stopped=0]="Stopped",C[C.Started=1]="Started"}(Q||(Q={}));class f{get state(){return this._state}set state(C){this._state=C,this.onStateChangedObservable.notifyObservers(C)}constructor(C){this.onStateChangedObservable=new O.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=C.QU,this._sceneEventCoordinator=new v(this._scene),this._coordinator=C.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((C=>{for(const U of this._executionContexts){const K=this._getContextualOrder(C.type,U);for(const m of K)if(!m._executeEvent(U,C.bK))break}switch(C.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const U of this._executionContexts)U._notifyOnTick(C.bK);break;case"SceneDispose":this.dispose()}}))}createContext(){const C=new E({QU:this._scene,coordinator:this._coordinator});return this._executionContexts.push(C),C}getContext(C){return this._executionContexts[C]}addEventBlock(C){if("PointerOver"!==C.type&&"PointerOut"!==C.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==C.type&&this._eventBlocks[C.type].push(C),1===this.state)for(const U of this._executionContexts)C._startPendingTasks(U);else this.onStateChangedObservable.addOnce((U=>{if(1===U)for(const K of this._executionContexts)C._startPendingTasks(K)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((C=>{1===C&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const C of this._executionContexts)for(const U in this._eventBlocks){const K=this._getContextualOrder(U,C);for(const U of K)U._startPendingTasks(C)}}_getContextualOrder(C,U){const K=this._eventBlocks[C].sort(((C,U)=>U.initPriority-C.initPriority));if("MeshPick"===C){const C=[];for(const m of K){const O=m.asset.getValue(U);let X=0;for(;X<K.length;X++){const C=K[X].asset.getValue(U);if(O&&C&&(0,V.m)(O,C))break}C.splice(X,0,m)}return C}return K}dispose(){var C;if(0!==this.state){this.state=0;for(const C of this._executionContexts)C._clearPendingBlocks();this._executionContexts.length=0;for(const C in this._eventBlocks)this._eventBlocks[C].length=0;null===(C=this._eventObserver)||void 0===C||C.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(C){const U=[],K=new Set;for(const m in this._eventBlocks)for(const C of this._eventBlocks[m])U.push(C),K.add(C.uniqueId);for(;U.length>0;){const m=U.pop();C(m);for(const C of m.dataInputs)for(const m of C._connectedPoint)K.has(m._ownerBlock.uniqueId)||(U.push(m._ownerBlock),K.add(m._ownerBlock.uniqueId));if(m instanceof u.e)for(const C of m.signalOutputs)for(const m of C._connectedPoint)K.has(m._ownerBlock.uniqueId)||(U.push(m._ownerBlock),K.add(m._ownerBlock.uniqueId))}}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},U=arguments.length>1?arguments[1]:void 0;C.allBlocks=[],this.visitAllBlocks((U=>{const K={};U.serialize(K),C.allBlocks.push(K)})),C.executionContexts=[];for(const K of this._executionContexts){const m={};K.serialize(m,U),C.executionContexts.push(m)}}}class F{constructor(C){this.config=C,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.QU.RA.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.QU.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const C=this._executeOnNextFrame.slice(0);if(C.length)for(const U of C){this.notifyCustomEvent(U.id,U.data,!1);const C=this._executeOnNextFrame.findIndex((C=>C.uniqueId===U.uniqueId));-1!==C&&this._executeOnNextFrame.splice(C,1)}}));(F.SceneCoordinators.get(this.config.QU)??[]).push(this)}createGraph(){const C=new f({QU:this.config.QU,coordinator:this});return this._flowGraphs.push(C),C}removeGraph(C){const U=this._flowGraphs.indexOf(C);-1!==U&&(C.dispose(),this._flowGraphs.splice(U,1))}start(){for(const C of this._flowGraphs)C.start()}dispose(){var C,U;for(const O of this._flowGraphs)O.dispose();this._flowGraphs.length=0,null===(C=this._disposeObserver)||void 0===C||C.remove(),null===(U=this._onBeforeRenderObserver)||void 0===U||U.remove();const K=F.SceneCoordinators.get(this.config.QU)??[],m=K.indexOf(this);-1!==m&&K.splice(m,1)}serialize(C,U){C._flowGraphs=[];for(const K of this._flowGraphs){const m={};K.serialize(m,U),C._flowGraphs.push(m)}C.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(C){let U=this._customEventsMap.get(C);return U||(U=new O.b,this._customEventsMap.set(C,U)),U}notifyCustomEvent(C,U){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:C,data:U,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(C)){const U=this._eventExecutionCounter.get(C);if(this._eventExecutionCounter.set(C,U+1),U>=F.MaxEventTypeExecutionPerFrame)return void(U===F.MaxEventTypeExecutionPerFrame&&j.d.Warn(`FlowGraphCoordinator: Too many executions of event "${C}".`))}else this._eventExecutionCounter.set(C,1);const K=this._customEventsMap.get(C);K&&K.notifyObservers(U)}}F.MaxEventsPerType=30,F.MaxEventTypeExecutionPerFrame=30,F.SceneCoordinators=new Map},13556:(C,U,K)=>{"use strict";K.d(U,{e:()=>O});var m=K(13559);class O extends m.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(C){C._notifyExecuteNode(this),this.done._activateSignal(C)}}},13531:(C,U,K)=>{"use strict";K.d(U,{e:()=>e});var m=K(13539),O=K(13543),X=K(11789);class A extends O.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(C){super.connectTo(C),this._connectedPoint.sort(((C,U)=>U.priority-C.priority))}_activateSignal(C){var U;if(null===(U=C.logger)||void 0===U||U.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,bK:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)C._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(C,this),C._increaseExecutionId();else for(const K of this._connectedPoint)K._activateSignal(C)}}(0,X.h)("FlowGraphSignalConnection",A);class e extends m.e{constructor(C){super(C),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(C){const U=new A(C,0,this);return this.signalInputs.push(U),U}_registerSignalOutput(C){const U=new A(C,1,this);return this.signalOutputs.push(U),U}_unregisterSignalInput(C){const U=this.signalInputs.findIndex((U=>U.name===C));-1!==U&&(this.signalInputs[U].dispose(),this.signalInputs.splice(U,1))}_unregisterSignalOutput(C){const U=this.signalOutputs.findIndex((U=>U.name===C));-1!==U&&(this.signalOutputs[U].dispose(),this.signalOutputs.splice(U,1))}_reportError(C,U){this.error.bK="string"===typeof U?new Error(U):U,this.error._activateSignal(C)}getSignalInput(C){return this.signalInputs.find((U=>U.name===C))}getSignalOutput(C){return this.signalOutputs.find((U=>U.name===C))}serialize(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(C),C.signalInputs=[],C.signalOutputs=[];for(const U of this.signalInputs){const K={};U.serialize(K),C.signalInputs.push(K)}for(const U of this.signalOutputs){const K={};U.serialize(K),C.signalOutputs.push(K)}}deserialize(C){for(let U=0;U<C.signalInputs.length;U++){const K=this.getSignalInput(C.signalInputs[U].name);if(!K)throw new Error("Could not find signal input with name "+C.signalInputs[U].name+" in block "+C.className);K.deserialize(C.signalInputs[U])}for(let U=0;U<C.signalOutputs.length;U++){const K=this.getSignalOutput(C.signalOutputs[U].name);if(!K)throw new Error("Could not find signal output with name "+C.signalOutputs[U].name+" in block "+C.className);K.deserialize(C.signalOutputs[U])}}getClassName(){return"FlowGraphExecutionBlock"}}},13564:(C,U,K)=>{"use strict";K.d(U,{c:()=>O});var m=K(13531);class O extends m.e{constructor(C){super(C),this.out=this._registerSignalOutput("out")}}},13514:(C,U,K)=>{"use strict";K.d(U,{A:()=>u,E:()=>b,F:()=>v,J:()=>y,K:()=>a,M:()=>T,P:()=>d,c:()=>z,f:()=>E,i:()=>H,m:()=>Q,q:()=>V,t:()=>f,w:()=>p,x:()=>P,y:()=>j});var m,O=K(11827),X=K(11879),A=K(13508),e=K(13517);!function(C){C.Any="any",C.String="string",C.Number="number",C.Boolean="boolean",C.Object="object",C.Integer="FlowGraphInteger",C.Vector2="Vector2",C.bU="bU",C.Vector4="Vector4",C.Quaternion="Quaternion",C.Matrix="Matrix",C.Matrix2D="Matrix2D",C.Matrix3D="Matrix3D",C.fU="fU",C.ve="ve"}(m||(m={}));class t{constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=C,this.defaultValue=U,this.animationType=K}serialize(C){C.typeName=this.typeName,C.defaultValue=this.defaultValue}}const z=new t("any",void 0),j=new t("string",""),p=new t("number",0,0),E=new t("boolean",!1),u=new t("Vector2",O.Vector2.Zero(),5),b=new t("bU",O.bU.Zero(),1),v=new t("Vector4",O.Vector4.Zero()),Q=new t("Matrix",O.Matrix.Identity(),3),V=new t("Matrix2D",new e.e),f=new t("Matrix3D",new e.g),F=new t("fU",X.fU.Black(),4),Z=new t("ve",new X.ve(0,0,0,0),7),P=new t("Quaternion",O.Quaternion.Identity(),2);P.typeTransformer=C=>{if(C.getClassName){if("Vector4"===C.getClassName())return O.Quaternion.FU(C.Oe());if("bU"===C.getClassName())return O.Quaternion.FromEulerVector(C);if("Matrix"===C.getClassName())return O.Quaternion.FromRotationMatrix(C)}return C};const H=new t("FlowGraphInteger",new A.d(0),0);function d(C){const U=C;switch(typeof C){case"string":return j;case"number":return p;case"boolean":return E;case"object":if(U.getClassName)switch(U.getClassName()){case"Vector2":return u;case"bU":return b;case"Vector4":return v;case"Matrix":return Q;case"fU":return F;case"ve":return Z;case"Quaternion":return P;case"FlowGraphInteger":return H;case"Matrix2D":return V;case"Matrix3D":return f}return z;default:return z}}function T(C){switch(C){case"string":return j;case"number":return p;case"boolean":return E;case"Vector2":return u;case"bU":return b;case"Vector4":return v;case"Matrix":return Q;case"fU":return F;case"ve":return Z;case"Quaternion":return P;case"FlowGraphInteger":return H;case"Matrix2D":return V;case"Matrix3D":return f;default:return z}}function y(C){switch(C){case"number":default:return 0;case"Vector2":return 5;case"bU":return 1;case"Matrix":return 3;case"fU":return 4;case"ve":return 7;case"Quaternion":return 2}}function a(C){switch(C){case 0:return p;case 5:return u;case 1:return b;case 3:return Q;case 4:return F;case 7:return Z;case 2:return P;default:return z}}},13502:(C,U,K)=>{"use strict";K.d(U,{b:()=>j,f:()=>z,h:()=>p});var m=K(11879),O=K(11827),X=K(13508),A=K(13514),e=K(13517);function t(C){return"Vector2"===C||"bU"===C||"Vector4"===C||"Quaternion"===C||"fU"===C||"ve"===C}function z(C,U,K){var m;const O=(null===U||void 0===U||null===(m=U.getClassName)||void 0===m?void 0:m.call(U))??"";if(t(O)||function(C){return"Matrix"===C||"Matrix2D"===C||"Matrix3D"===C}(O))K[C]={value:U.Oe(),className:O};else if("FlowGraphInteger"===O)K[C]={value:U.value,className:O};else if(O&&(U.id||U.name))K[C]={id:U.id,name:U.name,className:O};else{if("object"===typeof U)throw new Error(`Could not serialize value ${U}`);K[C]=U}}function j(C,U,K,z){const p=U[C];let E;const u=(null===p||void 0===p?void 0:p.type)??(null===p||void 0===p?void 0:p.className);if(function(C){return"Mesh"===C||"AbstractMesh"===C||"GroundMesh"===C||"InstanceMesh"===C||"LinesMesh"===C||"GoldbergMesh"===C||"GreasedLineMesh"===C||"TrailMesh"===C}(u)){let C=z.meshes.filter((C=>p.id?C.id===p.id:C.name===p.name));0===C.length&&(C=z.transformNodes.filter((C=>p.id?C.id===p.id:C.name===p.name))),E=p.uniqueId?C.find((C=>C.uniqueId===p.uniqueId)):C[0]}else if(t(u))E=function(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===C)return O.Vector2.FU(U);if("bU"===C)return K&&(U[2]*=-1),O.bU.FU(U);if("Vector4"===C)return O.Vector4.FU(U);if("Quaternion"===C)return K&&(U[2]*=-1,U[3]*=-1),O.Quaternion.FU(U);if("fU"===C)return new m.fU(U[0],U[1],U[2]);if("ve"===C)return new m.ve(U[0],U[1],U[2],U[3]);throw new Error(`Unknown vector class name ${C}`)}(u,p.value);else if(function(C){return"AnimationGroup"===C}(u)){const C=z.animationGroups.filter((C=>C.name===p.name));E=1===C.length?C[0]:C.find((C=>C.uniqueId===p.uniqueId))}else E="Matrix"===u?O.Matrix.FU(p.value):"Matrix2D"===u?new e.e(p.value):"Matrix3D"===u?new e.g(p.value):"FlowGraphInteger"===u?X.d.FromValue(p.value):"number"===u||"string"===u||"boolean"===u?p.value[0]:p&&void 0!==p.value?p.value:Array.isArray(p)?p.reduce(((C,U)=>U.eventData?(C[U.id]={type:(0,A.M)(U.type)},"undefined"!==typeof U.value&&(C[U.id].value=j("value",U,K,z)),C):C),{}):p;return E}function p(C){return"FlowGraphJsonPointerParserBlock"===C}},13552:(C,U,K)=>{"use strict";function m(C,U){return!(!C.parent||C.parent!==U&&!m(C.parent,U))}function O(C){if(C.getClassName)return C.getClassName()}function X(C,U){return C===U&&("Vector2"===C||"bU"===C||"Vector4"===C||"Quaternion"===C)}function A(C,U){return C===U&&("Matrix"===C||"Matrix2D"===C||"Matrix3D"===C)}function e(C,U){return"FlowGraphInteger"===C&&"FlowGraphInteger"===U}function t(C,U){const K="number"===typeof C||"number"===typeof(null===C||void 0===C?void 0:C.value);return K&&!U?!isNaN(z(C)):K}function z(C){return"number"===typeof C?C:C.value}K.d(U,{e:()=>e,h:()=>A,j:()=>X,k:()=>O,m:()=>m,o:()=>z,p:()=>t})},12905:(C,U,K)=>{"use strict";K.r(U),K.d(U,{SceneInstrumentation:()=>X});var m=K(11660),O=K(12053);class X{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(C){C!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=C,C?(this._onBeforeActiveMeshesEvaluationObserver=this.QU.onBeforeActiveMeshesEvaluationObservable.add((()=>{m.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.QU.onAfterActiveMeshesEvaluationObservable.add((()=>{m.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.QU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.QU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(C){C!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=C,C?(this._onBeforeRenderTargetsRenderObserver=this.QU.onBeforeRenderTargetsRenderObservable.add((()=>{m.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.QU.onAfterRenderTargetsRenderObservable.add((()=>{m.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.QU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.QU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(C){C!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=C,C?(this._onBeforeParticlesRenderingObserver=this.QU.onBeforeParticlesRenderingObservable.add((()=>{m.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.QU.onAfterParticlesRenderingObservable.add((()=>{m.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.QU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.QU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(C){C!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=C,this.QU.spriteManagers&&(C?(this._onBeforeSpritesRenderingObserver=this.QU.onBeforeSpritesRenderingObservable.add((()=>{m.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.QU.onAfterSpritesRenderingObservable.add((()=>{m.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.QU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.QU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(C){C!==this._capturePhysicsTime&&this.QU.onBeforePhysicsObservable&&(this._capturePhysicsTime=C,C?(this._onBeforePhysicsObserver=this.QU.onBeforePhysicsObservable.add((()=>{m.Tools.StartPerformanceCounter("ge"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.QU.onAfterPhysicsObservable.add((()=>{m.Tools.EndPerformanceCounter("ge"),this._physicsTime.endMonitoring()}))):(this.QU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.QU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(C){C!==this._captureAnimationsTime&&(this._captureAnimationsTime=C,C?this._onAfterAnimationsObserver=this.QU.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.QU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(C){this._captureFrameTime=C}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(C){this._captureInterFrameTime=C}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(C){C!==this._captureRenderTime&&(this._captureRenderTime=C,C?(this._onBeforeDrawPhaseObserver=this.QU.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),m.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.QU.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),m.Tools.EndPerformanceCounter("Main render")}))):(this.QU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.QU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(C){C!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=C,C?(this._onBeforeCameraRenderObserver=this.QU.onBeforeCameraRenderObservable.add((C=>{this._cameraRenderTime.beginMonitoring(),m.Tools.StartPerformanceCounter(`Rendering camera ${C.name}`)})),this._onAfterCameraRenderObserver=this.QU.onAfterCameraRenderObservable.add((C=>{this._cameraRenderTime.endMonitoring(!1),m.Tools.EndPerformanceCounter(`Rendering camera ${C.name}`)}))):(this.QU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.QU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.QU.getEngine()._drawCalls}constructor(C){this.QU=C,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new O.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new O.d,this._captureFrameTime=!1,this._frameTime=new O.d,this._captureRenderTime=!1,this._renderTime=new O.d,this._captureInterFrameTime=!1,this._interFrameTime=new O.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new O.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new O.d,this._capturePhysicsTime=!1,this._physicsTime=new O.d,this._captureAnimationsTime=!1,this._animationsTime=new O.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new O.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=C.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(m.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.QU.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=C.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(m.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.sA(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.sA(),this._captureParticlesRenderTime&&this._particlesRenderTime.sA(),this._captureSpritesRenderTime&&this._spritesRenderTime.sA(),this._captureRenderTime&&this._renderTime.sA(),this._captureCameraRenderTime&&this._cameraRenderTime.sA()}))}dispose(){this._disposed||(this.QU.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.QU.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.QU.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.QU.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.QU.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.QU.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.QU.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.QU.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.QU.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.QU.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.QU.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.QU.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.QU.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.QU.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.QU.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.QU.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.QU.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.QU=null,this._disposed=!0)}}},13492:(C,U,K)=>{"use strict";K.d(U,{e:()=>j});var m=K(11810),O=K(11818),X=K(11827),A=K(12254),e=K(12367),t=K(12418),z=K(11789);A.c.AddNodeConstructor("Light_Type_1",((C,U)=>()=>new j(C,X.bU.Zero(),U)));class j extends t.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(C){this._shadowFrustumSize=C,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(C){this._shadowOrthoScale=C,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(C){this._orthoLeft=C}get orthoRight(){return this._orthoRight}set orthoRight(C){this._orthoRight=C}get orthoTop(){return this._orthoTop}set orthoTop(C){this._orthoTop=C}get orthoBottom(){return this._orthoBottom}set orthoBottom(C){this._orthoBottom=C}constructor(C,U,K){super(C,K),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=U.scale(-1),this.direction=U}getClassName(){return"Le"}getTypeID(){return e.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(C,U,K){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(C):this._setDefaultAutoExtendShadowProjectionMatrix(C,U,K)}_setDefaultFixedFrustumShadowProjectionMatrix(C){const U=this.dC().activeCamera;U&&X.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:U.Ae,void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,C,this.dC().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(C,U,K){const m=this.dC().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const C=X.bU.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let m=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(let A=0;A<K.length;A++){const e=K[A];if(!e)continue;const t=e.getBoundingInfo().boundingBox;for(let K=0;K<t.vectorsWorld.length;K++)X.bU.TransformCoordinatesToRef(t.vectorsWorld[K],U,C),C.x<this._orthoLeft&&(this._orthoLeft=C.x),C.y<this._orthoBottom&&(this._orthoBottom=C.y),C.x>this._orthoRight&&(this._orthoRight=C.x),C.y>this._orthoTop&&(this._orthoTop=C.y),this.autoCalcShadowZBounds&&(C.z<m&&(m=C.z),C.z>O&&(O=C.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=m,this._shadowMaxZ=O)}const O=this._orthoRight-this._orthoLeft,A=this._orthoTop-this._orthoBottom,e=void 0!==this.shadowMinZ?this.shadowMinZ:(null===m||void 0===m?void 0:m.Ae)||0,t=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===m||void 0===m?void 0:m.maxZ)||1e4,z=this.dC().getEngine().useReverseDepthBuffer;X.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-O*this.shadowOrthoScale,this._orthoRight+O*this.shadowOrthoScale,this._orthoBottom-A*this.shadowOrthoScale,this._orthoTop+A*this.shadowOrthoScale,z?t:e,z?e:t,C,this.dC().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(C,U){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,U),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,U),this)}transferToNodeMaterialEffect(C,U){return this.computeTransformedInformation()?(C.setFloat3(U,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(C.setFloat3(U,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(C){const U=this._scene.getEngine();return!U.useReverseDepthBuffer&&U.isNDCHalfZRange?0:1}getDepthMaxZ(C){const U=this._scene.getEngine();return U.useReverseDepthBuffer&&U.isNDCHalfZRange?0:1}prepareLightSpecificDefines(C,U){C["DIRLIGHT"+U]=!0}}(0,m.d)([(0,O.O)()],j.prototype,"shadowFrustumSize",null),(0,m.d)([(0,O.O)()],j.prototype,"shadowOrthoScale",null),(0,m.d)([(0,O.O)()],j.prototype,"autoUpdateExtends",void 0),(0,m.d)([(0,O.O)()],j.prototype,"autoCalcShadowZBounds",void 0),(0,m.d)([(0,O.O)("orthoLeft")],j.prototype,"_orthoLeft",void 0),(0,m.d)([(0,O.O)("orthoRight")],j.prototype,"_orthoRight",void 0),(0,m.d)([(0,O.O)("orthoTop")],j.prototype,"_orthoTop",void 0),(0,m.d)([(0,O.O)("orthoBottom")],j.prototype,"_orthoBottom",void 0),(0,z.h)("BABYLON.DirectionalLight",j)},13983:(C,U,K)=>{"use strict";K.d(U,{d:()=>j});var m=K(11810),O=K(11818),X=K(11827),A=K(11879),e=K(12254),t=K(12367),z=K(11789);e.c.AddNodeConstructor("Light_Type_3",((C,U)=>()=>new j(C,X.bU.Zero(),U)));class j extends t.e{constructor(C,U,K){super(C,K),this.groundColor=new A.fU(0,0,0),this.direction=U||X.bU.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Ye"}setDirectionToTarget(C){return this.direction=X.bU.Normalize(C.vU(X.bU.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(C,U){const K=X.bU.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",K.x,K.y,K.z,0,U),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.fe),U),this}transferToNodeMaterialEffect(C,U){const K=X.bU.Normalize(this.direction);return C.setFloat3(U,K.x,K.y,K.z),this}te(){return this._worldMatrix||(this._worldMatrix=X.Matrix.Identity()),this._worldMatrix}getTypeID(){return t.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(C,U){C["HEMILIGHT"+U]=!0}}(0,m.d)([(0,O.o)()],j.prototype,"groundColor",void 0),(0,m.d)([(0,O.L)()],j.prototype,"direction",void 0),(0,z.h)("BABYLON.HemisphericLight",j)},13461:(C,U,K)=>{"use strict";K.d(U,{b:()=>p});var m=K(11810),O=K(11818),X=K(11827),A=K(12254),e=K(12367),t=K(12418),z=K(11808),j=K(11789);A.c.AddNodeConstructor("Light_Type_2",((C,U)=>()=>new p(C,X.bU.Zero(),X.bU.Zero(),0,0,U)));class p extends t.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(C){this._iesProfileTexture!==C&&(this._iesProfileTexture=C,this._iesProfileTexture&&p._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(C){this._angle=C,this._cosHalfAngle=Math.cos(.5*C),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(C){this._innerAngle=C,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(C){this._shadowAngleScale=C,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(C){this._projectionTextureLightNear=C,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(C){this._projectionTextureLightFar=C,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(C){this._projectionTextureUpDirection=C,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(C){this._projectionTexture!==C&&(this._projectionTexture=C,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(p._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):p._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(C){return void 0!==C.onGeneratedObservable}static _IsTexture(C){return void 0!==C.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(C){this._projectionTextureProjectionLightMatrix=C,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(C,U,K,m,O,A){super(C,A),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=X.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=X.bU.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=X.bU.Zero(),this._projectionTextureViewLightMatrix=X.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=X.Matrix.Zero(),this._projectionTextureScalingMatrix=X.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=U,this.direction=K,this.angle=m,this.exponent=O}getClassName(){return"SpotLight"}getTypeID(){return e.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(C){super._setDirection(C),this._projectionTextureViewLightDirty=!0}_setPosition(C){super._setPosition(C),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(C,U,K){const m=this.dC().activeCamera;if(!m)return;this._shadowAngleScale=this._shadowAngleScale||1;const O=this._shadowAngleScale*this._angle,A=void 0!==this.shadowMinZ?this.shadowMinZ:m.Ae,e=void 0!==this.shadowMaxZ?this.shadowMaxZ:m.maxZ,t=this.dC().getEngine().useReverseDepthBuffer;X.Matrix.PerspectiveFovLHToRef(O,1,t?e:A,t?A:e,C,!0,this._scene.getEngine().isNDCHalfZRange,void 0,t)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),X.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const C=this.projectionTextureLightFar,U=this.projectionTextureLightNear,K=C/(C-U),m=-K*U,O=1/Math.tan(this._angle/2);X.Matrix.FromValuesToRef(O/1,0,0,0,0,O,0,0,0,0,K,1,0,0,m,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof z.b){const C=this._projectionTexture.uScale/2,U=this._projectionTexture.vScale/2;X.Matrix.FromValuesToRef(C,0,0,0,0,U,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(C,U){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),C.setMatrix("textureProjectionMatrix"+U,this._projectionTextureMatrix),C.setTexture("projectionLightTexture"+U,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&C.setTexture("iesLightTexture"+U,this._iesProfileTexture),this}transferToEffect(C,U){let K;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,U),K=X.bU.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,U),K=X.bU.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",K.x,K.y,K.z,this._cosHalfAngle,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,U),this}transferToNodeMaterialEffect(C,U){let K;return K=this.computeTransformedInformation()?X.bU.Normalize(this.transformedDirection):X.bU.Normalize(this.direction),this.dC().useRightHandedSystem?C.setFloat3(U,-K.x,-K.y,-K.z):C.setFloat3(U,K.x,K.y,K.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(C){const U=this._scene.getEngine(),K=void 0!==this.shadowMinZ?this.shadowMinZ:(null===C||void 0===C?void 0:C.Ae)??0;return U.useReverseDepthBuffer&&U.isNDCHalfZRange?K:this._scene.getEngine().isNDCHalfZRange?0:K}getDepthMaxZ(C){const U=this._scene.getEngine(),K=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===C||void 0===C?void 0:C.maxZ)??1e4;return U.useReverseDepthBuffer&&U.isNDCHalfZRange?0:K}prepareLightSpecificDefines(C,U){C["SPOTLIGHT"+U]=!0,C["PROJECTEDLIGHTTEXTURE"+U]=!(!this.projectionTexture||!this.projectionTexture.isReady()),C["IESLIGHTTEXTURE"+U]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,m.d)([(0,O.O)()],p.prototype,"angle",null),(0,m.d)([(0,O.O)()],p.prototype,"innerAngle",null),(0,m.d)([(0,O.O)()],p.prototype,"shadowAngleScale",null),(0,m.d)([(0,O.O)()],p.prototype,"exponent",void 0),(0,m.d)([(0,O.O)()],p.prototype,"projectionTextureLightNear",null),(0,m.d)([(0,O.O)()],p.prototype,"projectionTextureLightFar",null),(0,m.d)([(0,O.O)()],p.prototype,"projectionTextureUpDirection",null),(0,m.d)([(0,O.D)("projectedLightTexture")],p.prototype,"_projectionTexture",void 0),(0,j.h)("BABYLON.SpotLight",p)},13166:(C,U,K)=>{"use strict";K.d(U,{d:()=>A,e:()=>X,g:()=>e});const m={},O={};function X(C,U){m[C]=U}function A(C,U){O[C]=U}function e(C){return O[C]?O[C]:null}},13074:(C,U,K)=>{"use strict";K.d(U,{e:()=>d,i:()=>B});var m,O=K(11660),X=K(11663),A=K(12078),e=K(11703),t=K(11679),z=K(12302),j=K(11709),p=K(11717),E=K(11793),u=K(11735),b=K(11701);!function(C){C[C.Clean=0]="Clean",C[C.Stop=1]="Stop",C[C.Sync=2]="Sync",C[C.NoSync=3]="NoSync"}(m||(m={}));const v=new X.b,Q={};let V=!1;function f(){return Q[".babylon"]}function F(C,U){const K=Q[C];return K||(t.d.Warn("Unable to find a plugin to load "+C+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U?f():void 0)}function Z(C,U,K){let m="Unable to load from "+(C.rawData?"binary data":C.url);return U?m+=`: ${U}`:K&&(m+=`: ${K}`),m}async function P(C,U,K,m,O,X,A,e,t){var z;const p="data:"===(E=C.url).substring(0,5)?E.substring(5):null;var E;if(C.rawData&&!A)throw"When using ArrayBufferView to load data the file extension must be provided.";const V=p||A?"":function(C){const U=C.indexOf("?");-1!==U&&(C=C.substring(0,U));const K=C.lastIndexOf(".");return C.substring(K,C.length).toLowerCase()}(C.url);let Z=A?F(A,!0):p?function(C){for(const U in Q){const K=Q[U].plugin;if(K.canDirectLoad&&K.canDirectLoad(C))return Q[U]}return f()}(C.url):F(V,!1);if(!Z&&V){if(C.url&&!C.url.startsWith("blob:")){const U=await async function(C,U){const K=U.method||"GET";return await new Promise(((m,O)=>{const X=new b.b;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const C={};if(U.responseHeaders)for(const K of U.responseHeaders)C[K]=X.getResponseHeader(K)||"";m({response:X.response,headerValues:C})}else O(`Unable to fetch data from ${C}. Error code: ${X.status}`)})),X.open(K,C),X.send()}))}(C.url,{method:"HEAD",responseHeaders:["Content-Type"]}),K=U.headerValues?U.headerValues["Content-Type"]:"";K&&(Z=function(C){for(const U in Q){const K=Q[U];if(K.mimeType===C)return K}}(K))}Z||(Z=f())}if(!Z)throw new Error(`No plugin or fallback for ${A??C.url}`);if(!1===(null===t||void 0===t||null===(z=t[Z.plugin.name])||void 0===z?void 0:z.enabled))throw new Error(`The '${Z.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(C.rawData&&!Z.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(C=>{if(Z.plugin.createPlugin){const U=Z.plugin.createPlugin(t??{});return U instanceof Promise?(U.then(C).catch((C=>{O("Error instantiating plugin.",C)})),null):(C(U),U)}return C(Z.plugin),Z.plugin})((t=>{var z;if(!t)throw`The loader plugin corresponding to the '${A}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(v.notifyObservers(t),p&&(t.canDirectLoad&&t.canDirectLoad(C.url)||!(0,j.i)(C.url))){if(t.directLoad){const C=t.directLoad(U,p);C instanceof Promise?C.then((C=>{K(t,C)})).catch((C=>{O("Error in directLoad of _loadData: "+C,C)})):K(t,C)}else K(t,p);return}const E=Z.isBinary,b=(C,m)=>{U.A?O("Scene has been disposed"):K(t,C,m)};let Q=null,V=!1;null===(z=t.RA)||void 0===z||z.add((()=>{V=!0,Q&&(Q.abort(),Q=null),X()}));const f=()=>{if(V)return;const K=(C,U)=>{O(null===C||void 0===C?void 0:C.statusText,U)};if(!t.loadFile&&C.rawData)throw"Plugin does not support loading ArrayBufferView.";Q=t.loadFile?t.loadFile(U,C.rawData||C.file||C.url,C.rootUrl,b,m,E,K,e):U._loadFile(C.file||C.url,b,m,!0,E,K)},F=U.getEngine();let P=F.enableOfflineSupport;if(P){let K=!1;for(const m of U.disableOfflineSupportExceptionRules)if(m.test(C.url)){K=!0;break}P=!K}P&&u.b.OfflineProviderFactory?U.offlineProvider=u.b.OfflineProviderFactory(C.url,f,F.disableManifestCheck):f()}))}function H(C,U){let K,m,X=null,A=null;if(U)if(U.name)K=`file:${U.name}`,m=U.name,X=U;else if(ArrayBuffer.isView(U))K="",m=(0,E.d)(),A=U;else if(U.startsWith("data:"))K=U,m="";else if(C){const X=U;if("/"===X.substring(0,1))return O.Tools.Error("Wrong sceneFilename parameter"),null;K=C+X,m=X}else K=U,m=O.Tools.GetFilename(U),C=O.Tools.GetFolderPath(U);else K=C,m=O.Tools.GetFilename(C),C=O.Tools.GetFolderPath(C);return{url:K,rootUrl:C,name:m,file:X,rawData:A}}function d(C){if("string"===typeof C.extensions){const U=C.extensions;Q[U.toLowerCase()]={plugin:C,isBinary:!1}}else{const U=C.extensions,K=Object.keys(U);for(const m of K)Q[m.toLowerCase()]={plugin:C,isBinary:U[m].isBinary,mimeType:U[m].mimeType}}}async function T(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.c.LastCreatedScene,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!m)return t.d.Error("No scene available to import mesh to"),null;const u=H(U,K);if(!u)return null;const b={};m.addPendingData(b);const v=()=>{m.removePendingData(b)},Q=(C,U)=>{const K=Z(u,C,U);A?A(m,K,new p.j(K,p.f.SceneLoaderError,U)):t.d.Error(K),v()},V=X?C=>{try{X(C)}catch(U){Q("Error in onProgress callback: "+U,U)}}:void 0,f=(C,U,K,X,A,e,t,z)=>{if(m.importedMeshesFiles.push(u.url),O)try{O(C,U,K,X,A,e,t,z)}catch(j){Q("Error in onSuccess callback: "+j,j)}m.removePendingData(b)};return await P(u,m,((U,K,O)=>{if(U.rewriteRootURL&&(u.rootUrl=U.rewriteRootURL(u.rootUrl,O)),U.importMesh){const O=[],X=[],A=[];if(!U.importMesh(C,m,K,u.rootUrl,O,X,A,Q))return;m.loadingPluginName=U.name,f(O,X,A,[],[],[],[],[])}else{U.importMeshAsync(C,m,K,u.rootUrl,V,u.name).then((C=>{m.loadingPluginName=U.name,f(C.meshes,C.AE,C.skeletons,C.animationGroups,C.transformNodes,C.geometries,C.lights,C.spriteManagers)})).catch((C=>{Q(C.message,C)}))}}),V,Q,v,z,j,E)}async function y(C,U,K,m,O,X,A,e){return await new Promise(((t,z)=>{try{T(C,U,K,m,((C,U,K,m,O,X,A,e)=>{t({meshes:C,AE:U,skeletons:K,animationGroups:m,transformNodes:O,geometries:X,lights:A,spriteManagers:e})}),O,((C,U,K)=>{z(K||new Error(U))}),X,A,e).catch(z)}catch(p){z(p)}}))}async function a(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.c.LastCreatedEngine,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};K?await i(C,U,new A.b(K),m,X,t,z,j,p):O.Tools.Error("No engine available")}async function r(C,U,K,m,O,X,A){return await new Promise(((e,t)=>{a(C,U,K,(C=>{e(C)}),m,((C,U,K)=>{t(K||new Error(U))}),O,X,A)}))}async function i(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.c.LastCreatedScene,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!K)return t.d.Error("No scene available to append to"),null;const u=H(C,U);if(!u)return null;const b={};K.addPendingData(b);const v=()=>{K.removePendingData(b)};z.e.ShowLoadingScreen&&!V&&(V=!0,K.getEngine().displayLoadingUI(),K.executeWhenReady((()=>{K.getEngine().hideLoadingUI(),V=!1})));const Q=(C,U)=>{const m=Z(u,C,U);X?X(K,m,new p.j(m,p.f.SceneLoaderError,U)):t.d.Error(m),v()},f=O?C=>{try{O(C)}catch(U){Q("Error in onProgress callback",U)}}:void 0,F=()=>{if(m)try{m(K)}catch(C){Q("Error in onSuccess callback",C)}K.removePendingData(b)};return await P(u,K,((C,U)=>{if(C.load){if(!C.load(K,U,u.rootUrl,Q))return;K.loadingPluginName=C.name,F()}else{C.loadAsync(K,U,u.rootUrl,f,u.name).then((()=>{K.loadingPluginName=C.name,F()})).catch((C=>{Q(C.message,C)}))}}),f,Q,v,A,j,E)}async function D(C,U,K,m,O,X,A){return await new Promise(((e,t)=>{try{i(C,U,K,(C=>{e(C)}),m,((C,U,K)=>{t(K||new Error(U))}),O,X,A).catch(t)}catch(p){t(p)}}))}async function l(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.c.LastCreatedScene,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!K)return t.d.Error("No scene available to load asset container to"),null;const E=H(C,U);if(!E)return null;const u={};K.addPendingData(u);const b=()=>{K.removePendingData(u)},v=(C,U)=>{const m=Z(E,C,U);X?X(K,m,new p.j(m,p.f.SceneLoaderError,U)):t.d.Error(m),b()},Q=O?C=>{try{O(C)}catch(U){v("Error in onProgress callback",U)}}:void 0,V=C=>{if(m)try{m(C)}catch(U){v("Error in onSuccess callback",U)}K.removePendingData(u)};return await P(E,K,((C,U)=>{if(C.loadAssetContainer){const m=C.loadAssetContainer(K,U,E.rootUrl,v);if(!m)return;m.populateRootNodes(),K.loadingPluginName=C.name,V(m)}else if(C.loadAssetContainerAsync){C.loadAssetContainerAsync(K,U,E.rootUrl,Q,E.name).then((U=>{U.populateRootNodes(),K.loadingPluginName=C.name,V(U)})).catch((C=>{v(C.message,C)}))}else v("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),Q,v,b,A,z,j)}async function G(C,U,K,m,O,X,A){return await new Promise(((e,t)=>{try{l(C,U,K,(C=>{e(C)}),m,((C,U,K)=>{t(K||new Error(U))}),O,X,A).catch(t)}catch(p){t(p)}}))}async function J(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.c.LastCreatedScene,m=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!K)return void t.d.Error("No scene available to load animations to");if(m){for(const m of K.animatables)m.reset();K.stopAllAnimations();const C=K.animationGroups.slice();for(const K of C)K.dispose();const U=K.getNodes();for(const K of U)K.animations&&(K.animations=[])}else switch(O){case 0:const C=K.animationGroups.slice();for(const U of C)U.dispose();break;case 1:for(const U of K.animationGroups)U.stop();break;case 2:for(const U of K.animationGroups)U.reset(),U.restart();break;case 3:break;default:return void t.d.Error("Unknown animation group loading mode value '"+O+"'")}const b=K.animatables.length;await l(C,U,K,(C=>{C.mergeAnimationsTo(K,K.animatables.slice(b),X),C.dispose(),K.onAnimationFileImportedObservable.notifyObservers(K),A&&A(K)}),z,j,p,E,u)}async function o(C,U,K,m,O,X,A,e,t,z){return await new Promise(((j,E)=>{try{J(C,U,K,m,O,X,(C=>{j(C)}),A,((C,U,K)=>{E(K||new Error(U))}),e,t,z).catch(E)}catch(p){E(p)}}))}class B{static get ForceFullSceneLoadingForIncremental(){return z.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(C){z.e.ForceFullSceneLoadingForIncremental=C}static get ShowLoadingScreen(){return z.e.ShowLoadingScreen}static set ShowLoadingScreen(C){z.e.ShowLoadingScreen=C}static get loggingLevel(){return z.e.loggingLevel}static set loggingLevel(C){z.e.loggingLevel=C}static get CleanBoneMatrixWeights(){return z.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(C){z.e.CleanBoneMatrixWeights=C}static GetDefaultPlugin(){return f()}static GetPluginForExtension(C){var U;return null===(U=F(C,!0))||void 0===U?void 0:U.plugin}static IsPluginForExtensionAvailable(C){return function(C){return!!Q[C]}(C)}static RegisterPlugin(C){d(C)}static ImportMesh(C,U,K,m,O,X,A,t,z){T(C,U,K,m,O,X,A,t,z).catch((C=>null===A||void 0===A?void 0:A(e.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async ImportMeshAsync(C,U,K,m,O,X,A){return await y(C,U,K,m,O,X,A)}static Load(C,U,K,m,O,X,A,t){a(C,U,K,m,O,X,A,t).catch((C=>null===X||void 0===X?void 0:X(e.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async LoadAsync(C,U,K,m,O,X){return await r(C,U,K,m,O,X)}static Append(C,U,K,m,O,X,A,t){i(C,U,K,m,O,X,A,t).catch((C=>null===X||void 0===X?void 0:X(K??e.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async AppendAsync(C,U,K,m,O,X){return await D(C,U,K,m,O,X)}static LoadAssetContainer(C,U,K,m,O,X,A,t){l(C,U,K,m,O,X,A,t).catch((C=>null===X||void 0===X?void 0:X(K??e.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async LoadAssetContainerAsync(C,U,K,m,O,X){return await G(C,U,K,m,O,X)}static ImportAnimations(C,U,K,m,O,X,A,t,z,j,p){J(C,U,K,m,O,X,A,t,z,j,p).catch((C=>null===z||void 0===z?void 0:z(K??e.c.LastCreatedScene,null===C||void 0===C?void 0:C.message,C)))}static async ImportAnimationsAsync(C,U,K,m,O,X,A,e,t,z,j){return await o(C,U,K,m,O,X,e,z,j)}}B.NO_LOGGING=0,B.MINIMAL_LOGGING=1,B.SUMMARY_LOGGING=2,B.DETAILED_LOGGING=3,B.OnPluginActivatedObservable=v},13477:(C,U,K)=>{"use strict";K.d(U,{e:()=>E});var m=K(11810),O=K(11818),X=K(11660),A=K(11827),e=K(11854),t=K(11808),z=K(11789),j=K(11663),p=K(11863);K(13483);class E extends e.c{set boundingBoxSize(C){if(this._boundingBoxSize&&this._boundingBoxSize.equals(C))return;this._boundingBoxSize=C;const U=this.dC();U&&U.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(C){this._rotationY=C,this.setReflectionTextureMatrix(A.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(C,U,K){let m="";for(const O of C)m+=O;return new E(m,U,null,K,C)}static CreateFromPrefilteredData(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const O=U.useDelayedTextureLoading;U.useDelayedTextureLoading=!1;const X=new E(C,U,null,!1,null,null,null,void 0,!0,K,m);return U.useDelayedTextureLoading=O,X}constructor(C,U){var K;let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,V=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0;super(U),this.onLoadObservable=new j.b,this.boundingBoxPosition=A.bU.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new A.Matrix,this._buffer=null,this.name=C,this.url=C,this._noMipmap=O,this.Xe=!1,this.isCube=!0,this._textureMatrix=A.Matrix.Identity(),this.coordinatesMode=t.b.CUBIC_MODE;let F=null,Z=null;null===m||Array.isArray(m)?(this._noMipmap=O,this._format=p,this._createPolynomials=b,F=m,this._loaderOptions=V,this._useSRGBBuffer=f,this._lodScale=v,this._lodOffset=Q):(F=m.extensions??null,this._noMipmap=m.noMipmap??!1,X=m.files??null,Z=m.buffer??null,this._format=m.format??5,E=m.prefiltered??!1,u=m.forcedExtension??null,this._createPolynomials=m.createPolynomials??!1,this._lodScale=m.lodScale??.8,this._lodOffset=m.lodOffset??0,this._loaderOptions=m.loaderOptions,this._useSRGBBuffer=m.useSRGBBuffer,e=m.R??null,z=m.onError??null),(C||X)&&this.updateURL(C,u,e,E,z,F,null===(K=this.dC())||void 0===K?void 0:K.useDelayedTextureLoading,X,Z)}getClassName(){return"CubeTexture"}updateURL(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=C),this.url=C,U&&(this._forcedExtension=U);const z=C.lastIndexOf("."),j=U||(z>-1?C.substring(z).toLowerCase():""),p=0===j.indexOf(".dds"),E=0===j.indexOf(".env"),u=0===j.indexOf(".basis");if(E?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=m,m&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),e)this._files=e;else if(u||E||p||X||(X=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,X){for(let U=0;U<X.length;U++)this._files.push(C+X[U]);this._extensions=X}this._buffer=t,A?(this.delayLoadState=4,this._delayedOnLoad=K,this._delayedOnError=O):this._loadTexture(K,O)}delayLoad(C){4===this.delayLoadState&&(C&&(this._forcedExtension=C),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(C){var U,K;if(C.updateFlag===this._textureMatrix.updateFlag)return;C.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(K=this.dC())||void 0===K||K.markAllMaterialsAsDirty(1,(C=>-1!==C.getActiveTextures().indexOf(this))));if(this._textureMatrix=C,null===(U=this.dC())||void 0===U||!U.useRightHandedSystem)return;const m=A.TmpVectors.bU[0],O=A.TmpVectors.Quaternion[0],X=A.TmpVectors.bU[1];this._textureMatrix.decompose(m,O,X),O.z*=-1,O.w*=-1,A.Matrix.ComposeToRef(m,O,X,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var C;return null!==(C=this.dC())&&void 0!==C&&C.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=this.dC(),m=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const O=()=>{var U;(this.onLoadObservable.notifyObservers(this),m)&&(m.dispose(),null===(U=this.dC())||void 0===U||U.markAllMaterialsAsDirty(1));C&&C()},A=(C,K)=>{this._loadingError=!0,this._errorObject={message:C,exception:K},U&&U(C,K),t.b.OnTextureLoadErrorObservable.notifyObservers(this)};var e;this._texture?this._texture.isReady?X.Tools.SetImmediate((()=>O())):this._texture.onLoadedObservable.add((()=>O())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,K,this._lodScale,this._lodOffset,C,A,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,K,this._files,this._noMipmap,C,A,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(e=this._texture)||void 0===e||e.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(C,U,K){const m=p.c.Parse((()=>{let m=!1;return C.prefiltered&&(m=C.prefiltered),new E(K+(C.url??C.name),U,C.extensions,!1,C.files||null,null,null,void 0,m,C.forcedExtension)}),C,U);if(C.boundingBoxPosition&&(m.boundingBoxPosition=A.bU.FU(C.boundingBoxPosition)),C.boundingBoxSize&&(m.boundingBoxSize=A.bU.FU(C.boundingBoxSize)),C.animations)for(let O=0;O<C.animations.length;O++){const U=C.animations[O],K=(0,z.d)("BABYLON.Animation");K&&m.animations.push(K.Parse(U))}return m}clone(){let C=0;const U=p.c.Clone((()=>{const U=new E(this.url,this.dC()||this._getEngine(),this._extensions,this._noMipmap,this._files);return C=U.uniqueId,U}),this);return U.uniqueId=C,U}}(0,m.d)([(0,O.O)()],E.prototype,"url",void 0),(0,m.d)([(0,O.L)()],E.prototype,"boundingBoxPosition",void 0),(0,m.d)([(0,O.L)()],E.prototype,"boundingBoxSize",null),(0,m.d)([(0,O.O)("rotationY")],E.prototype,"rotationY",null),(0,m.d)([(0,O.O)("files")],E.prototype,"_files",void 0),(0,m.d)([(0,O.O)("forcedExtension")],E.prototype,"_forcedExtension",void 0),(0,m.d)([(0,O.O)("extensions")],E.prototype,"_extensions",void 0),(0,m.d)([(0,O.y)("textureMatrix")],E.prototype,"_textureMatrix",void 0),(0,m.d)([(0,O.y)("textureMatrixRefraction")],E.prototype,"_textureMatrixRefraction",void 0),t.b._CubeTextureParser=E.Parse,(0,z.h)("BABYLON.CubeTexture",E)},13996:(C,U,K)=>{"use strict";K.d(U,{c:()=>t});var m=K(11679),O=K(11808),X=K(11802),A=K(11962),e=K(11773);A.ThinEngine.prototype.createDynamicTexture=function(C,U,K,m){const O=new e.d(this,4);return O.baseWidth=C,O.baseHeight=U,K&&(C=this.needPOTTextures?(0,X.g)(C,this._caps.maxTextureSize):C,U=this.needPOTTextures?(0,X.g)(U,this._caps.maxTextureSize):U),O.width=C,O.height=U,O.isReady=!1,O.generateMipMaps=K,O.samplingMode=m,this.updateTextureSamplingMode(m,O),this._internalTexturesCache.push(O),O},A.ThinEngine.prototype.updateDynamicTexture=function(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4?arguments[4]:void 0,X=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!C)return;const A=this._gl,e=A.TEXTURE_2D,t=this._bindTextureDirectly(e,C,!0,X);this._unpackFlipY(void 0===K?C.invertY:K),m&&A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const z=this._getWebGLTextureType(C.type),j=this._getInternalFormat(O||C.format),p=this._getRGBABufferInternalSizedFormat(C.type,j);A.texImage2D(e,0,p,j,z,U),C.generateMipMaps&&A.generateMipmap(e),t||this._bindTextureDirectly(e,null),m&&A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),O&&(C.format=O),C._dynamicTextureSource=U,C._premulAlpha=m,C.invertY=K||!1,C.isReady=!0};class t extends O.b{constructor(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,e=arguments.length>6?arguments[6]:void 0;const t=!K||K._isScene;super(null,t?K:null===K||void 0===K?void 0:K.QU,t?!m:K,e,X,void 0,void 0,void 0,void 0,A),this.name=C,this.wrapU=O.b.CLAMP_ADDRESSMODE,this.wrapV=O.b.CLAMP_ADDRESSMODE,this._generateMipMaps=m;const z=this._getEngine();if(!z)return;if(U.getContext)this._canvas=U,this._ownCanvas=!1,this._texture=z.createDynamicTexture(this._canvas.width,this._canvas.height,m,X);else{this._canvas=z.createCanvas(1,1),this._ownCanvas=!0;const C=U;C.width||0===C.width?this._texture=z.createDynamicTexture(C.width,C.height,m,X):this._texture=z.createDynamicTexture(U,U,m,X)}const j=this.getSize();this._canvas.width!==j.width&&(this._canvas.width=j.width),this._canvas.height!==j.height&&(this._canvas.height=j.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(C){this._canvas.width=C.width,this._canvas.height=C.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(C.width,C.height,this._generateMipMaps,this.samplingMode)}scale(C){const U=this.getSize();U.width*=C,U.height*=C,this._recreate(U)}scaleTo(C,U){const K=this.getSize();K.width=C,K.height=U,this._recreate(K)}getContext(){return this._context}clear(C){const U=this.getSize();C&&(this._context.fillStyle=C),this._context.clearRect(0,0,U.width,U.height)}update(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===C||C,U,this._format||void 0,void 0,K)}drawText(C,U,K,m,O,X,A){let e=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const t=this.getSize();if(X&&(this._context.fillStyle=X,this._context.fillRect(0,0,t.width,t.height)),this._context.font=m,null===U||void 0===U){const K=this._context.measureText(C);U=(t.width-K.width)/2}if(null===K||void 0===K){const C=parseInt(m.replace(/\D/g,""));K=t.height/2+C/3.65}this._context.fillStyle=O||"",this._context.fillText(C,U,K),e&&this.update(A)}dispose(){var C,U;(super.dispose(),this._ownCanvas)&&(null===(C=this._canvas)||void 0===C||null===(U=C.remove)||void 0===U||U.call(C));this._canvas=null,this._context=null}clone(){const C=this.dC();if(!C)return this;const U=this.getSize(),K=new t(this.name,U,C,this._generateMipMaps);return K.Xe=this.Xe,K.level=this.level,K.wrapU=this.wrapU,K.wrapV=this.wrapV,K}serialize(){const C=this.dC();C&&!C.isReady()&&m.d.Warn("The scene must be ready before serializing the dynamic texture");const U=super.serialize();return t._IsCanvasElement(this._canvas)&&(U.base64String=this._canvas.toDataURL()),U.invertY=this._invertY,U.samplingMode=this.samplingMode,U}static _IsCanvasElement(C){return void 0!==C.toDataURL}_rebuild(){this.update()}}},13388:(C,U,K)=>{"use strict";K.d(U,{c:()=>O});var m=K(11808);class O extends m.b{get depth(){return this._depth}constructor(C,U,K,O,X,A){let e=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:m.b.TRILINEAR_SAMPLINGMODE,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,p=arguments.length>10?arguments[10]:void 0;super(null,A,!e,t),this.format=X,this._texture=A.getEngine().createRawTexture2DArray(C,U,K,O,X,e,t,z,null,j,p),this._depth=O,this.is2DArray=!0}update(C){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,C,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(C,U,K,m,X){return new O(C,U,K,m,5,X,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13187:(C,U,K)=>{"use strict";K.d(U,{b:()=>e,d:()=>t,f:()=>X,j:()=>A});var m=K(11846),O=K(11827);function X(C,U){return`{X: ${C.x.toFixed(U)} Y: ${C.y.toFixed(U)}}`}function A(C,U){return`{X: ${C._x.toFixed(U)} Y: ${C._y.toFixed(U)} Z: ${C._z.toFixed(U)}}`}function e(C,U){return 2*Math.acos((0,m.Clamp)(O.Quaternion.Dot(C,U)))}function t(C,U){const K=new O.Quaternion;return function(C,U,K){const X=O.bU.Cross(C,U),A=Math.acos((0,m.Clamp)(O.bU.Dot(C,U),-1,1));O.Quaternion.RotationAxisToRef(X,A,K)}(C,U,K),K}},13022:(C,U,K)=>{"use strict";K.d(U,{d:()=>z});var m=K(11827),O=K(11879),X=K(12285),A=K(12265),e=K(11890);K(13027);function t(C){let U=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const K=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],X=[];let t=[];const z=C.width||C.size||1,j=C.height||C.size||1,p=C.depth||C.size||1,E=C.wrap||!1;let u=void 0===C.topBaseAt?1:C.topBaseAt,b=void 0===C.bottomBaseAt?0:C.bottomBaseAt;u=(u+4)%4,b=(b+4)%4;let v=[2,0,3,1][u],Q=[2,0,1,3][b],V=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(E){U=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],V=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let C=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],K=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const m=[17,18,19,16],O=[22,23,20,21];for(;v>0;)C.unshift(C.pop()),m.unshift(m.pop()),v--;for(;Q>0;)K.unshift(K.pop()),O.unshift(O.pop()),Q--;C=C.flat(),K=K.flat(),V=V.concat(C).concat(K),U.push(m[0],m[2],m[3],m[0],m[1],m[2]),U.push(O[0],O[2],O[3],O[0],O[1],O[2])}const f=[z/2,j/2,p/2];t=V.reduce(((C,U,K)=>C.concat(U*f[K%3])),[]);const F=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE,Z=C.faceUV||new Array(6),P=C.faceColors,H=[];for(let A=0;A<6;A++)void 0===Z[A]&&(Z[A]=new m.Vector4(0,0,1,1)),P&&void 0===P[A]&&(P[A]=new O.ve(1,1,1,1));for(let m=0;m<6;m++)if(X.push(Z[m].z,e.e?1-Z[m].w:Z[m].w),X.push(Z[m].x,e.e?1-Z[m].w:Z[m].w),X.push(Z[m].x,e.e?1-Z[m].y:Z[m].y),X.push(Z[m].z,e.e?1-Z[m].y:Z[m].y),P)for(let C=0;C<4;C++)H.push(P[m].r,P[m].g,P[m].b,P[m].a);A.e._ComputeSides(F,t,U,K,X,C.frontUVs,C.backUVs);const d=new A.e;if(d.indices=U,d.yC=t,d.aC=K,d.iC=X,P){const C=F===A.e.DOUBLESIDE?H.concat(H):H;d.rC=C}return d}function z(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new X.b(C,K);U.sideOrientation=X.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return t(U).lC(m,U.updatable),m}A.e.CreateBox=t,X.b.CreateBox=function(C,U){return z(C,{size:U,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13174:(C,U,K)=>{"use strict";K.d(U,{b:()=>e});var m=K(12285),O=K(12265),X=K(11890);function A(C){const U=[],K=[],m=[],A=[],e=C.radius||.5,t=C.tessellation||64,z=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,j=0===C.sideOrientation?0:C.sideOrientation||O.e.DEFAULTSIDE;U.push(0,0,0),A.push(.5,.5);const p=2*Math.PI*z,E=1===z?p/t:p/(t-1);let u=0;for(let O=0;O<t;O++){const C=Math.cos(u),K=Math.sin(u),m=(C+1)/2,O=(1-K)/2;U.push(e*C,e*K,0),A.push(m,X.e?1-O:O),u+=E}1===z&&(U.push(U[3],U[4],U[5]),A.push(A[2],X.e?1-A[3]:A[3]));const b=U.length/3;for(let O=1;O<b-1;O++)K.push(O+1,0,O);O.e.ComputeNormals(U,K,m),O.e._ComputeSides(j,U,K,m,A,C.frontUVs,C.backUVs);const v=new O.e;return v.indices=K,v.yC=U,v.aC=m,v.iC=A,v}function e(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new m.b(C,K);U.sideOrientation=m.b._GetDefaultSideOrientation(U.sideOrientation),O._originalBuilderSideOrientation=U.sideOrientation;return A(U).lC(O,U.updatable),O}O.e.CreateDisc=A,m.b.CreateDisc=function(C,U,K){return e(C,{radius:U,tessellation:K,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13027:(C,U,K)=>{"use strict";K.d(U,{e:()=>Q,d:()=>f,h:()=>V});var m=K(11827),O=K(11879),X=K(12285),A=K(12265),e=K(11905);X.b._GroundMeshParser=(C,U)=>t.Parse(C,U);class t extends X.b{constructor(C,U){super(C,U),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=C,this._subdivisionsY=C,this.subdivide(C);const K=this;K.createOrUpdateSubmeshesOctree&&K.createOrUpdateSubmeshesOctree(U)}getHeightAtCoordinates(C,U){const K=this.getWorldMatrix(),O=m.TmpVectors.Matrix[5];K.invertToRef(O);const X=m.TmpVectors.bU[8];if(m.bU.TransformCoordinatesFromFloatsToRef(C,0,U,O,X),C=X.x,U=X.z,C<this._minX||C>=this._maxX||U<=this._minZ||U>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const A=this._getFacetAt(C,U),e=-(A.x*C+A.z*U+A.w)/A.y;return m.bU.TransformCoordinatesFromFloatsToRef(0,e,0,K,X),X.y}getNormalAtCoordinates(C,U){const K=new m.bU(0,1,0);return this.getNormalAtCoordinatesToRef(C,U,K),K}getNormalAtCoordinatesToRef(C,U,K){const O=this.getWorldMatrix(),X=m.TmpVectors.Matrix[5];O.invertToRef(X);const A=m.TmpVectors.bU[8];if(m.bU.TransformCoordinatesFromFloatsToRef(C,0,U,X,A),C=A.x,U=A.z,C<this._minX||C>this._maxX||U<this._minZ||U>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const e=this._getFacetAt(C,U);return m.bU.TransformNormalFromFloatsToRef(e.x,e.y,e.z,O,K),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(C,U){const K=Math.floor((C+this._maxX)*this._subdivisionsX/this._width),m=Math.floor(-(U+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),O=this._heightQuads[m*this._subdivisionsX+K];let X;return X=U<O.slope.x*C+O.slope.y?O.facet1:O.facet2,X}_initHeightQuads(){const C=this._subdivisionsX,U=this._subdivisionsY;this._heightQuads=[];for(let K=0;K<U;K++)for(let U=0;U<C;U++){const O={slope:m.Vector2.Zero(),facet1:new m.Vector4(0,0,0,0),facet2:new m.Vector4(0,0,0,0)};this._heightQuads[K*C+U]=O}return this}_computeHeightQuads(){const C=this.getVerticesData(e.d.PositionKind);if(!C)return this;const U=m.TmpVectors.bU[3],K=m.TmpVectors.bU[2],O=m.TmpVectors.bU[1],X=m.TmpVectors.bU[0],A=m.TmpVectors.bU[4],t=m.TmpVectors.bU[5],z=m.TmpVectors.bU[6],j=m.TmpVectors.bU[7],p=m.TmpVectors.bU[8];let E=0,u=0,b=0,v=0,Q=0,V=0,f=0;const F=this._subdivisionsX,Z=this._subdivisionsY;for(let e=0;e<Z;e++)for(let Z=0;Z<F;Z++){E=3*Z,u=e*(F+1)*3,b=(e+1)*(F+1)*3,U.x=C[u+E],U.y=C[u+E+1],U.z=C[u+E+2],K.x=C[u+E+3],K.y=C[u+E+4],K.z=C[u+E+5],O.x=C[b+E],O.y=C[b+E+1],O.z=C[b+E+2],X.x=C[b+E+3],X.y=C[b+E+4],X.z=C[b+E+5],v=(X.z-U.z)/(X.x-U.x),Q=U.z-v*U.x,K.subtractToRef(U,A),O.subtractToRef(U,t),X.subtractToRef(U,z),m.bU.CrossToRef(z,t,j),m.bU.CrossToRef(A,z,p),j.normalize(),p.normalize(),V=-(j.x*U.x+j.y*U.y+j.z*U.z),f=-(p.x*K.x+p.y*K.y+p.z*K.z);const P=this._heightQuads[e*F+Z];P.slope.Ee(v,Q),P.facet1.Ee(j.x,j.y,j.z,V),P.facet2.Ee(p.x,p.y,p.z,f)}return this}serialize(C){super.serialize(C),C.subdivisionsX=this._subdivisionsX,C.subdivisionsY=this._subdivisionsY,C.minX=this._minX,C.maxX=this._maxX,C.Ae=this._minZ,C.maxZ=this._maxZ,C.width=this._width,C.height=this._height}static Parse(C,U){const K=new t(C.name,U);return K._subdivisionsX=C.subdivisionsX||1,K._subdivisionsY=C.subdivisionsY||1,K._minX=C.minX,K._maxX=C.maxX,K._minZ=C.Ae,K._maxZ=C.maxZ,K._width=C.width,K._height=C.height,K}}var z=K(11660),j=K(11703),p=K(11835),E=K(11890);function u(C){const U=[],K=[],O=[],X=[];let e,t;const z=C.width||C.size||1,j=C.height||C.size||1,p=0|(C.subdivisionsX||C.subdivisions||1),u=0|(C.subdivisionsY||C.subdivisions||1);for(e=0;e<=u;e++)for(t=0;t<=p;t++){const C=new m.bU(t*z/p-z/2,0,(u-e)*j/u-j/2),U=new m.bU(0,1,0);K.push(C.x,C.y,C.z),O.push(U.x,U.y,U.z),X.push(t/p,E.e?e/u:1-e/u)}for(e=0;e<u;e++)for(t=0;t<p;t++)U.push(t+1+(e+1)*(p+1)),U.push(t+1+e*(p+1)),U.push(t+e*(p+1)),U.push(t+(e+1)*(p+1)),U.push(t+1+(e+1)*(p+1)),U.push(t+e*(p+1));const b=new A.e;return b.indices=U,b.yC=K,b.aC=O,b.iC=X,b}function b(C){const U=void 0!==C.xmin&&null!==C.xmin?C.xmin:-1,K=void 0!==C.zmin&&null!==C.zmin?C.zmin:-1,O=void 0!==C.xmax&&null!==C.xmax?C.xmax:1,X=void 0!==C.zmax&&null!==C.zmax?C.zmax:1,e=C.subdivisions||{w:1,h:1},t=C.precision||{w:1,h:1},z=[],j=[],p=[],E=[];let u,b,v,Q;e.h=e.h<1?1:e.h,e.w=e.w<1?1:e.w,t.w=t.w<1?1:t.w,t.h=t.h<1?1:t.h;const V=(O-U)/e.w,f=(X-K)/e.h;function F(C,U,K,O){const X=j.length/3,A=t.w+1;for(u=0;u<t.h;u++)for(b=0;b<t.w;b++){const C=[X+b+u*A,X+(b+1)+u*A,X+(b+1)+(u+1)*A,X+b+(u+1)*A];z.push(C[1]),z.push(C[2]),z.push(C[3]),z.push(C[0]),z.push(C[1]),z.push(C[3])}const e=m.bU.Zero(),v=new m.bU(0,1,0);for(u=0;u<=t.h;u++)for(e.z=u*(O-U)/t.h+U,b=0;b<=t.w;b++)e.x=b*(K-C)/t.w+C,e.y=0,j.push(e.x,e.y,e.z),p.push(v.x,v.y,v.z),E.push(b/t.w,u/t.h)}for(v=0;v<e.h;v++)for(Q=0;Q<e.w;Q++)F(U+Q*V,K+v*f,U+(Q+1)*V,K+(v+1)*f);const Z=new A.e;return Z.indices=z,Z.yC=j,Z.aC=p,Z.iC=E,Z}function v(C){const U=[],K=[],X=[],e=[];let t,z;const j=C.colorFilter||new O.fU(.3,.59,.11),E=C.alphaFilter||0;let u=!1;if(C.minHeight>C.maxHeight){u=!0;const U=C.maxHeight;C.maxHeight=C.minHeight,C.minHeight=U}for(t=0;t<=C.subdivisions;t++)for(z=0;z<=C.subdivisions;z++){const U=new m.bU(z*C.width/C.subdivisions-C.width/2,0,(C.subdivisions-t)*C.height/C.subdivisions-C.height/2),O=4*(((U.x+C.width/2)/C.width*(C.bufferWidth-1)|0)+((1-(U.z+C.height/2)/C.height)*(C.bufferHeight-1)|0)*C.bufferWidth);let A=C.buffer[O]/255,b=C.buffer[O+1]/255,v=C.buffer[O+2]/255;const Q=C.buffer[O+3]/255;u&&(A=1-A,b=1-b,v=1-v);const V=A*j.r+b*j.g+v*j.b;U.y=Q>=E?C.minHeight+(C.maxHeight-C.minHeight)*V:C.minHeight-p.d,C.heightBuffer&&(C.heightBuffer[t*(C.subdivisions+1)+z]=U.y),K.push(U.x,U.y,U.z),X.push(0,0,0),e.push(z/C.subdivisions,1-t/C.subdivisions)}for(t=0;t<C.subdivisions;t++)for(z=0;z<C.subdivisions;z++){const m=z+1+(t+1)*(C.subdivisions+1),O=z+1+t*(C.subdivisions+1),X=z+t*(C.subdivisions+1),A=z+(t+1)*(C.subdivisions+1),e=K[3*m+1]>=C.minHeight,j=K[3*O+1]>=C.minHeight,p=K[3*X+1]>=C.minHeight;e&&j&&p&&(U.push(m),U.push(O),U.push(X));K[3*A+1]>=C.minHeight&&e&&p&&(U.push(A),U.push(m),U.push(X))}A.e.ComputeNormals(K,U,X);const b=new A.e;return b.indices=U,b.yC=K,b.aC=X,b.iC=e,b}function Q(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const K=new t(C,arguments.length>2?arguments[2]:void 0);K._setReady(!1),K._subdivisionsX=U.subdivisionsX||U.subdivisions||1,K._subdivisionsY=U.subdivisionsY||U.subdivisions||1,K._width=U.width||1,K._height=U.height||1,K._maxX=K._width/2,K._maxZ=K._height/2,K._minX=-K._maxX,K._minZ=-K._maxZ;return u(U).lC(K,U.updatable),K._setReady(!0),K}function V(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new X.b(C,K);return b(U).lC(m,U.updatable),m}function f(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const X=K.width||10,A=K.height||10,e=K.subdivisions||1,p=K.minHeight||0,E=K.maxHeight||1,u=K.colorFilter||new O.fU(.3,.59,.11),b=K.alphaFilter||0,Q=K.updatable,V=K.onReady;m=m||j.c.LastCreatedScene;const f=new t(C,m);let F;f._subdivisionsX=e,f._subdivisionsY=e,f._width=X,f._height=A,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),K.passHeightBufferInCallback&&(F=new Float32Array((e+1)*(e+1)));const Z=(C,U,K)=>{v({width:X,height:A,subdivisions:e,minHeight:p,maxHeight:E,colorFilter:u,buffer:C,bufferWidth:U,bufferHeight:K,alphaFilter:b,heightBuffer:F}).lC(f,Q),V&&V(f,F),f._setReady(!0)};if("string"===typeof U){const C=C=>{var U;const K=C.width,O=C.height;if(m.A)return;const X=null===(U=m)||void 0===U?void 0:U.getEngine().resizeImageBitmap(C,K,O);Z(X,K,O)};z.Tools.LoadImage(U,C,K.onError?K.onError:()=>{},m.offlineProvider)}else Z(U.data,U.width,U.height);return f}A.e.CreateGround=u,A.e.CreateTiledGround=b,A.e.CreateGroundFromHeightMap=v,X.b.CreateGround=(C,U,K,m,O,X)=>Q(C,{width:U,height:K,subdivisions:m,updatable:X},O),X.b.CreateTiledGround=(C,U,K,m,O,X,A,e,t)=>V(C,{xmin:U,zmin:K,xmax:m,zmax:O,subdivisions:X,precision:A,updatable:t},e),X.b.CreateGroundFromHeightMap=(C,U,K,m,O,X,A,e,t,z,j)=>f(C,U,{width:K,height:m,subdivisions:O,minHeight:X,maxHeight:A,updatable:t,onReady:z,alphaFilter:j},e)},13692:(C,U,K)=>{"use strict";K.d(U,{b:()=>u,d:()=>p,e:()=>E});var m=K(11827),O=K(12285),X=K(12265),A=K(12376),e=K(11905),t=K(11679);function z(C){const U=[],K=[],m=C.lines,O=C.rC,A=[];let e=0;for(let X=0;X<m.length;X++){const C=m[X];for(let m=0;m<C.length;m++){const{x:t,y:z,z:j}=C[m];if(K.push(t,z,j),O){const C=O[X],{r:U,g:K,b:e,a:t}=C[m];A.push(U,K,e,t)}m>0&&(U.push(e-1),U.push(e)),e++}}const t=new X.e;return t.indices=U,t.yC=K,O&&(t.rC=A),t}function j(C){const U=C.dashSize||3,K=C.gapSize||1,O=C.dashNb||200,A=C.points,e=[],t=[],z=m.bU.Zero();let j=0,p=0,E=0,u=0,b=0,v=0,Q=0;for(Q=0;Q<A.length-1;Q++)A[Q+1].subtractToRef(A[Q],z),j+=z.length();for(E=j/O,u=U*E/(U+K),Q=0;Q<A.length-1;Q++){A[Q+1].subtractToRef(A[Q],z),p=Math.floor(z.length()/E),z.normalize();for(let C=0;C<p;C++)b=E*C,e.push(A[Q].x+b*z.x,A[Q].y+b*z.y,A[Q].z+b*z.z),e.push(A[Q].x+(b+u)*z.x,A[Q].y+(b+u)*z.y,A[Q].z+(b+u)*z.z),t.push(v,v+1),v+=2}const V=new X.e;return V.yC=e,V.indices=t,V}function p(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=U.instance,O=U.lines,X=U.rC;if(m){const C=m.getVerticesData(e.d.PositionKind);let U,K;X&&(U=m.getVerticesData(e.d.ColorKind));let A=0,t=0;for(let m=0;m<O.length;m++){const e=O[m];for(let O=0;O<e.length;O++)C[A]=e[O].x,C[A+1]=e[O].y,C[A+2]=e[O].z,X&&U&&(K=X[m],U[t]=K[O].r,U[t+1]=K[O].g,U[t+2]=K[O].b,U[t+3]=K[O].a,t+=4),A+=3}return m.updateVerticesData(e.d.PositionKind,C,!1,!1),X&&U&&m.updateVerticesData(e.d.ColorKind,U,!1,!1),m.refreshBoundingInfo(),m}const t=!!X,j=new A.e(C,K,null,void 0,void 0,t,U.useVertexAlpha,U.material);return z(U).lC(j,U.updatable),j}function E(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=U.rC?[U.rC]:null;return p(C,{lines:[U.points],updatable:U.updatable,instance:U.instance,rC:m,useVertexAlpha:U.useVertexAlpha,material:U.material},K)}function u(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=U.points,e=U.instance,z=U.gapSize||1,p=U.dashSize||3;if(e){const C=C=>{const U=m.bU.Zero(),K=C.length/6;let O=0,A=0,t=0,z=0,j=0,p=0,E=0,u=0;for(E=0;E<X.length-1;E++)X[E+1].subtractToRef(X[E],U),O+=U.length();t=O/K;const b=e._creationDataStorage.dashSize;for(z=b*t/(b+e._creationDataStorage.gapSize),E=0;E<X.length-1;E++)for(X[E+1].subtractToRef(X[E],U),A=Math.floor(U.length()/t),U.normalize(),u=0;u<A&&p<C.length;)j=t*u,C[p]=X[E].x+j*U.x,C[p+1]=X[E].y+j*U.y,C[p+2]=X[E].z+j*U.z,C[p+3]=X[E].x+(j+z)*U.x,C[p+4]=X[E].y+(j+z)*U.y,C[p+5]=X[E].z+(j+z)*U.z,p+=6,u++;for(;p<C.length;)C[p]=X[E].x,C[p+1]=X[E].y,C[p+2]=X[E].z,p+=3};return(U.dashNb||U.dashSize||U.gapSize||U.useVertexAlpha||U.material)&&t.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),e.updateMeshPositions(C,!1),e}const E=new A.e(C,K,null,void 0,void 0,void 0,U.useVertexAlpha,U.material);return j(U).lC(E,U.updatable),E._creationDataStorage=new O.d,E._creationDataStorage.dashSize=p,E._creationDataStorage.gapSize=z,E}X.e.CreateLineSystem=z,X.e.CreateDashedLines=j,O.b.az=function(C,U){return E(C,{points:U,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},O.b.CreateDashedLines=function(C,U,K,m,O){return u(C,{points:U,dashSize:K,gapSize:m,dashNb:O,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13079:(C,U,K)=>{"use strict";K.d(U,{b:()=>e,e:()=>t});var m=K(12285),O=K(12265),X=K(11890);function A(C){const U=[],K=[],m=[],A=[],e=void 0!==C.width?C.width:void 0!==C.size?C.size:1,t=void 0!==C.height?C.height:void 0!==C.size?C.size:1,z=0===C.sideOrientation?0:C.sideOrientation||O.e.DEFAULTSIDE,j=e/2,p=t/2;K.push(-j,-p,0),m.push(0,0,-1),A.push(0,X.e?1:0),K.push(j,-p,0),m.push(0,0,-1),A.push(1,X.e?1:0),K.push(j,p,0),m.push(0,0,-1),A.push(1,X.e?0:1),K.push(-j,p,0),m.push(0,0,-1),A.push(0,X.e?0:1),U.push(0),U.push(1),U.push(2),U.push(0),U.push(2),U.push(3),O.e._ComputeSides(z,K,U,m,A,C.frontUVs,C.backUVs);const E=new O.e;return E.indices=U,E.yC=K,E.aC=m,E.iC=A,E}function e(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new m.b(C,K);U.sideOrientation=m.b._GetDefaultSideOrientation(U.sideOrientation),O._originalBuilderSideOrientation=U.sideOrientation;return A(U).lC(O,U.updatable),U.sourcePlane&&(O.translate(U.sourcePlane.normal,-U.sourcePlane.d),O.setDirection(U.sourcePlane.normal.scale(-1))),O}const t={Dz:e};O.e.Dz=A,m.b.Dz=(C,U,K,m,O)=>e(C,{size:U,width:U,height:U,sideOrientation:O,updatable:m},K)},13162:(C,U,K)=>{"use strict";K.d(U,{d:()=>t});var m=K(11827),O=K(12285),X=K(12265),A=K(11890);function e(C){const U=0|(C.segments||32),K=C.diameterX||C.diameter||1,O=C.diameterY||C.diameter||1,e=C.diameterZ||C.diameter||1,t=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,z=C.slice&&C.slice<=0?1:C.slice||1,j=0===C.sideOrientation?0:C.sideOrientation||X.e.DEFAULTSIDE,p=!!C.dedupTopBottomIndices,E=new m.bU(K/2,O/2,e/2),u=2+U,b=2*u,v=[],Q=[],V=[],f=[];for(let X=0;X<=u;X++){const C=X/u,U=C*Math.PI*z;for(let K=0;K<=b;K++){const O=K/b,X=O*Math.PI*2*t,e=m.Matrix.RotationZ(-U),z=m.Matrix.RotationY(X),j=m.bU.TransformCoordinates(m.bU.Up(),e),p=m.bU.TransformCoordinates(j,z),u=p.multiply(E),v=p.divide(E).normalize();Q.push(u.x,u.y,u.z),V.push(v.x,v.y,v.z),f.push(O,A.e?1-C:C)}if(X>0){const C=Q.length/3;for(let U=C-2*(b+1);U+b+2<C;U++)p?(X>1&&(v.push(U),v.push(U+1),v.push(U+b+1)),(X<u||z<1)&&(v.push(U+b+1),v.push(U+1),v.push(U+b+2))):(v.push(U),v.push(U+1),v.push(U+b+1),v.push(U+b+1),v.push(U+1),v.push(U+b+2))}}X.e._ComputeSides(j,Q,v,V,f,C.frontUVs,C.backUVs);const F=new X.e;return F.indices=v,F.yC=Q,F.aC=V,F.iC=f,F}function t(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new O.b(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return e(U).lC(m,U.updatable),m}X.e.CreateSphere=e,O.b.CreateSphere=(C,U,K,m,O,X)=>t(C,{segments:U,diameterX:K,diameterY:K,diameterZ:K,sideOrientation:X,updatable:O},m)},14002:(C,U,K)=>{"use strict";K.d(U,{e:()=>e});var m=K(12396),O=K(13488),X=K(12409),A=K(12265);class e{static get Configuration(){return{get decoder(){return O.c.DefaultConfiguration},set decoder(C){O.c.DefaultConfiguration=C}}}static set Configuration(C){O.c.DefaultConfiguration=C.decoder}static get DecoderAvailable(){return(0,m.e)(O.c.DefaultConfiguration)}static get Default(){return e._Default??(e._Default=new e),e._Default}static ResetDefault(C){e._Default&&(C||e._Default.dispose(),e._Default=null)}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DefaultNumWorkers;const U="number"===typeof C?{...O.c.DefaultConfiguration,numWorkers:C}:{...O.c.DefaultConfiguration,...C};this._decoder=new O.c(U)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(C,U,K){return this._decoder.decodeMeshToMeshDataAsync(C,U,K)}async decodeMeshToGeometryAsync(C,U,K,m){return await this._decoder.decodeMeshToGeometryAsync(C,U,K,m)}async _decodeMeshToGeometryForGltfAsync(C,U,K,m,O,X){return await this._decoder._decodeMeshToGeometryForGltfAsync(C,U,K,m,O,X)}async decodeMeshAsync(C,U){const K=await this._decoder.decodeMeshToMeshDataAsync(C,U),m=new A.e;K.indices&&(m.indices=K.indices);for(const O of K.attributes){const C=X.d.GetFloatData(O.data,O.size,X.d.GetDataType(O.data),O.byteOffset,O.byteStride,O.normalized,K.totalVertices);m.set(C,O.kind)}return m}}e.DefaultNumWorkers=(0,m.d)(),e._Default=null},13488:(C,U,K)=>{"use strict";K.d(U,{c:()=>z});var m=K(12396),O=K(11660),X=K(12296),A=K(12409),e=K(11679),t=K(12400);class z extends m.b{static get DefaultAvailable(){return(0,m.e)(z.DefaultConfiguration)}static get Default(){return z._Default??(z._Default=new z),z._Default}static ResetDefault(C){z._Default&&(C||z._Default.dispose(),z._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(C,U){return{module:await(U||DracoDecoderModule)({wasmBinary:C})}}_getWorkerContent(){return`${t.b}(${t.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.DefaultConfiguration)}decodeMeshToMeshDataAsync(C,U,K){const m=C instanceof ArrayBuffer?new Int8Array(C):new Int8Array(C.buffer,C.byteOffset,C.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async C=>await new Promise(((O,X)=>{C.push(((C,A)=>{let t=null;const z=[],j=U=>{C.removeEventListener("error",j),C.removeEventListener("message",p),X(U),A()},p=U=>{const m=U.data;switch(m.id){case"indices":t=m.data;break;case"attribute":z.push({kind:m.kind,data:m.data,size:m.size,byteOffset:m.byteOffset,byteStride:m.byteStride,normalized:(X=m.kind,E=m.normalized,K&&void 0!==K[X]?(E!==K[X]&&e.d.Warn(`Normalized flag from Draco data (${E}) does not match normalized flag from glTF accessor (${K[X]}). Using flag from glTF accessor.`),K[X]):E)});break;case"decodeMeshDone":C.removeEventListener("error",j),C.removeEventListener("message",p),O({indices:t,attributes:z,totalVertices:m.totalVertices}),A()}var X,E};C.addEventListener("error",j),C.addEventListener("message",p);const E=m.slice();C.postMessage({id:"decodeMesh",dataView:E,attributes:U},[E.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((C=>{let K=null;const O=[],X=(0,t.b)(C.module,m,U,(C=>{K=C}),((C,U,K,m,X,A)=>{O.push({kind:C,data:U,size:K,byteOffset:m,byteStride:X,normalized:A})}));return{indices:K,attributes:O,totalVertices:X}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(C,U,K,m){const O=await this.decodeMeshToMeshDataAsync(K,m),e=new X.d(C,U);O.indices&&e.setIndices(O.indices);for(const X of O.attributes)e.setVerticesBuffer(new A.d(U.getEngine(),X.data,X.kind,!1,void 0,X.byteStride,void 0,X.byteOffset,X.size,void 0,X.normalized,!0),O.totalVertices);return e}async _decodeMeshToGeometryForGltfAsync(C,U,K,m,O,e){const t=await this.decodeMeshToMeshDataAsync(K,m,O),z=new X.d(C,U);e&&(z._boundingInfo=e,z.useBoundingInfoFromGeometry=!0),t.indices&&z.setIndices(t.indices);for(const X of t.attributes)z.setVerticesBuffer(new A.d(U.getEngine(),X.data,X.kind,!1,void 0,X.byteStride,void 0,X.byteOffset,X.size,void 0,X.normalized,!0),t.totalVertices);return z}}z.DefaultConfiguration={wasmUrl:`${O.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${O.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${O.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},z._Default=null},13684:(C,U,K)=>{"use strict";K.d(U,{c:()=>eC});var m=K(11827),O=K(12285),X=K(11905),A=K(12265),e=K(11890);function t(C){let U=C.pathArray;const K=C.closeArray||!1,m=C.closePath||!1,O=C.invertUV||!1,t=Math.floor(U[0].length/2);let z=C.offset||t;z=z>t?t:Math.floor(z);const j=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE,p=C.iC,E=C.rC,u=[],b=[],v=[],Q=[],V=[],f=[],F=[],Z=[];let P;const H=[],d=[];let T,y,a;if(U.length<2){const C=[],K=[];for(y=0;y<U[0].length-z;y++)C.push(U[0][y]),K.push(U[0][y+z]);U=[C,K]}let r=0;const i=m?1:0,D=K?1:0;let l,G,J,o,B,k;for(P=U[0].length,T=0;T<U.length+D;T++){for(F[T]=0,V[T]=[0],l=T===U.length?U[0]:U[T],G=l.length,P=P<G?P:G,a=0;a<G;)u.push(l[a].x,l[a].y,l[a].z),a>0&&(J=l[a].vU(l[a-1]).length(),o=J+F[T],V[T].push(o),F[T]=o),a++;m&&(a--,u.push(l[0].x,l[0].y,l[0].z),J=l[a].vU(l[0]).length(),o=J+F[T],V[T].push(o),F[T]=o),H[T]=G+i,d[T]=r,r+=G+i}let w,h,c=null,N=null;for(y=0;y<P+i;y++)for(Z[y]=0,f[y]=[0],T=0;T<U.length-1+D;T++)B=U[T],k=T===U.length-1?U[0]:U[T+1],y===P?(c=B[0],N=k[0]):(c=B[y],N=k[y]),J=N.vU(c).length(),o=J+Z[y],f[y].push(o),Z[y]=o;if(p)for(T=0;T<p.length;T++)Q.push(p[T].x,e.e?1-p[T].y:p[T].y);else for(T=0;T<U.length+D;T++)for(y=0;y<P+i;y++)w=0!=F[T]?V[T][y]/F[T]:0,h=0!=Z[y]?f[y][T]/Z[y]:0,O?Q.push(h,w):Q.push(w,e.e?1-h:h);T=0;let g=0,M=H[T]-1,L=H[T+1]-1,Y=M<L?M:L,W=d[1]-d[0];const x=H.length-1;for(;g<=Y&&T<x;)b.push(g,g+W,g+1),b.push(g+W+1,g+1,g+W),g+=1,g===Y&&(T++,W=d[T+1]-d[T],M=H[T]-1,L=H[T+1]-1,g=d[T],Y=M<L?M+g:L+g);if(A.e.ComputeNormals(u,b,v),m){let C=0,K=0;for(T=0;T<U.length;T++){C=3*d[T],K=T+1<U.length?3*(d[T+1]-1):v.length-3,v[C]=.5*(v[C]+v[K]),v[C+1]=.5*(v[C+1]+v[K+1]),v[C+2]=.5*(v[C+2]+v[K+2]);const m=Math.sqrt(v[C]*v[C]+v[C+1]*v[C+1]+v[C+2]*v[C+2]);v[C]/=m,v[C+1]/=m,v[C+2]/=m,v[K]=v[C],v[K+1]=v[C+1],v[K+2]=v[C+2]}}if(K){let C=3*d[0],K=3*d[U.length];for(y=0;y<P+i;y++){v[C]=.5*(v[C]+v[K]),v[C+1]=.5*(v[C+1]+v[K+1]),v[C+2]=.5*(v[C+2]+v[K+2]);const U=Math.sqrt(v[C]*v[C]+v[C+1]*v[C+1]+v[C+2]*v[C+2]);v[C]/=U,v[C+1]/=U,v[C+2]/=U,v[K]=v[C],v[K+1]=v[C+1],v[K+2]=v[C+2],C+=3,K+=3}}A.e._ComputeSides(j,u,b,v,Q,C.frontUVs,C.backUVs);let n=null;if(E){n=new Float32Array(4*E.length);for(let C=0;C<E.length;C++)n[4*C]=E[C].r,n[4*C+1]=E[C].g,n[4*C+2]=E[C].b,n[4*C+3]=E[C].a}const S=new A.e,s=new Float32Array(u),R=new Float32Array(v),q=new Float32Array(Q);return S.indices=b,S.yC=s,S.aC=R,S.iC=q,n&&S.set(n,X.d.ColorKind),m&&(S._idx=d),S}function z(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=U.pathArray,j=U.closeArray,p=U.closePath,E=O.b._GetDefaultSideOrientation(U.sideOrientation),u=U.instance,b=U.updatable;if(u){const C=m.TmpVectors.bU[0].be(Number.MAX_VALUE),K=m.TmpVectors.bU[1].be(-Number.MAX_VALUE),t=U=>{let m=z[0].length;const X=u;let A=0;const e=X._originalBuilderSideOrientation===O.b.DOUBLESIDE?2:1;for(let O=1;O<=e;++O)for(let e=0;e<z.length;++e){const O=z[e],t=O.length;m=m<t?m:t;for(let X=0;X<m;++X){const m=O[X];U[A]=m.x,U[A+1]=m.y,U[A+2]=m.z,C.minimizeInPlaceFromFloats(m.x,m.y,m.z),K.maximizeInPlaceFromFloats(m.x,m.y,m.z),A+=3}if(X._creationDataStorage&&X._creationDataStorage.closePath){const C=O[0];U[A]=C.x,U[A+1]=C.y,U[A+2]=C.z,A+=3}}},j=u.getVerticesData(X.d.PositionKind);if(t(j),u.hasBoundingInfo?u.getBoundingInfo().reConstruct(C,K,u._worldMatrix):u.buildBoundingInfo(C,K,u._worldMatrix),u.updateVerticesData(X.d.PositionKind,j,!1,!1),U.rC){const C=u.getVerticesData(X.d.ColorKind);for(let K=0,m=0;K<U.rC.length;K++,m+=4){const O=U.rC[K];C[m]=O.r,C[m+1]=O.g,C[m+2]=O.b,C[m+3]=O.a}u.updateVerticesData(X.d.ColorKind,C,!1,!1)}if(U.iC){const C=u.getVerticesData(X.d.UVKind);for(let K=0;K<U.iC.length;K++)C[2*K]=U.iC[K].x,C[2*K+1]=e.e?1-U.iC[K].y:U.iC[K].y;u.updateVerticesData(X.d.UVKind,C,!1,!1)}if(!u.areNormalsFrozen||u.isFacetDataEnabled){const C=u.je(),U=u.getVerticesData(X.d.NormalKind),K=u.isFacetDataEnabled?u.getFacetDataParameters():null;if(A.e.ComputeNormals(j,C,U,K),u._creationDataStorage&&u._creationDataStorage.closePath){let C=0,K=0;for(let m=0;m<z.length;m++)C=3*u._creationDataStorage.idx[m],K=m+1<z.length?3*(u._creationDataStorage.idx[m+1]-1):U.length-3,U[C]=.5*(U[C]+U[K]),U[C+1]=.5*(U[C+1]+U[K+1]),U[C+2]=.5*(U[C+2]+U[K+2]),U[K]=U[C],U[K+1]=U[C+1],U[K+2]=U[C+2]}u.areNormalsFrozen||u.updateVerticesData(X.d.NormalKind,U,!1,!1)}return u}{const m=new O.b(C,K);m._originalBuilderSideOrientation=E,m._creationDataStorage=new O.d;const X=t(U);return p&&(m._creationDataStorage.idx=X._idx),m._creationDataStorage.closePath=p,m._creationDataStorage.closeArray=j,X.lC(m,b),m}}A.e.CreateRibbon=t,O.b.CreateRibbon=function(C,U){return z(C,{pathArray:U,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var j=K(13174),p=K(13022),E=K(11879);function u(C){const U=C.pattern||O.b.NO_FLIP,K=C.tileWidth||C.tileSize||1,m=C.tileHeight||C.tileSize||1,X=C.alignHorizontal||0,e=C.alignVertical||0,t=C.width||C.size||1,z=Math.floor(t/K);let j=t-z*K;const p=C.height||C.size||1,E=Math.floor(p/m);let u=p-E*m;const b=K*z/2,v=m*E/2;let Q=0,V=0,f=0,F=0,Z=0,P=0;if(j>0||u>0){switch(f=-b,F=-v,Z=b,P=v,X){case O.b.CENTER:j/=2,f-=j,Z+=j;break;case O.b.LEFT:Z+=j,Q=-j/2;break;case O.b.RIGHT:f-=j,Q=j/2}switch(e){case O.b.CENTER:u/=2,F-=u,P+=u;break;case O.b.BOTTOM:P+=u,V=-u/2;break;case O.b.TOP:F-=u,V=u/2}}const H=[],d=[],T=[];T[0]=[0,0,1,0,1,1,0,1],T[1]=[0,0,1,0,1,1,0,1],U!==O.b.ROTATE_TILE&&U!==O.b.ROTATE_ROW||(T[1]=[1,1,0,1,0,0,1,0]),U!==O.b.FLIP_TILE&&U!==O.b.FLIP_ROW||(T[1]=[1,0,0,0,0,1,1,1]),U!==O.b.FLIP_N_ROTATE_TILE&&U!==O.b.FLIP_N_ROTATE_ROW||(T[1]=[0,1,1,1,1,0,0,0]);let y=[];const a=[],r=[];let i=0;for(let A=0;A<E;A++)for(let C=0;C<z;C++)H.push(C*K-b+Q,A*m-v+V,0),H.push((C+1)*K-b+Q,A*m-v+V,0),H.push((C+1)*K-b+Q,(A+1)*m-v+V,0),H.push(C*K-b+Q,(A+1)*m-v+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),y=U===O.b.FLIP_TILE||U===O.b.ROTATE_TILE||U===O.b.FLIP_N_ROTATE_TILE?y.concat(T[(C%2+A%2)%2]):U===O.b.FLIP_ROW||U===O.b.ROTATE_ROW||U===O.b.FLIP_N_ROTATE_ROW?y.concat(T[A%2]):y.concat(T[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),i+=4;if(j>0||u>0){const C=u>0&&(e===O.b.CENTER||e===O.b.TOP),A=u>0&&(e===O.b.CENTER||e===O.b.BOTTOM),t=j>0&&(X===O.b.CENTER||X===O.b.RIGHT),p=j>0&&(X===O.b.CENTER||X===O.b.LEFT);let T,D,l,G,J=[];if(C&&t&&(H.push(f+Q,F+V,0),H.push(-b+Q,F+V,0),H.push(-b+Q,F+u+V,0),H.push(f+Q,F+u+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,T=1-j/K,D=1-u/m,l=1,G=1,J=[T,D,l,D,l,G,T,G],U===O.b.ROTATE_ROW&&(J=[1-T,1-D,1-l,1-D,1-l,1-G,1-T,1-G]),U===O.b.FLIP_ROW&&(J=[1-T,D,1-l,D,1-l,G,1-T,G]),U===O.b.FLIP_N_ROTATE_ROW&&(J=[T,1-D,l,1-D,l,1-G,T,1-G]),y=y.concat(J),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),C&&p&&(H.push(b+Q,F+V,0),H.push(Z+Q,F+V,0),H.push(Z+Q,F+u+V,0),H.push(b+Q,F+u+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,T=0,D=1-u/m,l=j/K,G=1,J=[T,D,l,D,l,G,T,G],(U===O.b.ROTATE_ROW||U===O.b.ROTATE_TILE&&z%2===0)&&(J=[1-T,1-D,1-l,1-D,1-l,1-G,1-T,1-G]),(U===O.b.FLIP_ROW||U===O.b.FLIP_TILE&&z%2===0)&&(J=[1-T,D,1-l,D,1-l,G,1-T,G]),(U===O.b.FLIP_N_ROTATE_ROW||U===O.b.FLIP_N_ROTATE_TILE&&z%2===0)&&(J=[T,1-D,l,1-D,l,1-G,T,1-G]),y=y.concat(J),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&t&&(H.push(f+Q,v+V,0),H.push(-b+Q,v+V,0),H.push(-b+Q,P+V,0),H.push(f+Q,P+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,T=1-j/K,D=0,l=1,G=u/m,J=[T,D,l,D,l,G,T,G],(U===O.b.ROTATE_ROW&&E%2===1||U===O.b.ROTATE_TILE&&E%1===0)&&(J=[1-T,1-D,1-l,1-D,1-l,1-G,1-T,1-G]),(U===O.b.FLIP_ROW&&E%2===1||U===O.b.FLIP_TILE&&E%2===0)&&(J=[1-T,D,1-l,D,1-l,G,1-T,G]),(U===O.b.FLIP_N_ROTATE_ROW&&E%2===1||U===O.b.FLIP_N_ROTATE_TILE&&E%2===0)&&(J=[T,1-D,l,1-D,l,1-G,T,1-G]),y=y.concat(J),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&p&&(H.push(b+Q,v+V,0),H.push(Z+Q,v+V,0),H.push(Z+Q,P+V,0),H.push(b+Q,P+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,T=0,D=0,l=j/K,G=u/m,J=[T,D,l,D,l,G,T,G],(U===O.b.ROTATE_ROW&&E%2===1||U===O.b.ROTATE_TILE&&(E+z)%2===1)&&(J=[1-T,1-D,1-l,1-D,1-l,1-G,1-T,1-G]),(U===O.b.FLIP_ROW&&E%2===1||U===O.b.FLIP_TILE&&(E+z)%2===1)&&(J=[1-T,D,1-l,D,1-l,G,1-T,G]),(U===O.b.FLIP_N_ROTATE_ROW&&E%2===1||U===O.b.FLIP_N_ROTATE_TILE&&(E+z)%2===1)&&(J=[T,1-D,l,1-D,l,1-G,T,1-G]),y=y.concat(J),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),C){const C=[];T=0,D=1-u/m,l=1,G=1,C[0]=[T,D,l,D,l,G,T,G],C[1]=[T,D,l,D,l,G,T,G],U!==O.b.ROTATE_TILE&&U!==O.b.ROTATE_ROW||(C[1]=[1-T,1-D,1-l,1-D,1-l,1-G,1-T,1-G]),U!==O.b.FLIP_TILE&&U!==O.b.FLIP_ROW||(C[1]=[1-T,D,1-l,D,1-l,G,1-T,G]),U!==O.b.FLIP_N_ROTATE_TILE&&U!==O.b.FLIP_N_ROTATE_ROW||(C[1]=[T,1-D,l,1-D,l,1-G,T,1-G]);for(let m=0;m<z;m++)H.push(m*K-b+Q,F+V,0),H.push((m+1)*K-b+Q,F+V,0),H.push((m+1)*K-b+Q,F+u+V,0),H.push(m*K-b+Q,F+u+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,y=U===O.b.FLIP_TILE||U===O.b.ROTATE_TILE||U===O.b.FLIP_N_ROTATE_TILE?y.concat(C[(m+1)%2]):U===O.b.FLIP_ROW||U===O.b.ROTATE_ROW||U===O.b.FLIP_N_ROTATE_ROW?y.concat(C[1]):y.concat(C[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(A){const C=[];T=0,D=0,l=1,G=u/m,C[0]=[T,D,l,D,l,G,T,G],C[1]=[T,D,l,D,l,G,T,G],U!==O.b.ROTATE_TILE&&U!==O.b.ROTATE_ROW||(C[1]=[1-T,1-D,1-l,1-D,1-l,1-G,1-T,1-G]),U!==O.b.FLIP_TILE&&U!==O.b.FLIP_ROW||(C[1]=[1-T,D,1-l,D,1-l,G,1-T,G]),U!==O.b.FLIP_N_ROTATE_TILE&&U!==O.b.FLIP_N_ROTATE_ROW||(C[1]=[T,1-D,l,1-D,l,1-G,T,1-G]);for(let m=0;m<z;m++)H.push(m*K-b+Q,P-u+V,0),H.push((m+1)*K-b+Q,P-u+V,0),H.push((m+1)*K-b+Q,P+V,0),H.push(m*K-b+Q,P+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,y=U===O.b.FLIP_TILE||U===O.b.ROTATE_TILE||U===O.b.FLIP_N_ROTATE_TILE?y.concat(C[(m+E)%2]):U===O.b.FLIP_ROW||U===O.b.ROTATE_ROW||U===O.b.FLIP_N_ROTATE_ROW?y.concat(C[E%2]):y.concat(C[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const C=[];T=1-j/K,D=0,l=1,G=1,C[0]=[T,D,l,D,l,G,T,G],C[1]=[T,D,l,D,l,G,T,G],U!==O.b.ROTATE_TILE&&U!==O.b.ROTATE_ROW||(C[1]=[1-T,1-D,1-l,1-D,1-l,1-G,1-T,1-G]),U!==O.b.FLIP_TILE&&U!==O.b.FLIP_ROW||(C[1]=[1-T,D,1-l,D,1-l,G,1-T,G]),U!==O.b.FLIP_N_ROTATE_TILE&&U!==O.b.FLIP_N_ROTATE_ROW||(C[1]=[T,1-D,l,1-D,l,1-G,T,1-G]);for(let K=0;K<E;K++)H.push(f+Q,K*m-v+V,0),H.push(f+j+Q,K*m-v+V,0),H.push(f+j+Q,(K+1)*m-v+V,0),H.push(f+Q,(K+1)*m-v+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,y=U===O.b.FLIP_TILE||U===O.b.ROTATE_TILE||U===O.b.FLIP_N_ROTATE_TILE?y.concat(C[(K+1)%2]):U===O.b.FLIP_ROW||U===O.b.ROTATE_ROW||U===O.b.FLIP_N_ROTATE_ROW?y.concat(C[K%2]):y.concat(C[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const C=[];T=0,D=0,l=j/m,G=1,C[0]=[T,D,l,D,l,G,T,G],C[1]=[T,D,l,D,l,G,T,G],U!==O.b.ROTATE_TILE&&U!==O.b.ROTATE_ROW||(C[1]=[1-T,1-D,1-l,1-D,1-l,1-G,1-T,1-G]),U!==O.b.FLIP_TILE&&U!==O.b.FLIP_ROW||(C[1]=[1-T,D,1-l,D,1-l,G,1-T,G]),U!==O.b.FLIP_N_ROTATE_TILE&&U!==O.b.FLIP_N_ROTATE_ROW||(C[1]=[T,1-D,l,1-D,l,1-G,T,1-G]);for(let K=0;K<E;K++)H.push(Z-j+Q,K*m-v+V,0),H.push(Z+Q,K*m-v+V,0),H.push(Z+Q,(K+1)*m-v+V,0),H.push(Z-j+Q,(K+1)*m-v+V,0),r.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,y=U===O.b.FLIP_TILE||U===O.b.ROTATE_TILE||U===O.b.FLIP_N_ROTATE_TILE?y.concat(C[(K+z)%2]):U===O.b.FLIP_ROW||U===O.b.ROTATE_ROW||U===O.b.FLIP_N_ROTATE_ROW?y.concat(C[K%2]):y.concat(C[0]),a.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const D=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE;A.e._ComputeSides(D,H,r,d,y,C.frontUVs,C.backUVs);const l=new A.e;l.indices=r,l.yC=H,l.aC=d,l.iC=y;const G=D===A.e.DOUBLESIDE?a.concat(a):a;return l.rC=G,l}function b(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new O.b(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return u(U).lC(m,U.updatable),m}function v(C){const U=C.faceUV||new Array(6),K=C.faceColors,X=C.pattern||O.b.NO_FLIP,t=C.width||C.size||1,z=C.height||C.size||1,j=C.depth||C.size||1,p=C.tileWidth||C.tileSize||1,b=C.tileHeight||C.tileSize||1,v=C.alignHorizontal||0,Q=C.alignVertical||0,V=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE;for(let O=0;O<6;O++)void 0===U[O]&&(U[O]=new m.Vector4(0,0,1,1)),K&&void 0===K[O]&&(K[O]=new E.ve(1,1,1,1));const f=t/2,F=z/2,Z=j/2,P=[];for(let m=0;m<2;m++)P[m]=u({pattern:X,tileWidth:p,tileHeight:b,width:t,height:z,alignVertical:Q,alignHorizontal:v,sideOrientation:V});for(let m=2;m<4;m++)P[m]=u({pattern:X,tileWidth:p,tileHeight:b,width:j,height:z,alignVertical:Q,alignHorizontal:v,sideOrientation:V});let H=Q;Q===O.b.BOTTOM?H=O.b.TOP:Q===O.b.TOP&&(H=O.b.BOTTOM);for(let m=4;m<6;m++)P[m]=u({pattern:X,tileWidth:p,tileHeight:b,width:t,height:j,alignVertical:H,alignHorizontal:v,sideOrientation:V});let d=[],T=[],y=[],a=[];const r=[],i=[],D=[],l=[];let G=0,J=0;for(let O=0;O<6;O++){const C=P[O].yC.length;i[O]=[],D[O]=[];for(let U=0;U<C/3;U++)i[O].push(new m.bU(P[O].yC[3*U],P[O].yC[3*U+1],P[O].yC[3*U+2])),D[O].push(new m.bU(P[O].aC[3*U],P[O].aC[3*U+1],P[O].aC[3*U+2]));G=P[O].iC.length,l[O]=[];for(let K=0;K<G;K+=2)l[O][K]=U[O].x+(U[O].z-U[O].x)*P[O].iC[K],l[O][K+1]=U[O].y+(U[O].w-U[O].y)*P[O].iC[K+1],e.e&&(l[O][K+1]=1-l[O][K+1]);if(y=y.concat(l[O]),a=a.concat(P[O].indices.map((C=>C+J))),J+=i[O].length,K)for(let U=0;U<4;U++)r.push(K[O].r,K[O].g,K[O].b,K[O].a)}const o=new m.bU(0,0,Z),B=m.Matrix.RotationY(Math.PI);d=i[0].map((C=>m.bU.TransformNormal(C,B).add(o))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[]),T=D[0].map((C=>m.bU.TransformNormal(C,B))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[]),d=d.concat(i[1].map((C=>C.vU(o))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[])),T=T.concat(D[1].map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[]));const k=new m.bU(f,0,0),w=m.Matrix.RotationY(-Math.PI/2);d=d.concat(i[2].map((C=>m.bU.TransformNormal(C,w).add(k))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[])),T=T.concat(D[2].map((C=>m.bU.TransformNormal(C,w))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[]));const h=m.Matrix.RotationY(Math.PI/2);d=d.concat(i[3].map((C=>m.bU.TransformNormal(C,h).vU(k))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[])),T=T.concat(D[3].map((C=>m.bU.TransformNormal(C,h))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[]));const c=new m.bU(0,F,0),N=m.Matrix.RotationX(Math.PI/2);d=d.concat(i[4].map((C=>m.bU.TransformNormal(C,N).add(c))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[])),T=T.concat(D[4].map((C=>m.bU.TransformNormal(C,N))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[]));const g=m.Matrix.RotationX(-Math.PI/2);d=d.concat(i[5].map((C=>m.bU.TransformNormal(C,g).vU(c))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[])),T=T.concat(D[5].map((C=>m.bU.TransformNormal(C,g))).map((C=>[C.x,C.y,C.z])).reduce(((C,U)=>C.concat(U)),[])),A.e._ComputeSides(V,d,a,T,y);const M=new A.e;if(M.indices=a,M.yC=d,M.aC=T,M.iC=y,K){const C=V===A.e.DOUBLESIDE?r.concat(r):r;M.rC=C}return M}function Q(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new O.b(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return v(U).lC(m,U.updatable),m}A.e.CreateTiledPlane=u;A.e.CreateTiledBox=v;var V=K(13162),f=K(12078),F=K(12029);function Z(C){const U=C.height||2;let K=0===C.diameterTop?0:C.diameterTop||C.diameter||1,X=0===C.diameterBottom?0:C.diameterBottom||C.diameter||1;K=K||1e-5,X=X||1e-5;const t=0|(C.tessellation||24),z=0|(C.subdivisions||1),j=!!C.hasRings,p=!!C.enclose,u=0===C.cap?0:C.cap||O.b.CAP_ALL,b=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,v=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE,Q=C.faceUV||new Array(3),V=C.faceColors,f=2+(1+(1!==b&&p?2:0))*(j?z:1);let Z;for(Z=0;Z<f;Z++)V&&void 0===V[Z]&&(V[Z]=new E.ve(1,1,1,1));for(Z=0;Z<f;Z++)Q&&void 0===Q[Z]&&(Q[Z]=new m.Vector4(0,0,1,1));const P=[],H=[],d=[],T=[],y=[],a=2*Math.PI*b/t;let r,i,D;const l=(X-K)/2/U,G=m.bU.Zero(),J=m.bU.Zero(),o=m.bU.Zero(),B=m.bU.Zero(),k=m.bU.Zero(),w=F.b.Y;let h,c,N,g=1,M=1,L=0,Y=0;for(h=0;h<=z;h++)for(i=h/z,D=(i*(K-X)+X)/2,g=j&&0!==h&&h!==z?2:1,N=0;N<g;N++){for(j&&(M+=N),p&&(M+=2*N),c=0;c<=t;c++)r=c*a,G.x=Math.cos(-r)*D,G.y=-U/2+i*U,G.z=Math.sin(-r)*D,0===K&&h===z?(J.x=d[d.length-3*(t+1)],J.y=d[d.length-3*(t+1)+1],J.z=d[d.length-3*(t+1)+2]):(J.x=G.x,J.z=G.z,J.y=Math.sqrt(J.x*J.x+J.z*J.z)*l,J.normalize()),0===c&&(o.m(G),B.m(J)),H.push(G.x,G.y,G.z),d.push(J.x,J.y,J.z),Y=j?L!==M?Q[M].y:Q[M].w:Q[M].y+(Q[M].w-Q[M].y)*i,T.push(Q[M].x+(Q[M].z-Q[M].x)*c/t,e.e?1-Y:Y),V&&y.push(V[M].r,V[M].g,V[M].b,V[M].a);1!==b&&p&&(H.push(G.x,G.y,G.z),H.push(0,G.y,0),H.push(0,G.y,0),H.push(o.x,o.y,o.z),m.bU.CrossToRef(w,J,k),k.normalize(),d.push(k.x,k.y,k.z,k.x,k.y,k.z),m.bU.CrossToRef(B,w,k),k.normalize(),d.push(k.x,k.y,k.z,k.x,k.y,k.z),Y=j?L!==M?Q[M+1].y:Q[M+1].w:Q[M+1].y+(Q[M+1].w-Q[M+1].y)*i,T.push(Q[M+1].x,e.e?1-Y:Y),T.push(Q[M+1].z,e.e?1-Y:Y),Y=j?L!==M?Q[M+2].y:Q[M+2].w:Q[M+2].y+(Q[M+2].w-Q[M+2].y)*i,T.push(Q[M+2].x,e.e?1-Y:Y),T.push(Q[M+2].z,e.e?1-Y:Y),V&&(y.push(V[M+1].r,V[M+1].g,V[M+1].b,V[M+1].a),y.push(V[M+1].r,V[M+1].g,V[M+1].b,V[M+1].a),y.push(V[M+2].r,V[M+2].g,V[M+2].b,V[M+2].a),y.push(V[M+2].r,V[M+2].g,V[M+2].b,V[M+2].a))),L!==M&&(L=M)}const W=1!==b&&p?t+4:t;for(h=0,M=0;M<z;M++){let C=0,U=0,K=0,m=0;for(c=0;c<t;c++)C=h*(W+1)+c,U=(h+1)*(W+1)+c,K=h*(W+1)+(c+1),m=(h+1)*(W+1)+(c+1),P.push(C,U,K),P.push(m,K,U);1!==b&&p&&(P.push(C+2,U+2,K+2),P.push(m+2,K+2,U+2),P.push(C+4,U+4,K+4),P.push(m+4,K+4,U+4)),h=j?h+2:h+1}const x=C=>{const O=C?K/2:X/2;if(0===O)return;let A,z,j;const p=C?Q[f-1]:Q[0];let E=null;V&&(E=C?V[f-1]:V[0]);const u=H.length/3,v=C?U/2:-U/2,F=new m.bU(0,v,0);H.push(F.x,F.y,F.z),d.push(0,C?1:-1,0);const Z=p.y+.5*(p.w-p.y);T.push(p.x+.5*(p.z-p.x),e.e?1-Z:Z),E&&y.push(E.r,E.g,E.b,E.a);const a=new m.Vector2(.5,.5);for(j=0;j<=t;j++){A=2*Math.PI*j*b/t;const U=Math.cos(-A),K=Math.sin(-A);z=new m.bU(U*O,v,K*O);const X=new m.Vector2(U*a.x+.5,K*a.y+.5);H.push(z.x,z.y,z.z),d.push(0,C?1:-1,0);const u=p.y+(p.w-p.y)*X.y;T.push(p.x+(p.z-p.x)*X.x,e.e?1-u:u),E&&y.push(E.r,E.g,E.b,E.a)}for(j=0;j<t;j++)C?(P.push(u),P.push(u+(j+2)),P.push(u+(j+1))):(P.push(u),P.push(u+(j+1)),P.push(u+(j+2)))};u!==O.b.CAP_START&&u!==O.b.CAP_ALL||x(!1),u!==O.b.CAP_END&&u!==O.b.CAP_ALL||x(!0),A.e._ComputeSides(v,H,P,d,T,C.frontUVs,C.backUVs);const n=new A.e;return n.indices=P,n.yC=H,n.aC=d,n.iC=T,V&&(n.rC=y),n}function P(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;const m=new O.b(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return Z(U).lC(m,U.updatable),m}function H(C){const U=[],K=[],O=[],X=[],t=C.diameter||1,z=C.thickness||.5,j=0|(C.tessellation||16),p=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE,E=j+1;for(let A=0;A<=j;A++){const C=A/j,p=A*Math.PI*2/j-Math.PI/2,u=m.Matrix.Translation(t/2,0,0).multiply(m.Matrix.RotationY(p));for(let t=0;t<=j;t++){const p=1-t/j,b=t*Math.PI*2/j+Math.PI,v=Math.cos(b),Q=Math.sin(b);let V=new m.bU(v,Q,0),f=V.scale(z/2);const F=new m.Vector2(C,p);f=m.bU.TransformCoordinates(f,u),V=m.bU.TransformNormal(V,u),K.push(f.x,f.y,f.z),O.push(V.x,V.y,V.z),X.push(F.x,e.e?1-F.y:F.y);const Z=(A+1)%E,P=(t+1)%E;U.push(A*E+t),U.push(A*E+P),U.push(Z*E+t),U.push(A*E+P),U.push(Z*E+P),U.push(Z*E+t)}}A.e._ComputeSides(p,K,U,O,X,C.frontUVs,C.backUVs);const u=new A.e;return u.indices=U,u.yC=K,u.aC=O,u.iC=X,u}function d(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;const m=new O.b(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return H(U).lC(m,U.updatable),m}A.e.CreateCylinder=Z,O.b.CreateCylinder=(C,U,K,m,X,A,e,t,z)=>{void 0!==e&&e instanceof f.b||(void 0!==e&&(z=t||O.b.DEFAULTSIDE,t=e),e=A,A=1);return P(C,{height:U,diameterTop:K,diameterBottom:m,tessellation:X,subdivisions:A,sideOrientation:z,updatable:t},e)};function T(C){const U=[],K=[],O=[],X=[],t=C.radius||2,z=C.tube||.5,j=C.radialSegments||32,p=C.tubularSegments||32,E=C.p||2,u=C.q||3,b=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE,v=C=>{const U=Math.cos(C),K=Math.sin(C),O=u/E*C,X=Math.cos(O),A=t*(2+X)*.5*U,e=t*(2+X)*K*.5,z=t*Math.sin(O)*.5;return new m.bU(A,e,z)};let Q,V;for(Q=0;Q<=j;Q++){const C=Q%j/j*2*E*Math.PI,U=v(C),O=v(C+.01),A=O.vU(U);let t=O.add(U);const u=m.bU.Cross(A,t);for(t=m.bU.Cross(u,A),u.normalize(),t.normalize(),V=0;V<p;V++){const C=V%p/p*2*Math.PI,m=-z*Math.cos(C),O=z*Math.sin(C);K.push(U.x+m*t.x+O*u.x),K.push(U.y+m*t.y+O*u.y),K.push(U.z+m*t.z+O*u.z),X.push(Q/j),X.push(e.e?1-V/p:V/p)}}for(Q=0;Q<j;Q++)for(V=0;V<p;V++){const C=(V+1)%p,K=Q*p+V,m=(Q+1)*p+V,O=(Q+1)*p+C,X=Q*p+C;U.push(X),U.push(m),U.push(K),U.push(X),U.push(O),U.push(m)}A.e.ComputeNormals(K,U,O),A.e._ComputeSides(b,K,U,O,X,C.frontUVs,C.backUVs);const f=new A.e;return f.indices=U,f.yC=K,f.aC=O,f.iC=X,f}function y(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;const m=new O.b(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return T(U).lC(m,U.updatable),m}A.e.CreateTorus=H,O.b.CreateTorus=(C,U,K,m,O,X,A)=>d(C,{diameter:U,thickness:K,tessellation:m,sideOrientation:A,updatable:X},O);A.e.CreateTorusKnot=T,O.b.CreateTorusKnot=(C,U,K,m,O,X,A,e,t,z)=>y(C,{radius:U,tube:K,radialSegments:m,tubularSegments:O,p:X,q:A,sideOrientation:z,updatable:t},e);var a=K(13692),r=K(12386),i=K(12045);function D(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=U.path,X=U.shape,A=U.scale||1,e=U.rotation||0,t=0===U.cap?0:U.cap||O.b.NO_CAP,z=U.updatable,j=O.b._GetDefaultSideOrientation(U.sideOrientation),p=U.instance||null,E=U.invertUV||!1,u=U.closeShape||!1,b=U.closePath||!1,v=U.capFunction||null;return G(C,X,m,A,e,null,null,b,u,t,!1,K,!!z,j,p,E,U.frontUVs||null,U.backUVs||null,U.firstNormal||null,!!U.adjustFrame,v)}function l(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=U.path,X=U.shape,A=U.scaleFunction||(()=>1),e=U.rotationFunction||(()=>0),t=U.closePath||U.ribbonCloseArray||!1,z=U.closeShape||U.ribbonClosePath||!1,j=0===U.cap?0:U.cap||O.b.NO_CAP,p=U.updatable,E=U.firstNormal||null,u=U.adjustFrame||!1,b=O.b._GetDefaultSideOrientation(U.sideOrientation),v=U.instance,Q=U.invertUV||!1,V=U.capFunction||null;return G(C,X,m,null,null,A,e,t,z,j,!0,K,!!p,b,v||null,Q,U.frontUVs||null,U.backUVs||null,E,u,V||null)}function G(C,U,K,X,A,e,t,j,p,E,u,b,v,Q,V,f,F,Z,P,H,d){const T=(C,U,K,X,A,e,t,z,j,p,E)=>{const u=K.getTangents(),b=K.getNormals(),v=K.getBinormals(),Q=K.getDistances();if(E)for(let O=0;O<u.length;O++)if(0==u[O].x&&0==u[O].y&&0==u[O].z&&u[O].m(u[O-1]),0==b[O].x&&0==b[O].y&&0==b[O].z&&b[O].m(b[O-1]),0==v[O].x&&0==v[O].y&&0==v[O].z&&v[O].m(v[O-1]),O>0){let C=u[O-1];m.bU.Dot(C,u[O])<0&&u[O].scaleInPlace(-1),C=b[O-1],m.bU.Dot(C,b[O])<0&&b[O].scaleInPlace(-1),C=v[O-1],m.bU.Dot(C,v[O])<0&&v[O].scaleInPlace(-1)}let V=0;const f=p&&z?z:()=>null!==e?e:0,F=p&&t?t:()=>null!==A?A:1;let Z=j===O.b.NO_CAP||j===O.b.CAP_END?0:2;const P=m.TmpVectors.Matrix[0];for(let O=0;O<U.length;O++){const K=[],A=f(O,Q[O]),e=F(O,Q[O]);m.Matrix.RotationAxisToRef(u[O],V,P);for(let X=0;X<C.length;X++){const A=u[O].scale(C[X].z).add(b[O].scale(C[X].x)).add(v[O].scale(C[X].y)),t=m.bU.Zero();m.bU.TransformCoordinatesToRef(A,P,t),t.scaleInPlace(e).addInPlace(U[O]),K[X]=t}X[Z]=K,V+=A,Z++}const H=d||(C=>{const U=Array(),K=m.bU.Zero();let O;for(O=0;O<C.length;O++)K.addInPlace(C[O]);for(K.scaleInPlace(1/C.length),O=0;O<C.length;O++)U.push(K);return U});switch(j){case O.b.NO_CAP:break;case O.b.CAP_START:X[0]=H(X[2]),X[1]=X[2];break;case O.b.CAP_END:X[Z]=X[Z-1],X[Z+1]=H(X[Z-1]);break;case O.b.CAP_ALL:X[0]=H(X[2]),X[1]=X[2],X[Z]=X[Z-1],X[Z+1]=H(X[Z-1])}return X};let y,a;if(V){const C=V._creationDataStorage;return y=P?C.path3D.update(K,P):C.path3D.update(K),a=T(U,K,C.path3D,C.pathArray,X,A,e,t,C.cap,u,H),V=z("",{pathArray:a,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:V},b||void 0)}y=P?new i.k(K,P):new i.k(K);a=T(U,K,y,new Array,X,A,e,t,E=E<0||E>3?0:E,u,H);const r=z(C,{pathArray:a,closeArray:j,closePath:p,updatable:v,sideOrientation:Q,invertUV:f,frontUVs:F||void 0,backUVs:Z||void 0},b);return r._creationDataStorage.pathArray=a,r._creationDataStorage.path3D=y,r._creationDataStorage.cap=E,r}function J(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=U.arc?U.arc<=0||U.arc>1?1:U.arc:1,A=void 0===U.closed||U.closed,e=U.shape,t=U.radius||1,j=U.tessellation||64,p=U.clip||0,E=U.updatable,u=O.b._GetDefaultSideOrientation(U.sideOrientation),b=U.cap||O.b.NO_CAP,v=2*Math.PI,Q=[],V=U.invertUV||!1;let f=0,F=0;const Z=v/j*X;let P,H;for(f=0;f<=j-p;f++){for(H=[],b!=O.b.CAP_START&&b!=O.b.CAP_ALL||(H.push(new m.bU(0,e[0].y,0)),H.push(new m.bU(Math.cos(f*Z)*e[0].x*t,e[0].y,Math.sin(f*Z)*e[0].x*t))),F=0;F<e.length;F++)P=new m.bU(Math.cos(f*Z)*e[F].x*t,e[F].y,Math.sin(f*Z)*e[F].x*t),H.push(P);b!=O.b.CAP_END&&b!=O.b.CAP_ALL||(H.push(new m.bU(Math.cos(f*Z)*e[e.length-1].x*t,e[e.length-1].y,Math.sin(f*Z)*e[e.length-1].x*t)),H.push(new m.bU(0,e[e.length-1].y,0))),Q.push(H)}return z(C,{pathArray:Q,closeArray:A,sideOrientation:u,updatable:E,invertUV:V,frontUVs:U.frontUVs,backUVs:U.backUVs},K)}O.b.ExtrudeShape=function(C,U,K,m,X,A){let e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7?arguments[7]:void 0,z=arguments.length>8?arguments[8]:void 0,j=arguments.length>9?arguments[9]:void 0;return D(C,{shape:U,path:K,scale:m,rotation:X,cap:0===A?0:A||O.b.NO_CAP,sideOrientation:z,instance:j,updatable:t},e)},O.b.ExtrudeShapeCustom=(C,U,K,m,X,A,e,t,z,j,p,E)=>l(C,{shape:U,path:K,scaleFunction:m,rotationFunction:X,ribbonCloseArray:A,ribbonClosePath:e,cap:0===t?0:t||O.b.NO_CAP,sideOrientation:p,instance:E,updatable:j},z);O.b.CreateLathe=(C,U,K,m,O,X,A)=>J(C,{shape:U,radius:K,tessellation:m,sideOrientation:A,updatable:X},O);var o=K(13079),B=K(13027);function k(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=U.path;let A=U.instance,e=1;void 0!==U.radius?e=U.radius:A&&(e=A._creationDataStorage.radius);const t=U.tessellation||64,j=U.radiusFunction||null;let p=U.cap||O.b.NO_CAP;const E=U.invertUV||!1,u=U.updatable,b=O.b._GetDefaultSideOrientation(U.sideOrientation);U.arc=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1;const v=(C,U,K,X,A,e,t,z)=>{const j=U.getTangents(),p=U.getNormals(),E=U.getDistances(),u=2*Math.PI/A*z,b=e||(()=>X);let v,Q,V,f;const F=m.TmpVectors.Matrix[0];let Z=t===O.b.NO_CAP||t===O.b.CAP_END?0:2;for(let O=0;O<C.length;O++){Q=b(O,E[O]),v=Array(),V=p[O];for(let U=0;U<A;U++)m.Matrix.RotationAxisToRef(j[O],u*U,F),f=v[U]?v[U]:m.bU.Zero(),m.bU.TransformCoordinatesToRef(V,F,f),f.scaleInPlace(Q).addInPlace(C[O]),v[U]=f;K[Z]=v,Z++}const P=(U,K)=>{const m=Array();for(let O=0;O<U;O++)m.push(C[K]);return m};switch(t){case O.b.NO_CAP:break;case O.b.CAP_START:K[0]=P(A,0),K[1]=K[2].slice(0);break;case O.b.CAP_END:K[Z]=K[Z-1].slice(0),K[Z+1]=P(A,C.length-1);break;case O.b.CAP_ALL:K[0]=P(A,0),K[1]=K[2].slice(0),K[Z]=K[Z-1].slice(0),K[Z+1]=P(A,C.length-1)}return K};let Q,V;if(A){const C=A._creationDataStorage,K=U.arc||C.arc;return Q=C.path3D.update(X),V=v(X,Q,C.pathArray,e,C.tessellation,j,C.cap,K),A=z("",{pathArray:V,instance:A}),C.path3D=Q,C.pathArray=V,C.arc=K,C.radius=e,A}Q=new i.k(X);p=p<0||p>3?0:p,V=v(X,Q,new Array,e,t,j,p,U.arc);const f=z(C,{pathArray:V,closePath:!0,closeArray:!1,updatable:u,sideOrientation:b,invertUV:E,frontUVs:U.frontUVs,backUVs:U.backUVs},K);return f._creationDataStorage.pathArray=V,f._creationDataStorage.path3D=Q,f._creationDataStorage.tessellation=t,f._creationDataStorage.cap=p,f._creationDataStorage.arc=U.arc,f._creationDataStorage.radius=e,f}function w(C){const U=[];U[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},U[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},U[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},U[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},U[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},U[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},U[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},U[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},U[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},U[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},U[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},U[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},U[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},U[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},U[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const K=C.type&&(C.type<0||C.type>=U.length)?0:C.type||0,O=C.size,X=C.sizeX||O||1,t=C.sizeY||O||1,z=C.sizeZ||O||1,j=C.custom||U[K],p=j.face.length,u=C.faceUV||new Array(p),b=C.faceColors,v=void 0===C.flat||C.flat,Q=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE,V=[],f=[],F=[],Z=[],P=[];let H=0,d=0;const T=[];let y,a,r,i,D,l,G=0,J=0;if(v)for(J=0;J<p;J++)b&&void 0===b[J]&&(b[J]=new E.ve(1,1,1,1)),u&&void 0===u[J]&&(u[J]=new m.Vector4(0,0,1,1));if(v)for(J=0;J<p;J++){const C=j.face[J].length;for(r=2*Math.PI/C,i=.5*Math.tan(r/2),D=.5,G=0;G<C;G++)V.push(j.vertex[j.face[J][G]][0]*X,j.vertex[j.face[J][G]][1]*t,j.vertex[j.face[J][G]][2]*z),T.push(H),H++,y=u[J].x+(u[J].z-u[J].x)*(.5+i),a=u[J].y+(u[J].w-u[J].y)*(D-.5),Z.push(y,e.e?1-a:a),l=i*Math.cos(r)-D*Math.sin(r),D=i*Math.sin(r)+D*Math.cos(r),i=l,b&&P.push(b[J].r,b[J].g,b[J].b,b[J].a);for(G=0;G<C-2;G++)f.push(T[0+d],T[G+2+d],T[G+1+d]);d+=C}else{for(G=0;G<j.vertex.length;G++)V.push(j.vertex[G][0]*X,j.vertex[G][1]*t,j.vertex[G][2]*z),Z.push(0,e.e?1:0);for(J=0;J<p;J++)for(G=0;G<j.face[J].length-2;G++)f.push(j.face[J][0],j.face[J][G+2],j.face[J][G+1])}A.e.ComputeNormals(V,f,F),A.e._ComputeSides(Q,V,f,F,Z,C.frontUVs,C.backUVs);const o=new A.e;return o.yC=V,o.indices=f,o.aC=F,o.iC=Z,b&&v&&(o.rC=P),o}function h(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new O.b(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return w(U).lC(m,U.updatable),m}O.b.CreateTube=(C,U,K,m,O,X,A,e,t,z)=>k(C,{path:U,radius:K,tessellation:m,radiusFunction:O,arc:1,cap:X,updatable:e,sideOrientation:t,instance:z},A);function c(C){const U=C.sideOrientation||A.e.DEFAULTSIDE,K=C.radius||1,O=void 0===C.flat||C.flat,X=0|(C.subdivisions||4),t=C.radiusX||K,z=C.radiusY||K,j=C.radiusZ||K,p=(1+Math.sqrt(5))/2,E=[-1,p,-0,1,p,0,-1,-p,0,1,-p,0,0,-1,-p,0,1,-p,0,-1,p,0,1,p,p,0,1,p,0,-1,-p,0,1,-p,0,-1],u=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],b=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],v=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],Q=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],V=[],f=[],F=[],Z=[];let P=0;const H=new Array(3),d=new Array(3);let T;for(T=0;T<3;T++)H[T]=m.bU.Zero(),d[T]=m.Vector2.Zero();for(let A=0;A<20;A++){for(T=0;T<3;T++){const C=u[3*A+T];H[T].Ee(E[3*b[C]],E[3*b[C]+1],E[3*b[C]+2]),H[T].normalize(),d[T].Ee(.134765625*v[2*C]+.05859375+-.0390625*Q[A],.2333984375*v[2*C+1]+.025390625+.01953125*Q[A])}const C=(C,U,K,A)=>{const p=m.bU.Lerp(H[0],H[2],U/X),E=m.bU.Lerp(H[1],H[2],U/X),u=X===U?H[2]:m.bU.Lerp(p,E,C/(X-U));let b;if(u.normalize(),O){const C=m.bU.Lerp(H[0],H[2],A/X),U=m.bU.Lerp(H[1],H[2],A/X);b=m.bU.Lerp(C,U,K/(X-A))}else b=new m.bU(u.x,u.y,u.z);b.x/=t,b.y/=z,b.z/=j,b.normalize();const v=m.Vector2.Lerp(d[0],d[2],U/X),Q=m.Vector2.Lerp(d[1],d[2],U/X),T=X===U?d[2]:m.Vector2.Lerp(v,Q,C/(X-U));f.push(u.x*t,u.y*z,u.z*j),F.push(b.x,b.y,b.z),Z.push(T.x,e.e?1-T.y:T.y),V.push(P),P++};for(let U=0;U<X;U++)for(let K=0;K+U<X;K++)C(K,U,K+1/3,U+1/3),C(K+1,U,K+1/3,U+1/3),C(K,U+1,K+1/3,U+1/3),K+U+1<X&&(C(K+1,U,K+2/3,U+2/3),C(K+1,U+1,K+2/3,U+2/3),C(K,U+1,K+2/3,U+2/3))}A.e._ComputeSides(U,f,V,F,Z,C.frontUVs,C.backUVs);const y=new A.e;return y.indices=V,y.yC=f,y.aC=F,y.iC=Z,y}function N(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new O.b(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),m._originalBuilderSideOrientation=U.sideOrientation;return c(U).lC(m,U.updatable),m}A.e.CreatePolyhedron=w,O.b.CreatePolyhedron=(C,U,K)=>h(C,U,K);A.e.CreateIcoSphere=c,O.b.CreateIcoSphere=(C,U,K)=>N(C,U,K);var g=K(11846);const M=new m.bU(1,0,0),L=new m.bU(-1,0,0),Y=new m.bU(0,1,0),W=new m.bU(0,-1,0),x=new m.bU(0,0,1),n=new m.bU(0,0,-1);class S{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.bU.Zero(),U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.bU.Up(),K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.Vector2.Zero(),O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=C,this.normal=U,this.uv=K,this.vertexIdx=O,this.vertexIdxForBones=X,this.localPositionOverride=A,this.localNormalOverride=e,this.matrixIndicesOverride=t,this.matrixWeightsOverride=z}clone(){var C,U,K,m;return new S(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(C=this.localPositionOverride)||void 0===C?void 0:C.slice(),null===(U=this.localNormalOverride)||void 0===U?void 0:U.slice(),null===(K=this.matrixIndicesOverride)||void 0===K?void 0:K.slice(),null===(m=this.matrixWeightsOverride)||void 0===m?void 0:m.slice())}}function s(C,U,K){var t,z,j,p,E;const u=!!U.skeleton,b=!(null===(t=U.morphTargetManager)||void 0===t||!t.numTargets),v=K.localMode||u,Q=U.je(),V=u||b?U.Je(!0,!0):U.getVerticesData(X.d.PositionKind),f=u||b?U.getNormalsData(!0,!0):U.getVerticesData(X.d.NormalKind),F=v?u?U.getVerticesData(X.d.PositionKind):V:null,Z=v?u?U.getVerticesData(X.d.NormalKind):f:null,P=U.getVerticesData(X.d.UVKind),H=u?U.getVerticesData(X.d.MatricesIndicesKind):null,d=u?U.getVerticesData(X.d.MatricesWeightsKind):null,T=u?U.getVerticesData(X.d.MatricesIndicesExtraKind):null,y=u?U.getVerticesData(X.d.MatricesWeightsExtraKind):null,a=K.position||m.bU.Zero();let r=K.normal||m.bU.Up();const i=K.size||m.bU.One(),D=K.angle||0;if(!r){const C=new m.bU(0,0,1),K=U.dC().activeCamera,O=m.bU.TransformCoordinates(C,K.getWorldMatrix());r=K.globalPosition.vU(O)}const l=-Math.atan2(r.z,r.x)-Math.PI/2,G=Math.sqrt(r.x*r.x+r.z*r.z),J=Math.atan2(r.y,G),o=new A.e;o.indices=[],o.yC=[],o.aC=[],o.iC=[],o.matricesIndices=u?[]:null,o.matricesWeights=u?[]:null,o.matricesIndicesExtra=T?[]:null,o.matricesWeightsExtra=y?[]:null;let B=0;const k=(C,U)=>{const O=new S;if(!Q||!V||!f)return O;const X=Q[C];if(O.vertexIdx=3*X,O.vertexIdxForBones=4*X,O.position=new m.bU(V[3*X],V[3*X+1],V[3*X+2]),m.bU.TransformCoordinatesToRef(O.position,U,O.position),O.normal=new m.bU(f[3*X],f[3*X+1],f[3*X+2]),m.bU.TransformNormalToRef(O.normal,U,O.normal),K.captureUVS&&P){const C=P[2*X+1];O.uv=new m.Vector2(P[2*X],e.e?1-C:C)}return O},w=[0,0,0,0],h=(C,U)=>{if(0===C.length)return C;const K=.5*Math.abs(m.bU.Dot(i,U)),O=(C,U,K,m)=>{for(let O=0;O<m;++O)if(C[K+O]===U)return K+O;return-1},X=(C,X)=>{const A=m.bU.GetClipFactor(C.position,X.position,U,K);let e=w,t=w;if(H&&d){const U=C.matrixIndicesOverride?0:C.vertexIdxForBones,K=C.matrixIndicesOverride??H,m=C.matrixWeightsOverride??d,z=X.matrixIndicesOverride?0:X.vertexIdxForBones,j=X.matrixIndicesOverride??H,p=X.matrixWeightsOverride??d;e=[0,0,0,0],t=[0,0,0,0];let E=0;for(let C=0;C<4;++C)if(m[U+C]>0){const X=O(j,K[U+C],z,4);e[E]=K[U+C],t[E]=(0,g.Lerp)(m[U+C],X>=0?p[X]:0,A),E++}for(let C=0;C<4&&E<4;++C){const m=j[z+C];-1===O(K,m,U,4)&&(e[E]=m,t[E]=(0,g.Lerp)(0,p[z+C],A),E++)}const u=t[0]+t[1]+t[2]+t[3];t[0]/=u,t[1]/=u,t[2]/=u,t[3]/=u}const z=C.localPositionOverride?C.localPositionOverride[0]:(null===F||void 0===F?void 0:F[C.vertexIdx])??0,j=C.localPositionOverride?C.localPositionOverride[1]:(null===F||void 0===F?void 0:F[C.vertexIdx+1])??0,p=C.localPositionOverride?C.localPositionOverride[2]:(null===F||void 0===F?void 0:F[C.vertexIdx+2])??0,E=X.localPositionOverride?X.localPositionOverride[0]:(null===F||void 0===F?void 0:F[X.vertexIdx])??0,u=X.localPositionOverride?X.localPositionOverride[1]:(null===F||void 0===F?void 0:F[X.vertexIdx+1])??0,b=X.localPositionOverride?X.localPositionOverride[2]:(null===F||void 0===F?void 0:F[X.vertexIdx+2])??0,v=C.localNormalOverride?C.localNormalOverride[0]:(null===Z||void 0===Z?void 0:Z[C.vertexIdx])??0,Q=C.localNormalOverride?C.localNormalOverride[1]:(null===Z||void 0===Z?void 0:Z[C.vertexIdx+1])??0,V=C.localNormalOverride?C.localNormalOverride[2]:(null===Z||void 0===Z?void 0:Z[C.vertexIdx+2])??0,f=v+((X.localNormalOverride?X.localNormalOverride[0]:(null===Z||void 0===Z?void 0:Z[X.vertexIdx])??0)-v)*A,P=Q+((X.localNormalOverride?X.localNormalOverride[1]:(null===Z||void 0===Z?void 0:Z[X.vertexIdx+1])??0)-Q)*A,T=V+((X.localNormalOverride?X.localNormalOverride[2]:(null===Z||void 0===Z?void 0:Z[X.vertexIdx+2])??0)-V)*A,y=Math.sqrt(f*f+P*P+T*T);return new S(m.bU.Lerp(C.position,X.position,A),m.bU.Lerp(C.normal,X.normal,A).normalize(),m.Vector2.Lerp(C.uv,X.uv,A),-1,-1,F?[z+(E-z)*A,j+(u-j)*A,p+(b-p)*A]:null,Z?[f/y,P/y,T/y]:null,e,t)};let A=null;C.length>3&&(A=[]);for(let e=0;e<C.length;e+=3){let O=0,t=null,z=null,j=null,p=null;const E=m.bU.Dot(C[e].position,U)-K>0,u=m.bU.Dot(C[e+1].position,U)-K>0,b=m.bU.Dot(C[e+2].position,U)-K>0;switch(O=(E?1:0)+(u?1:0)+(b?1:0),O){case 0:C.length>3?(A.push(C[e]),A.push(C[e+1]),A.push(C[e+2])):A=C;break;case 1:if(A=A??new Array,E&&(t=C[e+1],z=C[e+2],j=X(C[e],t),p=X(C[e],z)),u){t=C[e],z=C[e+2],j=X(C[e+1],t),p=X(C[e+1],z),A.push(j),A.push(z.clone()),A.push(t.clone()),A.push(z.clone()),A.push(j.clone()),A.push(p);break}b&&(t=C[e],z=C[e+1],j=X(C[e+2],t),p=X(C[e+2],z)),t&&z&&j&&p&&(A.push(t.clone()),A.push(z.clone()),A.push(j),A.push(p),A.push(j.clone()),A.push(z.clone()));break;case 2:A=A??new Array,E||(t=C[e].clone(),z=X(t,C[e+1]),j=X(t,C[e+2]),A.push(t),A.push(z),A.push(j)),u||(t=C[e+1].clone(),z=X(t,C[e+2]),j=X(t,C[e]),A.push(t),A.push(z),A.push(j)),b||(t=C[e+2].clone(),z=X(t,C[e]),j=X(t,C[e+1]),A.push(t),A.push(z),A.push(j))}}return A},c=U instanceof O.b?U:null,N=null===c||void 0===c?void 0:c._thinInstanceDataStorage.matrixData,s=(null===c||void 0===c?void 0:c.Ve)||1,R=m.TmpVectors.Matrix[0];R.m(m.Matrix.IdentityReadOnly);for(let O=0;O<s;++O){if(null!==c&&void 0!==c&&c.hasThinInstances&&N){const C=16*O;R.setRowFromFloats(0,N[C+0],N[C+1],N[C+2],N[C+3]),R.setRowFromFloats(1,N[C+4],N[C+5],N[C+6],N[C+7]),R.setRowFromFloats(2,N[C+8],N[C+9],N[C+10],N[C+11]),R.setRowFromFloats(3,N[C+12],N[C+13],N[C+14],N[C+15])}const C=m.Matrix.RotationYawPitchRoll(l,J,D).multiply(m.Matrix.Translation(a.x,a.y,a.z)),X=m.Matrix.Invert(C),A=U.getWorldMatrix(),t=R.multiply(A).multiply(X),z=new Array(3);for(let U=0;U<Q.length;U+=3){let C=z;if(C[0]=k(U,t),C[1]=k(U+1,t),C[2]=k(U+2,t),!(K.cullBackFaces&&-C[0].normal.z<=0&&-C[1].normal.z<=0&&-C[2].normal.z<=0)&&(C=h(C,M),C&&(C=h(C,L),C&&(C=h(C,Y),C&&(C=h(C,W),C&&(C=h(C,x),C&&(C=h(C,n),C)))))))for(let U=0;U<C.length;U++){const m=C[U];if(o.indices.push(B),v?(m.localPositionOverride?(o.yC[3*B]=m.localPositionOverride[0],o.yC[3*B+1]=m.localPositionOverride[1],o.yC[3*B+2]=m.localPositionOverride[2]):F&&(o.yC[3*B]=F[m.vertexIdx],o.yC[3*B+1]=F[m.vertexIdx+1],o.yC[3*B+2]=F[m.vertexIdx+2]),m.localNormalOverride?(o.aC[3*B]=m.localNormalOverride[0],o.aC[3*B+1]=m.localNormalOverride[1],o.aC[3*B+2]=m.localNormalOverride[2]):Z&&(o.aC[3*B]=Z[m.vertexIdx],o.aC[3*B+1]=Z[m.vertexIdx+1],o.aC[3*B+2]=Z[m.vertexIdx+2])):(m.position.toArray(o.yC,3*B),m.normal.toArray(o.aC,3*B)),o.matricesIndices&&o.matricesWeights&&(m.matrixIndicesOverride?(o.matricesIndices[4*B]=m.matrixIndicesOverride[0],o.matricesIndices[4*B+1]=m.matrixIndicesOverride[1],o.matricesIndices[4*B+2]=m.matrixIndicesOverride[2],o.matricesIndices[4*B+3]=m.matrixIndicesOverride[3]):(H&&(o.matricesIndices[4*B]=H[m.vertexIdxForBones],o.matricesIndices[4*B+1]=H[m.vertexIdxForBones+1],o.matricesIndices[4*B+2]=H[m.vertexIdxForBones+2],o.matricesIndices[4*B+3]=H[m.vertexIdxForBones+3]),T&&o.matricesIndicesExtra&&(o.matricesIndicesExtra[4*B]=T[m.vertexIdxForBones],o.matricesIndicesExtra[4*B+1]=T[m.vertexIdxForBones+1],o.matricesIndicesExtra[4*B+2]=T[m.vertexIdxForBones+2],o.matricesIndicesExtra[4*B+3]=T[m.vertexIdxForBones+3])),m.matrixWeightsOverride?(o.matricesWeights[4*B]=m.matrixWeightsOverride[0],o.matricesWeights[4*B+1]=m.matrixWeightsOverride[1],o.matricesWeights[4*B+2]=m.matrixWeightsOverride[2],o.matricesWeights[4*B+3]=m.matrixWeightsOverride[3]):(d&&(o.matricesWeights[4*B]=d[m.vertexIdxForBones],o.matricesWeights[4*B+1]=d[m.vertexIdxForBones+1],o.matricesWeights[4*B+2]=d[m.vertexIdxForBones+2],o.matricesWeights[4*B+3]=d[m.vertexIdxForBones+3]),y&&o.matricesWeightsExtra&&(o.matricesWeightsExtra[4*B]=y[m.vertexIdxForBones],o.matricesWeightsExtra[4*B+1]=y[m.vertexIdxForBones+1],o.matricesWeightsExtra[4*B+2]=y[m.vertexIdxForBones+2],o.matricesWeightsExtra[4*B+3]=y[m.vertexIdxForBones+3]))),K.captureUVS)m.uv.toArray(o.iC,2*B);else{o.iC.push(.5+m.position.x/i.x);const C=.5+m.position.y/i.y;o.iC.push(e.e?1-C:C)}B++}}}0===o.indices.length&&(o.indices=null),0===o.yC.length&&(o.yC=null),0===o.aC.length&&(o.aC=null),0===o.iC.length&&(o.iC=null),0===(null===(z=o.matricesIndices)||void 0===z?void 0:z.length)&&(o.matricesIndices=null),0===(null===(j=o.matricesWeights)||void 0===j?void 0:j.length)&&(o.matricesWeights=null),0===(null===(p=o.matricesIndicesExtra)||void 0===p?void 0:p.length)&&(o.matricesIndicesExtra=null),0===(null===(E=o.matricesWeightsExtra)||void 0===E?void 0:E.length)&&(o.matricesWeightsExtra=null);const q=new O.b(C,U.dC());return o.lC(q),v?(q.skeleton=U.skeleton,q.parent=U):(q.position=a.clone(),q.rotation=new m.bU(J,l,D)),q.te(!0),q.refreshBoundingInfo(!0,!0),q}function R(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const U=0|Math.max(C.subdivisions?C.subdivisions:2,1),K=0|Math.max(C.tessellation?C.tessellation:16,3),O=Math.max(C.height?C.height:1,0),X=Math.max(C.radius?C.radius:.25,0),t=0|Math.max(C.capSubdivisions?C.capSubdivisions:6,1),z=K,j=U,p=Math.max(C.radiusTop?C.radiusTop:X,0),E=Math.max(C.radiusBottom?C.radiusBottom:X,0),u=O-(p+E),b=2*Math.PI,v=Math.max(C.topCapSubdivisions?C.topCapSubdivisions:t,1),Q=Math.max(C.bottomCapSubdivisions?C.bottomCapSubdivisions:t,1),V=Math.acos((E-p)/O);let f=[];const F=[],Z=[],P=[];let H=0;const d=[],T=.5*u,y=.5*Math.PI;let a,r;const i=m.bU.Zero(),D=m.bU.Zero(),l=Math.cos(V),G=Math.sin(V),J=new m.Vector2(p*G,T+p*l).vU(new m.Vector2(E*G,E*l-T)).length(),o=p*V+J+E*(y-V);let B=0;for(r=0;r<=v;r++){const C=[],U=y-V*(r/v);B+=p*V/v;const K=Math.cos(U),m=Math.sin(U),O=K*p;for(a=0;a<=z;a++){const U=a/z,X=U*b+0,A=Math.sin(X),t=Math.cos(X);D.x=O*A,D.y=T+m*p,D.z=O*t,F.push(D.x,D.y,D.z),i.set(K*A,m,K*t),Z.push(i.x,i.y,i.z),P.push(U,e.e?B/o:1-B/o),C.push(H),H++}d.push(C)}const k=O-p-E+l*p-l*E,w=G*(E-p)/k;for(r=1;r<=j;r++){const C=[];B+=J/j;const U=G*(r*(E-p)/j+p);for(a=0;a<=z;a++){const K=a/z,m=K*b+0,O=Math.sin(m),X=Math.cos(m);D.x=U*O,D.y=T+l*p-r*k/j,D.z=U*X,F.push(D.x,D.y,D.z),i.set(O,w,X).normalize(),Z.push(i.x,i.y,i.z),P.push(K,e.e?B/o:1-B/o),C.push(H),H++}d.push(C)}for(r=1;r<=Q;r++){const C=[],U=y-V-(Math.PI-V)*(r/Q);B+=E*V/Q;const K=Math.cos(U),m=Math.sin(U),O=K*E;for(a=0;a<=z;a++){const U=a/z,X=U*b+0,A=Math.sin(X),t=Math.cos(X);D.x=O*A,D.y=m*E-T,D.z=O*t,F.push(D.x,D.y,D.z),i.set(K*A,m,K*t),Z.push(i.x,i.y,i.z),P.push(U,e.e?B/o:1-B/o),C.push(H),H++}d.push(C)}for(a=0;a<z;a++)for(r=0;r<v+j+Q;r++){const C=d[r][a],U=d[r+1][a],K=d[r+1][a+1],m=d[r][a+1];f.push(C),f.push(U),f.push(m),f.push(U),f.push(K),f.push(m)}if(f=f.reverse(),C.orientation&&!C.orientation.equals(m.bU.Up())){const U=new m.Matrix;C.orientation.clone().scale(.5*Math.PI).cross(m.bU.Up()).toQuaternion().toRotationMatrix(U);const K=m.bU.Zero();for(let C=0;C<F.length;C+=3)K.set(F[C],F[C+1],F[C+2]),m.bU.TransformCoordinatesToRef(K.clone(),U,K),F[C]=K.x,F[C+1]=K.y,F[C+2]=K.z}const h=new A.e;return h.yC=F,h.aC=Z,h.iC=P,h.indices=f,h}function q(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:m.bU.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new O.b(C,K);return R(U).lC(X,U.updatable),X}O.b.CreateDecal=(C,U,K,m,O,X)=>s(C,U,{position:K,normal:m,size:O,angle:X});O.b.CreateCapsule=(C,U,K)=>q(C,U,K),A.e.CreateCapsule=R;var I=K(11679),CC=K(11835);class UC{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=C,this.y=U,C!==Math.floor(C)&&(C=Math.floor(C),I.d.Warn("x is not an integer, floor(x) used")),U!==Math.floor(U)&&(U=Math.floor(U),I.d.Warn("y is not an integer, floor(y) used"))}clone(){return new UC(this.x,this.y)}rotate60About(C){const U=this.x;return this.x=C.x+C.y-this.y,this.y=U+this.y-C.x,this}rotateNeg60About(C){const U=this.x;return this.x=U+this.y-C.y,this.y=C.x+C.y-U,this}rotate120(C,U){C!==Math.floor(C)&&(C=Math.floor(C),I.d.Warn("m not an integer only floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),I.d.Warn("n not an integer only floor(n) used"));const K=this.x;return this.x=C-K-this.y,this.y=U+K,this}rotateNeg120(C,U){C!==Math.floor(C)&&(C=Math.floor(C),I.d.Warn("m is not an integer, floor(m) used")),U!==Math.floor(U)&&(U=Math.floor(U),I.d.Warn("n is not an integer,   floor(n) used"));const K=this.x;return this.x=this.y-U,this.y=C+U-K-this.y,this}toCartesianOrigin(C,U){const K=m.bU.Zero();return K.x=C.x+2*this.x*U+this.y*U,K.y=C.y+Math.sqrt(3)*this.y*U,K}static Zero(){return new UC(0,0)}}class KC{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new mC("icosahedron","Regular",[[0,CC.f,-1],[-CC.f,1,0],[-1,0,-CC.f],[1,0,-CC.f],[CC.f,1,0],[0,CC.f,1],[-1,0,CC.f],[-CC.f,-1,0],[0,-CC.f,-1],[CC.f,-1,0],[1,0,CC.f],[0,-CC.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let C=12;const U={},K=this.m,m=this.n;let O,X,A,e,t,z=K,j=1,p=0;0!==m&&(z=(0,g.HighestCommonFactor)(K,m)),j=K/z,p=m/z;const E=UC.Zero(),u=new UC(K,m),b=new UC(-m,K+m),v=UC.Zero(),Q=UC.Zero(),V=UC.Zero();let f,F,Z,P,H=[];const d=[],T=this.vertByDist,y=(K,m,O,X)=>{f=K+"|"+O,F=m+"|"+X,f in U||F in U?f in U&&!(F in U)?U[F]=U[f]:F in U&&!(f in U)&&(U[f]=U[F]):(U[f]=C,U[F]=C,C++),T[O][0]>2?d[U[f]]=[-T[O][0],T[O][1],U[f]]:d[U[f]]=[H[T[O][0]],T[O][1],U[f]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let a=0;a<20;a++){if(H=this.IDATA.face[a],A=H[2],e=H[1],t=H[0],Z=E.x+"|"+E.y,f=a+"|"+Z,f in U||(U[f]=A,d[A]=[H[T[Z][0]],T[Z][1]]),Z=u.x+"|"+u.y,f=a+"|"+Z,f in U||(U[f]=e,d[e]=[H[T[Z][0]],T[Z][1]]),Z=b.x+"|"+b.y,f=a+"|"+Z,f in U||(U[f]=t,d[t]=[H[T[Z][0]],T[Z][1]]),O=this.IDATA.edgematch[a][0],X=this.IDATA.edgematch[a][1],"B"===X)for(let C=1;C<z;C++)Q.x=K-C*(j+p),Q.y=m+C*j,V.x=-C*p,V.y=C*(j+p),Z=Q.x+"|"+Q.y,P=V.x+"|"+V.y,y(a,O,Z,P);if("O"===X)for(let C=1;C<z;C++)V.x=-C*p,V.y=C*(j+p),v.x=C*j,v.y=C*p,Z=V.x+"|"+V.y,P=v.x+"|"+v.y,y(a,O,Z,P);if(O=this.IDATA.edgematch[a][2],X=this.IDATA.edgematch[a][3],X&&"A"===X)for(let C=1;C<z;C++)v.x=C*j,v.y=C*p,Q.x=K-(z-C)*(j+p),Q.y=m+(z-C)*j,Z=v.x+"|"+v.y,P=Q.x+"|"+Q.y,y(a,O,Z,P);for(let K=0;K<this.vertices.length;K++)Z=this.vertices[K].x+"|"+this.vertices[K].y,f=a+"|"+Z,f in U||(U[f]=C++,T[Z][0]>2?d[U[f]]=[-T[Z][0],T[Z][1],U[f]]:d[U[f]]=[H[T[Z][0]],T[Z][1],U[f]])}this.closestTo=d,this.vecToidx=U}calcCoeffs(){const C=this.m,U=this.n,K=Math.sqrt(3)/3,m=C*C+U*U+C*U;this.coau=(C+U)/m,this.cobu=-U/m,this.coav=-K*(C-U)/m,this.cobv=K*(2*C+U)/m}createInnerFacets(){const C=this.m,U=this.n;for(let K=0;K<U+C+1;K++)for(let C=this.min[K];C<this.max[K]+1;C++)C<this.max[K]&&C<this.max[K+1]+1&&this.innerFacets.push(["|"+C+"|"+K,"|"+C+"|"+(K+1),"|"+(C+1)+"|"+K]),K>0&&C<this.max[K-1]&&C+1<this.max[K]+1&&this.innerFacets.push(["|"+C+"|"+K,"|"+(C+1)+"|"+K,"|"+(C+1)+"|"+(K-1)])}edgeVecsABOB(){const C=this.m,U=this.n,K=new UC(-U,C+U);for(let m=1;m<C+U;m++){const C=new UC(this.min[m],m),U=new UC(this.min[m-1],m-1),O=new UC(this.min[m+1],m+1),X=C.clone(),A=U.clone(),e=O.clone();X.rotate60About(K),A.rotate60About(K),e.rotate60About(K);const t=new UC(this.max[X.y],X.y),z=new UC(this.max[X.y-1],X.y-1),j=new UC(this.max[X.y-1]-1,X.y-1);X.x===t.x&&X.y===t.y||(X.x!==z.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,z,j]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,j,t])):X.y===e.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([C,U,z]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([C,z,O])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([C,U,z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([C,z,t])))}}mapABOBtoOBOA(){const C=new UC(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const K=[];for(let m=0;m<3;m++)C.x=this.isoVecsABOB[U][m].x,C.y=this.isoVecsABOB[U][m].y,0===this.vertexTypes[U][m]&&C.rotateNeg120(this.m,this.n),K.push(C.clone());this.isoVecsOBOA.push(K)}}mapABOBtoBAOA(){const C=new UC(0,0);for(let U=0;U<this.isoVecsABOB.length;U++){const K=[];for(let m=0;m<3;m++)C.x=this.isoVecsABOB[U][m].x,C.y=this.isoVecsABOB[U][m].y,1===this.vertexTypes[U][m]&&C.rotate120(this.m,this.n),K.push(C.clone());this.isoVecsBAOA.push(K)}}MapToFace(C,U){const K=this.IDATA.face[C],O=K[2],X=K[1],A=K[0],e=m.bU.FU(this.IDATA.vertex[O]),t=m.bU.FU(this.IDATA.vertex[X]),z=m.bU.FU(this.IDATA.vertex[A]),j=t.vU(e),p=z.vU(e),E=j.scale(this.coau).add(p.scale(this.cobu)),u=j.scale(this.coav).add(p.scale(this.cobv)),b=[];let v,Q=m.TmpVectors.bU[0];for(let m=0;m<this.cartesian.length;m++)Q=E.scale(this.cartesian[m].x).add(u.scale(this.cartesian[m].y)).add(e),b[m]=[Q.x,Q.y,Q.z],v=C+"|"+this.vertices[m].x+"|"+this.vertices[m].y,U.vertex[this.vecToidx[v]]=[Q.x,Q.y,Q.z]}build(C,U){const K=[],m=UC.Zero(),O=new UC(C,U),X=new UC(-U,C+U);K.push(m,O,X);for(let Z=U;Z<C+1;Z++)for(let U=0;U<C+1-Z;U++)K.push(new UC(U,Z));if(U>0){const m=(0,g.HighestCommonFactor)(C,U),O=C/m,X=U/m;for(let e=1;e<m;e++)K.push(new UC(e*O,e*X)),K.push(new UC(-e*X,e*(O+X))),K.push(new UC(C-e*(O+X),U+e*O));const A=C/U;for(let e=1;e<U;e++)for(let m=0;m<e*A;m++)K.push(new UC(m,e)),K.push(new UC(m,e).rotate120(C,U)),K.push(new UC(m,e).rotateNeg120(C,U))}K.sort(((C,U)=>C.x-U.x)),K.sort(((C,U)=>C.y-U.y));const A=new Array(C+U+1),e=new Array(C+U+1);for(let Z=0;Z<A.length;Z++)A[Z]=1/0,e[Z]=-1/0;let t=0,z=0;const j=K.length;for(let Z=0;Z<j;Z++)z=K[Z].x,t=K[Z].y,A[t]=Math.min(z,A[t]),e[t]=Math.max(z,e[t]);const p=(K,m)=>{const O=K.clone();return"A"===m&&O.rotateNeg120(C,U),"B"===m&&O.rotate120(C,U),O.x<0?O.y:O.x+O.y},E=[],u=[],b=[],v=[],Q={},V=[];let f=-1,F=-1;for(let Z=0;Z<j;Z++)E[Z]=K[Z].toCartesianOrigin(new UC(0,0),.5),u[Z]=p(K[Z],"O"),b[Z]=p(K[Z],"A"),v[Z]=p(K[Z],"B"),u[Z]===b[Z]&&b[Z]===v[Z]?(f=3,F=u[Z]):u[Z]===b[Z]?(f=4,F=u[Z]):b[Z]===v[Z]?(f=5,F=b[Z]):v[Z]===u[Z]&&(f=6,F=u[Z]),u[Z]<b[Z]&&u[Z]<v[Z]&&(f=2,F=u[Z]),b[Z]<u[Z]&&b[Z]<v[Z]&&(f=1,F=b[Z]),v[Z]<b[Z]&&v[Z]<u[Z]&&(f=0,F=v[Z]),V.push([f,F,K[Z].x,K[Z].y]);V.sort(((C,U)=>C[2]-U[2])),V.sort(((C,U)=>C[3]-U[3])),V.sort(((C,U)=>C[1]-U[1])),V.sort(((C,U)=>C[0]-U[0]));for(let Z=0;Z<V.length;Z++)Q[V[Z][2]+"|"+V[Z][3]]=[V[Z][0],V[Z][1],Z];return this.m=C,this.n=U,this.vertices=K,this.vertByDist=Q,this.cartesian=E,this.min=A,this.max=e,this}}class mC{constructor(C,U,K,m){this.name=C,this.category=U,this.vertex=K,this.face=m}}class OC extends mC{innerToData(C,U){for(let K=0;K<U.innerFacets.length;K++)this.face.push(U.innerFacets[K].map((K=>U.vecToidx[C+K])))}mapABOBtoDATA(C,U){const K=U.IDATA.edgematch[C][0];for(let m=0;m<U.isoVecsABOB.length;m++){const O=[];for(let X=0;X<3;X++)0===U.vertexTypes[m][X]?O.push(C+"|"+U.isoVecsABOB[m][X].x+"|"+U.isoVecsABOB[m][X].y):O.push(K+"|"+U.isoVecsABOB[m][X].x+"|"+U.isoVecsABOB[m][X].y);this.face.push([U.vecToidx[O[0]],U.vecToidx[O[1]],U.vecToidx[O[2]]])}}mapOBOAtoDATA(C,U){const K=U.IDATA.edgematch[C][0];for(let m=0;m<U.isoVecsOBOA.length;m++){const O=[];for(let X=0;X<3;X++)1===U.vertexTypes[m][X]?O.push(C+"|"+U.isoVecsOBOA[m][X].x+"|"+U.isoVecsOBOA[m][X].y):O.push(K+"|"+U.isoVecsOBOA[m][X].x+"|"+U.isoVecsOBOA[m][X].y);this.face.push([U.vecToidx[O[0]],U.vecToidx[O[1]],U.vecToidx[O[2]]])}}mapBAOAtoDATA(C,U){const K=U.IDATA.edgematch[C][2];for(let m=0;m<U.isoVecsBAOA.length;m++){const O=[];for(let X=0;X<3;X++)1===U.vertexTypes[m][X]?O.push(C+"|"+U.isoVecsBAOA[m][X].x+"|"+U.isoVecsBAOA[m][X].y):O.push(K+"|"+U.isoVecsBAOA[m][X].x+"|"+U.isoVecsBAOA[m][X].y);this.face.push([U.vecToidx[O[0]],U.vecToidx[O[1]],U.vecToidx[O[2]]])}}orderData(C){const U=[];for(let X=0;X<13;X++)U[X]=[];const K=C.closestTo;for(let X=0;X<K.length;X++)K[X][0]>-1?K[X][1]>0&&U[K[X][0]].push([X,K[X][1]]):U[12].push([X,K[X][0]]);const m=[];for(let X=0;X<12;X++)m[X]=X;let O=12;for(let X=0;X<12;X++){U[X].sort(((C,U)=>C[1]-U[1]));for(let C=0;C<U[X].length;C++)m[U[X][C][0]]=O++}for(let X=0;X<U[12].length;X++)m[U[12][X][0]]=O++;for(let X=0;X<this.vertex.length;X++)this.vertex[X].push(m[X]);this.vertex.sort(((C,U)=>C[3]-U[3]));for(let X=0;X<this.vertex.length;X++)this.vertex[X].pop();for(let X=0;X<this.face.length;X++)for(let C=0;C<this.face[X].length;C++)this.face[X][C]=m[this.face[X][C]];this.sharedNodes=U[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(C,U){const K=[],m=[];let O=U.pop();m.push(O);let X=this.face[O].indexOf(C);X=(X+2)%3;let A=this.face[O][X];K.push(A);let e=0;for(;U.length>0;)O=U[e],this.face[O].indexOf(A)>-1?(X=(this.face[O].indexOf(A)+1)%3,A=this.face[O][X],K.push(A),m.push(O),U.splice(e,1),e=0):e++;return this.adjacentFaces.push(K),m}toGoldbergPolyhedronData(){const C=new mC("GeoDual","Goldberg",[],[]);C.name="GD dual";const U=this.vertex.length,K=new Array(U);for(let t=0;t<U;t++)K[t]=[];for(let t=0;t<this.face.length;t++)for(let C=0;C<3;C++)K[this.face[t][C]].push(t);let m=0,O=0,X=0,A=[],e=[];this.adjacentFaces=[];for(let t=0;t<K.length;t++){C.face[t]=this.setOrder(t,K[t].concat([]));for(const U of K[t]){m=0,O=0,X=0,A=this.face[U];for(let C=0;C<3;C++)e=this.vertex[A[C]],m+=e[0],O+=e[1],X+=e[2];C.vertex[U]=[m/3,O/3,X/3]}}return C}static BuildGeodesicData(C){const U=new OC("Geodesic-m-n","Geodesic",[[0,CC.f,-1],[-CC.f,1,0],[-1,0,-CC.f],[1,0,-CC.f],[CC.f,1,0],[0,CC.f,1],[-1,0,CC.f],[-CC.f,-1,0],[0,-CC.f,-1],[CC.f,-1,0],[1,0,CC.f],[0,-CC.f,1]],[]);C.setIndices(),C.calcCoeffs(),C.createInnerFacets(),C.edgeVecsABOB(),C.mapABOBtoOBOA(),C.mapABOBtoBAOA();for(let K=0;K<C.IDATA.face.length;K++)C.MapToFace(K,U),U.innerToData(K,C),"B"===C.IDATA.edgematch[K][1]&&U.mapABOBtoDATA(K,C),"O"===C.IDATA.edgematch[K][1]&&U.mapOBOAtoDATA(K,C),"A"===C.IDATA.edgematch[K][3]&&U.mapBAOAtoDATA(K,C);U.orderData(C);return U.vertex=U.vertex.map((function(C){const U=C[0],K=C[1],m=C[2],O=Math.sqrt(U*U+K*K+m*m);return C[0]*=1/O,C[1]*=1/O,C[2]*=1/O,C})),U}}O.b._GoldbergMeshParser=(C,U)=>XC.Parse(C,U);class XC extends O.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(C,U){return void 0===U?(C>this.goldbergData.nbUnsharedFaces-1&&(I.d.Warn("Maximum number of unshared faces used"),C=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+C):(C>11&&(I.d.Warn("Last pole used"),C=11),U>this.goldbergData.nbFacesAtPole-1&&(I.d.Warn("Maximum number of faces at a pole used"),U=this.goldbergData.nbFacesAtPole-1),12+C*this.goldbergData.nbFacesAtPole+U)}_changeGoldbergFaceColors(C){for(let K=0;K<C.length;K++){const U=C[K][0],m=C[K][1],O=C[K][2];for(let C=U;C<m+1;C++)this.goldbergData.faceColors[C]=O}const U=[];for(let K=0;K<12;K++)for(let C=0;C<5;C++)U.push(this.goldbergData.faceColors[K].r,this.goldbergData.faceColors[K].g,this.goldbergData.faceColors[K].b,this.goldbergData.faceColors[K].a);for(let K=12;K<this.goldbergData.faceColors.length;K++)for(let C=0;C<6;C++)U.push(this.goldbergData.faceColors[K].r,this.goldbergData.faceColors[K].g,this.goldbergData.faceColors[K].b,this.goldbergData.faceColors[K].a);return U}setGoldbergFaceColors(C){const U=this._changeGoldbergFaceColors(C);this.BC(X.d.ColorKind,U)}updateGoldbergFaceColors(C){const U=this._changeGoldbergFaceColors(C);this.updateVerticesData(X.d.ColorKind,U)}_changeGoldbergFaceUVs(C){const U=this.getVerticesData(X.d.UVKind);for(let K=0;K<C.length;K++){const m=C[K][0],O=C[K][1],X=C[K][2],A=C[K][3],e=C[K][4],t=[],z=[];let j,p;for(let C=0;C<5;C++)j=X.x+A*Math.cos(e+C*Math.PI/2.5),p=X.y+A*Math.sin(e+C*Math.PI/2.5),j<0&&(j=0),j>1&&(j=1),t.push(j,p);for(let C=0;C<6;C++)j=X.x+A*Math.cos(e+C*Math.PI/3),p=X.y+A*Math.sin(e+C*Math.PI/3),j<0&&(j=0),j>1&&(j=1),z.push(j,p);for(let C=m;C<Math.min(12,O+1);C++)for(let K=0;K<5;K++)U[10*C+2*K]=t[2*K],U[10*C+2*K+1]=t[2*K+1];for(let C=Math.max(12,m);C<O+1;C++)for(let K=0;K<6;K++)U[12*C-24+2*K]=z[2*K],U[12*C-23+2*K]=z[2*K+1]}return U}setGoldbergFaceUVs(C){const U=this._changeGoldbergFaceUVs(C);this.BC(X.d.UVKind,U)}updateGoldbergFaceUVs(C){const U=this._changeGoldbergFaceUVs(C);this.updateVerticesData(X.d.UVKind,U)}placeOnGoldbergFaceAt(C,U,K){const O=m.bU.RotationFromAxis(this.goldbergData.faceXaxis[U],this.goldbergData.faceYaxis[U],this.goldbergData.faceZaxis[U]);C.rotation=O,C.position=this.goldbergData.faceCenters[U].add(this.goldbergData.faceXaxis[U].scale(K.x)).add(this.goldbergData.faceYaxis[U].scale(K.y)).add(this.goldbergData.faceZaxis[U].scale(K.z))}serialize(C){super.serialize(C),C.type="GoldbergMesh";const U={};if(U.adjacentFaces=this.goldbergData.adjacentFaces,U.nbSharedFaces=this.goldbergData.nbSharedFaces,U.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,U.nbFaces=this.goldbergData.nbFaces,U.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){U.faceColors=[];for(const C of this.goldbergData.faceColors)U.faceColors.push(C.Oe())}if(this.goldbergData.faceCenters){U.faceCenters=[];for(const C of this.goldbergData.faceCenters)U.faceCenters.push(C.Oe())}if(this.goldbergData.faceZaxis){U.faceZaxis=[];for(const C of this.goldbergData.faceZaxis)U.faceZaxis.push(C.Oe())}if(this.goldbergData.faceYaxis){U.faceYaxis=[];for(const C of this.goldbergData.faceYaxis)U.faceYaxis.push(C.Oe())}if(this.goldbergData.faceXaxis){U.faceXaxis=[];for(const C of this.goldbergData.faceXaxis)U.faceXaxis.push(C.Oe())}C.goldbergData=U}static Parse(C,U){const K=C.goldbergData;K.faceColors=K.faceColors.map((C=>E.ve.FU(C))),K.faceCenters=K.faceCenters.map((C=>m.bU.FU(C))),K.faceZaxis=K.faceZaxis.map((C=>m.bU.FU(C))),K.faceXaxis=K.faceXaxis.map((C=>m.bU.FU(C))),K.faceYaxis=K.faceYaxis.map((C=>m.bU.FU(C)));const O=new XC(C.name,U);return O.goldbergData=K,O}}var AC=K(12383);const eC={CreateBox:p.d,CreateTiledBox:Q,CreateSphere:V.d,CreateDisc:j.b,CreateIcoSphere:N,CreateRibbon:z,CreateCylinder:P,CreateTorus:d,CreateTorusKnot:y,CreateLineSystem:a.d,az:a.e,CreateDashedLines:a.b,ExtrudeShape:D,ExtrudeShapeCustom:l,CreateLathe:J,CreateTiledPlane:b,Dz:o.b,CreateGround:B.e,CreateTiledGround:B.h,CreateGroundFromHeightMap:B.d,CreatePolygon:r.c,ExtrudePolygon:r.g,CreateTube:k,CreatePolyhedron:h,CreateGeodesic:function(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=U.m||1;m!==Math.floor(m)&&(m=Math.floor(m),I.d.Warn("m not an integer only floor(m) used"));let O=U.n||0;if(O!==Math.floor(O)&&(O=Math.floor(O),I.d.Warn("n not an integer only floor(n) used")),O>m){const C=O;O=m,m=C,I.d.Warn("n > m therefore m and n swapped")}const X=new KC;return X.build(m,O),h(C,{custom:OC.BuildGeodesicData(X),size:U.size,sizeX:U.sizeX,sizeY:U.sizeY,sizeZ:U.sizeZ,faceUV:U.faceUV,faceColors:U.faceColors,flat:U.flat,updatable:U.updatable,sideOrientation:U.sideOrientation,frontUVs:U.frontUVs,backUVs:U.backUVs},K)},CreateGoldberg:function(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=U.size,t=U.sizeX||X||1,z=U.sizeY||X||1,j=U.sizeZ||X||1;let p=U.m||1;p!==Math.floor(p)&&(p=Math.floor(p),I.d.Warn("m not an integer only floor(m) used"));let u=U.n||0;if(u!==Math.floor(u)&&(u=Math.floor(u),I.d.Warn("n not an integer only floor(n) used")),u>p){const C=u;u=p,p=C,I.d.Warn("n > m therefore m and n swapped")}const b=new KC;b.build(p,u);const v=OC.BuildGeodesicData(b),Q=v.toGoldbergPolyhedronData(),V=new XC(C,K);U.sideOrientation=O.b._GetDefaultSideOrientation(U.sideOrientation),V._originalBuilderSideOrientation=U.sideOrientation;(function(C,U){const K=C.size,O=C.sizeX||K||1,X=C.sizeY||K||1,t=C.sizeZ||K||1,z=0===C.sideOrientation?0:C.sideOrientation||A.e.DEFAULTSIDE,j=[],p=[],E=[],u=[];let b=1/0,v=-1/0,Q=1/0,V=-1/0;for(let m=0;m<U.vertex.length;m++)b=Math.min(b,U.vertex[m][0]*O),v=Math.max(v,U.vertex[m][0]*O),Q=Math.min(Q,U.vertex[m][1]*X),V=Math.max(V,U.vertex[m][1]*X);let f=0;for(let A=0;A<U.face.length;A++){const C=U.face[A],K=m.bU.FU(U.vertex[C[0]]),z=m.bU.FU(U.vertex[C[2]]),F=m.bU.FU(U.vertex[C[1]]),Z=z.vU(K),P=F.vU(K),H=m.bU.Cross(P,Z).normalize();for(let m=0;m<C.length;m++){E.push(H.x,H.y,H.z);const K=U.vertex[C[m]];j.push(K[0]*O,K[1]*X,K[2]*t);const A=(K[1]*X-Q)/(V-Q);u.push((K[0]*O-b)/(v-b),e.e?1-A:A)}for(let U=0;U<C.length-2;U++)p.push(f,f+U+2,f+U+1);f+=C.length}A.e._ComputeSides(z,j,p,E,u);const F=new A.e;return F.yC=j,F.indices=p,F.aC=E,F.iC=u,F})(U,Q).lC(V,U.updatable),V.goldbergData.nbSharedFaces=v.sharedNodes,V.goldbergData.nbUnsharedFaces=v.poleNodes,V.goldbergData.adjacentFaces=v.adjacentFaces,V.goldbergData.nbFaces=V.goldbergData.nbSharedFaces+V.goldbergData.nbUnsharedFaces,V.goldbergData.nbFacesAtPole=(V.goldbergData.nbUnsharedFaces-12)/12;for(let O=0;O<v.vertex.length;O++)V.goldbergData.faceCenters.push(m.bU.FU(v.vertex[O])),V.goldbergData.faceCenters[O].x*=t,V.goldbergData.faceCenters[O].y*=z,V.goldbergData.faceCenters[O].z*=j,V.goldbergData.faceColors.push(new E.ve(1,1,1,1));for(let O=0;O<Q.face.length;O++){const C=Q.face[O],U=m.bU.FU(Q.vertex[C[0]]),K=m.bU.FU(Q.vertex[C[2]]),X=m.bU.FU(Q.vertex[C[1]]),A=K.vU(U),e=X.vU(U),t=m.bU.Cross(e,A).normalize(),z=m.bU.Cross(e,t).normalize();V.goldbergData.faceXaxis.push(e.normalize()),V.goldbergData.faceYaxis.push(t),V.goldbergData.faceZaxis.push(z)}return V},CreateDecal:s,CreateCapsule:q,CreateText:AC.h}},13098:(C,U,K)=>{"use strict";K.d(U,{c:()=>eU});var m=K(11827),O=K(12216);class X extends O.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var A=K(11879),e=(K(11998),K(11789));class t{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(C){this._targetStopDuration!==C&&(this._targetStopDuration=C)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(C){this._noiseTexture!==C&&(this._noiseTexture=C,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(C){this._animationSheetEnabled!==C&&(this._animationSheetEnabled=C)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(C){this._isAnimationSheetEnabled!=C&&(this._isAnimationSheetEnabled=C,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(C){this._useLogarithmicDepth=C&&this.dC().getEngine().getCaps().fragmentDepthSupported}dC(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(C){switch(C){case t.BLENDMODE_MULTIPLYADD:return;case t.BLENDMODE_ADD:C=1;break;case t.BLENDMODE_ONEONE:C=6;break;case t.BLENDMODE_STANDARD:C=2;break;case t.BLENDMODE_MULTIPLY:C=4;break;case t.BLENDMODE_SUBTRACT:C=3}this._engine.setAlphaMode(C)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:m.bU.Zero()}set direction1(C){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=C)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:m.bU.Zero()}set direction2(C){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=C)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:m.bU.Zero()}set minEmitBox(C){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=C)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:m.bU.Zero()}set maxEmitBox(C){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=C)}get billboardMode(){return this._billboardMode}set billboardMode(C){this._billboardMode!==C&&(this._billboardMode=C,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(C){this._isBillboardBased!==C&&(this._isBillboardBased=C,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(C){this._attachImageProcessingConfiguration(C)}_attachImageProcessingConfiguration(C){C!==this._imageProcessingConfiguration&&(!C&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=C)}_reset(){}_removeGradientAndTexture(C,U,K){if(!U)return this;let m=0;for(const O of U){if(O.gradient===C){U.splice(m,1);break}m++}return K&&K.dispose(),this}constructor(C){this.animations=[],this.renderingGroupId=0,this.mU=m.bU.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new m.bU(10,10,10),this.onAnimationEnd=null,this.blendMode=t.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new m.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.dz=new m.bU(0,0,0),this._useLogarithmicDepth=!1,this.gravity=m.bU.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new A.ve(1,1,1,1),this.color2=new A.ve(1,1,1,1),this.colorDead=new A.ve(0,0,0,1),this.textureMask=new A.ve(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new X,this.id=C,this.name=C}createPointEmitter(C,U){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new m.bU(0,1,0),arguments.length>2&&void 0!==arguments[2]||new m.bU(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new m.bU(0,1,0),arguments.length>4&&void 0!==arguments[4]||new m.bU(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new m.bU(0,1,0),arguments.length>3&&void 0!==arguments[3]||new m.bU(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(C,U,K,m){throw new Error("Method not implemented.")}}t.BLENDMODE_ONEONE=0,t.BLENDMODE_STANDARD=1,t.BLENDMODE_ADD=2,t.BLENDMODE_MULTIPLY=3,t.BLENDMODE_MULTIPLYADD=4,t.BLENDMODE_SUBTRACT=-1,(0,e.h)("BABYLON.BaseParticleSystem",t);var z=K(11846),j=K(11685);class p{constructor(){this.direction1=new m.bU(0,1,0),this.direction2=new m.bU(0,1,0),this.minEmitBox=new m.bU(-.5,-.5,-.5),this.maxEmitBox=new m.bU(.5,.5,.5)}startDirectionFunction(C,U,K,O){const X=(0,z.RandomRange)(this.direction1.x,this.direction2.x),A=(0,z.RandomRange)(this.direction1.y,this.direction2.y),e=(0,z.RandomRange)(this.direction1.z,this.direction2.z);if(O)return U.x=X,U.y=A,void(U.z=e);m.bU.TransformNormalFromFloatsToRef(X,A,e,C,U)}startPositionFunction(C,U,K,O){const X=(0,z.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),A=(0,z.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),e=(0,z.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(O)return U.x=X,U.y=A,void(U.z=e);m.bU.TransformCoordinatesFromFloatsToRef(X,A,e,C,U)}clone(){const C=new p;return j.b.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2),C.setVector3("minEmitBox",this.minEmitBox),C.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3),C.addUniform("minEmitBox",3),C.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.direction1=this.direction1.Oe(),C.direction2=this.direction2.Oe(),C.minEmitBox=this.minEmitBox.Oe(),C.maxEmitBox=this.maxEmitBox.Oe(),C}parse(C){m.bU.FromArrayToRef(C.direction1,0,this.direction1),m.bU.FromArrayToRef(C.direction2,0,this.direction2),m.bU.FromArrayToRef(C.minEmitBox,0,this.minEmitBox),m.bU.FromArrayToRef(C.maxEmitBox,0,this.maxEmitBox)}}class E{get radius(){return this._radius}set radius(C){this._radius=C,this._buildHeight()}get angle(){return this._angle}set angle(C){this._angle=C,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=K,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=U,this.radius=C}startDirectionFunction(C,U,K,O){O?m.TmpVectors.bU[0].m(K.ne).normalize():K.position.subtractToRef(C.getTranslation(),m.TmpVectors.bU[0]).normalize();const X=(0,z.RandomRange)(0,this.directionRandomizer),A=(0,z.RandomRange)(0,this.directionRandomizer),e=(0,z.RandomRange)(0,this.directionRandomizer);U.x=m.TmpVectors.bU[0].x+X,U.y=m.TmpVectors.bU[0].y+A,U.z=m.TmpVectors.bU[0].z+e,U.normalize()}startPositionFunction(C,U,K,O){const X=(0,z.RandomRange)(0,2*Math.PI);let A;this.emitFromSpawnPointOnly?A=1e-4:(A=(0,z.RandomRange)(0,this.heightRange),A=1-A*A);let e=this._radius-(0,z.RandomRange)(0,this._radius*this.radiusRange);e*=A;const t=e*Math.sin(X),j=e*Math.cos(X),p=A*this._height;if(O)return U.x=t,U.y=p,void(U.z=j);m.bU.TransformCoordinatesFromFloatsToRef(t,p,j,C,U)}clone(){const C=new E(this._radius,this._angle,this.directionRandomizer);return j.b.DeepCopy(this,C),C}applyToShader(C){C.setFloat2("radius",this._radius,this.radiusRange),C.setFloat("coneAngle",this._angle),C.setFloat2("height",this._height,this.heightRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("radius",2),C.addUniform("coneAngle",1),C.addUniform("height",2),C.addUniform("directionRandomizer",1)}getEffectDefines(){let C="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(C+="\n#define CONEEMITTERSPAWNPOINT"),C}getClassName(){return"ConeParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.radius=this._radius,C.angle=this._angle,C.directionRandomizer=this.directionRandomizer,C.radiusRange=this.radiusRange,C.heightRange=this.heightRange,C.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,C}parse(C){this.radius=C.radius,this.angle=C.angle,this.directionRandomizer=C.directionRandomizer,this.radiusRange=void 0!==C.radiusRange?C.radiusRange:1,this.heightRange=void 0!==C.radiusRange?C.heightRange:1,this.emitFromSpawnPointOnly=void 0!==C.emitFromSpawnPointOnly&&C.emitFromSpawnPointOnly}}class u extends E{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.bU(0,1,0),O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new m.bU(0,1,0);super(C,U),this.direction1=K,this.direction2=O}startDirectionFunction(C,U){const K=(0,z.RandomRange)(this.direction1.x,this.direction2.x),O=(0,z.RandomRange)(this.direction1.y,this.direction2.y),X=(0,z.RandomRange)(this.direction1.z,this.direction2.z);m.bU.TransformNormalFromFloatsToRef(K,O,X,C,U)}clone(){const C=new u(this.radius,this.angle,this.direction1,this.direction2);return j.b.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.Oe(),C.direction2=this.direction2.Oe(),C}parse(C){super.parse(C),this.direction1.m(C.direction1),this.direction2.m(C.direction2)}}class b{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=C,this.height=U,this.radiusRange=K,this.directionRandomizer=O,this._tempVector=m.bU.Zero()}startDirectionFunction(C,U,K,O,X){K.position.subtractToRef(C.getTranslation(),this._tempVector),this._tempVector.normalize(),m.bU.TransformNormalToRef(this._tempVector,X,this._tempVector);const A=(0,z.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let e=Math.atan2(this._tempVector.x,this._tempVector.z);e+=(0,z.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=A,this._tempVector.x=Math.sin(e),this._tempVector.z=Math.cos(e),this._tempVector.normalize(),O?U.m(this._tempVector):m.bU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,C,U)}startPositionFunction(C,U,K,O){const X=(0,z.RandomRange)(-this.height/2,this.height/2),A=(0,z.RandomRange)(0,2*Math.PI),e=(0,z.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),t=Math.sqrt(e)*this.radius,j=t*Math.cos(A),p=t*Math.sin(A);O?U.Ee(j,X,p):m.bU.TransformCoordinatesFromFloatsToRef(j,X,p,C,U)}clone(){const C=new b(this.radius,this.directionRandomizer);return j.b.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("height",this.height),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("height",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.radius=this.radius,C.height=this.height,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.radius=C.radius,this.height=C.height,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class v extends b{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new m.bU(0,1,0),X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new m.bU(0,1,0);super(C,U,K),this.direction1=O,this.direction2=X}startDirectionFunction(C,U,K,O){const X=(0,z.RandomRange)(this.direction1.x,this.direction2.x),A=(0,z.RandomRange)(this.direction1.y,this.direction2.y),e=(0,z.RandomRange)(this.direction1.z,this.direction2.z);O?U.Ee(X,A,e):m.bU.TransformNormalFromFloatsToRef(X,A,e,C,U)}clone(){const C=new v(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return j.b.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("height",this.height),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("height",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.Oe(),C.direction2=this.direction2.Oe(),C}parse(C){super.parse(C),m.bU.FromArrayToRef(C.direction1,0,this.direction1),m.bU.FromArrayToRef(C.direction2,0,this.direction2)}}class Q{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=C,this.radiusRange=U,this.directionRandomizer=K}startDirectionFunction(C,U,K,O){const X=K.position.vU(C.getTranslation()).normalize(),A=(0,z.RandomRange)(0,this.directionRandomizer),e=(0,z.RandomRange)(0,this.directionRandomizer),t=(0,z.RandomRange)(0,this.directionRandomizer);X.x+=A,X.y+=e,X.z+=t,X.normalize(),O?U.m(X):m.bU.TransformNormalFromFloatsToRef(X.x,X.y,X.z,C,U)}startPositionFunction(C,U,K,O){const X=this.radius-(0,z.RandomRange)(0,this.radius*this.radiusRange),A=(0,z.RandomRange)(0,1),e=(0,z.RandomRange)(0,2*Math.PI),t=Math.acos(2*A-1),j=X*Math.cos(e)*Math.sin(t),p=X*Math.cos(t),E=X*Math.sin(e)*Math.sin(t);O?U.Ee(j,Math.abs(p),E):m.bU.TransformCoordinatesFromFloatsToRef(j,Math.abs(p),E,C,U)}clone(){const C=new Q(this.radius,this.directionRandomizer);return j.b.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.radius=this.radius,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.radius=C.radius,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class V{constructor(){this.direction1=new m.bU(0,1,0),this.direction2=new m.bU(0,1,0)}startDirectionFunction(C,U,K,O){const X=(0,z.RandomRange)(this.direction1.x,this.direction2.x),A=(0,z.RandomRange)(this.direction1.y,this.direction2.y),e=(0,z.RandomRange)(this.direction1.z,this.direction2.z);O?U.Ee(X,A,e):m.bU.TransformNormalFromFloatsToRef(X,A,e,C,U)}startPositionFunction(C,U,K,O){O?U.Ee(0,0,0):m.bU.TransformCoordinatesFromFloatsToRef(0,0,0,C,U)}clone(){const C=new V;return j.b.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.direction1=this.direction1.Oe(),C.direction2=this.direction2.Oe(),C}parse(C){m.bU.FromArrayToRef(C.direction1,0,this.direction1),m.bU.FromArrayToRef(C.direction2,0,this.direction2)}}class f{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=C,this.radiusRange=U,this.directionRandomizer=K}startDirectionFunction(C,U,K,O){const X=K.position.vU(C.getTranslation()).normalize(),A=(0,z.RandomRange)(0,this.directionRandomizer),e=(0,z.RandomRange)(0,this.directionRandomizer),t=(0,z.RandomRange)(0,this.directionRandomizer);X.x+=A,X.y+=e,X.z+=t,X.normalize(),O?U.m(X):m.bU.TransformNormalFromFloatsToRef(X.x,X.y,X.z,C,U)}startPositionFunction(C,U,K,O){const X=this.radius-(0,z.RandomRange)(0,this.radius*this.radiusRange),A=(0,z.RandomRange)(0,1),e=(0,z.RandomRange)(0,2*Math.PI),t=Math.acos(2*A-1),j=X*Math.cos(e)*Math.sin(t),p=X*Math.cos(t),E=X*Math.sin(e)*Math.sin(t);O?U.Ee(j,p,E):m.bU.TransformCoordinatesFromFloatsToRef(j,p,E,C,U)}clone(){const C=new f(this.radius,this.directionRandomizer);return j.b.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("radiusRange",this.radiusRange),C.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("radiusRange",1),C.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.radius=this.radius,C.radiusRange=this.radiusRange,C.directionRandomizer=this.directionRandomizer,C}parse(C){this.radius=C.radius,this.radiusRange=C.radiusRange,this.directionRandomizer=C.directionRandomizer}}class F extends f{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.bU(0,1,0),K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.bU(0,1,0);super(C),this.direction1=U,this.direction2=K}startDirectionFunction(C,U){const K=(0,z.RandomRange)(this.direction1.x,this.direction2.x),O=(0,z.RandomRange)(this.direction1.y,this.direction2.y),X=(0,z.RandomRange)(this.direction1.z,this.direction2.z);m.bU.TransformNormalFromFloatsToRef(K,O,X,C,U)}clone(){const C=new F(this.radius,this.direction1,this.direction2);return j.b.DeepCopy(this,C),C}applyToShader(C){C.setFloat("radius",this.radius),C.setFloat("radiusRange",this.radiusRange),C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("radius",1),C.addUniform("radiusRange",1),C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const C=super.serialize();return C.direction1=this.direction1.Oe(),C.direction2=this.direction2.Oe(),C}parse(C){super.parse(C),this.direction1.m(C.direction1),this.direction2.m(C.direction2)}}class Z{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(C,U,K,O){const X=m.TmpVectors.bU[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,K,X);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,K,X);const C=m.TmpVectors.bU[1];X.subtractToRef(K.position,C),C.scaleToRef(1/K.lifeTime,X)}else X.set(0,0,0);O?U.m(X):m.bU.TransformNormalToRef(X,C,U)}startPositionFunction(C,U,K,O){const X=m.TmpVectors.bU[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,K,X):X.set(0,0,0),O?U.m(X):m.bU.TransformCoordinatesToRef(X,C,U)}clone(){const C=new Z;return j.b.DeepCopy(this,C),C}applyToShader(C){}buildUniformLayout(C){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const C={};return C.type=this.getClassName(),C.particlePositionGenerator=this.particlePositionGenerator,C.particleDestinationGenerator=this.particleDestinationGenerator,C}parse(C){C.particlePositionGenerator&&(this.particlePositionGenerator=C.particlePositionGenerator),C.particleDestinationGenerator&&(this.particleDestinationGenerator=C.particleDestinationGenerator)}}var P=K(11905);class H{get mesh(){return this._mesh}set mesh(C){this._mesh!==C&&(this._mesh=C,C?(this._indices=C.je(),this._positions=C.getVerticesData(P.d.PositionKind),this._normals=C.getVerticesData(P.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=m.bU.Zero(),this._mesh=null,this.direction1=new m.bU(0,1,0),this.direction2=new m.bU(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=C}startDirectionFunction(C,U,K,O){if(this.useMeshNormalsForDirection&&this._normals)return void m.bU.TransformNormalToRef(this._storedNormal,C,U);const X=(0,z.RandomRange)(this.direction1.x,this.direction2.x),A=(0,z.RandomRange)(this.direction1.y,this.direction2.y),e=(0,z.RandomRange)(this.direction1.z,this.direction2.z);O?U.Ee(X,A,e):m.bU.TransformNormalFromFloatsToRef(X,A,e,C,U)}startPositionFunction(C,U,K,O){if(!this._indices||!this._positions)return;const X=3*(Math.random()*(this._indices.length/3)|0),A=Math.random(),e=Math.random()*(1-A),t=1-A-e,z=this._indices[X],j=this._indices[X+1],p=this._indices[X+2],E=m.TmpVectors.bU[0],u=m.TmpVectors.bU[1],b=m.TmpVectors.bU[2],v=m.TmpVectors.bU[3];m.bU.FromArrayToRef(this._positions,3*z,E),m.bU.FromArrayToRef(this._positions,3*j,u),m.bU.FromArrayToRef(this._positions,3*p,b),v.x=A*E.x+e*u.x+t*b.x,v.y=A*E.y+e*u.y+t*b.y,v.z=A*E.z+e*u.z+t*b.z,O?U.Ee(v.x,v.y,v.z):m.bU.TransformCoordinatesFromFloatsToRef(v.x,v.y,v.z,C,U),this.useMeshNormalsForDirection&&this._normals&&(m.bU.FromArrayToRef(this._normals,3*z,E),m.bU.FromArrayToRef(this._normals,3*j,u),m.bU.FromArrayToRef(this._normals,3*p,b),this._storedNormal.x=A*E.x+e*u.x+t*b.x,this._storedNormal.y=A*E.y+e*u.y+t*b.y,this._storedNormal.z=A*E.z+e*u.z+t*b.z)}clone(){const C=new H(this.mesh);return j.b.DeepCopy(this,C),C}applyToShader(C){C.setVector3("direction1",this.direction1),C.setVector3("direction2",this.direction2)}buildUniformLayout(C){C.addUniform("direction1",3),C.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var C;const U={};return U.type=this.getClassName(),U.direction1=this.direction1.Oe(),U.direction2=this.direction2.Oe(),U.meshId=null===(C=this.mesh)||void 0===C?void 0:C.id,U.useMeshNormalsForDirection=this.useMeshNormalsForDirection,U}parse(C,U){m.bU.FromArrayToRef(C.direction1,0,this.direction1),m.bU.FromArrayToRef(C.direction2,0,this.direction2),C.meshId&&U&&(this.mesh=U.getLastMeshById(C.meshId)),this.useMeshNormalsForDirection=C.useMeshNormalsForDirection}}class d{_isUbo(C){return void 0!==C.addUniform}constructor(C){this._isUbo(C)?(this.setMatrix3x3=C.updateMatrix3x3.bind(C),this.setMatrix2x2=C.updateMatrix2x2.bind(C),this.setFloat=C.updateFloat.bind(C),this.setFloat2=C.updateFloat2.bind(C),this.setFloat3=C.updateFloat3.bind(C),this.setFloat4=C.updateFloat4.bind(C),this.setFloatArray=C.updateFloatArray.bind(C),this.setArray=C.updateArray.bind(C),this.setIntArray=C.updateIntArray.bind(C),this.setMatrix=C.ee.bind(C),this.setMatrices=C.updateMatrices.bind(C),this.setVector3=C.updateVector3.bind(C),this.setVector4=C.updateVector4.bind(C),this.setColor3=C.updateColor3.bind(C),this.setColor4=C.updateColor4.bind(C),this.setDirectColor4=C.updateDirectColor4.bind(C),this.setInt=C.updateInt.bind(C),this.setInt2=C.updateInt2.bind(C),this.setInt3=C.updateInt3.bind(C),this.setInt4=C.updateInt4.bind(C)):(this.setMatrix3x3=C.setMatrix3x3.bind(C),this.setMatrix2x2=C.setMatrix2x2.bind(C),this.setFloat=C.setFloat.bind(C),this.setFloat2=C.setFloat2.bind(C),this.setFloat3=C.setFloat3.bind(C),this.setFloat4=C.setFloat4.bind(C),this.setFloatArray=C.setFloatArray.bind(C),this.setArray=C.setArray.bind(C),this.setIntArray=C.setIntArray.bind(C),this.setMatrix=C.setMatrix.bind(C),this.setMatrices=C.setMatrices.bind(C),this.setVector3=C.setVector3.bind(C),this.setVector4=C.setVector4.bind(C),this.setColor3=C.setColor3.bind(C),this.setColor4=C.setColor4.bind(C),this.setDirectColor4=C.setDirectColor4.bind(C),this.setInt=C.setInt.bind(C),this.setInt2=C.setInt2.bind(C),this.setInt3=C.setInt3.bind(C),this.setInt4=C.setInt4.bind(C))}}var T=K(11747);const y="gpuUpdateParticlesPixelShader",a="#version 300 es\nvoid main() {discard;}\n";T.d.ShadersStore[y]||(T.d.ShadersStore[y]=a);const r="gpuUpdateParticlesVertexShader",i="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";T.d.ShadersStore[r]||(T.d.ShadersStore[r]=i);(0,e.h)("BABYLON.WebGL2ParticleSystem",class{constructor(C,U){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=C,this._engine=U,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var C;return(null===(C=this._updateEffect)||void 0===C?void 0:C.isReady())??!1}createUpdateBuffer(C){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Z&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=C,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new d(this._updateEffect)}createVertexBuffers(C,U){this._updateVAO.push(this._createUpdateVAO(C)),this._renderVAO.push(this._engine.recordVertexArrayObject(U,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=U}createParticleBuffer(C){return C}bindDrawBuffers(C,U,K){K?this._engine.bindBuffers(this._renderVertexBuffers,K,U):this._engine.bindVertexArrayObject(this._renderVAO[C],null)}preUpdateParticleBuffer(){const C=this._engine;if(this._engine.enableEffect(this._updateEffect),!C.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(C,U,K){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[C],null);const m=this._engine;m.bindTransformFeedbackBuffer(U.getBuffer()),m.setRasterizerState(!1),m.beginTransformFeedback(!0),m.drawArraysType(3,0,K),m.endTransformFeedback(),m.setRasterizerState(!0),m.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let C=0;C<this._updateVAO.length;C++)this._engine.releaseVertexArrayObject(this._updateVAO[C]);this._updateVAO.length=0;for(let C=0;C<this._renderVAO.length;C++)this._engine.releaseVertexArrayObject(this._renderVAO[C]);this._renderVAO.length=0}_createUpdateVAO(C){const U={};U.position=C.createVertexBuffer("position",0,3);let K=3;U.age=C.createVertexBuffer("age",K,1),K+=1,U.size=C.createVertexBuffer("size",K,3),K+=3,U.life=C.createVertexBuffer("life",K,1),K+=1,U.seed=C.createVertexBuffer("seed",K,4),K+=4,U.direction=C.createVertexBuffer("direction",K,3),K+=3,this._parent.particleEmitterType instanceof Z&&(U.initialPosition=C.createVertexBuffer("initialPosition",K,3),K+=3),this._parent._colorGradientsTexture||(U.color=C.createVertexBuffer("color",K,4),K+=4),this._parent._isBillboardBased||(U.initialDirection=C.createVertexBuffer("initialDirection",K,3),K+=3),this._parent.noiseTexture&&(U.noiseCoordinates1=C.createVertexBuffer("noiseCoordinates1",K,3),K+=3,U.noiseCoordinates2=C.createVertexBuffer("noiseCoordinates2",K,3),K+=3),this._parent._angularSpeedGradientsTexture?(U.angle=C.createVertexBuffer("angle",K,1),K+=1):(U.angle=C.createVertexBuffer("angle",K,2),K+=2),this._parent._isAnimationSheetEnabled&&(U.cellIndex=C.createVertexBuffer("cellIndex",K,1),K+=1,this._parent.spriteRandomStartCell&&(U.cellStartOffset=C.createVertexBuffer("cellStartOffset",K,1),K+=1));const m=this._engine.recordVertexArrayObject(U,null,this._updateEffect);return this._engine.bindArrayBuffer(null),m}});class D{constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,m=arguments.length>3?arguments[3]:void 0;this._engine=C,this._label=m,this._engine._storageBuffers.push(this),this._create(U,K)}_create(C,U){this._bufferSize=C,this._creationFlags=U,this._buffer=this._engine.createStorageBuffer(C,U,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(C,U,K){this._buffer&&this._engine.updateStorageBuffer(this._buffer,C,U,K)}async read(C,U,K,m){return await this._engine.readFromStorageBuffer(this._buffer,C,U,K,m)}dispose(){const C=this._engine._storageBuffers,U=C.indexOf(this);-1!==U&&(C[U]=C[C.length-1],C.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var l=K(11810),G=K(11818),J=K(11863),o=K(11808),B=K(12142),k=K(11679),w=K(11775),h=K(12053);class c{constructor(){this._gpuTimeInFrameId=-1,this.counter=new h.d}_addDuration(C,U){C<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==C?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(U,!1),this._gpuTimeInFrameId=C):this.counter.addCount(U,!1))}}var N=K(11733);class g{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=C,this._engine=U,this.uniqueId=B.e.UniqueId,U.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new c),this._engine.getCaps().supportComputeShaders?m.bindingsMapping?(this._context=U.createComputeContext(),this._shaderPath=K,this._options={bindingsMapping:{},defines:[],...m}):k.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):k.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(C,U){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const m=this._bindings[C];this._bindings[C]={type:K?0:4,object:U,indexInGroupEntries:null===m||void 0===m?void 0:m.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!m||m.object!==U||m.type!==this._bindings[C].type)}setStorageTexture(C,U){const K=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!K||K.object!==U),this._bindings[C]={type:1,object:U,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}setExternalTexture(C,U){const K=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!K||K.object!==U),this._bindings[C]={type:6,object:U,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}setVideoTexture(C,U){return!!U.externalTexture&&(this.setExternalTexture(C,U.externalTexture),!0)}setUniformBuffer(C,U){const K=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!K||K.object!==U),this._bindings[C]={type:g._BufferIsDataBuffer(U)?7:2,object:U,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}setStorageBuffer(C,U){const K=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!K||K.object!==U),this._bindings[C]={type:g._BufferIsDataBuffer(U)?7:3,object:U,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}setTextureSampler(C,U){const K=this._bindings[C];this._contextIsDirty||(this._contextIsDirty=!K||!U.compareSampler(K.object)),this._bindings[C]={type:5,object:U,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}isReady(){let C=this._effect;for(const O in this._bindings){const C=this._bindings[O],U=C.type,K=C.object;switch(U){case 0:case 4:case 1:if(!K.isReady())return!1;break;case 6:if(!K.isReady())return!1;break}}const U=[],K=this._shaderPath;if(this._options.defines)for(let O=0;O<this._options.defines.length;O++)U.push(this._options.defines[O]);const m=U.join("\n");return this._cachedDefines!==m&&(this._cachedDefines=m,C=this._engine.createComputeEffect(K,{defines:m,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=C),!!C.isReady()}dispatch(C,U,K){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,C,U,K,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const K=g._BufferIsDataBuffer(C)?C:C.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,K,U,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const U in this._bindings){const K=this._bindings[U];if(!this._options.bindingsMapping[U])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+U+"'");switch(K.type){case 0:{const m=this._samplers[U],O=K.object;var C;if(!m||!O._texture||!m.compareSampler(O._texture))this._samplers[U]=(new w.d).setParameters(O.wrapU,O.wrapV,O.wrapR,O.anisotropicFilteringLevel,O._texture.samplingMode,null===(C=O._texture)||void 0===C?void 0:C._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const C=K.object;C.getBuffer()!==K.buffer&&(K.buffer=C.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((O=>{(0,N.c)((()=>this.dispatch(C,U,K)),O,void 0,m)}))}serialize(){const C=J.c.Serialize(this);C.options=this._options,C.shaderPath=this._shaderPath,C.uE={},C.textures={};for(const U in this._bindings){const K=this._bindings[U],m=K.object;switch(K.type){case 0:case 4:case 1:{const O=m.serialize();O&&(C.textures[U]=O,C.uE[U]={type:K.type});break}}}return C}static Parse(C,U,K){const m=J.c.Parse((()=>new g(C.name,U.getEngine(),C.shaderPath,C.options)),C,U,K);for(const O in C.textures){const X=C.uE[O],A=o.b.Parse(C.textures[O],U,K);0===X.type?m.setTexture(O,A):4===X.type?m.setTexture(O,A,!1):m.setStorageTexture(O,A)}return m}static _BufferIsDataBuffer(C){return void 0!==C.underlyingResource}}(0,l.d)([(0,G.O)()],g.prototype,"name",void 0),(0,l.d)([(0,G.O)()],g.prototype,"fastMode",void 0),(0,e.h)("BABYLON.ComputeShader",g);var M=K(12099);const L="gpuUpdateParticlesComputeShader",Y="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";T.d.ShadersStoreWGSL[L]||(T.d.ShadersStoreWGSL[L]=Y);(0,e.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(C,U){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=C,this._engine=U}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var C;return(null===(C=this._updateComputeShader)||void 0===C?void 0:C.isReady())??!1}createUpdateBuffer(C){var U;const K={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(K.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(K.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(K.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(K.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(K.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(K.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(K.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new g("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:K,defines:C.split("\n")}),null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=new M.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new d(this._simParamsComputeShader)}createVertexBuffers(C,U){this._renderVertexBuffers.push(U)}createParticleBuffer(C){const U=new D(this._engine,4*C.length,11,"ComputeShaderParticleSystemBuffer");return U.update(C),this._bufferComputeShader.push(U),U.getBuffer()}bindDrawBuffers(C,U,K){this._engine.bindBuffers(this._renderVertexBuffers[C],K,U)}preUpdateParticleBuffer(){}updateParticleBuffer(C,U,K){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[C]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^C]),this._updateComputeShader.dispatch(Math.ceil(K/64))}releaseBuffers(){var C;for(let U=0;U<this._bufferComputeShader.length;++U)this._bufferComputeShader[U].dispose();this._bufferComputeShader.length=0,null===(C=this._simParamsComputeShader)||void 0===C||C.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class W{constructor(C,U,K){this.gradient=C,this.color1=U,this.color2=K}getColorToRef(C){this.color2?A.ve.LerpToRef(this.color1,this.color2,Math.random(),C):C.m(this.color1)}}class x{constructor(C,U){this.gradient=C,this.color=U}}class n{constructor(C,U,K){this.gradient=C,this.factor1=U,this.factor2=K}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class S{static GetCurrentGradient(C,U,K){if(U[0].gradient>C)return void K(U[0],U[0],1);for(let O=0;O<U.length-1;O++){const m=U[O],X=U[O+1];if(C>=m.gradient&&C<=X.gradient){return void K(m,X,(C-m.gradient)/(X.gradient-m.gradient))}}const m=U.length-1;K(U[m],U[m],1)}}var s=K(11663),R=K(12318),q=K(11703);class I{constructor(C){this.particleSystem=C,this.position=m.bU.Zero(),this.direction=m.bU.Zero(),this.color=new A.ve(0,0,0,0),this.colorStep=new A.ve(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new m.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new A.ve(0,0,0,0),this._currentColor2=new A.ve(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=I._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let C=this.age,U=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===U?(U=1,C=this._randomCellOffset):C+=this._randomCellOffset);const K=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let m;m=this._initialSpriteCellLoop?(0,z.Clamp)(C*U%this.lifeTime/this.lifeTime):(0,z.Clamp)(C*U/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+m*K|0}_inheritParticleInfoToSubEmitter(C){if(C.particleSystem.mU.position){const U=C.particleSystem.mU;if(U.position.m(this.position),C.inheritDirection){const C=m.TmpVectors.bU[0];this.direction.normalizeToRef(C),U.setDirection(C,0,Math.PI/2)}}else{C.particleSystem.mU.m(this.position)}this.direction.scaleToRef(C.inheritedVelocityAmount/2,m.TmpVectors.bU[0]),C.particleSystem._inheritedVelocityOffset.m(m.TmpVectors.bU[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const C of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(C)}_reset(){this.age=0,this.id=I._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(C){C.position.m(this.position),this._initialDirection?C._initialDirection?C._initialDirection.m(this._initialDirection):C._initialDirection=this._initialDirection.clone():C._initialDirection=null,C.direction.m(this.direction),this.ne&&(C.ne?C.ne.m(this.ne):C.ne=this.ne.clone()),C.color.m(this.color),C.colorStep.m(this.colorStep),C.lifeTime=this.lifeTime,C.age=this.age,C._randomCellOffset=this._randomCellOffset,C.size=this.size,C.scale.m(this.scale),C.angle=this.angle,C.angularSpeed=this.angularSpeed,C.particleSystem=this.particleSystem,C.cellIndex=this.cellIndex,C.id=this.id,C._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(C._currentColorGradient=this._currentColorGradient,C._currentColor1.m(this._currentColor1),C._currentColor2.m(this._currentColor2)),this._currentSizeGradient&&(C._currentSizeGradient=this._currentSizeGradient,C._currentSize1=this._currentSize1,C._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(C._currentAngularSpeedGradient=this._currentAngularSpeedGradient,C._currentAngularSpeed1=this._currentAngularSpeed1,C._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(C._currentVelocityGradient=this._currentVelocityGradient,C._currentVelocity1=this._currentVelocity1,C._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(C._currentLimitVelocityGradient=this._currentLimitVelocityGradient,C._currentLimitVelocity1=this._currentLimitVelocity1,C._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(C._currentDragGradient=this._currentDragGradient,C._currentDrag1=this._currentDrag1,C._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(C._initialStartSpriteCellId=this._initialStartSpriteCellId,C._initialEndSpriteCellId=this._initialEndSpriteCellId,C._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(C.remapData&&this.remapData?C.remapData.m(this.remapData):C.remapData=new m.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(C._randomNoiseCoordinates1?(C._randomNoiseCoordinates1.m(this._randomNoiseCoordinates1),C._randomNoiseCoordinates2.m(this._randomNoiseCoordinates2)):(C._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),C._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}I._Count=0;var CC=K(11947),UC=(K(11990),K(12200)),KC=K(12198),mC=K(12093);function OC(C,U){const K=(0,z.RandomRange)(0,1);A.ve.LerpToRef(U.color1,U.color2,K,C.color),U.colorDead.subtractToRef(C.color,U._colorDiff),U._colorDiff.scaleToRef(1/C.lifeTime,C.colorStep)}function XC(C,U){C._currentColorGradient=U._colorGradients[0],C._currentColorGradient.getColorToRef(C.color),C._currentColor1.m(C.color),U._colorGradients.length>1?U._colorGradients[1].getColorToRef(C._currentColor2):C._currentColor2.m(C.color)}function AC(C,U){const K=U._colorGradients;S.GetCurrentGradient(U._ratio,K,((U,K,m)=>{U!==C._currentColorGradient&&(C._currentColor1.m(C._currentColor2),K.getColorToRef(C._currentColor2),C._currentColorGradient=U),A.ve.LerpToRef(C._currentColor1,C._currentColor2,m,C.color)}))}function eC(C,U){C.colorStep.scaleToRef(U._scaledUpdateSpeed,U._scaledColorStep),C.color.addInPlace(U._scaledColorStep),C.color.a<0&&(C.color.a=0)}function tC(C,U){S.GetCurrentGradient(U._ratio,U._angularSpeedGradients,((U,K,m)=>{U!==C._currentAngularSpeedGradient&&(C._currentAngularSpeed1=C._currentAngularSpeed2,C._currentAngularSpeed2=K.getFactor(),C._currentAngularSpeedGradient=U),C.angularSpeed=(0,z.Lerp)(C._currentAngularSpeed1,C._currentAngularSpeed2,m)}))}function zC(C,U){C.angle+=C.angularSpeed*U._scaledUpdateSpeed}function jC(C,U){U.particleEmitterType.startDirectionFunction(U._emitterWorldMatrix,C.direction,C,U.isLocal,U._emitterInverseWorldMatrix)}function pC(C,U){U.startDirectionFunction(U._emitterWorldMatrix,C.direction,C,U.isLocal)}function EC(C,U){C._currentVelocityGradient=U._velocityGradients[0],C._currentVelocity1=C._currentVelocityGradient.getFactor(),U._velocityGradients.length>1?C._currentVelocity2=U._velocityGradients[1].getFactor():C._currentVelocity2=C._currentVelocity1}function uC(C,U){C._currentLimitVelocityGradient=U._limitVelocityGradients[0],C._currentLimitVelocity1=C._currentLimitVelocityGradient.getFactor(),U._limitVelocityGradients.length>1?C._currentLimitVelocity2=U._limitVelocityGradients[1].getFactor():C._currentLimitVelocity2=C._currentLimitVelocity1}function bC(C,U){S.GetCurrentGradient(U._ratio,U._velocityGradients,((K,m,O)=>{K!==C._currentVelocityGradient&&(C._currentVelocity1=C._currentVelocity2,C._currentVelocity2=m.getFactor(),C._currentVelocityGradient=K),U._directionScale*=(0,z.Lerp)(C._currentVelocity1,C._currentVelocity2,O)}))}function vC(C,U){S.GetCurrentGradient(U._ratio,U._limitVelocityGradients,((K,m,O)=>{K!==C._currentLimitVelocityGradient&&(C._currentLimitVelocity1=C._currentLimitVelocity2,C._currentLimitVelocity2=m.getFactor(),C._currentLimitVelocityGradient=K);const X=(0,z.Lerp)(C._currentLimitVelocity1,C._currentLimitVelocity2,O);C.direction.length()>X&&C.direction.scaleInPlace(U.limitVelocityDamping)}))}function QC(C,U){C.direction.scaleToRef(U._directionScale,U._scaledDirection)}function VC(C,U){U.particleEmitterType.startPositionFunction(U._emitterWorldMatrix,C.position,C,U.isLocal)}function fC(C,U){U.startPositionFunction(U._emitterWorldMatrix,C.position,C,U.isLocal)}function FC(C,U){C.ne?C.ne.m(C.position):C.ne=C.position.clone(),m.bU.TransformCoordinatesToRef(C.ne,U._emitterWorldMatrix,C.position)}function ZC(C,U){U.isLocal&&C.ne?(C.ne.addInPlace(U._scaledDirection),m.bU.TransformCoordinatesToRef(C.ne,U._emitterWorldMatrix,C.position)):C.position.addInPlace(U._scaledDirection)}function PC(C,U){C._currentDragGradient=U._dragGradients[0],C._currentDrag1=C._currentDragGradient.getFactor(),U._dragGradients.length>1?C._currentDrag2=U._dragGradients[1].getFactor():C._currentDrag2=C._currentDrag1}function HC(C,U){S.GetCurrentGradient(U._ratio,U._dragGradients,((K,m,O)=>{K!==C._currentDragGradient&&(C._currentDrag1=C._currentDrag2,C._currentDrag2=m.getFactor(),C._currentDragGradient=K);const X=(0,z.Lerp)(C._currentDrag1,C._currentDrag2,O);U._scaledDirection.scaleInPlace(1-X)}))}function dC(C,U){C._randomNoiseCoordinates1?(C._randomNoiseCoordinates1.Ee(Math.random(),Math.random(),Math.random()),C._randomNoiseCoordinates2.Ee(Math.random(),Math.random(),Math.random())):(C._randomNoiseCoordinates1=new m.bU(Math.random(),Math.random(),Math.random()),C._randomNoiseCoordinates2=new m.bU(Math.random(),Math.random(),Math.random()))}function TC(C,U){const K=U._noiseTextureData,O=U._noiseTextureSize;if(K&&O&&C._randomNoiseCoordinates1){const X=U._fetchR(C._randomNoiseCoordinates1.x,C._randomNoiseCoordinates1.y,O.width,O.height,K),A=U._fetchR(C._randomNoiseCoordinates1.z,C._randomNoiseCoordinates2.x,O.width,O.height,K),e=U._fetchR(C._randomNoiseCoordinates2.y,C._randomNoiseCoordinates2.z,O.width,O.height,K),t=m.TmpVectors.bU[0],z=m.TmpVectors.bU[1];t.Ee((2*X-1)*U.noiseStrength.x,(2*A-1)*U.noiseStrength.y,(2*e-1)*U.noiseStrength.z),t.scaleToRef(U._tempScaledUpdateSpeed,z),C.direction.addInPlace(z)}}function yC(C,U){U.gravity.scaleToRef(U._tempScaledUpdateSpeed,U._scaledGravity),C.direction.addInPlace(U._scaledGravity)}function aC(C,U){C.size=(0,z.RandomRange)(U.minSize,U.maxSize),C.scale.Ee((0,z.RandomRange)(U.minScaleX,U.maxScaleX),(0,z.RandomRange)(U.minScaleY,U.maxScaleY))}function rC(C,U){C._currentSizeGradient=U._sizeGradients[0],C._currentSize1=C._currentSizeGradient.getFactor(),C.size=C._currentSize1,U._sizeGradients.length>1?C._currentSize2=U._sizeGradients[1].getFactor():C._currentSize2=C._currentSize1,C.scale.Ee((0,z.RandomRange)(U.minScaleX,U.maxScaleX),(0,z.RandomRange)(U.minScaleY,U.maxScaleY))}function iC(C,U){const K=U._actualFrame/U.targetStopDuration;S.GetCurrentGradient(K,U._startSizeGradients,((K,m,O)=>{K!==U._currentStartSizeGradient&&(U._currentStartSize1=U._currentStartSize2,U._currentStartSize2=m.getFactor(),U._currentStartSizeGradient=K);const X=(0,z.Lerp)(U._currentStartSize1,U._currentStartSize2,O);C.scale.scaleInPlace(X)}))}function DC(C,U){S.GetCurrentGradient(U._ratio,U._sizeGradients,((U,K,m)=>{U!==C._currentSizeGradient&&(C._currentSize1=C._currentSize2,C._currentSize2=K.getFactor(),C._currentSizeGradient=U),C.size=(0,z.Lerp)(C._currentSize1,C._currentSize2,m)}))}function lC(C,U){C.remapData=new m.Vector4(0,1,0,1)}function GC(C,U){U._colorRemapGradients&&U._colorRemapGradients.length>0&&S.GetCurrentGradient(U._ratio,U._colorRemapGradients,((U,K,m)=>{const O=(0,z.Lerp)(U.factor1,K.factor1,m),X=(0,z.Lerp)(U.factor2,K.factor2,m);C.remapData.x=O,C.remapData.y=X-O})),U._alphaRemapGradients&&U._alphaRemapGradients.length>0&&S.GetCurrentGradient(U._ratio,U._alphaRemapGradients,((U,K,m)=>{const O=(0,z.Lerp)(U.factor1,K.factor1,m),X=(0,z.Lerp)(U.factor2,K.factor2,m);C.remapData.z=O,C.remapData.w=X-O}))}function JC(C,U){const K=(0,z.Clamp)(U._actualFrame/U.targetStopDuration);S.GetCurrentGradient(K,U._lifeTimeGradients,((U,m)=>{const O=U,X=m,A=O.getFactor(),e=X.getFactor(),t=(K-O.gradient)/(X.gradient-O.gradient);C.lifeTime=(0,z.Lerp)(A,e,t)})),U._emitPower=(0,z.RandomRange)(U.minEmitPower,U.maxEmitPower)}function oC(C,U){C.lifeTime=(0,z.RandomRange)(U.minLifeTime,U.maxLifeTime),U._emitPower=(0,z.RandomRange)(U.minEmitPower,U.maxEmitPower)}function BC(C,U){0===U._emitPower?(C._initialDirection?C._initialDirection.m(C.direction):C._initialDirection=C.direction.clone(),C.direction.set(0,0,0)):(C._initialDirection=null,C.direction.scaleInPlace(U._emitPower)),C.direction.addInPlace(U._inheritedVelocityOffset)}function kC(C,U){C.angularSpeed=(0,z.RandomRange)(U.minAngularSpeed,U.maxAngularSpeed),C.angle=(0,z.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function wC(C,U){C._currentAngularSpeedGradient=U._angularSpeedGradients[0],C.angularSpeed=C._currentAngularSpeedGradient.getFactor(),C._currentAngularSpeed1=C.angularSpeed,U._angularSpeedGradients.length>1?C._currentAngularSpeed2=U._angularSpeedGradients[1].getFactor():C._currentAngularSpeed2=C._currentAngularSpeed1,C.angle=(0,z.RandomRange)(U.minInitialRotation,U.maxInitialRotation)}function hC(C,U){C._initialStartSpriteCellId=U.startSpriteCellID,C._initialEndSpriteCellId=U.endSpriteCellID,C._initialSpriteCellLoop=U.spriteCellLoop}function cC(C,U){C.previousItem=U.previousItem,C.nextItem=U,U.previousItem&&(U.previousItem.nextItem=C),U.previousItem=C}function NC(C,U){C.previousItem=U,C.nextItem=U.nextItem,U.nextItem&&(U.nextItem.previousItem=C),U.nextItem=C}function gC(C,U){let K=U;for(;K.nextItem;)K=K.nextItem;C.previousItem=K,C.nextItem=K.nextItem,K.nextItem=C}function MC(C){C.previousItem&&(C.previousItem.nextItem=C.nextItem),C.nextItem&&(C.nextItem.previousItem=C.previousItem)}class LC extends t{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(C){this._startDirectionFunction!==C&&(this._startDirectionFunction=C,this._directionProcessing.process=C?pC:jC)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(C){this._startPositionFunction!==C&&(this._startPositionFunction=C,this._positionCreation.process=C?fC:VC)}set onDispose(C){this._onDisposeObserver&&this.RA.remove(this._onDisposeObserver),this._onDisposeObserver=this.RA.add(C)}get A(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(C){this._useRampGradients!==C&&(this._useRampGradients=C,this._resetEffect(),C?(this._rampCreation={process:lC,previousItem:null,nextItem:null},NC(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:GC,previousItem:null,nextItem:null},NC(this._remapGradientProcessing,this._gravityProcessing)):(MC(this._rampCreation),MC(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(C){this._isLocal!==C&&(this._isLocal=C,C?(this._isLocalCreation={process:FC,previousItem:null,nextItem:null},NC(this._isLocalCreation,this._positionCreation)):MC(this._isLocalCreation))}get particles(){return this.tE}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(C){this._animationSheetEnabled!==C&&(this._animationSheetEnabled=C,C?(this._sheetCreation={process:hC,previousItem:null,nextItem:null},NC(this._sheetCreation,this._colorCreation)):MC(this._sheetCreation),this._reset())}getActiveCount(){return this.tE.length}getClassName(){return"Pe"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var C;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(C=this._customWrappers[U])||void 0===C?void 0:C.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[C]??this._customWrappers[0]}setCustomEffect(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new CC.d(this._engine),this._customWrappers[U].effect=C,this._customWrappers[U].drawContext&&(this._customWrappers[U].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new s.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(C){if(this.noiseTexture!==C){if(this._noiseTexture=C,!C)return MC(this._noiseCreation),void MC(this._noiseProcessing);this._noiseCreation={process:dC,previousItem:null,nextItem:null},NC(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:TC,previousItem:null,nextItem:null},NC(this._noiseProcessing,this._positionProcessing)}}constructor(C,U,K){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]&&arguments[4],e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(C),this._emitterInverseWorldMatrix=m.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new m.bU,this.RA=new s.b,this.onStoppedObservable=new s.b,this.onStartedObservable=new s.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.tE=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new A.ve(0,0,0,0),this._colorDiff=new A.ve(0,0,0,0),this._scaledDirection=m.bU.Zero(),this._scaledGravity=m.bU.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=C=>{},this.recycleParticle=C=>{const U=this.tE.pop();U!==C&&U.copyTo(C),this._stockParticles.push(U)},this._createParticle=()=>{let C;return 0!==this._stockParticles.length?(C=this._stockParticles.pop(),C._reset()):C=new I(this),this._prepareParticle(C),C},this.paused=!1,this._shadersLoaded=!1,this._capacity=U,this._epsilon=e,K&&"Scene"!==K.getClassName()?(this._engine=K,this.defaultProjectionMatrix=m.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=K||q.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.AE.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:oC,previousItem:null,nextItem:null},this._positionCreation={process:VC,previousItem:null,nextItem:null},NC(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:jC,previousItem:null,nextItem:null},NC(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:BC,previousItem:null,nextItem:null},NC(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:aC,previousItem:null,nextItem:null},NC(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:kC,previousItem:null,nextItem:null},NC(this._angleCreation,this._sizeCreation),this._colorCreation={process:OC,previousItem:null,nextItem:null},NC(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,t||(this._colorProcessing={process:eC,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:zC,previousItem:null,nextItem:null},NC(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:QC,previousItem:null,nextItem:null},NC(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:ZC,previousItem:null,nextItem:null},NC(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:yC,previousItem:null,nextItem:null},NC(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=X,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new CC.d(this._engine)},this._customWrappers[0].effect=O,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new p,this.updateFunction=C=>{var U;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(U=this.noiseTexture.getContent())||void 0===U||U.then((C=>{this._noiseTextureData=C})));const K=C===this.tE;for(let m=0;m<C.length;m++){const U=C[m];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const O=U.age;if(U.age+=this._tempScaledUpdateSpeed,U.age>U.lifeTime){const C=U.age-O,K=U.lifeTime-O;this._tempScaledUpdateSpeed=K*this._tempScaledUpdateSpeed/C,U.age=U.lifeTime}this._ratio=U.age/U.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let X=this._updateQueueStart;for(;X;)X.process(U,this),X=X.nextItem;if(this._isAnimationSheetEnabled&&!t&&U.updateCellIndex(),U._inheritParticleInfoToSubEmitters(),U.age>=U.lifeTime){if(this._emitFromParticle(U),U._attachedSubEmitters){for(const C of U._attachedSubEmitters)C.particleSystem.disposeOnStop=!0,C.particleSystem.stop();U._attachedSubEmitters=null}this.recycleParticle(U),K&&m--}else;}}}serialize(C){throw new Error("Method not implemented.")}clone(C,U){throw new Error("Method not implemented.")}_addFactorGradient(C,U,K,m){const O=new n(U,K,m);C.push(O),C.sort(((C,U)=>C.gradient<U.gradient?-1:C.gradient>U.gradient?1:0))}_removeFactorGradient(C,U){if(!C)return;let K=0;for(const m of C){if(m.gradient===U){C.splice(K,1);break}K++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=JC:this._lifeTimeCreation.process=oC}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:iC,previousItem:null,nextItem:null},NC(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(MC(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(C){this.targetStopDuration!==C&&(this._targetStopDuration=C,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(C,U,K){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,C,U,K),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(C){return this._removeFactorGradient(this._lifeTimeGradients,C),this._syncLifeTimeCreation(),this}addSizeGradient(C,U,K){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=rC,this._sizeGradientProcessing={process:DC,previousItem:null,nextItem:null},cC(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,C,U,K),this}removeSizeGradient(C){var U;return this._removeFactorGradient(this._sizeGradients,C),0===(null===(U=this._sizeGradients)||void 0===U?void 0:U.length)&&(MC(this._sizeGradientProcessing),this._sizeCreation.process=aC),this}addColorRemapGradient(C,U,K){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,C,U,K),this}removeColorRemapGradient(C){return this._removeFactorGradient(this._colorRemapGradients,C),this}addAlphaRemapGradient(C,U,K){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,C,U,K),this}removeAlphaRemapGradient(C){return this._removeFactorGradient(this._alphaRemapGradients,C),this}addAngularSpeedGradient(C,U,K){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=wC,this._angularSpeedGradientProcessing={process:tC,previousItem:null,nextItem:null},cC(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,C,U,K),this}removeAngularSpeedGradient(C){var U;return this._removeFactorGradient(this._angularSpeedGradients,C),0===(null===(U=this._angularSpeedGradients)||void 0===U?void 0:U.length)&&(this._angleCreation.process=kC,MC(this._angularSpeedGradientProcessing)),this}addVelocityGradient(C,U,K){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:EC,previousItem:null,nextItem:null},NC(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:bC,previousItem:null,nextItem:null},cC(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,C,U,K),this}removeVelocityGradient(C){var U;return this._removeFactorGradient(this._velocityGradients,C),0===(null===(U=this._velocityGradients)||void 0===U?void 0:U.length)&&(MC(this._velocityCreation),MC(this._velocityGradientProcessing)),this}addLimitVelocityGradient(C,U,K){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:uC,previousItem:null,nextItem:null},NC(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:vC,previousItem:null,nextItem:null},NC(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,C,U,K),this}removeLimitVelocityGradient(C){var U;return this._removeFactorGradient(this._limitVelocityGradients,C),0===(null===(U=this._limitVelocityGradients)||void 0===U?void 0:U.length)&&(MC(this._limitVelocityCreation),MC(this._limitVelocityGradientProcessing)),this}addDragGradient(C,U,K){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:PC,previousItem:null,nextItem:null},cC(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:HC,previousItem:null,nextItem:null},cC(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,C,U,K),this}removeDragGradient(C){var U;return this._removeFactorGradient(this._dragGradients,C),0===(null===(U=this._dragGradients)||void 0===U?void 0:U.length)&&(MC(this._dragCreation),MC(this._dragGradientProcessing)),this}addEmitRateGradient(C,U,K){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,C,U,K),this}removeEmitRateGradient(C){return this._removeFactorGradient(this._emitRateGradients,C),this}addStartSizeGradient(C,U,K){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,C,U,K),this._syncStartSizeCreation(),this}removeStartSizeGradient(C){return this._removeFactorGradient(this._startSizeGradients,C),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const C=new Uint8Array(4*this._rawTextureWidth),U=A.TmpColors.fU[0];for(let K=0;K<this._rawTextureWidth;K++){const m=K/this._rawTextureWidth;S.GetCurrentGradient(m,this._rampGradients,((m,O,X)=>{A.fU.LerpToRef(m.color,O.color,X,U),C[4*K]=255*U.r,C[4*K+1]=255*U.g,C[4*K+2]=255*U.b,C[4*K+3]=255}))}this._rampGradientsTexture=R.d.CreateRGBATexture(C,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((C,U)=>C.gradient<U.gradient?-1:C.gradient>U.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(C,U){this._rampGradients||(this._rampGradients=[]);const K=new x(C,U);return this._rampGradients.push(K),this._syncRampGradientTexture(),this}removeRampGradient(C){return this._removeGradientAndTexture(C,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(C,U,K){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=XC,this._colorProcessing.process=AC);const m=new W(C,U,K);return this._colorGradients.push(m),this._colorGradients.sort(((C,U)=>C.gradient<U.gradient?-1:C.gradient>U.gradient?1:0)),this}removeColorGradient(C){if(!this._colorGradients)return this;let U=0;for(const K of this._colorGradients){if(K.gradient===C){this._colorGradients.splice(U,1);break}U++}return 0===this._colorGradients.length&&(this._colorCreation.process=OC,this._colorProcessing.process=eC),this}resetDrawCache(){if(this._drawWrappers){for(const C of this._drawWrappers)if(C)for(const U of C)null===U||void 0===U||U.dispose();this._drawWrappers=[]}}_fetchR(C,U,K,m,O){return O[4*(((C=.5*Math.abs(C)+.5)*K%K|0)+((U=.5*Math.abs(U)+.5)*m%m|0)*K)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const C=this._engine,U=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*U),this._vertexBuffer=new P.b(C,this._vertexData,!0,U);let K=0;const m=this._vertexBuffer.createVertexBuffer(P.d.PositionKind,K,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.d.PositionKind]=m,K+=3;const O=this._vertexBuffer.createVertexBuffer(P.d.ColorKind,K,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.d.ColorKind]=O,K+=4;const X=this._vertexBuffer.createVertexBuffer("angle",K,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=X,K+=1;const A=this._vertexBuffer.createVertexBuffer("size",K,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=A,K+=2,this._isAnimationSheetEnabled){const C=this._vertexBuffer.createVertexBuffer("cellIndex",K,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=C,K+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const C=this._vertexBuffer.createVertexBuffer("direction",K,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=C,K+=3}if(this._useRampGradients){const C=this._vertexBuffer.createVertexBuffer("remapData",K,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=C,K+=4}let e;if(this._useInstancing){const U=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new P.b(C,U,!1,2),e=this._spriteBuffer.createVertexBuffer("offset",0,2)}else e=this._vertexBuffer.createVertexBuffer("offset",K,2,this._vertexBufferSize,this._useInstancing),K+=2;this._vertexBuffers.offset=e,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const C=[],U=[];let K=0;for(let m=0;m<this._capacity;m++)C.push(K),C.push(K+1),C.push(K+2),C.push(K),C.push(K+2),C.push(K+3),U.push(K,K+1,K+1,K+2,K+2,K+3,K+3,K,K,K+3),K+=4;this._indexBuffer=this._engine.createIndexBuffer(C),this._linesIndexBuffer=this._engine.createIndexBuffer(U)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(C)setTimeout((()=>{this.start(0)}),C);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var U;-1!==(null===(U=this.mU)||void 0===U?void 0:U.getClassName().indexOf("Mesh"))&&this.mU.te(!0);const C=this.noiseTexture;if(C&&C.onGeneratedObservable)C.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),C.render()}))}));else for(let U=0;U<this.preWarmCycles;U++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(C))}_postStop(C){}reset(){this._stockParticles.length=0,this.tE.length=0}_appendParticleVertex(C,U,K,O){let X=C*this._vertexBufferSize;if(this._vertexData[X++]=U.position.x+this.dz.x,this._vertexData[X++]=U.position.y+this.dz.y,this._vertexData[X++]=U.position.z+this.dz.z,this._vertexData[X++]=U.color.r,this._vertexData[X++]=U.color.g,this._vertexData[X++]=U.color.b,this._vertexData[X++]=U.color.a,this._vertexData[X++]=U.angle,this._vertexData[X++]=U.scale.x*U.size,this._vertexData[X++]=U.scale.y*U.size,this._isAnimationSheetEnabled&&(this._vertexData[X++]=U.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[X++]=U.direction.x,this._vertexData[X++]=U.direction.y,this._vertexData[X++]=U.direction.z);else if(U._initialDirection){let C=U._initialDirection;this.isLocal&&(m.bU.TransformNormalToRef(C,this._emitterWorldMatrix,m.TmpVectors.bU[0]),C=m.TmpVectors.bU[0]),0===C.x&&0===C.z&&(C.x=.001),this._vertexData[X++]=C.x,this._vertexData[X++]=C.y,this._vertexData[X++]=C.z}else{let C=U.direction;this.isLocal&&(m.bU.TransformNormalToRef(C,this._emitterWorldMatrix,m.TmpVectors.bU[0]),C=m.TmpVectors.bU[0]),0===C.x&&0===C.z&&(C.x=.001),this._vertexData[X++]=C.x,this._vertexData[X++]=C.y,this._vertexData[X++]=C.z}this._useRampGradients&&U.remapData&&(this._vertexData[X++]=U.remapData.x,this._vertexData[X++]=U.remapData.y,this._vertexData[X++]=U.remapData.z,this._vertexData[X++]=U.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===K?K=this._epsilon:1===K&&(K=1-this._epsilon),0===O?O=this._epsilon:1===O&&(O=1-this._epsilon)),this._vertexData[X++]=K,this._vertexData[X++]=O)}_prepareParticle(C){}_createNewOnes(C){let U;for(let K=0;K<C&&this.tE.length!==this._capacity;K++){U=this._createParticle(),this.tE.push(U);let C=this._createQueueStart;for(;C;)C.process(U,this),C=C.nextItem;U._inheritParticleInfoToSubEmitters()}}_update(C){if(this._alive=this.tE.length>0,this.mU.position){const C=this.mU;this._emitterWorldMatrix=C.getWorldMatrix()}else{const C=this.mU;this._emitterWorldMatrix=m.Matrix.Translation(C.x,C.y,C.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.tE),this._createNewOnes(C)}static _GetAttributeNamesOrOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const m=[P.d.PositionKind,P.d.ColorKind,"angle","offset","size"];return C&&m.push("cellIndex"),U||m.push("direction"),K&&m.push("remapData"),m}static _GetEffectCreationOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const m=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,UC.d)(m),C&&m.push("particlesInfos"),U&&m.push("logarithmicDepthConstant"),K&&(m.push("vFogInfos"),m.push("vFogColor")),m}fillDefines(C,U){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UC.k)(this,this._scene,C),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&C.push("#define FOG")),this._isAnimationSheetEnabled&&C.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&C.push("#define LOGARITHMICDEPTH"),U===t.BLENDMODE_MULTIPLY&&C.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&C.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(C.push("#define BILLBOARD"),this.billboardMode){case 2:C.push("#define BILLBOARDY");break;case 8:case 9:C.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&C.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:C.push("#define BILLBOARDMODE_ALL")}K&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),C.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(C,U,K){U.push(...LC._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),C.push(...LC._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),K.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,mC.e)(C,this._imageProcessingConfigurationDefines),(0,mC.b)(K,this._imageProcessingConfigurationDefines))}_getWrapper(C){const U=this._getCustomDrawWrapper(C);if(null!==U&&void 0!==U&&U.effect)return U;const K=[];this.fillDefines(K,C);const m=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let O=this._drawWrappers[m];O||(O=this._drawWrappers[m]=[]);let X=O[C];X||(X=new CC.d(this._engine),X.drawContext&&(X.drawContext.useInstancing=this._useInstancing),O[C]=X);const A=K.join("\n");if(X.defines!==A){const C=[],U=[],K=[];this.fillUniformsAttributesAndSamplerNames(U,C,K),X.setEffect(this._engine.createEffect("particles",C,U,K,A,void 0,void 0,void 0,void 0,this._shaderLanguage),A)}return X}animate(){var C;let U,K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!K&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(K?this.preWarmStepOffset:(null===(C=this._scene)||void 0===C?void 0:C.getAnimationRatio())||1),this.manualEmitCount>-1)U=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let C=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const U=this._actualFrame/this.targetStopDuration;S.GetCurrentGradient(U,this._emitRateGradients,((U,K,m)=>{U!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=K.getFactor(),this._currentEmitRateGradient=U),C=(0,z.Lerp)(this._currentEmitRate1,this._currentEmitRate2,m)}))}U=C*this._scaledUpdateSpeed|0,this._newPartsExcess+=C*this._scaledUpdateSpeed-U}if(this._newPartsExcess>1&&(U+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?U=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(U),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!K){let C=0;for(let U=0;U<this.tE.length;U++){const K=this.tE[U];this._appendParticleVertices(C,K),C+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.tE.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(C,U){this._appendParticleVertex(C++,U,0,0),this._useInstancing||(this._appendParticleVertex(C++,U,1,0),this._appendParticleVertex(C++,U,1,1),this._appendParticleVertex(C++,U,0,1))}rebuild(){var C;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(C=this._spriteBuffer)||void 0===C||C._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!LC.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(K.bind(K,13282)),Promise.resolve().then(K.bind(K,13218))])):await Promise.all([Promise.resolve().then(K.bind(K,13203)),Promise.resolve().then(K.bind(K,13189))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.mU||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(t.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(t.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(C){const U=this._getWrapper(C),K=U.effect,O=this._engine;O.enableEffect(U);const X=this.defaultViewMatrix??this._scene.getViewMatrix();if(K.setTexture("diffuseSampler",this.particleTexture),K.setMatrix("view",X),K.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const C=this.particleTexture.getBaseSize();K.setFloat3("particlesInfos",this.spriteCellWidth/C.width,this.spriteCellHeight/C.height,this.spriteCellWidth/C.width)}if(K.setVector2("translationPivot",this.translationPivot),K.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const C=this._scene.activeCamera;K.setVector3("eyePosition",C.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),K.setTexture("rampSampler",this._rampGradientsTexture));const A=K.defines;var e,t,z,j,p,E;(this._scene&&((0,UC.f)(K,this,this._scene),this.applyFog&&(0,KC.f)(this._scene,void 0,K)),A.indexOf("#define BILLBOARDMODE_ALL")>=0&&(X.invertToRef(m.TmpVectors.Matrix[0]),K.setMatrix("invView",m.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?O.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,K):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,K)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?O.bindBuffers(this._vertexBuffers,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBuffer:this._indexBuffer,K):O.bindBuffers(this._vertexBuffers,null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._linesIndexBufferUseInstancing:null,K);(this.useLogarithmicDepth&&this._scene&&(0,KC.k)(A,K,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(K),this._setEngineBasedOnBlendMode(C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(K),this._useInstancing)?null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?O.drawElementsType(6,0,10,this.tE.length):O.drawArraysType(7,0,4,this.tE.length):null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?O.drawElementsType(1,0,10*this.tE.length):O.drawElementsType(0,0,6*this.tE.length);return this.tE.length}render(){if(!this.isReady()||!this.tE.length)return 0;const C=this._engine;C.setState&&(C.setState(!1),this.forceDepthWrite&&C.setDepthWrite(!0));let U=0;return U=this.blendMode===t.BLENDMODE_MULTIPLYADD?this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),U}_onDispose(){}dispose(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),C&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),C&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(U,K),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const C=this._scene.AE.indexOf(this);C>-1&&this._scene.AE.splice(C,1),this._scene._activeParticleSystems.dispose()}this.RA.notifyObservers(this),this.RA.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}LC.ForceGLSL=!1;var YC,WC=K(11696);!function(C){C[C.ATTACHED=0]="ATTACHED",C[C.END=1]="END"}(YC||(YC={}));class xC{constructor(C){if(this.particleSystem=C,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!C.mU||!C.mU.dispose){const U=(0,e.d)("BABYLON.AbstractMesh");C.mU=new U("SubemitterSystemEmitter",C.dC()),C._disposeEmitterOnDispose=!0}}clone(){let C=this.particleSystem.mU;if(C){if(C instanceof m.bU)C=C.clone();else if(-1!==C.getClassName().indexOf("Mesh")){C=new((0,e.d)("BABYLON.Mesh"))("",C.dC()),C.isVisible=!1}}else C=new m.bU;const U=new xC(this.particleSystem.clone(this.particleSystem.name,C));return U.particleSystem.name+="Clone",U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem._disposeEmitterOnDispose=!0,U.particleSystem.disposeOnStop=!0,U}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return U.type=this.type,U.inheritDirection=this.inheritDirection,U.inheritedVelocityAmount=this.inheritedVelocityAmount,U.particleSystem=this.particleSystem.serialize(C),U}static _ParseParticleSystem(C,U,K){throw(0,WC.b)("ParseParticle")}static Parse(C,U,K){const m=C.particleSystem,O=new xC(xC._ParseParticleSystem(m,U,K,!0));return O.type=C.type,O.inheritDirection=C.inheritDirection,O.inheritedVelocityAmount=C.inheritedVelocityAmount,O.particleSystem._isSubEmitter=!0,O}dispose(){this.particleSystem.dispose()}}var nC=K(11735);function SC(C,U){const K=new V;return K.direction1=C,K.direction2=U,K}function sC(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function RC(){return new f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function qC(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.bU(0,1,0),K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.bU(0,1,0);return new F(C,U,K)}function IC(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function CU(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new m.bU(0,1,0),X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new m.bU(0,1,0);return new v(C,U,K,O,X)}function UU(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new E(C,U)}function KU(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.bU(0,1,0),O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new m.bU(0,1,0);return new u(C,U,K,O)}const mU=m.bU.Zero(),OU=m.bU.Zero(),XU=m.bU.Zero();class AU{constructor(){this.strength=0,this.position=m.bU.Zero()}_processParticle(C,U){this.position.subtractToRef(C.position,mU);const K=mU.lengthSquared()+1;mU.normalize().scaleToRef(this.strength/K,OU),OU.scaleToRef(U._tempScaledUpdateSpeed,XU),C.direction.addInPlace(XU)}serialize(){return{position:this.position.Oe(),strength:this.strength}}}class eU extends LC{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=C=>{if(!this._subEmitters||0===this._subEmitters.length)return;const U=Math.floor(Math.random()*this._subEmitters.length);for(const K of this._subEmitters[U])if(1===K.type){const U=K.clone();C._inheritParticleInfoToSubEmitter(U),U.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(U.particleSystem),U.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(C,U){const K=SC(C,U);return this.particleEmitterType=K,K}get flowMap(){return this._flowMap}set flowMap(C){this._flowMap!==C&&(this._flowMap=C,this._flowMapUpdate&&(MC(this._flowMapUpdate),this._flowMapUpdate=null),C&&(this._flowMapUpdate={process:C=>{var U;const K=null===(U=this.dC())||void 0===U?void 0:U.getTransformMatrix();this._flowMap._processParticle(C,this.flowMapStrength*this._tempScaledUpdateSpeed,K)},previousItem:null,nextItem:null},NC(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(C){this._attractors.push(C),1===this._attractors.length&&(this._attractorUpdate={process:C=>{for(const U of this._attractors)U._processParticle(C,this)},previousItem:null,nextItem:null},NC(this._attractorUpdate,this._directionProcessing))}removeAttractor(C){const U=this._attractors.indexOf(C);-1!==U&&this._attractors.splice(U,1),0===this._attractors.length&&MC(this._attractorUpdate)}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(C)}createHemisphericEmitter(){const C=sC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createSphereEmitter(){const C=RC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createDirectedSphereEmitter(){const C=qC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.bU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.bU(0,1,0));return this.particleEmitterType=C,C}createCylinderEmitter(){const C=IC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=C,C}createDirectedCylinderEmitter(){const C=CU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new m.bU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new m.bU(0,1,0));return this.particleEmitterType=C,C}createConeEmitter(){const C=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=C,C}createDirectedConeEmitter(){const C=KU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.bU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new m.bU(0,1,0));return this.particleEmitterType=C,C}createBoxEmitter(C,U,K,m){const O=new p;return this.particleEmitterType=O,this.direction1=C,this.direction2=U,this.minEmitBox=K,this.maxEmitBox=m,O}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const C of this.subEmitters)C instanceof eU?this._subEmitters.push([new xC(C)]):C instanceof xC?this._subEmitters.push([C]):C instanceof Array&&this._subEmitters.push(C)}_stopSubEmitters(){if(this.activeSubSystems){for(const C of this.activeSubSystems)C.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const C=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==C&&this._rootParticleSystem.activeSubSystems.splice(C,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(C){C&&this._stopSubEmitters()}_prepareParticle(C){if(this._subEmitters&&this._subEmitters.length>0){const U=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];C._attachedSubEmitters=[];for(const K of U)if(0===K.type){const U=K.clone();C._attachedSubEmitters.push(U),U.particleSystem.start()}}}_onDispose(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),C&&this.particles)for(const K of this.particles)if(K._attachedSubEmitters)for(let C=K._attachedSubEmitters.length-1;C>=0;C-=1)K._attachedSubEmitters[C].dispose();if(U&&this.activeSubSystems)for(let K=this.activeSubSystems.length-1;K>=0;K-=1)this.activeSubSystems[K].dispose();if(this._subEmitters&&this._subEmitters.length){for(let C=0;C<this._subEmitters.length;C++)for(const U of this._subEmitters[C])U.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.mU&&this.mU.dispose&&this.mU.dispose(!0)}static _Parse(C,U,K,O){let X;X=K instanceof nC.b?null:K;const t=(0,e.d)("BABYLON.Texture");if(t&&X&&(C.texture?U.particleTexture=t.Parse(C.texture,X,O):C.textureName&&(U.particleTexture=new t(O+C.textureName,X,!1,void 0===C.invertY||C.invertY),U.particleTexture.name=C.textureName)),C.emitterId||0===C.emitterId||void 0!==C.mU?C.emitterId&&X?U.mU=X.getLastMeshById(C.emitterId):U.mU=m.bU.FU(C.mU):U.mU=m.bU.Zero(),U.isLocal=!!C.isLocal,void 0!==C.renderingGroupId&&(U.renderingGroupId=C.renderingGroupId),void 0!==C.isBillboardBased&&(U.isBillboardBased=C.isBillboardBased),void 0!==C.billboardMode&&(U.billboardMode=C.billboardMode),void 0!==C.useLogarithmicDepth&&(U.useLogarithmicDepth=C.useLogarithmicDepth),C.animations){for(let K=0;K<C.animations.length;K++){const m=C.animations[K],O=(0,e.d)("BABYLON.Animation");O&&U.animations.push(O.Parse(m))}U.beginAnimationOnStart=C.beginAnimationOnStart,U.beginAnimationFrom=C.beginAnimationFrom,U.beginAnimationTo=C.beginAnimationTo,U.beginAnimationLoop=C.beginAnimationLoop}if(C.autoAnimate&&X&&X.beginAnimation(U,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1),U.startDelay=0|C.startDelay,U.minAngularSpeed=C.minAngularSpeed,U.maxAngularSpeed=C.maxAngularSpeed,U.minSize=C.minSize,U.maxSize=C.maxSize,C.minScaleX&&(U.minScaleX=C.minScaleX,U.maxScaleX=C.maxScaleX,U.minScaleY=C.minScaleY,U.maxScaleY=C.maxScaleY),void 0!==C.preWarmCycles&&(U.preWarmCycles=C.preWarmCycles,U.preWarmStepOffset=C.preWarmStepOffset),void 0!==C.minInitialRotation&&(U.minInitialRotation=C.minInitialRotation,U.maxInitialRotation=C.maxInitialRotation),U.minLifeTime=C.minLifeTime,U.maxLifeTime=C.maxLifeTime,U.minEmitPower=C.minEmitPower,U.maxEmitPower=C.maxEmitPower,U.emitRate=C.emitRate,U.gravity=m.bU.FU(C.gravity),C.noiseStrength&&(U.noiseStrength=m.bU.FU(C.noiseStrength)),U.color1=A.ve.FU(C.color1),U.color2=A.ve.FU(C.color2),U.colorDead=A.ve.FU(C.colorDead),U.updateSpeed=C.updateSpeed,U.targetStopDuration=C.targetStopDuration,U.blendMode=C.blendMode,C.colorGradients)for(const m of C.colorGradients)U.addColorGradient(m.gradient,A.ve.FU(m.color1),m.color2?A.ve.FU(m.color2):void 0);if(C.rampGradients){for(const K of C.rampGradients)U.addRampGradient(K.gradient,A.fU.FU(K.color));U.useRampGradients=C.useRampGradients}if(C.colorRemapGradients)for(const m of C.colorRemapGradients)U.addColorRemapGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.alphaRemapGradients)for(const m of C.alphaRemapGradients)U.addAlphaRemapGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.sizeGradients)for(const m of C.sizeGradients)U.addSizeGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.angularSpeedGradients)for(const m of C.angularSpeedGradients)U.addAngularSpeedGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.velocityGradients)for(const m of C.velocityGradients)U.addVelocityGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.dragGradients)for(const m of C.dragGradients)U.addDragGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.emitRateGradients)for(const m of C.emitRateGradients)U.addEmitRateGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.startSizeGradients)for(const m of C.startSizeGradients)U.addStartSizeGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.lifeTimeGradients)for(const m of C.lifeTimeGradients)U.addLifeTimeGradient(m.gradient,void 0!==m.factor1?m.factor1:m.factor,m.factor2);if(C.limitVelocityGradients){for(const K of C.limitVelocityGradients)U.addLimitVelocityGradient(K.gradient,void 0!==K.factor1?K.factor1:K.factor,K.factor2);U.limitVelocityDamping=C.limitVelocityDamping}if(C.noiseTexture&&X){const K=(0,e.d)("BABYLON.ProceduralTexture");U.noiseTexture=K.Parse(C.noiseTexture,X,O)}let z;if(C.particleEmitterType){switch(C.particleEmitterType.type){case"SphereParticleEmitter":z=new f;break;case"SphereDirectedParticleEmitter":z=new F;break;case"ConeEmitter":case"ConeParticleEmitter":z=new E;break;case"ConeDirectedParticleEmitter":z=new u;break;case"CylinderParticleEmitter":z=new b;break;case"CylinderDirectedParticleEmitter":z=new v;break;case"HemisphericParticleEmitter":z=new Q;break;case"PointParticleEmitter":z=new V;break;case"MeshParticleEmitter":z=new H;break;case"CustomParticleEmitter":z=new Z;break;default:z=new p}z.parse(C.particleEmitterType,X)}else z=new p,z.parse(C,X);U.particleEmitterType=z,U.startSpriteCellID=C.startSpriteCellID,U.endSpriteCellID=C.endSpriteCellID,U.spriteCellLoop=C.spriteCellLoop??!0,U.spriteCellWidth=C.spriteCellWidth,U.spriteCellHeight=C.spriteCellHeight,U.spriteCellChangeSpeed=C.spriteCellChangeSpeed,U.spriteRandomStartCell=C.spriteRandomStartCell,U.disposeOnStop=C.disposeOnStop??!1,U.manualEmitCount=C.manualEmitCount??-1}static Parse(C,U,K){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],X=arguments.length>4?arguments[4]:void 0;const e=C.name;let t,z,j=null,p=null;if(U instanceof nC.b?t=U:(z=U,t=z.getEngine()),C.customShader&&t.createEffectForParticles){p=C.customShader;const U=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"";j=t.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,U)}const E=new eU(e,X||C.ye,U,j,C.isAnimationSheetEnabled);if(E.customShader=p,E._rootUrl=K,C.id&&(E.id=C.id),C.subEmitters){E.subEmitters=[];for(const m of C.subEmitters){const C=[];for(const O of m)C.push(xC.Parse(O,U,K));E.subEmitters.push(C)}}if(C.attractors)for(const A of C.attractors){const C=new AU;C.position=m.bU.FU(A.position),C.strength=A.strength,E.addAttractor(C)}return eU._Parse(C,E,U,K),C.textureMask&&(E.textureMask=A.ve.FU(C.textureMask)),C.dz&&(E.dz=m.bU.FU(C.dz)),C.preventAutoStart&&(E.preventAutoStart=C.preventAutoStart),O||E.preventAutoStart||E.start(),E}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};if(eU._Serialize(U,this,C),U.textureMask=this.textureMask.Oe(),U.customShader=this.customShader,U.preventAutoStart=this.preventAutoStart,U.dz=this.dz.Oe(),this.subEmitters){U.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const K of this._subEmitters){const m=[];for(const U of K)m.push(U.serialize(C));U.subEmitters.push(m)}}if(this._attractors&&this._attractors.length){U.attractors=[];for(const C of this._attractors)U.attractors.push(C.serialize())}return U}static _Serialize(C,U,K){if(C.name=U.name,C.id=U.id,C.ye=U.getCapacity(),C.disposeOnStop=U.disposeOnStop,C.manualEmitCount=U.manualEmitCount,U.mU.position){const K=U.mU;C.emitterId=K.id}else{const K=U.mU;C.mU=K.Oe()}U.particleEmitterType&&(C.particleEmitterType=U.particleEmitterType.serialize()),U.particleTexture&&(K?C.texture=U.particleTexture.serialize():(C.textureName=U.particleTexture.name,C.invertY=!!U.particleTexture._invertY)),C.isLocal=U.isLocal,J.c.AppendSerializedAnimations(U,C),C.beginAnimationOnStart=U.beginAnimationOnStart,C.beginAnimationFrom=U.beginAnimationFrom,C.beginAnimationTo=U.beginAnimationTo,C.beginAnimationLoop=U.beginAnimationLoop,C.startDelay=U.startDelay,C.renderingGroupId=U.renderingGroupId,C.isBillboardBased=U.isBillboardBased,C.billboardMode=U.billboardMode,C.minAngularSpeed=U.minAngularSpeed,C.maxAngularSpeed=U.maxAngularSpeed,C.minSize=U.minSize,C.maxSize=U.maxSize,C.minScaleX=U.minScaleX,C.maxScaleX=U.maxScaleX,C.minScaleY=U.minScaleY,C.maxScaleY=U.maxScaleY,C.minEmitPower=U.minEmitPower,C.maxEmitPower=U.maxEmitPower,C.minLifeTime=U.minLifeTime,C.maxLifeTime=U.maxLifeTime,C.emitRate=U.emitRate,C.gravity=U.gravity.Oe(),C.noiseStrength=U.noiseStrength.Oe(),C.color1=U.color1.Oe(),C.color2=U.color2.Oe(),C.colorDead=U.colorDead.Oe(),C.updateSpeed=U.updateSpeed,C.targetStopDuration=U.targetStopDuration,C.blendMode=U.blendMode,C.preWarmCycles=U.preWarmCycles,C.preWarmStepOffset=U.preWarmStepOffset,C.minInitialRotation=U.minInitialRotation,C.maxInitialRotation=U.maxInitialRotation,C.startSpriteCellID=U.startSpriteCellID,C.spriteCellLoop=U.spriteCellLoop,C.endSpriteCellID=U.endSpriteCellID,C.spriteCellChangeSpeed=U.spriteCellChangeSpeed,C.spriteCellWidth=U.spriteCellWidth,C.spriteCellHeight=U.spriteCellHeight,C.spriteRandomStartCell=U.spriteRandomStartCell,C.isAnimationSheetEnabled=U.isAnimationSheetEnabled,C.useLogarithmicDepth=U.useLogarithmicDepth;const m=U.getColorGradients();if(m){C.colorGradients=[];for(const U of m){const K={gradient:U.gradient,color1:U.color1.Oe()};U.color2?K.color2=U.color2.Oe():K.color2=U.color1.Oe(),C.colorGradients.push(K)}}const O=U.getRampGradients();if(O){C.rampGradients=[];for(const U of O){const K={gradient:U.gradient,color:U.color.Oe()};C.rampGradients.push(K)}C.useRampGradients=U.useRampGradients}const X=U.getColorRemapGradients();if(X){C.colorRemapGradients=[];for(const U of X){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.colorRemapGradients.push(K)}}const A=U.getAlphaRemapGradients();if(A){C.alphaRemapGradients=[];for(const U of A){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.alphaRemapGradients.push(K)}}const e=U.getSizeGradients();if(e){C.sizeGradients=[];for(const U of e){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.sizeGradients.push(K)}}const t=U.getAngularSpeedGradients();if(t){C.angularSpeedGradients=[];for(const U of t){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.angularSpeedGradients.push(K)}}const z=U.getVelocityGradients();if(z){C.velocityGradients=[];for(const U of z){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.velocityGradients.push(K)}}const j=U.getDragGradients();if(j){C.dragGradients=[];for(const U of j){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.dragGradients.push(K)}}const p=U.getEmitRateGradients();if(p){C.emitRateGradients=[];for(const U of p){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.emitRateGradients.push(K)}}const E=U.getStartSizeGradients();if(E){C.startSizeGradients=[];for(const U of E){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.startSizeGradients.push(K)}}const u=U.getLifeTimeGradients();if(u){C.lifeTimeGradients=[];for(const U of u){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.lifeTimeGradients.push(K)}}const b=U.getLimitVelocityGradients();if(b){C.limitVelocityGradients=[];for(const U of b){const K={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2?K.factor2=U.factor2:K.factor2=U.factor1,C.limitVelocityGradients.push(K)}C.limitVelocityDamping=U.limitVelocityDamping}U.noiseTexture&&(C.noiseTexture=U.noiseTexture.serialize())}clone(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const m={...this._customWrappers};let O=null;const X=this._engine;if(X.createEffectForParticles&&null!=this.customShader){O=this.customShader;const C=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"",U=X.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,C);m[0]?m[0].effect=U:this.setCustomEffect(U,0)}const A=this.serialize(K),e=eU.Parse(A,this._scene||this._engine,this._rootUrl);return e.name=C,e.customShader=O,e._customWrappers=m,void 0===U&&(U=this.mU),this.noiseTexture&&(e.noiseTexture=this.noiseTexture.clone()),e.mU=U,this.preventAutoStart||e.start(),e}}eU.BILLBOARDMODE_Y=2,eU.BILLBOARDMODE_ALL=7,eU.BILLBOARDMODE_STRETCHED=8,eU.BILLBOARDMODE_STRETCHED_LOCAL=9,xC._ParseParticleSystem=eU.Parse;var tU=K(12084),zU=K(12078),jU=K(11958);jU.c.prototype.createTransformFeedback=function(){const C=this._gl.createTransformFeedback();if(!C)throw new Error("Unable to create Transform Feedback");return C},jU.c.prototype.deleteTransformFeedback=function(C){this._gl.deleteTransformFeedback(C)},jU.c.prototype.bindTransformFeedback=function(C){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,C)},jU.c.prototype.beginTransformFeedback=function(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(C?this._gl.POINTS:this._gl.TRIANGLES)},jU.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},jU.c.prototype.setTranformFeedbackVaryings=function(C,U){this._gl.transformFeedbackVaryings(C,U,this._gl.INTERLEAVED_ATTRIBS)},jU.c.prototype.bindTransformFeedbackBuffer=function(C){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,C?C.underlyingResource:null)},jU.c.prototype.readTransformFeedbackBuffer=function(C){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,C)};const pU="clipPlaneFragmentDeclaration2",EU="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";T.d.IncludesShadersStore[pU]||(T.d.IncludesShadersStore[pU]=EU);K(13104),K(13113),K(13116),K(13119),K(13123),K(13128),K(13131),K(13134);const uU="gpuRenderParticlesPixelShader",bU="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";T.d.ShadersStore[uU]||(T.d.ShadersStore[uU]=bU);const vU="clipPlaneVertexDeclaration2",QU="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";T.d.IncludesShadersStore[vU]||(T.d.IncludesShadersStore[vU]=QU);K(13140),K(13142),K(13145),K(13153);const VU="gpuRenderParticlesVertexShader",fU="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";T.d.ShadersStore[VU]||(T.d.ShadersStore[VU]=fU);class FU extends t{static get IsSupported(){if(!q.c.LastCreatedEngine)return!1;const C=q.c.LastCreatedEngine.getCaps();return C.supportTransformFeedbacks||C.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(C){this._maxActiveParticleCount=Math.min(C,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(C){this.maxActiveParticleCount=C}createPointEmitter(C,U){const K=SC(C,U);return this.particleEmitterType=K,K}createHemisphericEmitter(){const C=sC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createSphereEmitter(){const C=RC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=C,C}createDirectedSphereEmitter(){const C=qC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.bU(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.bU(0,1,0));return this.particleEmitterType=C,C}createCylinderEmitter(){const C=IC(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=C,C}createDirectedCylinderEmitter(){const C=CU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new m.bU(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new m.bU(0,1,0));return this.particleEmitterType=C,C}createConeEmitter(){const C=UU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=C,C}createDirectedConeEmitter(){const C=KU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.bU(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new m.bU(0,1,0));return this.particleEmitterType=C,C}createBoxEmitter(C,U,K,m){const O=new p;return this.particleEmitterType=O,this.direction1=C,this.direction2=U,this.minEmitBox=K,this.maxEmitBox=m,O}get flowMap(){return this._flowMap}set flowMap(C){this._flowMap!==C&&(this._flowMap=C)}isReady(){if(!this.mU||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==eU.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(eU.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(eU.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";C?setTimeout((()=>{this.start(0)}),C):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var C;let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(C=this._customWrappers[U])||void 0===C?void 0:C.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[C]??this._customWrappers[0]}setCustomEffect(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[U]=new CC.d(this._engine),this._customWrappers[U].effect=C}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new s.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(C,U,K){return super._removeGradientAndTexture(C,U,K),this._releaseBuffers(),this}addColorGradient(C,U){this._colorGradients||(this._colorGradients=[]);const K=new W(C,U);return this._colorGradients.push(K),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(C&&this._colorGradients.sort(((C,U)=>C.gradient<U.gradient?-1:C.gradient>U.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(C){return this._removeGradientAndTexture(C,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const U in this._drawWrappers){var C;null===(C=this._drawWrappers[U].drawContext)||void 0===C||C.reset()}}_addFactorGradient(C,U,K){const m=new n(U,K);C.push(m),this._releaseBuffers()}addSizeGradient(C,U){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,C,U),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(C){return this._removeGradientAndTexture(C,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(C,U){if(!C)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&C.sort(((C,U)=>C.gradient<U.gradient?-1:C.gradient>U.gradient?1:0));const K=this;K[U]&&(K[U].dispose(),K[U]=null)}addAngularSpeedGradient(C,U){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,C,U),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(C){return this._removeGradientAndTexture(C,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(C,U){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,C,U),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(C){return this._removeGradientAndTexture(C,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(C,U){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,C,U),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(C){return this._removeGradientAndTexture(C,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(C,U){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,C,U),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(C){return this._removeGradientAndTexture(C,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(C){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(C,U,K){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(C),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.RA=new s.b,this.onStoppedObservable=new s.b,this.onStartedObservable=new s.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,K&&"Scene"!==K.getClassName()?(this._engine=K,this.defaultProjectionMatrix=m.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=K||q.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.AE.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,e.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,e.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,e.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,e.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new CC.d(this._engine)},this._customWrappers[0].effect=O,this._drawWrappers={0:new CC.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(U=U??{}).randomTextureSize||delete U.randomTextureSize;const A={ye:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...U},t=U;isFinite(t)&&(A.ye=t),this._capacity=A.ye,this._maxActiveParticleCount=A.ye,this._currentActiveCount=0,this._isAnimationSheetEnabled=X,this.particleEmitterType=new p;const z=Math.min(this._engine.getCaps().maxTextureSize,A.randomTextureSize);let j=[];for(let m=0;m<z;++m)j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),j.push(Math.random());this._randomTexture=new R.d(new Float32Array(j),z,1,5,K,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,j=[];for(let m=0;m<z;++m)j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),j.push(Math.random());this._randomTexture2=new R.d(new Float32Array(j),z,1,5,K,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=z}_reset(){this._releaseBuffers()}_createVertexBuffers(C,U,K){const m={};m.position=U.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let O=3;m.age=U.createVertexBuffer("age",O,1,this._attributesStrideSize,!0),O+=1,m.size=U.createVertexBuffer("size",O,3,this._attributesStrideSize,!0),O+=3,m.life=U.createVertexBuffer("life",O,1,this._attributesStrideSize,!0),O+=1,O+=4,this.billboardMode===eU.BILLBOARDMODE_STRETCHED&&(m.direction=U.createVertexBuffer("direction",O,3,this._attributesStrideSize,!0)),O+=3,this._platform.alignDataInBuffer&&(O+=1),this.particleEmitterType instanceof Z&&(O+=3,this._platform.alignDataInBuffer&&(O+=1)),this._colorGradientsTexture||(m.color=U.createVertexBuffer("color",O,4,this._attributesStrideSize,!0),O+=4),this._isBillboardBased||(m.initialDirection=U.createVertexBuffer("initialDirection",O,3,this._attributesStrideSize,!0),O+=3,this._platform.alignDataInBuffer&&(O+=1)),this.noiseTexture&&(m.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",O,3,this._attributesStrideSize,!0),O+=3,this._platform.alignDataInBuffer&&(O+=1),m.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",O,3,this._attributesStrideSize,!0),O+=3,this._platform.alignDataInBuffer&&(O+=1)),m.angle=U.createVertexBuffer("angle",O,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?O++:O+=2,this._isAnimationSheetEnabled&&(m.cellIndex=U.createVertexBuffer("cellIndex",O,1,this._attributesStrideSize,!0),O+=1,this.spriteRandomStartCell&&(m.cellStartOffset=U.createVertexBuffer("cellStartOffset",O,1,this._attributesStrideSize,!0),O+=1)),m.offset=K.createVertexBuffer("offset",0,2),m.uv=K.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(m),this._platform.createVertexBuffers(C,m),this.resetDrawCache()}_initialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!C)return;const U=this._engine,K=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Z&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const O=this.particleEmitterType instanceof Z,X=m.TmpVectors.bU[0];let A=0;for(let m=0;m<this._capacity;m++)if(K.push(0),K.push(0),K.push(0),K.push(0),K.push(0),K.push(0),K.push(0),K.push(0),K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),O?(this.particleEmitterType.particleDestinationGenerator(m,null,X),K.push(X.x),K.push(X.y),K.push(X.z)):(K.push(0),K.push(0),K.push(0)),this._platform.alignDataInBuffer&&K.push(0),A+=16,O&&(this.particleEmitterType.particlePositionGenerator(m,null,X),K.push(X.x),K.push(X.y),K.push(X.z),this._platform.alignDataInBuffer&&K.push(0),A+=4),this._colorGradientsTexture||(K.push(0),K.push(0),K.push(0),K.push(0),A+=4),this.isBillboardBased||(K.push(0),K.push(0),K.push(0),this._platform.alignDataInBuffer&&K.push(0),A+=4),this.noiseTexture&&(K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),this._platform.alignDataInBuffer&&K.push(0),K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),this._platform.alignDataInBuffer&&K.push(0),A+=8),K.push(0),A+=1,this._angularSpeedGradientsTexture||(K.push(0),A+=1),this._isAnimationSheetEnabled&&(K.push(0),A+=1,this.spriteRandomStartCell&&(K.push(0),A+=1)),this._platform.alignDataInBuffer){let C=3-(A+3&3);for(A+=C;C-- >0;)K.push(0)}const e=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),t=this._platform.createParticleBuffer(K),z=this._platform.createParticleBuffer(K);this._buffer0=new P.b(U,t,!1,this._attributesStrideSize),this._buffer1=new P.b(U,z,!1,this._attributesStrideSize),this._spriteBuffer=new P.b(U,e,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let C=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(C+="\n#define BILLBOARD"),this._colorGradientsTexture&&(C+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(C+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(C+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(C+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(C+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(C+="\n#define DRAGGRADIENTS"),this._flowMap&&(C+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(C+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(C+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(C+="\n#define NOISE"),this.isLocal&&(C+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===C||(this._cachedUpdateDefines=C,this._updateBuffer=this._platform.createUpdateBuffer(C)),this._platform.isUpdateBufferReady()}_getWrapper(C){const U=this._getCustomDrawWrapper(C);if(null!==U&&void 0!==U&&U.effect)return U;const K=[];this.fillDefines(K,C);let m=this._drawWrappers[C];m||(m=new CC.d(this._engine),m.drawContext&&(m.drawContext.useInstancing=!0),this._drawWrappers[C]=m);const O=K.join("\n");if(m.defines!==O){const C=[],U=[],K=[];this.fillUniformsAttributesAndSamplerNames(U,C,K),m.setEffect(this._engine.createEffect("gpuRenderParticles",C,U,K,O),O)}return m}static _GetAttributeNamesOrOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const O=[P.d.PositionKind,"age","life","size","angle"];return C||O.push(P.d.ColorKind),U&&O.push("cellIndex"),K||O.push("initialDirection"),m&&O.push("direction"),O.push("offset",P.d.UVKind),O}static _GetEffectCreationOptions(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const m=["emitterWM","dz","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,UC.d)(m),C&&m.push("sheetInfos"),U&&m.push("logarithmicDepthConstant"),K&&(m.push("vFogInfos"),m.push("vFogColor")),m}fillDefines(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,UC.k)(this,this._scene,C),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==zU.b.FOGMODE_NONE&&C.push("#define FOG")),U===eU.BLENDMODE_MULTIPLY&&C.push("#define BLENDMULTIPLYMODE"),this.isLocal&&C.push("#define LOCAL"),this.useLogarithmicDepth&&C.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(C.push("#define BILLBOARD"),this.billboardMode){case eU.BILLBOARDMODE_Y:C.push("#define BILLBOARDY");break;case eU.BILLBOARDMODE_STRETCHED:C.push("#define BILLBOARDSTRETCHED");break;case eU.BILLBOARDMODE_ALL:C.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&C.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&C.push("#define ANIMATESHEET"),K&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),C.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(C,U,K){U.push(...FU._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===eU.BILLBOARDMODE_STRETCHED)),C.push(...FU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),K.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(tU.c.PrepareUniforms(C,this._imageProcessingConfigurationDefines),tU.c.PrepareSamplers(K,this._imageProcessingConfigurationDefines))}animate(){var C;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(U?this.preWarmStepOffset:(null===(C=this._scene)||void 0===C?void 0:C.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(C,U){const K=this[U];if(!C||!C.length||K)return;const m=new Float32Array(this._rawTextureWidth);for(let O=0;O<this._rawTextureWidth;O++){const U=O/this._rawTextureWidth;S.GetCurrentGradient(U,C,((C,U,K)=>{m[O]=(0,z.Lerp)(C.factor1,U.factor1,K)}))}this[U]=R.d.CreateRTexture(m,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[U].name=U.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const C=new Uint8Array(4*this._rawTextureWidth),U=A.TmpColors.ve[0];for(let K=0;K<this._rawTextureWidth;K++){const m=K/this._rawTextureWidth;S.GetCurrentGradient(m,this._colorGradients,((m,O,X)=>{A.ve.LerpToRef(m.color1,O.color1,X,U),C[4*K]=255*U.r,C[4*K+1]=255*U.g,C[4*K+2]=255*U.b,C[4*K+3]=255*U.a}))}this._colorGradientsTexture=R.d.CreateRGBATexture(C,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(C,U){var K,O,X,A;const e=this._getWrapper(C),t=e.effect;this._engine.enableEffect(e);const z=(null===(K=this._scene)||void 0===K?void 0:K.getViewMatrix())||m.Matrix.IdentityReadOnly;if(t.setMatrix("view",z),t.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),t.setTexture("diffuseSampler",this.particleTexture),t.setVector2("translationPivot",this.translationPivot),t.setVector3("dz",this.dz),this.isLocal&&t.setMatrix("emitterWM",U),this._colorGradientsTexture?t.setTexture("colorGradientSampler",this._colorGradientsTexture):t.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const C=this.particleTexture.getBaseSize();t.setFloat3("sheetInfos",this.spriteCellWidth/C.width,this.spriteCellHeight/C.height,C.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const C=this._scene.activeCamera;t.setVector3("eyePosition",C.globalPosition)}const j=t.defines;if(this._scene&&((0,UC.f)(t,this,this._scene),this.applyFog&&(0,KC.f)(this._scene,void 0,t)),j.indexOf("#define BILLBOARDMODE_ALL")>=0){const C=z.clone();C.invert(),t.setMatrix("invView",C)}return this.useLogarithmicDepth&&this._scene&&(0,KC.k)(j,t,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(t),this._setEngineBasedOnBlendMode(C),this._platform.bindDrawBuffers(this._targetIndex,t,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(t),null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(A=this._scene)&&void 0!==A&&A.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(C){if(!this.mU||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!C)if(this.mU.position){C=this.mU.getWorldMatrix()}else{const U=this.mU;C=m.TmpVectors.Matrix[0],m.Matrix.TranslationToRef(U.x,U.y,U.z,C)}const U=this._engine,K=U.getDepthWrite();if(U.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const C=this.dC();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",C.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",C),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const O=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=O,U.setDepthWrite(K)}render(){let C,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],K=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!U&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let C=0;C<this.preWarmCycles;C++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const C=0|this._accumulatedCount;this._accumulatedCount-=C,this._currentActiveCount+=C}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.mU.position){C=this.mU.getWorldMatrix()}else{const U=this.mU;C=m.TmpVectors.Matrix[0],m.Matrix.TranslationToRef(U.x,U.y,U.z,C)}const O=this._engine;this.updateInAnimate||this._update(C);let X=0;return U||K||(O.setState(!1),this.forceDepthWrite&&O.setDepthWrite(!0),X=this.blendMode===eU.BLENDMODE_MULTIPLYADD?this._render(eU.BLENDMODE_MULTIPLY,C)+this._render(eU.BLENDMODE_ADD,C):this._render(this.blendMode,C),this._engine.setAlphaMode(0)),X}rebuild(){const C=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(C,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,C()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const U in this._drawWrappers){this._drawWrappers[U].dispose()}if(this._drawWrappers={},this._scene){const C=this._scene.AE.indexOf(this);C>-1&&this._scene.AE.splice(C,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let U=0;U<this._renderVertexBuffers.length;++U){const C=this._renderVertexBuffers[U];for(const U in C)C[U].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),C&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),C&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.RA.notifyObservers(this),this.RA.clear()}clone(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const m={...this._customWrappers};let O=null;const X=this._engine;if(X.createEffectForParticles&&null!=this.customShader){O=this.customShader;const C=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"";m[0]=X.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,C,void 0,void 0,void 0,this)}const A=this.serialize(K),e=FU.Parse(A,this._scene||this._engine,this._rootUrl);return e.name=C,e.customShader=O,e._customWrappers=m,void 0===U&&(U=this.mU),this.noiseTexture&&(e.noiseTexture=this.noiseTexture.clone()),e.mU=U,e}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={};return eU._Serialize(U,this,C),U.activeParticleCount=this.activeParticleCount,U.randomTextureSize=this._randomTextureSize,U.customShader=this.customShader,U}static Parse(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4?arguments[4]:void 0;const X=C.name;let A,e;U instanceof nC.b?A=U:(e=U,A=e.getEngine());const t=new FU(X,{ye:O||C.ye,randomTextureSize:C.randomTextureSize},U,null,C.isAnimationSheetEnabled);if(t._rootUrl=K,C.customShader&&A.createEffectForParticles){const U=C.customShader,K=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",m=A.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,K,void 0,void 0,void 0,t);t.setCustomEffect(m,0),t.customShader=U}return C.id&&(t.id=C.id),C.activeParticleCount&&(t.activeParticleCount=C.activeParticleCount),eU._Parse(C,t,U,K),C.preventAutoStart&&(t.preventAutoStart=C.preventAutoStart),m||t.preventAutoStart||t.start(),t}}var ZU=K(11660),PU=K(13162),HU=K(12205);class dU{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(C){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const U of this.systems)U.mU=C;this._emitterNode=C}setEmitterAsSphere(C,U,K){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:C,renderingGroupId:U};const m=(0,PU.d)("emitterSphere",{diameter:C.diameter,segments:C.segments},K);m.renderingGroupId=U;const O=new HU.VU("emitterSphereMaterial",K);O.emissiveColor=C.color,m.material=O;for(const X of this.systems)X.mU=m;this._emitterNode=m}start(C){for(const U of this.systems)C&&(U.mU=C),U.start()}dispose(){for(const C of this.systems)C.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U={systems:[]};for(const K of this.systems)U.systems.push(K.serialize(C));return this._emitterNode&&(U.mU=this._emitterCreationOptions),U}static Parse(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3?arguments[3]:void 0;const O=new dU,X=this.BaseAssetsUrl+"/textures/";U=U||q.c.LastCreatedScene;for(const A of C.systems)O.systems.push(K?FU.Parse(A,U,X,!0,m):eU.Parse(A,U,X,!0,m));if(C.mU){const K=C.mU.options;if("Sphere"===C.mU.kind)O.setEmitterAsSphere({diameter:K.diameter,segments:K.segments,color:A.fU.FU(K.color)},C.mU.renderingGroupId,U)}return O}}dU.BaseAssetsUrl="https://assets.babylonjs.com/particles";var TU=K(11701);class yU{static CreateDefault(C){let U,K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,m=arguments.length>2?arguments[2]:void 0;U=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new FU("default system",{ye:K},m):new eU("default system",K,m),U.mU=C;const O=ZU.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return U.particleTexture=new o.b(O,U.dC()),U.createConeEmitter(.1,Math.PI/4),U.color1=new A.ve(1,1,1,1),U.color2=new A.ve(1,1,1,1),U.colorDead=new A.ve(1,1,1,0),U.minSize=.1,U.maxSize=.1,U.minEmitPower=2,U.maxEmitPower=2,U.updateSpeed=1/60,U.emitRate=30,U}static CreateAsync(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3?arguments[3]:void 0;U||(U=q.c.LastCreatedScene);const O={};return U.addPendingData(O),new Promise(((X,A)=>{if(K&&!FU.IsSupported)return U.removePendingData(O),A("Particle system with GPU is not supported.");ZU.Tools.LoadFile(`${yU.BaseAssetsUrl}/systems/${C}.json`,(C=>{U.removePendingData(O);const A=JSON.parse(C.toString());return X(dU.Parse(A,U,K,m))}),void 0,void 0,void 0,(()=>(U.removePendingData(O),A(`An error occurred with the creation of your particle system. Check if your type '${C}' exists.`))))}))}static ExportSet(C){const U=new dU;for(const K of C)U.systems.push(K);return U}static ParseFromFileAsync(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",X=arguments.length>5?arguments[5]:void 0;return new Promise(((A,e)=>{const t=new TU.b;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const U=JSON.parse(t.responseText);let e;e=m?FU.Parse(U,K,O,!1,X):eU.Parse(U,K,O,!1,X),C&&(e.name=C),A(e)}else e("Unable to load the particle system")})),t.open("GET",U),t.send()}))}static ParseFromSnippetAsync(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",O=arguments.length>4?arguments[4]:void 0;if("_BLANK"===C){const C=this.CreateDefault(null);return C.start(),Promise.resolve(C)}return new Promise(((X,A)=>{const e=new TU.b;e.addEventListener("readystatechange",(()=>{if(4==e.readyState)if(200==e.status){const A=JSON.parse(JSON.parse(e.responseText).jsonPayload),t=JSON.parse(A.particleSystem);let z;z=K?FU.Parse(t,U,m,!1,O):eU.Parse(t,U,m,!1,O),z.snippetId=C,X(z)}else A("Unable to load the snippet "+C)})),e.open("GET",this.SnippetUrl+"/"+C.replace(/#/g,"/")),e.send()}))}}yU.BaseAssetsUrl=dU.BaseAssetsUrl,yU.SnippetUrl="https://snippet.babylonjs.com",yU.CreateFromSnippetAsync=yU.ParseFromSnippetAsync;var aU=K(12285),rU=K(12109),iU=K(13166);(0,iU.e)(rU.d.NAME_PARTICLESYSTEM,((C,U,K,m)=>{const O=(0,iU.g)(rU.d.NAME_PARTICLESYSTEM);if(O&&void 0!==C.AE&&null!==C.AE)for(let X=0,A=C.AE.length;X<A;X++){const A=C.AE[X];K.AE.push(O(A,U,m))}})),(0,iU.d)(rU.d.NAME_PARTICLESYSTEM,((C,U,K)=>{if(C.activeParticleCount){return FU.Parse(C,U,K)}return eU.Parse(C,U,K)})),nC.b.prototype.createEffectForParticles=function(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",X=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0,e=arguments.length>6?arguments[6]:void 0,t=arguments.length>7?arguments[7]:void 0,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,j=arguments.length>9?arguments[9]:void 0,p=[],E=[];const u=[];return t?t.fillUniformsAttributesAndSamplerNames(E,p,u):(p=eU._GetAttributeNamesOrOptions(),E=eU._GetEffectCreationOptions()),-1===O.indexOf(" BILLBOARD")&&(O+="\n#define BILLBOARD\n"),null!==t&&void 0!==t&&t.isAnimationSheetEnabled&&-1===O.indexOf(" ANIMATESHEET")&&(O+="\n#define ANIMATESHEET\n"),-1===m.indexOf("diffuseSampler")&&m.push("diffuseSampler"),this.createEffect({vertex:j??(null===t||void 0===t?void 0:t.vertexShaderName)??"particles",fragmentElement:C},p,E.concat(U),u.concat(m),O,X,A,e,void 0,z,(async()=>{0===z?await Promise.resolve().then(K.bind(K,13203)):await Promise.resolve().then(K.bind(K,13282))}))},aU.b.prototype.getEmittedParticleSystems=function(){const C=[];for(let U=0;U<this.dC().AE.length;U++){const K=this.dC().AE[U];K.mU===this&&C.push(K)}return C},aU.b.prototype.getHierarchyEmittedParticleSystems=function(){const C=[],U=this.getDescendants();U.push(this);for(let K=0;K<this.dC().AE.length;K++){const m=this.dC().AE[K],O=m.mU;O.position&&-1!==U.indexOf(O)&&C.push(m)}return C};K(12178),K(12186),K(12262);K(12265),K(13174),K(12029),K(12160),K(12310);K(12020);var DU;K(13180),K(11854);!function(C){C[C.Color=2]="Color",C[C.UV=1]="UV",C[C.Random=0]="Random",C[C.Stated=3]="Stated"}(DU||(DU={}));var lU=K(12067);const GU=new m.bU(0,0,0),JU=new m.bU(0,0,0),oU=new m.bU(0,0,0);class BU{constructor(C,U,K){this.width=C,this.height=U,this.data=K}processFlowable(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2?arguments[2]:void 0;if(!K)return;K instanceof m.Matrix?m.bU.TransformCoordinatesToRef(C.position,K,oU):(oU.x=K.x,oU.y=K.y,oU.z=K.z);const O=.5*oU.x+.5,X=1-(.5*oU.y+.5),A=Math.floor(O*this.width),e=Math.floor(X*this.height);if(A<0||A>=this.width||e<0||e>=this.height)return;const t=4*(e*this.width+A),z=this.data[t]/255*2-1,j=this.data[t+1]/255*2-1,p=this.data[t+2]/255*2-1,E=this.data[t+3]/255;GU.set(z,j,p),GU.scaleToRef(U*E,JU),C.direction.addInPlace(JU)}_processParticle(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2?arguments[2]:void 0;this.processFlowable(C,U,K)}static async FromUrlAsync(C){return await new Promise(((U,K)=>{const m=document.createElement("canvas"),O=m.getContext("2d");let X=null;const A=new Image;A.crossOrigin="anonymous",A.src=C,A.onerror=U=>{K(new Error(`Failed to load image: ${C} : ${U}`))},A.onload=()=>{m.width=A.width,m.height=A.height,O.drawImage(A,0,0),X=O.getImageData(0,0,m.width,m.height),U(new BU(m.width,m.height,X.data))}}))}static async ExtractFromTextureAsync(C){return await new Promise(((U,K)=>{if(!C.isReady())return void C.onLoadObservable.addOnce((async()=>{try{const K=await this.ExtractFromTextureAsync(C);U(K)}catch(m){K(m)}}));const m=C.getSize();lU.k.GetTextureDataAsync(C,m.width,m.height).then((C=>{U(new BU(m.width,m.height,new Uint8ClampedArray(C)))})).catch(K)}))}}var kU,wU,hU,cU,NU,gU,MU,LU,YU;!function(C){C[C.Int=1]="Int",C[C.Float=2]="Float",C[C.Vector2=4]="Vector2",C[C.bU=8]="bU",C[C.Matrix=16]="Matrix",C[C.Particle=32]="Particle",C[C.Texture=64]="Texture",C[C.ve=128]="ve",C[C.FloatGradient=256]="FloatGradient",C[C.Vector2Gradient=512]="Vector2Gradient",C[C.Vector3Gradient=1024]="Vector3Gradient",C[C.Color4Gradient=2048]="Color4Gradient",C[C.System=4096]="System",C[C.AutoDetect=8192]="AutoDetect",C[C.BasedOnInput=16384]="BasedOnInput",C[C.Undefined=32768]="Undefined",C[C.All=65535]="All"}(kU||(kU={})),function(C){C[C.Compatible=0]="Compatible",C[C.TypeIncompatible=1]="TypeIncompatible",C[C.HierarchyIssue=2]="HierarchyIssue"}(wU||(wU={})),function(C){C[C.Input=0]="Input",C[C.Output=1]="Output"}(hU||(hU={}));class WU{get direction(){return this._direction}get type(){if(this._type===kU.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===kU.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(C){this._type=C}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((C=>C.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(C,U,K){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=kU.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new s.b,this.onDisconnectionObservable=new s.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=U,this.name=C,this._direction=K}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(C){var U;return this.isConnected?null!==(U=this._connectedPoint)&&void 0!==U&&U._storedFunction?this._connectedPoint._storedFunction(C):this._connectedPoint._storedValue:this.value}canConnectTo(C){return 0===this.checkCompatibilityState(C)}checkCompatibilityState(C){const U=this._ownerBlock,K=C.ownerBlock;if(this.type!==C.type&&C.innerType!==kU.AutoDetect)return C.acceptedConnectionPointTypes&&-1!==C.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(C.excludedConnectionPointTypes&&-1!==C.excludedConnectionPointTypes.indexOf(this.type))return 1;let m=K,O=U;return 0===this.direction&&(m=U,O=K),m.isAnAncestorOf(O)?2:0}connectTo(C){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(C))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${C.ownerBlock.name}".${C.name}`;return this._endpoints.push(C),C._connectedPoint=this,this.onConnectionObservable.notifyObservers(C),C.onConnectionObservable.notifyObservers(this),this}disconnectFrom(C){const U=this._endpoints.indexOf(C);return-1===U||(this._endpoints.splice(U,1),C._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(C),C.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(C){let U=1;for(;U<kU.All;)C&U||this.excludedConnectionPointTypes.push(U),U<<=1}serialize(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U={};return U.name=this.name,U.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Oe?(U.valueType="BABYLON."+this.value.getClassName(),U.value=this.value.Oe()):(U.valueType="number",U.value=this.value)),C&&this.connectedPoint&&(U.inputName=this.name,U.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,U.targetConnectionName=this.connectedPoint.name,U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(U.isExposedOnFrame=!0,U.exposedPortPosition=this.exposedPortPosition),U}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class xU{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(C){this._name=C}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(C){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new s.b,this.RA=new s.b,this.onInputChangedObservable=new s.b,this.visibleOnFrame=!1,this._name=C,this.uniqueId=B.e.UniqueId}_inputRename(C){return C}_outputRename(C){return C}isAnAncestorOf(C){for(const U of this._outputs)if(U.hasEndpoints)for(const K of U.endpoints){if(K.ownerBlock===C)return!0;if(K.ownerBlock.isAnAncestorOf(C))return!0}return!1}isAnAncestorOfType(C){if(this.getClassName()===C)return!0;for(const U of this._outputs)if(U.hasEndpoints)for(const K of U.endpoints)if(K.ownerBlock.isAnAncestorOfType(C))return!0;return!1}getInputByName(C){const U=this._inputs.filter((U=>U.name===C));return U.length?U[0]:null}_linkConnectionTypes(C,U){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[U]._acceptedConnectionPointType=this._inputs[C]:(this._inputs[C]._linkedConnectionSource=this._inputs[U],this._inputs[C]._isMainLinkSource=!0),this._inputs[U]._linkedConnectionSource=this._inputs[C]}registerInput(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0,X=arguments.length>5?arguments[5]:void 0;const A=new WU(C,this,0);return A.type=U,A.isOptional=K,A.defaultValue=m,A.value=m,A.valueMin=O,A.valueMax=X,this._inputs.push(A),this.onInputChangedObservable.notifyObservers(A),this}registerOutput(C,U,K){return(K=K??new WU(C,this,1)).type=U,this._outputs.push(K),this}_build(C){}_customBuildStep(C){}build(C){if(this._buildId===C.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((C=>C.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=C.buildId;for(const U of this._inputs){if(!U.connectedPoint){U.isOptional||C.notConnectedNonOptionalInputs.push(U);continue}const K=U.connectedPoint.ownerBlock;K&&K!==this&&!K.isSystem&&K.build(C)}return this._customBuildStep(C),C.verbose&&k.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(C),this.onBuildObservable.notifyObservers(this),!1}serialize(){const C={};C.customType="BABYLON."+this.getClassName(),C.id=this.uniqueId,C.name=this.name,C.visibleOnFrame=this.visibleOnFrame,C.inputs=[],C.outputs=[];for(const U of this.inputs)C.inputs.push(U.serialize());for(const U of this.outputs)C.outputs.push(U.serialize(!1));return C}_deserialize(C){this._name=C.name,this.comments=C.comments,this.visibleOnFrame=!!C.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(C)}_deserializePortDisplayNamesAndExposedOnFrame(C){const U=C.inputs,K=C.outputs;if(U)for(const m of U){const C=this.inputs.find((C=>C.name===m.name));if(!C)return;if(m.displayName&&(C.displayName=m.displayName),m.isExposedOnFrame&&(C.isExposedOnFrame=m.isExposedOnFrame,C.exposedPortPosition=m.exposedPortPosition),void 0!==m.value&&null!==m.value)if("number"===m.valueType)C.value=m.value;else{const U=(0,e.d)(m.valueType);U&&(C.value=U.FU(m.value))}}if(K)for(let m=0;m<K.length;m++){const C=K[m];C.displayName&&(this.outputs[m].displayName=C.displayName),C.isExposedOnFrame&&(this.outputs[m].isExposedOnFrame=C.isExposedOnFrame,this.outputs[m].exposedPortPosition=C.exposedPortPosition)}}clone(){const C=this.serialize(),U=(0,e.d)(C.customType);if(U){const K=new U;return K._deserialize(C),K}return null}dispose(){this.RA.notifyObservers(this),this.RA.clear();for(const C of this.inputs)C.dispose();for(const C of this.outputs)C.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function nU(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",m=arguments.length>3?arguments[3]:void 0;return(O,X)=>{let A=O._propStore;A||(A=[],O._propStore=A),A.push({propertyName:X,displayName:C,type:U,groupName:K,options:m??{},className:O.getClassName()})}}(0,l.d)([(0,G.O)("comment")],xU.prototype,"comments",void 0),function(C){C[C.Boolean=0]="Boolean",C[C.Float=1]="Float",C[C.Int=2]="Int",C[C.Vector2=3]="Vector2",C[C.List=4]="List",C[C.ve=5]="ve",C[C.SamplingMode=6]="SamplingMode",C[C.TextureFormat=7]="TextureFormat",C[C.TextureType=8]="TextureType"}(cU||(cU={})),function(C){C[C.None=0]="None",C[C.Position=1]="Position",C[C.Direction=2]="Direction",C[C.Age=3]="Age",C[C.Lifetime=4]="Lifetime",C[C.Color=5]="Color",C[C.ScaledDirection=6]="ScaledDirection",C[C.Scale=7]="Scale",C[C.AgeGradient=8]="AgeGradient",C[C.Angle=9]="Angle",C[C.SpriteCellIndex=16]="SpriteCellIndex",C[C.SpriteCellStart=17]="SpriteCellStart",C[C.SpriteCellEnd=18]="SpriteCellEnd"}(NU||(NU={})),function(C){C[C.None=0]="None",C[C.Time=1]="Time",C[C.Delta=2]="Delta",C[C.Emitter=3]="Emitter"}(gU||(gU={}));class SU{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let C="";for(const U of this.notConnectedNonOptionalInputs)C+=`input ${U.name} from block ${U.ownerBlock.name}[${U.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(C)throw"Build of Node Particle System Set failed:\n"+C}adapt(C,U){const K=C.getConnectedValue(this)||0;if(C.type===U)return K;switch(U){case kU.Vector2:return new m.Vector2(K,K);case kU.bU:return new m.bU(K,K,K);case kU.ve:return new A.ve(K,K,K,K)}return null}getContextualValue(C){if(!this.particleContext||!this.systemContext)return null;switch(C){case NU.Position:return this.particleContext.position;case NU.Direction:return this.particleContext.direction;case NU.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case NU.Color:return this.particleContext.color;case NU.Age:return this.particleContext.age;case NU.Lifetime:return this.particleContext.lifeTime;case NU.Angle:return this.particleContext.angle;case NU.Scale:return this.particleContext.scale;case NU.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case NU.SpriteCellEnd:return this.systemContext.endSpriteCellID;case NU.SpriteCellIndex:return this.particleContext.cellIndex;case NU.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.mU.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.mU.absolutePosition:this.systemContext.mU:null}getSystemValue(C){if(!this.particleContext||!this.systemContext)return null;switch(C){case gU.Time:return this.systemContext._actualFrame;case gU.Delta:return this.systemContext._scaledUpdateSpeed;case gU.Emitter:if(this.isEmitterTransformNode){return this.systemContext.mU.absolutePosition}return this.systemContext.mU}return null}}function sU(C,U,K){const m=new SU;m.QU=U;const O=C.createSystem(m);return O.canStart=()=>!0,O.mU=K.clone(),O.disposeOnStop=!0,O.start(),O}class RU extends xU{constructor(C){super(C),this.blendMode=t.BLENDMODE_ONEONE,this.ye=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",kU.Particle),this.registerInput("texture",kU.Texture),this.registerInput("onStart",kU.System,!0),this.registerInput("onEnd",kU.System,!0),this.registerOutput("system",kU.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(C){C.ye=this.ye,C.buildId=this._buildId++,this.build(C);const U=this.particle.getConnectedValue(C);return U.particleTexture=this.texture.getConnectedValue(C),U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.name=this.name,U._nodeGenerated=!0,U._targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,this.system._storedValue=this,U.canStart=()=>!this.doNoStart,U.onStartedObservable.add((K=>{const m=this.onStart.getConnectedValue(C);m&&K.onStartedObservable.addOnce((()=>{C.systemContext=U;const K=sU(m,C.QU,C.emitterPosition);this.RA.addOnce((()=>{K.dispose()}))}));const O=this.onEnd.getConnectedValue(C);O&&K.onStoppedObservable.addOnce((()=>{C.systemContext=U;const K=sU(O,C.QU,C.emitterPosition);this.RA.addOnce((()=>{K.dispose()}))}))})),this.RA.addOnce((()=>{U.dispose()})),U}serialize(){const C=super.serialize();return C.ye=this.ye,C.emitRate=this.emitRate,C.blendMode=this.blendMode,C.doNoStart=this.doNoStart,C.targetStopDuration=this.targetStopDuration,C.startDelay=this.startDelay,C}_deserialize(C){super._deserialize(C),this.ye=C.ye,this.emitRate=C.emitRate,this.doNoStart=!!C.doNoStart,void 0!==C.blendMode&&(this.blendMode=C.blendMode),void 0!==C.targetStopDuration&&(this.targetStopDuration=C.targetStopDuration),void 0!==C.startDelay&&(this.startDelay=C.startDelay)}}(0,l.d)([nU("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:t.BLENDMODE_ONEONE},{label:"Standard",value:t.BLENDMODE_STANDARD},{label:"Add",value:t.BLENDMODE_ADD},{label:"Multiply",value:t.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:t.BLENDMODE_MULTIPLYADD}]})],RU.prototype,"blendMode",void 0),(0,l.d)([nU("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],RU.prototype,"ye",void 0),(0,l.d)([nU("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RU.prototype,"emitRate",void 0),(0,l.d)([nU("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RU.prototype,"targetStopDuration",void 0),(0,l.d)([nU("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RU.prototype,"startDelay",void 0),(0,l.d)([nU("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],RU.prototype,"doNoStart",void 0),(0,e.h)("BABYLON.SystemBlock",RU);class qU extends xU{get type(){if(this._type===kU.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=kU.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=kU.Vector2,this._type;case"bU":return this._type=kU.bU,this._type;case"ve":return this._type=kU.ve,this._type;case"Matrix":return this._type=kU.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===NU.None&&this._systemSource!==gU.None}get systemSource(){return this._systemSource}set systemSource(C){if(this._systemSource=C,C!==gU.None){switch(this._contextualSource=NU.None,this._type=kU.Float,C){case gU.Time:case gU.Delta:this._type=kU.Float;break;case gU.Emitter:this._type=kU.bU}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==NU.None}get contextualValue(){return this._contextualSource}set contextualValue(C){if(this._contextualSource=C,C!==NU.None){switch(this._systemSource=gU.None,C){case NU.Scale:this._type=kU.Vector2;break;case NU.Position:case NU.Direction:case NU.ScaledDirection:this._type=kU.bU;break;case NU.Color:this._type=kU.ve;break;case NU.Age:case NU.Lifetime:case NU.Angle:case NU.AgeGradient:this._type=kU.Float;break;case NU.SpriteCellEnd:case NU.SpriteCellStart:case NU.SpriteCellIndex:this._type=kU.Int}this.output&&(this.output.type=this._type)}}constructor(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kU.AutoDetect;super(C),this._type=kU.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new s.b,this._systemSource=gU.None,this._contextualSource=NU.None,this._type=U,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",U)}get value(){return this._storedValue}set value(C){this.type===kU.Float&&this.min!==this.max&&(C=Math.max(this.min,C),C=Math.min(this.max,C)),this._storedValue=C,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(C){this._valueCallback=C}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case kU.Int:case kU.Float:this.value=0;break;case kU.Vector2:this.value=m.Vector2.Zero();break;case kU.bU:this.value=m.bU.Zero();break;case kU.ve:this.value=new A.ve(1,1,1,1);break;case kU.Matrix:this.value=m.Matrix.Identity()}}_build(C){super._build(C),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=C=>C.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=C=>C.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const C=super.serialize();return C.type=this.type,C.contextualValue=this.contextualValue,C.systemSource=this.systemSource,C.min=this.min,C.max=this.max,C.groupInInspector=this.groupInInspector,C.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Oe?(C.valueType="BABYLON."+this._storedValue.getClassName(),C.value=this._storedValue.Oe()):(C.valueType="number",C.value=this._storedValue)),C}_deserialize(C){if(super._deserialize(C),this._type=C.type,this.contextualValue=C.contextualValue,this.systemSource=C.systemSource||gU.None,this.min=C.min||0,this.max=C.max||0,this.groupInInspector=C.groupInInspector||"",void 0!==C.displayInInspector&&(this.displayInInspector=C.displayInInspector),C.valueType)if("number"===C.valueType)this._storedValue=C.value;else{const U=(0,e.d)(C.valueType);U&&(this._storedValue=U.FU(C.value))}}}(0,e.h)("BABYLON.ParticleInputBlock",qU);class IU extends xU{get url(){return this._url}set url(C){this._url!==C&&(this._cachedData=null,this._url=C,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(C){this._textureDataUrl!==C&&(this._cachedData=null,this._textureDataUrl=C,this._url="",this._sourceTexture=null)}set sourceTexture(C){this._sourceTexture!==C&&(this._cachedData=null,this._sourceTexture=C,this._url="",this._textureDataUrl="")}constructor(C){super(C),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",kU.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const C=this.texture._storedValue;return await new Promise(((U,K)=>{if(!C.isReady())return void C.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),U(this._cachedData)}catch(C){K(C)}}));const m=C.getSize();lU.k.GetTextureDataAsync(C,m.width,m.height).then((K=>{this._cachedData={width:m.width,height:m.height,data:new Uint8ClampedArray(K)},C.dispose(),U(this._cachedData)})).catch(K)}))}_build(C){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new o.b(this._textureDataUrl,C.QU):this.texture._storedValue=new o.b(this._url,C.QU):this.texture._storedValue=null}serialize(){const C=super.serialize();return C.url=this.url,C.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(C.textureDataUrl=this.textureDataUrl),C}_deserialize(C){super._deserialize(C),this.url=C.url,this.serializedCachedData=!!C.serializedCachedData,C.textureDataUrl&&(this.textureDataUrl=C.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,e.h)("BABYLON.ParticleTextureSourceBlock",IU);class CK extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("position",kU.bU),this.registerOutput("output",kU.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(C){const U=this.particle.getConnectedValue(C);if(this.output._storedValue=U,!this.position.isConnected)return;const K={process:K=>{C.particleContext=K,C.systemContext=U,K.position.m(this.position.getConnectedValue(C))},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K}}(0,e.h)("BABYLON.UpdatePositionBlock",CK),function(C){C[C.Add=0]="Add",C[C.Subtract=1]="Subtract",C[C.Multiply=2]="Multiply",C[C.Divide=3]="Divide",C[C.Max=4]="Max",C[C.Min=5]="Min"}(MU||(MU={}));class UK extends xU{constructor(C){super(C),this.operation=MU.Add,this.registerInput("left",kU.AutoDetect),this.registerInput("right",kU.AutoDetect),this.registerOutput("output",kU.BasedOnInput),this.output._typeConnectionSource=this.left;const U=[kU.Matrix,kU.Particle,kU.Texture,kU.System,kU.FloatGradient,kU.Color4Gradient,kU.Vector2Gradient,kU.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...U),this.right.excludedConnectionPointTypes.push(...U),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(C){let U;const K=this.left,O=this.right;if(!K.isConnected||!O.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const X=K.type===kU.Float||K.type===kU.Int,e=O.type===kU.Float||O.type===kU.Int,t=X&&e;switch(this.operation){case MU.Add:U=t?C=>K.getConnectedValue(C)+O.getConnectedValue(C):X?C=>C.adapt(K,O.type).add(O.getConnectedValue(C)):C=>K.getConnectedValue(C).add(C.adapt(O,K.type));break;case MU.Subtract:U=t?C=>K.getConnectedValue(C)-O.getConnectedValue(C):X?C=>C.adapt(K,O.type).vU(O.getConnectedValue(C)):C=>K.getConnectedValue(C).vU(C.adapt(O,K.type));break;case MU.Multiply:U=t?C=>K.getConnectedValue(C)*O.getConnectedValue(C):X?C=>C.adapt(K,O.type).multiply(O.getConnectedValue(C)):C=>K.getConnectedValue(C).multiply(C.adapt(O,K.type));break;case MU.Divide:U=t?C=>K.getConnectedValue(C)/O.getConnectedValue(C):X?C=>C.adapt(K,O.type).divide(O.getConnectedValue(C)):C=>K.getConnectedValue(C).divide(C.adapt(O,K.type));break;case MU.Min:if(t)U=C=>Math.min(K.getConnectedValue(C),O.getConnectedValue(C));else{const[C,e]=X?[O,K]:[K,O];switch(C.type){case kU.Vector2:U=U=>m.Vector2.Minimize(C.getConnectedValue(U),U.adapt(e,C.type));break;case kU.bU:U=U=>m.bU.Minimize(C.getConnectedValue(U),U.adapt(e,C.type));break;case kU.ve:U=U=>{const K=C.getConnectedValue(U),{r:m,g:O,b:X,a:t}=U.adapt(e,C.type);return new A.ve(Math.min(K.r,m),Math.min(K.g,O),Math.min(K.b,X),Math.min(K.a,t))}}}break;case MU.Max:if(!t){const[C,e]=X?[O,K]:[K,O];switch(C.type){case kU.Vector2:U=U=>m.Vector2.Maximize(C.getConnectedValue(U),U.adapt(e,C.type));break;case kU.bU:U=U=>m.bU.Maximize(C.getConnectedValue(U),U.adapt(e,C.type));break;case kU.ve:U=U=>{const K=C.getConnectedValue(U),{r:m,g:O,b:X,a:t}=U.adapt(e,C.type);return new A.ve(Math.max(K.r,m),Math.min(K.g,O),Math.min(K.b,X),Math.min(K.a,t))}}break}U=C=>Math.max(K.getConnectedValue(C),O.getConnectedValue(C))}this.output._storedFunction=C=>K.type===kU.Int?0|U(C):U(C)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===kU.Int||this.left.type===kU.Float&&this.right.type!==kU.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[C,U]of[[this.left,this.right],[this.right,this.left]])C.acceptedConnectionPointTypes=[kU.Int,kU.Float],U.isConnected&&(C.acceptedConnectionPointTypes.push(U.type),U.type!==kU.Int&&U.type!==kU.Float||C.acceptedConnectionPointTypes.push(kU.Vector2,kU.bU,kU.ve))}dispose(){super.dispose();for(const C of this._connectionObservers)C.remove();this._connectionObservers.length=0}serialize(){const C=super.serialize();return C.operation=this.operation,C}_deserialize(C){super._deserialize(C),this.operation=C.operation}}(0,l.d)([nU("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:MU.Add},{label:"Subtract",value:MU.Subtract},{label:"Multiply",value:MU.Multiply},{label:"Divide",value:MU.Divide},{label:"Max",value:MU.Max},{label:"Min",value:MU.Min}]})],UK.prototype,"operation",void 0),(0,e.h)("BABYLON.ParticleMathBlock",UK);class KK extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("direction1",kU.bU,!0,new m.bU(0,1,0)),this.registerInput("direction2",kU.bU,!0,new m.bU(0,1,0)),this.registerInput("minEmitBox",kU.bU,!0,new m.bU(-.5,-.5,-.5)),this.registerInput("maxEmitBox",kU.bU,!0,new m.bU(.5,.5,.5)),this.registerOutput("output",kU.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(C){const U=this.particle.getConnectedValue(C);U._directionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.direction1.getConnectedValue(C),X=this.direction2.getConnectedValue(C),A=(0,z.RandomRange)(O.x,X.x),e=(0,z.RandomRange)(O.y,X.y),t=(0,z.RandomRange)(O.z,X.z);C.isEmitterTransformNode?m.bU.TransformNormalFromFloatsToRef(A,e,t,C.emitterWorldMatrix,K.direction):K.direction.Ee(A,e,t)},U._positionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.minEmitBox.getConnectedValue(C),X=this.maxEmitBox.getConnectedValue(C),A=(0,z.RandomRange)(O.x,X.x),e=(0,z.RandomRange)(O.y,X.y),t=(0,z.RandomRange)(O.z,X.z);C.isEmitterTransformNode?m.bU.TransformCoordinatesFromFloatsToRef(A,e,t,C.emitterWorldMatrix,K.position):(K.position.Ee(A,e,t),K.position.addInPlace(C.emitterPosition))},this.output._storedValue=U}}(0,e.h)("BABYLON.BoxShapeBlock",KK);class mK extends xU{constructor(C){super(C),this.registerInput("emitPower",kU.Float,!0,1),this.registerInput("lifeTime",kU.Float,!0,1),this.registerInput("color",kU.ve,!0,new A.ve(1,1,1,1)),this.registerInput("scale",kU.Vector2,!0,new m.Vector2(1,1)),this.registerInput("angle",kU.Float,!0,0),this.registerOutput("particle",kU.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(C){const U=new eU(this.name,C.ye,C.QU,null,!1,void 0,!0);U.particleEmitterType=new V,U._lifeTimeCreation.process=(U,K)=>{C.particleContext=U,U.lifeTime=this.lifeTime.getConnectedValue(C),K._emitPower=this.emitPower.getConnectedValue(C)},U._colorCreation.process=U=>{C.particleContext=U,U.color.m(this.color.getConnectedValue(C))},U._sizeCreation.process=U=>{C.particleContext=U,U.size=1,U.scale.m(this.scale.getConnectedValue(C))},U._angleCreation.process=U=>{C.particleContext=U,U.angle=this.angle.getConnectedValue(C)},this.particle._storedValue=U}}(0,e.h)("BABYLON.CreateParticleBlock",mK);class OK{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const C=[];for(const U of this.attachedBlocks)U.isInput&&C.push(U);return C}constructor(C){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new s.b,this.name=C}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(C)&&this.attachedBlocks.push(C);for(const K of C.inputs){const m=K.connectedPoint;if(m){const K=m.ownerBlock;K!==C&&this._initializeBlock(K,U)}}}async buildAsync(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((K=>{const m=new dU;for(const C of this._systemBlocks)this._initializeBlock(C);for(const O of this.systemBlocks){const K=new SU;K.buildId=this._buildId++,K.QU=C,K.verbose=U;const X=O.createSystem(K);K.emitErrors(),m.systems.push(X)}this.onBuildObservable.notifyObservers(this),K(m)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const C=new RU("Particle system"),U=new CK("Update position");U.output.connectTo(C.particle);const K=new qU("Position");K.contextualValue=NU.Position;const m=new qU("Scaled direction");m.contextualValue=NU.ScaledDirection;const O=new UK("Add");O.operation=MU.Add,K.output.connectTo(O.left),m.output.connectTo(O.right),O.output.connectTo(U.position);const X=new mK("Create particle"),A=new KK("Box shape");X.particle.connectTo(A.particle),A.output.connectTo(U.particle);const e=new IU("Texture");e.texture.connectTo(C.texture),e.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(C)}removeBlock(C){const U=this.attachedBlocks.indexOf(C);if(U>-1&&this.attachedBlocks.splice(U,1),C.isSystem){const U=this._systemBlocks.indexOf(C);U>-1&&this._systemBlocks.splice(U,1)}}parseSerializedObject(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U||this.clear();const K={};for(const m of C.Tj){const C=(0,e.d)(m.customType);if(C){const U=new C;U._deserialize(m),K[m.id]=U,this.attachedBlocks.push(U),U.isSystem&&this._systemBlocks.push(U)}}for(const m of this.attachedBlocks)if(m.isTeleportOut){const C=m,U=C._tempEntryPointUniqueId;if(U){const m=K[U];m&&m.attachToEndpoint(C)}}for(let m=0;m<C.Tj.length;m++){const O=C.Tj[m],X=K[O.id];X&&(X.inputs.length&&O.inputs.some((C=>C.targetConnectionName))&&!U||this._restoreConnections(X,C,K))}if(C.locations||C.editorData&&C.editorData.locations){const m=C.locations||C.editorData.locations;for(const C of m)K[C.Rm]&&(C.Rm=K[C.Rm].uniqueId);U&&this.editorData&&this.editorData.locations&&m.concat(this.editorData.locations),C.locations?this.editorData={locations:m}:(this.editorData=C.editorData,this.editorData.locations=m);const O=[];for(const C in K)O[C]=K[C].uniqueId;this.editorData.map=O}this.comment=C.comment}_restoreConnections(C,U,K){for(const m of C.outputs)for(const O of U.Tj){const X=K[O.id];if(X)for(const A of O.inputs)if(K[A.targetBlockId]!==C||A.targetConnectionName!==m.name);else{const C=X.getInputByName(A.inputName);if(!C||C.isConnected)continue;m.connectTo(C,!0),this._restoreConnections(X,U,K)}}}serialize(C){const U=C?{}:J.c.Serialize(this);U.editorData=JSON.parse(JSON.stringify(this.editorData));let K=[];C?K=C:U.customType="BABYLON.NodeParticleSystemSet",U.Tj=[];for(const m of K)U.Tj.push(m.serialize());if(!C)for(const m of this.attachedBlocks)-1===K.indexOf(m)&&U.Tj.push(m.serialize());return U}dispose(){for(const C of this.attachedBlocks)C.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(C){const U=new OK(C);return U.setToDefault(),U}static Parse(C){const U=J.c.Parse((()=>new OK(C.name)),C,null);return U.parseSerializedObject(C),U}static ParseFromSnippetAsync(C,U){return"_BLANK"===C?Promise.resolve(OK.CreateDefault("blank")):new Promise(((K,m)=>{const O=new TU.b;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const A=JSON.parse(JSON.parse(O.responseText).jsonPayload),e=JSON.parse(A.nodeParticle);U||(U=J.c.Parse((()=>new OK(C)),e,null)),U.parseSerializedObject(e),U.snippetId=C;try{K(U)}catch(X){m(X)}}else m("Unable to load the snippet "+C)})),O.open("GET",this.SnippetUrl+"/"+C.replace(/#/g,"/")),O.send()}))}}OK.EditorURL=`${ZU.Tools._DefaultCdnUrl}/v${nC.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,OK.SnippetUrl="https://snippet.babylonjs.com",(0,l.d)([(0,G.O)()],OK.prototype,"name",void 0),(0,l.d)([(0,G.O)("comment")],OK.prototype,"comment",void 0),function(C){C[C.None=0]="None",C[C.PerParticle=1]="PerParticle",C[C.PerSystem=2]="PerSystem"}(LU||(LU={}));class XK extends xU{constructor(C){super(C),this._currentLockId=-2,this.lockMode=LU.PerParticle,this.registerInput("min",kU.AutoDetect,!0,0),this.registerInput("max",kU.AutoDetect,!0,1),this.registerOutput("output",kU.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kU.Float|kU.Int|kU.Vector2|kU.bU|kU.ve),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(kU.Float|kU.Int|kU.Vector2|kU.bU|kU.ve),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=kU.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let C=null;switch(this._currentLockId=-2,this.min.type){case kU.AutoDetect:case kU.Int:case kU.Float:C=C=>{const U=this.min.getConnectedValue(C)||0,K=this.max.getConnectedValue(C)||1;return U+Math.random()*(K-U)};break;case kU.Vector2:C=C=>{const U=this.min.getConnectedValue(C)||m.Vector2.Zero(),K=this.max.getConnectedValue(C)||m.Vector2.One();return new m.Vector2(U.x+Math.random()*(K.x-U.x),U.y+Math.random()*(K.y-U.y))};break;case kU.bU:C=C=>{const U=this.min.getConnectedValue(C)||m.bU.Zero(),K=this.max.getConnectedValue(C)||m.bU.One();return new m.bU(U.x+Math.random()*(K.x-U.x),U.y+Math.random()*(K.y-U.y),U.z+Math.random()*(K.z-U.z))};break;case kU.ve:C=C=>{const U=this.min.getConnectedValue(C)||new A.ve(0,0,0,0),K=this.max.getConnectedValue(C)||new A.ve(1,1,1,1);return new A.ve(U.x+Math.random()*(K.x-U.x),U.y+Math.random()*(K.y-U.y),U.z+Math.random()*(K.z-U.z),U.w+Math.random()*(K.w-U.w))}}this.output._storedFunction=U=>{var K;let m=0;switch(this.lockMode){case LU.PerParticle:m=(null===(K=U.particleContext)||void 0===K?void 0:K.id)||-1;break;case LU.PerSystem:m=U.buildId||0}return this._currentLockId!==m&&(this.lockMode!==LU.None&&(this._currentLockId=m),this.output._storedValue=C(U)),this.output._storedValue}}serialize(){const C=super.serialize();return C.lockMode=this.lockMode,C}_deserialize(C){super._deserialize(C),this.lockMode=C.lockMode}}(0,l.d)([nU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:LU.None},{label:"Per particle",value:LU.PerParticle},{label:"Per system",value:LU.PerSystem}]})],XK.prototype,"lockMode",void 0),(0,e.h)("BABYLON.ParticleRandomBlock",XK);class AK extends xU{constructor(C){super(C),this._currentLockId=-2,this.lockMode=LU.PerParticle,this.registerInput("min",kU.AutoDetect),this.registerInput("max",kU.AutoDetect),this.registerOutput("output",kU.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const U=[kU.Matrix,kU.Particle,kU.Texture,kU.System,kU.FloatGradient,kU.Color4Gradient,kU.Vector2Gradient,kU.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...U),this.max.excludedConnectionPointTypes.push(...U)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let C=null;switch(this._currentLockId=-2,this.min.type){case kU.Float:case kU.Int:C=C=>{const U=this.min.getConnectedValue(C),K=this.max.getConnectedValue(C);return Math.random()*(K-U)+U};break;case kU.Vector2:C=C=>{const U=this.min.getConnectedValue(C),K=this.max.getConnectedValue(C);return new m.Vector2(Math.random()*(K.x-U.x)+U.x,Math.random()*(K.y-U.y)+U.y)};break;case kU.bU:C=C=>{const U=this.min.getConnectedValue(C),K=this.max.getConnectedValue(C);return new m.bU(Math.random()*(K.x-U.x)+U.x,Math.random()*(K.y-U.y)+U.y,Math.random()*(K.z-U.z)+U.z)};break;case kU.ve:C=C=>{const U=this.min.getConnectedValue(C),K=this.max.getConnectedValue(C);return new A.ve(Math.random()*(K.r-U.r)+U.r,Math.random()*(K.g-U.g)+U.g,Math.random()*(K.b-U.b)+U.b,Math.random()*(K.a-U.a)+U.a)}}this.output._storedFunction=U=>{var K;let m=0;switch(this.lockMode){case LU.PerParticle:m=(null===(K=U.particleContext)||void 0===K?void 0:K.id)||-1;break;case LU.PerSystem:m=U.buildId||0}return this._currentLockId!==m&&(this.lockMode!==LU.None&&(this._currentLockId=m),this.output._storedValue=C(U)),this.output._storedValue}}serialize(){const C=super.serialize();return C.lockMode=this.lockMode,C}_deserialize(C){super._deserialize(C),void 0!==C.lockMode&&(this.lockMode=C.lockMode)}}(0,l.d)([nU("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:LU.None},{label:"Per particle",value:LU.PerParticle},{label:"Per system",value:LU.PerSystem}]})],AK.prototype,"lockMode",void 0),(0,e.h)("BABYLON.RandomRangeBlock",AK);(0,e.h)("BABYLON.ParticleLerpBlock",class extends xU{constructor(C){super(C),this.registerInput("left",kU.AutoDetect),this.registerInput("right",kU.AutoDetect),this.registerInput("gradient",kU.Float,!0,0,0,1),this.registerOutput("output",kU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kU.Float|kU.Int|kU.Vector2|kU.bU|kU.ve)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const C=(C,U,K)=>(1-C)*U+C*K;this.output._storedFunction=U=>{const K=this.left.getConnectedValue(U),O=this.right.getConnectedValue(U),X=this.gradient.getConnectedValue(U);switch(this.left.type){case kU.Int:case kU.Float:return C(X,K,O);case kU.Vector2:return new m.Vector2(C(X,K.x,O.x),C(X,K.y,O.y));case kU.bU:return new m.bU(C(X,K.x,O.x),C(X,K.y,O.y),C(X,K.z,O.z));case kU.ve:return new A.ve(C(X,K.r,O.r),C(X,K.g,O.g),C(X,K.b,O.b),C(X,K.a,O.a))}return 0}}});(0,e.h)("BABYLON.UpdateDirectionBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("direction",kU.bU),this.registerOutput("output",kU.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(C){const U=this.particle.getConnectedValue(C);if(this.output._storedValue=U,!this.direction.isConnected)return;const K={process:K=>{C.particleContext=K,C.systemContext=U,K.direction.m(this.direction.getConnectedValue(C))},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K}});(0,e.h)("BABYLON.UpdateColorBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("color",kU.ve),this.registerOutput("output",kU.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(C){const U=this.particle.getConnectedValue(C);if(this.output._storedValue=U,!this.color.isConnected)return;const K={process:K=>{C.particleContext=K,C.systemContext=U,K.color.m(this.color.getConnectedValue(C))},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K}});(0,e.h)("BABYLON.UpdateScaleBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("scale",kU.Vector2),this.registerOutput("output",kU.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(C){const U=this.particle.getConnectedValue(C);if(this.output._storedValue=U,!this.scale.isConnected)return;const K={process:K=>{C.particleContext=K,C.systemContext=U,K.scale.m(this.scale.getConnectedValue(C))},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K}});(0,e.h)("BABYLON.UpdateAngleBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("angle",kU.Float),this.registerOutput("output",kU.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(C){const U=this.particle.getConnectedValue(C);if(this.output._storedValue=U,!this.angle.isConnected)return;const K={process:K=>{C.particleContext=K,C.systemContext=U,K.angle=this.angle.getConnectedValue(C)},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K}});(0,e.h)("BABYLON.BasicPositionUpdateBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerOutput("output",kU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(C){const U=this.particle.getConnectedValue(C),K={process:K=>{C.particleContext=K,C.systemContext=U,K.direction.scaleToRef(U._directionScale,U._scaledDirection),K.position.addInPlace(U._scaledDirection)},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K,this.output._storedValue=U}});(0,e.h)("BABYLON.BasicSpriteUpdateBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerOutput("output",kU.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(C){const U=this.particle.getConnectedValue(C),K={process:K=>{C.particleContext=K,C.systemContext=U,K.updateCellIndex()},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K,this.output._storedValue=U}});(0,e.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("cellIndex",kU.Int),this.registerOutput("output",kU.Particle),this.cellIndex.acceptedConnectionPointTypes=[kU.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(C){const U=this.particle.getConnectedValue(C);if(this.output._storedValue=U,!this.cellIndex.isConnected)return;const K={process:K=>{C.particleContext=K,C.systemContext=U,K.cellIndex=Math.floor(this.cellIndex.getConnectedValue(C))},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K}});class eK extends xU{constructor(C){super(C),this.strength=1,this.registerInput("particle",kU.Particle),this.registerInput("flowMap",kU.Texture),this.registerOutput("output",kU.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(C){var U;const K=this.particle.getConnectedValue(C),m=C.QU;let O;(null===(U=this.flowMap.connectedPoint)||void 0===U?void 0:U.ownerBlock).extractTextureContentAsync().then((C=>{C&&(O=new BU(C.width,C.height,C.data))}));const X={process:C=>{const U=m.getTransformMatrix();O&&O._processParticle(C,this.strength*K._tempScaledUpdateSpeed,U)},previousItem:null,nextItem:null};K._updateQueueStart?gC(X,K._updateQueueStart):K._updateQueueStart=X,this.output._storedValue=K}serialize(){const C=super.serialize();return C.strength=this.strength,C}_deserialize(C){super._deserialize(C),this.strength=C.strength}}(0,l.d)([nU("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eK.prototype,"strength",void 0),(0,e.h)("BABYLON.UpdateFlowMapBlock",eK);(0,e.h)("BABYLON.SphereShapeBlock",class extends xU{constructor(C){super(C),this.registerInput("input",kU.Particle),this.registerInput("radius",kU.Float,!0,1),this.registerInput("radiusRange",kU.Float,!0,1,0,1),this.registerInput("directionRandomizer",kU.Float,!0,0,0,1),this.registerOutput("output",kU.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(C){const U=this.input.getConnectedValue(C);U._directionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.directionRandomizer.getConnectedValue(C),X=K.position.vU(C.emitterPosition).normalize(),A=(0,z.RandomRange)(0,O),e=(0,z.RandomRange)(0,O),t=(0,z.RandomRange)(0,O);X.x+=A,X.y+=e,X.z+=t,X.normalize(),C.isEmitterTransformNode?m.bU.TransformNormalFromFloatsToRef(A,e,t,C.emitterWorldMatrix,K.direction):K.direction.Ee(A,e,t)},U._positionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.radius.getConnectedValue(C),X=this.radiusRange.getConnectedValue(C),A=O-(0,z.RandomRange)(0,O*X),e=(0,z.RandomRange)(0,1),t=(0,z.RandomRange)(0,2*Math.PI),j=Math.acos(2*e-1),p=A*Math.cos(t)*Math.sin(j),E=A*Math.cos(j),u=A*Math.sin(t)*Math.sin(j);C.isEmitterTransformNode?m.bU.TransformCoordinatesFromFloatsToRef(p,E,u,C.emitterWorldMatrix,K.position):(K.position.Ee(p,E,u),K.position.addInPlace(C.emitterPosition))},this.output._storedValue=U}});(0,e.h)("BABYLON.PointShapeBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("direction1",kU.bU,!0,new m.bU(0,1,0)),this.registerInput("direction2",kU.bU,!0,new m.bU(0,1,0)),this.registerOutput("output",kU.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(C){const U=this.particle.getConnectedValue(C);U._directionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.direction1.getConnectedValue(C),X=this.direction2.getConnectedValue(C),A=(0,z.RandomRange)(O.x,X.x),e=(0,z.RandomRange)(O.y,X.y),t=(0,z.RandomRange)(O.z,X.z);C.isEmitterTransformNode?m.bU.TransformNormalFromFloatsToRef(A,e,t,C.emitterWorldMatrix,K.direction):K.direction.Ee(A,e,t)},U._positionCreation.process=K=>{C.systemContext=U,C.isEmitterTransformNode?m.bU.TransformCoordinatesFromFloatsToRef(0,0,0,C.emitterWorldMatrix,K.position):K.position.m(C.emitterPosition)},this.output._storedValue=U}});(0,e.h)("BABYLON.CustomShapeBlock",class extends xU{constructor(C){super(C),this.registerInput("particle",kU.Particle),this.registerInput("position",kU.bU,!0,new m.bU(0,0,0)),this.registerInput("direction",kU.bU,!0,new m.bU(0,1,0)),this.registerOutput("output",kU.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(C){const U=this.particle.getConnectedValue(C);U._directionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.direction.getConnectedValue(C);C.isEmitterTransformNode?m.bU.TransformNormalToRef(O,C.emitterWorldMatrix,K.direction):K.direction.m(O)},U._positionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.position.getConnectedValue(C);C.isEmitterTransformNode?m.bU.TransformCoordinatesToRef(O,C.emitterWorldMatrix,K.position):(K.position.m(O),K.position.addInPlace(C.emitterPosition))},this.output._storedValue=U}});(0,e.h)("BABYLON.CylinderShapeBlock",class extends xU{constructor(C){super(C),this._tempVector=m.bU.Zero(),this.registerInput("particle",kU.Particle),this.registerInput("radius",kU.Float,!0,1),this.registerInput("height",kU.Float,!0,1,0),this.registerInput("radiusRange",kU.Float,!0,1,0,1),this.registerInput("directionRandomizer",kU.Float,!0,0,0,1),this.registerOutput("output",kU.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(C){const U=this.particle.getConnectedValue(C);U._directionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.directionRandomizer.getConnectedValue(C);K.position.subtractToRef(C.emitterPosition,this._tempVector),this._tempVector.normalize(),C.isEmitterTransformNode&&m.bU.TransformNormalToRef(this._tempVector,C.emitterInverseWorldMatrix,this._tempVector);const X=(0,z.RandomRange)(-O/2,O/2);let A=Math.atan2(this._tempVector.x,this._tempVector.z);A+=(0,z.RandomRange)(-Math.PI/2,Math.PI/2)*O,this._tempVector.y=X,this._tempVector.x=Math.sin(A),this._tempVector.z=Math.cos(A),this._tempVector.normalize(),C.isEmitterTransformNode?m.bU.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,C.emitterWorldMatrix,K.direction):K.direction.m(this._tempVector)},U._positionCreation.process=K=>{C.particleContext=K,C.systemContext=U;const O=this.height.getConnectedValue(C),X=this.radiusRange.getConnectedValue(C),A=this.radius.getConnectedValue(C),e=(0,z.RandomRange)(-O/2,O/2),t=(0,z.RandomRange)(0,2*Math.PI),j=(0,z.RandomRange)((1-X)*(1-X),1),p=Math.sqrt(j)*A,E=p*Math.cos(t),u=p*Math.sin(t);C.isEmitterTransformNode?m.bU.TransformCoordinatesFromFloatsToRef(E,e,u,C.emitterWorldMatrix,K.position):(K.position.Ee(E,e,u),K.position.addInPlace(C.emitterPosition))},this.output._storedValue=U}});class tK extends xU{constructor(C){super(C),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",kU.Particle),this.registerOutput("output",kU.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(C){super._build(C);const U=this.particle.getConnectedValue(C);U._isAnimationSheetEnabled=!0,U.spriteCellWidth=this.width,U.spriteCellHeight=this.height,U.startSpriteCellID=this.start,U.endSpriteCellID=this.end,U.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=U}serialize(){const C=super.serialize();return C.width=this.width,C.height=this.height,C.start=this.start,C.end=this.end,C.randomStartCell=this.randomStartCell,C}_deserialize(C){super._deserialize(C),this.width=C.width,this.height=C.height,this.start=C.start,this.end=C.end,this.randomStartCell=C.randomStartCell}}(0,l.d)([nU("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tK.prototype,"start",void 0),(0,l.d)([nU("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tK.prototype,"end",void 0),(0,l.d)([nU("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tK.prototype,"width",void 0),(0,l.d)([nU("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tK.prototype,"height",void 0),(0,l.d)([nU("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],tK.prototype,"loop",void 0),(0,l.d)([nU("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],tK.prototype,"randomStartCell",void 0),(0,e.h)("BABYLON.SetupSpriteSheetBlock",tK);class zK extends xU{constructor(C){super(C),this.reference=0,this.registerInput("value",kU.AutoDetect),this.registerOutput("output",kU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=C=>{switch(C){case kU.Float:return kU.FloatGradient;case kU.Vector2:return kU.Vector2Gradient;case kU.bU:return kU.Vector3Gradient;case kU.ve:return kU.Color4Gradient}return C},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kU.Float|kU.Vector2|kU.bU|kU.ve)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=C=>null}serialize(){const C=super.serialize();return C.reference=this.reference,C}_deserialize(C){super._deserialize(C),this.reference=C.reference}}(0,l.d)([nU("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],zK.prototype,"reference",void 0),(0,e.h)("BABYLON.ParticleGradientValueBlock",zK);(0,e.h)("BABYLON.ParticleGradientBlock",class extends xU{constructor(C){super(C),this._entryCount=1,this.registerInput("gradient",kU.Float,!0,1,0,1),this.registerInput("value0",kU.AutoDetect),this.registerOutput("output",kU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=C=>{switch(C){case kU.FloatGradient:return kU.Float;case kU.Vector2Gradient:return kU.Vector2;case kU.Vector3Gradient:return kU.bU;case kU.Color4Gradient:return kU.ve}return C},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(kU.FloatGradient|kU.Vector2Gradient|kU.Vector3Gradient|kU.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(C){this._inputs[C].onConnectionObservable.add((()=>{this._entryCount>C||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),kU.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const C=[];for(let K=1;K<this._inputs.length;K++){var U;if(this._inputs[K].isConnected)C.push(null===(U=this._inputs[K].connectedPoint)||void 0===U?void 0:U.ownerBlock)}C.sort(((C,U)=>C.reference-U.reference)),this.output._storedFunction=U=>{const K=this.gradient.getConnectedValue(U);if(1===C.length)return C[0].value.getConnectedValue(U);let O=null;for(let X=C.length-1;X>=0;X--){const e=C[X];if(e.reference<=K){const C=e.value.getConnectedValue(U);if(O){const X=O.value.getConnectedValue(U),t=O.reference,j=e.reference,p=Math.max(0,Math.min(1,(K-j)/(t-j)));switch(this.output.type){case kU.Float:return(0,z.Lerp)(C,X,p);case kU.Vector2:return m.Vector2.Lerp(C,X,p);case kU.bU:return m.bU.Lerp(C,X,p);case kU.ve:return A.ve.Lerp(C,X,p)}}return C}O=e}return 0}}});(0,e.h)("BABYLON.ParticleConverterBlock",class extends xU{constructor(C){super(C),this.registerInput("color ",kU.ve,!0),this.registerInput("xyz ",kU.bU,!0),this.registerInput("xy ",kU.Vector2,!0),this.registerInput("zw ",kU.Vector2,!0),this.registerInput("x ",kU.Float,!0),this.registerInput("y ",kU.Float,!0),this.registerInput("z ",kU.Float,!0),this.registerInput("w ",kU.Float,!0),this.registerOutput("color",kU.ve),this.registerOutput("xyz",kU.bU),this.registerOutput("xy",kU.Vector2),this.registerOutput("zw",kU.Vector2),this.registerOutput("x",kU.Float),this.registerOutput("y",kU.Float),this.registerOutput("z",kU.Float),this.registerOutput("w",kU.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(C){return"color "===C?"colorIn":"xyz "===C?"xyzIn":"xy "===C?"xyIn":"zw "===C?"zwIn":"x "===C?"xIn":"y "===C?"yIn":"z "===C?"zIn":"w "===C?"wIn":C}_outputRename(C){switch(C){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return C}}_build(C){super._build(C);const U=this.xIn,K=this.yIn,O=this.zIn,X=this.wIn,e=this.xyIn,t=this.zwIn,z=this.xyzIn,j=this.colorIn,p=this.colorOut,E=this.xyzOut,u=this.xyOut,b=this.zwOut,v=this.xOut,Q=this.yOut,V=this.zOut,f=this.wOut,F=C=>{if(j.isConnected)return j.getConnectedValue(C);let m=0,p=0,E=0,u=0;if(U.isConnected&&(m=U.getConnectedValue(C)),K.isConnected&&(p=K.getConnectedValue(C)),O.isConnected&&(E=O.getConnectedValue(C)),X.isConnected&&(u=X.getConnectedValue(C)),e.isConnected){const U=e.getConnectedValue(C);U&&(m=U.x,p=U.y)}if(t.isConnected){const U=t.getConnectedValue(C);U&&(E=U.x,u=U.y)}if(z.isConnected){const U=z.getConnectedValue(C);U&&(m=U.x,p=U.y,E=U.z)}return new A.ve(m,p,E,u)};p._storedFunction=C=>F(C),E._storedFunction=C=>{const U=F(C);return new m.bU(U.r,U.g,U.b)},u._storedFunction=C=>{const U=F(C);return new m.Vector2(U.r,U.g)},b._storedFunction=C=>{const U=F(C);return new m.Vector2(U.b,U.a)},v._storedFunction=C=>F(C).r,Q._storedFunction=C=>F(C).g,V._storedFunction=C=>F(C).b,f._storedFunction=C=>F(C).a}}),function(C){C[C.Cos=0]="Cos",C[C.Sin=1]="Sin",C[C.Abs=2]="Abs",C[C.Exp=3]="Exp",C[C.Exp2=4]="Exp2",C[C.Round=5]="Round",C[C.Floor=6]="Floor",C[C.Ceiling=7]="Ceiling",C[C.Sqrt=8]="Sqrt",C[C.Log=9]="Log",C[C.Tan=10]="Tan",C[C.ArcTan=11]="ArcTan",C[C.ArcCos=12]="ArcCos",C[C.ArcSin=13]="ArcSin",C[C.Sign=14]="Sign",C[C.Negate=15]="Negate",C[C.OneMinus=16]="OneMinus",C[C.Reciprocal=17]="Reciprocal",C[C.ToDegrees=18]="ToDegrees",C[C.ToRadians=19]="ToRadians",C[C.Fract=20]="Fract"}(YU||(YU={}));class jK extends xU{constructor(C){super(C),this.operation=YU.Cos,this.registerInput("input",kU.AutoDetect),this.registerOutput("output",kU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kU.Float|kU.Int|kU.Vector2|kU.bU|kU.ve)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(C){super._build(C);let U=null;switch(this.operation){case YU.Cos:U=C=>Math.cos(C);break;case YU.Sin:U=C=>Math.sin(C);break;case YU.Abs:U=C=>Math.abs(C);break;case YU.Exp:U=C=>Math.exp(C);break;case YU.Exp2:U=C=>Math.pow(2,C);break;case YU.Round:U=C=>Math.round(C);break;case YU.Floor:U=C=>Math.floor(C);break;case YU.Ceiling:U=C=>Math.ceil(C);break;case YU.Sqrt:U=C=>Math.sqrt(C);break;case YU.Log:U=C=>Math.log(C);break;case YU.Tan:U=C=>Math.tan(C);break;case YU.ArcTan:U=C=>Math.atan(C);break;case YU.ArcCos:U=C=>Math.acos(C);break;case YU.ArcSin:U=C=>Math.asin(C);break;case YU.Sign:U=C=>Math.sign(C);break;case YU.Negate:U=C=>-C;break;case YU.OneMinus:U=C=>1-C;break;case YU.Reciprocal:U=C=>1/C;break;case YU.ToRadians:U=C=>C*Math.PI/180;break;case YU.ToDegrees:U=C=>180*C/Math.PI;break;case YU.Fract:U=C=>C>=0?C-Math.floor(C):C-Math.ceil(C)}if(!U)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case kU.Int:case kU.Float:this.output._storedFunction=C=>{const K=this.input.getConnectedValue(C);return U(K)};break;case kU.Vector2:this.output._storedFunction=C=>{const K=this.input.getConnectedValue(C);return new m.Vector2(U(K.x),U(K.y))};break;case kU.bU:this.output._storedFunction=C=>{const K=this.input.getConnectedValue(C);return new m.bU(U(K.x),U(K.y),U(K.z))};break;case kU.ve:this.output._storedFunction=C=>{const K=this.input.getConnectedValue(C);return new A.ve(U(K.r),U(K.g),U(K.b),U(K.a))}}return this}serialize(){const C=super.serialize();return C.operation=this.operation,C}_deserialize(C){super._deserialize(C),this.operation=C.operation}}(0,l.d)([nU("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:YU.Cos},{label:"Sin",value:YU.Sin},{label:"Abs",value:YU.Abs},{label:"Exp",value:YU.Exp},{label:"Exp2",value:YU.Exp2},{label:"Round",value:YU.Round},{label:"Floor",value:YU.Floor},{label:"Ceiling",value:YU.Ceiling},{label:"Sqrt",value:YU.Sqrt},{label:"Log",value:YU.Log},{label:"Tan",value:YU.Tan},{label:"ArcTan",value:YU.ArcTan},{label:"ArcCos",value:YU.ArcCos},{label:"ArcSin",value:YU.ArcSin},{label:"Sign",value:YU.Sign},{label:"Negate",value:YU.Negate},{label:"OneMinus",value:YU.OneMinus},{label:"Reciprocal",value:YU.Reciprocal},{label:"ToDegrees",value:YU.ToDegrees},{label:"ToRadians",value:YU.ToRadians},{label:"Fract",value:YU.Fract}]})],jK.prototype,"operation",void 0),(0,e.h)("BABYLON.ParticleTrigonometryBlock",jK);var pK,EK=K(13187);class uK extends xU{constructor(C){super(C),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",kU.AutoDetect),this.registerOutput("output",kU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(kU.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(kU.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(kU.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(kU.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(kU.System),this._inputs[0].excludedConnectionPointTypes.push(kU.Particle),this._inputs[0].excludedConnectionPointTypes.push(kU.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(C){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const U=C=>{const U=this.input.getConnectedValue(C);if(this.log.length>=this.stackSize)return U;if(null===U||void 0===U)return this.log.push(["null",""]),U;switch(this.input.type){case kU.Vector2:this.log.push([(0,EK.f)(U,4),U.toString()]);break;case kU.bU:this.log.push([(0,EK.j)(U,4),U.toString()]);break;case kU.ve:this.log.push([`{R: ${U.r.toFixed(4)} G: ${U.g.toFixed(4)} B: ${U.b.toFixed(4)} A: ${U.a.toFixed(4)}}`,U.toString()]);break;default:this.log.push([U.toString(),U.toString()])}return U};this.output.isConnected?this.output._storedFunction=U:this.output._storedValue=U(C)}serialize(){const C=super.serialize();return C.stackSize=this.stackSize,C}_deserialize(C){super._deserialize(C),this.stackSize=C.stackSize}}(0,l.d)([nU("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],uK.prototype,"stackSize",void 0),(0,e.h)("BABYLON.ParticleDebugBlock",uK);(0,e.h)("BABYLON.ParticleElbowBlock",class extends xU{constructor(C){super(C),this.registerInput("input",kU.AutoDetect),this.registerOutput("output",kU.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(C){super._build(C);const U=this._outputs[0],K=this._inputs[0];U._storedFunction=C=>K.getConnectedValue(C)}});(0,e.h)("BABYLON.ParticleTeleportInBlock",class extends xU{get endpoints(){return this._endpoints}constructor(C){super(C),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",kU.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(C){if(this.getClassName()===C)return!0;for(const U of this.endpoints)if(U.isAnAncestorOfType(C))return!0;return!1}isAnAncestorOf(C){for(const U of this.endpoints){if(U===C)return!0;if(U.isAnAncestorOf(C))return!0}return!1}attachToEndpoint(C){C.detach(),this._endpoints.push(C),C._entryPoint=this,C._outputs[0]._typeConnectionSource=this._inputs[0],C._tempEntryPointUniqueId=null,C.name="> "+this.name}detachFromEndpoint(C){const U=this._endpoints.indexOf(C);-1!==U&&(this._endpoints.splice(U,1),C._outputs[0]._typeConnectionSource=null,C._entryPoint=null)}_build(){for(const C of this._endpoints)C.output._storedFunction=C=>this.input.getConnectedValue(C)}});(0,e.h)("BABYLON.ParticleTeleportOutBlock",class extends xU{constructor(C){super(C),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",kU.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(C){this.entryPoint&&this.entryPoint.build(C)}clone(){const C=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(C),C}serialize(){var C;const U=super.serialize();return U.entryPoint=(null===(C=this.entryPoint)||void 0===C?void 0:C.uniqueId)??"",U}_deserialize(C){super._deserialize(C),this._tempEntryPointUniqueId=C.entryPoint}}),function(C){C[C.Equal=0]="Equal",C[C.NotEqual=1]="NotEqual",C[C.LessThan=2]="LessThan",C[C.GreaterThan=3]="GreaterThan",C[C.LessOrEqual=4]="LessOrEqual",C[C.GreaterOrEqual=5]="GreaterOrEqual",C[C.Xor=6]="Xor",C[C.Or=7]="Or",C[C.And=8]="And"}(pK||(pK={}));class bK extends xU{constructor(C){super(C),this.test=pK.Equal,this.epsilon=0,this.registerInput("left",kU.Float),this.registerInput("right",kU.Float,!0,0),this.registerInput("ifTrue",kU.AutoDetect,!0,1),this.registerInput("ifFalse",kU.AutoDetect,!0,0),this.registerOutput("output",kU.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=kU.Float,this._inputs[0].acceptedConnectionPointTypes.push(kU.Int),this._inputs[1].acceptedConnectionPointTypes.push(kU.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const C=C=>{const U=this.left.getConnectedValue(C),K=this.right.getConnectedValue(C);let m=!1;switch(this.test){case pK.Equal:m=(0,z.WithinEpsilon)(U,K,this.epsilon);break;case pK.NotEqual:m=!(0,z.WithinEpsilon)(U,K,this.epsilon);break;case pK.LessThan:m=U<K+this.epsilon;break;case pK.GreaterThan:m=U>K-this.epsilon;break;case pK.LessOrEqual:m=U<=K+this.epsilon;break;case pK.GreaterOrEqual:m=U>=K-this.epsilon;break;case pK.Xor:m=!!U&&!K||!U&&!!K;break;case pK.Or:m=!!U||!!K;break;case pK.And:m=!!U&&!!K}return m};this.output._storedFunction=U=>C(U)?this.ifTrue.getConnectedValue(U):this.ifFalse.getConnectedValue(U)}serialize(){const C=super.serialize();return C.test=this.test,C.epsilon=this.epsilon,C}_deserialize(C){super._deserialize(C),this.test=C.test,void 0!==C.epsilon&&(this.epsilon=C.epsilon)}}(0,l.d)([nU("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:pK.Equal},{label:"NotEqual",value:pK.NotEqual},{label:"LessThan",value:pK.LessThan},{label:"GreaterThan",value:pK.GreaterThan},{label:"LessOrEqual",value:pK.LessOrEqual},{label:"GreaterOrEqual",value:pK.GreaterOrEqual},{label:"Xor",value:pK.Xor},{label:"Or",value:pK.Or},{label:"And",value:pK.And}]})],bK.prototype,"test",void 0),(0,l.d)([nU("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],bK.prototype,"epsilon",void 0),(0,e.h)("BABYLON.ParticleConditionBlock",bK);class vK extends xU{constructor(C){super(C),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",kU.Particle),this.registerInput("condition",kU.Float,!0,0),this.registerInput("system",kU.System),this.registerOutput("output",kU.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(C){this._triggerCount=0;const U=this.input.getConnectedValue(C),K={process:K=>{if(C.particleContext=K,C.systemContext=U,0!==this.condition.getConnectedValue(C)&&(0===this.limit||this._triggerCount<this.limit)){const m=(new Date).getTime();if(this._previousOne&&m-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=m;const O=this.system.getConnectedValue(C);if(O){const m=sU(O,C.QU,K.position);m.RA.addOnce((()=>{this._triggerCount--})),U.RA.addOnce((()=>{m.dispose()}))}}},previousItem:null,nextItem:null};U._updateQueueStart?gC(K,U._updateQueueStart):U._updateQueueStart=K,this.output._storedValue=U}serialize(){const C=super.serialize();return C.limit=this.limit,C.delay=this.delay,C}_deserialize(C){super._deserialize(C),void 0!==C.limit&&(this.limit=C.limit),void 0!==C.delay&&(this.delay=C.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,l.d)([nU("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],vK.prototype,"limit",void 0),(0,l.d)([nU("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],vK.prototype,"delay",void 0),(0,e.h)("BABYLON.ParticleTriggerBlock",vK);K(13189),K(13203),K(13218),K(13282)},13259:(C,U,K)=>{"use strict";var m=K(11747);const O="clipPlaneFragment",X="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13222:(C,U,K)=>{"use strict";var m=K(11747);const O="clipPlaneFragmentDeclaration",X="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13297:(C,U,K)=>{"use strict";var m=K(11747);const O="clipPlaneVertex",X="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13287:(C,U,K)=>{"use strict";var m=K(11747);const O="clipPlaneVertexDeclaration",X="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13275:(C,U,K)=>{"use strict";var m=K(11747);const O="fogFragment",X="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13251:(C,U,K)=>{"use strict";var m=K(11747);const O="fogFragmentDeclaration",X="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13306:(C,U,K)=>{"use strict";var m=K(11747);const O="fogVertex",X="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13294:(C,U,K)=>{"use strict";var m=K(11747);const O="fogVertexDeclaration",X="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13236:(C,U,K)=>{"use strict";var m=K(11747);const O="helperFunctions",X="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13230:(C,U,K)=>{"use strict";var m=K(11747);const O="imageProcessingDeclaration",X="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13243:(C,U,K)=>{"use strict";var m=K(11747);const O="imageProcessingFunctions",X="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13233:(C,U,K)=>{"use strict";var m=K(11747);const O="logDepthDeclaration",X="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13267:(C,U,K)=>{"use strict";var m=K(11747);const O="logDepthFragment",X="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13309:(C,U,K)=>{"use strict";var m=K(11747);const O="logDepthVertex",X="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";m.d.IncludesShadersStoreWGSL[O]||(m.d.IncludesShadersStoreWGSL[O]=X)},13218:(C,U,K)=>{"use strict";K.r(U),K.d(U,{particlesPixelShaderWGSL:()=>A});var m=K(11747);K(13222),K(13230),K(13233),K(13236),K(13243),K(13251),K(13259),K(13267),K(13275);const O="particlesPixelShader",X="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";m.d.ShadersStoreWGSL[O]||(m.d.ShadersStoreWGSL[O]=X);const A={name:O,shader:X}},13282:(C,U,K)=>{"use strict";K.r(U),K.d(U,{particlesVertexShaderWGSL:()=>A});var m=K(11747);K(13287),K(13294),K(13233),K(13297),K(13306),K(13309);const O="particlesVertexShader",X="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";m.d.ShadersStoreWGSL[O]||(m.d.ShadersStoreWGSL[O]=X);const A={name:O,shader:X}},13128:(C,U,K)=>{"use strict";var m=K(11747);const O="clipPlaneFragment",X="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13198:(C,U,K)=>{"use strict";var m=K(11747);const O="clipPlaneFragmentDeclaration",X="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13142:(C,U,K)=>{"use strict";var m=K(11747);const O="clipPlaneVertex",X="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13212:(C,U,K)=>{"use strict";var m=K(11747);const O="clipPlaneVertexDeclaration",X="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13134:(C,U,K)=>{"use strict";var m=K(11747);const O="fogFragment",X="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13123:(C,U,K)=>{"use strict";var m=K(11747);const O="fogFragmentDeclaration",X="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13145:(C,U,K)=>{"use strict";var m=K(11747);const O="fogVertex",X="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13140:(C,U,K)=>{"use strict";var m=K(11747);const O="fogVertexDeclaration",X="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13116:(C,U,K)=>{"use strict";var m=K(11747);const O="helperFunctions",X="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13104:(C,U,K)=>{"use strict";var m=K(11747);const O="imageProcessingDeclaration",X="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13119:(C,U,K)=>{"use strict";var m=K(11747);const O="imageProcessingFunctions",X="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13113:(C,U,K)=>{"use strict";var m=K(11747);const O="logDepthDeclaration",X="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13131:(C,U,K)=>{"use strict";var m=K(11747);const O="logDepthFragment",X="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13153:(C,U,K)=>{"use strict";var m=K(11747);const O="logDepthVertex",X="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";m.d.IncludesShadersStore[O]||(m.d.IncludesShadersStore[O]=X)},13189:(C,U,K)=>{"use strict";K.r(U),K.d(U,{particlesPixelShader:()=>A});var m=K(11747);K(13198),K(13104),K(13113),K(13116),K(13119),K(13123),K(13128),K(13131),K(13134);const O="particlesPixelShader",X="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";m.d.ShadersStore[O]||(m.d.ShadersStore[O]=X);const A={name:O,shader:X}},13203:(C,U,K)=>{"use strict";K.r(U),K.d(U,{particlesVertexShader:()=>A});var m=K(11747);K(13212),K(13140),K(13113),K(13142),K(13145),K(13153);const O="particlesVertexShader",X="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";m.d.ShadersStore[O]||(m.d.ShadersStore[O]=X);const A={name:O,shader:X}},13567:(C,U,K)=>{"use strict";K.r(U),K.d(U,{FlowGraphGLTFDataProvider:()=>X});var m=K(13539),O=K(13514);class X extends m.e{constructor(C){var U,K;super();const m=C.glTF,X=(null===(U=m.animations)||void 0===U?void 0:U.map((C=>C._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",O.c,X);const A=(null===(K=m.nodes)||void 0===K?void 0:K.map((C=>C._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",O.c,A)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13454:(C,U,K)=>{"use strict";K.d(U,{e:()=>Q,h:()=>b,k:()=>u,m:()=>v});var m=K(11827),O=K(12321),X=K(11879),A=K(13461);const e=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class t{constructor(C,U){this._gltf=C,this._infoTree=U}convert(C){let U,K=this._gltf,m=this._infoTree;if(!C.startsWith("/"))throw new Error("Path must start with a /");const O=C.split("/");if(O.shift(),O[O.length-1].includes(".length")){const C=O[O.length-1].split(".");O.pop(),O.push(...C)}let X=!1;for(const t of O){const O="length"===t;if(O&&!m.__array__)throw new Error(`Path ${C} is invalid`);if(m.__ignoreObjectTree__&&(X=!0),m.__array__&&!O)m=m.__array__;else if(m=m[t],!m)throw new Error(`Path ${C} is invalid`);if(!X)if(void 0===K){if(!e.find((U=>U.regex.test(C))))throw new Error(`Path ${C} is invalid`)}else if(!O){var A;K=null===(A=K)||void 0===A?void 0:A[t]}(m.__target__||O)&&(U=K)}return{object:U,info:m}}}function z(C,U,K,m){const O=j(C,U);return m?O[K][m]:O[K]}function j(C,U,K){var m,X;return null===(m=C._data)||void 0===m||null===(X=m[(null===K||void 0===K?void 0:K.fillMode)??O.c.MATERIAL_TriangleFillMode])||void 0===X?void 0:X.babylonMaterial}function p(C,U){return{offset:{componentsCount:2,type:"Vector2",get:(K,O,X)=>{const A=z(K,X,C,U);return new m.Vector2(null===A||void 0===A?void 0:A.uOffset,null===A||void 0===A?void 0:A.vOffset)},getTarget:j,set:(K,m,O,X)=>{const A=z(m,X,C,U);A.uOffset=K.x,A.vOffset=K.y},getPropertyName:[()=>`${C}${U?"."+U:""}.uOffset`,()=>`${C}${U?"."+U:""}.vOffset`]},rotation:{type:"number",get:(K,m,O)=>{var X;return null===(X=z(K,O,C,U))||void 0===X?void 0:X.wAng},getTarget:j,set:(K,m,O,X)=>z(m,X,C,U).wAng=K,getPropertyName:[()=>`${C}${U?"."+U:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(K,O,X)=>{const A=z(K,X,C,U);return new m.Vector2(null===A||void 0===A?void 0:A.uScale,null===A||void 0===A?void 0:A.vScale)},getTarget:j,set:(K,m,O,X)=>{const A=z(m,X,C,U);A.uScale=K.x,A.vScale=K.y},getPropertyName:[()=>`${C}${U?"."+U:""}.uScale`,()=>`${C}${U?"."+U:""}.vScale`]}}}const E={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:C=>{var U,K;return new m.Vector2((null===(U=C._babylonCamera)||void 0===U?void 0:U.orthoLeft)??0,(null===(K=C._babylonCamera)||void 0===K?void 0:K.orthoRight)??0)},set:(C,U)=>{U._babylonCamera&&(U._babylonCamera.orthoLeft=C.x,U._babylonCamera.orthoRight=C.y)},getTarget:C=>C,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:C=>{var U,K;return new m.Vector2((null===(U=C._babylonCamera)||void 0===U?void 0:U.orthoBottom)??0,(null===(K=C._babylonCamera)||void 0===K?void 0:K.orthoTop)??0)},set:(C,U)=>{U._babylonCamera&&(U._babylonCamera.orthoBottom=C.x,U._babylonCamera.orthoTop=C.y)},getTarget:C=>C,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:C=>{var U;return null===(U=C._babylonCamera)||void 0===U?void 0:U.maxZ},set:(C,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=C)},getTarget:C=>C,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:C=>{var U;return null===(U=C._babylonCamera)||void 0===U?void 0:U.Ae},set:(C,U)=>{U._babylonCamera&&(U._babylonCamera.Ae=C)},getTarget:C=>C,getPropertyName:[()=>"Ae"]}},perspective:{aspectRatio:{type:"number",get:C=>{var U;return null===(U=C._babylonCamera)||void 0===U?void 0:U.getEngine().getAspectRatio(C._babylonCamera)},getTarget:C=>C,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:C=>{var U;return null===(U=C._babylonCamera)||void 0===U?void 0:U.fov},set:(C,U)=>{U._babylonCamera&&(U._babylonCamera.fov=C)},getTarget:C=>C,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:C=>{var U;return null===(U=C._babylonCamera)||void 0===U?void 0:U.maxZ},set:(C,U)=>{U._babylonCamera&&(U._babylonCamera.maxZ=C)},getTarget:C=>C,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:C=>{var U;return null===(U=C._babylonCamera)||void 0===U?void 0:U.Ae},set:(C,U)=>{U._babylonCamera&&(U._babylonCamera.Ae=C)},getTarget:C=>C,getPropertyName:[()=>"Ae"]}}}},nodes:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"bU",get:C=>{var U;return null===(U=C._babylonTransformNode)||void 0===U?void 0:U.position},set:(C,U)=>{var K;return null===(K=U._babylonTransformNode)||void 0===K?void 0:K.position.m(C)},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:C=>{var U;return null===(U=C._babylonTransformNode)||void 0===U?void 0:U.rotationQuaternion},set:(C,U)=>{var K,m;return null===(K=U._babylonTransformNode)||void 0===K||null===(m=K.rotationQuaternion)||void 0===m?void 0:m.m(C)},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"bU",get:C=>{var U;return null===(U=C._babylonTransformNode)||void 0===U?void 0:U.ue},set:(C,U)=>{var K;return null===(K=U._babylonTransformNode)||void 0===K?void 0:K.ue.m(C)},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"ue"]},weights:{length:{type:"number",get:C=>C._numMorphTargets,getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(C,U)=>{var K,m;return void 0!==U?null===(K=C._primitiveBabylonMeshes)||void 0===K||null===(m=K[0].morphTargetManager)||void 0===m?void 0:m.getTarget(U).influence:void 0},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(C,U)=>[0],getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:C=>{var U,K,O;return m.Matrix.Compose(null===(U=C._babylonTransformNode)||void 0===U?void 0:U.ue,null===(K=C._babylonTransformNode)||void 0===K?void 0:K.rotationQuaternion,null===(O=C._babylonTransformNode)||void 0===O?void 0:O.position)},getTarget:C=>C._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:C=>{var U,K,O,X;const A=m.Matrix.Identity();let e=C.parent;for(;e&&e.parent;)e=e.parent;const t=(null===(U=C._babylonTransformNode)||void 0===U?void 0:U.position._isDirty)||(null===(K=C._babylonTransformNode)||void 0===K||null===(O=K.rotationQuaternion)||void 0===O?void 0:O._isDirty)||(null===(X=C._babylonTransformNode)||void 0===X?void 0:X.ue._isDirty);if(e){var z;const U=null===(z=e._babylonTransformNode)||void 0===z?void 0:z.te(!0).invert();var j,p;if(U)null===(j=C._babylonTransformNode)||void 0===j||null===(p=j.te(t))||void 0===p||p.multiplyToRef(U,A)}else C._babylonTransformNode&&A.m(C._babylonTransformNode.te(t));return A},getTarget:C=>C._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:C=>{var U,K;return null===(U=C._babylonTransformNode)||void 0===U||null===(K=U.getChildren((C=>C instanceof A.b),!0)[0])||void 0===K?void 0:K.fe},getTarget:C=>{var U;return null===(U=C._babylonTransformNode)||void 0===U?void 0:U.getChildren((C=>C instanceof A.b),!0)[0]},set:(C,U)=>{if(U._babylonTransformNode){const K=U._babylonTransformNode.getChildren((C=>C instanceof A.b),!0)[0];K&&(K.fe=C)}}},color:{type:"fU",get:C=>{var U,K;return null===(U=C._babylonTransformNode)||void 0===U||null===(K=U.getChildren((C=>C instanceof A.b),!0)[0])||void 0===K?void 0:K.Fe},getTarget:C=>{var U;return null===(U=C._babylonTransformNode)||void 0===U?void 0:U.getChildren((C=>C instanceof A.b),!0)[0]},set:(C,U)=>{if(U._babylonTransformNode){const K=U._babylonTransformNode.getChildren((C=>C instanceof A.b),!0)[0];K&&(K.Fe=C)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"fU",get:(C,U,K)=>j(C,U,K).emissiveColor,set:(C,U,K,m)=>j(U,K,m).emissiveColor.m(C),getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:p("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(C,U,K)=>{var m;return null===(m=z(C,K,"bumpTexture"))||void 0===m?void 0:m.level},set:(C,U,K,m)=>{const O=z(U,m,"bumpTexture");O&&(O.level=C)},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:p("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(C,U,K)=>j(C,U,K).ambientTextureStrength,set:(C,U,K,m)=>{const O=j(U,K,m);O&&(O.ambientTextureStrength=C)},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:p("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ve",get:(C,U,K)=>{const m=j(C,U,K);return X.ve.FromColor3(m.albedoColor,m.alpha)},set:(C,U,K,m)=>{const O=j(U,K,m);O.albedoColor.set(C.r,C.g,C.b),O.alpha=C.a},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:p("albedoTexture")}},metallicFactor:{type:"number",get:(C,U,K)=>j(C,U,K).metallic,set:(C,U,K,m)=>{const O=j(U,K,m);O&&(O.metallic=C)},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(C,U,K)=>j(C,U,K).roughness,set:(C,U,K,m)=>{const O=j(U,K,m);O&&(O.roughness=C)},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:p("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(C,U,K)=>j(C,U,K).anisotropy.fe,set:(C,U,K,m)=>{j(U,K,m).anisotropy.fe=C},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(C,U,K)=>j(C,U,K).anisotropy.angle,set:(C,U,K,m)=>{j(U,K,m).anisotropy.angle=C},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:p("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(C,U,K)=>j(C,U,K).clearCoat.fe,set:(C,U,K,m)=>{j(U,K,m).clearCoat.fe=C},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(C,U,K)=>j(C,U,K).clearCoat.roughness,set:(C,U,K,m)=>{j(U,K,m).clearCoat.roughness=C},getTarget:(C,U,K)=>j(C,U,K),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:p("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(C,U,K)=>{var m;return null===(m=j(C,U,K).clearCoat.bumpTexture)||void 0===m?void 0:m.level},getTarget:j,set:(C,U,K,m)=>j(U,K,m).clearCoat.bumpTexture.level=C},extensions:{KHR_texture_transform:p("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:p("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(C,U,K)=>j(C,U,K).subSurface.dispersion,getTarget:j,set:(C,U,K,m)=>j(U,K,m).subSurface.dispersion=C}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(C,U,K)=>j(C,U,K).emissiveIntensity,getTarget:j,set:(C,U,K,m)=>j(U,K,m).emissiveIntensity=C}},KHR_materials_ior:{ior:{type:"number",get:(C,U,K)=>j(C,U,K).indexOfRefraction,getTarget:j,set:(C,U,K,m)=>j(U,K,m).indexOfRefraction=C}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(C,U,K)=>j(C,U,K).iridescence.fe,getTarget:j,set:(C,U,K,m)=>j(U,K,m).iridescence.fe=C},iridescenceIor:{type:"number",get:(C,U,K)=>j(C,U,K).iridescence.indexOfRefraction,getTarget:j,set:(C,U,K,m)=>j(U,K,m).iridescence.indexOfRefraction=C},iridescenceTexture:{extensions:{KHR_texture_transform:p("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(C,U,K)=>j(C,U,K).iridescence.maximumThickness,getTarget:j,set:(C,U,K,m)=>j(U,K,m).iridescence.maximumThickness=C},iridescenceThicknessMinimum:{type:"number",get:(C,U,K)=>j(C,U,K).iridescence.minimumThickness,getTarget:j,set:(C,U,K,m)=>j(U,K,m).iridescence.minimumThickness=C},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:p("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"fU",get:(C,U,K)=>j(C,U,K).sheen.color,getTarget:j,set:(C,U,K,m)=>j(U,K,m).sheen.color.m(C)},sheenColorTexture:{extensions:{KHR_texture_transform:p("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(C,U,K)=>j(C,U,K).sheen.fe,getTarget:j,set:(C,U,K,m)=>j(U,K,m).sheen.fe=C},sheenRoughnessTexture:{extensions:{KHR_texture_transform:p("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(C,U,K)=>j(C,U,K).metallicF0Factor,getTarget:j,set:(C,U,K,m)=>j(U,K,m).metallicF0Factor=C,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"fU",get:(C,U,K)=>j(C,U,K).metallicReflectanceColor,getTarget:j,set:(C,U,K,m)=>j(U,K,m).metallicReflectanceColor.m(C),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:p("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:p("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(C,U,K)=>j(C,U,K).subSurface.refractionIntensity,getTarget:j,set:(C,U,K,m)=>j(U,K,m).subSurface.refractionIntensity=C,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:p("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(C,U,K)=>j(C,U,K).subSurface.translucencyIntensity,getTarget:j,set:(C,U,K,m)=>j(U,K,m).subSurface.translucencyIntensity=C},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:p("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"fU",get:(C,U,K)=>j(C,U,K).subSurface.translucencyColor,getTarget:j,set:(C,U,K,m)=>{var O;return C&&(null===(O=j(U,K,m).subSurface.translucencyColor)||void 0===O?void 0:O.m(C))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:p("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"fU",get:(C,U,K)=>j(C,U,K).subSurface.tintColor,getTarget:j,set:(C,U,K,m)=>j(U,K,m).subSurface.tintColor.m(C)},attenuationDistance:{type:"number",get:(C,U,K)=>j(C,U,K).subSurface.tintColorAtDistance,getTarget:j,set:(C,U,K,m)=>j(U,K,m).subSurface.tintColorAtDistance=C},thicknessFactor:{type:"number",get:(C,U,K)=>j(C,U,K).subSurface.maximumThickness,getTarget:j,set:(C,U,K,m)=>j(U,K,m).subSurface.maximumThickness=C},thicknessTexture:{extensions:{KHR_texture_transform:p("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonLight)),getPropertyName:[C=>"length"]},__array__:{__target__:!0,color:{type:"fU",get:C=>{var U;return null===(U=C._babylonLight)||void 0===U?void 0:U.Fe},set:(C,U)=>{var K;return null===(K=U._babylonLight)||void 0===K?void 0:K.Fe.m(C)},getTarget:C=>C._babylonLight,getPropertyName:[C=>"diffuse"]},fe:{type:"number",get:C=>{var U;return null===(U=C._babylonLight)||void 0===U?void 0:U.fe},set:(C,U)=>U._babylonLight?U._babylonLight.fe=C:void 0,getTarget:C=>C._babylonLight,getPropertyName:[C=>"intensity"]},range:{type:"number",get:C=>{var U;return null===(U=C._babylonLight)||void 0===U?void 0:U.range},set:(C,U)=>U._babylonLight?U._babylonLight.range=C:void 0,getTarget:C=>C._babylonLight,getPropertyName:[C=>"range"]},spot:{innerConeAngle:{type:"number",get:C=>{var U;return null===(U=C._babylonLight)||void 0===U?void 0:U.innerAngle},set:(C,U)=>U._babylonLight?U._babylonLight.innerAngle=C:void 0,getTarget:C=>C._babylonLight,getPropertyName:[C=>"innerConeAngle"]},outerConeAngle:{type:"number",get:C=>{var U;return null===(U=C._babylonLight)||void 0===U?void 0:U.angle},set:(C,U)=>U._babylonLight?U._babylonLight.angle=C:void 0,getTarget:C=>C._babylonLight,getPropertyName:[C=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonLight)),getPropertyName:[C=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonTexture)),getPropertyName:[C=>"length"]},__array__:{__target__:!0,fe:{type:"number",get:C=>{var U;return null===(U=C._babylonTexture)||void 0===U?void 0:U.level},set:(C,U)=>{U._babylonTexture&&(U._babylonTexture.level=C)},getTarget:C=>C._babylonTexture},rotation:{type:"Quaternion",get:C=>{var U;return C._babylonTexture&&m.Quaternion.FromRotationMatrix(null===(U=C._babylonTexture)||void 0===U?void 0:U.getReflectionTextureMatrix())},set:(C,U)=>{var K;U._babylonTexture&&(null!==(K=U._babylonTexture.dC())&&void 0!==K&&K.useRightHandedSystem||(C=m.Quaternion.Inverse(C)),m.Matrix.FromQuaternionToRef(C,U._babylonTexture.getReflectionTextureMatrix()))},getTarget:C=>C._babylonTexture}}}}},animations:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>C._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:C=>C.length,getTarget:C=>C.map((C=>{var U;return null===(U=C.primitives[0]._instanceData)||void 0===U?void 0:U.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function u(C){return new t(C,E)}function b(C){const U=C.split("/").map((C=>C.replace(/{}/g,"__array__")));let K=E;for(const m of U)m&&(K=K[m]);if(K&&K.type&&K.get)return K}function v(C,U){const K=C.split("/").map((C=>C.replace(/{}/g,"__array__")));let m=E;for(const O of K)O&&(m=m[O]);m&&m.type&&m.get&&(m.interpolation=U)}function Q(C,U){const K=C.split("/").map((C=>C.replace(/{}/g,"__array__")));let m=E;for(const O of K)if(O){if(!m[O]){if("?"===O){m.__ignoreObjectTree__=!0;continue}m[O]={},"__array__"===O&&(m[O].__target__=!0)}m=m[O]}Object.assign(m,U)}},13468:(C,U,K)=>{"use strict";K.r(U),K.d(U,{AnimationPropertyInfo:()=>z,TransformNodeAnimationPropertyInfo:()=>j,WeightAnimationPropertyInfo:()=>p,getQuaternion:()=>e,getVector3:()=>A,getWeights:()=>t});var m=K(12357),O=K(11827),X=K(13454);function A(C,U,K,m){return O.bU.FU(U,K).scaleInPlace(m)}function e(C,U,K,m){return O.Quaternion.FU(U,K).scaleInPlace(m)}function t(C,U,K,m){const O=new Array(C._numMorphTargets);for(let X=0;X<O.length;X++)O[X]=U[K++]*m;return O}class z{constructor(C,U,K,m){this.type=C,this.name=U,this.getValue=K,this.getStride=m}_buildAnimation(C,U,K){const O=new m.c(C,this.name,U,this.type);return O.setKeys(K),O}}class j extends z{buildAnimations(C,U,K,m){const O=[];return O.push({babylonAnimatable:C._babylonTransformNode,babylonAnimation:this._buildAnimation(U,K,m)}),O}}class p extends z{buildAnimations(C,U,K,O){const X=[];if(C._numMorphTargets)for(let A=0;A<C._numMorphTargets;A++){const e=new m.c(`${U}_${A}`,this.name,K,this.type);if(e.setKeys(O.map((C=>({frame:C.frame,inTangent:C.inTangent?C.inTangent[A]:void 0,value:C.value[A],outTangent:C.outTangent?C.outTangent[A]:void 0,interpolation:C.interpolation})))),C._primitiveBabylonMeshes)for(const U of C._primitiveBabylonMeshes)if(U.morphTargetManager){const C=U.morphTargetManager.getTarget(A),K=e.clone();C.animations.push(K),X.push({babylonAnimatable:C,babylonAnimation:K})}}return X}}(0,X.m)("/nodes/{}/translation",[new j(m.c.ANIMATIONTYPE_VECTOR3,"position",A,(()=>3))]),(0,X.m)("/nodes/{}/rotation",[new j(m.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",e,(()=>4))]),(0,X.m)("/nodes/{}/scale",[new j(m.c.ANIMATIONTYPE_VECTOR3,"ue",A,(()=>3))]),(0,X.m)("/nodes/{}/weights",[new p(m.c.ANIMATIONTYPE_FLOAT,"influence",t,(C=>C._numMorphTargets))])},13422:(C,U,K)=>{"use strict";class m{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((C,U)=>{this._resolve=C,this._reject=U}))}}var O=K(11827),X=K(11879),A=K(11660),e=K(12292),t=K(13431),z=K(13443),j=K(11663),p=K(12318),E=K(12357),u=K(12359),b=K(11703),v=K(11679),Q=K(11685);class V{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(C){this._useTextureToStoreBoneMatrices=C,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(C){this._animationPropertiesOverride=C}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(C,U,K){this.name=C,this.id=U,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=O.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new j.b,this.bones=[],this._scene=K||b.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const m=this._scene.getEngine().getCaps();this._canUseTextureForBones=m.textureFloat&&m.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((C=>!C.getParent()))}getTransformMatrices(C){if(this.needInitialSkinMatrix){if(!C)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return C._bonesTransformMatrices||this.prepare(!0),C._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(C){return this.needInitialSkinMatrix&&C._transformMatrixTexture?C._transformMatrixTexture:this._transformMatrixTexture}dC(){return this._scene}toString(C){let U=`Name: ${this.name}, nBones: ${this.bones.length}`;if(U+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,C){U+=", Ranges: {";let C=!0;for(const K in this._ranges)C&&(U+=", ",C=!1),U+=K;U+="}"}return U}getBoneIndexByName(C){for(let U=0,K=this.bones.length;U<K;U++)if(this.bones[U].name===C)return U;return-1}createAnimationRange(C,U,K){if(!this._ranges[C]){this._ranges[C]=new u.b(C,U,K);for(let m=0,O=this.bones.length;m<O;m++)this.bones[m].animations[0]&&this.bones[m].animations[0].createRange(C,U,K)}}deleteAnimationRange(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let K=0,m=this.bones.length;K<m;K++)this.bones[K].animations[0]&&this.bones[K].animations[0].deleteRange(C,U);this._ranges[C]=null}getAnimationRange(C){return this._ranges[C]||null}getAnimationRanges(){const C=[];let U;for(U in this._ranges)C.push(this._ranges[U]);return C}copyAnimationRange(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[U]||!C.getAnimationRange(U))return!1;let m=!0;const O=this._getHighestAnimationFrame()+1,X={},A=C.bones;let e,t;for(t=0,e=A.length;t<e;t++)X[A[t].name]=A[t];this.bones.length!==A.length&&(v.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${A.length}`),m=!1);const z=K&&this.dimensionsAtRest&&C.dimensionsAtRest?this.dimensionsAtRest.divide(C.dimensionsAtRest):null;for(t=0,e=this.bones.length;t<e;t++){const C=this.bones[t].name,A=X[C];A?m=m&&this.bones[t].copyAnimationRange(A,U,O,K,z):(v.d.Warn("copyAnimationRange: not same rig, missing source bone "+C),m=!1)}const j=C.getAnimationRange(U);return j&&(this._ranges[U]=new u.b(U,j.from+O,j.to+O)),m}returnToRest(){for(const C of this.bones)-1!==C._index&&C.returnToRest()}_getHighestAnimationFrame(){let C=0;for(let U=0,K=this.bones.length;U<K;U++)if(this.bones[U].animations[0]){const K=this.bones[U].animations[0].getHighestFrame();C<K&&(C=K)}return C}beginAnimation(C,U,K,m){const O=this.getAnimationRange(C);return O?this._scene.beginAnimation(this,O.from,O.to,U,K,m):null}static MakeAnimationAdditive(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;const m=C.getAnimationRange(K);if(!m)return null;const O=C._scene.getAllAnimatablesByTarget(C);let X=null;for(let e=0;e<O.length;e++){const C=O[e];if(C.fromFrame===(null===m||void 0===m?void 0:m.from)&&C.toFrame===(null===m||void 0===m?void 0:m.to)){X=C;break}}const A=C.getAnimatables();for(let e=0;e<A.length;e++){const C=A[e].animations;if(C)for(let m=0;m<C.length;m++)E.c.MakeAnimationAdditive(C[m],U,K)}return X&&(X.isAdditive=!0),C}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(C){this._meshesWithPoseMatrix.push(C)}_unregisterMeshWithPoseMatrix(C){const U=this._meshesWithPoseMatrix.indexOf(C);U>-1&&this._meshesWithPoseMatrix.splice(U,1)}_computeTransformMatrices(C,U){this.onBeforeComputeObservable.notifyObservers(this);for(let K=0;K<this.bones.length;K++){const m=this.bones[K];m._childUpdateId++;const O=m.getParent();if(O?m.getLocalMatrix().multiplyToRef(O.getFinalMatrix(),m.getFinalMatrix()):U?m.getLocalMatrix().multiplyToRef(U,m.getFinalMatrix()):m.getFinalMatrix().m(m.getLocalMatrix()),-1!==m._index){const U=null===m._index?K:m._index;m.getAbsoluteInverseBindMatrix().multiplyToArray(m.getFinalMatrix(),C,16*U)}}this._identity.copyToArray(C,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const C=this.dC().getRenderId();if(this._currentRenderId===C)return;this._currentRenderId=C}if(this._numBonesWithLinkedTransformNode>0)for(const C of this.bones)if(C._linkedTransformNode){const U=C._linkedTransformNode;C.position=U.position,U.rotationQuaternion?C.rotationQuaternion=U.rotationQuaternion:C.rotation=U.rotation,C.ue=U.ue}if(this.needInitialSkinMatrix)for(const C of this._meshesWithPoseMatrix){const U=C.getPoseMatrix();let K=this._isDirty;if(C._bonesTransformMatrices&&C._bonesTransformMatrices.length===16*(this.bones.length+1)||(C._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),K=!0),K){if(this._synchronizedWithMesh!==C){this._synchronizedWithMesh=C;for(const C of this.bones)if(!C.getParent()){C.getBindMatrix().multiplyToRef(U,O.TmpVectors.Matrix[1]),C._updateAbsoluteBindMatrices(O.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const U=4*(this.bones.length+1);C._transformMatrixTexture&&C._transformMatrixTexture.getSize().width===U||(C._transformMatrixTexture&&C._transformMatrixTexture.dispose(),C._transformMatrixTexture=p.d.CreateRGBATexture(C._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(C._bonesTransformMatrices,U),this.isUsingTextureForMatrices&&C._transformMatrixTexture&&C._transformMatrixTexture.update(C._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=p.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let C=0;C<this.bones.length;C++)this._animatables.push(this.bones[C])}return this._animatables}clone(C,U){const K=new V(C,U||C,this._scene);K.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let m=0;m<this.bones.length;m++){const C=this.bones[m];let U=null;const O=C.getParent();if(O){const C=this.bones.indexOf(O);U=K.bones[C]}const X=new z.c(C.name,K,U,C.getBindMatrix().clone(),C.getRestMatrix().clone());X._index=C._index,C._linkedTransformNode&&X.linkTransformNode(C._linkedTransformNode),Q.b.DeepCopy(C.animations,X.animations)}if(this._ranges){K._ranges={};for(const C in this._ranges){const U=this._ranges[C];U&&(K._ranges[C]=U.clone())}}return this._isDirty=!0,K.prepare(!0),K}enableBlending(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const U of this.bones)for(const K of U.animations)K.enableBlending=!0,K.blendingSpeed=C}dispose(){if(this._meshesWithPoseMatrix.length=0,this.dC().stopAnimation(this),this.dC().removeSkeleton(this),this._parentContainer){const C=this._parentContainer.skeletons.indexOf(this);C>-1&&this._parentContainer.skeletons.splice(C,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const C={};C.name=this.name,C.id=this.id,this.dimensionsAtRest&&(C.dimensionsAtRest=this.dimensionsAtRest.Oe()),C.bones=[],C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let K=0;K<this.bones.length;K++){var U;const m=this.bones[K],O=m.getParent(),X={parentBoneIndex:O?this.bones.indexOf(O):-1,index:m.getIndex(),name:m.name,id:m.id,matrix:m.getBindMatrix().Oe(),rest:m.getRestMatrix().Oe(),linkedTransformNodeId:null===(U=m.getTransformNode())||void 0===U?void 0:U.id};C.bones.push(X),m.length&&(X.length=m.length),m.metadata&&(X.metadata=m.metadata),m.animations&&m.animations.length>0&&(X.animation=m.animations[0].serialize()),C.ranges=[];for(const U in this._ranges){const K=this._ranges[U];if(!K)continue;const m={};m.name=U,m.from=K.from,m.to=K.to,C.ranges.push(m)}}return C}static Parse(C,U){const K=new V(C.name,C.id,U);let m;for(C.dimensionsAtRest&&(K.dimensionsAtRest=O.bU.FU(C.dimensionsAtRest)),K.needInitialSkinMatrix=C.needInitialSkinMatrix,m=0;m<C.bones.length;m++){const U=C.bones[m],X=C.bones[m].index;let A=null;U.parentBoneIndex>-1&&(A=K.bones[U.parentBoneIndex]);const e=U.rest?O.Matrix.FU(U.rest):null,t=new z.c(U.name,K,A,O.Matrix.FU(U.matrix),e,null,X);void 0!==U.id&&null!==U.id&&(t.id=U.id),U.length&&(t.length=U.length),U.metadata&&(t.metadata=U.metadata),U.animation&&t.animations.push(E.c.Parse(U.animation)),void 0!==U.linkedTransformNodeId&&null!==U.linkedTransformNodeId&&(K._hasWaitingData=!0,t._waitingTransformNodeId=U.linkedTransformNodeId)}if(C.ranges)for(m=0;m<C.ranges.length;m++){const U=C.ranges[m];K.createAnimationRange(U.name,U.from,U.to)}return K}computeAbsoluteMatrices(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||C)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(C)}getPoseMatrix(){let C=null;return this._meshesWithPoseMatrix.length>0&&(C=this._meshesWithPoseMatrix[0].getPoseMatrix()),C}sortBones(){const C=[],U=new Array(this.bones.length);for(let K=0;K<this.bones.length;K++)this._sortBones(K,C,U);this.bones=C}_sortBones(C,U,K){if(K[C])return;K[C]=!0;const m=this.bones[C];if(!m)return;void 0===m._index&&(m._index=C);const O=m.getParent();O&&this._sortBones(this.bones.indexOf(O),U,K),U.push(m)}setCurrentPoseAsRest(){for(const C of this.bones)C.setCurrentPoseAsRest()}}var f=K(12158),F=K(12328),Z=K(11808),P=K(12249),H=K(11905),d=K(12296),T=K(12262),y=K(12285),a=K(12364),r=K(11930),i=K(13388);class D{set areUpdatesFrozen(C){C?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new r.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,C||(C=b.c.LastCreatedScene),this._scene=C,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const C=this._scene.getEngine().getCaps();this._canUseTextureForTargets=C.canUseGLVertexID&&C.textureFloat&&C.maxVertexTextureImageUnits>0&&C.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return D.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?D.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(C){this._numMaxInfluencers!==C&&(this._numMaxInfluencers=C,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(C){this._useTextureToStoreTargets!==C&&(this._useTextureToStoreTargets=C,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var C;return D.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(C=this._scene)&&void 0!==C&&C.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(C){return this._activeTargets.data[C]}getTarget(C){return this._targets[C]}getTargetByName(C){for(const U of this._targets)if(U.name===C)return U;return null}addTarget(C){this._targets.push(C),this._targetInfluenceChangedObservers.push(C.onInfluenceChanged.add((C=>{this.areUpdatesFrozen&&C&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(C)}))),this._targetDataLayoutChangedObservers.push(C._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(C){const U=this._targets.indexOf(C);U>=0&&(this._targets.splice(U,1),C.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(U,1)[0]),C._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(U,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(C)}_bind(C){C.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),C.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),C.setTexture("morphTargets",this._targetStoreTexture),C.setInt("morphTargetCount",this.numInfluencers)}clone(){const C=new D(this._scene);for(const U of this._targets)C.addTarget(U.clone());return C.enablePositionMorphing=this.enablePositionMorphing,C.enableNormalMorphing=this.enableNormalMorphing,C.enableTangentMorphing=this.enableTangentMorphing,C.enableUVMorphing=this.enableUVMorphing,C.enableUV2Morphing=this.enableUV2Morphing,C.enableColorMorphing=this.enableColorMorphing,C}serialize(){const C={};C.id=this.uniqueId,C.targets=[];for(const U of this._targets)C.targets.push(U.serialize());return C}_syncActiveTargets(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const U=!!this._targetStoreTexture,K=this.isUsingTextureForTargets;(this._mustSynchronize||U!==K)&&(this._mustSynchronize=!1,this.synchronize());let m=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let O=-1;for(const X of this._targets)if(O++,0!==X.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=D.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(X),this._morphTargetTextureIndices[m]=O,this._tempInfluences[m++]=X.influence}this._morphTargetTextureIndices.length!==m&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,m)),this._influences&&this._influences.length===m||(this._influences=new Float32Array(m));for(let X=0;X<m;X++)this._influences[X]=this._tempInfluences[X];if(C&&this._scene)for(const X of this._scene.meshes)X.morphTargetManager===this&&(K?X._markSubMeshesAsAttributesDirty():X._syncGeometryWithMorphTargetManager())}synchronize(){var C;if(!this._scene||this.areUpdatesFrozen)return;const U=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(C=this._targetStoreTexture)||void 0===C||C.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>U.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const K of this._targets){this._supportsPositions=this._supportsPositions&&K.hasPositions,this._supportsNormals=this._supportsNormals&&K.hasNormals,this._supportsTangents=this._supportsTangents&&K.hasTangents,this._supportsUVs=this._supportsUVs&&K.hasUVs,this._supportsUV2s=this._supportsUV2s&&K.hasUV2s,this._supportsColors=this._supportsColors&&K.hasColors;const C=K.vertexCount;if(0===this._vertexCount)this._vertexCount=C;else if(this._vertexCount!==C)return void v.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${K.name}": ${C}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const C=U.getCaps().maxTextureSize;this._textureWidth>C&&(this._textureHeight=Math.ceil(this._textureWidth/C),this._textureWidth=C);const K=this._targets.length,m=new Float32Array(K*this._textureWidth*this._textureHeight*4);let O=0;for(let U=0;U<K;U++){const C=this._targets[U],K=C.getPositions(),X=C.getNormals(),A=C.getUVs(),e=C.getTangents(),t=C.getUV2s(),z=C.getColors();O=U*this._textureWidth*this._textureHeight*4;for(let U=0;U<this._vertexCount;U++)this._supportsPositions&&K&&(m[O]=K[3*U],m[O+1]=K[3*U+1],m[O+2]=K[3*U+2],O+=4),this._supportsNormals&&X&&(m[O]=X[3*U],m[O+1]=X[3*U+1],m[O+2]=X[3*U+2],O+=4),this._supportsUVs&&A&&(m[O]=A[2*U],m[O+1]=A[2*U+1],O+=4),this._supportsTangents&&e&&(m[O]=e[3*U],m[O+1]=e[3*U+1],m[O+2]=e[3*U+2],O+=4),this._supportsUV2s&&t&&(m[O]=t[2*U],m[O+1]=t[2*U+1],O+=4),this._supportsColors&&z&&(m[O]=z[4*U],m[O+1]=z[4*U+1],m[O+2]=z[4*U+2],m[O+3]=z[4*U+3],O+=4)}this._targetStoreTexture=i.c.CreateRGBATexture(m,this._textureWidth,this._textureHeight,K,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const K of this._scene.meshes)K.morphTargetManager===this&&K._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const C=this._parentContainer.morphTargetManagers.indexOf(this);C>-1&&this._parentContainer.morphTargetManagers.splice(C,1),this._parentContainer=null}for(const C of this._targets)this._scene.stopAnimation(C)}}static Parse(C,U){const K=new D(U);for(const m of C.targets)K.addTarget(a.d.Parse(m,U));return K}}D.EnableTextureStorage=!0,D.MaxActiveMorphTargetsInVertexAttributeMode=8,D.ConstantTargetCountForTextureMode=0;var l=K(13448),G=K(11709),J=K(12178);const o=new Map,B=o;function k(C,U,K){w(C)&&v.d.Warn(`Extension with the name '${C}' already exists`),o.set(C,{isGLTFExtension:U,factory:K})}function w(C){return o.delete(C)}var h=K(13454),c=K(12415),N=K(11918);class g{static Get(C,U,K){if(!U||void 0==K||!U[K])throw new Error(`${C}: Failed to find index (${K})`);return U[K]}static TryGet(C,U){return C&&void 0!=U&&C[U]?C[U]:null}static Assign(C){if(C)for(let U=0;U<C.length;U++)C[U].index=U}}function M(C){if(C.min&&C.max){const U=C.min,K=C.max,m=O.TmpVectors.bU[0].Ee(U[0],U[1],U[2]),X=O.TmpVectors.bU[1].Ee(K[0],K[1],K[2]);if(C.normalized&&5126!==C.componentType){let U=1;switch(C.componentType){case 5120:U=127;break;case 5121:U=255;break;case 5122:U=32767;break;case 5123:U=65535}const K=1/U;m.scaleInPlace(K),X.scaleInPlace(K)}return new J.d(m,X)}return null}class L{static RegisterExtension(C,U){k(C,!1,U)}static UnregisterExtension(C){return w(C)}get Ce(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(C){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=C}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((C=>C.dispose&&C.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(C,U,K,m,O,X){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=U,this._assetContainer=K,this._loadData(m);let X=null;if(C){const U={};if(this._gltf.nodes)for(const C of this._gltf.nodes)C.name&&(U[C.name]=C.index);X=(C instanceof Array?C:[C]).map((C=>{const K=U[C];if(void 0===K)throw new Error(`Failed to find node '${C}'`);return K}))}return await this._loadAsync(O,A,X,(()=>({meshes:this._getMeshes(),AE:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=C,this._loadData(U),await this._loadAsync(K,O,null,(()=>{}))}async _loadAsync(C,U,K,m){return await Promise.resolve().then((async()=>{this._rootUrl=C,this._uniqueRootUrl=!C.startsWith("file:")&&U?C:`${C}${Date.now()}/`,this._fileName=U,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const O=`${l.l[l.l.LOADING]} => ${l.l[l.l.READY]}`,X=`${l.l[l.l.LOADING]} => ${l.l[l.l.COMPLETE]}`;this._parent._startPerformanceCounter(O),this._parent._startPerformanceCounter(X),this._parent._setState(l.l.LOADING),this._extensionsOnLoading();const e=new Array;if(!this.parent.loadOnlyMaterials)if(K)e.push(this.loadSceneAsync("/nodes",{nodes:K,index:-1}));else if(void 0!=this._gltf.QU||this._gltf.scenes&&this._gltf.scenes[0]){const C=g.Get("/scene",this._gltf.scenes,this._gltf.QU||0);e.push(this.loadSceneAsync(`/scenes/${C.index}`,C))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let C=0;C<this._gltf.materials.length;++C){const U=this._gltf.materials[C],K="/materials/"+C,m=f.e.TriangleFillMode;e.push(this._loadMaterialAsync(K,U,null,m,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&e.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&e.push(this._compileShadowGeneratorsAsync());const t=Promise.all(e).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Me(!0);for(const C of this._babylonScene.materials){const U=C;void 0!==U.maxSimultaneousLights&&(U.maxSimultaneousLights=Math.max(U.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(l.l.READY),this._skipStartAnimationStep||this._startAnimations(),m()}));return await t.then((C=>(this._parent._endPerformanceCounter(O),A.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(X),this._parent._setState(l.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(C=>{this._parent.onErrorObservable.notifyObservers(C),this._parent.onErrorObservable.clear(),this.dispose()}))})),C)))})).catch((C=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(C),this._parent.onErrorObservable.clear(),this.dispose()),C}))}_loadData(C){if(this._gltf=C.json,this._setupData(),C.bin){const U=this._gltf.buffers;if(U&&U[0]&&!U[0].uri){const K=U[0];(K.byteLength<C.bin.byteLength-3||K.byteLength>C.bin.byteLength)&&v.d.Warn(`Binary buffer length (${K.byteLength}) from JSON does not match chunk length (${C.bin.byteLength})`),this._bin=C.bin}else v.d.Warn("Unexpected BIN chunk")}}_setupData(){if(g.Assign(this._gltf.accessors),g.Assign(this._gltf.animations),g.Assign(this._gltf.buffers),g.Assign(this._gltf.bufferViews),g.Assign(this._gltf.cameras),g.Assign(this._gltf.images),g.Assign(this._gltf.materials),g.Assign(this._gltf.meshes),g.Assign(this._gltf.nodes),g.Assign(this._gltf.samplers),g.Assign(this._gltf.scenes),g.Assign(this._gltf.skins),g.Assign(this._gltf.textures),this._gltf.nodes){const C={};for(const K of this._gltf.nodes)if(K.children)for(const U of K.children)C[U]=K.index;const U=this._createRootNode();for(const K of this._gltf.nodes){const m=C[K.index];K.parent=void 0===m?U:this._gltf.nodes[m]}}}async _loadExtensionsAsync(){const C=[];if(B.forEach(((U,K)=>{var m;!1===(null===(m=this.parent.extensionOptions[K])||void 0===m?void 0:m.enabled)?U.isGLTFExtension&&this.isExtensionUsed(K)&&v.d.Warn(`Extension ${K} is used but has been explicitly disabled.`):U.isGLTFExtension&&!this.isExtensionUsed(K)||C.push((async()=>{const C=await U.factory(this);return C.name!==K&&v.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${C.name} !== ${K}`),this._parent.onExtensionLoadedObservable.notifyObservers(C),C})())})),this._extensions.push(...await Promise.all(C)),this._extensions.sort(((C,U)=>(C.order||Number.MAX_VALUE)-(U.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const K of this._gltf.extensionsRequired){if(!this._extensions.some((C=>C.name===K&&C.enabled))){var U;if(!1===(null===(U=this.parent.extensionOptions[K])||void 0===U?void 0:U.enabled))throw new Error(`Required extension ${K} is disabled`);throw new Error(`Required extension ${K} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new y.b("__root__",this._babylonScene);this._rootBabylonMesh=C,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Me(!1);const U={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case l.i.AUTO:this._babylonScene.useRightHandedSystem||(U.rotation=[0,1,0,0],U.scale=[1,1,-1],L._LoadTransform(U,this._rootBabylonMesh));break;case l.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(C),U}loadSceneAsync(C,U){const K=this._extensionsLoadSceneAsync(C,U);if(K)return K;const m=new Array;if(this.logOpen(`${C} ${U.name||""}`),U.nodes)for(const O of U.nodes){const U=g.Get(`${C}/nodes/${O}`,this._gltf.nodes,O);m.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(C=>{C.parent=this._rootBabylonMesh})))}for(const O of this._postSceneLoadActions)O();return m.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(m).then((()=>{}))}_forEachPrimitive(C,U){if(C._primitiveBabylonMeshes)for(const K of C._primitiveBabylonMeshes)U(K)}_getGeometries(){const C=[],U=this._gltf.nodes;if(U)for(const K of U)this._forEachPrimitive(K,(U=>{const K=U.ze;K&&-1===C.indexOf(K)&&C.push(K)}));return C}_getMeshes(){const C=[];this._rootBabylonMesh instanceof T.d&&C.push(this._rootBabylonMesh);const U=this._gltf.nodes;if(U)for(const K of U)this._forEachPrimitive(K,(U=>{C.push(U)}));return C}_getTransformNodes(){const C=[],U=this._gltf.nodes;if(U)for(const K of U)K._babylonTransformNode&&"ae"===K._babylonTransformNode.getClassName()&&C.push(K._babylonTransformNode),K._babylonTransformNodeForSkin&&C.push(K._babylonTransformNodeForSkin);return C}_getSkeletons(){const C=[],U=this._gltf.skins;if(U)for(const K of U)K._data&&C.push(K._data.babylonSkeleton);return C}_getAnimationGroups(){const C=[],U=this._gltf.animations;if(U)for(const K of U)K._babylonAnimationGroup&&C.push(K._babylonAnimationGroup);return C}_startAnimations(){switch(this._parent.animationStartMode){case l.g.NONE:break;case l.g.FIRST:{const C=this._getAnimationGroups();0!==C.length&&C[0].start(!0);break}case l.g.ALL:{const C=this._getAnimationGroups();for(const U of C)U.start(!0);break}default:return void v.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const m=this._extensionsLoadNodeAsync(C,U,K);if(m)return m;if(U._babylonTransformNode)throw new Error(`${C}: Invalid recursive node hierarchy`);const O=new Array;this.logOpen(`${C} ${U.name||""}`);const X=m=>{if(L.AddPointerMetadata(m,C),L._LoadTransform(U,m),void 0!=U.camera){const K=g.Get(`${C}/camera`,this._gltf.cameras,U.camera);O.push(this.loadCameraAsync(`/cameras/${K.index}`,K,(C=>{C.parent=m,this._babylonScene.useRightHandedSystem||(m.ue.x=-1)})))}if(U.children)for(const K of U.children){const U=g.Get(`${C}/children/${K}`,this._gltf.nodes,K);O.push(this.loadNodeAsync(`/nodes/${U.index}`,U,(C=>{C.parent=m})))}K(m)},A=void 0!=U.mesh,e=this._parent.loadSkins&&void 0!=U.skin;if(!A||e){const C=U.name||`node${U.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new P.b(C,this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==U.mesh?U._babylonTransformNode=K:U._babylonTransformNodeForSkin=K,X(K)}if(A)if(e){const K=g.Get(`${C}/mesh`,this._gltf.meshes,U.mesh);O.push(this._loadMeshAsync(`/meshes/${K.index}`,U,K,(K=>{const m=U._babylonTransformNodeForSkin;K.metadata=(0,c.b)(m.metadata,K.metadata||{});const X=g.Get(`${C}/skin`,this._gltf.skins,U.skin);O.push(this._loadSkinAsync(`/skins/${X.index}`,U,X,(C=>{this._forEachPrimitive(U,(U=>{U.skeleton=C})),this._postSceneLoadActions.push((()=>{if(void 0!=X.skeleton){const C=g.Get(`/skins/${X.index}/skeleton`,this._gltf.nodes,X.skeleton).parent;U.index===C.index?K.parent=m.parent:K.parent=C._babylonTransformNode}else K.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:m,skinnedNode:K})}))})))})))}else{const K=g.Get(`${C}/mesh`,this._gltf.meshes,U.mesh);O.push(this._loadMeshAsync(`/meshes/${K.index}`,U,K,X))}return this.logClose(),Promise.all(O).then((()=>(this._forEachPrimitive(U,(C=>{const U=C;!U.isAnInstance&&U.ze&&U.ze.useBoundingInfoFromGeometry?C.JC():C.refreshBoundingInfo(!0,!0)})),U._babylonTransformNode)))}_loadMeshAsync(C,U,K,m){const O=K.primitives;if(!O||!O.length)throw new Error(`${C}: Primitives are missing`);void 0==O[0].index&&g.Assign(O);const X=new Array;this.logOpen(`${C} ${K.name||""}`);const A=U.name||`node${U.index}`;if(1===O.length){const m=K.primitives[0];X.push(this._loadMeshPrimitiveAsync(`${C}/primitives/${m.index}`,A,U,K,m,(C=>{U._babylonTransformNode=C,U._primitiveBabylonMeshes=[C]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,U._babylonTransformNode=new P.b(A,this._babylonScene),U._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._primitiveBabylonMeshes=[];for(const m of O)X.push(this._loadMeshPrimitiveAsync(`${C}/primitives/${m.index}`,`${A}_primitive${m.index}`,U,K,m,(C=>{C.parent=U._babylonTransformNode,U._primitiveBabylonMeshes.push(C)})))}return m(U._babylonTransformNode),this.logClose(),Promise.all(X).then((()=>U._babylonTransformNode))}_loadMeshPrimitiveAsync(C,U,K,m,O,X){const A=this._extensionsLoadMeshPrimitiveAsync(C,U,K,m,O,X);if(A)return A;this.logOpen(`${C}`);const e=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==K.skin&&!m.primitives[0].targets;let t,z;if(e&&O._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,t=O._instanceData.babylonSourceMesh.createInstance(U),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z=O._instanceData.promise;else{const X=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new y.b(U,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.sideOrientation=this._babylonScene.useRightHandedSystem?f.e.CounterClockWiseSideOrientation:f.e.ClockWiseSideOrientation,this._createMorphTargets(C,K,m,O,A),X.push(this._loadVertexDataAsync(C,O,A).then((async U=>await this._loadMorphTargetsAsync(C,O,A,U).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,U.lC(A),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const j=L._GetDrawMode(C,O.mode);if(void 0==O.material){let C=this._defaultBabylonMaterialData[j];C||(C=this._createDefaultMaterial("__GLTFLoader._default",j),this._parent.onMaterialLoadedObservable.notifyObservers(C),this._defaultBabylonMaterialData[j]=C),A.material=C}else if(!this.parent.skipMaterials){const U=g.Get(`${C}/material`,this._gltf.materials,O.material);X.push(this._loadMaterialAsync(`/materials/${U.index}`,U,A,j,(C=>{A.material=C})))}z=Promise.all(X),e&&(O._instanceData={babylonSourceMesh:A,promise:z}),t=A}return L.AddPointerMetadata(t,C),this._parent.onMeshLoadedObservable.notifyObservers(t),X(t),this.logClose(),z.then((()=>t))}_loadVertexDataAsync(C,U,K){const m=this._extensionsLoadVertexDataAsync(C,U,K);if(m)return m;const O=U.attributes;if(!O)throw new Error(`${C}: Attributes are missing`);const X=new Array,A=new d.d(K.name,this._babylonScene);if(void 0==U.indices)K.isUnIndexed=!0;else{const K=g.Get(`${C}/indices`,this._gltf.accessors,U.indices);X.push(this._loadIndicesAccessorAsync(`/accessors/${K.index}`,K).then((C=>{A.setIndices(C)})))}const e=(U,m,e)=>{if(void 0==O[U])return;K._delayInfo=K._delayInfo||[],-1===K._delayInfo.indexOf(m)&&K._delayInfo.push(m);const t=g.Get(`${C}/attributes/${U}`,this._gltf.accessors,O[U]);X.push(this._loadVertexAccessorAsync(`/accessors/${t.index}`,t,m).then((C=>{if(C.getKind()===H.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!K.skeleton){const C=M(t);C&&(A._boundingInfo=C,A.useBoundingInfoFromGeometry=!0)}A.setVerticesBuffer(C,t.count)}))),m==H.d.MatricesIndicesExtraKind&&(K.numBoneInfluencers=8),e&&e(t)};return e("POSITION",H.d.PositionKind),e("NORMAL",H.d.NormalKind),e("TANGENT",H.d.TangentKind),e("TEXCOORD_0",H.d.UVKind),e("TEXCOORD_1",H.d.UV2Kind),e("TEXCOORD_2",H.d.UV3Kind),e("TEXCOORD_3",H.d.UV4Kind),e("TEXCOORD_4",H.d.UV5Kind),e("TEXCOORD_5",H.d.UV6Kind),e("JOINTS_0",H.d.MatricesIndicesKind),e("WEIGHTS_0",H.d.MatricesWeightsKind),e("JOINTS_1",H.d.MatricesIndicesExtraKind),e("WEIGHTS_1",H.d.MatricesWeightsExtraKind),e("COLOR_0",H.d.ColorKind,(C=>{"VEC4"===C.type&&(K.hasVertexAlpha=!0)})),Promise.all(X).then((()=>A))}_createMorphTargets(C,U,K,m,O){if(!m.targets||!this._parent.loadMorphTargets)return;if(void 0==U._numMorphTargets)U._numMorphTargets=m.targets.length;else if(m.targets.length!==U._numMorphTargets)throw new Error(`${C}: Primitives do not have the same number of targets`);const X=K.extras?K.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,O.morphTargetManager=new D(this._babylonScene),O.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.morphTargetManager.areUpdatesFrozen=!0;for(let A=0;A<m.targets.length;A++){const C=U.weights?U.weights[A]:K.weights?K.weights[A]:0,m=X?X[A]:`morphTarget${A}`;O.morphTargetManager.addTarget(new a.d(m,C,O.dC()))}}_loadMorphTargetsAsync(C,U,K,m){if(!U.targets||!this._parent.loadMorphTargets)return Promise.resolve();const O=new Array,X=K.morphTargetManager;for(let A=0;A<X.numTargets;A++){const K=X.getTarget(A);O.push(this._loadMorphTargetVertexDataAsync(`${C}/targets/${A}`,m,U.targets[A],K))}return Promise.all(O).then((()=>{X.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(C,U,K,m){const O=new Array,X=(m,X,A)=>{if(void 0==K[m])return;const e=U.getVertexBuffer(X);if(!e)return;const t=g.Get(`${C}/${m}`,this._gltf.accessors,K[m]);O.push(this._loadFloatAccessorAsync(`/accessors/${t.index}`,t).then((C=>{A(e,C)})))};return X("POSITION",H.d.PositionKind,((C,U)=>{const K=new Float32Array(U.length);C.forEach(U.length,((C,m)=>{K[m]=U[m]+C})),m.setPositions(K)})),X("NORMAL",H.d.NormalKind,((C,U)=>{const K=new Float32Array(U.length);C.forEach(K.length,((C,m)=>{K[m]=U[m]+C})),m.setNormals(K)})),X("TANGENT",H.d.TangentKind,((C,U)=>{const K=new Float32Array(U.length/3*4);let O=0;C.forEach(U.length/3*4,((C,m)=>{(m+1)%4!==0&&(K[O]=U[O]+C,O++)})),m.setTangents(K)})),X("TEXCOORD_0",H.d.UVKind,((C,U)=>{const K=new Float32Array(U.length);C.forEach(U.length,((C,m)=>{K[m]=U[m]+C})),m.setUVs(K)})),X("TEXCOORD_1",H.d.UV2Kind,((C,U)=>{const K=new Float32Array(U.length);C.forEach(U.length,((C,m)=>{K[m]=U[m]+C})),m.setUV2s(K)})),X("COLOR_0",H.d.ColorKind,((U,K)=>{let O=null;const X=U.getSize();if(3===X){O=new Float32Array(K.length/3*4),U.forEach(K.length,((C,U)=>{const m=Math.floor(U/3),X=U%3;O[4*m+X]=K[3*m+X]+C}));for(let C=0;C<K.length/3;++C)O[4*C+3]=1}else{if(4!==X)throw new Error(`${C}: Invalid number of components (${X}) for COLOR_0 attribute`);O=new Float32Array(K.length),U.forEach(K.length,((C,U)=>{O[U]=K[U]+C}))}m.setColors(O)})),await Promise.all(O).then((()=>{}))}static _LoadTransform(C,U){if(void 0!=C.skin)return;let K=O.bU.Zero(),m=O.Quaternion.Identity(),X=O.bU.One();if(C.matrix){O.Matrix.FU(C.matrix).decompose(X,m,K)}else C.translation&&(K=O.bU.FU(C.translation)),C.rotation&&(m=O.Quaternion.FU(C.rotation)),C.scale&&(X=O.bU.FU(C.scale));U.position=K,U.rotationQuaternion=m,U.ue=X}_loadSkinAsync(C,U,K,m){if(!this._parent.loadSkins)return Promise.resolve();const O=this._extensionsLoadSkinAsync(C,U,K);if(O)return O;if(K._data)return m(K._data.babylonSkeleton),K._data.promise;const X=`skeleton${K.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new V(K.name||X,X,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(C,K,A);const e=this._loadSkinInverseBindMatricesDataAsync(C,K).then((C=>{this._updateBoneMatrices(A,C)}));return K._data={babylonSkeleton:A,promise:e},m(A),e}_loadBones(C,U,K){if(void 0==U.skeleton||this._parent.alwaysComputeSkeletonRootNode){const K=this._findSkeletonRootNode(`${C}/joints`,U.joints);if(K)if(void 0===U.skeleton)U.skeleton=K.index;else{const m=(C,U)=>{for(;U.parent;U=U.parent)if(U.parent===C)return!0;return!1},O=g.Get(`${C}/skeleton`,this._gltf.nodes,U.skeleton);O===K||m(O,K)||(v.d.Warn(`${C}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),U.skeleton=K.index)}else v.d.Warn(`${C}: Failed to find common root`)}const m={};for(const O of U.joints){const X=g.Get(`${C}/joints/${O}`,this._gltf.nodes,O);this._loadBone(X,U,K,m)}}_findSkeletonRootNode(C,U){if(0===U.length)return null;const K={};for(const O of U){const U=[];let m=g.Get(`${C}/${O}`,this._gltf.nodes,O);for(;-1!==m.index;)U.unshift(m),m=m.parent;K[O]=U}let m=null;for(let O=0;;++O){let C=K[U[0]];if(O>=C.length)return m;const X=C[O];for(let A=1;A<U.length;++A)if(C=K[U[A]],O>=C.length||X!==C[O])return m;m=X}}_loadBone(C,U,K,m){C._isJoint=!0;let O=m[C.index];if(O)return O;let X=null;C.index!==U.skeleton&&(C.parent&&-1!==C.parent.index?X=this._loadBone(C.parent,U,K,m):void 0!==U.skeleton&&v.d.Warn(`/skins/${U.index}/skeleton: Skeleton node is not a common root`));const A=U.joints.indexOf(C.index);return O=new z.c(C.name||`joint${C.index}`,K,X,this._getNodeMatrix(C),null,null,A),m[C.index]=O,this._postSceneLoadActions.push((()=>{O.linkTransformNode(C._babylonTransformNode)})),O}_loadSkinInverseBindMatricesDataAsync(C,U){if(void 0==U.inverseBindMatrices)return Promise.resolve(null);const K=g.Get(`${C}/inverseBindMatrices`,this._gltf.accessors,U.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${K.index}`,K)}_updateBoneMatrices(C,U){for(const K of C.bones){const C=O.Matrix.Identity(),m=K._index;U&&-1!==m&&(O.Matrix.FromArrayToRef(U,16*m,C),C.invertToRef(C));const X=K.getParent();X&&C.multiplyToRef(X.getAbsoluteInverseBindMatrix(),C),K.ee(C,!1,!1),K._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(C){return C.matrix?O.Matrix.FU(C.matrix):O.Matrix.Compose(C.scale?O.bU.FU(C.scale):O.bU.One(),C.rotation?O.Quaternion.FU(C.rotation):O.Quaternion.Identity(),C.translation?O.bU.FU(C.translation):O.bU.Zero())}loadCameraAsync(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const m=this._extensionsLoadCameraAsync(C,U,K);if(m)return m;const X=new Array;this.logOpen(`${C} ${U.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new t.b(U.name||`camera${U.index}`,O.bU.Zero(),this._babylonScene,!1);switch(A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonCamera=A,A.setTarget(new O.bU(0,0,-1)),U.type){case"perspective":{const K=U.perspective;if(!K)throw new Error(`${C}: Camera perspective properties are missing`);A.fov=K.yfov,A.Ae=K.znear,A.maxZ=K.zfar||0;break}case"orthographic":if(!U.orthographic)throw new Error(`${C}: Camera orthographic properties are missing`);A.mode=e.b.ORTHOGRAPHIC_CAMERA,A.orthoLeft=-U.orthographic.xmag,A.orthoRight=U.orthographic.xmag,A.orthoBottom=-U.orthographic.ymag,A.orthoTop=U.orthographic.ymag,A.Ae=U.orthographic.znear,A.maxZ=U.orthographic.zfar;break;default:throw new Error(`${C}: Invalid camera type (${U.type})`)}return L.AddPointerMetadata(A,C),this._parent.onCameraLoadedObservable.notifyObservers(A),K(A),this.logClose(),Promise.all(X).then((()=>A))}_loadAnimationsAsync(){const C=this._gltf.animations;if(!C)return Promise.resolve();const U=new Array;for(let K=0;K<C.length;K++){const m=C[K];U.push(this.loadAnimationAsync(`/animations/${m.index}`,m).then((C=>{0===C.targetedAnimations.length&&C.dispose()})))}return Promise.all(U).then((()=>{}))}loadAnimationAsync(C,U){const m=this._extensionsLoadAnimationAsync(C,U);return m||K.e(78).then(K.bind(K,14940)).then((K=>{let{AnimationGroup:m}=K;this._babylonScene._blockEntityCollection=!!this._assetContainer;const O=new m(U.name||`animation${U.index}`,this._babylonScene);O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U._babylonAnimationGroup=O;const X=new Array;g.Assign(U.channels),g.Assign(U.samplers);for(const A of U.channels)X.push(this._loadAnimationChannelAsync(`${C}/channels/${A.index}`,C,U,A,((C,U)=>{C.animations=C.animations||[],C.animations.push(U),O.addTargetedAnimation(U,C)})));return Promise.all(X).then((()=>(O.normalize(0),O)))}))}async _loadAnimationChannelAsync(C,U,m,O,X){const A=this._extensionsLoadAnimationChannelAsync(C,U,m,O,X);if(A)return await A;if(void 0==O.target.node)return await Promise.resolve();const e=g.Get(`${C}/target/node`,this._gltf.nodes,O.target.node),t=O.target.path,z="weights"===t;if(z&&!e._numMorphTargets||!z&&!e._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!z&&!e._isJoint)return await Promise.resolve();let j;switch(await Promise.resolve().then(K.bind(K,13468)),t){case"translation":var p;j=null===(p=(0,h.h)("/nodes/{}/translation"))||void 0===p?void 0:p.interpolation;break;case"rotation":var E;j=null===(E=(0,h.h)("/nodes/{}/rotation"))||void 0===E?void 0:E.interpolation;break;case"scale":var u;j=null===(u=(0,h.h)("/nodes/{}/scale"))||void 0===u?void 0:u.interpolation;break;case"weights":var b;j=null===(b=(0,h.h)("/nodes/{}/weights"))||void 0===b?void 0:b.interpolation;break;default:throw new Error(`${C}/target/path: Invalid value (${O.target.path})`)}if(!j)throw new Error(`${C}/target/path: Could not find interpolation properties for target path (${O.target.path})`);const v={object:e,info:j};return await this._loadAnimationChannelFromTargetInfoAsync(C,U,m,O,v,X)}_loadAnimationChannelFromTargetInfoAsync(C,U,K,m,O,X){const A=this.parent.targetFps,e=1/A,t=g.Get(`${C}/sampler`,K.samplers,m.sampler);return this._loadAnimationSamplerAsync(`${U}/samplers/${m.sampler}`,t).then((C=>{let U=0;const t=O.object,z=O.info;for(const O of z){const z=O.getStride(t),j=C.input,p=C.output,E=new Array(j.length);let u=0;switch(C.interpolation){case"STEP":for(let C=0;C<j.length;C++){const U=O.getValue(t,p,u,1);u+=z,E[C]={frame:j[C]*A,value:U,interpolation:1}}break;case"CUBICSPLINE":for(let C=0;C<j.length;C++){const U=O.getValue(t,p,u,e);u+=z;const K=O.getValue(t,p,u,1);u+=z;const m=O.getValue(t,p,u,e);u+=z,E[C]={frame:j[C]*A,inTangent:U,value:K,outTangent:m}}break;case"LINEAR":for(let C=0;C<j.length;C++){const U=O.getValue(t,p,u,1);u+=z,E[C]={frame:j[C]*A,value:U}}}if(u>0){const C=`${K.name||`animation${K.index}`}_channel${m.index}_${U}`,e=O.buildAnimations(t,C,A,E);for(const K of e)U++,X(K.babylonAnimatable,K.babylonAnimation)}}}))}_loadAnimationSamplerAsync(C,U){if(U._data)return U._data;const K=U.interpolation||"LINEAR";switch(K){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${C}/interpolation: Invalid value (${U.interpolation})`)}const m=g.Get(`${C}/input`,this._gltf.accessors,U.input),O=g.Get(`${C}/output`,this._gltf.accessors,U.output);return U._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${m.index}`,m),this._loadFloatAccessorAsync(`/accessors/${O.index}`,O)]).then((C=>{let[U,m]=C;return{input:U,interpolation:K,output:m}})),U._data}loadBufferAsync(C,U,K,m){const O=this._extensionsLoadBufferAsync(C,U,K,m);if(O)return O;if(!U._data)if(U.uri)U._data=this.loadUriAsync(`${C}/uri`,U,U.uri);else{if(!this._bin)throw new Error(`${C}: Uri is missing or the binary glTF is missing its binary chunk`);U._data=this._bin.readAsync(0,U.byteLength)}return U._data.then((U=>{try{return new Uint8Array(U.buffer,U.byteOffset+K,m)}catch(O){throw new Error(`${C}: ${O.message}`)}}))}loadBufferViewAsync(C,U){const K=this._extensionsLoadBufferViewAsync(C,U);if(K)return K;if(U._data)return U._data;const m=g.Get(`${C}/buffer`,this._gltf.buffers,U.buffer);return U._data=this.loadBufferAsync(`/buffers/${m.index}`,m,U.byteOffset||0,U.byteLength),U._data}_loadAccessorAsync(C,U,K){if(U._data)return U._data;const m=L._GetNumComponents(C,U.type),O=m*H.d.GetTypeByteLength(U.componentType),X=m*U.count;if(void 0==U.bufferView)U._data=Promise.resolve(new K(X));else{const A=g.Get(`${C}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((e=>{if(5126!==U.componentType||U.normalized||A.byteStride&&A.byteStride!==O){const C=new K(X);return H.d.ForEach(e,U.byteOffset||0,A.byteStride||O,m,U.componentType,C.length,U.normalized||!1,((U,K)=>{C[K]=U})),C}return L._GetTypedArray(C,U.componentType,e,U.byteOffset,X)}))}if(U.sparse){const X=U.sparse;U._data=U._data.then((A=>{const e=A,t=g.Get(`${C}/sparse/indices/bufferView`,this._gltf.bufferViews,X.indices.bufferView),z=g.Get(`${C}/sparse/values/bufferView`,this._gltf.bufferViews,X.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${t.index}`,t),this.loadBufferViewAsync(`/bufferViews/${z.index}`,z)]).then((A=>{let[t,z]=A;const j=L._GetTypedArray(`${C}/sparse/indices`,X.indices.componentType,t,X.indices.byteOffset,X.count),p=m*X.count;let E;if(5126!==U.componentType||U.normalized){const A=L._GetTypedArray(`${C}/sparse/values`,U.componentType,z,X.values.byteOffset,p);E=new K(p),H.d.ForEach(A,0,O,m,U.componentType,E.length,U.normalized||!1,((C,U)=>{E[U]=C}))}else E=L._GetTypedArray(`${C}/sparse/values`,U.componentType,z,X.values.byteOffset,p);let u=0;for(let C=0;C<j.length;C++){let U=j[C]*m;for(let C=0;C<m;C++)e[U++]=E[u++]}return e}))}))}return U._data}_loadFloatAccessorAsync(C,U){return this._loadAccessorAsync(C,U,Float32Array)}_loadIndicesAccessorAsync(C,U){if("SCALAR"!==U.type)throw new Error(`${C}/type: Invalid value ${U.type}`);if(5121!==U.componentType&&5123!==U.componentType&&5125!==U.componentType)throw new Error(`${C}/componentType: Invalid value ${U.componentType}`);if(U._data)return U._data;if(U.sparse){const K=L._GetTypedArrayConstructor(`${C}/componentType`,U.componentType);U._data=this._loadAccessorAsync(C,U,K)}else{const K=g.Get(`${C}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((K=>L._GetTypedArray(C,U.componentType,K,U.byteOffset,U.count)))}return U._data}_loadVertexBufferViewAsync(C){if(C._babylonBuffer)return C._babylonBuffer;const U=this._babylonScene.getEngine();return C._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>new H.b(U,C,!1))),C._babylonBuffer}_loadVertexAccessorAsync(C,U,K){var m;if(null!==(m=U._babylonVertexBuffer)&&void 0!==m&&m[K])return U._babylonVertexBuffer[K];U._babylonVertexBuffer||(U._babylonVertexBuffer={});const O=this._babylonScene.getEngine();if(U.sparse||void 0==U.bufferView)U._babylonVertexBuffer[K]=this._loadFloatAccessorAsync(C,U).then((C=>new H.d(O,C,K,!1)));else{const m=g.Get(`${C}/bufferView`,this._gltf.bufferViews,U.bufferView);U._babylonVertexBuffer[K]=this._loadVertexBufferViewAsync(m).then((X=>{const A=L._GetNumComponents(C,U.type);return new H.d(O,X,K,!1,void 0,m.byteStride,void 0,U.byteOffset,A,U.componentType,U.normalized,!0,void 0,!0)}))}return U._babylonVertexBuffer[K]}_loadMaterialMetallicRoughnessPropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;return U&&(U.baseColorFactor?(K.albedoColor=X.fU.FU(U.baseColorFactor),K.alpha=U.baseColorFactor[3]):K.albedoColor=X.fU.White(),K.metallic=void 0==U.metallicFactor?1:U.metallicFactor,K.roughness=void 0==U.roughnessFactor?1:U.roughnessFactor,U.baseColorTexture&&m.push(this.loadTextureInfoAsync(`${C}/baseColorTexture`,U.baseColorTexture,(C=>{C.name=`${K.name} (Base Color)`,K.albedoTexture=C}))),U.metallicRoughnessTexture&&(U.metallicRoughnessTexture.nonColorData=!0,m.push(this.loadTextureInfoAsync(`${C}/metallicRoughnessTexture`,U.metallicRoughnessTexture,(C=>{C.name=`${K.name} (Metallic Roughness)`,K.metallicTexture=C}))),K.useMetallnessFromMetallicTextureBlue=!0,K.useRoughnessFromMetallicTextureGreen=!0,K.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(m).then((()=>{}))}_loadMaterialAsync(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const X=this._extensionsLoadMaterialAsync(C,U,K,m,O);if(X)return X;U._data=U._data||{};let A=U._data[m];if(!A){this.logOpen(`${C} ${U.name||""}`);const K=this.createMaterial(C,U,m);A={babylonMaterial:K,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(C,U,K)},U._data[m]=A,L.AddPointerMetadata(K,C),this._parent.onMaterialLoadedObservable.notifyObservers(K),this.logClose()}return K&&(A.babylonMeshes.push(K),K.RA.addOnce((()=>{const C=A.babylonMeshes.indexOf(K);-1!==C&&A.babylonMeshes.splice(C,1)}))),O(A.babylonMaterial),A.promise.then((()=>A.babylonMaterial))}_createDefaultMaterial(C,U){this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new F.e(C,this._babylonScene);return K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K.fillMode=U,K.enableSpecularAntiAliasing=!0,K.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,K.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,K.transparencyMode=F.e.PBRMATERIAL_OPAQUE,K.metallic=1,K.roughness=1,K}createMaterial(C,U,K){const m=this._extensionsCreateMaterial(C,U,K);if(m)return m;const O=U.name||`material${U.index}`;return this._createDefaultMaterial(O,K)}loadMaterialPropertiesAsync(C,U,K){const m=this._extensionsLoadMaterialPropertiesAsync(C,U,K);if(m)return m;const O=new Array;return O.push(this.loadMaterialBasePropertiesAsync(C,U,K)),U.pbrMetallicRoughness&&O.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${C}/pbrMetallicRoughness`,U.pbrMetallicRoughness,K)),this.loadMaterialAlphaProperties(C,U,K),Promise.all(O).then((()=>{}))}loadMaterialBasePropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;return K.emissiveColor=U.emissiveFactor?X.fU.FU(U.emissiveFactor):new X.fU(0,0,0),U.doubleSided&&(K.pe=!1,K.twoSidedLighting=!0),U.normalTexture&&(U.normalTexture.nonColorData=!0,m.push(this.loadTextureInfoAsync(`${C}/normalTexture`,U.normalTexture,(C=>{C.name=`${K.name} (Normal)`,K.bumpTexture=C}))),K.invertNormalMapX=!this._babylonScene.useRightHandedSystem,K.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=U.normalTexture.scale&&K.bumpTexture&&(K.bumpTexture.level=U.normalTexture.scale),K.forceIrradianceInFragment=!0),U.occlusionTexture&&(U.occlusionTexture.nonColorData=!0,m.push(this.loadTextureInfoAsync(`${C}/occlusionTexture`,U.occlusionTexture,(C=>{C.name=`${K.name} (Occlusion)`,K.ambientTexture=C}))),K.useAmbientInGrayScale=!0,void 0!=U.occlusionTexture.strength&&(K.ambientTextureStrength=U.occlusionTexture.strength)),U.emissiveTexture&&m.push(this.loadTextureInfoAsync(`${C}/emissiveTexture`,U.emissiveTexture,(C=>{C.name=`${K.name} (Emissive)`,K.emissiveTexture=C}))),Promise.all(m).then((()=>{}))}loadMaterialAlphaProperties(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);switch(U.alphaMode||"OPAQUE"){case"OPAQUE":K.transparencyMode=F.e.PBRMATERIAL_OPAQUE,K.alpha=1;break;case"MASK":K.transparencyMode=F.e.PBRMATERIAL_ALPHATEST,K.alphaCutOff=void 0==U.alphaCutoff?.5:U.alphaCutoff,K.albedoTexture&&(K.albedoTexture.Xe=!0);break;case"BLEND":K.transparencyMode=F.e.PBRMATERIAL_ALPHABLEND,K.albedoTexture&&(K.albedoTexture.Xe=!0,K.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${C}/alphaMode: Invalid value (${U.alphaMode})`)}}loadTextureInfoAsync(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const m=this._extensionsLoadTextureInfoAsync(C,U,K);if(m)return m;if(this.logOpen(`${C}`),U.texCoord>=6)throw new Error(`${C}/texCoord: Invalid value (${U.texCoord})`);const O=g.Get(`${C}/index`,this._gltf.textures,U.index);O._textureInfo=U;const X=this._loadTextureAsync(`/textures/${U.index}`,O,(m=>{m.coordinatesIndex=U.texCoord||0,L.AddPointerMetadata(m,C),this._parent.onTextureLoadedObservable.notifyObservers(m),K(m)}));return this.logClose(),X}_loadTextureAsync(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const m=this._extensionsLoadTextureAsync(C,U,K);if(m)return m;this.logOpen(`${C} ${U.name||""}`);const O=void 0==U.sampler?L.DefaultSampler:g.Get(`${C}/sampler`,this._gltf.samplers,U.sampler),X=g.Get(`${C}/source`,this._gltf.images,U.source),A=this._createTextureAsync(C,O,X,K,void 0,!U._textureInfo.nonColorData);return this.logClose(),A}_createTextureAsync(C,U,K){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},X=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0;const e=this._loadSampler(`/samplers/${U.index}`,U),t=new Array,z=new m;this._babylonScene._blockEntityCollection=!!this._assetContainer;const j={noMipmap:e.noMipMaps,invertY:!1,samplingMode:e.samplingMode,R:()=>{this._disposed||z.resolve()},onError:(U,K)=>{this._disposed||z.reject(new Error(`${C}: ${K&&K.message?K.message:U||"Failed to load texture"}`))},mimeType:K.mimeType??(0,G.h)(K.uri??""),loaderOptions:X,useSRGBBuffer:!!A&&this._parent.useSRGBBuffers},p=new Z.b(null,this._babylonScene,j);return p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.push(z.promise),t.push(this.loadImageAsync(`/images/${K.index}`,K).then((C=>{const U=K.uri||`${this._fileName}#image${K.index}`,m=`data:${this._uniqueRootUrl}${U}`;p.updateURL(m,C);const O=p.getInternalTexture();O&&(O.label=K.name)}))),p.wrapU=e.wrapU,p.wrapV=e.wrapV,O(p),this._parent.useGltfTextureNames&&(p.name=K.name||K.uri||`image${K.index}`),Promise.all(t).then((()=>p))}_loadSampler(C,U){return U._data||(U._data={noMipMaps:9728===U.minFilter||9729===U.minFilter,samplingMode:L._GetTextureSamplingMode(C,U),wrapU:L._GetTextureWrapMode(`${C}/wrapS`,U.wrapS),wrapV:L._GetTextureWrapMode(`${C}/wrapT`,U.wrapT)}),U._data}loadImageAsync(C,U){if(!U._data){if(this.logOpen(`${C} ${U.name||""}`),U.uri)U._data=this.loadUriAsync(`${C}/uri`,U,U.uri);else{const K=g.Get(`${C}/bufferView`,this._gltf.bufferViews,U.bufferView);U._data=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K)}this.logClose()}return U._data}loadUriAsync(C,U,K){const m=this._extensionsLoadUriAsync(C,U,K);if(m)return m;if(!L._ValidateUri(K))throw new Error(`${C}: '${K}' is invalid`);if((0,G.i)(K)){const U=new Uint8Array((0,G.d)(K));return this.log(`${C}: Decoded ${K.substring(0,64)}... (${U.length} bytes)`),Promise.resolve(U)}return this.log(`${C}: Loading ${K}`),this._parent.preprocessUrlAsync(this._rootUrl+K).then((U=>new Promise(((m,O)=>{this._parent._loadFile(this._babylonScene,U,(U=>{this._disposed||(this.log(`${C}: Loaded ${K} (${U.byteLength} bytes)`),m(new Uint8Array(U)))}),!0,(U=>{O(new G.j(`${C}: Failed to load '${K}'${U?": "+U.status+" "+U.statusText:""}`,U))}))}))))}static AddPointerMetadata(C,U){C.metadata=C.metadata||{};const K=C._internalMetadata=C._internalMetadata||{},m=K.Ce=K.Ce||{};(m.pointers=m.pointers||[]).push(U)}static _GetTextureWrapMode(C,U){switch(U=void 0==U?10497:U){case 33071:return Z.b.CLAMP_ADDRESSMODE;case 33648:return Z.b.MIRROR_ADDRESSMODE;case 10497:return Z.b.WRAP_ADDRESSMODE;default:return v.d.Warn(`${C}: Invalid value (${U})`),Z.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(C,U){const K=void 0==U.magFilter?9729:U.magFilter,m=void 0==U.minFilter?9987:U.minFilter;if(9729===K)switch(m){case 9728:return Z.b.LINEAR_NEAREST;case 9729:return Z.b.LINEAR_LINEAR;case 9984:return Z.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return Z.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return Z.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return Z.b.LINEAR_LINEAR_MIPLINEAR;default:return v.d.Warn(`${C}/minFilter: Invalid value (${m})`),Z.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==K&&v.d.Warn(`${C}/magFilter: Invalid value (${K})`),m){case 9728:return Z.b.NEAREST_NEAREST;case 9729:return Z.b.NEAREST_LINEAR;case 9984:return Z.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return Z.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return Z.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return Z.b.NEAREST_LINEAR_MIPLINEAR;default:return v.d.Warn(`${C}/minFilter: Invalid value (${m})`),Z.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(C,U){try{return(0,N.r)(U)}catch(K){throw new Error(`${C}: ${K.message}`)}}static _GetTypedArray(C,U,K,m,O){const X=K.buffer;m=K.byteOffset+(m||0);const A=L._GetTypedArrayConstructor(`${C}/componentType`,U),e=H.d.GetTypeByteLength(U);return m%e!==0?(v.d.Warn(`${C}: Copying buffer as byte offset (${m}) is not a multiple of component type byte length (${e})`),new A(X.slice(m,m+O*e),0)):new A(X,m,O)}static _GetNumComponents(C,U){switch(U){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${C}: Invalid type (${U})`)}static _ValidateUri(C){return A.Tools.IsBase64(C)||-1===C.indexOf("..")}static _GetDrawMode(C,U){switch(void 0==U&&(U=4),U){case 0:return f.e.PointListDrawMode;case 1:return f.e.LineListDrawMode;case 2:return f.e.LineLoopDrawMode;case 3:return f.e.LineStripDrawMode;case 4:return f.e.TriangleFillMode;case 5:return f.e.TriangleStripDrawMode;case 6:return f.e.TriangleFanDrawMode}throw new Error(`${C}: Invalid mesh primitive mode (${U})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const C=new Array;if(this._gltf.materials)for(const U of this._gltf.materials)if(U._data)for(const K in U._data){const m=U._data[K];for(const U of m.babylonMeshes){U.te(!0);const K=m.babylonMaterial;C.push(K.forceCompilationAsync(U)),C.push(K.forceCompilationAsync(U,{useInstances:!0})),this._parent.useClipPlane&&(C.push(K.forceCompilationAsync(U,{clipPlane:!0})),C.push(K.forceCompilationAsync(U,{clipPlane:!0,useInstances:!0})))}}return Promise.all(C).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const C=new Array,U=this._babylonScene.lights;for(const K of U){const U=K.getShadowGenerator();U&&C.push(U.forceCompilationAsync())}return Promise.all(C).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(C){for(const U of this._extensions)U.enabled&&C(U)}_applyExtensions(C,U,K){for(const m of this._extensions)if(m.enabled){const O=`${m.name}.${U}`,X=C;X._activeLoaderExtensionFunctions=X._activeLoaderExtensionFunctions||{};const A=X._activeLoaderExtensionFunctions;if(!A[O]){A[O]=!0;try{const C=K(m);if(C)return C}finally{delete A[O]}}}return null}_extensionsOnLoading(){this._forEachExtensions((C=>C.onLoading&&C.onLoading()))}_extensionsOnReady(){this._forEachExtensions((C=>C.onReady&&C.onReady()))}_extensionsLoadSceneAsync(C,U){return this._applyExtensions(U,"loadScene",(K=>K.loadSceneAsync&&K.loadSceneAsync(C,U)))}_extensionsLoadNodeAsync(C,U,K){return this._applyExtensions(U,"loadNode",(m=>m.loadNodeAsync&&m.loadNodeAsync(C,U,K)))}_extensionsLoadCameraAsync(C,U,K){return this._applyExtensions(U,"loadCamera",(m=>m.loadCameraAsync&&m.loadCameraAsync(C,U,K)))}_extensionsLoadVertexDataAsync(C,U,K){return this._applyExtensions(U,"loadVertexData",(m=>m._loadVertexDataAsync&&m._loadVertexDataAsync(C,U,K)))}_extensionsLoadMeshPrimitiveAsync(C,U,K,m,O,X){return this._applyExtensions(O,"loadMeshPrimitive",(A=>A._loadMeshPrimitiveAsync&&A._loadMeshPrimitiveAsync(C,U,K,m,O,X)))}_extensionsLoadMaterialAsync(C,U,K,m,O){return this._applyExtensions(U,"loadMaterial",(X=>X._loadMaterialAsync&&X._loadMaterialAsync(C,U,K,m,O)))}_extensionsCreateMaterial(C,U,K){return this._applyExtensions(U,"createMaterial",(m=>m.createMaterial&&m.createMaterial(C,U,K)))}_extensionsLoadMaterialPropertiesAsync(C,U,K){return this._applyExtensions(U,"loadMaterialProperties",(m=>m.loadMaterialPropertiesAsync&&m.loadMaterialPropertiesAsync(C,U,K)))}_extensionsLoadTextureInfoAsync(C,U,K){return this._applyExtensions(U,"loadTextureInfo",(m=>m.loadTextureInfoAsync&&m.loadTextureInfoAsync(C,U,K)))}_extensionsLoadTextureAsync(C,U,K){return this._applyExtensions(U,"loadTexture",(m=>m._loadTextureAsync&&m._loadTextureAsync(C,U,K)))}_extensionsLoadAnimationAsync(C,U){return this._applyExtensions(U,"loadAnimation",(K=>K.loadAnimationAsync&&K.loadAnimationAsync(C,U)))}_extensionsLoadAnimationChannelAsync(C,U,K,m,O){return this._applyExtensions(K,"loadAnimationChannel",(X=>X._loadAnimationChannelAsync&&X._loadAnimationChannelAsync(C,U,K,m,O)))}_extensionsLoadSkinAsync(C,U,K){return this._applyExtensions(K,"loadSkin",(m=>m._loadSkinAsync&&m._loadSkinAsync(C,U,K)))}_extensionsLoadUriAsync(C,U,K){return this._applyExtensions(U,"loadUri",(m=>m._loadUriAsync&&m._loadUriAsync(C,U,K)))}_extensionsLoadBufferViewAsync(C,U){return this._applyExtensions(U,"loadBufferView",(K=>K.loadBufferViewAsync&&K.loadBufferViewAsync(C,U)))}_extensionsLoadBufferAsync(C,U,K,m){return this._applyExtensions(U,"loadBuffer",(O=>O.loadBufferAsync&&O.loadBufferAsync(C,U,K,m)))}static LoadExtensionAsync(C,U,K,m){if(!U.extensions)return null;const O=U.extensions[K];return O?m(`${C}/extensions/${K}`,O):null}static LoadExtraAsync(C,U,K,m){if(!U.extras)return null;const O=U.extras[K];return O?m(`${C}/extras/${K}`,O):null}isExtensionUsed(C){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(C)}logOpen(C){this._parent._logOpen(C)}logClose(){this._parent._logClose()}log(C){this._parent._log(C)}startPerformanceCounter(C){this._parent._startPerformanceCounter(C)}endPerformanceCounter(C){this._parent._endPerformanceCounter(C)}}L.DefaultSampler={index:-1},l.c._CreateGLTF2Loader=C=>new L(C);var Y=K(13468),W=K(12018),x=K(11863),n=K(13472),S=K(13477);class s extends S.e{constructor(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",C),this._texture=C.getEngine().createRawCubeTexture(U,K,m,O,X,A,e,t)}update(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,C,U,K,m,O)}updateRGBDAsync(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,n.i)(this._texture,C,U,K,m).then((()=>{}))}clone(){return x.c.Clone((()=>{const C=this.dC(),U=this._texture,K=new s(C,U._bufferViewArray,U.width,U.format,U.type,U.generateMipMaps,U.invertY,U.samplingMode,U._compression);return 13===U.source&&K.updateRGBDAsync(U._bufferViewArrayArray,U._sphericalPolynomial,U._lodGenerationScale,U._lodGenerationOffset),K}),this)}}const R="EXT_lights_image_based";class q{constructor(C){this.name=R,this._loader=C,this.enabled=this._loader.isExtensionUsed(R)}dispose(){this._loader=null,delete this._lights}onLoading(){const C=this._loader.Ce.extensions;if(C&&C[this.name]){const U=C[this.name];this._lights=U.lights}}loadSceneAsync(C,U){return L.LoadExtensionAsync(C,U,this.name,(async(K,m)=>{this._loader._allMaterialsDirtyRequired=!0;const O=new Array;O.push(this._loader.loadSceneAsync(C,U)),this._loader.logOpen(`${K}`);const X=g.Get(`${K}/light`,this._lights,m.nA);return O.push(this._loadLightAsync(`/extensions/${this.name}/lights/${m.nA}`,X).then((C=>{this._loader.babylonScene.environmentTexture=C}))),this._loader.logClose(),await Promise.all(O).then((()=>{}))}))}_loadLightAsync(C,U){if(!U._loaded){const K=new Array;this._loader.logOpen(`${C}`);const m=new Array(U.specularImages.length);for(let O=0;O<U.specularImages.length;O++){const X=U.specularImages[O];m[O]=new Array(X.length);for(let U=0;U<X.length;U++){const A=`${C}/specularImages/${O}/${U}`;this._loader.logOpen(`${A}`);const e=X[U],t=g.Get(A,this._loader.Ce.images,e);K.push(this._loader.loadImageAsync(`/images/${e}`,t).then((C=>{m[O][U]=C}))),this._loader.logClose()}}this._loader.logClose(),U._loaded=Promise.all(K).then((async()=>{const K=new s(this._loader.babylonScene,null,U.specularImageSize);if(K.name=U.name||"environment",U._babylonTexture=K,void 0!=U.fe&&(K.level=U.fe),U.rotation){let C=O.Quaternion.FU(U.rotation);this._loader.babylonScene.useRightHandedSystem||(C=O.Quaternion.Inverse(C)),O.Matrix.FromQuaternionToRef(C,K.getReflectionTextureMatrix())}if(!U.irradianceCoefficients)throw new Error(`${C}: Irradiance coefficients are missing`);const X=W.d.FU(U.irradianceCoefficients);X.scaleInPlace(U.fe),X.convertIrradianceToLambertianRadiance();const A=W.g.FromHarmonics(X),e=(m.length-1)/Math.log2(U.specularImageSize);return await K.updateRGBDAsync(m,A,e)}))}return U._loaded.then((()=>U._babylonTexture))}}w(R),k(R,!0,(C=>new q(C)));K(12393);const I="EXT_mesh_gpu_instancing";class CC{constructor(C){this.name=I,this._loader=C,this.enabled=this._loader.isExtensionUsed(I)}dispose(){this._loader=null}loadNodeAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(C,m)=>{this._loader._disableInstancedMesh++;const X=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,K);if(this._loader._disableInstancedMesh--,!U._primitiveBabylonMeshes)return await X;const A=new Array;let e=0;const t=U=>{if(void 0==m.attributes[U])return void A.push(Promise.resolve(null));const K=g.Get(`${C}/attributes/${U}`,this._loader.Ce.accessors,m.attributes[U]);if(A.push(this._loader._loadFloatAccessorAsync(`/accessors/${K.bufferView}`,K)),0===e)e=K.count;else if(e!==K.count)throw new Error(`${C}/attributes: Instance buffer accessors do not have the same count.`)};return t("TRANSLATION"),t("ROTATION"),t("SCALE"),await X.then((async C=>{const[K,m,X]=await Promise.all(A),t=new Float32Array(16*e);O.TmpVectors.bU[0].Ee(0,0,0),O.TmpVectors.Quaternion[0].Ee(0,0,0,1),O.TmpVectors.bU[1].Ee(1,1,1);for(let U=0;U<e;++U)K&&O.bU.FromArrayToRef(K,3*U,O.TmpVectors.bU[0]),m&&O.Quaternion.FromArrayToRef(m,4*U,O.TmpVectors.Quaternion[0]),X&&O.bU.FromArrayToRef(X,3*U,O.TmpVectors.bU[1]),O.Matrix.ComposeToRef(O.TmpVectors.bU[1],O.TmpVectors.Quaternion[0],O.TmpVectors.bU[0],O.TmpVectors.Matrix[0]),O.TmpVectors.Matrix[0].copyToArray(t,16*U);for(const O of U._primitiveBabylonMeshes)O.yp("matrix",t,16,!0);return C}))}))}}w(I),k(I,!0,(C=>new CC(C)));let UC=0,KC=null;class mC{static get Default(){return mC._Default||(mC._Default=new mC),mC._Default}constructor(){const C=mC.Configuration.decoder;this._decoderModulePromise=A.Tools.LoadBabylonScriptAsync(C.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(C,U,K,m,O){await this._decoderModulePromise,0===UC&&(MeshoptDecoder.useWorkers(1),UC=1);const X=await MeshoptDecoder.decodeGltfBufferAsync(U,K,C,m,O);return null!==KC&&clearTimeout(KC),KC=setTimeout((()=>{MeshoptDecoder.useWorkers(0),UC=0,KC=null}),1e3),X}}mC.Configuration={decoder:{url:`${A.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},mC._Default=null;const OC="EXT_meshopt_compression";class XC{constructor(C){this.name=OC,this.enabled=C.isExtensionUsed(OC),this._loader=C}dispose(){this._loader=null}loadBufferViewAsync(C,U){return L.LoadExtensionAsync(C,U,this.name,(async(K,m)=>{const O=U;if(O._meshOptData)return await O._meshOptData;const X=g.Get(`${C}/buffer`,this._loader.Ce.buffers,m.buffer);return O._meshOptData=this._loader.loadBufferAsync(`/buffers/${X.index}`,X,m.byteOffset||0,m.byteLength).then((async C=>await mC.Default.decodeGltfBufferAsync(C,m.count,m.byteStride,m.mode,m.filter))),await O._meshOptData}))}}w(OC),k(OC,!0,(C=>new XC(C)));const AC="EXT_texture_webp";class eC{constructor(C){this.name=AC,this._loader=C,this.enabled=C.isExtensionUsed(AC)}dispose(){this._loader=null}_loadTextureAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=void 0==U.sampler?L.DefaultSampler:g.Get(`${C}/sampler`,this._loader.Ce.samplers,U.sampler),A=g.Get(`${m}/source`,this._loader.Ce.images,O.source);return await this._loader._createTextureAsync(C,X,A,(C=>{K(C)}),void 0,!U._textureInfo.nonColorData)}))}}w(AC),k(AC,!0,(C=>new eC(C)));const tC="EXT_texture_avif";class zC{constructor(C){this.name=tC,this._loader=C,this.enabled=C.isExtensionUsed(tC)}dispose(){this._loader=null}_loadTextureAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=void 0==U.sampler?L.DefaultSampler:g.Get(`${C}/sampler`,this._loader.Ce.samplers,U.sampler),A=g.Get(`${m}/source`,this._loader.Ce.images,O.source);return await this._loader._createTextureAsync(C,X,A,(C=>{K(C)}),void 0,!U._textureInfo.nonColorData)}))}}w(tC),k(tC,!0,(C=>new zC(C)));var jC=K(13461),pC=K(12367);const EC="EXT_lights_ies";class uC{constructor(C){this.name=EC,this._loader=C,this.enabled=this._loader.isExtensionUsed(EC)}dispose(){this._loader=null,delete this._lights}onLoading(){const C=this._loader.Ce.extensions;if(C&&C[this.name]){const U=C[this.name];this._lights=U.lights,g.Assign(this._lights)}}loadNodeAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,A)=>{let e,t;this._loader._allMaterialsDirtyRequired=!0;const z=await this._loader.loadNodeAsync(C,U,(C=>{t=g.Get(m,this._lights,A.nA);const U=t.name||C.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,e=new jC.b(U,O.bU.Zero(),O.bU.Backward(),0,1,this._loader.babylonScene),e.angle=Math.PI/2,e.innerAngle=0,e._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,t._babylonLight=e,e.falloffType=pC.e.FALLOFF_GLTF,e.Fe=A.color?X.fU.FU(A.color):X.fU.White(),e.fe=A.multiplier||1,e.range=Number.MAX_VALUE,e.parent=C,this._loader._babylonLights.push(e),L.AddPointerMetadata(e,m),K(C)}));let j;if(t.uri)j=await this._loader.loadUriAsync(C,t,t.uri);else{const U=g.Get(`${C}/bufferView`,this._loader.Ce.bufferViews,t.bufferView);j=await this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U)}return e.iesProfileTexture=new Z.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,j,!0,void 0,void 0,void 0,void 0,".ies"),z}))}}w(EC),k(EC,!0,(C=>new uC(C)));var bC=K(13488);const vC="KHR_draco_mesh_compression";class QC{constructor(C){this.name=vC,this.useNormalizedFlagFromAccessor=!0,this._loader=C,this.enabled=bC.c.DefaultAvailable&&this._loader.isExtensionUsed(vC)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{if(void 0!=U.mode&&4!==U.mode&&5!==U.mode)throw new Error(`${C}: Unsupported mode ${U.mode}`);const X={},A={},e=(C,m)=>{const e=O.attributes[C];if(void 0!=e&&(K._delayInfo=K._delayInfo||[],-1===K._delayInfo.indexOf(m)&&K._delayInfo.push(m),X[m]=e,this.useNormalizedFlagFromAccessor)){const K=g.TryGet(this._loader.Ce.accessors,U.attributes[C]);K&&(A[m]=K.normalized||!1)}};e("POSITION",H.d.PositionKind),e("NORMAL",H.d.NormalKind),e("TANGENT",H.d.TangentKind),e("TEXCOORD_0",H.d.UVKind),e("TEXCOORD_1",H.d.UV2Kind),e("TEXCOORD_2",H.d.UV3Kind),e("TEXCOORD_3",H.d.UV4Kind),e("TEXCOORD_4",H.d.UV5Kind),e("TEXCOORD_5",H.d.UV6Kind),e("JOINTS_0",H.d.MatricesIndicesKind),e("WEIGHTS_0",H.d.MatricesWeightsKind),e("COLOR_0",H.d.ColorKind);const t=g.Get(m,this._loader.Ce.bufferViews,O.bufferView);return t._dracoBabylonGeometry||(t._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((async m=>{const O=this.dracoDecoder||bC.c.Default,e=g.TryGet(this._loader.Ce.accessors,U.attributes.POSITION),t=this._loader.parent.alwaysComputeBoundingBox||K.skeleton||!e?null:M(e);return await O._decodeMeshToGeometryForGltfAsync(K.name,this._loader.babylonScene,m,X,A,t).catch((U=>{throw new Error(`${C}: ${U.message}`)}))}))),await t._dracoBabylonGeometry}))}}w(vC),k(vC,!0,(C=>new QC(C)));var VC=K(13492),fC=K(11810),FC=K(11818),ZC=K(12254),PC=K(12418),HC=K(11789);ZC.c.AddNodeConstructor("Light_Type_0",((C,U)=>()=>new dC(C,O.bU.Zero(),U)));class dC extends PC.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(C){this._shadowAngle=C,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(C){const U=this.needCube();if(this._direction=C,this.needCube()!==U&&this._shadowGenerators){const C=this._shadowGenerators.values();for(let U=C.next();!0!==U.done;U=C.next()){U.value.recreateShadowMap()}}}constructor(C,U,K){super(C,K),this._shadowAngle=Math.PI/2,this.position=U}getClassName(){return"PointLight"}getTypeID(){return pC.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(C){if(this.direction)return super.getShadowDirection(C);switch(C){case 0:return new O.bU(1,0,0);case 1:return new O.bU(-1,0,0);case 2:return new O.bU(0,-1,0);case 3:return new O.bU(0,1,0);case 4:return new O.bU(0,0,1);case 5:return new O.bU(0,0,-1)}return O.bU.Zero()}_setDefaultShadowProjectionMatrix(C,U,K){const m=this.dC().activeCamera;if(!m)return;const X=void 0!==this.shadowMinZ?this.shadowMinZ:m.Ae,A=void 0!==this.shadowMaxZ?this.shadowMaxZ:m.maxZ,e=this.dC().getEngine().useReverseDepthBuffer;O.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,e?A:X,e?X:A,C,!0,this._scene.getEngine().isNDCHalfZRange,void 0,e)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(C,U){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,U):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,U),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,U),this}transferToNodeMaterialEffect(C,U){return this.computeTransformedInformation()?C.setFloat3(U,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):C.setFloat3(U,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(C,U){C["POINTLIGHT"+U]=!0}}(0,fC.d)([(0,FC.O)()],dC.prototype,"shadowAngle",null),(0,HC.h)("BABYLON.PointLight",dC);const TC="KHR_lights_punctual";class yC{constructor(C){this.name=TC,this._loader=C,this.enabled=this._loader.isExtensionUsed(TC)}dispose(){this._loader=null,delete this._lights}onLoading(){const C=this._loader.Ce.extensions;if(C&&C[this.name]){const U=C[this.name];this._lights=U.lights,g.Assign(this._lights)}}loadNodeAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,A)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(C,U,(C=>{let U;const e=g.Get(m,this._lights,A.nA),t=e.name||C.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,e.type){case"directional":{const C=new VC.e(t,O.bU.Backward(),this._loader.babylonScene);C.position.be(0),U=C;break}case"point":U=new dC(t,O.bU.Zero(),this._loader.babylonScene);break;case"spot":{const C=new jC.b(t,O.bU.Zero(),O.bU.Backward(),0,1,this._loader.babylonScene);C.angle=2*(e.spot&&e.spot.outerConeAngle||Math.PI/4),C.innerAngle=2*(e.spot&&e.spot.innerConeAngle||0),U=C;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${m}: Invalid light type (${e.type})`)}U._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonLight=U,U.falloffType=pC.e.FALLOFF_GLTF,U.Fe=e.color?X.fU.FU(e.color):X.fU.White(),U.fe=void 0==e.fe?1:e.fe,U.range=void 0==e.range?Number.MAX_VALUE:e.range,U.parent=C,this._loader._babylonLights.push(U),L.AddPointerMetadata(U,m),K(C)})))))}}w(TC),k(TC,!0,(C=>new yC(C)));const aC="KHR_materials_pbrSpecularGlossiness";class rC{constructor(C){this.name=aC,this.order=200,this._loader=C,this.enabled=this._loader.isExtensionUsed(aC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialBasePropertiesAsync(C,U,K)),X.push(this._loadSpecularGlossinessPropertiesAsync(m,O,K)),this._loader.loadMaterialAlphaProperties(C,U,K),await Promise.all(X).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;return K.metallic=null,K.roughness=null,U.diffuseFactor?(K.albedoColor=X.fU.FU(U.diffuseFactor),K.alpha=U.diffuseFactor[3]):K.albedoColor=X.fU.White(),K.reflectivityColor=U.specularFactor?X.fU.FU(U.specularFactor):X.fU.White(),K.microSurface=void 0==U.glossinessFactor?1:U.glossinessFactor,U.diffuseTexture&&m.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTexture`,U.diffuseTexture,(C=>{C.name=`${K.name} (Diffuse)`,K.albedoTexture=C}))),U.specularGlossinessTexture&&(m.push(this._loader.loadTextureInfoAsync(`${C}/specularGlossinessTexture`,U.specularGlossinessTexture,(C=>{C.name=`${K.name} (Specular Glossiness)`,K.reflectivityTexture=C,K.reflectivityTexture.Xe=!0}))),K.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(m).then((()=>{}))}}w(aC),k(aC,!0,(C=>new rC(C)));const iC="KHR_materials_unlit";class DC{constructor(C){this.name=iC,this.order=210,this._loader=C,this.enabled=this._loader.isExtensionUsed(iC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async()=>await this._loadUnlitPropertiesAsync(C,U,K)))}_loadUnlitPropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;K.unlit=!0;const O=U.pbrMetallicRoughness;return O&&(O.baseColorFactor?(K.albedoColor=X.fU.FU(O.baseColorFactor),K.alpha=O.baseColorFactor[3]):K.albedoColor=X.fU.White(),O.baseColorTexture&&m.push(this._loader.loadTextureInfoAsync(`${C}/baseColorTexture`,O.baseColorTexture,(C=>{C.name=`${K.name} (Base Color)`,K.albedoTexture=C})))),U.doubleSided&&(K.pe=!1,K.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(C,U,K),Promise.all(m).then((()=>{}))}}w(iC),k(iC,!0,(C=>new DC(C)));const lC="KHR_materials_clearcoat";class GC{constructor(C){this.name=lC,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(lC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadClearCoatPropertiesAsync(m,O,K)),await Promise.all(X)}))}_loadClearCoatPropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;return K.clearCoat.isEnabled=!0,K.clearCoat.useRoughnessFromMainTexture=!1,K.clearCoat.remapF0OnInterfaceChange=!1,void 0!=U.clearcoatFactor?K.clearCoat.fe=U.clearcoatFactor:K.clearCoat.fe=0,U.clearcoatTexture&&m.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatTexture`,U.clearcoatTexture,(C=>{C.name=`${K.name} (ClearCoat)`,K.clearCoat.texture=C}))),void 0!=U.clearcoatRoughnessFactor?K.clearCoat.roughness=U.clearcoatRoughnessFactor:K.clearCoat.roughness=0,U.clearcoatRoughnessTexture&&(U.clearcoatRoughnessTexture.nonColorData=!0,m.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatRoughnessTexture`,U.clearcoatRoughnessTexture,(C=>{C.name=`${K.name} (ClearCoat Roughness)`,K.clearCoat.textureRoughness=C})))),U.clearcoatNormalTexture&&(U.clearcoatNormalTexture.nonColorData=!0,m.push(this._loader.loadTextureInfoAsync(`${C}/clearcoatNormalTexture`,U.clearcoatNormalTexture,(C=>{C.name=`${K.name} (ClearCoat Normal)`,K.clearCoat.bumpTexture=C}))),K.invertNormalMapX=!K.dC().useRightHandedSystem,K.invertNormalMapY=K.dC().useRightHandedSystem,void 0!=U.clearcoatNormalTexture.scale&&(K.clearCoat.bumpTexture.level=U.clearcoatNormalTexture.scale)),Promise.all(m).then((()=>{}))}}w(lC),k(lC,!0,(C=>new GC(C)));const JC="KHR_materials_iridescence";class oC{constructor(C){this.name=JC,this.order=195,this._loader=C,this.enabled=this._loader.isExtensionUsed(JC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadIridescencePropertiesAsync(m,O,K)),await Promise.all(X).then((()=>{}))}))}_loadIridescencePropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;return K.iridescence.isEnabled=!0,K.iridescence.fe=U.iridescenceFactor??0,K.iridescence.indexOfRefraction=U.iridescenceIor??U.iridescenceIOR??1.3,K.iridescence.minimumThickness=U.iridescenceThicknessMinimum??100,K.iridescence.maximumThickness=U.iridescenceThicknessMaximum??400,U.iridescenceTexture&&m.push(this._loader.loadTextureInfoAsync(`${C}/iridescenceTexture`,U.iridescenceTexture,(C=>{C.name=`${K.name} (Iridescence)`,K.iridescence.texture=C}))),U.iridescenceThicknessTexture&&m.push(this._loader.loadTextureInfoAsync(`${C}/iridescenceThicknessTexture`,U.iridescenceThicknessTexture,(C=>{C.name=`${K.name} (Iridescence Thickness)`,K.iridescence.thicknessTexture=C}))),Promise.all(m).then((()=>{}))}}w(JC),k(JC,!0,(C=>new oC(C)));const BC="KHR_materials_anisotropy";class kC{constructor(C){this.name=BC,this.order=195,this._loader=C,this.enabled=this._loader.isExtensionUsed(BC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadIridescencePropertiesAsync(m,O,K)),await Promise.all(X)}))}async _loadIridescencePropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;K.anisotropy.isEnabled=!0,K.anisotropy.fe=U.anisotropyStrength??0,K.anisotropy.angle=U.anisotropyRotation??0,U.anisotropyTexture&&(U.anisotropyTexture.nonColorData=!0,m.push(this._loader.loadTextureInfoAsync(`${C}/anisotropyTexture`,U.anisotropyTexture,(C=>{C.name=`${K.name} (Anisotropy Intensity)`,K.anisotropy.texture=C})))),await Promise.all(m)}}w(BC),k(BC,!0,(C=>new kC(C)));const wC="KHR_materials_emissive_strength";class hC{constructor(C){this.name=wC,this.order=170,this._loader=C,this.enabled=this._loader.isExtensionUsed(wC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>await this._loader.loadMaterialPropertiesAsync(C,U,K).then((()=>{this._loadEmissiveProperties(m,O,K)}))))}_loadEmissiveProperties(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);void 0!==U.emissiveStrength&&(K.emissiveIntensity=U.emissiveStrength)}}w(wC),k(wC,!0,(C=>new hC(C)));const cC="KHR_materials_sheen";class NC{constructor(C){this.name=cC,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(cC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadSheenPropertiesAsync(m,O,K)),await Promise.all(X).then((()=>{}))}))}_loadSheenPropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;return K.sheen.isEnabled=!0,K.sheen.fe=1,void 0!=U.sheenColorFactor?K.sheen.color=X.fU.FU(U.sheenColorFactor):K.sheen.color=X.fU.Black(),U.sheenColorTexture&&m.push(this._loader.loadTextureInfoAsync(`${C}/sheenColorTexture`,U.sheenColorTexture,(C=>{C.name=`${K.name} (Sheen Color)`,K.sheen.texture=C}))),void 0!==U.sheenRoughnessFactor?K.sheen.roughness=U.sheenRoughnessFactor:K.sheen.roughness=0,U.sheenRoughnessTexture&&(U.sheenRoughnessTexture.nonColorData=!0,m.push(this._loader.loadTextureInfoAsync(`${C}/sheenRoughnessTexture`,U.sheenRoughnessTexture,(C=>{C.name=`${K.name} (Sheen Roughness)`,K.sheen.textureRoughness=C})))),K.sheen.albedoScaling=!0,K.sheen.useRoughnessFromMainTexture=!1,Promise.all(m).then((()=>{}))}}w(cC),k(cC,!0,(C=>new NC(C)));var gC=K(12321);const MC="KHR_materials_specular";class LC{constructor(C){this.name=MC,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(MC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;if(X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadSpecularPropertiesAsync(m,O,K)),O.extensions&&O.extensions.EXT_materials_specular_edge_color&&K instanceof F.e){O.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(K.brdf.dielectricSpecularModel=gC.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,K.brdf.conductorSpecularModel=gC.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(X).then((()=>{}))}))}_loadSpecularPropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;return void 0!==U.specularFactor&&(K.metallicF0Factor=U.specularFactor),void 0!==U.specularColorFactor&&(K.metallicReflectanceColor=X.fU.FU(U.specularColorFactor)),U.specularTexture&&(U.specularTexture.nonColorData=!0,m.push(this._loader.loadTextureInfoAsync(`${C}/specularTexture`,U.specularTexture,(C=>{C.name=`${K.name} (Specular)`,K.metallicReflectanceTexture=C,K.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),U.specularColorTexture&&m.push(this._loader.loadTextureInfoAsync(`${C}/specularColorTexture`,U.specularColorTexture,(C=>{C.name=`${K.name} (Specular Color)`,K.reflectanceTexture=C}))),Promise.all(m).then((()=>{}))}}w(MC),k(MC,!0,(C=>new LC(C)));const YC="KHR_materials_ior";class WC{constructor(C){this.name=YC,this.order=180,this._loader=C,this.enabled=this._loader.isExtensionUsed(YC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadIorPropertiesAsync(m,O,K)),await Promise.all(X).then((()=>{}))}))}_loadIorPropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);return void 0!==U.ior?K.indexOfRefraction=U.ior:K.indexOfRefraction=WC._DEFAULT_IOR,Promise.resolve()}}WC._DEFAULT_IOR=1.5,w(YC),k(YC,!0,(C=>new WC(C)));const xC="KHR_materials_variants";class nC{constructor(C){this.name=xC,this._loader=C,this.enabled=this._loader.isExtensionUsed(xC)}dispose(){this._loader=null}static GetAvailableVariants(C){const U=this._GetExtensionMetadata(C);return U?Object.keys(U.variants):[]}getAvailableVariants(C){return nC.GetAvailableVariants(C)}static SelectVariant(C,U){const K=this._GetExtensionMetadata(C);if(!K)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${xC} extension`);const m=C=>{const U=K.variants[C];if(U)for(const K of U)K.mesh.material=K.material};if(U instanceof Array)for(const O of U)m(O);else m(U);K.lastSelected=U}selectVariant(C,U){nC.SelectVariant(C,U)}static Reset(C){const U=this._GetExtensionMetadata(C);if(!U)throw new Error(`Cannot reset on a glTF mesh that does not have the ${xC} extension`);for(const K of U.original)K.mesh.material=K.material;U.lastSelected=null}reset(C){nC.Reset(C)}static GetLastSelectedVariant(C){const U=this._GetExtensionMetadata(C);if(!U)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${xC} extension`);return U.lastSelected}getLastSelectedVariant(C){return nC.GetLastSelectedVariant(C)}static _GetExtensionMetadata(C){var U,K;return(null===C||void 0===C||null===(U=C._internalMetadata)||void 0===U||null===(K=U.Ce)||void 0===K?void 0:K[xC])||null}onLoading(){const C=this._loader.Ce.extensions;if(C&&C[this.name]){const U=C[this.name];this._variants=U.variants}}onReady(){const C=this._loader.rootBabylonMesh;if(C){var U;const K=this._loader.parent.extensionOptions[xC];null!==K&&void 0!==K&&K.defaultVariant&&nC.SelectVariant(C,K.defaultVariant),null===K||void 0===K||null===(U=K.onLoaded)||void 0===U||U.call(K,{get variants(){return nC.GetAvailableVariants(C)},get selectedVariant(){const U=nC.GetLastSelectedVariant(C);return U?Array.isArray(U)?U[0]:U:nC.GetAvailableVariants(C)[0]},set selectedVariant(U){nC.SelectVariant(C,U)}})}}_loadMeshPrimitiveAsync(C,U,K,m,O,X){return L.LoadExtensionAsync(C,O,this.name,(async(A,e)=>{const t=new Array;return t.push(this._loader._loadMeshPrimitiveAsync(C,U,K,m,O,(U=>{if(X(U),U instanceof y.b){const K=L._GetDrawMode(C,O.mode),m=this._loader.rootBabylonMesh,X=m?m._internalMetadata=m._internalMetadata||{}:{},z=X.Ce=X.Ce||{},j=z[xC]=z[xC]||{lastSelected:null,original:[],variants:{}};j.original.push({mesh:U,material:U.material});for(let C=0;C<e.mappings.length;++C){const O=e.mappings[C],X=g.Get(`${A}/mappings/${C}/material`,this._loader.Ce.materials,O.material);t.push(this._loader._loadMaterialAsync(`#/materials/${O.material}`,X,U,K,(C=>{for(let K=0;K<O.variants.length;++K){const X=O.variants[K],A=g.Get(`/extensions/${xC}/variants/${X}`,this._variants,X);j.variants[A.name]=j.variants[A.name]||[],j.variants[A.name].push({mesh:U,material:C}),U.onClonedObservable.add((C=>{const K=C;let O=null,X=K;do{if(X=X.parent,!X)return;O=nC._GetExtensionMetadata(X)}while(null===O);if(m&&O===nC._GetExtensionMetadata(m)){X._internalMetadata={};for(const C in m._internalMetadata)X._internalMetadata[C]=m._internalMetadata[C];X._internalMetadata.Ce=[];for(const C in m._internalMetadata.Ce)X._internalMetadata.Ce[C]=m._internalMetadata.Ce[C];X._internalMetadata.Ce[xC]={lastSelected:null,original:[],variants:{}};for(const C of O.original)X._internalMetadata.Ce[xC].original.push({mesh:C.mesh,material:C.material});for(const C in O.variants)if(Object.prototype.hasOwnProperty.call(O.variants,C)){X._internalMetadata.Ce[xC].variants[C]=[];for(const U of O.variants[C])X._internalMetadata.Ce[xC].variants[C].push({mesh:U.mesh,material:U.material})}O=X._internalMetadata.Ce[xC]}for(const m of O.original)m.mesh===U&&(m.mesh=K);for(const m of O.variants[A.name])m.mesh===U&&(m.mesh=K)}))}})))}}}))),await Promise.all(t).then((C=>{let[U]=C;return U}))}))}}w(xC),k(xC,!0,(C=>new nC(C)));var SC=K(11898);class sC{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:gC.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(C,U){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...sC._GetDefaultOptions(),...C},this._scene=U,this._scene._transmissionHelper=this,this.onErrorObservable=new j.b,this._scene.RA.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(C){if(!Object.keys(C).filter((U=>this._options[U]!==C[U])).length)return;const U={...this._options,...C},K=this._options;this._options=U,U.renderSize===K.renderSize&&U.renderTargetTextureType===K.renderTargetTextureType&&U.generateMipmaps===K.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=U.samples,this._opaqueRenderTarget.lodGenerationScale=U.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=U.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(C){return!!C&&!!(C instanceof F.e&&C.subSurface.isRefractionEnabled)}_addMesh(C){this._materialObservers[C.uniqueId]=C.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),A.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(C.material)?(C.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(C)&&this._transparentMeshesCache.push(C)):-1===this._opaqueMeshesCache.indexOf(C)&&this._opaqueMeshesCache.push(C)}))}_removeMesh(C){C.onMaterialChangedObservable.remove(this._materialObservers[C.uniqueId]),delete this._materialObservers[C.uniqueId];let U=this._transparentMeshesCache.indexOf(C);-1!==U&&this._transparentMeshesCache.splice(U,1),U=this._opaqueMeshesCache.indexOf(C),-1!==U&&this._opaqueMeshesCache.splice(U,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(C){const U=this._transparentMeshesCache.indexOf(C),K=this._opaqueMeshesCache.indexOf(C);this._shouldRenderAsTransmission(C.material)?(C.material instanceof F.e&&(C.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==K?(this._opaqueMeshesCache.splice(K,1),this._transparentMeshesCache.push(C)):-1===U&&this._transparentMeshesCache.push(C)):-1!==U?(this._transparentMeshesCache.splice(U,1),this._opaqueMeshesCache.push(C)):-1===K&&this._opaqueMeshesCache.push(C)}_isRenderTargetValid(){var C;return null!==(null===(C=this._opaqueRenderTarget)||void 0===C?void 0:C.getInternalTexture())}_setupRenderTargets(){var C;let U;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new SC.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(C=this._options.clearColor)||void 0===C?void 0:C.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((C=>{U=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?C.clearColor.m(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(C.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=U}));for(const K of this._transparentMeshesCache)this._shouldRenderAsTransmission(K.material)&&(K.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const RC="KHR_materials_transmission";class qC{constructor(C){this.name=RC,this.order=175,this._loader=C,this.enabled=this._loader.isExtensionUsed(RC),this.enabled&&(C.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadTransparentPropertiesAsync(m,U,K,O)),await Promise.all(X).then((()=>{}))}))}_loadTransparentPropertiesAsync(C,U,K,m){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const O=K;if(O.subSurface.isRefractionEnabled=!0,O.subSurface.volumeIndexOfRefraction=1,O.subSurface.useAlbedoToTintRefraction=!0,void 0===m.transmissionFactor)return O.subSurface.refractionIntensity=0,O.subSurface.isRefractionEnabled=!1,Promise.resolve();{var X;O.subSurface.refractionIntensity=m.transmissionFactor;const C=O.dC();if(O.subSurface.refractionIntensity&&!C._transmissionHelper)new sC({},O.dC());else if(O.subSurface.refractionIntensity&&(null===(X=C._transmissionHelper)||void 0===X||!X._isRenderTargetValid())){var A;null===(A=C._transmissionHelper)||void 0===A||A._setupRenderTargets()}}return O.subSurface.minimumThickness=0,O.subSurface.maximumThickness=0,m.transmissionTexture?(m.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${C}/transmissionTexture`,m.transmissionTexture,void 0).then((C=>{C.name=`${K.name} (Transmission)`,O.subSurface.refractionIntensityTexture=C,O.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(RC),k(RC,!0,(C=>new qC(C)));const IC="KHR_materials_diffuse_transmission";class CU{constructor(C){this.name=IC,this.order=174,this._loader=C,this.enabled=this._loader.isExtensionUsed(IC),this.enabled&&(C.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadTranslucentPropertiesAsync(m,U,K,O)),await Promise.all(X).then((()=>{}))}))}_loadTranslucentPropertiesAsync(C,U,K,m){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const O=K;if(O.subSurface.isTranslucencyEnabled=!0,O.subSurface.volumeIndexOfRefraction=1,O.subSurface.minimumThickness=0,O.subSurface.maximumThickness=0,O.subSurface.useAlbedoToTintTranslucency=!1,void 0===m.diffuseTransmissionFactor)return O.subSurface.translucencyIntensity=0,O.subSurface.isTranslucencyEnabled=!1,Promise.resolve();O.subSurface.translucencyIntensity=m.diffuseTransmissionFactor;const A=new Array;return O.subSurface.useGltfStyleTextures=!0,m.diffuseTransmissionTexture&&(m.diffuseTransmissionTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTransmissionTexture`,m.diffuseTransmissionTexture).then((C=>{C.name=`${K.name} (Diffuse Transmission)`,O.subSurface.translucencyIntensityTexture=C})))),void 0!==m.diffuseTransmissionColorFactor?O.subSurface.translucencyColor=X.fU.FU(m.diffuseTransmissionColorFactor):O.subSurface.translucencyColor=X.fU.White(),m.diffuseTransmissionColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${C}/diffuseTransmissionColorTexture`,m.diffuseTransmissionColorTexture).then((C=>{C.name=`${K.name} (Diffuse Transmission Color)`,O.subSurface.translucencyColorTexture=C}))),Promise.all(A).then((()=>{}))}}w(IC),k(IC,!0,(C=>new CU(C)));const UU="KHR_materials_volume";class KU{constructor(C){this.name=UU,this.order=173,this._loader=C,this.enabled=this._loader.isExtensionUsed(UU),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadVolumePropertiesAsync(m,U,K,O)),await Promise.all(X).then((()=>{}))}))}_loadVolumePropertiesAsync(C,U,K,m){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);if(!K.subSurface.isRefractionEnabled&&!K.subSurface.isTranslucencyEnabled||!m.thicknessFactor)return Promise.resolve();K.subSurface.volumeIndexOfRefraction=K.indexOfRefraction;const O=void 0!==m.attenuationDistance?m.attenuationDistance:Number.MAX_VALUE;return K.subSurface.tintColorAtDistance=O,void 0!==m.attenuationColor&&3==m.attenuationColor.length&&K.subSurface.tintColor.Ee(m.attenuationColor[0],m.attenuationColor[1],m.attenuationColor[2]),K.subSurface.minimumThickness=0,K.subSurface.maximumThickness=m.thicknessFactor,K.subSurface.useThicknessAsDepth=!0,m.thicknessTexture?(m.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${C}/thicknessTexture`,m.thicknessTexture).then((C=>{C.name=`${K.name} (Thickness)`,K.subSurface.thicknessTexture=C,K.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(UU),k(UU,!0,(C=>new KU(C)));const mU="KHR_materials_dispersion";class OU{constructor(C){this.name=mU,this.order=174,this._loader=C,this.enabled=this._loader.isExtensionUsed(mU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadDispersionPropertiesAsync(m,U,K,O)),await Promise.all(X).then((()=>{}))}))}_loadDispersionPropertiesAsync(C,U,K,m){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);return K.subSurface.isRefractionEnabled&&m.dispersion?(K.subSurface.isDispersionEnabled=!0,K.subSurface.dispersion=m.dispersion,Promise.resolve()):Promise.resolve()}}w(mU),k(mU,!0,(C=>new OU(C)));const XU="EXT_materials_diffuse_roughness";class AU{constructor(C){this.name=XU,this.order=190,this._loader=C,this.enabled=this._loader.isExtensionUsed(XU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=new Array;return X.push(this._loader.loadMaterialPropertiesAsync(C,U,K)),X.push(this._loadDiffuseRoughnessPropertiesAsync(m,O,K)),await Promise.all(X).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(C,U,K){if(!(K instanceof F.e))throw new Error(`${C}: Material type not supported`);const m=new Array;return K.brdf.baseDiffuseModel=gC.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=U.diffuseRoughnessFactor?K.baseDiffuseRoughness=U.diffuseRoughnessFactor:K.baseDiffuseRoughness=0,U.diffuseRoughnessTexture&&m.push(this._loader.loadTextureInfoAsync(`${C}/diffuseRoughnessTexture`,U.diffuseRoughnessTexture,(C=>{C.name=`${K.name} (Diffuse Roughness)`,K.baseDiffuseRoughnessTexture=C}))),Promise.all(m).then((()=>{}))}}w(XU),k(XU,!0,(C=>new AU(C)));const eU="KHR_mesh_quantization";class tU{constructor(C){this.name=eU,this.enabled=C.isExtensionUsed(eU)}dispose(){}}w(eU),k(eU,!0,(C=>new tU(C)));const zU="KHR_texture_basisu";class jU{constructor(C){this.name=zU,this._loader=C,this.enabled=C.isExtensionUsed(zU)}dispose(){this._loader=null}_loadTextureAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>{const X=void 0==U.sampler?L.DefaultSampler:g.Get(`${C}/sampler`,this._loader.Ce.samplers,U.sampler),A=g.Get(`${m}/source`,this._loader.Ce.images,O.source);return await this._loader._createTextureAsync(C,X,A,(C=>{K(C)}),U._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!U._textureInfo.nonColorData)}))}}w(zU),k(zU,!0,(C=>new jU(C)));const pU="KHR_texture_transform";class EU{constructor(C){this.name=pU,this._loader=C,this.enabled=this._loader.isExtensionUsed(pU)}dispose(){this._loader=null}loadTextureInfoAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(m,O)=>await this._loader.loadTextureInfoAsync(C,U,(C=>{if(!(C instanceof Z.b))throw new Error(`${m}: Texture type not supported`);O.offset&&(C.uOffset=O.offset[0],C.vOffset=O.offset[1]),C.uRotationCenter=0,C.vRotationCenter=0,O.rotation&&(C.wAng=-O.rotation),O.scale&&(C.uScale=O.scale[0],C.vScale=O.scale[1]),void 0!=O.texCoord&&(C.coordinatesIndex=O.texCoord),K(C)}))))}}w(pU),k(pU,!0,(C=>new EU(C)));const uU="KHR_xmp_json_ld";class bU{constructor(C){this.name=uU,this.order=100,this._loader=C,this.enabled=this._loader.isExtensionUsed(uU)}dispose(){this._loader=null}onLoading(){var C,U,K;if(null===this._loader.rootBabylonMesh)return;const m=null===(C=this._loader.Ce.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld,O=null===(U=this._loader.Ce.asset)||void 0===U||null===(K=U.extensions)||void 0===K?void 0:K.KHR_xmp_json_ld;if(m&&O){const C=+O.packet;m.packets&&C<m.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=m.packets[C])}}}function vU(C,U,K,m){return X.fU.FU(U,K).scale(m)}function QU(C,U,K,m){return U[K]*m}function VU(C,U,K,m){return-U[K]*m}function fU(C,U,K,m){return U[K+1]*m}function FU(C,U,K,m){return U[K]*m*2}function ZU(C){return{scale:[new HU(E.c.ANIMATIONTYPE_FLOAT,`${C}.uScale`,QU,(()=>2)),new HU(E.c.ANIMATIONTYPE_FLOAT,`${C}.vScale`,fU,(()=>2))],offset:[new HU(E.c.ANIMATIONTYPE_FLOAT,`${C}.uOffset`,QU,(()=>2)),new HU(E.c.ANIMATIONTYPE_FLOAT,`${C}.vOffset`,fU,(()=>2))],rotation:[new HU(E.c.ANIMATIONTYPE_FLOAT,`${C}.wAng`,VU,(()=>1))]}}w(uU),k(uU,!0,(C=>new bU(C)));class PU extends Y.AnimationPropertyInfo{buildAnimations(C,U,K,m){return[{babylonAnimatable:C._babylonCamera,babylonAnimation:this._buildAnimation(U,K,m)}]}}class HU extends Y.AnimationPropertyInfo{buildAnimations(C,U,K,m){const O=[];for(const X in C._data)O.push({babylonAnimatable:C._data[X].babylonMaterial,babylonAnimation:this._buildAnimation(U,K,m)});return O}}class dU extends Y.AnimationPropertyInfo{buildAnimations(C,U,K,m){return[{babylonAnimatable:C._babylonLight,babylonAnimation:this._buildAnimation(U,K,m)}]}}(0,h.m)("/cameras/{}/orthographic/xmag",[new PU(E.c.ANIMATIONTYPE_FLOAT,"orthoLeft",VU,(()=>1)),new PU(E.c.ANIMATIONTYPE_FLOAT,"orthoRight",fU,(()=>1))]),(0,h.m)("/cameras/{}/orthographic/ymag",[new PU(E.c.ANIMATIONTYPE_FLOAT,"orthoBottom",VU,(()=>1)),new PU(E.c.ANIMATIONTYPE_FLOAT,"orthoTop",fU,(()=>1))]),(0,h.m)("/cameras/{}/orthographic/zfar",[new PU(E.c.ANIMATIONTYPE_FLOAT,"maxZ",QU,(()=>1))]),(0,h.m)("/cameras/{}/orthographic/znear",[new PU(E.c.ANIMATIONTYPE_FLOAT,"Ae",QU,(()=>1))]),(0,h.m)("/cameras/{}/perspective/yfov",[new PU(E.c.ANIMATIONTYPE_FLOAT,"fov",QU,(()=>1))]),(0,h.m)("/cameras/{}/perspective/zfar",[new PU(E.c.ANIMATIONTYPE_FLOAT,"maxZ",QU,(()=>1))]),(0,h.m)("/cameras/{}/perspective/znear",[new PU(E.c.ANIMATIONTYPE_FLOAT,"Ae",QU,(()=>1))]),(0,h.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new HU(E.c.ANIMATIONTYPE_COLOR3,"albedoColor",vU,(()=>4)),new HU(E.c.ANIMATIONTYPE_FLOAT,"alpha",(function(C,U,K,m){return U[K+3]*m}),(()=>4))]),(0,h.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"metallic",QU,(()=>1))]),(0,h.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"roughness",QU,(()=>1))]);const TU=ZU("albedoTexture");(0,h.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",TU.scale),(0,h.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",TU.offset),(0,h.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",TU.rotation);const yU=ZU("metallicTexture");(0,h.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",yU.scale),(0,h.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",yU.offset),(0,h.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",yU.rotation),(0,h.m)("/materials/{}/emissiveFactor",[new HU(E.c.ANIMATIONTYPE_COLOR3,"emissiveColor",vU,(()=>3))]);const aU=ZU("bumpTexture");(0,h.m)("/materials/{}/normalTexture/scale",[new HU(E.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",QU,(()=>1))]),(0,h.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",aU.scale),(0,h.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",aU.offset),(0,h.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",aU.rotation),(0,h.m)("/materials/{}/occlusionTexture/strength",[new HU(E.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",QU,(()=>1))]);const rU=ZU("ambientTexture");(0,h.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",rU.scale),(0,h.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",rU.offset),(0,h.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",rU.rotation);const iU=ZU("emissiveTexture");(0,h.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",iU.scale),(0,h.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",iU.offset),(0,h.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",iU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new HU(E.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new HU(E.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",QU,(()=>1))]);const DU=ZU("anisotropy.texture");(0,h.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",DU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",DU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",DU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",QU,(()=>1))]);const lU=ZU("clearCoat.texture");(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",lU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",lU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",lU.rotation);const GU=ZU("clearCoat.bumpTexture");(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new HU(E.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",GU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",GU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",GU.rotation);const JU=ZU("clearCoat.textureRoughness");(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",JU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",JU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",JU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new HU(E.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new HU(E.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new HU(E.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new HU(E.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",QU,(()=>1))]);const oU=ZU("iridescence.texture");(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",oU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",oU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",oU.rotation);const BU=ZU("iridescence.thicknessTexture");(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",BU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",BU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",BU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new HU(E.c.ANIMATIONTYPE_COLOR3,"sheen.color",vU,(()=>3))]),(0,h.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",QU,(()=>1))]);const kU=ZU("sheen.texture");(0,h.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",kU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",kU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",kU.rotation);const wU=ZU("sheen.textureRoughness");(0,h.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",wU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",wU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",wU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new HU(E.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",vU,(()=>3))]);const hU=ZU("metallicReflectanceTexture");(0,h.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",hU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",hU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",hU.rotation);const cU=ZU("reflectanceTexture");(0,h.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",cU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",cU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",cU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",QU,(()=>1))]);const NU=ZU("subSurface.refractionIntensityTexture");(0,h.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",NU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",NU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",NU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new HU(E.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",vU,(()=>3))]),(0,h.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new HU(E.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",QU,(()=>1))]),(0,h.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",QU,(()=>1))]);const gU=ZU("subSurface.thicknessTexture");(0,h.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",gU.scale),(0,h.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",gU.offset),(0,h.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",gU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new HU(E.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",QU,(()=>1))]);const MU=ZU("subSurface.translucencyIntensityTexture");(0,h.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",MU.scale),(0,h.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",MU.offset),(0,h.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",MU.rotation),(0,h.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new HU(E.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",vU,(()=>3))]);const LU=ZU("subSurface.translucencyColorTexture");(0,h.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",LU.scale),(0,h.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",LU.offset),(0,h.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",LU.rotation),(0,h.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new dU(E.c.ANIMATIONTYPE_COLOR3,"diffuse",vU,(()=>3))]),(0,h.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new dU(E.c.ANIMATIONTYPE_FLOAT,"intensity",QU,(()=>1))]),(0,h.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new dU(E.c.ANIMATIONTYPE_FLOAT,"range",QU,(()=>1))]),(0,h.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new dU(E.c.ANIMATIONTYPE_FLOAT,"innerAngle",FU,(()=>1))]),(0,h.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new dU(E.c.ANIMATIONTYPE_FLOAT,"angle",FU,(()=>1))]),(0,h.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new dU(E.c.ANIMATIONTYPE_COLOR3,"diffuse",vU,(()=>3))]),(0,h.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new dU(E.c.ANIMATIONTYPE_FLOAT,"intensity",QU,(()=>1))]);const YU="KHR_animation_pointer";class WU{constructor(C){this.name=YU,this._loader=C,this._pathToObjectConverter=(0,h.k)(this._loader.Ce)}get enabled(){return this._loader.isExtensionUsed(YU)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(C,U,K,m,O){var X;const A=null===(X=m.target.extensions)||void 0===X?void 0:X.KHR_animation_pointer;if(!A||!this._pathToObjectConverter)return null;"pointer"!==m.target.path&&v.d.Warn(`${C}/target/path: Value (${m.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=m.target.node&&v.d.Warn(`${C}/target/node: Value (${m.target.node}) must not be present when using the ${this.name} extension`);const e=`${C}/extensions/${this.name}`,t=A.pointer;if(!t)throw new Error(`${e}: Pointer is missing`);try{const X=this._pathToObjectConverter.convert(t);if(!X.info.interpolation)throw new Error(`${e}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(C,U,K,m,{object:X.object,info:X.info.interpolation},O)}catch(z){return v.d.Warn(`${e}/pointer: Invalid pointer (${t}) skipped`),null}}}w(YU),k(YU,!0,(C=>new WU(C)));class xU{constructor(C,U,K){this.frame=C,this.action=U,this.onlyOnce=K,this.isDone=!1}_clone(){return new xU(this.frame,this.action,this.onlyOnce)}}var nU=K(11696),SU=K(11735),sU=K(11733);class RU{get loop(){return this._loop}set loop(C){C!==this._loop&&(this._loop=C,this.updateOptions({loop:C}))}get currentTime(){var C;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(C=SU.b.audioEngine)&&void 0!==C&&C.audioContext&&(this.isPlaying||this.isPaused)){const C=this.isPaused?0:SU.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+C}return 0}get spatialSound(){return this._spatialSound}set spatialSound(C){if(C==this._spatialSound)return;const U=this.isPlaying;this.pause(),C?(this._spatialSound=C,this._updateSpatialParameters()):this._disableSpatialSound(),U&&this.play()}constructor(C,U,K){var m;let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new j.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=O.bU.Zero(),this._localDirection=new O.bU(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=C,K=K||b.c.LastCreatedScene)if(this._scene=K,RU._SceneComponentInitialization(K),this._readyToPlayCallback=X,this._customAttenuationFunction=(C,U,K,m,O)=>U<K?C*(1-U/K):0,e&&(this.autoplay=e.autoplay||!1,this._loop=e.loop||!1,void 0!==e.volume&&(this._volume=e.volume),this._spatialSound=e.spatialSound??!1,this.maxDistance=e.maxDistance??100,this.useCustomAttenuation=e.useCustomAttenuation??!1,this.rolloffFactor=e.rolloffFactor||1,this.refDistance=e.refDistance||1,this.distanceModel=e.distanceModel||"linear",this._playbackRate=e.playbackRate||1,this._streaming=e.streaming??!1,this._length=e.length,this._offset=e.offset),null!==(m=SU.b.audioEngine)&&void 0!==m&&m.canUseWebAudio&&SU.b.audioEngine.audioContext){this._soundGain=SU.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let C=!0;if(U)try{"string"===typeof U?(this._urlType="String",this._url=U):U instanceof ArrayBuffer?this._urlType="ArrayBuffer":U instanceof HTMLMediaElement?this._urlType="MediaElement":U instanceof MediaStream?this._urlType="MediaStream":U instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(U)&&(this._urlType="Array");let K=[],m=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=SU.b.audioEngine.audioContext.createMediaElementSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=SU.b.audioEngine.audioContext.createMediaStreamSource(U),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":U.byteLength>0&&(m=!0,this._soundLoaded(U));break;case"AudioBuffer":this._audioBufferLoaded(U);break;case"String":K.push(U);case"Array":0===K.length&&(K=U);for(let C=0;C<K.length;C++){const U=K[C];if(m=e&&e.skipCodecCheck||-1!==U.indexOf(".mp3",U.length-4)&&SU.b.audioEngine.isMP3supported||-1!==U.indexOf(".ogg",U.length-4)&&SU.b.audioEngine.isOGGsupported||-1!==U.indexOf(".wav",U.length-4)||-1!==U.indexOf(".m4a",U.length-4)||-1!==U.indexOf(".mp4",U.length-4)||-1!==U.indexOf("blob:"),m){this._streaming?(this._htmlAudioElement=new Audio(U),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,A.Tools.SetCorsBehavior(U,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(U,(C=>{this._soundLoaded(C)}),void 0,!0,!0,(C=>{C&&v.d.Error("XHR "+C.status+" error on: "+U+"."),v.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:C=!1}C?m||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):v.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(t){v.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),SU.b.audioEngine&&!SU.b.audioEngine.WarnedWebAudioUnsupported&&(v.d.Error("Web Audio is not supported by your browser."),SU.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var C;null!==(C=SU.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(C){var U;null!==(U=SU.b.audioEngine)&&void 0!==U&&U.audioContext&&(this._audioBuffer=C,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(C){var U;null!==(U=SU.b.audioEngine)&&void 0!==U&&U.audioContext&&SU.b.audioEngine.audioContext.decodeAudioData(C,(C=>{this._audioBufferLoaded(C)}),(C=>{v.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+C)}))}setAudioBuffer(C){var U;null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this._audioBuffer=C,this._isReadyToPlay=!0)}updateOptions(C){C&&(this.loop=C.loop??this.loop,this.maxDistance=C.maxDistance??this.maxDistance,this.useCustomAttenuation=C.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=C.rolloffFactor??this.rolloffFactor,this.refDistance=C.refDistance??this.refDistance,this.distanceModel=C.distanceModel??this.distanceModel,this._playbackRate=C.playbackRate??this._playbackRate,this._length=C.length??void 0,this.spatialSound=C.spatialSound??this._spatialSound,this._setOffset(C.offset??void 0),this.setVolume(C.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var C;null!==(C=SU.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&SU.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??SU.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var C;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(C=this._soundPanner)||void 0===C||C.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var C;null!==(C=SU.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(C){var U;null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(C),this._isOutputConnected=!0)}setDirectionalCone(C,U,K){U<C?v.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=C,this._coneOuterAngle=U,this._coneOuterGain=K,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(C){if(C!=this._coneInnerAngle){var U;if(this._coneOuterAngle<C)return void v.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=C,null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(C){if(C!=this._coneOuterAngle){var U;if(C<this._coneInnerAngle)return void v.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=C,null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(C){var U;C.equals(this._position)||(this._position.m(C),null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(C){var U;this._localDirection=C,null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const C=this._connectedTransformNode.getWorldMatrix(),U=O.bU.TransformNormal(this._localDirection,C);U.normalize(),this._soundPanner.orientationX.value=U.x,this._soundPanner.orientationY.value=U.y,this._soundPanner.orientationZ.value=U.z}updateDistanceFromListener(){var C;if(null!==(C=SU.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const C=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.vU(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,C,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(C){this._customAttenuationFunction=C}play(C,U,K){var m;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(m=SU.b.audioEngine)&&void 0!==m&&m.audioContext)try{var O,X;this._clearTimeoutsAndObservers();let m=C?(null===(O=SU.b.audioEngine)||void 0===O?void 0:O.audioContext.currentTime)+C:null===(X=SU.b.audioEngine)||void 0===X?void 0:X.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=SU.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const C=()=>{var K;if(null!==(K=SU.b.audioEngine)&&void 0!==K&&K.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=U??0;const K=this._htmlAudioElement.play();void 0!==K&&K.catch((()=>{var U,K;(null===(U=SU.b.audioEngine)||void 0===U||U.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(K=SU.b.audioEngine)||void 0===K?void 0:K.onAudioUnlockedObservable.addOnce((()=>{C()})))}))}else{var m;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(m=SU.b.audioEngine)||void 0===m?void 0:m.onAudioUnlockedObservable.addOnce((()=>{C()}))}};C()}}else{var A;const O=()=>{var O;if(null!==(O=SU.b.audioEngine)&&void 0!==O&&O.audioContext){var X;if(K=K||this._length,void 0!==U&&this._setOffset(U),this._soundSource){const C=this._soundSource;C.onended=()=>{C.disconnect()}}if(this._soundSource=null===(X=SU.b.audioEngine)||void 0===X?void 0:X.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var A;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==U&&(this._soundSource.loopStart=U),void 0!==K&&(this._soundSource.loopEnd=(0|U)+K),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},m=C?(null===(A=SU.b.audioEngine)||void 0===A?void 0:A.audioContext.currentTime)+C:SU.b.audioEngine.audioContext.currentTime;const O=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(m,O,this.loop?void 0:K)}}};"suspended"===(null===(A=SU.b.audioEngine)||void 0===A?void 0:A.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var C;"suspended"===(null===(C=SU.b.audioEngine)||void 0===C?void 0:C.audioContext.state)?(SU.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=SU.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{O()})))):O()}),500):O()}this._startTime=m,this.isPlaying=!0,this.isPaused=!1}catch(e){v.d.Error("Error while trying to play audio: "+this.name+", "+e.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(C){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var K;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(K=this._streamingSource)||void 0===K||K.disconnect();this.isPlaying=!1}else if(null!==(U=SU.b.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource){const U=C?SU.b.audioEngine.audioContext.currentTime+C:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(U)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var C;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var U;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(U=this._streamingSource)||void 0===U||U.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(C=SU.b.audioEngine)&&void 0!==C&&C.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=SU.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(C,U){var K;null!==(K=SU.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._soundGain&&(U&&SU.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(SU.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,SU.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(C,SU.b.audioEngine.audioContext.currentTime+U)):this._soundGain.gain.value=C),this._volume=C}setPlaybackRate(C){this._playbackRate=C,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(C){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=C,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=C=>this._onRegisterAfterWorldMatrixUpdate(C),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(C){var U;if(C.getBoundingInfo){const U=C.getBoundingInfo();this.setPosition(U.boundingSphere.centerWorld)}else this.setPosition(C.absolutePosition);null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const C=()=>{(0,sU.c)((()=>this._isReadyToPlay),(()=>{K._audioBuffer=this.getAudioBuffer(),K._isReadyToPlay=!0,K.autoplay&&K.play(0,this._offset,this._length)}),void 0,300)},U={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},K=new RU(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,U);return this.useCustomAttenuation&&K.setAttenuationFunction(this._customAttenuationFunction),K.setPosition(this._position),K.setPlaybackRate(this._playbackRate),C(),K}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const C={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(C.connectedMeshId=this._connectedTransformNode.id),C.position=this._position.Oe(),C.refDistance=this.refDistance,C.distanceModel=this.distanceModel,C.isDirectional=this._isDirectional,C.localDirectionToMesh=this._localDirection.Oe(),C.coneInnerAngle=this._coneInnerAngle,C.coneOuterAngle=this._coneOuterAngle,C.coneOuterGain=this._coneOuterGain),C}static Parse(C,U,K,m){const X=C.name;let A;A=C.url?K+C.url:K+X;const e={autoplay:C.autoplay,loop:C.loop,volume:C.volume,spatialSound:C.spatialSound,maxDistance:C.maxDistance,rolloffFactor:C.rolloffFactor,refDistance:C.refDistance,distanceModel:C.distanceModel,playbackRate:C.playbackRate};let t;if(m){const C=()=>{(0,sU.c)((()=>m._isReadyToPlay),(()=>{t._audioBuffer=m.getAudioBuffer(),t._isReadyToPlay=!0,t.autoplay&&t.play(0,t._offset,t._length)}),void 0,300)};t=new RU(X,new ArrayBuffer(0),U,null,e),C()}else t=new RU(X,A,U,(()=>{U.removePendingData(t)}),e),U.addPendingData(t);if(C.position){const U=O.bU.FU(C.position);t.setPosition(U)}if(C.isDirectional&&(t.setDirectionalCone(C.coneInnerAngle||360,C.coneOuterAngle||360,C.coneOuterGain||0),C.localDirectionToMesh)){const U=O.bU.FU(C.localDirectionToMesh);t.setLocalDirectionToMesh(U)}if(C.connectedMeshId){const K=U.getMeshById(C.connectedMeshId);K&&t.attachToMesh(K)}return C.metadata&&(t.metadata=C.metadata),t}_setOffset(C){this._offset!==C&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=C)}_clearTimeoutsAndObservers(){var C;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(C=SU.b.audioEngine)||void 0===C||C.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}RU._SceneComponentInitialization=C=>{throw(0,nU.b)("AudioSceneComponent")},(0,HC.h)("BABYLON.Sound",RU);class qU{constructor(C,U,K){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],U.length!==K.length)throw new Error("Sounds length does not equal weights length");this.loop=C,this._weights=K;let m=0;for(const X of K)m+=X;const O=m>0?1/m:0;for(let X=0;X<this._weights.length;X++)this._weights[X]*=O;this._sounds=U;for(const X of this._sounds)X.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(C){if(C!==this._coneInnerAngle){if(this._coneOuterAngle<C)return void v.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=C;for(const U of this._sounds)U.directionalConeInnerAngle=C}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(C){if(C!==this._coneOuterAngle){if(C<this._coneInnerAngle)return void v.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=C;for(const U of this._sounds)U.directionalConeOuterAngle=C}}get volume(){return this._volume}set volume(C){if(C!==this._volume)for(const U of this._sounds)U.setVolume(C)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(C){if(!this.isPaused){this.stop();const C=Math.random();let U=0;for(let K=0;K<this._weights.length;K++)if(U+=this._weights[K],C<=U){this._currentIndex=K;break}}const U=this._sounds[this._currentIndex??0];U.isReady()?U.play(0,this.isPaused?void 0:C):U.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class IU{constructor(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(C=C||b.c.LastCreatedScene)&&(this._scene=C,this.soundCollection=[],this._options=U,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var C;null!==(C=SU.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&SU.b.audioEngine.audioContext&&(this._outputAudioNode=SU.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(SU.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(SU.b.audioEngine&&SU.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(C){var U;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&C.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==C.soundTrackId&&(-1===C.soundTrackId?this._scene.mainSoundTrack.removeSound(C):this._scene.soundTracks&&this._scene.soundTracks[C.soundTrackId].removeSound(C)),this.soundCollection.push(C),C.soundTrackId=this.id}removeSound(C){const U=this.soundCollection.indexOf(C);-1!==U&&this.soundCollection.splice(U,1)}setVolume(C){var U;null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=C)}switchPanningModelToHRTF(){var C;if(null!==(C=SU.b.audioEngine)&&void 0!==C&&C.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var C;if(null!==(C=SU.b.audioEngine)&&void 0!==C&&C.canUseWebAudio)for(let U=0;U<this.soundCollection.length;U++)this.soundCollection[U].switchPanningModelToEqualPower()}connectToAnalyser(C){var U;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=C,null!==(U=SU.b.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,SU.b.audioEngine.masterGain))}}var CK=K(12109),UK=K(12078),KK=K(11670);SU.b.AudioEngineFactory=(C,U,K)=>new mK(C,U,K);class mK{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new j.b,this.onAudioLockedObservable=new j.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,KK.g)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const m=document.createElement("audio");this._hostElement=C,this._audioContext=U,this._audioDestination=K;try{m&&m.canPlayType&&(m.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||m.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(O){}try{m&&m.canPlayType&&m.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(O){}}lock(){this._triggerSuspendedState()}unlock(){var C,U;if("running"===(null===(C=this._audioContext)||void 0===C?void 0:C.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(U=this._audioContext)||void 0===U||U.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{v.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var C;null===(C=this._audioContext)||void 0===C||C.addEventListener("statechange",(()=>{var C;this.unlocked&&"running"!==(null===(C=this._audioContext)||void 0===C?void 0:C.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var C;return null!==(C=this._audioContext)&&void 0!==C&&C.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(C){this.canUseWebAudio=!1,v.d.Error("Web Audio: "+C.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(C){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const C=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",U=document.createElement("style");U.appendChild(document.createTextNode(C)),document.getElementsByTagName("head")[0].appendChild(U),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var C;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(C=this._audioContext)||void 0===C||C.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(C){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=C)}connectToAnalyser(C){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=C,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var OK=K(11688);(0,K(13166).e)(CK.d.NAME_AUDIO,((C,U,K,m)=>{let O,X=[];if(K.NE=K.NE||[],void 0!==C.NE&&null!==C.NE)for(let e=0,t=C.NE.length;e<t;e++){var A;const t=C.NE[e];null!==(A=SU.b.audioEngine)&&void 0!==A&&A.canUseWebAudio?(t.url||(t.url=t.name),X[t.url]?K.NE.push(RU.Parse(t,U,m,X[t.url])):(O=RU.Parse(t,U,m),X[t.url]=O,K.NE.push(O))):K.NE.push(new RU(t.name,null,U))}X=[]})),Object.defineProperty(UK.b.prototype,"mainSoundTrack",{get:function(){let C=this._getComponent(CK.d.NAME_AUDIO);return C||(C=new XK(this),this.SA(C)),this._mainSoundTrack||(this._mainSoundTrack=new IU(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),UK.b.prototype.getSoundByName=function(C){let U;for(U=0;U<this.mainSoundTrack.soundCollection.length;U++)if(this.mainSoundTrack.soundCollection[U].name===C)return this.mainSoundTrack.soundCollection[U];if(this.soundTracks)for(let K=0;K<this.soundTracks.length;K++)for(U=0;U<this.soundTracks[K].soundCollection.length;U++)if(this.soundTracks[K].soundCollection[U].name===C)return this.soundTracks[K].soundCollection[U];return null},Object.defineProperty(UK.b.prototype,"audioEnabled",{get:function(){let C=this._getComponent(CK.d.NAME_AUDIO);return C||(C=new XK(this),this.SA(C)),C.audioEnabled},set:function(C){let U=this._getComponent(CK.d.NAME_AUDIO);U||(U=new XK(this),this.SA(U)),C?U.enableAudio():U.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(UK.b.prototype,"headphone",{get:function(){let C=this._getComponent(CK.d.NAME_AUDIO);return C||(C=new XK(this),this.SA(C)),C.headphone},set:function(C){let U=this._getComponent(CK.d.NAME_AUDIO);U||(U=new XK(this),this.SA(U)),C?U.switchAudioModeForHeadphones():U.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(UK.b.prototype,"audioListenerPositionProvider",{get:function(){let C=this._getComponent(CK.d.NAME_AUDIO);return C||(C=new XK(this),this.SA(C)),C.audioListenerPositionProvider},set:function(C){let U=this._getComponent(CK.d.NAME_AUDIO);if(U||(U=new XK(this),this.SA(U)),C&&"function"!==typeof C)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");U.audioListenerPositionProvider=C},enumerable:!0,configurable:!0}),Object.defineProperty(UK.b.prototype,"audioListenerRotationProvider",{get:function(){let C=this._getComponent(CK.d.NAME_AUDIO);return C||(C=new XK(this),this.SA(C)),C.audioListenerRotationProvider},set:function(C){let U=this._getComponent(CK.d.NAME_AUDIO);if(U||(U=new XK(this),this.SA(U)),C&&"function"!==typeof C)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");U.audioListenerRotationProvider=C},enumerable:!0,configurable:!0}),Object.defineProperty(UK.b.prototype,"audioPositioningRefreshRate",{get:function(){let C=this._getComponent(CK.d.NAME_AUDIO);return C||(C=new XK(this),this.SA(C)),C.audioPositioningRefreshRate},set:function(C){let U=this._getComponent(CK.d.NAME_AUDIO);U||(U=new XK(this),this.SA(U)),U.audioPositioningRefreshRate=C},enumerable:!0,configurable:!0});class XK{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(C){this.name=CK.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new O.bU,this._cachedCameraPosition=new O.bU,this._lastCheck=0,this._invertMatrixTemp=new O.Matrix,this._cameraDirectionTemp=new O.bU,(C=C||b.c.LastCreatedScene)&&(this.QU=C,C.soundTracks=[],C.NE=[])}register(){this.QU._afterRenderStage.registerStep(CK.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(C){if(C.NE=[],this.QU.soundTracks)for(let U=0;U<this.QU.soundTracks.length;U++){const K=this.QU.soundTracks[U];for(let U=0;U<K.soundCollection.length;U++)C.NE.push(K.soundCollection[U].serialize())}}addFromContainer(C){if(C.NE)for(const U of C.NE)U.play(),U.autoplay=!0,this.QU.mainSoundTrack.addSound(U)}removeFromContainer(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(C.NE)for(const K of C.NE)K.stop(),K.autoplay=!1,this.QU.mainSoundTrack.removeSound(K),U&&K.dispose()}dispose(){const C=this.QU;if(C._mainSoundTrack&&C.mainSoundTrack.dispose(),C.soundTracks)for(let U=0;U<C.soundTracks.length;U++)C.soundTracks[U].dispose()}disableAudio(){const C=this.QU;let U;for(this._audioEnabled=!1,SU.b.audioEngine&&SU.b.audioEngine.audioContext&&SU.b.audioEngine.audioContext.suspend(),U=0;U<C.mainSoundTrack.soundCollection.length;U++)C.mainSoundTrack.soundCollection[U].pause();if(C.soundTracks)for(U=0;U<C.soundTracks.length;U++)for(let K=0;K<C.soundTracks[U].soundCollection.length;K++)C.soundTracks[U].soundCollection[K].pause()}enableAudio(){const C=this.QU;let U;for(this._audioEnabled=!0,SU.b.audioEngine&&SU.b.audioEngine.audioContext&&SU.b.audioEngine.audioContext.resume(),U=0;U<C.mainSoundTrack.soundCollection.length;U++)C.mainSoundTrack.soundCollection[U].isPaused&&C.mainSoundTrack.soundCollection[U].play();if(C.soundTracks)for(U=0;U<C.soundTracks.length;U++)for(let K=0;K<C.soundTracks[U].soundCollection.length;K++)C.soundTracks[U].soundCollection[K].isPaused&&C.soundTracks[U].soundCollection[K].play()}switchAudioModeForHeadphones(){const C=this.QU;if(this._headphone=!0,C.mainSoundTrack.switchPanningModelToHRTF(),C.soundTracks)for(let U=0;U<C.soundTracks.length;U++)C.soundTracks[U].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const C=this.QU;if(this._headphone=!1,C.mainSoundTrack.switchPanningModelToEqualPower(),C.soundTracks)for(let U=0;U<C.soundTracks.length;U++)C.soundTracks[U].switchPanningModelToEqualPower()}_afterRender(){const C=OK.c.Now;if(this._lastCheck&&C-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=C;const U=this.QU;if(!this._audioEnabled||!U._mainSoundTrack||!U.soundTracks||0===U._mainSoundTrack.soundCollection.length&&1===U.soundTracks.length)return;const K=SU.b.audioEngine;if(K&&K.audioContext){let C,m=U.activeCamera;if(U.activeCameras&&U.activeCameras.length>0&&(m=U.activeCameras[0]),this.audioListenerPositionProvider){const C=this.audioListenerPositionProvider();K.audioContext.listener.setPosition(C.x||0,C.y||0,C.z||0)}else m?this._cachedCameraPosition.equals(m.globalPosition)||(this._cachedCameraPosition.m(m.globalPosition),K.audioContext.listener.setPosition(m.globalPosition.x,m.globalPosition.y,m.globalPosition.z)):K.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const C=this.audioListenerRotationProvider();K.audioContext.listener.setOrientation(C.x||0,C.y||0,C.z||0,0,1,0)}else m?(m.rigCameras&&m.rigCameras.length>0&&(m=m.rigCameras[0]),m.getViewMatrix().invertToRef(this._invertMatrixTemp),O.bU.TransformNormalToRef(XK._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.m(this._cameraDirectionTemp),K.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):K.audioContext.listener.setOrientation(0,0,0,0,1,0);for(C=0;C<U.mainSoundTrack.soundCollection.length;C++){const K=U.mainSoundTrack.soundCollection[C];K.useCustomAttenuation&&K.updateDistanceFromListener()}if(U.soundTracks)for(C=0;C<U.soundTracks.length;C++)for(let K=0;K<U.soundTracks[C].soundCollection.length;K++){const m=U.soundTracks[C].soundCollection[K];m.useCustomAttenuation&&m.updateDistanceFromListener()}}}}XK._CameraDirection=new O.bU(0,0,-1),RU._SceneComponentInitialization=C=>{let U=C._getComponent(CK.d.NAME_AUDIO);U||(U=new XK(C),C.SA(U))};const AK="MSFT_audio_emitter";class eK{constructor(C){this.name=AK,this._loader=C,this.enabled=this._loader.isExtensionUsed(AK)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const C=this._loader.Ce.extensions;if(C&&C[this.name]){const U=C[this.name];this._clips=U.clips,this._emitters=U.emitters,g.Assign(this._clips),g.Assign(this._emitters)}}loadSceneAsync(C,U){return L.LoadExtensionAsync(C,U,this.name,(async(K,m)=>{const O=new Array;O.push(this._loader.loadSceneAsync(C,U));for(const C of m.emitters){const U=g.Get(`${K}/emitters`,this._emitters,C);if(void 0!=U.refDistance||void 0!=U.maxDistance||void 0!=U.rolloffFactor||void 0!=U.distanceModel||void 0!=U.innerAngle||void 0!=U.outerAngle)throw new Error(`${K}: Direction or Distance properties are not allowed on emitters attached to a scene`);O.push(this._loadEmitterAsync(`${K}/emitters/${U.index}`,U))}await Promise.all(O)}))}loadNodeAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(C,m)=>{const X=new Array,e=await this._loader.loadNodeAsync(C,U,(U=>{for(const K of m.emitters){const m=g.Get(`${C}/emitters`,this._emitters,K);X.push(this._loadEmitterAsync(`${C}/emitters/${m.index}`,m).then((()=>{for(const C of m._babylonSounds)C.attachToMesh(U),void 0==m.innerAngle&&void 0==m.outerAngle||(C.setLocalDirectionToMesh(O.bU.Forward()),C.setDirectionalCone(2*A.Tools.ToDegrees(void 0==m.innerAngle?Math.PI:m.innerAngle),2*A.Tools.ToDegrees(void 0==m.outerAngle?Math.PI:m.outerAngle),0))})))}K(U)}));return await Promise.all(X),e}))}loadAnimationAsync(C,U){return L.LoadExtensionAsync(C,U,this.name,(async(K,m)=>{const O=await this._loader.loadAnimationAsync(C,U),X=new Array;g.Assign(m.events);for(const A of m.events)X.push(this._loadAnimationEventAsync(`${K}/events/${A.index}`,C,U,A,O));return await Promise.all(X),O}))}_loadClipAsync(C,U){if(U._objectURL)return U._objectURL;let K;if(U.uri)K=this._loader.loadUriAsync(C,U,U.uri);else{const m=g.Get(`${C}/bufferView`,this._loader.Ce.bufferViews,U.bufferView);K=this._loader.loadBufferViewAsync(`/bufferViews/${m.index}`,m)}return U._objectURL=K.then((C=>URL.createObjectURL(new Blob([C],{type:U.mimeType})))),U._objectURL}_loadEmitterAsync(C,U){if(U._babylonSounds=U._babylonSounds||[],!U._babylonData){const C=new Array,K=U.name||`emitter${U.index}`,m={loop:!1,autoplay:!1,volume:void 0==U.volume?1:U.volume};for(let X=0;X<U.clips.length;X++){const O=`/extensions/${this.name}/clips`,A=g.Get(O,this._clips,U.clips[X].clip);C.push(this._loadClipAsync(`${O}/${U.clips[X].clip}`,A).then((C=>{const O=U._babylonSounds[X]=new RU(K,C,this._loader.babylonScene,null,m);O.refDistance=U.refDistance||1,O.maxDistance=U.maxDistance||256,O.rolloffFactor=U.rolloffFactor||1,O.distanceModel=U.distanceModel||"exponential"})))}const O=Promise.all(C).then((()=>{const C=U.clips.map((C=>C.weight||1)),K=new qU(U.loop||!1,U._babylonSounds,C);U.innerAngle&&(K.directionalConeInnerAngle=2*A.Tools.ToDegrees(U.innerAngle)),U.outerAngle&&(K.directionalConeOuterAngle=2*A.Tools.ToDegrees(U.outerAngle)),U.volume&&(K.volume=U.volume),U._babylonData.sound=K}));U._babylonData={loaded:O}}return U._babylonData.loaded}_getEventAction(C,U,K,m,O){switch(K){case"play":return C=>{const K=(O||0)+(C-m);U.play(K)};case"stop":return()=>{U.stop()};case"pause":return()=>{U.pause()};default:throw new Error(`${C}: Unsupported action ${K}`)}}_loadAnimationEventAsync(C,U,K,m,O){if(0==O.targetedAnimations.length)return Promise.resolve();const X=O.targetedAnimations[0],A=m.mU,e=g.Get(`/extensions/${this.name}/emitters`,this._emitters,A);return this._loadEmitterAsync(C,e).then((()=>{const U=e._babylonData.sound;if(U){const K=new xU(m.time,this._getEventAction(C,U,m.action,m.time,m.startOffset));X.animation.addEvent(K),O.onAnimationGroupEndObservable.add((()=>{U.stop()})),O.onAnimationGroupPauseObservable.add((()=>{U.pause()}))}}))}}w(AK),k(AK,!0,(C=>new eK(C)));const tK="MSFT_lod";class zK{constructor(C){var U;this.name=tK,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new j.b,this.onMaterialLODsLoadedObservable=new j.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=C,this.maxLODsToLoad=(null===(U=this._loader.parent.extensionOptions[tK])||void 0===U?void 0:U.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(tK)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let C=0;C<this._nodePromiseLODs.length;C++){const U=Promise.all(this._nodePromiseLODs[C]).then((()=>{0!==C&&(this._loader.endPerformanceCounter(`Node LOD ${C}`),this._loader.log(`Loaded node LOD ${C}`)),this.onNodeLODsLoadedObservable.notifyObservers(C),C!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${C+1}`),this._loadBufferLOD(this._nodeBufferLODs,C+1),this._nodeSignalLODs[C]&&this._nodeSignalLODs[C].resolve())}));this._loader._completePromises.push(U)}for(let C=0;C<this._materialPromiseLODs.length;C++){const U=Promise.all(this._materialPromiseLODs[C]).then((()=>{0!==C&&(this._loader.endPerformanceCounter(`Material LOD ${C}`),this._loader.log(`Loaded material LOD ${C}`)),this.onMaterialLODsLoadedObservable.notifyObservers(C),C!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${C+1}`),this._loadBufferLOD(this._materialBufferLODs,C+1),this._materialSignalLODs[C]&&this._materialSignalLODs[C].resolve())}));this._loader._completePromises.push(U)}}loadSceneAsync(C,U){const K=this._loader.loadSceneAsync(C,U);return this._loadBufferLOD(this._bufferLODs,0),K}loadNodeAsync(C,U,K){return L.LoadExtensionAsync(C,U,this.name,(async(C,O)=>{let X;const A=this._getLODs(C,U,this._loader.Ce.nodes,O.ids);this._loader.logOpen(`${C}`);for(let U=0;U<A.length;U++){const C=A[U];0!==U&&(this._nodeIndexLOD=U,this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new m);const O=C=>{K(C),C.Me(!1)},e=this._loader.loadNodeAsync(`/nodes/${C.index}`,C,O).then((C=>{if(0!==U){const C=A[U-1];C._babylonTransformNode&&(this._disposeTransformNode(C._babylonTransformNode),delete C._babylonTransformNode)}return C.Me(!0),C}));this._nodePromiseLODs[U]=this._nodePromiseLODs[U]||[],0===U?X=e:(this._nodeIndexLOD=null,this._nodePromiseLODs[U].push(e))}return this._loader.logClose(),await X}))}_loadMaterialAsync(C,U,K,m,O){return this._nodeIndexLOD?null:L.LoadExtensionAsync(C,U,this.name,(async(C,X)=>{let A;const e=this._getLODs(C,U,this._loader.Ce.materials,X.ids);this._loader.logOpen(`${C}`);for(let U=0;U<e.length;U++){const C=e[U];0!==U&&(this._materialIndexLOD=U);const X=this._loader._loadMaterialAsync(`/materials/${C.index}`,C,K,m,(C=>{0===U&&O(C)})).then((C=>{if(0!==U){O(C);const K=e[U-1]._data;K[m]&&(this._disposeMaterials([K[m].babylonMaterial]),delete K[m])}return C}));this._materialPromiseLODs[U]=this._materialPromiseLODs[U]||[],0===U?A=X:(this._materialIndexLOD=null,this._materialPromiseLODs[U].push(X))}return this._loader.logClose(),await A}))}_loadUriAsync(C,U,K){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const O=this._nodeIndexLOD-1;return this._nodeSignalLODs[O]=this._nodeSignalLODs[O]||new m,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(C,U,K)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const O=this._materialIndexLOD-1;return this._materialSignalLODs[O]=this._materialSignalLODs[O]||new m,this._materialSignalLODs[O].promise.then((async()=>await this._loader.loadUriAsync(C,U,K)))}return null}loadBufferAsync(C,U,K,O){if(this._loader.parent.useRangeRequests&&!U.uri){if(!this._loader.bin)throw new Error(`${C}: Uri is missing or the binary glTF is missing its binary chunk`);const U=async(C,U)=>{const X=K,A=X+O-1;let e=C[U];return e?(e.start=Math.min(e.start,X),e.end=Math.max(e.end,A)):(e={start:X,end:A,loaded:new m},C[U]=e),await e.loaded.promise.then((C=>new Uint8Array(C.buffer,C.byteOffset+K-e.start,O)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?U(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?U(this._materialBufferLODs,this._materialIndexLOD):U(this._bufferLODs,0)}return null}_loadBufferLOD(C,U){const K=C[U];K&&(this._loader.log(`Loading buffer range [${K.start}-${K.end}]`),this._loader.bin.readAsync(K.start,K.end-K.start+1).then((C=>{K.loaded.resolve(C)}),(C=>{K.loaded.reject(C)})))}_getLODs(C,U,K,m){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const O=[];for(let X=m.length-1;X>=0;X--)if(O.push(g.Get(`${C}/ids/${m[X]}`,K,m[X])),O.length===this.maxLODsToLoad)return O;return O.push(U),O}_disposeTransformNode(C){const U=[],K=C.material;K&&U.push(K);for(const O of C.getChildMeshes())O.material&&U.push(O.material);C.dispose();const m=U.filter((C=>this._loader.babylonScene.meshes.every((U=>U.material!=C))));this._disposeMaterials(m)}_disposeMaterials(C){const U={};for(const K of C){for(const C of K.getActiveTextures())U[C.uniqueId]=C;K.dispose()}for(const K in U)for(const C of this._loader.babylonScene.materials)C.hasTexture(U[K])&&delete U[K];for(const K in U)U[K].dispose()}}w(tK),k(tK,!0,(C=>new zK(C)));const jK="MSFT_minecraftMesh";class pK{constructor(C){this.name=jK,this._loader=C,this.enabled=this._loader.isExtensionUsed(jK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtraAsync(C,U,this.name,(async(m,O)=>{if(O){if(!(K instanceof F.e))throw new Error(`${m}: Material type not supported`);const O=this._loader.loadMaterialPropertiesAsync(C,U,K);return K.needAlphaBlending()&&(K.forceDepthWrite=!0,K.separateCullingPass=!0),K.pe=K.forceDepthWrite,K.twoSidedLighting=!0,await O}}))}}w(jK),k(jK,!0,(C=>new pK(C)));const EK="MSFT_sRGBFactors";class uK{constructor(C){this.name=EK,this._loader=C,this.enabled=this._loader.isExtensionUsed(EK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(C,U,K){return L.LoadExtraAsync(C,U,this.name,(async(m,O)=>{if(O){if(!(K instanceof F.e))throw new Error(`${m}: Material type not supported`);const O=this._loader.loadMaterialPropertiesAsync(C,U,K),X=K.dC().getEngine().useExactSrgbConversions;return K.albedoTexture||K.albedoColor.toLinearSpaceToRef(K.albedoColor,X),K.reflectivityTexture||K.reflectivityColor.toLinearSpaceToRef(K.reflectivityColor,X),await O}}))}}w(EK),k(EK,!0,(C=>new uK(C)));var bK=K(13495);const vK={};var QK=K(13556),VK=K(13531),fK=K(13502),FK=K(13514);function ZK(C,U){for(const K of C)for(const C of K.dataOutputs)if(C.uniqueId===U)return C;throw new Error("Could not find data out connection with unique id "+U)}function PK(C,U){for(const K of C)if(K instanceof VK.e)for(const C of K.signalInputs)if(C.uniqueId===U)return C;throw new Error("Could not find signal in connection with unique id "+U)}async function HK(C,U){const m=await Promise.all(C.allBlocks.map((async C=>{const U=function(C){switch(C){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([K.e(78),K.e(79)]).then(K.bind(K,14947))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await K.e(80).then(K.bind(K,14950))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await K.e(81).then(K.bind(K,14953))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await K.e(82).then(K.bind(K,14958))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await K.e(83).then(K.bind(K,14963))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await K.e(84).then(K.bind(K,14965))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await K.e(85).then(K.bind(K,14971))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await K.e(86).then(K.bind(K,14979))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await K.e(87).then(K.bind(K,14981))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await K.e(90).then(K.bind(K,15009))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await K.e(90).then(K.bind(K,15009))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await K.e(90).then(K.bind(K,15009))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await K.e(90).then(K.bind(K,15009))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await K.e(95).then(K.bind(K,15011))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await K.e(96).then(K.bind(K,15017))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await K.e(97).then(K.bind(K,15022))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await K.e(98).then(K.bind(K,15029))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await K.e(99).then(K.bind(K,15038))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await K.e(100).then(K.bind(K,15046))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await K.e(101).then(K.bind(K,15054))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await K.e(102).then(K.bind(K,15062))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await K.e(103).then(K.bind(K,15068))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await K.e(104).then(K.bind(K,15070))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await K.e(105).then(K.bind(K,15072))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await K.e(106).then(K.bind(K,15074))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await K.e(107).then(K.bind(K,15080))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await K.e(108).then(K.bind(K,15082))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await K.e(109).then(K.bind(K,15084))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await K.e(110).then(K.bind(K,15086))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await K.e(111).then(K.bind(K,15093))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await K.e(112).then(K.bind(K,15096))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await K.e(113).then(K.bind(K,15103))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await K.e(92).then(K.bind(K,15106))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await K.e(114).then(K.bind(K,15112))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await K.e(115).then(K.bind(K,15118))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await K.e(116).then(K.bind(K,15120))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await K.e(93).then(K.bind(K,15125))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await K.e(88).then(K.bind(K,14984))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await K.e(94).then(K.bind(K,15129))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await K.e(94).then(K.bind(K,15129))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await K.e(94).then(K.bind(K,15129))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await K.e(94).then(K.bind(K,15129))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await K.e(94).then(K.bind(K,15129))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await K.e(94).then(K.bind(K,15129))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await K.e(94).then(K.bind(K,15129))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await K.e(94).then(K.bind(K,15129))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await K.e(89).then(K.bind(K,15002))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await K.e(90).then(K.bind(K,15009))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await K.e(90).then(K.bind(K,15009))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await K.e(91).then(K.bind(K,15135))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await K.e(91).then(K.bind(K,15135))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await K.e(91).then(K.bind(K,15135))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await K.e(91).then(K.bind(K,15135))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await K.e(91).then(K.bind(K,15135))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await K.e(91).then(K.bind(K,15135))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await K.e(117).then(K.bind(K,15141))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await K.e(118).then(K.bind(K,15146))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await K.e(119).then(K.bind(K,15155))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await K.e(120).then(K.bind(K,15162))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await K.e(121).then(K.bind(K,15171))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await K.e(122).then(K.bind(K,15180))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await K.e(123).then(K.bind(K,15185))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await K.e(124).then(K.bind(K,15193))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await K.e(125).then(K.bind(K,15199))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await K.e(126).then(K.bind(K,15205))).FlowGraphDataSwitchBlock;default:if(vK[C])return vK[C];throw new Error(`Unknown block name ${C}`)}}(C.className);return await U()})));return function(C,U,K){const m=U.coordinator.createGraph(),O=[],X=U.valueParseFunction??fK.b;for(let A=0;A<C.allBlocks.length;A++){const e=TK(C.allBlocks[A],{QU:U.coordinator.config.QU,pathConverter:U.pathConverter,assetsContainer:U.coordinator.config.QU,valueParseFunction:X},K[A]);O.push(e),e instanceof QK.e&&m.addEventBlock(e)}for(const A of O){for(const C of A.dataInputs)for(const U of C.connectedPointIds){const K=ZK(O,U);C.connectTo(K)}if(A instanceof VK.e)for(const C of A.signalOutputs)for(const U of C.connectedPointIds){const K=PK(O,U);C.connectTo(K)}}for(const A of C.executionContexts)dK(A,{graph:m,valueParseFunction:X},C.rightHanded);return m}(C,U,m)}function dK(C,U,K){const m=U.graph.createContext();C.enableLogging&&(m.enableLogging=!0),m.treatDataAsRightHanded=K||!1;const O=U.valueParseFunction??fK.b;m.uniqueId=C.uniqueId;const X=m.dC();if(C._assetsContext){var A,e,t,z,j,p,E,u,b,v;const U=C._assetsContext,K={meshes:null===(A=U.meshes)||void 0===A?void 0:A.map((C=>X.getMeshById(C))),lights:null===(e=U.lights)||void 0===e?void 0:e.map((C=>X.getLightByName(C))),cameras:null===(t=U.cameras)||void 0===t?void 0:t.map((C=>X.getCameraByName(C))),materials:null===(z=U.materials)||void 0===z?void 0:z.map((C=>X.getMaterialById(C))),textures:null===(j=U.textures)||void 0===j?void 0:j.map((C=>X.getTextureByName(C))),animations:null===(p=U.animations)||void 0===p?void 0:p.map((C=>X.animations.find((U=>U.name===C)))),skeletons:null===(E=U.skeletons)||void 0===E?void 0:E.map((C=>X.getSkeletonByName(C))),AE:null===(u=U.AE)||void 0===u?void 0:u.map((C=>X.getParticleSystemById(C))),animationGroups:null===(b=U.animationGroups)||void 0===b?void 0:b.map((C=>X.getAnimationGroupByName(C))),transformNodes:null===(v=U.transformNodes)||void 0===v?void 0:v.map((C=>X.getTransformNodeById(C))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],NE:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};m.assetsContext=K}for(const Q in C._userVariables){const U=O(Q,C._userVariables,m.assetsContext,X);m.userVariables[Q]=U}for(const Q in C._connectionValues){const U=O(Q,C._connectionValues,m.assetsContext,X);m._setConnectionValueByKey(Q,U)}return m}function TK(C,U,K){const m={},O=U.valueParseFunction??fK.b;if(C.config)for(const A in C.config)m[A]=O(A,C.config,U.assetsContainer||U.QU,U.QU);if((0,fK.h)(C.className)){if(!U.pathConverter)throw new Error("Path converter is required for this block");m.pathConverter=U.pathConverter}const X=new K(m);X.uniqueId=C.uniqueId;for(let A=0;A<C.dataInputs.length;A++){const U=X.getDataInput(C.dataInputs[A].name);if(!U)throw new Error("Could not find data input with name "+C.dataInputs[A].name+" in block "+C.className);U.deserialize(C.dataInputs[A])}for(let A=0;A<C.dataOutputs.length;A++){const U=X.getDataOutput(C.dataOutputs[A].name);if(!U)throw new Error("Could not find data output with name "+C.dataOutputs[A].name+" in block "+C.className);U.deserialize(C.dataOutputs[A])}return X.metadata=C.metadata,X.deserialize&&X.deserialize(C),X}function yK(C){const[U,K]=C.split(":");return aK({op:U,extension:K})}function aK(C){var U;let K=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=C.extension?null===(U=iK[C.extension])||void 0===U?void 0:U[C.op]:DK[C.op];if(!m&&(v.d.Warn(`No mapping found for operation ${C.op} and extension ${C.extension||"KHR_interactivity"}`),K)){const U={},K={flows:{}};if(C.inputValueSockets){U.values={};for(const K in C.inputValueSockets)U.values[K]={name:K}}return C.outputValueSockets&&(K.values={},Object.keys(C.outputValueSockets).forEach((C=>{K.values[C]={name:C}}))),{Tj:[],inputs:U,outputs:K}}return m}function rK(C,U,K){iK[U]||(iK[U]={}),iK[U][C]=K}const iK={BABYLON:{"flow/log":{Tj:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},DK={"event/onStart":{Tj:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Tj:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Tj:["FlowGraphSendCustomEventBlock"],extraProcessor(C,U,K,m,O){if("event/send"!==U.op||!C.configuration||1!==Object.keys(C.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const X=C.configuration.event.value[0];if("number"!==typeof X)throw new Error("Event id should be a number");const A=m.arrays.events[X],e=O[0];return e.config||(e.config={}),e.config.eventId=A.eventId,e.config.eventData=A.eventData,O}},"event/receive":{Tj:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(C,U){var K;if(!C.configuration)return v.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const m=C.configuration.event;if(!m)return v.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const O=m.value[0];if("number"!==typeof O)return v.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(K=U.events)||void 0===K?void 0:K[O])?{valid:!0}:(v.d.Error(`Event with id ${O} not found`),{valid:!1,error:`Event with id ${O} not found`})},extraProcessor(C,U,K,m,O){if("event/receive"!==U.op||!C.configuration||1!==Object.keys(C.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const X=C.configuration.event.value[0];if("number"!==typeof X)throw new Error("Event id should be a number");const A=m.arrays.events[X],e=O[0];return e.config||(e.config={}),e.config.eventId=A.eventId,e.config.eventData=A.eventData,O}},"math/e":lK("FlowGraphEBlock"),"math/pi":lK("FlowGraphPIBlock"),"math/inf":lK("FlowGraphInfBlock"),"math/nan":lK("FlowGraphNaNBlock"),"math/abs":lK("FlowGraphAbsBlock"),"math/sign":lK("FlowGraphSignBlock"),"math/trunc":lK("FlowGraphTruncBlock"),"math/floor":lK("FlowGraphFloorBlock"),"math/ceil":lK("FlowGraphCeilBlock"),"math/round":{Tj:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O){var X;return(X=O[0]).config||(X.config={}),O[0].config.roundHalfAwayFromZero=!0,O}},"math/fract":lK("FlowGraphFractBlock"),"math/neg":lK("FlowGraphNegationBlock"),"math/add":lK("FlowGraphAddBlock",["a","b"],!0),"math/sub":lK("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Tj:["FlowGraphMultiplyBlock"],extraProcessor(C,U,K,m,O){var X;(X=O[0]).config||(X.config={}),O[0].config.useMatrixPerComponent=!0,O[0].config.preventIntegerFloatArithmetic=!0;let A=-1;return Object.keys(C.values||{}).find((U=>{var K;return void 0!==(null===(K=C.values)||void 0===K?void 0:K[U].type)&&(A=C.values[U].type,!0)})),-1!==A&&(O[0].config.type=m.arrays.types[A].flowGraphType),O},validation:C=>C.values?GK(C):{valid:!0}},"math/div":lK("FlowGraphDivideBlock",["a","b"],!0),"math/rem":lK("FlowGraphModuloBlock",["a","b"]),"math/min":lK("FlowGraphMinBlock",["a","b"]),"math/max":lK("FlowGraphMaxBlock",["a","b"]),"math/clamp":lK("FlowGraphClampBlock",["a","b","c"]),"math/saturate":lK("FlowGraphSaturateBlock"),"math/mix":lK("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":lK("FlowGraphEqualityBlock",["a","b"]),"math/lt":lK("FlowGraphLessThanBlock",["a","b"]),"math/le":lK("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":lK("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":lK("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":lK("FlowGraphIsNaNBlock"),"math/isinf":lK("FlowGraphIsInfBlock"),"math/select":{Tj:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Tj:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":lK("FlowGraphSinBlock"),"math/cos":lK("FlowGraphCosBlock"),"math/tan":lK("FlowGraphTanBlock"),"math/asin":lK("FlowGraphASinBlock"),"math/acos":lK("FlowGraphACosBlock"),"math/atan":lK("FlowGraphATanBlock"),"math/atan2":lK("FlowGraphATan2Block",["a","b"]),"math/sinh":lK("FlowGraphSinhBlock"),"math/cosh":lK("FlowGraphCoshBlock"),"math/tanh":lK("FlowGraphTanhBlock"),"math/asinh":lK("FlowGraphASinhBlock"),"math/acosh":lK("FlowGraphACoshBlock"),"math/atanh":lK("FlowGraphATanhBlock"),"math/exp":lK("FlowGraphExponentialBlock"),"math/log":lK("FlowGraphLogBlock"),"math/log2":lK("FlowGraphLog2Block"),"math/log10":lK("FlowGraphLog10Block"),"math/sqrt":lK("FlowGraphSquareRootBlock"),"math/cbrt":lK("FlowGraphCubeRootBlock"),"math/pow":lK("FlowGraphPowerBlock",["a","b"]),"math/length":lK("FlowGraphLengthBlock"),"math/normalize":lK("FlowGraphNormalizeBlock"),"math/dot":lK("FlowGraphDotBlock",["a","b"]),"math/cross":lK("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":lK("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":lK("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Tj:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Tj:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Tj:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Tj:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Tj:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Tj:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Tj:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":lK("FlowGraphTransposeBlock"),"math/determinant":lK("FlowGraphDeterminantBlock"),"math/inverse":lK("FlowGraphInvertMatrixBlock"),"math/matmul":lK("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Tj:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ue",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O,X){const A=O[0].dataInputs.find((C=>"rotationQuaternion"===C.name));if(!A)throw new Error("Rotation quaternion input not found");return X._connectionValues[A.uniqueId]&&(X._connectionValues[A.uniqueId].type="Quaternion"),O}},"math/matDecompose":{Tj:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ue"}}}},"math/quatConjugate":lK("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Tj:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O){var X;return(X=O[0]).config||(X.config={}),O[0].config.type="Quaternion",O}},"math/quatAngleBetween":lK("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Tj:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":lK("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":lK("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Tj:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O){var X;return(X=O[0]).config||(X.config={}),O[0].config.inputIsColumnMajor=!0,O}},"math/extract2x2":{Tj:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Tj:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O){var X;return(X=O[0]).config||(X.config={}),O[0].config.inputIsColumnMajor=!0,O}},"math/extract3x3":{Tj:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Tj:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O){var X;return(X=O[0]).config||(X.config={}),O[0].config.inputIsColumnMajor=!0,O}},"math/extract4x4":{Tj:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Tj:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O,X){var A,e;(e=O[0]).config||(e.config={});const t=O[0].dataInputs[0];return O[0].config.valueType=(null===(A=X._connectionValues[t.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",O}},"math/and":{Tj:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O,X){var A,e,t;(t=O[0]).config||(t.config={});const z=O[0].dataInputs[0],j=O[0].dataInputs[1];return O[0].config.valueType=(null===(A=X._connectionValues[z.uniqueId])||void 0===A?void 0:A.type)??(null===(e=X._connectionValues[j.uniqueId])||void 0===e?void 0:e.type)??"FlowGraphInteger",O}},"math/or":{Tj:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O,X){var A,e,t;(t=O[0]).config||(t.config={});const z=O[0].dataInputs[0],j=O[0].dataInputs[1];return O[0].config.valueType=(null===(A=X._connectionValues[z.uniqueId])||void 0===A?void 0:A.type)??(null===(e=X._connectionValues[j.uniqueId])||void 0===e?void 0:e.type)??"FlowGraphInteger",O}},"math/xor":{Tj:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(C,U,K,m,O,X){var A,e,t;(t=O[0]).config||(t.config={});const z=O[0].dataInputs[0],j=O[0].dataInputs[1];return O[0].config.valueType=(null===(A=X._connectionValues[z.uniqueId])||void 0===A?void 0:A.type)??(null===(e=X._connectionValues[j.uniqueId])||void 0===e?void 0:e.type)??"FlowGraphInteger",O}},"math/asr":lK("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":lK("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":lK("FlowGraphLeadingZerosBlock"),"math/ctz":lK("FlowGraphTrailingZerosBlock"),"math/popcnt":lK("FlowGraphOneBitsCounterBlock"),"math/rad":lK("FlowGraphDegToRadBlock"),"math/deg":lK("FlowGraphRadToDegBlock"),"type/boolToInt":lK("FlowGraphBooleanToInt"),"type/boolToFloat":lK("FlowGraphBooleanToFloat"),"type/intToBool":lK("FlowGraphIntToBoolean"),"type/intToFloat":lK("FlowGraphIntToFloat"),"type/floatToInt":lK("FlowGraphFloatToInt"),"type/floatToBool":lK("FlowGraphFloatToBoolean"),"flow/sequence":{Tj:["FlowGraphSequenceBlock"],extraProcessor(C,U,K,m,O){const X=O[0];return X.config||(X.config={}),X.config.outputSignalCount=Object.keys(C.flows||[]).length,X.signalOutputs.forEach(((C,U)=>{C.name="out_"+U})),O}},"flow/branch":{Tj:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Tj:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(C){if(C.configuration&&C.configuration.cases){const U=C.configuration.cases.value;if(!U.every((C=>"number"===typeof C&&/^-?\d+$/.test(C.toString()))))return v.d.Warn("Switch cases should be integers. Using empty array instead."),C.configuration.cases.value=[],{valid:!0};const K=new Set(U);C.configuration.cases.value=Array.from(K)}return{valid:!0}},extraProcessor(C,U,K,m,O){if("flow/switch"!==U.op||!C.flows||0===Object.keys(C.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return O[0].signalOutputs.forEach((C=>{"default"!==C.name&&(C.name="out_"+C.name)})),O}},"flow/while":{Tj:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Tj:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(C,U,K,m,O){const X=O[0];return X.config||(X.config={}),X.config.incrementIndexWhenLoopDone=!0,O}},"flow/doN":{Tj:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Tj:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(C,U,K,m,O){if("flow/multiGate"!==U.op||!C.flows||0===Object.keys(C.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const X=O[0];return X.config||(X.config={}),X.config.outputSignalCount=Object.keys(C.flows).length,X.signalOutputs.forEach(((C,U)=>{C.name="out_"+U})),O}},"flow/waitAll":{Tj:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(C){var U,K;return"number"!==typeof(null===(U=C.configuration)||void 0===U||null===(K=U.inputFlows)||void 0===K?void 0:K.value[0])&&(C.configuration=C.configuration||{inputFlows:{value:[0]}},C.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Tj:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Tj:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Tj:["FlowGraphCancelDelayBlock"]},"variable/get":{Tj:["FlowGraphGetVariableBlock"],validation(C){var U,K;return null!==(U=C.configuration)&&void 0!==U&&null!==(K=U.variable)&&void 0!==K&&K.value?{valid:!0}:(v.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(C,U)=>[U.getVariableName(C[0])]}}},"variable/set":{Tj:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(C,U)=>[U.getVariableName(C[0])]}}},"variable/setMultiple":{Tj:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(C,U)=>[C[0].map((C=>U.getVariableName(C)))]}},extraProcessor:(C,U,K,m,O)=>(O[0].dataInputs.forEach((C=>{C.name=m.getVariableName(+C.name)})),O)},"variable/interpolate":{Tj:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(C,U)=>[U.getVariableName(C[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:C=>!0===C[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",FK:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",FK:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",FK:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",FK:"FlowGraphPlayAnimationBlock"},out:{name:"out",FK:"FlowGraphPlayAnimationBlock"},done:{name:"done",FK:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(C,U,K,m,O){var X,A,e;const t=O[0],z=null===(X=C.configuration)||void 0===X?void 0:X.variable.value[0];if("number"!==typeof z)throw v.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const j=m.arrays.staticVariables[z];"undefined"===typeof t.config.animationType.value&&(m.arrays.staticVariables,t.config.animationType.value=(0,FK.J)(j.type));const p=O[4];return p.config||(p.config={}),(A=p.config).variable||(A.variable={}),p.config.variable.value=m.getVariableName(z),(e=O[3]).config||(e.config={}),O}},"pointer/get":{Tj:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",FK:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",FK:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(C,U,K,m,O)=>(O.forEach((C=>{"FlowGraphJsonPointerParserBlock"===C.className&&(C.config||(C.config={}),C.config.outputValue=!0)})),O)},"pointer/set":{Tj:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",FK:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",FK:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(C,U,K,m,O)=>(O.forEach((C=>{"FlowGraphJsonPointerParserBlock"===C.className&&(C.config||(C.config={}),C.config.outputValue=!0)})),O)},"pointer/interpolate":{Tj:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",FK:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",FK:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",FK:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",FK:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",FK:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",FK:"FlowGraphPlayAnimationBlock"},out:{name:"out",FK:"FlowGraphPlayAnimationBlock"},done:{name:"done",FK:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(C,U,K,m,O)=>(O.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className?(U.config||(U.config={}),U.config.outputValue=!0):"FlowGraphInterpolationBlock"===U.className&&(U.config||(U.config={}),Object.keys(C.values||[]).forEach((K=>{var O;const X=null===(O=C.values)||void 0===O?void 0:O[K];if("value"===K&&X){const C=X.type;void 0!==C&&(U.config.animationType=m.arrays.types[C].flowGraphType)}})))})),O)},"animation/start":{Tj:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",FK:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(C,U)=>[C[0]*U._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(C,U)=>[C[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(C,U,K,m,O,X,A){const e=O[O.length-1];return e.config||(e.config={}),e.config.glTF=A,O}},"animation/stop":{Tj:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",FK:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(C,U,K,m,O,X,A){const e=O[O.length-1];return e.config||(e.config={}),e.config.glTF=A,O}},"animation/stopAt":{Tj:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",FK:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(C,U)=>[C[0]*U._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(C,U,K,m,O,X,A){const e=O[O.length-1];return e.config||(e.config={}),e.config.glTF=A,O}},"math/switch":{Tj:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(C){if(C.configuration&&C.configuration.cases){const U=C.configuration.cases.value;if(!U.every((C=>"number"===typeof C&&/^-?\d+$/.test(C.toString()))))return v.d.Warn("Switch cases should be integers. Using empty array instead."),C.configuration.cases.value=[],{valid:!0};const K=new Set(U);C.configuration.cases.value=Array.from(K)}return{valid:!0}},extraProcessor(C,U,K,m,O){const X=O[0];return X.dataInputs.forEach((C=>{"default"!==C.name&&"case"!==C.name&&(C.name="in_"+C.name)})),X.config||(X.config={}),X.config.treatCasesAsIntegers=!0,O}},"debug/log":{Tj:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function lK(C){let U=arguments.length>2?arguments[2]:void 0;return{Tj:[C],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((C,U)=>(C[U]={name:U},C)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(C,K,m,O,X){var A;if(U){(A=X[0]).config||(A.config={}),X[0].config.preventIntegerFloatArithmetic=!0;let U=-1;Object.keys(C.values||{}).find((K=>{var m;return void 0!==(null===(m=C.values)||void 0===m?void 0:m[K].type)&&(U=C.values[K].type,!0)})),-1!==U&&(X[0].config.type=O.arrays.types[U].flowGraphType)}return X},validation:C=>U?GK(C):{valid:!0}}}function GK(C){if(C.values){const U=Object.keys(C.values).map((U=>C.values[U].type)).filter((C=>void 0!==C));if(!U.every((C=>C===U[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}DK["math/compose"]=DK["math/matCompose"],DK["math/decompose"]=DK["math/matDecompose"];var JK=K(11793);const oK={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"bU",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class BK{constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=C,this._gltf=U,this._animationTargetFps=K,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const C of this._interactivityGraph.types)this._types.push(oK[C.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const C of this._interactivityGraph.declarations){const U=aK(C);if(!U)throw v.d.Error(["No mapping found for declaration",C]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:U,fullOperationName:C.extension?C.op+":"+C.extension:C.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const C of this._interactivityGraph.variables){const U=this._parseVariable(C);this._staticVariables.push(U)}}_parseVariable(C,U){const K=this._types[C.type];if(!K)throw v.d.Error(["No type found for variable",C]),new Error("Error parsing variables");if(C.value&&C.value.length!==K.length)throw v.d.Error(["Invalid value length for variable",C,K]),new Error("Error parsing variables");const m=C.value||[];if(!m.length)switch(K.flowGraphType){case"boolean":m.push(!1);break;case"FlowGraphInteger":m.push(0);break;case"number":m.push(NaN);break;case"Vector2":m.push(NaN,NaN);break;case"bU":m.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":m.fill(NaN,0,4);break;case"Matrix":m.fill(NaN,0,16);break;case"Matrix3D":m.fill(NaN,0,9)}return"number"===K.elementType&&"string"===typeof m[0]&&(m[0]=parseFloat(m[0])),{type:K.flowGraphType,value:U?U(m,this):m}}_parseEvents(){if(this._interactivityGraph.events)for(const C of this._interactivityGraph.events){const U={eventId:C.id||"internalEvent_"+this._internalEventsCounter++};C.values&&(U.eventData=Object.keys(C.values).map((U=>{var K;const m=null===(K=C.values)||void 0===K?void 0:K[U];if(!m)throw v.d.Error(["No value found for event key",U]),new Error("Error parsing events");const O=this._types[m.type];if(!O)throw v.d.Error(["No type found for event value",m]),new Error("Error parsing events");const X="undefined"!==typeof m.value?this._parseVariable(m):void 0;return{id:U,type:O.flowGraphType,eventData:!0,value:X}}))),this._events.push(U)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const U of this._interactivityGraph.nodes){if("number"!==typeof U.declaration)throw v.d.Error(["No declaration found for node",U]),new Error("Error parsing nodes");const K=this._mappings[U.declaration];if(!K)throw v.d.Error(["No mapping found for node",U]),new Error("Error parsing nodes");if(K.flowGraphMapping.validation){const m=K.flowGraphMapping.validation(U,this._interactivityGraph,this._gltf);var C;if(!m.valid)throw new Error(`Error validating interactivity node ${null===(C=this._interactivityGraph.declarations)||void 0===C?void 0:C[U.declaration].op} - ${m.error}`)}const m=[];for(const C of K.flowGraphMapping.Tj){const O=this._getEmptyBlock(C,K.fullOperationName);this._parseNodeConfiguration(U,O,K.flowGraphMapping,C),m.push(O)}this._nodes.push({Tj:m,fullOperationName:K.fullOperationName})}}_getEmptyBlock(C,U){return{uniqueId:(0,JK.d)(),className:C,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:U,metadata:{}}}_parseNodeConfiguration(C,U,K,m){const O=U.config;if(C.configuration){const U=Object.keys(C.configuration);for(const e of U){var X,A;const U=null===(X=C.configuration)||void 0===X?void 0:X[e];if(!U)throw v.d.Error(["No value found for node configuration",e]),new Error("Error parsing node configuration");const t=null===(A=K.configuration)||void 0===A?void 0:A[e];if(t&&t.FK?t.FK===m:0===K.Tj.indexOf(m)){const C=(null===t||void 0===t?void 0:t.name)||e;U&&"undefined"!==typeof U.value||"undefined"===typeof(null===t||void 0===t?void 0:t.defaultValue)?U.value.length>=0?O[C]={value:1===U.value.length?U.value[0]:U.value}:v.d.Warn(["Invalid value for node configuration",U]):O[C]={value:t.defaultValue},t&&t.dataTransformer&&(O[C].value=t.dataTransformer([O[C].value],this)[0])}}}}_parseNodeConnections(C){for(let H=0;H<this._nodes.length;H++){var U;const d=null===(U=this._interactivityGraph.nodes)||void 0===U?void 0:U[H];if(!d)throw v.d.Error(["No node found for interactivity node",this._nodes[H]]),new Error("Error parsing node connections");const T=this._nodes[H],y=this._mappings[d.declaration];if(!y)throw v.d.Error(["No mapping found for node",d]),new Error("Error parsing node connections");const a=d.flows||{},r=Object.keys(a).sort();for(const C of r){var K,m,O,X;const U=a[C],z=null===(K=y.flowGraphMapping.outputs)||void 0===K||null===(m=K.flows)||void 0===m?void 0:m[C],j=(null===z||void 0===z?void 0:z.name)||C,p=this._createNewSocketConnection(j,!0);(z&&z.FK&&T.Tj.find((C=>C.className===z.FK))||T.Tj[0]).signalOutputs.push(p);const E=U.node,u=this._nodes[E];if(!u)throw v.d.Error(["No node found for input node id",E]),new Error("Error parsing node connections");const b=yK(u.fullOperationName);if(!b)throw v.d.Error(["No mapping found for input node",u]),new Error("Error parsing node connections");let Q=null===(O=b.inputs)||void 0===O||null===(X=O.flows)||void 0===X?void 0:X[U.socket||"in"],V=!1;if(!Q)for(const C in null===(A=b.inputs)||void 0===A?void 0:A.flows){var A,e,t;if(C.startsWith("[")&&C.endsWith("]"))V=!0,Q=null===(e=b.inputs)||void 0===e||null===(t=e.flows)||void 0===t?void 0:t[C]}const f=Q?V?Q.name.replace("$1",U.socket||""):Q.name:U.socket||"in",F=Q&&Q.FK&&u.Tj.find((C=>C.className===Q.FK))||u.Tj[0];let Z=F.signalInputs.find((C=>C.name===f));Z||(Z=this._createNewSocketConnection(f),F.signalInputs.push(Z)),Z.connectedPointIds.push(p.uniqueId),p.connectedPointIds.push(Z.uniqueId)}const i=d.values||{},D=Object.keys(i);for(const U of D){var z,j;const K=i[U];let m=null===(z=y.flowGraphMapping.inputs)||void 0===z||null===(j=z.values)||void 0===j?void 0:j[U],O=!1;if(!m)for(const C in null===(p=y.flowGraphMapping.inputs)||void 0===p?void 0:p.values){var p,E,u;if(C.startsWith("[")&&C.endsWith("]"))O=!0,m=null===(E=y.flowGraphMapping.inputs)||void 0===E||null===(u=E.values)||void 0===u?void 0:u[C]}const X=m?O?m.name.replace("$1",U):m.name:U,A=this._createNewSocketConnection(X);if((m&&m.FK&&T.Tj.find((C=>C.className===m.FK))||T.Tj[0]).dataInputs.push(A),void 0!==K.value){const U=this._parseVariable(K,m&&m.dataTransformer);C._connectionValues[A.uniqueId]=U}else{if("undefined"===typeof K.node)throw v.d.Error(["Invalid value for value connection",K]),new Error("Error parsing node connections");{var b,Q,V;const C=K.node,U=K.socket||"value",m=this._nodes[C];if(!m)throw v.d.Error(["No node found for output socket reference",K]),new Error("Error parsing node connections");const O=yK(m.fullOperationName);if(!O)throw v.d.Error(["No mapping found for output socket reference",K]),new Error("Error parsing node connections");let X=null===(b=O.outputs)||void 0===b||null===(Q=b.values)||void 0===Q?void 0:Q[U],e=!1;if(!X)for(const K in null===(f=O.outputs)||void 0===f?void 0:f.values){var f,F,Z;if(K.startsWith("[")&&K.endsWith("]"))e=!0,X=null===(F=O.outputs)||void 0===F||null===(Z=F.values)||void 0===Z?void 0:Z[K]}const t=X?e?X.name.replace("$1",U):null===(V=X)||void 0===V?void 0:V.name:U,z=X&&X.FK&&m.Tj.find((C=>C.className===X.FK))||m.Tj[0];let j=z.dataOutputs.find((C=>C.name===t));j||(j=this._createNewSocketConnection(t,!0),z.dataOutputs.push(j)),A.connectedPointIds.push(j.uniqueId),j.connectedPointIds.push(A.uniqueId)}}}if(y.flowGraphMapping.interBlockConnectors)for(const C of y.flowGraphMapping.interBlockConnectors){const U=C.input,K=C.output,m=C.isVariable;this._connectFlowGraphNodes(U,K,T.Tj[C.inputBlockIndex],T.Tj[C.outputBlockIndex],m)}if(y.flowGraphMapping.extraProcessor){var P;const U=null===(P=this._interactivityGraph.declarations)||void 0===P?void 0:P[d.declaration];if(!U)throw v.d.Error(["No declaration found for extra processor",d]),new Error("Error parsing node connections");T.Tj=y.flowGraphMapping.extraProcessor(d,U,y.flowGraphMapping,this,T.Tj,C,this._gltf)}}}_createNewSocketConnection(C,U){return{uniqueId:(0,JK.d)(),name:C,_connectionType:U?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(C,U,K,m,O){const X=O?K.dataInputs:K.signalInputs,A=O?m.dataOutputs:m.signalOutputs,e=X.find((U=>U.name===C))||this._createNewSocketConnection(C),t=A.find((C=>C.name===U))||this._createNewSocketConnection(U,!0);X.find((U=>U.name===C))||X.push(e),A.find((C=>C.name===U))||A.push(t),e.connectedPointIds.push(t.uniqueId),t.connectedPointIds.push(e.uniqueId)}getVariableName(C){return"staticVariable_"+C}serializeToFlowGraph(){const C={uniqueId:(0,JK.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(C);for(let U=0;U<this._staticVariables.length;U++){const K=this._staticVariables[U];C._userVariables[this.getVariableName(U)]=K}return{rightHanded:!0,allBlocks:this._nodes.reduce(((C,U)=>C.concat(U.Tj)),[]),executionContexts:[C]}}}const kK="KHR_interactivity";class wK{constructor(C){this._loader=C,this.name=kK,this.enabled=this._loader.isExtensionUsed(kK),this._pathConverter=(0,h.k)(this._loader.Ce),C._skipStartAnimationStep=!0;const U=C.babylonScene;U&&function(C){(0,h.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!C.activeCamera)return new O.Quaternion(NaN,NaN,NaN,NaN);const U=O.Quaternion.FromRotationMatrix(C.activeCamera.getWorldMatrix()).normalize();return C.useRightHandedSystem||(U.w*=-1,U.x*=-1),U},type:"Quaternion",getTarget:()=>C.activeCamera}),(0,h.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!C.activeCamera)return new O.bU(NaN,NaN,NaN);const U=C.activeCamera.getWorldMatrix().getTranslation();return C.useRightHandedSystem||(U.x*=-1),U},type:"bU",getTarget:()=>C.activeCamera}),(0,h.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:C=>{var U;return(null===(U=C._babylonAnimationGroup)||void 0===U?void 0:U.isPlaying)??!1},type:"boolean",getTarget:C=>C._babylonAnimationGroup}),(0,h.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:C=>{var U;return((null===(U=C._babylonAnimationGroup)||void 0===U?void 0:U.from)??0)/60},type:"number",getTarget:C=>C._babylonAnimationGroup}),(0,h.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:C=>{var U;return((null===(U=C._babylonAnimationGroup)||void 0===U?void 0:U.to)??0)/60},type:"number",getTarget:C=>C._babylonAnimationGroup}),(0,h.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:C=>{var U;return((null===(U=C._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:C=>C._babylonAnimationGroup}),(0,h.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:C=>{var U;return((null===(U=C._babylonAnimationGroup)||void 0===U?void 0:U.getCurrentFrame())??0)/60},type:"number",getTarget:C=>C._babylonAnimationGroup})}(U)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var C;if(!this._loader.babylonScene||!this._pathConverter)return;const U=this._loader.babylonScene,K=null===(C=this._loader.Ce.extensions)||void 0===C?void 0:C.KHR_interactivity;if(!K)return;const m=new bK.d({QU:U});m.dispatchEventsSynchronously=!1;const O=K.graphs.map((C=>new BK(C,this._loader.Ce,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(O.map((async C=>await HK(C,{coordinator:m,pathConverter:this._pathConverter})))),m.start()}}var hK;hK=async()=>(await Promise.resolve().then(K.bind(K,13567))).FlowGraphGLTFDataProvider,vK[`${kK}/${"FlowGraphGLTFDataProvider"}`]=hK,w(kK),k(kK,!0,(C=>new wK(C)));const cK="KHR_node_visibility";(0,h.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:C=>{const U=C._babylonTransformNode;return!U||void 0===U.isVisible||U.isVisible},set:(C,U)=>{var K,m;null===(K=U._primitiveBabylonMeshes)||void 0===K||K.forEach((C=>{C.inheritVisibility=!0})),U._babylonTransformNode&&(U._babylonTransformNode.isVisible=C),null===(m=U._primitiveBabylonMeshes)||void 0===m||m.forEach((U=>{U.isVisible=C}))},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class NK{constructor(C){this.name=cK,this._loader=C,this.enabled=C.isExtensionUsed(cK)}async onReady(){var C;null===(C=this._loader.Ce.nodes)||void 0===C||C.forEach((C=>{var U,K,m,O;(null===(U=C._primitiveBabylonMeshes)||void 0===U||U.forEach((C=>{C.inheritVisibility=!0})),null!==(K=C.extensions)&&void 0!==K&&K.KHR_node_visibility)&&(!1===(null===(m=C.extensions)||void 0===m?void 0:m.KHR_node_visibility.visible)&&(C._babylonTransformNode&&(C._babylonTransformNode.isVisible=!1),null===(O=C._primitiveBabylonMeshes)||void 0===O||O.forEach((C=>{C.isVisible=!1}))))}))}dispose(){this._loader=null}}w(cK),k(cK,!0,(C=>new NK(C)));const gK="KHR_node_selectability";rK("event/onSelect",gK,{Tj:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FK:"FlowGraphGetVariableBlock",dataTransformer:C=>["pickedMesh_"+C[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",FK:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(C,U,K,m,O,X,A){var e,t,z,j,p,E;const u=O[O.length-1];u.config=u.config||{},u.config.glTF=A;const b=null===(e=C.configuration)||void 0===e||null===(t=e.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const v="pickedMesh_"+b;return O[1].config.variable=v,X._userVariables[v]={className:"Mesh",id:null===A||void 0===A||null===(z=A.nodes)||void 0===z||null===(j=z[b]._babylonTransformNode)||void 0===j?void 0:j.id,uniqueId:null===A||void 0===A||null===(p=A.nodes)||void 0===p||null===(E=p[b]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},O}}),(0,h.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:C=>{const U=C._babylonTransformNode;return!U||void 0===U.xt||U.xt},set:(C,U)=>{var K;null===(K=U._primitiveBabylonMeshes)||void 0===K||K.forEach((U=>{U.xt=C}))},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"xt"],type:"boolean"});class MK{constructor(C){this.name=gK,this._loader=C,this.enabled=C.isExtensionUsed(gK)}async onReady(){var C;null===(C=this._loader.Ce.nodes)||void 0===C||C.forEach((C=>{var U,K,m;null!==(U=C.extensions)&&void 0!==U&&U.KHR_node_selectability&&!1===(null===(K=C.extensions)||void 0===K?void 0:K.KHR_node_selectability.selectable)&&(null===(m=C._babylonTransformNode)||void 0===m||m.getChildMeshes().forEach((C=>{C.xt=!1})))}))}dispose(){this._loader=null}}w(gK),k(gK,!0,(C=>new MK(C)));const LK="KHR_node_hoverability",YK="targetMeshPointerOver_";rK("event/onHoverIn",LK,{Tj:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FK:"FlowGraphGetVariableBlock",dataTransformer:C=>[YK+C[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",FK:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(C,U,K,m,O,X,A){var e,t,z,j,p,E;const u=O[O.length-1];u.config=u.config||{},u.config.glTF=A;const b=null===(e=C.configuration)||void 0===e||null===(t=e.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const v=YK+b;return O[1].config.variable=v,X._userVariables[v]={className:"Mesh",id:null===A||void 0===A||null===(z=A.nodes)||void 0===z||null===(j=z[b]._babylonTransformNode)||void 0===j?void 0:j.id,uniqueId:null===A||void 0===A||null===(p=A.nodes)||void 0===p||null===(E=p[b]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},O}});const WK="targetMeshPointerOut_";rK("event/onHoverOut",LK,{Tj:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FK:"FlowGraphGetVariableBlock",dataTransformer:C=>[WK+C[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",FK:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(C,U,K,m,O,X,A){var e,t,z,j,p,E;const u=O[O.length-1];u.config=u.config||{},u.config.glTF=A;const b=null===(e=C.configuration)||void 0===e||null===(t=e.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===b||"number"!==typeof b)throw new Error("nodeIndex not found in configuration");const v=WK+b;return O[1].config.variable=v,X._userVariables[v]={className:"Mesh",id:null===A||void 0===A||null===(z=A.nodes)||void 0===z||null===(j=z[b]._babylonTransformNode)||void 0===j?void 0:j.id,uniqueId:null===A||void 0===A||null===(p=A.nodes)||void 0===p||null===(E=p[b]._babylonTransformNode)||void 0===E?void 0:E.uniqueId},O}}),(0,h.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:C=>{const U=C._babylonTransformNode;return!U||void 0===U.pointerOverDisableMeshTesting||U.pointerOverDisableMeshTesting},set:(C,U)=>{var K;null===(K=U._primitiveBabylonMeshes)||void 0===K||K.forEach((U=>{U.pointerOverDisableMeshTesting=!C}))},getTarget:C=>C._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class xK{constructor(C){this.name=LK,this._loader=C,this.enabled=C.isExtensionUsed(LK)}async onReady(){var C;null===(C=this._loader.Ce.nodes)||void 0===C||C.forEach((C=>{var U,K,m;null!==(U=C.extensions)&&void 0!==U&&U.KHR_node_hoverability&&!1===(null===(K=C.extensions)||void 0===K?void 0:K.KHR_node_hoverability.hoverable)&&(null===(m=C._babylonTransformNode)||void 0===m||m.getChildMeshes().forEach((C=>{C.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}w(LK),k(LK,!0,(C=>new xK(C)));const nK="ExtrasAsMetadata";class SK{_assignExtras(C,U){if(U.extras&&Object.keys(U.extras).length>0){const K=C.metadata=C.metadata||{};(K.Ce=K.Ce||{}).extras=U.extras}}constructor(C){this.name=nK,this.enabled=!0,this._loader=C}dispose(){this._loader=null}loadNodeAsync(C,U,K){return this._loader.loadNodeAsync(C,U,(C=>{this._assignExtras(C,U),K(C)}))}loadCameraAsync(C,U,K){return this._loader.loadCameraAsync(C,U,(C=>{this._assignExtras(C,U),K(C)}))}createMaterial(C,U,K){const m=this._loader.createMaterial(C,U,K);return this._assignExtras(m,U),m}}w(nK),k(nK,!1,(C=>new SK(C)));K(13567)},13448:(C,U,K)=>{"use strict";K.d(U,{c:()=>G,g:()=>y,i:()=>T,l:()=>a});var m=K(11663),O=K(11660),X=K(13074),A=K(12285),e=K(12249),t=K(12262),z=K(11679),j=K(11703),p=K(12281),E=K(12367),u=K(12292),b=K(11872);class v{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.AE=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.NE=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(C){this._environmentTexture=C}getNodes(){let C=[];C=C.concat(this.meshes),C=C.concat(this.lights),C=C.concat(this.cameras),C=C.concat(this.transformNodes);for(const U of this.skeletons)C=C.concat(U.bones);return C}}class Q extends v{}class V{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const C=this.rootNodes;for(const m of C)m.dispose();C.length=0;const U=this.skeletons;for(const m of U)m.dispose();U.length=0;const K=this.animationGroups;for(const m of K)m.dispose();K.length=0}}class f extends v{constructor(C){super(),this._wasAddedToScene=!1,(C=C||j.c.LastCreatedScene)&&(this.QU=C,this.proceduralTextures=[],C.RA.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=C.getEngine().onContextRestoredObservable.add((()=>{for(const C of this.geometries)C._rebuild();for(const C of this.meshes)C._rebuild();for(const C of this.AE)C.rebuild();for(const C of this.textures)C._rebuild()})))}_topologicalSort(C){const U=new Map;for(const A of C)U.set(A.uniqueId,A);const K={dependsOn:new Map,dependedBy:new Map};for(const A of C){const C=A.uniqueId;K.dependsOn.set(C,new Set),K.dependedBy.set(C,new Set)}for(const A of C){const C=A.uniqueId,m=K.dependsOn.get(C);if(A instanceof p.d){const O=A.sourceMesh;U.has(O.uniqueId)&&(m.add(O.uniqueId),K.dependedBy.get(O.uniqueId).add(C))}const O=K.dependedBy.get(C);for(const X of A.getDescendants()){const m=X.uniqueId;if(U.has(m)){O.add(m);K.dependsOn.get(m).add(C)}}}const m=[],O=[];for(const A of C){const C=A.uniqueId;0===K.dependsOn.get(C).size&&(O.push(A),U.delete(C))}const X=O;for(;X.length>0;){const C=X.shift();m.push(C);const O=K.dependedBy.get(C.uniqueId);for(const m of Array.from(O.values())){const O=K.dependsOn.get(m);O.delete(C.uniqueId),0===O.size&&U.get(m)&&(X.push(U.get(m)),U.delete(m))}}return U.size>0&&(z.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),U.forEach((C=>{z.d.Error(C.name)}))),m}_addNodeAndDescendantsToList(C,U,K,m){if(K&&(!m||m(K))&&!U.has(K.uniqueId)){C.push(K),U.add(K.uniqueId);for(const O of K.getDescendants(!0))this._addNodeAndDescendantsToList(C,U,O,m)}}_isNodeInContainer(C){return C instanceof t.d&&-1!==this.meshes.indexOf(C)||(C instanceof e.b&&-1!==this.transformNodes.indexOf(C)||(C instanceof E.e&&-1!==this.lights.indexOf(C)||C instanceof u.b&&-1!==this.cameras.indexOf(C)))}_isValidHierarchy(){for(const C of this.meshes)if(C.parent&&!this._isNodeInContainer(C.parent))return z.d.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.transformNodes)if(C.parent&&!this._isNodeInContainer(C.parent))return z.d.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.lights)if(C.parent&&!this._isNodeInContainer(C.parent))return z.d.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;for(const C of this.cameras)if(C.parent&&!this._isNodeInContainer(C.parent))return z.d.Warn(`Node ${C.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||O.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const m={},X={},e=new V,t=[],z=[],j={doNotInstantiate:!0,...K},p=[],E=new Set;for(const O of this.transformNodes)null===O.parent&&this._addNodeAndDescendantsToList(p,E,O,j.predicate);for(const O of this.meshes)null===O.parent&&this._addNodeAndDescendantsToList(p,E,O,j.predicate);const u=this._topologicalSort(p),b=(K,O)=>{if(((U,K)=>{if(m[U.uniqueId]=K.uniqueId,X[K.uniqueId]=K,C&&(K.name=C(U.name)),K instanceof A.b){const C=K;if(C.morphTargetManager){const K=U.morphTargetManager;C.morphTargetManager=K.clone();for(let U=0;U<K.numTargets;U++){const O=K.getTarget(U),A=C.morphTargetManager.getTarget(U);m[O.uniqueId]=A.uniqueId,X[A.uniqueId]=A}}}})(K,O),K.parent){const C=m[K.parent.uniqueId],U=X[C];O.parent=U||K.parent}if(O.position&&K.position&&O.position.m(K.position),O.rotationQuaternion&&K.rotationQuaternion&&O.rotationQuaternion.m(K.rotationQuaternion),O.rotation&&K.rotation&&O.rotation.m(K.rotation),O.ue&&K.ue&&O.ue.m(K.ue),O.material){const A=O;if(A.material)if(U){const U=K.material;if(-1===z.indexOf(U)){let K=U.clone(C?C(U.name):"Clone of "+U.name);if(z.push(U),m[U.uniqueId]=K.uniqueId,X[K.uniqueId]=K,"MultiMaterial"===U.getClassName()){const O=U;for(const U of O.Qe)U&&(K=U.clone(C?C(U.name):"Clone of "+U.name),z.push(U),m[U.uniqueId]=K.uniqueId,X[K.uniqueId]=K);O.Qe=O.Qe.map((C=>C&&X[m[C.uniqueId]]))}}"InstancedMesh"!==A.getClassName()&&(A.material=X[m[U.uniqueId]])}else"MultiMaterial"===A.material.getClassName()?-1===this.QU.multiMaterials.indexOf(A.material)&&this.QU.addMultiMaterial(A.material):-1===this.QU.materials.indexOf(A.material)&&this.QU.addMaterial(A.material)}null===O.parent&&e.rootNodes.push(O)};for(const O of u)if("InstancedMesh"===O.getClassName()){const C=O,U=C.sourceMesh,K=m[U.uniqueId];b(C,("number"===typeof K?X[K]:U).createInstance(C.name))}else{let C=!0;"ae"===O.getClassName()||"Node"===O.getClassName()||O.skeleton||!O.getTotalVertices||0===O.getTotalVertices()?C=!1:j.doNotInstantiate&&(C="function"===typeof j.doNotInstantiate?!j.doNotInstantiate(O):!j.doNotInstantiate);const U=C?O.createInstance(`instance of ${O.name}`):O.clone(`Clone of ${O.name}`,null,!0);if(!U)throw new Error(`Could not clone or instantiate node on Asset Container ${O.name}`);b(O,U)}for(const O of this.skeletons){if(j.predicate&&!j.predicate(O))continue;const U=O.clone(C?C(O.name):"Clone of "+O.name);for(const C of this.meshes)if(C.skeleton===O&&!C.isAnInstance){const K=X[m[C.uniqueId]];if(!K||K.isAnInstance)continue;if(K.skeleton=U,-1!==t.indexOf(U))continue;t.push(U);for(const C of U.bones)C._linkedTransformNode&&(C._linkedTransformNode=X[m[C._linkedTransformNode.uniqueId]])}e.skeletons.push(U)}for(const O of this.animationGroups){if(j.predicate&&!j.predicate(O))continue;const U=O.clone(C?C(O.name):"Clone of "+O.name,(C=>X[m[C.uniqueId]]||C));e.animationGroups.push(U)}return e}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||O.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.QU.environmentTexture=this.environmentTexture);for(const C of this.QU._serializableComponents)C.addFromContainer(this);this.QU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const U=[];for(const K of this.cameras)C&&!C(K)||(this.QU.addCamera(K),U.push(K));for(const K of this.lights)C&&!C(K)||(this.QU.addLight(K),U.push(K));for(const K of this.meshes)C&&!C(K)||(this.QU.Ej(K),U.push(K));for(const K of this.skeletons)C&&!C(K)||this.QU.addSkeleton(K);for(const K of this.animations)C&&!C(K)||this.QU.addAnimation(K);for(const K of this.animationGroups)C&&!C(K)||this.QU.addAnimationGroup(K);for(const K of this.multiMaterials)C&&!C(K)||this.QU.addMultiMaterial(K);for(const K of this.materials)C&&!C(K)||this.QU.addMaterial(K);for(const K of this.morphTargetManagers)C&&!C(K)||this.QU.addMorphTargetManager(K);for(const K of this.geometries)C&&!C(K)||this.QU.addGeometry(K);for(const K of this.transformNodes)C&&!C(K)||(this.QU.addTransformNode(K),U.push(K));for(const K of this.actionManagers)C&&!C(K)||this.QU.addActionManager(K);for(const K of this.textures)C&&!C(K)||this.QU.addTexture(K);for(const K of this.reflectionProbes)C&&!C(K)||this.QU.addReflectionProbe(K);for(const K of U)K.parent&&-1===this.QU.getNodes().indexOf(K.parent)&&(K.setParent?K.setParent(null):K.parent=null)}removeAllFromScene(){this._isValidHierarchy()||O.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.QU.environmentTexture&&(this.QU.environmentTexture=null);for(const C of this.QU._serializableComponents)C.removeFromContainer(this)}removeFromScene(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const U of this.cameras)C&&!C(U)||this.QU.removeCamera(U);for(const U of this.lights)C&&!C(U)||this.QU.removeLight(U);for(const U of this.meshes)C&&!C(U)||this.QU.pj(U,!0);for(const U of this.skeletons)C&&!C(U)||this.QU.removeSkeleton(U);for(const U of this.animations)C&&!C(U)||this.QU.removeAnimation(U);for(const U of this.animationGroups)C&&!C(U)||this.QU.removeAnimationGroup(U);for(const U of this.multiMaterials)C&&!C(U)||this.QU.removeMultiMaterial(U);for(const U of this.materials)C&&!C(U)||this.QU.removeMaterial(U);for(const U of this.morphTargetManagers)C&&!C(U)||this.QU.removeMorphTargetManager(U);for(const U of this.geometries)C&&!C(U)||this.QU.removeGeometry(U);for(const U of this.transformNodes)C&&!C(U)||this.QU.removeTransformNode(U);for(const U of this.actionManagers)C&&!C(U)||this.QU.removeActionManager(U);for(const U of this.textures)C&&!C(U)||this.QU.removeTexture(U);for(const U of this.reflectionProbes)C&&!C(U)||this.QU.removeReflectionProbe(U)}dispose(){const C=this.cameras.slice(0);for(const u of C)u.dispose();this.cameras.length=0;const U=this.lights.slice(0);for(const u of U)u.dispose();this.lights.length=0;const K=this.meshes.slice(0);for(const u of K)u.dispose();this.meshes.length=0;const m=this.skeletons.slice(0);for(const u of m)u.dispose();this.skeletons.length=0;const O=this.animationGroups.slice(0);for(const u of O)u.dispose();this.animationGroups.length=0;const X=this.multiMaterials.slice(0);for(const u of X)u.dispose();this.multiMaterials.length=0;const A=this.materials.slice(0);for(const u of A)u.dispose();this.materials.length=0;const e=this.geometries.slice(0);for(const u of e)u.dispose();this.geometries.length=0;const t=this.transformNodes.slice(0);for(const u of t)u.dispose();this.transformNodes.length=0;const z=this.actionManagers.slice(0);for(const u of z)u.dispose();this.actionManagers.length=0;const j=this.textures.slice(0);for(const u of j)u.dispose();this.textures.length=0;const p=this.reflectionProbes.slice(0);for(const u of p)u.dispose();this.reflectionProbes.length=0;const E=this.morphTargetManagers.slice(0);for(const u of E)u.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const u of this.QU._serializableComponents)u.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.QU.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(C,U,K){if(C&&U)for(const m of C){let C=!0;if(K)for(const U of K)if(m===U){C=!1;break}C&&(U.push(m),m._parentContainer=this)}}moveAllFromScene(C){this._wasAddedToScene=!1,void 0===C&&(C=new Q);for(const U in this)Object.prototype.hasOwnProperty.call(this,U)&&(this[U]=this[U]||("_environmentTexture"===U?null:[]),this._moveAssets(this.QU[U],this[U],C[U]));this.environmentTexture=this.QU.environmentTexture,this.removeAllFromScene()}createRootMesh(){const C=new A.b("assetContainerRootMesh",this.QU);for(const U of this.meshes)U.parent||C.addChild(U);return this.meshes.unshift(C),C}mergeAnimationsTo(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.c.LastCreatedScene,U=arguments.length>1?arguments[1]:void 0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!C)return z.d.Error("No scene available to merge animations to"),[];const m=K||(U=>{let K=null;const m=U.animations.length?U.animations[0].targetProperty:"",O=U.name.split(".").join("").split("_primitive")[0];switch(m){case"position":case"rotationQuaternion":K=C.getTransformNodeByName(U.name)||C.getTransformNodeByName(O);break;case"influence":K=C.getMorphTargetByName(U.name)||C.getMorphTargetByName(O);break;default:K=C.getNodeByName(U.name)||C.getNodeByName(O)}return K}),O=this.getNodes();for(const e of O){const C=m(e);if(null!==C){for(const U of e.animations){const K=C.animations.filter((C=>C.targetProperty===U.targetProperty));for(const U of K){const K=C.animations.indexOf(U,0);K>-1&&C.animations.splice(K,1)}}C.animations=C.animations.concat(e.animations)}}const X=[],A=this.animationGroups.slice();for(const e of A){X.push(e.clone(e.name,m));for(const C of e.animatables)C.stop()}for(const e of U){const U=m(e.target);U&&(C.beginAnimation(U,e.fromFrame,e.toFrame,e.loopAnimation,e.speedRatio,e.onAnimationEnd?e.onAnimationEnd:void 0,void 0,!0,void 0,e.onAnimationLoop?e.onAnimationLoop:void 0),C.stopAnimation(e.target))}return X}populateRootNodes(){this.rootNodes.length=0;for(const C of this.meshes)C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C);for(const C of this.transformNodes)C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C);for(const C of this.lights)C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C);for(const C of this.cameras)C.parent||-1!==this.rootNodes.indexOf(C)||this.rootNodes.push(C)}addAllAssetsToContainer(C){if(!C)return;const U=[],K=new Set;for(U.push(C);U.length>0;){const C=U.pop();if(C instanceof A.b?(C.ze&&-1===this.geometries.indexOf(C.ze)&&this.geometries.push(C.ze),this.meshes.push(C)):C instanceof p.d?this.meshes.push(C):C instanceof e.b?this.transformNodes.push(C):C instanceof E.e?this.lights.push(C):C instanceof u.b&&this.cameras.push(C),C instanceof t.d){if(C.material&&-1===this.materials.indexOf(C.material)){this.materials.push(C.material);for(const U of C.material.getActiveTextures())-1===this.textures.indexOf(U)&&this.textures.push(U)}C.skeleton&&-1===this.skeletons.indexOf(C.skeleton)&&this.skeletons.push(C.skeleton),C.morphTargetManager&&-1===this.morphTargetManagers.indexOf(C.morphTargetManager)&&this.morphTargetManagers.push(C.morphTargetManager)}for(const m of C.getChildren())K.has(m)||U.push(m);K.add(C)}this.populateRootNodes()}_getByTags(C,U,K){if(void 0===U)return C;const m=[];for(const O in C){const X=C[O];b.d&&b.d.MatchesQuery(X,U)&&(!K||K(X))&&m.push(X)}return m}getMeshesByTags(C,U){return this._getByTags(this.meshes,C,U)}getCamerasByTags(C,U){return this._getByTags(this.cameras,C,U)}getLightsByTags(C,U){return this._getByTags(this.lights,C,U)}getMaterialsByTags(C,U){return this._getByTags(this.materials,C,U).concat(this._getByTags(this.multiMaterials,C,U))}getTransformNodesByTags(C,U){return this._getByTags(this.transformNodes,C,U)}}var F=K(11719);class Z{constructor(C){this.byteOffset=0,this.buffer=C}async loadAsync(C){const U=await this.buffer.readAsync(this.byteOffset,C);this._dataView=new DataView(U.buffer,U.byteOffset,U.byteLength),this._dataByteOffset=0}readUint32(){const C=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,C}readUint8Array(C){const U=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,C);return this._dataByteOffset+=C,this.byteOffset+=C,U}readString(C){return(0,F.j)(this.readUint8Array(C))}skipBytes(C){this._dataByteOffset+=C,this.byteOffset+=C}}var P=K(13450);const H="Z2xURg",d={name:"Ce",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:C=>-1!==C.indexOf("asset")&&-1!==C.indexOf("version")||C.startsWith("data:base64,"+H)||C.startsWith("data:;base64,"+H)||C.startsWith("data:application/octet-stream;base64,"+H)||C.startsWith("data:model/gltf-binary;base64,"+H)};var T,y,a,r=K(11709),i=K(11717);function D(C,U,K){try{return Promise.resolve(new Uint8Array(C,U,K))}catch(m){return Promise.reject(m)}}!function(C){C[C.AUTO=0]="AUTO",C[C.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(T||(T={})),function(C){C[C.NONE=0]="NONE",C[C.FIRST=1]="FIRST",C[C.ALL=2]="ALL"}(y||(y={})),function(C){C[C.LOADING=0]="LOADING",C[C.READY=1]="READY",C[C.COMPLETE=2]="COMPLETE"}(a||(a={}));class l{constructor(){this.coordinateSystemMode=T.AUTO,this.animationStartMode=y.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=C=>Promise.resolve(C),this.extensionOptions={}}m(C){C&&(this.onParsed=C.onParsed,this.coordinateSystemMode=C.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=C.animationStartMode??this.animationStartMode,this.loadNodeAnimations=C.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=C.loadSkins??this.loadSkins,this.loadMorphTargets=C.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=C.compileMaterials??this.compileMaterials,this.useClipPlane=C.useClipPlane??this.useClipPlane,this.compileShadowGenerators=C.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=C.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=C.useRangeRequests??this.useRangeRequests,this.createInstances=C.createInstances??this.createInstances,this.alwaysComputeBoundingBox=C.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=C.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=C.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=C.skipMaterials??this.skipMaterials,this.useSRGBBuffers=C.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=C.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=C.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=C.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=C.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=C.customRootNode,this.onMeshLoaded=C.onMeshLoaded,this.onSkinLoaded=C.onSkinLoaded,this.onTextureLoaded=C.onTextureLoaded,this.onMaterialLoaded=C.onMaterialLoaded,this.onCameraLoaded=C.onCameraLoaded,this.extensionOptions=C.extensionOptions??this.extensionOptions)}}class G extends l{constructor(C){super(),this.onParsedObservable=new m.b,this.onMeshLoadedObservable=new m.b,this.onSkinLoadedObservable=new m.b,this.onTextureLoadedObservable=new m.b,this.onMaterialLoadedObservable=new m.b,this.onCameraLoadedObservable=new m.b,this.onCompleteObservable=new m.b,this.onErrorObservable=new m.b,this.RA=new m.b,this.onExtensionLoadedObservable=new m.b,this.validate=!1,this.onValidatedObservable=new m.b,this._loader=null,this._state=null,this._requests=new Array,this.name=d.name,this.extensions=d.extensions,this.onLoaderStateChangedObservable=new m.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.m(C)}set onParsed(C){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),C&&(this._onParsedObserver=this.onParsedObservable.add(C))}set onMeshLoaded(C){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),C&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(C))}set onSkinLoaded(C){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),C&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((U=>C(U.node,U.skinnedNode))))}set onTextureLoaded(C){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),C&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(C))}set onMaterialLoaded(C){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),C&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(C))}set onCameraLoaded(C){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),C&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(C))}set onComplete(C){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(C)}set onError(C){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(C)}set onDispose(C){this._onDisposeObserver&&this.RA.remove(this._onDisposeObserver),this._onDisposeObserver=this.RA.add(C)}set onExtensionLoaded(C){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(C)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(C){this._loggingEnabled!==C&&(this._loggingEnabled=C,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(C){this._capturePerformanceCounters!==C&&(this._capturePerformanceCounters=C,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(C){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(C)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const C of this._requests)C.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=C=>Promise.resolve(C),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.RA.notifyObservers(void 0),this.RA.clear()}loadFile(C,U,K,X,A,e,t,j){if(ArrayBuffer.isView(U))return this._loadBinary(C,U,K,X,t,j),null;this._progressCallback=A;const p=U.name||O.Tools.GetFilename(U);if(e){if(this.useRangeRequests){this.validate&&z.d.Warn("glTF validation is not supported when range requests are enabled");const K={abort:()=>{},onCompleteObservable:new m.b},O={readAsync:(K,m)=>new Promise(((O,X)=>{this._loadFile(C,U,(C=>{O(new Uint8Array(C))}),!0,(C=>{X(C)}),(C=>{C.setRequestHeader("Range",`bytes=${K}-${K+m-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Z(O)).then((C=>{K.onCompleteObservable.notifyObservers(K),X(C)}),t?C=>t(void 0,C):void 0),K}return this._loadFile(C,U,(U=>{this._validate(C,new Uint8Array(U,0,U.byteLength),K,p),this._unpackBinaryAsync(new Z({readAsync:(C,K)=>D(U,C,K),byteLength:U.byteLength})).then((C=>{X(C)}),t?C=>t(void 0,C):void 0)}),!0,t)}return this._loadFile(C,U,(U=>{try{this._validate(C,U,K,p),X({json:this._parseJson(U)})}catch{t&&t()}}),!1,t)}_loadBinary(C,U,K,m,O,X){this._validate(C,new Uint8Array(U.buffer,U.byteOffset,U.byteLength),K,X),this._unpackBinaryAsync(new Z({readAsync:(C,K)=>function(C,U,K){try{if(U<0||U>=C.byteLength)throw new RangeError("Offset is out of range.");if(U+K>C.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(C.buffer,C.byteOffset+U,K))}catch(m){return Promise.reject(m)}}(U,C,K),byteLength:U.byteLength})).then((C=>{m(C)}),O?C=>O(void 0,C):void 0)}importMeshAsync(C,U,K,m,O,X){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(K),this.onParsedObservable.clear(),this._log(`Loading ${X||""}`),this._loader=this._getLoader(K),this._loader.importMeshAsync(C,U,null,K,m,O,X))))}loadAsync(C,U,K,m,O){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${O||""}`),this._loader=this._getLoader(U),this._loader.loadAsync(C,U,K,m,O))))}loadAssetContainerAsync(C,U,K,m,O){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(U),this.onParsedObservable.clear(),this._log(`Loading ${O||""}`),this._loader=this._getLoader(U);const X=new f(C),A=[];this.onMaterialLoadedObservable.add((C=>{A.push(C)}));const e=[];this.onTextureLoadedObservable.add((C=>{e.push(C)}));const t=[];this.onCameraLoadedObservable.add((C=>{t.push(C)}));const z=[];return this.onMeshLoadedObservable.add((C=>{C.morphTargetManager&&z.push(C.morphTargetManager)})),this._loader.importMeshAsync(null,C,X,U,K,m,O).then((C=>(Array.prototype.push.apply(X.geometries,C.geometries),Array.prototype.push.apply(X.meshes,C.meshes),Array.prototype.push.apply(X.AE,C.AE),Array.prototype.push.apply(X.skeletons,C.skeletons),Array.prototype.push.apply(X.animationGroups,C.animationGroups),Array.prototype.push.apply(X.materials,A),Array.prototype.push.apply(X.textures,e),Array.prototype.push.apply(X.lights,C.lights),Array.prototype.push.apply(X.transformNodes,C.transformNodes),Array.prototype.push.apply(X.cameras,t),Array.prototype.push.apply(X.morphTargetManagers,z),X)))}))}canDirectLoad(C){return d.canDirectLoad(C)}directLoad(C,U){if(U.startsWith("base64,"+H)||U.startsWith(";base64,"+H)||U.startsWith("application/octet-stream;base64,"+H)||U.startsWith("model/gltf-binary;base64,"+H)){const K=(0,r.d)(U);return this._validate(C,new Uint8Array(K,0,K.byteLength)),this._unpackBinaryAsync(new Z({readAsync:(C,U)=>D(K,C,U),byteLength:K.byteLength}))}return this._validate(C,U),Promise.resolve({json:this._parseJson(U)})}createPlugin(C){return new G(C[d.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((C,U)=>{this.onCompleteObservable.addOnce((()=>{C()})),this.onErrorObservable.addOnce((C=>{U(C)}))}))}_setState(C){this._state!==C&&(this._state=C,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(a[this._state]))}_loadFile(C,U,K,m,O,X){const A=C._loadFile(U,K,(C=>{this._onProgress(C,A)}),!0,m,O,X);return A.onCompleteObservable.add((()=>{A._lengthComputable=!0,A._total=A._loaded})),this._requests.push(A),A}_onProgress(C,U){if(!this._progressCallback)return;U._lengthComputable=C.lengthComputable,U._loaded=C.loaded,U._total=C.total;let K=!0,m=0,O=0;for(const X of this._requests){if(void 0===X._lengthComputable||void 0===X._loaded||void 0===X._total)return;K=K&&X._lengthComputable,m+=X._loaded,O+=X._total}this._progressCallback({lengthComputable:K,loaded:m,total:K?O:0})}_validate(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),P.c.ValidateAsync(U,K,m,(U=>this.preprocessUrlAsync(K+U).then((U=>C._loadFileAsync(U,void 0,!0,!0).then((C=>new Uint8Array(C,0,C.byteLength))))))).then((C=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(C),this.onValidatedObservable.clear()}),(C=>{this._endPerformanceCounter("Validate JSON"),O.Tools.Warn(`Failed to validate: ${C.message}`),this.onValidatedObservable.clear()})))}_getLoader(C){const U=C.json.asset||{};this._log(`Asset version: ${U.version}`),U.minVersion&&this._log(`Asset minimum version: ${U.minVersion}`),U.generator&&this._log(`Asset generator: ${U.generator}`);const K=G._parseVersion(U.version);if(!K)throw new Error("Invalid version: "+U.version);if(void 0!==U.minVersion){const C=G._parseVersion(U.minVersion);if(!C)throw new Error("Invalid minimum version: "+U.minVersion);if(G._compareVersion(C,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+U.minVersion)}const m={1:G._CreateGLTF1Loader,2:G._CreateGLTF2Loader}[K.major];if(!m)throw new Error("Unsupported version: "+U.version);return m(this)}_parseJson(C){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${C.length}`);const U=JSON.parse(C);return this._endPerformanceCounter("Parse JSON"),U}_unpackBinaryAsync(C){return this._startPerformanceCounter("Unpack Binary"),C.loadAsync(20).then((()=>{const U=C.readUint32();if(1179937895!==U)throw new i.j("Unexpected magic: "+U,i.f.GLTFLoaderUnexpectedMagicError);const K=C.readUint32();this.loggingEnabled&&this._log(`Binary version: ${K}`);const m=C.readUint32();let O;switch(this.useRangeRequests||m===C.buffer.byteLength||z.d.Warn(`Length in header does not match actual data length: ${m} != ${C.buffer.byteLength}`),K){case 1:O=this._unpackBinaryV1Async(C,m);break;case 2:O=this._unpackBinaryV2Async(C,m);break;default:throw new Error("Unsupported version: "+K)}return this._endPerformanceCounter("Unpack Binary"),O}))}_unpackBinaryV1Async(C,U){const K=C.readUint32(),m=C.readUint32();if(0!==m)throw new Error(`Unexpected content format: ${m}`);const O=U-C.byteOffset,X={json:this._parseJson(C.readString(K)),bin:null};if(0!==O){const U=C.byteOffset;X.bin={readAsync:(K,m)=>C.buffer.readAsync(U+K,m),byteLength:O}}return Promise.resolve(X)}_unpackBinaryV2Async(C,U){const K=1313821514,m=5130562,O=C.readUint32();if(C.readUint32()!==K)throw new Error("First chunk format is not JSON");return C.byteOffset+O===U?C.loadAsync(O).then((()=>({json:this._parseJson(C.readString(O)),bin:null}))):C.loadAsync(O+8).then((()=>{const X={json:this._parseJson(C.readString(O)),bin:null},A=()=>{const O=C.readUint32();switch(C.readUint32()){case K:throw new Error("Unexpected JSON chunk");case m:{const U=C.byteOffset;X.bin={readAsync:(K,m)=>C.buffer.readAsync(U+K,m),byteLength:O},C.skipBytes(O);break}default:C.skipBytes(O)}return C.byteOffset!==U?C.loadAsync(8).then(A):Promise.resolve(X)};return A()}))}static _parseVersion(C){if("1.0"===C||"1.0.1"===C)return{major:1,minor:0};const U=(C+"").match(/^(\d+)\.(\d+)/);return U?{major:parseInt(U[1]),minor:parseInt(U[2])}:null}static _compareVersion(C,U){return C.major>U.major?1:C.major<U.major?-1:C.minor>U.minor?1:C.minor<U.minor?-1:0}_logOpen(C){this._log(C),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(C){const U=G._logSpaces.substring(0,2*this._logIndentLevel);z.d.Log(`${U}${C}`)}_logDisabled(C){}_startPerformanceCounterEnabled(C){O.Tools.StartPerformanceCounter(C)}_startPerformanceCounterDisabled(C){}_endPerformanceCounterEnabled(C){O.Tools.EndPerformanceCounter(C)}_endPerformanceCounterDisabled(C){}}G.IncrementalLoading=!0,G.HomogeneousCoordinates=!1,G._logSpaces="                                ",(0,X.e)(new G)},13450:(C,U,K)=>{"use strict";K.d(U,{c:()=>A});var m=K(11660);function O(C,U,K,m){const O={externalResourceFunction:m};return K&&(O.uri="file:"===U?K:U+K),ArrayBuffer.isView(C)?GLTFValidator.validateBytes(C,O):GLTFValidator.validateString(C,O)}function X(){const C=[];onmessage=U=>{const K=U.data;switch(K.id){case"init":importScripts(K.url);break;case"validate":O(K.data,K.rootUrl,K.fileName,(U=>new Promise(((K,m)=>{const O=C.length;C.push({resolve:K,reject:m}),postMessage({id:"getExternalResource",index:O,uri:U})})))).then((C=>{postMessage({id:"validate.resolve",value:C})}),(C=>{postMessage({id:"validate.reject",reason:C})}));break;case"getExternalResource.resolve":C[K.index].resolve(K.value);break;case"getExternalResource.reject":C[K.index].reject(K.reason)}}}class A{static ValidateAsync(C,U,K,A){return"function"===typeof Worker?new Promise(((e,t)=>{const z=`${O}(${X})()`,j=URL.createObjectURL(new Blob([z],{type:"application/javascript"})),p=new Worker(j),E=C=>{p.removeEventListener("error",E),p.removeEventListener("message",u),t(C)},u=C=>{const U=C.data;switch(U.id){case"getExternalResource":A(U.uri).then((C=>{p.postMessage({id:"getExternalResource.resolve",index:U.index,value:C},[C.buffer])}),(C=>{p.postMessage({id:"getExternalResource.reject",index:U.index,reason:C})}));break;case"validate.resolve":p.removeEventListener("error",E),p.removeEventListener("message",u),e(U.value),p.terminate();break;case"validate.reject":p.removeEventListener("error",E),p.removeEventListener("message",u),t(U.reason),p.terminate()}};if(p.addEventListener("error",E),p.addEventListener("message",u),p.postMessage({id:"init",url:m.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(C)){const m=C.slice();p.postMessage({id:"validate",data:m,rootUrl:U,fileName:K},[m.buffer])}else p.postMessage({id:"validate",data:C,rootUrl:U,fileName:K})})):(this._LoadScriptPromise||(this._LoadScriptPromise=m.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>O(C,U,K,A))))}}A.Configuration={url:`${m.Tools._DefaultCdnUrl}/gltf_validator.js`}},13999:(C,U,K)=>{"use strict";K.d(U,{c:()=>d});var m=K(11810),O=K(11818),X=K(11863),A=K(11827),e=K(12216),t=K(12150),z=K(11905),j=K(12078),p=K(11789),E=K(11747);K(13198),K(13113),K(13123),K(13116),K(13128),K(13131),K(13134);const u="imageProcessingCompatibility",b="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";E.d.IncludesShadersStore[u]||(E.d.IncludesShadersStore[u]=b);const v="skyPixelShader",Q="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";E.d.ShadersStore[v]||(E.d.ShadersStore[v]=Q);K(13212),K(13140),K(13142),K(13153),K(13145);const V="skyVertexShader",f="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";E.d.ShadersStore[V]||(E.d.ShadersStore[V]=f);var F=K(12148),Z=K(12200),P=K(12198);class H extends e.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class d extends t.b{constructor(C,U){super(C,U),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new A.bU(0,100,0),this.useSunPosition=!1,this.cameraOffset=A.bU.Zero(),this.up=A.bU.Up(),this.dithering=!1,this._cameraPosition=A.bU.Zero(),this._skyOrientation=new A.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(C,U){const K=U._drawWrapper;if(this.isFrozen&&K.effect&&K._wasPreviouslyReady)return!0;U.materialDefines||(U.materialDefines=new H);const m=U.materialDefines,O=this.dC();if(this._isReadyForSubMesh(U))return!0;if((0,P.O)(C,O,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,m),(0,P.H)(C,m,!0,!1),m.IMAGEPROCESSINGPOSTPROCESS!==O.imageProcessingConfiguration.applyByPostProcess&&m.markAsMiscDirty(),m.DITHER!==this.dithering&&m.markAsMiscDirty(),m.isDirty){m.markAsProcessed(),O.resetCachedMaterial();const C=new F.d;m.FOG&&C.addFallback(1,"FOG"),m.IMAGEPROCESSINGPOSTPROCESS=O.imageProcessingConfiguration.applyByPostProcess,m.DITHER=this.dithering;const K=[z.d.PositionKind];m.VERTEXCOLOR&&K.push(z.d.ColorKind);const X="sky",A=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Z.d)(A);const e=m.toString();U.setEffect(O.getEngine().createEffect(X,K,A,[],e,C,this.onCompiled,this.onError),m,this._materialContext)}return!(!U.effect||!U.effect.isReady())&&(m._renderId=O.getRenderId(),K._wasPreviouslyReady=!0,!0)}bindForSubMesh(C,U,K){const m=this.dC(),O=K.materialDefines;if(!O)return;const X=K.effect;if(!X)return;this._activeEffect=X,this.bindOnlyWorldMatrix(C),this._activeEffect.setMatrix("viewProjection",m.getTransformMatrix()),this._mustRebind(m,X,K)&&((0,Z.f)(X,this,m),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,P.k)(O,X,m)),m.fogEnabled&&U.applyFog&&m.fogMode!==j.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",m.getViewMatrix()),(0,P.f)(m,U,this._activeEffect);const e=m.activeCamera;if(e){const C=e.getWorldMatrix();this._cameraPosition.x=C.m[12],this._cameraPosition.y=C.m[13],this._cameraPosition.z=C.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const C=Math.PI*(this.inclination-.5),U=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(U)*Math.cos(C),this.sunPosition.y=this.distance*Math.sin(-C),this.sunPosition.z=this.distance*Math.sin(U)*Math.cos(C),A.Quaternion.FromUnitVectorsToRef(A.bU.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(U,this._activeEffect,K)}getAnimatables(){return[]}dispose(C){super.dispose(C)}clone(C){return X.c.Clone((()=>new d(C,this.dC())),this)}serialize(){const C=super.serialize();return C.customType="BABYLON.SkyMaterial",C}getClassName(){return"SkyMaterial"}static Parse(C,U,K){return X.c.Parse((()=>new d(C.name,U)),C,U,K)}}(0,m.d)([(0,O.O)()],d.prototype,"luminance",void 0),(0,m.d)([(0,O.O)()],d.prototype,"turbidity",void 0),(0,m.d)([(0,O.O)()],d.prototype,"rayleigh",void 0),(0,m.d)([(0,O.O)()],d.prototype,"mieCoefficient",void 0),(0,m.d)([(0,O.O)()],d.prototype,"mieDirectionalG",void 0),(0,m.d)([(0,O.O)()],d.prototype,"distance",void 0),(0,m.d)([(0,O.O)()],d.prototype,"inclination",void 0),(0,m.d)([(0,O.O)()],d.prototype,"azimuth",void 0),(0,m.d)([(0,O.L)()],d.prototype,"sunPosition",void 0),(0,m.d)([(0,O.O)()],d.prototype,"useSunPosition",void 0),(0,m.d)([(0,O.L)()],d.prototype,"cameraOffset",void 0),(0,m.d)([(0,O.L)()],d.prototype,"up",void 0),(0,m.d)([(0,O.O)()],d.prototype,"dithering",void 0),(0,p.h)("BABYLON.SkyMaterial",d)},12512:(C,U,K)=>{"use strict";function m(C,U){U.headers=C.headers||{},U.statusMessage=C.statusText,U.statusCode=C.status,U.data=C.response}function O(C,U,K){return new Promise((function(O,X){K=K||{};var A,e,t,z=new XMLHttpRequest,j=K.body,p=K.headers||{};for(A in K.timeout&&(z.timeout=K.timeout),z.ontimeout=z.onerror=function(C){C.timeout="timeout"==C.type,X(C)},z.open(C,U.href||U),z.onload=function(){for(t=z.getAllResponseHeaders().trim().split(/[\r\n]+/),m(z,z);e=t.shift();)e=e.split(": "),z.headers[e.shift().toLowerCase()]=e.join(": ");if((e=z.headers["content-type"])&&~e.indexOf("application/json"))try{z.data=JSON.parse(z.data,K.reviver)}catch(C){return m(z,C),X(C)}(z.status>=400?X:O)(z)},typeof FormData<"u"&&j instanceof FormData||j&&"object"==typeof j&&(p["content-type"]="application/json",j=JSON.stringify(j)),z.withCredentials=!!K.withCredentials,p)z.setRequestHeader(A,p[A]);z.send(j)}))}K.r(U),K.d(U,{del:()=>t,get:()=>X,patch:()=>e,post:()=>A,put:()=>z,send:()=>O});var X=O.bind(O,"GET"),A=O.bind(O,"POST"),e=O.bind(O,"PATCH"),t=O.bind(O,"DELETE"),z=O.bind(O,"PUT")},14097:(C,U,K)=>{"use strict";K.d(U,{e:()=>p});const m=.5*(Math.sqrt(3)-1),O=(3-Math.sqrt(3))/6,X=1/3,A=1/6,e=(Math.sqrt(5)-1)/4,t=(5-Math.sqrt(5))/20,z=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),j=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const p=class{constructor(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const U="function"==typeof C?C:function(C){let U=0,K=0,m=0,O=1;const X=function(){let C=4022871197;return function(U){U=U.toString();for(let K=0;K<U.length;K++){C+=U.charCodeAt(K);let m=.02519603282416938*C;C=m>>>0,m-=C,m*=C,C=m>>>0,m-=C,C+=4294967296*m}return 2.3283064365386963e-10*(C>>>0)}}();U=X(" "),K=X(" "),m=X(" "),U-=X(C),U<0&&(U+=1);K-=X(C),K<0&&(K+=1);m-=X(C),m<0&&(m+=1);return function(){const C=2091639*U+2.3283064365386963e-10*O;return U=K,K=m,m=C-(O=0|C)}}(C);this.p=function(C){const U=new Uint8Array(256);for(let K=0;K<256;K++)U[K]=K;for(let K=0;K<255;K++){const m=K+~~(C()*(256-K)),O=U[K];U[K]=U[m],U[m]=O}return U}(U),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let K=0;K<512;K++)this.perm[K]=this.p[255&K],this.permMod12[K]=this.perm[K]%12}noise2D(C,U){const K=this.permMod12,X=this.perm;let A=0,e=0,t=0;const j=(C+U)*m,p=Math.floor(C+j),E=Math.floor(U+j),u=(p+E)*O,b=C-(p-u),v=U-(E-u);let Q,V;b>v?(Q=1,V=0):(Q=0,V=1);const f=b-Q+O,F=v-V+O,Z=b-1+2*O,P=v-1+2*O,H=255&p,d=255&E;let T=.5-b*b-v*v;if(T>=0){const C=3*K[H+X[d]];T*=T,A=T*T*(z[C]*b+z[C+1]*v)}let y=.5-f*f-F*F;if(y>=0){const C=3*K[H+Q+X[d+V]];y*=y,e=y*y*(z[C]*f+z[C+1]*F)}let a=.5-Z*Z-P*P;if(a>=0){const C=3*K[H+1+X[d+1]];a*=a,t=a*a*(z[C]*Z+z[C+1]*P)}return 70*(A+e+t)}noise3D(C,U,K){const m=this.permMod12,O=this.perm;let e,t,j,p;const E=(C+U+K)*X,u=Math.floor(C+E),b=Math.floor(U+E),v=Math.floor(K+E),Q=(u+b+v)*A,V=C-(u-Q),f=U-(b-Q),F=K-(v-Q);let Z,P,H,d,T,y;V>=f?f>=F?(Z=1,P=0,H=0,d=1,T=1,y=0):V>=F?(Z=1,P=0,H=0,d=1,T=0,y=1):(Z=0,P=0,H=1,d=1,T=0,y=1):f<F?(Z=0,P=0,H=1,d=0,T=1,y=1):V<F?(Z=0,P=1,H=0,d=0,T=1,y=1):(Z=0,P=1,H=0,d=1,T=1,y=0);const a=V-Z+A,r=f-P+A,i=F-H+A,D=V-d+2*A,l=f-T+2*A,G=F-y+2*A,J=V-1+.5,o=f-1+.5,B=F-1+.5,k=255&u,w=255&b,h=255&v;let c=.6-V*V-f*f-F*F;if(c<0)e=0;else{const C=3*m[k+O[w+O[h]]];c*=c,e=c*c*(z[C]*V+z[C+1]*f+z[C+2]*F)}let N=.6-a*a-r*r-i*i;if(N<0)t=0;else{const C=3*m[k+Z+O[w+P+O[h+H]]];N*=N,t=N*N*(z[C]*a+z[C+1]*r+z[C+2]*i)}let g=.6-D*D-l*l-G*G;if(g<0)j=0;else{const C=3*m[k+d+O[w+T+O[h+y]]];g*=g,j=g*g*(z[C]*D+z[C+1]*l+z[C+2]*G)}let M=.6-J*J-o*o-B*B;if(M<0)p=0;else{const C=3*m[k+1+O[w+1+O[h+1]]];M*=M,p=M*M*(z[C]*J+z[C+1]*o+z[C+2]*B)}return 32*(e+t+j+p)}noise4D(C,U,K,m){const O=this.perm;let X,A,z,p,E;const u=(C+U+K+m)*e,b=Math.floor(C+u),v=Math.floor(U+u),Q=Math.floor(K+u),V=Math.floor(m+u),f=(b+v+Q+V)*t,F=C-(b-f),Z=U-(v-f),P=K-(Q-f),H=m-(V-f);let d=0,T=0,y=0,a=0;F>Z?d++:T++,F>P?d++:y++,F>H?d++:a++,Z>P?T++:y++,Z>H?T++:a++,P>H?y++:a++;const r=d>=3?1:0,i=T>=3?1:0,D=y>=3?1:0,l=a>=3?1:0,G=d>=2?1:0,J=T>=2?1:0,o=y>=2?1:0,B=a>=2?1:0,k=d>=1?1:0,w=T>=1?1:0,h=y>=1?1:0,c=a>=1?1:0,N=F-r+t,g=Z-i+t,M=P-D+t,L=H-l+t,Y=F-G+2*t,W=Z-J+2*t,x=P-o+2*t,n=H-B+2*t,S=F-k+3*t,s=Z-w+3*t,R=P-h+3*t,q=H-c+3*t,I=F-1+4*t,CC=Z-1+4*t,UC=P-1+4*t,KC=H-1+4*t,mC=255&b,OC=255&v,XC=255&Q,AC=255&V;let eC=.6-F*F-Z*Z-P*P-H*H;if(eC<0)X=0;else{const C=O[mC+O[OC+O[XC+O[AC]]]]%32*4;eC*=eC,X=eC*eC*(j[C]*F+j[C+1]*Z+j[C+2]*P+j[C+3]*H)}let tC=.6-N*N-g*g-M*M-L*L;if(tC<0)A=0;else{const C=O[mC+r+O[OC+i+O[XC+D+O[AC+l]]]]%32*4;tC*=tC,A=tC*tC*(j[C]*N+j[C+1]*g+j[C+2]*M+j[C+3]*L)}let zC=.6-Y*Y-W*W-x*x-n*n;if(zC<0)z=0;else{const C=O[mC+G+O[OC+J+O[XC+o+O[AC+B]]]]%32*4;zC*=zC,z=zC*zC*(j[C]*Y+j[C+1]*W+j[C+2]*x+j[C+3]*n)}let jC=.6-S*S-s*s-R*R-q*q;if(jC<0)p=0;else{const C=O[mC+k+O[OC+w+O[XC+h+O[AC+c]]]]%32*4;jC*=jC,p=jC*jC*(j[C]*S+j[C+1]*s+j[C+2]*R+j[C+3]*q)}let pC=.6-I*I-CC*CC-UC*UC-KC*KC;if(pC<0)E=0;else{const C=O[mC+1+O[OC+1+O[XC+1+O[AC+1]]]]%32*4;pC*=pC,E=pC*pC*(j[C]*I+j[C+1]*CC+j[C+2]*UC+j[C+3]*KC)}return 27*(X+A+z+p+E)}}}}]);